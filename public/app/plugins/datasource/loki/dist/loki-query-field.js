"use strict";(globalThis.webpackChunkloki=globalThis.webpackChunkloki||[]).push([[952],{1020:(e,t,n)=>{n.r(t),n.d(t,{default:()=>ae,defaultWordPattern:()=>se});var r=n(9728),i=n(6089),o=n(3241),l=n(5959);const s=function(e){var t=(0,l.useRef)(e);return t.current=e,t};var a=n(9992),u=n(9076),c=n(5508),d=n(7547),g=n(2007);let p={storageService:function(){const e=new Map;return e.set("expandSuggestionDocs",(!0).toString()),{onDidChangeValue:e=>{},onDidChangeTarget:e=>{},onWillSaveState:e=>{},get:(t,n,r)=>{var i;return null!==(i=e.get(t))&&void 0!==i?i:r},getBoolean:(t,n,r)=>{const i=e.get(t);return void 0!==i?"true"===i:r},getNumber:(t,n,r)=>{const i=e.get(t);return void 0!==i?parseInt(i,10):r},store:(t,n,r,i)=>{null==n?e.delete(t):e.set(t,n.toString())},remove:(t,n)=>{e.delete(t)},keys:(t,n)=>Array.from(e.keys()),logStorage:()=>{},migrate:()=>Promise.resolve(void 0),isNew:e=>!0,flush:e=>Promise.resolve(void 0)}}()};var f=n(7895);function m(e,t,n,r,i,o,l){try{var s=e[o](l),a=s.value}catch(e){return void n(e)}s.done?t(a):Promise.resolve(a).then(r,i)}function h(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var o=e.apply(t,n);function l(e){m(o,r,i,l,s,"next",e)}function s(e){m(o,r,i,l,s,"throw",e)}l(void 0)}))}}function y(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class b{buildSelector(e){return`{${e.map((e=>`${e.name}${e.op}"${(0,f.Qn)(e.value)}"`)).join(",")}}`}setTimeRange(e){this.timeRange=e,this.queryToLabelKeysCache.clear()}getHistory(){return(0,o.chain)(this.historyRef.current).orderBy("ts","desc").map((e=>e.query.expr.trim())).filter().uniq().value()}getLabelNames(){return h((function*(e=[]){if(0===e.length)return yield this.languageProvider.start(this.timeRange),this.languageProvider.getLabelKeys();const t=yield this.languageProvider.fetchLabels({streamSelector:this.buildSelector(e),timeRange:this.timeRange}),n=new Set(e.map((e=>e.name)));return t.filter((e=>!n.has(e)))})).apply(this,arguments)}getLabelValues(e,t){return h((function*(){return yield this.languageProvider.fetchLabelValues(e,{streamSelector:this.buildSelector(t),timeRange:this.timeRange})})).call(this)}getParserAndLabelKeys(e){return h((function*(){const t=this.queryToLabelKeysCache.has(e)?this.queryToLabelKeysCache.get(e):null;if(t)return t;{if(this.queryToLabelKeysCache.size>=2){const e=this.queryToLabelKeysCache.keys().next().value;void 0!==e&&this.queryToLabelKeysCache.delete(e)}const t=yield this.languageProvider.getParserAndLabelKeys(e,{timeRange:this.timeRange});return this.queryToLabelKeysCache.set(e,t),t}})).call(this)}constructor(e,t={current:[]},n){y(this,"languageProvider",void 0),y(this,"historyRef",void 0),y(this,"timeRange",void 0),y(this,"queryToLabelKeysCache",void 0),this.languageProvider=e,this.historyRef=t,this.timeRange=n,this.queryToLabelKeysCache=new Map}}class v extends Error{constructor(e){super(`Unexpected case in switch statement: ${JSON.stringify(e)}`)}}var E=n(6227),L=n(3496),_=n(8116),T=n(601);function N(e,t,n,r,i,o,l){try{var s=e[o](l),a=s.value}catch(e){return void n(e)}s.done?t(a):Promise.resolve(a).then(r,i)}function P(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var o=e.apply(t,n);function l(e){N(o,r,i,l,s,"next",e)}function s(e){N(o,r,i,l,s,"throw",e)}l(void 0)}))}}const A=[{type:"PATTERN",label:"{}",insertText:"{$0}",isSnippet:!0,triggerOnInsert:!0}],C=T.dZ.map((e=>{var t;return{type:"FUNCTION",label:e.label,insertText:`${null!==(t=e.insertText)&&void 0!==t?t:""}($0)`,isSnippet:!0,triggerOnInsert:!0,detail:e.detail,documentation:e.documentation}})),O=T.RQ.map((e=>{var t;return{type:"FUNCTION",label:e.label,insertText:`${null!==(t=e.insertText)&&void 0!==t?t:""}({$0}[\\$__auto])`,isSnippet:!0,triggerOnInsert:!0,detail:e.detail,documentation:e.documentation}})),x=T.fV.map((e=>{var t;return{type:"FUNCTION",label:e.label,insertText:`${null!==(t=e.insertText)&&void 0!==t?t:""}($0)`,isSnippet:!0,triggerOnInsert:!0,detail:e.detail,documentation:e.documentation}})),R=["$__auto","1m","5m","10m","30m","1h","1d"].map((e=>({type:"DURATION",label:e,insertText:e}))),w=[{type:"FUNCTION",label:"duration_seconds",documentation:"Will convert the label value in seconds from the go duration format (e.g 5m, 24s30ms).",insertText:"duration_seconds()"},{type:"FUNCTION",label:"duration",documentation:"Short version of duration_seconds().",insertText:"duration()"},{type:"FUNCTION",label:"bytes",documentation:"Will convert the label value to raw bytes applying the bytes unit (e.g. 5 MiB, 3k, 1G).",insertText:"bytes()"}],I=[{type:"FUNCTION",label:"--strict",documentation:"Strict parsing. The logfmt parser stops scanning the log line and returns early with an error when it encounters any poorly formatted key/value pair.",insertText:"--strict"},{type:"FUNCTION",label:"--keep-empty",documentation:"Retain standalone keys with empty value. The logfmt parser retains standalone keys (keys without a value) as labels with value set to empty string.",insertText:"--keep-empty"}],S=[{operator:"|=",documentation:(0,L.y6)(_.EF.LineContains),afterPipe:!0},{operator:"!=",documentation:(0,L.y6)(_.EF.LineContainsNot)},{operator:"|~",documentation:(0,L.y6)(_.EF.LineMatchesRegex),afterPipe:!0},{operator:"!~",documentation:(0,L.y6)(_.EF.LineMatchesRegexNot)}];function M(e=""){const t=[];return t.push({type:"PIPE_OPERATION",label:"line_format",insertText:`${e}line_format "{{.$0}}"`,isSnippet:!0,documentation:(0,L.y6)(_.EF.LineFormat)}),t.push({type:"PIPE_OPERATION",label:"label_format",insertText:`${e}label_format`,isSnippet:!0,documentation:(0,L.y6)(_.EF.LabelFormat)}),t.push({type:"PIPE_OPERATION",label:"unwrap",insertText:`${e}unwrap`,documentation:(0,L.y6)(_.EF.Unwrap)}),t.push({type:"PIPE_OPERATION",label:"decolorize",insertText:`${e}decolorize`,documentation:(0,L.y6)(_.EF.Decolorize)}),t.push({type:"PIPE_OPERATION",label:"drop",insertText:`${e}drop`,documentation:(0,L.y6)(_.EF.Drop)}),t.push({type:"PIPE_OPERATION",label:"keep",insertText:`${e}keep`,documentation:(0,L.y6)(_.EF.Keep)}),t}const $=["json","logfmt","pattern","regexp","unpack"];function k(e,t,n,r,i,o){return P((function*(){const l=new Set($),s=[],a=i.some((e=>"level"===e));if(t){const t=o?"":" (detected)";r?(l.delete("unpack"),s.push({type:"PARSER",label:`unpack${t}`,insertText:`${e}unpack`,documentation:(0,L.y6)(_.EF.Unpack)})):(l.delete("json"),s.push({type:"PARSER",label:`json${t}`,insertText:`${e}json`,documentation:a?"Use it to get log-levels in the histogram":(0,L.y6)(_.EF.Json)}))}if(n){l.delete("logfmt");const t=o?"":" (detected)";s.push({type:"PARSER",label:`logfmt${t}`,insertText:`${e}logfmt`,documentation:a?"Get detected levels in the histogram":(0,L.y6)(_.EF.Logfmt)})}return Array.from(l).sort().forEach((t=>{s.push({type:"PARSER",label:t,insertText:`${e}${t}`,documentation:(0,L.y6)(t)})})),s}))()}function K(e,t,n,r){return P((function*(){let i=e;t&&(i=(0,o.trimEnd)(e,"| "));const{extractedLabelKeys:l,structuredMetadataKeys:s,hasJSON:a,hasLogfmt:u,hasPack:c}=yield r.getParserAndLabelKeys(i),d=(0,E.MX)(i).queryWithParser,g=`${n?"":" "}${t?"":"| "}`,p=[...yield k(g,a,u,c,l,d),...M(g)];if(s.forEach((e=>{p.push({type:"LABEL_NAME",label:`${e} (detected)`,insertText:`${g}${e}`,documentation:`"${e}" was suggested based on structured metadata attached to your loglines.`})})),d&&l.forEach((e=>{p.push({type:"LABEL_NAME",label:`${e} (detected)`,insertText:`${g}${e}`,documentation:`"${e}" was suggested based on the content of your log lines for the label filter expression.`})})),d)return[...p];const f=t&&n?[]:function(e){return S.filter((t=>!e||t.afterPipe)).map((({operator:t,documentation:n})=>({type:"LINE_FILTER",label:`${t} ""`,insertText:`${e?t.replace("|",""):t} "$0"`,isSnippet:!0,documentation:n})))}(t);return[...f,...p]}))()}function F(e,t){return P((function*(){switch(e.type){case"EMPTY":case"AT_ROOT":const n=yield function(e){return P((function*(){return(yield e.getHistory()).map((e=>({type:"HISTORY",label:e,insertText:e})))}))()}(t);return[...n,...A,...C,...x,...O];case"IN_RANGE":return R;case"IN_GROUPING":return function(e,t){return P((function*(){const{extractedLabelKeys:n}=yield t.getParserAndLabelKeys(e);return n.map((e=>({type:"LABEL_NAME",label:e,insertText:e,triggerOnInsert:!1})))}))()}(e.logQuery,t);case"IN_LABEL_SELECTOR_NO_LABEL_NAME":return function(e,t){return P((function*(){return(yield t.getLabelNames(e)).map((e=>({type:"LABEL_NAME",label:e,insertText:`${e}=`,triggerOnInsert:!0})))}))()}(e.otherLabels,t);case"IN_LABEL_SELECTOR_WITH_LABEL_NAME":return function(e,t,n,r){return P((function*(){return(yield r.getLabelValues(e,n)).map((e=>({type:"LABEL_VALUE",label:e,insertText:t?(0,f.Qn)(e):`"${(0,f.Qn)(e)}"`})))}))()}(e.labelName,e.betweenQuotes,e.otherLabels,t);case"AFTER_SELECTOR":return K(e.logQuery,e.afterPipe,e.hasSpace,t);case"AFTER_UNWRAP":return function(e,t){return P((function*(){const{unwrapLabelKeys:n}=yield t.getParserAndLabelKeys(e);return[...n.map((e=>({type:"LABEL_NAME",label:e,insertText:e,triggerOnInsert:!1}))),...w]}))()}(e.logQuery,t);case"IN_AGGREGATION":return[...O,...C];case"AFTER_KEEP_AND_DROP":return function(e,t){return P((function*(){const{extractedLabelKeys:n}=yield t.getParserAndLabelKeys(e);return[...n.map((e=>({type:"LABEL_NAME",label:e,insertText:e,triggerOnInsert:!1})))]}))()}(e.logQuery,t);case"IN_LOGFMT":return function(e,t,n,r,i,l){return P((function*(){let s=[];n&&(e=(0,o.trimEnd)(e,", "));const{extractedLabelKeys:a,hasJSON:u,hasLogfmt:c,hasPack:d}=yield l.getParserAndLabelKeys(e),g=M("| ");if(n||t||(s=[...I]),!n&&r){const e=i.length>0?yield k("| ",u,c,d,a,!0):[];s=[...s,...e,...g]}const p=a.filter((e=>!i.includes(e)));let f="";i.length>0&&r&&(f=n?"":", ");const m=p.map((e=>({type:"LABEL_NAME",label:e,insertText:f+e,triggerOnInsert:!1})));return s=[...s,...m],s}))()}(e.logQuery,e.flags,e.trailingComma,e.trailingSpace,e.otherLabels,t);default:throw new v(e)}}))()}function B(e,t){return e[t]}function D(e,t){let n=e;for(const[e,r]of t){if(n=B(n,e),null===n)return null;if(n.type.id!==r)return null}return n}function q(e,t){return t.slice(e.from,e.to)}function W(e,t){return e.every(((e,n)=>e===t[n]))}const U=[{paths:[[c.MD],[c.MD,c.sq],[c.sq],[0,c.sq],[0,c.sq,c.MD]],fun:function(e,t,n){const r=D(e,[["firstChild",c.sq]]);if(null!==r){if(!t.slice(r.from,n).trim().endsWith(","))return null}const i=0===e.type.id?D(e,[["parent",c.sq]]):e;if(!i)return null;return{type:"IN_LABEL_SELECTOR_NO_LABEL_NAME",otherLabels:G(i,t)}}},{paths:[[c.K0],[c.h1],[0,c.xo,c.h1],[0,c.I4],[c.xo],[0,c.I4],[c.I4],[c.Tz]],fun:function(e,t,n){const r=c.K3.parse(t),i=t.substring(0,n).trimEnd().length,o=i<n?i:n,l=r.cursorAt(o),s=[c.c$,c.ov,c.Gn,c.I4];let a=!1;do{const{node:e}=l;if(s.includes(e.type.id)&&(l.from<=o&&l.to>=o)){a=!0;break}}while(l.next());if(!a)return null;const u=(0,E.QH)(t,[c.ov]).length>1,d=(0,E.QH)(t,[c.Gn]).map((e=>e.getChild(c.gw))).filter((e=>null!==e)).map((e=>q(e,t))),g=(0,E.g5)(t,o).trim(),p=" "===t.charAt(n-1),f=","===t.trimEnd().charAt(o-1);return{type:"IN_LOGFMT",otherLabels:d,flags:u,trailingSpace:p,trailingComma:f,logQuery:g}}},{paths:[[c.K0],[0,c.MD]],fun:function(e,t,n){const r=D(e,[["lastChild",c.GN],["lastChild",c.UK]]);if(null!=r&&t.endsWith(" "))return z(r,t,n,!1);if(null!=D(e,[["firstChild",0],["firstChild",c.gw]]))return{type:"AT_ROOT"};return null}},{paths:[[c.Qf,c.g$]],fun:V},{paths:[[c.aU]],fun:function(e,t,n){const r=D(e,[["parent",c.Rh]]);if(null===r)return null;const i=r.getChild("MetricExpr");if(null===i)return null;if(null===D(i,[["firstChild",c.h1],["lastChild",c.xo],["firstChild",c.MD]]))return null;return{type:"IN_GROUPING",logQuery:(0,E.g5)(t,n).trim()}}},{paths:[[c.xo]],fun:function(e,t,n){const r=t.substring(0,n).trimEnd().endsWith("|");return z(e,t,n,r)}},{paths:[[0,c.g$],[0,c.sq,c.MD]],fun:V},{paths:[[0,c.Q6]],fun:function(e,t,n){return{type:"IN_RANGE"}}},{paths:[[0,c.xo]],fun:function(e,t,n){const r=D(e,[["parent",c.xo]]);if(null===r)return null;const i=t.substring(0,n).trimEnd().endsWith("|");return z(r,t,n,i)}},{paths:[[0,c.Nl,c.Yw,c.Rh]],fun:()=>({type:"IN_AGGREGATION"})},{paths:[[0,c.t3,c.AL],[c.t3,c.AL]],fun:function(e,t,n){var r,i;let o=null;0===e.type.id?o=D(e,[["parent",c.t3],["parent",c.AL]]):e.type.id===c.t3&&(o=D(e,[["parent",c.AL]]));if((null==o||null===(r=o.parent)||void 0===r?void 0:r.type.id)===c.UK||(null==o||null===(i=o.parent)||void 0===i?void 0:i.type.id)===c.xo)return z(o.parent,t,n,!0);return null}},{paths:[[0,c.HV],[c.HV]],fun:function(e,t,n){return{type:"AFTER_UNWRAP",logQuery:(0,E.g5)(t,n).trim()}}},{paths:[[0,c.i8],[0,c.LQ],[0,c.UP],[0,c.J3]],fun:function(e,t,n){let r=(0,E.g5)(t,n).trim(),i=null,o=e.parent;for(;null!==o;){if(o.type.id===c.t3){i=o;break}o=o.parent}(null==i?void 0:i.type.id)===c.t3&&(r=r.slice(0,i.from));return{type:"AFTER_KEEP_AND_DROP",logQuery:r}}}],j=new Map([["Eq","="],["Re","=~"],["Neq","!="],["Nre","!~"]]);function Q(e,t){if(e.type.id!==c.g$)return null;const n=D(e,[["firstChild",c.gw]]);if(null===n)return null;const r=n.nextSibling;if(null===r)return null;const i=function(e){var t;return null!==(t=j.get(e.name))&&void 0!==t?t:null}(r);if(null===i)return null;const o=D(e,[["lastChild",c.Qf]]);if(null===o)return null;const l=q(n,t),s=function(e){const t=e.slice(1,e.length-1);if(e.startsWith('"')&&e.endsWith('"'))return t.replace(/\\"/gm,'"');if(e.startsWith("'")&&e.endsWith("'"))return t.replace(/\\'/gm,"'");if(e.startsWith("`")&&e.endsWith("`"))return t;throw new Error(`Invalid string literal: ${e}`)}(q(o,t));return{name:l,value:s,op:i}}function G(e,t){var n;if(e.type.id!==c.MD&&e.type.id!==c.sq)return[];let r=null;var i,o;(null==e||null===(n=e.parent)||void 0===n?void 0:n.type.id)===c.MD?r=e:r=null!==(o=null!==(i=function(e,t){let n=D(e,t);for(;n;){let e=D(n,t);if(!e)return n;n=e}return null}(e,[["parent",c.sq]]))&&void 0!==i?i:D(e,[["firstChild",c.sq]]))&&void 0!==o?o:D(e,[["lastChild",c.sq]]);const l=[];for(;null!==r;){const e=D(r,[["lastChild",c.g$]]);if(null!==e){const n=Q(e,t);null!==n&&l.push(n)}r=D(r,[["firstChild",c.sq]])}return l.reverse(),l}function V(e,t,n){const r=!e.type.isError,i=D(e,[["parent",c.g$]]);if(null===i)return null;const o=D(i,[["firstChild",c.gw]]);if(null===o)return null;const l=q(o,t),s=D(i,[["parent",c.sq]]);if(null===s)return null;let a=s,u=null;for(;null===u;){const e=a.parent;if(null===e)return null;switch(e.type.id){case c.sq:a=e;continue;case c.MD:u=e;continue;default:return null}}const d=G(u,t).filter((e=>e.name!==l));return{type:"IN_LABEL_SELECTOR_WITH_LABEL_NAME",labelName:l,betweenQuotes:r,otherLabels:d}}function z(e,t,n,r){const i=D(e,[["firstChild",c.MD]]);return!i||i.to>n?null:{type:"AFTER_SELECTOR",afterPipe:r,hasSpace:" "===t.charAt(n-1),logQuery:(0,E.g5)(t,n).trim()}}function H(e,t){if(""===e)return{type:"EMPTY"};const n=function(e,t){const n=e.trimEnd().length,r=n<t?n:t,i=c.K3.parse(e),o=i.cursorAt(r);do{if(o.from===r&&o.to===r&&o.node.type.isError)return o}while(o.next());return i.cursorAt(r)}(e,t),r=n.node,i=[n.type.id];for(;n.parent();)i.push(n.type.id);for(let n of U)for(let o of n.paths)if(W(o,i)){const i=n.fun(r,e,t);if(i)return i}return null}function J(e,t){switch(e){case"DURATION":return t.languages.CompletionItemKind.Unit;case"FUNCTION":return t.languages.CompletionItemKind.Variable;case"HISTORY":return t.languages.CompletionItemKind.Snippet;case"LABEL_NAME":return t.languages.CompletionItemKind.Enum;case"LABEL_VALUE":return t.languages.CompletionItemKind.EnumMember;case"PATTERN":return t.languages.CompletionItemKind.Constructor;case"PARSER":return t.languages.CompletionItemKind.Class;case"LINE_FILTER":return t.languages.CompletionItemKind.TypeParameter;case"PIPE_OPERATION":return t.languages.CompletionItemKind.Interface;default:throw new v(e)}}const Y=(e,t,n,r,i)=>{if(e&&"IN_LABEL_SELECTOR_WITH_LABEL_NAME"===(null==e?void 0:e.type)&&"betweenQuotes"in e&&e.betweenQuotes){var o,l,s;const e=null!==(s=null==n||null===(o=n.word)||void 0===o?void 0:o.indexOf('"'))&&void 0!==s?s:0;var a;const u=null!==(a=null==t||null===(l=t.word)||void 0===l?void 0:l.lastIndexOf('"'))&&void 0!==a?a:0,c=null==t?void 0:t.word.indexOf("="),d=null==t?void 0:t.word.lastIndexOf("=");if(d===c&&-1!==e&&-1!==u&&-1!==d)return null!=t?r.Range.lift({startLineNumber:i.lineNumber,endLineNumber:i.lineNumber,startColumn:n.startColumn+e+1,endColumn:n.startColumn+u}):r.Range.fromPositions(i)}return e&&"IN_LABEL_SELECTOR_WITH_LABEL_NAME"===e.type?null!=t?r.Range.lift({startLineNumber:i.lineNumber,endLineNumber:i.lineNumber,startColumn:n.endColumn,endColumn:n.endColumn}):r.Range.fromPositions(i):null!=t?r.Range.lift({startLineNumber:i.lineNumber,endLineNumber:i.lineNumber,startColumn:t.startColumn,endColumn:t.endColumn}):r.Range.fromPositions(i)};var X=n(1849);function Z(e,t,n,r,i,o,l){try{var s=e[o](l),a=s.value}catch(e){return void n(e)}s.done?t(a):Promise.resolve(a).then(r,i)}function ee(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function te(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){ee(e,t,n[t])}))}return e}function ne(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}function re(e,t){if(null==e)return{};var n,r,i=function(e,t){if(null==e)return{};var n,r,i={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}const ie={codeLens:!1,contextmenu:!1,fixedOverflowWidgets:!0,folding:!1,fontSize:14,lineDecorationsWidth:8,lineNumbers:"off",minimap:{enabled:!1},overviewRulerBorder:!1,overviewRulerLanes:0,padding:{top:4,bottom:5},renderLineHighlight:"none",scrollbar:{vertical:"hidden",verticalScrollbarSize:8,horizontal:"hidden",horizontalScrollbarSize:0,alwaysConsumeMouseWheel:!1},scrollBeyondLastLine:!1,suggest:{showWords:!1},suggestFontSize:12,wordWrap:"on"},oe="logql";let le=!1;const se=/(-?\d*\.\d\w*)|([^`~!#%^&*()\-=+\[{\]}\\|;:'",.<>\/?\s]+)/g;const ae=({history:e,onBlur:t,onRunQuery:n,initialValue:f,datasource:m,placeholder:h,onChange:y,timeRange:v})=>{const E=(0,a.A)(),L=(0,l.useRef)(p),_=(0,l.useRef)(null),T=s(m.languageProvider),N=s(e),P=s(n),A=s(t),C=(0,l.useRef)(null),O=(0,l.useRef)(null),x=((e,t)=>({container:(0,i.css)({borderRadius:e.shape.radius.default,border:`1px solid ${e.components.input.borderColor}`,width:"100%",".monaco-editor .suggest-widget":{minWidth:"50%"},overflow:"hidden"}),placeholder:(0,i.css)({"::after":{content:`'${t}'`,fontFamily:e.typography.fontFamilyMonospace,opacity:.3}})}))((0,g.useTheme2)(),h);(0,l.useEffect)((()=>()=>{var e;null===(e=O.current)||void 0===e||e.call(O)}),[]),(0,l.useEffect)((()=>{C.current&&v&&C.current.setTimeRange(v)}),[v]);const R=(0,o.debounce)((e=>{return(t=function*(){y(e)},function(){var e=this,n=arguments;return new Promise((function(r,i){var o=t.apply(e,n);function l(e){Z(o,r,i,l,s,"next",e)}function s(e){Z(o,r,i,l,s,"throw",e)}l(void 0)}))})();var t}),1e3);return(0,r.jsx)("div",{"data-testid":u.Tp.components.QueryField.container,className:x.container,ref:_,children:(0,r.jsx)(g.ReactMonacoEditor,{overrideServices:L.current,options:ie,language:oe,value:f,beforeMount:e=>{!function(e){!1===le&&(le=!0,e.languages.register({id:oe}),e.languages.setMonarchTokensProvider(oe,d.xN),e.languages.setLanguageConfiguration(oe,ne(te({},d.r0),{wordPattern:/(-?\d*\.\d\w*)|([^`~!#%^&*()+\[{\]}\\|;:',.<>\/?\s]+)/g})))}(e)},onMount:(e,t)=>{const n=e.createContextKey("isEditorFocused"+E,!1);e.onDidBlurEditorWidget((()=>{n.set(!1),A.current(e.getValue())})),e.onDidChangeModelContent((n=>{const r=e.getModel();if(!r)return;const i=r.getValue(),o=((0,X.B)(i,m.interpolateString(i,X.a),r.getLinesContent(),c.K3)||[]).map((e=>{var{error:n}=e,r=re(e,["error"]);return te({message:(n?`Error parsing "${n}"`:"Parse error")+". The query appears to be incorrect and could fail to be executed.",severity:t.MarkerSeverity.Error},r)}));R(i),t.editor.setModelMarkers(r,"owner",o)}));const r=new b(T.current,N,v);C.current=r;const i=function(e,t){return{triggerCharacters:["{",",","[","(","=","~"," ",'"',"|"],provideCompletionItems:(n,r)=>{const i=n.getWordAtPosition(r),o=n.getWordUntilPosition(r),l={column:r.column,lineNumber:r.lineNumber},s=n.getOffsetAt(l),a=H(n.getValue(),s),u=Y(a,i,o,e,r);return(null!=a?F(a,t):Promise.resolve([])).then((t=>{const n=t.length.toString().length;return{suggestions:t.map(((t,r)=>({kind:J(t.type,e),label:t.label,insertText:t.insertText,insertTextRules:t.isSnippet?4:void 0,detail:t.detail,documentation:t.documentation,sortText:r.toString().padStart(n,"0"),range:u,command:t.triggerOnInsert?{id:"editor.action.triggerSuggest",title:""}:void 0})))}}))}}}(t,r),o=ne(te({},i),{provideCompletionItems:(t,n,r,o)=>{var l;return(null===(l=e.getModel())||void 0===l?void 0:l.id)!==t.id?{suggestions:[]}:i.provideCompletionItems(t,n,r,o)}}),{dispose:l}=t.languages.registerCompletionItemProvider(oe,o);O.current=l;const s=()=>{const t=_.current;if(null!==t){const n=e.getContentHeight();t.style.height=`${n+2}px`;const r=t.clientWidth;e.layout({width:r,height:n})}};e.onDidContentSizeChange(s),s(),e.addCommand(t.KeyMod.Shift|t.KeyCode.Enter,(()=>{P.current(e.getValue())}),"isEditorFocused"+E),t.editor.addKeybindingRule({keybinding:t.KeyMod.CtrlCmd|t.KeyCode.KeyF,command:null}),e.onDidFocusEditorText((()=>{n.set(!0),""===e.getValue().trim()&&e.trigger("","editor.action.triggerSuggest",{})})),((e,t)=>{const n=[{range:new e.Range(1,1,1,1),options:{className:x.placeholder,isWholeLine:!0}}];let r=[];const i=()=>{const e=t.getModel();if(!e)return;const i=0===e.getValueLength()?n:[];r=e.deltaDecorations(r,i)};i(),t.onDidChangeModelContent(i)})(t,e)}})})}},7547:(e,t)=>{t.xN=t.r0=void 0,t.r0={wordPattern:/(-?\d*\.\d\w*)|([^`~!#%^&*()\-=+\[{\]}\\|;:'",.<>\/?\s]+)/g,comments:{lineComment:"#"},brackets:[["{","}"],["[","]"],["(",")"]],autoClosingPairs:[{open:"{",close:"}"},{open:"[",close:"]"},{open:"(",close:")"},{open:'"',close:'"'},{open:"'",close:"'"},{open:"`",close:"`"}],surroundingPairs:[{open:"{",close:"}"},{open:"[",close:"]"},{open:"(",close:")"},{open:'"',close:'"'},{open:"'",close:"'"},{open:"`",close:"`"},{open:"<",close:">"}],folding:{}};var n=["by","without"],r="(".concat(n.reduce((function(e,t){return"".concat(e,"|").concat(t)})),")"),i=["sum","avg","min","max","stddev","stdvar","count","topk","bottomk"].concat(["json","logfmt","regexp","unpack","pattern"]).concat(["line_format","label_format"]).concat(["count_over_time","rate","bytes_over_time","bytes_rate","avg_over_time","sum_over_time","min_over_time","max_over_time","stdvar_over_time","stddev_over_time","quantile_over_time","first_over_time","last_over_time","absent_over_time"]).concat(n);t.xN={ignoreCase:!1,defaultToken:"",tokenPostfix:".logql",keywords:i,operators:["+","-","*","/","%","^","==","!=",">","<",">=","<=","|=","!=","|~","!~","and","or","unless","|"],vectorMatching:r,symbols:/[=><!~?:&|+\-*\/^%]+/,escapes:/\\(?:[abfnrtv\\"']|x[0-9A-Fa-f]{1,4}|u[0-9A-Fa-f]{4}|U[0-9A-Fa-f]{8})/,digits:/\d+(_+\d+)*/,octaldigits:/[0-7]+(_+[0-7]+)*/,binarydigits:/[0-1]+(_+[0-1]+)*/,hexdigits:/[[0-9a-fA-F]+(_+[0-9a-fA-F]+)*/,integersuffix:/(ll|LL|u|U|l|L)?(ll|LL|u|U|l|L)?/,floatsuffix:/[fFlL]?/,tokenizer:{root:[[/@vectorMatching\s*(?=\()/,"type","@clauses"],[/[a-z_]\w*(?=\s*(=|!=|=~|!~))/,"tag"],[/(^#.*$)/,"comment"],[/[a-zA-Z_]\w*/,{cases:{"@keywords":"type","@default":"identifier"}}],[/"/,"string","@string_double"],[/'/,"string","@string_single"],[/`/,"string","@string_backtick"],{include:"@whitespace"},[/[{}()\[\]]/,"@brackets"],[/[<>](?!@symbols)/,"@brackets"],[/@symbols/,{cases:{"@operators":"delimiter","@default":""}}],[/\d+(?:\.\d)?(?:ms|ns|us|Âµs|[smhdwy])/,"number"],[/\d+(?:\.\d)?(?:b|kib|Kib|kb|KB|mib|Mib|mb|MB|gib|Gib|gb|GB|tib|Tib|tb|TB|pib|Pib|pb|PB|eib|Eib|eb|EB])/,"number"],[/\d*\d+[eE]([\-+]?\d+)?(@floatsuffix)/,"number.float"],[/\d*\.\d+([eE][\-+]?\d+)?(@floatsuffix)/,"number.float"],[/0[xX][0-9a-fA-F']*[0-9a-fA-F](@integersuffix)/,"number.hex"],[/0[0-7']*[0-7](@integersuffix)/,"number.octal"],[/0[bB][0-1']*[0-1](@integersuffix)/,"number.binary"],[/\d[\d']*\d(@integersuffix)/,"number"],[/\d(@integersuffix)/,"number"]],string_double:[[/\{\{(.*?)\}\}/,{token:"number"}],[/[^\\"]/,"string"],[/@escapes/,"string.escape"],[/\\./,"string.escape.invalid"],[/"/,"string","@pop"]],string_single:[[/[^\\']+/,"string"],[/@escapes/,"string.escape"],[/\\./,"string.escape.invalid"],[/'/,"string","@pop"]],string_backtick:[[/\{\{(.*?)\}\}/,{token:"number"}],[/[^\\`]/,"string"],[/@escapes/,"string.escape"],[/\\./,"string.escape.invalid"],[/`/,"string","@pop"]],clauses:[[/[^(,)]/,"tag"],[/\)/,"identifier","@pop"]],whitespace:[[/[ \t\r\n]+/,"white"]]}}}}]);
//# sourceMappingURL=loki-query-field.js.map