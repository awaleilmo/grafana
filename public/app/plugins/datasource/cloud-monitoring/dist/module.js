/*! For license information please see module.js.LICENSE.txt */
/* [create-plugin] version: 5.22.0 */
define(["module","lodash","@grafana/data","@grafana/runtime","react","@emotion/css","@grafana/ui","rxjs","rxjs/operators"],((e,t,r,n,i,o,a,u,l)=>(()=>{"use strict";var c={7:e=>{e.exports=a},44:(e,t,r)=>{var n=r(959),i=Symbol.for("react.element"),o=Symbol.for("react.fragment"),a=Object.prototype.hasOwnProperty,u=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,l={key:!0,ref:!0,__self:!0,__source:!0};function c(e,t,r){var n,o={},c=null,s=null;for(n in void 0!==r&&(c=""+r),void 0!==t.key&&(c=""+t.key),void 0!==t.ref&&(s=t.ref),t)a.call(t,n)&&!l.hasOwnProperty(n)&&(o[n]=t[n]);if(e&&e.defaultProps)for(n in t=e.defaultProps)void 0===o[n]&&(o[n]=t[n]);return{$$typeof:i,type:e,key:c,ref:s,props:o,_owner:u.current}}t.Fragment=o,t.jsx=c,t.jsxs=c},59:e=>{e.exports=l},89:e=>{e.exports=o},241:e=>{e.exports=t},269:e=>{e.exports=u},308:t=>{t.exports=e},513:e=>{e.exports=function e(t,r){if(t===r)return!0;if(t&&r&&"object"==typeof t&&"object"==typeof r){if(t.constructor!==r.constructor)return!1;var n,i,o;if(Array.isArray(t)){if((n=t.length)!=r.length)return!1;for(i=n;0!=i--;)if(!e(t[i],r[i]))return!1;return!0}if(t.constructor===RegExp)return t.source===r.source&&t.flags===r.flags;if(t.valueOf!==Object.prototype.valueOf)return t.valueOf()===r.valueOf();if(t.toString!==Object.prototype.toString)return t.toString()===r.toString();if((n=(o=Object.keys(t)).length)!==Object.keys(r).length)return!1;for(i=n;0!=i--;)if(!Object.prototype.hasOwnProperty.call(r,o[i]))return!1;for(i=n;0!=i--;){var a=o[i];if(!e(t[a],r[a]))return!1}return!0}return t!=t&&r!=r}},531:e=>{e.exports=n},635:e=>{e.exports=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=void 0,i=void 0,o=void 0,a=[];return function(){var l=function(e){return"function"==typeof e?e():e}(t),c=(new Date).getTime(),s=!n||c-n>l;n=c;for(var p=arguments.length,f=Array(p),h=0;h<p;h++)f[h]=arguments[h];if(s&&r.leading)return r.accumulate?Promise.resolve(e.call(this,[f])).then((function(e){return e[0]})):Promise.resolve(e.call.apply(e,[this].concat(f)));if(i?clearTimeout(o):i=function(){var e={};return e.promise=new Promise((function(t,r){e.resolve=t,e.reject=r})),e}(),a.push(f),o=setTimeout(u.bind(this),l),r.accumulate){var d=a.length-1;return i.promise.then((function(e){return e[d]}))}return i.promise};function u(){var t=i;clearTimeout(o),Promise.resolve(r.accumulate?e.call(this,a):e.apply(this,a[a.length-1])).then(t.resolve,t.reject),a=[],i=null}}},728:(e,t,r)=>{e.exports=r(44)},781:e=>{e.exports=r},959:e=>{e.exports=i}},s={};function p(e){var t=s[e];if(void 0!==t)return t.exports;var r=s[e]={exports:{}};return c[e](r,r.exports,p),r.exports}p.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return p.d(t,{a:t}),t},p.d=(e,t)=>{for(var r in t)p.o(t,r)&&!p.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},p.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),p.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},p.p="public/plugins/stackdriver/";var f={};p.r(f),p.d(f,{plugin:()=>an});var h=p(308),d=p.n(h);p.p=d()&&d().uri?d().uri.slice(0,d().uri.lastIndexOf("/")+1):"public/plugins/stackdriver/";var y=p(241),v=p(781),g=p(531),m=p(728),b=p(89),O=p(959);class j extends O.PureComponent{render(){return(0,m.jsxs)("div",{children:[(0,m.jsx)("h2",{children:"Cloud Monitoring alias patterns"}),(0,m.jsxs)("div",{children:[(0,m.jsx)("p",{children:"Format the legend keys any way you want by using alias patterns. Format the legend keys any way you want by using alias patterns."}),"Example:",(0,m.jsx)("code",{children:"{{metric.name}} - {{metric.label.instance_name}}"}),(0,m.jsx)("br",{}),"Result:   ",(0,m.jsx)("code",{children:"cpu/usage_time - server1-europe-west-1"}),(0,m.jsx)("br",{}),(0,m.jsx)("br",{}),(0,m.jsx)("span",{children:"Patterns:"}),(0,m.jsx)("br",{}),(0,m.jsxs)("ul",{className:(0,b.css)({listStyle:"none"}),children:[(0,m.jsxs)("li",{children:[(0,m.jsx)("code",{children:"{{metric.type}}"})," = metric type e.g. compute.googleapis.com/instance/cpu/usage_time"]}),(0,m.jsxs)("li",{children:[(0,m.jsx)("code",{children:"{{metric.name}}"})," = name part of metric e.g. instance/cpu/usage_time"]}),(0,m.jsxs)("li",{children:[(0,m.jsx)("code",{children:"{{metric.service}}"})," = service part of metric e.g. compute"]}),(0,m.jsxs)("li",{children:[(0,m.jsx)("code",{children:"{{metric.label.label_name}}"})," = Metric label metadata e.g. metric.label.instance_name"]}),(0,m.jsxs)("li",{children:[(0,m.jsx)("code",{children:"{{resource.label.label_name}}"})," = Resource label metadata e.g. resource.label.zone"]}),(0,m.jsxs)("li",{children:[(0,m.jsx)("code",{children:"{{metadata.system_labels.name}}"})," = Meta data system labels e.g. metadata.system_labels.name. For this to work, the needs to be included in the group by"]}),(0,m.jsxs)("li",{children:[(0,m.jsx)("code",{children:"{{metadata.user_labels.name}}"})," = Meta data user labels e.g. metadata.user_labels.name. For this to work, the needs to be included in the group by"]}),(0,m.jsxs)("li",{children:[(0,m.jsx)("code",{children:"{{bucket}}"})," = bucket boundary for distribution metrics when using a heatmap in Grafana"]}),(0,m.jsxs)("li",{children:[(0,m.jsx)("code",{children:"{{project}}"})," = The project name that was specified in the query editor"]}),(0,m.jsxs)("li",{children:[(0,m.jsx)("code",{children:"{{service}}"})," = The service id that was specified in the SLO query editor"]}),(0,m.jsxs)("li",{children:[(0,m.jsx)("code",{children:"{{slo}}"})," = The SLO id that was specified in the SLO query editor"]}),(0,m.jsxs)("li",{children:[(0,m.jsx)("code",{children:"{{selector}}"})," = The Selector function that was specified in the SLO query editor"]})]})]})]})}}var _=p(7);const E="jwt",S="gce",T=e=>e.jsonData.authenticationType?e:{...e,jsonData:{...e.jsonData,authenticationType:E}};var w,P="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},x={exports:{}};var I,N,D=(w||(w=1,I=x,N=x.exports,function(){var e,t="Expected a function",r="__lodash_hash_undefined__",n="__lodash_placeholder__",i=32,o=128,a=256,u=1/0,l=9007199254740991,c=NaN,s=4294967295,p=[["ary",o],["bind",1],["bindKey",2],["curry",8],["curryRight",16],["flip",512],["partial",i],["partialRight",64],["rearg",a]],f="[object Arguments]",h="[object Array]",d="[object Boolean]",y="[object Date]",v="[object Error]",g="[object Function]",m="[object GeneratorFunction]",b="[object Map]",O="[object Number]",j="[object Object]",_="[object Promise]",E="[object RegExp]",S="[object Set]",T="[object String]",w="[object Symbol]",x="[object WeakMap]",D="[object ArrayBuffer]",L="[object DataView]",A="[object Float32Array]",C="[object Float64Array]",R="[object Int8Array]",k="[object Int16Array]",U="[object Int32Array]",M="[object Uint8Array]",G="[object Uint8ClampedArray]",Q="[object Uint16Array]",B="[object Uint32Array]",q=/\b__p \+= '';/g,F=/\b(__p \+=) '' \+/g,V=/(__e\(.*?\)|\b__t\)) \+\n'';/g,K=/&(?:amp|lt|gt|quot|#39);/g,$=/[&<>"']/g,W=RegExp(K.source),z=RegExp($.source),Y=/<%-([\s\S]+?)%>/g,J=/<%([\s\S]+?)%>/g,H=/<%=([\s\S]+?)%>/g,Z=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,X=/^\w*$/,ee=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,te=/[\\^$.*+?()[\]{}|]/g,re=RegExp(te.source),ne=/^\s+/,ie=/\s/,oe=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,ae=/\{\n\/\* \[wrapped with (.+)\] \*/,ue=/,? & /,le=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,ce=/[()=,{}\[\]\/\s]/,se=/\\(\\)?/g,pe=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,fe=/\w*$/,he=/^[-+]0x[0-9a-f]+$/i,de=/^0b[01]+$/i,ye=/^\[object .+?Constructor\]$/,ve=/^0o[0-7]+$/i,ge=/^(?:0|[1-9]\d*)$/,me=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,be=/($^)/,Oe=/['\n\r\u2028\u2029\\]/g,je="\\ud800-\\udfff",_e="\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff",Ee="\\u2700-\\u27bf",Se="a-z\\xdf-\\xf6\\xf8-\\xff",Te="A-Z\\xc0-\\xd6\\xd8-\\xde",we="\\ufe0e\\ufe0f",Pe="\\xac\\xb1\\xd7\\xf7\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf\\u2000-\\u206f \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",xe="['’]",Ie="["+je+"]",Ne="["+Pe+"]",De="["+_e+"]",Le="\\d+",Ae="["+Ee+"]",Ce="["+Se+"]",Re="[^"+je+Pe+Le+Ee+Se+Te+"]",ke="\\ud83c[\\udffb-\\udfff]",Ue="[^"+je+"]",Me="(?:\\ud83c[\\udde6-\\uddff]){2}",Ge="[\\ud800-\\udbff][\\udc00-\\udfff]",Qe="["+Te+"]",Be="\\u200d",qe="(?:"+Ce+"|"+Re+")",Fe="(?:"+Qe+"|"+Re+")",Ve="(?:['’](?:d|ll|m|re|s|t|ve))?",Ke="(?:['’](?:D|LL|M|RE|S|T|VE))?",$e="(?:"+De+"|"+ke+")?",We="["+we+"]?",ze=We+$e+"(?:"+Be+"(?:"+[Ue,Me,Ge].join("|")+")"+We+$e+")*",Ye="(?:"+[Ae,Me,Ge].join("|")+")"+ze,Je="(?:"+[Ue+De+"?",De,Me,Ge,Ie].join("|")+")",He=RegExp(xe,"g"),Ze=RegExp(De,"g"),Xe=RegExp(ke+"(?="+ke+")|"+Je+ze,"g"),et=RegExp([Qe+"?"+Ce+"+"+Ve+"(?="+[Ne,Qe,"$"].join("|")+")",Fe+"+"+Ke+"(?="+[Ne,Qe+qe,"$"].join("|")+")",Qe+"?"+qe+"+"+Ve,Qe+"+"+Ke,"\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])","\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",Le,Ye].join("|"),"g"),tt=RegExp("["+Be+je+_e+we+"]"),rt=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,nt=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],it=-1,ot={};ot[A]=ot[C]=ot[R]=ot[k]=ot[U]=ot[M]=ot[G]=ot[Q]=ot[B]=!0,ot[f]=ot[h]=ot[D]=ot[d]=ot[L]=ot[y]=ot[v]=ot[g]=ot[b]=ot[O]=ot[j]=ot[E]=ot[S]=ot[T]=ot[x]=!1;var at={};at[f]=at[h]=at[D]=at[L]=at[d]=at[y]=at[A]=at[C]=at[R]=at[k]=at[U]=at[b]=at[O]=at[j]=at[E]=at[S]=at[T]=at[w]=at[M]=at[G]=at[Q]=at[B]=!0,at[v]=at[g]=at[x]=!1;var ut={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},lt=parseFloat,ct=parseInt,st="object"==typeof P&&P&&P.Object===Object&&P,pt="object"==typeof self&&self&&self.Object===Object&&self,ft=st||pt||Function("return this")(),ht=N&&!N.nodeType&&N,dt=ht&&I&&!I.nodeType&&I,yt=dt&&dt.exports===ht,vt=yt&&st.process,gt=function(){try{var e=dt&&dt.require&&dt.require("util").types;return e||vt&&vt.binding&&vt.binding("util")}catch(e){}}(),mt=gt&&gt.isArrayBuffer,bt=gt&&gt.isDate,Ot=gt&&gt.isMap,jt=gt&&gt.isRegExp,_t=gt&&gt.isSet,Et=gt&&gt.isTypedArray;function St(e,t,r){switch(r.length){case 0:return e.call(t);case 1:return e.call(t,r[0]);case 2:return e.call(t,r[0],r[1]);case 3:return e.call(t,r[0],r[1],r[2])}return e.apply(t,r)}function Tt(e,t,r,n){for(var i=-1,o=null==e?0:e.length;++i<o;){var a=e[i];t(n,a,r(a),e)}return n}function wt(e,t){for(var r=-1,n=null==e?0:e.length;++r<n&&!1!==t(e[r],r,e););return e}function Pt(e,t){for(var r=null==e?0:e.length;r--&&!1!==t(e[r],r,e););return e}function xt(e,t){for(var r=-1,n=null==e?0:e.length;++r<n;)if(!t(e[r],r,e))return!1;return!0}function It(e,t){for(var r=-1,n=null==e?0:e.length,i=0,o=[];++r<n;){var a=e[r];t(a,r,e)&&(o[i++]=a)}return o}function Nt(e,t){return!(null==e||!e.length)&&Qt(e,t,0)>-1}function Dt(e,t,r){for(var n=-1,i=null==e?0:e.length;++n<i;)if(r(t,e[n]))return!0;return!1}function Lt(e,t){for(var r=-1,n=null==e?0:e.length,i=Array(n);++r<n;)i[r]=t(e[r],r,e);return i}function At(e,t){for(var r=-1,n=t.length,i=e.length;++r<n;)e[i+r]=t[r];return e}function Ct(e,t,r,n){var i=-1,o=null==e?0:e.length;for(n&&o&&(r=e[++i]);++i<o;)r=t(r,e[i],i,e);return r}function Rt(e,t,r,n){var i=null==e?0:e.length;for(n&&i&&(r=e[--i]);i--;)r=t(r,e[i],i,e);return r}function kt(e,t){for(var r=-1,n=null==e?0:e.length;++r<n;)if(t(e[r],r,e))return!0;return!1}var Ut=Vt("length");function Mt(e,t,r){var n;return r(e,(function(e,r,i){if(t(e,r,i))return n=r,!1})),n}function Gt(e,t,r,n){for(var i=e.length,o=r+(n?1:-1);n?o--:++o<i;)if(t(e[o],o,e))return o;return-1}function Qt(e,t,r){return t==t?function(e,t,r){for(var n=r-1,i=e.length;++n<i;)if(e[n]===t)return n;return-1}(e,t,r):Gt(e,qt,r)}function Bt(e,t,r,n){for(var i=r-1,o=e.length;++i<o;)if(n(e[i],t))return i;return-1}function qt(e){return e!=e}function Ft(e,t){var r=null==e?0:e.length;return r?Wt(e,t)/r:c}function Vt(t){return function(r){return null==r?e:r[t]}}function Kt(t){return function(r){return null==t?e:t[r]}}function $t(e,t,r,n,i){return i(e,(function(e,i,o){r=n?(n=!1,e):t(r,e,i,o)})),r}function Wt(t,r){for(var n,i=-1,o=t.length;++i<o;){var a=r(t[i]);a!==e&&(n=n===e?a:n+a)}return n}function zt(e,t){for(var r=-1,n=Array(e);++r<e;)n[r]=t(r);return n}function Yt(e){return e?e.slice(0,fr(e)+1).replace(ne,""):e}function Jt(e){return function(t){return e(t)}}function Ht(e,t){return Lt(t,(function(t){return e[t]}))}function Zt(e,t){return e.has(t)}function Xt(e,t){for(var r=-1,n=e.length;++r<n&&Qt(t,e[r],0)>-1;);return r}function er(e,t){for(var r=e.length;r--&&Qt(t,e[r],0)>-1;);return r}var tr=Kt({À:"A",Á:"A",Â:"A",Ã:"A",Ä:"A",Å:"A",à:"a",á:"a",â:"a",ã:"a",ä:"a",å:"a",Ç:"C",ç:"c",Ð:"D",ð:"d",È:"E",É:"E",Ê:"E",Ë:"E",è:"e",é:"e",ê:"e",ë:"e",Ì:"I",Í:"I",Î:"I",Ï:"I",ì:"i",í:"i",î:"i",ï:"i",Ñ:"N",ñ:"n",Ò:"O",Ó:"O",Ô:"O",Õ:"O",Ö:"O",Ø:"O",ò:"o",ó:"o",ô:"o",õ:"o",ö:"o",ø:"o",Ù:"U",Ú:"U",Û:"U",Ü:"U",ù:"u",ú:"u",û:"u",ü:"u",Ý:"Y",ý:"y",ÿ:"y",Æ:"Ae",æ:"ae",Þ:"Th",þ:"th",ß:"ss",Ā:"A",Ă:"A",Ą:"A",ā:"a",ă:"a",ą:"a",Ć:"C",Ĉ:"C",Ċ:"C",Č:"C",ć:"c",ĉ:"c",ċ:"c",č:"c",Ď:"D",Đ:"D",ď:"d",đ:"d",Ē:"E",Ĕ:"E",Ė:"E",Ę:"E",Ě:"E",ē:"e",ĕ:"e",ė:"e",ę:"e",ě:"e",Ĝ:"G",Ğ:"G",Ġ:"G",Ģ:"G",ĝ:"g",ğ:"g",ġ:"g",ģ:"g",Ĥ:"H",Ħ:"H",ĥ:"h",ħ:"h",Ĩ:"I",Ī:"I",Ĭ:"I",Į:"I",İ:"I",ĩ:"i",ī:"i",ĭ:"i",į:"i",ı:"i",Ĵ:"J",ĵ:"j",Ķ:"K",ķ:"k",ĸ:"k",Ĺ:"L",Ļ:"L",Ľ:"L",Ŀ:"L",Ł:"L",ĺ:"l",ļ:"l",ľ:"l",ŀ:"l",ł:"l",Ń:"N",Ņ:"N",Ň:"N",Ŋ:"N",ń:"n",ņ:"n",ň:"n",ŋ:"n",Ō:"O",Ŏ:"O",Ő:"O",ō:"o",ŏ:"o",ő:"o",Ŕ:"R",Ŗ:"R",Ř:"R",ŕ:"r",ŗ:"r",ř:"r",Ś:"S",Ŝ:"S",Ş:"S",Š:"S",ś:"s",ŝ:"s",ş:"s",š:"s",Ţ:"T",Ť:"T",Ŧ:"T",ţ:"t",ť:"t",ŧ:"t",Ũ:"U",Ū:"U",Ŭ:"U",Ů:"U",Ű:"U",Ų:"U",ũ:"u",ū:"u",ŭ:"u",ů:"u",ű:"u",ų:"u",Ŵ:"W",ŵ:"w",Ŷ:"Y",ŷ:"y",Ÿ:"Y",Ź:"Z",Ż:"Z",Ž:"Z",ź:"z",ż:"z",ž:"z",Ĳ:"IJ",ĳ:"ij",Œ:"Oe",œ:"oe",ŉ:"'n",ſ:"s"}),rr=Kt({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"});function nr(e){return"\\"+ut[e]}function ir(e){return tt.test(e)}function or(e){var t=-1,r=Array(e.size);return e.forEach((function(e,n){r[++t]=[n,e]})),r}function ar(e,t){return function(r){return e(t(r))}}function ur(e,t){for(var r=-1,i=e.length,o=0,a=[];++r<i;){var u=e[r];u!==t&&u!==n||(e[r]=n,a[o++]=r)}return a}function lr(e){var t=-1,r=Array(e.size);return e.forEach((function(e){r[++t]=e})),r}function cr(e){var t=-1,r=Array(e.size);return e.forEach((function(e){r[++t]=[e,e]})),r}function sr(e){return ir(e)?function(e){for(var t=Xe.lastIndex=0;Xe.test(e);)++t;return t}(e):Ut(e)}function pr(e){return ir(e)?function(e){return e.match(Xe)||[]}(e):function(e){return e.split("")}(e)}function fr(e){for(var t=e.length;t--&&ie.test(e.charAt(t)););return t}var hr=Kt({"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"}),dr=function P(I){var N,ie=(I=null==I?ft:dr.defaults(ft.Object(),I,dr.pick(ft,nt))).Array,je=I.Date,_e=I.Error,Ee=I.Function,Se=I.Math,Te=I.Object,we=I.RegExp,Pe=I.String,xe=I.TypeError,Ie=ie.prototype,Ne=Ee.prototype,De=Te.prototype,Le=I["__core-js_shared__"],Ae=Ne.toString,Ce=De.hasOwnProperty,Re=0,ke=(N=/[^.]+$/.exec(Le&&Le.keys&&Le.keys.IE_PROTO||""))?"Symbol(src)_1."+N:"",Ue=De.toString,Me=Ae.call(Te),Ge=ft._,Qe=we("^"+Ae.call(Ce).replace(te,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Be=yt?I.Buffer:e,qe=I.Symbol,Fe=I.Uint8Array,Ve=Be?Be.allocUnsafe:e,Ke=ar(Te.getPrototypeOf,Te),$e=Te.create,We=De.propertyIsEnumerable,ze=Ie.splice,Ye=qe?qe.isConcatSpreadable:e,Je=qe?qe.iterator:e,Xe=qe?qe.toStringTag:e,tt=function(){try{var e=so(Te,"defineProperty");return e({},"",{}),e}catch(e){}}(),ut=I.clearTimeout!==ft.clearTimeout&&I.clearTimeout,st=je&&je.now!==ft.Date.now&&je.now,pt=I.setTimeout!==ft.setTimeout&&I.setTimeout,ht=Se.ceil,dt=Se.floor,vt=Te.getOwnPropertySymbols,gt=Be?Be.isBuffer:e,Ut=I.isFinite,Kt=Ie.join,yr=ar(Te.keys,Te),vr=Se.max,gr=Se.min,mr=je.now,br=I.parseInt,Or=Se.random,jr=Ie.reverse,_r=so(I,"DataView"),Er=so(I,"Map"),Sr=so(I,"Promise"),Tr=so(I,"Set"),wr=so(I,"WeakMap"),Pr=so(Te,"create"),xr=wr&&new wr,Ir={},Nr=Uo(_r),Dr=Uo(Er),Lr=Uo(Sr),Ar=Uo(Tr),Cr=Uo(wr),Rr=qe?qe.prototype:e,kr=Rr?Rr.valueOf:e,Ur=Rr?Rr.toString:e;function Mr(e){if(eu(e)&&!Fa(e)&&!(e instanceof qr)){if(e instanceof Br)return e;if(Ce.call(e,"__wrapped__"))return Mo(e)}return new Br(e)}var Gr=function(){function t(){}return function(r){if(!Xa(r))return{};if($e)return $e(r);t.prototype=r;var n=new t;return t.prototype=e,n}}();function Qr(){}function Br(t,r){this.__wrapped__=t,this.__actions__=[],this.__chain__=!!r,this.__index__=0,this.__values__=e}function qr(e){this.__wrapped__=e,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=s,this.__views__=[]}function Fr(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}function Vr(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}function Kr(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}function $r(e){var t=-1,r=null==e?0:e.length;for(this.__data__=new Kr;++t<r;)this.add(e[t])}function Wr(e){var t=this.__data__=new Vr(e);this.size=t.size}function zr(e,t){var r=Fa(e),n=!r&&qa(e),i=!r&&!n&&Wa(e),o=!r&&!n&&!i&&lu(e),a=r||n||i||o,u=a?zt(e.length,Pe):[],l=u.length;for(var c in e)!t&&!Ce.call(e,c)||a&&("length"==c||i&&("offset"==c||"parent"==c)||o&&("buffer"==c||"byteLength"==c||"byteOffset"==c)||mo(c,l))||u.push(c);return u}function Yr(t){var r=t.length;return r?t[Wn(0,r-1)]:e}function Jr(e,t){return Co(xi(e),an(t,0,e.length))}function Hr(e){return Co(xi(e))}function Zr(t,r,n){(n!==e&&!Ga(t[r],n)||n===e&&!(r in t))&&nn(t,r,n)}function Xr(t,r,n){var i=t[r];Ce.call(t,r)&&Ga(i,n)&&(n!==e||r in t)||nn(t,r,n)}function en(e,t){for(var r=e.length;r--;)if(Ga(e[r][0],t))return r;return-1}function tn(e,t,r,n){return pn(e,(function(e,i,o){t(n,e,r(e),o)})),n}function rn(e,t){return e&&Ii(t,Nu(t),e)}function nn(e,t,r){"__proto__"==t&&tt?tt(e,t,{configurable:!0,enumerable:!0,value:r,writable:!0}):e[t]=r}function on(t,r){for(var n=-1,i=r.length,o=ie(i),a=null==t;++n<i;)o[n]=a?e:Tu(t,r[n]);return o}function an(t,r,n){return t==t&&(n!==e&&(t=t<=n?t:n),r!==e&&(t=t>=r?t:r)),t}function un(t,r,n,i,o,a){var u,l=1&r,c=2&r,s=4&r;if(n&&(u=o?n(t,i,o,a):n(t)),u!==e)return u;if(!Xa(t))return t;var p=Fa(t);if(p){if(u=function(e){var t=e.length,r=new e.constructor(t);return t&&"string"==typeof e[0]&&Ce.call(e,"index")&&(r.index=e.index,r.input=e.input),r}(t),!l)return xi(t,u)}else{var h=ho(t),v=h==g||h==m;if(Wa(t))return _i(t,l);if(h==j||h==f||v&&!o){if(u=c||v?{}:vo(t),!l)return c?function(e,t){return Ii(e,fo(e),t)}(t,function(e,t){return e&&Ii(t,Du(t),e)}(u,t)):function(e,t){return Ii(e,po(e),t)}(t,rn(u,t))}else{if(!at[h])return o?t:{};u=function(e,t,r){var n,i=e.constructor;switch(t){case D:return Ei(e);case d:case y:return new i(+e);case L:return function(e,t){var r=t?Ei(e.buffer):e.buffer;return new e.constructor(r,e.byteOffset,e.byteLength)}(e,r);case A:case C:case R:case k:case U:case M:case G:case Q:case B:return Si(e,r);case b:return new i;case O:case T:return new i(e);case E:return function(e){var t=new e.constructor(e.source,fe.exec(e));return t.lastIndex=e.lastIndex,t}(e);case S:return new i;case w:return n=e,kr?Te(kr.call(n)):{}}}(t,h,l)}}a||(a=new Wr);var _=a.get(t);if(_)return _;a.set(t,u),ou(t)?t.forEach((function(e){u.add(un(e,r,n,e,t,a))})):tu(t)&&t.forEach((function(e,i){u.set(i,un(e,r,n,i,t,a))}));var P=p?e:(s?c?no:ro:c?Du:Nu)(t);return wt(P||t,(function(e,i){P&&(e=t[i=e]),Xr(u,i,un(e,r,n,i,t,a))})),u}function ln(t,r,n){var i=n.length;if(null==t)return!i;for(t=Te(t);i--;){var o=n[i],a=r[o],u=t[o];if(u===e&&!(o in t)||!a(u))return!1}return!0}function cn(r,n,i){if("function"!=typeof r)throw new xe(t);return No((function(){r.apply(e,i)}),n)}function sn(e,t,r,n){var i=-1,o=Nt,a=!0,u=e.length,l=[],c=t.length;if(!u)return l;r&&(t=Lt(t,Jt(r))),n?(o=Dt,a=!1):t.length>=200&&(o=Zt,a=!1,t=new $r(t));e:for(;++i<u;){var s=e[i],p=null==r?s:r(s);if(s=n||0!==s?s:0,a&&p==p){for(var f=c;f--;)if(t[f]===p)continue e;l.push(s)}else o(t,p,n)||l.push(s)}return l}Mr.templateSettings={escape:Y,evaluate:J,interpolate:H,variable:"",imports:{_:Mr}},Mr.prototype=Qr.prototype,Mr.prototype.constructor=Mr,Br.prototype=Gr(Qr.prototype),Br.prototype.constructor=Br,qr.prototype=Gr(Qr.prototype),qr.prototype.constructor=qr,Fr.prototype.clear=function(){this.__data__=Pr?Pr(null):{},this.size=0},Fr.prototype.delete=function(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t},Fr.prototype.get=function(t){var n=this.__data__;if(Pr){var i=n[t];return i===r?e:i}return Ce.call(n,t)?n[t]:e},Fr.prototype.has=function(t){var r=this.__data__;return Pr?r[t]!==e:Ce.call(r,t)},Fr.prototype.set=function(t,n){var i=this.__data__;return this.size+=this.has(t)?0:1,i[t]=Pr&&n===e?r:n,this},Vr.prototype.clear=function(){this.__data__=[],this.size=0},Vr.prototype.delete=function(e){var t=this.__data__,r=en(t,e);return!(r<0||(r==t.length-1?t.pop():ze.call(t,r,1),--this.size,0))},Vr.prototype.get=function(t){var r=this.__data__,n=en(r,t);return n<0?e:r[n][1]},Vr.prototype.has=function(e){return en(this.__data__,e)>-1},Vr.prototype.set=function(e,t){var r=this.__data__,n=en(r,e);return n<0?(++this.size,r.push([e,t])):r[n][1]=t,this},Kr.prototype.clear=function(){this.size=0,this.__data__={hash:new Fr,map:new(Er||Vr),string:new Fr}},Kr.prototype.delete=function(e){var t=lo(this,e).delete(e);return this.size-=t?1:0,t},Kr.prototype.get=function(e){return lo(this,e).get(e)},Kr.prototype.has=function(e){return lo(this,e).has(e)},Kr.prototype.set=function(e,t){var r=lo(this,e),n=r.size;return r.set(e,t),this.size+=r.size==n?0:1,this},$r.prototype.add=$r.prototype.push=function(e){return this.__data__.set(e,r),this},$r.prototype.has=function(e){return this.__data__.has(e)},Wr.prototype.clear=function(){this.__data__=new Vr,this.size=0},Wr.prototype.delete=function(e){var t=this.__data__,r=t.delete(e);return this.size=t.size,r},Wr.prototype.get=function(e){return this.__data__.get(e)},Wr.prototype.has=function(e){return this.__data__.has(e)},Wr.prototype.set=function(e,t){var r=this.__data__;if(r instanceof Vr){var n=r.__data__;if(!Er||n.length<199)return n.push([e,t]),this.size=++r.size,this;r=this.__data__=new Kr(n)}return r.set(e,t),this.size=r.size,this};var pn=Li(bn),fn=Li(On,!0);function hn(e,t){var r=!0;return pn(e,(function(e,n,i){return r=!!t(e,n,i)})),r}function dn(t,r,n){for(var i=-1,o=t.length;++i<o;){var a=t[i],u=r(a);if(null!=u&&(l===e?u==u&&!uu(u):n(u,l)))var l=u,c=a}return c}function yn(e,t){var r=[];return pn(e,(function(e,n,i){t(e,n,i)&&r.push(e)})),r}function vn(e,t,r,n,i){var o=-1,a=e.length;for(r||(r=go),i||(i=[]);++o<a;){var u=e[o];t>0&&r(u)?t>1?vn(u,t-1,r,n,i):At(i,u):n||(i[i.length]=u)}return i}var gn=Ai(),mn=Ai(!0);function bn(e,t){return e&&gn(e,t,Nu)}function On(e,t){return e&&mn(e,t,Nu)}function jn(e,t){return It(t,(function(t){return Ja(e[t])}))}function _n(t,r){for(var n=0,i=(r=mi(r,t)).length;null!=t&&n<i;)t=t[ko(r[n++])];return n&&n==i?t:e}function En(e,t,r){var n=t(e);return Fa(e)?n:At(n,r(e))}function Sn(t){return null==t?t===e?"[object Undefined]":"[object Null]":Xe&&Xe in Te(t)?function(t){var r=Ce.call(t,Xe),n=t[Xe];try{t[Xe]=e;var i=!0}catch(e){}var o=Ue.call(t);return i&&(r?t[Xe]=n:delete t[Xe]),o}(t):function(e){return Ue.call(e)}(t)}function Tn(e,t){return e>t}function wn(e,t){return null!=e&&Ce.call(e,t)}function Pn(e,t){return null!=e&&t in Te(e)}function xn(t,r,n){for(var i=n?Dt:Nt,o=t[0].length,a=t.length,u=a,l=ie(a),c=1/0,s=[];u--;){var p=t[u];u&&r&&(p=Lt(p,Jt(r))),c=gr(p.length,c),l[u]=!n&&(r||o>=120&&p.length>=120)?new $r(u&&p):e}p=t[0];var f=-1,h=l[0];e:for(;++f<o&&s.length<c;){var d=p[f],y=r?r(d):d;if(d=n||0!==d?d:0,!(h?Zt(h,y):i(s,y,n))){for(u=a;--u;){var v=l[u];if(!(v?Zt(v,y):i(t[u],y,n)))continue e}h&&h.push(y),s.push(d)}}return s}function In(t,r,n){var i=null==(t=Po(t,r=mi(r,t)))?t:t[ko(Yo(r))];return null==i?e:St(i,t,n)}function Nn(e){return eu(e)&&Sn(e)==f}function Dn(t,r,n,i,o){return t===r||(null==t||null==r||!eu(t)&&!eu(r)?t!=t&&r!=r:function(t,r,n,i,o,a){var u=Fa(t),l=Fa(r),c=u?h:ho(t),s=l?h:ho(r),p=(c=c==f?j:c)==j,g=(s=s==f?j:s)==j,m=c==s;if(m&&Wa(t)){if(!Wa(r))return!1;u=!0,p=!1}if(m&&!p)return a||(a=new Wr),u||lu(t)?eo(t,r,n,i,o,a):function(e,t,r,n,i,o,a){switch(r){case L:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case D:return!(e.byteLength!=t.byteLength||!o(new Fe(e),new Fe(t)));case d:case y:case O:return Ga(+e,+t);case v:return e.name==t.name&&e.message==t.message;case E:case T:return e==t+"";case b:var u=or;case S:var l=1&n;if(u||(u=lr),e.size!=t.size&&!l)return!1;var c=a.get(e);if(c)return c==t;n|=2,a.set(e,t);var s=eo(u(e),u(t),n,i,o,a);return a.delete(e),s;case w:if(kr)return kr.call(e)==kr.call(t)}return!1}(t,r,c,n,i,o,a);if(!(1&n)){var _=p&&Ce.call(t,"__wrapped__"),P=g&&Ce.call(r,"__wrapped__");if(_||P){var x=_?t.value():t,I=P?r.value():r;return a||(a=new Wr),o(x,I,n,i,a)}}return!!m&&(a||(a=new Wr),function(t,r,n,i,o,a){var u=1&n,l=ro(t),c=l.length,s=ro(r),p=s.length;if(c!=p&&!u)return!1;for(var f=c;f--;){var h=l[f];if(!(u?h in r:Ce.call(r,h)))return!1}var d=a.get(t),y=a.get(r);if(d&&y)return d==r&&y==t;var v=!0;a.set(t,r),a.set(r,t);for(var g=u;++f<c;){var m=t[h=l[f]],b=r[h];if(i)var O=u?i(b,m,h,r,t,a):i(m,b,h,t,r,a);if(!(O===e?m===b||o(m,b,n,i,a):O)){v=!1;break}g||(g="constructor"==h)}if(v&&!g){var j=t.constructor,_=r.constructor;j==_||!("constructor"in t)||!("constructor"in r)||"function"==typeof j&&j instanceof j&&"function"==typeof _&&_ instanceof _||(v=!1)}return a.delete(t),a.delete(r),v}(t,r,n,i,o,a))}(t,r,n,i,Dn,o))}function Ln(t,r,n,i){var o=n.length,a=o,u=!i;if(null==t)return!a;for(t=Te(t);o--;){var l=n[o];if(u&&l[2]?l[1]!==t[l[0]]:!(l[0]in t))return!1}for(;++o<a;){var c=(l=n[o])[0],s=t[c],p=l[1];if(u&&l[2]){if(s===e&&!(c in t))return!1}else{var f=new Wr;if(i)var h=i(s,p,c,t,r,f);if(!(h===e?Dn(p,s,3,i,f):h))return!1}}return!0}function An(e){return!(!Xa(e)||(t=e,ke&&ke in t))&&(Ja(e)?Qe:ye).test(Uo(e));var t}function Cn(e){return"function"==typeof e?e:null==e?rl:"object"==typeof e?Fa(e)?Qn(e[0],e[1]):Gn(e):pl(e)}function Rn(e){if(!Eo(e))return yr(e);var t=[];for(var r in Te(e))Ce.call(e,r)&&"constructor"!=r&&t.push(r);return t}function kn(e){if(!Xa(e))return function(e){var t=[];if(null!=e)for(var r in Te(e))t.push(r);return t}(e);var t=Eo(e),r=[];for(var n in e)("constructor"!=n||!t&&Ce.call(e,n))&&r.push(n);return r}function Un(e,t){return e<t}function Mn(e,t){var r=-1,n=Ka(e)?ie(e.length):[];return pn(e,(function(e,i,o){n[++r]=t(e,i,o)})),n}function Gn(e){var t=co(e);return 1==t.length&&t[0][2]?To(t[0][0],t[0][1]):function(r){return r===e||Ln(r,e,t)}}function Qn(t,r){return Oo(t)&&So(r)?To(ko(t),r):function(n){var i=Tu(n,t);return i===e&&i===r?wu(n,t):Dn(r,i,3)}}function Bn(t,r,n,i,o){t!==r&&gn(r,(function(a,u){if(o||(o=new Wr),Xa(a))!function(t,r,n,i,o,a,u){var l=xo(t,n),c=xo(r,n),s=u.get(c);if(s)Zr(t,n,s);else{var p=a?a(l,c,n+"",t,r,u):e,f=p===e;if(f){var h=Fa(c),d=!h&&Wa(c),y=!h&&!d&&lu(c);p=c,h||d||y?Fa(l)?p=l:$a(l)?p=xi(l):d?(f=!1,p=_i(c,!0)):y?(f=!1,p=Si(c,!0)):p=[]:nu(c)||qa(c)?(p=l,qa(l)?p=vu(l):Xa(l)&&!Ja(l)||(p=vo(c))):f=!1}f&&(u.set(c,p),o(p,c,i,a,u),u.delete(c)),Zr(t,n,p)}}(t,r,u,n,Bn,i,o);else{var l=i?i(xo(t,u),a,u+"",t,r,o):e;l===e&&(l=a),Zr(t,u,l)}}),Du)}function qn(t,r){var n=t.length;if(n)return mo(r+=r<0?n:0,n)?t[r]:e}function Fn(e,t,r){t=t.length?Lt(t,(function(e){return Fa(e)?function(t){return _n(t,1===e.length?e[0]:e)}:e})):[rl];var n=-1;t=Lt(t,Jt(uo()));var i=Mn(e,(function(e,r,i){var o=Lt(t,(function(t){return t(e)}));return{criteria:o,index:++n,value:e}}));return function(e,t){var r=e.length;for(e.sort(t);r--;)e[r]=e[r].value;return e}(i,(function(e,t){return function(e,t,r){for(var n=-1,i=e.criteria,o=t.criteria,a=i.length,u=r.length;++n<a;){var l=Ti(i[n],o[n]);if(l)return n>=u?l:l*("desc"==r[n]?-1:1)}return e.index-t.index}(e,t,r)}))}function Vn(e,t,r){for(var n=-1,i=t.length,o={};++n<i;){var a=t[n],u=_n(e,a);r(u,a)&&Zn(o,mi(a,e),u)}return o}function Kn(e,t,r,n){var i=n?Bt:Qt,o=-1,a=t.length,u=e;for(e===t&&(t=xi(t)),r&&(u=Lt(e,Jt(r)));++o<a;)for(var l=0,c=t[o],s=r?r(c):c;(l=i(u,s,l,n))>-1;)u!==e&&ze.call(u,l,1),ze.call(e,l,1);return e}function $n(e,t){for(var r=e?t.length:0,n=r-1;r--;){var i=t[r];if(r==n||i!==o){var o=i;mo(i)?ze.call(e,i,1):si(e,i)}}return e}function Wn(e,t){return e+dt(Or()*(t-e+1))}function zn(e,t){var r="";if(!e||t<1||t>l)return r;do{t%2&&(r+=e),(t=dt(t/2))&&(e+=e)}while(t);return r}function Yn(e,t){return Do(wo(e,t,rl),e+"")}function Jn(e){return Yr(Gu(e))}function Hn(e,t){var r=Gu(e);return Co(r,an(t,0,r.length))}function Zn(t,r,n,i){if(!Xa(t))return t;for(var o=-1,a=(r=mi(r,t)).length,u=a-1,l=t;null!=l&&++o<a;){var c=ko(r[o]),s=n;if("__proto__"===c||"constructor"===c||"prototype"===c)return t;if(o!=u){var p=l[c];(s=i?i(p,c,l):e)===e&&(s=Xa(p)?p:mo(r[o+1])?[]:{})}Xr(l,c,s),l=l[c]}return t}var Xn=xr?function(e,t){return xr.set(e,t),e}:rl,ei=tt?function(e,t){return tt(e,"toString",{configurable:!0,enumerable:!1,value:Xu(t),writable:!0})}:rl;function ti(e){return Co(Gu(e))}function ri(e,t,r){var n=-1,i=e.length;t<0&&(t=-t>i?0:i+t),(r=r>i?i:r)<0&&(r+=i),i=t>r?0:r-t>>>0,t>>>=0;for(var o=ie(i);++n<i;)o[n]=e[n+t];return o}function ni(e,t){var r;return pn(e,(function(e,n,i){return!(r=t(e,n,i))})),!!r}function ii(e,t,r){var n=0,i=null==e?n:e.length;if("number"==typeof t&&t==t&&i<=2147483647){for(;n<i;){var o=n+i>>>1,a=e[o];null!==a&&!uu(a)&&(r?a<=t:a<t)?n=o+1:i=o}return i}return oi(e,t,rl,r)}function oi(t,r,n,i){var o=0,a=null==t?0:t.length;if(0===a)return 0;for(var u=(r=n(r))!=r,l=null===r,c=uu(r),s=r===e;o<a;){var p=dt((o+a)/2),f=n(t[p]),h=f!==e,d=null===f,y=f==f,v=uu(f);if(u)var g=i||y;else g=s?y&&(i||h):l?y&&h&&(i||!d):c?y&&h&&!d&&(i||!v):!d&&!v&&(i?f<=r:f<r);g?o=p+1:a=p}return gr(a,4294967294)}function ai(e,t){for(var r=-1,n=e.length,i=0,o=[];++r<n;){var a=e[r],u=t?t(a):a;if(!r||!Ga(u,l)){var l=u;o[i++]=0===a?0:a}}return o}function ui(e){return"number"==typeof e?e:uu(e)?c:+e}function li(e){if("string"==typeof e)return e;if(Fa(e))return Lt(e,li)+"";if(uu(e))return Ur?Ur.call(e):"";var t=e+"";return"0"==t&&1/e==-1/0?"-0":t}function ci(e,t,r){var n=-1,i=Nt,o=e.length,a=!0,u=[],l=u;if(r)a=!1,i=Dt;else if(o>=200){var c=t?null:zi(e);if(c)return lr(c);a=!1,i=Zt,l=new $r}else l=t?[]:u;e:for(;++n<o;){var s=e[n],p=t?t(s):s;if(s=r||0!==s?s:0,a&&p==p){for(var f=l.length;f--;)if(l[f]===p)continue e;t&&l.push(p),u.push(s)}else i(l,p,r)||(l!==u&&l.push(p),u.push(s))}return u}function si(e,t){return null==(e=Po(e,t=mi(t,e)))||delete e[ko(Yo(t))]}function pi(e,t,r,n){return Zn(e,t,r(_n(e,t)),n)}function fi(e,t,r,n){for(var i=e.length,o=n?i:-1;(n?o--:++o<i)&&t(e[o],o,e););return r?ri(e,n?0:o,n?o+1:i):ri(e,n?o+1:0,n?i:o)}function hi(e,t){var r=e;return r instanceof qr&&(r=r.value()),Ct(t,(function(e,t){return t.func.apply(t.thisArg,At([e],t.args))}),r)}function di(e,t,r){var n=e.length;if(n<2)return n?ci(e[0]):[];for(var i=-1,o=ie(n);++i<n;)for(var a=e[i],u=-1;++u<n;)u!=i&&(o[i]=sn(o[i]||a,e[u],t,r));return ci(vn(o,1),t,r)}function yi(t,r,n){for(var i=-1,o=t.length,a=r.length,u={};++i<o;){var l=i<a?r[i]:e;n(u,t[i],l)}return u}function vi(e){return $a(e)?e:[]}function gi(e){return"function"==typeof e?e:rl}function mi(e,t){return Fa(e)?e:Oo(e,t)?[e]:Ro(gu(e))}var bi=Yn;function Oi(t,r,n){var i=t.length;return n=n===e?i:n,!r&&n>=i?t:ri(t,r,n)}var ji=ut||function(e){return ft.clearTimeout(e)};function _i(e,t){if(t)return e.slice();var r=e.length,n=Ve?Ve(r):new e.constructor(r);return e.copy(n),n}function Ei(e){var t=new e.constructor(e.byteLength);return new Fe(t).set(new Fe(e)),t}function Si(e,t){var r=t?Ei(e.buffer):e.buffer;return new e.constructor(r,e.byteOffset,e.length)}function Ti(t,r){if(t!==r){var n=t!==e,i=null===t,o=t==t,a=uu(t),u=r!==e,l=null===r,c=r==r,s=uu(r);if(!l&&!s&&!a&&t>r||a&&u&&c&&!l&&!s||i&&u&&c||!n&&c||!o)return 1;if(!i&&!a&&!s&&t<r||s&&n&&o&&!i&&!a||l&&n&&o||!u&&o||!c)return-1}return 0}function wi(e,t,r,n){for(var i=-1,o=e.length,a=r.length,u=-1,l=t.length,c=vr(o-a,0),s=ie(l+c),p=!n;++u<l;)s[u]=t[u];for(;++i<a;)(p||i<o)&&(s[r[i]]=e[i]);for(;c--;)s[u++]=e[i++];return s}function Pi(e,t,r,n){for(var i=-1,o=e.length,a=-1,u=r.length,l=-1,c=t.length,s=vr(o-u,0),p=ie(s+c),f=!n;++i<s;)p[i]=e[i];for(var h=i;++l<c;)p[h+l]=t[l];for(;++a<u;)(f||i<o)&&(p[h+r[a]]=e[i++]);return p}function xi(e,t){var r=-1,n=e.length;for(t||(t=ie(n));++r<n;)t[r]=e[r];return t}function Ii(t,r,n,i){var o=!n;n||(n={});for(var a=-1,u=r.length;++a<u;){var l=r[a],c=i?i(n[l],t[l],l,n,t):e;c===e&&(c=t[l]),o?nn(n,l,c):Xr(n,l,c)}return n}function Ni(e,t){return function(r,n){var i=Fa(r)?Tt:tn,o=t?t():{};return i(r,e,uo(n,2),o)}}function Di(t){return Yn((function(r,n){var i=-1,o=n.length,a=o>1?n[o-1]:e,u=o>2?n[2]:e;for(a=t.length>3&&"function"==typeof a?(o--,a):e,u&&bo(n[0],n[1],u)&&(a=o<3?e:a,o=1),r=Te(r);++i<o;){var l=n[i];l&&t(r,l,i,a)}return r}))}function Li(e,t){return function(r,n){if(null==r)return r;if(!Ka(r))return e(r,n);for(var i=r.length,o=t?i:-1,a=Te(r);(t?o--:++o<i)&&!1!==n(a[o],o,a););return r}}function Ai(e){return function(t,r,n){for(var i=-1,o=Te(t),a=n(t),u=a.length;u--;){var l=a[e?u:++i];if(!1===r(o[l],l,o))break}return t}}function Ci(t){return function(r){var n=ir(r=gu(r))?pr(r):e,i=n?n[0]:r.charAt(0),o=n?Oi(n,1).join(""):r.slice(1);return i[t]()+o}}function Ri(e){return function(t){return Ct(Ju(qu(t).replace(He,"")),e,"")}}function ki(e){return function(){var t=arguments;switch(t.length){case 0:return new e;case 1:return new e(t[0]);case 2:return new e(t[0],t[1]);case 3:return new e(t[0],t[1],t[2]);case 4:return new e(t[0],t[1],t[2],t[3]);case 5:return new e(t[0],t[1],t[2],t[3],t[4]);case 6:return new e(t[0],t[1],t[2],t[3],t[4],t[5]);case 7:return new e(t[0],t[1],t[2],t[3],t[4],t[5],t[6])}var r=Gr(e.prototype),n=e.apply(r,t);return Xa(n)?n:r}}function Ui(t){return function(r,n,i){var o=Te(r);if(!Ka(r)){var a=uo(n,3);r=Nu(r),n=function(e){return a(o[e],e,o)}}var u=t(r,n,i);return u>-1?o[a?r[u]:u]:e}}function Mi(r){return to((function(n){var i=n.length,o=i,a=Br.prototype.thru;for(r&&n.reverse();o--;){var u=n[o];if("function"!=typeof u)throw new xe(t);if(a&&!l&&"wrapper"==oo(u))var l=new Br([],!0)}for(o=l?o:i;++o<i;){var c=oo(u=n[o]),s="wrapper"==c?io(u):e;l=s&&jo(s[0])&&424==s[1]&&!s[4].length&&1==s[9]?l[oo(s[0])].apply(l,s[3]):1==u.length&&jo(u)?l[c]():l.thru(u)}return function(){var e=arguments,t=e[0];if(l&&1==e.length&&Fa(t))return l.plant(t).value();for(var r=0,o=i?n[r].apply(this,e):t;++r<i;)o=n[r].call(this,o);return o}}))}function Gi(t,r,n,i,a,u,l,c,s,p){var f=r&o,h=1&r,d=2&r,y=24&r,v=512&r,g=d?e:ki(t);return function o(){for(var m=arguments.length,b=ie(m),O=m;O--;)b[O]=arguments[O];if(y)var j=ao(o),_=function(e,t){for(var r=e.length,n=0;r--;)e[r]===t&&++n;return n}(b,j);if(i&&(b=wi(b,i,a,y)),u&&(b=Pi(b,u,l,y)),m-=_,y&&m<p){var E=ur(b,j);return $i(t,r,Gi,o.placeholder,n,b,E,c,s,p-m)}var S=h?n:this,T=d?S[t]:t;return m=b.length,c?b=function(t,r){for(var n=t.length,i=gr(r.length,n),o=xi(t);i--;){var a=r[i];t[i]=mo(a,n)?o[a]:e}return t}(b,c):v&&m>1&&b.reverse(),f&&s<m&&(b.length=s),this&&this!==ft&&this instanceof o&&(T=g||ki(T)),T.apply(S,b)}}function Qi(e,t){return function(r,n){return function(e,t,r,n){return bn(e,(function(e,i,o){t(n,r(e),i,o)})),n}(r,e,t(n),{})}}function Bi(t,r){return function(n,i){var o;if(n===e&&i===e)return r;if(n!==e&&(o=n),i!==e){if(o===e)return i;"string"==typeof n||"string"==typeof i?(n=li(n),i=li(i)):(n=ui(n),i=ui(i)),o=t(n,i)}return o}}function qi(e){return to((function(t){return t=Lt(t,Jt(uo())),Yn((function(r){var n=this;return e(t,(function(e){return St(e,n,r)}))}))}))}function Fi(t,r){var n=(r=r===e?" ":li(r)).length;if(n<2)return n?zn(r,t):r;var i=zn(r,ht(t/sr(r)));return ir(r)?Oi(pr(i),0,t).join(""):i.slice(0,t)}function Vi(t){return function(r,n,i){return i&&"number"!=typeof i&&bo(r,n,i)&&(n=i=e),r=fu(r),n===e?(n=r,r=0):n=fu(n),function(e,t,r,n){for(var i=-1,o=vr(ht((t-e)/(r||1)),0),a=ie(o);o--;)a[n?o:++i]=e,e+=r;return a}(r,n,i=i===e?r<n?1:-1:fu(i),t)}}function Ki(e){return function(t,r){return"string"==typeof t&&"string"==typeof r||(t=yu(t),r=yu(r)),e(t,r)}}function $i(t,r,n,o,a,u,l,c,s,p){var f=8&r;r|=f?i:64,4&(r&=~(f?64:i))||(r&=-4);var h=[t,r,a,f?u:e,f?l:e,f?e:u,f?e:l,c,s,p],d=n.apply(e,h);return jo(t)&&Io(d,h),d.placeholder=o,Lo(d,t,r)}function Wi(e){var t=Se[e];return function(e,r){if(e=yu(e),(r=null==r?0:gr(hu(r),292))&&Ut(e)){var n=(gu(e)+"e").split("e");return+((n=(gu(t(n[0]+"e"+(+n[1]+r)))+"e").split("e"))[0]+"e"+(+n[1]-r))}return t(e)}}var zi=Tr&&1/lr(new Tr([,-0]))[1]==u?function(e){return new Tr(e)}:ul;function Yi(e){return function(t){var r=ho(t);return r==b?or(t):r==S?cr(t):function(e,t){return Lt(t,(function(t){return[t,e[t]]}))}(t,e(t))}}function Ji(r,u,l,c,s,p,f,h){var d=2&u;if(!d&&"function"!=typeof r)throw new xe(t);var y=c?c.length:0;if(y||(u&=-97,c=s=e),f=f===e?f:vr(hu(f),0),h=h===e?h:hu(h),y-=s?s.length:0,64&u){var v=c,g=s;c=s=e}var m=d?e:io(r),b=[r,u,l,c,s,v,g,p,f,h];if(m&&function(e,t){var r=e[1],i=t[1],u=r|i,l=u<131,c=i==o&&8==r||i==o&&r==a&&e[7].length<=t[8]||384==i&&t[7].length<=t[8]&&8==r;if(!l&&!c)return e;1&i&&(e[2]=t[2],u|=1&r?0:4);var s=t[3];if(s){var p=e[3];e[3]=p?wi(p,s,t[4]):s,e[4]=p?ur(e[3],n):t[4]}(s=t[5])&&(p=e[5],e[5]=p?Pi(p,s,t[6]):s,e[6]=p?ur(e[5],n):t[6]),(s=t[7])&&(e[7]=s),i&o&&(e[8]=null==e[8]?t[8]:gr(e[8],t[8])),null==e[9]&&(e[9]=t[9]),e[0]=t[0],e[1]=u}(b,m),r=b[0],u=b[1],l=b[2],c=b[3],s=b[4],!(h=b[9]=b[9]===e?d?0:r.length:vr(b[9]-y,0))&&24&u&&(u&=-25),u&&1!=u)O=8==u||16==u?function(t,r,n){var i=ki(t);return function o(){for(var a=arguments.length,u=ie(a),l=a,c=ao(o);l--;)u[l]=arguments[l];var s=a<3&&u[0]!==c&&u[a-1]!==c?[]:ur(u,c);return(a-=s.length)<n?$i(t,r,Gi,o.placeholder,e,u,s,e,e,n-a):St(this&&this!==ft&&this instanceof o?i:t,this,u)}}(r,u,h):u!=i&&33!=u||s.length?Gi.apply(e,b):function(e,t,r,n){var i=1&t,o=ki(e);return function t(){for(var a=-1,u=arguments.length,l=-1,c=n.length,s=ie(c+u),p=this&&this!==ft&&this instanceof t?o:e;++l<c;)s[l]=n[l];for(;u--;)s[l++]=arguments[++a];return St(p,i?r:this,s)}}(r,u,l,c);else var O=function(e,t,r){var n=1&t,i=ki(e);return function t(){return(this&&this!==ft&&this instanceof t?i:e).apply(n?r:this,arguments)}}(r,u,l);return Lo((m?Xn:Io)(O,b),r,u)}function Hi(t,r,n,i){return t===e||Ga(t,De[n])&&!Ce.call(i,n)?r:t}function Zi(t,r,n,i,o,a){return Xa(t)&&Xa(r)&&(a.set(r,t),Bn(t,r,e,Zi,a),a.delete(r)),t}function Xi(t){return nu(t)?e:t}function eo(t,r,n,i,o,a){var u=1&n,l=t.length,c=r.length;if(l!=c&&!(u&&c>l))return!1;var s=a.get(t),p=a.get(r);if(s&&p)return s==r&&p==t;var f=-1,h=!0,d=2&n?new $r:e;for(a.set(t,r),a.set(r,t);++f<l;){var y=t[f],v=r[f];if(i)var g=u?i(v,y,f,r,t,a):i(y,v,f,t,r,a);if(g!==e){if(g)continue;h=!1;break}if(d){if(!kt(r,(function(e,t){if(!Zt(d,t)&&(y===e||o(y,e,n,i,a)))return d.push(t)}))){h=!1;break}}else if(y!==v&&!o(y,v,n,i,a)){h=!1;break}}return a.delete(t),a.delete(r),h}function to(t){return Do(wo(t,e,Vo),t+"")}function ro(e){return En(e,Nu,po)}function no(e){return En(e,Du,fo)}var io=xr?function(e){return xr.get(e)}:ul;function oo(e){for(var t=e.name+"",r=Ir[t],n=Ce.call(Ir,t)?r.length:0;n--;){var i=r[n],o=i.func;if(null==o||o==e)return i.name}return t}function ao(e){return(Ce.call(Mr,"placeholder")?Mr:e).placeholder}function uo(){var e=Mr.iteratee||nl;return e=e===nl?Cn:e,arguments.length?e(arguments[0],arguments[1]):e}function lo(e,t){var r,n,i=e.__data__;return("string"==(n=typeof(r=t))||"number"==n||"symbol"==n||"boolean"==n?"__proto__"!==r:null===r)?i["string"==typeof t?"string":"hash"]:i.map}function co(e){for(var t=Nu(e),r=t.length;r--;){var n=t[r],i=e[n];t[r]=[n,i,So(i)]}return t}function so(t,r){var n=function(t,r){return null==t?e:t[r]}(t,r);return An(n)?n:e}var po=vt?function(e){return null==e?[]:(e=Te(e),It(vt(e),(function(t){return We.call(e,t)})))}:dl,fo=vt?function(e){for(var t=[];e;)At(t,po(e)),e=Ke(e);return t}:dl,ho=Sn;function yo(e,t,r){for(var n=-1,i=(t=mi(t,e)).length,o=!1;++n<i;){var a=ko(t[n]);if(!(o=null!=e&&r(e,a)))break;e=e[a]}return o||++n!=i?o:!!(i=null==e?0:e.length)&&Za(i)&&mo(a,i)&&(Fa(e)||qa(e))}function vo(e){return"function"!=typeof e.constructor||Eo(e)?{}:Gr(Ke(e))}function go(e){return Fa(e)||qa(e)||!!(Ye&&e&&e[Ye])}function mo(e,t){var r=typeof e;return!!(t=null==t?l:t)&&("number"==r||"symbol"!=r&&ge.test(e))&&e>-1&&e%1==0&&e<t}function bo(e,t,r){if(!Xa(r))return!1;var n=typeof t;return!!("number"==n?Ka(r)&&mo(t,r.length):"string"==n&&t in r)&&Ga(r[t],e)}function Oo(e,t){if(Fa(e))return!1;var r=typeof e;return!("number"!=r&&"symbol"!=r&&"boolean"!=r&&null!=e&&!uu(e))||X.test(e)||!Z.test(e)||null!=t&&e in Te(t)}function jo(e){var t=oo(e),r=Mr[t];if("function"!=typeof r||!(t in qr.prototype))return!1;if(e===r)return!0;var n=io(r);return!!n&&e===n[0]}(_r&&ho(new _r(new ArrayBuffer(1)))!=L||Er&&ho(new Er)!=b||Sr&&ho(Sr.resolve())!=_||Tr&&ho(new Tr)!=S||wr&&ho(new wr)!=x)&&(ho=function(t){var r=Sn(t),n=r==j?t.constructor:e,i=n?Uo(n):"";if(i)switch(i){case Nr:return L;case Dr:return b;case Lr:return _;case Ar:return S;case Cr:return x}return r});var _o=Le?Ja:yl;function Eo(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||De)}function So(e){return e==e&&!Xa(e)}function To(t,r){return function(n){return null!=n&&n[t]===r&&(r!==e||t in Te(n))}}function wo(t,r,n){return r=vr(r===e?t.length-1:r,0),function(){for(var e=arguments,i=-1,o=vr(e.length-r,0),a=ie(o);++i<o;)a[i]=e[r+i];i=-1;for(var u=ie(r+1);++i<r;)u[i]=e[i];return u[r]=n(a),St(t,this,u)}}function Po(e,t){return t.length<2?e:_n(e,ri(t,0,-1))}function xo(e,t){if(("constructor"!==t||"function"!=typeof e[t])&&"__proto__"!=t)return e[t]}var Io=Ao(Xn),No=pt||function(e,t){return ft.setTimeout(e,t)},Do=Ao(ei);function Lo(e,t,r){var n=t+"";return Do(e,function(e,t){var r=t.length;if(!r)return e;var n=r-1;return t[n]=(r>1?"& ":"")+t[n],t=t.join(r>2?", ":" "),e.replace(oe,"{\n/* [wrapped with "+t+"] */\n")}(n,function(e,t){return wt(p,(function(r){var n="_."+r[0];t&r[1]&&!Nt(e,n)&&e.push(n)})),e.sort()}(function(e){var t=e.match(ae);return t?t[1].split(ue):[]}(n),r)))}function Ao(t){var r=0,n=0;return function(){var i=mr(),o=16-(i-n);if(n=i,o>0){if(++r>=800)return arguments[0]}else r=0;return t.apply(e,arguments)}}function Co(t,r){var n=-1,i=t.length,o=i-1;for(r=r===e?i:r;++n<r;){var a=Wn(n,o),u=t[a];t[a]=t[n],t[n]=u}return t.length=r,t}var Ro=function(e){var t=Aa(e,(function(e){return 500===r.size&&r.clear(),e})),r=t.cache;return t}((function(e){var t=[];return 46===e.charCodeAt(0)&&t.push(""),e.replace(ee,(function(e,r,n,i){t.push(n?i.replace(se,"$1"):r||e)})),t}));function ko(e){if("string"==typeof e||uu(e))return e;var t=e+"";return"0"==t&&1/e==-1/0?"-0":t}function Uo(e){if(null!=e){try{return Ae.call(e)}catch(e){}try{return e+""}catch(e){}}return""}function Mo(e){if(e instanceof qr)return e.clone();var t=new Br(e.__wrapped__,e.__chain__);return t.__actions__=xi(e.__actions__),t.__index__=e.__index__,t.__values__=e.__values__,t}var Go=Yn((function(e,t){return $a(e)?sn(e,vn(t,1,$a,!0)):[]})),Qo=Yn((function(t,r){var n=Yo(r);return $a(n)&&(n=e),$a(t)?sn(t,vn(r,1,$a,!0),uo(n,2)):[]})),Bo=Yn((function(t,r){var n=Yo(r);return $a(n)&&(n=e),$a(t)?sn(t,vn(r,1,$a,!0),e,n):[]}));function qo(e,t,r){var n=null==e?0:e.length;if(!n)return-1;var i=null==r?0:hu(r);return i<0&&(i=vr(n+i,0)),Gt(e,uo(t,3),i)}function Fo(t,r,n){var i=null==t?0:t.length;if(!i)return-1;var o=i-1;return n!==e&&(o=hu(n),o=n<0?vr(i+o,0):gr(o,i-1)),Gt(t,uo(r,3),o,!0)}function Vo(e){return null!=e&&e.length?vn(e,1):[]}function Ko(t){return t&&t.length?t[0]:e}var $o=Yn((function(e){var t=Lt(e,vi);return t.length&&t[0]===e[0]?xn(t):[]})),Wo=Yn((function(t){var r=Yo(t),n=Lt(t,vi);return r===Yo(n)?r=e:n.pop(),n.length&&n[0]===t[0]?xn(n,uo(r,2)):[]})),zo=Yn((function(t){var r=Yo(t),n=Lt(t,vi);return(r="function"==typeof r?r:e)&&n.pop(),n.length&&n[0]===t[0]?xn(n,e,r):[]}));function Yo(t){var r=null==t?0:t.length;return r?t[r-1]:e}var Jo=Yn(Ho);function Ho(e,t){return e&&e.length&&t&&t.length?Kn(e,t):e}var Zo=to((function(e,t){var r=null==e?0:e.length,n=on(e,t);return $n(e,Lt(t,(function(e){return mo(e,r)?+e:e})).sort(Ti)),n}));function Xo(e){return null==e?e:jr.call(e)}var ea=Yn((function(e){return ci(vn(e,1,$a,!0))})),ta=Yn((function(t){var r=Yo(t);return $a(r)&&(r=e),ci(vn(t,1,$a,!0),uo(r,2))})),ra=Yn((function(t){var r=Yo(t);return r="function"==typeof r?r:e,ci(vn(t,1,$a,!0),e,r)}));function na(e){if(!e||!e.length)return[];var t=0;return e=It(e,(function(e){if($a(e))return t=vr(e.length,t),!0})),zt(t,(function(t){return Lt(e,Vt(t))}))}function ia(t,r){if(!t||!t.length)return[];var n=na(t);return null==r?n:Lt(n,(function(t){return St(r,e,t)}))}var oa=Yn((function(e,t){return $a(e)?sn(e,t):[]})),aa=Yn((function(e){return di(It(e,$a))})),ua=Yn((function(t){var r=Yo(t);return $a(r)&&(r=e),di(It(t,$a),uo(r,2))})),la=Yn((function(t){var r=Yo(t);return r="function"==typeof r?r:e,di(It(t,$a),e,r)})),ca=Yn(na),sa=Yn((function(t){var r=t.length,n=r>1?t[r-1]:e;return n="function"==typeof n?(t.pop(),n):e,ia(t,n)}));function pa(e){var t=Mr(e);return t.__chain__=!0,t}function fa(e,t){return t(e)}var ha=to((function(t){var r=t.length,n=r?t[0]:0,i=this.__wrapped__,o=function(e){return on(e,t)};return!(r>1||this.__actions__.length)&&i instanceof qr&&mo(n)?((i=i.slice(n,+n+(r?1:0))).__actions__.push({func:fa,args:[o],thisArg:e}),new Br(i,this.__chain__).thru((function(t){return r&&!t.length&&t.push(e),t}))):this.thru(o)})),da=Ni((function(e,t,r){Ce.call(e,r)?++e[r]:nn(e,r,1)})),ya=Ui(qo),va=Ui(Fo);function ga(e,t){return(Fa(e)?wt:pn)(e,uo(t,3))}function ma(e,t){return(Fa(e)?Pt:fn)(e,uo(t,3))}var ba=Ni((function(e,t,r){Ce.call(e,r)?e[r].push(t):nn(e,r,[t])})),Oa=Yn((function(e,t,r){var n=-1,i="function"==typeof t,o=Ka(e)?ie(e.length):[];return pn(e,(function(e){o[++n]=i?St(t,e,r):In(e,t,r)})),o})),ja=Ni((function(e,t,r){nn(e,r,t)}));function _a(e,t){return(Fa(e)?Lt:Mn)(e,uo(t,3))}var Ea=Ni((function(e,t,r){e[r?0:1].push(t)}),(function(){return[[],[]]})),Sa=Yn((function(e,t){if(null==e)return[];var r=t.length;return r>1&&bo(e,t[0],t[1])?t=[]:r>2&&bo(t[0],t[1],t[2])&&(t=[t[0]]),Fn(e,vn(t,1),[])})),Ta=st||function(){return ft.Date.now()};function wa(t,r,n){return r=n?e:r,r=t&&null==r?t.length:r,Ji(t,o,e,e,e,e,r)}function Pa(r,n){var i;if("function"!=typeof n)throw new xe(t);return r=hu(r),function(){return--r>0&&(i=n.apply(this,arguments)),r<=1&&(n=e),i}}var xa=Yn((function(e,t,r){var n=1;if(r.length){var o=ur(r,ao(xa));n|=i}return Ji(e,n,t,r,o)})),Ia=Yn((function(e,t,r){var n=3;if(r.length){var o=ur(r,ao(Ia));n|=i}return Ji(t,n,e,r,o)}));function Na(r,n,i){var o,a,u,l,c,s,p=0,f=!1,h=!1,d=!0;if("function"!=typeof r)throw new xe(t);function y(t){var n=o,i=a;return o=a=e,p=t,l=r.apply(i,n)}function v(t){var r=t-s;return s===e||r>=n||r<0||h&&t-p>=u}function g(){var e=Ta();if(v(e))return m(e);c=No(g,function(e){var t=n-(e-s);return h?gr(t,u-(e-p)):t}(e))}function m(t){return c=e,d&&o?y(t):(o=a=e,l)}function b(){var t=Ta(),r=v(t);if(o=arguments,a=this,s=t,r){if(c===e)return function(e){return p=e,c=No(g,n),f?y(e):l}(s);if(h)return ji(c),c=No(g,n),y(s)}return c===e&&(c=No(g,n)),l}return n=yu(n)||0,Xa(i)&&(f=!!i.leading,u=(h="maxWait"in i)?vr(yu(i.maxWait)||0,n):u,d="trailing"in i?!!i.trailing:d),b.cancel=function(){c!==e&&ji(c),p=0,o=s=a=c=e},b.flush=function(){return c===e?l:m(Ta())},b}var Da=Yn((function(e,t){return cn(e,1,t)})),La=Yn((function(e,t,r){return cn(e,yu(t)||0,r)}));function Aa(e,r){if("function"!=typeof e||null!=r&&"function"!=typeof r)throw new xe(t);var n=function(){var t=arguments,i=r?r.apply(this,t):t[0],o=n.cache;if(o.has(i))return o.get(i);var a=e.apply(this,t);return n.cache=o.set(i,a)||o,a};return n.cache=new(Aa.Cache||Kr),n}function Ca(e){if("function"!=typeof e)throw new xe(t);return function(){var t=arguments;switch(t.length){case 0:return!e.call(this);case 1:return!e.call(this,t[0]);case 2:return!e.call(this,t[0],t[1]);case 3:return!e.call(this,t[0],t[1],t[2])}return!e.apply(this,t)}}Aa.Cache=Kr;var Ra=bi((function(e,t){var r=(t=1==t.length&&Fa(t[0])?Lt(t[0],Jt(uo())):Lt(vn(t,1),Jt(uo()))).length;return Yn((function(n){for(var i=-1,o=gr(n.length,r);++i<o;)n[i]=t[i].call(this,n[i]);return St(e,this,n)}))})),ka=Yn((function(t,r){var n=ur(r,ao(ka));return Ji(t,i,e,r,n)})),Ua=Yn((function(t,r){var n=ur(r,ao(Ua));return Ji(t,64,e,r,n)})),Ma=to((function(t,r){return Ji(t,a,e,e,e,r)}));function Ga(e,t){return e===t||e!=e&&t!=t}var Qa=Ki(Tn),Ba=Ki((function(e,t){return e>=t})),qa=Nn(function(){return arguments}())?Nn:function(e){return eu(e)&&Ce.call(e,"callee")&&!We.call(e,"callee")},Fa=ie.isArray,Va=mt?Jt(mt):function(e){return eu(e)&&Sn(e)==D};function Ka(e){return null!=e&&Za(e.length)&&!Ja(e)}function $a(e){return eu(e)&&Ka(e)}var Wa=gt||yl,za=bt?Jt(bt):function(e){return eu(e)&&Sn(e)==y};function Ya(e){if(!eu(e))return!1;var t=Sn(e);return t==v||"[object DOMException]"==t||"string"==typeof e.message&&"string"==typeof e.name&&!nu(e)}function Ja(e){if(!Xa(e))return!1;var t=Sn(e);return t==g||t==m||"[object AsyncFunction]"==t||"[object Proxy]"==t}function Ha(e){return"number"==typeof e&&e==hu(e)}function Za(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=l}function Xa(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)}function eu(e){return null!=e&&"object"==typeof e}var tu=Ot?Jt(Ot):function(e){return eu(e)&&ho(e)==b};function ru(e){return"number"==typeof e||eu(e)&&Sn(e)==O}function nu(e){if(!eu(e)||Sn(e)!=j)return!1;var t=Ke(e);if(null===t)return!0;var r=Ce.call(t,"constructor")&&t.constructor;return"function"==typeof r&&r instanceof r&&Ae.call(r)==Me}var iu=jt?Jt(jt):function(e){return eu(e)&&Sn(e)==E},ou=_t?Jt(_t):function(e){return eu(e)&&ho(e)==S};function au(e){return"string"==typeof e||!Fa(e)&&eu(e)&&Sn(e)==T}function uu(e){return"symbol"==typeof e||eu(e)&&Sn(e)==w}var lu=Et?Jt(Et):function(e){return eu(e)&&Za(e.length)&&!!ot[Sn(e)]},cu=Ki(Un),su=Ki((function(e,t){return e<=t}));function pu(e){if(!e)return[];if(Ka(e))return au(e)?pr(e):xi(e);if(Je&&e[Je])return function(e){for(var t,r=[];!(t=e.next()).done;)r.push(t.value);return r}(e[Je]());var t=ho(e);return(t==b?or:t==S?lr:Gu)(e)}function fu(e){return e?(e=yu(e))===u||e===-1/0?17976931348623157e292*(e<0?-1:1):e==e?e:0:0===e?e:0}function hu(e){var t=fu(e),r=t%1;return t==t?r?t-r:t:0}function du(e){return e?an(hu(e),0,s):0}function yu(e){if("number"==typeof e)return e;if(uu(e))return c;if(Xa(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=Xa(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=Yt(e);var r=de.test(e);return r||ve.test(e)?ct(e.slice(2),r?2:8):he.test(e)?c:+e}function vu(e){return Ii(e,Du(e))}function gu(e){return null==e?"":li(e)}var mu=Di((function(e,t){if(Eo(t)||Ka(t))Ii(t,Nu(t),e);else for(var r in t)Ce.call(t,r)&&Xr(e,r,t[r])})),bu=Di((function(e,t){Ii(t,Du(t),e)})),Ou=Di((function(e,t,r,n){Ii(t,Du(t),e,n)})),ju=Di((function(e,t,r,n){Ii(t,Nu(t),e,n)})),_u=to(on),Eu=Yn((function(t,r){t=Te(t);var n=-1,i=r.length,o=i>2?r[2]:e;for(o&&bo(r[0],r[1],o)&&(i=1);++n<i;)for(var a=r[n],u=Du(a),l=-1,c=u.length;++l<c;){var s=u[l],p=t[s];(p===e||Ga(p,De[s])&&!Ce.call(t,s))&&(t[s]=a[s])}return t})),Su=Yn((function(t){return t.push(e,Zi),St(Au,e,t)}));function Tu(t,r,n){var i=null==t?e:_n(t,r);return i===e?n:i}function wu(e,t){return null!=e&&yo(e,t,Pn)}var Pu=Qi((function(e,t,r){null!=t&&"function"!=typeof t.toString&&(t=Ue.call(t)),e[t]=r}),Xu(rl)),xu=Qi((function(e,t,r){null!=t&&"function"!=typeof t.toString&&(t=Ue.call(t)),Ce.call(e,t)?e[t].push(r):e[t]=[r]}),uo),Iu=Yn(In);function Nu(e){return Ka(e)?zr(e):Rn(e)}function Du(e){return Ka(e)?zr(e,!0):kn(e)}var Lu=Di((function(e,t,r){Bn(e,t,r)})),Au=Di((function(e,t,r,n){Bn(e,t,r,n)})),Cu=to((function(e,t){var r={};if(null==e)return r;var n=!1;t=Lt(t,(function(t){return t=mi(t,e),n||(n=t.length>1),t})),Ii(e,no(e),r),n&&(r=un(r,7,Xi));for(var i=t.length;i--;)si(r,t[i]);return r})),Ru=to((function(e,t){return null==e?{}:function(e,t){return Vn(e,t,(function(t,r){return wu(e,r)}))}(e,t)}));function ku(e,t){if(null==e)return{};var r=Lt(no(e),(function(e){return[e]}));return t=uo(t),Vn(e,r,(function(e,r){return t(e,r[0])}))}var Uu=Yi(Nu),Mu=Yi(Du);function Gu(e){return null==e?[]:Ht(e,Nu(e))}var Qu=Ri((function(e,t,r){return t=t.toLowerCase(),e+(r?Bu(t):t)}));function Bu(e){return Yu(gu(e).toLowerCase())}function qu(e){return(e=gu(e))&&e.replace(me,tr).replace(Ze,"")}var Fu=Ri((function(e,t,r){return e+(r?"-":"")+t.toLowerCase()})),Vu=Ri((function(e,t,r){return e+(r?" ":"")+t.toLowerCase()})),Ku=Ci("toLowerCase"),$u=Ri((function(e,t,r){return e+(r?"_":"")+t.toLowerCase()})),Wu=Ri((function(e,t,r){return e+(r?" ":"")+Yu(t)})),zu=Ri((function(e,t,r){return e+(r?" ":"")+t.toUpperCase()})),Yu=Ci("toUpperCase");function Ju(t,r,n){return t=gu(t),(r=n?e:r)===e?function(e){return rt.test(e)}(t)?function(e){return e.match(et)||[]}(t):function(e){return e.match(le)||[]}(t):t.match(r)||[]}var Hu=Yn((function(t,r){try{return St(t,e,r)}catch(e){return Ya(e)?e:new _e(e)}})),Zu=to((function(e,t){return wt(t,(function(t){t=ko(t),nn(e,t,xa(e[t],e))})),e}));function Xu(e){return function(){return e}}var el=Mi(),tl=Mi(!0);function rl(e){return e}function nl(e){return Cn("function"==typeof e?e:un(e,1))}var il=Yn((function(e,t){return function(r){return In(r,e,t)}})),ol=Yn((function(e,t){return function(r){return In(e,r,t)}}));function al(e,t,r){var n=Nu(t),i=jn(t,n);null!=r||Xa(t)&&(i.length||!n.length)||(r=t,t=e,e=this,i=jn(t,Nu(t)));var o=!(Xa(r)&&"chain"in r&&!r.chain),a=Ja(e);return wt(i,(function(r){var n=t[r];e[r]=n,a&&(e.prototype[r]=function(){var t=this.__chain__;if(o||t){var r=e(this.__wrapped__);return(r.__actions__=xi(this.__actions__)).push({func:n,args:arguments,thisArg:e}),r.__chain__=t,r}return n.apply(e,At([this.value()],arguments))})})),e}function ul(){}var ll=qi(Lt),cl=qi(xt),sl=qi(kt);function pl(e){return Oo(e)?Vt(ko(e)):function(e){return function(t){return _n(t,e)}}(e)}var fl=Vi(),hl=Vi(!0);function dl(){return[]}function yl(){return!1}var vl,gl=Bi((function(e,t){return e+t}),0),ml=Wi("ceil"),bl=Bi((function(e,t){return e/t}),1),Ol=Wi("floor"),jl=Bi((function(e,t){return e*t}),1),_l=Wi("round"),El=Bi((function(e,t){return e-t}),0);return Mr.after=function(e,r){if("function"!=typeof r)throw new xe(t);return e=hu(e),function(){if(--e<1)return r.apply(this,arguments)}},Mr.ary=wa,Mr.assign=mu,Mr.assignIn=bu,Mr.assignInWith=Ou,Mr.assignWith=ju,Mr.at=_u,Mr.before=Pa,Mr.bind=xa,Mr.bindAll=Zu,Mr.bindKey=Ia,Mr.castArray=function(){if(!arguments.length)return[];var e=arguments[0];return Fa(e)?e:[e]},Mr.chain=pa,Mr.chunk=function(t,r,n){r=(n?bo(t,r,n):r===e)?1:vr(hu(r),0);var i=null==t?0:t.length;if(!i||r<1)return[];for(var o=0,a=0,u=ie(ht(i/r));o<i;)u[a++]=ri(t,o,o+=r);return u},Mr.compact=function(e){for(var t=-1,r=null==e?0:e.length,n=0,i=[];++t<r;){var o=e[t];o&&(i[n++]=o)}return i},Mr.concat=function(){var e=arguments.length;if(!e)return[];for(var t=ie(e-1),r=arguments[0],n=e;n--;)t[n-1]=arguments[n];return At(Fa(r)?xi(r):[r],vn(t,1))},Mr.cond=function(e){var r=null==e?0:e.length,n=uo();return e=r?Lt(e,(function(e){if("function"!=typeof e[1])throw new xe(t);return[n(e[0]),e[1]]})):[],Yn((function(t){for(var n=-1;++n<r;){var i=e[n];if(St(i[0],this,t))return St(i[1],this,t)}}))},Mr.conforms=function(e){return function(e){var t=Nu(e);return function(r){return ln(r,e,t)}}(un(e,1))},Mr.constant=Xu,Mr.countBy=da,Mr.create=function(e,t){var r=Gr(e);return null==t?r:rn(r,t)},Mr.curry=function t(r,n,i){var o=Ji(r,8,e,e,e,e,e,n=i?e:n);return o.placeholder=t.placeholder,o},Mr.curryRight=function t(r,n,i){var o=Ji(r,16,e,e,e,e,e,n=i?e:n);return o.placeholder=t.placeholder,o},Mr.debounce=Na,Mr.defaults=Eu,Mr.defaultsDeep=Su,Mr.defer=Da,Mr.delay=La,Mr.difference=Go,Mr.differenceBy=Qo,Mr.differenceWith=Bo,Mr.drop=function(t,r,n){var i=null==t?0:t.length;return i?ri(t,(r=n||r===e?1:hu(r))<0?0:r,i):[]},Mr.dropRight=function(t,r,n){var i=null==t?0:t.length;return i?ri(t,0,(r=i-(r=n||r===e?1:hu(r)))<0?0:r):[]},Mr.dropRightWhile=function(e,t){return e&&e.length?fi(e,uo(t,3),!0,!0):[]},Mr.dropWhile=function(e,t){return e&&e.length?fi(e,uo(t,3),!0):[]},Mr.fill=function(t,r,n,i){var o=null==t?0:t.length;return o?(n&&"number"!=typeof n&&bo(t,r,n)&&(n=0,i=o),function(t,r,n,i){var o=t.length;for((n=hu(n))<0&&(n=-n>o?0:o+n),(i=i===e||i>o?o:hu(i))<0&&(i+=o),i=n>i?0:du(i);n<i;)t[n++]=r;return t}(t,r,n,i)):[]},Mr.filter=function(e,t){return(Fa(e)?It:yn)(e,uo(t,3))},Mr.flatMap=function(e,t){return vn(_a(e,t),1)},Mr.flatMapDeep=function(e,t){return vn(_a(e,t),u)},Mr.flatMapDepth=function(t,r,n){return n=n===e?1:hu(n),vn(_a(t,r),n)},Mr.flatten=Vo,Mr.flattenDeep=function(e){return null!=e&&e.length?vn(e,u):[]},Mr.flattenDepth=function(t,r){return null!=t&&t.length?vn(t,r=r===e?1:hu(r)):[]},Mr.flip=function(e){return Ji(e,512)},Mr.flow=el,Mr.flowRight=tl,Mr.fromPairs=function(e){for(var t=-1,r=null==e?0:e.length,n={};++t<r;){var i=e[t];n[i[0]]=i[1]}return n},Mr.functions=function(e){return null==e?[]:jn(e,Nu(e))},Mr.functionsIn=function(e){return null==e?[]:jn(e,Du(e))},Mr.groupBy=ba,Mr.initial=function(e){return null!=e&&e.length?ri(e,0,-1):[]},Mr.intersection=$o,Mr.intersectionBy=Wo,Mr.intersectionWith=zo,Mr.invert=Pu,Mr.invertBy=xu,Mr.invokeMap=Oa,Mr.iteratee=nl,Mr.keyBy=ja,Mr.keys=Nu,Mr.keysIn=Du,Mr.map=_a,Mr.mapKeys=function(e,t){var r={};return t=uo(t,3),bn(e,(function(e,n,i){nn(r,t(e,n,i),e)})),r},Mr.mapValues=function(e,t){var r={};return t=uo(t,3),bn(e,(function(e,n,i){nn(r,n,t(e,n,i))})),r},Mr.matches=function(e){return Gn(un(e,1))},Mr.matchesProperty=function(e,t){return Qn(e,un(t,1))},Mr.memoize=Aa,Mr.merge=Lu,Mr.mergeWith=Au,Mr.method=il,Mr.methodOf=ol,Mr.mixin=al,Mr.negate=Ca,Mr.nthArg=function(e){return e=hu(e),Yn((function(t){return qn(t,e)}))},Mr.omit=Cu,Mr.omitBy=function(e,t){return ku(e,Ca(uo(t)))},Mr.once=function(e){return Pa(2,e)},Mr.orderBy=function(t,r,n,i){return null==t?[]:(Fa(r)||(r=null==r?[]:[r]),Fa(n=i?e:n)||(n=null==n?[]:[n]),Fn(t,r,n))},Mr.over=ll,Mr.overArgs=Ra,Mr.overEvery=cl,Mr.overSome=sl,Mr.partial=ka,Mr.partialRight=Ua,Mr.partition=Ea,Mr.pick=Ru,Mr.pickBy=ku,Mr.property=pl,Mr.propertyOf=function(t){return function(r){return null==t?e:_n(t,r)}},Mr.pull=Jo,Mr.pullAll=Ho,Mr.pullAllBy=function(e,t,r){return e&&e.length&&t&&t.length?Kn(e,t,uo(r,2)):e},Mr.pullAllWith=function(t,r,n){return t&&t.length&&r&&r.length?Kn(t,r,e,n):t},Mr.pullAt=Zo,Mr.range=fl,Mr.rangeRight=hl,Mr.rearg=Ma,Mr.reject=function(e,t){return(Fa(e)?It:yn)(e,Ca(uo(t,3)))},Mr.remove=function(e,t){var r=[];if(!e||!e.length)return r;var n=-1,i=[],o=e.length;for(t=uo(t,3);++n<o;){var a=e[n];t(a,n,e)&&(r.push(a),i.push(n))}return $n(e,i),r},Mr.rest=function(r,n){if("function"!=typeof r)throw new xe(t);return Yn(r,n=n===e?n:hu(n))},Mr.reverse=Xo,Mr.sampleSize=function(t,r,n){return r=(n?bo(t,r,n):r===e)?1:hu(r),(Fa(t)?Jr:Hn)(t,r)},Mr.set=function(e,t,r){return null==e?e:Zn(e,t,r)},Mr.setWith=function(t,r,n,i){return i="function"==typeof i?i:e,null==t?t:Zn(t,r,n,i)},Mr.shuffle=function(e){return(Fa(e)?Hr:ti)(e)},Mr.slice=function(t,r,n){var i=null==t?0:t.length;return i?(n&&"number"!=typeof n&&bo(t,r,n)?(r=0,n=i):(r=null==r?0:hu(r),n=n===e?i:hu(n)),ri(t,r,n)):[]},Mr.sortBy=Sa,Mr.sortedUniq=function(e){return e&&e.length?ai(e):[]},Mr.sortedUniqBy=function(e,t){return e&&e.length?ai(e,uo(t,2)):[]},Mr.split=function(t,r,n){return n&&"number"!=typeof n&&bo(t,r,n)&&(r=n=e),(n=n===e?s:n>>>0)?(t=gu(t))&&("string"==typeof r||null!=r&&!iu(r))&&!(r=li(r))&&ir(t)?Oi(pr(t),0,n):t.split(r,n):[]},Mr.spread=function(e,r){if("function"!=typeof e)throw new xe(t);return r=null==r?0:vr(hu(r),0),Yn((function(t){var n=t[r],i=Oi(t,0,r);return n&&At(i,n),St(e,this,i)}))},Mr.tail=function(e){var t=null==e?0:e.length;return t?ri(e,1,t):[]},Mr.take=function(t,r,n){return t&&t.length?ri(t,0,(r=n||r===e?1:hu(r))<0?0:r):[]},Mr.takeRight=function(t,r,n){var i=null==t?0:t.length;return i?ri(t,(r=i-(r=n||r===e?1:hu(r)))<0?0:r,i):[]},Mr.takeRightWhile=function(e,t){return e&&e.length?fi(e,uo(t,3),!1,!0):[]},Mr.takeWhile=function(e,t){return e&&e.length?fi(e,uo(t,3)):[]},Mr.tap=function(e,t){return t(e),e},Mr.throttle=function(e,r,n){var i=!0,o=!0;if("function"!=typeof e)throw new xe(t);return Xa(n)&&(i="leading"in n?!!n.leading:i,o="trailing"in n?!!n.trailing:o),Na(e,r,{leading:i,maxWait:r,trailing:o})},Mr.thru=fa,Mr.toArray=pu,Mr.toPairs=Uu,Mr.toPairsIn=Mu,Mr.toPath=function(e){return Fa(e)?Lt(e,ko):uu(e)?[e]:xi(Ro(gu(e)))},Mr.toPlainObject=vu,Mr.transform=function(e,t,r){var n=Fa(e),i=n||Wa(e)||lu(e);if(t=uo(t,4),null==r){var o=e&&e.constructor;r=i?n?new o:[]:Xa(e)&&Ja(o)?Gr(Ke(e)):{}}return(i?wt:bn)(e,(function(e,n,i){return t(r,e,n,i)})),r},Mr.unary=function(e){return wa(e,1)},Mr.union=ea,Mr.unionBy=ta,Mr.unionWith=ra,Mr.uniq=function(e){return e&&e.length?ci(e):[]},Mr.uniqBy=function(e,t){return e&&e.length?ci(e,uo(t,2)):[]},Mr.uniqWith=function(t,r){return r="function"==typeof r?r:e,t&&t.length?ci(t,e,r):[]},Mr.unset=function(e,t){return null==e||si(e,t)},Mr.unzip=na,Mr.unzipWith=ia,Mr.update=function(e,t,r){return null==e?e:pi(e,t,gi(r))},Mr.updateWith=function(t,r,n,i){return i="function"==typeof i?i:e,null==t?t:pi(t,r,gi(n),i)},Mr.values=Gu,Mr.valuesIn=function(e){return null==e?[]:Ht(e,Du(e))},Mr.without=oa,Mr.words=Ju,Mr.wrap=function(e,t){return ka(gi(t),e)},Mr.xor=aa,Mr.xorBy=ua,Mr.xorWith=la,Mr.zip=ca,Mr.zipObject=function(e,t){return yi(e||[],t||[],Xr)},Mr.zipObjectDeep=function(e,t){return yi(e||[],t||[],Zn)},Mr.zipWith=sa,Mr.entries=Uu,Mr.entriesIn=Mu,Mr.extend=bu,Mr.extendWith=Ou,al(Mr,Mr),Mr.add=gl,Mr.attempt=Hu,Mr.camelCase=Qu,Mr.capitalize=Bu,Mr.ceil=ml,Mr.clamp=function(t,r,n){return n===e&&(n=r,r=e),n!==e&&(n=(n=yu(n))==n?n:0),r!==e&&(r=(r=yu(r))==r?r:0),an(yu(t),r,n)},Mr.clone=function(e){return un(e,4)},Mr.cloneDeep=function(e){return un(e,5)},Mr.cloneDeepWith=function(t,r){return un(t,5,r="function"==typeof r?r:e)},Mr.cloneWith=function(t,r){return un(t,4,r="function"==typeof r?r:e)},Mr.conformsTo=function(e,t){return null==t||ln(e,t,Nu(t))},Mr.deburr=qu,Mr.defaultTo=function(e,t){return null==e||e!=e?t:e},Mr.divide=bl,Mr.endsWith=function(t,r,n){t=gu(t),r=li(r);var i=t.length,o=n=n===e?i:an(hu(n),0,i);return(n-=r.length)>=0&&t.slice(n,o)==r},Mr.eq=Ga,Mr.escape=function(e){return(e=gu(e))&&z.test(e)?e.replace($,rr):e},Mr.escapeRegExp=function(e){return(e=gu(e))&&re.test(e)?e.replace(te,"\\$&"):e},Mr.every=function(t,r,n){var i=Fa(t)?xt:hn;return n&&bo(t,r,n)&&(r=e),i(t,uo(r,3))},Mr.find=ya,Mr.findIndex=qo,Mr.findKey=function(e,t){return Mt(e,uo(t,3),bn)},Mr.findLast=va,Mr.findLastIndex=Fo,Mr.findLastKey=function(e,t){return Mt(e,uo(t,3),On)},Mr.floor=Ol,Mr.forEach=ga,Mr.forEachRight=ma,Mr.forIn=function(e,t){return null==e?e:gn(e,uo(t,3),Du)},Mr.forInRight=function(e,t){return null==e?e:mn(e,uo(t,3),Du)},Mr.forOwn=function(e,t){return e&&bn(e,uo(t,3))},Mr.forOwnRight=function(e,t){return e&&On(e,uo(t,3))},Mr.get=Tu,Mr.gt=Qa,Mr.gte=Ba,Mr.has=function(e,t){return null!=e&&yo(e,t,wn)},Mr.hasIn=wu,Mr.head=Ko,Mr.identity=rl,Mr.includes=function(e,t,r,n){e=Ka(e)?e:Gu(e),r=r&&!n?hu(r):0;var i=e.length;return r<0&&(r=vr(i+r,0)),au(e)?r<=i&&e.indexOf(t,r)>-1:!!i&&Qt(e,t,r)>-1},Mr.indexOf=function(e,t,r){var n=null==e?0:e.length;if(!n)return-1;var i=null==r?0:hu(r);return i<0&&(i=vr(n+i,0)),Qt(e,t,i)},Mr.inRange=function(t,r,n){return r=fu(r),n===e?(n=r,r=0):n=fu(n),function(e,t,r){return e>=gr(t,r)&&e<vr(t,r)}(t=yu(t),r,n)},Mr.invoke=Iu,Mr.isArguments=qa,Mr.isArray=Fa,Mr.isArrayBuffer=Va,Mr.isArrayLike=Ka,Mr.isArrayLikeObject=$a,Mr.isBoolean=function(e){return!0===e||!1===e||eu(e)&&Sn(e)==d},Mr.isBuffer=Wa,Mr.isDate=za,Mr.isElement=function(e){return eu(e)&&1===e.nodeType&&!nu(e)},Mr.isEmpty=function(e){if(null==e)return!0;if(Ka(e)&&(Fa(e)||"string"==typeof e||"function"==typeof e.splice||Wa(e)||lu(e)||qa(e)))return!e.length;var t=ho(e);if(t==b||t==S)return!e.size;if(Eo(e))return!Rn(e).length;for(var r in e)if(Ce.call(e,r))return!1;return!0},Mr.isEqual=function(e,t){return Dn(e,t)},Mr.isEqualWith=function(t,r,n){var i=(n="function"==typeof n?n:e)?n(t,r):e;return i===e?Dn(t,r,e,n):!!i},Mr.isError=Ya,Mr.isFinite=function(e){return"number"==typeof e&&Ut(e)},Mr.isFunction=Ja,Mr.isInteger=Ha,Mr.isLength=Za,Mr.isMap=tu,Mr.isMatch=function(e,t){return e===t||Ln(e,t,co(t))},Mr.isMatchWith=function(t,r,n){return n="function"==typeof n?n:e,Ln(t,r,co(r),n)},Mr.isNaN=function(e){return ru(e)&&e!=+e},Mr.isNative=function(e){if(_o(e))throw new _e("Unsupported core-js use. Try https://npms.io/search?q=ponyfill.");return An(e)},Mr.isNil=function(e){return null==e},Mr.isNull=function(e){return null===e},Mr.isNumber=ru,Mr.isObject=Xa,Mr.isObjectLike=eu,Mr.isPlainObject=nu,Mr.isRegExp=iu,Mr.isSafeInteger=function(e){return Ha(e)&&e>=-9007199254740991&&e<=l},Mr.isSet=ou,Mr.isString=au,Mr.isSymbol=uu,Mr.isTypedArray=lu,Mr.isUndefined=function(t){return t===e},Mr.isWeakMap=function(e){return eu(e)&&ho(e)==x},Mr.isWeakSet=function(e){return eu(e)&&"[object WeakSet]"==Sn(e)},Mr.join=function(e,t){return null==e?"":Kt.call(e,t)},Mr.kebabCase=Fu,Mr.last=Yo,Mr.lastIndexOf=function(t,r,n){var i=null==t?0:t.length;if(!i)return-1;var o=i;return n!==e&&(o=(o=hu(n))<0?vr(i+o,0):gr(o,i-1)),r==r?function(e,t,r){for(var n=r+1;n--;)if(e[n]===t)return n;return n}(t,r,o):Gt(t,qt,o,!0)},Mr.lowerCase=Vu,Mr.lowerFirst=Ku,Mr.lt=cu,Mr.lte=su,Mr.max=function(t){return t&&t.length?dn(t,rl,Tn):e},Mr.maxBy=function(t,r){return t&&t.length?dn(t,uo(r,2),Tn):e},Mr.mean=function(e){return Ft(e,rl)},Mr.meanBy=function(e,t){return Ft(e,uo(t,2))},Mr.min=function(t){return t&&t.length?dn(t,rl,Un):e},Mr.minBy=function(t,r){return t&&t.length?dn(t,uo(r,2),Un):e},Mr.stubArray=dl,Mr.stubFalse=yl,Mr.stubObject=function(){return{}},Mr.stubString=function(){return""},Mr.stubTrue=function(){return!0},Mr.multiply=jl,Mr.nth=function(t,r){return t&&t.length?qn(t,hu(r)):e},Mr.noConflict=function(){return ft._===this&&(ft._=Ge),this},Mr.noop=ul,Mr.now=Ta,Mr.pad=function(e,t,r){e=gu(e);var n=(t=hu(t))?sr(e):0;if(!t||n>=t)return e;var i=(t-n)/2;return Fi(dt(i),r)+e+Fi(ht(i),r)},Mr.padEnd=function(e,t,r){e=gu(e);var n=(t=hu(t))?sr(e):0;return t&&n<t?e+Fi(t-n,r):e},Mr.padStart=function(e,t,r){e=gu(e);var n=(t=hu(t))?sr(e):0;return t&&n<t?Fi(t-n,r)+e:e},Mr.parseInt=function(e,t,r){return r||null==t?t=0:t&&(t=+t),br(gu(e).replace(ne,""),t||0)},Mr.random=function(t,r,n){if(n&&"boolean"!=typeof n&&bo(t,r,n)&&(r=n=e),n===e&&("boolean"==typeof r?(n=r,r=e):"boolean"==typeof t&&(n=t,t=e)),t===e&&r===e?(t=0,r=1):(t=fu(t),r===e?(r=t,t=0):r=fu(r)),t>r){var i=t;t=r,r=i}if(n||t%1||r%1){var o=Or();return gr(t+o*(r-t+lt("1e-"+((o+"").length-1))),r)}return Wn(t,r)},Mr.reduce=function(e,t,r){var n=Fa(e)?Ct:$t,i=arguments.length<3;return n(e,uo(t,4),r,i,pn)},Mr.reduceRight=function(e,t,r){var n=Fa(e)?Rt:$t,i=arguments.length<3;return n(e,uo(t,4),r,i,fn)},Mr.repeat=function(t,r,n){return r=(n?bo(t,r,n):r===e)?1:hu(r),zn(gu(t),r)},Mr.replace=function(){var e=arguments,t=gu(e[0]);return e.length<3?t:t.replace(e[1],e[2])},Mr.result=function(t,r,n){var i=-1,o=(r=mi(r,t)).length;for(o||(o=1,t=e);++i<o;){var a=null==t?e:t[ko(r[i])];a===e&&(i=o,a=n),t=Ja(a)?a.call(t):a}return t},Mr.round=_l,Mr.runInContext=P,Mr.sample=function(e){return(Fa(e)?Yr:Jn)(e)},Mr.size=function(e){if(null==e)return 0;if(Ka(e))return au(e)?sr(e):e.length;var t=ho(e);return t==b||t==S?e.size:Rn(e).length},Mr.snakeCase=$u,Mr.some=function(t,r,n){var i=Fa(t)?kt:ni;return n&&bo(t,r,n)&&(r=e),i(t,uo(r,3))},Mr.sortedIndex=function(e,t){return ii(e,t)},Mr.sortedIndexBy=function(e,t,r){return oi(e,t,uo(r,2))},Mr.sortedIndexOf=function(e,t){var r=null==e?0:e.length;if(r){var n=ii(e,t);if(n<r&&Ga(e[n],t))return n}return-1},Mr.sortedLastIndex=function(e,t){return ii(e,t,!0)},Mr.sortedLastIndexBy=function(e,t,r){return oi(e,t,uo(r,2),!0)},Mr.sortedLastIndexOf=function(e,t){if(null!=e&&e.length){var r=ii(e,t,!0)-1;if(Ga(e[r],t))return r}return-1},Mr.startCase=Wu,Mr.startsWith=function(e,t,r){return e=gu(e),r=null==r?0:an(hu(r),0,e.length),t=li(t),e.slice(r,r+t.length)==t},Mr.subtract=El,Mr.sum=function(e){return e&&e.length?Wt(e,rl):0},Mr.sumBy=function(e,t){return e&&e.length?Wt(e,uo(t,2)):0},Mr.template=function(t,r,n){var i=Mr.templateSettings;n&&bo(t,r,n)&&(r=e),t=gu(t),r=Ou({},r,i,Hi);var o,a,u=Ou({},r.imports,i.imports,Hi),l=Nu(u),c=Ht(u,l),s=0,p=r.interpolate||be,f="__p += '",h=we((r.escape||be).source+"|"+p.source+"|"+(p===H?pe:be).source+"|"+(r.evaluate||be).source+"|$","g"),d="//# sourceURL="+(Ce.call(r,"sourceURL")?(r.sourceURL+"").replace(/\s/g," "):"lodash.templateSources["+ ++it+"]")+"\n";t.replace(h,(function(e,r,n,i,u,l){return n||(n=i),f+=t.slice(s,l).replace(Oe,nr),r&&(o=!0,f+="' +\n__e("+r+") +\n'"),u&&(a=!0,f+="';\n"+u+";\n__p += '"),n&&(f+="' +\n((__t = ("+n+")) == null ? '' : __t) +\n'"),s=l+e.length,e})),f+="';\n";var y=Ce.call(r,"variable")&&r.variable;if(y){if(ce.test(y))throw new _e("Invalid `variable` option passed into `_.template`")}else f="with (obj) {\n"+f+"\n}\n";f=(a?f.replace(q,""):f).replace(F,"$1").replace(V,"$1;"),f="function("+(y||"obj")+") {\n"+(y?"":"obj || (obj = {});\n")+"var __t, __p = ''"+(o?", __e = _.escape":"")+(a?", __j = Array.prototype.join;\nfunction print() { __p += __j.call(arguments, '') }\n":";\n")+f+"return __p\n}";var v=Hu((function(){return Ee(l,d+"return "+f).apply(e,c)}));if(v.source=f,Ya(v))throw v;return v},Mr.times=function(e,t){if((e=hu(e))<1||e>l)return[];var r=s,n=gr(e,s);t=uo(t),e-=s;for(var i=zt(n,t);++r<e;)t(r);return i},Mr.toFinite=fu,Mr.toInteger=hu,Mr.toLength=du,Mr.toLower=function(e){return gu(e).toLowerCase()},Mr.toNumber=yu,Mr.toSafeInteger=function(e){return e?an(hu(e),-9007199254740991,l):0===e?e:0},Mr.toString=gu,Mr.toUpper=function(e){return gu(e).toUpperCase()},Mr.trim=function(t,r,n){if((t=gu(t))&&(n||r===e))return Yt(t);if(!t||!(r=li(r)))return t;var i=pr(t),o=pr(r);return Oi(i,Xt(i,o),er(i,o)+1).join("")},Mr.trimEnd=function(t,r,n){if((t=gu(t))&&(n||r===e))return t.slice(0,fr(t)+1);if(!t||!(r=li(r)))return t;var i=pr(t);return Oi(i,0,er(i,pr(r))+1).join("")},Mr.trimStart=function(t,r,n){if((t=gu(t))&&(n||r===e))return t.replace(ne,"");if(!t||!(r=li(r)))return t;var i=pr(t);return Oi(i,Xt(i,pr(r))).join("")},Mr.truncate=function(t,r){var n=30,i="...";if(Xa(r)){var o="separator"in r?r.separator:o;n="length"in r?hu(r.length):n,i="omission"in r?li(r.omission):i}var a=(t=gu(t)).length;if(ir(t)){var u=pr(t);a=u.length}if(n>=a)return t;var l=n-sr(i);if(l<1)return i;var c=u?Oi(u,0,l).join(""):t.slice(0,l);if(o===e)return c+i;if(u&&(l+=c.length-l),iu(o)){if(t.slice(l).search(o)){var s,p=c;for(o.global||(o=we(o.source,gu(fe.exec(o))+"g")),o.lastIndex=0;s=o.exec(p);)var f=s.index;c=c.slice(0,f===e?l:f)}}else if(t.indexOf(li(o),l)!=l){var h=c.lastIndexOf(o);h>-1&&(c=c.slice(0,h))}return c+i},Mr.unescape=function(e){return(e=gu(e))&&W.test(e)?e.replace(K,hr):e},Mr.uniqueId=function(e){var t=++Re;return gu(e)+t},Mr.upperCase=zu,Mr.upperFirst=Yu,Mr.each=ga,Mr.eachRight=ma,Mr.first=Ko,al(Mr,(vl={},bn(Mr,(function(e,t){Ce.call(Mr.prototype,t)||(vl[t]=e)})),vl),{chain:!1}),Mr.VERSION="4.17.21",wt(["bind","bindKey","curry","curryRight","partial","partialRight"],(function(e){Mr[e].placeholder=Mr})),wt(["drop","take"],(function(t,r){qr.prototype[t]=function(n){n=n===e?1:vr(hu(n),0);var i=this.__filtered__&&!r?new qr(this):this.clone();return i.__filtered__?i.__takeCount__=gr(n,i.__takeCount__):i.__views__.push({size:gr(n,s),type:t+(i.__dir__<0?"Right":"")}),i},qr.prototype[t+"Right"]=function(e){return this.reverse()[t](e).reverse()}})),wt(["filter","map","takeWhile"],(function(e,t){var r=t+1,n=1==r||3==r;qr.prototype[e]=function(e){var t=this.clone();return t.__iteratees__.push({iteratee:uo(e,3),type:r}),t.__filtered__=t.__filtered__||n,t}})),wt(["head","last"],(function(e,t){var r="take"+(t?"Right":"");qr.prototype[e]=function(){return this[r](1).value()[0]}})),wt(["initial","tail"],(function(e,t){var r="drop"+(t?"":"Right");qr.prototype[e]=function(){return this.__filtered__?new qr(this):this[r](1)}})),qr.prototype.compact=function(){return this.filter(rl)},qr.prototype.find=function(e){return this.filter(e).head()},qr.prototype.findLast=function(e){return this.reverse().find(e)},qr.prototype.invokeMap=Yn((function(e,t){return"function"==typeof e?new qr(this):this.map((function(r){return In(r,e,t)}))})),qr.prototype.reject=function(e){return this.filter(Ca(uo(e)))},qr.prototype.slice=function(t,r){t=hu(t);var n=this;return n.__filtered__&&(t>0||r<0)?new qr(n):(t<0?n=n.takeRight(-t):t&&(n=n.drop(t)),r!==e&&(n=(r=hu(r))<0?n.dropRight(-r):n.take(r-t)),n)},qr.prototype.takeRightWhile=function(e){return this.reverse().takeWhile(e).reverse()},qr.prototype.toArray=function(){return this.take(s)},bn(qr.prototype,(function(t,r){var n=/^(?:filter|find|map|reject)|While$/.test(r),i=/^(?:head|last)$/.test(r),o=Mr[i?"take"+("last"==r?"Right":""):r],a=i||/^find/.test(r);o&&(Mr.prototype[r]=function(){var r=this.__wrapped__,u=i?[1]:arguments,l=r instanceof qr,c=u[0],s=l||Fa(r),p=function(e){var t=o.apply(Mr,At([e],u));return i&&f?t[0]:t};s&&n&&"function"==typeof c&&1!=c.length&&(l=s=!1);var f=this.__chain__,h=!!this.__actions__.length,d=a&&!f,y=l&&!h;if(!a&&s){r=y?r:new qr(this);var v=t.apply(r,u);return v.__actions__.push({func:fa,args:[p],thisArg:e}),new Br(v,f)}return d&&y?t.apply(this,u):(v=this.thru(p),d?i?v.value()[0]:v.value():v)})})),wt(["pop","push","shift","sort","splice","unshift"],(function(e){var t=Ie[e],r=/^(?:push|sort|unshift)$/.test(e)?"tap":"thru",n=/^(?:pop|shift)$/.test(e);Mr.prototype[e]=function(){var e=arguments;if(n&&!this.__chain__){var i=this.value();return t.apply(Fa(i)?i:[],e)}return this[r]((function(r){return t.apply(Fa(r)?r:[],e)}))}})),bn(qr.prototype,(function(e,t){var r=Mr[t];if(r){var n=r.name+"";Ce.call(Ir,n)||(Ir[n]=[]),Ir[n].push({name:t,func:r})}})),Ir[Gi(e,2).name]=[{name:"wrapper",func:e}],qr.prototype.clone=function(){var e=new qr(this.__wrapped__);return e.__actions__=xi(this.__actions__),e.__dir__=this.__dir__,e.__filtered__=this.__filtered__,e.__iteratees__=xi(this.__iteratees__),e.__takeCount__=this.__takeCount__,e.__views__=xi(this.__views__),e},qr.prototype.reverse=function(){if(this.__filtered__){var e=new qr(this);e.__dir__=-1,e.__filtered__=!0}else(e=this.clone()).__dir__*=-1;return e},qr.prototype.value=function(){var e=this.__wrapped__.value(),t=this.__dir__,r=Fa(e),n=t<0,i=r?e.length:0,o=function(e,t,r){for(var n=-1,i=r.length;++n<i;){var o=r[n],a=o.size;switch(o.type){case"drop":e+=a;break;case"dropRight":t-=a;break;case"take":t=gr(t,e+a);break;case"takeRight":e=vr(e,t-a)}}return{start:e,end:t}}(0,i,this.__views__),a=o.start,u=o.end,l=u-a,c=n?u:a-1,s=this.__iteratees__,p=s.length,f=0,h=gr(l,this.__takeCount__);if(!r||!n&&i==l&&h==l)return hi(e,this.__actions__);var d=[];e:for(;l--&&f<h;){for(var y=-1,v=e[c+=t];++y<p;){var g=s[y],m=g.iteratee,b=g.type,O=m(v);if(2==b)v=O;else if(!O){if(1==b)continue e;break e}}d[f++]=v}return d},Mr.prototype.at=ha,Mr.prototype.chain=function(){return pa(this)},Mr.prototype.commit=function(){return new Br(this.value(),this.__chain__)},Mr.prototype.next=function(){this.__values__===e&&(this.__values__=pu(this.value()));var t=this.__index__>=this.__values__.length;return{done:t,value:t?e:this.__values__[this.__index__++]}},Mr.prototype.plant=function(t){for(var r,n=this;n instanceof Qr;){var i=Mo(n);i.__index__=0,i.__values__=e,r?o.__wrapped__=i:r=i;var o=i;n=n.__wrapped__}return o.__wrapped__=t,r},Mr.prototype.reverse=function(){var t=this.__wrapped__;if(t instanceof qr){var r=t;return this.__actions__.length&&(r=new qr(this)),(r=r.reverse()).__actions__.push({func:fa,args:[Xo],thisArg:e}),new Br(r,this.__chain__)}return this.thru(Xo)},Mr.prototype.toJSON=Mr.prototype.valueOf=Mr.prototype.value=function(){return hi(this.__wrapped__,this.__actions__)},Mr.prototype.first=Mr.prototype.head,Je&&(Mr.prototype[Je]=function(){return this}),Mr}();dt?((dt.exports=dr)._=dr,ht._=dr):ft._=dr}.call(x.exports)),x.exports);const L="Configuration help box",A="Configuration drop zone",C="Configuration text area",R="Paste JWT button",k="Upload JWT button",U="JWT form",M="JWT button",G="GCE button",Q="Private Key Path Input",B="Private Key Input",q="Fill JWT info manually",F="Show private key path input",V="Show private key input",K=["private_key","token_uri","client_email","project_id"],$=({onChange:e,showConfigEditor:t,showPaste:r,showUpload:n,isPasting:i,isUploading:o})=>{const[a,u]=(0,O.useState)(),l=(0,_.useTheme2)(),c=(0,O.useCallback)((e=>{u(null),r()}),[r]),s=(0,O.useCallback)((e=>{n(),u(null)}),[n]),p=(0,O.useCallback)((r=>{if(""!==r.trim()){let n;try{n=JSON.parse(r)}catch(e){u("Invalid JWT token")}const i=W(n);i.isValid?(t(),e({privateKey:n.private_key,tokenUri:n.token_uri,clientEmail:n.client_email,projectId:n.project_id})):u(i.error)}}),[u,e,t]);return O.createElement(O.Fragment,null,O.createElement(_.Field,{label:"JWT token",invalid:Boolean(a),description:i?"Paste JWT token below":"Upload or paste Google JWT token",error:a},O.createElement(O.Fragment,null,o&&O.createElement("div",{"data-testid":A},_.FileDropzone&&O.createElement(_.FileDropzone,{options:{multiple:!1,accept:".json"},readAs:"readAsText",onLoad:e=>{p(e)}},O.createElement("p",{style:{margin:0,fontSize:`${l.typography.h4.fontSize}`,textAlign:"center"}},"Drop the Google JWT file here",O.createElement("br",null),O.createElement("br",null),O.createElement(_.Button,{fill:"outline"},"Click to browse files")))),i&&O.createElement(_.TextArea,{"data-testid":C,autoFocus:!0,invalid:Boolean(a),placeholder:"Paste Google JWT token here",onBlur:e=>p(e.currentTarget.value),rows:12}))),!i&&O.createElement(O.Fragment,null,O.createElement(_.Button,{"data-testid":R,type:"button",fill:"outline",style:{color:`${l.colors.primary.text}`},onClick:c},"Paste JWT Token"),O.createElement("span",{style:{paddingRight:"10px",paddingLeft:"10px"}},"or")),i&&O.createElement(O.Fragment,null,O.createElement(_.Button,{"data-testid":k,type:"button",fill:"outline",style:{color:`${l.colors.primary.text}`},onClick:()=>{n()}},"Upload JWT Token"),O.createElement("span",{style:{paddingRight:"10px",paddingLeft:"10px"}},"or")),O.createElement(_.Button,{"data-testid":q,type:"button",fill:"outline",style:{color:`${l.colors.primary.text}`},onClick:t},"Fill In JWT Token manually"),i&&a&&O.createElement(_.Field,null,O.createElement(_.Button,{type:"button",fill:"outline",style:{color:`${l.colors.primary.text}`},onClick:s},"Upload JWT Token")))},W=e=>{if(!D.isObject(e))return{isValid:!1,error:"Invalid JWT token"};const t=K.filter((t=>!e[t]));return t.length>0?{isValid:!1,error:`Missing keys: ${t.join(", ")}`}:{isValid:!0}},{SecretFormField:z}=_.LegacyForms,Y=({options:e,onReset:t,onOptionsChange:r,showPaste:n,showUpload:i})=>{var o;const[a,u]=O.useState((e=>"privateKeyPath"in e&&""!==e.privateKeyPath?"path":"jwt")(e.jsonData)),l=t=>(0,v.onUpdateDatasourceJsonDataOption)({options:e,onOptionsChange:r},t),c=()=>{u("jwt"===a?"path":"jwt")},s=(0,_.useTheme2)(),p=O.createElement("span",null,"path"===a?O.createElement("a",{className:"external-link",onClick:c,"data-testid":V},"Paste private key"):"Paste private key"," ","or  ","jwt"===a?O.createElement("a",{className:"external-link",onClick:c,"data-testid":F},"provide path to private file"):"provide path to private key file"),f={isConfigured:Boolean(e.secureJsonFields.privateKey),value:(null==(o=e.secureJsonData)?void 0:o.privateKey)||"",placeholder:"Enter Private key",onReset:()=>t(),onChange:(0,v.onUpdateDatasourceSecureJsonDataOption)({options:e,onOptionsChange:r},"privateKey"),"data-testid":B};return O.createElement("div",{"data-testid":U},O.createElement(_.Field,{label:"Project ID"},O.createElement(_.Input,{id:"defaultProject",width:60,value:e.jsonData.defaultProject||"",onChange:l("defaultProject")})),O.createElement(_.Field,{label:"Client email"},O.createElement(_.Input,{width:60,id:"clientEmail",value:e.jsonData.clientEmail||"",onChange:l("clientEmail")})),O.createElement(_.Field,{label:"Token URI"},O.createElement(_.Input,{width:60,id:"tokenUri",value:e.jsonData.tokenUri||"",onChange:l("tokenUri")})),"path"===a&&O.createElement(_.Field,{label:"Private key path",description:p},O.createElement(_.Input,{width:60,id:"privateKeyPath",value:e.jsonData.privateKeyPath||"",placeholder:"File location of your private key (e.g. /etc/secrets/gce.pem)",onChange:l("privateKeyPath"),"data-testid":Q})),"jwt"===a&&O.createElement(O.Fragment,null,_.SecretInput?O.createElement(_.Field,{label:"Private key",description:p},O.createElement(_.SecretInput,{...f,width:60})):O.createElement(z,{...f,label:"Private key",labelWidth:10,inputWidth:20})),O.createElement(O.Fragment,null,O.createElement(_.Button,{"data-testid":R,type:"button",fill:"outline",style:{color:`${s.colors.primary.text}`},onClick:n},"Paste JWT Token"),O.createElement("span",{style:{paddingRight:"10px",paddingLeft:"10px"}},"or"),O.createElement(_.Button,{"data-testid":k,type:"button",fill:"outline",style:{color:`${s.colors.primary.text}`},onClick:i},"Upload JWT Token")))};function J(e){const{options:t,onOptionsChange:r,authOptions:n,showServiceAccountImpersonationConfig:i}=e,{jsonData:o,secureJsonFields:a,secureJsonData:u}=T(t),l=()=>Boolean(o.clientEmail&&o.defaultProject&&o.tokenUri&&(a&&a.privateKey||o.privateKeyPath)),[c,s]=(0,O.useState)(H(o.authenticationType)),[p,f]=(0,O.useState)(l()),[h,d]=(0,O.useState)(!1),[y,g]=(0,O.useState)(!0),m=()=>{d(!1),g(!0),f(!1)},b=()=>{d(!0),g(!1),f(!1)};return O.createElement(O.Fragment,null,O.createElement(_.FieldSet,{label:"Authentication"},O.createElement(_.Field,{label:"Authentication type"},O.createElement(_.RadioButtonGroup,{options:n,value:o.authenticationType||E,onChange:e=>{f(l()),r({...t,jsonData:{...t.jsonData,authenticationType:e}}),s(H(e))}}))),c&&O.createElement(_.FieldSet,{label:"JWT Key Details"},p?O.createElement(Y,{options:t,onReset:()=>(()=>{const e={...u},n={...t.jsonData};delete n.clientEmail,delete n.defaultProject,delete n.tokenUri,delete n.privateKeyPath,delete e.privateKey,s(!0),f(!1),r({...t,secureJsonFields:{...t.secureJsonFields,privateKey:!1},secureJsonData:e,jsonData:n})})(),onOptionsChange:r,showUpload:m,showPaste:b}):O.createElement($,{showConfigEditor:()=>{f(!0)},showUpload:m,showPaste:b,isPasting:h,isUploading:y,onChange:e=>{r({...t,secureJsonFields:{...a,privateKey:!0},secureJsonData:{...u,privateKey:e.privateKey},jsonData:{...o,clientEmail:e.clientEmail,defaultProject:e.projectId,tokenUri:e.tokenUri}})}})," "),o.authenticationType===S&&O.createElement(_.Field,{label:"Default project"},O.createElement(_.Input,{id:"defaultProject",width:60,value:t.jsonData.defaultProject||"",onChange:(0,v.onUpdateDatasourceJsonDataOption)(e,"defaultProject")})),i&&O.createElement(_.FieldSet,{label:"Service account impersonation"},O.createElement(_.Field,{label:"Enable",htmlFor:"usingImpersonation",description:O.createElement("span",null,"Read more about service account impersonation"," ",O.createElement("a",{href:"https://cloud.google.com/iam/docs/service-account-impersonation",rel:"noreferrer",className:"external-link",target:"_blank"},"here"))},O.createElement(_.Switch,{value:t.jsonData.usingImpersonation||!1,onChange:(0,v.onUpdateDatasourceJsonDataOptionChecked)(e,"usingImpersonation"),id:"usingImpersonation"})),t.jsonData.usingImpersonation&&O.createElement(_.Field,{label:"Service account to impersonate",htmlFor:"serviceAccountToImpersonate"},O.createElement(_.Input,{id:"serviceAccountToImpersonate",width:60,value:t.jsonData.serviceAccountToImpersonate||"",onChange:(0,v.onUpdateDatasourceJsonDataOption)(e,"serviceAccountToImpersonate")}))))}const H=e=>e===E||void 0===e,Z=[{label:"Google JWT File",value:E,ariaLabel:M},{label:"GCE Default Service Account",value:S,ariaLabel:G}],X=e=>{const t=T(e.options),r=t.jsonData.authenticationType===E||void 0===t.jsonData.authenticationType;return O.createElement(O.Fragment,null,O.createElement(J,{authOptions:Z,onOptionsChange:e.onOptionsChange,showServiceAccountImpersonationConfig:!0,options:t}),O.createElement("div",{className:"grafana-info-box",style:{marginTop:"16px"},"data-testid":L},O.createElement("p",null,"Don’t know how to get a service account key file or create a service account? Read more"," ",O.createElement("a",{className:"external-link",target:"_blank",rel:"noopener noreferrer",href:"https://grafana.com/docs/grafana/latest/datasources/google-cloud-monitoring/google-authentication/"},"in the documentation."))),!r&&O.createElement(_.Alert,{title:"",severity:"info"},"Verify GCE default service account by clicking Save & Test"))},ee=({dataSourceName:e,docsLink:t,hasRequiredFields:r=!0,className:n})=>{const i=(0,_.useTheme2)(),o={container:(0,b.css)({p:{margin:0},"p + p":{marginTop:i.spacing(2)}}),text:(0,b.css)({...i.typography.body,color:i.colors.text.secondary,a:(0,b.css)({color:i.colors.text.link,textDecoration:"underline","&:hover":{textDecoration:"none"}})})};return O.createElement("div",{className:(0,b.cx)(o.container,n)},O.createElement("p",{className:o.text},"Before you can use the ",e," data source, you must configure it below or in the config file. For detailed instructions,"," ",O.createElement("a",{href:t,target:"_blank",rel:"noreferrer"},"view the documentation"),"."),r&&O.createElement("p",{className:o.text},O.createElement("i",null,"Fields marked with * are required")))},te=({children:e,title:t,description:r,isCollapsible:n=!1,isInitiallyOpen:i=!0,kind:o="section",className:a})=>{const{colors:u,typography:l,spacing:c}=(0,_.useTheme2)(),[s,p]=(0,O.useState)(!n||i),f=s?"angle-up":"angle-down",h="sub-section"===o,d=`${s?"Collapse":"Expand"} section ${t}`,y={header:(0,b.css)({display:"flex",justifyContent:"space-between",alignItems:"center"}),title:(0,b.css)({margin:0}),subtitle:(0,b.css)({margin:0,fontWeight:l.fontWeightRegular}),descriptionText:(0,b.css)({marginTop:c(h?.25:.5),marginBottom:0,...l.bodySmall,color:u.text.secondary}),content:(0,b.css)({marginTop:c(2)})};return O.createElement("div",{className:a},O.createElement("div",{className:y.header},"section"===o?O.createElement("h3",{className:y.title},t):O.createElement("h6",{className:y.subtitle},t),n&&O.createElement(_.IconButton,{name:f,onClick:()=>p(!s),type:"button",size:"xl","aria-label":d})),r&&O.createElement("p",{className:y.descriptionText},r),s&&O.createElement("div",{className:y.content},e))},re=({children:e,...t})=>O.createElement(te,{...t,kind:"section"},e);function ne(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function ie(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){ne(e,t,r[t])}))}return e}function oe(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})),e}class ae extends O.PureComponent{render(){const{options:e,onOptionsChange:t}=this.props;return(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)(ee,{dataSourceName:"Google Cloud Monitoring",docsLink:"https://grafana.com/docs/grafana/latest/datasources/google-cloud-monitoring/",hasRequiredFields:!0}),(0,m.jsx)(_.Divider,{}),(0,m.jsx)(X,oe(ie({},this.props),{onOptionsChange:this.handleOnOptionsChange})),g.config.secureSocksDSProxyEnabled&&(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)(_.Divider,{}),(0,m.jsx)(re,{title:"Additional settings",description:"Additional settings are optional settings that can be configured for more control over your data source. This includes Secure Socks Proxy.",isCollapsible:!0,isInitiallyOpen:void 0!==e.jsonData.enableSecureSocksProxy,children:(0,m.jsx)(_.SecureSocksProxySettings,{options:e,onOptionsChange:t})})]})]})}constructor(...e){super(...e),ne(this,"handleOnOptionsChange",(e=>{(e.jsonData.privateKeyPath||e.secureJsonFields.privateKey)&&(0,g.reportInteraction)("grafana_cloud_monitoring_config_changed",{authenticationType:"JWT",privateKey:e.secureJsonFields.privateKey,privateKeyPath:!!e.jsonData.privateKeyPath}),this.props.onOptionsChange(e)}))}}var ue=p(513),le=p.n(ue);const ce=({children:e,wrap:t=!0,...r})=>{var n,i;return O.createElement(_.Stack,{wrap:t?"wrap":void 0,direction:null!=(n=r.direction)?n:"row",gap:null!=(i=r.gap)?i:2,...r},e)},se=({children:e})=>O.createElement(ce,{gap:.5,direction:"column"},e),pe={queryEditor:{container:"data-testid cloud-monitoring-query-editor",header:{select:"data-testid cloud-monitoring-header"},visualMetricsQueryEditor:{container:{input:"data-testid cloud-monitoring-visual-metrics-query-editor"}},mqlMetricsQueryEditor:{container:{input:"data-testid cloud-monitoring-mql-query-editor"}},sloQueryEditor:{container:{input:"data-testid cloud-monitoring-slo-query-editor"}},promQlQueryEditor:{container:{input:"data-testid cloud-monitoring-prom-ql-query-editor"}}}};var fe=function(e){return e.ANNOTATION="annotation",e.PROMQL="promQL",e.SLO="slo",e.TIME_SERIES_LIST="timeSeriesList",e.TIME_SERIES_QUERY="timeSeriesQuery",e}({});var he=function(e){return e.Delta="delta",e.None="none",e.Rate="rate",e}({});var de=function(e){return e.CUMULATIVE="CUMULATIVE",e.DELTA="DELTA",e.GAUGE="GAUGE",e.METRIC_KIND_UNSPECIFIED="METRIC_KIND_UNSPECIFIED",e}({}),ye=function(e){return e.BOOL="BOOL",e.DISTRIBUTION="DISTRIBUTION",e.DOUBLE="DOUBLE",e.INT64="INT64",e.MONEY="MONEY",e.STRING="STRING",e.VALUE_TYPE_UNSPECIFIED="VALUE_TYPE_UNSPECIFIED",e}({}),ve=function(e){return e.ALIGN_COUNT="ALIGN_COUNT",e.ALIGN_COUNT_FALSE="ALIGN_COUNT_FALSE",e.ALIGN_COUNT_TRUE="ALIGN_COUNT_TRUE",e.ALIGN_DELTA="ALIGN_DELTA",e.ALIGN_FRACTION_TRUE="ALIGN_FRACTION_TRUE",e.ALIGN_INTERPOLATE="ALIGN_INTERPOLATE",e.ALIGN_MAX="ALIGN_MAX",e.ALIGN_MEAN="ALIGN_MEAN",e.ALIGN_MIN="ALIGN_MIN",e.ALIGN_NEXT_OLDER="ALIGN_NEXT_OLDER",e.ALIGN_NONE="ALIGN_NONE",e.ALIGN_PERCENTILE_05="ALIGN_PERCENTILE_05",e.ALIGN_PERCENTILE_50="ALIGN_PERCENTILE_50",e.ALIGN_PERCENTILE_95="ALIGN_PERCENTILE_95",e.ALIGN_PERCENTILE_99="ALIGN_PERCENTILE_99",e.ALIGN_PERCENT_CHANGE="ALIGN_PERCENT_CHANGE",e.ALIGN_RATE="ALIGN_RATE",e.ALIGN_STDDEV="ALIGN_STDDEV",e.ALIGN_SUM="ALIGN_SUM",e}({});var ge=function(e){return e.Aggregations="aggregations",e.Aligners="aligners",e.AlignmentPeriods="alignmentPeriods",e.DefaultProject="defaultProject",e.LabelKeys="labelKeys",e.LabelValues="labelValues",e.MetricTypes="metricTypes",e.Projects="projects",e.ResourceTypes="resourceTypes",e.SLO="slo",e.SLOServices="sloServices",e.Selectors="selectors",e.Services="services",e}({});const me=e=>{var t;const{label:r,optional:n,tooltip:i,tooltipInteractive:o,children:a,width:u,...l}=e,c=(0,_.useStyles2)(be,u),s=(null==l?void 0:l.htmlFor)||(null==(t=_.ReactUtils)?void 0:t.getChildId(a)),p=O.createElement(O.Fragment,null,O.createElement("label",{className:c.label,htmlFor:s},r,n&&O.createElement("span",{className:c.optional}," - optional"),i&&O.createElement(_.Tooltip,{placement:"top",content:i,theme:"info",interactive:o},O.createElement(_.Icon,{tabIndex:0,name:"info-circle",size:"sm",className:c.icon}))),O.createElement(_.Space,{v:.5}));return O.createElement("div",{className:c.root},O.createElement(_.Field,{className:c.field,label:p,...l},a))},be=(e,t)=>({root:(0,b.css)({minWidth:e.spacing(null!=t?t:0)}),label:(0,b.css)({fontSize:12,fontWeight:e.typography.fontWeightMedium}),optional:(0,b.css)({fontStyle:"italic",color:e.colors.text.secondary}),field:(0,b.css)({marginBottom:0}),icon:(0,b.css)({color:e.colors.text.secondary,marginLeft:e.spacing(1),":hover":{color:e.colors.text.primary}})}),Oe=({refId:e,value:t="",onChange:r})=>{const[n,i]=(0,O.useState)(null!=t?t:""),o=(0,y.debounce)(r,1e3);return(0,m.jsx)(me,{label:"Alias by",children:(0,m.jsx)(_.Input,{id:`${e}-alias-by`,value:n,onChange:e=>{i(e.currentTarget.value),o(e.currentTarget.value)}})})},je=({children:e})=>{const t=(0,_.useStyles2)(_e);return O.createElement("div",{className:t.root},O.createElement(ce,{gap:2},e))},_e=e=>({root:(0,b.css)({padding:e.spacing(1),backgroundColor:e.colors.background.secondary,borderRadius:e.shape.radius.default})}),Ee=[{text:"none",value:"ALIGN_NONE",valueTypes:[ye.INT64,ye.DOUBLE,ye.MONEY,ye.DISTRIBUTION,ye.STRING,ye.VALUE_TYPE_UNSPECIFIED,ye.BOOL],metricKinds:[de.GAUGE]},{text:"delta",value:"ALIGN_DELTA",valueTypes:[ye.INT64,ye.DOUBLE,ye.MONEY,ye.DISTRIBUTION],metricKinds:[de.CUMULATIVE,de.DELTA]},{text:"rate",value:"ALIGN_RATE",valueTypes:[ye.INT64,ye.DOUBLE,ye.MONEY],metricKinds:[de.CUMULATIVE,de.DELTA]},{text:"interpolate",value:"ALIGN_INTERPOLATE",valueTypes:[ye.INT64,ye.DOUBLE,ye.MONEY],metricKinds:[de.GAUGE]},{text:"next older",value:"ALIGN_NEXT_OLDER",valueTypes:[ye.INT64,ye.DOUBLE,ye.MONEY,ye.DISTRIBUTION,ye.STRING,ye.VALUE_TYPE_UNSPECIFIED,ye.BOOL],metricKinds:[de.GAUGE]},{text:"min",value:"ALIGN_MIN",valueTypes:[ye.INT64,ye.DOUBLE,ye.MONEY],metricKinds:[de.GAUGE,de.DELTA]},{text:"max",value:"ALIGN_MAX",valueTypes:[ye.INT64,ye.DOUBLE,ye.MONEY],metricKinds:[de.GAUGE,de.DELTA]},{text:"mean",value:"ALIGN_MEAN",valueTypes:[ye.INT64,ye.DOUBLE,ye.MONEY],metricKinds:[de.GAUGE,de.DELTA]},{text:"count",value:"ALIGN_COUNT",valueTypes:[ye.INT64,ye.DOUBLE,ye.MONEY,ye.BOOL],metricKinds:[de.GAUGE,de.DELTA]},{text:"sum",value:"ALIGN_SUM",valueTypes:[ye.INT64,ye.DOUBLE,ye.MONEY,ye.DISTRIBUTION],metricKinds:[de.GAUGE,de.DELTA]},{text:"stddev",value:"ALIGN_STDDEV",valueTypes:[ye.INT64,ye.DOUBLE,ye.MONEY],metricKinds:[de.GAUGE,de.DELTA]},{text:"count true",value:"ALIGN_COUNT_TRUE",valueTypes:[ye.BOOL],metricKinds:[de.GAUGE]},{text:"count false",value:"ALIGN_COUNT_FALSE",valueTypes:[ye.BOOL],metricKinds:[de.GAUGE]},{text:"fraction true",value:"ALIGN_FRACTION_TRUE",valueTypes:[ye.BOOL],metricKinds:[de.GAUGE]},{text:"percentile 99",value:"ALIGN_PERCENTILE_99",valueTypes:[ye.DISTRIBUTION],metricKinds:[de.GAUGE,de.DELTA]},{text:"percentile 95",value:"ALIGN_PERCENTILE_95",valueTypes:[ye.DISTRIBUTION],metricKinds:[de.GAUGE,de.DELTA]},{text:"percentile 50",value:"ALIGN_PERCENTILE_50",valueTypes:[ye.DISTRIBUTION],metricKinds:[de.GAUGE,de.DELTA]},{text:"percentile 05",value:"ALIGN_PERCENTILE_05",valueTypes:[ye.DISTRIBUTION],metricKinds:[de.GAUGE,de.DELTA]},{text:"percent change",value:"ALIGN_PERCENT_CHANGE",valueTypes:[ye.INT64,ye.DOUBLE,ye.MONEY],metricKinds:[de.GAUGE,de.DELTA]}],Se=[{text:"none",value:"REDUCE_NONE",valueTypes:[ye.INT64,ye.DOUBLE,ye.MONEY,ye.DISTRIBUTION,ye.BOOL,ye.STRING],metricKinds:[de.GAUGE,de.DELTA,de.CUMULATIVE,de.METRIC_KIND_UNSPECIFIED]},{text:"mean",value:"REDUCE_MEAN",valueTypes:[ye.INT64,ye.DOUBLE,ye.MONEY,ye.DISTRIBUTION],metricKinds:[de.GAUGE,de.DELTA,de.CUMULATIVE]},{text:"min",value:"REDUCE_MIN",valueTypes:[ye.INT64,ye.DOUBLE,ye.MONEY],metricKinds:[de.GAUGE,de.DELTA,de.CUMULATIVE,de.METRIC_KIND_UNSPECIFIED]},{text:"max",value:"REDUCE_MAX",valueTypes:[ye.INT64,ye.DOUBLE,ye.MONEY],metricKinds:[de.GAUGE,de.DELTA,de.CUMULATIVE,de.METRIC_KIND_UNSPECIFIED]},{text:"sum",value:"REDUCE_SUM",valueTypes:[ye.INT64,ye.DOUBLE,ye.MONEY,ye.DISTRIBUTION],metricKinds:[de.GAUGE,de.DELTA,de.CUMULATIVE,de.METRIC_KIND_UNSPECIFIED]},{text:"std. dev.",value:"REDUCE_STDDEV",valueTypes:[ye.INT64,ye.DOUBLE,ye.MONEY,ye.DISTRIBUTION],metricKinds:[de.GAUGE,de.DELTA,de.CUMULATIVE,de.METRIC_KIND_UNSPECIFIED]},{text:"count",value:"REDUCE_COUNT",valueTypes:[ye.INT64,ye.DOUBLE,ye.MONEY,ye.DISTRIBUTION,ye.BOOL,ye.STRING],metricKinds:[de.GAUGE,de.DELTA,de.CUMULATIVE]},{text:"count true",value:"REDUCE_COUNT_TRUE",valueTypes:[ye.BOOL],metricKinds:[de.GAUGE,de.DELTA]},{text:"count false",value:"REDUCE_COUNT_FALSE",valueTypes:[ye.BOOL],metricKinds:[de.GAUGE,de.DELTA]},{text:"99th percentile",value:"REDUCE_PERCENTILE_99",valueTypes:[ye.INT64,ye.DOUBLE,ye.MONEY,ye.DISTRIBUTION],metricKinds:[de.GAUGE,de.DELTA,de.CUMULATIVE]},{text:"95th percentile",value:"REDUCE_PERCENTILE_95",valueTypes:[ye.INT64,ye.DOUBLE,ye.MONEY,ye.DISTRIBUTION],metricKinds:[de.GAUGE,de.DELTA,de.CUMULATIVE]},{text:"50th percentile",value:"REDUCE_PERCENTILE_50",valueTypes:[ye.INT64,ye.DOUBLE,ye.MONEY,ye.DISTRIBUTION],metricKinds:[de.GAUGE,de.DELTA,de.CUMULATIVE]},{text:"5th percentile",value:"REDUCE_PERCENTILE_05",valueTypes:[ye.INT64,ye.DOUBLE,ye.MONEY,ye.DISTRIBUTION],metricKinds:[de.GAUGE,de.DELTA,de.CUMULATIVE]}],Te=[{text:"grafana auto",value:"grafana-auto"},{text:"stackdriver auto",value:"stackdriver-auto",hidden:!0},{text:"cloud monitoring auto",value:"cloud-monitoring-auto"},{text:"1m",value:"+60s"},{text:"2m",value:"+120s"},{text:"5m",value:"+300s"},{text:"10m",value:"+600s"},{text:"30m",value:"+1800s"},{text:"1h",value:"+3600s"},{text:"3h",value:"+7200s"},{text:"6h",value:"+21600s"},{text:"1d",value:"+86400s"},{text:"3d",value:"+259200s"},{text:"1w",value:"+604800s"}],we=[{text:"auto",value:"auto"},{text:"1m",value:"1m"},{text:"2m",value:"2m"},{text:"5m",value:"5m"},{text:"10m",value:"10m"},{text:"30m",value:"30m"},{text:"1h",value:"1h"},{text:"3h",value:"3h"},{text:"6h",value:"6h"},{text:"1d",value:"1d"},{text:"3d",value:"3d"},{text:"1w",value:"1w"}],Pe=[{text:"1m",value:"1m"},{text:"2m",value:"2m"},{text:"5m",value:"5m"},{text:"10m",value:"10m"},{text:"30m",value:"30m"},{text:"1h",value:"1h"},{text:"3h",value:"3h"},{text:"6h",value:"6h"},{text:"24h",value:"24h"},{text:"72h",value:"72h"}],xe=["metadata.system_labels.cloud_account","metadata.system_labels.name","metadata.system_labels.region","metadata.system_labels.state","metadata.system_labels.instance_group","metadata.system_labels.node_name","metadata.system_labels.service_name","metadata.system_labels.top_level_controller_type","metadata.system_labels.top_level_controller_name","metadata.system_labels.container_image"],Ie="select_slo_burn_rate",Ne=[{label:"SLI Value",value:"select_slo_health"},{label:"SLO Compliance",value:"select_slo_compliance"},{label:"SLO Error Budget Remaining",value:"select_slo_budget_fraction"},{label:"SLO Burn Rate",value:Ie}],De=[{label:"Builder",value:fe.TIME_SERIES_LIST},{label:"MQL",value:fe.TIME_SERIES_QUERY},{label:"Service Level Objectives (SLO)",value:fe.SLO},{label:"PromQL",value:fe.PROMQL}];function Le(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Ae(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})),e}function Ce({inputId:e,templateVariableOptions:t,onChange:r,current:n,disabled:i,aligmentPeriods:o}){const a=(0,O.useMemo)((()=>o.map((e=>Ae(function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){Le(e,t,r[t])}))}return e}({},e),{label:e.text})))),[o]),u=(0,O.useMemo)((()=>a.filter((e=>!e.hidden))),[a]);return(0,m.jsx)(_.Select,{width:"auto",onChange:({value:e})=>r(e),value:[...a,...t].find((e=>e.value===n)),options:[{label:"Template Variables",options:t},{label:"Aggregations",expanded:!0,options:u}],placeholder:"Select Period",inputId:e,disabled:i,allowCustomValue:!0,menuPlacement:"top"})}const Re=({refId:e,onChange:t,graphPeriod:r,variableOptionGroup:n})=>(0,m.jsx)(je,{children:(0,m.jsx)(me,{label:"Graph period",htmlFor:`${e}-graph-period`,tooltip:(0,m.jsxs)(m.Fragment,{children:["Set ",(0,m.jsx)("code",{children:"graph_period"})," which forces a preferred period between points. Automatically set to the current interval if left blank."]}),children:(0,m.jsxs)(_.Stack,{gap:1,children:[(0,m.jsx)(_.Switch,{"data-testid":`${e}-switch-graph-period`,value:"disabled"!==r,onChange:e=>t(e.currentTarget.checked?"":"disabled")}),(0,m.jsx)(Ce,{inputId:`${e}-graph-period`,templateVariableOptions:n.options,current:r,onChange:t,disabled:"disabled"===r,aligmentPeriods:we})]})})});function ke({query:e,onChange:t,onRunQuery:r}){return(0,m.jsx)("span",{"data-testid":pe.queryEditor.mqlMetricsQueryEditor.container.input,children:(0,m.jsx)(_.TextArea,{name:"Query",className:"slate-query-field",value:e,rows:10,placeholder:"Enter a Cloud Monitoring MQL query (Run with Shift+Enter)",onBlur:r,onChange:e=>t(e.currentTarget.value),onKeyDown:e=>{"Enter"===e.key&&(e.shiftKey||e.ctrlKey)&&(e.preventDefault(),r())}})})}function Ue({refId:e,projectName:t,datasource:r,onChange:n,templateVariableOptions:i}){const[o,a]=(0,O.useState)([]);(0,O.useEffect)((()=>{r.getProjects().then((e=>a(e)))}),[r]);const u=(0,O.useMemo)((()=>[{label:"Template Variables",options:i},...o]),[o,i]);return(0,m.jsx)(me,{label:"Project",children:(0,m.jsx)(_.Select,{width:"auto",allowCustomValue:!0,formatCreateLabel:e=>`Use project: ${e}`,onChange:({value:e})=>n(e),options:u,value:{value:t,label:t},placeholder:"Select Project",inputId:`${e}-project`})})}var Me=p(635),Ge=p.n(Me);const Qe=({children:e})=>O.createElement(ce,{gap:1},e);function Be(e,t,r,n,i,o,a){try{var u=e[o](a),l=u.value}catch(e){return void r(e)}u.done?t(l):Promise.resolve(l).then(n,i)}function qe(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Fe(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})),e}const Ve=e=>(0,y.uniqBy)(e,"service"),Ke=(e,t)=>e.filter((e=>e.service===t)),$e=(e,t,r,n)=>{const i=Ke(e,n).map((e=>({value:e.type,name:e.displayName}))),o=i.some((e=>e.value===r)),a=i.length?i[0].value:"";return{metricTypes:i,selectedMetricType:o?t:a}},We=(e,t,r)=>(r&&r===he.Rate&&(t=de.GAUGE),e?Ee.filter((r=>-1!==r.valueTypes.indexOf(e)&&-1!==r.metricKinds.indexOf(t))):[]),ze=(e,t)=>t?Se.filter((r=>-1!==r.valueTypes.indexOf(e)&&-1!==r.metricKinds.indexOf(t))):[],Ye=(e,t,r)=>{return(n=function*(){const n=yield e.getLabels(t,"handleLabelKeysQuery",r);return[...Object.keys(n),...xe]},function(){var e=this,t=arguments;return new Promise((function(r,i){var o=n.apply(e,t);function a(e){Be(o,r,i,a,u,"next",e)}function u(e){Be(o,r,i,a,u,"throw",e)}a(void 0)}))})();var n},Je=(e=ye.DOUBLE,t=de.GAUGE,r=ve.ALIGN_MEAN,n)=>{const i=(0,g.getTemplateSrv)(),o=We(e,t,n).map((e=>Fe(function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){qe(e,t,r[t])}))}return e}({},e),{label:e.text})));return o.some((e=>e.value===i.replace(r)))||(r=o.length>0?o[0].value:ve.ALIGN_MEAN),{alignOptions:o,perSeriesAligner:r}},He=e=>{const t=e.reduce(((e,t)=>{const r=t.split(".").map(y.startCase),n=(2===r.length?r:(0,y.initial)(r)).join(" "),i={value:t,label:t};return e[n]?e[n]=[...e[n],i]:e[n]=[i],e}),{});return Object.entries(t).map((([e,t])=>({label:e,options:t,expanded:!0})),[])},Ze=(e,t)=>{const{perSeriesAligner:r,alignmentPeriod:n}=e;if(!n||!r)return"";const i=Ee.find((e=>e.value===t.templateSrv.replace(r))),o=parseInt(n,10);var a;return`${v.rangeUtil.secondsToHms(o)} interval (${null!==(a=null==i?void 0:i.text)&&void 0!==a?a:""})`},Xe=e=>{var t,r;const n=null==e||null===(t=e.filters)||void 0===t?void 0:t.findIndex((e=>"metric.type"===e));return(null==e||null===(r=e.filters)||void 0===r?void 0:r[n+2])||""},et=(e,t)=>{var r;if(!e.filters)return e.filters=["metric.type","=",t],e;const n=null==e||null===(r=e.filters)||void 0===r?void 0:r.findIndex((e=>"metric.type"===e));return-1===n?e.filters.push("metric.type","=",t):e.filters[n+2]=t,e};function tt(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function rt(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})),e}const nt=({inputId:e,query:t,templateVariableOptions:r,onChange:n,metricDescriptor:i,preprocessor:o})=>{const{perSeriesAligner:a}=t;let{valueType:u,metricKind:l}=i||{};const{perSeriesAligner:c,alignOptions:s}=(0,O.useMemo)((()=>Je(u,l,a,o)),[u,l,a,o]);return(0,m.jsx)(_.Select,{onChange:({value:e})=>n(rt(function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){tt(e,t,r[t])}))}return e}({},t),{perSeriesAligner:e})),value:[...s,...r].find((e=>e.value===c)),options:[{label:"Template Variables",options:r},{label:"Alignment options",expanded:!0,options:s}],placeholder:"Select Alignment",inputId:e,menuPlacement:"top"})};function it(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function ot(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){it(e,t,r[t])}))}return e}function at(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})),e}const ut=({refId:e,templateVariableOptions:t,onChange:r,query:n,customMetaData:i,datasource:o,metricDescriptor:a,preprocessor:u})=>{const l=(0,O.useMemo)((()=>Ze(i,o)),[i,o]);return(0,m.jsxs)(Qe,{children:[(0,m.jsx)(me,{label:"Alignment function",tooltip:"The process of alignment consists of collecting all data points received in a fixed length of time, applying a function to combine those data points, and assigning a timestamp to the result.",children:(0,m.jsx)(nt,{inputId:`${e}-alignment-function`,templateVariableOptions:t,query:n,onChange:e=>r(ot({},n,e)),metricDescriptor:a,preprocessor:u})}),(0,m.jsx)(me,{label:"Alignment period",tooltip:l,children:(0,m.jsx)(Ce,{inputId:`${e}-alignment-period`,templateVariableOptions:t,current:n.alignmentPeriod,onChange:e=>r(at(ot({},n),{alignmentPeriod:e})),aligmentPeriods:Te})})]})};function lt(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function ct(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})),e}const st=e=>{const t=pt(e),r=ft(t,e);return(0,m.jsx)(me,{label:"Group by function","data-testid":"cloud-monitoring-aggregation",tooltip:"Aggregation function used on the metric data. Defaults to none for scalar data and mean for distribution data. Not applying an aggregation to distribution data may lead to performance issues.",children:(0,m.jsx)(_.Select,{width:"auto",onChange:({value:t})=>e.onChange(t),value:r,options:[{label:"Template Variables",options:e.templateVariableOptions},{label:"Aggregations",expanded:!0,options:t}],placeholder:"Select Reducer",inputId:`${e.refId}-group-by-function`,menuPlacement:"top"})})},pt=({metricDescriptor:e})=>{const t=null==e?void 0:e.valueType,r=null==e?void 0:e.metricKind;return(0,O.useMemo)((()=>t&&r?ze(t,r).map((e=>ct(function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){lt(e,t,r[t])}))}return e}({},e),{label:e.text}))):[]),[t,r])},ft=(e,t)=>(0,O.useMemo)((()=>[...e,...t.templateVariableOptions].find((e=>e.value===t.crossSeriesReducer))),[e,t.crossSeriesReducer,t.templateVariableOptions]);function ht(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function dt(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){ht(e,t,r[t])}))}return e}function yt(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})),e}const vt=({refId:e,labels:t=[],query:r,onChange:n,variableOptionGroup:i,metricDescriptor:o})=>{const a=(0,O.useMemo)((()=>[i,...He([...t,...xe])]),[t,i]);var u,l;return(0,m.jsxs)(Qe,{children:[(0,m.jsx)(me,{label:"Group by",tooltip:"You can reduce the amount of data returned for a metric by combining different time series. To combine multiple time series, you can specify a grouping and a function. Grouping is done on the basis of labels. The grouping function is used to combine the time series in the group into a single time series.",children:(0,m.jsx)(_.MultiSelect,{allowCustomValue:!0,inputId:`${e}-group-by`,width:"auto",placeholder:"Choose label",options:a,value:null!==(u=r.groupBys)&&void 0!==u?u:[],onChange:e=>{n(yt(dt({},r),{groupBys:e.map((e=>e.value))}))},menuPlacement:"top"})}),(0,m.jsx)(st,{metricDescriptor:o,templateVariableOptions:i.options,crossSeriesReducer:r.crossSeriesReducer,groupBys:null!==(l=r.groupBys)&&void 0!==l?l:[],onChange:e=>n(yt(dt({},r),{crossSeriesReducer:e})),refId:e})]})},gt=({className:e,...t})=>{const r=(0,_.useStyles2)(mt);return O.createElement(_.Button,{...t,className:(0,b.cx)(e,r.button)})},mt=e=>({button:(0,b.css)({paddingLeft:e.spacing(1.5),paddingRight:e.spacing(1.5)})}),bt=O.forwardRef((function({items:e,renderItem:t,onChange:r},n){return O.createElement(ce,null,e.map(((n,i)=>O.createElement("div",{key:i},t(n,(t=>((t,n)=>{const i=[...e];i[t]=n,r(i)})(i,t)),(()=>(t=>{const n=[...e];n.splice(t,1),r(n)})(i)))))),O.createElement(_.Button,{ref:n,onClick:()=>{const t=[...e,{}];r(t)},variant:"secondary",size:"md",icon:"plus","aria-label":"Add",type:"button"}))})),Ot="=",jt="AND",_t=["=","!=","=~","!=~"].map(v.toOption),Et=["metric.type"],St=({labels:e={},filters:t,onChange:r,variableOptionGroup:n})=>{const i=(e=>(0,y.chunk)(e,4).map((([e,t,r,n="AND"])=>({key:e,operator:t,value:r,condition:n}))))(t),o=i.filter((({key:e})=>!Et.includes(e))),a=i.filter((({key:e})=>Et.includes(e))),u=(0,O.useMemo)((()=>[n,...He(Object.keys(e))]),[e,n]),l=({key:t="",value:r=""})=>{u.some((e=>e.options?u.some((e=>e.label===t)):e.label===t))||u.push({label:t,value:t});const i=e.hasOwnProperty(t)?[n,...e[t].map(v.toOption)]:[n];return i.some((e=>e.label===r))||i.push({label:r,value:r}),{options:u,valueOptions:i}};return(0,m.jsx)(je,{children:(0,m.jsx)(me,{label:"Filter",tooltip:"To reduce the amount of data charted, apply a filter. A filter has three components: a label, a comparison, and a value. The comparison can be an equality, inequality, or regular expression.",children:(0,m.jsx)(bt,{items:o,renderItem:(e,t,r)=>{const{key:n="",operator:i=Ot,value:o="",condition:a=jt}=e,{options:u,valueOptions:c}=l(e);return(0,m.jsxs)(_.Stack,{gap:1,width:"auto",children:[(0,m.jsx)(_.Select,{"aria-label":"Filter label key",formatCreateLabel:e=>`Use label key: ${e}`,allowCustomValue:!0,value:n,options:u,onChange:({value:e=""})=>t({key:e,operator:i,value:o,condition:a})}),(0,m.jsx)(_.Select,{value:i,options:_t,onChange:({value:e=Ot})=>t({key:n,operator:e,value:o,condition:a})}),(0,m.jsx)(_.Select,{"aria-label":"Filter label value",placeholder:"add filter value",formatCreateLabel:e=>`Use label value: ${e}`,allowCustomValue:!0,value:o,options:c,onChange:({value:e=""})=>t({key:n,operator:i,value:e,condition:a})}),(0,m.jsx)(gt,{"aria-label":"Remove",icon:"times",variant:"secondary",onClick:r,type:"button"})]})},onChange:e=>{const t=e.concat(a).map((({key:e,operator:t,value:r,condition:n})=>({key:e||"",operator:t||Ot,value:r||"",condition:n||jt})));r((e=>e.flatMap((({key:e,operator:t,value:r,condition:n})=>[e,t,r,n])).slice(0,-1))(t))}})})})};function Tt(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function wt(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})),e}const Pt={label:"None",value:he.None},xt=({query:e,metricDescriptor:t,onChange:r})=>{const n=It(t);var i;return(0,m.jsx)(me,{label:"Pre-processing",tooltip:"Preprocessing options are displayed when the selected metric has a metric kind of delta or cumulative. The specific options available are determined by the metric's value type. If you select 'Rate', data points are aligned and converted to a rate per time series. If you select 'Delta', data points are aligned by their delta (difference) per time series",children:(0,m.jsx)(_.RadioButtonGroup,{onChange:n=>{const{perSeriesAligner:i}=e,{valueType:o,metricKind:a}=null!=t?t:{},{perSeriesAligner:u}=Je(o,a,i,n);r(wt(function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){Tt(e,t,r[t])}))}return e}({},e),{preprocessor:n,perSeriesAligner:u}))},value:null!==(i=e.preprocessor)&&void 0!==i?i:he.None,options:n})})},It=e=>{const t=null==e?void 0:e.metricKind,r=null==e?void 0:e.valueType;return(0,O.useMemo)((()=>{if(!t||t===de.GAUGE||r===ye.DISTRIBUTION)return[Pt];const e=[Pt,{label:"Rate",value:he.Rate,description:"Data points are aligned and converted to a rate per time series"}];return t===de.CUMULATIVE?[...e,{label:"Delta",value:he.Delta,description:"Data points are aligned by their delta (difference) per time series"}]:e}),[t,r])};function Nt(e,t,r,n,i,o,a){try{var u=e[o](a),l=u.value}catch(e){return void r(e)}u.done?t(l):Promise.resolve(l).then(n,i)}function Dt(e){return function(){var t=this,r=arguments;return new Promise((function(n,i){var o=e.apply(t,r);function a(e){Nt(o,n,i,a,u,"next",e)}function u(e){Nt(o,n,i,a,u,"throw",e)}a(void 0)}))}}function Lt(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function At(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){Lt(e,t,r[t])}))}return e}function Ct(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})),e}function Rt({refId:e,onChange:t,datasource:r,query:n,variableOptionGroup:i,customMetaData:o,aliasBy:a,onChangeAliasBy:u,range:l}){const[c,s]=(0,O.useState)({}),[p,f]=(0,O.useState)([]),[h,d]=(0,O.useState)(),[v,b]=(0,O.useState)([]),[j,E]=(0,O.useState)([]),[S,T]=(0,O.useState)(""),[w,P]=(0,O.useState)(At({},l));var x;x=l,null===w||w.raw.from.toString()===x.raw.from.toString()&&w.raw.to.toString()===x.raw.to.toString()||P(At({},x));const I=(0,_.useTheme2)(),N=(0,_.getSelectStyles)(I),D=(0,_.useStyles2)(kt),{projectName:L,groupBys:A,crossSeriesReducer:C}=n,R=Xe(n),{templateSrv:k}=r,U=(0,O.useCallback)(((e,t)=>e.find((e=>e.type===k.replace(t)))),[k]);(0,O.useEffect)((()=>{L&&R&&r.getLabels(R,e,L,{groupBys:A,crossSeriesReducer:C},w).then((e=>s(e)))}),[r,A,R,L,e,C,w]),(0,O.useEffect)((()=>{Dt((function*(){if(L){const e=yield r.getMetricTypes(L);(0,g.reportInteraction)("cloud-monitoring-metric-descriptors-loaded",{count:e.length});const t=M(e);f(e),E(t)}}))()}),[r,L,D,N.optionDescription]),(0,O.useEffect)((()=>{const e=(e=>{const t=U(e,R);if(!t)return[];return e.filter((e=>e.service===t.service)).map((e=>({service:e.service,value:e.type,label:e.displayName,component:function(){return(0,m.jsxs)("div",{children:[(0,m.jsx)("div",{className:D,children:e.type}),(0,m.jsx)("div",{className:N.optionDescription,children:e.description})]})}})))})(p),t=e.length>0?e[0].service:"",r=U(p,R);d(r),b(e),T(t)}),[p,U,R,D,N.optionDescription]);const M=e=>{const t=e.map((e=>({value:e.service,label:(0,y.startCase)(e.serviceShortName)})));return t.length>0?(0,y.uniqBy)(t,(e=>e.value)):[]},G=Ge()((e=>Dt((function*(){const t=(yield r.filterMetricsByType(L,S)).filter((t=>t.type.includes(e.toLowerCase()))).map((e=>({value:e.type,label:e.displayName,component:function(){return(0,m.jsxs)("div",{children:[(0,m.jsx)("div",{className:D,children:e.type}),(0,m.jsx)("div",{className:N.optionDescription,children:e.description})]})}})));return[{label:"Template Variables",options:i.options},...t]}))()),400),Q=({value:e})=>{const i=U(p,e);d(i);const{metricKind:o,valueType:a}=i,u=o===de.GAUGE||a===ye.DISTRIBUTION?he.None:he.Rate,{perSeriesAligner:l}=Je(a,o,n.perSeriesAligner,u);Object.assign(n,Ct(At({},Bt(r)),{crossSeriesReducer:a===ye.DISTRIBUTION?"REDUCE_MEAN":"REDUCE_NONE",projectName:n.projectName,filters:n.filters})),t(Ct(At({},et(Ct(At({},n),{perSeriesAligner:l}),e)),{preprocessor:u}))};return(0,m.jsxs)("span",{"data-testid":pe.queryEditor.visualMetricsQueryEditor.container.input,children:[(0,m.jsx)(je,{children:(0,m.jsxs)(Qe,{children:[(0,m.jsx)(Ue,{refId:e,templateVariableOptions:i.options,projectName:L,datasource:r,onChange:e=>{t(Ct(At({},n),{projectName:e}))}}),(0,m.jsx)(me,{label:"Service",width:"auto",children:(0,m.jsx)(_.Select,{width:"auto",onChange:({value:e})=>{const t=p.filter((t=>t.service===k.replace(e))).map((e=>({service:e.service,value:e.type,label:e.displayName,description:e.description})));n.filters=[],t.length>0&&!t.some((e=>e.value===k.replace(R)))?(Q(t[0]),T(e),b(t)):(T(e),b(t))},isLoading:0===j.length,value:[...j,...i.options].find((e=>e.value===S)),options:[{label:"Template Variables",options:i.options},...j],placeholder:"Select Services",inputId:`${e}-service`})}),(0,m.jsx)(me,{label:"Metric name",width:"auto",htmlFor:`${e}-select-metric`,children:(0,m.jsx)("span",{title:""===S?"Select a service first":"Type to search metrics",children:(0,m.jsx)(_.AsyncSelect,{width:"auto",onChange:Q,value:[...v,...i.options].find((e=>e.value===R)),loadOptions:G,defaultOptions:[{label:"Template Variables",options:i.options},...v.slice(0,100)],placeholder:"Select Metric",inputId:`${e}-select-metric`,disabled:""===S})})})]})}),(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)(St,{labels:c,filters:n.filters,onChange:e=>t(Ct(At({},n),{filters:e})),variableOptionGroup:i}),(0,m.jsxs)(je,{children:[(0,m.jsx)(xt,{metricDescriptor:h,query:n,onChange:t}),(0,m.jsx)(vt,{refId:e,labels:Object.keys(c),query:n,onChange:t,variableOptionGroup:i,metricDescriptor:h}),(0,m.jsx)(ut,{refId:e,datasource:r,templateVariableOptions:i.options,query:n,customMetaData:o,onChange:t,metricDescriptor:h,preprocessor:n.preprocessor}),(0,m.jsx)(Oe,{refId:e,value:a,onChange:u})]})]})]})}const kt=e=>(0,b.css)({label:"grafana-select-option-description",fontWeight:"normal",fontStyle:"italic",color:e.colors.text.secondary}),Ut=O.memo(Rt);function Mt(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Gt(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){Mt(e,t,r[t])}))}return e}function Qt(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})),e}const Bt=e=>({projectName:e.getDefaultProject(),crossSeriesReducer:"REDUCE_NONE",alignmentPeriod:"cloud-monitoring-auto",perSeriesAligner:ve.ALIGN_MEAN,groupBys:[],filters:[]}),qt=e=>({projectName:e.getDefaultProject(),query:""});function Ft({refId:e,query:t,datasource:r,onChange:n,onRunQuery:i,customMetaData:o,variableOptionGroup:a,range:u}){const l=(0,O.useCallback)((e=>{let r=!0;if((null==e?void 0:e.filters)&&e.filters.length>0)for(const t of e.filters)if(""===t){r=!1;break}n(Qt(Gt({},t),{timeSeriesList:e})),r&&i()}),[n,i,t]),c=(0,O.useCallback)((e=>{n(Qt(Gt({},t),{timeSeriesQuery:e})),i()}),[n,i,t]);return(0,O.useEffect)((()=>{t.queryType!==fe.TIME_SERIES_LIST||t.timeSeriesList||n({refId:t.refId,datasource:t.datasource,queryType:fe.TIME_SERIES_LIST,timeSeriesList:Bt(r),aliasBy:t.aliasBy}),t.queryType!==fe.TIME_SERIES_QUERY||t.timeSeriesQuery||n({refId:t.refId,datasource:t.datasource,queryType:fe.TIME_SERIES_QUERY,timeSeriesQuery:qt(r),aliasBy:t.aliasBy})}),[n,t,r]),(0,m.jsxs)(se,{children:[(t.queryType===fe.ANNOTATION||t.queryType===fe.TIME_SERIES_LIST)&&t.timeSeriesList&&(0,m.jsx)(Ut,{refId:e,variableOptionGroup:a,customMetaData:o,onChange:l,datasource:r,query:t.timeSeriesList,aliasBy:t.aliasBy,onChangeAliasBy:e=>n(Qt(Gt({},t),{aliasBy:e})),range:u}),t.queryType===fe.TIME_SERIES_QUERY&&t.timeSeriesQuery&&(0,m.jsxs)(m.Fragment,{children:[(0,m.jsxs)(_.Stack,{gap:1,direction:"row",children:[(0,m.jsx)(Ue,{refId:e,datasource:r,onChange:e=>c(Qt(Gt({},t.timeSeriesQuery),{projectName:e})),templateVariableOptions:a.options,projectName:t.timeSeriesQuery.projectName}),(0,m.jsx)(Oe,{refId:e,value:t.aliasBy,onChange:e=>n(Qt(Gt({},t),{aliasBy:e}))})]}),(0,m.jsx)(ke,{onChange:e=>c(Qt(Gt({},t.timeSeriesQuery),{query:e})),onRunQuery:i,query:t.timeSeriesQuery.query}),(0,m.jsx)(Re,{onChange:e=>c(Qt(Gt({},t.timeSeriesQuery),{graphPeriod:e})),graphPeriod:t.timeSeriesQuery.graphPeriod,refId:e,variableOptionGroup:a})]})]})}const Vt=O.memo(Ft);function Kt(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function $t(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){Kt(e,t,r[t])}))}return e}function Wt(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})),e}function zt({refId:e,query:t,datasource:r,onChange:n,variableOptionGroup:i,onRunQuery:o}){function a(e){"Enter"===e.key&&e.shiftKey&&(o(),e.preventDefault(),e.stopPropagation())}var u;return(0,m.jsx)("span",{"data-testid":pe.queryEditor.promQlQueryEditor.container.input,children:(0,m.jsxs)(je,{children:[(0,m.jsx)(Ue,{refId:e,templateVariableOptions:i.options,projectName:t.projectName,datasource:r,onChange:e=>n(Wt($t({},t),{projectName:e}))}),(0,m.jsx)(_.TextArea,{name:"Query",className:"slate-query-field",value:t.expr,rows:10,placeholder:"Enter a Cloud Monitoring Prometheus query (Run with Shift+Enter)",onBlur:o,onKeyDown:a,onChange:e=>n(Wt($t({},t),{expr:e.currentTarget.value}))}),(0,m.jsx)(me,{label:"Min step",tooltip:"Time units and built-in variables can be used here, for example: $__interval, $__rate_interval, 5s, 1m, 3h, 1d, 1y (Default if no unit is specified: 10s)",children:(0,m.jsx)(_.Input,{type:"string",placeholder:"auto",onChange:e=>n(Wt($t({},t),{step:e.currentTarget.value})),onKeyDown:a,value:null!==(u=t.step)&&void 0!==u?u:""})})]})})}const Yt=({children:e})=>{const t=(0,_.useStyles2)(Jt);return O.createElement("div",{className:t.root},e)},Jt=e=>({root:(0,b.css)({display:"flex",flexWrap:"wrap",alignItems:"center",gap:e.spacing(3),minHeight:e.spacing(4)})});function Ht({label:e,...t}){const[r]=(0,O.useState)((()=>Math.random().toString(16).slice(2))),n=(0,_.useStyles2)(er),i={SelectContainer:Zt,ValueContainer:Xt,SingleValue:Xt};return O.createElement("div",{className:n.root},e&&O.createElement("label",{className:n.label,htmlFor:r},e,":"," "),O.createElement(_.Select,{openMenuOnFocus:!0,inputId:r,...t,components:i}))}const Zt=e=>{const{children:t}=e,r=(0,_.useStyles2)(er);return O.createElement(_.SelectContainer,{...e,className:(0,b.cx)(e.className,r.container)},t)},Xt=e=>{const{className:t,children:r}=e,n=(0,_.useStyles2)(er);return O.createElement("div",{className:(0,b.cx)(t,n.valueContainer)},r)},er=e=>({root:(0,b.css)({display:"flex",fontSize:12,alignItems:"center"}),label:(0,b.css)({color:e.colors.text.secondary,whiteSpace:"nowrap"}),container:(0,b.css)({background:"none",borderColor:"transparent"}),valueContainer:(0,b.css)({display:"flex",alignItems:"center",flex:"initial",color:e.colors.text.secondary,fontSize:12})}),tr=({grow:e,shrink:t})=>O.createElement("div",{style:{display:"block",flexGrow:e,flexShrink:t}});function rr(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function nr(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})),e}const ir=e=>{const{query:t,onChange:r,onRunQuery:n}=e,{queryType:i}=t;return(0,m.jsxs)(Yt,{children:[(0,m.jsx)(Ht,{label:"Query type",options:De,value:i,onChange:({value:e})=>{r(nr(function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){rr(e,t,r[t])}))}return e}({},t),{queryType:e})),n()}}),(0,m.jsx)(tr,{grow:1})]})};function or(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function ar(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})),e}const ur=({refId:e,current:t,templateVariableOptions:r,onChange:n})=>{const i=Pe.map((e=>ar(function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){or(e,t,r[t])}))}return e}({},e),{label:e.text})));t&&!i.find((e=>e.value===t))&&i.push({label:t,text:t,value:t,hidden:!1});const o=i.filter((e=>!e.hidden));return(0,m.jsx)(me,{label:"Lookback period",htmlFor:`${e}-lookback-period`,children:(0,m.jsx)(_.Select,{inputId:`${e}-lookback-period`,width:"auto",allowCustomValue:!0,value:[...i,...r].find((e=>e.value===t)),options:[{label:"Template Variables",options:r},{label:"Predefined periods",expanded:!0,options:o}],onChange:({value:e})=>n(e)})})};function lr(e,t,r,n,i,o,a){try{var u=e[o](a),l=u.value}catch(e){return void r(e)}u.done?t(l):Promise.resolve(l).then(n,i)}function cr(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function sr(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})),e}const pr=({refId:e,query:t,templateVariableOptions:r,onChange:n,datasource:i})=>{const[o,a]=(0,O.useState)([]),{projectName:u,serviceId:l}=t;return(0,O.useEffect)((()=>{u&&l&&i.getServiceLevelObjectives(u,l).then((e=>{a([{label:"Template Variables",options:r},...e])}))}),[i,u,l,r]),(0,m.jsx)(me,{label:"SLO",children:(0,m.jsx)(_.Select,{inputId:`${e}-slo`,width:"auto",allowCustomValue:!0,value:(null==t?void 0:t.sloId)&&{value:null==t?void 0:t.sloId,label:(null==t?void 0:t.sloName)||(null==t?void 0:t.sloId)},placeholder:"Select SLO",options:o,onChange:({value:e="",label:r=""})=>{return(o=function*(){const o=(yield i.getServiceLevelObjectives(u,l)).find((({value:t})=>t===i.templateSrv.replace(e)));n(sr(function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){cr(e,t,r[t])}))}return e}({},t),{sloId:e,sloName:r,goal:null==o?void 0:o.goal}))},function(){var e=this,t=arguments;return new Promise((function(r,n){var i=o.apply(e,t);function a(e){lr(i,r,n,a,u,"next",e)}function u(e){lr(i,r,n,a,u,"throw",e)}a(void 0)}))})();var o}})})};function fr(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function hr(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})),e}const dr=({refId:e,query:t,templateVariableOptions:r,onChange:n,datasource:i})=>(0,m.jsx)(me,{label:"Selector",htmlFor:`${e}-slo-selector`,children:(0,m.jsx)(_.Select,{inputId:`${e}-slo-selector`,width:"auto",allowCustomValue:!0,value:[...Ne,...r].find((e=>e.value===(null==t?void 0:t.selectorName))),options:[{label:"Template Variables",options:r},...Ne],onChange:({value:e})=>n(hr(function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){fr(e,t,r[t])}))}return e}({},t),{selectorName:null!=e?e:""}))})});function yr(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function vr(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})),e}const gr=({refId:e,query:t,templateVariableOptions:r,onChange:n,datasource:i})=>{const[o,a]=(0,O.useState)([]),{projectName:u}=t;return(0,O.useEffect)((()=>{u&&i.getSLOServices(u).then((e=>{a([{label:"Template Variables",options:r},...e])}))}),[i,u,r]),(0,m.jsx)(me,{label:"Service",children:(0,m.jsx)(_.Select,{inputId:`${e}-slo-service`,width:"auto",allowCustomValue:!0,value:(null==t?void 0:t.serviceId)&&{value:null==t?void 0:t.serviceId,label:(null==t?void 0:t.serviceName)||(null==t?void 0:t.serviceId)},placeholder:"Select service",options:o,onChange:({value:e="",label:r=""})=>n(vr(function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){yr(e,t,r[t])}))}return e}({},t),{serviceId:e,serviceName:r,sloId:""}))})})};function mr(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function br(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){mr(e,t,r[t])}))}return e}function Or(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})),e}function jr({refId:e,query:t,datasource:r,onChange:n,variableOptionGroup:i,customMetaData:o,aliasBy:a,onChangeAliasBy:u}){const l=(0,O.useMemo)((()=>Ze(o,r)),[o,r]);return(0,m.jsx)("span",{"data-testid":pe.queryEditor.sloQueryEditor.container.input,children:(0,m.jsxs)(je,{children:[(0,m.jsx)(Ue,{refId:e,templateVariableOptions:i.options,projectName:t.projectName,datasource:r,onChange:e=>n(Or(br({},t),{projectName:e}))}),(0,m.jsx)(gr,{refId:e,datasource:r,templateVariableOptions:i.options,query:t,onChange:n}),(0,m.jsx)(pr,{refId:e,datasource:r,templateVariableOptions:i.options,query:t,onChange:n}),(0,m.jsx)(dr,{refId:e,datasource:r,templateVariableOptions:i.options,query:t,onChange:n}),t.selectorName===Ie&&(0,m.jsx)(ur,{refId:e,onChange:e=>n(Or(br({},t),{lookbackPeriod:e})),current:t.lookbackPeriod,templateVariableOptions:i.options}),(0,m.jsx)(Qe,{children:(0,m.jsx)(me,{label:"Alignment period",tooltip:l,children:(0,m.jsx)(Ce,{inputId:`${e}-alignment-period`,templateVariableOptions:i.options,current:t.alignmentPeriod,onChange:e=>n(Or(br({},t),{alignmentPeriod:e})),aligmentPeriods:Te})})}),(0,m.jsx)(Oe,{refId:e,value:a,onChange:u})]})})}function _r(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Er(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){_r(e,t,r[t])}))}return e}function Sr(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})),e}const Tr=({label:e,onChange:t,value:r,options:n,allowCustomValue:i=!1})=>(0,m.jsx)(_.Field,{label:e,children:(0,m.jsx)(_.Select,{width:25,allowCustomValue:i,value:r,onChange:({value:e})=>t(e),options:n})});function wr(e,t,r,n,i,o,a){try{var u=e[o](a),l=u.value}catch(e){return void r(e)}u.done?t(l):Promise.resolve(l).then(n,i)}function Pr(e){return function(){var t=this,r=arguments;return new Promise((function(n,i){var o=e.apply(t,r);function a(e){wr(o,n,i,a,u,"next",e)}function u(e){wr(o,n,i,a,u,"throw",e)}a(void 0)}))}}function xr(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Ir(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){xr(e,t,r[t])}))}return e}function Nr(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})),e}function Dr(e,t){if(null==e)return{};var r,n,i=function(e,t){if(null==e)return{};var r,n,i={},o=Object.keys(e);for(n=0;n<o.length;n++)r=o[n],t.indexOf(r)>=0||(i[r]=e[r]);return i}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)r=o[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(i[r]=e[r])}return i}class Lr extends O.PureComponent{componentDidMount(){return Pr((function*(){yield this.props.datasource.ensureGCEDefaultProject();const e=this.props.query.projectName||this.props.datasource.getDefaultProject(),t=yield this.props.datasource.getProjects(),r=yield this.props.datasource.getMetricTypes(this.props.query.projectName||this.props.datasource.getDefaultProject()),n=Ve(r).map((e=>({value:e.service,label:e.serviceShortName})));let i="";n.some((e=>e.value===(0,g.getTemplateSrv)().replace(this.state.selectedService)))?i=this.state.selectedService:n&&n.length>0&&(i=n[0].value);const{metricTypes:o,selectedMetricType:a}=$e(r,this.state.selectedMetricType,(0,g.getTemplateSrv)().replace(this.state.selectedMetricType),(0,g.getTemplateSrv)().replace(i)),u=yield this.props.datasource.getSLOServices(e),l=Nr(Ir({services:n,selectedService:i,metricTypes:o,selectedMetricType:a,metricDescriptors:r,projects:t},yield this.getLabels(a,e)),{sloServices:u,loading:!1,projectName:e});this.setState(l,(()=>this.onPropsChange()))})).call(this)}onQueryTypeChange(e){return Pr((function*(){const t=Ir({selectedQueryType:e},yield this.getLabels(this.state.selectedMetricType,this.state.projectName,e));this.setState(t)})).call(this)}onProjectChange(e){return Pr((function*(){const t=yield this.props.datasource.getMetricTypes(e),r=yield this.getLabels(this.state.selectedMetricType,e),{metricTypes:n,selectedMetricType:i}=$e(t,this.state.selectedMetricType,(0,g.getTemplateSrv)().replace(this.state.selectedMetricType),(0,g.getTemplateSrv)().replace(this.state.selectedService)),o=yield this.props.datasource.getSLOServices(e);this.setState(Nr(Ir({},r),{metricTypes:n,selectedMetricType:i,metricDescriptors:t,projectName:e,sloServices:o}),(()=>this.onPropsChange()))})).call(this)}onServiceChange(e){return Pr((function*(){const{metricTypes:t,selectedMetricType:r}=$e(this.state.metricDescriptors,this.state.selectedMetricType,(0,g.getTemplateSrv)().replace(this.state.selectedMetricType),(0,g.getTemplateSrv)().replace(e)),n=Ir({selectedService:e,metricTypes:t,selectedMetricType:r},yield this.getLabels(r,this.state.projectName));this.setState(n,(()=>this.onPropsChange()))})).call(this)}onMetricTypeChange(e){return Pr((function*(){const t=Ir({selectedMetricType:e},yield this.getLabels((0,g.getTemplateSrv)().replace(e),this.state.projectName));this.setState(t,(()=>this.onPropsChange()))})).call(this)}onLabelKeyChange(e){this.setState({labelKey:e},(()=>this.onPropsChange()))}componentDidUpdate(e,t){const r=t.selectedQueryType!==this.state.selectedQueryType,n=this.state.selectedSLOService!==t.selectedSLOService;(r||n)&&this.onPropsChange()}getLabels(e,t){return Pr((function*(e,t,r=this.state.selectedQueryType){let n={labels:this.state.labels,labelKey:this.state.labelKey};if(e&&r===ge.LabelValues){const r=yield Ye(this.props.datasource,e,t),i=r.some((e=>e===(0,g.getTemplateSrv)().replace(this.state.labelKey)))?this.state.labelKey:r[0];n={labels:r,labelKey:i}}return n})).apply(this,arguments)}renderQueryTypeSwitch(e){const t={label:"Template Variables",expanded:!1,options:(0,g.getTemplateSrv)().getVariables().map((e=>({value:`$${e.name}`,label:`$${e.name}`})))};switch(e){case ge.MetricTypes:return(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)(Tr,{allowCustomValue:!0,value:this.state.projectName,options:[t,...this.state.projects],onChange:e=>this.onProjectChange(e),label:"Project"}),(0,m.jsx)(Tr,{value:this.state.selectedService,options:[t,...this.state.services],onChange:e=>this.onServiceChange(e),label:"Service"})]});case ge.LabelKeys:case ge.LabelValues:case ge.ResourceTypes:return(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)(Tr,{allowCustomValue:!0,value:this.state.projectName,options:[t,...this.state.projects],onChange:e=>this.onProjectChange(e),label:"Project"}),(0,m.jsx)(Tr,{value:this.state.selectedService,options:[t,...this.state.services],onChange:e=>this.onServiceChange(e),label:"Service"}),(0,m.jsx)(Tr,{value:this.state.selectedMetricType,options:[t,...this.state.metricTypes.map((({value:e,name:t})=>({value:e,label:t})))],onChange:e=>this.onMetricTypeChange(e),label:"Metric Type"}),e===ge.LabelValues&&(0,m.jsx)(Tr,{value:this.state.labelKey,options:[t,...this.state.labels.map((e=>({value:e,label:e})))],onChange:e=>this.onLabelKeyChange(e),label:"Label Key"})]});case ge.Aligners:case ge.Aggregations:return(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)(Tr,{value:this.state.selectedService,options:[t,...this.state.services],onChange:e=>this.onServiceChange(e),label:"Service"}),(0,m.jsx)(Tr,{value:this.state.selectedMetricType,options:[t,...this.state.metricTypes.map((({value:e,name:t})=>({value:e,label:t})))],onChange:e=>this.onMetricTypeChange(e),label:"Metric Type"})]});case ge.Services:case ge.SLOServices:return(0,m.jsx)(m.Fragment,{children:(0,m.jsx)(Tr,{allowCustomValue:!0,value:this.state.projectName,options:[t,...this.state.projects],onChange:e=>this.onProjectChange(e),label:"Project"})});case ge.SLO:return(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)(Tr,{allowCustomValue:!0,value:this.state.projectName,options:[t,...this.state.projects],onChange:e=>this.onProjectChange(e),label:"Project"}),(0,m.jsx)(Tr,{value:this.state.selectedSLOService,options:[t,...this.state.sloServices],onChange:e=>{this.setState(Nr(Ir({},this.state),{selectedSLOService:e}))},label:"SLO Service"})]});default:return""}}render(){return this.state.loading?(0,m.jsx)(Tr,{value:"loading",options:[{value:"loading",label:"Loading..."}],onChange:e=>null,label:"Query Type"}):(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)(Tr,{value:this.state.selectedQueryType,options:this.queryTypes,onChange:e=>this.onQueryTypeChange(e),label:"Query Type"}),this.renderQueryTypeSwitch(this.state.selectedQueryType)]})}constructor(e){super(e),xr(this,"queryTypes",[{value:ge.Projects,label:"Projects"},{value:ge.Services,label:"Services"},{value:ge.MetricTypes,label:"Metric Types"},{value:ge.LabelKeys,label:"Label Keys"},{value:ge.LabelValues,label:"Label Values"},{value:ge.ResourceTypes,label:"Resource Types"},{value:ge.Aggregations,label:"Aggregations"},{value:ge.Aligners,label:"Aligners"},{value:ge.AlignmentPeriods,label:"Alignment Periods"},{value:ge.Selectors,label:"Selectors"},{value:ge.SLOServices,label:"SLO Services"},{value:ge.SLO,label:"Service Level Objectives (SLO)"}]),xr(this,"defaults",{selectedQueryType:this.queryTypes[0].value,metricDescriptors:[],selectedService:"",selectedMetricType:"",labels:[],labelKey:"",metricTypes:[],services:[],sloServices:[],selectedSLOService:"",projects:[],projectName:"",loading:!0}),xr(this,"onPropsChange",(()=>{const e=this.state,{metricDescriptors:t,labels:r,metricTypes:n,services:i}=e,o=Dr(e,["metricDescriptors","labels","metricTypes","services"]);this.props.onChange(Nr(Ir({},o),{refId:"CloudMonitoringVariableQueryEditor-VariableQuery"}))})),this.state=Object.assign(this.defaults,this.props.query)}}var Ar=p(269),Cr=p(59);function Rr(e,t,r){void 0===t&&(t=0),void 0===r&&(r=[]);var n=function(e,t){void 0===t&&(t=0);var r=(0,O.useRef)(!1),n=(0,O.useRef)(),i=(0,O.useRef)(e),o=(0,O.useCallback)((function(){return r.current}),[]),a=(0,O.useCallback)((function(){r.current=!1,n.current&&clearTimeout(n.current),n.current=setTimeout((function(){r.current=!0,i.current()}),t)}),[t]),u=(0,O.useCallback)((function(){r.current=null,n.current&&clearTimeout(n.current)}),[]);return(0,O.useEffect)((function(){i.current=e}),[e]),(0,O.useEffect)((function(){return a(),u}),[t]),[o,u,a]}(e,t),i=n[0],o=n[1],a=n[2];return(0,O.useEffect)(a,r),[i,o]}const kr=()=>(0,m.jsx)(_.Alert,{severity:"info",title:"Annotation Query Format",children:(0,m.jsxs)("div",{children:[(0,m.jsxs)("p",{children:["An annotation is an event that is overlaid on top of graphs. Annotation rendering is expensive so it is important to limit the number of rows returned."," "]}),(0,m.jsx)("p",{children:"The Title and Text fields support templating and can use data returned from the query. For example, the Title field could have the following text:"}),(0,m.jsxs)("code",{children:["{{metric.type}}"," has value: ","{{metric.value}}"]}),(0,m.jsxs)("p",{children:["Example Result: ",(0,m.jsx)("code",{children:"monitoring.googleapis.com/uptime_check/http_status has this value: 502"})]}),(0,m.jsx)("span",{children:"Patterns:"}),(0,m.jsxs)("p",{children:[(0,m.jsx)("code",{children:"{{metric.value}}"})," = value of the metric/point"]}),(0,m.jsxs)("p",{children:[(0,m.jsx)("code",{children:"{{metric.type}}"})," = metric type e.g. compute.googleapis.com/instance/cpu/usage_time"]}),(0,m.jsxs)("p",{children:[(0,m.jsx)("code",{children:"{{metric.name}}"})," = name part of metric e.g. instance/cpu/usage_time"]}),(0,m.jsxs)("p",{children:[(0,m.jsx)("code",{children:"{{metric.service}}"})," = service part of metric e.g. compute"]}),(0,m.jsxs)("p",{children:[(0,m.jsx)("code",{children:"{{metric.label.label_name}}"})," = Metric label metadata e.g. metric.label.instance_name"]}),(0,m.jsxs)("p",{children:[(0,m.jsx)("code",{children:"{{resource.label.label_name}}"})," = Resource label metadata e.g. resource.label.zone"]})]})});function Ur(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Mr(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){Ur(e,t,r[t])}))}return e}function Gr(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})),e}const Qr=e=>{const{datasource:t,query:r,onRunQuery:n,data:i,onChange:o,range:a}=e,u=(null==i?void 0:i.series.length)?null==i?void 0:i.series[0].meta:{};var l;const c=null!==(l=null==u?void 0:u.custom)&&void 0!==l?l:{},s=Mr({},(e=>Gr(Mr({},Bt(e)),{title:"",text:""}))(t),r.timeSeriesList),[p,f]=(0,O.useState)(s.title||""),[h,d]=(0,O.useState)(s.text||""),y={label:"Template Variables",options:t.getVariables().map(v.toOption)};return Rr((()=>{o(Gr(Mr({},r),{timeSeriesList:Gr(Mr({},s),{title:p})}))}),1e3,[p,o]),Rr((()=>{o(Gr(Mr({},r),{timeSeriesList:Gr(Mr({},s),{text:h})}))}),1e3,[h,o]),(0,O.useEffect)((()=>{r.queryType&&Object.values(fe).includes(r.queryType)||o(Gr(Mr({},r),{queryType:fe.TIME_SERIES_LIST}))})),(0,m.jsxs)(se,{children:[(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)(Vt,{refId:r.refId,variableOptionGroup:y,customMetaData:c,onChange:o,onRunQuery:n,datasource:t,query:r,range:a||(0,v.getDefaultTimeRange)()}),(0,m.jsx)(me,{label:"Title",htmlFor:"annotation-query-title",children:(0,m.jsx)(_.Input,{id:"annotation-query-title",value:p,onChange:e=>{f(e.target.value)}})}),(0,m.jsx)(me,{label:"Text",htmlFor:"annotation-query-text",children:(0,m.jsx)(_.Input,{id:"annotation-query-text",value:h,onChange:e=>{d(e.target.value)}})})]}),(0,m.jsx)(kr,{})]})};function Br(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function qr(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})),e}const Fr=e=>({prepareAnnotation:t=>{if(!(e=>{var t,r;return void 0!==(null===(t=e.target)||void 0===t?void 0:t.title)||void 0!==(null===(r=e.target)||void 0===r?void 0:r.text)})(t))return t;const{enable:r,name:n,iconColor:i}=t,{target:o}=t;return{datasource:t.datasource,enable:r,name:n,iconColor:i,target:{intervalMs:e.intervalMs,refId:(null==o?void 0:o.refId)||"annotationQuery",queryType:fe.ANNOTATION,timeSeriesList:{projectName:(null==o?void 0:o.projectName)||e.getDefaultProject(),filters:(null==o?void 0:o.filters)||[],crossSeriesReducer:"REDUCE_NONE",perSeriesAligner:ve.ALIGN_NONE,title:(null==o?void 0:o.title)||"",text:(null==o?void 0:o.text)||""}}}},prepareQuery:e=>{if(e.target)return qr(function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){Br(e,t,r[t])}))}return e}({},e.target),{queryType:fe.ANNOTATION,type:"annotationQuery"})},QueryEditor:Qr});function Vr(e,t,r,n,i,o,a){try{var u=e[o](a),l=u.value}catch(e){return void r(e)}u.done?t(l):Promise.resolve(l).then(n,i)}function Kr(e){return function(){var t=this,r=arguments;return new Promise((function(n,i){var o=e.apply(t,r);function a(e){Vr(o,n,i,a,u,"next",e)}function u(e){Vr(o,n,i,a,u,"throw",e)}a(void 0)}))}}function $r(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Wr(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})),e}class zr{execute(e){return Kr((function*(){try{switch(e.projectName||(e.projectName=this.datasource.getDefaultProject()),e.selectedQueryType){case ge.Projects:return this.handleProjectsQuery();case ge.Services:return this.handleServiceQuery(e);case ge.MetricTypes:return this.handleMetricTypesQuery(e);case ge.LabelKeys:return this.handleLabelKeysQuery(e);case ge.LabelValues:return this.handleLabelValuesQuery(e);case ge.ResourceTypes:return this.handleResourceTypeQuery(e);case ge.Aligners:return this.handleAlignersQuery(e);case ge.AlignmentPeriods:return this.handleAlignmentPeriodQuery();case ge.Aggregations:return this.handleAggregationQuery(e);case ge.SLOServices:return this.handleSLOServicesQuery(e);case ge.SLO:return this.handleSLOQuery(e);case ge.Selectors:return this.handleSelectorQuery();default:return[]}}catch(t){return console.error(`Could not run CloudMonitoringMetricFindQuery ${e}`,t),[]}})).call(this)}handleProjectsQuery(){return Kr((function*(){return(yield this.datasource.getProjects()).map((e=>({text:e.label,value:e.value,expandable:!0})))})).call(this)}handleServiceQuery(e){return Kr((function*({projectName:e}){const t=yield this.datasource.getMetricTypes(e);return Ve(t).map((e=>({text:e.serviceShortName,value:e.service,expandable:!0})))})).apply(this,arguments)}handleMetricTypesQuery(e){return Kr((function*({selectedService:e,projectName:t}){if(!e)return[];const r=yield this.datasource.getMetricTypes(t);return Ke(r,this.datasource.templateSrv.replace(e)).map((e=>({text:e.displayName,value:e.type,expandable:!0})))})).apply(this,arguments)}handleLabelKeysQuery(e){return Kr((function*({selectedMetricType:e,projectName:t}){if(!e)return[];return(yield Ye(this.datasource,e,t)).map(this.toFindQueryResult)})).apply(this,arguments)}handleLabelValuesQuery(e){return Kr((function*({selectedMetricType:e,labelKey:t,projectName:r}){if(!e)return[];const n=yield this.datasource.getLabels(e,"handleLabelValuesQuery",r,{groupBys:[t],crossSeriesReducer:"REDUCE_MEAN"}),i=this.datasource.templateSrv.replace(t);return(n.hasOwnProperty(i)?n[i]:[]).map(this.toFindQueryResult)})).apply(this,arguments)}handleResourceTypeQuery(e){return Kr((function*({selectedMetricType:e,projectName:t}){var r;if(!e)return[];var n;return null!==(n=null===(r=(yield this.datasource.getLabels(e,"handleResourceTypeQueryQueryType",t))["resource.type"])||void 0===r?void 0:r.map(this.toFindQueryResult))&&void 0!==n?n:[]})).apply(this,arguments)}handleAlignersQuery(e){return Kr((function*({selectedMetricType:e,projectName:t}){if(!e)return[];const r=(yield this.datasource.getMetricTypes(t)).find((t=>t.type===this.datasource.templateSrv.replace(e)));return r?We(r.valueType,r.metricKind).map(this.toFindQueryResult):[]})).apply(this,arguments)}handleAggregationQuery(e){return Kr((function*({selectedMetricType:e,projectName:t}){if(!e)return[];const r=(yield this.datasource.getMetricTypes(t)).find((t=>t.type===this.datasource.templateSrv.replace(e)));return r?ze(r.valueType,r.metricKind).map(this.toFindQueryResult):[]})).apply(this,arguments)}handleSLOServicesQuery(e){return Kr((function*({projectName:e}){return(yield this.datasource.getSLOServices(e)).map(this.toFindQueryResult)})).apply(this,arguments)}handleSLOQuery(e){return Kr((function*({selectedSLOService:e,projectName:t}){return(yield this.datasource.getServiceLevelObjectives(t,e)).map(this.toFindQueryResult)})).apply(this,arguments)}handleSelectorQuery(){return Kr((function*(){return Ne.map(this.toFindQueryResult)})).call(this)}handleAlignmentPeriodQuery(){return Te.map(this.toFindQueryResult)}toFindQueryResult(e){return(0,y.isString)(e)?{text:e,expandable:!0}:Wr(function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){$r(e,t,r[t])}))}return e}({},e),{expandable:!0})}constructor(e){$r(this,"datasource",void 0),this.datasource=e}}function Yr(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class Jr extends v.CustomVariableSupport{query(e){const t=(0,Ar.from)(this.metricFindQuery.execute(e.targets[0]));return(0,Ar.from)(this.datasource.ensureGCEDefaultProject()).pipe((0,Cr.mergeMap)((()=>t)),(0,Cr.map)((e=>({data:e}))))}constructor(e){super(),Yr(this,"datasource",void 0),Yr(this,"metricFindQuery",void 0),Yr(this,"editor",void 0),this.datasource=e,this.editor=Lr,this.metricFindQuery=new zr(e)}}function Hr(e,t,r,n,i,o,a){try{var u=e[o](a),l=u.value}catch(e){return void r(e)}u.done?t(l):Promise.resolve(l).then(n,i)}function Zr(e){return function(){var t=this,r=arguments;return new Promise((function(n,i){var o=e.apply(t,r);function a(e){Hr(o,n,i,a,u,"next",e)}function u(e){Hr(o,n,i,a,u,"throw",e)}a(void 0)}))}}function Xr(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function en(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){Xr(e,t,r[t])}))}return e}function tn(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})),e}function rn(e,t){if(null==e)return{};var r,n,i=function(e,t){if(null==e)return{};var r,n,i={},o=Object.keys(e);for(n=0;n<o.length;n++)r=o[n],t.indexOf(r)>=0||(i[r]=e[r]);return i}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)r=o[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(i[r]=e[r])}return i}class nn extends g.DataSourceWithBackend{getVariables(){return this.templateSrv.getVariables().map((e=>`$${e.name}`))}query(e){return e.targets=e.targets.map((t=>tn(en({},this.migrateQuery(t)),{intervalMs:e.intervalMs}))),super.query(e)}applyTemplateVariables(e,t){const{timeSeriesList:r,timeSeriesQuery:n,sloQuery:i,promQLQuery:o}=e;return tn(en({},e),{datasource:this.getRef(),intervalMs:this.intervalMs,timeSeriesList:r&&tn(en({},this.interpolateProps(r,t)),{projectName:this.templateSrv.replace(r.projectName?r.projectName:this.getDefaultProject(),t),filters:this.interpolateFilters(r.filters||[],t),groupBys:this.interpolateGroupBys(r.groupBys||[],t),view:r.view||"FULL"}),timeSeriesQuery:n&&tn(en({},this.interpolateProps(n,t)),{projectName:this.templateSrv.replace(n.projectName?n.projectName:this.getDefaultProject(),t)}),sloQuery:i&&this.interpolateProps(i,t),promQLQuery:o&&this.interpolateProps(o,t,{expr:this.interpolatePromQLQuery})})}getLabels(e,t,r,n,i){return Zr((function*(){const o={targets:[{refId:t,datasource:this.getRef(),queryType:fe.TIME_SERIES_LIST,timeSeriesList:et({projectName:this.templateSrv.replace(r),groupBys:this.interpolateGroupBys((null==n?void 0:n.groupBys)||[],{}),crossSeriesReducer:"REDUCE_NONE",view:"HEADERS"},this.templateSrv.replace(e))}],range:i||(0,v.getDefaultTimeRange)()},a=o.targets;return a.length?(0,Ar.lastValueFrom)((0,Ar.from)(this.ensureGCEDefaultProject()).pipe((0,Cr.mergeMap)((()=>this.backendSrv.fetch({url:"/api/ds/query",method:"POST",headers:this.getRequestHeaders(),data:{from:o.range.from.valueOf().toString(),to:o.range.to.valueOf().toString(),queries:a}}))),(0,Cr.map)((({data:e})=>{const t=(0,g.toDataQueryResponse)({data:e}),r=null==t?void 0:t.data.map((e=>{var t,r;return null===(r=e.meta)||void 0===r||null===(t=r.custom)||void 0===t?void 0:t.labels})).filter((e=>!!e)).reduce(((e,t)=>{for(let r in t)e[r]||(e[r]=new Set),t[r]&&e[r].add(t[r]);return e}),{});return Object.fromEntries(Object.entries(r).map((([e,t])=>[e,Array.from(t)])))})))):(0,Ar.lastValueFrom)((0,Ar.of)({results:[]}))})).call(this)}getGCEDefaultProject(){return Zr((function*(){return this.getResource("gceDefaultProject")})).call(this)}getDefaultProject(){const{defaultProject:e,authenticationType:t,gceDefaultProject:r}=this.instanceSettings.jsonData;return"gce"===t?r||"":e||""}ensureGCEDefaultProject(){return Zr((function*(){const{authenticationType:e,gceDefaultProject:t}=this.instanceSettings.jsonData;"gce"!==e||t||(this.instanceSettings.jsonData.gceDefaultProject=yield this.getGCEDefaultProject())})).call(this)}getMetricTypes(e){return Zr((function*(){return e?this.getResource(`metricDescriptors/v3/projects/${this.templateSrv.replace(e)}/metricDescriptors`):[]})).call(this)}filterMetricsByType(e,t){return Zr((function*(){return e?this.getResource(`metricDescriptors/v3/projects/${this.templateSrv.replace(e)}/metricDescriptors`,{filter:`metric.type : "${t}"`}):[]})).call(this)}getSLOServices(e){return Zr((function*(){return this.getResource(`services/v3/projects/${this.templateSrv.replace(e)}/services?pageSize=1000`)})).call(this)}getServiceLevelObjectives(e,t){return Zr((function*(){if(!t)return Promise.resolve([]);let{projectName:r,serviceId:n}=this.interpolateProps({projectName:e,serviceId:t});return this.getResource(`slo-services/v3/projects/${r}/services/${n}/serviceLevelObjectives`)})).call(this)}getProjects(){return this.getResource("projects")}migrateMetricTypeFilter(e,t){const r=["metric.type","=",e];return(null==t?void 0:t.length)?t.concat("AND",r):r}migrateQuery(e){const{hide:t,refId:r,datasource:n,key:i,queryType:o,maxLines:a,metric:u,intervalMs:l,type:c}=e,s=rn(e,["hide","refId","datasource","key","queryType","maxLines","metric","intervalMs","type"]);if(!(e.hasOwnProperty("metricQuery")||e.hasOwnProperty("sloQuery")||e.hasOwnProperty("timeSeriesQuery")||e.hasOwnProperty("timeSeriesList"))){let o=s.filters||[];return s.metricType&&(o=this.migrateMetricTypeFilter(s.metricType,o)),{datasource:n,key:i,refId:r,intervalMs:l,hide:t,queryType:"annotationQuery"===c?fe.ANNOTATION:fe.TIME_SERIES_LIST,timeSeriesList:tn(en({},s),{projectName:(0,y.get)(e,"projectName")||this.getDefaultProject(),filters:o,view:s.view||"FULL"})}}var p;if((0,y.has)(e,"metricQuery")&&["metrics",fe.ANNOTATION].includes(null!==(p=e.queryType)&&void 0!==p?p:"")){const t=(0,y.get)(e,"metricQuery");"mql"===t.editorMode?(e.timeSeriesQuery={projectName:t.projectName,query:t.query,graphPeriod:t.graphPeriod},e.queryType=fe.TIME_SERIES_QUERY):(e.timeSeriesList={projectName:t.projectName||this.getDefaultProject(),crossSeriesReducer:t.crossSeriesReducer,alignmentPeriod:t.alignmentPeriod,perSeriesAligner:t.perSeriesAligner,groupBys:t.groupBys,filters:t.filters,view:t.view,preprocessor:t.preprocessor},e.queryType=fe.TIME_SERIES_LIST,t.metricType&&(e.timeSeriesList.filters=this.migrateMetricTypeFilter(t.metricType,e.timeSeriesList.filters))),e.aliasBy=t.aliasBy,e=(0,y.omit)(e,"metricQuery")}if(e.queryType===fe.SLO&&(0,y.has)(e,"sloQuery.aliasBy")){const t=(0,y.get)(e,"sloQuery.aliasBy");"string"==typeof t&&(e.aliasBy=t),e=(0,y.omit)(e,"sloQuery.aliasBy")}return e}interpolatePromQLQuery(e,t){return(0,y.isArray)(e)?e.join("|"):e}interpolateProps(e,t={},r){return Object.entries(e).reduce(((e,[n,i])=>{let o=i;return i&&(0,y.isString)(i)&&(o=this.templateSrv.replace(i,t,r&&r[n])),tn(en({},e),{[n]:o})}),{})}filterQuery(e){if(e.hide)return!1;const t=this.migrateQuery(e);if(t.queryType===fe.SLO){if(!t.sloQuery)return!1;const{selectorName:e,serviceId:r,sloId:n,projectName:i,lookbackPeriod:o}=t.sloQuery;return!(!e||!r||!n||!i||e===Ie&&!o)}return t.queryType===fe.TIME_SERIES_QUERY?!!t.timeSeriesQuery&&!!t.timeSeriesQuery.projectName&&!!t.timeSeriesQuery.query:t.queryType&&[fe.TIME_SERIES_LIST,fe.ANNOTATION].includes(t.queryType)?!!t.timeSeriesList&&!!t.timeSeriesList.projectName&&!!Xe(t.timeSeriesList):t.queryType===fe.PROMQL&&!!(t.promQLQuery&&t.promQLQuery.projectName&&t.promQLQuery.expr&&t.promQLQuery.step)}interpolateVariablesInQueries(e,t){return e.map((e=>this.applyTemplateVariables(this.migrateQuery(e),t)))}interpolateFilters(e,t){const r=(0,y.chunk)(e,4).map((([e,t,r,n])=>en({key:e,operator:t,value:r},n&&{condition:n}))).filter((e=>e.value));return(0,y.flatten)(r.map((({key:e,operator:r,value:n,condition:i})=>[this.templateSrv.replace(e,t||{}),r,this.templateSrv.replace(n,t||{},(e=>(0,y.isArray)(e)&&e.length?`(${e.join("|")})`:e)),...i?[i]:[]])))||[]}interpolateGroupBys(e,t){let r=[];return(e||[]).forEach((e=>{const n=this.templateSrv.replace(e,t||{},"csv").split(",");Array.isArray(n)?r=r.concat(n):r.push(n)})),r}constructor(e,t=(0,g.getTemplateSrv)()){super(e),Xr(this,"instanceSettings",void 0),Xr(this,"templateSrv",void 0),Xr(this,"authenticationType",void 0),Xr(this,"intervalMs",void 0),Xr(this,"backendSrv",void 0),this.instanceSettings=e,this.templateSrv=t,this.authenticationType=e.jsonData.authenticationType||"jwt",this.variables=new Jr(this),this.intervalMs=0,this.annotations=Fr(this),this.backendSrv=(0,g.getBackendSrv)()}}const on="stackdriver",an=new v.DataSourcePlugin(nn).setQueryEditorHelp(j).setQueryEditor((e=>{var t,r;const{datasource:n,query:i,onRunQuery:o,onChange:a,range:u}=e,[l,c]=(0,O.useState)(!1);(0,O.useEffect)((()=>{const e=n.migrateQuery(i);le()(e,i)||a(Er({},e))}),[i,n,a]);const[s,p]=(0,O.useState)(i),[f,h]=(0,O.useState)(!1),d=Er({},{projectName:n.getDefaultProject(),alignmentPeriod:"cloud-monitoring-auto",perSeriesAligner:ve.ALIGN_MEAN,aliasBy:"",selectorName:"select_slo_health",serviceId:"",serviceName:"",sloId:"",sloName:"",lookbackPeriod:""},i.sloQuery);const g=Er({},{projectName:n.getDefaultProject(),expr:"",step:"10s"},i.promQLQuery),b=(null===(t=e.data)||void 0===t?void 0:t.series.length)?null===(r=e.data)||void 0===r?void 0:r.series[0].meta:{};var j;const E=null!==(j=null==b?void 0:b.custom)&&void 0!==j?j:{},S={label:"Template Variables",expanded:!1,options:n.getVariables().map(v.toOption)};(0,O.useEffect)((()=>{i.queryType&&Object.values(fe).includes(i.queryType)||a(Sr(Er({},i),{queryType:fe.TIME_SERIES_LIST}))}));const T=i.queryType;return(0,m.jsx)("span",{"data-testid":pe.queryEditor.container,children:(0,m.jsxs)(se,{children:[(0,m.jsx)(_.ConfirmModal,{"data-testid":"switch-query-type-modal",title:"Warning",body:"By switching your query type, your current query will be lost.",isOpen:l,onConfirm:()=>{c(!1),a(s),h(!1)},confirmText:"Confirm",onDismiss:()=>{c(!1),p(i)}}),(0,m.jsx)(ir,{query:i,onChange:e=>{!f||s.queryType!==fe.TIME_SERIES_LIST&&s.queryType!==fe.TIME_SERIES_QUERY?a(e):s.queryType!==e.queryType&&c(!0),p(e)},onRunQuery:o}),T===fe.PROMQL&&(0,m.jsx)(zt,{refId:i.refId,variableOptionGroup:S,onChange:e=>{a(Sr(Er({},i),{promQLQuery:e}))},onRunQuery:o,datasource:n,query:g}),T!==fe.SLO&&(0,m.jsx)(Vt,{refId:i.refId,variableOptionGroup:S,customMetaData:E,onChange:e=>{(e.queryType===fe.TIME_SERIES_LIST&&!(0,y.isEqual)(e.timeSeriesList,Bt(n))||e.queryType===fe.TIME_SERIES_QUERY&&!(0,y.isEqual)(e.timeSeriesQuery,qt(n)))&&h(!0),a(e)},onRunQuery:o,datasource:n,query:i,range:u||(0,v.getDefaultTimeRange)()}),T===fe.SLO&&(0,m.jsx)(jr,{refId:i.refId,variableOptionGroup:S,customMetaData:E,onChange:e=>{a(Sr(Er({},i),{sloQuery:e})),o()},onRunQuery:o,datasource:n,query:d,aliasBy:i.aliasBy,onChangeAliasBy:e=>a(Sr(Er({},i),{aliasBy:e}))})]})})})).setConfigEditor(ae).setVariableQueryEditor(Lr);return(0,g.getAppEvents)().subscribe(v.DashboardLoadedEvent,(({payload:{dashboardId:e,orgId:t,grafanaVersion:r,queries:n}})=>{const i=n[on];let o={[fe.TIME_SERIES_QUERY]:0,[fe.TIME_SERIES_LIST]:0,[fe.SLO]:0,[fe.ANNOTATION]:0,[fe.PROMQL]:0};var a;i.forEach((e=>{e.queryType===fe.TIME_SERIES_QUERY||e.queryType===fe.TIME_SERIES_LIST||e.queryType===fe.SLO||e.queryType===fe.ANNOTATION||e.queryType===fe.PROMQL?o[e.queryType]++:"metrics"===e.queryType&&(e.hasOwnProperty("type")&&"annotationQuery"===(0,y.get)(e,"type")&&o.annotation++,"mql"===(0,y.get)(e,"metricQuery.editorMode")?o.timeSeriesQuery++:o.timeSeriesList++)})),i&&i.length>0&&(a={grafana_version:r,dashboard_id:e,org_id:t,mql_queries:o[fe.TIME_SERIES_QUERY],time_series_filter_queries:o[fe.TIME_SERIES_LIST],slo_queries:o[fe.SLO],annotation_queries:o[fe.ANNOTATION],promQL_queries:o[fe.PROMQL]},(0,g.reportInteraction)("grafana_ds_cloudmonitoring_dashboard_loaded",a))})),f})()));
//# sourceMappingURL=module.js.map