"use strict";(globalThis.webpackChunktempo=globalThis.webpackChunktempo||[]).push([[9762],{3887:(e,t,r)=>{r.r(t),r.d(t,{default:()=>jt});var n=r(9728),a=r(6089),i=r(5959),o=r(7781),s=r(8531),l=r(2007),c=r(9605),u=r(8146),p=r.n(u);function d({query:e,lang:t,className:r}){const i=(0,l.useTheme2)(),o=g(i),s=p().highlight(e,t.grammar,t.name);return(0,n.jsx)("div",{className:(0,a.cx)(o.editorField,"prism-syntax-highlight",r),"aria-label":"selector",dangerouslySetInnerHTML:{__html:s}})}const g=e=>({editorField:(0,a.css)({fontFamily:e.typography.fontFamilyMonospace,fontSize:e.typography.bodySmall.fontSize})});var m=r(3292),h=r(2381),f=r(6490),y=r(4326);function v({title:e,children:t,collapsedInfo:r,queryStats:a,onToggle:i,isOpen:o}){const[c,u]=(0,h.A)(!1),p=(0,l.useStyles2)(b);return(0,n.jsxs)("div",{className:p.wrapper,children:[(0,n.jsx)(l.Collapse,{className:p.collapse,collapsible:!0,isOpen:null!=o?o:c,onToggle:null!=i?i:u,label:(0,n.jsxs)(l.Stack,{gap:0,children:[(0,n.jsx)("h6",{className:p.title,children:e}),!c&&(0,n.jsx)("div",{className:p.description,children:r.map(((e,t)=>(0,n.jsx)("span",{children:e},t)))})]}),children:(0,n.jsx)("div",{className:p.body,children:t})}),a&&s.config.featureToggles.lokiQuerySplitting&&(0,n.jsx)(l.Tooltip,{content:"Note: the query will be split into multiple parts and executed in sequence. Query limits will only apply each individual part.",children:(0,n.jsx)(l.Icon,{tabIndex:0,name:"info-circle",className:p.tooltip,size:"sm"})}),a&&(0,n.jsx)("p",{className:p.stats,children:M(a)})]})}const b=e=>({collapse:(0,a.css)({backgroundColor:"unset",border:"unset",marginBottom:0,"> button":{padding:e.spacing(0,1)}}),wrapper:(0,a.css)({width:"100%",display:"flex",justifyContent:"space-between",alignItems:"baseline"}),title:(0,a.css)({flexGrow:1,overflow:"hidden",fontSize:e.typography.bodySmall.fontSize,fontWeight:e.typography.fontWeightMedium,margin:0}),description:(0,a.css)({color:e.colors.text.secondary,fontSize:e.typography.bodySmall.fontSize,fontWeight:e.typography.bodySmall.fontWeight,paddingLeft:e.spacing(2),gap:e.spacing(2),display:"flex"}),body:(0,a.css)({display:"flex",gap:e.spacing(2),flexWrap:"wrap"}),stats:(0,a.css)({margin:"0px",color:e.colors.text.secondary,fontSize:e.typography.bodySmall.fontSize}),tooltip:(0,a.css)({marginRight:e.spacing(.25)})}),M=e=>e.message?e.message:`This query will process approximately ${j(e)}.`,j=e=>{const{text:t,suffix:r}=(0,o.getValueFormat)("bytes")(e.bytes,1);return t+r};var T=r(9638);function O(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function x(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){O(e,t,r[t])}))}return e}function A(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})),e}const S=(e,t)=>{const r=parseInt(e,10);return isNaN(r)?t:r},w=i.memo((({onChange:e,query:t,searchStreaming:r,metricsStreaming:a,app:i})=>{const s=(0,l.useStyles2)(I),[c,u]=(0,h.A)(!1),p=i===o.CoreApp.UnifiedAlerting,d=a&&!p;t.hasOwnProperty("limit")||(t.limit=T.eH),t.hasOwnProperty("tableType")||(t.tableType=m.Jv.Traces),t.hasOwnProperty("metricsQueryType")||(t.metricsQueryType=m.Ag.Range),p&&t.metricsQueryType===m.Ag.Range&&e(A(x({},t),{metricsQueryType:m.Ag.Instant}));const g=[`Limit: ${t.limit||T.eH}`,`Spans Limit: ${t.spss||T.m9}`,"Table Format: "+(t.tableType===m.Jv.Traces?"Traces":"Spans"),"|","Streaming: "+(r?"Enabled":"Disabled")],b=[`Step: ${t.step||"auto"}`,"Type: "+(t.metricsQueryType===m.Ag.Range?"Range":"Instant"),"|","Streaming: "+(d?"Enabled":"Disabled")];return(0,n.jsx)(f.U,{children:(0,n.jsxs)("div",{className:s.options,children:[!p&&(0,n.jsxs)(v,{title:"Search Options",collapsedInfo:g,isOpen:c,onToggle:u,children:[(0,n.jsx)(y.c,{label:"Limit",tooltip:"Maximum number of traces to return.",children:(0,n.jsx)(l.AutoSizeInput,{className:"width-4",placeholder:"auto",type:"number",min:1,defaultValue:t.limit||T.eH,onCommitChange:r=>{e(A(x({},t),{limit:S(r.currentTarget.value,T.eH)}))},value:t.limit})}),(0,n.jsx)(y.c,{label:"Span Limit",tooltip:"Maximum number of spans to return for each span set.",children:(0,n.jsx)(l.AutoSizeInput,{className:"width-4",placeholder:"auto",type:"number",min:1,defaultValue:t.spss||T.m9,onCommitChange:r=>{e(A(x({},t),{spss:S(r.currentTarget.value,T.m9)}))},value:t.spss})}),(0,n.jsx)(y.c,{label:"Table Format",tooltip:"How the query data should be displayed in the results table",children:(0,n.jsx)(l.RadioButtonGroup,{options:[{label:"Traces",value:m.Jv.Traces},{label:"Spans",value:m.Jv.Spans}],value:t.tableType,onChange:r=>{e(A(x({},t),{tableType:r}))}})}),(0,n.jsx)(y.c,{label:"Streaming",tooltip:(0,n.jsx)(C,{}),tooltipInteractive:!0,children:(0,n.jsx)("div",{children:r?"Enabled":"Disabled"})})]}),(0,n.jsxs)(v,{title:"Metrics Options",collapsedInfo:b,isOpen:c,onToggle:u,children:[!p&&(0,n.jsx)(y.c,{label:"Step",tooltip:"Defines the step for metric queries. Use duration notation, for example 30s or 1m",children:(0,n.jsx)(l.AutoSizeInput,{className:"width-4",placeholder:"auto",type:"string",defaultValue:t.step,onCommitChange:r=>{e(A(x({},t),{step:r.currentTarget.value}))},value:t.step})}),(0,n.jsx)(y.c,{label:"Type",tooltip:"Type of metrics query to run",children:(0,n.jsx)(l.RadioButtonGroup,{options:[{label:"Range",value:m.Ag.Range},{label:"Instant",value:m.Ag.Instant}],value:t.metricsQueryType,onChange:r=>{e(A(x({},t),{metricsQueryType:r}))},disabled:p})}),(0,n.jsx)(y.c,{label:"Streaming",tooltip:(0,n.jsx)(C,{}),tooltipInteractive:!0,children:(0,n.jsx)("div",{children:d?"Enabled":"Disabled"})})]})]})})})),C=()=>(0,n.jsxs)("div",{style:{display:"flex",gap:"4px"},children:[(0,n.jsx)("span",{children:"Indicates if streaming is currently enabled. Streaming allows you to view partial query results before the entire query completes."}),(0,n.jsx)(l.TextLink,{external:!0,href:"https://grafana.com/docs/tempo/latest/traceql/#stream-query-results","aria-label":"Learn more about streaming query results",style:{textDecoration:"underline"},children:"Learn more"})]});w.displayName="TempoQueryBuilderOptions";const I=e=>({options:(0,a.css)({display:"flex",width:"-webkit-fill-available",gap:e.spacing(1),"> div":{width:"auto"}})});var N=r(103);function D({query:e,onChange:t}){return e.groupBy?(0,n.jsxs)(l.Alert,{title:"",severity:"info",children:["The aggregate by feature has been removed. We recommend using Traces Drilldown app instead.  ",(0,n.jsx)(l.Button,{onClick:t,children:"Remove aggregate by from this query"})]}):null}var P=r(9183);function E(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){E(e,t,r[t])}))}return e}function R(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})),e}const L=/^(\$\w+)|(\d+(?:\.\d)?\d*(?:us|µs|ns|ms|s|m|h))$/,z=()=>({noBoxShadow:(0,a.css)({boxShadow:"none","*:focus":{boxShadow:"none"}})}),k=({filter:e,operators:t,updateFilter:r})=>{const a=(0,l.useStyles2)(z);let i=!1;return"string"==typeof e.value&&(i=!!e.value&&!L.test(e.value.concat(""))),(0,n.jsxs)(l.Stack,{gap:0,children:[(0,n.jsx)(l.Select,{className:a.noBoxShadow,inputId:`${e.id}-operator`,options:t.map(P.wu),value:e.operator,onChange:t=>{r(R(_({},e),{operator:null==t?void 0:t.value}))},isClearable:!1,"aria-label":`select ${e.id} operator`,allowCustomValue:!0,width:8}),(0,n.jsx)(l.Input,{className:a.noBoxShadow,value:e.value,onChange:t=>{r(R(_({},e),{value:t.currentTarget.value}))},placeholder:"e.g. 100ms, 1.2s","aria-label":`select ${e.id} value`,invalid:i,width:18})]})},F=({label:e,tooltip:t,children:r})=>(0,n.jsx)(l.InlineFieldRow,{children:(0,n.jsx)(l.InlineField,{label:e,labelWidth:28,grow:!0,tooltip:t,children:r})});var q=r(318),Q=r(5876);function V(e,t,r,n,a,i,o){try{var s=e[i](o),l=s.value}catch(e){return void r(e)}s.done?t(l):Promise.resolve(l).then(n,a)}function U(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Y(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){U(e,t,r[t])}))}return e}function W(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})),e}const B=["min-duration","max-duration","status"],$=({datasource:e,query:t,onChange:r,onClearResults:a,app:o,addVariablesToOptions:u=!0,range:p})=>{var g,h,f,y,v,b;const M=(0,l.useStyles2)(G),[j,T]=(0,i.useState)(),[O,x]=(0,i.useState)(null),[A,S]=(0,i.useState)(!0),[C,I]=(0,i.useState)(""),E=(0,s.getTemplateSrv)(),_=(0,i.useCallback)((e=>{var n;const a=Y({},t);(n=a).filters||(n.filters=[]);const i=a.filters.findIndex((t=>t.id===e.id));i>=0?a.filters=(0,P._D)(a.filters,i,e):a.filters.push(e),r(a)}),[r,t]),R=(0,s.getTemplateSrv)().getVariables();(0,i.useEffect)((()=>{I(e.languageProvider.generateQueryFromFilters({traceqlFilters:(0,P.tH)(t.filters||[])}))}),[e.languageProvider,t,R]);const L=(0,i.useCallback)((e=>{var r;return null===(r=t.filters)||void 0===r?void 0:r.find((t=>t.id===e))}),[t.filters]);(0,i.useEffect)((()=>{var t;(t=function*(){try{yield e.languageProvider.start(p,e.timeRangeForTags),S(!1),T(void 0)}catch(e){e instanceof Error&&T(`Error: ${e.message}`)}},function(){var e=this,r=arguments;return new Promise((function(n,a){var i=t.apply(e,r);function o(e){V(i,n,a,o,s,"next",e)}function s(e){V(i,n,a,o,s,"throw",e)}o(void 0)}))})()}),[e,T,p,e.timeRangeForTags]),(0,i.useEffect)((()=>{var t,r;null===(r=e.search)||void 0===r||null===(t=r.filters)||void 0===t||t.filter((e=>e.value)).forEach((e=>{L(e.id)||_(e)}))}),[null===(g=e.search)||void 0===g?void 0:g.filters,L,_]);const z=(null===(f=e.search)||void 0===f||null===(h=f.filters)||void 0===h?void 0:h.map((e=>e.tag)))||[];z.push("duration"),z.push("traceDuration"),z.push("span:duration"),z.push("trace:duration"),z.push("status"),z.push("span:status");const U=(t.filters||[]).filter((t=>{var r,n;return!B.includes(t.id)&&-1===((null===(n=e.search)||void 0===n||null===(r=n.filters)||void 0===r?void 0:r.findIndex((e=>e.id===t.id)))||0)&&"duration-type"!==t.id})),$=r=>{var n;if(!r)return C;const a=(null===(n=t.filters)||void 0===n?void 0:n.filter((e=>e.id!==r.id)))||[];return e.languageProvider.generateQueryFromFilters({traceqlFilters:(0,P.tH)(a||[])})};var Z,K,H;return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{className:M.container,children:[(0,n.jsxs)("div",{children:[null===(v=e.search)||void 0===v||null===(y=v.filters)||void 0===y?void 0:y.map((t=>t.tag&&(0,n.jsx)(F,{label:(0,P.hr)(t,e.languageProvider),tooltip:`Filter your search by ${(0,P.pE)(t,e.languageProvider)}. To modify the default filters shown for search visit the Tempo datasource configuration page.`,children:(0,n.jsx)(q.A,{filter:L(t.id)||t,datasource:e,setError:x,updateFilter:_,tags:[],hideScope:!0,hideTag:!0,query:$(L(t.id)),addVariablesToOptions:u,range:p,timeRangeForTags:e.timeRangeForTags})},t.id))),(0,n.jsx)(F,{label:"Status",children:(0,n.jsx)(q.A,{filter:L("status")||{id:"status",tag:"status",scope:m.d.Intrinsic,operator:"="},datasource:e,setError:x,updateFilter:_,tags:[],hideScope:!0,hideTag:!0,query:$(L("status")),isMulti:!1,allowCustomValue:!1,addVariablesToOptions:u,range:p,timeRangeForTags:e.timeRangeForTags})}),(0,n.jsx)(F,{label:"Duration",tooltip:"The trace or span duration, i.e. end - start time of the trace/span. Accepted units are ns, ms, s, m, h",children:(0,n.jsxs)(l.Stack,{gap:0,children:[(0,n.jsx)(l.Select,{width:"auto",options:[{label:"span",value:"span"},{label:"trace",value:"trace"}],value:null!==(Z=null===(b=L("duration-type"))||void 0===b?void 0:b.value)&&void 0!==Z?Z:"span",onChange:e=>{const t=L("duration-type")||{id:"duration-type",value:"span"};_(W(Y({},t),{value:null==e?void 0:e.value}))},"aria-label":"duration type"}),(0,n.jsx)(k,{filter:L("min-duration")||{id:"min-duration",tag:"duration",operator:">",valueType:"duration"},operators:[">",">="],updateFilter:_}),(0,n.jsx)(k,{filter:L("max-duration")||{id:"max-duration",tag:"duration",operator:"<",valueType:"duration"},operators:["<","<="],updateFilter:_})]})}),(0,n.jsx)(F,{label:"Tags",children:(0,n.jsx)(Q.A,{filters:U,datasource:e,setError:x,updateFilter:_,deleteFilter:e=>{r(W(Y({},t),{filters:t.filters.filter((t=>t.id!==e.id))}))},staticTags:z,isTagsLoading:A,generateQueryWithoutFilter:$,requireTagAndValue:!0,addVariablesToOptions:u,range:p,timeRangeForTags:e.timeRangeForTags})}),(0,n.jsx)(D,{query:t,onChange:()=>{delete t.groupBy,r(Y({},t))}})]}),(0,n.jsxs)("div",{className:M.rawQueryContainer,children:[(0,n.jsx)(d,{query:E.replace(C),lang:{grammar:N.UD,name:"traceql"}}),(0,n.jsx)(l.Button,{variant:"secondary",size:"sm",onClick:()=>{(0,s.reportInteraction)("grafana_traces_copy_to_traceql_clicked",{app:null!=o?o:"",grafana_version:s.config.buildInfo.version,location:"search_tab"}),a();const n=e.languageProvider.generateQueryFromFilters({traceqlFilters:t.filters||[]});r(W(Y({},t),{query:n,queryType:"traceql"}))},children:"Edit in TraceQL"})]}),(0,n.jsx)(w,{onChange:r,query:t,searchStreaming:null!==(K=e.isStreamingSearchEnabled())&&void 0!==K&&K,metricsStreaming:null!==(H=e.isStreamingMetricsEnabled())&&void 0!==H&&H,app:o})]}),O?(0,n.jsxs)(l.Alert,{title:"Unable to connect to Tempo search",severity:"info",className:M.alert,children:["Please ensure that Tempo is configured with search enabled. If you would like to hide this tab, you can configure it in the ",(0,n.jsx)(l.TextLink,{href:`/datasources/edit/${e.uid}`,children:"datasource settings"}),"."]}):null,j&&(0,n.jsx)(c.C,{severity:"error",text:j})]})},G=e=>({alert:(0,a.css)({maxWidth:"75ch",marginTop:e.spacing(2)}),container:(0,a.css)({display:"flex",gap:"4px",flexWrap:"wrap",flexDirection:"column"}),rawQueryContainer:(0,a.css)({alignItems:"center",backgroundColor:e.colors.background.secondary,display:"flex",justifyContent:"space-between",padding:e.spacing(1)})});var Z=r(1777),K=r(3437);function H(e,t,r,n,a,i,o){try{var s=e[i](o),l=s.value}catch(e){return void r(e)}s.done?t(l):Promise.resolve(l).then(n,a)}function J(e){return function(){var t=this,r=arguments;return new Promise((function(n,a){var i=e.apply(t,r);function o(e){H(i,n,a,o,s,"next",e)}function s(e){H(i,n,a,o,s,"throw",e)}o(void 0)}))}}const X=({datasource:e,onChange:t,disabled:r,filterKey:a,allFilters:i})=>{const o=()=>ne(e,a,i);return null===a?(0,n.jsx)("div",{className:"gf-form","data-testid":"AdHocFilterKey-add-key-wrapper",children:(0,n.jsx)(l.SegmentAsync,{disabled:r,className:"query-segment-key",Component:re,value:a,onChange:t,loadOptions:o,inputMinWidth:90})}):(0,n.jsx)("div",{className:"gf-form","data-testid":"AdHocFilterKey-key-wrapper",children:(0,n.jsx)(l.SegmentAsync,{disabled:r,className:"query-segment-key",value:a,onChange:t,loadOptions:()=>ae(e,a,i),inputMinWidth:90})})},ee="-- remove filter --",te={label:ee,value:ee},re=(0,n.jsx)("span",{className:"gf-form-label query-part","aria-label":"Add Filter",children:(0,n.jsx)(l.Icon,{name:"plus"})}),ne=(e,t,r)=>J((function*(){const n=yield(0,s.getDataSourceSrv)().get(e);if(!n||!n.getTagKeys)return[];const a=r.filter((e=>e.key!==t)),i=yield n.getTagKeys({filters:a});return(Array.isArray(i)?i:i.data).map((e=>({label:e.text,value:e.text})))}))(),ae=(e,t,r)=>J((function*(){const n=yield ne(e,t,r);return[te,...n]}))();function ie(e,t,r,n,a,i,o){try{var s=e[i](o),l=s.value}catch(e){return void r(e)}s.done?t(l):Promise.resolve(l).then(n,a)}const oe=({datasource:e,disabled:t,onChange:r,filterKey:a,filterValue:i,placeHolder:o,allFilters:s})=>(0,n.jsx)("div",{className:"gf-form","data-testid":"AdHocFilterValue-value-wrapper",children:(0,n.jsx)(l.SegmentAsync,{className:"query-segment-value",disabled:t,placeholder:o,value:i,onChange:r,loadOptions:()=>se(e,a,s)})}),se=(e,t,r)=>{return(n=function*(){const n=yield(0,s.getDataSourceSrv)().get(e);if(!n||!n.getTagValues)return[];const a=(0,o.getDefaultTimeRange)(),i=r.filter((e=>e.key!==t)),l=yield n.getTagValues({key:t,filters:i,timeRange:a});return(Array.isArray(l)?l:l.data).map((e=>({label:e.text,value:e.text})))},function(){var e=this,t=arguments;return new Promise((function(r,a){var i=n.apply(e,t);function o(e){ie(i,r,a,o,s,"next",e)}function s(e){ie(i,r,a,o,s,"throw",e)}o(void 0)}))})();var n},le=["=","!=","<",">","=~","!~"].map((e=>({label:e,value:e}))),ce=({value:e,disabled:t,onChange:r})=>(0,n.jsx)(l.Segment,{className:"query-segment-operator",value:e,disabled:t,options:le,onChange:r}),ue=({datasource:e,filter:{key:t,operator:r,value:a},onKeyChange:i,onOperatorChange:o,onValueChange:s,placeHolder:l,allFilters:c,disabled:u})=>(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(X,{disabled:u,datasource:e,filterKey:t,onChange:i,allFilters:c}),(0,n.jsx)("div",{className:"gf-form",children:(0,n.jsx)(ce,{disabled:u,value:r,onChange:o})}),(0,n.jsx)(oe,{disabled:u,datasource:e,filterKey:t,filterValue:a,allFilters:c,onChange:s,placeHolder:l})]}),pe=K.Ay.t,de=({datasource:e,appendBefore:t,onCompleted:r,allFilters:a})=>{const[o,s]=(0,i.useState)(null),[l,c]=(0,i.useState)("="),u=(0,i.useCallback)((e=>{var t;e.value===ee?s(null):s(null!==(t=e.value)&&void 0!==t?t:"")}),[s]),p=(0,i.useCallback)((e=>{var t;return c(null!==(t=e.value)&&void 0!==t?t:"")}),[c]),d=(0,i.useCallback)((e=>{var t;r({value:null!==(t=e.value)&&void 0!==t?t:"",operator:l,key:o}),s(null),c("=")}),[r,l,o]);return null===o?(0,n.jsx)(X,{datasource:e,filterKey:o,onChange:u,allFilters:a}):(0,n.jsxs)(i.Fragment,{children:[t,(0,n.jsx)(ue,{datasource:e,filter:{key:o,value:"",operator:l},placeHolder:(g="variable.adhoc.placeholder",m="Select value",pe(g,m,h)),onKeyChange:u,onOperatorChange:p,onValueChange:d,allFilters:a})]},"filter-builder");var g,m,h},ge=({label:e})=>(0,n.jsx)("div",{className:"gf-form",children:(0,n.jsx)("span",{className:"gf-form-label query-keyword",children:e})});function me(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function he(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})),e}class fe extends i.PureComponent{render(){const{filters:e,disabled:t}=this.props;return(0,n.jsxs)("div",{className:"gf-form-inline",children:[this.renderFilters(e,t),!t&&(0,n.jsx)(de,{datasource:this.props.datasource,appendBefore:e.length>0?(0,n.jsx)(ge,{label:"AND"}):null,onCompleted:this.appendFilterToVariable,allFilters:this.getAllFilters()})]})}getAllFilters(){return this.props.baseFilters?this.props.baseFilters.concat(this.props.filters):this.props.filters}renderFilters(e,t){return 0===e.length&&t?(0,n.jsx)(l.Segment,{disabled:t,value:"No filters",options:[],onChange:()=>{}}):e.reduce(((e,r,a)=>(e.length>0&&e.push((0,n.jsx)(ge,{label:"AND"},`condition-${a}`)),e.push(this.renderFilterSegments(r,a,t)),e)),[])}renderFilterSegments(e,t,r){return(0,n.jsx)(i.Fragment,{children:(0,n.jsx)(ue,{disabled:r,datasource:this.props.datasource,filter:e,onKeyChange:this.onChange(t,"key"),onOperatorChange:this.onChange(t,"operator"),onValueChange:this.onChange(t,"value"),allFilters:this.getAllFilters()})},`filter-${t}`)}constructor(...e){super(...e),me(this,"onChange",((e,t)=>r=>{const{filters:n}=this.props,{value:a}=r;return r.value===ee?this.props.removeFilter(e):this.props.changeFilter(e,he(function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){me(e,t,r[t])}))}return e}({},n[e]),{[t]:a}))})),me(this,"appendFilterToVariable",(e=>{this.props.addFilter(e)}))}}var ye=r(5645);function ve(e,t,r,n,a,i,o){try{var s=e[i](o),l=s.value}catch(e){return void r(e)}s.done?t(l):Promise.resolve(l).then(n,a)}function be(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Me(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){be(e,t,r[t])}))}return e}function je(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})),e}function Te({graphDatasourceUid:e,query:t,onChange:r}){const a=(0,l.useStyles2)(Ae),o=(0,Z.A)((()=>(0,ye.q$)(e)),[e]),[s,c]=(0,i.useState)(void 0);if((0,i.useEffect)((()=>{!o.loading&&o.value&&function(e){(function(e){return function(){var t=this,r=arguments;return new Promise((function(n,a){var i=e.apply(t,r);function o(e){ve(i,n,a,o,s,"next",e)}function s(e){ve(i,n,a,o,s,"throw",e)}o(void 0)}))}})((function*(){const t=yield e.getTagKeys({filters:[{key:"__name__",operator:"=~",value:"traces_service_graph_request_server_seconds_sum|traces_service_graph_request_total|traces_service_graph_request_failed_total",condition:""}]});c(Boolean(t.length))}))()}(o.value)}),[o]),o.loading)return null;const u=o.value;if(!e)return Oe("No service graph datasource selected","Please set up a service graph datasource in the datasource settings",a);if(e&&!u)return Oe("No service graph data found","Service graph datasource is configured but the data source no longer exists. Please configure existing data source to use the service graph functionality",a);const p=function(e){let t,r=[];const n=/([\w_]+)(=|!=|<|>|=~|!~)"(.*?)"/g;for(;null!==(t=n.exec(e));)r.push({key:t[1],operator:t[2],value:t[3],condition:""});return r}((Array.isArray(t.serviceMapQuery)?t.serviceMapQuery[0]:t.serviceMapQuery)||"");return(0,n.jsxs)("div",{children:[(0,n.jsx)(l.InlineFieldRow,{children:(0,n.jsx)(l.InlineField,{label:"Filter",labelWidth:14,grow:!0,children:(0,n.jsx)(fe,{datasource:{uid:e},filters:p,baseFilters:[{key:"__name__",operator:"=~",value:"traces_service_graph_request_total|traces_spanmetrics_calls_total",condition:""}],addFilter:e=>{r(je(Me({},t),{serviceMapQuery:xe([...p,e])}))},removeFilter:e=>{const n=[...p];n.splice(e,1),r(je(Me({},t),{serviceMapQuery:xe(n)}))},changeFilter:(e,n)=>{const a=[...p];a.splice(e,1,n),r(je(Me({},t),{serviceMapQuery:xe(a)}))}})})}),!1===s?Oe("No service graph data found","Please ensure that service graph metrics are set up correctly",a):null]})}function Oe(e,t,r){return(0,n.jsxs)(l.Alert,{title:e,severity:"info",className:r.alert,children:[t," according to the"," ",(0,n.jsx)(l.TextLink,{external:!0,href:"https://grafana.com/docs/grafana/latest/datasources/tempo/service-graph/",children:"Tempo documentation"}),"."]})}function xe(e){return`{${e.map((e=>`${e.key}${e.operator}"${e.value}"`)).join(",")}}`}const Ae=e=>({alert:(0,a.css)({maxWidth:"75ch",marginTop:e.spacing(2)})});var Se=r(3241);const we={};var Ce=r(9607),Ie=r(6417),Ne=r(3731);function De(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Pe(e,t){const r=e.cursorAt(t);do{if(r.from===t||r.to===t){const{node:e}=r;if(e.type.isError)return e}}while(r.next());return null}function Ee(e,t){return e[t]}function _e(e,t){let r=e;for(const[e,n]of t){if(r=Ee(r,e),null===r)return null;if(void 0===n.find((e=>e===(null==r?void 0:r.type.id))))return null}return r}function Re(e,t){return t.slice(e.from===e.to?e.from-1:e.from,e.to)}function Le(e,t){return e.every(((e,r)=>e===t[r]))}function ze(e,t){if(""===e)return{query:e,type:"EMPTY"};const r=e.substring(0,t);if(/\bwith\s*\(\s*$/.test(r))return{query:e,type:"QUERY_HINT_NAME"};if(/\bwith\s*\(\s*\w+\s*=\s*[\w]*$/.test(r))return{query:e,type:"QUERY_HINT_VALUE"};const n=Ne.K3.parse(e);let a=t;for(;a-1>=0&&" "===e[a-1];)a-=1;let i=Pe(n,a);i||(i=Pe(n,a-1)),i||(i=Pe(n,a+1));const o=null!=i?i.cursor():n.cursorAt(a),s=o.node,l=[o.type.id];for(;o.parent();)l.push(o.type.id);let c;for(let r of ke)Le(r.path,l)&&(c=r.fun(s,e,a,t));return function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){De(e,t,r[t])}))}return e}({query:e},null!=c?c:{type:"UNKNOWN"})}const ke=[{path:[0,Ne.d4],fun:function(e,t){const r=_e(e,[["parent",[Ne.d4]]]),n=r?Re(r,t):"";if("."===n)return{type:"SPANSET_ONLY_DOT"};const a=n.indexOf("."),i=n.slice(0,a);if(["event","instrumentation","link","resource","span","parent"].find((e=>e===i)))return{type:"SPANSET_IN_NAME_SCOPE",scope:i};return{type:"SPANSET_IN_NAME"}}},{path:[0,Ne.v5],fun:Qe},{path:[0,Ne.NA],fun:function(e,t,r){const n=Fe(e,t,r);if(n)return n;return{type:"SPANSET_EXPRESSION_OPERATORS_WITH_MISSING_CLOSED_BRACE"}}},{path:[0,Ne.S6],fun:Ue},{path:[0,Ne.sd],fun:Ue},{path:[0,Ne.vp],fun:Ue},{path:[0,Ne.yl],fun:Ue},{path:[0,Ne.zs],fun:function(e,t,r){var n;if((null===(n=e.prevSibling)||void 0===n?void 0:n.type.id)===Ne.nT)return{type:"SPANSET_PIPELINE_AFTER_OPERATOR"};return{type:"NEW_SPANSET"}}},{path:[0,Ne.T,Ne.$f],fun:function(e,t,r){var n;if((null===(n=e.prevSibling)||void 0===n?void 0:n.type.id)!==Ne.LU)return{type:"SPANSET_COMPARISON_OPERATORS"}}},{path:[Ne.v5],fun:qe},{path:[Ne.NA],fun:qe},{path:[Ne.zs],fun:Ve},{path:[Ne.z],fun:Ve},{path:[Ne.Qf,Ne.jC],fun:Qe}],Fe=(e,t,r)=>{const n=e=>{const r=_e(e,[["firstChild",[Ne.d4]]]),n=r?Re(r,t):"",a=n.indexOf(".");return n.slice(0,a)};if(" "===t[r-1])return;const a=_e(e,[["firstChild",[Ne.v5]]]);if(a)return{type:"SPANSET_IN_NAME_SCOPE",scope:n(a)};const i=_e(e,[["parent",[Ne.NA]],["firstChild",[Ne.v5]]]);return i&&" "!==t[r]?{type:"SPANSET_IN_NAME_SCOPE",scope:n(i)}:void 0};function qe(e,t,r,n){const a=Fe(e,t,n);if(a)return a;let i=_e(e,[["firstChild",[Ne.v5]],["firstChild",[Ne.d4]]]);return i?{type:"SPANSET_EXPRESSION_OPERATORS"}:(i=_e(e,[["lastChild",[Ne.v5]],["lastChild",[Ne.v5]],["lastChild",[Ne.jC]]]),i?{type:"SPANFIELD_COMBINING_OPERATORS"}:(i=_e(e,[["lastChild",[Ne.v5]]]),i?{type:"SPANSET_EXPRESSION_OPERATORS"}:{type:"SPANSET_EMPTY"}))}function Qe(e,t,r,n){var a,i,o;const s=Fe(e,t,n);if(s)return s;if(_e(e,[["parent",[Ne.jC]],["parent",[Ne.v5]],["prevSibling",[Ne.Ib]]])){var l,c,u;let r=null===(u=e.parent)||void 0===u||null===(c=u.parent)||void 0===c||null===(l=c.prevSibling)||void 0===l?void 0:l.prevSibling;if(r)return{type:"SPANSET_IN_VALUE",tagName:Re(r,t),betweenQuotes:!0}}if((null===(a=e.prevSibling)||void 0===a?void 0:a.type.id)===Ne.Ib){var p;let r=null===(p=e.prevSibling)||void 0===p?void 0:p.prevSibling;if(r)return{type:"SPANSET_IN_VALUE",tagName:Re(r,t),betweenQuotes:!1}}return"And"===(null===(i=e.prevSibling)||void 0===i?void 0:i.type.name)||"Or"===(null===(o=e.prevSibling)||void 0===o?void 0:o.type.name)?{type:"SPANSET_EMPTY"}:{type:"SPANSET_IN_THE_MIDDLE"}}function Ve(e,t,r){let n=e.firstChild;try{for(n=e.firstChild;n.to<r;)n=n.nextSibling}catch(e){console.error("Unexpected error while searching for previous node",e)}return(null==n?void 0:n.type.id)===Ne.KD||(null==n?void 0:n.type.id)===Ne.Or?{type:"NEW_SPANSET"}:{type:"SPANSET_COMBINING_OPERATORS"}}function Ue(e,t,r){const n=null==e?void 0:e.parent;if(n&&[Ne.sd,Ne.S6,Ne.vp,Ne.yl,Ne.oL].includes(n.type.id))return{type:"ATTRIBUTE_FOR_FUNCTION"}}function Ye(e,t,r,n,a,i,o){try{var s=e[i](o),l=s.value}catch(e){return void r(e)}s.done?t(l):Promise.resolve(l).then(n,a)}function We(e){return function(){var t=this,r=arguments;return new Promise((function(n,a){var i=e.apply(t,r);function o(e){Ye(i,n,a,o,s,"next",e)}function s(e){Ye(i,n,a,o,s,"throw",e)}o(void 0)}))}}function Be(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function $e(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){Be(e,t,r[t])}))}return e}function Ge(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})),e}class Ze{provideCompletionItems(e,t){var r;if(!this.monaco||!this.editor)throw new Error("provideCompletionItems called before CompletionProvider was initialized");if((null===(r=this.editor.getModel())||void 0===r?void 0:r.id)!==e.id)return{suggestions:[]};const{range:n,offset:a}=function(e,t,r){const n=t.getWordAtPosition(r),a=null!=n?e.Range.lift({startLineNumber:r.lineNumber,endLineNumber:r.lineNumber,startColumn:n.startColumn,endColumn:n.endColumn}):e.Range.fromPositions(r),i={column:r.column,lineNumber:r.lineNumber},o=t.getOffsetAt(i);return{offset:o,range:a}}(this.monaco,e,t),i=ze(e.getValue(),a);return(null!=i?this.getCompletions(i,this.setAlertText):Promise.resolve([])).then((t=>{var r;const i=function(e,t,r="noOp",n,a){var i;const[o,s,l]=null!==(i=n.substring(0,a).match(He))&&void 0!==i?i:[],c=e.length.toString().length,u=e.map(((e,n)=>{const i={kind:Ke(e.type),label:e.label,insertText:e.insertText,insertTextRules:e.insertTextRules,detail:e.detail,documentation:e.documentation,sortText:n.toString().padStart(c,"0"),range:t,command:{id:r,title:"Report Interaction",arguments:[e.label,e.type]}};return l&&"TAG_NAME"===e.type&&function(e,t,r,n){null==n&&"."!==e.insertText[0]&&(e.insertText="."+e.insertText);e.range=Ge($e({},e.range),{startColumn:t-r.length+1})}(i,a,l,s),i}));return u}(t,n,null!==(r=this.registerInteractionCommandId)&&void 0!==r?r:void 0,e.getValue(),a);return{suggestions:i}}))}setRegisterInteractionCommandId(e){this.registerInteractionCommandId=e}getTagValues(e,t,r,n){return We((function*(){let a;const i=`${e}:${t}`;return this.cachedValues.hasOwnProperty(i)?a=this.cachedValues[i]:(a=yield this.languageProvider.getOptionsV2({tag:e,query:t,timeRangeForTags:r,range:n}),this.cachedValues[i]=a),a})).call(this)}getCompletions(e,t){return We((function*(){switch(e.type){case"UNKNOWN":return[];case"EMPTY":return this.getScopesCompletions("{ ","$0 }").concat(this.getIntrinsicsCompletions("{ ","$0 }")).concat(this.getTagsCompletions("{ ."));case"SPANSET_EMPTY":case"ATTRIBUTE_FOR_FUNCTION":return this.getScopesCompletions().concat(this.getIntrinsicsCompletions()).concat(this.getTagsCompletions("."));case"SPANSET_ONLY_DOT":return this.getTagsCompletions();case"SPANSET_IN_THE_MIDDLE":case"SPANSET_EXPRESSION_OPERATORS_WITH_MISSING_CLOSED_BRACE":return this.getOperatorsCompletions([...Ze.comparisonOps,...Ze.logicalOps]);case"SPANSET_IN_NAME":return this.getScopesCompletions().concat(this.getIntrinsicsCompletions()).concat(this.getTagsCompletions());case"SPANSET_IN_NAME_SCOPE":return this.getTagsCompletions(void 0,e.scope);case"SPANSET_EXPRESSION_OPERATORS":return this.getOperatorsCompletions([...Ze.comparisonOps,...Ze.logicalOps,...Ze.arithmeticOps]);case"SPANFIELD_COMBINING_OPERATORS":return this.getOperatorsCompletions([...Ze.logicalOps,...Ze.arithmeticOps,...Ze.comparisonOps]);case"SPANSET_COMBINING_OPERATORS":const r=Ze.queryHints.map((e=>Ge($e({},e),{insertTextRules:Ie.eo.CompletionItemInsertTextRule.InsertAsSnippet,type:"KEYWORD"})));return[...this.getOperatorsCompletions(Ze.spansetOps),...r];case"SPANSET_PIPELINE_AFTER_OPERATOR":return[...Ze.functions.map((e=>Ge($e({},e),{insertTextRules:Ie.eo.CompletionItemInsertTextRule.InsertAsSnippet,type:"FUNCTION"}))),...this.getScopesCompletions().concat(this.getIntrinsicsCompletions()).concat(this.getTagsCompletions("."))];case"SPANSET_COMPARISON_OPERATORS":return this.getOperatorsCompletions(Ze.comparisonOps);case"SPANSET_IN_VALUE":let n;try{n=yield this.getTagValues(e.tagName,e.query,this.timeRangeForTags,this.range),t(void 0)}catch(e){(0,s.isFetchError)(e)?t(e.data.error):e instanceof Error&&t(`Error: ${e.message}`)}const a=t=>e.betweenQuotes?t.label:"string"===t.type?`"${t.label}"`:t.label,i=[];return null==n||n.forEach((e=>{(null==e?void 0:e.label)&&i.push({label:e.label,insertText:a(e),type:"TAG_VALUE"})})),i;case"SPANSET_AFTER_VALUE":return Ze.logicalOps.map((e=>({label:e.label,insertText:e.insertText+"}",type:"OPERATOR"})));case"NEW_SPANSET":return this.getScopesCompletions("{ ","$0 }").concat(this.getIntrinsicsCompletions("{ ","$0 }")).concat(this.getTagsCompletions("."));case"QUERY_HINT_NAME":return Ze.withParameters.map((e=>Ge($e({},e),{type:"TAG_NAME",insertTextRules:Ie.eo.CompletionItemInsertTextRule.InsertAsSnippet})));case"QUERY_HINT_VALUE":return Ze.withValues.map((e=>Ge($e({},e),{type:"TAG_VALUE"})));default:throw new Error(`Unexpected situation ${e}`)}})).call(this)}getTagsCompletions(e,t){return function(e,t=""){return e.sort(Je.compare).map((e=>({label:e,insertText:`${t}${e}`,type:"TAG_NAME"})))}(this.languageProvider.getTraceqlAutocompleteTags(t),e)}getIntrinsicsCompletions(e,t){return this.languageProvider.getIntrinsics().map((r=>{var n;return{label:r,insertText:(e||"")+r+(t||""),type:"KEYWORD",insertTextRules:null===(n=Ie.eo.CompletionItemInsertTextRule)||void 0===n?void 0:n.InsertAsSnippet}}))}getScopesCompletions(e,t){return N.Wu.map((r=>{var n;return{label:r,insertText:(e||"")+r+(t||""),type:"SCOPE",insertTextRules:null===(n=Ie.eo.CompletionItemInsertTextRule)||void 0===n?void 0:n.InsertAsSnippet}}))}getOperatorsCompletions(e){return e.map((e=>Ge($e({},e),{type:"OPERATOR"})))}constructor(e){Be(this,"languageProvider",void 0),Be(this,"registerInteractionCommandId",void 0),Be(this,"setAlertText",void 0),Be(this,"timeRangeForTags",void 0),Be(this,"range",void 0),Be(this,"triggerCharacters",["{",".","[","(","=","~"," ",'"']),Be(this,"monaco",void 0),Be(this,"editor",void 0),Be(this,"cachedValues",{}),this.languageProvider=e.languageProvider,this.setAlertText=e.setAlertText,this.registerInteractionCommandId=null,this.timeRangeForTags=e.timeRangeForTags,this.range=e.range}}function Ke(e){switch(e){case"TAG_NAME":return Ie.eo.CompletionItemKind.Enum;case"KEYWORD":return Ie.eo.CompletionItemKind.Keyword;case"OPERATOR":return Ie.eo.CompletionItemKind.Operator;case"TAG_VALUE":return Ie.eo.CompletionItemKind.EnumMember;case"SCOPE":return Ie.eo.CompletionItemKind.Class;case"FUNCTION":return Ie.eo.CompletionItemKind.Function;default:throw new Error(`Unexpected CompletionItemType: ${e}`)}}Be(Ze,"arithmeticOps",[{label:"+",insertText:"+",detail:"Plus"},{label:"-",insertText:"-",detail:"Minus"},{label:"*",insertText:"*",detail:"Times"},{label:"/",insertText:"/",detail:"Over"}]),Be(Ze,"logicalOps",[{label:"&&",insertText:"&&",detail:"And",documentation:"And (intersection) operator. Checks that both conditions found matches."},{label:"||",insertText:"||",detail:"Or",documentation:"Or (union) operator. Checks that either condition found matches."}]),Be(Ze,"comparisonOps",[{label:"=",insertText:"=",detail:"Equality"},{label:"!=",insertText:"!=",detail:"Inequality"},{label:">",insertText:">",detail:"Greater than"},{label:">=",insertText:">=",detail:"Greater than or equal to"},{label:"<",insertText:"<",detail:"Less than"},{label:"<=",insertText:"<=",detail:"Less than or equal to"},{label:"=~",insertText:"=~",detail:"Regular expression"},{label:"!~",insertText:"!~",detail:"Negated regular expression"}]),Be(Ze,"structuralOps",[{label:">>",insertText:">>",detail:"Descendant",documentation:"Descendant operator. Looks for spans matching {condB} that are descendants of a span matching {condA}"},{label:">",insertText:">",detail:"Child",documentation:"Child operator. Looks for spans matching {condB} that are direct child spans of a parent matching {condA}"},{label:"<<",insertText:"<<",detail:"Ancestor",documentation:"Ancestor operator. Looks for spans matching {condB} that are ancestors of a span matching {condA}"},{label:"<",insertText:"<",detail:"Parent",documentation:"Parent operator. Looks for spans matching {condB} that are direct parent spans of a child matching {condA}"},{label:"~",insertText:"~",detail:"Sibling",documentation:"Sibling operator. Checks that spans matching {condA} and {condB} are siblings of the same parent span."},{label:"&>>",insertText:"&>>",detail:"Union Descendant",documentation:"The descendant operator (>>) looks for spans matching {condB} that are descendants of a span matching {condA}"},{label:"&>",insertText:"&>",detail:"Union Child",documentation:"The child operator (>) looks for spans matching {condB} that are direct child spans of a parent matching {condA}"},{label:"&<<",insertText:"&<<",detail:"Union Ancestor",documentation:"The ancestor operator (<<) looks for spans matching {condB} that are ancestor of a span matching {condA}"},{label:"&<",insertText:"&<",detail:"Union Parent",documentation:"The parent operator (<) looks for spans matching {condB} that are direct parent spans of a child matching {condA}"},{label:"&~",insertText:"&~",detail:"Union Sibling",documentation:"The sibling operator (~) looks at spans matching {condB} that have at least one sibling matching {condA}"},{label:"!>>",insertText:"!>>",detail:"Not Descendant",documentation:"The not-descendant operator (!>>) looks for spans matching {condB} that are not descendant spans of a parent matching {condA}"},{label:"!>",insertText:"!>",detail:"Not Child",documentation:"The not-child operator (!>) looks for spans matching {condB} that are not direct child spans of a parent matching {condA}"},{label:"!<<",insertText:"!<<",detail:"Not Ancestor",documentation:"The not-ancestor operator (!<<) looks for spans matching {condB} that are not ancestor spans of a child matching {condA}"},{label:"!<",insertText:"!<",detail:"Not Parent",documentation:"The not-parent operator (!<) looks for spans matching {condB} that are not direct parent spans of a child matching {condA}"},{label:"!~",insertText:"!~",detail:"Not Sibling",documentation:"The not-sibling operator (!~) looks for spans matching {condB} that do not have at least one sibling matching {condA}"}]),Be(Ze,"spansetOps",[{label:"|",insertText:"|",detail:"Pipe"},...Ze.logicalOps,...Ze.structuralOps]),Be(Ze,"aggregatorFunctions",[{label:"avg",insertText:"avg($0)",detail:"Average of attribute",documentation:"Computes the average of a given numeric attribute or intrinsic for a spanset."},{label:"count",insertText:"count()$0",detail:"Number of spans",documentation:"Counts the number of spans in a spanset."},{label:"max",insertText:"max($0)",detail:"Max value of attribute",documentation:"Computes the maximum value of a given numeric attribute or intrinsic for a spanset."},{label:"min",insertText:"min($0)",detail:"Min value of attribute",documentation:"Computes the minimum value of a given numeric attribute or intrinsic for a spanset."},{label:"sum",insertText:"sum($0)",detail:"Sum value of attribute",documentation:"Computes the sum value of a given numeric attribute or intrinsic for a spanset."}]),Be(Ze,"functions",[...Ze.aggregatorFunctions,{label:"by",insertText:"by($0)",detail:"Grouping of attributes",documentation:"Groups by arbitrary attributes."},{label:"compare",insertText:"compare($0)",detail:"Compare span groups",documentation:"Splits spans into two groups (selection and baseline) and returns time-series for all attributes to highlight differences. First parameter is a spanset filter for the selection group (e.g., {status=error}). Optional parameters: topN limit (default 10), start timestamp, end timestamp."},{label:"count_over_time",insertText:"count_over_time()$0",detail:"Number of spans over time",documentation:"Counts the number of spans over time."},{label:"min_over_time",insertText:"min_over_time()$0",detail:"Minimum value of attribute over time",documentation:"Minimum value for the specified attribute across all matching spans over time."},{label:"max_over_time",insertText:"max_over_time()$0",detail:"Maximum value of attribute over time",documentation:"Maximum value for the specified attribute across all matching spans over time."},{label:"avg_over_time",insertText:"avg_over_time()$0",detail:"Average value of attribute over time",documentation:"Average value for the specified attribute across all matching spans over time."},{label:"sum_over_time",insertText:"sum_over_time()$0",detail:"Summation value of attribute over time",documentation:"Sum of the values for the specified attribute across all matching spans over time."},{label:"histogram_over_time",insertText:"histogram_over_time($0)",detail:"Histogram of attribute over time",documentation:"Retrieves a histogram of an attributes values over time which are sorted into buckets."},{label:"quantile_over_time",insertText:"quantile_over_time($0)",detail:"Quantile of attribute over time",documentation:"Retrieves one or more quantiles of an attributes numeric values over time."},{label:"rate",insertText:"rate()$0",detail:"Rate of spans",documentation:"Counts the rate of spans per second."},{label:"select",insertText:"select($0)",detail:"Selection of fields",documentation:"Selects arbitrary fields from spans."}]),Be(Ze,"queryHints",[{label:"with",insertText:"with($0)",detail:"Query hints",documentation:"Provides query hints to modify search behavior. Use with parameters like most_recent=true to get the latest traces."}]),Be(Ze,"withParameters",[{label:"most_recent",insertText:"most_recent=$0",detail:"Get latest traces",documentation:"Forces Tempo to return the most recent results ordered by time. Use most_recent=true to see the freshest data when troubleshooting incidents."}]),Be(Ze,"withValues",[{label:"true",insertText:"true",detail:"Boolean true"},{label:"false",insertText:"false",detail:"Boolean false"}]);const He=/(event\.|instrumentation\.|link\.|resource\.|span\.|\.)?([\w./-]*)$/;const Je=new Intl.Collator("en",{sensitivity:"accent"});const Xe=e=>{if(""===e.trim())return[];if(e.trim().match(/^[0-9A-Fa-f]*$/))return[];const t=Ne.K3.parse(e),r=[];return t.iterate({enter:e=>{0===e.type.id&&r.push(e.node)}}),r},et=(e,t,r)=>{const n=[...tt(e.MarkerSeverity.Error,t,r),...rt(e.MarkerSeverity.Warning,t)];e.editor.setModelMarkers(t,"owner",n)},tt=(e,t,r)=>r.map((r=>{const n=(e=>{var t;switch(null===(t=e.parent)||void 0===t?void 0:t.type.id){case Ne.v5:var r;switch(null===(r=e.prevSibling)||void 0===r?void 0:r.type.id){case Ne.KD:case Ne.Or:return"Invalid value after logical operator.";case Ne.Ib:return"Invalid value after comparison or arithmetic operator.";default:return"Invalid operator after field expression."}case Ne.NA:var n;return(null===(n=e.prevSibling)||void 0===n?void 0:n.type.id)===Ne.v5?"Invalid comparison operator after field expression.":"Invalid expression for spanset.";case Ne.zs:var a;switch(null===(a=e.prevSibling)||void 0===a?void 0:a.type.id){case Ne.zs:return"Invalid spanset combining operator after spanset expression.";case Ne.nT:return"Invalid aggregation operator after pipeline operator.";default:return"Invalid spanset expression after spanset combining operator."}case Ne.sd:case Ne.S6:var i,o,s,l,c,u,p;return(null===(s=e.parent)||void 0===s||null===(o=s.parent)||void 0===o||null===(i=o.parent)||void 0===i?void 0:i.type.id)===Ne.vp?"Invalid expression for by operator.":(null===(p=e.parent)||void 0===p||null===(u=p.parent)||void 0===u||null===(c=u.parent)||void 0===c||null===(l=c.parent)||void 0===l?void 0:l.type.id)===Ne.yl?"Invalid expression for select operator.":"Invalid expression for aggregator operator.";case Ne.d4:return"Invalid expression for spanset.";case Ne.T:var d;switch(null===(d=e.prevSibling)||void 0===d?void 0:d.type.id){case Ne.LU:return"Invalid value after comparison operator.";case Ne.JP:var g,m;if((null===(m=e.prevSibling)||void 0===m||null===(g=m.firstChild)||void 0===g?void 0:g.type.id)===Ne.S6)return"Invalid comparison operator after aggregator operator.";default:return"Invalid value after comparison operator."}default:return"Invalid query."}})(r);return nt(e,n,t,r.from,r.to)})),rt=(e,t)=>{let r=[];const n=t.getValue(),a=Ne.K3.parse(n);if(n.indexOf(".")>-1){const n=a.cursorAt(0);do{const{node:a}=n;var i,o,s,l,c,u;if(a.type.id===Ne.gw)if((null===(i=a.prevSibling)||void 0===i?void 0:i.type.id)!==Ne.n$&&(null===(o=a.prevSibling)||void 0===o?void 0:o.type.id)!==Ne.Jh&&(null===(s=a.prevSibling)||void 0===s?void 0:s.type.id)!==Ne.r5&&(null===(l=a.prevSibling)||void 0===l?void 0:l.type.id)!==Ne.N_&&(null===(c=a.prevSibling)||void 0===c?void 0:c.type.id)!==Ne.FW&&(null===(u=a.prevSibling)||void 0===u?void 0:u.type.id)!==Ne.L9){const n=a.prevSibling?a.prevSibling.from:a.from-1,i=a.prevSibling?a.prevSibling.to:a.from-1,o="Add resource or span scope to attribute to improve query performance.";r.push(nt(e,o,t,n,i))}}while(n.next())}return r},nt=(e,t,r,n,a)=>{let i=0,o=0,s=n,l=a;for(;s>0;)i++,s-=r.getLineLength(i)+1;for(;l>0;)o++,l-=r.getLineLength(o)+1;return{message:t,severity:e,startLineNumber:i,endLineNumber:o,startColumn:s+r.getLineLength(i)+2,endColumn:l+r.getLineLength(o)+2}};function at(e,t,r,n,a,i,o){try{var s=e[i](o),l=s.value}catch(e){return void r(e)}s.done?t(l):Promise.resolve(l).then(n,a)}function it(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function ot(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})),e}function st(e){const[t,r]=(0,i.useState)(),{query:a,onChange:o,onRunQuery:u,placeholder:p}=e;var d;const g=function(e,t,r,n){const a=(0,i.useRef)(new Ze({languageProvider:e.languageProvider,setAlertText:t,timeRangeForTags:r,range:n})),o=(0,i.useRef)(n);(0,i.useEffect)((()=>{const a=()=>{return(a=function*(){try{yield e.languageProvider.start(n,r),t(void 0)}catch(e){e instanceof Error&&t(`Error: ${e.message}`)}},function(){var e=this,t=arguments;return new Promise((function(r,n){var i=a.apply(e,t);function o(e){at(i,r,n,o,s,"next",e)}function s(e){at(i,r,n,o,s,"throw",e)}o(void 0)}))})();var a};a()}),[e,t,n,r]),(0,i.useEffect)((()=>{e.languageProvider.shouldRefreshLabels(n,o.current)&&(a.current.range=n,o.current=n)}),[n,e.languageProvider]),(0,i.useEffect)((()=>{a.current.timeRangeForTags=r}),[r]);const s=(0,i.useRef)(null);return(0,i.useEffect)((()=>()=>{var e;null===(e=s.current)||void 0===e||e.call(s)}),[]),(e,t,r)=>{a.current.editor=e,a.current.monaco=t,a.current.setRegisterInteractionCommandId(r);const{dispose:n}=t.languages.registerCompletionItemProvider(ct,a.current);s.current=n}}(e.datasource,r,null!==(d=e.datasource.timeRangeForTags)&&void 0!==d?d:Ce.o,e.range),m=(0,l.useTheme2)(),h=pt(m,p),f=(0,i.useRef)(a);f.current=a;const y=e=>{o(ot(function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){it(e,t,r[t])}))}return e}({},f.current),{query:e}))},v=(0,i.useRef)(u);v.current=u;const b=(0,i.useRef)();return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(l.CodeEditor,{value:a.query||"",language:ct,onBlur:y,onChange:y,containerStyles:h.queryField,readOnly:e.readOnly,monacoOptions:{folding:!1,fontSize:14,lineNumbers:"off",overviewRulerLanes:0,renderLineHighlight:"none",scrollbar:{vertical:"hidden",verticalScrollbarSize:8,horizontal:"hidden",horizontalScrollbarSize:0},scrollBeyondLastLine:!1,wordWrap:"on"},onBeforeEditorMount:ut,onEditorDidMount:(t,r)=>{e.readOnly||(g(t,r,function(e){return e.addCommand(0,(function(e,t,r){const n={datasourceType:"tempo",type:r};"TAG_VALUE"!==r&&(n.label=t),(0,s.reportInteraction)("grafana_traces_traceql_completion",n)}))}(t)),function(e,t,r){e.addAction({id:"run-query",label:"Run Query",keybindings:[t.KeyMod.Shift|t.KeyCode.Enter],contextMenuGroupId:"navigation",contextMenuOrder:1.5,run:function(){r()}})}(t,r,(()=>v.current())),function(e,t,r){const n=[{range:new t.Range(1,1,1,1),options:{className:r.placeholder,isWholeLine:!0}}];let a=[];const i=()=>{const t=e.getModel();if(!t)return;const r=0===t.getValueLength()?n:[];a=t.deltaDecorations(a,r)};i(),e.onDidChangeModelContent(i)}(t,r,h)),function(e){const t=e.getDomNode(),r=()=>{if(t){const r=Math.min(1e3,e.getContentHeight()),n=parseInt(t.style.width,10);t.style.width=`${n}px`,t.style.height=`${r}px`,e.layout({width:n,height:r})}};e.onDidContentSizeChange(r),r()}(t);const n=t.getModel();if(n){const e=Xe(n.getValue());et(r,n,e)}t.onDidChangeModelContent((e=>{const n=t.getModel();if(!n)return;window.clearTimeout(b.current);const a=Xe(n.getValue()),i=e.changes[0].rangeOffset;et(r,n,a.filter((e=>!(e.from<=i&&i<=e.to)))),b.current=window.setTimeout((()=>{et(r,n,a)}),500)}))}}),t&&(0,n.jsx)(c.C,{severity:"error",text:t})]})}let lt=!1;const ct="traceql";function ut(e){if(!lt){lt=!0;const{aliases:t,extensions:r,mimetypes:n,def:a}=N.YG;e.languages.register({id:ct,aliases:t,extensions:r,mimetypes:n}),e.languages.setMonarchTokensProvider(ct,a.language),e.languages.setLanguageConfiguration(ct,a.languageConfiguration)}}const pt=(e,t)=>({queryField:(0,a.css)({borderRadius:e.shape.radius.default,border:`1px solid ${e.components.input.borderColor}`,flex:1}),placeholder:(0,a.css)({"::after":{content:`'${t}'`,fontFamily:e.typography.fontFamilyMonospace,opacity:.3}})});function dt(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function gt(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})),e}function mt(e){const t=(0,l.useStyles2)(ht),r=(0,Se.defaults)(e.query,we),[a,c]=(0,i.useState)((()=>{const t=e.datasource.languageProvider.generateQueryFromFilters({traceqlFilters:r.filters||[]});return t===r.query||"{}"===t})),u=(0,n.jsxs)(l.Alert,{title:"Tempo metrics is an experimental feature",severity:"warning",children:["Please note that TraceQL metrics is an experimental feature and should not be used in production. Read more about it in"," ",(0,n.jsx)(l.TextLink,{external:!0,href:"https://grafana.com/docs/tempo/latest/operations/traceql-metrics/",children:"documentation"}),"."]}),p=e.app===o.CoreApp.UnifiedAlerting||e.app===o.CoreApp.CloudAlerting;var d,g;return(0,n.jsxs)(n.Fragment,{children:[p&&u,(0,n.jsxs)(l.InlineLabel,{children:["Build complex queries using TraceQL to select a list of traces."," ",(0,n.jsx)(l.TextLink,{external:!0,href:"https://grafana.com/docs/tempo/latest/traceql/",children:"Documentation"})]}),!a&&(0,n.jsxs)("div",{className:t.copyContainer,children:[(0,n.jsx)("span",{children:"Continue editing the query from the Search tab?"}),(0,n.jsx)(l.Button,{variant:"secondary",size:"sm",onClick:()=>{var t;(0,s.reportInteraction)("grafana_traces_copy_to_traceql_clicked",{app:null!==(t=e.app)&&void 0!==t?t:"",grafana_version:s.config.buildInfo.version,location:"traceql_tab"}),e.onClearResults(),e.onChange(gt(function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){dt(e,t,r[t])}))}return e}({},r),{query:e.datasource.languageProvider.generateQueryFromFilters({traceqlFilters:r.filters||[]})})),c(!0)},style:{marginLeft:"10px"},children:"Copy query from Search"})]}),(0,n.jsx)(st,{placeholder:"Enter a TraceQL query or trace ID (run with Shift+Enter)",query:r,onChange:e.onChange,datasource:e.datasource,onRunQuery:e.onRunQuery,range:e.range}),(0,n.jsx)("div",{className:t.optionsContainer,children:(0,n.jsx)(w,{query:r,onChange:e.onChange,searchStreaming:null!==(d=e.datasource.isStreamingSearchEnabled())&&void 0!==d&&d,metricsStreaming:null!==(g=e.datasource.isStreamingMetricsEnabled())&&void 0!==g&&g,app:e.app})})]})}const ht=e=>({optionsContainer:(0,a.css)({marginTop:"10px"}),copyContainer:(0,a.css)({backgroundColor:e.colors.background.secondary,padding:e.spacing(.5,1),fontSize:e.typography.body.fontSize})});function ft(e,t,r,n,a,i,o){try{var s=e[i](o),l=s.value}catch(e){return void r(e)}s.done?t(l):Promise.resolve(l).then(n,a)}function yt(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function vt(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){yt(e,t,r[t])}))}return e}function bt(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})),e}class Mt extends i.PureComponent{componentDidMount(){return(e=function*(){this._isMounted=!0,this.props.query.queryType&&"clear"!==this.props.query.queryType||this.props.onChange(bt(vt({},this.props.query),{queryType:"traceql"}));const e=this.props.range,t=yield this.props.datasource.getNativeHistograms(e);this._isMounted&&(this.props.onChange(bt(vt({},this.props.query),{serviceMapUseNativeHistograms:t})),"serviceMap"===this.props.query.queryType&&void 0===this.props.query.serviceMapUseNativeHistograms&&this.props.query.serviceMapUseNativeHistograms!==t&&t&&this.props.onRunQuery())},function(){var t=this,r=arguments;return new Promise((function(n,a){var i=e.apply(t,r);function o(e){ft(i,n,a,o,s,"next",e)}function s(e){ft(i,n,a,o,s,"throw",e)}o(void 0)}))}).call(this);var e}componentWillUnmount(){this._isMounted=!1}render(){var e;const{query:t,onChange:r,datasource:i,app:c}=this.props,u=c===o.CoreApp.UnifiedAlerting,p=null===(e=i.serviceMap)||void 0===e?void 0:e.datasourceUid;return(t.spanName||t.serviceName||t.search||t.maxDuration||t.minDuration||"nativeSearch"===t.queryType)&&r((0,ye.d6)(t)),(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(l.Modal,{title:"Upload trace",isOpen:this.state.uploadModalOpen,onDismiss:()=>this.setState({uploadModalOpen:!1}),children:(0,n.jsx)("div",{className:(0,a.css)({padding:this.props.theme.spacing(2)}),children:(0,n.jsx)(l.FileDropzone,{options:{multiple:!1},onLoad:e=>{if("string"!=typeof e&&null!==e)throw Error("Unexpected result type: "+typeof e);this.props.datasource.uploadedJson=e,r(bt(vt({},t),{queryType:"upload"})),this.setState({uploadModalOpen:!1}),this.props.onRunQuery()}})})}),!u&&(0,n.jsx)(l.InlineFieldRow,{children:(0,n.jsx)(l.InlineField,{label:"Query type",grow:!0,children:(0,n.jsxs)(l.Stack,{gap:1,alignItems:"center",justifyContent:"space-between",children:[(0,n.jsx)(l.RadioButtonGroup,{options:[{value:"traceqlSearch",label:"Search"},{value:"traceql",label:"TraceQL"},{value:"serviceMap",label:"Service Graph"}],value:t.queryType,onChange:e=>{var n;(0,s.reportInteraction)("grafana_traces_query_type_changed",{datasourceType:"tempo",app:null!=c?c:"",grafana_version:s.config.buildInfo.version,newQueryType:e,previousQueryType:null!==(n=t.queryType)&&void 0!==n?n:""}),this.onClearResults(),r(bt(vt({},t),{queryType:e}))},size:"md"}),(0,n.jsx)(l.Button,{variant:"secondary",size:"sm",onClick:()=>{this.setState({uploadModalOpen:!0})},children:"Import trace"})]})})}),"traceqlSearch"===t.queryType&&(0,n.jsx)($,{datasource:this.props.datasource,query:t,onChange:r,onBlur:this.props.onBlur,app:c,onClearResults:this.onClearResults,addVariablesToOptions:this.props.addVariablesToOptions,range:this.props.range}),"serviceMap"===t.queryType&&(0,n.jsx)(Te,{graphDatasourceUid:p,query:t,onChange:r}),"traceql"===t.queryType&&(0,n.jsx)(mt,{datasource:this.props.datasource,query:t,onRunQuery:this.props.onRunQuery,onChange:r,app:c,onClearResults:this.onClearResults,range:this.props.range})]})}constructor(e){super(e),yt(this,"_isMounted",!1),yt(this,"onClearResults",(()=>{const{onChange:e,query:t,onRunQuery:r}=this.props;e(bt(vt({},t),{queryType:"clear"})),r()})),this.state={uploadModalOpen:!1}}}const jt=(0,l.withTheme2)(Mt)},6060:e=>{e.exports="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNTMiIGhlaWdodD0iMzYiIHZpZXdCb3g9IjAgMCA1MyAzNiIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPGcgY2xpcC1wYXRoPSJ1cmwoI2NsaXAwKSI+CjxwYXRoIGZpbGwtcnVsZT0iZXZlbm9kZCIgY2xpcC1ydWxlPSJldmVub2RkIiBkPSJNNDguMDM2NCA0LjAxMDQySDQuMDA3NzlMNC4wMDc3OSAzMi4wMjg2SDQ4LjAzNjRWNC4wMTA0MlpNNC4wMDc3OSAwLjAwNzgxMjVDMS43OTcyMSAwLjAwNzgxMjUgMC4wMDUxODc5OSAxLjc5OTg0IDAuMDA1MTg3OTkgNC4wMTA0MlYzMi4wMjg2QzAuMDA1MTg3OTkgMzQuMjM5MiAxLjc5NzIxIDM2LjAzMTIgNC4wMDc3OSAzNi4wMzEySDQ4LjAzNjRDNTAuMjQ3IDM2LjAzMTIgNTIuMDM5IDM0LjIzOTIgNTIuMDM5IDMyLjAyODZWNC4wMTA0MkM1Mi4wMzkgMS43OTk4NCA1MC4yNDcgMC4wMDc4MTI1IDQ4LjAzNjQgMC4wMDc4MTI1SDQuMDA3NzlaTTguMDEwNDIgOC4wMTMwMkgxMi4wMTNWMTIuMDE1Nkg4LjAxMDQyVjguMDEzMDJaTTIwLjAxODIgOC4wMTMwMkgxNi4wMTU2VjEyLjAxNTZIMjAuMDE4MlY4LjAxMzAyWk0yNC4wMjA4IDguMDEzMDJIMjguMDIzNFYxMi4wMTU2SDI0LjAyMDhWOC4wMTMwMlpNMzYuMDI4NiA4LjAxMzAySDMyLjAyNlYxMi4wMTU2SDM2LjAyODZWOC4wMTMwMlpNNDAuMDMxMiA4LjAxMzAySDQ0LjAzMzlWMTIuMDE1Nkg0MC4wMzEyVjguMDEzMDJaTTE2LjAxNTYgMTYuMDE4Mkg4LjAxMDQyVjIwLjAyMDhIMTYuMDE1NlYxNi4wMTgyWk0yMC4wMTgyIDE2LjAxODJIMjQuMDIwOFYyMC4wMjA4SDIwLjAxODJWMTYuMDE4MlpNMzIuMDI2IDE2LjAxODJIMjguMDIzNFYyMC4wMjA4SDMyLjAyNlYxNi4wMTgyWk00NC4wMzM5IDE2LjAxODJWMjAuMDIwOEgzNi4wMjg2VjE2LjAxODJINDQuMDMzOVpNMTIuMDEzIDI0LjAyMzRIOC4wMTA0MlYyOC4wMjZIMTIuMDEzVjI0LjAyMzRaTTE2LjAxNTYgMjQuMDIzNEgzNi4wMjg2VjI4LjAyNkgxNi4wMTU2VjI0LjAyMzRaTTQ0LjAzMzkgMjQuMDIzNEg0MC4wMzEyVjI4LjAyNkg0NC4wMzM5VjI0LjAyMzRaIiBmaWxsPSIjQzVDNUM1Ii8+CjwvZz4KPGRlZnM+CjxjbGlwUGF0aCBpZD0iY2xpcDAiPgo8cmVjdCB3aWR0aD0iNTMiIGhlaWdodD0iMzYiIGZpbGw9IndoaXRlIi8+CjwvY2xpcFBhdGg+CjwvZGVmcz4KPC9zdmc+Cg=="},7584:e=>{e.exports="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNTMiIGhlaWdodD0iMzYiIHZpZXdCb3g9IjAgMCA1MyAzNiIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPGcgY2xpcC1wYXRoPSJ1cmwoI2NsaXAwKSI+CjxwYXRoIGZpbGwtcnVsZT0iZXZlbm9kZCIgY2xpcC1ydWxlPSJldmVub2RkIiBkPSJNNDguMDM2NCA0LjAxMDQySDQuMDA3NzlMNC4wMDc3OSAzMi4wMjg2SDQ4LjAzNjRWNC4wMTA0MlpNNC4wMDc3OSAwLjAwNzgxMjVDMS43OTcyMSAwLjAwNzgxMjUgMC4wMDUxODc5OSAxLjc5OTg0IDAuMDA1MTg3OTkgNC4wMTA0MlYzMi4wMjg2QzAuMDA1MTg3OTkgMzQuMjM5MiAxLjc5NzIxIDM2LjAzMTIgNC4wMDc3OSAzNi4wMzEySDQ4LjAzNjRDNTAuMjQ3IDM2LjAzMTIgNTIuMDM5IDM0LjIzOTIgNTIuMDM5IDMyLjAyODZWNC4wMTA0MkM1Mi4wMzkgMS43OTk4NCA1MC4yNDcgMC4wMDc4MTI1IDQ4LjAzNjQgMC4wMDc4MTI1SDQuMDA3NzlaTTguMDEwNDIgOC4wMTMwMkgxMi4wMTNWMTIuMDE1Nkg4LjAxMDQyVjguMDEzMDJaTTIwLjAxODIgOC4wMTMwMkgxNi4wMTU2VjEyLjAxNTZIMjAuMDE4MlY4LjAxMzAyWk0yNC4wMjA4IDguMDEzMDJIMjguMDIzNFYxMi4wMTU2SDI0LjAyMDhWOC4wMTMwMlpNMzYuMDI4NiA4LjAxMzAySDMyLjAyNlYxMi4wMTU2SDM2LjAyODZWOC4wMTMwMlpNNDAuMDMxMiA4LjAxMzAySDQ0LjAzMzlWMTIuMDE1Nkg0MC4wMzEyVjguMDEzMDJaTTE2LjAxNTYgMTYuMDE4Mkg4LjAxMDQyVjIwLjAyMDhIMTYuMDE1NlYxNi4wMTgyWk0yMC4wMTgyIDE2LjAxODJIMjQuMDIwOFYyMC4wMjA4SDIwLjAxODJWMTYuMDE4MlpNMzIuMDI2IDE2LjAxODJIMjguMDIzNFYyMC4wMjA4SDMyLjAyNlYxNi4wMTgyWk00NC4wMzM5IDE2LjAxODJWMjAuMDIwOEgzNi4wMjg2VjE2LjAxODJINDQuMDMzOVpNMTIuMDEzIDI0LjAyMzRIOC4wMTA0MlYyOC4wMjZIMTIuMDEzVjI0LjAyMzRaTTE2LjAxNTYgMjQuMDIzNEgzNi4wMjg2VjI4LjAyNkgxNi4wMTU2VjI0LjAyMzRaTTQ0LjAzMzkgMjQuMDIzNEg0MC4wMzEyVjI4LjAyNkg0NC4wMzM5VjI0LjAyMzRaIiBmaWxsPSIjNDI0MjQyIi8+CjwvZz4KPGRlZnM+CjxjbGlwUGF0aCBpZD0iY2xpcDAiPgo8cmVjdCB3aWR0aD0iNTMiIGhlaWdodD0iMzYiIGZpbGw9IndoaXRlIi8+CjwvY2xpcFBhdGg+CjwvZGVmcz4KPC9zdmc+Cg=="},8968:e=>{e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAQAAAAECAYAAACp8Z5+AAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAAZdEVYdFNvZnR3YXJlAHBhaW50Lm5ldCA0LjAuMTZEaa/1AAAAHUlEQVQYV2PYvXu3JAi7uLiAMaYAjAGTQBPYLQkAa/0Zef3qRswAAAAASUVORK5CYII="}}]);
//# sourceMappingURL=9762.js.map