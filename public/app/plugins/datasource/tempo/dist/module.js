/*! For license information please see module.js.LICENSE.txt */
/* [create-plugin] version: 5.22.0 */
define(["module","react","@grafana/data","@grafana/runtime","@grafana/ui","lodash","rxjs","rxjs/operators","@emotion/css","prismjs"],((e,t,r,a,n,s,o,i,l,c)=>(()=>{"use strict";var u,d,p={103:(e,t,r)=>{r.d(t,{Hx:()=>l,II:()=>a,UD:()=>v,Wu:()=>c,YG:()=>f,c3:()=>u,fV:()=>n,jN:()=>s,on:()=>i,rx:()=>o});const a=["=","!=",">","<",">=","<=","=~","!~"],n=["=","!="],s=["=","!=","=~","!~"],o=["=","!=",">","<",">=","<="],i=["duration","kind","name","rootName","rootServiceName","status","statusMessage","traceDuration"],l=i.concat(["event:name","event:timeSinceStart","instrumentation:name","instrumentation:version","link:spanID","link:traceID","span:duration","span:id","span:kind","span:name","span:parentID","span:status","span:statusMessage","trace:duration","trace:id","trace:rootName","trace:rootService"]),c=["event","instrumentation","link","resource","span"],u=["kind","span:kind","status","span:status"],d=["avg","count","max","min","sum"].concat(["by","compare","count_over_time","min_over_time","max_over_time","avg_over_time","sum_over_time","histogram_over_time","quantile_over_time","rate","select"]),p=["with"],m=l.concat(c).concat(p),f={id:"traceql",extensions:[".traceql"],aliases:["tempo","traceql"],mimetypes:[],def:{language:{ignoreCase:!1,defaultToken:"",tokenPostfix:".traceql",keywords:m,operators:a,statusValues:["ok","unset","error","false","true"],functions:d,withClauseKeywords:p,withParameters:["most_recent"],symbols:/[=><!~?:&|+\-*\/^%]+/,escapes:/\\(?:[abfnrtv\\"']|x[0-9A-Fa-f]{1,4}|u[0-9A-Fa-f]{4}|U[0-9A-Fa-f]{8})/,digits:/\d+(_+\d+)*/,octaldigits:/[0-7]+(_+[0-7]+)*/,binarydigits:/[0-1]+(_+[0-1]+)*/,tokenizer:{root:[[/\/\/.*/,"comment"],[/\/\*.*\*\//,"comment"],[/[0-9]+(.[0-9]+)?(us|µs|ns|ms|s|m|h)/,"number"],[/^\s*[0-9A-Fa-f]+\s*$/,"tag"],[/\bwith\b/,{token:"keyword",next:"@withStart"}],[`(?:${m.join("|")})`,{cases:{"@keywords":"keyword","@default":"tag"}}],[/(?:\w|^[^{}()=~!<>&|," ]|"(?:\\"|\\\\|[^\\"])*")+/,{cases:{"@functions":"predefined","@statusValues":"type","@withParameters":"variable","@default":"tag"}}],[/"([^"\\]|\\.)*$/,"string.invalid"],[/'([^'\\]|\\.)*$/,"string.invalid"],[/([^\w])(")/,[{token:""},{token:"string",next:"@string_double"}]],[/([^\w])(')/,[{token:""},{token:"string",next:"@string_single"}]],[/([^\w])(`)/,[{token:""},{token:"string",next:"@string_back"}]],[/[{}()\[\]]/,"delimiter.bracket"],[/@symbols/,{cases:{"@operators":"delimiter","@default":""}}],[/(@digits)[eE]([\-+]?(@digits))?[fFdD]?/,"number.float"],[/(@digits)\.(@digits)([eE][\-+]?(@digits))?[fFdD]?/,"number.float"],[/0(@octaldigits)[Ll]?/,"number.octal"],[/0[bB](@binarydigits)[Ll]?/,"number.binary"],[/(@digits)[fFdD]/,"number.float"],[/(@digits)[lL]?/,"number"]],withStart:[[/\s+/,""],[/\(/,{token:"delimiter.bracket",next:"@withClause"}],[/(?=.)/,{token:"",next:"@pop"}]],withClause:[[/\s+/,""],[/\w+/,{cases:{"@withParameters":"variable"}}],[/=/,"delimiter"],[/\b(true|false)\b/,"type"],[/\)/,{token:"delimiter.bracket",next:"@pop"}]],string_double:[[/[^\\"]+/,"string"],[/@escapes/,"string.escape"],[/\\./,"string.escape.invalid"],[/"/,"string","@pop"]],string_single:[[/[^\\']+/,"string"],[/@escapes/,"string.escape"],[/\\./,"string.escape.invalid"],[/'/,"string","@pop"]],string_back:[[/[^\\`]+/,"string"],[/@escapes/,"string.escape"],[/\\./,"string.escape.invalid"],[/`/,"string","@pop"]]}},languageConfiguration:{wordPattern:/(-?\d*\.\d\w*)|([^`~!#%^&*()\-=+\[{\]}\\|;:'",.<>\/?\s]+)/g,brackets:[["{","}"],["(",")"]],autoClosingPairs:[{open:"{",close:"}"},{open:"(",close:")"},{open:'"',close:'"'},{open:"'",close:"'"}],surroundingPairs:[{open:"{",close:"}"},{open:"(",close:")"},{open:'"',close:'"'},{open:"'",close:"'"}],folding:{}}}},v={comment:{pattern:/\/\/.*/},"span-set":{pattern:/\{[^}]*}/,inside:{filter:{pattern:/([\w:.\/-]+)\s*(=|!=|<=|>=|=~|!~|>|<)\s*("[^"]*"|[\w.\/-]+)(\s*(\&\&|\|\|)\s*([\w:.\/-]+)\s*(=|!=|<=|>=|=~|!~|>|<)\s*("[^"]*"|[\w.\/-]+))*/g,inside:{comment:{pattern:/#.*/},"label-key":{pattern:/[a-z_.][\w./_-]*(:[\w./_-]+)?(?=\s*(=|!=|>|<|>=|<=|=~|!~))/,alias:"attr-name"},"label-value":{pattern:/("(?:\\.|[^\\"])*")|(\w+)/,alias:"attr-value"}}},punctuation:/[}{&|]/}},"with-clause":{pattern:/\bwith\s*\([^)]*\)/,inside:{"with-keyword":{pattern:/\bwith\b/,alias:"keyword"},"parameter-name":{pattern:/\b[a-zA-Z_][a-zA-Z0-9_]*(?=\s*=)/,alias:"attr-name"},"parameter-value":{pattern:/\b(true|false)\b|"(?:\\.|[^\\"])*"|'(?:\\.|[^\\'])*'|\d+(?:\.\d+)?/,alias:"attr-value"},punctuation:/[()=,]/}},number:/\b-?\d+((\.\d*)?([eE][+-]?\d+)?)?\b/,operator:new RegExp("/[-+*/=%^~]|&&?|\\|?\\||!=?|<(?:=>?|<|>)?|>[>=]?|","i"),punctuation:/[{};()`,.]/}},110:(e,t,r)=>{const a=r(7715);e.exports=(e,t,r)=>a(e,t,"<",r)},122:e=>{e.exports=class{constructor(){this.max=1e3,this.map=new Map}get(e){const t=this.map.get(e);return void 0===t?void 0:(this.map.delete(e),this.map.set(e,t),t)}delete(e){return this.map.delete(e)}set(e,t){if(!this.delete(e)&&void 0!==t){if(this.map.size>=this.max){const e=this.map.keys().next().value;this.delete(e)}this.map.set(e,t)}return this}}},130:(e,t,r)=>{const a=r(2839);e.exports=(e,t)=>{try{return new a(e,t).range||"*"}catch(e){return null}}},204:(e,t,r)=>{r.d(t,{$:()=>m,E:()=>p});var a=r(9728),n=r(6089),s=r(7781),o=r(9558),i=r(4848),l=r(2007);function c(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function u(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},a=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(a=a.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),a.forEach((function(t){c(e,t,r[t])}))}return e}function d(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,a)}return r}(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})),e}function p({options:e,onOptionsChange:t}){var r,n,c,p,f;const v=(0,l.useStyles2)(m),g=e=>`Time shift for ${e} of search`,h=e=>`Shifts the ${e} of the time range when searching by TraceID. Searching can return traces that do not fully fall into the search time range, so we recommend using higher time shifts for longer traces. Default: 30m (Time units can be used here, for example: 5s, 1m, 3h`;return(0,a.jsxs)("div",{className:v.container,children:[(0,a.jsx)(l.InlineField,{label:"Use time range in query",tooltip:"The time range can be used when there are performance issues or timeouts since it will narrow down the search to the defined range. Default: disabled",labelWidth:26,children:(0,a.jsx)(l.InlineSwitch,{id:"enable-time-shift",value:(null===(r=e.jsonData.traceQuery)||void 0===r?void 0:r.timeShiftEnabled)||!1,onChange:r=>{(0,s.updateDatasourcePluginJsonDataOption)({onOptionsChange:t,options:e},"traceQuery",d(u({},e.jsonData.traceQuery),{timeShiftEnabled:r.currentTarget.checked}))}})}),(0,a.jsx)(o.e,{label:g("start"),tooltip:h("start"),value:(null===(n=e.jsonData.traceQuery)||void 0===n?void 0:n.spanStartTimeShift)||"",disabled:!(null===(c=e.jsonData.traceQuery)||void 0===c?void 0:c.timeShiftEnabled),onChange:r=>{(0,s.updateDatasourcePluginJsonDataOption)({onOptionsChange:t,options:e},"traceQuery",d(u({},e.jsonData.traceQuery),{spanStartTimeShift:r}))},isInvalidError:i.FJ}),(0,a.jsx)(o.e,{label:g("end"),tooltip:h("end"),value:(null===(p=e.jsonData.traceQuery)||void 0===p?void 0:p.spanEndTimeShift)||"",disabled:!(null===(f=e.jsonData.traceQuery)||void 0===f?void 0:f.timeShiftEnabled),onChange:r=>{(0,s.updateDatasourcePluginJsonDataOption)({onOptionsChange:t,options:e},"traceQuery",d(u({},e.jsonData.traceQuery),{spanEndTimeShift:r}))},isInvalidError:i.FJ})]})}const m=e=>({infoText:(0,n.css)({paddingBottom:e.spacing(2),color:e.colors.text.secondary}),container:(0,n.css)({width:"100%"}),row:(0,n.css)({alignItems:"baseline"})})},284:(e,t,r)=>{const a=r(2839);e.exports=(e,t,r)=>(e=new a(e,r),t=new a(t,r),e.intersects(t,r))},318:(e,t,r)=>{r.d(t,{A:()=>b});var a=r(9728),n=r(6089),s=r(3241),o=r(5959),i=r(1777),l=r(9605),c=r(8531),u=r(2007),d=r(3292),p=r(9922),m=r(103),f=r(9183);function v(e,t,r,a,n,s,o){try{var i=e[s](o),l=i.value}catch(e){return void r(e)}i.done?t(l):Promise.resolve(l).then(a,n)}function g(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function h(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},a=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(a=a.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),a.forEach((function(t){g(e,t,r[t])}))}return e}function y(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,a)}return r}(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})),e}const b=({filter:e,datasource:t,updateFilter:r,isTagsLoading:n,tags:g,setError:b,hideScope:w,hideTag:T,hideValue:S,query:O,addVariablesToOptions:N,isMulti:I=!0,allowCustomValue:j=!0,range:$,timeRangeForTags:F})=>{var D;const P=(0,u.useStyles2)(E),[x,R]=(0,o.useState)(),L=(0,o.useMemo)((()=>(0,f.pE)(e,t.languageProvider)),[t.languageProvider,e]),[k,A]=(0,o.useState)(""),[q,C]=(0,o.useState)(""),{loading:M,value:V}=(0,i.A)((()=>{return(r=function*(){try{const r=e.tag?yield t.languageProvider.getOptionsV2({tag:L,query:O,timeRangeForTags:F,range:$}):[];return R(void 0),b(null),r}catch(e){(0,c.isFetchError)(e)&&404===(null==e?void 0:e.status)?b(e):e instanceof Error&&R(`Error: ${e.message}`)}return[]},function(){var e=this,t=arguments;return new Promise((function(a,n){var s=r.apply(e,t);function o(e){v(s,a,n,o,i,"next",e)}function i(e){v(s,a,n,o,i,"throw",e)}o(void 0)}))})();var r}),[L,t.languageProvider,b,O,$,F]);e.value&&!Array.isArray(e.value)&&V&&!V.find((t=>t.value===e.value))&&V.push({label:e.value.toString(),value:e.value.toString(),type:e.valueType});const G=Object.values(d.d).filter((e=>t.languageProvider.getTags(e).length>0)).map((e=>({label:e,value:e}))),U=null==V?void 0:V.filter((e=>{var t;return e.type===(null===(t=V[0])||void 0===t?void 0:t.type)})),Q=(null==V?void 0:V.length)===(null==U?void 0:U.length)?null==V||null===(D=V[0])||void 0===D?void 0:D.type:void 0;let B=m.II;switch(Q){case"keyword":B=m.fV;break;case"string":B=m.jN;break;case"int":case"float":B=m.rx}const J=B.map(f.wu),X=(e,t)=>(void 0!==t?(0,s.uniq)([t,...e]):e).map((e=>({label:e,value:e}))),H=(0,o.useMemo)((()=>{if(0===k.length)return X(g.slice(0,p.J_),e.tag);const t=k.toLowerCase(),r=g.filter((e=>e.toLowerCase().includes(t))).slice(0,p.J_);return X(r,e.tag)}),[e.tag,k,g]),z=(0,o.useMemo)((()=>{if(!V)return;let t=V;if(e.isCustomValue&&e.value){const r=(Array.isArray(e.value)?e.value:[e.value]).filter((e=>!V.some((t=>t.value===e)))).map((t=>({label:t,value:t,type:e.valueType})));r.length>0&&(t=[...V,...r])}if(0===q.length)return t.slice(0,p.J_);const r=q.toLowerCase();return t.filter((e=>!!(e.value&&e.value.length>0)&&e.value.toLowerCase().includes(r))).slice(0,p.J_)}),[q,V,e.isCustomValue,e.value,e.valueType]);return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(u.Stack,{gap:0,width:"auto",children:[!w&&(0,a.jsx)(u.Select,{width:"auto",className:P.dropdown,inputId:`${e.id}-scope`,options:N?_(G):G,value:e.scope,onChange:t=>r(y(h({},e),{scope:null==t?void 0:t.value,tag:void 0,value:[]})),placeholder:"Select scope","aria-label":`select ${e.id} scope`}),!T&&(0,a.jsx)(u.Select,{width:"auto",className:P.dropdown,inputId:`${e.id}-tag`,isLoading:n,options:N?_(H):H,onInputChange:(e,{action:t})=>{"input-change"===t&&A(e)},onCloseMenu:()=>A(""),onChange:t=>r(y(h({},e),{tag:null==t?void 0:t.value,value:[]})),value:e.tag,placeholder:"Select tag",isClearable:!0,"aria-label":`select ${e.id} tag`,allowCustomValue:!0,virtualized:!0},e.tag),(0,a.jsx)(u.Select,{className:P.dropdown,inputId:`${e.id}-operator`,options:N?_(J):J,value:e.operator,onChange:t=>r(y(h({},e),{operator:null==t?void 0:t.value})),isClearable:!1,"aria-label":`select ${e.id} operator`,allowCustomValue:!0,width:8}),!S&&(0,a.jsx)(u.Select,{width:"auto",virtualized:!0,className:P.dropdown,inputId:`${e.id}-value`,isLoading:M,options:N?_(z):z,value:e.value,onInputChange:(e,{action:t})=>{"input-change"===t&&C(e)},onCloseMenu:()=>C(""),onChange:t=>{var a;Array.isArray(t)?r(y(h({},e),{value:t.map((e=>e.value)),valueType:(null===(a=t[0])||void 0===a?void 0:a.type)||Q,isCustomValue:!1})):r(y(h({},e),{value:null==t?void 0:t.value,valueType:(null==t?void 0:t.type)||Q,isCustomValue:!1}))},onCreateOption:t=>{var a;r(y(h({},e),{value:Array.isArray(e.value)?null===(a=e.value)||void 0===a?void 0:a.concat(t):t,valueType:Q,isCustomValue:!0}))},placeholder:"Select value",isClearable:!0,"aria-label":`select ${e.id} value`,allowCustomValue:j,isMulti:I,allowCreateWhileLoading:!0})]}),x&&(0,a.jsx)(l.C,{severity:"error",text:x})]})},_=e=>[...e||[],...(0,c.getTemplateSrv)().getVariables().map((e=>({label:`$${e.name}`,value:`$${e.name}`})))],E=()=>({dropdown:(0,n.css)({boxShadow:"none"})})},362:(e,t,r)=>{const a=r(4708),n=r(4256),{safeRe:s,t:o}=r(5750);e.exports=(e,t)=>{if(e instanceof a)return e;if("number"==typeof e&&(e=String(e)),"string"!=typeof e)return null;let r=null;if((t=t||{}).rtl){const a=t.includePrerelease?s[o.COERCERTLFULL]:s[o.COERCERTL];let n;for(;(n=a.exec(e))&&(!r||r.index+r[0].length!==e.length);)r&&n.index+n[0].length===r.index+r[0].length||(r=n),a.lastIndex=n.index+n[1].length+n[2].length;a.lastIndex=-1}else r=e.match(t.includePrerelease?s[o.COERCEFULL]:s[o.COERCE]);if(null===r)return null;const i=r[2],l=r[3]||"0",c=r[4]||"0",u=t.includePrerelease&&r[5]?`-${r[5]}`:"",d=t.includePrerelease&&r[6]?`+${r[6]}`:"";return n(`${i}.${l}.${c}${u}${d}`,t)}},364:(e,t,r)=>{r.d(t,{A:()=>s});var a=r(5959),n=r(6819);const s=({children:e,...t})=>a.createElement(n.x,{...t,kind:"section"},e)},709:(e,t,r)=>{const a=r(5750),n=r(2074),s=r(4708),o=r(1427),i=r(4256),l=r(9881),c=r(8854),u=r(2479),d=r(4952),p=r(1034),m=r(9406),f=r(5229),v=r(6513),g=r(3440),h=r(7618),y=r(5699),b=r(7565),_=r(3559),E=r(1173),w=r(9308),T=r(2083),S=r(1409),O=r(6031),N=r(3833),I=r(4624),j=r(4991),$=r(362),F=r(9264),D=r(2839),P=r(3238),x=r(3327),R=r(6988),L=r(2366),k=r(7453),A=r(130),q=r(7715),C=r(7379),M=r(110),V=r(284),G=r(8285),U=r(2008);e.exports={parse:i,valid:l,clean:c,inc:u,diff:d,major:p,minor:m,patch:f,prerelease:v,compare:g,rcompare:h,compareLoose:y,compareBuild:b,sort:_,rsort:E,gt:w,lt:T,eq:S,neq:O,gte:N,lte:I,cmp:j,coerce:$,Comparator:F,Range:D,satisfies:P,toComparators:x,maxSatisfying:R,minSatisfying:L,minVersion:k,validRange:A,outside:q,gtr:C,ltr:M,intersects:V,simplifyRange:G,subset:U,SemVer:s,re:a.re,src:a.src,tokens:a.t,SEMVER_SPEC_VERSION:n.SEMVER_SPEC_VERSION,RELEASE_TYPES:n.RELEASE_TYPES,compareIdentifiers:o.compareIdentifiers,rcompareIdentifiers:o.rcompareIdentifiers}},1034:(e,t,r)=>{const a=r(4708);e.exports=(e,t)=>new a(e,t).major},1064:e=>{const t="object"==typeof process&&process.env&&process.env.NODE_DEBUG&&/\bsemver\b/i.test(process.env.NODE_DEBUG)?(...e)=>console.error("SEMVER",...e):()=>{};e.exports=t},1173:(e,t,r)=>{const a=r(7565);e.exports=(e,t)=>e.sort(((e,r)=>a(r,e,t)))},1269:e=>{e.exports=o},1308:t=>{t.exports=e},1409:(e,t,r)=>{const a=r(3440);e.exports=(e,t,r)=>0===a(e,t,r)},1427:e=>{const t=/^[0-9]+$/,r=(e,r)=>{const a=t.test(e),n=t.test(r);return a&&n&&(e=+e,r=+r),e===r?0:a&&!n?-1:n&&!a?1:e<r?-1:1};e.exports={compareIdentifiers:r,rcompareIdentifiers:(e,t)=>r(t,e)}},1777:(e,t,r)=>{var a=r(4769),n=r(5959),s=a.__importDefault(r(5053));t.A=function(e,t){void 0===t&&(t=[]);var r=s.default(e,t,{loading:!0}),a=r[0],o=r[1];return n.useEffect((function(){o()}),[o]),a}},2007:e=>{e.exports=n},2008:(e,t,r)=>{const a=r(2839),n=r(9264),{ANY:s}=n,o=r(3238),i=r(3440),l=[new n(">=0.0.0-0")],c=[new n(">=0.0.0")],u=(e,t,r)=>{if(e===t)return!0;if(1===e.length&&e[0].semver===s){if(1===t.length&&t[0].semver===s)return!0;e=r.includePrerelease?l:c}if(1===t.length&&t[0].semver===s){if(r.includePrerelease)return!0;t=c}const a=new Set;let n,u,m,f,v,g,h;for(const t of e)">"===t.operator||">="===t.operator?n=d(n,t,r):"<"===t.operator||"<="===t.operator?u=p(u,t,r):a.add(t.semver);if(a.size>1)return null;if(n&&u){if(m=i(n.semver,u.semver,r),m>0)return null;if(0===m&&(">="!==n.operator||"<="!==u.operator))return null}for(const e of a){if(n&&!o(e,String(n),r))return null;if(u&&!o(e,String(u),r))return null;for(const a of t)if(!o(e,String(a),r))return!1;return!0}let y=!(!u||r.includePrerelease||!u.semver.prerelease.length)&&u.semver,b=!(!n||r.includePrerelease||!n.semver.prerelease.length)&&n.semver;y&&1===y.prerelease.length&&"<"===u.operator&&0===y.prerelease[0]&&(y=!1);for(const e of t){if(h=h||">"===e.operator||">="===e.operator,g=g||"<"===e.operator||"<="===e.operator,n)if(b&&e.semver.prerelease&&e.semver.prerelease.length&&e.semver.major===b.major&&e.semver.minor===b.minor&&e.semver.patch===b.patch&&(b=!1),">"===e.operator||">="===e.operator){if(f=d(n,e,r),f===e&&f!==n)return!1}else if(">="===n.operator&&!o(n.semver,String(e),r))return!1;if(u)if(y&&e.semver.prerelease&&e.semver.prerelease.length&&e.semver.major===y.major&&e.semver.minor===y.minor&&e.semver.patch===y.patch&&(y=!1),"<"===e.operator||"<="===e.operator){if(v=p(u,e,r),v===e&&v!==u)return!1}else if("<="===u.operator&&!o(u.semver,String(e),r))return!1;if(!e.operator&&(u||n)&&0!==m)return!1}return!(n&&g&&!u&&0!==m)&&(!(u&&h&&!n&&0!==m)&&(!b&&!y))},d=(e,t,r)=>{if(!e)return t;const a=i(e.semver,t.semver,r);return a>0?e:a<0||">"===t.operator&&">="===e.operator?t:e},p=(e,t,r)=>{if(!e)return t;const a=i(e.semver,t.semver,r);return a<0?e:a>0||"<"===t.operator&&"<="===e.operator?t:e};e.exports=(e,t,r={})=>{if(e===t)return!0;e=new a(e,r),t=new a(t,r);let n=!1;e:for(const a of e.set){for(const e of t.set){const t=u(a,e,r);if(n=n||null!==t,t)continue e}if(n)return!1}return!0}},2074:e=>{const t=Number.MAX_SAFE_INTEGER||9007199254740991;e.exports={MAX_LENGTH:256,MAX_SAFE_COMPONENT_LENGTH:16,MAX_SAFE_BUILD_LENGTH:250,MAX_SAFE_INTEGER:t,RELEASE_TYPES:["major","premajor","minor","preminor","patch","prepatch","prerelease"],SEMVER_SPEC_VERSION:"2.0.0",FLAG_INCLUDE_PRERELEASE:1,FLAG_LOOSE:2}},2083:(e,t,r)=>{const a=r(3440);e.exports=(e,t,r)=>a(e,t,r)<0},2366:(e,t,r)=>{const a=r(4708),n=r(2839);e.exports=(e,t,r)=>{let s=null,o=null,i=null;try{i=new n(t,r)}catch(e){return null}return e.forEach((e=>{i.test(e)&&(s&&1!==o.compare(e)||(s=e,o=new a(s,r)))})),s}},2479:(e,t,r)=>{const a=r(4708);e.exports=(e,t,r,n,s)=>{"string"==typeof r&&(s=n,n=r,r=void 0);try{return new a(e instanceof a?e.version:e,r).inc(t,n,s).version}catch(e){return null}}},2839:(e,t,r)=>{const a=/\s+/g;class n{constructor(e,t){if(t=o(t),e instanceof n)return e.loose===!!t.loose&&e.includePrerelease===!!t.includePrerelease?e:new n(e.raw,t);if(e instanceof i)return this.raw=e.value,this.set=[[e]],this.formatted=void 0,this;if(this.options=t,this.loose=!!t.loose,this.includePrerelease=!!t.includePrerelease,this.raw=e.trim().replace(a," "),this.set=this.raw.split("||").map((e=>this.parseRange(e.trim()))).filter((e=>e.length)),!this.set.length)throw new TypeError(`Invalid SemVer Range: ${this.raw}`);if(this.set.length>1){const e=this.set[0];if(this.set=this.set.filter((e=>!h(e[0]))),0===this.set.length)this.set=[e];else if(this.set.length>1)for(const e of this.set)if(1===e.length&&y(e[0])){this.set=[e];break}}this.formatted=void 0}get range(){if(void 0===this.formatted){this.formatted="";for(let e=0;e<this.set.length;e++){e>0&&(this.formatted+="||");const t=this.set[e];for(let e=0;e<t.length;e++)e>0&&(this.formatted+=" "),this.formatted+=t[e].toString().trim()}}return this.formatted}format(){return this.range}toString(){return this.range}parseRange(e){const t=((this.options.includePrerelease&&v)|(this.options.loose&&g))+":"+e,r=s.get(t);if(r)return r;const a=this.options.loose,n=a?u[d.HYPHENRANGELOOSE]:u[d.HYPHENRANGE];e=e.replace(n,F(this.options.includePrerelease)),l("hyphen replace",e),e=e.replace(u[d.COMPARATORTRIM],p),l("comparator trim",e),e=e.replace(u[d.TILDETRIM],m),l("tilde trim",e),e=e.replace(u[d.CARETTRIM],f),l("caret trim",e);let o=e.split(" ").map((e=>_(e,this.options))).join(" ").split(/\s+/).map((e=>$(e,this.options)));a&&(o=o.filter((e=>(l("loose invalid filter",e,this.options),!!e.match(u[d.COMPARATORLOOSE]))))),l("range list",o);const c=new Map,y=o.map((e=>new i(e,this.options)));for(const e of y){if(h(e))return[e];c.set(e.value,e)}c.size>1&&c.has("")&&c.delete("");const b=[...c.values()];return s.set(t,b),b}intersects(e,t){if(!(e instanceof n))throw new TypeError("a Range is required");return this.set.some((r=>b(r,t)&&e.set.some((e=>b(e,t)&&r.every((r=>e.every((e=>r.intersects(e,t)))))))))}test(e){if(!e)return!1;if("string"==typeof e)try{e=new c(e,this.options)}catch(e){return!1}for(let t=0;t<this.set.length;t++)if(D(this.set[t],e,this.options))return!0;return!1}}e.exports=n;const s=new(r(122)),o=r(9547),i=r(9264),l=r(1064),c=r(4708),{safeRe:u,t:d,comparatorTrimReplace:p,tildeTrimReplace:m,caretTrimReplace:f}=r(5750),{FLAG_INCLUDE_PRERELEASE:v,FLAG_LOOSE:g}=r(2074),h=e=>"<0.0.0-0"===e.value,y=e=>""===e.value,b=(e,t)=>{let r=!0;const a=e.slice();let n=a.pop();for(;r&&a.length;)r=a.every((e=>n.intersects(e,t))),n=a.pop();return r},_=(e,t)=>(l("comp",e,t),e=S(e,t),l("caret",e),e=w(e,t),l("tildes",e),e=N(e,t),l("xrange",e),e=j(e,t),l("stars",e),e),E=e=>!e||"x"===e.toLowerCase()||"*"===e,w=(e,t)=>e.trim().split(/\s+/).map((e=>T(e,t))).join(" "),T=(e,t)=>{const r=t.loose?u[d.TILDELOOSE]:u[d.TILDE];return e.replace(r,((t,r,a,n,s)=>{let o;return l("tilde",e,t,r,a,n,s),E(r)?o="":E(a)?o=`>=${r}.0.0 <${+r+1}.0.0-0`:E(n)?o=`>=${r}.${a}.0 <${r}.${+a+1}.0-0`:s?(l("replaceTilde pr",s),o=`>=${r}.${a}.${n}-${s} <${r}.${+a+1}.0-0`):o=`>=${r}.${a}.${n} <${r}.${+a+1}.0-0`,l("tilde return",o),o}))},S=(e,t)=>e.trim().split(/\s+/).map((e=>O(e,t))).join(" "),O=(e,t)=>{l("caret",e,t);const r=t.loose?u[d.CARETLOOSE]:u[d.CARET],a=t.includePrerelease?"-0":"";return e.replace(r,((t,r,n,s,o)=>{let i;return l("caret",e,t,r,n,s,o),E(r)?i="":E(n)?i=`>=${r}.0.0${a} <${+r+1}.0.0-0`:E(s)?i="0"===r?`>=${r}.${n}.0${a} <${r}.${+n+1}.0-0`:`>=${r}.${n}.0${a} <${+r+1}.0.0-0`:o?(l("replaceCaret pr",o),i="0"===r?"0"===n?`>=${r}.${n}.${s}-${o} <${r}.${n}.${+s+1}-0`:`>=${r}.${n}.${s}-${o} <${r}.${+n+1}.0-0`:`>=${r}.${n}.${s}-${o} <${+r+1}.0.0-0`):(l("no pr"),i="0"===r?"0"===n?`>=${r}.${n}.${s}${a} <${r}.${n}.${+s+1}-0`:`>=${r}.${n}.${s}${a} <${r}.${+n+1}.0-0`:`>=${r}.${n}.${s} <${+r+1}.0.0-0`),l("caret return",i),i}))},N=(e,t)=>(l("replaceXRanges",e,t),e.split(/\s+/).map((e=>I(e,t))).join(" ")),I=(e,t)=>{e=e.trim();const r=t.loose?u[d.XRANGELOOSE]:u[d.XRANGE];return e.replace(r,((r,a,n,s,o,i)=>{l("xRange",e,r,a,n,s,o,i);const c=E(n),u=c||E(s),d=u||E(o),p=d;return"="===a&&p&&(a=""),i=t.includePrerelease?"-0":"",c?r=">"===a||"<"===a?"<0.0.0-0":"*":a&&p?(u&&(s=0),o=0,">"===a?(a=">=",u?(n=+n+1,s=0,o=0):(s=+s+1,o=0)):"<="===a&&(a="<",u?n=+n+1:s=+s+1),"<"===a&&(i="-0"),r=`${a+n}.${s}.${o}${i}`):u?r=`>=${n}.0.0${i} <${+n+1}.0.0-0`:d&&(r=`>=${n}.${s}.0${i} <${n}.${+s+1}.0-0`),l("xRange return",r),r}))},j=(e,t)=>(l("replaceStars",e,t),e.trim().replace(u[d.STAR],"")),$=(e,t)=>(l("replaceGTE0",e,t),e.trim().replace(u[t.includePrerelease?d.GTE0PRE:d.GTE0],"")),F=e=>(t,r,a,n,s,o,i,l,c,u,d,p)=>`${r=E(a)?"":E(n)?`>=${a}.0.0${e?"-0":""}`:E(s)?`>=${a}.${n}.0${e?"-0":""}`:o?`>=${r}`:`>=${r}${e?"-0":""}`} ${l=E(c)?"":E(u)?`<${+c+1}.0.0-0`:E(d)?`<${c}.${+u+1}.0-0`:p?`<=${c}.${u}.${d}-${p}`:e?`<${c}.${u}.${+d+1}-0`:`<=${l}`}`.trim(),D=(e,t,r)=>{for(let r=0;r<e.length;r++)if(!e[r].test(t))return!1;if(t.prerelease.length&&!r.includePrerelease){for(let r=0;r<e.length;r++)if(l(e[r].semver),e[r].semver!==i.ANY&&e[r].semver.prerelease.length>0){const a=e[r].semver;if(a.major===t.major&&a.minor===t.minor&&a.patch===t.patch)return!0}return!1}return!0}},3059:e=>{e.exports=i},3238:(e,t,r)=>{const a=r(2839);e.exports=(e,t,r)=>{try{t=new a(t,r)}catch(e){return!1}return t.test(e)}},3241:e=>{e.exports=s},3292:(e,t,r)=>{r.d(t,{Ag:()=>a,Jv:()=>s,O8:()=>n,d:()=>o});var a=function(e){return e.Instant="instant",e.Range="range",e}({}),n=function(e){return e.Done="done",e.Error="error",e.Pending="pending",e.Streaming="streaming",e}({}),s=function(e){return e.Raw="raw",e.Spans="spans",e.Traces="traces",e}({}),o=function(e){return e.Event="event",e.Instrumentation="instrumentation",e.Intrinsic="intrinsic",e.Link="link",e.Resource="resource",e.Span="span",e.Unscoped="unscoped",e}({})},3327:(e,t,r)=>{const a=r(2839);e.exports=(e,t)=>new a(e,t).set.map((e=>e.map((e=>e.value)).join(" ").trim().split(" ")))},3440:(e,t,r)=>{const a=r(4708);e.exports=(e,t,r)=>new a(e,r).compare(new a(t,r))},3559:(e,t,r)=>{const a=r(7565);e.exports=(e,t)=>e.sort(((e,r)=>a(e,r,t)))},3833:(e,t,r)=>{const a=r(3440);e.exports=(e,t,r)=>a(e,t,r)>=0},4256:(e,t,r)=>{const a=r(4708);e.exports=(e,t,r=!1)=>{if(e instanceof a)return e;try{return new a(e,t)}catch(e){if(!r)return null;throw e}}},4624:(e,t,r)=>{const a=r(3440);e.exports=(e,t,r)=>a(e,t,r)<=0},4708:(e,t,r)=>{const a=r(1064),{MAX_LENGTH:n,MAX_SAFE_INTEGER:s}=r(2074),{safeRe:o,t:i}=r(5750),l=r(9547),{compareIdentifiers:c}=r(1427);class u{constructor(e,t){if(t=l(t),e instanceof u){if(e.loose===!!t.loose&&e.includePrerelease===!!t.includePrerelease)return e;e=e.version}else if("string"!=typeof e)throw new TypeError(`Invalid version. Must be a string. Got type "${typeof e}".`);if(e.length>n)throw new TypeError(`version is longer than ${n} characters`);a("SemVer",e,t),this.options=t,this.loose=!!t.loose,this.includePrerelease=!!t.includePrerelease;const r=e.trim().match(t.loose?o[i.LOOSE]:o[i.FULL]);if(!r)throw new TypeError(`Invalid Version: ${e}`);if(this.raw=e,this.major=+r[1],this.minor=+r[2],this.patch=+r[3],this.major>s||this.major<0)throw new TypeError("Invalid major version");if(this.minor>s||this.minor<0)throw new TypeError("Invalid minor version");if(this.patch>s||this.patch<0)throw new TypeError("Invalid patch version");r[4]?this.prerelease=r[4].split(".").map((e=>{if(/^[0-9]+$/.test(e)){const t=+e;if(t>=0&&t<s)return t}return e})):this.prerelease=[],this.build=r[5]?r[5].split("."):[],this.format()}format(){return this.version=`${this.major}.${this.minor}.${this.patch}`,this.prerelease.length&&(this.version+=`-${this.prerelease.join(".")}`),this.version}toString(){return this.version}compare(e){if(a("SemVer.compare",this.version,this.options,e),!(e instanceof u)){if("string"==typeof e&&e===this.version)return 0;e=new u(e,this.options)}return e.version===this.version?0:this.compareMain(e)||this.comparePre(e)}compareMain(e){return e instanceof u||(e=new u(e,this.options)),c(this.major,e.major)||c(this.minor,e.minor)||c(this.patch,e.patch)}comparePre(e){if(e instanceof u||(e=new u(e,this.options)),this.prerelease.length&&!e.prerelease.length)return-1;if(!this.prerelease.length&&e.prerelease.length)return 1;if(!this.prerelease.length&&!e.prerelease.length)return 0;let t=0;do{const r=this.prerelease[t],n=e.prerelease[t];if(a("prerelease compare",t,r,n),void 0===r&&void 0===n)return 0;if(void 0===n)return 1;if(void 0===r)return-1;if(r!==n)return c(r,n)}while(++t)}compareBuild(e){e instanceof u||(e=new u(e,this.options));let t=0;do{const r=this.build[t],n=e.build[t];if(a("build compare",t,r,n),void 0===r&&void 0===n)return 0;if(void 0===n)return 1;if(void 0===r)return-1;if(r!==n)return c(r,n)}while(++t)}inc(e,t,r){if(e.startsWith("pre")){if(!t&&!1===r)throw new Error("invalid increment argument: identifier is empty");if(t){const e=`-${t}`.match(this.options.loose?o[i.PRERELEASELOOSE]:o[i.PRERELEASE]);if(!e||e[1]!==t)throw new Error(`invalid identifier: ${t}`)}}switch(e){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",t,r);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",t,r);break;case"prepatch":this.prerelease.length=0,this.inc("patch",t,r),this.inc("pre",t,r);break;case"prerelease":0===this.prerelease.length&&this.inc("patch",t,r),this.inc("pre",t,r);break;case"release":if(0===this.prerelease.length)throw new Error(`version ${this.raw} is not a prerelease`);this.prerelease.length=0;break;case"major":0===this.minor&&0===this.patch&&0!==this.prerelease.length||this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":0===this.patch&&0!==this.prerelease.length||this.minor++,this.patch=0,this.prerelease=[];break;case"patch":0===this.prerelease.length&&this.patch++,this.prerelease=[];break;case"pre":{const e=Number(r)?1:0;if(0===this.prerelease.length)this.prerelease=[e];else{let a=this.prerelease.length;for(;--a>=0;)"number"==typeof this.prerelease[a]&&(this.prerelease[a]++,a=-2);if(-1===a){if(t===this.prerelease.join(".")&&!1===r)throw new Error("invalid increment argument: identifier already exists");this.prerelease.push(e)}}if(t){let a=[t,e];!1===r&&(a=[t]),0===c(this.prerelease[0],t)?isNaN(this.prerelease[1])&&(this.prerelease=a):this.prerelease=a}break}default:throw new Error(`invalid increment argument: ${e}`)}return this.raw=this.format(),this.build.length&&(this.raw+=`+${this.build.join(".")}`),this}}e.exports=u},4769:(e,t,r)=>{r.r(t),r.d(t,{__addDisposableResource:()=>L,__assign:()=>s,__asyncDelegator:()=>O,__asyncGenerator:()=>S,__asyncValues:()=>N,__await:()=>T,__awaiter:()=>f,__classPrivateFieldGet:()=>P,__classPrivateFieldIn:()=>R,__classPrivateFieldSet:()=>x,__createBinding:()=>g,__decorate:()=>i,__disposeResources:()=>A,__esDecorate:()=>c,__exportStar:()=>h,__extends:()=>n,__generator:()=>v,__importDefault:()=>D,__importStar:()=>F,__makeTemplateObject:()=>I,__metadata:()=>m,__param:()=>l,__propKey:()=>d,__read:()=>b,__rest:()=>o,__rewriteRelativeImportExtension:()=>q,__runInitializers:()=>u,__setFunctionName:()=>p,__spread:()=>_,__spreadArray:()=>w,__spreadArrays:()=>E,__values:()=>y,default:()=>C});var a=function(e,t){return a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},a(e,t)};function n(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}var s=function(){return s=Object.assign||function(e){for(var t,r=1,a=arguments.length;r<a;r++)for(var n in t=arguments[r])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e},s.apply(this,arguments)};function o(e,t){var r={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(r[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(a=Object.getOwnPropertySymbols(e);n<a.length;n++)t.indexOf(a[n])<0&&Object.prototype.propertyIsEnumerable.call(e,a[n])&&(r[a[n]]=e[a[n]])}return r}function i(e,t,r,a){var n,s=arguments.length,o=s<3?t:null===a?a=Object.getOwnPropertyDescriptor(t,r):a;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,a);else for(var i=e.length-1;i>=0;i--)(n=e[i])&&(o=(s<3?n(o):s>3?n(t,r,o):n(t,r))||o);return s>3&&o&&Object.defineProperty(t,r,o),o}function l(e,t){return function(r,a){t(r,a,e)}}function c(e,t,r,a,n,s){function o(e){if(void 0!==e&&"function"!=typeof e)throw new TypeError("Function expected");return e}for(var i,l=a.kind,c="getter"===l?"get":"setter"===l?"set":"value",u=!t&&e?a.static?e:e.prototype:null,d=t||(u?Object.getOwnPropertyDescriptor(u,a.name):{}),p=!1,m=r.length-1;m>=0;m--){var f={};for(var v in a)f[v]="access"===v?{}:a[v];for(var v in a.access)f.access[v]=a.access[v];f.addInitializer=function(e){if(p)throw new TypeError("Cannot add initializers after decoration has completed");s.push(o(e||null))};var g=(0,r[m])("accessor"===l?{get:d.get,set:d.set}:d[c],f);if("accessor"===l){if(void 0===g)continue;if(null===g||"object"!=typeof g)throw new TypeError("Object expected");(i=o(g.get))&&(d.get=i),(i=o(g.set))&&(d.set=i),(i=o(g.init))&&n.unshift(i)}else(i=o(g))&&("field"===l?n.unshift(i):d[c]=i)}u&&Object.defineProperty(u,a.name,d),p=!0}function u(e,t,r){for(var a=arguments.length>2,n=0;n<t.length;n++)r=a?t[n].call(e,r):t[n].call(e);return a?r:void 0}function d(e){return"symbol"==typeof e?e:"".concat(e)}function p(e,t,r){return"symbol"==typeof t&&(t=t.description?"[".concat(t.description,"]"):""),Object.defineProperty(e,"name",{configurable:!0,value:r?"".concat(r," ",t):t})}function m(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}function f(e,t,r,a){return new(r||(r=Promise))((function(n,s){function o(e){try{l(a.next(e))}catch(e){s(e)}}function i(e){try{l(a.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(o,i)}l((a=a.apply(e,t||[])).next())}))}function v(e,t){var r,a,n,s={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]},o=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return o.next=i(0),o.throw=i(1),o.return=i(2),"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function i(i){return function(l){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;o&&(o=0,i[0]&&(s=0)),s;)try{if(r=1,a&&(n=2&i[0]?a.return:i[0]?a.throw||((n=a.return)&&n.call(a),0):a.next)&&!(n=n.call(a,i[1])).done)return n;switch(a=0,n&&(i=[2&i[0],n.value]),i[0]){case 0:case 1:n=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,a=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!(n=s.trys,(n=n.length>0&&n[n.length-1])||6!==i[0]&&2!==i[0])){s=0;continue}if(3===i[0]&&(!n||i[1]>n[0]&&i[1]<n[3])){s.label=i[1];break}if(6===i[0]&&s.label<n[1]){s.label=n[1],n=i;break}if(n&&s.label<n[2]){s.label=n[2],s.ops.push(i);break}n[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(e){i=[6,e],a=0}finally{r=n=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,l])}}}var g=Object.create?function(e,t,r,a){void 0===a&&(a=r);var n=Object.getOwnPropertyDescriptor(t,r);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,a,n)}:function(e,t,r,a){void 0===a&&(a=r),e[a]=t[r]};function h(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||g(t,e,r)}function y(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],a=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&a>=e.length&&(e=void 0),{value:e&&e[a++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function b(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var a,n,s=r.call(e),o=[];try{for(;(void 0===t||t-- >0)&&!(a=s.next()).done;)o.push(a.value)}catch(e){n={error:e}}finally{try{a&&!a.done&&(r=s.return)&&r.call(s)}finally{if(n)throw n.error}}return o}function _(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(b(arguments[t]));return e}function E(){for(var e=0,t=0,r=arguments.length;t<r;t++)e+=arguments[t].length;var a=Array(e),n=0;for(t=0;t<r;t++)for(var s=arguments[t],o=0,i=s.length;o<i;o++,n++)a[n]=s[o];return a}function w(e,t,r){if(r||2===arguments.length)for(var a,n=0,s=t.length;n<s;n++)!a&&n in t||(a||(a=Array.prototype.slice.call(t,0,n)),a[n]=t[n]);return e.concat(a||Array.prototype.slice.call(t))}function T(e){return this instanceof T?(this.v=e,this):new T(e)}function S(e,t,r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var a,n=r.apply(e,t||[]),s=[];return a=Object.create(("function"==typeof AsyncIterator?AsyncIterator:Object).prototype),o("next"),o("throw"),o("return",(function(e){return function(t){return Promise.resolve(t).then(e,c)}})),a[Symbol.asyncIterator]=function(){return this},a;function o(e,t){n[e]&&(a[e]=function(t){return new Promise((function(r,a){s.push([e,t,r,a])>1||i(e,t)}))},t&&(a[e]=t(a[e])))}function i(e,t){try{(r=n[e](t)).value instanceof T?Promise.resolve(r.value.v).then(l,c):u(s[0][2],r)}catch(e){u(s[0][3],e)}var r}function l(e){i("next",e)}function c(e){i("throw",e)}function u(e,t){e(t),s.shift(),s.length&&i(s[0][0],s[0][1])}}function O(e){var t,r;return t={},a("next"),a("throw",(function(e){throw e})),a("return"),t[Symbol.iterator]=function(){return this},t;function a(a,n){t[a]=e[a]?function(t){return(r=!r)?{value:T(e[a](t)),done:!1}:n?n(t):t}:n}}function N(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,r=e[Symbol.asyncIterator];return r?r.call(e):(e=y(e),t={},a("next"),a("throw"),a("return"),t[Symbol.asyncIterator]=function(){return this},t);function a(r){t[r]=e[r]&&function(t){return new Promise((function(a,n){(function(e,t,r,a){Promise.resolve(a).then((function(t){e({value:t,done:r})}),t)})(a,n,(t=e[r](t)).done,t.value)}))}}}function I(e,t){return Object.defineProperty?Object.defineProperty(e,"raw",{value:t}):e.raw=t,e}var j=Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t},$=function(e){return $=Object.getOwnPropertyNames||function(e){var t=[];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[t.length]=r);return t},$(e)};function F(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r=$(e),a=0;a<r.length;a++)"default"!==r[a]&&g(t,e,r[a]);return j(t,e),t}function D(e){return e&&e.__esModule?e:{default:e}}function P(e,t,r,a){if("a"===r&&!a)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!a:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===r?a:"a"===r?a.call(e):a?a.value:t.get(e)}function x(e,t,r,a,n){if("m"===a)throw new TypeError("Private method is not writable");if("a"===a&&!n)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===a?n.call(e,r):n?n.value=r:t.set(e,r),r}function R(e,t){if(null===t||"object"!=typeof t&&"function"!=typeof t)throw new TypeError("Cannot use 'in' operator on non-object");return"function"==typeof e?t===e:e.has(t)}function L(e,t,r){if(null!=t){if("object"!=typeof t&&"function"!=typeof t)throw new TypeError("Object expected.");var a,n;if(r){if(!Symbol.asyncDispose)throw new TypeError("Symbol.asyncDispose is not defined.");a=t[Symbol.asyncDispose]}if(void 0===a){if(!Symbol.dispose)throw new TypeError("Symbol.dispose is not defined.");a=t[Symbol.dispose],r&&(n=a)}if("function"!=typeof a)throw new TypeError("Object not disposable.");n&&(a=function(){try{n.call(this)}catch(e){return Promise.reject(e)}}),e.stack.push({value:t,dispose:a,async:r})}else r&&e.stack.push({async:!0});return t}var k="function"==typeof SuppressedError?SuppressedError:function(e,t,r){var a=new Error(r);return a.name="SuppressedError",a.error=e,a.suppressed=t,a};function A(e){function t(t){e.error=e.hasError?new k(t,e.error,"An error was suppressed during disposal."):t,e.hasError=!0}var r,a=0;return function n(){for(;r=e.stack.pop();)try{if(!r.async&&1===a)return a=0,e.stack.push(r),Promise.resolve().then(n);if(r.dispose){var s=r.dispose.call(r.value);if(r.async)return a|=2,Promise.resolve(s).then(n,(function(e){return t(e),n()}))}else a|=1}catch(e){t(e)}if(1===a)return e.hasError?Promise.reject(e.error):Promise.resolve();if(e.hasError)throw e.error}()}function q(e,t){return"string"==typeof e&&/^\.\.?\//.test(e)?e.replace(/\.(tsx)$|((?:\.d)?)((?:\.[^./]+?)?)\.([cm]?)ts$/i,(function(e,r,a,n,s){return r?t?".jsx":".js":!a||n&&s?a+n+"."+s.toLowerCase()+"js":e})):e}const C={__extends:n,__assign:s,__rest:o,__decorate:i,__param:l,__esDecorate:c,__runInitializers:u,__propKey:d,__setFunctionName:p,__metadata:m,__awaiter:f,__generator:v,__createBinding:g,__exportStar:h,__values:y,__read:b,__spread:_,__spreadArrays:E,__spreadArray:w,__await:T,__asyncGenerator:S,__asyncDelegator:O,__asyncValues:N,__makeTemplateObject:I,__importStar:F,__importDefault:D,__classPrivateFieldGet:P,__classPrivateFieldSet:x,__classPrivateFieldIn:R,__addDisposableResource:L,__disposeResources:A,__rewriteRelativeImportExtension:q}},4848:(e,t,r)=>{r.d(t,{FJ:()=>b,T0:()=>_,XX:()=>y,cJ:()=>h});var a=r(9728),n=r(6089),s=r(5959),o=r(364),i=r(5909),l=r(8531),c=r(2007),u=r(9558),d=r(9784);function p(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function m(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},a=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(a=a.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),a.forEach((function(t){p(e,t,r[t])}))}return e}function f(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,a)}return r}(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})),e}function v({options:e,onOptionsChange:t}){const r=["loki","elasticsearch","grafana-splunk-datasource","grafana-opensearch-datasource","grafana-falconlogscale-datasource","googlecloud-logging-datasource","victoriametrics-logs-datasource"],o=(0,s.useMemo)((()=>function(e){var t;if(null==e?void 0:e.tracesToLogsV2)return e.tracesToLogsV2;if(!(null==e?void 0:e.tracesToLogs))return;const r={customQuery:!1};return r.datasourceUid=e.tracesToLogs.datasourceUid,r.tags=e.tracesToLogs.mapTagNamesEnabled?e.tracesToLogs.mappedTags:null===(t=e.tracesToLogs.tags)||void 0===t?void 0:t.map((e=>({key:e}))),r.filterByTraceID=e.tracesToLogs.filterByTraceID,r.filterBySpanID=e.tracesToLogs.filterBySpanID,r.spanStartTimeShift=e.tracesToLogs.spanStartTimeShift,r.spanEndTimeShift=e.tracesToLogs.spanEndTimeShift,r}(e.jsonData)||{customQuery:!1}),[e.jsonData]),{query:i="",tags:p,customQuery:v}=o,_=(0,s.useCallback)((r=>{t(f(m({},e),{jsonData:f(m({},e.jsonData),{tracesToLogsV2:m({},o,r),tracesToLogs:void 0})}))}),[t,e,o]);return(0,a.jsxs)("div",{className:(0,n.css)({width:"100%"}),children:[(0,a.jsx)(c.InlineFieldRow,{children:(0,a.jsx)(c.InlineField,{tooltip:"The logs data source the trace is going to navigate to",label:"Data source",labelWidth:26,children:(0,a.jsx)(l.DataSourcePicker,{inputId:"trace-to-logs-data-source-picker",filter:e=>r.includes(e.type),current:o.datasourceUid,noDefault:!0,width:40,onChange:e=>_({datasourceUid:e.uid}),onClear:()=>_({datasourceUid:void 0})})})}),(0,a.jsx)(c.InlineFieldRow,{children:(0,a.jsx)(u.e,{label:h("start"),tooltip:y("start","0"),value:o.spanStartTimeShift||"",onChange:e=>{_({spanStartTimeShift:e})},isInvalidError:b})}),(0,a.jsx)(c.InlineFieldRow,{children:(0,a.jsx)(u.e,{label:h("end"),tooltip:y("end","0"),value:o.spanEndTimeShift||"",onChange:e=>{_({spanEndTimeShift:e})},isInvalidError:b})}),(0,a.jsx)(c.InlineFieldRow,{children:(0,a.jsx)(c.InlineField,{tooltip:"Tags that will be used in the query. Default tags: 'cluster', 'hostname', 'namespace', 'pod', 'service.name', 'service.namespace'",label:"Tags",labelWidth:26,children:(0,a.jsx)(d.l,{values:null!=p?p:[],onChange:e=>_({tags:e})})})}),(0,a.jsx)(g,{disabled:v,type:"trace",id:"filterByTraceID",value:Boolean(o.filterByTraceID),onChange:e=>_({filterByTraceID:e})}),(0,a.jsx)(g,{disabled:v,type:"span",id:"filterBySpanID",value:Boolean(o.filterBySpanID),onChange:e=>_({filterBySpanID:e})}),(0,a.jsx)(c.InlineFieldRow,{children:(0,a.jsx)(c.InlineField,{tooltip:"Use a custom query with the possibility to interpolate variables from the trace or span",label:"Use custom query",labelWidth:26,children:(0,a.jsx)(c.InlineSwitch,{id:"customQuerySwitch",value:v,onChange:e=>_({customQuery:e.currentTarget.checked})})})}),v&&(0,a.jsx)(c.InlineField,{label:"Query",labelWidth:26,tooltip:"The query that will run when navigating from a trace to logs data source. Interpolate tags using the `$__tags` keyword",grow:!0,children:(0,a.jsx)(c.Input,{label:"Query",type:"text",allowFullScreen:!0,value:i,onChange:e=>_({query:e.currentTarget.value})})})]})}function g(e){return(0,a.jsx)(c.InlineFieldRow,{children:(0,a.jsx)(c.InlineField,{disabled:e.disabled,label:`Filter by ${e.type} ID`,labelWidth:26,grow:!0,tooltip:`Filters logs by ${e.type} ID, where the ${e.type} ID should be part of the log line`,children:(0,a.jsx)(c.InlineSwitch,{id:e.id,value:e.value,onChange:t=>e.onChange(t.currentTarget.checked)})})})}const h=e=>`Span ${e} time shift`,y=(e,t)=>`Shifts the ${e} time of the span. Default: ${t} (Time units can be used here, for example: 5s, -1m, 3h)`,b="Invalid time shift. See tooltip for examples.",_=({options:e,onOptionsChange:t})=>{let r=e.type;return r+="tempo"===e.type?"/configure-tempo-data-source/#trace-to-logs":"/#trace-to-logs",(0,a.jsx)(o.A,{title:"Trace to logs",description:(0,a.jsx)(i.H,{description:"Navigate from a trace span to the selected data source's logs.",suffix:r,feature:"trace to logs"}),isCollapsible:!0,isInitiallyOpen:!0,children:(0,a.jsx)(v,{options:e,onOptionsChange:t})})}},4952:(e,t,r)=>{const a=r(4256);e.exports=(e,t)=>{const r=a(e,null,!0),n=a(t,null,!0),s=r.compare(n);if(0===s)return null;const o=s>0,i=o?r:n,l=o?n:r,c=!!i.prerelease.length;if(!!l.prerelease.length&&!c){if(!l.patch&&!l.minor)return"major";if(0===l.compareMain(i))return l.minor&&!l.patch?"minor":"patch"}const u=c?"pre":"";return r.major!==n.major?u+"major":r.minor!==n.minor?u+"minor":r.patch!==n.patch?u+"patch":"prerelease"}},4991:(e,t,r)=>{const a=r(1409),n=r(6031),s=r(9308),o=r(3833),i=r(2083),l=r(4624);e.exports=(e,t,r,c)=>{switch(t){case"===":return"object"==typeof e&&(e=e.version),"object"==typeof r&&(r=r.version),e===r;case"!==":return"object"==typeof e&&(e=e.version),"object"==typeof r&&(r=r.version),e!==r;case"":case"=":case"==":return a(e,r,c);case"!=":return n(e,r,c);case">":return s(e,r,c);case">=":return o(e,r,c);case"<":return i(e,r,c);case"<=":return l(e,r,c);default:throw new TypeError(`Invalid operator: ${t}`)}}},5053:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0});var a=r(4769),n=r(5959),s=a.__importDefault(r(9812));t.default=function(e,t,r){void 0===t&&(t=[]),void 0===r&&(r={loading:!1});var o=n.useRef(0),i=s.default(),l=n.useState(r),c=l[0],u=l[1],d=n.useCallback((function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];var n=++o.current;return c.loading||u((function(e){return a.__assign(a.__assign({},e),{loading:!0})})),e.apply(void 0,t).then((function(e){return i()&&n===o.current&&u({value:e,loading:!1}),e}),(function(e){return i()&&n===o.current&&u({error:e,loading:!1}),e}))}),t);return[c,d]}},5229:(e,t,r)=>{const a=r(4708);e.exports=(e,t)=>new a(e,t).patch},5645:(e,t,r)=>{r.d(t,{YN:()=>u,d6:()=>m,hO:()=>f,q$:()=>p,u1:()=>d});var a=r(7781),n=r(8531),s=r(5876),o=r(3292);function i(e,t,r,a,n,s,o){try{var i=e[s](o),l=i.value}catch(e){return void r(e)}i.done?t(l):Promise.resolve(l).then(a,n)}const l=/.*range specified by start and end.*exceeds.*/,c=/.*metrics query time range exceeds the maximum allowed duration of.*/;function u(e){return e&&(l.test(e)||c.test(e))?"The selected time range exceeds the maximum allowed duration. Please select a shorter time range.":e}const d=(e,t)=>u(`${t||"Error"}${e?` (${e})`:""}. Please check the server logs for more details.`);function p(e){return(t=function*(){if(!e)return;const t=(0,n.getDataSourceSrv)();try{return yield t.get(e)}catch(e){return void console.error("Failed to load data source",e)}},function(){var e=this,r=arguments;return new Promise((function(a,n){var s=t.apply(e,r);function o(e){i(s,a,n,o,l,"next",e)}function l(e){i(s,a,n,o,l,"throw",e)}o(void 0)}))})();var t}const m=e=>{let t=[];if(e.spanName&&t.push({id:"span-name",scope:o.d.Span,tag:"name",operator:"=",value:[e.spanName],valueType:"string"}),e.serviceName&&t.push({id:"service-name",scope:o.d.Resource,tag:"service.name",operator:"=",value:[e.serviceName],valueType:"string"}),(e.minDuration||e.maxDuration)&&t.push({id:"duration-type",value:"trace"}),e.minDuration&&t.push({id:"min-duration",tag:"duration",operator:">",value:[e.minDuration],valueType:"duration"}),e.maxDuration&&t.push({id:"max-duration",tag:"duration",operator:"<",value:[e.maxDuration],valueType:"duration"}),e.search){const r=e.search.split(" ");for(const e of r){const[r,a]=e.split("=");r&&a&&t.push({id:(0,s.$)(),scope:o.d.Unscoped,tag:r,operator:"=",value:[a.replace(/(^"|"$)/g,"")],valueType:a.startsWith('"')&&a.endsWith('"')?"string":void 0})}}return{datasource:e.datasource,filters:t,limit:e.limit,query:e.query,queryType:"traceqlSearch",refId:e.refId}},f=e=>{if(!e)return 0;const t=e.match(/(\d+)(.+)/),r=null==t?void 0:t[1],n=null==t?void 0:t[2];if(r){if("ns"===n)return parseInt(r,10);if("µs"===n)return 1e3*parseInt(r,10);if("ms"===n)return 1e6*parseInt(r,10);const t=(0,a.parseDuration)(e);return 1e9*(t.seconds||0)+6e10*(t.minutes||0)+36e11*(t.hours||0)}return 0}},5699:(e,t,r)=>{const a=r(3440);e.exports=(e,t)=>a(e,t,!0)},5750:(e,t,r)=>{const{MAX_SAFE_COMPONENT_LENGTH:a,MAX_SAFE_BUILD_LENGTH:n,MAX_LENGTH:s}=r(2074),o=r(1064),i=(t=e.exports={}).re=[],l=t.safeRe=[],c=t.src=[],u=t.safeSrc=[],d=t.t={};let p=0;const m="[a-zA-Z0-9-]",f=[["\\s",1],["\\d",s],[m,n]],v=(e,t,r)=>{const a=(e=>{for(const[t,r]of f)e=e.split(`${t}*`).join(`${t}{0,${r}}`).split(`${t}+`).join(`${t}{1,${r}}`);return e})(t),n=p++;o(e,n,t),d[e]=n,c[n]=t,u[n]=a,i[n]=new RegExp(t,r?"g":void 0),l[n]=new RegExp(a,r?"g":void 0)};v("NUMERICIDENTIFIER","0|[1-9]\\d*"),v("NUMERICIDENTIFIERLOOSE","\\d+"),v("NONNUMERICIDENTIFIER",`\\d*[a-zA-Z-]${m}*`),v("MAINVERSION",`(${c[d.NUMERICIDENTIFIER]})\\.(${c[d.NUMERICIDENTIFIER]})\\.(${c[d.NUMERICIDENTIFIER]})`),v("MAINVERSIONLOOSE",`(${c[d.NUMERICIDENTIFIERLOOSE]})\\.(${c[d.NUMERICIDENTIFIERLOOSE]})\\.(${c[d.NUMERICIDENTIFIERLOOSE]})`),v("PRERELEASEIDENTIFIER",`(?:${c[d.NONNUMERICIDENTIFIER]}|${c[d.NUMERICIDENTIFIER]})`),v("PRERELEASEIDENTIFIERLOOSE",`(?:${c[d.NONNUMERICIDENTIFIER]}|${c[d.NUMERICIDENTIFIERLOOSE]})`),v("PRERELEASE",`(?:-(${c[d.PRERELEASEIDENTIFIER]}(?:\\.${c[d.PRERELEASEIDENTIFIER]})*))`),v("PRERELEASELOOSE",`(?:-?(${c[d.PRERELEASEIDENTIFIERLOOSE]}(?:\\.${c[d.PRERELEASEIDENTIFIERLOOSE]})*))`),v("BUILDIDENTIFIER",`${m}+`),v("BUILD",`(?:\\+(${c[d.BUILDIDENTIFIER]}(?:\\.${c[d.BUILDIDENTIFIER]})*))`),v("FULLPLAIN",`v?${c[d.MAINVERSION]}${c[d.PRERELEASE]}?${c[d.BUILD]}?`),v("FULL",`^${c[d.FULLPLAIN]}$`),v("LOOSEPLAIN",`[v=\\s]*${c[d.MAINVERSIONLOOSE]}${c[d.PRERELEASELOOSE]}?${c[d.BUILD]}?`),v("LOOSE",`^${c[d.LOOSEPLAIN]}$`),v("GTLT","((?:<|>)?=?)"),v("XRANGEIDENTIFIERLOOSE",`${c[d.NUMERICIDENTIFIERLOOSE]}|x|X|\\*`),v("XRANGEIDENTIFIER",`${c[d.NUMERICIDENTIFIER]}|x|X|\\*`),v("XRANGEPLAIN",`[v=\\s]*(${c[d.XRANGEIDENTIFIER]})(?:\\.(${c[d.XRANGEIDENTIFIER]})(?:\\.(${c[d.XRANGEIDENTIFIER]})(?:${c[d.PRERELEASE]})?${c[d.BUILD]}?)?)?`),v("XRANGEPLAINLOOSE",`[v=\\s]*(${c[d.XRANGEIDENTIFIERLOOSE]})(?:\\.(${c[d.XRANGEIDENTIFIERLOOSE]})(?:\\.(${c[d.XRANGEIDENTIFIERLOOSE]})(?:${c[d.PRERELEASELOOSE]})?${c[d.BUILD]}?)?)?`),v("XRANGE",`^${c[d.GTLT]}\\s*${c[d.XRANGEPLAIN]}$`),v("XRANGELOOSE",`^${c[d.GTLT]}\\s*${c[d.XRANGEPLAINLOOSE]}$`),v("COERCEPLAIN",`(^|[^\\d])(\\d{1,${a}})(?:\\.(\\d{1,${a}}))?(?:\\.(\\d{1,${a}}))?`),v("COERCE",`${c[d.COERCEPLAIN]}(?:$|[^\\d])`),v("COERCEFULL",c[d.COERCEPLAIN]+`(?:${c[d.PRERELEASE]})?`+`(?:${c[d.BUILD]})?(?:$|[^\\d])`),v("COERCERTL",c[d.COERCE],!0),v("COERCERTLFULL",c[d.COERCEFULL],!0),v("LONETILDE","(?:~>?)"),v("TILDETRIM",`(\\s*)${c[d.LONETILDE]}\\s+`,!0),t.tildeTrimReplace="$1~",v("TILDE",`^${c[d.LONETILDE]}${c[d.XRANGEPLAIN]}$`),v("TILDELOOSE",`^${c[d.LONETILDE]}${c[d.XRANGEPLAINLOOSE]}$`),v("LONECARET","(?:\\^)"),v("CARETTRIM",`(\\s*)${c[d.LONECARET]}\\s+`,!0),t.caretTrimReplace="$1^",v("CARET",`^${c[d.LONECARET]}${c[d.XRANGEPLAIN]}$`),v("CARETLOOSE",`^${c[d.LONECARET]}${c[d.XRANGEPLAINLOOSE]}$`),v("COMPARATORLOOSE",`^${c[d.GTLT]}\\s*(${c[d.LOOSEPLAIN]})$|^$`),v("COMPARATOR",`^${c[d.GTLT]}\\s*(${c[d.FULLPLAIN]})$|^$`),v("COMPARATORTRIM",`(\\s*)${c[d.GTLT]}\\s*(${c[d.LOOSEPLAIN]}|${c[d.XRANGEPLAIN]})`,!0),t.comparatorTrimReplace="$1$2$3",v("HYPHENRANGE",`^\\s*(${c[d.XRANGEPLAIN]})\\s+-\\s+(${c[d.XRANGEPLAIN]})\\s*$`),v("HYPHENRANGELOOSE",`^\\s*(${c[d.XRANGEPLAINLOOSE]})\\s+-\\s+(${c[d.XRANGEPLAINLOOSE]})\\s*$`),v("STAR","(<|>)?=?\\s*\\*"),v("GTE0","^\\s*>=\\s*0\\.0\\.0\\s*$"),v("GTE0PRE","^\\s*>=\\s*0\\.0\\.0-0\\s*$")},5876:(e,t,r)=>{r.d(t,{A:()=>f,$:()=>v});var a=r(9728),n=r(6089),s=r(5959),o=r(6373),i=(r(7781),r(2007));const l=({className:e,...t})=>{const r=(0,i.useStyles2)(c);return s.createElement(i.Button,{...t,className:(0,n.cx)(e,r.button)})},c=e=>({button:(0,n.css)({paddingLeft:e.spacing(1.5),paddingRight:e.spacing(1.5)})});var u=r(3292),d=r(318),p=r(9183);const m=e=>({vertical:(0,n.css)({display:"flex",flexDirection:"column",gap:e.spacing(.25)}),horizontal:(0,n.css)({display:"flex",flexDirection:"row",gap:e.spacing(1)}),addTag:(0,n.css)({marginLeft:e.spacing(1)})}),f=({updateFilter:e,deleteFilter:t,filters:r,datasource:n,setError:o,staticTags:c,isTagsLoading:f,hideValues:g,requireTagAndValue:h,generateQueryWithoutFilter:y,addVariablesToOptions:b,range:_,timeRangeForTags:E})=>{const w=(0,i.useStyles2)(m),T=(0,s.useCallback)((()=>e({id:v(),operator:"=",scope:u.d.Span})),[e]);(0,s.useEffect)((()=>{(null==r?void 0:r.length)||T()}),[r,T]);const S=e=>{const t=n.languageProvider.getTags(e.scope);return(0,p.l8)(t,c)},O=e=>h?e.tag&&e.value&&e.value.length>0:e.tag;return(0,a.jsx)("div",{className:w.vertical,children:null==r?void 0:r.map(((s,i)=>(0,a.jsxs)("div",{className:w.horizontal,children:[(0,a.jsx)(d.A,{filter:s,datasource:n,setError:o,updateFilter:e,tags:S(s),isTagsLoading:f,hideValue:g,query:y(s),addVariablesToOptions:b,range:_,timeRangeForTags:E}),(O(s)||r.length>1)&&(0,a.jsx)(l,{"aria-label":`Remove tag with ID ${s.id}`,variant:"secondary",icon:"times",onClick:()=>null==t?void 0:t(s),tooltip:"Remove tag"}),O(s)&&i===r.length-1&&(0,a.jsx)("span",{className:w.addTag,children:(0,a.jsx)(l,{"aria-label":"Add tag",variant:"secondary",icon:"plus",onClick:T,tooltip:"Add tag"})})]},s.id)))})},v=()=>(0,o.A)().slice(0,8)},5909:(e,t,r)=>{r.d(t,{H:()=>o});var a=r(6089),n=r(5959),s=(r(7781),r(2007));function o(e){const{description:t,suffix:r,feature:a}=e,o=`Learn more about ${a}`,l=(0,s.useStyles2)(i);return n.createElement("span",{className:l.container},t,n.createElement("a",{"aria-label":o,href:`https://grafana.com/docs/grafana/next/datasources/${r}`,rel:"noreferrer",target:"_blank"},o))}const i=e=>({container:(0,a.css)({color:e.colors.text.secondary,a:(0,a.css)({color:e.colors.text.link,textDecoration:"underline",marginLeft:"5px","&:hover":{textDecoration:"none"}})})})},5959:e=>{e.exports=t},6031:(e,t,r)=>{const a=r(3440);e.exports=(e,t,r)=>0!==a(e,t,r)},6089:e=>{e.exports=l},6373:(e,t,r)=>{r.d(t,{A:()=>l});const a={randomUUID:"undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};let n;const s=new Uint8Array(16);const o=[];for(let e=0;e<256;++e)o.push((e+256).toString(16).slice(1));function i(e,t=0){return(o[e[t+0]]+o[e[t+1]]+o[e[t+2]]+o[e[t+3]]+"-"+o[e[t+4]]+o[e[t+5]]+"-"+o[e[t+6]]+o[e[t+7]]+"-"+o[e[t+8]]+o[e[t+9]]+"-"+o[e[t+10]]+o[e[t+11]]+o[e[t+12]]+o[e[t+13]]+o[e[t+14]]+o[e[t+15]]).toLowerCase()}const l=function(e,t,r){if(a.randomUUID&&!t&&!e)return a.randomUUID();const o=(e=e||{}).random??e.rng?.()??function(){if(!n){if("undefined"==typeof crypto||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");n=crypto.getRandomValues.bind(crypto)}return n(s)}();if(o.length<16)throw new Error("Random bytes length must be >= 16");if(o[6]=15&o[6]|64,o[8]=63&o[8]|128,t){if((r=r||0)<0||r+16>t.length)throw new RangeError(`UUID byte range ${r}:${r+15} is out of buffer bounds`);for(let e=0;e<16;++e)t[r+e]=o[e];return t}return i(o)}},6513:(e,t,r)=>{const a=r(4256);e.exports=(e,t)=>{const r=a(e,t);return r&&r.prerelease.length?r.prerelease:null}},6819:(e,t,r)=>{r.d(t,{x:()=>o});var a=r(5959),n=r(6089),s=r(2007);const o=({children:e,title:t,description:r,isCollapsible:o=!1,isInitiallyOpen:i=!0,kind:l="section",className:c})=>{const{colors:u,typography:d,spacing:p}=(0,s.useTheme2)(),[m,f]=(0,a.useState)(!o||i),v=m?"angle-up":"angle-down",g="sub-section"===l,h=`${m?"Collapse":"Expand"} section ${t}`,y={header:(0,n.css)({display:"flex",justifyContent:"space-between",alignItems:"center"}),title:(0,n.css)({margin:0}),subtitle:(0,n.css)({margin:0,fontWeight:d.fontWeightRegular}),descriptionText:(0,n.css)({marginTop:p(g?.25:.5),marginBottom:0,...d.bodySmall,color:u.text.secondary}),content:(0,n.css)({marginTop:p(2)})};return a.createElement("div",{className:c},a.createElement("div",{className:y.header},"section"===l?a.createElement("h3",{className:y.title},t):a.createElement("h6",{className:y.subtitle},t),o&&a.createElement(s.IconButton,{name:v,onClick:()=>f(!m),type:"button",size:"xl","aria-label":h})),r&&a.createElement("p",{className:y.descriptionText},r),m&&a.createElement("div",{className:y.content},e))}},6988:(e,t,r)=>{const a=r(4708),n=r(2839);e.exports=(e,t,r)=>{let s=null,o=null,i=null;try{i=new n(t,r)}catch(e){return null}return e.forEach((e=>{i.test(e)&&(s&&-1!==o.compare(e)||(s=e,o=new a(s,r)))})),s}},7379:(e,t,r)=>{const a=r(7715);e.exports=(e,t,r)=>a(e,t,">",r)},7453:(e,t,r)=>{const a=r(4708),n=r(2839),s=r(9308);e.exports=(e,t)=>{e=new n(e,t);let r=new a("0.0.0");if(e.test(r))return r;if(r=new a("0.0.0-0"),e.test(r))return r;r=null;for(let t=0;t<e.set.length;++t){const n=e.set[t];let o=null;n.forEach((e=>{const t=new a(e.semver.version);switch(e.operator){case">":0===t.prerelease.length?t.patch++:t.prerelease.push(0),t.raw=t.format();case"":case">=":o&&!s(t,o)||(o=t);break;case"<":case"<=":break;default:throw new Error(`Unexpected operation: ${e.operator}`)}})),!o||r&&!s(r,o)||(r=o)}return r&&e.test(r)?r:null}},7565:(e,t,r)=>{const a=r(4708);e.exports=(e,t,r)=>{const n=new a(e,r),s=new a(t,r);return n.compare(s)||n.compareBuild(s)}},7618:(e,t,r)=>{const a=r(3440);e.exports=(e,t,r)=>a(t,e,r)},7715:(e,t,r)=>{const a=r(4708),n=r(9264),{ANY:s}=n,o=r(2839),i=r(3238),l=r(9308),c=r(2083),u=r(4624),d=r(3833);e.exports=(e,t,r,p)=>{let m,f,v,g,h;switch(e=new a(e,p),t=new o(t,p),r){case">":m=l,f=u,v=c,g=">",h=">=";break;case"<":m=c,f=d,v=l,g="<",h="<=";break;default:throw new TypeError('Must provide a hilo val of "<" or ">"')}if(i(e,t,p))return!1;for(let r=0;r<t.set.length;++r){const a=t.set[r];let o=null,i=null;if(a.forEach((e=>{e.semver===s&&(e=new n(">=0.0.0")),o=o||e,i=i||e,m(e.semver,o.semver,p)?o=e:v(e.semver,i.semver,p)&&(i=e)})),o.operator===g||o.operator===h)return!1;if((!i.operator||i.operator===g)&&f(e,i.semver))return!1;if(i.operator===h&&v(e,i.semver))return!1}return!0}},7781:e=>{e.exports=r},7817:(e,t,r)=>{r.d(t,{$m:()=>s,eX:()=>a,ob:()=>n});var a=function(e){return e.Basic="basic",e.Gradient="gradient",e.Lcd="lcd",e}({}),n=function(e){return e.Actions="actions",e.Auto="auto",e.BasicGauge="basic",e.ColorBackground="color-background",e.ColorBackgroundSolid="color-background-solid",e.ColorText="color-text",e.Custom="custom",e.DataLinks="data-links",e.Gauge="gauge",e.Geo="geo",e.GradientGauge="gradient-gauge",e.Image="image",e.JSONView="json-view",e.LcdGauge="lcd-gauge",e.Markdown="markdown",e.Pill="pill",e.Sparkline="sparkline",e}({}),s=function(e){return e.CSV="csv",e.CustomQueryParam="customqueryparam",e.Date="date",e.Distributed="distributed",e.DoubleQuote="doublequote",e.Glob="glob",e.HTML="html",e.JSON="json",e.Join="join",e.Lucene="lucene",e.PercentEncode="percentencode",e.Pipe="pipe",e.QueryParam="queryparam",e.Raw="raw",e.Regex="regex",e.SQLString="sqlstring",e.SingleQuote="singlequote",e.Text="text",e.UriEncode="uriencode",e}({})},8044:(e,t,r)=>{var a=r(5959),n=Symbol.for("react.element"),s=Symbol.for("react.fragment"),o=Object.prototype.hasOwnProperty,i=a.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,l={key:!0,ref:!0,__self:!0,__source:!0};function c(e,t,r){var a,s={},c=null,u=null;for(a in void 0!==r&&(c=""+r),void 0!==t.key&&(c=""+t.key),void 0!==t.ref&&(u=t.ref),t)o.call(t,a)&&!l.hasOwnProperty(a)&&(s[a]=t[a]);if(e&&e.defaultProps)for(a in t=e.defaultProps)void 0===s[a]&&(s[a]=t[a]);return{$$typeof:n,type:e,key:c,ref:u,props:s,_owner:i.current}}t.Fragment=s,t.jsx=c,t.jsxs=c},8146:e=>{e.exports=c},8285:(e,t,r)=>{const a=r(3238),n=r(3440);e.exports=(e,t,r)=>{const s=[];let o=null,i=null;const l=e.sort(((e,t)=>n(e,t,r)));for(const e of l){a(e,t,r)?(i=e,o||(o=e)):(i&&s.push([o,i]),i=null,o=null)}o&&s.push([o,null]);const c=[];for(const[e,t]of s)e===t?c.push(e):t||e!==l[0]?t?e===l[0]?c.push(`<=${t}`):c.push(`${e} - ${t}`):c.push(`>=${e}`):c.push("*");const u=c.join(" || "),d="string"==typeof t.raw?t.raw:String(t);return u.length<d.length?u:t}},8531:e=>{e.exports=a},8854:(e,t,r)=>{const a=r(4256);e.exports=(e,t)=>{const r=a(e.trim().replace(/^[=v]+/,""),t);return r?r.version:null}},9183:(e,t,r)=>{r.d(t,{Jy:()=>y,LL:()=>h,_D:()=>N,hr:()=>_,l8:()=>E,pE:()=>b,r:()=>S,rC:()=>T,rd:()=>w,tH:()=>p,vP:()=>O,wu:()=>I});var a=r(3241),n=r(8531),s=r(7817),o=r(3292),i=r(9638),l=r(103);function c(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function u(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},a=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(a=a.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),a.forEach((function(t){c(e,t,r[t])}))}return e}function d(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,a)}return r}(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})),e}const p=(e,t)=>e.map((e=>{var r;const a=d(u({},e),{tag:(0,n.getTemplateSrv)().replace(null!==(r=e.tag)&&void 0!==r?r:"",null!=t?t:{})});var o;e.value&&(a.value="string"==typeof e.value?(0,n.getTemplateSrv)().replace(null!==(o=e.value)&&void 0!==o?o:"",null!=t?t:{},s.$m.Pipe):e.value.map((e=>(0,n.getTemplateSrv)().replace(null!=e?e:"",null!=t?t:{},s.$m.Pipe))));return a})),m=e=>"=~"===e||"!~"===e,f=e=>{let t=e.value;return Array.isArray(t)&&!e.isCustomValue&&(t=(0,i.q1)(t),m(e.operator)&&(t=(0,i.JK)(t))),Array.isArray(t)&&t.length>1?`"${t.join("|")}"`:"string"===e.valueType?`"${t}"`:t},v=(e,t)=>{var r;return t.getIntrinsics().find((t=>t===e.tag))?"":(e.scope===o.d.Event||e.scope===o.d.Instrumentation||e.scope===o.d.Link||e.scope===o.d.Resource||e.scope===o.d.Span?null===(r=e.scope)||void 0===r?void 0:r.toLowerCase():"")+"."},g=(e,t)=>{if("duration"===e.tag){const r=t.find((e=>"duration-type"===e.id));return r?"trace"===r.value?"traceDuration":"duration":e.tag}return e.tag},h=(e,t,r)=>Array.isArray(e.value)&&e.value.length>1&&!m(e.operator)?`(${e.value.map((a=>`${v(e,r)}${g(e,t)}${e.operator}${f(d(u({},e),{value:a}))}`)).join(" || ")})`:`${v(e,r)}${g(e,t)}${e.operator}${f(e)}`,y=e=>e.replace(/^(event|instrumentation|link|resource|span)\./,""),b=(e,t)=>v(e,t)+e.tag,_=(e,t)=>"name"===e.tag?"Span Name":"service.name"===e.tag&&e.scope===o.d.Resource?"Service Name":(0,a.startCase)(b(e,t)),E=(e,t)=>[...e].filter((e=>!t.includes(e))),w=e=>(0,a.uniq)(e.map((e=>e.name&&e.name!==o.d.Intrinsic&&e.tags?e.tags:[])).flat()),T=e=>{let t=e.map((e=>e.name&&e.name===o.d.Intrinsic&&e.tags?e.tags:[])).flat();return t=(0,a.uniq)(t.concat(l.Hx)),t},S=e=>(0,a.uniq)(e.map((e=>e.tags?e.tags:[])).flat()),O=(e,t)=>(0,a.uniq)(e.map((e=>e.name&&e.name===t&&e.tags?e.tags:[])).flat());function N(e,t,r){const a=e.slice(0);return a[t]=r,a}const I=e=>{const t={label:e,value:e};switch(e){case"=":t.description="Equals";break;case"!=":t.description="Not equals";break;case">":t.description="Greater";break;case">=":t.description="Greater or Equal";break;case"<":t.description="Less";break;case"<=":t.description="Less or Equal";break;case"=~":t.description="Matches regex";break;case"!~":t.description="Does not match regex"}return t}},9264:(e,t,r)=>{const a=Symbol("SemVer ANY");class n{static get ANY(){return a}constructor(e,t){if(t=s(t),e instanceof n){if(e.loose===!!t.loose)return e;e=e.value}e=e.trim().split(/\s+/).join(" "),c("comparator",e,t),this.options=t,this.loose=!!t.loose,this.parse(e),this.semver===a?this.value="":this.value=this.operator+this.semver.version,c("comp",this)}parse(e){const t=this.options.loose?o[i.COMPARATORLOOSE]:o[i.COMPARATOR],r=e.match(t);if(!r)throw new TypeError(`Invalid comparator: ${e}`);this.operator=void 0!==r[1]?r[1]:"","="===this.operator&&(this.operator=""),r[2]?this.semver=new u(r[2],this.options.loose):this.semver=a}toString(){return this.value}test(e){if(c("Comparator.test",e,this.options.loose),this.semver===a||e===a)return!0;if("string"==typeof e)try{e=new u(e,this.options)}catch(e){return!1}return l(e,this.operator,this.semver,this.options)}intersects(e,t){if(!(e instanceof n))throw new TypeError("a Comparator is required");return""===this.operator?""===this.value||new d(e.value,t).test(this.value):""===e.operator?""===e.value||new d(this.value,t).test(e.semver):(!(t=s(t)).includePrerelease||"<0.0.0-0"!==this.value&&"<0.0.0-0"!==e.value)&&(!(!t.includePrerelease&&(this.value.startsWith("<0.0.0")||e.value.startsWith("<0.0.0")))&&(!(!this.operator.startsWith(">")||!e.operator.startsWith(">"))||(!(!this.operator.startsWith("<")||!e.operator.startsWith("<"))||(!(this.semver.version!==e.semver.version||!this.operator.includes("=")||!e.operator.includes("="))||(!!(l(this.semver,"<",e.semver,t)&&this.operator.startsWith(">")&&e.operator.startsWith("<"))||!!(l(this.semver,">",e.semver,t)&&this.operator.startsWith("<")&&e.operator.startsWith(">")))))))}}e.exports=n;const s=r(9547),{safeRe:o,t:i}=r(5750),l=r(4991),c=r(1064),u=r(4708),d=r(2839)},9308:(e,t,r)=>{const a=r(3440);e.exports=(e,t,r)=>a(e,t,r)>0},9406:(e,t,r)=>{const a=r(4708);e.exports=(e,t)=>new a(e,t).minor},9547:e=>{const t=Object.freeze({loose:!0}),r=Object.freeze({});e.exports=e=>e?"object"!=typeof e?t:e:r},9558:(e,t,r)=>{r.d(t,{e:()=>d});var a=r(9728),n=r(5959);function s(e,t,r){void 0===t&&(t=0),void 0===r&&(r=[]);var a=function(e,t){void 0===t&&(t=0);var r=(0,n.useRef)(!1),a=(0,n.useRef)(),s=(0,n.useRef)(e),o=(0,n.useCallback)((function(){return r.current}),[]),i=(0,n.useCallback)((function(){r.current=!1,a.current&&clearTimeout(a.current),a.current=setTimeout((function(){r.current=!0,s.current()}),t)}),[t]),l=(0,n.useCallback)((function(){r.current=null,a.current&&clearTimeout(a.current)}),[]);return(0,n.useEffect)((function(){s.current=e}),[e]),(0,n.useEffect)((function(){return i(),l}),[t]),[o,l,i]}(e,t),s=a[0],o=a[1],i=a[2];return(0,n.useEffect)(i,r),[s,o]}var o=r(2007);const i=/^(-?\d+(?:\.\d+)?)(ms|[Mwdhmsy])$/,l=(e,t=i)=>!(e.match(t)||!e);function c(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function u(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,a)}return r}(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})),e}const d=e=>{const[t,r]=(0,n.useState)((()=>!!e.value&&l(e.value,e.validationRegex)));var i;s((()=>{r(l(e.value,e.validationRegex))}),500,[e.value]);const d={labelWidth:26,disabled:null!==(i=e.disabled)&&void 0!==i&&i,invalid:t,error:e.isInvalidError};return e.label&&(d.label=e.label,d.tooltip=e.tooltip||""),(0,a.jsx)(o.InlineField,u(function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},a=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(a=a.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),a.forEach((function(t){c(e,t,r[t])}))}return e}({},d),{children:(0,a.jsx)(o.Input,{type:"text",placeholder:e.placeholder||"0",width:e.width||40,onChange:t=>{e.onChange(t.currentTarget.value)},value:e.value,"aria-label":e.ariaLabel||"interval input"})}))}},9605:(e,t,r)=>{r.d(t,{C:()=>l});var a=r(9728),n=r(6089),s=r(5959),o=r(2007);const i={error:7e3,info:3e3,success:3e3,warning:5e3},l=e=>{const t=(r=(0,o.useTheme2)(),(0,n.css)({position:"absolute",zIndex:r.zIndex.portal,top:0,right:10}));var r;const[l,c]=(0,s.useState)(!1),[u,d]=(0,s.useState)();return(0,s.useEffect)((()=>()=>{u&&clearTimeout(u)}),[u]),(0,s.useEffect)((()=>{if(""!==e.text){c(!0);const t=setTimeout((()=>{c(!1)}),i[e.severity]);d(t)}}),[e.severity,e.text]),(0,a.jsx)(a.Fragment,{children:l&&(0,a.jsx)(o.Alert,{className:t,elevated:!0,onRemove:()=>c(!1),severity:e.severity,title:e.text})})}},9607:(e,t,r)=>{r.d(t,{b:()=>l,o:()=>i});var a=r(9728),n=r(7781),s=r(2007),o=r(204);const i=1800;function l({options:e,onOptionsChange:t}){var r;const l=(0,s.useStyles2)(o.$),c=[{label:"Last 30 minutes of selected range",value:i},{label:"Last 3 hours of selected range",value:10800},{label:"Last 24 hours of selected range",value:86400},{label:"Last 3 days of selected range",value:259200},{label:"Last 7 days of selected range",value:604800}];return(0,a.jsx)("div",{className:l.container,children:(0,a.jsx)(s.InlineFieldRow,{className:l.row,children:(0,a.jsx)(s.InlineField,{tooltip:"Time range in tags and tag value queries",label:"Time range in query",labelWidth:26,children:(0,a.jsx)(s.Combobox,{id:"time-range-for-tags-select",options:c,value:(null===(r=e.jsonData)||void 0===r?void 0:r.timeRangeForTags)||i,onChange:r=>{var a;(0,n.updateDatasourcePluginJsonDataOption)({onOptionsChange:t,options:e},"timeRangeForTags",null!==(a=null==r?void 0:r.value)&&void 0!==a?a:i)},placeholder:"Time range for tags",width:40})})})})}},9638:(e,t,r)=>{r.d(t,{eH:()=>er,m9:()=>tr,SD:()=>rr,H1:()=>nr,yJ:()=>ar,JK:()=>ir,q1:()=>lr});var a=r(3241),n=r(1269),s=r(3059),o=r(709),i=r.n(o),l=r(7781),c=r(8531),u=r(7817),d=r(9183),p=r(9728),m=r(5959),f=r(2007),v=r(9922),g=function(e){return e[e.LabelNames=0]="LabelNames",e[e.LabelValues=1]="LabelValues",e}({});const h=[{label:"Label names",value:0},{label:"Label values",value:1}],y="TempoDatasourceVariableQueryEditor-VariableQuery",b=({onChange:e,query:t,datasource:r,range:a})=>{const[n,s]=(0,m.useState)(t.label||""),[o,i]=(0,m.useState)(t.type),[l,c]=(0,m.useState)([]),[u,d]=(0,m.useState)(""),[g,b]=(0,m.useState)(!1);(0,m.useEffect)((()=>{1===o&&(b(!0),r.labelNamesQuery(a).then((e=>{c(e.map((({text:e})=>({label:e,value:e})))),b(!1)})).catch((()=>{b(!1)})))}),[r,t,o,a]);const _=(0,m.useMemo)((()=>{if(0===u.length)return l.slice(0,v.J_);const e=u.toLowerCase();return l.filter((t=>!!(t.value&&t.value.length>0)&&t.value.toLowerCase().includes(e))).slice(0,v.J_)}),[u,l]),E=()=>{void 0!==o&&e({type:o,label:n,refId:y})};return(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)(f.InlineFieldRow,{children:(0,p.jsx)(f.InlineField,{label:"Query type",labelWidth:20,children:(0,p.jsx)(f.Select,{"aria-label":"Query type",onChange:t=>{i(t.value),void 0!==t.value&&e({type:t.value,label:n,refId:y})},onBlur:E,value:o,options:h,width:32})})}),1===o&&(0,p.jsx)(f.InlineFieldRow,{children:(0,p.jsx)(f.InlineField,{label:"Label",labelWidth:20,children:(0,p.jsx)(f.Select,{"aria-label":"Label",onChange:t=>{const r=t.value||"";s(r),void 0!==o&&e({type:o,label:r,refId:y})},onBlur:E,onInputChange:(e,{action:t})=>{"input-change"===t&&d(e)},onCloseMenu:()=>d(""),value:{label:n,value:n},options:_,width:32,allowCustomValue:!0,virtualized:!0,isLoading:g})})})]})};var _=r(3292);const E="traces_service_graph_request_server_seconds_sum",w="traces_service_graph_request_total",T="traces_service_graph_request_failed_total",S="traces_service_graph_request_server_seconds_bucket",O={expr:"sum(rate(traces_spanmetrics_calls_total{}[$__range])) by (span_name)",topk:5,params:[]},N={expr:"sum(rate(traces_spanmetrics_calls_total{}[$__range])) by (span_name)",topk:5,params:['status_code="STATUS_CODE_ERROR"']},I={expr:"histogram_quantile(.9, sum(rate(traces_spanmetrics_latency_bucket{}[$__range])) by (le))",params:[]},j={expr:"histogram_quantile(.9, sum(rate(traces_spanmetrics_latency{}[$__range])) by (le))",params:[]},$='span_kind="SPAN_KIND_SERVER"',F=[E,w,T,S];function D(e,t){const r=function(e){var t;return((null===(t=e[0])||void 0===t?void 0:t.data)||[]).reduce(((e,t)=>{const r=(0,l.toDataFrame)(t);var a;return e[null!==(a=r.refId)&&void 0!==a?a:"A"]=new l.DataFrameView(r),e}),{})}(e),a={},n={};return P(r[w],"total",w,a,n),P(r[E],"seconds",E,a,n),P(r[T],"failed",T,a,n),x(r[`${w}_labels`],a),x(r[`${E}_labels`],a),x(r[`${T}_labels`],a),function(e,t){const[r,a]=function(){function e(e,t){return new l.MutableDataFrame({name:e,fields:t,meta:{preferredVisualisationType:"nodeGraph"}})}const t=e("Nodes",[{name:l.NodeGraphDataFrameFieldNames.id,type:l.FieldType.string,values:[]},{name:l.NodeGraphDataFrameFieldNames.title,type:l.FieldType.string,config:{displayName:"Service name"},values:[]},{name:l.NodeGraphDataFrameFieldNames.subTitle,type:l.FieldType.string,config:{displayName:"Service namespace"},values:[]},{name:l.NodeGraphDataFrameFieldNames.mainStat,type:l.FieldType.number,config:{unit:"ms/r",displayName:"Average response time"},values:[]},{name:l.NodeGraphDataFrameFieldNames.secondaryStat,type:l.FieldType.number,config:{unit:"r/sec",displayName:"Requests per second"},values:[]},{name:l.NodeGraphDataFrameFieldNames.arc+"success",type:l.FieldType.number,config:{displayName:"Success",color:{fixedColor:"green",mode:l.FieldColorModeId.Fixed}},values:[]},{name:l.NodeGraphDataFrameFieldNames.arc+"failed",type:l.FieldType.number,config:{displayName:"Failed",color:{fixedColor:"red",mode:l.FieldColorModeId.Fixed}},values:[]},{name:l.NodeGraphDataFrameFieldNames.isInstrumented,type:l.FieldType.boolean,values:[]}]),r=e("Edges",[{name:l.NodeGraphDataFrameFieldNames.id,type:l.FieldType.string,values:[]},{name:l.NodeGraphDataFrameFieldNames.source,type:l.FieldType.string,values:[]},{name:"sourceName",type:l.FieldType.string,values:[]},{name:"sourceNamespace",type:l.FieldType.string,values:[]},{name:l.NodeGraphDataFrameFieldNames.target,type:l.FieldType.string,values:[]},{name:"targetName",type:l.FieldType.string,values:[]},{name:"targetNamespace",type:l.FieldType.string,values:[]},{name:l.NodeGraphDataFrameFieldNames.mainStat,type:l.FieldType.number,config:{unit:"ms/r",displayName:"Average response time"},values:[]},{name:l.NodeGraphDataFrameFieldNames.secondaryStat,type:l.FieldType.number,config:{unit:"r/sec",displayName:"Requests per second"},values:[]}]);return[t,r]}();for(const t of Object.keys(e)){const a=e[t];var n;r.add({[l.NodeGraphDataFrameFieldNames.id]:t,[l.NodeGraphDataFrameFieldNames.title]:a.name,[l.NodeGraphDataFrameFieldNames.subTitle]:a.namespace,[l.NodeGraphDataFrameFieldNames.mainStat]:a.total?a.seconds/a.total*1e3:Number.NaN,[l.NodeGraphDataFrameFieldNames.secondaryStat]:a.total?Math.round(100*a.total)/100:Number.NaN,[l.NodeGraphDataFrameFieldNames.arc+"success"]:a.total?(a.total-Math.min(a.failed||0,a.total))/a.total:1,[l.NodeGraphDataFrameFieldNames.arc+"failed"]:a.total?Math.min(a.failed||0,a.total)/a.total:0,[l.NodeGraphDataFrameFieldNames.isInstrumented]:null===(n=a.isInstrumented)||void 0===n||n})}for(const e of Object.keys(t)){const r=t[e];a.add({[l.NodeGraphDataFrameFieldNames.id]:e,[l.NodeGraphDataFrameFieldNames.source]:r.source,sourceName:r.sourceName,sourceNamespace:r.sourceNamespace,[l.NodeGraphDataFrameFieldNames.target]:r.target,targetName:r.targetName,targetNamespace:r.targetNamespace,[l.NodeGraphDataFrameFieldNames.mainStat]:r.total?r.seconds/r.total*1e3:Number.NaN,[l.NodeGraphDataFrameFieldNames.secondaryStat]:r.total?Math.round(100*r.total)/100:Number.NaN})}return{nodes:r,edges:a}}(a,n)}function P(e,t,r,a,n){if(!e)return;const s=`Value #${r}`;for(let r=0;r<e.length;r++){const o=e.get(r),i=o.server_service_namespace?`${o.server_service_namespace}/${o.server}`:o.server,l=o.client_service_namespace?`${o.client_service_namespace}/${o.client}`:o.client,c=`${l}_${i}`;n[c]?n[c][t]=(n[c][t]||0)+o[s]:n[c]={target:i,targetName:o.server,targetNamespace:o.server_service_namespace,source:l,sourceName:o.client,sourceNamespace:o.client_service_namespace,[t]:o[s]},a[i]?a[i][t]=(a[i][t]||0)+o[s]:a[i]={name:o.server,namespace:o.server_service_namespace,[t]:o[s]},a[l]||(a[l]={name:o.client,namespace:o.client_service_namespace,[t]:0})}}function x(e,t){if(e)for(let r=0;r<e.length;r++){const a=e.get(r),n=a.server_service_namespace?`${a.server_service_namespace}/${a.server}`:a.server;t[n]&&!0!==t[n].isInstrumented&&(t[n].isInstrumented=""===a.connection_type||"messaging_system"===a.connection_type)}}function R(e){let t={};const r=e.length;for(let a=0;a<r;a++){const r=e[a];r&&(t[String(r).toUpperCase().replace(/[-.]/g,"_")]=r)}return t}const L="cloud.provider",k="cloud.account.id",A="cloud.region",q="cloud.availability_zone",C="cloud.platform",M="aws.ecs.container.arn",V="aws.ecs.cluster.arn",G="aws.ecs.launchtype",U="aws.ecs.task.arn",Q="aws.ecs.task.family",B="aws.ecs.task.revision",J="aws.eks.cluster.arn",X="aws.log.group.names",H="aws.log.group.arns",z="aws.log.stream.names",W="aws.log.stream.arns",Y="container.name",K="container.id",Z="container.runtime",ee="container.image.name",te="container.image.tag",re="deployment.environment",ae="device.id",ne="device.model.identifier",se="device.model.name",oe="faas.name",ie="faas.id",le="faas.version",ce="faas.instance",ue="faas.max_memory",de="host.id",pe="host.name",me="host.type",fe="host.arch",ve="host.image.name",ge="host.image.id",he="host.image.version",ye="k8s.cluster.name",be="k8s.node.name",_e="k8s.node.uid",Ee="k8s.namespace.name",we="k8s.pod.uid",Te="k8s.pod.name",Se="k8s.container.name",Oe="k8s.replicaset.uid",Ne="k8s.replicaset.name",Ie="k8s.deployment.uid",je="k8s.deployment.name",$e="k8s.statefulset.uid",Fe="k8s.statefulset.name",De="k8s.daemonset.uid",Pe="k8s.daemonset.name",xe="k8s.job.uid",Re="k8s.job.name",Le="k8s.cronjob.uid",ke="k8s.cronjob.name",Ae="os.type",qe="os.description",Ce="os.name",Me="os.version",Ve="process.pid",Ge="process.executable.name",Ue="process.executable.path",Qe="process.command",Be="process.command_line",Je="process.command_args",Xe="process.owner",He="process.runtime.name",ze="process.runtime.version",We="process.runtime.description",Ye="service.name",Ke="service.namespace",Ze="service.instance.id",et="service.version",tt="telemetry.sdk.name",rt="telemetry.sdk.language",at="telemetry.sdk.version",nt="telemetry.auto.version",st="webengine.name",ot="webengine.version",it="webengine.description",lt=R([L,k,A,q,C,M,V,G,U,Q,B,J,X,H,z,W,Y,K,Z,ee,te,re,ae,ne,se,oe,ie,le,ce,ue,de,pe,me,fe,ve,ge,he,ye,be,_e,Ee,we,Te,Se,Oe,Ne,Ie,je,$e,Fe,De,Pe,xe,Re,Le,ke,Ae,qe,Ce,Me,Ve,Ge,Ue,Qe,Be,Je,Xe,He,ze,We,Ye,Ke,Ze,et,tt,rt,at,nt,st,ot,it]);function ct(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function ut(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},a=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(a=a.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),a.forEach((function(t){ct(e,t,r[t])}))}return e}function dt(e){const{nodes:t,edges:r}=function(e){const t=[],r=[],a=new l.DataFrameView(e),n=function(e){let t=0,r=1/0;for(let a=0;a<e.length;a++){const n=e.get(a);n.startTime<r&&(r=n.startTime),n.startTime+n.duration>t&&(t=n.startTime+n.duration)}return t-r}(a),s=function(e){const t={};let r;for(let a=0;r=e(a),r;a++){t[r.id]?t[r.id].span=r.span:t[r.id]={span:r.span,children:[]};for(const e of r.parentIds)e&&(t[e]?t[e].children.push(r.id):t[e]={span:void 0,children:[r.id]})}return t}((t=>{if(t>=e.length)return;const r=a.get(t);return{span:ut({},r),id:r.spanID,parentIds:r.parentSpanID?[r.parentSpanID]:[]}}));for(let e=0;e<a.length;e++){const i=a.get(e),c=pt(s[i.spanID].children.map((e=>{const t=s[e].span;return[t.startTime,t.startTime+t.duration]}))),u=i.duration-c,d=mt(i.duration,n,u);var o;t.push({[l.NodeGraphDataFrameFieldNames.id]:i.spanID,[l.NodeGraphDataFrameFieldNames.title]:null!==(o=i.serviceName)&&void 0!==o?o:"",[l.NodeGraphDataFrameFieldNames.subTitle]:i.operationName,[l.NodeGraphDataFrameFieldNames.mainStat]:d.main,[l.NodeGraphDataFrameFieldNames.secondaryStat]:d.secondary,[l.NodeGraphDataFrameFieldNames.color]:u/n}),i.parentSpanID&&s[i.parentSpanID].span&&r.push({[l.NodeGraphDataFrameFieldNames.id]:i.parentSpanID+"--"+i.spanID,[l.NodeGraphDataFrameFieldNames.target]:i.spanID,[l.NodeGraphDataFrameFieldNames.source]:i.parentSpanID})}return{nodes:t,edges:r}}(e),[a,n]=function(){const e=new l.MutableDataFrame({fields:[{name:l.NodeGraphDataFrameFieldNames.id,type:l.FieldType.string},{name:l.NodeGraphDataFrameFieldNames.title,type:l.FieldType.string},{name:l.NodeGraphDataFrameFieldNames.subTitle,type:l.FieldType.string},{name:l.NodeGraphDataFrameFieldNames.mainStat,type:l.FieldType.string,config:{displayName:"Total time (% of trace)"}},{name:l.NodeGraphDataFrameFieldNames.secondaryStat,type:l.FieldType.string,config:{displayName:"Self time (% of total)"}},{name:l.NodeGraphDataFrameFieldNames.color,type:l.FieldType.number,config:{color:{mode:"continuous-GrYlRd"},displayName:"Self time / Trace duration"}}],meta:{preferredVisualisationType:"nodeGraph"}}),t=new l.MutableDataFrame({fields:[{name:l.NodeGraphDataFrameFieldNames.id,type:l.FieldType.string},{name:l.NodeGraphDataFrameFieldNames.target,type:l.FieldType.string},{name:l.NodeGraphDataFrameFieldNames.source,type:l.FieldType.string}],meta:{preferredVisualisationType:"nodeGraph"}});return[e,t]}();for(const e of t)a.add(e);for(const e of r)n.add(e);return[a,n]}function pt(e){e.sort(((e,t)=>e[0]-t[0]));return e.reduce(((e,t)=>{if(!e.length)return[t];const r=e.slice(-1)[0],[a,n]=r,[s,o]=t;return o<n?e:s>n?[...e,t]:[...e.slice(0,-1),[a,o]]}),[]).reduce(((e,t)=>e+(t[1]-t[0])),0)}function mt(e,t,r){return{main:`${ft(e)}ms (${ft(e/t*100)}%)`,secondary:`${ft(r)}ms (${ft(r/e*100)}%)`}}function ft(e){return parseFloat(e.toFixed(2))}function vt(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function gt(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,a)}return r}(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})),e}function ht(e){if(e.stringValue)return e.stringValue;if(void 0!==e.boolValue)return Boolean(e.boolValue);if(void 0!==e.intValue)return Number.parseInt(String(e.intValue),10);if(e.doubleValue)return Number.parseFloat(String(e.doubleValue));if(e.arrayValue){const t=[];for(const r of e.arrayValue.values)t.push(ht(r));return t}return""}function yt(e){const t=[];let r="OTLPResourceNoServiceName";if(!e)return{serviceName:r,serviceTags:t};for(const a of e.attributes)a.key===lt.SERVICE_NAME&&(r=a.value.stringValue||r),t.push({key:a.key,value:ht(a.value)});return{serviceName:r,serviceTags:t}}function bt(e){const t=[];if(e.attributes)for(const r of e.attributes)t.push({key:r.key,value:ht(r.value)});return t}function _t(e){let t;if(e.kind){const r=e.kind.toString().toLowerCase().split("_");t=r.length?r[r.length-1]:e.kind.toString()}return t}function Et(e){const t=[];if(e.links)for(const r of e.links){const{traceId:e,spanId:a}=r,n=[];if(r.attributes)for(const e of r.attributes)n.push({key:e.key,value:ht(e.value)});t.push({traceID:e,spanID:a,tags:n})}return t}function wt(e){const t=[];if(e.events)for(const r of e.events){const e=[];if(r.attributes)for(const t of r.attributes)e.push({key:t.key,value:ht(t.value)});t.push({fields:e,timestamp:r.timeUnixNano/1e6,name:r.name})}return t}function Tt(e,t,r=!1){const a=e.data[0];if(!a)return $t;const n=null==t?void 0:t.jsonData,s=null==n?void 0:n.tracesToProfiles;let o;if((null==s?void 0:s.datasourceUid)&&(o=(0,c.getDataSourceSrv)().getInstanceSettings(s.datasourceUid)),s&&o){const e=s.customQuery?s.query:void 0;var i;const t={title:"Related profiles",url:"",internal:{datasourceUid:o.uid,datasourceName:o.name,query:{labelSelector:e||"{${__tags}}",groupBy:[],profileTypeId:null!==(i=s.profileTypeId)&&void 0!==i?i:"",queryType:"profile",spanSelector:['${__span.tags["pyroscope.profile.id"]}'],refId:"profile"}},origin:l.DataLinkConfigOrigin.Datasource};a.fields.forEach((e=>{"tags"===e.name&&(e.config.links=[t])}))}let u=[...e.data];return r&&u.push(...dt((0,l.toDataFrame)(a))),gt(function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},a=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(a=a.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),a.forEach((function(t){vt(e,t,r[t])}))}return e}({},e),{data:u})}function St(e,t){var r;return null===(r=e.data)||void 0===r||r.filter((e=>{var t;return"exemplar"===e.name&&"annotations"===(null===(t=e.meta)||void 0===t?void 0:t.dataTopic)})).map((e=>{const r=e.fields.find((e=>"traceId"===e.name));if(r){const e=function(e){const t=[];var r;e.uid&&t.push({title:"View trace",url:"",internal:{query:{query:"${__value.raw}",queryType:"traceql"},datasourceUid:e.uid,datasourceName:null!==(r=null==e?void 0:e.name)&&void 0!==r?r:"Data source not found"}});return t}(t),n=r.config.links||[],s=e.filter((e=>!n.some((t=>{var r,n,s,o;return t.title===e.title&&(null===(r=t.internal)||void 0===r?void 0:r.datasourceUid)===(null===(n=e.internal)||void 0===n?void 0:n.datasourceUid)&&(0,a.isEqual)(null===(s=t.internal)||void 0===s?void 0:s.query,null===(o=e.internal)||void 0===o?void 0:o.query)}))));r.config.links=n.length?[...n,...s]:s}return e})),e}function Ot(e,t,r){switch(r){case _.Jv.Spans:return function(e,t){const r={};let a=!1;null==e||e.forEach((e=>Nt(e).forEach((e=>{var t;null===(t=e.attributes)||void 0===t||t.forEach((e=>{r[e.key]={name:e.key,type:l.FieldType.string,config:{displayNameFromDS:e.key}}})),e.spans.forEach((e=>{var t;e.name&&(a=!0),null===(t=e.attributes)||void 0===t||t.forEach((e=>{r[e.key]={name:e.key,type:l.FieldType.string,config:{displayNameFromDS:e.key}}}))}))}))));const n=new l.MutableDataFrame({name:"Spans",refId:"traces",fields:[{name:"traceIdHidden",type:l.FieldType.string,config:{custom:{hidden:!0}}},{name:"traceService",type:l.FieldType.string,config:{displayNameFromDS:"Trace Service",custom:{width:200}}},{name:"traceName",type:l.FieldType.string,config:{displayNameFromDS:"Trace Name",custom:{width:200}}},{name:"spanID",type:l.FieldType.string,config:{unit:"string",displayNameFromDS:"Span ID",custom:{width:200},links:[{title:"Span: ${__value.raw}",url:"",internal:{datasourceUid:t.uid,datasourceName:t.name,query:{query:"${__data.fields.traceIdHidden}",queryType:"traceql"},panelsState:{trace:{spanId:"${__value.raw}"}}}}]}},{name:"time",type:l.FieldType.time,config:{displayNameFromDS:"Start time"}},{name:"name",type:l.FieldType.string,config:{displayNameFromDS:"Name",custom:{hidden:!a}}},...Object.values(r).sort(((e,t)=>e.name.localeCompare(t.name))),{name:"duration",type:l.FieldType.number,config:{displayNameFromDS:"Duration",unit:"ns",custom:{width:120}}}],meta:{preferredVisualisationType:"table"}});if(!e||!e.length)return[n];return e.sort(((e,t)=>parseInt(null==t?void 0:t.startTimeUnixNano,10)/1e6-parseInt(null==e?void 0:e.startTimeUnixNano,10)/1e6)).forEach((e=>{Nt(e).forEach((t=>{t.spans.forEach((r=>{n.add(jt(r,t,e))}))}))})),[n]}(e,t);case _.Jv.Raw:return function(e){return[(0,l.createDataFrame)({name:"Raw response",refId:"raw",fields:[{name:"response",type:l.FieldType.string,values:[JSON.stringify(e,null,2)]}]})]}(e);default:return function(e,t){const r=(0,l.createDataFrame)({name:"Traces",refId:"traces",fields:[{name:"traceID",type:l.FieldType.string,config:{unit:"string",displayNameFromDS:"Trace ID",custom:{width:200},links:[{title:"Trace: ${__value.raw}",url:"",internal:{datasourceUid:t.uid,datasourceName:t.name,query:{query:"${__value.raw}",queryType:"traceql"}}}]}},{name:"startTime",type:l.FieldType.time,config:{displayNameFromDS:"Start time",custom:{width:200}}},{name:"traceService",type:l.FieldType.string,config:{displayNameFromDS:"Service"}},{name:"traceName",type:l.FieldType.string,config:{displayNameFromDS:"Name"}},{name:"traceDuration",type:l.FieldType.number,config:{displayNameFromDS:"Duration",unit:"ms",custom:{width:120}}},{name:"nested",type:l.FieldType.nestedFrames}],meta:{preferredVisualisationType:"table",uniqueRowIdFields:[0]}});if(!(null==e?void 0:e.length))return[r];return r.length=e.length,e.sort(((e,t)=>parseInt(null==t?void 0:t.startTimeUnixNano,10)/1e6-parseInt(null==e?void 0:e.startTimeUnixNano,10)/1e6)).forEach((e=>{const a=function(e){return{traceID:e.traceID,startTime:parseInt(e.startTimeUnixNano,10)/1e6,traceDuration:e.durationMs,traceService:e.rootServiceName||"",traceName:e.rootTraceName||""}}(e);r.fields[0].values.push(a.traceID),r.fields[1].values.push(a.startTime),r.fields[2].values.push(a.traceService),r.fields[3].values.push(a.traceName),r.fields[4].values.push(a.traceDuration?a.traceDuration:"<1ms"),e.spanSets?r.fields[5].values.push(e.spanSets.map((r=>It(e,r,t)))):e.spanSet&&r.fields[5].values.push([It(e,e.spanSet,t)])})),[r]}(e,t)}}const Nt=e=>e.spanSets||(e.spanSet?[e.spanSet]:[]),It=(e,t,r)=>{var a;const n={};let s=!1;null===(a=t.attributes)||void 0===a||a.map((e=>{n[e.key]={name:e.key,type:l.FieldType.string,config:{displayNameFromDS:e.key},values:[]}})),t.spans.forEach((e=>{var t;e.name&&(s=!0),null===(t=e.attributes)||void 0===t||t.forEach((e=>{n[e.key]={name:e.key,type:l.FieldType.string,config:{displayNameFromDS:e.key},values:[]}}))}));const o=new l.MutableDataFrame({fields:[{name:"traceIdHidden",type:l.FieldType.string,config:{custom:{hidden:!0}},values:[]},{name:"spanID",type:l.FieldType.string,values:[],config:{unit:"string",displayNameFromDS:"Span ID",custom:{width:200},links:[{title:"Span: ${__value.raw}",url:"",internal:{datasourceUid:r.uid,datasourceName:r.name,query:{query:"${__data.fields.traceIdHidden}",queryType:"traceql"},panelsState:{trace:{spanId:"${__value.raw}"}}}}]}},{name:"time",type:l.FieldType.time,config:{displayNameFromDS:"Start time",custom:{width:200}}},{name:"name",type:l.FieldType.string,values:[],config:{displayNameFromDS:"Name",custom:{hidden:!s}}},...Object.values(n).sort(((e,t)=>e.name.localeCompare(t.name))),{name:"duration",type:l.FieldType.number,values:[],config:{displayNameFromDS:"Duration",unit:"ns",custom:{width:120}}}],meta:{preferredVisualisationType:"table"}}),i=(0,l.createTheme)();for(const e of o.fields)e.display=(0,l.getDisplayProcessor)({field:e,theme:i});return t.spans.forEach((r=>{o.add(jt(r,t,e))})),o};function jt(e,t,r){const a=parseInt(e.startTimeUnixNano,10)/1e6,n={traceIdHidden:r.traceID,traceService:r.rootServiceName||"",traceName:r.rootTraceName||"",spanID:e.spanID,time:a,duration:parseInt(e.durationNanos,10),name:e.name};let s=[];return t.attributes&&(s=s.concat(t.attributes)),e.attributes&&(s=s.concat(e.attributes)),s.forEach((e=>{var t,r,a,s,o,i,l,c;(e.value.boolValue||(null===(t=e.value.Value)||void 0===t?void 0:t.bool_value))&&(n[e.key]=e.value.boolValue||(null===(o=e.value.Value)||void 0===o?void 0:o.bool_value));(e.value.doubleValue||(null===(r=e.value.Value)||void 0===r?void 0:r.double_value))&&(n[e.key]=e.value.doubleValue||(null===(i=e.value.Value)||void 0===i?void 0:i.double_value));(e.value.intValue||(null===(a=e.value.Value)||void 0===a?void 0:a.int_value))&&(n[e.key]=e.value.intValue||(null===(l=e.value.Value)||void 0===l?void 0:l.int_value));(e.value.stringValue||(null===(s=e.value.Value)||void 0===s?void 0:s.string_value))&&(n[e.key]=e.value.stringValue||(null===(c=e.value.Value)||void 0===c?void 0:c.string_value))})),n}const $t={data:[new l.MutableDataFrame({fields:[{name:"trace",type:l.FieldType.trace,values:[]}],meta:{preferredVisualisationType:"trace",custom:{traceFormat:"otlp"}}})]};var Ft=r(6373);function Dt(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Pt(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},a=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(a=a.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),a.forEach((function(t){Dt(e,t,r[t])}))}return e}function xt(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,a)}return r}(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})),e}function Rt(e,t){if(!e)return qt(t);var r,a;t.data.forEach((t=>{const r=e.data.find((e=>function(e,t){var r,a,n,s,o,i;if(e.refId!==t.refId||e.name!==t.name)return!1;const c=null===(r=e.meta)||void 0===r?void 0:r.type,u=null===(a=t.meta)||void 0===a?void 0:a.type;if(c!==u)return!1;if(c===l.DataFrameType.TimeSeriesMulti){const r=e.fields.find((e=>e.type===l.FieldType.number)),a=t.fields.find((e=>e.type===l.FieldType.number));return void 0!==r&&void 0!==a&&(0,l.shallowCompare)(null!==(d=r.labels)&&void 0!==d?d:{},null!==(p=a.labels)&&void 0!==p?p:{});var d,p}const m=null===(s=e.meta)||void 0===s||null===(n=s.custom)||void 0===n?void 0:n.frameType,f=null===(i=t.meta)||void 0===i||null===(o=i.custom)||void 0===o?void 0:o.frameType;if("LabeledTimeValues"===m&&"LabeledTimeValues"===f)return!0;if(m===f)return!0;return!1}(e,t)));r?function(e,t){var r,a;const n=Math.max(e.fields.length,t.fields.length);for(let r=0;r<n;r++){if(!e.fields[r])continue;const a=Lt(e.fields[r],t.fields,r);if(a&&(e.fields[r].values=[].concat.apply(a.values,e.fields[r].values),a.nanos)){var s,o;const a=(null===(s=e.fields[r].nanos)||void 0===s?void 0:s.slice())||[];e.fields[r].nanos=null===(o=t.fields[r].nanos)||void 0===o?void 0:o.concat(a)}}var i,l;e.length+=t.length,e.meta=xt(Pt({},e.meta),{stats:At(null!==(i=null===(r=e.meta)||void 0===r?void 0:r.stats)&&void 0!==i?i:[],null!==(l=null===(a=t.meta)||void 0===a?void 0:a.stats)&&void 0!==l?l:[])})}(r,t):e.data.push(Ct(t))}));const n=[...null!==(r=e.errors)&&void 0!==r?r:[],...null!==(a=t.errors)&&void 0!==a?a:[]];var s;n.length>0&&(e.errors=n);const o=null!==(s=e.error)&&void 0!==s?s:t.error;var i,c;null!=o&&(e.error=o);const u=[...null!==(i=e.traceIds)&&void 0!==i?i:[],...null!==(c=t.traceIds)&&void 0!==c?c:[]];return u.length>0&&(e.traceIds=u),e}function Lt(e,t,r){const a=t.filter((t=>t.name===e.name));return 1===a.length?a[0]:e.labels?a.find((t=>{var r,a;return(0,l.shallowCompare)(null!==(r=e.labels)&&void 0!==r?r:{},null!==(a=t.labels)&&void 0!==a?a:{})})):t[r]}const kt="Summary: total bytes processed";function At(e,t){const r=e.find((e=>e.displayName===kt)),a=t.find((e=>e.displayName===kt));if(null!=a&&null!=r)return[{value:a.value+r.value,displayName:kt,unit:r.unit}];const n=null!=a?a:r;return null!=n?[n]:[]}function qt(e){return xt(Pt({},e),{data:e.data.map(Ct)})}function Ct(e){return xt(Pt({},e),{fields:e.fields.map((e=>xt(Pt({},e),{values:e.values})))})}var Mt=r(5645);function Vt(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Gt(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},a=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(a=a.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),a.forEach((function(t){Vt(e,t,r[t])}))}return e}function Ut(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,a)}return r}(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})),e}function Qt(){return(0,Ft.A)()}function Bt(e,t,r){const a=r.range,s=Qt();let o=l.LoadingState.NotStarted;const i=(0,Mt.hO)(e.step);return(0,c.getGrafanaLiveSrv)().getStream({scope:l.LiveChannelScope.DataSource,namespace:t.uid,path:`metrics/${s}`,data:Ut(Gt({},e),{step:i,timeRange:{from:a.from.toISOString(),to:a.to.toISOString()}})}).pipe((0,n.takeWhile)((e=>{if("message"in e&&(null==e?void 0:e.message)){const t=e.message.data.values[2][0];if(t===_.O8.Done||t===_.O8.Error)return!1}return!0}),!0),(0,n.map)((e=>{let t={data:[],state:l.LoadingState.NotStarted};if("message"in e&&(null==e?void 0:e.message)){var r,a,n;const i=(0,l.dataFrameFromJSON)(e.message),c=new l.FieldCache(i),u=null===(r=c.getFieldByName("result"))||void 0===r?void 0:r.values[0],d=null===(a=c.getFieldByName("state"))||void 0===a?void 0:a.values[0],p=null===(n=c.getFieldByName("error"))||void 0===n?void 0:n.values[0];switch(d){case _.O8.Done:o=l.LoadingState.Done;break;case _.O8.Streaming:o=l.LoadingState.Streaming;break;case _.O8.Error:throw new Error(p)}var s;t={data:null!==(s=null==u?void 0:u.map(l.dataFrameFromJSON))&&void 0!==s?s:[],state:o}}return t})),(0,n.scan)(((t,r)=>r?t&&e.metricsQueryType!==_.Ag.Instant?function(e,t){const r=Rt(qt(e),t);return r.data=r.data.map((e=>{let t=e;const r=e.fields.findIndex((e=>e.type===l.FieldType.time));return r>=0&&(!function(e,t){var r;const a=e.fields[t].values.reduce(((e,t,r)=>(e[t]?e[t].push(r):e[t]=[r],e)),{}),n=Object.values(a).filter((e=>e.length>1)).map((e=>e.slice(1))).flat();e.fields.forEach((e=>{e.values=e.values.filter(((e,t)=>!n.includes(t)))})),"exemplar"===e.name&&"annotations"===(null===(r=e.meta)||void 0===r?void 0:r.dataTopic)&&n.length>0&&(e.length=e.fields[t].values.length)}(e,r),t=(0,l.sortDataFrame)(e,r)),t})),r.state=t.state,r}(t,r):qt(r):t)))}function Jt(e,t,r){const n={steps:[{color:"blue",value:-1/0},{color:"green",value:75}],mode:l.ThresholdsMode.Absolute};return{refId:"streaming-progress",name:"Streaming Progress",length:1,fields:[{name:"state",type:l.FieldType.string,values:[(0,a.capitalize)(t.toString())],config:{displayNameFromDS:"State"}},{name:"elapsedTime",type:l.FieldType.number,values:[r],config:{unit:"ms",displayNameFromDS:"Elapsed Time"}},{name:"totalBlocks",type:l.FieldType.number,values:[e.totalBlocks],config:{displayNameFromDS:"Total Blocks"}},{name:"completedJobs",type:l.FieldType.number,values:[e.completedJobs],config:{displayNameFromDS:"Completed Jobs"}},{name:"totalJobs",type:l.FieldType.number,values:[e.totalJobs],config:{displayNameFromDS:"Total Jobs"}},{name:"progress",type:l.FieldType.number,values:[t===_.O8.Done?100:(e.completedJobs||0)/(e.totalJobs||1)*100],config:{displayNameFromDS:"Progress",unit:"percent",min:0,max:100,custom:{cellOptions:{type:"gauge",mode:"gradient"}},thresholds:n}}],meta:{preferredVisualisationType:"table"}}}function Xt(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class Ht extends l.CustomVariableSupport{query(e){if(!this.datasource)throw new Error("Datasource not initialized");const t=this.datasource.executeVariableQuery(e.targets[0],e.range);return(0,n.from)(t).pipe((0,s.map)((e=>({data:e}))))}constructor(e){super(),Xt(this,"datasource",void 0),Xt(this,"editor",void 0),this.datasource=e,this.editor=b}}function zt(e,t,r,a,n,s,o){try{var i=e[s](o),l=i.value}catch(e){return void r(e)}i.done?t(l):Promise.resolve(l).then(a,n)}function Wt(e){return function(){var t=this,r=arguments;return new Promise((function(a,n){var s=e.apply(t,r);function o(e){zt(s,a,n,o,i,"next",e)}function i(e){zt(s,a,n,o,i,"throw",e)}o(void 0)}))}}function Yt(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Kt(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},a=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(a=a.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),a.forEach((function(t){Yt(e,t,r[t])}))}return e}function Zt(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,a)}return r}(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})),e}const er=20,tr=3;var rr=function(e){return e.searchStreaming="searchStreaming",e.metricsStreaming="metricsStreaming",e}({});const ar={searchStreaming:"2.2.0",metricsStreaming:"2.7.0"};class nr extends c.DataSourceWithBackend{executeVariableQuery(e,t){return Wt((function*(){if(void 0===e.type)return new Promise((()=>[]));switch(e.type){case g.LabelNames:return yield this.labelNamesQuery(t);case g.LabelValues:return this.labelValuesQuery(e.label,t);default:throw Error("Invalid query type: "+e.type)}})).call(this)}labelNamesQuery(e){return Wt((function*(){yield this.languageProvider.start(e,this.timeRangeForTags);return this.languageProvider.getAutocompleteTags().filter((e=>void 0!==e)).map((e=>({text:e})))})).call(this)}labelValuesQuery(e,t){return Wt((function*(){if(!e)return[];let r;yield this.languageProvider.start(t,this.timeRangeForTags);try{var a;const n=null===(a=(this.languageProvider.tagsV2||[]).flatMap((e=>e.tags.map((t=>({scope:e.name,name:t}))))).find((t=>t.name===e)))||void 0===a?void 0:a.scope;if(!n)throw Error(`Scope for tag ${e} not found`);const s="intrinsic"===n?e:`${n}.${e}`;r=yield this.languageProvider.getOptionsV2({tag:s,timeRangeForTags:this.timeRangeForTags,range:t})}catch(t){r=yield this.languageProvider.getOptionsV1(e)}return r.flatMap((e=>void 0!==e.value?[{text:e.value}]:[]))})).call(this)}getTagKeys(e){return Wt((function*(){var t;yield this.languageProvider.fetchTags(this.timeRangeForTags,null!==(t=null==e?void 0:e.timeRange)&&void 0!==t?t:void 0);return(this.languageProvider.tagsV2||[]).map((({name:e,tags:t})=>t.filter((e=>void 0!==e)).map((t=>"intrinsic"!==e?`${e}.${t}`:`${t}`)))).flat().map((e=>({text:e})))})).call(this)}getTagValues(e){const t=this.languageProvider.generateQueryFromFilters({adhocFilters:e.filters});var r;return this.tagValuesQuery(e.key,t,null!==(r=null==e?void 0:e.timeRange)&&void 0!==r?r:void 0)}tagValuesQuery(e,t,r){return Wt((function*(){let a;try{a=yield this.languageProvider.getOptionsV2({tag:e,query:t,timeRangeForTags:this.timeRangeForTags,range:r})}catch(t){a=yield this.languageProvider.getOptionsV1((0,d.Jy)(e))}return a.flatMap((e=>void 0!==e.value?[{text:e.value}]:[]))})).call(this)}getNativeHistograms(e){return Wt((function*(){var t;if(!(null===(t=this.serviceMap)||void 0===t?void 0:t.datasourceUid))return!1;const r=S.replace("_bucket","");try{var a;const t=yield(0,c.getDataSourceSrv)().get(this.serviceMap.datasourceUid),n=(null==e?void 0:e.from)||(0,l.dateTime)().subtract(1,"hour"),s=(null==e?void 0:e.to)||(0,l.dateTime)(),o=Math.floor(n.valueOf()/1e3),i=Math.floor(s.valueOf()/1e3);if(!("metadataRequest"in t)||"function"!=typeof t.metadataRequest)return!1;const u=yield t.metadataRequest("/api/v1/series",{"match[]":r,limit:1,start:o,end:i}),d=null==u||null===(a=u.data)||void 0===a?void 0:a.data;return!(!d||!Array.isArray(d))&&d.length>0}catch(e){return console.warn("Failed to check for native histograms:",e),!1}})).call(this)}isFeatureAvailable(e){var t;const r=null!==(t=this.tempoVersion)&&void 0!==t?t:"2.1.0";try{return i().gte(r,ar[e])}catch(e){return!0}}isStreamingSearchEnabled(){var e;return(null===(e=this.streamingEnabled)||void 0===e?void 0:e.search)&&c.config.liveEnabled}isStreamingMetricsEnabled(){var e;return(null===(e=this.streamingEnabled)||void 0===e?void 0:e.metrics)&&c.config.liveEnabled}isTraceQlMetricsQuery(e){return!!e.trim().match(/\|\s*(rate|count_over_time|avg_over_time|max_over_time|min_over_time|sum_over_time|quantile_over_time|histogram_over_time|compare)\s*\(/)}isTraceIdQuery(e){return!!e.trim().match(/^[0-9A-Fa-f]*$/)}query(e){var t,r,o,i,d,p;const m=[],f=e.targets.filter((e=>!e.hide)),v=(0,a.groupBy)(f,(e=>e.queryType||"traceql"));if(v.clear)return(0,n.of)({data:[],state:l.LoadingState.Done});if((null===(t=v.nativeSearch)||void 0===t?void 0:t.length)&&(v.nativeSearch[0].spanName||v.nativeSearch[0].serviceName||v.nativeSearch[0].search||v.nativeSearch[0].maxDuration||v.nativeSearch[0].minDuration||"nativeSearch"===v.nativeSearch[0].queryType)){var g;const e=(0,Mt.d6)(v.nativeSearch[0]);(null===(g=v.traceqlSearch)||void 0===g?void 0:g.length)?v.traceqlSearch.push(e):v.traceqlSearch=[e]}if(null===(r=v.traceql)||void 0===r?void 0:r.length)try{const t=this.applyVariables(v.traceql[0],e.scopedVars),r=(null==t?void 0:t.query)||"";var h;if(this.isTraceIdQuery(r))(0,c.reportInteraction)("grafana_traces_traceID_queried",{datasourceType:"tempo",app:null!==(h=e.app)&&void 0!==h?h:"",grafana_version:c.config.buildInfo.version,hasQuery:""!==r}),m.push(this.handleTraceIdQuery(e,v.traceql,r));else if(this.isTraceQlMetricsQuery(r)){const t=this.isStreamingMetricsEnabled()&&e.app!==l.CoreApp.CloudAlerting&&e.app!==l.CoreApp.UnifiedAlerting;var y;(0,c.reportInteraction)("grafana_traces_traceql_metrics_queried",{datasourceType:"tempo",app:null!==(y=e.app)&&void 0!==y?y:"",grafana_version:c.config.buildInfo.version,query:null!=r?r:"",streaming:t}),t?m.push(this.handleMetricsStreamingQuery(e,v.traceql,r)):m.push(this.handleTraceQlMetricsQuery(e,v.traceql,r))}else{var b;(0,c.reportInteraction)("grafana_traces_traceql_queried",{datasourceType:"tempo",app:null!==(b=e.app)&&void 0!==b?b:"",grafana_version:c.config.buildInfo.version,query:null!=r?r:"",streaming:this.isStreamingSearchEnabled()}),m.push(this.handleTraceQlQuery(e,v,r))}}catch(e){return(0,n.of)({error:{message:e instanceof Error?e.message:"Unknown error occurred"},data:[]})}if(null===(o=v.traceqlSearch)||void 0===o?void 0:o.length){if(v.traceqlSearch[0].groupBy)return(0,n.of)({error:{message:"The aggregate by query is deprecated. Please remove the current query and create a new one. Alternatively, you can use Traces Drilldown."},data:[]});try{const t=v.traceqlSearch;if(t.length>0){const r=this.applyVariables(t[0],e.scopedVars),a=this.languageProvider.generateQueryFromFilters({traceqlFilters:r.filters,adhocFilters:e.filters});var _;if((0,c.reportInteraction)("grafana_traces_traceql_search_queried",{datasourceType:"tempo",app:null!==(_=e.app)&&void 0!==_?_:"",grafana_version:c.config.buildInfo.version,query:null!=a?a:"",streaming:this.isStreamingSearchEnabled()}),this.isStreamingSearchEnabled())m.push(this.handleStreamingQuery(e,t,a));else{const t=performance.now();var E,w;m.push(this._request("/api/search",{q:a,limit:null!==(E=e.targets[0].limit)&&void 0!==E?E:er,spss:null!==(w=e.targets[0].spss)&&void 0!==w?w:tr,start:e.range.from.unix(),end:e.range.to.unix()}).pipe((0,s.map)((r=>(fr("grafana_traces_traceql_response",e,{success:!0,streaming:!1,latencyMs:Math.round(performance.now()-t),query:null!=a?a:""}),{data:Ot(r.data.traces,this.instanceSettings,v.traceqlSearch[0].tableType)}))),(0,s.catchError)((r=>{var s;return fr("grafana_traces_traceql_response",e,{success:!1,streaming:!1,latencyMs:Math.round(performance.now()-t),query:null!=a?a:"",error:(0,Mt.u1)(r.message),statusCode:r.status,statusText:r.statusText}),(0,n.of)({error:{message:(0,Mt.u1)(null==r||null===(s=r.data)||void 0===s?void 0:s.message)},data:[]})}))))}}}catch(e){return(0,n.of)({error:{message:e instanceof Error?e.message:"Unknown error occurred"},data:[]})}}if(null===(i=v.upload)||void 0===i?void 0:i.length)if(this.uploadedJson){var T;(0,c.reportInteraction)("grafana_traces_json_file_uploaded",{datasourceType:"tempo",app:null!==(T=e.app)&&void 0!==T?T:"",grafana_version:c.config.buildInfo.version});const t=JSON.parse(this.uploadedJson),r=t.batches,a=Array.isArray(t)&&t.some((e=>{var t;return"nodeGraph"===(null==e||null===(t=e.meta)||void 0===t?void 0:t.preferredVisualisationType)}));var S;if(r)m.push((0,n.of)(function(e,t=!1){const r=new l.MutableDataFrame({fields:[{name:"traceID",type:l.FieldType.string,values:[]},{name:"spanID",type:l.FieldType.string,values:[]},{name:"parentSpanID",type:l.FieldType.string,values:[]},{name:"operationName",type:l.FieldType.string,values:[]},{name:"serviceName",type:l.FieldType.string,values:[]},{name:"kind",type:l.FieldType.string,values:[]},{name:"statusCode",type:l.FieldType.number,values:[]},{name:"statusMessage",type:l.FieldType.string,values:[]},{name:"instrumentationLibraryName",type:l.FieldType.string,values:[]},{name:"instrumentationLibraryVersion",type:l.FieldType.string,values:[]},{name:"traceState",type:l.FieldType.string,values:[]},{name:"serviceTags",type:l.FieldType.other,values:[]},{name:"startTime",type:l.FieldType.number,values:[]},{name:"duration",type:l.FieldType.number,values:[]},{name:"logs",type:l.FieldType.other,values:[]},{name:"references",type:l.FieldType.other,values:[]},{name:"tags",type:l.FieldType.other,values:[]}],meta:{preferredVisualisationType:"trace",custom:{traceFormat:"otlp"}}});try{for(const t of e){const{serviceName:e,serviceTags:i}=yt(t.resource);for(const l of t.instrumentationLibrarySpans)for(const t of l.spans){var a,n,s,o;r.add({traceID:t.traceId,spanID:t.spanId,parentSpanID:t.parentSpanId||"",operationName:t.name||"",serviceName:e,kind:_t(t),statusCode:null===(a=t.status)||void 0===a?void 0:a.code,statusMessage:null===(n=t.status)||void 0===n?void 0:n.message,instrumentationLibraryName:null===(s=l.instrumentationLibrary)||void 0===s?void 0:s.name,instrumentationLibraryVersion:null===(o=l.instrumentationLibrary)||void 0===o?void 0:o.version,traceState:t.traceState,serviceTags:i,startTime:t.startTimeUnixNano/1e6,duration:(t.endTimeUnixNano-t.startTimeUnixNano)/1e6,tags:bt(t),logs:wt(t),references:Et(t)})}}}catch(e){return console.error(e),{error:{message:"JSON is not valid OpenTelemetry format: "+e},data:[]}}let i=[r];return t&&i.push(...dt(r)),{data:i}}(t.batches,null===(S=this.nodeGraph)||void 0===S?void 0:S.enabled)));else a?m.push((0,n.of)({data:t,state:l.LoadingState.Done})):m.push((0,n.of)({error:{message:"Unable to parse uploaded data."},data:[]}))}else m.push((0,n.of)({data:[],state:l.LoadingState.Done}));if((null===(d=this.serviceMap)||void 0===d?void 0:d.datasourceUid)&&(null===(p=v.serviceMap)||void 0===p?void 0:p.length)>0){var F;(0,c.reportInteraction)("grafana_traces_service_graph_queried",{datasourceType:"tempo",app:null!==(F=e.app)&&void 0!==F?F:"",grafana_version:c.config.buildInfo.version,hasServiceMapQuery:!!v.serviceMap[0].serviceMapQuery});const{datasourceUid:t}=this.serviceMap,r=e.targets[0].serviceMapUseNativeHistograms,a=this.uid;m.push(function(e,t,r,a){const n=mr(e,a);return sr(n,t).pipe((0,s.toArray)(),(0,s.map)((n=>{const s=n.find((e=>!!e.error));var o;if(s)throw new Error((0,Mt.u1)(null===(o=s.error)||void 0===o?void 0:o.message));const{nodes:i,edges:u}=D(n,e.range);if(i.fields.length>0&&u.fields.length>0){const e=i.fields[0].values.length,t=u.fields[0].values.length;(0,c.reportInteraction)("grafana_traces_service_graph_size",{datasourceType:"tempo",grafana_version:c.config.buildInfo.version,nodeLength:e,edgeLength:t})}const{serviceMapIncludeNamespace:d,refId:p}=e.targets[0];return i.refId=p,u.refId=p,d?(i.fields[0].config=cr(t,r,"__data.fields.title","__data.fields[0]",void 0,{targetNamespace:"__data.fields.subtitle"},a),u.fields[0].config=cr(t,r,"__data.fields.targetName","__data.fields.target","__data.fields.sourceName",{targetNamespace:"__data.fields.targetNamespace",sourceNamespace:"__data.fields.sourceNamespace"},a)):(i.fields[0].config=cr(t,r,"__data.fields.id","__data.fields[0]",void 0,void 0,a),u.fields[0].config=cr(t,r,"__data.fields.target","__data.fields.target","__data.fields.source",void 0,a)),{nodes:i,edges:u,state:l.LoadingState.Done}})))}(e,t,a,r).pipe((0,s.concatMap)((n=>function(e,t,r,a){const n=mr(e,a);return n.targets=yr([vr(O,$,e)]),sr(n,r).pipe((0,s.toArray)(),(0,s.map)((e=>{var r;const a=e.find((e=>!!e.error));var n,s;if(a)throw new Error((0,Mt.u1)(null===(n=a.error)||void 0===n?void 0:n.message));return{rates:null!==(s=null===(r=e[0])||void 0===r?void 0:r.data)&&void 0!==s?s:[],nodes:t.nodes,edges:t.edges}})))}(e,n,t).pipe((0,s.concatMap)((n=>function(e,t,r,a,n){let o=[],i="",c=[],d=[];if(t.rates[0]&&e.app===l.CoreApp.Explore){const e=t.rates[0].fields.find((e=>"span_name"===e.name));e&&e.values&&(d=e.values)}else t.rates&&t.rates.map((e=>{const t=e.fields.find((e=>{var t;return null===(t=e.labels)||void 0===t?void 0:t.span_name}));var r;t&&d.push(null===(r=t.labels)||void 0===r?void 0:r.span_name)}));const p=ir(lr(d));p.length>0&&(i=vr(N,'span_name=~"'+p.join("|")+'"',e),o.push(i),p.map((t=>{const r=vr(n?j:I,'span_name=~"'+t+'"',e);c.push(r),o.push(r)})));const m=mr(e,n);return m.targets=yr(o),sr(m,r).pipe((0,s.toArray)(),(0,s.map)((s=>{const o=s.find((e=>!!e.error));var d;if(o)throw new Error((0,Mt.u1)(null===(d=o.error)||void 0===d?void 0:d.message));const p=function(e,t,r,a,n,s,o,i){var c,d;let p={fields:[]};const m=t.rates.filter((t=>t.refId===vr(O,$,e))),f=r.data.filter((e=>e.refId===a)),v=r.data.filter((e=>{var t;return n.includes(null!==(t=e.refId)&&void 0!==t?t:"")}));m.length>0&&(null===(c=m[0].fields)||void 0===c?void 0:c.length)>2&&(p.fields.push(Zt(Kt({},m[0].fields[1]),{name:"Name",config:{filterable:!1}})),p.fields.push(Zt(Kt({},m[0].fields[2]),{name:"Rate",config:{links:[or("Rate",gr(vr(O,'span_name="${__data.fields[0]}"',e)),s,!1)],decimals:2}})),p.fields.push(Zt(Kt({},m[0].fields[2]),{name:"  ",labels:null,config:{color:{mode:"continuous-BlPu"},custom:{cellOptions:{mode:u.eX.Lcd,type:u.ob.Gauge}},decimals:3}})));if(f.length>0&&(null===(d=f[0].fields)||void 0===d?void 0:d.length)>2){var g,h,y;const t=null!==(y=null===(g=f[0].fields[1])||void 0===g?void 0:g.values)&&void 0!==y?y:[];var b;const r=null!==(b=null===(h=f[0].fields[2])||void 0===h?void 0:h.values)&&void 0!==b?b:[];let a={};t.map(((e,t)=>{a[e]={value:r[t]}}));const n=hr(Kt({},m),a);p.fields.push(Zt(Kt({},f[0].fields[2]),{name:"Error Rate",values:n,config:{links:[or("Error Rate",gr(vr(N,'span_name="${__data.fields[0]}"',e)),s,!1)],decimals:2}})),p.fields.push(Zt(Kt({},f[0].fields[2]),{name:"   ",values:n,labels:null,config:{color:{mode:"continuous-RdYlGr"},custom:{cellOptions:{mode:u.eX.Lcd,type:u.ob.Gauge}},decimals:3}}))}if(v.length>0){let t={};if(v.forEach((e=>{if(e.fields.length>1){var r,a;const n=(null===(r=e.refId)||void 0===r?void 0:r.includes('span_name=~"'))?'span_name=~"':'span_name="',s=null===(a=e.refId)||void 0===a?void 0:a.split(n)[1].split('"}')[0];t[s]={value:e.fields[1].values[0]}}})),Object.keys(t).length>0){const r=i?j:I;p.fields.push(Zt(Kt({},v[0].fields[1]),{name:"Duration (p90)",values:hr(Kt({},m),t),config:{links:[or("Duration",gr(vr(r,'span_name="${__data.fields[0]}"',e)),s,!1)],unit:"s"}}))}}p.fields.length>0&&p.fields[0].values&&p.fields.push({name:"Links",type:l.FieldType.string,values:p.fields[0].values.map((()=>"Tempo")),config:{links:[dr("Tempo",void 0,"","${__data.fields[0]}",o)]}});return p}(e,t,s[0],i,c,r,a,n);return 0===p.fields.length?{data:[t.nodes,t.edges],state:l.LoadingState.Done}:{data:[p,t.nodes,t.edges],state:l.LoadingState.Done}})))}(e,n,t,a,r))))))))}return(0,n.merge)(...m).pipe((0,s.map)((e=>{var t,r,a,n;(null===(r=e.errors)||void 0===r||null===(t=r[0])||void 0===t?void 0:t.message)&&(e.errors[0].message=(0,Mt.YN)(null===(n=e.errors)||void 0===n||null===(a=n[0])||void 0===a?void 0:a.message));return e})))}applyTemplateVariables(e,t){return this.applyVariables(e,t)}interpolateVariablesInQueries(e,t){return e&&0!==e.length?e.map((e=>Kt(Zt(Kt({},e),{datasource:this.getRef()}),this.applyVariables(e,t)))):[]}applyVariables(e,t){const r=Kt({},e);var a,n;return e.filters&&(r.filters=(0,d.tH)(e.filters,t)),Zt(Kt({},r),{query:this.templateSrv.replace(null!==(a=e.query)&&void 0!==a?a:"",t,u.$m.Pipe),serviceMapQuery:Array.isArray(e.serviceMapQuery)?e.serviceMapQuery.map((e=>this.templateSrv.replace(e,t))):this.templateSrv.replace(null!==(n=e.serviceMapQuery)&&void 0!==n?n:"",t)})}handleTraceIdQuery(e,t,r){const a=t.filter((e=>e.query)).map((e=>{var t;return Zt(Kt({},e),{query:null===(t=e.query)||void 0===t?void 0:t.trim(),queryType:"traceId"})}));if(!a.length)return n.EMPTY;const o=performance.now(),i=this.makeTraceIdRequest(e,a);return super.query(i).pipe((0,s.map)((t=>{var a;return t.error?(fr("grafana_traces_traceID_response",e,{success:!1,streaming:!1,latencyMs:Math.round(performance.now()-o),query:null!=r?r:"",error:(0,Mt.u1)(t.error.message),statusCode:t.error.status,statusText:t.error.statusText}),t):(fr("grafana_traces_traceID_response",e,{success:!0,streaming:!1,latencyMs:Math.round(performance.now()-o),query:null!=r?r:""}),Tt(t,this.instanceSettings,null===(a=this.nodeGraph)||void 0===a?void 0:a.enabled))})),(0,s.catchError)((t=>{throw fr("grafana_traces_traceID_response",e,{success:!1,streaming:!1,latencyMs:Math.round(performance.now()-o),query:null!=r?r:"",error:(0,Mt.u1)(t.message),statusCode:t.status,statusText:t.statusText}),t})))}handleTraceQlMetricsQuery(e,t,r){const a=t.filter((e=>e.query)).map((t=>Zt(Kt({},t),{query:this.applyVariables(t,e.scopedVars).query,queryType:"traceql"})));if(!a.length)return n.EMPTY;const o=performance.now(),i=Zt(Kt({},e),{targets:a});return super.query(i).pipe((0,s.map)((t=>(fr("grafana_traces_traceql_metrics_response",e,{success:!0,streaming:!1,latencyMs:Math.round(performance.now()-o),query:null!=r?r:""}),St(t,this.instanceSettings)))),(0,s.catchError)((t=>{var a,s;return fr("grafana_traces_traceql_metrics_response",e,{success:!1,streaming:!1,latencyMs:Math.round(performance.now()-o),query:null!=r?r:"",error:(0,Mt.u1)(null==t||null===(a=t.data)||void 0===a?void 0:a.message),statusCode:t.status,statusText:t.statusText}),(0,n.of)({error:{message:(0,Mt.u1)(null==t||null===(s=t.data)||void 0===s?void 0:s.message)},data:[]})})))}handleStreamingQuery(e,t,r){if(""===r)return n.EMPTY;const a=performance.now();return(0,n.merge)(...t.map((t=>function(e,t,r,a){const s=r.range;let o,i=l.LoadingState.NotStarted;const u=performance.now();var d;return(0,c.getGrafanaLiveSrv)().getStream({scope:l.LiveChannelScope.DataSource,namespace:t.uid,path:`search/${Qt()}`,data:Ut(Gt({},e),{SpansPerSpanSet:null!==(d=e.spss)&&void 0!==d?d:tr,timeRange:{from:s.from.toISOString(),to:s.to.toISOString()}})}).pipe((0,n.takeWhile)((e=>{if("message"in e&&(null==e?void 0:e.message)){const t=e.message.data.values[2][0];if(t===_.O8.Done||t===_.O8.Error)return!1}return!0}),!0)).pipe((0,n.map)((t=>{if("message"in t&&(null==t?void 0:t.message)){var r,n,s,c;const d=performance.now()-u,p=(0,l.dataFrameFromJSON)(t.message),m=new l.FieldCache(p),f=null===(r=m.getFieldByName("result"))||void 0===r?void 0:r.values[0],v=null===(n=m.getFieldByName("metrics"))||void 0===n?void 0:n.values[0],g=null===(s=m.getFieldByName("state"))||void 0===s?void 0:s.values[0],h=null===(c=m.getFieldByName("error"))||void 0===c?void 0:c.values[0];switch(g){case _.O8.Done:i=l.LoadingState.Done;break;case _.O8.Streaming:i=l.LoadingState.Streaming;break;case _.O8.Error:throw new Error(h)}o=[...Ot(f,a,e.tableType),Jt(v,g,d)]}return{data:o||[],state:i}})))}(Zt(Kt({},t),{query:r}),this,e,this.instanceSettings)))).pipe((0,s.catchError)((t=>{var n;throw fr("grafana_traces_traceql_response",e,{success:!1,streaming:!0,latencyMs:Math.round(performance.now()-a),query:null!=r?r:"",error:(0,Mt.u1)(null==t||null===(n=t.data)||void 0===n?void 0:n.message),statusCode:t.status,statusText:t.statusText}),t})),(0,s.finalize)((()=>{fr("grafana_traces_traceql_response",e,{success:!0,streaming:!0,query:null!=r?r:"",latencyMs:Math.round(performance.now()-a)})})))}handleMetricsStreamingQuery(e,t,r){if(""===r)return n.EMPTY;const a=performance.now();return(0,n.merge)(...t.map((t=>Bt(Zt(Kt({},t),{query:r}),this,e)))).pipe((0,s.map)((e=>St(e,this.instanceSettings))),(0,s.catchError)((t=>{var n;throw fr("grafana_traces_traceql_metrics_response",e,{success:!1,streaming:!0,latencyMs:Math.round(performance.now()-a),query:null!=r?r:"",error:(0,Mt.u1)(null==t||null===(n=t.data)||void 0===n?void 0:n.message),statusCode:t.status,statusText:t.statusText}),t})),(0,s.finalize)((()=>{fr("grafana_traces_traceql_metrics_response",e,{success:!0,streaming:!0,query:null!=r?r:"",latencyMs:Math.round(performance.now()-a)})})))}makeTraceIdRequest(e,t){var r;const a=Zt(Kt({},e),{targets:t});var n,s;(null===(r=this.traceQuery)||void 0===r?void 0:r.timeShiftEnabled)?a.range=e.range&&Zt(Kt({},e.range),{from:(0,l.dateTime)(e.range.from).subtract(l.rangeUtil.intervalToMs((null===(n=this.traceQuery)||void 0===n?void 0:n.spanStartTimeShift)||"30m"),"milliseconds"),to:(0,l.dateTime)(e.range.to).add(l.rangeUtil.intervalToMs((null===(s=this.traceQuery)||void 0===s?void 0:s.spanEndTimeShift)||"30m"),"milliseconds")}):a.range={from:(0,l.dateTime)(0),to:(0,l.dateTime)(0),raw:{from:(0,l.dateTime)(0),to:(0,l.dateTime)(0)}};return a}metadataRequest(e){return Wt((function*(e,t={}){return yield(0,n.lastValueFrom)(this._request(e,t,{method:"GET",hideFromInspector:!0}))})).apply(this,arguments)}_request(e,t,r){const a=t?l.urlUtil.serializeParams(t):"",n=`${this.instanceSettings.url}${e}${a.length?`?${a}`:""}`,s=Zt(Kt({},r),{url:n});return(0,c.getBackendSrv)().fetch(s)}testDatasource(){return Wt((function*(){var e;const t=[],r={headers:{},method:"GET",url:`${this.instanceSettings.url}/api/echo`};if(t.push((0,c.getBackendSrv)().fetch(r).pipe((0,s.mergeMap)((()=>(0,n.of)({status:"success",message:"Health check succeeded"}))),(0,s.catchError)((e=>{var t;return(0,n.of)({status:"error",message:(0,Mt.u1)(null==e||null===(t=e.data)||void 0===t?void 0:t.message,"Unable to connect with Tempo")})})))),null===(e=this.streamingEnabled)||void 0===e?void 0:e.search){const e=new Date,r=new Date(e);r.setMinutes(r.getMinutes()-15),t.push(this.handleStreamingQuery({range:{from:(0,l.dateTime)(r),to:(0,l.dateTime)(e),raw:{from:"now-15m",to:"now"}},requestId:"",interval:"",intervalMs:0,scopedVars:{},targets:[],timezone:"",app:"",startTime:0},[{datasource:this.instanceSettings,limit:1,query:"{}",queryType:"traceql",refId:"A",tableType:_.Jv.Traces,filters:[]}],"{}").pipe((0,s.mergeMap)((()=>(0,n.of)({status:"success",message:"Streaming test succeeded."}))),(0,s.catchError)((e=>{var t;return(0,n.of)({status:"error",message:(0,Mt.u1)(null==e||null===(t=e.data)||void 0===t?void 0:t.message,"Test for streaming failed, consider disabling streaming")})}))))}return yield(0,n.lastValueFrom)((0,n.forkJoin)(t).pipe((0,s.mergeMap)((e=>{const t=e.find((e=>"success"!==e.status));return t?(0,n.of)(t):(0,n.of)({status:"success",message:"Successfully connected to Tempo data source."})}))))})).call(this)}getQueryDisplayText(e){var t;if("traceql"===e.queryType||"traceId"===e.queryType)return null!==(t=e.query)&&void 0!==t?t:"";const r=this.applyVariables(e,{});return this.languageProvider.generateQueryFromFilters({traceqlFilters:r.filters})}constructor(e,t=(0,c.getTemplateSrv)()){var r,a;super(e),Yt(r=this,"instanceSettings",void 0),Yt(r,"templateSrv",void 0),Yt(r,"tracesToLogs",void 0),Yt(r,"serviceMap",void 0),Yt(r,"search",void 0),Yt(r,"nodeGraph",void 0),Yt(r,"traceQuery",void 0),Yt(r,"uploadedJson",void 0),Yt(r,"spanBar",void 0),Yt(r,"tagLimit",void 0),Yt(r,"languageProvider",void 0),Yt(r,"streamingEnabled",void 0),Yt(r,"timeRangeForTags",void 0),Yt(r,"tempoVersion",void 0),Yt(r,"init",void 0),Yt(r,"handleTraceQlQuery",void 0),r.instanceSettings=e,r.templateSrv=t,r.uploadedJson=null,r.init=()=>Wt((function*(){const e=yield(0,n.lastValueFrom)(r._request("/api/status/buildinfo").pipe((0,s.map)((e=>e)),(0,s.catchError)((e=>{var t;return console.error("Failure in retrieving build information",null==e||null===(t=e.data)||void 0===t?void 0:t.message),(0,n.of)({error:e,data:{version:null}})}))));r.tempoVersion=e.data.version}))(),r.handleTraceQlQuery=(e,t,a)=>{const o=performance.now();return r.isStreamingSearchEnabled()?r.handleStreamingQuery(e,t.traceql,a):r._request("/api/search",{q:a,limit:null!==(i=e.targets[0].limit)&&void 0!==i?i:er,spss:null!==(l=e.targets[0].spss)&&void 0!==l?l:tr,start:e.range.from.unix(),end:e.range.to.unix()}).pipe((0,s.map)((n=>(fr("grafana_traces_traceql_response",e,{success:!0,streaming:!1,latencyMs:Math.round(performance.now()-o),query:null!=a?a:""}),{data:Ot(n.data.traces,r.instanceSettings,t.traceql[0].tableType)}))),(0,s.catchError)((t=>{var r;return fr("grafana_traces_traceql_response",e,{success:!1,streaming:!1,latencyMs:Math.round(performance.now()-o),query:null!=a?a:"",error:(0,Mt.u1)(t.message),statusCode:t.status,statusText:t.statusText}),(0,n.of)({error:{message:(0,Mt.u1)(null==t||null===(r=t.data)||void 0===r?void 0:r.message)},data:[]})})));var i,l},r.tracesToLogs=e.jsonData.tracesToLogs,r.serviceMap=e.jsonData.serviceMap,r.search=e.jsonData.search,r.nodeGraph=e.jsonData.nodeGraph,r.traceQuery=e.jsonData.traceQuery,r.streamingEnabled=e.jsonData.streamingEnabled,r.timeRangeForTags=e.jsonData.timeRangeForTags,r.languageProvider=new v.Ay(r),(null===(a=r.search)||void 0===a?void 0:a.filters)||(r.search=Zt(Kt({},r.search),{filters:[{id:"service-name",tag:"service.name",operator:"=",scope:_.d.Resource},{id:"span-name",tag:"name",operator:"=",scope:_.d.Span}]})),r.variables=new Ht(r)}}function sr(e,t){return(0,n.from)((0,c.getDataSourceSrv)().get(t)).pipe((0,s.mergeMap)((t=>t.query(e))))}function or(e,t,r,a){var n,s;return{url:"",title:e,internal:{query:{expr:t,range:!a,exemplar:!a,instant:a},datasourceUid:r,datasourceName:null!==(s=null===(n=(0,c.getDataSourceSrv)().getInstanceSettings(r))||void 0===n?void 0:n.name)&&void 0!==s?s:""}}}function ir(e){return e.map((e=>e.replace(/[$^*{}\[\]\'+?.()|]/g,"\\\\$&")))}function lr(e){return e.map((e=>e.replace(/["\\]/g,"\\$&")))}function cr(e,t,r,a,n,s,o){let i=n?`client="\${${n}}",`:"",l=`server="\${${r}}"`,c="server";if(void 0!==s){const{targetNamespace:e}=s;if(l+=`,server_service_namespace="\${${e}}"`,c+=", server_service_namespace",i){const{sourceNamespace:e}=s;i+=`client_service_namespace="\${${e}}",`,c+=", client_service_namespace"}}return{links:[or("Request rate",`sum by (client, ${c})(rate(${w}{${i}${l}}[$__rate_interval]))`,e,!1),...ur(e,i,l,c,o),or("Failed request rate",`sum by (client, ${c})(rate(${T}{${i}${l}}[$__rate_interval]))`,e,!1),pr("View traces",void 0!==s?`\${${s.targetNamespace}}`:"",`\${${r}}`,t)]}}function ur(e,t,r,a,n){const s=(n,s)=>or(s,`histogram_quantile(0.9, sum(rate(${n}{${t}${r}}[$__rate_interval])) by (le, client, ${a}))`,e,!1);return n?[s("traces_service_graph_request_server_seconds","Request native histogram")]:[s(S,"Request classic histogram")]}function dr(e,t,r,a,n){var s;let o={refId:"A",queryType:"traceqlSearch",filters:[]};var i;return void 0!==t&&""!==t&&o.filters.push({id:"service-namespace",scope:_.d.Resource,tag:"service.namespace",value:t,operator:"=",valueType:"string"}),""!==r&&o.filters.push({id:"service-name",scope:_.d.Resource,tag:"service.name",value:r,operator:"=",valueType:"string"}),""!==a&&o.filters.push({id:"span-name",scope:_.d.Span,tag:"name",value:a,operator:"=",valueType:"string"}),{url:"",title:e,internal:{query:o,datasourceUid:n,datasourceName:null!==(i=null===(s=(0,c.getDataSourceSrv)().getInstanceSettings(n))||void 0===s?void 0:s.name)&&void 0!==i?i:""}}}function pr(e,t,r,a){var n,s;return{url:"",title:e,internal:{datasourceUid:a,datasourceName:null!==(s=null===(n=(0,c.getDataSourceSrv)().getInstanceSettings(a))||void 0===n?void 0:n.name)&&void 0!==s?s:"",query:({replaceVariables:e,scopedVars:a})=>{const n=null==e?void 0:e(r,a),s=t?null==e?void 0:e(t,a):void 0,o={refId:"A",queryType:"traceqlSearch",filters:[]};if(!1===("false"!==(null==e?void 0:e(`\${__data.fields.${l.NodeGraphDataFrameFieldNames.isInstrumented}}`,a)))){const e=["db.name","db.system","peer.service","messaging.system","net.peer.name"].map((e=>`span.${e}="${n}"`)).join(" || ");o.queryType="traceql",o.query=`{${e}}`}else s&&o.filters.push({id:"service-namespace",scope:_.d.Resource,tag:"service.namespace",value:s,operator:"=",valueType:"string"}),n&&o.filters.push({id:"service-name",scope:_.d.Resource,tag:"service.name",value:n,operator:"=",valueType:"string"});return o}}}}function mr(e,t){return Zt(Kt({},e),{targets:F.map((r=>{t&&(r=r.replace("_bucket",""));const{serviceMapQuery:a,serviceMapIncludeNamespace:n}=e.targets[0],s=n?", client_service_namespace, server_service_namespace":"",o=Array.isArray(a)?a:[a],i=o.map((e=>`sum by (client, server${s}) (rate(${r}${e||""}[$__range]))`)),l=o.map((e=>`group by (client, connection_type, server${s}) (${r}${e||""})`));return[{format:"table",refId:r,expr:i.join(" OR "),instant:!0},{format:"table",refId:`${r}_labels`,expr:l.join(" OR "),instant:!0}]})).flat()})}function fr(e,t,r){var a;(0,c.reportInteraction)(e,Kt({datasourceType:"tempo",app:null!==(a=t.app)&&void 0!==a?a:"",grafana_version:c.config.buildInfo.version,timeRangeSeconds:t.range?t.range.to.unix()-t.range.from.unix():0,timeRange:t.range?t.range.raw.from+";"+t.range.raw.to:""},r))}function vr(e,t,r){var a,n;let s=null!==(n=null===(a=r.targets[0])||void 0===a?void 0:a.serviceMapQuery)&&void 0!==n?n:"";const o=(Array.isArray(s)?s:[s]).map((r=>{const a=r.match(/^{(.*)}$/);return(null==a?void 0:a.length)&&(r=a[1]),(r=r.replaceAll("client_","").replaceAll("server_","").replace("client","service").replace("server","service")).includes("span_name")?e.params.concat(r):e.params.concat(r).concat(t).filter((e=>e))})).map((t=>e.expr.replace("{}","{"+t.join(",")+"}"))).join(" OR ");return e.topk?`topk(${e.topk}, ${o})`:o}function gr(e){return(e=e.replace("topk(5, ","").replace(" by (span_name))","")).replace("__range","__rate_interval")}function hr(e,t){var r,a,n;const s=null!==(n=null===(a=e[0])||void 0===a||null===(r=a.fields[1])||void 0===r?void 0:r.values)&&void 0!==n?n:[];let o=[];for(let e=0;e<s.length;e++)Object.keys(t).includes(s[e])?o.push(t[s[e]].value):o.push("0");return o}function yr(e){return e.map((e=>({refId:e,expr:e,instant:!0})))}},9728:(e,t,r)=>{e.exports=r(8044)},9784:(e,t,r)=>{r.d(t,{l:()=>c});var a=r(9728),n=r(6089),s=r(2007);function o(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function i(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},a=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(a=a.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),a.forEach((function(t){o(e,t,r[t])}))}return e}function l(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,a)}return r}(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})),e}const c=({values:e,onChange:t,id:r})=>{const o=(0,s.useStyles2)(u);return(0,a.jsx)("div",{className:o.wrapper,children:e.length?e.map(((c,u)=>(0,a.jsxs)("div",{className:o.pair,children:[(0,a.jsx)(s.SegmentInput,{id:`${r}-key-${u}`,placeholder:"Tag name",value:c.key,onChange:r=>{t(e.map(((e,t)=>t===u?l(i({},e),{key:String(r)}):e)))}}),(0,a.jsx)(s.InlineLabel,{"aria-label":"equals",className:o.operator,children:"as"}),(0,a.jsx)(s.SegmentInput,{id:`${r}-value-${u}`,placeholder:"New name (optional)",value:c.value||"",onChange:r=>{t(e.map(((e,t)=>t===u?l(i({},e),{value:String(r)}):e)))}}),(0,a.jsx)(s.ToolbarButton,{onClick:()=>t([...e.slice(0,u),...e.slice(u+1)]),className:(0,n.cx)(o.removeTag,"query-part"),"aria-label":"Remove tag",type:"button",icon:"times"}),u===e.length-1?(0,a.jsx)(s.ToolbarButton,{onClick:()=>t([...e,{key:"",value:""}]),className:"query-part","aria-label":"Add tag",type:"button",icon:"plus"}):null]},u))):(0,a.jsx)(s.ToolbarButton,{icon:"plus",onClick:()=>t([...e,{key:"",value:""}]),className:"query-part","aria-label":"Add tag",type:"button"})})},u=e=>({wrapper:(0,n.css)({display:"flex",flexDirection:"column",gap:`${e.spacing(.5)} 0`}),pair:(0,n.css)({display:"flex",justifyContent:"start",alignItems:"center"}),operator:(0,n.css)({color:e.v1.palette.orange,width:"auto"}),removeTag:(0,n.css)({marginRight:e.spacing(.5)})})},9812:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0});var a=r(5959);t.default=function(){var e=a.useRef(!1),t=a.useCallback((function(){return e.current}),[]);return a.useEffect((function(){return e.current=!0,function(){e.current=!1}}),[]),t}},9881:(e,t,r)=>{const a=r(4256);e.exports=(e,t)=>{const r=a(e,t);return r?r.version:null}},9922:(e,t,r)=>{r.d(t,{Ay:()=>f,J_:()=>m});var a=r(7781),n=r(8531),s=r(7817),o=r(9183),i=r(9607),l=r(3292),c=r(103);function u(e,t,r,a,n,s,o){try{var i=e[s](o),l=i.value}catch(e){return void r(e)}i.done?t(l):Promise.resolve(l).then(a,n)}function d(e){return function(){var t=this,r=arguments;return new Promise((function(a,n){var s=e.apply(t,r);function o(e){u(s,a,n,o,i,"next",e)}function i(e){u(s,a,n,o,i,"throw",e)}o(void 0)}))}}function p(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}const m=1e3;class f extends a.LanguageProvider{fetchTags(e,t){return d((function*(){let r,a;try{const r={limit:this.getTagsLimit()};if(e&&t&&e!==i.o){const{start:a,end:n}=this.getTimeRangeForTags(e,t);r.start=a,r.end=n}a=yield this.request("/api/v2/search/tags",r)}catch(e){r=yield this.request("/api/search/tags",[])}a&&a.scopes?this.setV2Tags(a.scopes):r&&this.setV1Tags(r.tagNames)})).call(this)}getOptionsV1(e){return d((function*(){const t=this.encodeTag(e),r=yield this.request(`/api/search/tag/${t}/values`);let a=[];return r&&r.tagValues&&(a=r.tagValues.map((e=>({value:e,label:e})))),a})).call(this)}getOptionsV2(e){return d((function*({tag:e,query:t,timeRangeForTags:r,range:a}){const o=this.encodeTag(e),l={limit:this.getTagsLimit()};if(t&&(l.q=(0,n.getTemplateSrv)().replace(t,{},s.$m.Pipe)),r&&a&&r!==i.o){const{start:e,end:t}=this.getTimeRangeForTags(r,a);l.start=e,l.end=t}const c=yield this.request(`/api/v2/search/tag/${o}/values`,l);let u=[];return c&&c.tagValues&&c.tagValues.forEach((e=>{e.value&&u.push({type:e.type,value:e.value,label:e.value})})),u})).apply(this,arguments)}generateQueryFromFilters({traceqlFilters:e,adhocFilters:t}){if(!e&&!t)return"";return`{${[...this.generateQueryFromTraceQlFilters(e||[]),...this.generateQueryFromAdHocFilters(t||[])].join(" && ")}}`}generateQueryFromTraceQlFilters(e){return e?e.filter((e=>{var t;return e.tag&&e.operator&&(null===(t=e.value)||void 0===t?void 0:t.length)})).map((t=>(0,o.LL)(t,e,this))):""}constructor(e){var t;super(),p(t=this,"datasource",void 0),p(t,"tagsV1",void 0),p(t,"tagsV2",void 0),p(t,"previousRange",void 0),p(t,"request",((e,r={})=>d((function*(){const a=yield t.datasource.metadataRequest(e,r);return null==a?void 0:a.data}))())),p(t,"start",((e,r)=>d((function*(){const a=t.shouldRefreshLabels(e,t.previousRange);return t.startTask&&!a||(t.previousRange=e,t.startTask=t.fetchTags(r,e).then((()=>[]))),t.startTask}))())),p(t,"roundMsToMin",(e=>t.roundSecToMin(e/1e3))),p(t,"roundSecToMin",(e=>Math.floor(e/60))),p(t,"shouldRefreshLabels",((e,r)=>{if(e&&r){const a=t.roundMsToMin(e.from.valueOf())===t.roundMsToMin(r.from.valueOf()),n=t.roundMsToMin(e.to.valueOf())===t.roundMsToMin(r.to.valueOf());return!(a&&n)}return r!==e})),p(t,"getTagsLimit",(()=>{var e;return(null===(e=t.datasource.instanceSettings.jsonData)||void 0===e?void 0:e.tagLimit)||5e3})),p(t,"setV1Tags",(e=>{t.tagsV1=e})),p(t,"setV2Tags",(e=>{t.tagsV2=e})),p(t,"getIntrinsics",(()=>t.tagsV2?(0,o.rC)(t.tagsV2):c.on)),p(t,"getTags",(e=>t.tagsV2&&e?e===l.d.Unscoped?(0,o.rd)(t.tagsV2):(0,o.vP)(t.tagsV2,e):t.tagsV1?(t.tagsV1.find((e=>"status"===e))||t.tagsV1.push("status"),t.tagsV1):[])),p(t,"getTraceqlAutocompleteTags",(e=>t.tagsV2?e?e===l.d.Unscoped?(0,o.rd)(t.tagsV2):(0,o.vP)(t.tagsV2,e):(0,o.rd)(t.tagsV2):t.tagsV1?(t.tagsV1.find((e=>"status"===e))||t.tagsV1.push("status"),t.tagsV1):[])),p(t,"getAutocompleteTags",(()=>t.tagsV2?(0,o.r)(t.tagsV2):t.tagsV1?(t.tagsV1.find((e=>"status.code"===e))||t.tagsV1.push("status.code"),t.tagsV1):[])),p(t,"getTimeRangeForTags",((e,t)=>({start:Math.max(t.from.unix(),t.to.unix()-e),end:t.to.unix()}))),p(t,"encodeTag",(e=>encodeURIComponent(encodeURIComponent(e)))),p(t,"generateQueryFromAdHocFilters",(e=>e.filter((e=>e.key&&e.operator&&e.value)).map((e=>`${e.key}${e.operator}${t.adHocValueHelper(e)}`)))),p(t,"adHocValueHelper",(e=>t.getIntrinsics().find((t=>t===e.key))&&c.c3.includes(e.key)||parseInt(e.value,10).toString()===e.value?e.value:`"${e.value}"`)),t.datasource=e}}}},m={};function f(e){var t=m[e];if(void 0!==t)return t.exports;var r=m[e]={id:e,exports:{}};return p[e](r,r.exports,f),r.exports}f.m=p,f.amdO={},f.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return f.d(t,{a:t}),t},f.d=(e,t)=>{for(var r in t)f.o(t,r)&&!f.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},f.f={},f.e=e=>Promise.all(Object.keys(f.f).reduce(((t,r)=>(f.f[r](e,t),t)),[])),f.u=e=>e+".js",f.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),f.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),u={},d="tempo:",f.l=(e,t,r,a)=>{if(u[e])u[e].push(t);else{var n,s;if(void 0!==r)for(var o=document.getElementsByTagName("script"),i=0;i<o.length;i++){var l=o[i];if(l.getAttribute("src")==e||l.getAttribute("data-webpack")==d+r){n=l;break}}n||(s=!0,(n=document.createElement("script")).charset="utf-8",n.timeout=120,f.nc&&n.setAttribute("nonce",f.nc),n.setAttribute("data-webpack",d+r),n.src=e),u[e]=[t];var c=(t,r)=>{n.onerror=n.onload=null,clearTimeout(p);var a=u[e];if(delete u[e],n.parentNode&&n.parentNode.removeChild(n),a&&a.forEach((e=>e(r))),t)return t(r)},p=setTimeout(c.bind(null,void 0,{type:"timeout",target:n}),12e4);n.onerror=c.bind(null,n.onerror),n.onload=c.bind(null,n.onload),s&&document.head.appendChild(n)}},f.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},f.p="public/plugins/tempo/",(()=>{f.b=document.baseURI||self.location.href;var e={4231:0};f.f.j=(t,r)=>{var a=f.o(e,t)?e[t]:void 0;if(0!==a)if(a)r.push(a[2]);else{var n=new Promise(((r,n)=>a=e[t]=[r,n]));r.push(a[2]=n);var s=f.p+f.u(t),o=new Error;f.l(s,(r=>{if(f.o(e,t)&&(0!==(a=e[t])&&(e[t]=void 0),a)){var n=r&&("load"===r.type?"missing":r.type),s=r&&r.target&&r.target.src;o.message="Loading chunk "+t+" failed.\n("+n+": "+s+")",o.name="ChunkLoadError",o.type=n,o.request=s,a[1](o)}}),"chunk-"+t,t)}};var t=(t,r)=>{var a,n,[s,o,i]=r,l=0;if(s.some((t=>0!==e[t]))){for(a in o)f.o(o,a)&&(f.m[a]=o[a]);if(i)i(f)}for(t&&t(r);l<s.length;l++)n=s[l],f.o(e,n)&&e[n]&&e[n][0](),e[n]=0},r=globalThis.webpackChunktempo=globalThis.webpackChunktempo||[];r.forEach(t.bind(null,0)),r.push=t.bind(null,r.push.bind(r))})(),f.nc=void 0;var v={};f.r(v),f.d(v,{plugin:()=>D});var g=f(1308),h=f.n(g);f.p=h()&&h().uri?h().uri.slice(0,h().uri.lastIndexOf("/")+1):"public/plugins/tempo/";var y=f(9728),b=f(5959),_=f(7781),E=f(8531),w=f(2007),T=f(9638);const S="tempo",O=e=>(Array.isArray(e)?e:[e]).some((e=>(0,E.getTemplateSrv)().containsTemplate(e)));function N(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function I(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},a=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(a=a.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),a.forEach((function(t){N(e,t,r[t])}))}return e}const j=(0,b.lazy)((()=>Promise.all([f.e(6067),f.e(9762)]).then(f.bind(f,3887)))),$=(0,b.lazy)((()=>Promise.all([f.e(3380),f.e(6082)]).then(f.bind(f,6082)))),F=(0,b.lazy)((()=>f.e(6948).then(f.bind(f,6948))));const D=new _.DataSourcePlugin(T.H1).setQueryEditor((function(e){return(0,y.jsx)(b.Suspense,{fallback:(0,y.jsx)(w.LoadingPlaceholder,{text:"Loading editor"}),children:(0,y.jsx)(j,I({},e))})})).setConfigEditor((function(e){return(0,y.jsx)(b.Suspense,{fallback:(0,y.jsx)(w.LoadingPlaceholder,{text:"Loading editor"}),children:(0,y.jsx)($,I({},e))})})).setQueryEditorHelp((function(){return(0,y.jsx)(b.Suspense,{fallback:null,children:(0,y.jsx)(F,{})})}));return(0,E.getAppEvents)().subscribe(_.DashboardLoadedEvent,(({payload:{dashboardId:e,orgId:t,grafanaVersion:r,queries:a}})=>{try{const n=a[S];if(!(null==n?void 0:n.length))return;let s={grafana_version:r,dashboard_id:e,org_id:t,service_map_query_count:0,traceql_query_count:0,upload_query_count:0,service_map_queries_with_template_variables_count:0,traceql_queries_with_template_variables_count:0};for(const e of n)e.hide||("serviceMap"===e.queryType?(s.service_map_query_count++,e.serviceMapQuery&&O(e.serviceMapQuery)&&s.service_map_queries_with_template_variables_count++):"traceql"===e.queryType?(s.traceql_query_count++,O(e.query)&&s.traceql_queries_with_template_variables_count++):"upload"===e.queryType&&s.upload_query_count++);(0,E.reportInteraction)("grafana_tempo_dashboard_loaded",s)}catch(e){console.error("error in tempo tracking handler",e)}})),v})()));
//# sourceMappingURL=module.js.map