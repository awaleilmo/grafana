"use strict";(globalThis.webpackChunktempo=globalThis.webpackChunktempo||[]).push([[6082],{6082:(e,t,n)=>{n.r(t),n.d(t,{default:()=>Pe});var o=n(9728),r=n(6089),a=n(4848),i=n(7781),s=n(364),l=n(5909),c=n(8531),u=n(2007),p=n(9558),d=n(9784);function h(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function g(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},o=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(o=o.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),o.forEach((function(t){h(e,t,n[t])}))}return e}function f(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}function b({options:e,onOptionsChange:t}){var n,s,l,h,b,j;const O=(0,u.useStyles2)(v);var y;return(0,o.jsxs)("div",{className:(0,r.css)({width:"100%"}),children:[(0,o.jsx)(u.InlineFieldRow,{className:O.row,children:(0,o.jsx)(u.InlineField,{tooltip:"The Prometheus data source the trace is going to navigate to",label:"Data source",labelWidth:26,children:(0,o.jsx)(c.DataSourcePicker,{inputId:"trace-to-metrics-data-source-picker",pluginId:"prometheus",current:null===(n=e.jsonData.tracesToMetrics)||void 0===n?void 0:n.datasourceUid,noDefault:!0,width:40,onChange:n=>(0,i.updateDatasourcePluginJsonDataOption)({onOptionsChange:t,options:e},"tracesToMetrics",f(g({},e.jsonData.tracesToMetrics),{datasourceUid:n.uid})),onClear:()=>(0,i.updateDatasourcePluginJsonDataOption)({onOptionsChange:t,options:e},"tracesToMetrics",f(g({},e.jsonData.tracesToMetrics),{datasourceUid:void 0}))})})}),(0,o.jsx)(u.InlineFieldRow,{children:(0,o.jsx)(p.e,{label:(0,a.cJ)("start"),tooltip:(0,a.XX)("start","-2m"),value:(null===(s=e.jsonData.tracesToMetrics)||void 0===s?void 0:s.spanStartTimeShift)||"",onChange:n=>{(0,i.updateDatasourcePluginJsonDataOption)({onOptionsChange:t,options:e},"tracesToMetrics",f(g({},e.jsonData.tracesToMetrics),{spanStartTimeShift:n}))},placeholder:"-2m",isInvalidError:a.FJ})}),(0,o.jsx)(u.InlineFieldRow,{children:(0,o.jsx)(p.e,{label:(0,a.cJ)("end"),tooltip:(0,a.XX)("end","2m"),value:(null===(l=e.jsonData.tracesToMetrics)||void 0===l?void 0:l.spanEndTimeShift)||"",onChange:n=>{(0,i.updateDatasourcePluginJsonDataOption)({onOptionsChange:t,options:e},"tracesToMetrics",f(g({},e.jsonData.tracesToMetrics),{spanEndTimeShift:n}))},placeholder:"2m",isInvalidError:a.FJ})}),(0,o.jsx)(u.InlineFieldRow,{children:(0,o.jsx)(u.InlineField,{tooltip:"Tags that will be used in the metrics query",label:"Tags",labelWidth:26,children:(0,o.jsx)(d.l,{values:null!==(y=null===(h=e.jsonData.tracesToMetrics)||void 0===h?void 0:h.tags)&&void 0!==y?y:[],onChange:n=>(0,i.updateDatasourcePluginJsonDataOption)({onOptionsChange:t,options:e},"tracesToMetrics",f(g({},e.jsonData.tracesToMetrics),{tags:n}))})})}),null===(j=e.jsonData.tracesToMetrics)||void 0===j||null===(b=j.queries)||void 0===b?void 0:b.map(((n,r)=>(0,o.jsxs)("div",{className:O.queryRow,children:[(0,o.jsx)(u.InlineField,{label:"Link Label",labelWidth:26,tooltip:"Descriptive label for the linked query",children:(0,o.jsx)(u.Input,{label:"Link Label",type:"text",allowFullScreen:!0,value:n.name,width:40,onChange:n=>{var o,a;const s=(null!==(a=null===(o=e.jsonData.tracesToMetrics)||void 0===o?void 0:o.queries)&&void 0!==a?a:[]).map(((e,t)=>t===r?f(g({},e),{name:n.currentTarget.value}):e));(0,i.updateDatasourcePluginJsonDataOption)({onOptionsChange:t,options:e},"tracesToMetrics",f(g({},e.jsonData.tracesToMetrics),{queries:s}))}})}),(0,o.jsx)(u.InlineField,{label:"Query",labelWidth:10,tooltip:"The Prometheus query that will run when navigating from a trace to metrics. Interpolate tags using the `$__tags` keyword",grow:!0,children:(0,o.jsx)(u.Input,{label:"Query",type:"text",allowFullScreen:!0,value:n.query,onChange:n=>{var o,a;const s=(null!==(a=null===(o=e.jsonData.tracesToMetrics)||void 0===o?void 0:o.queries)&&void 0!==a?a:[]).map(((e,t)=>t===r?f(g({},e),{query:n.currentTarget.value}):e));(0,i.updateDatasourcePluginJsonDataOption)({onOptionsChange:t,options:e},"tracesToMetrics",f(g({},e.jsonData.tracesToMetrics),{queries:s}))}})}),(0,o.jsx)(u.Button,{variant:"destructive","aria-label":"Remove query",icon:"times",type:"button",onClick:()=>{var n;const o=null===(n=e.jsonData.tracesToMetrics)||void 0===n?void 0:n.queries.filter(((e,t)=>t!==r));(0,i.updateDatasourcePluginJsonDataOption)({onOptionsChange:t,options:e},"tracesToMetrics",f(g({},e.jsonData.tracesToMetrics),{queries:o}))}})]},r))),(0,o.jsx)(u.Button,{variant:"secondary",title:"Add query",icon:"plus",type:"button",onClick:()=>{var n,o;(0,i.updateDatasourcePluginJsonDataOption)({onOptionsChange:t,options:e},"tracesToMetrics",f(g({},e.jsonData.tracesToMetrics),{queries:[...null!==(o=null===(n=e.jsonData.tracesToMetrics)||void 0===n?void 0:n.queries)&&void 0!==o?o:[],{query:""}]}))},children:"Add query"})]})}const j=({options:e,onOptionsChange:t})=>{let n=e.type;return n+="tempo"===e.type?"/configure-tempo-data-source/#trace-to-metrics":"/#trace-to-metrics",(0,o.jsx)(s.A,{title:"Trace to metrics",description:(0,o.jsx)(l.H,{description:"Navigate from a trace span to the selected data source's metrics.",suffix:n,feature:"trace to metrics"}),isCollapsible:!0,isInitiallyOpen:!0,children:(0,o.jsx)(b,{options:e,onOptionsChange:t})})},v=e=>({infoText:{paddingBottom:e.spacing(2),color:e.colors.text.secondary},row:(0,r.css)({label:"row",alignItems:"baseline"}),queryRow:(0,r.css)({label:"queryRow",display:"flex",flexFlow:"wrap"})});var O=n(5959),y=n(6321);function m(e){const t=(n=e.profileTypes,(0,O.useMemo)((()=>{if(!n)return[];let e=new Map;for(let o of n){var t;let n=[];o.id.indexOf(":")>-1&&(n=o.id.split(":"));const[r,a]=n;e.has(r)||e.set(r,{label:r,value:r,items:[]}),null===(t=e.get(r))||void 0===t||t.items.push({label:a,value:o.id})}return Array.from(e.values())}),[n]));var n,r;return(0,o.jsx)(u.Cascader,{placeholder:e.placeholder,separator:"-",displayAllSelectedLevels:!0,initialValue:e.initialProfileTypeId,allowCustomValue:!0,onSelect:e.onChange,options:t,changeOnSelect:!1,width:null!==(r=e.width)&&void 0!==r?r:26})}function w(e,t,n,o,r,a,i){try{var s=e[a](i),l=s.value}catch(e){return void n(e)}s.done?t(l):Promise.resolve(l).then(o,r)}function D(e){return function(){var t=this,n=arguments;return new Promise((function(o,r){var a=e.apply(t,n);function i(e){w(a,o,r,i,s,"next",e)}function s(e){w(a,o,r,i,s,"throw",e)}i(void 0)}))}}function x(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function P(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},o=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(o=o.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),o.forEach((function(t){x(e,t,n[t])}))}return e}function T(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}function C({options:e,onOptionsChange:t}){var n,a,s,l,p,h,g,f;const b=(0,O.useMemo)((()=>["grafana-pyroscope-datasource"]),[]),[j,v]=(0,O.useState)([]),w=(0,O.useMemo)((()=>{var t;let n=0===j.length?"No profile types found":"Select profile type";return(null===(t=e.jsonData.tracesToProfiles)||void 0===t?void 0:t.datasourceUid)||(n="Please select profiling data source"),n}),[null===(n=e.jsonData.tracesToProfiles)||void 0===n?void 0:n.datasourceUid,j]),{value:x}=(0,y.A)((()=>D((function*(){var t;return yield(0,c.getDataSourceSrv)().get(null===(t=e.jsonData.tracesToProfiles)||void 0===t?void 0:t.datasourceUid)}))()),[null===(a=e.jsonData.tracesToProfiles)||void 0===a?void 0:a.datasourceUid]),{value:C}=(0,y.A)((()=>D((function*(){var t;if(x instanceof c.DataSourceWithBackend&&b.includes(x.type)&&x.uid===(null===(t=e.jsonData.tracesToProfiles)||void 0===t?void 0:t.datasourceUid))return yield null==x?void 0:x.getResource("profileTypes")}))()),[x]);var S;return(0,O.useEffect)((()=>{v(null!=C?C:[])}),[C]),(0,o.jsxs)("div",{className:(0,r.css)({width:"100%"}),children:[(0,o.jsx)(u.InlineFieldRow,{children:(0,o.jsx)(u.InlineField,{tooltip:"The profiles data source the trace is going to navigate to",label:"Data source",labelWidth:26,children:(0,o.jsx)(c.DataSourcePicker,{inputId:"trace-to-profiles-data-source-picker",filter:e=>b.includes(e.type),current:null===(s=e.jsonData.tracesToProfiles)||void 0===s?void 0:s.datasourceUid,noDefault:!0,width:40,onChange:n=>{(0,i.updateDatasourcePluginJsonDataOption)({onOptionsChange:t,options:e},"tracesToProfiles",T(P({},e.jsonData.tracesToProfiles),{datasourceUid:n.uid}))},onClear:()=>{(0,i.updateDatasourcePluginJsonDataOption)({onOptionsChange:t,options:e},"tracesToProfiles",T(P({},e.jsonData.tracesToProfiles),{datasourceUid:void 0}))}})})}),(0,o.jsx)(u.InlineFieldRow,{children:(0,o.jsx)(u.InlineField,{tooltip:"Tags that will be used in the query. Default tags: 'service.name', 'service.namespace'",label:"Tags",labelWidth:26,children:(0,o.jsx)(d.l,{values:null!==(S=null===(l=e.jsonData.tracesToProfiles)||void 0===l?void 0:l.tags)&&void 0!==S?S:[],onChange:n=>{(0,i.updateDatasourcePluginJsonDataOption)({onOptionsChange:t,options:e},"tracesToProfiles",T(P({},e.jsonData.tracesToProfiles),{tags:n}))}})})}),(0,o.jsx)(u.InlineFieldRow,{children:(0,o.jsx)(u.InlineField,{tooltip:"Profile type that will be used in the query",label:"Profile type",labelWidth:26,children:(0,o.jsx)(m,{profileTypes:j,placeholder:w,initialProfileTypeId:null===(p=e.jsonData.tracesToProfiles)||void 0===p?void 0:p.profileTypeId,onChange:n=>{(0,i.updateDatasourcePluginJsonDataOption)({onOptionsChange:t,options:e},"tracesToProfiles",T(P({},e.jsonData.tracesToProfiles),{profileTypeId:n}))},width:40})})}),(0,o.jsx)(u.InlineFieldRow,{children:(0,o.jsx)(u.InlineField,{tooltip:"Use a custom query with the possibility to interpolate variables from the trace or span",label:"Use custom query",labelWidth:26,children:(0,o.jsx)(u.InlineSwitch,{id:"profilesCustomQuerySwitch",value:null===(h=e.jsonData.tracesToProfiles)||void 0===h?void 0:h.customQuery,onChange:n=>(0,i.updateDatasourcePluginJsonDataOption)({onOptionsChange:t,options:e},"tracesToProfiles",T(P({},e.jsonData.tracesToProfiles),{customQuery:n.currentTarget.checked}))})})}),(null===(g=e.jsonData.tracesToProfiles)||void 0===g?void 0:g.customQuery)&&(0,o.jsx)(u.InlineField,{label:"Query",labelWidth:26,tooltip:"The query that will run when navigating from a trace to profiles data source. Interpolate tags using the `$__tags` keyword",grow:!0,children:(0,o.jsx)(u.Input,{label:"Query",type:"text",allowFullScreen:!0,value:(null===(f=e.jsonData.tracesToProfiles)||void 0===f?void 0:f.query)||"",onChange:n=>(0,i.updateDatasourcePluginJsonDataOption)({onOptionsChange:t,options:e},"tracesToProfiles",T(P({},e.jsonData.tracesToProfiles),{query:n.currentTarget.value}))})})]})}const S=({options:e,onOptionsChange:t})=>(0,o.jsx)(s.A,{title:"Trace to profiles",description:(0,o.jsx)(l.H,{description:"Navigate from a trace span to the selected data source's profiles.",suffix:`${e.type}/configure-tempo-data-source/#trace-to-profiles`,feature:"trace to profiles"}),isCollapsible:!0,isInitiallyOpen:!0,children:(0,o.jsx)(C,{options:e,onOptionsChange:t})});var I=n(838);function k(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function F(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}function M({options:e,onOptionsChange:t}){var n;const r=(0,u.useStyles2)(E);return(0,o.jsx)("div",{className:r.container,children:(0,o.jsx)(u.InlineFieldRow,{className:r.row,children:(0,o.jsx)(u.InlineField,{tooltip:"Displays the node graph above the trace view. Default: disabled",label:"Enable node graph",labelWidth:26,children:(0,o.jsx)(u.InlineSwitch,{id:"enableNodeGraph",value:null===(n=e.jsonData.nodeGraph)||void 0===n?void 0:n.enabled,onChange:n=>(0,i.updateDatasourcePluginJsonDataOption)({onOptionsChange:t,options:e},"nodeGraph",F(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},o=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(o=o.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),o.forEach((function(t){k(e,t,n[t])}))}return e}({},e.jsonData.nodeGraph),{enabled:n.currentTarget.checked}))})})})})}const q=({options:e,onOptionsChange:t})=>{let n=e.type;return n+="tempo"===e.type?"/configure-tempo-data-source/#node-graph":"/#node-graph",(0,o.jsx)(I.I,{title:"Node graph",description:(0,o.jsx)(l.H,{description:"Show or hide the node graph visualization.",suffix:n,feature:"the node graph"}),children:(0,o.jsx)(M,{options:e,onOptionsChange:t})})},E=e=>({infoText:(0,r.css)({label:"infoText",paddingBottom:e.spacing(2),color:e.colors.text.secondary}),container:(0,r.css)({label:"container",width:"100%"}),row:(0,r.css)({label:"row",alignItems:"baseline"})});function J(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function N(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},o=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(o=o.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),o.forEach((function(t){J(e,t,n[t])}))}return e}function R(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}const W="None",U="Duration",A="Tag";function B({options:e,onOptionsChange:t}){var n,a,s;const l=(0,u.useStyles2)(H),c=[W,U,A].map(i.toOption);return(0,o.jsxs)("div",{className:(0,r.css)({width:"100%"}),children:[(0,o.jsx)(u.InlineFieldRow,{className:l.row,children:(0,o.jsx)(u.InlineField,{label:"Label",labelWidth:26,tooltip:"Default: duration",grow:!0,children:(0,o.jsx)(u.Select,{inputId:"label",options:c,value:(null===(n=e.jsonData.spanBar)||void 0===n?void 0:n.type)||"",onChange:n=>{var o;(0,i.updateDatasourcePluginJsonDataOption)({onOptionsChange:t,options:e},"spanBar",R(N({},e.jsonData.spanBar),{type:null!==(o=null==n?void 0:n.value)&&void 0!==o?o:""}))},placeholder:"Duration",isClearable:!0,"aria-label":"select-label-name",width:40})})}),(null===(a=e.jsonData.spanBar)||void 0===a?void 0:a.type)===A&&(0,o.jsx)(u.InlineFieldRow,{className:l.row,children:(0,o.jsx)(u.InlineField,{label:"Tag key",labelWidth:26,tooltip:"Tag key which will be used to get the tag value. A span's attributes and resources will be searched for the tag key",children:(0,o.jsx)(u.Input,{type:"text",placeholder:"Enter tag key",onChange:n=>(0,i.updateDatasourcePluginJsonDataOption)({onOptionsChange:t,options:e},"spanBar",R(N({},e.jsonData.spanBar),{tag:n.currentTarget.value})),value:(null===(s=e.jsonData.spanBar)||void 0===s?void 0:s.tag)||"",width:40})})})]})}const L=({options:e,onOptionsChange:t})=>{let n=e.type;return n+="tempo"===e.type?"/configure-tempo-data-source/#span-bar":"/#span-bar",(0,o.jsx)(I.I,{title:"Span bar",description:(0,o.jsx)(l.H,{description:"Add additional info next to the service and operation on a span bar row in the trace view.",suffix:n,feature:"the span bar"}),children:(0,o.jsx)(B,{options:e,onOptionsChange:t})})},H=e=>({infoText:(0,r.css)({label:"infoText",paddingBottom:e.spacing(2),color:e.colors.text.secondary}),row:(0,r.css)({label:"row",alignItems:"baseline"})});var Q=n(4305),$=n(1535),_=n(3260),G=n(8455),X=n(1080),V=n(204);function z(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function K(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}function Y({options:e,onOptionsChange:t}){var n,r,a;const s=(0,u.useStyles2)(V.$),l=(0,o.jsxs)(o.Fragment,{children:["Select which type of histograms are configured in the ",(0,o.jsx)(u.TextLink,{href:"https://grafana.com/docs/tempo/latest/setup-and-configuration/metrics-generator/",external:!0,children:"Tempo metrics generator"}),". If native histograms are configured, you must also configure native histograms ingestion in ",(0,o.jsx)(u.TextLink,{href:"https://prometheus.io/docs/specs/native_histograms/#native-histograms",external:!0,children:"Prometheus"})," or"," ",(0,o.jsx)(u.TextLink,{href:"https://grafana.com/docs/mimir/latest/configure/configure-native-histograms-ingestion/#configure-native-histograms-globally",external:!0,children:"Mimir"}),"."]});return(0,o.jsxs)("div",{className:s.container,children:[(0,o.jsxs)(u.InlineFieldRow,{className:s.row,children:[(0,o.jsx)(u.InlineField,{tooltip:"The Prometheus data source with the service graph data",label:"Data source",labelWidth:26,children:(0,o.jsx)(c.DataSourcePicker,{inputId:"service-graph-data-source-picker",pluginId:"prometheus",current:null===(n=e.jsonData.serviceMap)||void 0===n?void 0:n.datasourceUid,noDefault:!0,width:40,onChange:n=>(0,i.updateDatasourcePluginJsonDataOption)({onOptionsChange:t,options:e},"serviceMap",{datasourceUid:n.uid})})}),(null===(r=e.jsonData.serviceMap)||void 0===r?void 0:r.datasourceUid)?(0,o.jsx)(u.Button,{type:"button",variant:"secondary",size:"sm",fill:"text",onClick:()=>{(0,i.updateDatasourcePluginJsonDataOption)({onOptionsChange:t,options:e},"serviceMap",{datasourceUid:void 0})},children:"Clear"}):null]}),(0,o.jsx)(u.InlineFieldRow,{className:s.row,children:(0,o.jsx)(u.InlineField,{tooltip:l,label:"Histogram type",labelWidth:26,interactive:!0,children:(0,o.jsx)(u.Combobox,{id:"histogram-type-select",value:(null===(a=e.jsonData.serviceMap)||void 0===a?void 0:a.histogramType)||"classic",width:40,options:[{label:"Classic",value:"classic"},{label:"Native",value:"native"},{label:"Both",value:"both"}],onChange:n=>(0,i.updateDatasourcePluginJsonDataOption)({onOptionsChange:t,options:e},"serviceMap",K(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},o=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(o=o.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),o.forEach((function(t){z(e,t,n[t])}))}return e}({},e.jsonData.serviceMap),{histogramType:n.value}))})})})]})}var Z=n(9638);function ee(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function te(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},o=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(o=o.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),o.forEach((function(t){ee(e,t,n[t])}))}return e}function ne(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}const oe=({options:e,onOptionsChange:t})=>{var n,r;return(0,o.jsxs)(s.A,{title:"Streaming",isCollapsible:!1,description:(0,o.jsxs)(u.Stack,{gap:.5,children:[(0,o.jsx)("div",{children:"Enable streaming for different Tempo features."}),(0,o.jsx)(u.TextLink,{external:!0,href:"https://grafana.com/docs/tempo/latest/traceql/#stream-query-results",children:"Learn more"})]}),children:[(0,o.jsx)(u.Alert,{severity:"info",title:"Streaming and self-managed Tempo instances",children:"If your Tempo instance is behind a load balancer or proxy that does not supporting gRPC or HTTP2, streaming will probably not work and should be disabled."}),(0,o.jsx)(u.InlineFieldRow,{children:(0,o.jsx)(u.InlineField,{tooltip:`Enable streaming for search queries. Minimum required version for Tempo: ${Z.yJ[Z.SD.searchStreaming]}.`,label:"Search queries",labelWidth:26,children:(0,o.jsx)(u.InlineSwitch,{id:"streamingEnabled.search",value:(null===(n=e.jsonData.streamingEnabled)||void 0===n?void 0:n.search)||!1,onChange:n=>{(0,i.updateDatasourcePluginJsonDataOption)({onOptionsChange:t,options:e},"streamingEnabled",ne(te({},e.jsonData.streamingEnabled),{search:n.currentTarget.checked}))}})})}),(0,o.jsx)(u.InlineFieldRow,{children:(0,o.jsx)(u.InlineField,{tooltip:`Enable streaming for metrics queries. Minimum required version for Tempo: ${Z.yJ[Z.SD.metricsStreaming]}.`,label:"Metrics queries",labelWidth:26,children:(0,o.jsx)(u.InlineSwitch,{id:"streamingEnabled.metrics",value:(null===(r=e.jsonData.streamingEnabled)||void 0===r?void 0:r.metrics)||!1,onChange:n=>{(0,i.updateDatasourcePluginJsonDataOption)({onOptionsChange:t,options:e},"streamingEnabled",ne(te({},e.jsonData.streamingEnabled),{metrics:n.currentTarget.checked}))}})})})]})};function re({options:e,onOptionsChange:t}){const n=(0,u.useStyles2)(ie);return(0,o.jsx)("div",{className:(0,r.css)({width:"100%"}),children:(0,o.jsx)(u.InlineFieldRow,{className:n.row,children:(0,o.jsx)(u.InlineField,{label:"Max tags and tag values",labelWidth:26,tooltip:"Specify the max number of tags and tag values to display in the Tempo editor. Default: 5000",children:(0,o.jsx)(u.Input,{type:"number",placeholder:"5000",onChange:n=>(0,i.updateDatasourcePluginJsonDataOption)({onOptionsChange:t,options:e},"tagLimit",n.currentTarget.value),value:e.jsonData.tagLimit||"",width:40})})})})}const ae=({options:e,onOptionsChange:t})=>(0,o.jsx)(I.I,{title:"Tag limit",description:(0,o.jsx)(l.H,{description:"Specify the limit for tags and tag values.",suffix:"tempo/configure-tempo-data-source/#tag-limit",feature:"the tag limit"}),children:(0,o.jsx)(re,{options:e,onOptionsChange:t})}),ie=e=>({infoText:(0,r.css)({label:"infoText",paddingBottom:e.spacing(2),color:e.colors.text.secondary}),row:(0,r.css)({label:"row",alignItems:"baseline"})});var se=n(9607),le=n(1777),ce=n(5876),ue=n(9183),pe=n(3292),de=n(5645);function he(e,t,n,o,r,a,i){try{var s=e[a](i),l=s.value}catch(e){return void n(e)}s.done?t(l):Promise.resolve(l).then(o,r)}function ge(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function fe(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},o=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(o=o.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),o.forEach((function(t){ge(e,t,n[t])}))}return e}function be(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}function je({options:e,onOptionsChange:t,datasource:n}){var r,a,s;const{error:l,loading:c}=(0,le.A)((()=>{return(e=function*(){if(!n)throw new Error("Unable to retrieve datasource");try{yield n.languageProvider.start()}catch(e){throw new Error((0,de.u1)(e.data.message,"Unable to query Tempo"))}},function(){var t=this,n=arguments;return new Promise((function(o,r){var a=e.apply(t,n);function i(e){he(a,o,r,i,s,"next",e)}function s(e){he(a,o,r,i,s,"throw",e)}i(void 0)}))})();var e}),[n,e]),p=(0,O.useCallback)((n=>{var o;let r=null===(o=e.jsonData.search)||void 0===o?void 0:o.filters;r||(r=[]);const a=r.findIndex((e=>e.id===n.id));a>=0?r=(0,ue._D)(r,a,n):r.push(n),(0,i.updateDatasourcePluginJsonDataOption)({onOptionsChange:t,options:e},"search",be(fe({},e.jsonData.search),{filters:r}))}),[t,e]);(0,O.useEffect)((()=>{var n;(null===(n=e.jsonData.search)||void 0===n?void 0:n.filters)||(0,i.updateDatasourcePluginJsonDataOption)({onOptionsChange:t,options:e},"search",be(fe({},e.jsonData.search),{filters:[{id:"service-name",tag:"service.name",operator:"=",scope:pe.d.Resource},{id:"span-name",tag:"name",operator:"=",scope:pe.d.Span}]}))}),[t,e]);const d=null===(a=e.jsonData.search)||void 0===a||null===(r=a.filters)||void 0===r?void 0:r.find((e=>!e.tag));return(0,o.jsxs)(o.Fragment,{children:[n?(0,o.jsx)(ce.A,{updateFilter:p,deleteFilter:n=>{var o,r;(0,i.updateDatasourcePluginJsonDataOption)({onOptionsChange:t,options:e},"search",be(fe({},e.jsonData.search),{filters:null===(r=e.jsonData.search)||void 0===r||null===(o=r.filters)||void 0===o?void 0:o.filter((e=>e.id!==n.id))}))},filters:(null===(s=e.jsonData.search)||void 0===s?void 0:s.filters)||[],datasource:n,setError:()=>{},staticTags:["duration"],isTagsLoading:c,hideValues:!0,generateQueryWithoutFilter:()=>"{}"}):(0,o.jsx)("div",{children:"Invalid data source, please create a valid data source and try again"}),l&&(0,o.jsx)(u.Alert,{title:"Unable to fetch TraceQL tags",severity:"error",topSpacing:1,children:l.message}),d&&(0,o.jsx)(u.Alert,{title:"Please ensure each filter has a selected tag",severity:"warning",topSpacing:1})]})}function ve(e,t,n,o,r,a,i){try{var s=e[a](i),l=s.value}catch(e){return void n(e)}s.done?t(l):Promise.resolve(l).then(o,r)}function Oe(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function ye(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}function me({options:e,onOptionsChange:t}){var n;const r=(0,u.useStyles2)(V.$),a=(0,c.getDataSourceSrv)(),{value:s}=(0,le.A)((()=>{return(t=function*(){return yield a.get({type:e.type,uid:e.uid})},function(){var e=this,n=arguments;return new Promise((function(o,r){var a=t.apply(e,n);function i(e){ve(a,o,r,i,s,"next",e)}function s(e){ve(a,o,r,i,s,"throw",e)}i(void 0)}))})();var t}),[a,e]);return(0,o.jsxs)("div",{className:r.container,children:[(0,o.jsx)(u.InlineFieldRow,{className:r.row,children:(0,o.jsx)(u.InlineField,{tooltip:"Removes the search tab from the query editor",label:"Hide search",labelWidth:26,children:(0,o.jsx)(u.InlineSwitch,{id:"hideSearch",value:null===(n=e.jsonData.search)||void 0===n?void 0:n.hide,onChange:n=>(0,i.updateDatasourcePluginJsonDataOption)({onOptionsChange:t,options:e},"search",ye(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},o=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(o=o.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),o.forEach((function(t){Oe(e,t,n[t])}))}return e}({},e.jsonData.search),{hide:n.currentTarget.checked}))})})}),(0,o.jsx)(u.InlineFieldRow,{className:r.row,children:(0,o.jsx)(u.InlineField,{tooltip:"Configures which fields are available in the UI",label:"Static filters",labelWidth:26,children:(0,o.jsx)(je,{datasource:s,options:e,onOptionsChange:t})})})]})}function we(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function De(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},o=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(o=o.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),o.forEach((function(t){we(e,t,n[t])}))}return e}const xe=e=>({container:(0,r.css)({marginBottom:e.spacing(2),maxWidth:"900px"})}),Pe=({options:e,onOptionsChange:t})=>{const n=(0,u.useStyles2)(xe);return(0,o.jsxs)("div",{className:n.container,children:[(0,o.jsx)(Q.I,{dataSourceName:"Tempo",docsLink:"https://grafana.com/docs/grafana/latest/datasources/tempo",hasRequiredFields:!1}),(0,o.jsx)(u.Divider,{spacing:4}),(0,o.jsx)($.u,{config:e,onChange:t,urlPlaceholder:"http://localhost:3200"}),(0,o.jsx)(u.Divider,{spacing:4}),(0,o.jsx)(_.N,De({},(0,G.pe)({config:e,onChange:t}))),(0,o.jsx)(u.Divider,{spacing:4}),(0,o.jsx)(oe,{options:e,onOptionsChange:t}),(0,o.jsx)(u.Divider,{spacing:4}),(0,o.jsx)(a.T0,{options:e,onOptionsChange:t}),(0,o.jsx)(u.Divider,{spacing:4}),(0,o.jsx)(j,{options:e,onOptionsChange:t}),(0,o.jsx)(u.Divider,{spacing:4}),(0,o.jsx)(S,{options:e,onOptionsChange:t}),(0,o.jsx)(u.Divider,{spacing:4}),(0,o.jsx)(s.A,{title:"Additional settings",description:"Additional settings are optional settings that can be configured for more control over your data source.",isCollapsible:!0,isInitiallyOpen:!1,children:(0,o.jsxs)(u.Stack,{gap:5,direction:"column",children:[(0,o.jsx)(X.g,{config:e,onChange:t}),c.config.secureSocksDSProxyEnabled&&(0,o.jsx)(u.SecureSocksProxySettings,{options:e,onOptionsChange:t}),(0,o.jsx)(I.I,{title:"Service graph",description:(0,o.jsx)(l.H,{description:"Select a Prometheus data source that contains the service graph data.",suffix:"tempo/configure-tempo-data-source/#service-graph",feature:"the service graph"}),children:(0,o.jsx)(Y,{options:e,onOptionsChange:t})}),(0,o.jsx)(q,{options:e,onOptionsChange:t}),(0,o.jsx)(I.I,{title:"Tempo search",description:(0,o.jsx)(l.H,{description:"Modify how traces are searched.",suffix:"tempo/configure-tempo-data-source/#tempo-search",feature:"Tempo search"}),children:(0,o.jsx)(me,{options:e,onOptionsChange:t})}),(0,o.jsx)(I.I,{title:"TraceID query",description:(0,o.jsx)(l.H,{description:"Modify how TraceID queries are run.",suffix:"tempo/configure-tempo-data-source/#traceid-query",feature:"the TraceID query"}),children:(0,o.jsx)(V.E,{options:e,onOptionsChange:t})}),(0,o.jsx)(I.I,{title:"Tags time range",description:(0,o.jsx)(l.H,{description:"Modify how tags and tag values queries are run.",suffix:"tempo/configure-tempo-data-source/#tags-time-range",feature:"the tags time range"}),children:(0,o.jsx)(se.b,{options:e,onOptionsChange:t})}),(0,o.jsx)(ae,{options:e,onOptionsChange:t}),(0,o.jsx)(L,{options:e,onOptionsChange:t})]})})]})}}}]);
//# sourceMappingURL=6082.js.map