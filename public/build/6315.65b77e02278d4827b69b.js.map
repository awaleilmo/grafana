{"version":3,"file":"6315.65b77e02278d4827b69b.js","mappings":"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","sources":["webpack://grafana/./public/app/features/alerting/unified/utils/receiver-form.ts","webpack://grafana/./public/app/features/alerting/unified/components/receivers/form/fields/KeyValueMapInput.tsx","webpack://grafana/./public/app/features/alerting/unified/components/receivers/form/fields/StringArrayInput.tsx","webpack://grafana/./public/app/features/alerting/unified/components/receivers/form/fields/styles.ts","webpack://grafana/./public/app/features/alerting/unified/components/receivers/form/fields/SubformArrayField.tsx","webpack://grafana/./public/app/features/alerting/unified/components/receivers/form/fields/SubformField.tsx","webpack://grafana/./public/app/features/alerting/unified/components/receivers/form/fields/TemplateContentAndPreview.tsx","webpack://grafana/./public/app/features/alerting/unified/components/receivers/form/fields/TemplateSelector.tsx","webpack://grafana/./public/app/features/alerting/unified/components/receivers/form/fields/OptionField.tsx","webpack://grafana/./public/app/core/hooks/useCleanup.ts","webpack://grafana/./public/app/features/alerting/unified/hooks/useControlledFieldArray.ts","webpack://grafana/./public/app/features/alerting/unified/components/receivers/form/CollapsibleSection.tsx"],"sourcesContent":["import { has, isArray, isNil, omitBy, pickBy } from 'lodash';\n\nimport {\n  CloudNotifierType,\n  NotificationChannelOption,\n  NotifierDTO,\n  NotifierType,\n} from 'app/features/alerting/unified/types/alerting';\nimport {\n  AlertmanagerReceiver,\n  GrafanaManagedContactPoint,\n  GrafanaManagedReceiverConfig,\n  GrafanaManagedReceiverSecureFields,\n  Receiver,\n} from 'app/plugins/datasource/alertmanager/types';\n\nimport {\n  ChannelValues,\n  CloudChannelConfig,\n  CloudChannelMap,\n  CloudChannelValues,\n  GrafanaChannelMap,\n  GrafanaChannelValues,\n  ReceiverFormValues,\n} from '../types/receiver-form';\n\nexport function grafanaReceiverToFormValues(\n  receiver: GrafanaManagedContactPoint\n): [ReceiverFormValues<GrafanaChannelValues>, GrafanaChannelMap] {\n  const channelMap: GrafanaChannelMap = {};\n  // giving each form receiver item a unique id so we can use it to map back to \"original\" items\n  // as well as to use as `key` prop.\n  // @TODO use uid once backend is fixed to provide it. then we can get rid of the GrafanaChannelMap\n  let idCounter = 1;\n  const values = {\n    name: receiver.name,\n    items:\n      receiver.grafana_managed_receiver_configs?.map((channel) => {\n        const id = String(idCounter++);\n        channelMap[id] = channel;\n        return grafanaChannelConfigToFormChannelValues(id, channel);\n      }) ?? [],\n  };\n  return [values, channelMap];\n}\n\nexport function cloudReceiverToFormValues(\n  receiver: Receiver,\n  notifiers: NotifierDTO[]\n): [ReceiverFormValues<CloudChannelValues>, CloudChannelMap] {\n  const channelMap: CloudChannelMap = {};\n  // giving each form receiver item a unique id so we can use it to map back to \"original\" items\n  let idCounter = 1;\n  const items: CloudChannelValues[] = Object.entries(receiver)\n    // filter out only config items that are relevant to cloud\n    .filter(([type]) => type.endsWith('_configs') && type !== 'grafana_managed_receiver_configs')\n    // map property names to cloud notifier types by removing the `_config` suffix\n    .map(([type, configs]): [CloudNotifierType, CloudChannelConfig[]] => [\n      type.replace('_configs', '') as CloudNotifierType,\n      configs,\n    ])\n    // convert channel configs to form values\n    .map(([type, configs]) =>\n      configs.map((config) => {\n        const id = String(idCounter++);\n        channelMap[id] = { type, config };\n        const notifier = notifiers.find((notifier) => notifier.type === type);\n        if (!notifier) {\n          throw new Error(`unknown cloud notifier: ${type}`);\n        }\n        return cloudChannelConfigToFormChannelValues(id, type, config);\n      })\n    )\n    .flat();\n  const values = {\n    name: receiver.name,\n    items,\n  };\n  return [values, channelMap];\n}\n\nexport function formValuesToGrafanaReceiver(\n  values: ReceiverFormValues<GrafanaChannelValues>,\n  channelMap: GrafanaChannelMap,\n  defaultChannelValues: GrafanaChannelValues\n): GrafanaManagedContactPoint {\n  return {\n    name: values.name,\n    grafana_managed_receiver_configs: (values.items ?? []).map((channelValues) => {\n      const existing: GrafanaManagedReceiverConfig | undefined = channelMap[channelValues.__id];\n\n      return formChannelValuesToGrafanaChannelConfig(channelValues, defaultChannelValues, values.name, existing);\n    }),\n  };\n}\n\nexport function formValuesToCloudReceiver(\n  values: ReceiverFormValues<CloudChannelValues>,\n  defaults: CloudChannelValues\n): AlertmanagerReceiver {\n  const recv: AlertmanagerReceiver = {\n    name: values.name,\n  };\n  values.items.forEach(({ __id, type, settings, sendResolved }) => {\n    const channelWithOmmitedIdentifiers = omitEmptyValues({\n      ...omitTemporaryIdentifiers(settings),\n      send_resolved: sendResolved ?? defaults.sendResolved,\n    });\n\n    const channel =\n      type === 'jira' ? convertJiraFieldToJson(channelWithOmmitedIdentifiers) : channelWithOmmitedIdentifiers;\n\n    if (!(`${type}_configs` in recv)) {\n      recv[`${type}_configs`] = [channel];\n    } else {\n      recv[`${type}_configs`]?.push(channel);\n    }\n  });\n  return recv;\n}\n\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nexport function convertJiraFieldToJson(object: Record<string, any>) {\n  // Only for cloud alert manager. Jira fields option can be a nested object. We need to convert it to JSON.\n\n  const objectCopy = structuredClone(object);\n\n  if (typeof objectCopy.fields === 'object') {\n    for (const [optionName, optionValue] of Object.entries(objectCopy.fields)) {\n      let valueForField;\n      try {\n        // eslint-disable-next-line\n        valueForField = JSON.parse(optionValue as string); // is a stringified object\n      } catch {\n        valueForField = optionValue; // is not a stringified object\n      }\n      objectCopy.fields[optionName] = valueForField;\n    }\n  }\n\n  return objectCopy;\n}\n\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nexport function convertJsonToJiraField(object: Record<string, any>) {\n  // Only for cloud alert manager. Convert JSON back to nested Jira fields option.\n\n  const objectCopy = structuredClone(object);\n\n  if (typeof objectCopy.fields === 'object') {\n    for (const [optionName, optionValue] of Object.entries(objectCopy.fields)) {\n      let valueForField;\n      if (typeof optionValue === 'object') {\n        valueForField = JSON.stringify(optionValue);\n      } else {\n        valueForField = optionValue;\n      }\n      objectCopy.fields[optionName] = valueForField;\n    }\n  }\n\n  return objectCopy;\n}\n\nfunction cloudChannelConfigToFormChannelValues(\n  id: string,\n  type: CloudNotifierType,\n  channel: CloudChannelConfig\n): CloudChannelValues {\n  return {\n    __id: id,\n    type,\n    settings: {\n      ...(type === 'jira' ? convertJsonToJiraField(channel) : channel),\n    },\n    secureFields: {},\n    sendResolved: channel.send_resolved,\n  };\n}\n\nfunction grafanaChannelConfigToFormChannelValues(\n  id: string,\n  channel: GrafanaManagedReceiverConfig\n): GrafanaChannelValues {\n  const values: GrafanaChannelValues = {\n    __id: id,\n    type: channel.type as NotifierType,\n    provenance: channel.provenance,\n    settings: { ...channel.settings },\n    secureFields: { ...channel.secureFields },\n    disableResolveMessage: channel.disableResolveMessage,\n  };\n\n  return values;\n}\n\n/**\n * Recursively find all keys that should be marked a secure fields, using JSONpath for nested fields.\n */\nexport function getSecureFieldNames(notifier: NotifierDTO): string[] {\n  // eg. ['foo', 'bar.baz']\n  const secureFieldPaths: string[] = [];\n\n  // we'll pass in the prefix for each iteration so we can track the JSON path\n  function findSecureOptions(options: NotificationChannelOption[], prefix?: string) {\n    for (const option of options) {\n      const key = prefix ? `${prefix}.${option.propertyName}` : option.propertyName;\n\n      // if the field is a subform, recurse\n      if (option.subformOptions) {\n        findSecureOptions(option.subformOptions, key);\n        continue;\n      }\n\n      if (option.secure) {\n        secureFieldPaths.push(key);\n        continue;\n      }\n    }\n  }\n\n  findSecureOptions(notifier.options);\n\n  return secureFieldPaths;\n}\n\nexport function formChannelValuesToGrafanaChannelConfig(\n  values: GrafanaChannelValues,\n  defaults: GrafanaChannelValues,\n  name: string,\n  existing?: GrafanaManagedReceiverConfig\n): GrafanaManagedReceiverConfig {\n  const secureFieldsFromValues = values.secureFields ? omitFalsySecureFields(values.secureFields) : undefined;\n\n  const channel: GrafanaManagedReceiverConfig = {\n    settings: omitEmptyValues({\n      ...(existing && existing.type === values.type ? (existing.settings ?? {}) : {}),\n      ...(values.settings ?? {}),\n    }),\n    secureFields: secureFieldsFromValues,\n    type: values.type,\n    name,\n    disableResolveMessage:\n      values.disableResolveMessage ?? existing?.disableResolveMessage ?? defaults.disableResolveMessage,\n  };\n\n  if (existing) {\n    channel.uid = existing.uid;\n  }\n\n  return channel;\n}\n\n/**\n * Omit falsy values from secure fields object so the backend knows to reset them\n */\nfunction omitFalsySecureFields(secureFields: ChannelValues['secureFields']): GrafanaManagedReceiverSecureFields {\n  return pickBy(secureFields, (value) => value === true);\n}\n\n// null, undefined and '' are deemed unacceptable\nconst isUnacceptableValue = (value: unknown) => isNil(value) || value === '';\n\n// will remove properties that have empty ('', null, undefined) object properties.\n// traverses nested objects and arrays as well. in place, mutates the object.\n// this is needed because form will submit empty string for not filled in fields,\n// but for cloud alertmanager receiver config to use global default value the property must be omitted entirely\n// this isn't a perfect solution though. No way for user to intentionally provide an empty string. Will need rethinking later\nexport function omitEmptyValues<T>(obj: T): T {\n  if (isArray(obj)) {\n    obj.forEach(omitEmptyValues);\n  } else if (typeof obj === 'object' && obj !== null) {\n    Object.entries(obj).forEach(([key, value]) => {\n      if (isUnacceptableValue(value)) {\n        delete (obj as any)[key];\n      } else {\n        omitEmptyValues(value);\n      }\n    });\n  }\n  return obj;\n}\n\n// Will remove empty ('', null, undefined) object properties unless they were previously defined.\n// existing is a map of property names that were previously defined.\nexport function omitEmptyUnlessExisting(settings = {}, existing = {}): Record<string, unknown> {\n  return omitBy(settings, (value, key) => isUnacceptableValue(value) && !has(existing, key));\n}\n\nexport function omitTemporaryIdentifiers<T>(object: Readonly<T>): T {\n  function omitIdentifiers<T>(obj: T) {\n    if (isArray(obj)) {\n      obj.forEach(omitIdentifiers);\n    } else if (typeof obj === 'object' && obj !== null) {\n      if ('__id' in obj) {\n        delete obj.__id;\n      }\n      Object.values(obj).forEach(omitIdentifiers);\n    }\n  }\n\n  const objectCopy = structuredClone(object);\n  omitIdentifiers(objectCopy);\n\n  return objectCopy;\n}\n","import { css } from '@emotion/css';\nimport { useState } from 'react';\n\nimport { GrafanaTheme2 } from '@grafana/data';\nimport { Trans, t } from '@grafana/i18n';\nimport { Button, Input, Stack, useStyles2 } from '@grafana/ui';\n\nimport { ActionIcon } from '../../../rules/ActionIcon';\n\ninterface Props {\n  value?: Record<string, string>;\n  readOnly?: boolean;\n  onChange: (value: Record<string, string>) => void;\n}\n\nexport const KeyValueMapInput = ({ value, onChange, readOnly = false }: Props) => {\n  const styles = useStyles2(getStyles);\n  const [pairs, setPairs] = useState(recordToPairs(value));\n  const [currentNewPair, setCurrentNewPair] = useState<[string, string] | undefined>(undefined);\n\n  const emitChange = (pairs: Array<[string, string]>) => {\n    onChange(pairsToRecord(pairs));\n  };\n\n  const deleteItem = (index: number) => {\n    const newPairs = pairs.slice();\n    const removed = newPairs.splice(index, 1)[0];\n    setPairs(newPairs);\n    if (removed[0]) {\n      emitChange(newPairs);\n    }\n  };\n\n  return (\n    <div>\n      {!!pairs.length && (\n        <table className={styles.table}>\n          <thead>\n            <tr>\n              <th>\n                <Trans i18nKey=\"alerting.key-value-map-input.name\">Name</Trans>\n              </th>\n              <th>\n                <Trans i18nKey=\"alerting.key-value-map-input.value\">Value</Trans>\n              </th>\n              {!readOnly && <th />}\n            </tr>\n          </thead>\n          <tbody>\n            {pairs.map(([key, value], index) => (\n              <tr key={index}>\n                <td>\n                  <Input readOnly={readOnly} value={key} disabled />\n                </td>\n                <td>\n                  <Input readOnly={readOnly} value={value} disabled />\n                </td>\n                {!readOnly && (\n                  <td>\n                    <ActionIcon\n                      icon=\"trash-alt\"\n                      tooltip={t('alerting.common.delete', 'Delete')}\n                      onClick={() => deleteItem(index)}\n                    />\n                  </td>\n                )}\n              </tr>\n            ))}\n          </tbody>\n        </table>\n      )}\n      {currentNewPair && (\n        <table className={styles.table}>\n          <tr>\n            <Stack gap={1}>\n              <td>\n                <Input\n                  value={currentNewPair[0]}\n                  onChange={(e) => setCurrentNewPair([e.currentTarget.value, currentNewPair[1]])}\n                />\n              </td>\n              <td>\n                <Input\n                  value={currentNewPair[1]}\n                  onChange={(e) => setCurrentNewPair([currentNewPair[0], e.currentTarget.value])}\n                />\n              </td>\n              <td>\n                <Stack gap={1}>\n                  <ActionIcon\n                    icon=\"check\"\n                    tooltip={t('alerting.contact-points.key-value-map.confirm-add', 'Confirm to add')}\n                    onClick={() => {\n                      setPairs([...pairs, currentNewPair]);\n                      setCurrentNewPair(undefined);\n                      emitChange([...pairs, currentNewPair]);\n                    }}\n                  />\n                  <ActionIcon\n                    icon=\"times\"\n                    tooltip={t('alerting.common.cancel', 'Cancel')}\n                    onClick={() => setCurrentNewPair(undefined)}\n                  />\n                </Stack>\n              </td>\n            </Stack>\n          </tr>\n        </table>\n      )}\n      {!readOnly && (\n        <Button\n          className={styles.addButton}\n          type=\"button\"\n          variant=\"secondary\"\n          icon=\"plus\"\n          size=\"sm\"\n          disabled={!!currentNewPair}\n          onClick={() => setCurrentNewPair(['', ''])}\n        >\n          <Trans i18nKey=\"alerting.contact-points.key-value-map.add\">Add</Trans>\n        </Button>\n      )}\n    </div>\n  );\n};\n\nconst getStyles = (theme: GrafanaTheme2) => ({\n  addButton: css({\n    marginTop: theme.spacing(1),\n  }),\n  table: css({\n    'tbody td': {\n      padding: `0 ${theme.spacing(1)} ${theme.spacing(1)} 0`,\n    },\n  }),\n});\n\nconst pairsToRecord = (pairs: Array<[string, string]>): Record<string, string> => {\n  const record: Record<string, string> = {};\n  for (const [key, value] of pairs) {\n    if (key) {\n      record[key] = value;\n    }\n  }\n  return record;\n};\n\nconst recordToPairs = (obj?: Record<string, string>): Array<[string, string]> => Object.entries(obj ?? {});\n","import { css } from '@emotion/css';\n\nimport { GrafanaTheme2 } from '@grafana/data';\nimport { Trans, t } from '@grafana/i18n';\nimport { Button, Input, useStyles2 } from '@grafana/ui';\n\nimport { ActionIcon } from '../../../rules/ActionIcon';\n\ninterface Props {\n  value?: string[];\n  readOnly?: boolean;\n  onChange: (value: string[]) => void;\n}\n\nexport const StringArrayInput = ({ value, onChange, readOnly = false }: Props) => {\n  const styles = useStyles2(getStyles);\n\n  const deleteItem = (index: number) => {\n    if (!value) {\n      return;\n    }\n    const newValue = value.slice();\n    newValue.splice(index, 1);\n    onChange(newValue);\n  };\n\n  const updateValue = (itemValue: string, index: number) => {\n    if (!value) {\n      return;\n    }\n    onChange(value.map((v, i) => (i === index ? itemValue : v)));\n  };\n\n  return (\n    <div>\n      {!!value?.length &&\n        value.map((v, index) => (\n          <div key={index} className={styles.row}>\n            <Input readOnly={readOnly} value={v} onChange={(e) => updateValue(e.currentTarget.value, index)} />\n            {!readOnly && (\n              <ActionIcon\n                className={styles.deleteIcon}\n                icon=\"trash-alt\"\n                tooltip={t('alerting.string-array-input.tooltip-delete', 'delete')}\n                onClick={() => deleteItem(index)}\n              />\n            )}\n          </div>\n        ))}\n      {!readOnly && (\n        <Button\n          className={styles.addButton}\n          type=\"button\"\n          variant=\"secondary\"\n          icon=\"plus\"\n          size=\"sm\"\n          onClick={() => onChange([...(value ?? []), ''])}\n        >\n          <Trans i18nKey=\"alerting.string-array-input.add\">Add</Trans>\n        </Button>\n      )}\n    </div>\n  );\n};\n\nconst getStyles = (theme: GrafanaTheme2) => ({\n  row: css({\n    display: 'flex',\n    flexDirection: 'row',\n    marginBottom: theme.spacing(1),\n    alignItems: 'center',\n  }),\n  deleteIcon: css({\n    marginLeft: theme.spacing(1),\n  }),\n  addButton: css({\n    marginTop: theme.spacing(1),\n  }),\n});\n","import { css } from '@emotion/css';\n\nimport { GrafanaTheme2 } from '@grafana/data';\n\nexport const getReceiverFormFieldStyles = (theme: GrafanaTheme2) => ({\n  collapsibleSection: css({\n    margin: 0,\n    padding: 0,\n  }),\n  wrapper: css({\n    margin: theme.spacing(2, 0),\n    padding: theme.spacing(1),\n    border: `solid 1px ${theme.colors.border.medium}`,\n    borderRadius: theme.shape.radius.default,\n    position: 'relative',\n  }),\n  description: css({\n    color: theme.colors.text.secondary,\n    fontSize: theme.typography.size.sm,\n    fontWeight: theme.typography.fontWeightRegular,\n    margin: 0,\n  }),\n  deleteIcon: css({\n    position: 'absolute',\n    right: theme.spacing(1),\n    top: theme.spacing(1),\n  }),\n  addButton: css({\n    marginTop: theme.spacing(1),\n  }),\n});\n","import { DeepMap, FieldError, useFormContext } from 'react-hook-form';\n\nimport { Trans, t } from '@grafana/i18n';\nimport { Button, useStyles2 } from '@grafana/ui';\nimport { useControlledFieldArray } from 'app/features/alerting/unified/hooks/useControlledFieldArray';\nimport {\n  NotificationChannelOption,\n  NotificationChannelSecureFields,\n  OptionMeta,\n} from 'app/features/alerting/unified/types/alerting';\n\nimport { ActionIcon } from '../../../rules/ActionIcon';\nimport { CollapsibleSection } from '../CollapsibleSection';\n\nimport { OptionField } from './OptionField';\nimport { getReceiverFormFieldStyles } from './styles';\n\ninterface Props {\n  defaultValues?: any[];\n  option: NotificationChannelOption;\n  pathPrefix: string;\n  errors?: Array<DeepMap<any, FieldError>>;\n  readOnly?: boolean;\n  secureFields: NotificationChannelSecureFields;\n  getOptionMeta?: (option: NotificationChannelOption) => OptionMeta;\n}\n\nexport const SubformArrayField = ({\n  option,\n  pathPrefix,\n  errors,\n  defaultValues,\n  readOnly = false,\n  secureFields,\n  getOptionMeta,\n}: Props) => {\n  const styles = useStyles2(getReceiverFormFieldStyles);\n  const path = `${pathPrefix}${option.propertyName}`;\n  const formAPI = useFormContext();\n  const { fields, append, remove } = useControlledFieldArray({ name: path, formAPI, defaults: defaultValues });\n\n  return (\n    <div className={styles.wrapper}>\n      <CollapsibleSection\n        className={styles.collapsibleSection}\n        // eslint-disable-next-line @grafana/i18n/no-untranslated-strings\n        label={`${option.label} (${fields.length})`}\n        description={option.description}\n      >\n        {(fields ?? defaultValues ?? []).map((field, itemIndex) => {\n          return (\n            <div key={itemIndex} className={styles.wrapper}>\n              {!readOnly && (\n                <ActionIcon\n                  data-testid={`${path}.${itemIndex}.delete-button`}\n                  icon=\"trash-alt\"\n                  tooltip={t('alerting.subform-array-field.tooltip-delete', 'delete')}\n                  onClick={() => remove(itemIndex)}\n                  className={styles.deleteIcon}\n                />\n              )}\n              {option.subformOptions?.map((option) => (\n                <OptionField\n                  readOnly={readOnly}\n                  getOptionMeta={getOptionMeta}\n                  secureFields={secureFields}\n                  defaultValue={field?.[option.propertyName]}\n                  key={option.propertyName}\n                  option={option}\n                  pathPrefix={`${path}.${itemIndex}.`}\n                  error={errors?.[itemIndex]?.[option.propertyName]}\n                />\n              ))}\n            </div>\n          );\n        })}\n        {!readOnly && (\n          <Button\n            data-testid={`${path}.add-button`}\n            className={styles.addButton}\n            type=\"button\"\n            variant=\"secondary\"\n            icon=\"plus\"\n            size=\"sm\"\n            onClick={() => append({ __id: String(Math.random()) })}\n          >\n            <Trans i18nKey=\"alerting.subform-array-field.add\">Add</Trans>\n          </Button>\n        )}\n      </CollapsibleSection>\n    </div>\n  );\n};\n","import { useState } from 'react';\nimport { DeepMap, FieldError, useFormContext } from 'react-hook-form';\n\nimport { Trans, t } from '@grafana/i18n';\nimport { Button, useStyles2 } from '@grafana/ui';\nimport {\n  NotificationChannelOption,\n  NotificationChannelSecureFields,\n  OptionMeta,\n} from 'app/features/alerting/unified/types/alerting';\n\nimport { ActionIcon } from '../../../rules/ActionIcon';\n\nimport { OptionField } from './OptionField';\nimport { getReceiverFormFieldStyles } from './styles';\n\ninterface Props {\n  defaultValue: any;\n  option: NotificationChannelOption;\n  getOptionMeta?: (option: NotificationChannelOption) => OptionMeta;\n  pathPrefix: string;\n  errors?: DeepMap<any, FieldError>;\n  readOnly?: boolean;\n  secureFields: NotificationChannelSecureFields;\n  /**\n   * Callback function to delete a subform field. Removal requires side effects\n   * like settings and secure fields cleanup.\n   */\n  onDelete?: (settingsPath: string, option: NotificationChannelOption) => void;\n  onResetSecureField?: (propertyName: string) => void;\n}\n\nexport const SubformField = ({\n  option,\n  pathPrefix,\n  errors,\n  defaultValue,\n  getOptionMeta,\n  readOnly = false,\n  secureFields,\n  onDelete,\n  onResetSecureField,\n}: Props) => {\n  const styles = useStyles2(getReceiverFormFieldStyles);\n  const name = `${pathPrefix}${option.propertyName}`;\n  const { watch } = useFormContext();\n  const _watchValue = watch(name);\n  const value = _watchValue === undefined ? defaultValue : _watchValue;\n\n  const [show, setShow] = useState(!!value);\n\n  const onDeleteClick = () => {\n    onDelete?.(name, option);\n    setShow(false);\n  };\n\n  return (\n    <div className={styles.wrapper} data-testid={`${name}.container`}>\n      <h6>{option.label}</h6>\n      {option.description && <p className={styles.description}>{option.description}</p>}\n      {show && (\n        <>\n          {!readOnly && onDelete && (\n            <ActionIcon\n              data-testid={`${name}.delete-button`}\n              icon=\"trash-alt\"\n              tooltip={t('alerting.subform-field.tooltip-delete', 'delete')}\n              onClick={onDeleteClick}\n              className={styles.deleteIcon}\n            />\n          )}\n          {(option.subformOptions ?? []).map((subOption) => {\n            return (\n              <OptionField\n                readOnly={readOnly}\n                getOptionMeta={getOptionMeta}\n                onResetSecureField={onResetSecureField}\n                onDeleteSubform={onDelete}\n                secureFields={secureFields}\n                defaultValue={defaultValue?.[subOption.propertyName]}\n                key={subOption.propertyName}\n                option={subOption}\n                pathPrefix={`${name}.`}\n                error={errors?.[subOption.propertyName]}\n              />\n            );\n          })}\n        </>\n      )}\n      {!show && !readOnly && (\n        <Button\n          className={styles.addButton}\n          type=\"button\"\n          variant=\"secondary\"\n          icon=\"plus\"\n          size=\"sm\"\n          onClick={() => setShow(true)}\n          data-testid={`${name}.add-button`}\n        >\n          <Trans i18nKey=\"alerting.subform-field.add\">Add</Trans>\n        </Button>\n      )}\n    </div>\n  );\n};\n","import { css, cx } from '@emotion/css';\nimport * as React from 'react';\nimport AutoSizer from 'react-virtualized-auto-sizer';\n\nimport { GrafanaTheme2 } from '@grafana/data';\nimport { t } from '@grafana/i18n';\nimport { Box, useStyles2 } from '@grafana/ui';\nimport { useAlertmanager } from 'app/features/alerting/unified/state/AlertmanagerContext';\nimport { GRAFANA_RULES_SOURCE_NAME } from 'app/features/alerting/unified/utils/datasource';\n\nimport { EditorColumnHeader } from '../../../contact-points/templates/EditorColumnHeader';\nimport { TemplateEditor } from '../../TemplateEditor';\nimport { TemplatePreview } from '../../TemplatePreview';\n\nimport { getUseTemplateText } from './utils';\n\nexport function TemplateContentAndPreview({\n  payload,\n  templateContent,\n  templateName,\n  payloadFormatError,\n  setPayloadFormatError,\n  className,\n}: {\n  payload: string;\n  templateName: string;\n  payloadFormatError: string | null;\n  setPayloadFormatError: (value: React.SetStateAction<string | null>) => void;\n  className?: string;\n  templateContent: string;\n}) {\n  const styles = useStyles2(getStyles);\n\n  const { selectedAlertmanager } = useAlertmanager();\n\n  const isGrafanaAlertManager = selectedAlertmanager === GRAFANA_RULES_SOURCE_NAME;\n\n  return (\n    <div className={cx(className, styles.mainContainer)}>\n      <div className={styles.container}>\n        <EditorColumnHeader\n          label={t('alerting.template-content-and-preview.label-template-content', 'Template content')}\n        />\n        <Box flex={1}>\n          <div className={styles.viewerContainer({ height: 400 })}>\n            <AutoSizer>\n              {({ width, height }) => (\n                <TemplateEditor\n                  value={templateContent}\n                  containerStyles={styles.editorContainer}\n                  width={width}\n                  height={height}\n                  readOnly\n                />\n              )}\n            </AutoSizer>\n          </div>\n        </Box>\n      </div>\n\n      {isGrafanaAlertManager && (\n        <TemplatePreview\n          payload={payload}\n          // This should be an empty template name so that the test API treats it as a new unnamed template.\n          templateName={''}\n          templateContent={getUseTemplateText(templateName)}\n          setPayloadFormatError={setPayloadFormatError}\n          payloadFormatError={payloadFormatError}\n          className={cx(styles.templatePreview, styles.minEditorSize)}\n        />\n      )}\n    </div>\n  );\n}\n\nconst getStyles = (theme: GrafanaTheme2) => ({\n  mainContainer: css({\n    display: 'flex',\n    flexDirection: 'column',\n    gap: theme.spacing(2),\n  }),\n  container: css({\n    label: 'template-preview-container',\n    display: 'flex',\n    flexDirection: 'column',\n    borderRadius: theme.shape.radius.default,\n    border: `1px solid ${theme.colors.border.medium}`,\n  }),\n  templatePreview: css({\n    flex: 1,\n    display: 'flex',\n  }),\n  minEditorSize: css({\n    minHeight: 300,\n    minWidth: 300,\n  }),\n  viewerContainer: ({ height }: { height: number | string }) =>\n    css({\n      height,\n      overflow: 'auto',\n      backgroundColor: theme.colors.background.primary,\n    }),\n  editorContainer: css({\n    width: 'fit-content',\n    border: 'none',\n  }),\n});\n","import { css, cx } from '@emotion/css';\nimport { PropsWithChildren, useEffect, useMemo, useState } from 'react';\nimport { useFormContext } from 'react-hook-form';\nimport { useCopyToClipboard } from 'react-use';\n\nimport { GrafanaTheme2, SelectableValue } from '@grafana/data';\nimport { Trans, t } from '@grafana/i18n';\nimport {\n  Button,\n  Drawer,\n  IconButton,\n  Label,\n  RadioButtonGroup,\n  Select,\n  Stack,\n  Text,\n  TextArea,\n  useStyles2,\n} from '@grafana/ui';\nimport {\n  trackEditInputWithTemplate,\n  trackUseCustomInputInTemplate,\n  trackUseSingleTemplateInInput,\n} from 'app/features/alerting/unified/Analytics';\nimport { templatesApi } from 'app/features/alerting/unified/api/templateApi';\nimport {\n  NotificationTemplate,\n  useNotificationTemplates,\n} from 'app/features/alerting/unified/components/contact-points/useNotificationTemplates';\nimport { useAlertmanager } from 'app/features/alerting/unified/state/AlertmanagerContext';\nimport { NotificationChannelOption } from 'app/features/alerting/unified/types/alerting';\n\nimport { defaultPayloadString } from '../../TemplateForm';\n\nimport { TemplateContentAndPreview } from './TemplateContentAndPreview';\nimport { getTemplateName, getUseTemplateText, matchesOnlyOneTemplate, parseTemplates } from './utils';\n\nconst { useGetDefaultTemplatesQuery } = templatesApi;\n\ninterface TemplatesPickerProps {\n  onSelect: (temnplate: string) => void;\n  option: NotificationChannelOption;\n  valueInForm: string;\n}\nexport function TemplatesPicker({ onSelect, option, valueInForm }: TemplatesPickerProps) {\n  const [showTemplates, setShowTemplates] = useState(false);\n\n  const onClick = () => {\n    setShowTemplates(true);\n    trackEditInputWithTemplate();\n  };\n  const handleClose = () => setShowTemplates(false);\n\n  return (\n    <>\n      <Button\n        icon=\"edit\"\n        tooltip={t('alerting.templates-picker.tooltip-edit', 'Edit {{name}} using existing notification templates.', {\n          name: option.label.toLowerCase(),\n        })}\n        onClick={onClick}\n        variant=\"secondary\"\n        size=\"sm\"\n      >\n        <Trans i18nKey=\"alerting.templates-picker.button-edit\" values={{ name: option.label }}>\n          Edit {'{{name}}'}\n        </Trans>\n      </Button>\n\n      {showTemplates && (\n        <Drawer\n          title={t('alerting.templates-picker.title-drawer', 'Edit {{name}}', { name: option.label })}\n          size=\"md\"\n          onClose={handleClose}\n        >\n          <TemplateSelector onSelect={onSelect} onClose={handleClose} option={option} valueInForm={valueInForm} />\n        </Drawer>\n      )}\n    </>\n  );\n}\n\ntype TemplateFieldOption = 'Existing' | 'Custom';\n\nexport function getTemplateOptions(templateFiles: NotificationTemplate[], defaultTemplates: Template[] = []) {\n  // Add default templates\n  const templateMap = new Map<string, SelectableValue<Template>>();\n  templateFiles.forEach(({ content }) => {\n    const templates: Template[] = parseTemplates(content);\n    templates.forEach((template) => {\n      templateMap.set(template.name, {\n        label: template.name,\n        value: {\n          name: template.name,\n          content: template.content,\n        },\n      });\n    });\n  });\n  // Add default templates to the map\n  defaultTemplates.forEach((template) => {\n    templateMap.set(template.name, {\n      label: template.name,\n      value: {\n        name: template.name,\n        content: template.content,\n      },\n    });\n  });\n  // return the sum of default and custom templates\n  return Array.from(templateMap.values());\n}\n\nexport interface Template {\n  name: string;\n  content: string;\n}\ninterface TemplateSelectorProps {\n  onSelect: (template: string) => void;\n  onClose: () => void;\n  option: NotificationChannelOption;\n  valueInForm: string;\n}\n\nfunction TemplateSelector({ onSelect, onClose, option, valueInForm }: TemplateSelectorProps) {\n  const styles = useStyles2(getStyles);\n  const valueInFormIsCustom = Boolean(valueInForm) && !matchesOnlyOneTemplate(valueInForm);\n  const [template, setTemplate] = useState<SelectableValue<Template> | undefined>(undefined);\n  const [customTemplateValue, setCustomTemplateValue] = useState<string>(valueInForm);\n\n  const { selectedAlertmanager } = useAlertmanager();\n  const { data = [], error, isLoading } = useNotificationTemplates({ alertmanager: selectedAlertmanager! });\n  const { data: defaultTemplates } = useGetDefaultTemplatesQuery();\n  const [templateOption, setTemplateOption] = useState<TemplateFieldOption | undefined>(\n    valueInFormIsCustom ? 'Custom' : 'Existing'\n  );\n  const [_, copyToClipboard] = useCopyToClipboard();\n\n  const templateOptions: Array<SelectableValue<TemplateFieldOption>> = [\n    {\n      label: t(\n        'alerting.template-selector.template-options.label.select-notification-template',\n        'Select notification template'\n      ),\n      ariaLabel: t(\n        'alerting.template-selector.template-options.ariaLabel.select-notification-template',\n        'Select notification template'\n      ),\n      value: 'Existing',\n      description: `Select an existing notification template and preview it, or copy it to paste it in the custom tab. ${templateOption === 'Existing' ? 'Clicking Save saves your changes to the selected template.' : ''}`,\n    },\n    {\n      label: `Enter custom ${option.label.toLowerCase()}`,\n      ariaLabel: `Enter custom ${option.label.toLowerCase()}`,\n      value: 'Custom',\n      description: `Enter custom ${option.label.toLowerCase()}. ${templateOption === 'Custom' ? 'Clicking Save will save the custom value only.' : ''}`,\n    },\n  ];\n\n  useEffect(() => {\n    if (template?.value?.name) {\n      setCustomTemplateValue(getUseTemplateText(template.value.name));\n    }\n  }, [template]);\n\n  function onCustomTemplateChange(customInput: string) {\n    setCustomTemplateValue(customInput);\n  }\n\n  const onTemplateOptionChange = (option: TemplateFieldOption) => {\n    setTemplateOption(option);\n  };\n\n  const options = useMemo(() => {\n    if (!defaultTemplates || !data || isLoading || error) {\n      return [];\n    }\n    return getTemplateOptions(data, defaultTemplates);\n  }, [data, defaultTemplates, isLoading, error]);\n\n  const defaultTemplateValue = useMemo(() => {\n    if (!options.length || !Boolean(valueInForm) || !matchesOnlyOneTemplate(valueInForm)) {\n      return null;\n    }\n    const nameOfTemplateInForm = getTemplateName(valueInForm);\n\n    return options.find((option) => option.label === nameOfTemplateInForm) || null;\n  }, [options, valueInForm]);\n\n  if (error) {\n    return (\n      <div>\n        <Trans i18nKey=\"alerting.template-selector.error-loading-templates\">Error loading templates</Trans>\n      </div>\n    );\n  }\n\n  if (isLoading || !data || !defaultTemplates) {\n    return (\n      <div>\n        <Trans i18nKey=\"alerting.template-selector.loading\">Loading...</Trans>\n      </div>\n    );\n  }\n\n  return (\n    <Stack direction=\"column\" gap={1} justifyContent=\"space-between\" height=\"100%\">\n      <Stack direction=\"column\" gap={1}>\n        <RadioButtonGroup\n          options={templateOptions}\n          value={templateOption}\n          onChange={onTemplateOptionChange}\n          className={styles.templateTabOption}\n        />\n\n        {templateOption === 'Existing' ? (\n          <Stack direction=\"column\" gap={1}>\n            <Stack direction=\"row\" gap={1} alignItems=\"center\">\n              <Select<Template>\n                data-testid=\"existing-templates-selector\"\n                placeholder={t(\n                  'alerting.template-selector.existing-templates-selector-placeholder-choose-notification-template',\n                  'Choose notification template'\n                )}\n                aria-label={t(\n                  'alerting.template-selector.existing-templates-selector-aria-label-choose-notification-template',\n                  'Choose notification template'\n                )}\n                onChange={(value: SelectableValue<Template>, _) => {\n                  setTemplate(value);\n                }}\n                options={options}\n                width={50}\n                defaultValue={defaultTemplateValue}\n              />\n              <IconButton\n                tooltip={t(\n                  'alerting.template-selector.tooltip-copy',\n                  'Copy selected notification template to clipboard. You can use it in the custom tab.'\n                )}\n                onClick={() => copyToClipboard(template?.value?.content ?? defaultTemplateValue?.value?.content ?? '')}\n                name=\"copy\"\n              />\n            </Stack>\n\n            <TemplateContentAndPreview\n              templateContent={template?.value?.content ?? defaultTemplateValue?.value?.content ?? ''}\n              payload={defaultPayloadString}\n              templateName={template?.value?.name ?? defaultTemplateValue?.value?.name ?? ''}\n              setPayloadFormatError={() => {}}\n              className={cx(styles.templatePreview, styles.minEditorSize)}\n              payloadFormatError={null}\n            />\n          </Stack>\n        ) : (\n          <OptionCustomfield\n            option={option}\n            onCustomTemplateChange={onCustomTemplateChange}\n            initialValue={customTemplateValue}\n          />\n        )}\n      </Stack>\n      <div className={styles.actions}>\n        <Button variant=\"secondary\" onClick={onClose}>\n          <Trans i18nKey=\"alerting.common.cancel\">Cancel</Trans>\n        </Button>\n        <Button\n          variant=\"primary\"\n          onClick={() => {\n            if (templateOption === 'Custom') {\n              trackUseCustomInputInTemplate();\n              onSelect(customTemplateValue);\n            } else {\n              trackUseSingleTemplateInInput();\n              const name = template?.value?.name ?? defaultTemplateValue?.value?.name ?? '';\n              onSelect(getUseTemplateText(name));\n            }\n            return onClose();\n          }}\n        >\n          <Trans i18nKey=\"common.save\">Save</Trans>\n        </Button>\n      </div>\n    </Stack>\n  );\n}\n\nfunction OptionCustomfield({\n  option,\n  onCustomTemplateChange,\n  initialValue,\n}: {\n  option: NotificationChannelOption;\n  onCustomTemplateChange(customInput: string): void;\n  initialValue: string;\n}) {\n  const id = `custom-template-${option.label}`;\n  return (\n    <Stack direction=\"column\" gap={1}>\n      <Label htmlFor={id}>\n        <Trans i18nKey=\"alerting.contact-points.custom-template-value\">Custom template value</Trans>\n      </Label>\n      <TextArea\n        id={id}\n        label={t('alerting.option-customfield.label-custom-template', 'Custom template')}\n        placeholder={option.placeholder}\n        onChange={(e) => onCustomTemplateChange(e.currentTarget.value)}\n        defaultValue={initialValue}\n      />\n    </Stack>\n  );\n}\n\ninterface WrapWithTemplateSelectionProps extends PropsWithChildren {\n  useTemplates: boolean;\n  onSelectTemplate: (template: string) => void;\n  option: NotificationChannelOption;\n  name: string;\n}\nexport function WrapWithTemplateSelection({\n  useTemplates,\n  onSelectTemplate,\n  option,\n  name,\n  children,\n}: WrapWithTemplateSelectionProps) {\n  const styles = useStyles2(getStyles);\n  const { getValues } = useFormContext();\n  const value = getValues(name) ?? '';\n  // if the placeholder does not contain a template, we don't need to show the template picker\n  if (!option.placeholder.includes('{{ template ') || typeof value !== 'string') {\n    return <>{children}</>;\n  }\n  // Otherwise, we can use templates on this field\n  // if the value is empty, we only show the template picker\n  if (!value) {\n    return (\n      <div className={styles.inputContainer}>\n        <Stack direction=\"row\" gap={1} alignItems=\"center\">\n          {useTemplates && (\n            <TemplatesPicker onSelect={onSelectTemplate} option={option} valueInForm={getValues(name) ?? ''} />\n          )}\n        </Stack>\n      </div>\n    );\n  }\n  const onlyOneTemplate = value ? matchesOnlyOneTemplate(value) : false;\n  if (onlyOneTemplate) {\n    return (\n      <div className={styles.inputContainer}>\n        <Stack direction=\"row\" gap={1} alignItems=\"center\">\n          <Text variant=\"bodySmall\">{`Template: ${getTemplateName(value)}`}</Text>\n          {useTemplates && (\n            <TemplatesPicker onSelect={onSelectTemplate} option={option} valueInForm={getValues(name) ?? ''} />\n          )}\n        </Stack>\n      </div>\n    );\n  }\n  // custom template  field\n  return (\n    <div className={styles.inputContainer}>\n      <Stack direction=\"row\" gap={1} alignItems=\"center\">\n        {children}\n        {useTemplates && (\n          <TemplatesPicker onSelect={onSelectTemplate} option={option} valueInForm={getValues(name) ?? ''} />\n        )}\n      </Stack>\n    </div>\n  );\n}\n\nconst getStyles = (theme: GrafanaTheme2) => ({\n  actions: css({\n    flex: 0,\n    justifyContent: 'flex-end',\n    display: 'flex',\n    gap: theme.spacing(1),\n  }),\n  templatePreview: css({\n    flex: 1,\n    display: 'flex',\n  }),\n  templateTabOption: css({\n    width: 'fit-content',\n  }),\n  minEditorSize: css({\n    minHeight: 300,\n    minWidth: 300,\n  }),\n  inputContainer: css({\n    marginTop: theme.spacing(1.5),\n  }),\n});\n","import { css } from '@emotion/css';\nimport { FC, useEffect } from 'react';\nimport { Controller, DeepMap, FieldError, useFormContext } from 'react-hook-form';\n\nimport { GrafanaTheme2 } from '@grafana/data';\nimport {\n  Checkbox,\n  Field,\n  Input,\n  RadioButtonList,\n  SecretInput,\n  SecretTextArea,\n  Select,\n  TextArea,\n  useStyles2,\n} from '@grafana/ui';\nimport {\n  NotificationChannelOption,\n  NotificationChannelSecureFields,\n  OptionMeta,\n} from 'app/features/alerting/unified/types/alerting';\n\nimport { KeyValueMapInput } from './KeyValueMapInput';\nimport { StringArrayInput } from './StringArrayInput';\nimport { SubformArrayField } from './SubformArrayField';\nimport { SubformField } from './SubformField';\nimport { WrapWithTemplateSelection } from './TemplateSelector';\n\ninterface Props {\n  defaultValue: any;\n  option: NotificationChannelOption;\n  getOptionMeta?: (option: NotificationChannelOption) => OptionMeta;\n  invalid?: boolean;\n  pathPrefix: string;\n  error?: FieldError | DeepMap<any, FieldError>;\n  readOnly?: boolean;\n  customValidator?: (value: string) => boolean | string | Promise<boolean | string>;\n  onResetSecureField?: (propertyName: string) => void;\n  onDeleteSubform?: (settingsPath: string, option: NotificationChannelOption) => void;\n  secureFields: NotificationChannelSecureFields;\n}\n\nexport const OptionField: FC<Props> = ({\n  option,\n  invalid,\n  pathPrefix,\n  error,\n  defaultValue,\n  readOnly = false,\n  customValidator,\n  onResetSecureField,\n  secureFields,\n  onDeleteSubform,\n  getOptionMeta,\n}) => {\n  if (option.element === 'subform') {\n    return (\n      <SubformField\n        secureFields={secureFields}\n        onResetSecureField={onResetSecureField}\n        readOnly={readOnly}\n        defaultValue={defaultValue}\n        option={option}\n        errors={error}\n        pathPrefix={pathPrefix}\n        onDelete={onDeleteSubform}\n      />\n    );\n  }\n  if (option.element === 'subform_array') {\n    return (\n      <SubformArrayField\n        secureFields={secureFields}\n        readOnly={readOnly}\n        defaultValues={defaultValue}\n        option={option}\n        pathPrefix={pathPrefix}\n        errors={error as Array<DeepMap<any, FieldError>> | undefined}\n      />\n    );\n  }\n\n  return (\n    <Field\n      label={option.element !== 'checkbox' && option.element !== 'radio' ? option.label : undefined}\n      description={option.description || undefined}\n      invalid={!!error}\n      error={error?.message}\n      data-testid={`${pathPrefix}${option.propertyName}`}\n    >\n      <OptionInput\n        id={`${pathPrefix}${option.propertyName}`}\n        defaultValue={defaultValue}\n        option={option}\n        invalid={invalid}\n        pathPrefix={pathPrefix}\n        readOnly={readOnly}\n        customValidator={customValidator}\n        onResetSecureField={onResetSecureField}\n        secureFields={secureFields}\n        getOptionMeta={getOptionMeta}\n      />\n    </Field>\n  );\n};\n\nconst OptionInput: FC<Props & { id: string }> = ({\n  option,\n  invalid,\n  id,\n  pathPrefix = '',\n  readOnly = false,\n  customValidator,\n  onResetSecureField,\n  secureFields = {},\n  getOptionMeta,\n}) => {\n  const styles = useStyles2(getStyles);\n  const { control, register, unregister, setValue } = useFormContext();\n\n  const optionMeta = getOptionMeta?.(option);\n\n  const name = `${pathPrefix}${option.propertyName}`;\n\n  const secureFieldKey = option.secure && option.secureFieldKey ? option.secureFieldKey : '';\n  const isEncryptedInput = secureFieldKey && secureFields?.[secureFieldKey];\n\n  // workaround for https://github.com/react-hook-form/react-hook-form/issues/4993#issuecomment-829012506\n  useEffect(\n    () => () => {\n      unregister(name, { keepValue: false });\n    },\n    [unregister, name]\n  );\n\n  const useTemplates = option.placeholder.includes('{{ template');\n\n  function onSelectTemplate(template: string) {\n    setValue(name, template);\n  }\n\n  switch (option.element) {\n    case 'checkbox':\n      return (\n        <Checkbox\n          id={id}\n          readOnly={readOnly}\n          disabled={readOnly}\n          className={styles.checkbox}\n          {...register(name)}\n          label={option.label}\n          description={option.description}\n        />\n      );\n    case 'input':\n      return (\n        <WrapWithTemplateSelection\n          useTemplates={useTemplates}\n          option={option}\n          name={name}\n          onSelectTemplate={onSelectTemplate}\n        >\n          {isEncryptedInput ? (\n            <SecretInput id={id} onReset={() => onResetSecureField?.(secureFieldKey)} isConfigured />\n          ) : (\n            <Input\n              id={id}\n              readOnly={readOnly || useTemplates || optionMeta?.readOnly}\n              invalid={invalid}\n              type={option.inputType}\n              {...register(name, {\n                required: optionMeta?.required,\n                validate: {\n                  validationRule: (v) =>\n                    option.validationRule ? validateOption(v, option.validationRule, option.required) : true,\n                  customValidator: (v) => (customValidator ? customValidator(v) : true),\n                },\n                setValueAs: option.setValueAs,\n              })}\n              placeholder={option.placeholder}\n            />\n          )}\n        </WrapWithTemplateSelection>\n      );\n\n    case 'select':\n      return (\n        <Controller\n          render={({ field: { onChange, ref, ...field } }) => (\n            <Select\n              disabled={readOnly}\n              options={option.selectOptions ?? undefined}\n              invalid={invalid}\n              onChange={(value) => onChange(value.value)}\n              {...field}\n            />\n          )}\n          control={control}\n          name={name}\n          defaultValue={option.defaultValue?.value}\n          rules={{\n            validate: {\n              customValidator: (v) => (customValidator ? customValidator(v) : true),\n            },\n          }}\n        />\n      );\n    case 'radio':\n      return (\n        <>\n          <legend className={styles.legend}>{option.label}</legend>\n          <Controller\n            render={({ field: { ref, ...field } }) => (\n              <RadioButtonList disabled={readOnly} options={option.selectOptions ?? []} {...field} />\n            )}\n            control={control}\n            defaultValue={option.defaultValue?.value}\n            name={name}\n            rules={{\n              required: option.required ? 'Option is required' : false,\n              validate: {\n                validationRule: (v) =>\n                  option.validationRule ? validateOption(v, option.validationRule, option.required) : true,\n                customValidator: (v) => (customValidator ? customValidator(v) : true),\n              },\n            }}\n          />\n        </>\n      );\n    case 'textarea':\n      return (\n        <WrapWithTemplateSelection\n          useTemplates={useTemplates}\n          option={option}\n          name={name}\n          onSelectTemplate={onSelectTemplate}\n        >\n          {isEncryptedInput ? (\n            <SecretTextArea id={id} onReset={() => onResetSecureField?.(secureFieldKey)} isConfigured />\n          ) : (\n            <TextArea\n              id={id}\n              readOnly={readOnly || useTemplates}\n              invalid={invalid}\n              placeholder={option.placeholder}\n              {...register(name, {\n                required: option.required ? 'Required' : false,\n                validate: (v) =>\n                  option.validationRule !== '' ? validateOption(v, option.validationRule, option.required) : true,\n              })}\n            />\n          )}\n        </WrapWithTemplateSelection>\n      );\n    case 'string_array':\n      return (\n        <Controller\n          render={({ field: { value, onChange } }) => (\n            <StringArrayInput readOnly={readOnly} value={value} onChange={onChange} />\n          )}\n          control={control}\n          name={name}\n        />\n      );\n    case 'key_value_map':\n      return (\n        <Controller\n          render={({ field: { value, onChange } }) => (\n            <KeyValueMapInput readOnly={readOnly} value={value} onChange={onChange} />\n          )}\n          control={control}\n          name={name}\n        />\n      );\n\n    default:\n      console.error('Element not supported', option.element);\n      return null;\n  }\n};\n\nconst getStyles = (theme: GrafanaTheme2) => ({\n  checkbox: css({\n    height: 'auto', // native checkbox has fixed height which does not take into account description\n  }),\n  legend: css({\n    fontSize: theme.typography.h6.fontSize,\n  }),\n});\n\nconst validateOption = (value: string, validationRule: string, required: boolean) => {\n  if (value === '' && !required) {\n    return true;\n  }\n\n  return RegExp(validationRule).test(value) ? true : 'Invalid format';\n};\n","import { useEffect, useRef } from 'react';\n\nimport { useDispatch } from 'app/types/store';\n\nimport { cleanUpAction, CleanUpAction } from '../actions/cleanUp';\n\nexport function useCleanup(cleanupAction: CleanUpAction) {\n  const dispatch = useDispatch();\n  //bit of a hack to unburden user from having to wrap stateSelcetor in a useCallback. Otherwise cleanup would happen on every render\n  const selectorRef = useRef(cleanupAction);\n  selectorRef.current = cleanupAction;\n  useEffect(() => {\n    return () => {\n      dispatch(cleanUpAction({ cleanupAction: selectorRef.current }));\n    };\n  }, [dispatch]);\n}\n","import { set } from 'lodash';\nimport { useCallback } from 'react';\nimport { UseFormReturn } from 'react-hook-form';\n\ninterface Options<R> {\n  name: string;\n  formAPI: UseFormReturn<any>;\n  defaults?: R[];\n\n  // if true, sets `__deleted: true` but does not remove item from the array in values\n  softDelete?: boolean;\n}\n\nexport type ControlledField<R> = R & {\n  __deleted?: boolean;\n};\n\nconst EMPTY_ARRAY = [] as const;\n\n/*\n * react-hook-form's own useFieldArray is uncontrolled and super buggy.\n * this is a simple controlled version. It's dead simple and more robust at the cost of re-rendering the form\n * on every change to the sub forms in the array.\n * Warning: you'll have to take care of your own unique identiifer to use as `key` for the ReactNode array.\n * Using index will cause problems.\n */\nexport function useControlledFieldArray<R>(options: Options<R>) {\n  const { name, formAPI, defaults, softDelete } = options;\n  const { watch, getValues, reset, setValue } = formAPI;\n\n  const fields: Array<ControlledField<R>> = watch(name) ?? defaults ?? EMPTY_ARRAY;\n\n  const update = useCallback(\n    (updateFn: (fields: R[]) => R[]) => {\n      const values = JSON.parse(JSON.stringify(getValues()));\n      const newItems = updateFn(fields ?? []);\n      reset(set(values, name, newItems));\n    },\n    [getValues, name, reset, fields]\n  );\n\n  return {\n    fields,\n    append: useCallback((values: R) => update((fields) => [...fields, values]), [update]),\n    remove: useCallback(\n      (index: number) => {\n        if (softDelete) {\n          setValue(`${name}.${index}.__deleted`, true);\n        } else {\n          update((items) => {\n            const newItems = items.slice();\n            newItems.splice(index, 1);\n            return newItems;\n          });\n        }\n      },\n      [update, name, setValue, softDelete]\n    ),\n  };\n}\n","import { css, cx } from '@emotion/css';\nimport { useState } from 'react';\nimport * as React from 'react';\n\nimport { GrafanaTheme2 } from '@grafana/data';\nimport { IconSize, useStyles2 } from '@grafana/ui';\n\nimport { CollapseToggle } from '../../CollapseToggle';\n\ninterface Props {\n  label: string;\n  description?: string;\n  className?: string;\n  size?: IconSize;\n}\n\nexport const CollapsibleSection = ({\n  label,\n  description,\n  children,\n  className,\n  size = 'xl',\n}: React.PropsWithChildren<Props>) => {\n  const styles = useStyles2(getStyles);\n  const [isCollapsed, setIsCollapsed] = useState(true);\n\n  const toggleCollapse = () => setIsCollapsed(!isCollapsed);\n\n  return (\n    <div className={cx(styles.wrapper, className)}>\n      <CollapseToggle\n        className={styles.toggle}\n        size={size}\n        onToggle={toggleCollapse}\n        isCollapsed={isCollapsed}\n        text={label}\n      />\n      {description && <p className={styles.description}>{description}</p>}\n      <div className={isCollapsed ? styles.hidden : styles.content}>{children}</div>\n    </div>\n  );\n};\n\nconst getStyles = (theme: GrafanaTheme2) => ({\n  wrapper: css({\n    marginTop: theme.spacing(1),\n    paddingBottom: theme.spacing(1),\n  }),\n  toggle: css({\n    margin: theme.spacing(1, 0),\n    padding: 0,\n  }),\n  hidden: css({\n    display: 'none',\n  }),\n  description: css({\n    color: theme.colors.text.secondary,\n    fontSize: theme.typography.size.sm,\n    fontWeight: theme.typography.fontWeightRegular,\n    margin: 0,\n  }),\n  content: css({\n    paddingLeft: theme.spacing(3),\n  }),\n});\n"],"names":["grafanaReceiverToFormValues","receiver","channelMap","idCounter","channel","id","grafanaChannelConfigToFormChannelValues","cloudReceiverToFormValues","notifiers","items","type","configs","config","notifier","cloudChannelConfigToFormChannelValues","formValuesToGrafanaReceiver","values","defaultChannelValues","channelValues","existing","formChannelValuesToGrafanaChannelConfig","formValuesToCloudReceiver","defaults","recv","__id","settings","sendResolved","channelWithOmmitedIdentifiers","omitEmptyValues","omitTemporaryIdentifiers","convertJiraFieldToJson","object","objectCopy","optionName","optionValue","valueForField","convertJsonToJiraField","getSecureFieldNames","secureFieldPaths","findSecureOptions","options","prefix","option","key","name","secureFieldsFromValues","omitFalsySecureFields","secureFields","value","isUnacceptableValue","obj","omitEmptyUnlessExisting","omitIdentifiers","KeyValueMapInput","onChange","readOnly","styles","getStyles","pairs","setPairs","recordToPairs","currentNewPair","setCurrentNewPair","emitChange","pairsToRecord","deleteItem","index","newPairs","removed","Input","ActionIcon","Stack","e","Button","theme","record","StringArrayInput","newValue","updateValue","itemValue","v","i","getReceiverFormFieldStyles","SubformArrayField","pathPrefix","errors","defaultValues","getOptionMeta","path","formAPI","fields","append","remove","useControlledFieldArray","CollapsibleSection","field","itemIndex","OptionField","SubformField","defaultValue","onDelete","onResetSecureField","watch","_watchValue","show","setShow","onDeleteClick","subOption","TemplateContentAndPreview","payload","templateContent","templateName","payloadFormatError","setPayloadFormatError","className","selectedAlertmanager","isGrafanaAlertManager","EditorColumnHeader","Box","width","height","TemplateEditor","TemplatePreview","useGetDefaultTemplatesQuery","TemplatesPicker","onSelect","valueInForm","showTemplates","setShowTemplates","onClick","handleClose","Drawer","TemplateSelector","getTemplateOptions","templateFiles","defaultTemplates","templateMap","content","template","onClose","valueInFormIsCustom","setTemplate","customTemplateValue","setCustomTemplateValue","data","error","isLoading","useNotificationTemplates","templateOption","setTemplateOption","_","copyToClipboard","useCopyToClipboard","templateOptions","onCustomTemplateChange","customInput","onTemplateOptionChange","defaultTemplateValue","nameOfTemplateInForm","RadioButtonGroup","Select","IconButton","OptionCustomfield","initialValue","Label","TextArea","WrapWithTemplateSelection","useTemplates","onSelectTemplate","children","getValues","Text","invalid","customValidator","onDeleteSubform","Field","OptionInput","control","register","unregister","setValue","optionMeta","secureFieldKey","isEncryptedInput","Checkbox","SecretInput","validateOption","ref","RadioButtonList","SecretTextArea","validationRule","required","useCleanup","cleanupAction","dispatch","selectorRef","EMPTY_ARRAY","softDelete","reset","update","updateFn","newItems","label","description","size","isCollapsed","setIsCollapsed","toggleCollapse"],"sourceRoot":""}