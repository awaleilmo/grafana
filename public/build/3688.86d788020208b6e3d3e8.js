"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[3688],{284:(ze,we,t)=>{t.d(we,{n:()=>I});var e=t(74848),o=t(22803),m=t(96540),s=t(63142),M=t(25461),$=t(24728),P=t(98102);const I=(0,m.memo)(({log:ce,syntaxHighlighting:O})=>{const h=(0,s.of)(P.$f),X=(0,m.useMemo)(()=>ce.clone(),[ce]);return(0,e.jsx)("div",{className:x.logLineWrapper,children:(0,e.jsx)("div",{className:h.logLine,children:(0,e.jsx)("div",{className:h.wrappedLogLine,children:X.hasAnsi?(0,e.jsx)("span",{className:"field no-highlighting",children:(0,e.jsx)(M.$,{value:X.body})}):(0,e.jsxs)(e.Fragment,{children:[!O&&(0,e.jsx)("div",{className:"field no-highlighting",children:X.body}),O&&(0,e.jsx)("div",{className:"field log-syntax-highlight",children:(0,e.jsx)($.D,{log:X})})]})})})})});I.displayName="LogLineDetailsLog";const x={logLineWrapper:(0,o.css)({maxHeight:"50vh",overflow:"auto"})}},4123:(ze,we,t)=>{t.d(we,{_J:()=>ee,qg:()=>G,As:()=>Te});function e(l){return o.test(l)}const o=/^-?[0-9]+$/;function m(l){return s.test(l)}const s=/^-?(?:0|[1-9]\d*)(?:\.\d+)?(?:[eE][+-]?\d+)?$/;function M(l,B){const oe=Number.parseFloat(l),F=String(oe);if(l===F)return!0;const de=h(l),be=h(F);return!!(de===be||B?.approx===!0&&!e(l)&&be.length>=14&&de.startsWith(be.substring(0,14)))}let $=function(l){return l.underflow="underflow",l.overflow="overflow",l.truncate_integer="truncate_integer",l.truncate_float="truncate_float",l}({});function P(l){if(M(l,{approx:!1}))return;if(e(l))return $.truncate_integer;const B=Number.parseFloat(l);return Number.isFinite(B)?B===0?$.underflow:$.truncate_float:$.overflow}function I(l,B){const oe=Number.parseFloat(l),F=P(l);if(B?.approx===!0?F&&F!==$.truncate_float:F){const de=F?.replace(/_\w+$/,"");throw new Error(`Cannot safely convert to number: the value '${l}' would ${de} and become ${oe}`)}return oe}function x(l){const B=l.match(/^(-?)(\d+\.?\d*)([eE]([+-]?\d+))?$/);if(!B)throw new SyntaxError(`Invalid number: ${l}`);const oe=B[1],F=B[2];let de=B[4]!==void 0?Number.parseInt(B[4]):0;const be=F.indexOf(".");de+=be!==-1?be-1:F.length-1;const Se=F.replace(".","").replace(/^0*/,We=>(de-=We.length,"")).replace(/0*$/,"");return Se.length>0?{sign:oe,digits:Se,exponent:de}:{sign:oe,digits:"0",exponent:de+1}}function ce(l,B){if(l===B)return 0;const oe=x(l),F=x(B),de=oe.sign==="-"?-1:1;return oe.sign!==F.sign?oe.digits==="0"&&F.digits==="0"?0:de:oe.exponent!==F.exponent?oe.exponent>F.exponent?de:oe.exponent<F.exponent?-de:0:oe.digits>F.digits?de:oe.digits<F.digits?-de:0}function O(l){const{start:B,end:oe}=X(l),F=l.indexOf(".");return F===-1||F<B||F>oe?oe-B:oe-B-1}function h(l){const{start:B,end:oe}=X(l),F=l.substring(B,oe),de=F.indexOf(".");return de===-1?F:F.substring(0,de)+F.substring(de+1)}function X(l){let B=0;for(l[0]==="-"&&B++;l[B]==="0"||l[B]===".";)B++;let oe=l.lastIndexOf("e");for(oe===-1&&(oe=l.lastIndexOf("E")),oe===-1&&(oe=l.length);(l[oe-1]==="0"||l[oe-1]===".")&&oe>B;)oe--;return{start:B,end:oe}}class ee{isLosslessNumber=!0;constructor(B){if(!m(B))throw new Error(`Invalid number (value: "${B}")`);this.value=B}valueOf(){const B=P(this.value);if(B===void 0||B===$.truncate_float)return Number.parseFloat(this.value);if(e(this.value))return BigInt(this.value);throw new Error(`Cannot safely convert to number: the value '${this.value}' would ${B} and become ${Number.parseFloat(this.value)}`)}toString(){return this.value}}function K(l){return l&&typeof l=="object"&&l.isLosslessNumber||!1}function U(l){if(countSignificantDigits(String(l))>15)throw new Error(`Invalid number: contains more than 15 digits and is most likely truncated and unsafe by itself (value: ${l})`);if(Number.isNaN(l))throw new Error("Invalid number: NaN");if(!Number.isFinite(l))throw new Error(`Invalid number: ${l}`);return new ee(String(l))}function y(l,B){return compareNumber(l.value,B.value)}function Y(l){return new ee(l)}function ae(l){return isInteger(l)?BigInt(l):Number.parseFloat(l)}function Oe(l,B){return ne({"":l},"",l,B)}function ne(l,B,oe,F){return Array.isArray(oe)?F.call(l,B,_(oe,F)):oe&&typeof oe=="object"&&!K(oe)?F.call(l,B,C(oe,F)):F.call(l,B,oe)}function C(l,B){for(const oe of Object.keys(l)){const F=ne(l,oe,l[oe],B);F!==void 0?l[oe]=F:delete l[oe]}return l}function _(l,B){for(let oe=0;oe<l.length;oe++)l[oe]=ne(l,String(oe),l[oe],B);return l}function G(l,B){let oe=arguments.length>2&&arguments[2]!==void 0?arguments[2]:Y,F=0;const de=We();return Ee(de),Ce(),B?Oe(de,B):de;function be(){if(l.charCodeAt(F)===p){F++,Ae();const ve={};let De=!0;for(;F<l.length&&l.charCodeAt(F)!==n;){De?De=!1:(Be(),Ae());const Ne=F,Xe=Pe();if(Xe===void 0){_e();return}Ae(),z();const Fe=We();if(Fe===void 0){se();return}Object.prototype.hasOwnProperty.call(ve,Xe)&&!c(Fe,ve[Xe])&&je(Xe,Ne+1),ve[Xe]=Fe}return l.charCodeAt(F)!==n&&Me(),F++,ve}}function Se(){if(l.charCodeAt(F)===D){F++,Ae();const ve=[];let De=!0;for(;F<l.length&&l.charCodeAt(F)!==j;){De?De=!1:Be();const Ne=We();te(Ne),ve.push(Ne)}return l.charCodeAt(F)!==j&&T(),F++,ve}}function We(){Ae();const ve=Pe()??Ie()??be()??Se()??Qe("true",!0)??Qe("false",!1)??Qe("null",null);return Ae(),ve}function Qe(ve,De){if(l.slice(F,F+ve.length)===ve)return F+=ve.length,De}function Ae(){for(;he(l.charCodeAt(F));)F++}function Pe(){if(l.charCodeAt(F)===a){F++;let ve="";for(;F<l.length&&l.charCodeAt(F)!==a;){if(l.charCodeAt(F)===v){const De=l[F+1],Ne=L[De];Ne!==void 0?(ve+=Ne,F++):De==="u"?H(l.charCodeAt(F+2))&&H(l.charCodeAt(F+3))&&H(l.charCodeAt(F+4))&&H(l.charCodeAt(F+5))?(ve+=String.fromCharCode(Number.parseInt(l.slice(F+2,F+6),16)),F+=5):$e(F):ge(F)}else W(l.charCodeAt(F))?ve+=l[F]:A(l[F]);F++}return Le(),F++,ve}}function Ie(){const ve=F;if(l.charCodeAt(F)===S&&(F++,me(ve)),l.charCodeAt(F)===Q)F++;else if(V(l.charCodeAt(F)))for(F++;q(l.charCodeAt(F));)F++;if(l.charCodeAt(F)===u)for(F++,me(ve);q(l.charCodeAt(F));)F++;if(l.charCodeAt(F)===pe||l.charCodeAt(F)===N)for(F++,(l.charCodeAt(F)===S||l.charCodeAt(F)===i)&&F++,me(ve);q(l.charCodeAt(F));)F++;if(F>ve)return oe(l.slice(ve,F))}function Be(){if(l.charCodeAt(F)!==r)throw new SyntaxError(`Comma ',' expected after value ${ue()}`);F++}function z(){if(l.charCodeAt(F)!==g)throw new SyntaxError(`Colon ':' expected after property name ${ue()}`);F++}function Ee(ve){if(ve===void 0)throw new SyntaxError(`JSON value expected ${ue()}`)}function te(ve){if(ve===void 0)throw new SyntaxError(`Array item expected ${ue()}`)}function Ce(){if(F<l.length)throw new SyntaxError(`Expected end of input ${ue()}`)}function me(ve){if(!q(l.charCodeAt(F))){const De=l.slice(ve,F);throw new SyntaxError(`Invalid number '${De}', expecting a digit ${ue()}`)}}function Le(){if(l.charCodeAt(F)!==a)throw new SyntaxError(`End of string '"' expected ${ue()}`)}function _e(){throw new SyntaxError(`Quoted object key expected ${ue()}`)}function je(ve,De){throw new SyntaxError(`Duplicate key '${ve}' encountered at position ${De}`)}function Me(){throw new SyntaxError(`Quoted object key or end of object '}' expected ${ue()}`)}function T(){throw new SyntaxError(`Array item or end of array ']' expected ${ue()}`)}function A(ve){throw new SyntaxError(`Invalid character '${ve}' ${ie()}`)}function ge(ve){const De=l.slice(ve,ve+2);throw new SyntaxError(`Invalid escape character '${De}' ${ie()}`)}function se(){throw new SyntaxError(`Object value expected after ':' ${ie()}`)}function $e(ve){const De=l.slice(ve,ve+6);throw new SyntaxError(`Invalid unicode character '${De}' ${ie()}`)}function ie(){return`at position ${F}`}function fe(){return F<l.length?`but got '${l[F]}'`:"but reached end of input"}function ue(){return`${fe()} ${ie()}`}}function he(l){return l===Z||l===E||l===f||l===d}function H(l){return l>=Q&&l<=R||l>=w&&l<=re||l>=k&&l<=le}function q(l){return l>=Q&&l<=R}function V(l){return l>=J&&l<=R}function W(l){return l>=32&&l<=1114111}function c(l,B){return l===B?!0:Array.isArray(l)&&Array.isArray(B)?l.length===B.length&&l.every((oe,F)=>c(oe,B[F])):b(l)&&b(B)?[...new Set([...Object.keys(l),...Object.keys(B)])].every(F=>c(l[F],B[F])):!1}function b(l){return typeof l=="object"&&l!==null}const L={'"':'"',"\\":"\\","/":"/",b:"\b",f:"\f",n:`
`,r:"\r",t:"	"},v=92,p=123,n=125,D=91,j=93,Z=32,E=10,f=9,d=13,a=34,i=43,S=45,Q=48,J=49,R=57,r=44,u=46,g=58,w=65,k=97,N=69,pe=101,re=70,le=102;function Te(l,B,oe,F){const de=xe(oe),be=typeof B=="function"?B.call({"":l},"",l):l;return Se(be,"");function Se(Pe,Ie){if(Array.isArray(F)){const Be=F.find(z=>z.test(Pe));if(Be){const z=Be.stringify(Pe);if(typeof z!="string"||!m(z))throw new Error(`Invalid JSON number: output of a number stringifier must be a string containing a JSON number (output: ${z})`);return z}}if(typeof Pe=="boolean"||typeof Pe=="number"||typeof Pe=="string"||Pe===null||Pe instanceof Date||Pe instanceof Boolean||Pe instanceof Number||Pe instanceof String)return JSON.stringify(Pe);if(Pe?.isLosslessNumber||typeof Pe=="bigint")return Pe.toString();if(Array.isArray(Pe))return We(Pe,Ie);if(Pe&&typeof Pe=="object")return Qe(Pe,Ie)}function We(Pe,Ie){if(Pe.length===0)return"[]";const Be=de?Ie+de:void 0;let z=de?`[
`:"[";for(let Ee=0;Ee<Pe.length;Ee++){const te=typeof B=="function"?B.call(Pe,String(Ee),Pe[Ee]):Pe[Ee];de&&(z+=Be),typeof te<"u"&&typeof te!="function"?z+=Se(te,Be):z+="null",Ee<Pe.length-1&&(z+=de?`,
`:",")}return z+=de?`
${Ie}]`:"]",z}function Qe(Pe,Ie){if(typeof Pe.toJSON=="function")return Te(Pe.toJSON(),B,oe,void 0);const Be=Array.isArray(B)?B.map(String):Object.keys(Pe);if(Be.length===0)return"{}";const z=de?Ie+de:void 0;let Ee=!0,te=de?`{
`:"{";for(const Ce of Be){const me=typeof B=="function"?B.call(Pe,Ce,Pe[Ce]):Pe[Ce];if(Ae(Ce,me)){Ee?Ee=!1:te+=de?`,
`:",";const Le=JSON.stringify(Ce);te+=de?`${z+Le}: `:`${Le}:`,te+=Se(me,z)}}return te+=de?`
${Ie}}`:"}",te}function Ae(Pe,Ie){return typeof Ie<"u"&&typeof Ie!="function"&&typeof Ie!="symbol"}}function xe(l){if(typeof l=="number")return" ".repeat(l);if(typeof l=="string"&&l!=="")return l}},13744:(ze,we,t)=>{t.d(we,{x:()=>b,r:()=>V});var e=t(74848),o=t(22803),m=t(96540),s=t(54092),M=t(39443),$=t(92745),P=t(46907),I=t(63142),x=t(74746),ce=t(76487),O=t(2543),h=t(41811),X=t(1906),ee=t(27489),K=t(47931),U=t(76319),y=t(5753),Y=t(45967),ae=t(37234),Oe=t(29229),ne=t(21429);const C=(0,h.default)(L=>({labelType:(0,o.css)({border:`solid 1px ${L.colors.text.secondary}`,color:L.colors.text.secondary,borderRadius:L.shape.radius.circle,fontSize:L.spacing(1),lineHeight:L.spacing(1.25),height:L.spacing(1.5),width:L.spacing(1.5),display:"flex",justifyContent:"center",verticalAlign:"middle",marginLeft:L.spacing(1)}),wordBreakAll:(0,o.css)({label:"wordBreakAll",wordBreak:"break-all"}),copyButton:(0,o.css)({"& > button":{gap:0,color:L.colors.text.secondary,padding:0,justifyContent:"center",borderRadius:L.shape.radius.circle,height:L.spacing(L.components.height.sm),width:L.spacing(L.components.height.sm),svg:{margin:0},"span > div":{top:"-5px","& button":{color:L.colors.success.main}}}}),adjoiningLinkButton:(0,o.css)({marginLeft:L.spacing(1)}),wrapLine:(0,o.css)({label:"wrapLine",whiteSpace:"pre-wrap"}),logDetailsStats:(0,o.css)({padding:`0 ${L.spacing(1)}`}),logDetailsValue:(0,o.css)({display:"flex",alignItems:"center",lineHeight:"22px",".log-details-value-copy":{visibility:"hidden"},"&:hover":{".log-details-value-copy":{visibility:"visible"}}}),buttonRow:(0,o.css)({display:"flex",flexDirection:"row",gap:L.spacing(.5),marginLeft:L.spacing(.5)})}));class _ extends m.PureComponent{constructor(){super(...arguments),this.state={showFieldsStats:!1,fieldCount:0,fieldStats:null},this.showField=()=>{const{onClickShowField:v,parsedKeys:p,row:n}=this.props;v&&v(p[0]),(0,ee.rR)("grafana_explore_logs_log_details_replace_line_clicked",{datasourceType:n.datasourceType,logRowUid:n.uid,type:"enable"})},this.hideField=()=>{const{onClickHideField:v,parsedKeys:p,row:n}=this.props;v&&v(p[0]),(0,ee.rR)("grafana_explore_logs_log_details_replace_line_clicked",{datasourceType:n.datasourceType,logRowUid:n.uid,type:"disable"})},this.isFilterLabelActive=async()=>{const{isFilterLabelActive:v,parsedKeys:p,parsedValues:n,row:D}=this.props;return v?await v(p[0],n[0],D.dataFrame?.refId):!1},this.filterLabel=()=>{const{onClickFilterLabel:v,parsedKeys:p,parsedValues:n,row:D}=this.props;v&&v(p[0],n[0],(0,ae.f8)(D)||void 0),(0,ee.rR)("grafana_explore_logs_log_details_filter_clicked",{datasourceType:D.datasourceType,filterType:"include",logRowUid:D.uid})},this.filterOutLabel=()=>{const{onClickFilterOutLabel:v,parsedKeys:p,parsedValues:n,row:D}=this.props;v&&v(p[0],n[0],(0,ae.f8)(D)||void 0),(0,ee.rR)("grafana_explore_logs_log_details_filter_clicked",{datasourceType:D.datasourceType,filterType:"exclude",logRowUid:D.uid})},this.updateStats=()=>{const{getStats:v}=this.props,p=v(),n=p?p.reduce((D,j)=>D+j.count,0):0;(!(0,O.isEqual)(this.state.fieldStats,p)||n!==this.state.fieldCount)&&this.setState({fieldStats:p,fieldCount:n})},this.showStats=()=>{const{isLabel:v,row:p,app:n}=this.props,{showFieldsStats:D}=this.state;D||this.updateStats(),this.toggleFieldsStats(),(0,ee.rR)("grafana_explore_logs_log_details_stats_clicked",{dataSourceType:p.datasourceType,fieldType:v?"label":"detectedField",type:D?"close":"open",logRowUid:p.uid,app:n})}}componentDidUpdate(){this.state.showFieldsStats&&this.updateStats()}toggleFieldsStats(){this.setState(v=>({showFieldsStats:!v.showFieldsStats}))}generateClipboardButton(v){const{theme:p}=this.props,n=C(p);return(0,e.jsx)("div",{className:`log-details-value-copy ${n.copyButton}`,children:(0,e.jsx)(K.b,{getText:()=>v,"aria-label":(0,$.t)("logs.un-themed-log-details-row.title-copy-value-to-clipboard","Copy value to clipboard"),fill:"text",variant:"secondary",icon:"copy",size:"md"})})}generateMultiVal(v,p){return(0,e.jsx)("table",{children:(0,e.jsx)("tbody",{children:v?.map((n,D)=>(0,e.jsx)("tr",{children:(0,e.jsxs)("td",{children:[n,p&&n!==""&&this.generateClipboardButton(n)]})},`${n}-${D}`))})})}render(){const{theme:v,parsedKeys:p,parsedValues:n,isLabel:D,links:j,displayedFields:Z,wrapLogMessage:E,onClickFilterLabel:f,onClickFilterOutLabel:d,disableActions:a,row:i,app:S,onPinLine:Q,pinLineButtonTooltipTitle:J}=this.props,{showFieldsStats:R,fieldStats:r,fieldCount:u}=this.state,g=C(v),w=(0,ne.D)(v),k=p==null?!1:p.length===1,N=n==null?!1:n.length===1,pe=!a&&f&&d,re=S===X.Jk.Explore&&i.dataFrame?.refId?` in query ${i.dataFrame?.refId}`:"",le=k?(0,x.dO)(p[0],i):null,Te=!N&&n!=null&&!n.every(l=>l===""),xe=Z&&p!=null&&Z.includes(p[0])?(0,e.jsx)(U.K,{variant:"primary",tooltip:(0,$.t)("logs.un-themed-log-details-row.toggle-field-button.tooltip-hide-this-field","Hide this field"),name:"eye",onClick:this.hideField}):(0,e.jsx)(U.K,{tooltip:(0,$.t)("logs.un-themed-log-details-row.toggle-field-button.tooltip-field-instead-message","Show this field instead of the message"),name:"eye",onClick:this.showField});return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsxs)("tr",{className:w.logDetailsValue,children:[(0,e.jsx)("td",{className:w.logsDetailsIcon,children:(0,e.jsxs)("div",{className:g.buttonRow,children:[pe&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(he,{name:"search-plus",onClick:this.filterLabel,isActive:()=>this.isFilterLabelActive(),tooltipSuffix:re}),(0,e.jsx)(U.K,{name:"search-minus",tooltip:S===X.Jk.Explore&&i.dataFrame?.refId?(0,$.t)("logs.un-themed-log-details-row.filter-out-query","Filter out value in query {{query}}",{query:i.dataFrame?.refId}):(0,$.t)("logs.un-themed-log-details-row.filter-out","Filter out value"),onClick:this.filterOutLabel})]}),!a&&Z&&xe,!a&&(0,e.jsx)(U.K,{variant:R?"primary":"secondary",name:"signal",tooltip:(0,$.t)("logs.un-themed-log-details-row.tooltip-adhoc-statistics","Ad-hoc statistics"),className:"stats-button",disabled:!k,onClick:this.showStats})]})}),(0,e.jsx)("td",{children:le&&(0,e.jsx)(G,{type:le,styles:g})}),(0,e.jsx)("td",{className:w.logDetailsLabel,children:k?p[0]:this.generateMultiVal(p)}),(0,e.jsx)("td",{className:(0,o.cx)(g.wordBreakAll,E&&g.wrapLine),children:(0,e.jsxs)("div",{className:g.logDetailsValue,children:[N?n[0]:this.generateMultiVal(n,!0),N&&this.generateClipboardButton(n[0]),(0,e.jsx)("div",{className:(0,o.cx)((N||Te)&&g.adjoiningLinkButton),children:j?.map((l,B)=>{if(l.onClick&&Q){const oe=l.onClick;l.onClick=(F,de)=>{Q(i,!1),oe(F,de)}}return(0,e.jsx)("span",{children:(0,e.jsx)(y.R,{buttonProps:{tooltip:typeof J=="object"&&l.onClick?J:void 0,variant:"secondary",fill:"outline",...l.icon&&{icon:l.icon}},link:l})},`${l.title}-${B}`)})})]})})]}),R&&k&&N&&(0,e.jsxs)("tr",{children:[(0,e.jsx)("td",{colSpan:2,children:(0,e.jsx)(U.K,{variant:R?"primary":"secondary",name:"signal",tooltip:(0,$.t)("logs.un-themed-log-details-row.tooltip-hide-adhoc-statistics","Hide ad-hoc statistics"),onClick:this.showStats})}),(0,e.jsx)("td",{colSpan:2,children:(0,e.jsx)("div",{className:g.logDetailsStats,children:(0,e.jsx)(Oe.y,{stats:r,label:p[0],value:n[0],rowCount:u,isLabel:D})})})]})]})}}function G({type:L,styles:v}){return(0,e.jsx)(Y.m,{content:L,children:(0,e.jsx)("div",{className:v.labelType,children:(0,e.jsx)("span",{children:L.substring(0,1)})})})}const he=({isActive:L,tooltipSuffix:v,...p})=>{const[n,D]=(0,m.useState)(!1),j=n?"Remove filter":"Filter for value";return(0,m.useEffect)(()=>{L().then(D)},[L]),(0,e.jsx)(U.K,{...p,variant:n?"primary":void 0,tooltip:j+v})},H=(0,I.cV)(_);H.displayName="LogDetailsRow";var q=t(62215);const V=L=>{const v=(0,m.useMemo)(()=>({attributes:Object.fromEntries(Object.entries(L.labels).map(([n,D])=>[n,[D]])),datasource:{type:L.datasourceType??"",uid:L.datasourceUid??""}}),[L.labels,L.datasourceType,L.datasourceUid]),{links:p}=(0,P.U)({extensionPointId:s.SM.LogsViewResourceAttributes,limitPerPlugin:10,context:v});return(0,m.useMemo)(()=>p.reduce((n,D)=>{if(D.category){const j={href:D.path??"",target:"_blank",origin:void 0,title:D.title,onClick:D.onClick,icon:D.icon};n[D.category]?n[D.category].push(j):n[D.category]=[j]}return n},{}),[p])},W=L=>{function v(p){const n=V(p.row);return(0,e.jsx)(L,{...p,links:n})}return v};class c extends m.PureComponent{render(){const{app:v,row:p,theme:n,hasError:D,onClickFilterOutLabel:j,onClickFilterLabel:Z,getRows:E,showDuplicates:f,className:d,onClickShowField:a,onClickHideField:i,displayedFields:S,getFieldLinks:Q,wrapLogMessage:J,onPinLine:R,styles:r,pinLineButtonTooltipTitle:u,links:g}=this.props,w=(0,ne.L)(n,p.logLevel),k=p.labels?p.labels:{},N=Object.keys(k).length>0,pe=(0,q.jE)(p,Q);let re=pe.filter(de=>de.links?.length);const le=re.filter(de=>de.fieldIndex!==p.entryFieldIndex).sort(),Te=re.filter(de=>de.fieldIndex===p.entryFieldIndex).sort(),xe=(0,q.qE)(Te),l=le&&le.length>0||xe&&xe.length>0,B=p.dataFrame.meta?.type===M.m.LogLines?[]:pe.filter(de=>de.links?.length===0&&de.fieldIndex!==p.entryFieldIndex).sort(),oe=B&&B.length>0,F=D?"":`${w.logsRowLevelColor} ${r.logsRowLevel} ${r.logsRowLevelDetails}`;return(0,e.jsxs)("tr",{className:(0,o.cx)(d,r.logDetails),children:[f&&(0,e.jsx)("td",{}),(0,e.jsx)("td",{className:F,"aria-label":(0,$.t)("logs.un-themed-log-details.aria-label-log-level","Log level")}),(0,e.jsx)("td",{colSpan:4,children:(0,e.jsx)("div",{className:r.logDetailsContainer,children:(0,e.jsx)("table",{className:r.logDetailsTable,children:(0,e.jsxs)("tbody",{children:[S&&S.length>0&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("tr",{children:(0,e.jsx)("td",{colSpan:100,className:r.logDetailsHeading,"aria-label":(0,$.t)("logs.un-themed-log-details.aria-label-line","Log line"),children:(0,e.jsx)($.x6,{i18nKey:"logs.log-details.log-line",children:"Log line"})})}),(0,e.jsx)(ce.b,{onClickShowField:a,onClickHideField:i,row:p,app:v,displayedFields:S,disableActions:!1,theme:n})]}),(N||oe)&&(0,e.jsx)("tr",{children:(0,e.jsx)("td",{colSpan:100,className:r.logDetailsHeading,"aria-label":(0,$.t)("logs.un-themed-log-details.aria-label-fields","Fields"),children:(0,e.jsx)($.x6,{i18nKey:"logs.log-details.fields",children:"Fields"})})}),Object.keys(k).sort().map((de,be)=>{const Se=k[de];return(0,e.jsx)(H,{parsedKeys:[de],parsedValues:[Se],isLabel:!0,getStats:()=>(0,x.Tj)(E(),de),onClickFilterOutLabel:j,onClickFilterLabel:Z,onClickShowField:a,onClickHideField:i,row:p,app:v,wrapLogMessage:J,displayedFields:S,disableActions:!1,isFilterLabelActive:this.props.isFilterLabelActive,links:g?.[de]},`${de}=${Se}-${be}`)}),B.map((de,be)=>{const{keys:Se,values:We,fieldIndex:Qe}=de;return(0,e.jsx)(H,{parsedKeys:Se,parsedValues:We,onClickShowField:a,onClickHideField:i,onClickFilterOutLabel:j,onClickFilterLabel:Z,getStats:()=>(0,x.s2)(p.dataFrame.fields[Qe].values),displayedFields:S,wrapLogMessage:J,row:p,app:v,disableActions:!1,isFilterLabelActive:this.props.isFilterLabelActive},`${Se[0]}=${We[0]}-${be}`)}),l&&(0,e.jsx)("tr",{children:(0,e.jsx)("td",{colSpan:100,className:r.logDetailsHeading,"aria-label":(0,$.t)("logs.un-themed-log-details.aria-label-data-links","Data links"),children:(0,e.jsx)($.x6,{i18nKey:"logs.log-details.links",children:"Links"})})}),le.map((de,be)=>{const{keys:Se,values:We,links:Qe,fieldIndex:Ae}=de;return(0,e.jsx)(H,{parsedKeys:Se,parsedValues:We,links:Qe,onClickShowField:a,onClickHideField:i,onPinLine:R,pinLineButtonTooltipTitle:u,getStats:()=>(0,x.s2)(p.dataFrame.fields[Ae].values),displayedFields:S,wrapLogMessage:J,row:p,app:v,disableActions:!1},`${Se[0]}=${We[0]}-${be}`)}),xe?.map((de,be)=>{const{keys:Se,values:We,links:Qe,fieldIndex:Ae}=de;return(0,e.jsx)(H,{parsedKeys:Se,parsedValues:We,links:Qe,onClickShowField:a,onClickHideField:i,onPinLine:R,pinLineButtonTooltipTitle:u,getStats:()=>(0,x.s2)(p.dataFrame.fields[Ae].values),displayedFields:S,wrapLogMessage:J,row:p,app:v,disableActions:!0},`${Se[0]}=${We[0]}-${be}`)}),!oe&&!N&&!l&&(0,e.jsx)("tr",{children:(0,e.jsx)("td",{colSpan:100,"aria-label":(0,$.t)("logs.un-themed-log-details.aria-label-no-details","No details"),children:(0,e.jsx)($.x6,{i18nKey:"logs.log-details.no-details",children:"No details available"})})})]})})})})]})}}const b=(0,I.cV)(W(c));b.displayName="LogDetails"},17896:(ze,we,t)=>{t.d(we,{BB:()=>_,Dh:()=>U,K6:()=>ae,V7:()=>y,rg:()=>G,u8:()=>X});var e=t(74848),o=t(22803),m=t(96540),s=t(17548),M=t(1906),$=t(92745),P=t(43173),I=t(27489),x=t(739),ce=t(30703),O=t(45861),h=t(82212);const X=({app:H,children:q,loading:V,loadMoreLogs:W,range:c,rows:b,scrollElement:L,sortOrder:v,timeZone:p,topScrollEnabled:n=!1})=>{const[D,j]=(0,m.useState)(!1),[Z,E]=(0,m.useState)(!1),[f,d]=(0,m.useState)(!1),[a,i]=(0,m.useState)(!1),S=(0,m.useRef)(b),Q=(0,m.useRef)(L?.scrollTop||0),J=(0,m.useRef)(null),R=(0,m.useRef)(0);(0,m.useEffect)(()=>{j(!1),E(!1)},[c,b,v]),(0,m.useEffect)(()=>{V||(d(!1),i(!1))},[V]),(0,m.useEffect)(()=>{a&&L&&L.scrollTo(0,L.scrollHeight-L.clientHeight)},[a,L]),(0,m.useEffect)(()=>{b!==S.current&&b.length===S.current.length&&(f||a)&&(v===x.uH.Descending&&a?E(!0):v===x.uH.Ascending&&f&&j(!0)),S.current=b},[a,b,v,f]),(0,m.useEffect)(()=>{if(!L||!W||L.scrollHeight<=L.clientHeight)return;function w(pe){if(!L||!W||!b.length||V||!P.$.featureToggles.logsInfiniteScrolling)return;const re=y(pe,J.current,R,L,Q.current);J.current=pe,Q.current=L.scrollTop,re!==0&&(pe.stopImmediatePropagation(),re===-1&&n?k():re===1&&N(),J.current=null)}function k(){const pe=_(ae(b),c,p,v);if(!pe){j(!0);return}j(!1),W?.(pe),d(!0),(0,I.rR)("grafana_logs_infinite_scrolling",{direction:"top",sort_order:v})}function N(){const pe=G(ae(b),c,p,v);if(!pe){E(!0);return}E(!1),W?.(pe),i(!0),(0,I.rR)("grafana_logs_infinite_scrolling",{direction:"bottom",sort_order:v})}return L.addEventListener("scroll",w),L.addEventListener("wheel",w),()=>{L.removeEventListener("scroll",w),L.removeEventListener("wheel",w)}},[W,V,c,b,L,v,p,n]);const r=v===x.uH.Descending&&s.isRelativeTime(c.raw.to),u=v===x.uH.Ascending&&s.isRelativeTime(c.raw.to),g=(0,m.useCallback)(()=>{(0,I.rR)("grafana_explore_logs_infinite_pagination_clicked",{pageType:"olderLogsButton"});const w=_(ae(b),c,p,v);if(!w){j(!0);return}j(!1),W?.(w),d(!0),L?.scroll({behavior:"auto",top:0})},[W,c,b,L,v,p]);return(0,e.jsxs)(e.Fragment,{children:[f&&(0,e.jsx)(h.I,{adjective:v===x.uH.Descending?"newer":"older"}),!r&&D&&K,v===x.uH.Ascending&&H===M.Jk.Explore&&W&&(0,e.jsx)(O.$n,{className:ee.navButton,variant:"secondary",onClick:g,disabled:V,children:(0,e.jsxs)("div",{className:ee.navButtonContent,children:[(0,e.jsx)(ce.I,{name:"angle-up",size:"lg"}),(0,e.jsx)($.x6,{i18nKey:"logs.infinite-scroll.older-logs",children:"Older logs"})]})}),q,!u&&Z&&K,a&&(0,e.jsx)(h.I,{adjective:v===x.uH.Descending?"older":"newer"})]})},ee={messageContainer:(0,o.css)({textAlign:"center",padding:.25}),navButton:(0,o.css)({width:"58px",height:"68px",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",lineHeight:"1",position:"absolute",top:0,right:-3,zIndex:1}),navButtonContent:(0,o.css)({display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",whiteSpace:"normal"})},K=(0,e.jsx)("div",{className:ee.messageContainer,"data-testid":"end-of-range",children:(0,e.jsx)($.x6,{i18nKey:"logs.out-of-range-message.end-of-the-selected-time-range",children:"End of the selected time range."})});var U=(H=>(H[H.Top=-1]="Top",H[H.Bottom=1]="Bottom",H[H.NoScroll=0]="NoScroll",H))(U||{});function y(H,q,V,W,c){const b=H instanceof WheelEvent?H.deltaY:W.scrollTop-c;if(b===0)return 0;const L=b<0?-1:1;return(L===-1?W.scrollTop:W.scrollHeight-W.scrollTop-W.clientHeight)>1||!q||Y(H,q,V)?0:L}function Y(H,q,V){const W=H.timeStamp-q.timeStamp;return W>500?(V.current=0,!1):(V.current++,W<100?V.current>=180?(V.current=0,!1):!0:W<400&&V.current>=25?(V.current=0,!1):!0)}function ae(H){const q=H[0].timeEpochMs,V=H[H.length-1].timeEpochMs;return V<q?{from:V,to:q}:{from:q,to:V}}function Oe(H,q){return{from:q.from.valueOf(),to:H.from}}function ne(H,q,V){return q=he(q,V),{from:H.to,to:q.to.valueOf()}}const C=1e3;function _(H,q,V,W){return W===x.uH.Descending?(q=he(q,V),q.to.valueOf()-H.to>C?ne(H,q,V):void 0):Math.abs(q.from.valueOf()-H.from)>C?Oe(H,q):void 0}function G(H,q,V,W){return W===x.uH.Descending?Math.abs(q.from.valueOf()-H.from)>C?Oe(H,q):void 0:(q=he(q,V),q.to.valueOf()-H.to>C?ne(H,q,V):void 0)}function he(H,q){return s.isRelativeTimeRange(H.raw)?s.convertRawToRange(H.raw,q):H}},21429:(ze,we,t)=>{t.d(we,{D:()=>I,L:()=>P});var e=t(22803),o=t(41811),m=t(84140),s=t(6773),M=t(67770),$=t(35484);const P=(x,ce)=>{let O=x.isLight?x.v1.palette.gray5:x.v1.palette.gray2;switch(ce){case M.$b.crit:case M.$b.critical:O="#705da0";break;case M.$b.error:case M.$b.err:O="#e24d42";break;case M.$b.warning:case M.$b.warn:O=x.colors.warning.main;break;case M.$b.info:O="#7eb26d";break;case M.$b.debug:O="#1f78c1";break;case M.$b.trace:O="#6ed0e0";break}return{logsRowLevelColor:(0,e.css)({"&::after":{backgroundColor:O}})}},I=(0,o.default)(x=>{const ce=$.hoverColor(x.colors.background.secondary,x),O=(0,m.A)(x.components.dashboard.background).setAlpha(.7).toRgbString();return{logsRowLevel:(0,e.css)({label:"logs-row__level",maxWidth:x.spacing(1.25),cursor:"default","&::after":{content:"''",display:"block",position:"absolute",top:"1px",bottom:"1px",width:"3px",left:x.spacing(.5)}}),logsRowWithError:(0,e.css)({maxWidth:`${x.spacing(1.5)}`}),logsRowMatchHighLight:(0,e.css)({label:"logs-row__match-highlight",background:"inherit",padding:"inherit",color:x.components.textHighlight.text,backgroundColor:x.components.textHighlight.background}),logRows:(0,e.css)({position:"relative"}),shortcut:(0,e.css)({display:"inline-flex",alignItems:"center",gap:x.spacing(1),color:x.colors.text.secondary,opacity:.7,fontSize:x.typography.bodySmall.fontSize,marginTop:x.spacing(1)}),logsRowsTable:(0,e.css)({label:"logs-rows",fontFamily:x.typography.fontFamilyMonospace,fontSize:x.typography.bodySmall.fontSize,width:"100%",position:"relative"}),logsRowsTableContain:(0,e.css)({contain:"strict"}),highlightBackground:(0,e.css)({backgroundColor:(0,m.A)(x.colors.info.transparent).setAlpha(.25).toString()}),logsRow:(0,e.css)({label:"logs-row",width:"100%",cursor:"pointer",verticalAlign:"top","&:focus-within":{outline:`2px solid ${x.colors.primary.border}`,outlineOffset:"-2px"},"&:hover":{".log-row-menu":{zIndex:1},background:ce},"td:not(.log-row-menu-cell):last-child":{width:"100%"},"> td:not(.log-row-menu-cell)":{position:"relative",paddingRight:x.spacing(1),borderTop:"1px solid transparent",borderBottom:"1px solid transparent",height:"100%"}}),logsRowDuplicates:(0,e.css)({label:"logs-row__duplicates",textAlign:"right",width:"4em",cursor:"default"}),logIconError:(0,e.css)({color:x.colors.warning.main,position:"relative",top:"-2px"}),logIconInfo:(0,e.css)({color:x.colors.info.main,position:"relative",top:"-2px"}),logsRowToggleDetails:(0,e.css)({label:"logs-row-toggle-details__level",fontSize:"9px",maxWidth:"15px"}),logsRowLocalTime:(0,e.css)({label:"logs-row__localtime",whiteSpace:"nowrap"}),logsRowLabels:(0,e.css)({label:"logs-row__labels",whiteSpace:"nowrap",maxWidth:"22em","> span":{marginTop:"0.75px"}}),logsRowMessage:(0,e.css)({label:"logs-row__message",whiteSpace:"pre-wrap",wordBreak:"break-all",overflowWrap:"anywhere",width:"100%",textAlign:"left"}),copyLogButton:(0,e.css)({padding:x.spacing(0,0,0,.5),height:x.spacing(3),width:x.spacing(3.25),lineHeight:x.spacing(2.5),overflow:"hidden","&:hover":{backgroundColor:s.MV.alpha(x.colors.text.primary,.12)}}),logDetailsContainer:(0,e.css)({label:"logs-row-details-table",border:`1px solid ${x.colors.border.medium}`,padding:x.spacing(0,1,1),borderRadius:x.shape.radius.default,margin:x.spacing(2.5,1,2.5,2),cursor:"default"}),logDetailsTable:(0,e.css)({label:"logs-row-details-table",lineHeight:"18px",width:"100%","td:last-child":{width:"100%"}}),logsDetailsIcon:(0,e.css)({label:"logs-row-details__icon",position:"relative",color:x.v1.palette.gray3,paddingTop:"1px",paddingBottom:"1px",paddingRight:x.spacing(.75)}),logDetailsLabel:(0,e.css)({label:"logs-row-details__label",maxWidth:"30em",padding:x.spacing(0,1),overflowWrap:"break-word"}),logDetailsHeading:(0,e.css)({label:"logs-row-details__heading",fontWeight:x.typography.fontWeightBold,padding:x.spacing(1,0,.5)}),logDetailsValue:(0,e.css)({label:"logs-row-details__row",position:"relative",verticalAlign:"middle",cursor:"default","&:hover":{backgroundColor:ce}}),detailsToggle:(0,e.css)({appearance:"none",background:"none",border:"none",padding:0,maxHeight:"19px","&:focus-visible":{boxShadow:"none"},"&:focus":{outline:0},"&:after":{content:'""',inset:0,position:"absolute"}}),topVerticalAlign:(0,e.css)({label:"topVerticalAlign",marginTop:x.spacing(-.9),marginLeft:x.spacing(-.25)}),detailsOpen:(0,e.css)({"&:hover":{backgroundColor:$.hoverColor(x.colors.background.primary,x)}}),errorLogRow:(0,e.css)({label:"erroredLogRow",color:x.colors.text.secondary}),positionRelative:(0,e.css)({label:"positionRelative",position:"relative"}),rowWithContext:(0,e.css)({label:"rowWithContext",zIndex:1,outline:`9999px solid ${O}`,display:"inherit"}),horizontalScroll:(0,e.css)({label:"horizontalScroll",whiteSpace:"pre"}),contextNewline:(0,e.css)({display:"block",marginLeft:"0px"}),rowMenu:(0,e.css)({label:"rowMenu",display:"flex",flexWrap:"nowrap",flexDirection:"row",alignContent:"flex-end",justifyContent:"space-evenly",alignItems:"center",position:"absolute",top:0,bottom:"auto",background:x.colors.background.primary,boxShadow:x.shadows.z3,padding:x.spacing(.5,1,.5,1),zIndex:100,gap:x.spacing(.5),"& > button":{margin:0}}),logRowMenuCell:(0,e.css)({position:"sticky",zIndex:x.zIndex.dropdown,marginTop:x.spacing(-.125),right:0,"& > span":{transform:"translateX(-100%)"}}),logLine:(0,e.css)({fontFamily:x.typography.fontFamilyMonospace,fontSize:x.typography.bodySmall.fontSize,letterSpacing:x.typography.bodySmall.letterSpacing,textAlign:"left",padding:0,userSelect:"text"}),logsRowLevelDetails:(0,e.css)({label:"logs-row__level_details","&::after":{top:"-3px"}}),logDetails:(0,e.css)({label:"logDetailsDefaultCursor",cursor:"default","&:hover":{backgroundColor:x.colors.background.primary}}),visibleRowMenu:(0,e.css)({label:"visibleRowMenu",aspectRatio:"1/1",zIndex:90}),linkButton:(0,e.css)({label:"linkButton","> button":{paddingTop:x.spacing(.5)}}),hidden:(0,e.css)({label:"hidden",visibility:"hidden"}),unPinButton:(0,e.css)({height:x.spacing(3),lineHeight:x.spacing(2.5)})}})},22420:(ze,we,t)=>{t.d(we,{Bb:()=>X,Ed:()=>U,N4:()=>ee,P7:()=>Oe,Qn:()=>ce,WV:()=>P,qv:()=>O,sM:()=>Y,tY:()=>K,tt:()=>ae});var e=t(2543),o=t.n(e),m=t(46933),s=t(12282);function M(_){return $(_/1e3)}function $(_){return Math.floor(_/60)}function P(_,G){if(_&&G){const he=M(_.from.valueOf())===M(G.from.valueOf()),H=M(_.to.valueOf())===M(G.to.valueOf());return!(he&&H)}return!1}const I=/[*+?()|\\.\[\]{}^$]/g;function x(_){return _.replace(I,"\\$&")}function ce(_){return _.replace(/\\/g,"\\\\").replace(/\n/g,"\\n").replace(/"/g,'\\"')}function O(_){return _.replace(/\\n/g,`
`).replace(/\\"/g,'"').replace(/\\\\/g,"\\")}function h(_){return ce(x(_))}function X(_,G){return ee(G)?h(_):ce(_)}function ee(_){return!!(_&&(_.includes("=~")||_.includes("!~")))}function K(_){const G=["b","kib","Kib","kb","KB","mib","Mib","mb","MB","gib","Gib","gb","GB","tib","Tib","tb","TB","pib","Pib","pb","PB","eib","Eib","eb","EB"],he=new RegExp(`^(?:-?\\d+(?:\\.\\d+)?)(?:${G.join("|")})$`);return!!_.match(he)}function U(_,G,he){if(!G||he===void 0)return null;const H=G.fields.find(q=>q.name==="labelTypes")?.values[he];if(!H)return null;switch(H[_]){case"I":return s.HD.Indexed;case"S":return s.HD.StructuredMetadata;case"P":return s.HD.Parsed;default:return null}}const y={[m.D_.Equal]:"=",[m.D_.NotEqual]:"!=",[m.D_.EqualRegEx]:"=~",[m.D_.NotEqualRegEx]:"!~"},Y=(0,e.invert)(y);function ae(_){const G=_.labelMatchers.map(he=>{const H=y[he.operator];return H?`${he.name}${H}"${he.value}"`:""}).filter(he=>he!=="").join(", ");return G?`{${G}}`:""}function Oe(_){const G={};_.forEach(H=>{Object.keys(H).forEach(q=>{G[q]||(G[q]=new Set),G[q].has(H[q])||G[q].add(H[q])})});const he={};return C(Object.keys(G)).forEach(H=>{he[H]=C(Array.from(G[H]))}),{values:he,keys:Object.keys(he)}}const ne=1e4;function C(_){return _.slice(0,ne)}},24162:(ze,we,t)=>{t.d(we,{$F:()=>ee,Bg:()=>Z,Cg:()=>c,E2:()=>v,FV:()=>Oe,H0:()=>P,MX:()=>C,OT:()=>H,QH:()=>y,Rn:()=>W,TQ:()=>Y,_i:()=>he,aw:()=>_,d_:()=>G,g5:()=>q,gy:()=>L,kr:()=>D,mW:()=>I,pS:()=>V,pk:()=>b,sI:()=>ne,sc:()=>j,tO:()=>f,vV:()=>ce});var e=t(2543),o=t.n(e),m=t(36195),s=t(76160),M=t(96426),$=t(12282);function P(d=""){const a=[],i=y(d,[m.PN]);for(const S of i){const Q=S.getChild(m.dJ)?.getChild(m.Sg),J=S.getChild(m.dJ)?.getChild(m.q5),R=x(S);if(!(!Q&&!J||!R.length))for(const r of R){const u=d.substring(r.from,r.to).trim(),g=u[0]==="`",w=u.substring(1,u.length-1);if(!w)continue;let k="";J?k=g?w:w.replace(/\\\\/g,"\\"):k=(0,e.escapeRegExp)(w),k&&a.push(k)}}return a}function I(d){return d.replace("Expr: ","")}function x(d){const a=[];let i=d;do{const S=i.getChild(m.Qf);S&&!i.getChild(m.w7)&&a.push(S),i=i.getChild(m.ih)}while(i!=null);return a}function ce(d){let a=O(d);const{instant:i,range:S,...Q}=d;try{ne(d.expr)&&a===$.U3.Instant&&(a=$.U3.Range)}catch{}return{...Q,queryType:a}}function O(d){const{queryType:a}=d;return a===$.U3.Range||a===$.U3.Instant||a===$.U3.Stream?a:d.instant===!0?$.U3.Instant:$.U3.Range}const h=["String","Identifier","LineComment","Number"],X=["__error__","__interval","__interval_ms","__auto"];function ee(d){let a=d;return m.K3.parse(d).iterate({enter:({name:S,from:Q,to:J})=>{const R=d.substring(Q,J);h.includes(S)&&!X.includes(R)&&(a=a.replace(R,S))}}),a}function K(d){const a=[];return parser.parse(d).iterate({enter:({name:S})=>{a.push(S)}}),a}function U(d,a){let i=!1;return m.K3.parse(d).iterate({enter:({type:Q})=>{if(Q.id===a)return i=!0,!1}}),i}function y(d,a){const i=[];return m.K3.parse(d).iterate({enter:Q=>{(a===void 0||a.includes(Q.type.id))&&i.push(Q.node)}}),i}function Y(d,a){const i=[];return m.K3.parse(d).iterate({enter:Q=>{(a===void 0||a.includes(Q.type.id))&&i.push(s.Ch.fromNode(Q.node))}}),i}function ae(d,a){const i=y(d,[a]);return i.length>0?i[0]:void 0}function Oe(d){return U(d,M.Ql)}function ne(d){return d.trim().length>2&&!U(d,m.Yw)}function C(d){const i=y(d,[m.iT,m.eF,m.c$]).length;return{queryWithParser:i>0,parserCount:i}}function _(d){const a=y(d,[m.iT,m.LM,m.c$]);return a.length>0?d.substring(a[0].from,a[0].to).trim():void 0}function G(d){const a=y(d,[m.bY]);for(const i of a){const S=i.getChild(m.g$)?.getChild(m.gw);if(S&&d.substring(S.from,S.to)==="__error__")return!0}return!1}function he(d){return U(d,m.J_)}function H(d){if(ne(d))return d;const a=ae(d,m.MD);if(!a)return"";const i=d.substring(a.from,a.to),S=ae(d,m.AL),Q=S?d.substring(S.from,S.to):"";return`${i} ${Q}`.trim()}function q(d,a){if(ne(d))return d;const i=y(d,[m.Yw]).reverse().find(S=>S.from<=a&&S.to>=a);return i?H(d.substring(i.from,i.to)):""}function V(d){return U(d,m.bY)}function W(d){return U(d,m.PN)}function c(d){const a=y(d,[m.Q6]);for(const i of a)if(d.substring(i.from,i.to).match(/\[\$__range(_s|_ms)?/))return!0;return!1}function b(d){return(0,s.yB)(d).map(S=>d.slice(S.from,S.to))}function L(d){return d.filter(i=>!i.hide).filter(i=>!i.refId.includes("do-not-chunk")).filter(i=>i.expr).length>0}function v(d){return d.filter(i=>!i.hide).filter(i=>i.queryType!==$.U3.Instant).filter(i=>!i.refId.includes("do-not-shard")).filter(i=>i.expr).filter(i=>i.direction===$.ti.Scan&&ne(i.expr)||p(i.expr)).length>0}function p(d){if(ne(d)||(d=d.trim().toLowerCase(),y(d,[m.MK]).length>0))return!1;const i=y(d,[m.ZQ]),S=i.filter(u=>n(d,u)==="sum"),Q=i.filter(u=>n(d,u)!=="sum"),J=S.filter(u=>Q.every(g=>u.from<g.from));if(Q.length>0)return J.length>0;const R=y(d,[m.lo]),r=["count_over_time","sum_over_time","bytes_over_time"];for(const u of R)if(!r.includes(n(d,u)))return J.length>0;return!0}function n(d,a){return d.substring(a.from,a.to)}const D=d=>d?"expr"in d&&d.expr!==void 0:!1,j=d=>{if(!(!d||!D(d)))return d},Z=(d,a)=>{if(a.length===0)return d;let i=a.join("|");return i==="-1"||a.length===1?(i=i==="-1"?"":i,d.map(S=>({...S,expr:E(S.expr,"=",i)}))):d.map(S=>({...S,expr:E(S.expr,"=~",i)}))};function E(d,a,i){const S=(0,s.tE)(d,"__stream_shard__",a,i,$.HD.Indexed);return ne(d)?S:(0,s.Gk)(S,["__stream_shard__"])}const f=d=>{const a=y(d,[m.MD]);return a.length>0?d.substring(a[0].from,a[0].to):""}},24728:(ze,we,t)=>{t.d(we,{D:()=>o});var e=t(74848);const o=({log:s})=>(0,e.jsx)(e.Fragment,{children:s.highlightedBodyTokens.map((M,$)=>(0,e.jsx)(m,{token:M},$))}),m=({token:s})=>typeof s=="string"?s:Array.isArray(s.content)?(0,e.jsx)("span",{className:`token ${s.type}`,children:s.content.map((M,$)=>(0,e.jsx)(m,{token:M},$))}):(0,e.jsx)("span",{className:`token ${s.type}`,children:typeof s.content=="string"?s.content:(0,e.jsx)(m,{token:s.content})})},25461:(ze,we,t)=>{t.d(we,{$:()=>ce});var e=t(74848),o=t(88838),m=t(96540),s=t(23257),M=t.n(s),$=t(38388),P=t(63142);function I(O,h){return h.split(/;\s*/).reduce((X,ee)=>{if(ee==="color:rgba(0,0,0,0.5)")return{color:O.colors.text.secondary};const K=ee.match(/([^:\s]+)\s*:\s*(.+)/);if(K&&K[1]&&K[2]){const U=K[1].replace(/-([a-z])/g,(y,Y)=>Y.toUpperCase());X[U]=K[2]}return X},{})}class x extends m.PureComponent{constructor(){super(...arguments),this.state={chunks:[],prevValue:""}}static getDerivedStateFromProps(h,X){return h.value===X.prevValue?null:{chunks:o.Ay.parse(h.value).spans.map(K=>K.css?{style:I(h.theme,K.css),text:K.text}:{text:K.text}),prevValue:h.value}}render(){const{chunks:h}=this.state;return h.map((X,ee)=>{const K=this.props.highlight?.searchWords?(0,e.jsx)(M(),{textToHighlight:X.text,searchWords:this.props.highlight.searchWords,findChunks:$.Oq,highlightClassName:this.props.highlight.highlightClassName},ee):X.text;return X.style?(0,e.jsx)("span",{style:X.style,"data-testid":"ansiLogLine",children:K},ee):K})}}const ce=(0,P.cV)(x);ce.displayName="LogMessageAnsi"},25984:(ze,we,t)=>{t.d(we,{Y:()=>D,z:()=>E});var e=t(74848),o=t(22803),m=t(33149),s=t(96540),M=t(92745),$=t(27489),P=t(18027),I=t(18857),x=t(46072),ce=t(63142),O=t(37386),h=t(63527);function X(f){return{searchWrap:(0,o.css)({padding:`${f.spacing(.4)} 0 ${f.spacing(.4)} ${f.spacing(.4)}`})}}function ee(f){const d=(0,ce.$j)(),a=X(d);return(0,e.jsx)(O.D,{className:a.searchWrap,children:(0,e.jsx)(h.p,{value:f.value,type:"text",placeholder:(0,M.t)("explore.logs-column-search.placeholder-search-fields-by-name","Search fields by name"),onChange:f.onChange})})}var K=t(67155),U=t(21835);function y(f){return{empty:(0,o.css)({marginBottom:f.spacing(2),marginLeft:f.spacing(1.75),fontSize:f.typography.fontSize})}}function Y(){const f=(0,ce.$j)(),d=y(f);return(0,e.jsx)("div",{className:d.empty,children:(0,e.jsx)(M.x6,{i18nKey:"explore.logs-table-empty-fields.no-fields",children:"No fields"})})}var ae=t(32635),Oe=t(30703);function ne(f){return{dragIcon:(0,o.css)({cursor:"drag",marginLeft:f.spacing(1),opacity:.4}),labelCount:(0,o.css)({marginLeft:f.spacing(.5),marginRight:f.spacing(.5),appearance:"none",background:"none",border:"none",fontSize:f.typography.pxToRem(11),opacity:.6}),contentWrap:(0,o.css)({display:"flex",alignItems:"center",justifyContent:"space-between",width:"100%"}),checkboxLabel:(0,o.css)({"> span":{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",display:"block",maxWidth:"100%"}})}}function C(f){const d=(0,ce.$j)(),a=ne(d);if(f.labels[f.label])return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsxs)("div",{className:a.contentWrap,children:[(0,e.jsx)(ae.S,{className:a.checkboxLabel,label:f.label,onChange:f.onChange,checked:f.labels[f.label]?.active??!1}),f.showCount&&(0,e.jsxs)("button",{className:a.labelCount,onClick:f.onChange,children:[f.labels[f.label]?.percentOfLinesWithLabel,"%"]})]}),f.draggable&&(0,e.jsx)(Oe.I,{"aria-label":(0,M.t)("explore.logs-table-nav-field.aria-label-drag-and-drop-icon","Drag and drop icon"),title:(0,M.t)("explore.logs-table-nav-field.title-drag-and-drop-to-reorder","Drag and drop to reorder"),name:"draggabledots",size:"lg",className:a.dragIcon})]})}function _(f){return{wrap:(0,o.css)({marginTop:f.spacing(1),marginBottom:f.spacing(1),display:"flex",background:f.colors.background.primary}),dragging:(0,o.css)({background:f.colors.background.secondary}),columnWrapper:(0,o.css)({marginBottom:f.spacing(1.5),paddingLeft:f.spacing(.5)})}}function G(f){return(d,a)=>{const i=f[d],S=f[a];return i.index!=null&&S.index!=null?i.index-S.index:0}}const he=f=>{const{reorderColumn:d,labels:a,valueFilter:i,toggleColumn:S}=f,Q=(0,ce.$j)(),J=_(Q),R=Object.keys(a).filter(g=>i(g)),r=g=>{g.destination&&d(g.source.index,g.destination.index)},u=g=>{const w=a[g];if(w)return`${g} appears in ${w?.percentOfLinesWithLabel}% of log lines`};return R.length?(0,e.jsx)(U.JY,{onDragEnd:r,children:(0,e.jsx)(U.gL,{droppableId:"order-fields",direction:"vertical",children:g=>(0,e.jsxs)("div",{className:J.columnWrapper,...g.droppableProps,ref:g.innerRef,children:[R.sort(G(a)).map((w,k)=>(0,e.jsx)(U.sx,{draggableId:w,index:k,children:(N,pe)=>(0,e.jsx)("div",{className:(0,o.cx)(J.wrap,pe.isDragging?J.dragging:void 0),ref:N.innerRef,...N.draggableProps,...N.dragHandleProps,title:u(w),children:(0,e.jsx)(C,{label:w,onChange:()=>S(w),labels:a,draggable:!0})})},w)),g.placeholder]})})}):(0,e.jsx)(Y,{})},H=new Intl.Collator(void 0,{sensitivity:"base"});function q(f){return(d,a)=>{const i=f[d],S=f[a];return i!=null&&S!=null?+(S.type==="TIME_FIELD")-+(i.type==="TIME_FIELD")||+(S.type==="BODY_FIELD")-+(i.type==="BODY_FIELD")||H.compare(d,a):0}}const V=f=>{const{labels:d,valueFilter:a,toggleColumn:i}=f,S=(0,ce.$j)(),Q=_(S),J=Object.keys(d).filter(R=>a(R));return J.length?(0,e.jsx)("div",{className:Q.columnWrapper,children:J.sort(q(d)).map((R,r)=>(0,e.jsx)("div",{className:Q.wrap,title:(0,M.t)("explore.logs-table-available-fields.title-label-percentage","{{labelName}} appears in {{percentage}}% of log lines",{labelName:R,percentage:d[R]?.percentOfLinesWithLabel}),children:(0,e.jsx)(C,{showCount:!0,label:R,onChange:()=>i(R),labels:d})},R))}):(0,e.jsx)(Y,{})};function W(f){return{sidebarWrap:(0,o.css)({overflowY:"scroll",height:"calc(100% - 50px)","&::-webkit-scrollbar":{display:"none"},scrollbarWidth:"none"}),columnHeaderButton:(0,o.css)({appearance:"none",background:"none",border:"none",fontSize:f.typography.pxToRem(11)}),columnHeader:(0,o.css)({display:"flex",justifyContent:"space-between",fontSize:f.typography.h6.fontSize,background:f.colors.background.secondary,position:"sticky",top:0,left:0,paddingTop:f.spacing(.75),paddingRight:f.spacing(.75),paddingBottom:f.spacing(.75),paddingLeft:f.spacing(1.5),zIndex:3,marginBottom:f.spacing(2)})}}const c=f=>{const d=(0,ce.$j)(),a=W(d);return(0,e.jsx)("div",{className:a.sidebarWrap,children:(0,e.jsxs)(e.Fragment,{children:[(0,e.jsxs)("div",{className:a.columnHeader,children:[(0,e.jsx)(M.x6,{i18nKey:"explore.logs-table-multi-select.selected-fields",children:"Selected fields"}),(0,e.jsx)("button",{onClick:f.clear,className:a.columnHeaderButton,children:(0,e.jsx)(M.x6,{i18nKey:"explore.logs-table-multi-select.reset",children:"Reset"})})]}),(0,e.jsx)(he,{reorderColumn:f.reorderColumn,toggleColumn:f.toggleColumn,labels:f.filteredColumnsWithMeta??f.columnsWithMeta,valueFilter:i=>f.columnsWithMeta[i]?.active??!1,id:"selected-fields"}),(0,e.jsx)("div",{className:a.columnHeader,children:(0,e.jsx)(M.x6,{i18nKey:"explore.logs-table-multi-select.fields",children:"Fields"})}),(0,e.jsx)(V,{toggleColumn:f.toggleColumn,labels:f.filteredColumnsWithMeta??f.columnsWithMeta,valueFilter:i=>!f.columnsWithMeta[i]?.active})]})})};var b=t(84139),L=t(2543);const v=new b.A({intraMode:1,intraIns:1,intraSub:1,intraTrn:1,intraDel:1});function p(f,d,a){const[i,S,Q]=v.search(f,d,0,1e5);let J=[],R=new Set;if(i&&Q){const r=(u,g)=>{g&&R.add(u)};for(let u=0;u<Q.length;u++){let g=Q[u];b.A.highlight(f[S.idx[g]],S.ranges[g],r),J.push(f[S.idx[g]])}a([J,[...R]])}else d||a([[],[]])}const n=(0,L.debounce)(p,300);function D(f){const{logsFrames:d,updatePanelState:a,panelState:i}=f,S=i?.columns,[Q,J]=(0,s.useState)(void 0),[R,r]=(0,s.useState)(void 0),[u,g]=(0,s.useState)(""),w=E(),k=f?.panelState?.refId,[N,pe]=(0,s.useState)(d.find(z=>z.refId===k)??d[0]),re=(0,s.useCallback)(z=>{const Ee=f.panelState?.columns;return Ee&&Object.values(Ee).forEach((te,Ce)=>{z[te]&&(z[te].active=!0,z[te].index=Ce)}),z},[f.panelState?.columns]),le=(0,x.Os)(N);(0,s.useEffect)(()=>{if(le?.timeField.name&&le?.bodyField.name&&!S){const z={0:le?.timeField.name??"",1:le?.bodyField.name??""};a({columns:Object.values(z),visualisationType:"table",labelFieldName:le?.getLabelFieldName()??void 0})}},[le,S,a]),(0,s.useEffect)(()=>{const z=d.find(Ee=>Ee.refId===k)??d[0];z&&pe(z)},[d,k]),(0,s.useEffect)(()=>{if(!Q||!R)return;let z={...R},Ee=!1;Object.keys(Q).forEach(te=>{z[te]&&z[te].active!==Q[te].active&&(z[te]=Q[te],Ee=!0)}),Ee&&r(z)},[Q,R]),(0,s.useEffect)(()=>{if(!N.length)return;const z=N?N.length:0,Ee=(0,x.Os)(N),te=Ee?.getLogFrameLabelsAsLabels(),Ce=[];Ee&&Ce.push(...Ee.extraFields.filter(je=>!je?.config?.custom?.hidden)),Ee?.severityField&&Ce.push(Ee?.severityField),Ee?.bodyField&&Ce.push(Ee?.bodyField),Ee?.timeField&&Ce.push(Ee?.timeField);const me=new Map;let Le={};te?.length&&z&&(te.forEach(je=>{Object.keys(je).forEach(T=>{if(me.has(T)){const A=me.get(T);A&&(A?.active?me.set(T,{percentOfLinesWithLabel:A.percentOfLinesWithLabel+1,active:!0,index:A.index}):me.set(T,{percentOfLinesWithLabel:A.percentOfLinesWithLabel+1,active:!1,index:void 0}))}else me.set(T,{percentOfLinesWithLabel:1,active:!1,index:void 0})})}),Le=Object.fromEntries(me),Object.keys(Le).forEach(je=>{Le[je].percentOfLinesWithLabel=j(Le[je].percentOfLinesWithLabel,z)})),Ce.forEach(je=>{const Me=Le[je.name]?.active,T=Le[je.name]?.index;Me&&T!==void 0?Le[je.name]={percentOfLinesWithLabel:j(je.values.filter(A=>A!=null).length,z),active:!0,index:T}:Le[je.name]={percentOfLinesWithLabel:j(je.values.filter(A=>A!=null).length,z),active:!1,index:void 0}}),Le=re(Le),Object.keys(Le).filter(je=>Le[je].active).length===0&&(Ee?.bodyField?.name&&(Le[Ee.bodyField.name].active=!0),Ee?.timeField?.name&&(Le[Ee.timeField.name].active=!0)),Ee?.bodyField?.name&&Ee?.timeField?.name&&(Le[Ee.bodyField.name].type="BODY_FIELD",Le[Ee.timeField.name].type="TIME_FIELD"),J(Le)},[N,re]);const[Te,xe]=(0,s.useState)(220),l=f.width-Te;if(!Q)return null;function B(z){if(Q){const Ee=!Q[z]?.active,te=Object.keys(Q).filter(me=>Q[me]?.active)?.length,Ce={columnAction:Ee?"add":"remove",columnCount:Ee?te+1:te-1,datasourceType:f.datasourceType};(0,$.rR)("grafana_explore_logs_table_column_filter_clicked",Ce)}}function oe(z){(0,$.rR)("grafana_explore_logs_table_text_search_result_count",{resultCount:z,datasourceType:f.datasourceType??"unknown"})}const F=()=>{const z={...Q};let Ee=0;Object.keys(z).forEach(te=>{const Ce=!!z[te].type;z[te].active=Ce,z[te].index=Ce?Ee++:void 0}),J(z)},de=(z,Ee)=>{if(z===Ee)return;const te={...Q},Ce=Object.keys(te).filter(Le=>te[Le].active).map(Le=>({fieldName:Le,index:te[Le].index??0})).sort((Le,_e)=>Le.index-_e.index),[me]=Ce.splice(z,1);Ce.splice(Ee,0,me),Ce.forEach((Le,_e)=>{te[Le.fieldName].index=_e}),J(te),be(te)};function be(z){const Ee=Object.keys(z).filter(Le=>z[Le]?.active).sort((Le,_e)=>{const je=z[Le],Me=z[_e];return je.index!==void 0&&Me.index!==void 0?je.index-Me.index:0}),te=Object.assign({},Ee),Ce={0:le?.timeField.name??"",1:le?.bodyField.name??""},me={...f.panelState,columns:Object.keys(te).length?te:Ce,refId:N.refId,visualisationType:"table",labelFieldName:le?.getLabelFieldName()??void 0};a(me)}const Se=z=>{if(!Q||!(z in Q)){console.warn("failed to get column",Q);return}const Ee=Object.keys(Q).filter(me=>Q[me].active).length,te=Q[z].active?void 0:!0;let Ce;if(te?Ce={...Q,[z]:{...Q[z],active:te,index:Ee}}:Ce={...Q,[z]:{...Q[z],active:!1,index:void 0}},B(z),J(Ce),R){const me=!R[z]?.active;let Le;me?Le={...R,[z]:{...R[z],active:me,index:Ee}}:Le={...R,[z]:{...R[z],active:!1,index:void 0}},r(Le)}be(Ce)},We=z=>{const Ee=z[0];let te={},Ce=0;Ee.forEach(me=>{me in Q&&(te[me]=Q[me],Ce++)}),r(te),oe(Ce)},Qe=z=>{p(Object.keys(Q),z,We)},Ae=z=>{const Ee=z.currentTarget?.value;g(Ee),Ee?Qe(Ee):r(void 0)},Pe=z=>{d.find(te=>te.refId===z.value)&&pe(d.find(te=>te.refId===z.value)??d[0]),f.updatePanelState({refId:z.value,labelFieldName:le?.getLabelFieldName()??void 0})},Ie=Z(f.theme,w,Te),Be=(z,Ee,te)=>{const Ce=Number(te.style.width.slice(0,-2));isNaN(Ce)||xe(Ce)};return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("div",{children:d.length>1&&(0,e.jsx)("div",{children:(0,e.jsx)(P.I,{label:(0,M.t)("explore.logs-table-wrap.label-select-query","Select query"),htmlFor:"explore_logs_table_frame_selector",labelWidth:22,tooltip:(0,M.t)("explore.logs-table-wrap.tooltip-select-query-visualize-table","Select a query to visualize in the table"),children:(0,e.jsx)(I.l6,{inputId:"explore_logs_table_frame_selector","aria-label":(0,M.t)("explore.logs-table-wrap.aria-label-select-query-by-name","Select query by name"),value:N.refId,options:d.map(z=>({label:z.refId,value:z.refId})),onChange:Pe})})})}),(0,e.jsxs)("div",{className:Ie.wrapper,children:[(0,e.jsx)(m.c,{enable:{right:!0},handleClasses:{right:Ie.rzHandle},onResize:Be,children:(0,e.jsxs)("section",{className:Ie.sidebar,children:[(0,e.jsx)(ee,{value:u,onChange:Ae}),(0,e.jsx)(c,{reorderColumn:de,toggleColumn:Se,filteredColumnsWithMeta:R,columnsWithMeta:Q,clear:F})]})}),(0,e.jsx)(K.O,{logsFrame:le,onClickFilterLabel:f.onClickFilterLabel,onClickFilterOutLabel:f.onClickFilterOutLabel,logsSortOrder:f.logsSortOrder,range:f.range,splitOpen:f.splitOpen,timeZone:f.timeZone,width:l,dataFrame:N,columnsWithMeta:Q,height:w})]})]})}const j=(f,d)=>Math.ceil(100*f/d);function Z(f,d,a){return{wrapper:(0,o.css)({display:"flex"}),sidebar:(0,o.css)({height:d,fontSize:f.typography.pxToRem(11),overflowY:"hidden",width:a,paddingRight:f.spacing(3)}),rzHandle:(0,o.css)({background:f.colors.secondary.main,[f.transitions.handleMotion("no-preference","reduce")]:{transition:"0.3s background ease-in-out"},position:"relative",height:"50% !important",width:`${f.spacing(1)} !important`,top:"25% !important",right:`${f.spacing(1)} !important`,cursor:"grab",borderRadius:f.shape.radius.pill,"&:hover":{background:f.colors.secondary.shade}})}}const E=()=>Math.max(window.innerHeight-500,500)},27789:(ze,we,t)=>{t.d(we,{V:()=>v});var e=t(74848),o=t(22803),m=t(2543),s=t(96540),M=t(16817),$=t(28105),P=t(739),I=t(67770),x=t(25229),ce=t(92745),O=t(27489),h=t(43173),X=t(63142),ee=t(22787),K=t(45861),U=t(29043),y=t(70159),Y=t(35231),ae=t(52763),Oe=t(37234),ne=t(74746),C=t(82212),_=t(48575),G=t(21285);function he(p){return{buttons:(0,o.css)({display:"flex",gap:p.spacing(1)})}}const H=p=>{const n=(0,X.of)(he),{wrapLines:D,onChangeWrapLines:j,onScrollCenterClick:Z}=p,E=(0,s.useCallback)(f=>{const d=f.currentTarget.checked;(0,O.rR)("grafana_explore_logs_log_context_toggle_lines_clicked",{state:d}),j(d)},[j]);return(0,e.jsxs)("div",{className:n.buttons,children:[(0,e.jsx)(G.K,{showLabel:!0,value:D,onChange:E,label:(0,ce.t)("logs.log-context-buttons.label-wrap-lines","Wrap lines")}),(0,e.jsx)(K.$n,{variant:"secondary",onClick:Z,children:(0,e.jsx)(ce.x6,{i18nKey:"logs.log-context-buttons.center-matched-line",children:"Center matched line"})})]})},q=p=>({modal:(0,o.css)({width:"85vw",[p.breakpoints.down("md")]:{width:"100%"},top:"50%",left:"50%",transform:"translate(-50%, -50%)"}),sticky:(0,o.css)({position:"sticky",zIndex:1,top:"-1px",bottom:"-1px"}),entry:(0,o.css)({"& > td":{padding:p.spacing(1,0,1,0)},background:p.colors.emphasize(p.colors.background.secondary),"& > table":{marginBottom:0},"& .log-row-menu":{marginTop:"-6px"}}),datasourceUi:(0,o.css)({paddingBottom:p.spacing(1.25),display:"flex",alignItems:"center"}),logRowGroups:(0,o.css)({overflow:"auto",maxHeight:"75%",alignSelf:"stretch",display:"inline-block",border:`1px solid ${p.colors.border.weak}`,borderRadius:p.shape.radius.default,"& > table":{minWidth:"100%"}}),flexColumn:(0,o.css)({display:"flex",flexDirection:"column",padding:p.spacing(0,3,3,3)}),flexRow:(0,o.css)({display:"flex",flexDirection:"row",alignItems:"center","& > div:last-child":{marginLeft:"auto"}}),noMarginBottom:(0,o.css)({"& > table":{marginBottom:0}}),hidden:(0,o.css)({display:"none"}),paddingTop:(0,o.css)({paddingTop:p.spacing(1)}),paddingBottom:(0,o.css)({paddingBottom:p.spacing(1)}),link:(0,o.css)({color:p.colors.text.secondary,fontSize:p.typography.bodySmall.fontSize,":hover":{color:p.colors.text.link}}),loadingCell:(0,o.css)({position:"sticky",left:"50%",display:"inline-block",transform:"translateX(-50%)"})}),V=()=>({above:{loadingState:$.Gu.NotStarted,rows:[]},below:{loadingState:$.Gu.NotStarted,rows:[]}}),W=(p,n)=>p==="above"&&n===P.uH.Descending||p==="below"&&n===P.uH.Ascending?I.ZF.Forward:I.ZF.Backward,c=(p,n)=>({...p,dataFrame:{...p.dataFrame,refId:`context_${n.above}_${n.below}`}}),b=(p,n)=>p.some(D=>D.entry===n.entry&&D.timeEpochNs===n.timeEpochNs),L=100,v=({row:p,open:n,logsSortOrder:D,timeZone:j,getLogRowContextUi:Z,getRowContextQuery:E,onClose:f,getRowContext:d})=>{const a=(0,s.useRef)(null),i=(0,s.useRef)(null),S=(0,s.useRef)(null),Q=(0,s.useRef)(null),J=(0,s.useRef)(null),R=(0,s.useRef)(null),r=(0,s.useRef)(null),u=(0,s.useRef)({above:0,below:0}),g=(0,ae.wA)(),w=(0,X.$j)(),k=q(w),[N,pe]=(0,s.useState)(!0),[re,le]=(0,s.useState)(V()),Te=(me,Le)=>{le(_e=>{const je={..._e};return je[me]=Le(_e[me]),je})},xe=(0,s.useRef)(1),[l,B]=(0,s.useState)(null),[oe,F]=(0,s.useState)(U.A.getBool(y.$Z.logContextWrapLogMessage,U.A.getBool(y.$Z.wrapLogMessage,!0))),de=(0,s.useCallback)(()=>{const{below:me,above:Le}=re,_e=(0,ne.oR)([...me.rows,p,...Le.rows],P.uH.Ascending),je=_e[0].timeEpochMs;let Me=_e[_e.length-1].timeEpochMs;je===Me&&(Me+=1);const T=(0,x.KQ)(je),A=(0,x.KQ)(Me);return{from:T,to:A,raw:{from:T,to:A}}},[re,p]),be=(0,s.useCallback)(async()=>{const me=E?await E(p):null;B(me)},[p,E]),Se=async()=>{await be(),le(V()),u.current={above:0,below:0},xe.current+=1},We=async(me,Le)=>{u.current[me]+=1;const _e=Le.at(me==="above"?0:-1);if(_e==null)throw new Error("should never happen. the array always contains at least 1 item (the middle row)");(0,O.rR)("grafana_explore_logs_log_context_load_more_called",{datasourceType:_e.datasourceType,above:u.current.above,below:u.current.below});const je=W(me,D),Me=await d(c(_e,u.current),{limit:L,direction:je}),T=(0,Oe.HT)(Me.data).rows;return D===P.uH.Ascending&&T.reverse(),T.filter(ge=>!b(Le,ge))};(0,s.useEffect)(()=>{n&&be()},[be,n]);const[Qe,Ae]=(0,s.useState)([]),Pe=me=>{Qe.indexOf(me)===-1&&Ae([...Qe,me])},Ie=me=>{const Le=Qe.indexOf(me);Le>-1&&(Qe.splice(Le,1),Ae([...Qe]))},Be=async me=>{const{below:Le,above:_e}=re;if(re[me].loadingState===$.Gu.Loading)return;Te(me,T=>({...T,loadingState:$.Gu.Loading}));const Me=xe.current;try{const T=[..._e.rows,p,...Le.rows],A=(await We(me,T)).map(fe=>!fe.searchWords||!fe.searchWords?.length?{...fe,searchWords:p.searchWords}:fe),[ge,se]=(0,m.partition)(A,fe=>fe.timeEpochNs>p.timeEpochNs),$e=D===P.uH.Ascending?se:ge,ie=D===P.uH.Ascending?ge:se;Me===xe.current&&le(fe=>{const ue=$e.length>0?(0,ne.oR)([...$e,...fe.above.rows],D):fe.above.rows,ve=ie.length>0?(0,ne.oR)([...fe.below.rows,...ie],D):fe.below.rows;return{above:{rows:ue,loadingState:me==="above"?A.length===0?$.Gu.Done:$.Gu.NotStarted:fe.above.loadingState},below:{rows:ve,loadingState:me==="below"?A.length===0?$.Gu.Done:$.Gu.NotStarted:fe.below.loadingState}}})}catch{Te(me,T=>({rows:T.rows,loadingState:$.Gu.Error}))}},z=async(me,Le)=>{for(const _e of me){if(!_e.isIntersecting)continue;const je=_e.target;je===R.current?Be("above"):je===r.current&&Be("below")}};(0,s.useEffect)(()=>{const me=a.current,Le=R.current,_e=r.current;if(me==null)return;const je=new IntersectionObserver(z,{root:me});return Le!=null&&je.observe(Le),_e!=null&&je.observe(_e),()=>{je.disconnect()}});const Ee=(0,s.useCallback)(()=>{S.current?.scrollIntoView({block:"center"}),i.current?.scrollIntoView({block:"center"})},[S,i]);(0,s.useLayoutEffect)(()=>{const me=a.current;if(me==null)return;const Le=J.current,_e=me.clientHeight;if(J.current=_e,Le!==_e){Ee();return}if(u.current.above<=1&&u.current.below<=1){Ee();return}const je=Q.current,Me=me.scrollHeight;if(Q.current=Me,je!=null){const T=me.scrollTop+(Me-je);me.scrollTop=T}},[re.above.rows,Ee]),(0,M.A)(be,[E,p]);const te=re.above.loadingState,Ce=re.below.loadingState;return(0,e.jsxs)(ee.a,{isOpen:n,title:(0,ce.t)("logs.log-row-context-modal.title-log-context","Log context"),contentClassName:k.flexColumn,className:k.modal,onDismiss:f,children:[h.$.featureToggles.logsContextDatasourceUi&&Z&&(0,e.jsx)("div",{className:k.datasourceUi,children:Z(p,Se)}),(0,e.jsx)("div",{className:(0,o.cx)(k.flexRow,k.paddingBottom),children:(0,e.jsx)("div",{children:(0,e.jsx)(H,{wrapLines:oe,onChangeWrapLines:F,onScrollCenterClick:Ee})})}),(0,e.jsx)("div",{ref:a,className:k.logRowGroups,children:(0,e.jsx)("table",{children:(0,e.jsxs)("tbody",{children:[(0,e.jsx)("tr",{children:(0,e.jsxs)("td",{className:k.loadingCell,children:[te!==$.Gu.Done&&te!==$.Gu.Error&&(0,e.jsx)("div",{ref:R,children:(0,e.jsx)(C.I,{adjective:"newer"})}),te===$.Gu.Error&&(0,e.jsx)("div",{children:(0,e.jsx)(ce.x6,{i18nKey:"logs.log-row-context-modal.error-loading-log-more-logs",children:"Error loading more logs."})}),te===$.Gu.Done&&(0,e.jsx)("div",{children:(0,e.jsx)(ce.x6,{i18nKey:"logs.log-row-context-modal.no-more-logs-available",children:"No more logs available."})})]})}),(0,e.jsx)("tr",{children:(0,e.jsx)("td",{className:k.noMarginBottom,children:(0,e.jsx)(_.k,{logRows:re.above.rows,dedupStrategy:P.fY.none,showLabels:U.A.getBool(y.$Z.showLabels,!1),showTime:U.A.getBool(y.$Z.showTime,!0),wrapLogMessage:oe,prettifyLogMessage:U.A.getBool(y.$Z.prettifyLogMessage,!1),enableLogDetails:!0,timeZone:j,displayedFields:Qe,onClickShowField:Pe,onClickHideField:Ie,scrollElement:null})})}),(0,e.jsx)("tr",{ref:S}),(0,e.jsx)("tr",{ref:i,className:(0,o.cx)(k.entry,N?k.sticky:null),"data-testid":"entry-row",children:(0,e.jsx)("td",{className:k.noMarginBottom,children:(0,e.jsx)(_.k,{logRows:[p],dedupStrategy:P.fY.none,showLabels:U.A.getBool(y.$Z.showLabels,!1),showTime:U.A.getBool(y.$Z.showTime,!0),wrapLogMessage:oe,prettifyLogMessage:U.A.getBool(y.$Z.prettifyLogMessage,!1),enableLogDetails:!0,timeZone:j,displayedFields:Qe,onClickShowField:Pe,onClickHideField:Ie,onUnpinLine:()=>pe(!1),onPinLine:()=>pe(!0),pinnedLogs:N?[p.uid]:void 0,overflowingContent:!0,scrollElement:null})})}),(0,e.jsx)("tr",{children:(0,e.jsx)("td",{children:(0,e.jsx)(e.Fragment,{children:(0,e.jsx)(_.k,{logRows:re.below.rows,dedupStrategy:P.fY.none,showLabels:U.A.getBool(y.$Z.showLabels,!1),showTime:U.A.getBool(y.$Z.showTime,!0),wrapLogMessage:oe,prettifyLogMessage:U.A.getBool(y.$Z.prettifyLogMessage,!1),enableLogDetails:!0,timeZone:j,displayedFields:Qe,onClickShowField:Pe,onClickHideField:Ie,scrollElement:null})})})}),(0,e.jsx)("tr",{children:(0,e.jsxs)("td",{className:k.loadingCell,children:[Ce!==$.Gu.Done&&Ce!==$.Gu.Error&&(0,e.jsx)("div",{ref:r,children:(0,e.jsx)(C.I,{adjective:"older"})}),Ce===$.Gu.Error&&(0,e.jsx)("div",{children:(0,e.jsx)(ce.x6,{i18nKey:"logs.log-row-context-modal.error-loading-log-more-logs",children:"Error loading more logs."})}),Ce===$.Gu.Done&&(0,e.jsx)("div",{children:(0,e.jsx)(ce.x6,{i18nKey:"logs.log-row-context-modal.no-more-logs-available",children:"No more logs available."})})]})})]})})}),(0,e.jsx)(ee.a.ButtonRow,{children:l?.datasource?.uid&&(0,e.jsx)(K.$n,{variant:"secondary",onClick:async()=>{let me=p.uid;p.dataFrame.refId&&(me=p.uid.replace(p.dataFrame.refId,l.refId)),g((0,Y.ve)({queries:[l],range:de(),datasourceUid:l.datasource.uid,panelsState:{logs:{id:me}}})),f(),(0,O.rR)("grafana_explore_logs_log_context_open_split_view_clicked",{datasourceType:p.datasourceType,logRowUid:p.uid})},children:(0,e.jsx)(ce.x6,{i18nKey:"logs.log-row-context-modal.open-in-split-view",children:"Open in split view"})})})]})}},29229:(ze,we,t)=>{t.d(we,{y:()=>ce});var e=t(74848),o=t(22803),m=t(96540),s=t(92745),M=t(63142);const $=O=>({logsStatsRow:(0,o.css)({label:"logs-stats-row",margin:`${parseInt(O.spacing(2),10)/1.75}px 0`}),logsStatsRowActive:(0,o.css)({label:"logs-stats-row--active",color:O.colors.primary.text,position:"relative"}),logsStatsRowLabel:(0,o.css)({label:"logs-stats-row__label",display:"flex",marginBottom:"1px"}),logsStatsRowValue:(0,o.css)({label:"logs-stats-row__value",flex:1,textOverflow:"ellipsis",overflow:"hidden"}),logsStatsRowCount:(0,o.css)({label:"logs-stats-row__count",textAlign:"right",marginLeft:O.spacing(.75)}),logsStatsRowPercent:(0,o.css)({label:"logs-stats-row__percent",textAlign:"right",marginLeft:O.spacing(.75),width:O.spacing(4.5)}),logsStatsRowBar:(0,o.css)({label:"logs-stats-row__bar",height:O.spacing(.5),overflow:"hidden",background:O.colors.text.disabled}),logsStatsRowInnerBar:(0,o.css)({label:"logs-stats-row__innerbar",height:O.spacing(.5),overflow:"hidden",background:O.colors.primary.main})}),P=({active:O,count:h,proportion:X,value:ee})=>{const K=(0,M.of)($),U=`${Math.round(X*100)}%`,y={width:U},Y=O?(0,o.cx)([K.logsStatsRow,K.logsStatsRowActive]):(0,o.cx)([K.logsStatsRow]);return(0,e.jsxs)("div",{className:Y,children:[(0,e.jsxs)("div",{className:(0,o.cx)([K.logsStatsRowLabel]),children:[(0,e.jsx)("div",{className:(0,o.cx)([K.logsStatsRowValue]),title:ee,children:ee}),(0,e.jsx)("div",{className:(0,o.cx)([K.logsStatsRowCount]),children:h}),(0,e.jsx)("div",{className:(0,o.cx)([K.logsStatsRowPercent]),children:U})]}),(0,e.jsx)("div",{className:(0,o.cx)([K.logsStatsRowBar]),children:(0,e.jsx)("div",{className:(0,o.cx)([K.logsStatsRowInnerBar]),style:y})})]})};P.displayName="LogLabelStatsRow";const I=5,x=O=>({logsStats:(0,o.css)({label:"logs-stats",background:"inherit",color:O.colors.text.primary,wordBreak:"break-all",width:"fit-content",maxWidth:"100%"}),logsStatsHeader:(0,o.css)({label:"logs-stats__header",borderBottom:`1px solid ${O.colors.border.medium}`,display:"flex"}),logsStatsTitle:(0,o.css)({label:"logs-stats__title",fontWeight:O.typography.fontWeightMedium,paddingRight:O.spacing(2),display:"inline-block",whiteSpace:"nowrap",textOverflow:"ellipsis",flexGrow:1}),logsStatsClose:(0,o.css)({label:"logs-stats__close",cursor:"pointer"}),logsStatsBody:(0,o.css)({label:"logs-stats__body",padding:"5px 0px"})}),ce=({className:O,label:h,rowCount:X,stats:ee,value:K,isLabel:U})=>{const y=(0,M.of)(x),Y=(0,m.useMemo)(()=>{const _=ee.slice(0,I);let G=_.find(q=>q.value===K),he=ee.slice(I);const H=!G;return H&&(G=he.find(q=>q.value===K),he=he.filter(q=>q.value!==K)),{topRows:_,otherRows:he,insertActiveRow:H,activeRow:G}},[ee,K]),ae=(0,m.useMemo)(()=>Y.otherRows.reduce((_,G)=>_+G.count,0),[Y.otherRows]),ne=(0,m.useMemo)(()=>Y.topRows.reduce((_,G)=>_+G.count,0),[Y.topRows])+ae,C=ae/ne;return(0,e.jsxs)("div",{className:O??y.logsStats,"data-testid":"logLabelStats",children:[(0,e.jsx)("div",{className:y.logsStatsHeader,children:(0,e.jsx)("div",{className:y.logsStatsTitle,children:U?(0,s.t)("logs.un-themed-log-label-stats.label-log-stats","{{label}}: {{total}} of {{rowCount}} rows have that label",{label:h,total:ne,rowCount:X}):(0,s.t)("logs.un-themed-log-label-stats.field-log-stats","{{label}}: {{total}} of {{rowCount}} rows have that field")})}),(0,e.jsxs)("div",{className:y.logsStatsBody,children:[Y.topRows.map(_=>(0,e.jsx)(P,{..._,active:_.value===K},_.value)),Y.insertActiveRow&&Y.activeRow&&(0,e.jsx)(P,{...Y.activeRow,active:!0},Y.activeRow.value),ae>0&&(0,e.jsx)(P,{count:ae,value:"Other",proportion:C},"__OTHERS__")]})]})}},29457:(ze,we,t)=>{t.d(we,{AN:()=>V,KB:()=>he,Q4:()=>G,cQ:()=>C,fl:()=>Oe,u0:()=>ne,vv:()=>_,zB:()=>W});var e=t(74848),o=t(2543),m=t.n(o),s=t(96540),M=t(82679),$=t.n(M),P=t(739),I=t(76732),x=t(78012),ce=t(1906),O=t(92745),h=t(43173),X=t(78282),ee=t(74746),K=t(88152),U=t(58640),y=t(55439);const Y=(0,s.createContext)({app:ce.Jk.Unknown,closeDetails:()=>{},dedupStrategy:P.fY.none,detailsDisplayed:()=>!1,detailsMode:"sidebar",detailsWidth:0,displayedFields:[],downloadLogs:()=>{},enableLogDetails:!1,filterLevels:[],forceEscape:!1,fontSize:"default",hasUnescapedContent:!1,noInteractions:!1,setDedupStrategy:()=>{},setDetailsMode:()=>{},setDetailsWidth:()=>{},setFilterLevels:()=>{},setFontSize:()=>{},setForceEscape:()=>{},setLogListState:()=>{},setPinnedLogs:()=>{},setPrettifyJSON:()=>{},setShowTime:()=>{},setShowUniqueLabels:()=>{},setSortOrder:()=>{},setSyntaxHighlighting:()=>{},setTimestampResolution:()=>{},setWrapLogMessage:()=>{},showDetails:[],showTime:!0,sortOrder:P.uH.Ascending,syntaxHighlighting:!0,timestampResolution:"ns",toggleDetails:()=>{},wrapLogMessage:!1,isAssistantAvailable:!1,openAssistantByLog:()=>{}}),ae=v=>useContext(Y)[v],Oe=()=>(0,s.useContext)(Y),ne=v=>{const{pinnedLogs:p}=(0,s.useContext)(Y);return p?.some(n=>n===v.rowId)},C=v=>{const{permalinkedLogId:p}=(0,s.useContext)(Y);return p&&p===v.uid},_=({app:v,children:p,containerElement:n,enableLogDetails:D,logOptionsStorageKey:j,detailsMode:Z=j?x.M.get(`${j}.detailsMode`):L(n),dedupStrategy:E,displayedFields:f,filterLevels:d,fontSize:a,isLabelFilterActive:i,getRowContextQuery:S,logs:Q,logLineMenuCustomItems:J,logsMeta:R,logSupportsContext:r,noInteractions:u,onClickFilterLabel:g,onClickFilterOutLabel:w,onClickFilterString:k,onClickFilterOutString:N,onClickShowField:pe,onClickHideField:re,onLogOptionsChange:le,onLogLineHover:Te,onPermalinkClick:xe,onPinLine:l,onOpenContext:B,onUnpinLine:oe,permalinkedLogId:F,pinLineButtonTooltipTitle:de,pinnedLogs:be,prettifyJSON:Se=j?x.M.getBool(`${j}.prettifyLogMessage`,!0):!0,setDisplayedFields:We,showControls:Qe,showTime:Ae,showUniqueLabels:Pe,sortOrder:Ie,syntaxHighlighting:Be,timestampResolution:z=j?x.M.get(`${j}.timestampResolution`)??"ms":"ms",wrapLogMessage:Ee})=>{const[te,Ce]=(0,s.useState)({dedupStrategy:E,filterLevels:d??(j?x.M.getObject(`${j}.filterLevels`,[]):[]),fontSize:a,forceEscape:j?x.M.getBool(`${j}.forceEscape`,!1):!1,pinnedLogs:be,showTime:Ae,showUniqueLabels:Pe,sortOrder:Ie,syntaxHighlighting:Be,timestampResolution:z}),[me,Le]=(0,s.useState)([]),[_e,je]=(0,s.useState)(H(n,j,void 0,Z,Qe)),[Me,T]=(0,s.useState)(Z??L(n)),[A,ge]=(0,M.useAssistant)(),[se,$e]=(0,s.useState)(Se),[ie,fe]=(0,s.useState)(Ee);(0,s.useEffect)(()=>{u||(0,U.A)(`logs_log_list_${v}_logs_displayed`,{dedupStrategy:E,fontSize:a,forceEscape:te.forceEscape,showTime:Ae,syntaxHighlighting:Be,wrapLogMessage:ie,detailsWidth:_e,detailsMode:Me,withDisplayedFields:f.length>0,timestampResolution:te.timestampResolution})},[]),(0,s.useEffect)(()=>{if(f.length>0||!h.$.featureToggles.otelLogsFormatting||!We)return;const ye=(0,K.$x)(Q);ye.length&&We(ye)},[f.length,Q,We]),(0,s.useEffect)(()=>{if(Qe&&v!==ce.Jk.PanelEditor)return;const ye={...te,dedupStrategy:E,showTime:Ae,sortOrder:Ie,syntaxHighlighting:Be,wrapLogMessage:ie};(0,I.ab)(te,ye)||Ce(ye)},[v,E,te,be,Qe,Ae,Ie,Be,ie]),(0,s.useEffect)(()=>{d!==void 0&&Ce(ye=>(0,I.ab)(ye.filterLevels,d)?ye:{...ye,filterLevels:d})},[d]),(0,s.useEffect)(()=>{Ce(ye=>({...ye,fontSize:a}))},[a]),(0,s.useEffect)(()=>{(0,I.ab)(te.pinnedLogs??[],be??[])||Ce({...te,pinnedLogs:be})},[te,be]),(0,s.useEffect)(()=>{if(!me.length)return;const ye=me.filter(He=>Q.findIndex(Re=>Re.uid===He.uid)>=0);ye.length!==me.length&&Le(ye)},[Q,me]),(0,s.useEffect)(()=>{je(H(n,j,void 0,Me,Qe))},[n,Me,j,Qe]),(0,s.useEffect)(()=>{if(!n)return;const ye=(0,o.debounce)(()=>{je(Re=>H(n,j,Re,Me,Qe))},50),He=new ResizeObserver(()=>ye());return He.observe(n),()=>He.disconnect()},[n,Me,j,Qe]),(0,s.useEffect)(()=>{Ce(ye=>({...ye,timestampResolution:z}))},[z]);const ue=(0,s.useCallback)(ye=>!!me.find(He=>He.uid===ye.uid),[me]),ve=(0,s.useCallback)(ye=>{Ce({...te,dedupStrategy:ye}),le?.("dedupStrategy",ye)},[te,le]),De=(0,s.useCallback)(ye=>{j&&x.M.set(`${j}.fontSize`,ye),Ce(He=>({...He,fontSize:ye})),le?.("fontSize",ye)},[j,le]),Ne=(0,s.useCallback)(ye=>{Ce({...te,forceEscape:ye})},[te]),Xe=(0,s.useCallback)(ye=>{Ce({...te,filterLevels:ye}),le?.("filterLevels",ye)},[te,le]),Fe=(0,s.useCallback)(ye=>{Ce({...te,pinnedLogs:ye}),le?.("pinnedLogs",ye)},[te,le]),ke=(0,s.useCallback)(ye=>{const He=ye===!1?"ms":te.timestampResolution;Ce({...te,showTime:ye,timestampResolution:He}),le?.("showTime",ye),j&&(x.M.set(`${j}.showTime`,ye),x.M.set(`${j}.timestampResolution`,He))},[te,j,le]),Ye=(0,s.useCallback)(ye=>{Ce({...te,showUniqueLabels:ye}),le?.("showUniqueLabels",ye),j&&x.M.set(`${j}.showLabels`,ye)},[te,j,le]),Ke=(0,s.useCallback)(ye=>{$e(ye),j&&x.M.set(`${j}.prettifyLogMessage`,ye),le?.("prettifyJSON",ye)},[j,le]),Je=(0,s.useCallback)(ye=>{Ce({...te,syntaxHighlighting:ye}),le?.("syntaxHighlighting",ye),j&&x.M.set(`${j}.syntaxHighlighting`,ye)},[te,j,le]),tt=(0,s.useCallback)(ye=>{Ce({...te,sortOrder:ye}),le?.("sortOrder",ye),j&&x.M.set(`${j}.sortOrder`,ye)},[te,j,le]),nt=(0,s.useCallback)(ye=>{fe(ye),j&&x.M.set(`${j}.wrapLogMessage`,ye),le?.("wrapLogMessage",ye)},[j,le]),et=(0,s.useCallback)(ye=>{const He=te.filterLevels.length===0?Q:Q.filter(Re=>te.filterLevels.includes(Re.logLevel));(0,ee.K7)(ye,He,R)},[te.filterLevels,Q,R]),qe=(0,s.useCallback)(()=>{me.forEach(ye=>c(ye)),Le([])},[me]),Ve=(0,s.useCallback)(ye=>{if(!D)return;const He=me.find(Re=>Re===ye||Re.uid===ye.uid);He?(c(He),Le(me.filter(Re=>Re!==ye&&Re.uid!==ye.uid))):Le([...me,ye])},[D,me]),ot=(0,s.useCallback)(ye=>{if(!j||!n)return;const He=n.clientWidth-y.Of;ye>He||(x.M.set(`${j}.detailsWidth`,ye),je(ye))},[n,j]),it=(0,s.useCallback)(ye=>{j&&x.M.set(`${j}.timestampResolution`,ye),Ce(He=>({...He,timestampResolution:ye}))},[j]),st=(0,s.useCallback)(ye=>{ge&&b(ge,ye)},[ge]),lt=(0,s.useMemo)(()=>Q.some(ye=>!!(0,ee.Ei)(ye)),[Q]),Ue=(0,s.useMemo)(()=>Q.some(ye=>!!(0,ee.qR)(ye)),[Q]),ct=(0,s.useMemo)(()=>Q.some(ye=>ye.hasUnescapedContent),[Q]);return(0,e.jsx)(Y.Provider,{value:{app:v,closeDetails:qe,detailsDisplayed:ue,dedupStrategy:te.dedupStrategy,detailsMode:Me,detailsWidth:_e,displayedFields:f,downloadLogs:et,enableLogDetails:D,filterLevels:te.filterLevels,fontSize:te.fontSize,forceEscape:te.forceEscape,hasLogsWithErrors:lt,hasSampledLogs:Ue,hasUnescapedContent:ct,isLabelFilterActive:i,getRowContextQuery:S,logSupportsContext:r,logLineMenuCustomItems:J,logOptionsStorageKey:j,noInteractions:u??!1,onClickFilterLabel:g,onClickFilterOutLabel:w,onClickFilterString:k,onClickFilterOutString:N,onClickShowField:pe,onClickHideField:re,onLogLineHover:Te,onPermalinkClick:xe,onPinLine:l,onOpenContext:B,onUnpinLine:oe,permalinkedLogId:F,pinLineButtonTooltipTitle:de,pinnedLogs:te.pinnedLogs,prettifyJSON:se,setDedupStrategy:ve,setDetailsMode:T,setDetailsWidth:ot,setDisplayedFields:We,setFilterLevels:Xe,setFontSize:De,setForceEscape:Ne,setLogListState:Ce,setPinnedLogs:Fe,setPrettifyJSON:Ke,setShowTime:ke,setShowUniqueLabels:Ye,setSortOrder:tt,setSyntaxHighlighting:Je,setTimestampResolution:it,setWrapLogMessage:nt,showDetails:me,showTime:te.showTime,showUniqueLabels:te.showUniqueLabels,sortOrder:te.sortOrder,syntaxHighlighting:te.syntaxHighlighting,timestampResolution:te.timestampResolution,toggleDetails:Ve,wrapLogMessage:ie,isAssistantAvailable:A,openAssistantByLog:st},children:p})};function G(v){return v===P.uH.Ascending||v===P.uH.Descending}function he(v){return v===P.fY.exact||v===P.fY.none||v===P.fY.numbers||v===P.fY.signature}function H(v,p,n,D="sidebar",j){if(!v)return 0;if(D==="inline")return v.clientWidth-(0,y.XJ)()-(j?y.W5:0);const Z=v.clientWidth*.4,E=n||(p?parseInt(x.M.get(`${p}.detailsWidth`)??Z,10):Z),f=v.clientWidth-y.Of;return E>=v.clientWidth||E>f?n??Z:E}const q=new Map;function V(v,p){q.set(v.uid,p)}function W(v){return q.get(v.uid)??0}function c(v){q.delete(v.uid)}async function b(v,p){const n=await(0,X.l)().get(p.datasourceUid),D=[];n&&D.push((0,M.createAssistantContextItem)("datasource",{datasourceUid:n.uid})),v({origin:"grafana/explain-log-line",prompt:`${(0,O.t)("logs.log-line-menu.log-line-explainer","Explain log line in a concise way")}:

      \`\`\`
${p.entry.replaceAll("`","\\`")}
      \`\`\`
      `,context:[...D,(0,M.createAssistantContextItem)("structured",{title:(0,O.t)("logs.log-line-menu.log-line","Log line"),data:{labels:p.labels,value:p.entry,timestamp:p.timestamp}})]})}function L(v){return(v?.clientWidth??window.innerWidth)>1440?"sidebar":"inline"}},32783:(ze,we,t)=>{t.d(we,{u_:()=>$,w4:()=>G});var e=t(36195),o=t(80124),m=t(38903),s=t(96426),M=t(95826);function $(c){const b=(0,s.qk)(c),v=e.K3.parse(b).topNode,n={query:{labels:[],operations:[]},errors:[]};try{P(b,v,n)}catch(D){console.error(D),D instanceof Error&&n.errors.push({text:D.message})}return q(n.query)&&(n.errors=[]),n}function P(c,b,L){const v=L.query;switch(b.type.id){case e.g$:{v.labels.push(I(c,b));const p=b.getChild(s.Ql);p&&L.errors.push((0,s.xz)(c,p));break}case e.PN:{const{operation:p,error:n}=x(c,b);p&&v.operations.push(p),n&&L.errors.push(H(c,b,n));break}case e.iT:{v.operations.push(ce(c,b));break}case e.bY:{const{operation:p,error:n}=X(c,b);p&&v.operations.push(p),n&&L.errors.push(H(c,b,n));break}case e.eF:{v.operations.push(O(c,b));break}case e.Zj:case e.Tz:{const{operation:p,error:n}=h(c,b);p&&v.operations.push(p),n&&L.errors.push(H(c,b,n));break}case e.pH:{v.operations.push(ee(c,b));break}case e.e_:{v.operations.push(K(c,b));break}case e.HV:{const{operation:p,error:n}=y(c,b,L);p&&v.operations.push(p),n&&L.errors.push(H(c,b,n));break}case e.Zg:{v.operations.push(U());break}case e.h1:{v.operations.push(Y(c,b,L));break}case e.Rh:{v.operations.push(ae(c,b,L));break}case e.MK:{ne(c,b,L);break}case s.Ql:{if(_(b))break;L.errors.push((0,s.xz)(c,b));break}case e.i8:{v.operations.push(V(c,b,L));break}case e.UP:{v.operations.push(W(c,b,L));break}default:{let p=b.firstChild;for(;p;)P(c,p,L),p=p.nextSibling}}}function I(c,b){const L=b.getChild(e.gw),v=(0,s.AA)(c,L),p=(0,s.AA)(c,L?.nextSibling);let n=(0,s.AA)(c,b.getChild(e.Qf));return n=n.substring(1,n.length-1),{label:v,op:p,value:n}}function x(c,b){const L=(0,s.AA)(c,b.getChild(e.dJ)),v=G((0,s.AA)(c,b.getChild(e.Qf)));if(b.getChild(e.w7)?.getChild(e.Ip))return{operation:{id:M.EF.LineFilterIpMatches,params:[L,v]}};const n=[v];let D=b.getChild(e.ih);for(;D;)n.push(G((0,s.AA)(c,D.getChild(e.Qf)))),D=D.getChild(e.ih);return{operation:{id:{"|=":M.EF.LineContains,"!=":M.EF.LineContainsNot,"|~":M.EF.LineMatchesRegex,"!~":M.EF.LineMatchesRegexNot}[L],params:n}}}function ce(c,b){const L=b.firstChild,v=(0,s.AA)(c,L),p=G((0,s.AA)(c,b.getChild(e.Qf)));let n=p?[p]:[];const D=(0,m.mD)(v);return D&&!(0,m.VI)(D,n)&&(n=D?.defaultParams||[]),{id:v,params:n}}function O(c,b){const L=b.getChild(e.LM),v=(0,s.AA)(c,L),p=[...(0,s.R1)(c,b,e.Gn)];return{id:v,params:p}}function h(c,b){const L=[],v=[];let p;const n=b.from;return b.toTree().iterate({enter:j=>{j.type.id===e.ov?L.push(c.substring(j.from+n,j.to+n)):j.type.id===e.Gn?v.push(c.substring(j.from+n,j.to+n)):j.type.id===s.Ql&&(p=`Unexpected string "${c.substring(j.from+n,j.to+n)}"`)}}),{operation:{id:M.EF.Logfmt,params:[L.includes("--strict"),L.includes("--keep-empty"),...v]},error:p}}function X(c,b){if(b.getChild(e.Or)||b.getChild(e.KD)||b.getChild("Comma"))return{error:'Label filter with comma, "and", "or" not supported in query builder'};if(b.firstChild.type.id===e.GA){const Z=b.firstChild,E=Z?.getChild(e.gw),f=E?.nextSibling,d=Z?.getChild(e.Qf),a=G((0,s.AA)(c,d));return{operation:{id:M.EF.LabelFilterIpMatches,params:[(0,s.AA)(c,E),(0,s.AA)(c,f),a]}}}const L=M.EF.LabelFilter;if(b.firstChild.type.id===e.Jq){const E=b.firstChild.firstChild.firstChild,f=E.nextSibling,d=f.nextSibling,a=G((0,s.AA)(c,d));return{operation:{id:L,params:[(0,s.AA)(c,E),(0,s.AA)(c,f),a]}}}const p=b.firstChild.firstChild,n=p.nextSibling,D=n.nextSibling,j=[(0,s.AA)(c,p),(0,s.AA)(c,n),G((0,s.AA)(c,D))];return j.join("")==="__error__="?{operation:{id:M.EF.LabelFilterNoErrors,params:[]}}:{operation:{id:L,params:j}}}function ee(c,b){const L=M.EF.LineFormat,v=G((0,s.AA)(c,b.getChild(e.Qf)));return{id:L,params:[v]}}function K(c,b){const L=M.EF.LabelFormat,v=b.getChild(e.gw),n=v.nextSibling.nextSibling;return{id:L,params:[(0,s.AA)(c,n),G((0,s.AA)(c,v))]}}function U(){return{id:M.EF.Decolorize,params:[]}}function y(c,b,L){const v=b.getChild(e.HV),p=b.getChild(e.bY),n=b.getChild(e.sK);if(v&&P(c,v,L),p&&P(c,p,L),n){if(n.nextSibling?.type.id===e.yW){const D=n.nextSibling,j=D.nextSibling;return{operation:{id:M.EF.Unwrap,params:[(0,s.AA)(c,j),(0,s.AA)(c,D)]}}}return{operation:{id:M.EF.Unwrap,params:[(0,s.AA)(c,n?.nextSibling),""]}}}return{}}function Y(c,b,L){const v=b.getChild(e.lo),p=(0,s.AA)(c,v),n=b.getChild(e.wN),D=b.getChild(e.xo),j=n!=null?[(0,s.AA)(c,n)]:[],Z=D?.getChild(e.Q6),E=Z?(0,s.AA)(c,Z):null,f=b.getChild(e.aU);E&&j.unshift(E.substring(1,E.length-1)),f&&j.push(...(0,s.R1)(c,f,e.gw));const d={id:p,params:j};return D&&P(c,D,L),d}function ae(c,b,L){const v=b.getChild(e.ZQ);let p=(0,s.AA)(c,v);const n=b.getChild(e.aU),D=[],j=b.getChild(e.wN),Z=b.getChild(s.Ql)?.getChild(e.gw);j?D.push(Number((0,s.AA)(c,j))):Z&&D.push((0,s.AA)(c,Z)),n&&(n.getChild(e.By)&&p&&(p=`__${p}_by`),n.getChild(e.xB)&&(p=`__${p}_without`),D.push(...(0,s.R1)(c,n,e.gw)));const E=b.getChild(e.Yw),f={id:p,params:D};return E&&(E.firstChild?.type.id===e.MK&&L.errors.push({text:"Query parsing is ambiguous.",from:E.firstChild.from,to:E.firstChild?.to}),P(c,E,L)),f}const Oe=o.C.reduce((c,b)=>(c[b.sign]={id:b.id,comparison:b.comparison},c),{});function ne(c,b,L){const v=L.query,p=b.firstChild,n=(0,s.AA)(c,p.nextSibling),D=C(c,b.getChild(e.o5)),j=b.lastChild,Z=Oe[n],E=he(p,"MetricExpr.LiteralExpr.Number"),f=he(j,"MetricExpr.LiteralExpr.Number"),d=j.getChild(e.MK);if(E||P(c,p,L),f)v.operations.push((0,s.rq)(Z,c,j,!!D?.isBool));else if(d){const a=(0,s.z9)(j);a?.type.id===e.wN&&v.operations.push((0,s.rq)(Z,c,a,!!D?.isBool)),P(c,j,L)}else{v.binaryQueries=v.binaryQueries||[];const a={operator:n,query:{labels:[],operations:[]}};D?.isMatcher&&(a.vectorMatchesType=D.matchType,a.vectorMatches=D.matches),v.binaryQueries.push(a),P(c,j,{query:a.query,errors:L.errors})}}function C(c,b){if(!b)return;const L=b.getChild(e.wT),v=b.getChild(e.x);if(!L&&v)return{isBool:!0,isMatcher:!1};{if(!L)return;const p=(0,s.AA)(c,L.getChild(e.x$)?.getChild(e.qJ));return{isMatcher:!0,isBool:!!v,matches:p,matchType:L.getChild(e.On)?"on":"ignoring"}}}function _(c){return c?.parent?.type.id===e.Q6}function G(c){return c[0]==='"'&&c[c.length-1]==='"'?c.substring(1,c.length-1).replace(/\\"/g,'"').replace(/\\\\/g,"\\"):c.replace(/`/g,"")}function he(c,b){let L=c;const v=b.split(".");for(const p of v)if(L=L.getChild(p),!L)return null;return L}function H(c,b,L){const v=(0,s.xz)(c,b);return v.text=`${L}: ${v.text}`,v}function q(c){return c.labels.length===0&&c.operations.length===0}function V(c,b,L){const v=[];let p=b.getChild(e.LQ);for(;p;){const n=(0,s.AA)(c,p.getChild(e.yj));n&&v.push(n),p=p?.getChild(e.LQ)}return v.reverse(),{id:M.EF.Drop,params:v}}function W(c,b,L){const v=[];let p=b.getChild(e.J3);for(;p;){const n=(0,s.AA)(c,p.getChild(e.UM));n&&v.push(n),p=p?.getChild(e.J3)}return v.reverse(),{id:M.EF.Keep,params:v}}},36195:(ze,we,t)=>{t.d(we,{AL:()=>Ne,By:()=>F,CX:()=>Fe,GA:()=>at,GN:()=>Me,Gn:()=>He,HV:()=>It,I4:()=>ye,Ip:()=>qe,J3:()=>Rt,J_:()=>Et,Jq:()=>dt,K0:()=>je,K3:()=>a,KD:()=>be,LM:()=>i,LQ:()=>$t,MD:()=>A,MK:()=>Bt,Nl:()=>bt,On:()=>re,Or:()=>Se,PN:()=>ke,Q6:()=>Qt,Qf:()=>fe,Rh:()=>Wt,Sg:()=>Ke,Tz:()=>Re,UK:()=>T,UM:()=>Tt,UP:()=>wt,Yw:()=>Mt,ZQ:()=>Nt,Zg:()=>l,Zj:()=>it,aU:()=>_t,bY:()=>Ge,c$:()=>S,dJ:()=>Ye,dw:()=>pt,eF:()=>ct,e_:()=>Pt,g$:()=>se,gw:()=>$e,h1:()=>jt,i8:()=>Ct,iT:()=>Ue,ih:()=>Ve,lo:()=>Dt,o5:()=>kt,ov:()=>lt,pH:()=>Lt,q5:()=>Je,qJ:()=>Ht,sK:()=>r,sq:()=>ge,t3:()=>Xe,uk:()=>_e,w7:()=>et,wN:()=>yt,wT:()=>Ut,x:()=>pe,x$:()=>Xt,xB:()=>de,xo:()=>Ft,yW:()=>At,yj:()=>St});var e=t(48820);const o=1,m=2,s=3,M=4,$=5,P=6,I=7,x=8,ce=9,O=10,h=11,X=12,ee=13,K=14,U=15,y=16,Y=17,ae=18,Oe=19,ne=20,C=21,_=22,G=23,he=24,H=25,q=26,V=27,W=28,c=29,b=30,L=31,v=32,p=33,n=34,D=35,j={json:o,logfmt:m,unpack:s,pattern:M,regexp:$,label_format:I,line_format:x,label_replace:ce,vector:O,offset:h,bool:X,on:ee,ignoring:K,group_left:U,group_right:y,unwrap:P,decolorize:Y,drop:ae,keep:Oe},Z=gt=>j[gt.toLowerCase()]||-1,E={by:ne,without:C,and:_,or:G,unless:he,sum:H,avg:q,count:V,max:W,min:c,stddev:b,stdvar:L,bottomk:v,topk:p,sort:n,sort_desc:D},f=gt=>E[gt.toLowerCase()]||-1,d={__proto__:null,ip:295,count_over_time:301,rate:303,rate_counter:305,bytes_over_time:307,bytes_rate:309,avg_over_time:311,sum_over_time:313,min_over_time:315,max_over_time:317,stddev_over_time:319,stdvar_over_time:321,quantile_over_time:323,first_over_time:325,last_over_time:327,absent_over_time:329,bytes:335,duration:337,duration_seconds:339},a=e.U1.deserialize({version:14,states:"EtOYQPOOO#cQPO'#DUOOQO'#ER'#ERO#hQPO'#ERO$}QPO'#DTOYQPO'#DTOOQO'#Ed'#EdO%[QPO'#EcOOQO'#FP'#FPO%aQPO'#FOQ%lQPOOO&mQPO'#F]O&rQPO'#F^OOQO'#Eb'#EbOOQO'#DS'#DSOOQO'#Ee'#EeOOQO'#Ef'#EfOOQO'#Eg'#EgOOQO'#Eh'#EhOOQO'#Ei'#EiOOQO'#Ej'#EjOOQO'#Ek'#EkOOQO'#El'#ElOOQO'#Em'#EmOOQO'#En'#EnOOQO'#Eo'#EoOOQO'#Ep'#EpOOQO'#Eq'#EqOOQO'#Er'#ErOOQO'#Es'#EsO&wQPO'#DWOOQO'#DV'#DVO'VQPO,59pOOQO,5:m,5:mOOQO'#Dc'#DcO'_QPO'#DbO'gQPO'#DaO)lQPO'#D`O*{QPO'#D`OOQO'#D_'#D_O+sQPO,59oO-}QPO,59oO.UQPO,5:|O.]QPO,5:}O.hQPO'#E|O0sQPO,5;jO0zQPO,5;jO1PQPO,5;lO1PQPO,5;lO1PQPO,5;lO1PQPO,5;lO1PQPO,5;lO1PQPO,5;lOYQPO,5;wO3cQPO,5;xO3hQPO,59rO#cQPO,59qOOQO1G/[1G/[OOQO'#Dh'#DhO3mQPO,59|O5^QPO,59|OOQO'#Di'#DiO5cQPO,59{OOQO,59{,59{O5kQPO'#DWO6YQPO'#DlO8PQPO'#DoO9sQPO'#DoOOQO'#Do'#DoOOQO'#Dv'#DvOOQO'#Dt'#DtO+kQPO'#DtO9xQPO,59zO;iQPO'#EVO;nQPO'#EWOOQO'#EZ'#EZO;sQPO'#E[O;xQPO'#E_OOQO,59z,59zOOQO,59y,59yOOQO1G/Z1G/ZOOQO1G0h1G0hO;}QPO'#EtO.`QPO'#EtO<XQPO1G0iO<^QPO1G0iO<cQPO,5;hO=oQPO1G1UO=vQPO1G1UO=}QPO1G1UO>UQPO'#FSO@dQPO'#FRO@nQPO'#FROYQPO1G1WOYQPO1G1WOYQPO1G1WOYQPO1G1WOYQPO1G1WOYQPO1G1WO@xQPO1G1cOAPQPO1G1dOOQO1G/^1G/^OOQO1G/]1G/]O5cQPO1G/hOAUQPO1G/hOAZQPO'#DjOBzQPO'#DjOOQO1G/g1G/gOCbQPO,59rOCPQPO,5:cOOQO'#Dm'#DmOClQPO,5:WOEcQPO'#DrOOQO'#Dq'#DqOGVQPO,5:_OHvQPO,5:[OOQO,5:Z,5:ZOJgQPO,5:`O+kQPO,5:`O+kQPO,5:`OOQO,5:q,5:qOJuQPO'#EYOOQO'#EX'#EXOJzQPO,5:rOLkQPO'#E^OOQO'#E^'#E^OOQO'#E]'#E]ONbQPO,5:vO!!RQPO'#EaOOQO'#Ea'#EaOOQO'#E`'#E`O!#xQPO,5:yO!%iQPO'#D`O;}QPO,5;`O!%pQPO'#EuO!%uQPO,5;`O!%}QPO,5;`O!&[QPO,5;`O!&iQPO,5;`O!&nQPO7+&TO.`QPO7+&TOOQO'#E}'#E}O!(OQPO1G1SOOQO1G1S1G1SOYQPO7+&pO!(WQPO7+&pO!)hQPO7+&pO!)oQPO7+&pO!)vQQO'#FTOOQO,5;n,5;nO!,UQPO,5;mO!,]QPO,5;mO!-nQPO7+&rO!-uQPO7+&rOOQO7+&r7+&rO!.SQPO7+&rO!.ZQPO7+&rO!/`QPO7+&rO!/pQPO7+&}OOQO7+'O7+'OOOQO7+%S7+%SO!/uQPO7+%SO5cQPO,5:UO!/zQPO,5:UO!0PQPO1G/{OOQO1G/}1G/}OOQO1G0U1G0UOOQO1G0W1G0WOOQO,5:X,5:XO!0UQPO1G/yO!1uQPO,5:^O!1zQPO,5:]OOQO1G/z1G/zO!2PQPO1G/zO!3pQPO,5:tO;nQPO,5:sO;sQPO,5:wO;xQPO,5:zO!3xQPO,5;cO!%uQPO1G0zO!4WQPO1G0zO!4`QPO,5;aO+kQPO,5;cO!4eQPO1G0zO!4oQPO'#EvO!4tQPO1G0zO!4eQPO1G0zO!4|QPO1G0zO!5ZQPO1G0zO!%xQPO1G0zOOQO1G0z1G0zOOQO<<Io<<IoO!5fQPO<<IoO!5kQPO,5;iOOQO7+&n7+&nO!5pQPO<<J[OOQO<<J[<<J[OYQPO<<J[OOQO'#FV'#FVO!5wQPO,5;oOOQO'#FU'#FUOOQO,5;o,5;oOOQO1G1X1G1XO!6PQPO1G1XO!8YQPO<<JiOOQO<<Hn<<HnOOQO1G/p1G/pO!8_QPO1G/pO!8dQPO7+%gOOQO1G/x1G/xOOQO1G/w1G/wOOQO1G0`1G0`OOQO1G0_1G0_OOQO1G0c1G0cOOQO1G0f1G0fOOQO'#Ex'#ExOOQO1G0}1G0}O!8iQPO1G0}OOQO'#Ey'#EyOOQO'#Ez'#EzOOQO'#E{'#E{OOQO7+&f7+&fOOQO1G0{1G0{O!8nQPO1G0}O!9SQPO7+&fOOQO,5;b,5;bO!9[QPO7+&fO!%xQPO7+&fO!9fQPO7+&fO!9qQPOAN?ZOOQO1G1T1G1TO!;RQPOAN?vO!<cQPOAN?vO!<jQQO1G1ZOOQO1G1Z1G1ZOOQO7+&s7+&sO!<rQPOAN@TOOQO7+%[7+%[O!<wQPO<<IRO!<|QPO7+&iO!=RQPO<<JQO!=ZQPO<<JQO!=cQPO'#EwO!=hQPO<<JQOOQOG24uG24uOOQOG25bG25bOOQO1G1[1G1[OOQO7+&u7+&uO!=pQPOG25oOOQOAN>mAN>mO!=uQPO<<JTOOQOAN?lAN?lO!=zQPOAN?lO!>SQPOLD+ZOOQOAN?oAN?oOOQO,5:r,5:rO!>XQPO!$'NuO!>^QPO!)9DaO!>cQPO!.K9{OOQO!4//g!4//gO;nQPO'#EWO!>hQPO'#D`O!?`QPO,59oO!@fQPO'#DTOYQPO1G1WOYQPO1G1WOYQPO1G1WOYQPO1G1WOYQPO1G1WOYQPO1G1WO1PQPO,5;lO1PQPO,5;lO1PQPO,5;lO1PQPO,5;lO1PQPO,5;lO1PQPO,5;lO!AqQPO7+&rO!AxQPO7+&rO!BVQPO7+&rO!C_QPO7+&rO!CfQPO7+&rO!B^QPO'#FQ",stateData:"!Cs~O$TOStOS~OXZOY[OiWOjWOkWOlWOmWOnWOoWOpWOqWOrWOsWO!vQO!wRO!xRO$UPO$YTO$[_O$]`O$^aO$_bO$`cO$adO$beO$cfO$dgO$ehO$fiO$gjO$hkO$ilO$jmO~O{nO~O!vqO~O!OrO!QrO!WrO!XrO!YrO!ZrOfwXgwXhwX!lwX!nwX!owX!pwX!qwX!wwX!xwX#{wX#|wX#}wX$OwX~O!_vO$RwX$ZwX~P#mO$Y{O~Od|Oe|O$Y}O~Of!QOg!POh!QO!O!UO!l!UO!n!UO!o!UO!p!UO!q!UO!w!RO!x!RO#{!SO#|!SO#}!SO$O!TO~O$Y!VO~O$Y!WO~O|!XO!O!XO!P!XO!Q!XO~O$V!YO$W!ZO~O}!]O$X!_O~Og!`Of!TXh!TX!O!TX!Q!TX!W!TX!X!TX!Y!TX!Z!TX!_!TX!l!TX!n!TX!o!TX!p!TX!q!TX!w!TX!x!TX#{!TX#|!TX#}!TX$O!TX$R!TX$Z!TX$k!TX$V!TX~O!OrO!QrO!WrO!XrO!YrO!ZrO~Of!SXg!SXh!SX!_!SX!l!SX!n!SX!o!SX!p!SX!q!SX!w!SX!x!SX#{!SX#|!SX#}!SX$O!SX$R!SX$Z!SX$k!SX$V!SX~P)WOP!dOQ!cOR!fOS!eOT!eOV!lOW!kOa!mOb!nOc!oO{!bO$Y!iO~O!_vOfwagwahwa!lwa!nwa!owa!pwa!qwa!wwa!xwa#{wa#|wa#}wa$Owa$Rwa$Zwa~P)WOfvXgvXhvX!OvX!lvX!nvX!ovX!pvX!qvX!wvX!xvX#{vX#|vX#}vX$OvX~O$Z!rO~P,|O$Z!sO~P,|O!v!wO$UPO$Y!uO~O$Y!xO~OXZOY[OiWOjWOkWOlWOmWOnWOoWOpWOqWOrWOsWO!wRO!xRO$UPO$YTO$[_O$]`O$^aO$_bO$`cO$adO$beO$cfO$dgO$ehO$fiO$gjO$hkO$ilO$jmO~O!v!yO~P.mO$Y!{O~O[#OO]!|O^!|OX#uPY#uPi#uPj#uPk#uPl#uPm#uPn#uPo#uPp#uPq#uPr#uPs#uP!v#uP!w#uP!x#uP$U#uP$Y#uP$[#uP$]#uP$^#uP$_#uP$`#uP$a#uP$b#uP$c#uP$d#uP$e#uP$f#uP$g#uP$h#uP$i#uP$j#uP~O!v#WO~O}#XO~Og#ZOf!Uah!Ua!O!Ua!Q!Ua!W!Ua!X!Ua!Y!Ua!Z!Ua!_!Ua!l!Ua!n!Ua!o!Ua!p!Ua!q!Ua!w!Ua!x!Ua#{!Ua#|!Ua#}!Ua$O!Ua$R!Ua$Z!Ua$k!Ua$V!Ua~O$Y#[O~O}#]O$X!_O~O|#`O!O#`O!P!XO!Q!XO!l#aO!n#aO!o#aO!p#aO!q#aO~O{#dO!b#bOf!`Xg!`Xh!`X!O!`X!Q!`X!W!`X!X!`X!Y!`X!Z!`X!_!`X!l!`X!n!`X!o!`X!p!`X!q!`X!w!`X!x!`X#{!`X#|!`X#}!`X$O!`X$R!`X$Z!`X$k!`X$V!`X~O{#dOf!cXg!cXh!cX!O!cX!Q!cX!W!cX!X!cX!Y!cX!Z!cX!_!cX!l!cX!n!cX!o!cX!p!cX!q!cX!w!cX!x!cX#{!cX#|!cX#}!cX$O!cX$R!cX$Z!cX$k!cX$V!cX~O}#hO~Of#jOg#kO$V#jOh!Sa!O!Sa!Q!Sa!W!Sa!X!Sa!Y!Sa!Z!Sa!_!Sa!l!Sa!n!Sa!o!Sa!p!Sa!q!Sa!w!Sa!x!Sa#{!Sa#|!Sa#}!Sa$O!Sa$R!Sa$Z!Sa$k!Sa~O}#lO~O{#mO~O{#pO~O{#tO~O!_#xO$k#zO~P)WO$Z$PO~O$V$QO~O{$RO$Z$TO~Of!uXg!uXh!uX!O!uX!l!uX!n!uX!o!uX!p!uX!q!uX!w!uX!x!uX#{!uX#|!uX#}!uX$O!uX$Z!uX~O$V$UO~P<kO$Z$VO~P,|O!v$WO~P.mO$Y$YO~OX#uXY#uXi#uXj#uXk#uXl#uXm#uXn#uXo#uXp#uXq#uXr#uXs#uX!v#uX!w#uX!x#uX$U#uX$Y#uX$[#uX$]#uX$^#uX$_#uX$`#uX$a#uX$b#uX$c#uX$d#uX$e#uX$f#uX$g#uX$h#uX$i#uX$j#uX~O_$[O`$[O~P>ZO]!|O^!|O~P>ZO$V$dO~P,|O$Z$eO~O}$gO~Og$hOf!^Xh!^X!O!^X!Q!^X!W!^X!X!^X!Y!^X!Z!^X!_!^X!l!^X!n!^X!o!^X!p!^X!q!^X!w!^X!x!^X#{!^X#|!^X#}!^X$O!^X$R!^X$Z!^X$k!^X$V!^X~O$Y$iO~O!m$kO!s$lO!vQO!wRO!xRO~O}#XO$X!_O~PCPO{#dO!b$nOf!`ag!`ah!`a!O!`a!Q!`a!W!`a!X!`a!Y!`a!Z!`a!_!`a!l!`a!n!`a!o!`a!p!`a!q!`a!w!`a!x!`a#{!`a#|!`a#}!`a$O!`a$R!`a$Z!`a$k!`a$V!`a~O|$pOf!fXg!fXh!fX!O!fX!Q!fX!W!fX!X!fX!Y!fX!Z!fX!_!fX!l!fX!n!fX!o!fX!p!fX!q!fX!w!fX!x!fX#{!fX#|!fX#}!fX$O!fX$R!fX$V!fX$Z!fX$k!fX~O$V$qOf!gag!gah!ga!O!ga!Q!ga!W!ga!X!ga!Y!ga!Z!ga!_!ga!l!ga!n!ga!o!ga!p!ga!q!ga!w!ga!x!ga#{!ga#|!ga#}!ga$O!ga$R!ga$Z!ga$k!ga~O$V$qOf!dag!dah!da!O!da!Q!da!W!da!X!da!Y!da!Z!da!_!da!l!da!n!da!o!da!p!da!q!da!w!da!x!da#{!da#|!da#}!da$O!da$R!da$Z!da$k!da~Of#jOg#kO$V#jO$Z$rO~O|$tO~O$V$uOf!zag!zah!za!O!za!Q!za!W!za!X!za!Y!za!Z!za!_!za!l!za!n!za!o!za!p!za!q!za!w!za!x!za#{!za#|!za#}!za$O!za$R!za$Z!za$k!za~O|!XO!O!XO!P!XO!Q!XOf#QXg#QXh#QX!W#QX!X#QX!Y#QX!Z#QX!_#QX!l#QX!n#QX!o#QX!p#QX!q#QX!w#QX!x#QX#{#QX#|#QX#}#QX$O#QX$R#QX$V#QX$Z#QX$k#QX~O$V$vOf#Oag#Oah#Oa!O#Oa!Q#Oa!W#Oa!X#Oa!Y#Oa!Z#Oa!_#Oa!l#Oa!n#Oa!o#Oa!p#Oa!q#Oa!w#Oa!x#Oa#{#Oa#|#Oa#}#Oa$O#Oa$R#Oa$Z#Oa$k#Oa~O|!XO!O!XO!P!XO!Q!XOf#TXg#TXh#TX!W#TX!X#TX!Y#TX!Z#TX!_#TX!l#TX!n#TX!o#TX!p#TX!q#TX!w#TX!x#TX#{#TX#|#TX#}#TX$O#TX$R#TX$V#TX$Z#TX$k#TX~O$V$wOf#Rag#Rah#Ra!O#Ra!Q#Ra!W#Ra!X#Ra!Y#Ra!Z#Ra!_#Ra!l#Ra!n#Ra!o#Ra!p#Ra!q#Ra!w#Ra!x#Ra#{#Ra#|#Ra#}#Ra$O#Ra$R#Ra$Z#Ra$k#Ra~OU$xO~P*{O!m${O~O!_$|O$k#zO~OZ%OO!_#xO$Z#ha~P)WO!_#xO$Z%TO$k#zO~P)WO$Z%UO~Od|Oe|Of#Vqg#Vqh#Vq!O#Vq!l#Vq!n#Vq!o#Vq!p#Vq!q#Vq!w#Vq!x#Vq#{#Vq#|#Vq#}#Vq$O#Vq$R#Vq$Z#Vq$V#Vq~O$V%XO$Z%YO~Od|Oe|Of#rqg#rqh#rq!O#rq!l#rq!n#rq!o#rq!p#rq!q#rq!w#rq!x#rq#{#rq#|#rq#}#rq$O#rq$R#rq$Z#rq$V#rq~O$V%]O~P<kO$Z%[O~P,|O#z%^O$Z%aO~OX#uaY#uai#uaj#uak#ual#uam#uan#uao#uap#uaq#uar#uas#ua!v#ua!w#ua!x#ua$U#ua$[#ua$]#ua$^#ua$_#ua$`#ua$a#ua$b#ua$c#ua$d#ua$e#ua$f#ua$g#ua$h#ua$i#ua$j#ua~O$Y$YO~P!*OO_%cO`%cO$Y#ua~P!*OOf!QOh!QO!O!UO!l!UO!n!UO!o!UO!p!UO!q!UO!w!RO!x!RO#{#tq#|#tq#}#tq$O#tq$R#tq$Z#tq~Og#tq~P!,jOf#tqg#tqh#tq~P!,pOg!PO~P!,jO$R#tq$Z#tq~P%lOf#tqg#tqh#tq!O#tq!l#tq!n#tq!o#tq!p#tq!q#tq#{#tq#|#tq#}#tq$O#tq~O!w!RO!x!RO$R#tq$Z#tq~P!.eO}%dO~O$Z%eO~O}%gO~O$Y%hO~O$V$qOf!gig!gih!gi!O!gi!Q!gi!W!gi!X!gi!Y!gi!Z!gi!_!gi!l!gi!n!gi!o!gi!p!gi!q!gi!w!gi!x!gi#{!gi#|!gi#}!gi$O!gi$R!gi$Z!gi$k!gi~O}%iO~O{#dO~Of#jO$V#jOg!hih!hi!O!hi!Q!hi!W!hi!X!hi!Y!hi!Z!hi!_!hi!l!hi!n!hi!o!hi!p!hi!q!hi!w!hi!x!hi#{!hi#|!hi#}!hi$O!hi$R!hi$Z!hi$k!hi~O{%kO}%kO~O{%pO$m%rO$n%sO$o%tO~OZ%OO$Z#hi~O$l%vO~O!_#xO$Z#hi~P)WO!m%yO~O!_$|O$Z#hi~O!_#xO$Z%{O$k#zO~P)WO!_$|O$Z%{O$k#zO~O$Z%}O~O{&OO~O$Z&PO~P,|O$V&RO$Z&SO~O$Y$YOX#uiY#uii#uij#uik#uil#uim#uin#uio#uip#uiq#uir#uis#ui!v#ui!w#ui!x#ui$U#ui$[#ui$]#ui$^#ui$_#ui$`#ui$a#ui$b#ui$c#ui$d#ui$e#ui$f#ui$g#ui$h#ui$i#ui$j#ui~O$V&UO~O$Z&VO~O}&WO~O$Y&XO~Of#jOg#kO$V#jO!_#ki$k#ki$Z#ki~O!_$|O$Z#hq~O!_#xO$Z#hq~P)WOZ%OO!_&[O$Z#hq~Od|Oe|Of#V!Rg#V!Rh#V!R!O#V!R!l#V!R!n#V!R!o#V!R!p#V!R!q#V!R!w#V!R!x#V!R#{#V!R#|#V!R#}#V!R$O#V!R$R#V!R$Z#V!R$V#V!R~Od|Oe|Of#r!Rg#r!Rh#r!R!O#r!R!l#r!R!n#r!R!o#r!R!p#r!R!q#r!R!w#r!R!x#r!R#{#r!R#|#r!R#}#r!R$O#r!R$R#r!R$Z#r!R$V#r!R~O$Z&_O~P,|O#z%^O$Z&aO~O}&bO~O$Z&cO~O{&dO~O!_$|O$Z#hy~OZ%OO$Z#hy~OU$xO~O!_&[O$Z#hy~O$V&gO~O$Z&hO~O!_$|O$Z#h!R~O}&jO~O$V&kO~O}&lO~O$Z&mO~OP!dOQ!cOR!fOS!eOT!eOV&nOW!kOa!mOb!nOc!oO{!bO$Y!iO~O!_&oOfwagwahwa!lwa!nwa!owa!pwa!qwa!wwa!xwa#{wa#|wa#}wa$Owa$Vwa~P)WO!_&oO$VwX~P#mOf&yOh&yO!O&}O!l&}O!n&}O!o&}O!p&}O!q&}O!w&zO!x&zO#{#tq#|#tq#}#tq$O#tq$V#tq~Og#tq~P!@pOf#tqg#tqh#tq~P!@vOg&xO~P!@pOf&yOg&xOh&yO!O&}O!l&}O!n&}O!o&}O!p&}O!q&}O!w&zO!x&zO#{&{O#|&{O#}&{O$O&|O~O$V#tq~P!B^O!w&zO!x&zO$V#tq~P!.eO",goto:"1l$RPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPP$S%R%j&Y&]PPPPPP&t'W'h'v(XPPPP(h(p(yP)S)XP)S)S)[)e)S)m*O*O*XPPPPPP*XP*O*bPPP)S)S*{+R)S)S+Y+])S+c+f+l,_,t-Z-Z-Z-Z-Z-Z-Z-Z-Z-Z-Z-Z-Z-Z-Z-p-y.^.j/S/V/V/V/Y/i,_/l,_0R0w1Y1c1fPPPPP,_,_[YOT}!{$U%]Q$^#PQ$_#QS$`#R&tQ$a#SQ$b#TQ$c#UQ'O&rQ'P&sQ'Q&uQ'R&vQ'S&wR'T!Vt^O}!V!{#P#Q#R#S#T#U$U%]&r&s&t&u&v&wRyTjSOT}!V!{#P#Q#R#S#T#U$U%]S!t{$QQ#}!u]&q&r&s&t&u&v&wRpPQoP^!hv!i#j#k#x$|&oQ#Y!YS#q!n$vT#u!o$wQxSQ#y!tQ$}#|Q%R#}Q%z%QR&p&q[wS!t#|#}%Q&q]!qx#y$}%R%z&piuSx!t#y#|#}$}%Q%R%z&p&qhtSx!t#y#|#}$}%Q%R%z&p&qR!auksSux!t#y#|#}$}%Q%R%z&p&qQ!^sV#^!`#Z$hW![s!`#Z$hR$j#`Q#_!`Q$f#ZR%f$hV!pv#x&oR#c!cQ#f!cQ#g!dR$o#cU#e!c!d#cR%j$qU!jv#x&oQ#i!iQ$r#jQ$s#kR%w$|_!hv!i#j#k#x$|&o_!gv!i#j#k#x$|&ov]OT}!V!{#P#Q#R#S#T#U$U%]&r&s&t&u&v&wT$m#`#aQ#o!lR&i&nS#n!l&nR%l$uR#s!nQ#r!nR%m$vR#w!oQ#v!oR%n$wj^O#P#Q#R#S#T#U&r&s&t&u&v&wQzTQ!z}Q#V!VQ$X!{Q%Z$UR&Q%]w]OT}!V!{#P#Q#R#S#T#U$U%]&r&s&t&u&v&wwVOT}!V!{#P#Q#R#S#T#U$U%]&r&s&t&u&v&wwUOT}!V!{#P#Q#R#S#T#U$U%]&r&s&t&u&v&wQ!v{Q$O!uR%W$QS#|!t#}W$z#y#{%R%SQ%u$yQ%|%TR&Z%{Q%Q#|Q%u$zQ&]%|R&e&ZQ#{!tS$y#y%RQ%P#|Q%S#}S%x$}%QS&Y%z%|R&f&]R%q$xR%o$xQ!OXQ%V$PQ%[$VQ&^%}R&_&PR$S!xwXOT}!V!{#P#Q#R#S#T#U$U%]&r&s&t&u&v&wQ#P!PQ#Q!QQ#R!RQ#S!SQ#T!TQ#U!UQ&r&xQ&s&yQ&t&zQ&u&{Q&v&|R&w&}h!}!P!Q!R!S!T!U&x&y&z&{&|&}R$]#OQ$Z!|Q%b$[R&T%cR%_$YQ%`$YR&`&R",nodeNames:"\u26A0 Json Logfmt Unpack Pattern Regexp Unwrap LabelFormat LineFormat LabelReplace Vector Offset Bool On Ignoring GroupLeft GroupRight Decolorize Drop Keep By Without And Or Unless Sum Avg Count Max Min Stddev Stdvar Bottomk Topk Sort Sort_Desc LineComment LogQL Expr LogExpr Selector Matchers Matcher Identifier Eq String Neq Re Nre PipelineExpr PipelineStage LineFilters LineFilter Filter PipeExact PipeMatch PipePattern Npa FilterOp Ip OrFilter Pipe LogfmtParser LogfmtParserFlags ParserFlag LabelParser JsonExpressionParser LabelExtractionExpressionList LabelExtractionExpression LogfmtExpressionParser LabelFilter IpLabelFilter UnitFilter DurationFilter Gtr Duration Gte Lss Lte Eql BytesFilter Bytes NumberFilter LiteralExpr Number Add Sub LineFormatExpr LabelFormatExpr LabelsFormat LabelFormatMatcher DecolorizeExpr DropLabelsExpr DropLabels DropLabel KeepLabelsExpr KeepLabels KeepLabel MetricExpr RangeAggregationExpr RangeOp CountOverTime Rate RateCounter BytesOverTime BytesRate AvgOverTime SumOverTime MinOverTime MaxOverTime StddevOverTime StdvarOverTime QuantileOverTime FirstOverTime LastOverTime AbsentOverTime LogRangeExpr Range OffsetExpr UnwrapExpr ConvOp BytesConv DurationConv DurationSecondsConv Grouping Labels VectorAggregationExpr VectorOp BinOpExpr BinOpModifier OnOrIgnoringModifier GroupingLabels GroupingLabelList GroupingLabel LabelName Mul Div Mod Pow LabelReplaceExpr VectorExpr",maxTerm:169,skippedNodes:[0,36],repeatNodeCount:0,tokenData:"<n~RvX^#ipq#iqr$^rs$yst%kuv%vxy%{yz&Qz{&V{|&[|}&a}!O&f!O!P2v!P!Q3v!Q!R3{!R![7^![!]9]!^!_9q!_!`:O!`!a:e!c!}:r!}#O;Y#P#Q;_#Q#R;d#R#S:r#S#T;i#T#o:r#o#p;u#p#q;z#q#r<i#y#z#i$f$g#i#BY#BZ#i$IS$I_#i$I|$JO#i$JT$JU#i$KV$KW#i&FU&FV#i~#nY$T~X^#ipq#i#y#z#i$f$g#i#BY#BZ#i$IS$I_#i$I|$JO#i$JT$JU#i$KV$KW#i&FU&FV#i~$aR!_!`$j!`!a$o#r#s$t~$oO!O~~$tO!Z~~$yO!Q~~$|UOY$yZr$yrs%`s#O$y#O#P%e#P~$y~%eO}~~%hPO~$y~%pQt~OY%kZ~%k~%{O#}~~&QO$Y~~&VO$Z~~&[O#{~~&aO!w~~&fO$V~~&kQ!x~}!O&q!Q![(w~&tQ#_#`&z#g#h(X~&}P#X#Y'Q~'TP#X#Y'W~'ZP#d#e'^~'aP}!O'd~'gP#X#Y'j~'mP#a#b'p~'sP#d#e'v~'yP#h#i'|~(PP#m#n(S~(XO!b~~([P#h#i(_~(bP#f#g(e~(hP#]#^(k~(nP#V#W(q~(tP#h#i(S~(zZ!O!P)m!Q![(w#W#X0`#[#]*]#a#b+j#b#c.R#g#h/X#i#j.^#k#l1T#m#n1{${$|.^~)pP!Q![)s~)vV!Q![)s#[#]*]#a#b+j#b#c.R#g#h/X#i#j.^${$|.^~*bP!m~!Q![*e~*hV!O!P*}!Q![*e#a#b+j#b#c.R#g#h/X#i#j.^${$|.^~+QP!Q![+T~+WU!Q![+T#a#b+j#b#c.R#g#h/X#i#j.^${$|.^~+oQ!m~!Q![+u#g#h-Q~+xV!O!P,_!Q![+u#a#b,z#b#c.R#g#h/X#i#j.^${$|.^~,bP!Q![,e~,hU!Q![,e#a#b,z#b#c.R#g#h/X#i#j.^${$|.^~,}P#g#h-Q~-VP!m~!Q![-Y~-]T!O!P-l!Q![-Y#b#c.R#i#j.^${$|.^~-oP!Q![-r~-uS!Q![-r#b#c.R#i#j.^${$|.^~.UP#g#h.X~.^O!m~~.aP#g#h.d~.iP!m~!Q![.l~.oR!O!P.x!Q![.l#b#c.R~.{P!Q![/O~/RQ!Q![/O#b#c.R~/^P!m~!Q![/a~/dU!O!P/v!Q![/a#a#b,z#b#c.R#i#j.^${$|.^~/yP!Q![/|~0PT!Q![/|#a#b,z#b#c.R#i#j.^${$|.^~0eP!m~!Q![0h~0kW!O!P)m!Q![0h#[#]*]#a#b+j#b#c.R#g#h/X#i#j.^${$|.^~1YP!m~!Q![1]~1`X!O!P)m!Q![1]#W#X0`#[#]*]#a#b+j#b#c.R#g#h/X#i#j.^${$|.^~2QP!m~!Q![2T~2WY!O!P)m!Q![2T#W#X0`#[#]*]#a#b+j#b#c.R#g#h/X#i#j.^#k#l1T${$|.^~2yP!Q![2|~3RR!v~!Q![2|!g!h3[#X#Y3[~3_R{|3h}!O3h!Q![3n~3kP!Q![3n~3sP!v~!Q![3n~3{O#|~~4Qe!v~!O!P5c!Q![7^!d!e6x!g!h3[!i!j6}!m!n6}!o!p6}!r!s6}!v!w6}#W#X0`#X#Y3[#[#]*]#_#`7W#a#b+j#b#c.R#g#h/X#i#j.^#k#l1T#l#m8q#m#n1{${$|.^~5hR!v~!Q![5q!g!h3[#X#Y3[~5v`!v~!Q![5q!d!e6x!g!h3[!i!j6}!m!n6}!o!p6}!r!s6}!v!w6}#X#Y3[#[#]*]#_#`7W#a#b+j#b#c.R#g#h/X#i#j.^${$|.^~6}O!s~~7QQ!d!e6x#]#^7W~7ZP!d!e6x~7cd!v~!O!P5c!Q![7^!d!e6x!g!h3[!i!j6}!m!n6}!o!p6}!r!s6}!v!w6}#W#X0`#X#Y3[#[#]*]#_#`7W#a#b+j#b#c.R#g#h/X#i#j.^#k#l1T#m#n1{${$|.^~8tR!Q![8}!c!i8}#T#Z8}~9SR!v~!Q![8}!c!i8}#T#Z8}P9bT{P!Q![9]![!]9]!c!}9]#R#S9]#T#o9]~9vP!o~!_!`9y~:OO!p~~:TQ|~!_!`:Z#r#s:`~:`O!q~~:eO!P~~:jP!l~!_!`:m~:rO!n~R:yT{P#zQ!Q![:r![!]9]!c!}:r#R#S:r#T#o:r~;_O$k~~;dO$l~~;iO$O~~;lRO#S;i#S#T%`#T~;i~;zO$U~~<PR!_~!_!`<Y!`!a<_#r#s<d~<_O!W~~<dO!Y~~<iO!X~~<nO$W~",tokenizers:[0,1],topRules:{LogQL:[0,37]},specialized:[{term:43,get:(gt,zt)=>Z(gt)<<1},{term:43,get:(gt,zt)=>f(gt)<<1|1},{term:43,get:gt=>d[gt]||-1}],tokenPrec:0}),i=1,S=2,Q=3,J=4,R=5,r=6,u=7,g=8,w=9,k=10,N=11,pe=12,re=13,le=14,Te=15,xe=16,l=17,B=18,oe=19,F=20,de=21,be=22,Se=23,We=24,Qe=25,Ae=26,Pe=27,Ie=28,Be=29,z=30,Ee=31,te=32,Ce=33,me=34,Le=35,_e=36,je=37,Me=38,T=39,A=40,ge=41,se=42,$e=43,ie=44,fe=45,ue=46,ve=47,De=48,Ne=49,Xe=50,Fe=51,ke=52,Ye=53,Ke=54,Je=55,tt=56,nt=57,et=58,qe=59,Ve=60,ot=61,it=62,st=63,lt=64,Ue=65,ct=66,ye=67,He=68,Re=69,Ge=70,at=71,dt=72,rt=73,ht=74,pt=75,ft=76,mt=77,Ze=78,ut=79,Ot=80,vt=81,xt=82,bt=83,yt=84,Kt=85,Vt=86,Lt=87,Et=88,Gt=89,Pt=90,Yt=91,Ct=92,$t=93,St=94,wt=95,Rt=96,Tt=97,Mt=98,jt=99,Dt=100,Zt=101,Jt=102,qt=103,es=104,ts=105,ss=106,ns=107,os=108,as=109,is=110,rs=111,ls=112,cs=113,ds=114,us=115,Ft=116,Qt=117,gs=118,It=119,At=120,fs=121,ps=122,hs=123,_t=124,ms=125,Wt=126,Nt=127,Bt=128,kt=129,Ut=130,Xt=131,Ht=132,Os=133,vs=134,xs=135,bs=136,ys=137,Ls=138,Es=139,Ps=140},38903:(ze,we,t)=>{t.d(we,{VI:()=>U,y6:()=>ee,mD:()=>K,sp:()=>X});var e=t(80124),o=t(74848),m=t(96540),s=t(47184),M=t(22592),$=t(18857),P=t(69457),I=t(88744);function x({onChange:y,index:Y,operationId:ae,value:Oe,query:ne,datasource:C,timeRange:_,queryModeller:G}){const[he,H]=(0,m.useState)({});return(0,o.jsx)($.l6,{inputId:(0,I.OS)(ae,Y),onOpenMenu:async()=>{H({isLoading:!0});const q=await ce(ne,C,G,_);H({options:q,isLoading:void 0})},isLoading:he.isLoading,allowCustomValue:!0,noOptionsMessage:"No labels found",loadingMessage:"Loading labels",options:he.options,value:Oe?(0,s.z)(Oe.toString()):null,onChange:q=>{q.value&&y(Y,q.value)}})}async function ce(y,Y,ae,Oe=(0,M.E2)()){const ne=ae.renderQuery(y);if(!("getDataSamples"in Y)||typeof Y.getDataSamples!="function")return[];const C=await Y.getDataSamples({expr:ne,refId:"unwrap_samples"},Oe,{convertMetricQueryToLogQuery:!0});return(0,P.aN)(C[0]).map(he=>({label:he,value:he}))}var O=t(95826);function h(){const y=[O.EF.Sum,O.EF.Min,O.EF.Max,O.EF.Avg,O.EF.Stddev,O.EF.Stdvar,O.EF.Count].flatMap(C=>(0,I.G3)(C,{addOperationHandler:I.af,orderRank:O.h5.Last})),Y=[O.EF.TopK,O.EF.BottomK].flatMap(C=>(0,I.jC)(C,{params:[{name:"K-value",type:"number"}],defaultParams:[5]},{addOperationHandler:I.af,orderRank:O.h5.Last})),ae=[(0,I.fu)(O.EF.Rate),(0,I.fu)(O.EF.RateCounter),(0,I.fu)(O.EF.CountOverTime),(0,I.fu)(O.EF.SumOverTime),(0,I.fu)(O.EF.BytesRate),(0,I.fu)(O.EF.BytesOverTime),(0,I.fu)(O.EF.AbsentOverTime)],Oe=[...(0,I.yD)(O.EF.AvgOverTime),...(0,I.yD)(O.EF.MaxOverTime),...(0,I.yD)(O.EF.MinOverTime),...(0,I.yD)(O.EF.FirstOverTime),...(0,I.yD)(O.EF.LastOverTime),...(0,I.yD)(O.EF.StdvarOverTime),...(0,I.yD)(O.EF.StddevOverTime),...(0,I.yD)(O.EF.QuantileOverTime)];return[...y,...Y,...ae,...Oe,{id:O.EF.Json,name:"Json",params:[{name:"Expression",type:"string",restParam:!0,optional:!0,minWidth:18,placeholder:'server="servers[0]"',description:"Using expressions with your json parser will extract only the specified json fields to labels. You can specify one or more expressions in this way. All expressions must be quoted."}],defaultParams:[],toggleable:!0,alternativesKey:"format",category:O.Ln.Formats,orderRank:O.h5.Parsers,renderer:I.EP,addOperationHandler:I.af,explainHandler:()=>"This will extract keys and values from a [json](https://grafana.com/docs/loki/latest/logql/log_queries/#json) formatted log line as labels. The extracted labels can be used in label filter expressions and used as values for a range aggregation via the unwrap operation."},{id:O.EF.Logfmt,name:"Logfmt",params:[{name:"Strict",type:"boolean",optional:!0,description:"With strict parsing enabled, the logfmt parser immediately stops scanning the log line and returns early with an error when it encounters any poorly formatted key/value pair."},{name:"Keep empty",type:"boolean",optional:!0,description:"The logfmt parser retains standalone keys (keys without a value) as labels with its value set to empty string. "},{name:"Expression",type:"string",optional:!0,restParam:!0,minWidth:18,placeholder:"field_name",description:"Using expressions with your logfmt parser will extract and rename (if provided) only the specified fields to labels. You can specify one or more expressions in this way."}],defaultParams:[!1,!1],toggleable:!0,alternativesKey:"format",category:O.Ln.Formats,orderRank:O.h5.Parsers,renderer:I.EP,addOperationHandler:I.af,explainHandler:()=>"This will extract all keys and values from a [logfmt](https://grafana.com/docs/loki/latest/logql/log_queries/#logfmt) formatted log line as labels. The extracted labels can be used in label filter expressions and used as values for a range aggregation via the unwrap operation."},{id:O.EF.Regexp,name:"Regexp",params:[{name:"String",type:"string",hideName:!0,placeholder:"<re>",description:"The regexp expression that matches the structure of a log line.",minWidth:20}],defaultParams:[""],toggleable:!0,alternativesKey:"format",category:O.Ln.Formats,orderRank:O.h5.Parsers,renderer:(C,_,G)=>`${G} | regexp \`${C.params[0]}\``,addOperationHandler:I.af,explainHandler:()=>'The [regexp parser](https://grafana.com/docs/loki/latest/logql/log_queries/#regular-expression) takes a single parameter | regexp "<re>" which is the regular expression using the Golang RE2 syntax. The regular expression must contain a least one named sub-match (e.g (?P<name>re)), each sub-match will extract a different label. The expression matches the structure of a log line. The extracted labels can be used in label filter expressions and used as values for a range aggregation via the unwrap operation.'},{id:O.EF.Pattern,name:"Pattern",params:[{name:"String",type:"string",hideName:!0,placeholder:"<pattern-expression>",description:"The expression that matches the structure of a log line.",minWidth:20}],defaultParams:[""],toggleable:!0,alternativesKey:"format",category:O.Ln.Formats,orderRank:O.h5.Parsers,renderer:(C,_,G)=>`${G} | pattern \`${C.params[0]}\``,addOperationHandler:I.af,explainHandler:()=>"The [pattern parser](https://grafana.com/docs/loki/latest/logql/log_queries/#pattern) allows the explicit extraction of fields from log lines by defining a pattern expression (| pattern `<pattern-expression>`). The expression matches the structure of a log line. The extracted labels can be used in label filter expressions and used as values for a range aggregation via the unwrap operation."},{id:O.EF.Unpack,name:"Unpack",params:[],defaultParams:[],toggleable:!0,alternativesKey:"format",category:O.Ln.Formats,orderRank:O.h5.Parsers,renderer:I.EP,addOperationHandler:I.af,explainHandler:()=>"This will extract all keys and values from a JSON log line, [unpacking](https://grafana.com/docs/loki/latest/logql/log_queries/#unpack) all embedded labels in the pack stage. The extracted labels can be used in label filter expressions and used as values for a range aggregation via the unwrap operation."},{id:O.EF.LineFormat,name:"Line format",params:[{name:"String",type:"string",hideName:!0,placeholder:"{{.status_code}}",description:"A line template that can refer to stream labels and extracted labels.",minWidth:20}],defaultParams:[""],toggleable:!0,alternativesKey:"format",category:O.Ln.Formats,orderRank:O.h5.PipeOperations,renderer:(C,_,G)=>`${G} | line_format \`${C.params[0]}\``,addOperationHandler:I.af,explainHandler:()=>`This will replace log line using a specified template. The template can refer to stream labels and extracted labels.

Example: \`{{.status_code}} - {{.message}}\`

[Read the docs](https://grafana.com/docs/loki/latest/logql/log_queries/#line-format-expression) for more.
        `},{id:O.EF.LabelFormat,name:"Label format",params:[{name:"Label",type:"string"},{name:"Rename to",type:"string"}],defaultParams:["",""],toggleable:!0,alternativesKey:"format",category:O.Ln.Formats,orderRank:O.h5.PipeOperations,renderer:(C,_,G)=>`${G} | label_format ${C.params[1]}=${C.params[0]}`,addOperationHandler:I.af,explainHandler:()=>'This will change name of label to desired new label. In the example below, label "error_level" will be renamed to "level".\n\nExample: ``error_level=`level` ``\n\n[Read the docs](https://grafana.com/docs/loki/latest/logql/log_queries/#labels-format-expression) for more.\n        '},{id:O.EF.LineContains,name:"Line contains",params:[{name:"",type:"string",hideName:!0,restParam:!0,placeholder:"Text to find",description:"Find log lines that contains this text",minWidth:20,runQueryOnEnter:!0}],defaultParams:[""],toggleable:!0,alternativesKey:"line filter",category:O.Ln.LineFilters,orderRank:O.h5.LineFilters,renderer:(0,I.UF)("|="),addOperationHandler:I.af,explainHandler:C=>`Return log lines that contain string \`${C.params?.join("`, or `")}\`.`},{id:O.EF.LineContainsNot,name:"Line does not contain",params:[{name:"",type:"string",hideName:!0,restParam:!0,placeholder:"Text to exclude",description:"Find log lines that does not contain this text",minWidth:26,runQueryOnEnter:!0}],defaultParams:[""],toggleable:!0,alternativesKey:"line filter",category:O.Ln.LineFilters,orderRank:O.h5.LineFilters,renderer:(0,I.UF)("!="),addOperationHandler:I.af,explainHandler:C=>`Return log lines that does not contain string \`${C.params?.join("`, or `")}\`.`},{id:O.EF.LineContainsCaseInsensitive,name:"Line contains case insensitive",params:[{name:"",type:"string",hideName:!0,restParam:!0,placeholder:"Text to find",description:"Find log lines that contains this text",minWidth:33,runQueryOnEnter:!0}],defaultParams:[""],toggleable:!0,alternativesKey:"line filter",category:O.Ln.LineFilters,orderRank:O.h5.LineFilters,renderer:(0,I.UF)("|~",!0),addOperationHandler:I.af,explainHandler:C=>`Return log lines that match regex \`(?i)${C.params?.join("`, or `(?i)")}\`.`},{id:O.EF.LineContainsNotCaseInsensitive,name:"Line does not contain case insensitive",params:[{name:"",type:"string",hideName:!0,restParam:!0,placeholder:"Text to exclude",description:"Find log lines that does not contain this text",minWidth:40,runQueryOnEnter:!0}],defaultParams:[""],toggleable:!0,alternativesKey:"line filter",category:O.Ln.LineFilters,orderRank:O.h5.LineFilters,renderer:(0,I.UF)("!~",!0),addOperationHandler:I.af,explainHandler:C=>`Return log lines that does not match regex \`(?i)${C.params?.join("`, or `(?i)")}\`.`},{id:O.EF.LineMatchesRegex,name:"Line contains regex match",params:[{name:"",type:"string",hideName:!0,restParam:!0,placeholder:"Pattern to match",description:"Find log lines that match this regex pattern",minWidth:30,runQueryOnEnter:!0}],defaultParams:[""],toggleable:!0,alternativesKey:"line filter",category:O.Ln.LineFilters,orderRank:O.h5.LineFilters,renderer:(0,I.UF)("|~"),addOperationHandler:I.af,explainHandler:C=>`Return log lines that match a \`RE2\` regex pattern. \`${C.params?.join("`, or `")}\`.`},{id:O.EF.LineMatchesRegexNot,name:"Line does not match regex",params:[{name:"",type:"string",hideName:!0,restParam:!0,placeholder:"Pattern to exclude",description:"Find log lines that does not match this regex pattern",minWidth:30,runQueryOnEnter:!0}],defaultParams:[""],toggleable:!0,alternativesKey:"line filter",category:O.Ln.LineFilters,orderRank:O.h5.LineFilters,renderer:(0,I.UF)("!~"),addOperationHandler:I.af,explainHandler:C=>`Return log lines that doesn't match a \`RE2\` regex pattern. \`${C.params?.join("`, or `")}\`.`},{id:O.EF.LineFilterIpMatches,name:"IP line filter expression",params:[{name:"Operator",type:"string",minWidth:16,options:[O.NS.contains,O.NS.doesNotContain]},{name:"Pattern",type:"string",placeholder:"<pattern>",minWidth:16,runQueryOnEnter:!0}],defaultParams:["|=",""],toggleable:!0,alternativesKey:"line filter",category:O.Ln.LineFilters,orderRank:O.h5.LineFilters,renderer:(C,_,G)=>`${G} ${C.params[0]} ip(\`${C.params[1]}\`)`,addOperationHandler:I.af,explainHandler:C=>`Return log lines using IP matching of \`${C.params[1]}\``},{id:O.EF.LabelFilter,name:"Label filter expression",params:[{name:"Label",type:"string",minWidth:14},{name:"Operator",type:"string",minWidth:14,options:[O.NS.equals,O.NS.doesNotEqual,O.NS.matchesRegex,O.NS.doesNotMatchRegex,O.NS.greaterThan,O.NS.lessThan,O.NS.greaterThanOrEqual,O.NS.lessThanOrEqual]},{name:"Value",type:"string",minWidth:14}],defaultParams:["","=",""],toggleable:!0,alternativesKey:"label filter",category:O.Ln.LabelFilters,orderRank:O.h5.PipeOperations,renderer:I.sn,addOperationHandler:I.af,explainHandler:()=>"Label expression filter allows filtering using original and extracted labels."},{id:O.EF.LabelFilterIpMatches,name:"IP label filter expression",params:[{name:"Label",type:"string",minWidth:14},{name:"Operator",type:"string",minWidth:14,options:[O.NS.equals,O.NS.doesNotEqual]},{name:"Value",type:"string",minWidth:14}],defaultParams:["","=",""],toggleable:!0,alternativesKey:"label filter",category:O.Ln.LabelFilters,orderRank:O.h5.PipeOperations,renderer:(C,_,G)=>`${G} | ${C.params[0]} ${C.params[1]} ip(\`${C.params[2]}\`)`,addOperationHandler:I.af,explainHandler:C=>`Return log lines using IP matching of \`${C.params[2]}\` for \`${C.params[0]}\` label`},{id:O.EF.LabelFilterNoErrors,name:"No pipeline errors",params:[],defaultParams:[],toggleable:!0,alternativesKey:"label filter",category:O.Ln.LabelFilters,orderRank:O.h5.NoErrors,renderer:(C,_,G)=>`${G} | __error__=\`\``,addOperationHandler:I.af,explainHandler:()=>"Filter out all formatting and parsing errors."},{id:O.EF.Unwrap,name:"Unwrap",params:[{name:"Identifier",type:"string",hideName:!0,minWidth:16,placeholder:"Label key",editor:x},{name:"Conversion function",hideName:!0,type:"string",options:["duration","duration_seconds","bytes"],optional:!0}],defaultParams:["",""],toggleable:!0,alternativesKey:"format",category:O.Ln.Formats,orderRank:O.h5.Unwrap,renderer:(C,_,G)=>`${G} | unwrap ${C.params[1]?`${C.params[1]}(${C.params[0]})`:C.params[0]}`,addOperationHandler:I.af,explainHandler:C=>{let _=String(C.params[0]).length>0?C.params[0]:"<label>";return`Use the extracted label \`${_}\` as sample values instead of log lines for the subsequent range aggregation.${C.params[1]?` Conversion function \`${C.params[1]}\` wrapping \`${_}\` will attempt to convert this label from a specific format (e.g. 3k, 500ms).`:""}`}},{id:O.EF.Decolorize,name:"Decolorize",params:[],defaultParams:[],toggleable:!0,alternativesKey:"format",category:O.Ln.Formats,orderRank:O.h5.PipeOperations,renderer:(C,_,G)=>`${G} | decolorize`,addOperationHandler:I.af,explainHandler:()=>"This will remove ANSI color codes from log lines."},{id:O.EF.Drop,name:"Drop",params:[{name:"Label",type:"string",restParam:!0,optional:!0,minWidth:18,placeholder:'job="grafana"',description:"Specify labels or expressions to drop."}],defaultParams:[""],toggleable:!0,alternativesKey:"format",category:O.Ln.Formats,orderRank:O.h5.PipeOperations,renderer:I.EP,addOperationHandler:I.af,explainHandler:()=>"The drop expression will drop the given labels in the pipeline."},{id:O.EF.Keep,name:"Keep",params:[{name:"Label",type:"string",restParam:!0,optional:!0,minWidth:18,placeholder:'job="grafana"',description:"Specify labels or expressions to keep."}],defaultParams:[""],toggleable:!0,alternativesKey:"format",category:O.Ln.Formats,orderRank:O.h5.PipeOperations,renderer:I.EP,addOperationHandler:I.af,explainHandler:()=>"The keep expression will keep only the specified labels in the pipeline and drop all the other labels."},...e.I,{id:O.EF.NestedQuery,name:"Binary operation with query",params:[],defaultParams:[],toggleable:!0,category:O.Ln.BinaryOps,renderer:(C,_,G)=>G,addOperationHandler:I.VR}]}const X=h();function ee(y){return(X.find(Oe=>Oe.id===y)?.explainHandler?.({id:"",params:["<value>"]})||"").replace(/\[(.*)\]\(.*\)/g,"$1")}function K(y){return X.find(Y=>Y.id===y)}function U(y,Y){return!(Y.length<y.params.filter(ae=>!ae.optional).length)}},44376:(ze,we,t)=>{t.d(we,{U:()=>y});var e=t(74848),o=t(22803),m=t(96540),s=t(1906),M=t(739),$=t(19379),P=t(43173),I=t(63142),x=t(25984),ce=t(29457),O=t(92252);const h=({loading:ne,loadMoreLogs:C,deduplicatedRows:_=[],range:G,splitOpen:he,onClickFilterLabel:H,onClickFilterOutLabel:q,panelState:V,datasourceType:W,updatePanelState:c,width:b,logsTableFrames:L,visualisationType:v,...p})=>{const{sortOrder:n}=(0,ce.fl)(),D=(0,m.useMemo)(()=>new $.o,[]),j=(0,I.$j)(),Z=X(j);if(!he||!b||!c){console.error("<ControlledLogsTable>: Missing required props.");return}return(0,e.jsxs)("div",{className:Z.logRowsContainer,children:[(0,e.jsx)(O.V,{eventBus:D,visualisationType:v}),(0,e.jsx)("div",{className:Z.logRows,"data-testid":"logRowsTable",children:(0,e.jsx)(x.Y,{logsSortOrder:n,range:G,splitOpen:he,timeZone:p.timeZone,width:b-45,logsFrames:L??[],onClickFilterLabel:H,onClickFilterOutLabel:q,panelState:V,theme:j,updatePanelState:c,datasourceType:W})})]})},X=ne=>({logRows:(0,o.css)({overflowY:"visible",width:"100%"}),logRowsContainer:(0,o.css)({display:"flex",flexDirection:"row-reverse"})});var ee=t(17896),K=t(48575),U=t(55439);const y=(0,m.forwardRef)(({deduplicatedRows:ne,dedupStrategy:C,filterLevels:_,showLabels:G,showTime:he,logsMeta:H,logOptionsStorageKey:q,logsSortOrder:V,prettifyLogMessage:W,onLogOptionsChange:c,wrapLogMessage:b,...L},v)=>(0,e.jsxs)(ce.vv,{app:L.app||s.Jk.Unknown,displayedFields:[],dedupStrategy:C,enableLogDetails:!1,filterLevels:_,fontSize:"default",logOptionsStorageKey:q,logs:ne??[],logsMeta:H,prettifyJSON:W,showControls:!0,showTime:he,showUniqueLabels:G,sortOrder:V||M.uH.Descending,onLogOptionsChange:c,wrapLogMessage:b,children:[L.visualisationType==="logs"&&(0,e.jsx)(Y,{ref:v,...L,deduplicatedRows:ne}),L.visualisationType==="table"&&L.updatePanelState&&(0,e.jsx)(h,{...L})]}));y.displayName="ControlledLogRows";const Y=(0,m.forwardRef)(({loading:ne,loadMoreLogs:C,deduplicatedRows:_=[],range:G,scrollIntoView:he,...H},q)=>{const{app:V,dedupStrategy:W,filterLevels:c,forceEscape:b,prettifyJSON:L,sortOrder:v,showTime:p,showUniqueLabels:n,wrapLogMessage:D}=(0,ce.fl)(),j=(0,m.useMemo)(()=>new $.o,[]),Z=(0,m.useRef)(null);(0,m.useEffect)(()=>{const a=j.subscribe(U._B,i=>ae(i,Z.current));return()=>a.unsubscribe()},[j]),(0,m.useImperativeHandle)(q,()=>Z.current);const E=(0,m.useMemo)(()=>c.length===0?_:_.filter(a=>c.includes(a.logLevel)),[c,_]),f=(0,m.useMemo)(()=>q?Oe.forwardedScrollableLogRows:P.$.featureToggles.logsInfiniteScrolling?Oe.scrollableLogRows:Oe.logRows,[q]),d=(0,m.useCallback)(a=>{if(he){he(a);return}Z.current&&Z.current.scroll({behavior:"smooth",top:Z.current.scrollTop+a.getBoundingClientRect().top-window.innerHeight/2})},[he]);return(0,e.jsxs)("div",{className:Oe.logRowsContainer,children:[(0,e.jsx)(O.V,{eventBus:j}),(0,e.jsx)("div",{ref:Z,className:f,children:(0,e.jsx)(ee.u8,{loading:ne,loadMoreLogs:C,range:G,timeZone:H.timeZone,rows:E,scrollElement:Z.current,sortOrder:v,children:(0,e.jsx)(K.k,{...H,app:V,dedupStrategy:W,deduplicatedRows:E,forceEscape:b,logRows:E,logsSortOrder:v,scrollElement:Z.current,prettifyLogMessage:!!L,scrollIntoView:d,showLabels:!!n,showTime:p,wrapLogMessage:D})})})]})});Y.displayName="LogRowsComponent";function ae(ne,C){ne.payload.scrollTo==="top"?C?.scrollTo(0,0):C&&C.scrollTo(0,C.scrollHeight)}const Oe={scrollableLogRows:(0,o.css)({overflowY:"auto",width:"100%",maxHeight:"80vh"}),forwardedScrollableLogRows:(0,o.css)({overflowY:"auto",width:"100%",maxHeight:"100%"}),logRows:(0,o.css)({overflowX:"scroll",overflowY:"visible",width:"100%"}),logRowsContainer:(0,o.css)({display:"flex",flexDirection:"row-reverse",height:"100%"})}},46464:(ze,we,t)=>{t.d(we,{G:()=>_,E:()=>G});var e=t(88838),o=t(4123),m=t(28848),s=t.n(m),M=t(80011),$=t(5421),P=t(67770),I=t(43173),x=t(74746),ce=t(76487),O=t(62215),h=t(88152),X=t(38388),ee=t(8934);const K={"log-token-key":/(\b|\B)[\w_]+(?=\s*=)/gi,"log-token-string":/"(?!:)([^'"])*?"(?!:)/g},U={"log-token-uuid":/[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[1-5][0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12}/g,"log-token-size":/(?:\b|")\d+\.{0,1}\d*\s*[kKmMGgtTPp]*[bB]{1}(?:"|\b)/g,"log-token-duration":/(?:\b)\d+(\.\d+)?(ns|s|ms|s|m|h|d)(?:\b)/g,"log-token-method":/\b(GET|POST|PUT|DELETE|PATCH|HEAD|OPTIONS|TRACE|CONNECT)\b/g},y={"log-token-json-key":{pattern:/(^|[^\\])"(?:\\.|[^\\"\r\n])*"(?=\s*:)/,lookbehind:!0,greedy:!0},"log-token-string":{pattern:/(^|[^\\])"(?:\\.|[^\\"\r\n])*"(?!\s*:)/,lookbehind:!0,greedy:!0,inside:{...U}},"log-token-size":/-?\b\d+(?:\.\d+)?(?:e[+-]?\d+)?\b/i},Y=V=>{const W=Object.keys(V.labels).concat(V.fields.map(b=>b.keys[0])),c={"log-token-label":new RegExp(`\\b(${W.join("|")})(?:[=:]{1})\\b`,"g")};return V.isJSON?{...c,...y}:{...c,...U,...K}},ae=(V=[],W)=>{const c=V.map(b=>{const{cleaned:L,flags:v}=(0,X.bQ)(Oe(b));return new RegExp(`(?:${L})`,v)});return W&&c.push(new RegExp((0,ee.$f)(W),"gi")),c.length?{"log-search-match":c}:{}},Oe=V=>V.replace(/[[{(][\w,.\/:;<=>?:*+]+$/,""),ne=5e4,C=/(\r\n|\n|\r)/g;class _{constructor(W,{escape:c,getFieldLinks:b,grammar:L,prettifyJSON:v,timeZone:p,virtualization:n,wrapLogMessage:D}){this.collapsed=void 0,this._body=void 0,this._currentSearch=void 0,this._highlightedBody=void 0,this._highlightTokens=void 0,this._fields=void 0,this._getFieldLinks=void 0,this._json=!1,this.datasourceType=W.datasourceType,this.dataFrame=W.dataFrame,this.datasourceUid=W.datasourceUid,this.duplicates=W.duplicates,this.entry=W.entry,this.entryFieldIndex=W.entryFieldIndex,this.hasAnsi=W.hasAnsi,this.hasError=!!(0,x.Ei)(W),this.hasUnescapedContent=W.hasUnescapedContent,this.isSampled=!!(0,x.qR)(W),this.labels=W.labels,this.logLevel=W.logLevel,this.otelLanguage=(0,h.H7)(W),this.rowIndex=W.rowIndex,this.rowId=W.rowId,this.searchWords=W.searchWords,this.timeFromNow=W.timeFromNow,this.timeEpochMs=W.timeEpochMs,this.timeEpochNs=W.timeEpochNs,this.timeLocal=W.timeLocal,this.timeUtc=W.timeUtc,this.uid=W.uid,this.uniqueLabels=W.uniqueLabels,this.displayLevel=H(W.logLevel),this._getFieldLinks=b,this._grammar=L,this._prettifyJSON=!!v,this.timestamp=(0,M.LE)(W.timeEpochMs,{timeZone:p,format:$.WC.fullDateMS}),this._virtualization=n,this._wrapLogMessage=D;let j=W.raw;c&&W.hasUnescapedContent&&(j=(0,x.Hw)(j)),this.raw=j}clone(){const W=Object.assign(Object.create(Object.getPrototypeOf(this)),this);return W._wrapLogMessage=!0,W._body=void 0,W._highlightTokens=void 0,W}get body(){if(this._body===void 0){try{const c=(0,o.qg)(this.raw);typeof c=="object"&&c!==null&&!(c instanceof o._J)&&(this._json=!0);const b=this._wrapLogMessage&&this._prettifyJSON?(0,o.As)(c,void 0,2):this.raw;b&&(this.raw=b)}catch{}const W=I.$.featureToggles.otelLogsFormatting&&this.otelLanguage?(0,h.f_)(this):this.raw;this._body=this.collapsed?W.substring(0,this._virtualization?.getTruncationLength(null)??ne):W,this._wrapLogMessage||(this._body=this._body.replace(C,""))}return this._body}get errorMessage(){return(0,x.Ei)(this)}get fields(){return this._fields===void 0&&(this._fields=(0,O.jE)(this,this._getFieldLinks)),this._fields}get highlightedBody(){if(this._highlightedBody===void 0){const W=this.body;this._grammar=this._grammar??Y(this);const c=ae(this.searchWords,this._currentSearch);this._highlightedBody=s().highlight(W,{...c,...this._grammar},"logs")}return this._highlightedBody}get highlightedBodyTokens(){if(this._highlightTokens===void 0){const W=this.body;this._grammar=this._grammar??Y(this);const c=ae(this.searchWords,this._currentSearch);this._highlightTokens=s().tokenize(W,{...c,...this._grammar})}return this._highlightTokens}get isJSON(){return this._json}get sampledMessage(){return(0,x.qR)(this)}get timestampNs(){let W=this.timeEpochNs.substring(this.timeEpochMs.toString().length);return this.timestamp+W}getDisplayedFieldValue(W,c=!1){if(W===ce.I)return c?e.Ay.strip(this.body):this.body;let b="";if(this.labels[W]!=null)b=this.labels[W];else{const L=this.fields.find(v=>v.keys[0]===W);b=L?L.values.toString():""}return this._wrapLogMessage?b:b.replace(C,"")}updateCollapsedState(W,c){const b=W.length>0?W.map(v=>this.getDisplayedFieldValue(v,!0)).join(""):this.body;let L=b.length>=(this._virtualization?.getTruncationLength(c)??ne)?!0:void 0;if(!L&&this._virtualization){const v=this._virtualization.getTruncationLineCount();L=q(b,v)>=v?!0:L}(this.collapsed===void 0||L===void 0)&&(this.collapsed=L,this._body=void 0,this._highlightTokens=void 0)}setCollapsedState(W){this.collapsed!==W&&(this._body=void 0,this._highlightTokens=void 0),this.collapsed=W}setCurrentSearch(W){this._currentSearch=W,this._highlightTokens=void 0}}const G=(V,{escape:W,getFieldLinks:c,order:b,prettifyJSON:L,timeZone:v,virtualization:p,wrapLogMessage:n},D)=>(0,x.oR)(V,b).map(Z=>he(Z,{escape:W,getFieldLinks:c,grammar:D,prettifyJSON:L,timeZone:v,virtualization:p,wrapLogMessage:n})),he=(V,W)=>new _(V,W);function H(V=""){switch(V){case P.$b.critical:return"crit";case P.$b.warning:return"warn";case P.$b.unknown:return"";default:return V}}function q(V,W=1/0){let c=0;for(let b=0;b<V.length;++b){if(c>1/0)return c;V[b]===`
`?c+=1:V[b]==="\r"&&(c+=1,V[b]===`
`&&(b+=1))}return c}},48575:(ze,we,t)=>{t.d(we,{k:()=>d});var e=t(74848),o=t(22803),m=t(96540),s=t(739),M=t(92745),$=t(43173),P=t(63142),I=t(71599),x=t(30703),ce=t(78242);class O{constructor(){this.seen=new Set,this.count=0}getKey(i){this.count+=1;const S=`k_${i}`;return this.seen.has(S)?`i_${this.count}`:(this.seen.add(S),S)}}var h=t(74746),X=t(2543),ee=t(80011),K=t(27489),U=t(45967),y=t(13744),Y=t(59896),ae=t(23257),Oe=t.n(ae),ne=t(38388),C=t(25461),_=t(76319),G=t(47931);const he=(0,m.memo)(({logText:a,onOpenContext:i,onPermalinkClick:S,onPinLine:Q,onUnpinLine:J,pinLineButtonTooltipTitle:R,pinned:r,row:u,showContextToggle:g,styles:w,mouseIsOver:k,onBlur:N,getRowContextQuery:pe,addonBefore:re,addonAfter:le})=>{const Te=(0,m.useMemo)(()=>g?g(u):!1,[u,g]),xe=(0,m.useCallback)(be=>{be.stopPropagation()},[]),l=(0,m.useCallback)(async be=>{be.stopPropagation(),(0,h.R)(be,u,pe,i)},[i,pe,u]),B=(0,m.useCallback)(be=>{!be.currentTarget.contains(be.relatedTarget)&&N&&N()},[N]),oe=(0,m.useCallback)(()=>a,[a]),F=(0,m.useMemo)(()=>re?H(re,u):null,[re,u]),de=(0,m.useMemo)(()=>le?H(le,u):null,[le,u]);return(0,e.jsxs)("span",{className:`log-row-menu ${w.rowMenu}`,onClick:xe,onBlur:B,children:[r&&!k&&(0,e.jsx)(_.K,{className:w.unPinButton,size:"md",name:"gf-pin",onClick:()=>J&&J(u),tooltip:(0,M.t)("logs.log-row-menu-cell.tooltip-unpin-line","Unpin line"),tooltipPlacement:"top","aria-label":(0,M.t)("logs.log-row-menu-cell.aria-label-unpin-line","Unpin line"),tabIndex:0}),k&&(0,e.jsxs)(e.Fragment,{children:[F,Te&&(0,e.jsx)(_.K,{size:"md",name:"gf-show-context",onClick:l,tooltip:(0,M.t)("logs.log-row-menu-cell.tooltip-show-context","Show context"),tooltipPlacement:"top","aria-label":(0,M.t)("logs.log-row-menu-cell.aria-label-show-context","Show context"),tabIndex:0}),(0,e.jsx)(G.b,{className:w.copyLogButton,icon:"copy",variant:"secondary",fill:"text",size:"md",getText:oe,tooltip:(0,M.t)("logs.log-row-menu-cell.tooltip-copy-to-clipboard","Copy to clipboard"),tooltipPlacement:"top",tabIndex:0}),r&&J&&(0,e.jsx)(_.K,{className:w.unPinButton,size:"md",name:"gf-pin",onClick:()=>J&&J(u),tooltip:(0,M.t)("logs.log-row-menu-cell.tooltip-unpin-line","Unpin line"),tooltipPlacement:"top","aria-label":(0,M.t)("logs.log-row-menu-cell.aria-label-unpin-line","Unpin line"),tabIndex:0}),!r&&Q&&(0,e.jsx)(_.K,{className:w.unPinButton,size:"md",name:"gf-pin",onClick:()=>Q&&Q(u),tooltip:R??"Pin line",tooltipPlacement:"top","aria-label":(0,M.t)("logs.log-row-menu-cell.aria-label-pin-line","Pin line"),tabIndex:0}),S&&u.rowId!==void 0&&u.uid&&(0,e.jsx)(_.K,{tooltip:(0,M.t)("logs.log-row-menu-cell.tooltip-copy-shortlink","Copy shortlink"),"aria-label":(0,M.t)("logs.log-row-menu-cell.aria-label-copy-shortlink","Copy shortlink"),tooltipPlacement:"top",size:"md",name:"share-alt",onClick:()=>S(u),tabIndex:0}),de]})]})});function H(a,i){return a.map((S,Q)=>{if((0,m.isValidElement)(S)){const J=S.props.onClick;return J?(0,m.cloneElement)(S,{onClick:R=>{J(R,i)},key:Q}):S}return S})}he.displayName="LogRowMenuCell";const q=1e5,V=({hasAnsi:a,entry:i,highlights:S,styles:Q})=>{const J=(0,m.useMemo)(()=>i.length-q,[i]),R=S&&S.length>0&&S[0]&&S[0].length>0&&J<=0,r=S??[],[u,g]=(0,m.useState)(J<0),w=(0,m.useMemo)(()=>u?i:i.substring(0,q),[i,u]);if(a){const k=R?{searchWords:r,highlightClassName:Q.logsRowMatchHighLight}:void 0;return(0,e.jsx)(C.$,{value:w,highlight:k})}else if(R)return(0,e.jsx)(Oe(),{textToHighlight:w,searchWords:r,findChunks:ne.Oq,highlightClassName:Q.logsRowMatchHighLight});return(0,e.jsxs)(e.Fragment,{children:[w,!u&&(0,e.jsx)(W,{showFull:u,toggle:g,diff:J})]})},W=({toggle:a,diff:i})=>{const S=c((0,P.$j)()),Q=J=>{J.stopPropagation(),a(!0)};return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(M.x6,{i18nKey:"logs.log-row-message.ellipsis",children:"\u2026 "}),(0,e.jsxs)("button",{className:S.showMore,onClick:Q,children:[i," ",(0,e.jsx)(M.x6,{i18nKey:"logs.log-row-message.more",children:"more"})]})]})},c=a=>({showMore:(0,o.css)({backgroundColor:"transparent",display:"inline-flex",fontWeight:a.typography.fontWeightMedium,fontSize:a.typography.size.sm,fontFamily:a.typography.fontFamily,height:a.spacing(3),padding:a.spacing(.25,1),color:a.colors.secondary.text,border:`1px solid ${a.colors.border.strong}`,"&:hover":{background:a.colors.secondary.transparent,borderColor:a.colors.emphasize(a.colors.border.strong,.25),color:a.colors.secondary.text}})}),b=(a,i,S,Q,J)=>{let R=a.raw;if(i)try{return R=JSON.stringify(JSON.parse(R),void 0,2),a.hasUnescapedContent&&J?(0,h.Hw)(R):R}catch{}return a.hasUnescapedContent&&J&&(R=(0,h.Hw)(R)),!S&&!Q&&(R=R.replace(/(\r\n|\n|\r)/g,"")),R},L=(0,m.memo)(a=>{const{row:i,wrapLogMessage:S,prettifyLogMessage:Q,showContextToggle:J,styles:R,onOpenContext:r,onPermalinkClick:u,onUnpinLine:g,onPinLine:w,pinLineButtonTooltipTitle:k,pinned:N,mouseIsOver:pe,onBlur:re,getRowContextQuery:le,expanded:Te,logRowMenuIconsBefore:xe,logRowMenuIconsAfter:l,forceEscape:B}=a,{hasAnsi:oe}=i,F=(0,m.useMemo)(()=>b(i,Q,S,!!Te,!!B),[Te,B,Q,i,S]),de=pe||N;return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("td",{className:R.logsRowMessage,children:(0,e.jsx)("div",{className:S?R.positionRelative:R.horizontalScroll,children:(0,e.jsx)("div",{className:`${R.logLine} ${R.positionRelative}`,children:(0,e.jsx)(V,{hasAnsi:oe,entry:F,highlights:i.searchWords,styles:R})})})}),(0,e.jsx)("td",{className:`log-row-menu-cell ${R.logRowMenuCell}`,children:de&&(0,e.jsx)(he,{logText:F,row:i,showContextToggle:J,getRowContextQuery:le,onOpenContext:r,onPermalinkClick:u,onPinLine:w,onUnpinLine:g,pinLineButtonTooltipTitle:k,pinned:N,styles:R,mouseIsOver:pe,onBlur:re,addonBefore:xe,addonAfter:l})})]})});L.displayName="LogRowMessage";var v=t(76487),p=t(62215);const n=(0,m.memo)(a=>{const{row:i,detectedFields:S,getFieldLinks:Q,wrapLogMessage:J,styles:R,mouseIsOver:r,pinned:u,logRowMenuIconsBefore:g,logRowMenuIconsAfter:w,preview:k,...N}=a,pe=J?"":D.noWrap,re=(0,m.useMemo)(()=>(0,p.jE)(i,Q),[Q,i]),le=(0,m.useMemo)(()=>{let xe="";for(let l=0;l<S.length;l++){const B=S[l];B===v.I&&(xe+=` ${i.entry}`);const oe=re.find(F=>F.keys[0]===B);oe!=null&&(xe+=` ${B}=${oe.values}`),i.labels[B]!=null&&i.labels[B]!=null&&(xe+=` ${B}=${i.labels[B]}`)}return xe.trimStart()},[S,re,i.entry,i.labels]),Te=r||u;return k?(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("td",{children:(0,e.jsx)("div",{children:le})}),(0,e.jsx)("td",{})]}):(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("td",{className:R.logsRowMessage,children:(0,e.jsx)("div",{className:pe,children:le})}),(0,e.jsx)("td",{className:`log-row-menu-cell ${R.logRowMenuCell}`,children:Te&&(0,e.jsx)(he,{logText:le,row:i,styles:R,pinned:u,mouseIsOver:r,addonBefore:g,addonAfter:w,...N})})]})}),D={noWrap:(0,o.css)({whiteSpace:"nowrap"})};n.displayName="LogRowMessageDisplayedFields";var j=t(21429);const Z=({getRows:a,onClickFilterLabel:i,onClickFilterOutLabel:S,onClickShowField:Q,onClickHideField:J,enableLogDetails:R,row:r,showDuplicates:u,showContextToggle:g,showLabels:w,showTime:k,displayedFields:N,wrapLogMessage:pe,prettifyLogMessage:re,getFieldLinks:le,forceEscape:Te,app:xe,styles:l,getRowContextQuery:B,pinned:oe,logRowMenuIconsBefore:F,logRowMenuIconsAfter:de,timeZone:be,permalinkedRowId:Se,scrollIntoView:We,handleTextSelection:Qe,onLogRowHover:Ae,...Pe})=>{const[Ie,Be]=(0,m.useState)(!1),[z,Ee]=(0,m.useState)(!1),[te,Ce]=(0,m.useState)(!1),[me,Le]=(0,m.useState)(!1),_e=(0,m.useRef)(null),je=(0,P.$j)(),Me=(0,m.useMemo)(()=>(0,ee.LE)(r.timeEpochMs,{timeZone:be,defaultWithMS:!0}),[r.timeEpochMs,be]),T=(0,m.useMemo)(()=>(0,j.L)(je,r.logLevel),[r.logLevel,je]),A=(0,m.useMemo)(()=>r.hasUnescapedContent&&Te?{...r,entry:(0,h.Hw)(r.entry)}:r,[Te,r]),ge=(0,h.Ei)(r),se=ge!==void 0,$e=(0,h.qR)(r),ie=$e!==void 0;(0,m.useEffect)(()=>{if(Se!==r.uid){Le(!1);return}if(!me){Le(!0);return}_e.current&&We&&(We(_e.current),(0,K.rR)("grafana_explore_logs_permalink_opened",{datasourceType:r.datasourceType??"unknown",logRowUid:r.uid}),Le(!0))},[me,Se,r.datasourceType,r.uid,We]);const fe=(0,m.useCallback)((0,X.debounce)(()=>{Be(!1)},3e3),[]),ue=(0,m.useCallback)(Fe=>{Be(!0),Pe.onOpenContext(Fe,fe)},[fe,Pe]),ve=(0,m.useCallback)(Fe=>{Qe?.(Fe,r)||R&&Ee(ke=>!ke)},[R,Qe,r]),De=(0,m.useCallback)(()=>{Ce(!0),Ae&&Ae(r)},[Ae,r]),Ne=(0,m.useCallback)(Fe=>{Qe&&document.getSelection()?.toString()&&Fe.buttons>0&&Ce(!1)},[Qe]),Xe=(0,m.useCallback)(()=>{Ce(!1)},[]);return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsxs)("tr",{ref:_e,className:`${l.logsRow} ${se?l.errorLogRow:""} ${Ie||me||oe?l.highlightBackground:""}`,onClick:ve,onMouseEnter:De,onMouseLeave:Xe,onMouseMove:Ne,onFocus:De,children:[u&&(0,e.jsx)("td",{className:l.logsRowDuplicates,children:A.duplicates&&A.duplicates>0?`${A.duplicates+1}x`:null}),(0,e.jsxs)("td",{className:se||ie?l.logsRowWithError:`${T.logsRowLevelColor} ${l.logsRowLevel}`,children:[se&&(0,e.jsx)(U.m,{content:(0,M.t)("logs.log-row-message.tooltip-error","Error: {{errorMessage}}",{errorMessage:ge}),placement:"right",theme:"error",children:(0,e.jsx)(x.I,{className:l.logIconError,name:"exclamation-triangle",size:"xs"})}),ie&&(0,e.jsx)(U.m,{content:$e,placement:"right",theme:"info",children:(0,e.jsx)(x.I,{className:l.logIconInfo,name:"info-circle",size:"xs"})})]}),(0,e.jsx)("td",{title:R?z?"Hide log details":"See log details":"",className:R?l.logsRowToggleDetails:"",children:R&&(0,e.jsx)("button",{"aria-label":(0,M.t)("logs.log-row-message.see-details","See log details"),className:l.detailsToggle,"aria-expanded":z,children:(0,e.jsx)(x.I,{className:l.topVerticalAlign,name:z?"angle-down":"angle-right"})})}),k&&(0,e.jsx)("td",{className:l.logsRowLocalTime,children:Me}),w&&A.uniqueLabels&&(0,e.jsx)("td",{className:l.logsRowLabels,children:(0,e.jsx)(Y.h,{labels:A.uniqueLabels,addTooltip:!1})}),N&&N.length>0?(0,e.jsx)(n,{row:A,showContextToggle:g,detectedFields:N,getFieldLinks:le,wrapLogMessage:pe,onOpenContext:ue,onPermalinkClick:Pe.onPermalinkClick,styles:l,onPinLine:Pe.onPinLine,onUnpinLine:Pe.onUnpinLine,pinned:oe,mouseIsOver:te,onBlur:Xe,logRowMenuIconsBefore:F,logRowMenuIconsAfter:de}):(0,e.jsx)(L,{row:A,showContextToggle:g,getRowContextQuery:B,wrapLogMessage:pe,prettifyLogMessage:re,onOpenContext:ue,onPermalinkClick:Pe.onPermalinkClick,app:xe,styles:l,onPinLine:Pe.onPinLine,onUnpinLine:Pe.onUnpinLine,pinLineButtonTooltipTitle:Pe.pinLineButtonTooltipTitle,pinned:oe,mouseIsOver:te,onBlur:Xe,expanded:z,forceEscape:Te,logRowMenuIconsBefore:F,logRowMenuIconsAfter:de})]}),z&&(0,e.jsx)(y.x,{onPinLine:Pe.onPinLine,className:`${l.logsRow} ${se?l.errorLogRow:""} ${me&&!z?l.highlightBackground:""}`,showDuplicates:u,getFieldLinks:le,onClickFilterLabel:i,onClickFilterOutLabel:S,onClickShowField:Q,onClickHideField:J,getRows:a,row:A,wrapLogMessage:pe,hasError:se,displayedFields:N,app:xe,styles:l,isFilterLabelActive:Pe.isFilterLabelActive,pinLineButtonTooltipTitle:Pe.pinLineButtonTooltipTitle})]})},E=()=>{},f=({row:a,showDuplicates:i,showLabels:S,showTime:Q,displayedFields:J,...R})=>(0,e.jsxs)("tr",{children:[i&&(0,e.jsx)("td",{}),(0,e.jsx)("td",{}),(0,e.jsx)("td",{}),Q&&(0,e.jsx)("td",{children:a.timeEpochMs}),S&&a.uniqueLabels&&(0,e.jsx)("td",{}),J&&J.length>0?(0,e.jsx)(n,{...R,row:a,detectedFields:J,mouseIsOver:!1,onBlur:E,onOpenContext:E,preview:!0}):(0,e.jsx)("td",{className:R.styles.logsRowMessage,children:a.entry}),(0,e.jsx)("td",{className:`log-row-menu-cell ${R.styles.logRowMenuCell}`})]}),d=(0,m.memo)(({deduplicatedRows:a,logRows:i=[],dedupStrategy:S,logsSortOrder:Q,previewLimit:J,pinnedLogs:R,onOpenContext:r,onClickFilterOutString:u,onClickFilterString:g,scrollElement:w,renderPreview:k=!1,enableLogDetails:N,permalinkedRowId:pe,...re})=>{const[le,Te]=(0,m.useState)(k&&!pe?Math.max(2*Math.ceil(window.innerHeight/20),Math.ceil(i.length/3)):1/0),[xe,l]=(0,m.useState)({selection:"",selectedRow:null,popoverMenuCoordinates:{x:0,y:0}}),[B,oe]=(0,m.useState)(!1),F=(0,m.useRef)(null),de=(0,P.$j)(),be=(0,j.D)(de),Se=a||i,We=(0,m.useMemo)(()=>Se.reduce((Me,T)=>T.duplicates?Me+T.duplicates:Me,0),[Se]),Qe=S!==s.fY.none&&We>0,Ae=(0,m.useMemo)(()=>Q?(0,h.oR)(Se,Q):Se,[Se,Q]),Pe=(0,m.useMemo)(()=>()=>Ae,[Ae]),Ie=(0,m.useRef)(null),Be=new O;(0,m.useEffect)(()=>()=>{Ie.current&&(document.removeEventListener("click",Ie.current),document.removeEventListener("contextmenu",Ie.current))},[]),(0,m.useEffect)(()=>{if(!w)return;function Me(){Te(1/0),w?.removeEventListener("scroll",Me),w?.removeEventListener("wheel",Me)}w.addEventListener("scroll",Me),w.addEventListener("wheel",Me)},[i.length,w]);const z=(0,m.useCallback)((Me,T)=>{r&&r(Me,T)},[r]),Ee=(0,m.useCallback)(()=>!$.$.featureToggles.logRowsPopoverMenu||(0,h.Vu)()?!1:!!(u||g),[u,g]),te=(0,m.useCallback)(()=>{Ie.current&&(document.removeEventListener("click",Ie.current),document.removeEventListener("contextmenu",Ie.current),Ie.current=null),l({selection:"",popoverMenuCoordinates:{x:0,y:0},selectedRow:null})},[]),Ce=(0,m.useCallback)(Me=>{if((0,h.a8)(Me.target)&&!F.current?.contains(Me.target)){te();return}document.getSelection()?.toString()||te()},[te]),me=(0,m.useCallback)((Me,T)=>{const A=document.getSelection()?.toString();if(!A)return!1;if(Me.altKey&&(0,h.Ck)(),Ee()===!1)return!!A;if(!F.current)return!1;const ge=270,se=105,$e=Me.clientX+ge>window.innerWidth?window.innerWidth-ge:Me.clientX,ie=Me.clientY+se>window.innerHeight?window.innerHeight-se:Me.clientY;return l({selection:A,popoverMenuCoordinates:{x:$e,y:ie},selectedRow:T}),Ie.current=Ce,document.addEventListener("click",Ce),document.addEventListener("contextmenu",Ce),!0},[Ce,Ee]),Le=(0,m.useCallback)(()=>{oe(!0)},[]),_e=(0,m.useCallback)(()=>{oe(!1)},[]),je=(0,m.useCallback)(()=>{(0,h.PO)(),oe(!1)},[]);return(0,e.jsxs)("div",{className:be.logRows,ref:F,children:[xe.selection&&xe.selectedRow&&(0,e.jsx)(ce.N,{close:te,row:xe.selectedRow,selection:xe.selection,...xe.popoverMenuCoordinates,onClickFilterString:g,onClickFilterOutString:u,onDisable:Le}),B&&(0,e.jsx)(I.u,{isOpen:!0,title:(0,M.t)("logs.log-rows.disable-popover.title","Disable menu"),body:(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(M.x6,{i18nKey:"logs.log-rows.disable-popover.message",children:"You are about to disable the logs filter menu. To re-enable it, select text in a log line while holding the alt key."}),(0,e.jsxs)("div",{className:be.shortcut,children:[(0,e.jsx)(x.I,{name:"keyboard"}),(0,e.jsx)(M.x6,{i18nKey:"logs.log-rows.disable-popover-message.shortcut",children:"alt+select to enable again"})]})]}),confirmText:(0,M.t)("logs.log-rows.disable-popover.confirm","Confirm"),icon:"exclamation-triangle",onConfirm:je,onDismiss:_e}),(0,e.jsx)("table",{className:(0,o.cx)(be.logsRowsTable,re.overflowingContent?"":be.logsRowsTableContain),children:(0,e.jsx)("tbody",{children:Ae.map((Me,T)=>T<le?(0,e.jsx)(Z,{getRows:Pe,row:Me,showDuplicates:Qe,logsSortOrder:Q,onOpenContext:z,styles:be,onPermalinkClick:re.onPermalinkClick,scrollIntoView:re.scrollIntoView,permalinkedRowId:pe,onPinLine:re.onPinLine,onUnpinLine:re.onUnpinLine,pinLineButtonTooltipTitle:re.pinLineButtonTooltipTitle,pinned:R?.some(A=>A===Me.rowId||A===Me.uid),isFilterLabelActive:re.isFilterLabelActive,handleTextSelection:me,enableLogDetails:N,...re},Be.getKey(Me.uid)):(0,e.jsx)(f,{enableLogDetails:!1,getRows:Pe,onOpenContext:z,styles:be,showDuplicates:Qe,...re,row:Me},`preview_${Be.getKey(Me.uid)}`))})})]})});d.displayName="LogRows"},53622:(ze,we,t)=>{t.d(we,{EO:()=>_e,l_:()=>je,Bj:()=>me});var e=t(74848),o=t(22803),m=t(33149),s=t(96540),M=t(84596),$=t(92745),P=t(27489),I=t(63142),x=t(45897),ce=t(54314),O=t(60208),h=t(30703),X=t(2543),ee=t(39443),K=t(78012),U=t(89599),y=t(74746),Y=t(13744),ae=t(62215),Oe=t(21835),ne=t(8073),C=t(76319),_=t(76487),G=t(29457),he=t(58640);const H=()=>{const{displayedFields:T,setDisplayedFields:A}=(0,G.fl)(),ge=(0,s.useCallback)(($e,ie,fe)=>{const ue=[...T],ve=T[$e];ue.splice($e,1),ue.splice(ie,0,ve),A?.(ue),(0,he.A)("logs_log_line_details_organized_fields",{quantity:ue.length,mode:fe})},[T,A]),se=(0,s.useCallback)($e=>{$e.destination!=null&&ge($e.source.index,$e.destination.index,"drag")},[ge]);return(0,e.jsx)("div",{children:(0,e.jsx)(Oe.JY,{onDragEnd:se,children:(0,e.jsx)(Oe.gL,{droppableId:"displayed-fields",direction:"vertical",children:$e=>(0,e.jsxs)("div",{ref:$e.innerRef,...$e.droppableProps,children:[T.map((ie,fe)=>(0,e.jsx)(q,{field:ie,index:fe,moveField:ge},ie)),$e.placeholder]})})})})},q=({field:T,index:A,moveField:ge})=>(0,e.jsx)(Oe.sx,{draggableId:T,index:A,children:se=>(0,e.jsx)(V,{field:T,index:A,moveField:ge,provided:se},T)}),V=({field:T,index:A,moveField:ge,provided:se})=>{const{detailsMode:$e,displayedFields:ie,onClickHideField:fe}=(0,G.fl)(),ue=(0,I.of)(W,$e),ve=A===ie.length-1?0:A+1,De=A===0?ie.length-1:A-1;return(0,e.jsx)("div",{ref:se.innerRef,...se.draggableProps,...se.dragHandleProps,children:(0,e.jsx)(ne.Z,{noMargin:!0,className:ue.fieldCard,children:(0,e.jsxs)("div",{className:ue.fieldWrapper,children:[(0,e.jsx)("div",{className:ue.field,children:T===_.I?(0,$.t)("logs.log-line-details.log-line-field","Log line"):T}),ie.length>1&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(C.K,{name:"arrow-down",onClick:()=>ge(A,ve,"button"),tooltip:(0,$.t)("logs.log-line-details.move-displayed-field-down","Move down")}),(0,e.jsx)(C.K,{name:"arrow-up",onClick:()=>ge(A,De,"button"),tooltip:(0,$.t)("logs.log-line-details.move-displayed-field-up","Move up")})]}),fe&&(0,e.jsx)(C.K,{name:"times",onClick:()=>fe(T),tooltip:(0,$.t)("logs.log-line-details.remove-displayed-field","Remove field")})]})})})},W=(T,A)=>({fieldCard:(0,o.css)({display:"block",padding:T.spacing(1),marginBottom:T.spacing(1),width:A==="inline"?"30vw":void 0,overflow:"hidden",textOverflow:"ellipsis",wordBreak:"break-word"}),fieldWrapper:(0,o.css)({cursor:"move",display:"flex",gap:T.spacing(.5),justifyContent:"space-evenly"}),field:(0,o.css)({flex:1})});var c=t(4123),b=t(1906),L=t(99885),v=t(5753),p=t(47931),n=t(37234),D=t(29229);const j=(0,s.memo)(({disableActions:T,fields:A,log:ge,logs:se,search:$e})=>{const ie=(0,I.of)(E),fe=(0,s.useCallback)(()=>se,[se]),ue=(0,s.useMemo)(()=>$e?R(A,$e):A,[A,$e]);if(A.length){if(ue.length===0)return(0,$.t)("logs.log-line-details.search.no-results","No results to display.")}else return null;return(0,e.jsx)("div",{className:T?ie.fieldsTableNoActions:ie.fieldsTable,children:ue.map((ve,De)=>(0,e.jsx)(f,{disableActions:T,getLogs:fe,fieldIndex:ve.fieldIndex,keys:ve.keys,links:ve.links,log:ge,values:ve.values},`${ve.keys[0]}=${ve.values[0]}-${De}`))})});j.displayName="LogLineDetailsFields";const Z=({fields:T,log:A,logs:ge,search:se})=>{const $e=(0,I.of)(E),ie=(0,s.useCallback)(()=>ge,[ge]),fe=(0,s.useMemo)(()=>se?r(T,se):T,[T,se]);if(T.length){if(fe.length===0)return(0,$.t)("logs.log-line-details.search.no-results","No results to display.")}else return null;return(0,e.jsx)("div",{className:$e.fieldsTable,children:fe.map((ue,ve)=>(0,e.jsx)(f,{getLogs:ie,isLabel:!0,keys:[ue.key],links:ue.links,log:A,values:[ue.value]},`${ue.key}=${ue.value}-${ve}`))})},E=T=>({fieldsTable:(0,o.css)({display:"grid",gap:T.spacing(1),gridTemplateColumns:`${T.spacing(11.5)} minmax(auto, 40%) 1fr`}),fieldsTableNoActions:(0,o.css)({display:"grid",gap:T.spacing(1),gridTemplateColumns:"auto 1fr"})}),f=({disableActions:T=!1,fieldIndex:A,getLogs:ge,isLabel:se,links:$e,log:ie,keys:fe,values:ue})=>{const[ve,De]=(0,s.useState)(!1),[Ne,Xe]=(0,s.useState)(0),[Fe,ke]=(0,s.useState)(null),{app:Ye,closeDetails:Ke,displayedFields:Je,isLabelFilterActive:tt,noInteractions:nt,onClickFilterLabel:et,onClickFilterOutLabel:qe,onClickShowField:Ve,onClickHideField:ot,onPinLine:it,pinLineButtonTooltipTitle:st,syntaxHighlighting:lt}=(0,G.fl)(),Ue=(0,I.of)(d),ct=(0,s.useCallback)(()=>se?(0,y.Tj)(ge(),fe[0]):A!==void 0?(0,y.s2)(ie.dataFrame.fields[A].values):[],[A,ge,se,fe,ie.dataFrame.fields]),ye=(0,s.useCallback)(()=>{const Ze=ct(),ut=Ze.reduce((Ot,vt)=>Ot+vt.count,0);(!(0,X.isEqual)(Fe,Ze)||Ne!==ut)&&(ke(Ze),Xe(ut))},[Ne,Fe,ct]);(0,s.useEffect)(()=>{ve&&ye()},[ve,ye]);const He=(0,s.useCallback)((Ze,ut)=>{nt||(0,P.rR)(Ze,ut)},[nt]),Re=(0,s.useCallback)(()=>{Ve&&Ve(fe[0]),He("logs_log_line_details_show_field_clicked",{datasourceType:ie.datasourceType})},[Ve,He,ie.datasourceType,fe]),Ge=(0,s.useCallback)(()=>{ot&&ot(fe[0]),He("logs_log_line_details_hide_field_clicked",{datasourceType:ie.datasourceType})},[ot,He,ie.datasourceType,fe]),at=(0,s.useCallback)(()=>{et&&et(fe[0],ue[0],(0,n.f8)(ie)||void 0),He("logs_log_line_details_filter_clicked",{datasourceType:ie.datasourceType,filterType:"include",logRowUid:ie.uid})},[et,He,ie,fe,ue]),dt=(0,s.useCallback)(()=>{qe&&qe(fe[0],ue[0],(0,n.f8)(ie)||void 0),He("logs_log_line_details_filter_clicked",{datasourceType:ie.datasourceType,filterType:"exclude",logRowUid:ie.uid})},[qe,He,ie,fe,ue]),rt=(0,s.useCallback)(async()=>tt?await tt(fe[0],ue[0],ie.dataFrame?.refId):!1,[tt,fe,ue,ie.dataFrame?.refId]),ht=(0,s.useCallback)(()=>{De(Ze=>!Ze),He("logs_log_line_details_stats_clicked",{dataSourceType:ie.datasourceType,fieldType:se?"label":"field",type:ve?"close":"open",logRowUid:ie.uid,app:Ye})},[Ye,se,ie.datasourceType,ie.uid,He,ve]),pt=(0,s.useMemo)(()=>Ye===b.Jk.Explore&&ie.dataFrame?.refId?` in query ${ie.dataFrame?.refId}`:"",[Ye,ie.dataFrame?.refId]),ft=fe.length===1,mt=ue.length===1;return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsxs)("div",{className:Ue.row,children:[!T&&(0,e.jsxs)("div",{className:Ue.actions,children:[et&&(0,e.jsx)(J,{name:"search-plus",onClick:at,isActive:rt,tooltipSuffix:pt}),qe&&(0,e.jsx)(C.K,{name:"search-minus",tooltip:Ye===b.Jk.Explore&&ie.dataFrame?.refId?(0,$.t)("logs.log-line-details.fields.filter-out-query","Filter out value in query {{query}}",{query:ie.dataFrame?.refId}):(0,$.t)("logs.log-line-details.fields.filter-out","Filter out value"),onClick:dt}),ft&&Je.includes(fe[0])&&(0,e.jsx)(C.K,{variant:"primary",tooltip:(0,$.t)("logs.log-line-details.fields.toggle-field-button.hide-this-field","Hide this field"),name:"eye",onClick:Ge}),ft&&!Je.includes(fe[0])&&(0,e.jsx)(C.K,{tooltip:(0,$.t)("logs.log-line-details.fields.toggle-field-button.field-instead-message","Show this field instead of the message"),name:"eye",onClick:Re}),(0,e.jsx)(C.K,{variant:ve?"primary":"secondary",name:"signal",tooltip:(0,$.t)("logs.log-line-details.fields.adhoc-statistics","Ad-hoc statistics"),className:"stats-button",disabled:!ft,onClick:ht})]}),(0,e.jsx)("div",{className:Ue.label,children:ft?fe[0]:(0,e.jsx)(S,{values:fe})}),(0,e.jsx)("div",{className:Ue.value,children:(0,e.jsx)("div",{className:Ue.valueContainer,children:mt?(0,e.jsx)(Q,{value:ue[0],syntaxHighlighting:lt}):(0,e.jsx)(S,{showCopy:!0,values:ue})})})]}),$e?.map((Ze,ut)=>{if(Ze.onClick&&it){const Ot=Ze.onClick;Ze.onClick=(vt,xt)=>{it(ie),Ot(vt,xt),Ke()}}return(0,e.jsx)("div",{className:Ue.row,children:(0,e.jsx)("div",{className:T?Ue.linkNoActions:Ue.link,children:(0,e.jsx)(v.R,{buttonProps:{tooltip:typeof st=="object"&&Ze.onClick?st:void 0,variant:"secondary",fill:"outline",...Ze.icon&&{icon:Ze.icon}},link:Ze})})},`${Ze.title}-${ut}`)}),ve&&Fe&&(0,e.jsx)("div",{className:Ue.row,children:(0,e.jsx)("div",{className:T?void 0:Ue.statsColumn,children:(0,e.jsx)(D.y,{className:Ue.stats,stats:Fe,label:fe[0],value:ue[0],rowCount:Ne,isLabel:se})})})]})},d=T=>({row:(0,o.css)({display:"contents"}),actions:(0,o.css)({whiteSpace:"nowrap"}),label:(0,o.css)({overflowWrap:"break-word",wordBreak:"break-word"}),value:(0,o.css)({overflowWrap:"break-word",wordBreak:"break-word",button:{visibility:"hidden"},"&:hover":{button:{visibility:"visible"}}}),link:(0,o.css)({gridColumn:"2 / 4"}),linkNoActions:(0,o.css)({gridColumn:"span 2",paddingBottom:T.spacing(.5)}),stats:(0,o.css)({paddingRight:T.spacing(1),wordBreak:"break-all",width:"100%",maxWidth:"50vh"}),statsColumn:(0,o.css)({gridColumn:"2 / 4"}),valueContainer:(0,o.css)({display:"flex",lineHeight:T.typography.body.lineHeight,whiteSpace:"pre-wrap",wordBreak:"break-all",maxHeight:"50vh",overflow:"auto"})}),a=({value:T})=>{const A=(0,I.of)(i);return(0,e.jsx)("div",{className:A.button,children:(0,e.jsx)(p.b,{getText:()=>T,"aria-label":(0,$.t)("logs.log-line-details.fields.copy-value-to-clipboard","Copy value to clipboard"),fill:"text",variant:"secondary",icon:"copy",size:"md"})})},i=T=>({button:(0,o.css)({"& > button":{color:T.colors.text.secondary,gap:0,padding:0,justifyContent:"center",borderRadius:T.shape.radius.circle,height:T.spacing(T.components.height.sm),width:T.spacing(T.components.height.sm),svg:{margin:0},"span > div":{top:"-5px","& button":{color:T.colors.success.main}}}})}),S=({showCopy:T,values:A=[]})=>A.every(ge=>ge==="")?null:(0,e.jsx)("table",{children:(0,e.jsx)("tbody",{children:A.map((ge,se)=>(0,e.jsxs)("tr",{children:[(0,e.jsx)("td",{children:ge}),(0,e.jsx)("td",{children:T&&ge!==""&&(0,e.jsx)(a,{value:ge})})]},`${ge}-${se}`))})}),Q=({value:T,syntaxHighlighting:A})=>{const ge=(0,s.useMemo)(()=>{if(!A)return T;try{const se=(0,c.As)((0,c.qg)(T),void 0,2);if(se)return se}catch{}return T},[T,A]);return(0,e.jsxs)(e.Fragment,{children:[ge,(0,e.jsx)(a,{value:ge})]})},J=({isActive:T,tooltipSuffix:A,...ge})=>{const[se,$e]=(0,s.useState)(!1),ie=se?"Remove filter":"Filter for value";return(0,s.useEffect)(()=>{T().then($e)},[T]),(0,e.jsx)(C.K,{...ge,variant:se?"primary":void 0,tooltip:ie+A})};function R(T,A){const ge=T.map(ue=>ue.keys.join(" ")),se=(0,L.X)(ge,A),$e=T.map(ue=>ue.values.join(" ")),ie=(0,L.X)($e,A),fe=se.map(ue=>T[ue]);return ie.forEach(ue=>{fe.includes(T[ue])||fe.push(T[ue])}),fe}function r(T,A){const ge=T.map(ue=>ue.key),se=(0,L.X)(ge,A),$e=T.map(ue=>ue.value),ie=(0,L.X)($e,A),fe=se.map(ue=>T[ue]);return ie.forEach(ue=>{fe.includes(T[ue])||fe.push(T[ue])}),fe}var u=t(6773),g=t(63527);const w=({focusLogLine:T,log:A,search:ge,onSearch:se})=>{const{closeDetails:$e,detailsMode:ie,displayedFields:fe,getRowContextQuery:ue,logOptionsStorageKey:ve,logSupportsContext:De,noInteractions:Ne,setDetailsMode:Xe,onClickHideField:Fe,onClickShowField:ke,onOpenContext:Ye,onPermalinkClick:Ke,onPinLine:Je,onUnpinLine:tt,wrapLogMessage:nt,isAssistantAvailable:et,openAssistantByLog:qe}=(0,G.fl)(),Ve=(0,G.u0)(A),ot=(0,I.of)(k,ie,nt),it=(0,s.useRef)(null),st=(0,s.useRef)(null),lt=(0,s.useRef)(!1),Ue=(0,s.useCallback)((Ze,ut)=>{Ne||(0,P.rR)(Ze,ut)},[Ne]),ct=(0,s.useCallback)(()=>{T?.(A),Ue("logs_log_line_details_header_scroll_to_clicked")},[T,A,Ue]),ye=(0,s.useCallback)(()=>{(0,y.Dk)(A.entry,it),Ue("logs_log_line_details_header_copy_clicked")},[A.entry,Ue]),He=(0,s.useCallback)(()=>{Ke?.(A),Ue("logs_log_line_details_header_permalink_clicked")},[A,Ke,Ue]),Re=(0,s.useCallback)(()=>{Ve?tt?.(A):Je?.(A),Ue("logs_log_line_details_header_pinning_clicked")},[A,Je,tt,Ve,Ue]),Ge=(0,s.useMemo)(()=>De?De(A):!1,[A,De]),at=(0,s.useCallback)(async Ze=>{(0,y.R)(Ze,A,ue,ut=>Ye?.(ut,()=>{})),Ue("logs_log_line_details_header_context_clicked")},[A,ue,Ue,Ye]),dt=Fe&&ke&&fe.length>0,rt=fe.includes(_.I),ht=(0,s.useCallback)(()=>{const Ze=ie==="inline"?"sidebar":"inline";ve&&K.M.set(`${ve}.detailsMode`,Ze),Xe(Ze)},[ie,ve,Xe]),pt=(0,s.useCallback)(()=>{rt?Fe?.(_.I):ke?.(_.I),Ue("logs_log_line_details_header_show_logline_clicked")},[rt,Fe,ke,Ue]),ft=(0,s.useMemo)(()=>(0,e.jsx)(C.K,{name:"times",size:"sm",onClick:()=>{se(""),Ue("logs_log_line_details_header_search_cleared"),st.current&&(st.current.value="")},tooltip:(0,$.t)("logs.log-line-details.clear-search","Clear")}),[se,Ue]),mt=(0,s.useCallback)(Ze=>{se(Ze.target.value),lt.current||(Ue("logs_log_line_details_header_search_used"),lt.current=!0)},[se,Ue]);return(0,e.jsxs)("div",{className:ot.header,ref:it,children:[(0,e.jsx)(g.p,{onChange:mt,placeholder:(0,$.t)("logs.log-line-details.search-placeholder","Search field names and values"),ref:st,suffix:ge!==""?ft:void 0}),(0,e.jsxs)("div",{className:ot.icons,children:[et&&(0,e.jsx)(C.K,{tooltip:(0,$.t)("logs.log-line-details.open-assistant","Explain log line in Assistant"),tooltipPlacement:"top",size:"md",name:"ai-sparkle",onClick:()=>qe?.(A),tabIndex:0}),T&&(0,e.jsx)(C.K,{tooltip:(0,$.t)("logs.log-line-details.scroll-to-logline","Scroll to log line"),tooltipPlacement:"top",size:"md",name:"arrows-v",onClick:ct,tabIndex:0}),dt&&(0,e.jsx)(C.K,{tooltip:rt?(0,$.t)("logs.log-line-details.hide-log-line","Hide log line"):(0,$.t)("logs.log-line-details.show-log-line","Show log line"),tooltipPlacement:"top",size:"md",name:"eye",onClick:pt,tabIndex:0,variant:rt?"primary":void 0}),(0,e.jsx)(C.K,{tooltip:(0,$.t)("logs.log-line-details.copy-to-clipboard","Copy to clipboard"),tooltipPlacement:"top",size:"md",name:"copy",onClick:ye,tabIndex:0}),Ke&&A.rowId!==void 0&&A.uid&&(0,e.jsx)(C.K,{tooltip:(0,$.t)("logs.log-line-details.copy-shortlink","Copy shortlink"),tooltipPlacement:"top",size:"md",name:"share-alt",onClick:He,tabIndex:0}),Ve&&tt&&(0,e.jsx)(C.K,{size:"md",name:"gf-pin",onClick:Re,tooltip:(0,$.t)("logs.log-line-details.unpin-line","Unpin log"),tooltipPlacement:"top",tabIndex:0,variant:"primary"}),!Ve&&Je&&(0,e.jsx)(C.K,{size:"md",name:"gf-pin",onClick:Re,tooltip:(0,$.t)("logs.log-line-details.pin-line","Pin log"),tooltipPlacement:"top",tabIndex:0}),Ge&&(0,e.jsx)(C.K,{size:"md",name:"gf-show-context",onClick:at,tooltip:(0,$.t)("logs.log-line-details.show-context","Show context"),tooltipPlacement:"top",tabIndex:0}),(0,e.jsx)(C.K,{name:ie==="inline"?"web-section":"gf-layout-simple",tooltip:ie==="inline"?(0,$.t)("logs.log-line-details.sidebar-mode","Anchor to the right"):(0,$.t)("logs.log-line-details.inline-mode","Display inline"),onClick:ht}),(0,e.jsx)(C.K,{name:"times",tooltip:(0,$.t)("logs.log-line-details.close","Close log details"),onClick:$e})]})]})},k=(T,A,ge)=>({container:(0,o.css)({overflow:"auto",height:"100%"}),scrollContainer:(0,o.css)({overflow:"auto",height:"100%"}),header:(0,o.css)({alignItems:"center",background:T.colors.background.canvas,display:"flex",flexDirection:!ge&&A==="inline"?"row-reverse":"row",gap:T.spacing(.75),zIndex:T.zIndex.navbarFixed,height:T.spacing(5.5),marginBottom:T.spacing(1),padding:T.spacing(.5,1),position:"sticky",top:0}),icons:(0,o.css)({display:"flex",gap:T.spacing(1),paddingLeft:T.spacing(1)}),copyLogButton:(0,o.css)({padding:0,height:T.spacing(4),width:T.spacing(2.5),overflow:"hidden","&:hover":{backgroundColor:u.MV.alpha(T.colors.text.primary,.12)}}),componentWrapper:(0,o.css)({padding:T.spacing(0,1,1,1)})});var N=t(59243);const pe=(0,s.memo)(({fields:T,log:A,search:ge})=>{const se=(0,I.of)(re),$e=(0,s.useMemo)(()=>ge?R(T,ge):T,[T,ge]);if(T.length){if($e.length===0)return(0,$.t)("logs.log-line-details.search.no-results","No results to display.")}else return null;return(0,e.jsx)("div",{className:se.linksTable,children:$e.map((ie,fe)=>(0,e.jsx)(le,{field:ie,log:A},`${ie.keys[0]}=${ie.values[0]}-${fe}`))})});pe.displayName="LogLineDetailsLinks";const re=T=>({linksTable:(0,o.css)({display:"grid",gap:T.spacing(1),gridTemplateColumns:"minmax(auto, 40%) 1fr",marginBottom:T.spacing(1)})}),le=({field:T,log:A})=>{const{closeDetails:ge,onPinLine:se,pinLineButtonTooltipTitle:$e,syntaxHighlighting:ie}=(0,G.fl)(),fe=(0,I.of)(Te),ue=T.keys.length===1,ve=T.values.length===1,De=(0,s.useMemo)(()=>(0,e.jsx)("div",{className:fe.value,children:(0,e.jsx)("div",{className:fe.valueContainer,children:ve?(0,e.jsx)(Q,{value:T.values[0],syntaxHighlighting:ie}):(0,e.jsx)(S,{showCopy:!0,values:T.values})})}),[T.values,ve,fe.value,fe.valueContainer,ie]);return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsxs)("div",{className:fe.label,children:[ue?T.keys[0]:(0,e.jsx)(S,{values:T.keys}),(0,e.jsx)(N.G,{fitContent:!0,content:De,children:(0,e.jsx)(h.I,{"aria-label":(0,$.t)("logs.log-line-details.link-value-tooltip","Link value"),className:fe.labelIcon,name:"info-circle"})})]}),(0,e.jsx)("div",{className:fe.links,children:T.links?.map((Ne,Xe)=>{if(Ne.onClick&&se){const Fe=Ne.onClick;Ne.onClick=(ke,Ye)=>{se(A),Fe(ke,Ye),ge()}}return(0,e.jsx)("span",{className:fe.link,children:(0,e.jsx)(v.R,{buttonProps:{tooltip:typeof $e=="object"&&Ne.onClick?$e:void 0,variant:"secondary",fill:"outline"},link:Ne})},`${Ne.title}-${Xe}`)})})]})},Te=T=>({label:(0,o.css)({overflowWrap:"break-word",wordBreak:"break-word",paddingRight:T.spacing(1)}),labelIcon:(0,o.css)({marginLeft:T.spacing(1)}),value:(0,o.css)({button:{visibility:"hidden"},"&:hover":{button:{visibility:"visible"}}}),links:(0,o.css)({paddingBottom:T.spacing(.5)}),link:(0,o.css)({marginRight:T.spacing(.5)}),valueContainer:(0,o.css)({display:"flex",lineHeight:T.typography.body.lineHeight,whiteSpace:"pre-wrap",wordBreak:"break-all",maxHeight:"50vh",overflow:"auto"})});var xe=t(284),l=t(50832),B=t(75505),oe=t(78282),F=t(45967),de=t(68079),be=t(40476),Se=t(88535),We=t(90157);const Qe=({timeRange:T,timeZone:A,traceRef:ge})=>{const[se,$e]=(0,s.useState)(null),[ie,fe]=(0,s.useState)(void 0),{app:ue}=(0,G.fl)(),ve=(0,I.of)(Ae);(0,s.useEffect)(()=>{$e(null),(0,oe.l)().get(ge.dsUID).then(Ne=>{Ne?$e(Ne):fe(null)})},[ge.dsUID]),(0,s.useEffect)(()=>{if(!se)return;fe(void 0);const Ne={app:ue,requestId:`log-details-trace-${ge.query}`,targets:[{query:ge.query,queryType:"traceql",refId:`log-details-trace-${ge.query}`,tableType:We.Jv.Traces,filters:[]}],interval:"",intervalMs:0,range:T,scopedVars:{},timezone:A,startTime:Date.now()},Xe=se.query(Ne);(0,l.A)(Xe)&&(0,B.s)(Xe).then(Fe=>{fe(Fe.data?.length?Fe.data:null)}).catch(()=>{fe(null)})},[ue,se,T,A,ge.query]);const De=(0,s.useMemo)(()=>ie?.length?(0,Se.L)(ie[0]):void 0,[ie]);return(0,s.useEffect)(()=>{se&&Array.isArray(ie)&&De?(0,P.rR)("logs_log_line_details_trace_displayed"):ie===null&&(0,P.rR)("logs_log_line_details_trace_display_failed")},[ie,se,De]),(0,e.jsxs)("div",{children:[se&&Array.isArray(ie)&&De&&(0,e.jsx)(be.V,{dataFrames:ie,traceProp:De,datasource:se,timeRange:T}),ie===null&&(0,e.jsxs)("div",{className:ve.message,children:[(0,e.jsx)(F.m,{content:(0,$.t)("logs.log-line-details.trace.error-tooltip","The trace could have been sampled or be temporarily unavailable."),children:(0,e.jsx)(h.I,{name:"info-circle"})}),(0,$.t)("logs.log-line-details.trace.error-message","Could not retrieve trace.")]}),ie===void 0&&(0,e.jsxs)("div",{className:ve.message,children:[(0,e.jsx)(de.y,{}),(0,$.t)("logs.log-line-details.trace.loading-message","Loading trace...")]})]})},Ae=T=>({message:(0,o.css)({display:"flex",gap:T.spacing(1),alignItems:"center"})});function Pe(T){for(const A of T)if(A.links)for(const ge of A.links){const se=Ie(ge);if(se)return se}return null}function Ie(T){const A=Be(T);return!A||A.queryType!=="traceql"?null:A}function Be(T){if(!T.href)return null;const A=T.href.split("?")[1];if(!A)return null;const ge=Object.values(Object.fromEntries(new URLSearchParams(A)));try{const se=JSON.parse(ge[0]),$e="datasource"in se&&se.datasource?se.datasource.toString():"",ie="queries"in se&&Array.isArray(se.queries)&&"query"in se.queries[0]&&se.queries[0].query?se.queries[0].query.toString():"",fe="queryType"in se.queries[0]&&se.queries[0].queryType?se.queries[0].queryType.toString():"";return $e&&ie&&fe?{dsUID:$e,query:ie,queryType:fe}:null}catch{}return null}const z=(0,s.memo)(({focusLogLine:T,log:A,logs:ge,timeRange:se,timeZone:$e})=>{const{displayedFields:ie,noInteractions:fe,logOptionsStorageKey:ue,setDisplayedFields:ve,syntaxHighlighting:De}=(0,G.fl)(),[Ne,Xe]=(0,s.useState)(""),Fe=(0,s.useRef)(""),ke=(0,I.of)(te),Ye=(0,Y.r)(A),Ke=(0,s.useMemo)(()=>{const Re=A.fields.filter(rt=>rt.links?.length),Ge=Re.filter(rt=>rt.fieldIndex!==A.entryFieldIndex).sort(),at=Re.filter(rt=>rt.fieldIndex===A.entryFieldIndex).sort(),dt=(0,ae.qE)(at);return{links:Ge,linksFromVariableMap:dt}},[A.entryFieldIndex,A.fields]),Je=A.dataFrame.meta?.type===ee.m.LogLines?[]:A.fields.filter(Re=>Re.links?.length===0&&Re.fieldIndex!==A.entryFieldIndex).sort(),tt=(0,s.useMemo)(()=>Object.keys(A.labels).sort().map(Re=>({key:Re,value:A.labels[Re],links:Ye?.[Re]})),[Ye,A.labels]),nt=(0,s.useMemo)(()=>Pe(Ke.links),[Ke.links]),et=(0,s.useMemo)(()=>(0,X.groupBy)(tt,Re=>(0,y.dO)(Re.key,A,!0)??""),[tt,A]),qe=(0,s.useMemo)(()=>Object.keys(et),[et]),Ve=ue?K.M.getBool(`${ue}.log-details.logLineOpen`,!1):!1,ot=ue?K.M.getBool(`${ue}.log-details.linksOpen`,!0):!0,it=ue?K.M.getBool(`${ue}.log-details.fieldsOpen`,!0):!0,st=ue?K.M.getBool(`${ue}.log-details.displayedFieldsOpen`,!1):!1,lt=ue?K.M.getBool(`${ue}.log-details.traceOpen`,!1):!1,Ue=(0,s.useCallback)((Re,Ge)=>{K.M.set(`${ue}.log-details.${Re}`,Ge),fe||(0,P.rR)("logs_log_line_details_section_toggled",{section:Re.replace("Open",""),state:Ge?"open":"closed"})},[ue,fe]),ct=(0,s.useCallback)(Re=>{Fe.current=Re,(0,s.startTransition)(()=>{Xe(Fe.current)})},[]),ye=!Ke.links.length&&!Ke.linksFromVariableMap.length&&!qe.length&&!Je.length,He=(0,s.useMemo)(()=>[...Ke.links,...Ke.linksFromVariableMap],[Ke.links,Ke.linksFromVariableMap]);return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(w,{focusLogLine:T,log:A,search:Ne,onSearch:ct}),(0,e.jsxs)("div",{className:ke.componentWrapper,children:[(0,e.jsx)(U.a,{className:ke.collapsable,label:(0,$.t)("logs.log-line-details.log-line-section","Log line"),collapsible:!0,isOpen:Ve,onToggle:Re=>Ue("logLineOpen",Re),children:(0,e.jsx)(xe.n,{log:A,syntaxHighlighting:De??!0})}),ie.length>0&&ve&&(0,e.jsx)(U.a,{label:(0,$.t)("logs.log-line-details.displayed-fields-section","Organize displayed fields"),collapsible:!0,isOpen:st,onToggle:Re=>Ue("displayedFieldsOpen",Re),children:(0,e.jsx)(H,{})}),He.length>0&&(0,e.jsx)(U.a,{className:ke.collapsable,label:(0,$.t)("logs.log-line-details.links-section","Links"),collapsible:!0,isOpen:ot,onToggle:Re=>Ue("linksOpen",Re),children:(0,e.jsx)(pe,{log:A,logs:ge,fields:He,search:Ne})}),nt&&(0,e.jsx)(U.a,{label:(0,$.t)("logs.log-line-details.trace-section","Trace"),collapsible:!0,isOpen:lt,onToggle:Re=>Ue("traceOpen",Re),children:(0,e.jsx)(Qe,{timeRange:se,timeZone:$e,traceRef:nt})}),qe.map(Re=>Re===""?(0,e.jsxs)(U.a,{className:ke.collapsable,label:(0,$.t)("logs.log-line-details.fields-section","Fields"),collapsible:!0,isOpen:it,onToggle:Ge=>Ue("fieldsOpen",Ge),children:[(0,e.jsx)(Z,{log:A,logs:ge,fields:et[Re],search:Ne}),(0,e.jsx)(j,{log:A,logs:ge,fields:Je,search:Ne})]},"fields"):(0,e.jsx)(U.a,{className:ke.collapsable,label:Re,collapsible:!0,isOpen:K.M.getBool(`${ue}.log-details.${Ee(Re)}`,!0),onToggle:Ge=>Ue(Ee(Re),Ge),children:(0,e.jsx)(Z,{log:A,logs:ge,fields:et[Re],search:Ne})},Re)),!qe.length&&Je.length>0&&(0,e.jsx)(U.a,{className:ke.collapsable,label:(0,$.t)("logs.log-line-details.fields-section","Fields"),collapsible:!0,isOpen:it,onToggle:Re=>Ue("fieldsOpen",Re),children:(0,e.jsx)(j,{log:A,logs:ge,fields:Je,search:Ne})},"fields"),ye&&(0,e.jsx)($.x6,{i18nKey:"logs.log-line-details.no-details",children:"No fields to display."})]})]})});z.displayName="LogLineDetailsComponent";function Ee(T){return`${(0,X.camelCase)(T)}Open`}const te=T=>({collapsable:(0,o.css)({"&:last-of-type":{marginBottom:0}}),componentWrapper:(0,o.css)({padding:T.spacing(0,1,1,1)})});var Ce=t(55439);const me=(0,s.memo)(({containerElement:T,focusLogLine:A,logs:ge,timeRange:se,timeZone:$e,onResize:ie,showControls:fe})=>{const{detailsWidth:ue,noInteractions:ve,setDetailsWidth:De}=(0,G.fl)(),Ne=(0,I.of)(Me,"sidebar",fe),Xe=(0,I.of)(x.l),Fe=(0,s.useRef)(null),ke=(0,s.useCallback)(()=>{Fe.current&&De(Fe.current.clientWidth),ie()},[ie,De]),Ye=(0,s.useCallback)(()=>{Fe.current&&!ve&&(0,P.rR)("logs_log_line_details_sidebar_resized",{width:Math.round(Fe.current.clientWidth)})},[ve]),Ke=T.clientWidth-Ce.Of;return(0,e.jsx)(m.c,{onResize:ke,onResizeStop:Ye,handleClasses:{left:Xe.dragHandleVertical},defaultSize:{width:ue,height:T.clientHeight},size:{width:ue,height:T.clientHeight},enable:{left:!0},minWidth:40,maxWidth:Ke,children:(0,e.jsx)("div",{className:Ne.container,ref:Fe,children:(0,e.jsx)(Le,{focusLogLine:A,logs:ge,timeRange:se,timeZone:$e})})})});me.displayName="LogLineDetails";const Le=(0,s.memo)(({focusLogLine:T,logs:A,timeRange:ge,timeZone:se})=>{const{app:$e,closeDetails:ie,noInteractions:fe,showDetails:ue,toggleDetails:ve}=(0,G.fl)(),[De,Ne]=(0,s.useState)(ue[0]),Xe=(0,M.A)(ue),Fe=(0,I.of)(Me,"sidebar");return(0,s.useEffect)(()=>{T(De),fe||(0,P.rR)("logs_log_line_details_displayed",{mode:"sidebar",app:$e})},[]),(0,s.useEffect)(()=>{if(!ue.length){ie();return}if(!Xe||ue.length>Xe.length){Ne(ue[ue.length-1]);return}else ue.find(ke=>ke.uid===De.uid)||Ne(ue[ue.length-1])},[ie,De.uid,Xe,ue]),(0,e.jsxs)(e.Fragment,{children:[ue.length>1&&(0,e.jsx)(ce.U,{children:ue.map(ke=>(0,e.jsx)(O.o,{truncate:!0,label:ke.entry.substring(0,25),active:De.uid===ke.uid,onChangeTab:()=>Ne(ke),suffix:()=>(0,e.jsx)(h.I,{name:"times","aria-label":(0,$.t)("logs.log-line-details.remove-log","Remove log"),onClick:()=>ve(ke)})},ke.uid))}),(0,e.jsx)("div",{className:Fe.scrollContainer,children:(0,e.jsx)(z,{focusLogLine:T,log:De,logs:A,timeRange:ge,timeZone:se})})]})});Le.displayName="LogLineDetailsTabs";const _e=(0,s.memo)(({logs:T,log:A,onResize:ge,timeRange:se,timeZone:$e})=>{const{app:ie,detailsWidth:fe,noInteractions:ue}=(0,G.fl)(),ve=(0,I.of)(Me,"inline"),De=(0,s.useRef)(null);(0,s.useEffect)(()=>{ue||(0,P.rR)("logs_log_line_details_displayed",{mode:"inline",app:ie})},[ie,ue]),(0,s.useEffect)(()=>{function Xe(){ge()}return window.addEventListener("resize",Xe),()=>window.removeEventListener("resize",Xe)},[ge]);const Ne=(0,s.useCallback)(()=>{(0,G.AN)(A,De.current?.scrollTop??0)},[A]);return(0,s.useEffect)(()=>{De.current&&(De.current.scrollTop=(0,G.zB)(A))},[A]),(0,e.jsx)("div",{className:`${ve.inlineWrapper} log-line-inline-details`,style:{maxWidth:fe},children:(0,e.jsx)("div",{className:ve.inlineContainer,children:(0,e.jsx)("div",{className:ve.scrollContainer,ref:De,onScroll:Ne,children:(0,e.jsx)(z,{log:A,logs:T,timeRange:se,timeZone:$e})})})})});_e.displayName="InlineLogLineDetails";const je=45,Me=(T,A,ge)=>({inlineWrapper:(0,o.css)({gridColumn:"1 / -1",height:`${je}vh`,padding:T.spacing(1,2,1.5,2),marginRight:1}),inlineContainer:(0,o.css)({backgroundColor:T.colors.background.secondary,border:`1px solid ${T.colors.border.weak}`,borderRadius:T.shape.radius.default,height:"100%",overflow:"auto"}),container:(0,o.css)({backgroundColor:T.colors.background.elevated,border:`1px solid ${T.colors.border.weak}`,borderBottomRightRadius:ge?void 0:T.shape.radius.default,borderRight:A==="sidebar"&&ge?"none":void 0,borderTopRightRadius:ge?void 0:T.shape.radius.default,boxShadow:T.shadows.z3,height:"100%",overflow:"auto"}),scrollContainer:(0,o.css)({overflow:"auto",height:"100%"}),componentWrapper:(0,o.css)({padding:T.spacing(0,1,1,1)})})},55060:(ze,we,t)=>{t.d(we,{T:()=>m});var e=t(96540),o=(s=>(s.Code="code",s.Builder="builder",s))(o||{});const m="Binary operations"},55439:(ze,we,t)=>{t.d(we,{Dj:()=>$,Of:()=>s,SC:()=>ce,W5:()=>P,XJ:()=>ee,_B:()=>K,gn:()=>x,km:()=>I,yb:()=>M});var e=t(88838),o=t(68388),m=t(53622);const s=280,M=1.5,$=22,P=32;class I{constructor(y,Y){this.ctx=null,this.measurementMode="canvas",this.spanElement=document.createElement("span"),this.getLineHeight=()=>this.lineHeight,this.getGridSize=()=>this.gridSize,this.getPaddingBottom=()=>this.paddingBottom,this.getTruncationLineCount=()=>Math.round(window.innerHeight/this.getLineHeight()/1.5),this.getTruncationLength=C=>(C?X(C):window.innerWidth)/this.measureTextWidth("e")*this.getTruncationLineCount(),this.determineMeasurementMode=()=>{if(!this.ctx){this.measurementMode="dom";return}const C=this.ctx.measureText("e").width;this.measureTextWidthWithDOM("e")-C>=.1&&(console.warn("Virtualized log list: falling back to DOM for measurement"),this.measurementMode="dom")},this.initCanvasMeasurement=(C,_)=>{const G=document.createElement("canvas");this.ctx=G.getContext("2d"),this.ctx&&(this.ctx.font=C,this.ctx.fontKerning="normal",this.ctx.fontStretch="normal",this.ctx.fontVariantCaps="normal",this.ctx.textRendering="optimizeLegibility",_&&(this.ctx.letterSpacing=_))},this.initDOMmeasurement=(C,_)=>{this.spanElement.style.font=C,this.spanElement.style.visibility="hidden",this.spanElement.style.position="absolute",this.spanElement.style.wordBreak="break-all",_&&(this.spanElement.style.letterSpacing=_)},this.measureTextWidth=C=>{if(!this.ctx)throw new Error("Measuring context canvas is not initialized. Call init() before.");const _=C.length,G=this.textWidthMap.get(_);if(G)return G;const he=this.measurementMode==="canvas"?this.ctx.measureText(C).width:this.measureTextWidthWithDOM(C);return this.textWidthMap.set(_,he),he},this.measureTextWidthWithDOM=C=>{this.spanElement.textContent=C,document.body.appendChild(this.spanElement);const _=this.spanElement.getBoundingClientRect().width;return document.body.removeChild(this.spanElement),_},this.measureTextHeight=(C,_,G=0)=>{let he=0;const H=this.measureTextWidth("e");let q=Math.round(_/H);const V=Math.floor((_-G)/H)-2*H,W=C.split(`
`);if(W.length===1&&C.length<V)return{lines:1,height:this.getLineHeight()+this.paddingBottom};const c=_-G;for(const L of W)for(let v=0;v<L.length;){let p,n=0,D=0;do{p=L.substring(v,v+q-D);let j=p;he>0&&j.trimStart(),n=this.measureTextWidth(j),D+=1}while(n>=c);G&&(G=0),he+=1,v+=p.length}const b=he*this.getLineHeight()+this.paddingBottom;return{lines:he,height:b}},this.calculateFieldDimensions=(C,_=[],G)=>{if(!C.length)return[];let he=0,H=0;const q={};for(let W=0;W<C.length;W++){let c=this.measureTextWidth(G==="ms"?C[W].timestamp:C[W].timestampNs);c>he&&(he=Math.round(c)),c=this.measureTextWidth(C[W].displayLevel),c>H&&(H=Math.round(c));for(const b of _)c=this.measureTextWidth(C[W].getDisplayedFieldValue(b,!0)),q[b]=!q[b]||c>q[b]?Math.round(c):q[b]}const V=[{field:"timestamp",width:he},{field:"level",width:H}];for(const W in q)V.push({field:W,width:q[W]});return V},this.resetLogLineSizes=()=>{this.logLineSizesMap=new Map},this.storeLogLineSize=(C,_,G)=>{const he=`${C}_${X(_)}_${this.fontSize}`;this.logLineSizesMap.set(he,G)},this.retrieveLogLineSize=(C,_)=>{const G=`${C}_${X(_)}_${this.fontSize}`;return this.logLineSizesMap.get(G)},this.fontSize=Y;let ae;Y==="default"?(ae=y.typography.fontSize,this.lineHeight=y.typography.fontSize*y.typography.body.lineHeight):(ae=typeof y.typography.bodySmall.fontSize=="string"&&y.typography.bodySmall.fontSize.includes("rem")?y.typography.fontSize*parseFloat(y.typography.bodySmall.fontSize):parseInt(y.typography.bodySmall.fontSize,10),this.lineHeight=ae*y.typography.bodySmall.lineHeight),this.gridSize=y.spacing.gridSize,this.paddingBottom=this.gridSize*.75,this.logLineSizesMap=new Map,this.textWidthMap=new Map;const Oe=`${ae}px ${y.typography.fontFamilyMonospace}`,ne=y.typography.body.letterSpacing;this.initDOMmeasurement(Oe,ne),this.initCanvasMeasurement(Oe,ne),this.determineMeasurementMode()}}function x(U,y,Y,ae,{detailsMode:Oe,hasLogsWithErrors:ne,hasSampledLogs:C,showDuplicates:_,showDetails:G,showTime:he,wrap:H},q){if(!Y)return 0;const V=U.getGridSize()*M,W=Oe==="inline"&&y[q]&&G.findIndex(n=>n.uid===y[q].uid)>=0?window.innerHeight*(m.l_/100)+V/2:0;if(!H||!y[q])return U.getLineHeight()+U.getPaddingBottom()+W;if(y[q].updateCollapsedState(ae,Y),y[q].collapsed)return(U.getTruncationLineCount()+1)*U.getLineHeight()+W;const c=U.retrieveLogLineSize(y[q].uid,Y);if(c)return c;let b="";const L=U.getGridSize()*.5;let v=0;_&&(v+=U.getGridSize()*4.5+L),ne&&(v+=U.getGridSize()*2+L),C&&(v+=U.getGridSize()*2+L),he&&(v+=V,b+=y[q].timestamp),(y[q].displayLevel||!H)&&(v+=V,b+=y[q].displayLevel??"");for(const n of ae)b=y[q].getDisplayedFieldValue(n,!0)+b;ae.length||(b+=e.Ay.strip(y[q].body));const{height:p}=U.measureTextHeight(b,X(Y),v);return y[q].collapsed===!1?p+U.getLineHeight()+W:p+W}function ce(U,y,Y,ae){ae!==void 0&&Y&&(Y-=U.getLineHeight());const Oe=y.parentElement?Array.from(y.parentElement.children).filter(he=>he.classList.contains("log-line-inline-details")):void 0,ne=Oe?.length?Oe[0].clientHeight:0;let C=y.scrollHeight+ne;const _=Y??y.clientHeight;if(C>_)return ae!==void 0?C+U.getLineHeight():C;const G=y.children[1];return C=G.clientHeight+ne,G instanceof HTMLDivElement&&C<_?ae!==void 0?C+U.getLineHeight():C:null}const O=24,h=ee();function X(U){return U.clientWidth-h-O}function ee(){const U=document.createElement("div");U.style.width="100px",U.style.height="100px",U.style.overflow="scroll",U.style.position="absolute",U.style.top="-9999px",document.body.appendChild(U);const y=U.offsetWidth-U.clientWidth;return document.body.removeChild(U),y}class K extends o.x{static{this.type="logs-panel-scroll-to"}}},58640:(ze,we,t)=>{t.d(we,{A:()=>o});var e=t(27489);const o=(m,s)=>{const M=`logs.interactions.${m}`;sessionStorage.getItem(M)||(sessionStorage.setItem(M,"1"),(0,e.rR)(m,s))}},59896:(ze,we,t)=>{t.d(we,{A:()=>h,h:()=>O});var e=t(74848),o=t(22803),m=t(96540),s=t(92745),M=t(30703),$=t(45967),P=t(45861),I=t(63142),x=t(76487);const ce=["detected_level","level","lvl","filename"],O=(0,m.memo)(({labels:K,emptyMessage:U,addTooltip:y=!0,displayMax:Y,onDisplayMaxToggle:ae,displayAll:Oe=!1})=>{const[ne,C]=(0,m.useState)(Y?Oe:void 0),_=(0,I.of)(ee),G=(0,m.useMemo)(()=>Object.keys(K).filter(H=>!H.startsWith("_")&&!ce.includes(H)&&K[H]).map(H=>`${H}=${K[H]}`),[K]),he=(0,m.useMemo)(()=>G.slice(0,!ne&&Y?Y:1/0),[G,ne,Y]);return he.length===0&&U?(0,e.jsx)("span",{className:_.logsLabels,children:(0,e.jsx)("span",{className:_.logsLabel,children:U})}):(0,e.jsxs)("span",{className:_.logsLabels,children:[he.map(H=>y?(0,e.jsx)($.m,{content:H,placement:"top",children:(0,e.jsx)(X,{styles:_,children:H})},H):(0,e.jsx)(X,{styles:_,tooltip:H,children:H},H)),he.length<G.length&&!ne&&(0,e.jsxs)(P.$n,{size:"sm",fill:"outline",variant:"secondary","aria-label":(0,s.t)("logs.log-labels.expand","Expand labels"),onClick:()=>{C(!0),ae?.(!0)},children:[(0,e.jsx)(M.I,{name:"plus",size:"xs"}),G.length-he.length]}),ne===!0&&(0,e.jsx)(P.$n,{size:"sm",fill:"outline",variant:"secondary","aria-label":(0,s.t)("logs.log-labels.collapse","Collapse labels"),onClick:()=>{C(!1),ae?.(!1)},children:(0,e.jsx)(M.I,{name:"minus",size:"xs"})})]})});O.displayName="LogLabels";const h=(0,m.memo)(({labels:K})=>{const U=(0,I.of)(ee);return(0,e.jsx)("span",{className:U.logsLabels,children:K.map(y=>(0,e.jsx)(X,{styles:U,tooltip:y,children:y===x.I?(0,s.t)("logs.log-labels-list.log-line","log line"):y},y))})});h.displayName="LogLabelsList";const X=(0,m.forwardRef)(({styles:K,tooltip:U,children:y},Y)=>(0,e.jsx)("span",{className:K.logsLabel,ref:Y,children:(0,e.jsx)("span",{className:K.logsLabelValue,title:U,children:y})}));X.displayName="LogLabel";const ee=K=>({logsLabels:(0,o.css)({display:"flex",flexWrap:"wrap",fontSize:K.typography.size.xs,alignItems:"center"}),logsLabel:(0,o.css)({label:"logs-label",display:"flex",padding:K.spacing(0,.25),backgroundColor:K.colors.background.secondary,borderRadius:K.shape.radius.default,margin:K.spacing(.125,.5,0,0),textOverflow:"ellipsis",whiteSpace:"nowrap",overflow:"hidden",maxHeight:K.spacing(2)}),logsLabelValue:(0,o.css)({label:"logs-label__value",display:"inline-block",maxWidth:K.spacing(25),textOverflow:"ellipsis",overflow:"hidden"})})},67897:(ze,we,t)=>{t.d(we,{fV:()=>M,zz:()=>$});var e=t(74848),o=t(96540);const m=(0,o.createContext)({hideSearch:()=>{},filterLogs:!1,matchingUids:null,searchVisible:!1,setMatchingUids:()=>{},setSearch:()=>{},showSearch:()=>{},toggleFilterLogs:()=>{}}),s=P=>useContext(m)[P],M=()=>(0,o.useContext)(m),$=({children:P})=>{const[I,x]=(0,o.useState)(void 0),[ce,O]=(0,o.useState)(!1),[h,X]=(0,o.useState)(null),[ee,K]=(0,o.useState)(!1),U=(0,o.useCallback)(()=>{O(!1)},[]),y=(0,o.useCallback)(()=>{O(!0)},[]),Y=(0,o.useCallback)(()=>{K(ae=>!ae)},[]);return(0,e.jsx)(m.Provider,{value:{hideSearch:U,filterLogs:ee,matchingUids:h,search:I,searchVisible:ce,setMatchingUids:X,setSearch:x,showSearch:y,toggleFilterLogs:Y},children:P})}},69457:(ze,we,t)=>{t.d(we,{Ac:()=>ce,nE:()=>x,db:()=>ee,fV:()=>h,sz:()=>K,YB:()=>O,aN:()=>X,BY:()=>U});var e=t(95004),o=t(74529),m=t(22420);function s(y){let Y;try{Y=JSON.parse(y)}catch{}return typeof Y=="object"}const M=/(?:^|\s)([\w\(\)\[\]\{\}]+)=(""|(?:".*?[^\\]"|[^"\s]\S*))/;function $(y){return M.test(y)}function P(y){let Y;try{return Y=JSON.parse(y),Y.hasOwnProperty("_entry")}catch{return!1}}var I=t(12282);function x(y){return(y.fields.find(ae=>ae.name==="labels")?.values??[]).some(ae=>ae.__error__!==void 0)}function ce(y){return(y.fields.find(ae=>ae.name==="labels")?.values??[]).some(ae=>ae.level!==void 0)}function O(y){const Y=y.fields.find(_=>_.type===e.PU.string);if(Y==null)return{hasJSON:!1,hasLogfmt:!1,hasPack:!1};const ae=Y.values;let Oe=!1,ne=!1,C=!1;return ae.forEach(_=>{s(_)&&(Oe=!0,C=P(_)),$(_)&&(ne=!0)}),{hasLogfmt:ne,hasJSON:Oe,hasPack:C}}function h(y,Y=I.HD.Indexed){const ae=y?.fields?.find(C=>C.name==="labels")?.values??[],Oe=y?.fields?.find(C=>C.name==="labelTypes")?.values??[];if(!ae?.length)return[];if(!Oe?.length){if(Y===I.HD.Indexed){const{keys:C}=(0,m.P7)(ae);return C}return[]}let ne=new Set;for(let C=0;C<ae.length;C++){const _=ae[C],G=Oe[C],he=Object.keys(_).filter(H=>G[H]===Y);ne=new Set([...ne,...he])}return Array.from(ne)}function X(y){const Y=y?.fields?.find(Oe=>Oe.name==="labels")?.values??[];return Y?.length?Object.keys(Y[0]).filter(Oe=>{const ne=Y[0][Oe];return ne?!isNaN(Number(ne))||(0,o.pp)(ne)||(0,m.tY)(ne):!1}).filter(Oe=>Y.every(ne=>ne[Oe])):[]}function ee(y){const Y=y.fields.find(Oe=>Oe.name==="labels"&&Oe.type===e.PU.other);return Y==null?!1:Y.values.some(Oe=>Oe.__error__)}function K(y){const Y=y.fields.find(ne=>ne.name==="labels"&&ne.type===e.PU.other);if(Y==null)return null;const ae=Y.values.slice(0,2);let Oe=null;for(let ne of ae){const C=Object.keys(ne).find(_=>_==="level"||_==="detected_level"||_==="lvl"||_.includes("level"));if(C){Oe=C;break}}return Oe}function U(y){const Y=y.errors?(y.errors[0].message??"").toLowerCase():y.error?.message??"";if(Y.includes("timeout"))return!0;if(y.data.length>0&&y.data[0].fields.length>0)return!1;throw new Error(Y)}},70159:(ze,we,t)=>{t.d(we,{$Z:()=>e,OY:()=>o,r3:()=>m});const e={showLabels:"grafana.explore.logs.showLabels",showTime:"grafana.explore.logs.showTime",wrapLogMessage:"grafana.explore.logs.wrapLogMessage",prettifyLogMessage:"grafana.explore.logs.prettifyLogMessage",logsSortOrder:"grafana.explore.logs.sortOrder",logContextWrapLogMessage:"grafana.explore.logs.logContext.wrapLogMessage",commonLabels:"grafana.explore.logs.commonLabels"},o="grafana.explore.logs",m="grafana.explore.logs.visualisationType"},76160:(ze,we,t)=>{t.d(we,{Ch:()=>y,Gk:()=>H,cQ:()=>Z,o9:()=>W,tE:()=>_,OS:()=>f,yI:()=>V,aH:()=>he,lq:()=>i,lN:()=>v,cH:()=>L,yB:()=>b,je:()=>Y,Lv:()=>c,FN:()=>ae,i6:()=>D});var e=t(2543),o=t(36195),m=t(22420),s=t(24162),M=t(42954),$=t(55060),P=Object.defineProperty,I=(r,u,g)=>u in r?P(r,u,{enumerable:!0,configurable:!0,writable:!0,value:g}):r[u]=g,x=(r,u,g)=>I(r,typeof u!="symbol"?u+"":u,g);class ce{constructor(u,g){x(this,"operationsRegistry"),x(this,"categories",[]),x(this,"innerQueryPlaceholder"),this.operationsRegistry=new M.O(()=>u),this.innerQueryPlaceholder=g||"<query>"}setOperationCategories(u){this.categories=u}getOperationsForCategory(u){return this.operationsRegistry.list().filter(g=>g.category===u&&!g.hideFromList)}getAlternativeOperations(u){return this.operationsRegistry.list().filter(g=>g.alternativesKey&&g.alternativesKey===u)}getCategories(){return this.categories}getOperationDefinition(u){return this.operationsRegistry.getIfExists(u)}hasBinaryOp(u){return u.operations.find(g=>{const w=this.getOperationDefinition(g.id);return w?.category===$.T})!==void 0}}var O=t(38903),h=t(95826);class X extends ce{constructor(){super(O.sp,"<expr>"),this.setOperationCategories([h.Ln.Aggregations,h.Ln.RangeFunctions,h.Ln.Formats,h.Ln.BinaryOps,h.Ln.LabelFilters,h.Ln.LineFilters])}renderOperations(u,g){for(const w of g){if(w.disabled)continue;const k=this.operationsRegistry.getIfExists(w.id);if(!k){console.error(`Could not find operation ${w.id} in the registry`);continue}u=k.renderer(w,k,u)}return u}renderBinaryQueries(u,g){if(g)for(const w of g)u=`${this.renderBinaryQuery(u,w)}`;return u}renderBinaryQuery(u,g){let w=u+` ${g.operator} `;return g.vectorMatches&&(w+=`${g.vectorMatchesType}(${g.vectorMatches}) `),w+this.renderQuery(g.query,!0)}renderLabels(u){if(u.length===0)return"{}";let g="{";for(const w of u)g!=="{"&&(g+=", "),g+=`${w.label}${w.op}"${w.value}"`;return g+"}"}renderQuery(u,g){let w=this.renderLabels(u.labels);return w=this.renderOperations(w,u.operations),!g&&this.hasBinaryOp(u)&&u.binaryQueries?.length&&(w=`(${w})`),w=this.renderBinaryQueries(w,u.binaryQueries),w}getQueryPatterns(){return[{name:"Parse log lines with logfmt parser",type:h.IQ.Log,operations:[{id:h.EF.Logfmt,params:[]},{id:h.EF.LabelFilterNoErrors,params:[]}]},{name:"Parse log lines with JSON parser",type:h.IQ.Log,operations:[{id:h.EF.Json,params:[]},{id:h.EF.LabelFilterNoErrors,params:[]}]},{name:"Filter log line and parse with logfmt parser",type:h.IQ.Log,operations:[{id:h.EF.LineContains,params:[""]},{id:h.EF.Logfmt,params:[]},{id:h.EF.LabelFilterNoErrors,params:[]}]},{name:"Filter log lines and parse with json parser",type:h.IQ.Log,operations:[{id:h.EF.LineContains,params:[""]},{id:h.EF.Json,params:[]},{id:h.EF.LabelFilterNoErrors,params:[]}]},{name:"Parse log line with logfmt parser and use label filter",type:h.IQ.Log,operations:[{id:h.EF.LineContains,params:[""]},{id:h.EF.Logfmt,params:[]},{id:h.EF.LabelFilterNoErrors,params:[]},{id:h.EF.LabelFilter,params:["label","=","value"]}]},{name:"Parse log lines with nested json",type:h.IQ.Log,operations:[{id:h.EF.LineContains,params:[""]},{id:h.EF.Json,params:[]},{id:h.EF.LabelFilterNoErrors,params:[]},{id:h.EF.LineFormat,params:["{{.message}}"]},{id:h.EF.Json,params:[]},{id:h.EF.LabelFilterNoErrors,params:[]}]},{name:"Reformat log lines",type:h.IQ.Log,operations:[{id:h.EF.LineContains,params:[""]},{id:h.EF.Logfmt,params:[]},{id:h.EF.LabelFilterNoErrors,params:[]},{id:h.EF.LineFormat,params:["{{.message}}"]}]},{name:"Rename lvl label to level",type:h.IQ.Log,operations:[{id:h.EF.LineContains,params:[""]},{id:h.EF.Logfmt,params:[]},{id:h.EF.LabelFilterNoErrors,params:[]},{id:h.EF.LabelFormat,params:["lvl","level"]}]},{name:"Query on value inside a log line",type:h.IQ.Metric,operations:[{id:h.EF.LineContains,params:[""]},{id:h.EF.Logfmt,params:[]},{id:h.EF.LabelFilterNoErrors,params:[]},{id:h.EF.Unwrap,params:[""]},{id:h.EF.LabelFilterNoErrors,params:[]},{id:h.EF.SumOverTime,params:["$__auto"]},{id:h.EF.Sum,params:[]}]},{name:"Total requests per label of streams",type:h.IQ.Metric,operations:[{id:h.EF.LineContains,params:[""]},{id:h.EF.CountOverTime,params:["$__auto"]},{id:h.EF.Sum,params:[]}]},{name:"Total requests per parsed label or label of streams",type:h.IQ.Metric,operations:[{id:h.EF.LineContains,params:[""]},{id:h.EF.Logfmt,params:[]},{id:h.EF.LabelFilterNoErrors,params:[]},{id:h.EF.CountOverTime,params:["$__auto"]},{id:h.EF.Sum,params:[]}]},{name:"Bytes used by a log stream",type:h.IQ.Metric,operations:[{id:h.EF.LineContains,params:[""]},{id:h.EF.BytesOverTime,params:["$__auto"]}]},{name:"Count of log lines per stream",type:h.IQ.Metric,operations:[{id:h.EF.LineContains,params:[""]},{id:h.EF.CountOverTime,params:["$__auto"]}]},{name:"Top N results by label or parsed label",type:h.IQ.Metric,operations:[{id:h.EF.Logfmt,params:[]},{id:h.EF.LabelFilterNoErrors,params:[]},{id:h.EF.CountOverTime,params:["$__auto"]},{id:h.EF.Sum,params:[]},{id:h.EF.TopK,params:[10]}]},{name:"Extracted quantile",type:h.IQ.Metric,operations:[{id:h.EF.Logfmt,params:[]},{id:h.EF.LabelFilterNoErrors,params:[]},{id:h.EF.Unwrap,params:["latency"]},{id:h.EF.LabelFilterNoErrors,params:[]},{id:h.EF.QuantileOverTime,params:["$__auto",.5]},{id:h.EF.Sum,params:[]}]}]}}const ee=new X;var K=t(32783),U=t(12282);class y{constructor(u,g,w){this.from=u,this.to=g,this.type=w}static fromNode(u){return new y(u.from,u.to,u.type)}contains(u){return this.from<=u.from&&this.to>=u.to}getExpression(u){return u.substring(this.from,this.to)}}function Y(r,u,g,w){return C(r,u,g,w).length>0}function ae(r,u,g,w){const k=C(r,u,g,w);for(const N of k)r=N.parent?.type.id===o.bY?Oe(r,N):ne(r,N);return r}function Oe(r,u){const g=u.parent?.parent;return!g||g.type.id!==o.t3?r:(r.substring(0,g.from)+r.substring(g.to)).trim()}function ne(r,u){let g=u;do g=g.parent;while(g&&g.type.id!==o.MD);const w=u.getChild(o.gw);if(!g||!w)return r;const k=r.substring(w.from,w.to),N=r.substring(0,g.from),pe=r.substring(g.to),re=(0,K.u_)(r.substring(g.from,g.to));return re.query.labels=re.query.labels.filter(le=>le.label!==k),N+ee.renderQuery(re.query)+pe}function C(r,u,g,w){const k=o.K3.parse(r),N=[];return k.iterate({enter:({type:pe,node:re})=>{pe.id===o.g$&&N.push(re)}}),N.filter(pe=>{const re=pe.getChild(o.gw),le=re?.nextSibling,Te=pe.getChild(o.Qf);if(!re||!le||!Te||r.substring(re.from,re.to)!==u)return!1;const l=r.substring(Te.from,Te.to);return!((0,K.w4)(l)!==(0,m.qv)(w)||r.substring(le.from,le.to)!==g)})}function _(r,u,g,w,k){if(!u)throw new Error("Need label to add to query.");const N=b(r);if(!N.length)return r;const pe=L(r),re=v(r),le=J(r),Te=(0,s.TQ)(r,[o.J_]);k||R(r).map(F=>F.getExpression(r)).includes(u)&&(k=U.HD.Indexed);const xe=N.every(B=>le.some(oe=>oe.from>=B.from&&oe.to<=B.to)),l=D(u,w,g);if(k===U.HD.Parsed||k===U.HD.StructuredMetadata){const B=G(r,[...N,...re,...pe,...Te]);return Z(r,B,l)}else{if(k===U.HD.Indexed)return j(r,N,l);if(pe.length===0||xe===!1)return j(r,N,l);{const B=G(r,[...pe,...re,...Te]);return Z(r,B,l)}}}function G(r,u){const g=S((0,s.TQ)(r,[o.GN])),w=[...u];return g.map(N=>i(w.filter(pe=>N.contains(pe))))}function he(r,u){const g=p(r);if(g.length)return q(r,g,u);{const w=b(r);return w.length?q(r,w,u):r}}function H(r,u){const g=p(r);if(g.length)return q(r,g,`drop ${u.join(", ")}`);{const w=b(r);return w.length?q(r,w,`drop ${u.join(", ")}`):r}}function q(r,u,g){let w="",k=0;for(let N=0;N<u.length;N++){const pe=u[N],re=N===u.length-1,le=r.substring(k,pe.to),Te=re?r.substring(pe.to):"";w+=le+` | ${g}`+Te,k=pe.to}return w}function V(r){const u=L(r);if(!u.length)return r;const g=D("__error__","","=");return Z(r,u,g)}function W(r,u){const g=n(r);return E(r,g,u)}function c(r){const u=d(r);if(!u.length)return r;let g="",w=0;for(let k of u)g=g+r.substring(w,k.from),w=k.to;return g=g+r.substring(w),g}function b(r){const u=o.K3.parse(r),g=[];return u.iterate({enter:({type:w,node:k})=>{if(w.id===o.MD)return g.push(y.fromNode(k)),!1}}),g}function L(r){const u=o.K3.parse(r),g=[],w=[o.iT,o.eF,o.Zj,o.Tz];return u.iterate({enter:({type:k,node:N})=>{if(w.includes(k.id))return g.push(y.fromNode(N)),!1}}),g}function v(r){const u=o.K3.parse(r),g=[];return u.iterate({enter:({type:w,node:k})=>{if(w.id===o.bY)return g.push(y.fromNode(k)),!1}}),g}function p(r){const u=o.K3.parse(r),g=[];return u.iterate({enter:({type:w,node:k})=>{if(w.id===o.CX)return g.push(y.fromNode(k)),!1}}),g}function n(r){const u=o.K3.parse(r),g=[];return u.iterate({enter:({type:w,node:k})=>{if(w.id===o.UK)return g.push(y.fromNode(k)),!1;if(w.id===o.xo){const N=[],pe=k.getChild(o.MD);pe&&N.push(y.fromNode(pe));const re=k.getChild(o.AL);re&&N.push(y.fromNode(re));const le=k.getChild(o.HV);le&&N.push(y.fromNode(le));const Te=(0,e.sortBy)(N,xe=>xe.to);return g.push(new y(Te[0].from,Te[Te.length-1].to)),!1}}}),g}function D(r,u,g){return{label:r,op:g,value:u}}function j(r,u,g){let w="",k=0;for(let N=0;N<u.length;N++){const pe=u[N],re=N===u.length-1,le=r.substring(k,pe.from),Te=re?r.substring(pe.to):"",xe=(0,K.u_)(r.substring(pe.from,pe.to));a(xe.query.labels,g)||xe.query.labels.push(g);const l=ee.renderQuery(xe.query);w+=le+l+Te,k=pe.to}return w}function Z(r,u,g){let w="",k=0;for(let N=0;N<u.length;N++){const pe=u[N],re=N===u.length-1,le=r.substring(k,pe.to),Te=re?r.substring(pe.to):"";let xe="";!Number.isNaN(Number(g.value))&&(g.op==="<"||g.op===">")?xe=` | ${g.label}${g.op}${Number(g.value)}`:xe=` | ${g.label}${g.op}\`${(0,m.qv)(g.value)}\``,w+=le+xe+Te,k=pe.to}return w}function E(r,u,g){let w="",k=0;for(let N=0;N<u.length;N++){const pe=u[N],re=N===u.length-1,le=r.substring(k,pe.to),Te=re?r.substring(pe.to):"",xe=` | label_format ${g.renameTo}=${g.originalLabel}`;w+=le+xe+Te,k=pe.to}return w}function f(r,u="",g="|="){const w=b(r);if(!w.length)return r;const k=w[0].to;return r.slice(0,k)+` ${g} \`${u}\``+r.slice(k)}function d(r){const u=o.K3.parse(r),g=[];return u.iterate({enter:({type:w,from:k,to:N})=>{if(w.id===o.uk)return g.push(new y(k,N,w)),!1}}),g}function a(r,u){return r.find(g=>g.label===u.label&&g.value===u.value)}function i(r){return r.length?r.reduce((u,g)=>u.to>g.to?u:g):new y(0,0)}function S(r){return r.filter(u=>r.every(g=>u.contains(g)===!1||u===g))}function Q(r,u){if(r.type.id===u)return[y.fromNode(r)];const g=[];let w=0,k=r.childAfter(w);for(;k;)g.push(...Q(k,u)),w=k.to,k=r.childAfter(w);return g}function J(r){const u=o.K3.parse(r),g=[];return u.iterate({enter:({node:w})=>{w.type.id===o.MD&&g.push(...Q(w,o.g$))}}),g}function R(r){const u=o.K3.parse(r),g=[];return u.iterate({enter:({node:w})=>{w.type.id===o.MD&&g.push(...Q(w,o.gw))}}),g}},76487:(ze,we,t)=>{t.d(we,{I:()=>x,b:()=>ce});var e=t(74848),o=t(22803),m=t(41811),s=t(92745),M=t(27489),$=t(76319),P=t(21429);const I=(0,m.default)(O=>({buttonRow:(0,o.css)({display:"flex",flexDirection:"row",gap:O.spacing(.5),marginLeft:O.spacing(.5)})})),x="___LOG_LINE_BODY___",ce=O=>{const h=()=>{const{onClickShowField:ne,row:C}=O;ne&&ne(x),(0,M.rR)("grafana_explore_logs_log_details_show_body_clicked",{datasourceType:C.datasourceType,logRowUid:C.uid,type:"enable",app:O.app})},X=()=>{const{onClickHideField:ne,row:C}=O;ne&&ne(x),(0,M.rR)("grafana_explore_logs_log_details_show_body_clicked",{datasourceType:C.datasourceType,logRowUid:C.uid,type:"disable",app:O.app})},{theme:ee,displayedFields:K,disableActions:U,row:y}=O,Y=I(ee),ae=(0,P.D)(ee),Oe=K!=null&&K.includes(x)?(0,e.jsx)($.K,{variant:"primary",tooltip:(0,s.t)("logs.log-details-body.toggle-field-button.tooltip-hide-log-line","Hide log line"),name:"eye",onClick:X}):(0,e.jsx)($.K,{tooltip:(0,s.t)("logs.log-details-body.toggle-field-button.tooltip-show-log-line","Show log line"),name:"eye",onClick:h});return(0,e.jsxs)("tr",{className:ae.logDetailsValue,children:[(0,e.jsx)("td",{className:ae.logsDetailsIcon,children:(0,e.jsx)("div",{className:Y.buttonRow,children:!U&&K&&Oe})}),(0,e.jsx)("td",{className:ae.logDetailsLabel,colSpan:100,children:y.entry})]})}},78242:(ze,we,t)=>{t.d(we,{N:()=>x});var e=t(74848),o=t(22803),m=t(96540),s=t(92745),M=t(27489),$=t(87063),P=t(63142),I=t(74746);const x=({x:h,y:X,onClickFilterString:ee,onClickFilterOutString:K,selection:U,row:y,close:Y,...ae})=>{const Oe=(0,m.useRef)(null),ne=(0,P.of)(O);(0,m.useEffect)(()=>{function G(he){he.key==="Escape"&&Y()}return document.addEventListener("keyup",G),()=>{document.removeEventListener("keyup",G)}},[Y]);const C=(0,m.useCallback)(()=>{ce("popover_menu_disabled",U.length,y.datasourceType),ae.onDisable()},[ae,y.datasourceType,U.length]);return ee||K?(0,e.jsx)(e.Fragment,{children:(0,e.jsx)("div",{className:ne.menu,style:{top:X,left:h},children:(0,e.jsxs)($.W,{ref:Oe,children:[(0,e.jsx)($.W.Item,{label:(0,s.t)("logs.popover-menu.copy","Copy selection"),onClick:()=>{(0,I.Dk)(U,Oe),Y(),ce("copy",U.length,y.datasourceType)}}),ee&&(0,e.jsx)($.W.Item,{label:(0,s.t)("logs.popover-menu.line-contains","Add as line contains filter"),onClick:()=>{ee(U,y.dataFrame.refId),Y(),ce("line_contains",U.length,y.datasourceType)}}),K&&(0,e.jsx)($.W.Item,{label:(0,s.t)("logs.popover-menu.line-contains-not","Add as line does not contain filter"),onClick:()=>{K(U,y.dataFrame.refId),Y(),ce("line_does_not_contain",U.length,y.datasourceType)}}),(0,e.jsx)($.W.Divider,{}),(0,e.jsx)($.W.Item,{label:(0,s.t)("logs.popover-menu.disable-menu","Disable menu"),onClick:C})]})})}):null};function ce(h,X,ee){(0,M.rR)("grafana_explore_logs_popover_menu",{action:h,selectionLength:X,datasourceType:ee||"unknown"})}const O=h=>({menu:(0,o.css)({position:"fixed",zIndex:h.zIndex.modal})})},80124:(ze,we,t)=>{t.d(we,{C:()=>m,I:()=>s});var e=t(88744),o=t(95826);const m=[{id:o.EF.Addition,name:"Add scalar",sign:"+"},{id:o.EF.Subtraction,name:"Subtract scalar",sign:"-"},{id:o.EF.MultiplyBy,name:"Multiply by scalar",sign:"*"},{id:o.EF.DivideBy,name:"Divide by scalar",sign:"/"},{id:o.EF.Modulo,name:"Modulo by scalar",sign:"%"},{id:o.EF.Exponent,name:"Exponent",sign:"^"},{id:o.EF.EqualTo,name:"Equal to",sign:"==",comparison:!0},{id:o.EF.NotEqualTo,name:"Not equal to",sign:"!=",comparison:!0},{id:o.EF.GreaterThan,name:"Greater than",sign:">",comparison:!0},{id:o.EF.LessThan,name:"Less than",sign:"<",comparison:!0},{id:o.EF.GreaterOrEqual,name:"Greater or equal to",sign:">=",comparison:!0},{id:o.EF.LessOrEqual,name:"Less or equal to",sign:"<=",comparison:!0}],s=m.map($=>{const P=[{name:"Value",type:"number"}];let I=[2];return $.comparison&&(P.push({name:"Bool",type:"boolean",description:"If checked comparison will return 0 or 1 for the value rather than filtering."}),I=[2,!1]),{id:$.id,name:$.name,params:P,defaultParams:I,toggleable:!0,alternativesKey:"binary scalar operations",category:o.Ln.BinaryOps,renderer:M($.sign),addOperationHandler:e.iZ}});function M($){return function(I,x,ce){let O=I.params[0],h="";return I.params.length===2&&(h=I.params[1]?" bool":""),`${ce} ${$}${h} ${O}`}}},82212:(ze,we,t)=>{t.d(we,{I:()=>s});var e=t(74848),o=t(22803),m=t(68079);const s=({adjective:$="newer"})=>{const P=`Loading ${$} logs...`;return(0,e.jsx)("div",{className:M,children:(0,e.jsxs)("div",{children:[P," ",(0,e.jsx)(m.y,{inline:!0})]})})},M=(0,o.css)({display:"flex",justifyContent:"center"})},82423:(ze,we,t)=>{t.d(we,{Z:()=>a});var e=t(74848),o=t(22803),m=t(2543),s=t(96540),M=t(91793),$=t(78012),P=t(19379),I=t(739),x=t(1906),ce=t(92745),O=t(63142),h=t(71599),X=t(30703),ee=t(78242),K=t(84596),U=t(27489),y=t(43173),Y=t(68079),ae=t(17896),Oe=t(98102);const ne=({children:R,onClick:r,style:u,styles:g})=>(0,e.jsx)("div",{style:u,className:`${g.logLine} ${g.logLineMessage}`,children:r?(0,e.jsx)("button",{className:g.loadMoreButton,onClick:r,children:R}):R}),C=({children:R,displayedFields:r,handleOverflow:u,infiniteScrollMode:g,loading:w,loadMore:k,logs:N,onClick:pe,scrollElement:re,setInitialScrollPosition:le,showTime:Te,sortOrder:xe,timeRange:l,timeZone:B,virtualization:oe,wrapLogMessage:F})=>{const[de,be]=(0,s.useState)("idle"),[Se,We]=(0,s.useState)(!1),Qe=(0,K.A)(N),Ae=(0,K.A)(xe),Pe=(0,s.useRef)(re?.scrollTop||0),Ie=(0,s.useRef)(null),Be=(0,s.useRef)(0),z=(0,s.useRef)([]),Ee=(0,O.of)(Oe.$f,oe),te=(0,s.useRef)(null),Ce=(0,s.useRef)(void 0),me=(0,s.useRef)(!1);(0,s.useEffect)(()=>{!Qe||Qe===N||(de==="loading"?(be(N.length===Qe.length&&g==="interval"?"out-of-bounds":"idle"),Ce.current&&We(!0)):(z.current=[],We(!0)))},[de,g,N,Qe]),(0,s.useEffect)(()=>{Ae&&Ae!==xe&&be("idle")},[Ae,xe]),(0,s.useEffect)(()=>{Se&&!w&&(le(Ce.current),Ce.current=void 0,We(!1))},[Se,w,le]);const Le=(0,s.useCallback)(se=>{const $e=se===ae.Dh.Bottom?(0,ae.rg)((0,ae.K6)(N),l,B,xe):(0,ae.BB)((0,ae.K6)(N),l,B,xe);if(!$e&&g==="interval"){be("out-of-bounds");return}se===ae.Dh.Bottom?z.current.push(N[N.length-1].uid):(Ce.current=N[0],z.current.push(N[0].uid)),be("loading"),k?.($e??(0,ae.K6)(N),se),(0,U.rR)("grafana_logs_infinite_scrolling",{direction:se,sort_order:xe})},[g,k,N,xe,l,B]);(0,s.useEffect)(()=>{if(!re||!k||!y.$.featureToggles.logsInfiniteScrolling)return;function se($e){if(!re||!k||!N.length)return;const ie=(0,ae.V7)($e,Ie.current,Be,re,Pe.current);if(Ie.current=$e,Pe.current=re.scrollTop,de!=="pre-scroll-bottom"&&de!=="pre-scroll-top"){if(g==="unlimited"&&ie===ae.Dh.Top){be("pre-scroll-top"),te.current=setTimeout(()=>{be(fe=>fe==="pre-scroll-top"?"idle":fe)},1e4);return}return}ie!==ae.Dh.NoScroll&&Le(ie)}return re.addEventListener("scroll",se),re.addEventListener("wheel",se),()=>{re.removeEventListener("scroll",se),re.removeEventListener("wheel",se)}},[de,g,k,N.length,Le,re]),(0,s.useEffect)(()=>()=>{te.current&&clearTimeout(te.current)},[]);const _e=(0,s.useCallback)(()=>{te.current&&clearTimeout(te.current),Le(ae.Dh.Top)},[Le]),je=(0,s.useCallback)(()=>{Le(ae.Dh.Bottom)},[Le]),Me=(0,s.useCallback)(({index:se,style:$e})=>!N[se]&&de!=="idle"?(0,e.jsx)(ne,{style:$e,styles:Ee,onClick:de==="pre-scroll-bottom"?je:void 0,children:_(de,xe)}):(0,e.jsx)(Oe.P0,{displayedFields:r,index:se,log:N[se],logs:N,onClick:pe,showTime:Te,style:$e,styles:Ee,timeRange:l,timeZone:B,variant:G(N,se,z.current),virtualization:oe,wrapLogMessage:F,onOverflow:u}),[r,u,de,je,N,pe,Te,xe,Ee,l,B,oe,F]),T=(0,s.useCallback)(se=>{if(!re||(se.visibleStartIndex===0&&(me.current=re.scrollHeight<=re.clientHeight),me.current||de==="loading"||de==="out-of-bounds"))return;const $e=N.length-1,ie=N.length-2;se.visibleStopIndex>=$e?be("pre-scroll-bottom"):se.visibleStartIndex<ie&&be("idle")},[de,N.length,re]),A=(0,s.useCallback)(se=>N[se]?N[se].uid:se.toString(),[N]),ge=N.length&&k&&de!=="idle"?N.length+1:N.length;return(0,e.jsxs)(e.Fragment,{children:[de==="pre-scroll-top"&&(0,e.jsx)("div",{className:Ee.loadMoreTopContainer,children:(0,e.jsx)(ne,{style:{},styles:Ee,onClick:_e,children:(0,ce.t)("logs.infinite-scroll.load-more","Scroll to load more")})}),R({getItemKey:A,itemCount:ge,onItemsRendered:T,Renderer:Me})]})};function _(R,r){switch(R){case"out-of-bounds":return(0,ce.t)("logs.infinite-scroll.end-of-range","End of the selected time range.");case"loading":return(0,e.jsxs)(e.Fragment,{children:[r===I.uH.Ascending?(0,ce.t)("logs.infinite-scroll.load-newer","Loading newer logs..."):(0,ce.t)("logs.infinite-scroll.load-older","Loading older logs...")," ",(0,e.jsx)(Y.y,{inline:!0})]});case"pre-scroll-bottom":return(0,ce.t)("logs.infinite-scroll.load-more","Scroll to load more");default:return null}}function G(R,r,u){if(!u.length||!R[r-1])return;const g=R[r-1];for(const w of u)if(g.uid===w)return"infinite-scroll"}var he=t(53622),H=t(29457),q=t(92252),V=t(76732),W=t(8934),c=t(63527),b=t(76319),L=t(67897);const v=48,p=({listRef:R,logs:r})=>{const{hideSearch:u,filterLogs:g,matchingUids:w,setMatchingUids:k,setSearch:N,searchVisible:pe,toggleFilterLogs:re}=(0,L.fV)(),{displayedFields:le,noInteractions:Te}=(0,H.fl)(),[xe,l]=(0,s.useState)(""),[B,oe]=(0,s.useState)(null),F=(0,s.useRef)(""),de=(0,s.useRef)(!1),be=(0,O.of)(n),Se=(0,s.useMemo)(()=>!xe||!pe?[]:D(r,xe,le),[le,r,xe,pe]),We=(0,s.useCallback)(Ie=>{F.current=Ie.target.value,(0,s.startTransition)(()=>{l(F.current)}),!de.current&&!Te&&((0,U.rR)("logs_log_list_search_used"),de.current=!0)},[Te]),Qe=(0,s.useCallback)(()=>{if(B===null)return;const Ie=B>0?B-1:Se.length-1;oe(Ie),R?.scrollToItem(r.indexOf(Se[Ie]),"center")},[B,R,r,Se]),Ae=(0,s.useCallback)(()=>{if(B===null)return;const Ie=B<Se.length-1?B+1:0;oe(Ie),R?.scrollToItem(r.indexOf(Se[Ie]),"center")},[B,R,r,Se]);if((0,s.useEffect)(()=>{if(!Se.length){oe(null);return}B||(oe(0),R?.scrollToItem(r.indexOf(Se[0]),"center"))},[B,R,r,Se]),(0,s.useEffect)(()=>{pe||(l(""),N(void 0),k(null))},[pe,N,k]),(0,s.useEffect)(()=>{const Ie=Se.map(z=>z.uid),Be=w?(0,V.ab)(w,Ie):!1;w&&!Be&&r.filter(z=>w.includes(z.uid)).filter(z=>Se.findIndex(Ee=>Ee.uid===z.uid)<0).forEach(z=>z.setCurrentSearch(void 0)),N(xe||void 0),Be?Se.length||k(null):k(Ie.length?Ie:null)},[r,Se,w,xe,N,k]),!pe)return null;const Pe=xe!==""?(0,e.jsx)(e.Fragment,{children:`${B!==null?B+1:0}/${Se?.length??0}`}):void 0;return(0,e.jsxs)("div",{className:be.container,children:[(0,e.jsx)("div",{className:be.wrapper,children:(0,e.jsx)(c.p,{onChange:We,autoFocus:!0,placeholder:(0,ce.t)("logs.log-list-search.input-placeholder","Search in logs"),suffix:Pe})}),(0,e.jsx)(b.K,{name:"info-circle",variant:"secondary",tooltip:(0,ce.t)("logs.log-list-search.info","Client-side search for strings within the displayed logs. Not to be confused with query filters. Use this component to search for specific strings in your log results.")}),(0,e.jsx)(b.K,{onClick:Qe,disabled:!Se||!Se.length,name:"angle-up","aria-label":(0,ce.t)("logs.log-list-search.prev","Previous result")}),(0,e.jsx)(b.K,{onClick:Ae,disabled:!Se||!Se.length,name:"angle-down","aria-label":(0,ce.t)("logs.log-list-search.next","Next result")}),(0,e.jsx)(b.K,{onClick:re,disabled:!Se||!Se.length,className:g?be.controlButtonActive:void 0,name:"filter","aria-label":(0,ce.t)("logs.log-list-search.filter","Filter matching logs")}),(0,e.jsx)(b.K,{onClick:u,name:"times","aria-label":(0,ce.t)("logs.log-list-search.close","Close search")})]})},n=R=>({container:(0,o.css)({background:R.colors.background.elevated,display:"flex",gap:R.spacing(1),padding:R.spacing(1),zIndex:R.zIndex.modal,overflow:"hidden",width:"100%"}),wrapper:(0,o.css)({width:"50%"}),controlButtonActive:(0,o.css)({"&:after":{display:"block",content:'" "',position:"absolute",height:2,borderRadius:R.shape.radius.default,bottom:2,backgroundImage:R.colors.gradients.brandHorizontal,width:"95%",opacity:1}})});function D(R,r,u){const g=new RegExp((0,W.$f)(r),"i"),w=R.filter(k=>k.entry.match(g)?!0:u.some(N=>k.getDisplayedFieldValue(N).match(g)));return w.forEach(k=>k.setCurrentSearch(r)),w}var j=t(46464);const Z=()=>{const{hideSearch:R,searchVisible:r,showSearch:u}=(0,L.fV)();(0,s.useEffect)(()=>{function g(w){const k=navigator.userAgent.includes("Mac"),N=w.key==="f"||w.key==="F";if(k&&w.metaKey&&N||!k&&w.ctrlKey&&N){u();return}w.key==="Escape"&&r&&R()}return document.addEventListener("keydown",g),()=>{document.removeEventListener("keydown",g)}})};var E=t(74746);const f=R=>{const[r,u]=(0,s.useState)({selection:"",selectedRow:null,popoverMenuCoordinates:{x:0,y:0}}),[g,w]=(0,s.useState)(!1),k=(0,s.useRef)(null),{onClickFilterOutString:N,onClickFilterString:pe}=(0,H.fl)(),re=(0,s.useCallback)(()=>!y.$.featureToggles.logRowsPopoverMenu||(0,E.Vu)()?!1:!!(N||pe),[N,pe]),le=(0,s.useCallback)(()=>{k.current&&(document.removeEventListener("click",k.current),document.removeEventListener("contextmenu",k.current),k.current=null),u({selection:"",popoverMenuCoordinates:{x:0,y:0},selectedRow:null})},[]),Te=(0,s.useCallback)(F=>{if((0,E.a8)(F.target)&&!R?.contains(F.target)){le();return}document.getSelection()?.toString()||le()},[le,R]),xe=(0,s.useCallback)((F,de)=>{const be=document.getSelection()?.toString();if(!be)return!1;if(F.altKey&&(0,E.Ck)(),re()===!1)return!!be;if(!R)return!1;const Se=270,We=105,Qe=F.clientX+Se>window.innerWidth?window.innerWidth-Se:F.clientX,Ae=F.clientY+We>window.innerHeight?window.innerHeight-We:F.clientY;return u({selection:be,popoverMenuCoordinates:{x:Qe,y:Ae},selectedRow:de}),k.current=Te,document.addEventListener("click",Te),document.addEventListener("contextmenu",Te),!0},[R,Te,re]),l=(0,s.useCallback)(()=>{le(),w(!0)},[le]),B=(0,s.useCallback)(()=>{w(!1)},[]),oe=(0,s.useCallback)(()=>{(0,E.PO)(),w(!1)},[]);return{closePopoverMenu:le,handleTextSelection:xe,onDisableCancel:B,onDisableConfirm:oe,onDisablePopoverMenu:l,popoverState:r,showDisablePopoverOptions:g}};var d=t(55439);const a=({app:R,displayedFields:r,containerElement:u,logOptionsStorageKey:g,detailsMode:w,dedupStrategy:k,enableLogDetails:N,eventBus:pe,filterLevels:re,fontSize:le=g?$.M.get(`${g}.fontSize`)??"default":"default",getFieldLinks:Te,getRowContextQuery:xe,grammar:l,infiniteScrollMode:B,initialScrollPosition:oe="top",isLabelFilterActive:F,loading:de,loadMore:be,logLineMenuCustomItems:Se,logs:We,logsMeta:Qe,logSupportsContext:Ae,noInteractions:Pe,onClickFilterLabel:Ie,onClickFilterOutLabel:Be,onClickFilterString:z,onClickFilterOutString:Ee,onClickShowField:te,onClickHideField:Ce,onLogOptionsChange:me,onLogLineHover:Le,onPermalinkClick:_e,onPinLine:je,onOpenContext:Me,onUnpinLine:T,permalinkedLogId:A,pinLineButtonTooltipTitle:ge,pinnedLogs:se,setDisplayedFields:$e,showControls:ie,showTime:fe,sortOrder:ue,syntaxHighlighting:ve=g?$.M.getBool(`${g}.syntaxHighlighting`,!0):!0,timeRange:De,timestampResolution:Ne,timeZone:Xe,wrapLogMessage:Fe})=>(0,e.jsx)(H.vv,{app:R,containerElement:u,dedupStrategy:k,detailsMode:w,displayedFields:r,enableLogDetails:N,filterLevels:re,fontSize:le,getRowContextQuery:xe,isLabelFilterActive:F,logs:We,logsMeta:Qe,logLineMenuCustomItems:Se,logOptionsStorageKey:g,logSupportsContext:Ae,noInteractions:Pe,onClickFilterLabel:Ie,onClickFilterOutLabel:Be,onClickFilterString:z,onClickFilterOutString:Ee,onClickShowField:te,onClickHideField:Ce,onLogOptionsChange:me,onLogLineHover:Le,onPermalinkClick:_e,onPinLine:je,onOpenContext:Me,onUnpinLine:T,permalinkedLogId:A,pinLineButtonTooltipTitle:ge,pinnedLogs:se,setDisplayedFields:$e,showControls:ie,showTime:fe,sortOrder:ue,syntaxHighlighting:ve,timestampResolution:Ne,wrapLogMessage:Fe,children:(0,e.jsx)(L.zz,{children:(0,e.jsx)(i,{containerElement:u,eventBus:pe,getFieldLinks:Te,grammar:l,initialScrollPosition:oe,infiniteScrollMode:B,loading:de,loadMore:be,logs:We,showControls:ie,timeRange:De,timeZone:Xe})})}),i=({containerElement:R,eventBus:r=new P.o,getFieldLinks:u,grammar:g,initialScrollPosition:w="top",infiniteScrollMode:k="interval",loading:N,loadMore:pe,logs:re,showControls:le,timeRange:Te,timeZone:xe})=>{const{app:l,displayedFields:B,dedupStrategy:oe,detailsMode:F,filterLevels:de,fontSize:be,forceEscape:Se,hasLogsWithErrors:We,hasSampledLogs:Qe,onClickFilterString:Ae,onClickFilterOutString:Pe,permalinkedLogId:Ie,prettifyJSON:Be,showDetails:z,showTime:Ee,sortOrder:te,timestampResolution:Ce,toggleDetails:me,wrapLogMessage:Le}=(0,H.fl)(),[_e,je]=(0,s.useState)([]),[Me,T]=(0,s.useState)(J(R,l)),A=(0,O.$j)(),ge=(0,s.useRef)(null),se=(0,s.useRef)(R.clientWidth),$e=(0,s.useRef)(null),ie=(0,s.useRef)(null),fe=(0,s.useMemo)(()=>new d.km(A,be),[A,be]),ue=(0,s.useMemo)(()=>Le?[]:fe.calculateFieldDimensions(_e,B,Ce),[B,_e,Ce,fe,Le]),ve=(0,O.of)(S,ue,B,{showTime:Ee}),De=$e.current??R,{closePopoverMenu:Ne,handleTextSelection:Xe,onDisableCancel:Fe,onDisableConfirm:ke,onDisablePopoverMenu:Ye,popoverState:Ke,showDisablePopoverOptions:Je}=f($e.current);Z();const{filterLogs:tt,matchingUids:nt,searchVisible:et}=(0,L.fV)(),qe=(0,s.useMemo)(()=>de.length===0?_e:_e.filter(Re=>de.includes(Re.logLevel)),[de,_e]),Ve=(0,s.useMemo)(()=>nt&&tt?qe.filter(Re=>nt.includes(Re.uid)):qe,[tt,qe,nt]),ot=(0,s.useMemo)(()=>(0,m.debounce)(Re=>{ge.current?.resetAfterIndex(Re),st.current=1/0},25),[]),it=(0,s.useMemo)(()=>(0,m.debounce)((Re,Ge)=>{ge.current?.scrollToItem(Re,Ge)},250),[]);(0,s.useEffect)(()=>{const Re=r.subscribe(d._B,Ge=>Q(Ge,Ve,ge.current));return()=>Re.unsubscribe()},[r,Ve]),(0,s.useEffect)(()=>{je((0,j.E)(re,{getFieldLinks:u,escape:Se??!1,prettifyJSON:Be,order:te,timeZone:xe,virtualization:fe,wrapLogMessage:Le},g)),fe.resetLogLineSizes(),ge.current?.resetAfterIndex(0)},[Se,u,g,re,Be,te,xe,fe,Le]),(0,s.useEffect)(()=>{ge.current?.resetAfterIndex(0)},[Le,z,B,oe]),(0,s.useLayoutEffect)(()=>{se.current!==De.clientWidth&&(se.current=De.clientWidth,ot(0))}),(0,s.useLayoutEffect)(()=>{const Re=(0,m.debounce)(()=>{T(J(R,l,et))},50),Ge=new ResizeObserver(()=>Re());return Ge.observe(R),()=>Ge.disconnect()},[l,R,et]);const st=(0,s.useRef)(1/0),lt=(0,s.useCallback)((Re,Ge,at)=>{at!==void 0&&fe.storeLogLineSize(Ge,De,at),Re!==st.current&&(st.current=Re<st.current?Re:st.current,ot(st.current))},[ot,fe,De]),Ue=(0,s.useCallback)(Re=>{const Ge=Re?Re.uid:Ie;if(Ge){const at=_e.findIndex(dt=>dt.uid===Ge);if(at>=0){ge.current?.scrollToItem(at,"start");return}}ge.current?.scrollToItem(w==="top"?0:_e.length-1)},[w,Ie,_e]),ct=(0,s.useCallback)((Re,Ge)=>{Xe(Re,Ge)||me(Ge)},[Xe,me]),ye=(0,s.useCallback)(()=>{ot(0)},[ot]),He=(0,s.useCallback)(Re=>{const Ge=Ve.findIndex(at=>at.uid===Re.uid);Ge>=0&&it(Ge,"start")},[it,Ve]);return!R||Me==null?null:(0,e.jsxs)("div",{className:ve.logListContainer,children:[le&&(0,e.jsx)(q.V,{eventBus:r}),F==="sidebar"&&z.length>0&&(0,e.jsx)(he.Bj,{containerElement:R,focusLogLine:He,logs:Ve,timeRange:Te,timeZone:xe,onResize:ye,showControls:le}),(0,e.jsxs)("div",{className:ve.logListWrapper,ref:$e,children:[Ke.selection&&Ke.selectedRow&&(0,e.jsx)(ee.N,{close:Ne,row:Ke.selectedRow,selection:Ke.selection,...Ke.popoverMenuCoordinates,onClickFilterString:Ae,onClickFilterOutString:Pe,onDisable:Ye}),Je&&(0,e.jsx)(h.u,{isOpen:!0,title:(0,ce.t)("logs.log-rows.disable-popover.title","Disable menu"),body:(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(ce.x6,{i18nKey:"logs.log-rows.disable-popover.message",children:"You are about to disable the logs filter menu. To re-enable it, select text in a log line while holding the alt key."}),(0,e.jsxs)("div",{className:ve.shortcut,children:[(0,e.jsx)(X.I,{name:"keyboard"}),(0,e.jsx)(ce.x6,{i18nKey:"logs.log-rows.disable-popover-message.shortcut",children:"alt+select to enable again"})]})]}),confirmText:(0,ce.t)("logs.log-rows.disable-popover.confirm","Confirm"),icon:"exclamation-triangle",onConfirm:ke,onDismiss:Fe}),(0,e.jsx)(p,{logs:qe,listRef:ge.current}),(0,e.jsx)(C,{displayedFields:B,handleOverflow:lt,infiniteScrollMode:k,loading:N,logs:Ve,loadMore:pe,onClick:ct,scrollElement:ie.current,showTime:Ee,sortOrder:te,timeRange:Te,timeZone:xe,setInitialScrollPosition:Ue,virtualization:fe,wrapLogMessage:Le,children:({getItemKey:Re,itemCount:Ge,onItemsRendered:at,Renderer:dt})=>(0,e.jsx)(M._m,{className:ve.logList,height:Me,itemCount:Ge,itemSize:d.gn.bind(null,fe,Ve,De,B,{detailsMode:F,hasLogsWithErrors:We,hasSampledLogs:Qe,showDuplicates:oe!==I.fY.none,showDetails:z,showTime:Ee,wrap:Le}),itemKey:Re,layout:"vertical",onItemsRendered:at,outerRef:ie,overscanCount:5,ref:ge,style:Le?{overflowY:"scroll"}:{overflow:"scroll"},width:"100%",children:dt})})]})]})};function S(R,r,u,{showTime:g}){const w=g?r:r.filter((k,N)=>N>0);return{logList:(0,o.css)({"& .unwrapped-log-line":{display:"grid",gridTemplateColumns:(0,Oe.Q5)(w,u),"& .field":{overflow:"hidden"}}}),logListContainer:(0,o.css)({display:"flex",flexDirection:"row-reverse",minWidth:R.spacing(35)}),logListWrapper:(0,o.css)({position:"relative",width:"100%"}),shortcut:(0,o.css)({display:"inline-flex",alignItems:"center",gap:R.spacing(1),color:R.colors.text.secondary,opacity:.7,fontSize:R.typography.bodySmall.fontSize,marginTop:R.spacing(1)})}}function Q(R,r,u){if(R.payload.scrollTo==="top")u?.scrollTo(0);else if(R.payload.scrollTo==="bottom")u?.scrollToItem(r.length-1);else{const g=r.findIndex(w=>w.uid===R.payload.scrollTo);g>=0&&u?.scrollToItem(g,"center")}}function J(R,r,u=!1){return(r===x.Jk.Explore?Math.max(window.innerHeight*.8,R.clientHeight):R.clientHeight)-(u?v:0)}},88152:(ze,we,t)=>{t.d(we,{$x:()=>$,H7:()=>s,f_:()=>O});var e=t(76487);const o="severity_number";function m(h){const X=new Set;return h.forEach(ee=>{const K=s(ee);K!==void 0&&X.add(K)}),[...X]}function s(h){return"otelLanguage"in h&&h.otelLanguage?h.otelLanguage:h.labels[o]!==void 0&&h.labels.telemetry_sdk_language?h.labels.telemetry_sdk_language:void 0}function M(h,X){const ee=[];return X.forEach(K=>{(void 0??I()).forEach(y=>{ee.includes(y)||ee.push(y)})}),ee.filter(K=>K===e.I||h.some(U=>U.labels[K]!==void 0))}function $(h){return M(h,m(h))}function P(h){}function I(){return["scope_name","thread_name","exception_type","exception_message",e.I]}const x=/^(aws_|cloud_|cloudfoundry_|container_|deployment_|faas_|gcp_|host_|k8s_|os_|process_|service_|telemetry_)/,ce=/^(flags|observed_timestamp|scope_name|severity_number|severity_text|span_id|trace_id|detected_level)$/;function O(h){if(!h.otelLanguage)return h.raw;const X=Object.keys(h.labels).filter(ee=>!x.test(ee)&&!ce.test(ee));return h.raw+" "+X.map(ee=>h.labels[ee]?`${ee}=${h.labels[ee]}`:"").join(" ")}},88744:(ze,we,t)=>{t.d(we,{af:()=>C,VR:()=>_,G3:()=>L,jC:()=>j,fu:()=>X,yD:()=>ee,iZ:()=>b,UF:()=>G,OS:()=>H,sn:()=>y,EP:()=>ae});var e=t(2543),o=t(55127),m=t.n(o),s=t(22420),M=t(77236),$=t(74848),P=t(96540),I=t(18857);const x=({onChange:E,index:f,operationId:d,value:a,query:i,datasource:S,queryModeller:Q})=>{const[J,R]=(0,P.useState)({});return(0,$.jsx)(I.l6,{inputId:H(d,f),autoFocus:a==="",openMenuOnFocus:!0,onOpenMenu:async()=>{R({isLoading:!0});const r=await ce(i,S,Q);R({options:r,isLoading:void 0})},isLoading:J.isLoading,allowCustomValue:!0,noOptionsMessage:"No labels found",loadingMessage:"Loading labels",options:J.options,value:O(a),onChange:r=>E(f,r.value)})};async function ce(E,f,d){let a=E.labels;const i=d.renderLabels(a);return(await f.languageProvider.fetchLabels({streamSelector:i})).map(Q=>({label:Q,value:Q}))}const O=E=>({label:E?.toString(),value:E});var h=t(95826);function X(E,f){const d=[he()],a=["$__auto"];let i;return E===h.EF.QuantileOverTime&&(a.push("0.95"),d.push({name:"Quantile",type:"number"})),f&&(d.push({name:"By label",type:"string",restParam:!0,optional:!0}),i=q(`__${E}_by`)),{id:E,name:c(E),params:d,defaultParams:a,toggleable:!0,alternativesKey:"range function",category:h.Ln.RangeFunctions,orderRank:h.h5.RangeVectorFunction,renderer:U,addOperationHandler:C,paramChangedHandler:i,explainHandler:(S,Q)=>{let J=M.AW.find(R=>R.insertText===S.id)?.documentation??"";return S.params[0]==="$__auto"?`${J} \`$__auto\` is a variable that will be replaced with the [value of step](https://grafana.com/docs/grafana/next/datasources/loki/query-editor/#options) for range queries and with the value of the selected time range (calculated to - from) for instant queries.`:`${J} The [range vector](https://grafana.com/docs/loki/latest/logql/metric_queries/#range-vector-aggregation) is set to \`${S.params[0]}\`.`}}}function ee(E){const f=X(E,!0),d=f.params.slice(0,-1);return[f,{id:`__${E}_by`,name:`${c(E)} by`,params:[...d,{name:"Label",type:"string",restParam:!0,optional:!0,editor:x}],defaultParams:[...f.defaultParams,""],toggleable:!0,alternativesKey:"range function with grouping",category:h.Ln.RangeFunctions,renderer:K(E,"by"),paramChangedHandler:W(E),explainHandler:V(E,"by"),addOperationHandler:C,hideFromList:!0},{id:`__${E}_without`,name:`${c(E)} without`,params:[...d,{name:"Label",type:"string",restParam:!0,optional:!0,editor:x}],defaultParams:[...f.defaultParams,""],alternativesKey:"range function with grouping",category:h.Ln.RangeFunctions,renderer:K(E,"without"),paramChangedHandler:W(E),explainHandler:V(E,"without"),addOperationHandler:C,hideFromList:!0}]}function K(E,f){return function(a,i,S){const Q=i.params.findIndex(r=>r.restParam),J=a.params.slice(0,Q),R=a.params.slice(Q);return J.length===2&&E===h.EF.QuantileOverTime?`${E}(${J[1]}, ${S} [${J[0]}]) ${f} (${R.join(", ")})`:`${E}(${S} [${J[0]}]) ${f} (${R.join(", ")})`}}function U(E,f,d){const a=E.params??[],i=a[0]??"$__auto";if(a.length===2&&E.id===h.EF.QuantileOverTime){const S=a[1];return`${E.id}(${S}, ${d} [${i}])`}return`${E.id}(${d} [${a[0]??"$__auto"}])`}function y(E,f,d){return["<","<=",">",">="].includes(String(E.params[1]))?`${d} | ${E.params[0]} ${E.params[1]} ${E.params[2]}`:`${d} | ${E.params[0]} ${E.params[1]} \`${E.params[2]}\``}function Y(E,f){if(!E)return!1;const d=E.params[1].toString().startsWith("!");return f.filter(S=>S.id===LokiOperationId.LabelFilter&&S.params[0]===E.params[0]&&S.params[2]===E.params[2]).some(S=>!!(d&&S.params[1].toString().startsWith("!")===!1||d===!1&&S.params[1].toString().startsWith("!")))}function ae(E,f,d){switch(E.id){case h.EF.Logfmt:const[a=!1,i=!1,...S]=E.params;return`${d} | logfmt${a?" --strict":""}${i?" --keep-empty":""} ${S.filter(Q=>Q).join(", ")}`.trim();case h.EF.Json:return`${d} | json ${E.params.filter(Q=>Q).join(", ")}`.trim();case h.EF.Drop:return`${d} | drop ${E.params.filter(Q=>Q).join(", ")}`.trim();case h.EF.Keep:return`${d} | keep ${E.params.filter(Q=>Q).join(", ")}`.trim();default:return`${d} | ${E.id}`}}function Oe(E){return E.category===h.Ln.RangeFunctions}function ne(E,f,d){const a=E.findIndex(i=>{const S=f.getOperationDefinition(i.id);return S?d(S):!1});return a===-1?E.length:a}function C(E,f,d){const a={id:E.id,params:E.defaultParams},i=[...f.operations],S=i.find(Q=>{const J=d.getOperationDefinition(Q.id);return J?Oe(J):!1});switch(E.category){case h.Ln.Aggregations:case h.Ln.Functions:if(!S){const J=ne(i,d,R=>R.category===h.Ln.Functions);i.splice(J,0,{id:h.EF.Rate,params:["$__auto"]})}i.push(a);break;case h.Ln.RangeFunctions:if(S){const J=i.indexOf(S);i[J]=a;break}default:const Q=ne(i,d,J=>(E.orderRank??100)<(J.orderRank??100));i.splice(Q,0,a);break}return{...f,operations:i}}function _(E,f){return{...f,binaryQueries:[...f.binaryQueries??[],{operator:"/",query:f}]}}function G(E,f){return function(a,i,S){const Q=a.params.some(r=>typeof r=="string"&&r.includes("`")),J=Q?'"':"`";let R;return Q?R=a.params.map(r=>typeof r=="string"?(0,s.Qn)(r):r):R=a.params,f?`${S} ${E} ${J}(?i)${R.join(`${J} or ${J}(?i)`)}${J}`:`${S} ${E} ${J}${R.join(`${J} or ${J}`)}${J}`}}function he(){return{name:"Range",type:"string",options:["$__auto"],description:'Use the default value "$__auto". Change the "step" value in the query options to change the bucket size.'}}function H(E,f){return`operations.${E}.param.${f}`}function q(E){return function(d,a,i){return a.params.length===i.params.length?{...a,id:E}:a}}function V(E,f){return function(a){const i=a.params.map(Q=>`\`${Q}\``).join(" and "),S=m()("label",a.params.length);switch(f){case"by":return`Calculates ${E} over dimensions while preserving ${S} ${i}.`;case"without":return`Calculates ${E} over the dimensions ${i}. All other labels are preserved.`;default:return`Calculates ${E} over the dimensions.`}}}function W(E){return function(d,a,i){return a.params.length<i.params.length?{...a,id:E}:a}}function c(E){return(0,e.capitalize)(E.replace(/_/g," "))}function b(E,f){const d={id:E.id,params:E.defaultParams};return{...f,operations:[...f.operations,d]}}function L(E,f={}){return[{id:E,name:c(E),params:[{name:"By label",type:"string",restParam:!0,optional:!0}],defaultParams:[],toggleable:!0,alternativesKey:"plain aggregations",category:h.Ln.Aggregations,renderer:p,paramChangedHandler:q(`__${E}_by`),explainHandler:V(E,""),addOperationHandler:b,...f},{id:`__${E}_by`,name:`${c(E)} by`,params:[{name:"Label",type:"string",restParam:!0,optional:!0,editor:x}],defaultParams:[""],alternativesKey:"aggregations by",category:h.Ln.Aggregations,renderer:D(E),paramChangedHandler:W(E),explainHandler:V(E,"by"),addOperationHandler:b,hideFromList:!0,...f},{id:`__${E}_without`,name:`${c(E)} without`,params:[{name:"Label",type:"string",restParam:!0,optional:!0,editor:x}],defaultParams:[""],alternativesKey:"aggregations by",category:h.Ln.Aggregations,renderer:v(E),paramChangedHandler:W(E),explainHandler:V(E,"without"),addOperationHandler:b,hideFromList:!0,...f}]}function v(E){return function(d,a,i){return`${E} without(${d.params.join(", ")}) (${i})`}}function p(E,f,d){const a=n(E,f,d),i=E.id+"(";return d&&a.push(d),i+a.join(", ")+")"}function n(E,f,d){return(E.params??[]).map((a,i)=>f.params[i].type==="string"?'"'+a+'"':a)}function D(E){return function(d,a,i){return`${E} by(${d.params.join(", ")}) (${i})`}}function j(E,f,d={}){const a=L(E,d);return a[0].params.unshift(...f.params),a[1].params.unshift(...f.params),a[2].params.unshift(...f.params),a[0].defaultParams=f.defaultParams,a[1].defaultParams=[...f.defaultParams,""],a[2].defaultParams=[...f.defaultParams,""],a[1].renderer=Z(E),a[2].renderer=Z(E),a}function Z(E){return function(d,a,i){const S=a.params.findIndex(R=>R.restParam),Q=d.params.slice(0,S),J=d.params.slice(S);return`${E} by(${J.join(", ")}) (${Q.map((R,r)=>a.params[r].type==="string"?`"${R}"`:R).join(", ")}, ${i})`}}},92252:(ze,we,t)=>{t.d(we,{V:()=>G});var e=t(74848),o=t(22803),m=t(2543),s=t.n(m),M=t(96540),$=t(739),P=t(1906),I=t(67770),x=t(92745),ce=t(43173),O=t(27489),h=t(30703),X=t(76319),ee=t(45967),K=t(87063),U=t(88559),y=t(63142),Y=t(74746),ae=t(29457),Oe=t(67897),ne=t(55439);const C=[$.fY.none,$.fY.exact,$.fY.numbers,$.fY.signature],_=[I.$b.info,I.$b.debug,I.$b.trace,I.$b.warning,I.$b.error,I.$b.critical,I.$b.unknown],G=({eventBus:V,visualisationType:W="logs"})=>{const c=(0,y.of)(q),{app:b,dedupStrategy:L,downloadLogs:v,filterLevels:p,fontSize:n,forceEscape:D,hasUnescapedContent:j,prettifyJSON:Z,setDedupStrategy:E,setFilterLevels:f,setFontSize:d,setForceEscape:a,setPrettifyJSON:i,setShowTime:S,setShowUniqueLabels:Q,setSortOrder:J,setSyntaxHighlighting:R,setWrapLogMessage:r,showTime:u,showUniqueLabels:g,sortOrder:w,syntaxHighlighting:k,wrapLogMessage:N}=(0,ae.fl)(),{hideSearch:pe,searchVisible:re,showSearch:le}=(0,Oe.fV)(),Te=(0,M.useCallback)(()=>{(0,O.rR)("logs_log_list_controls_scroll_top_clicked"),V.publish(new ne._B({scrollTo:"top"}))},[V]),xe=(0,M.useCallback)(()=>{(0,O.rR)("logs_log_list_controls_scroll_bottom_clicked"),V.publish(new ne._B({scrollTo:"bottom"}))},[V]),l=(0,M.useCallback)(()=>{(0,O.rR)("logs_log_list_controls_force_escape_clicked"),a(!D)},[D,a]),B=(0,M.useCallback)(z=>{(0,O.rR)("logs_log_list_controls_level_clicked",{level:z}),z===void 0?f([]):p.includes(z)?f(p.filter(Ee=>Ee!==z)):f([...p,z])},[p,f]),oe=(0,M.useCallback)(()=>{const z=n==="default"?"small":"default";(0,O.rR)("logs_log_list_controls_font_size_clicked",{size:z}),d(z)},[n,d]),F=(0,M.useCallback)(()=>{(0,O.rR)("logs_log_list_controls_show_time_clicked",{show_time:!u}),S(!u)},[S,u]),de=(0,M.useCallback)(()=>{(0,O.rR)("logs_log_list_controls_show_unique_labels_clicked",{show_unique_labels:g}),Q(!g)},[Q,g]),be=(0,M.useCallback)(()=>{(0,O.rR)("logs_log_list_controls_sort_order_clicked",{order:w===$.uH.Ascending?$.uH.Descending:$.uH.Ascending}),J(w===$.uH.Ascending?$.uH.Descending:$.uH.Ascending)},[J,w]),Se=(0,M.useCallback)(()=>{(0,O.rR)("logs_log_list_controls_prettify_json_clicked",{state:!Z}),i(!Z)},[Z,i]),We=(0,M.useCallback)(()=>{(0,O.rR)("logs_log_list_controls_syntax_clicked",{state:!k}),R(!k)},[R,k]),Qe=(0,M.useCallback)(z=>{z.preventDefault(),(0,O.rR)("logs_log_list_controls_wrap_clicked",{state:!N}),r(!N)},[r,N]),Ae=(0,M.useMemo)(()=>(0,e.jsx)(K.W,{children:C.map(z=>(0,e.jsx)(K.W.Item,{className:L===z?c.menuItemActive:void 0,description:I._C[z],label:(0,m.capitalize)(z),onClick:()=>{E(z),(0,O.rR)("logs_log_list_controls_deduplication_clicked",{option:z})}},z))}),[L,E,c.menuItemActive]),Pe=(0,M.useMemo)(()=>(0,e.jsxs)(K.W,{children:[(0,e.jsx)(K.W.Item,{className:p.length===0?c.menuItemActive:void 0,label:(0,x.t)("logs.logs-controls.display-level-all","All levels"),onClick:()=>B()},"all"),_.map(z=>(0,e.jsx)(K.W.Item,{className:p.includes(z)?c.menuItemActive:void 0,label:(0,m.capitalize)(z),onClick:()=>B(z)},z))]}),[p,B,c.menuItemActive]),Ie=(0,M.useMemo)(()=>(0,e.jsxs)(K.W,{children:[(0,e.jsx)(K.W.Item,{label:(0,x.t)("logs.logs-controls.download-logs.txt","txt"),onClick:()=>{v(Y.s.Text),(0,O.rR)("logs_log_list_controls_downloaded_logs",{format:Y.s.Text})}}),(0,e.jsx)(K.W.Item,{label:(0,x.t)("logs.logs-controls.download-logs.json","json"),onClick:()=>{v(Y.s.Json),(0,O.rR)("logs_log_list_controls_downloaded_logs",{format:Y.s.Json})}}),(0,e.jsx)(K.W.Item,{label:(0,x.t)("logs.logs-controls.download-logs.csv","csv"),onClick:()=>{v(Y.s.CSV),(0,O.rR)("logs_log_list_controls_downloaded_logs",{format:Y.s.CSV})}})]}),[v]),Be=b===P.Jk.Dashboard||b===P.Jk.PanelEditor||b===P.Jk.PanelViewer;return(0,e.jsxs)("div",{className:c.navContainer,children:[W==="logs"&&(0,e.jsx)(X.K,{name:"arrow-down",className:c.controlButton,variant:"secondary",onClick:xe,tooltip:(0,x.t)("logs.logs-controls.scroll-bottom","Scroll to bottom"),size:"lg"}),Be?(0,e.jsxs)(e.Fragment,{children:[ce.$.featureToggles.newLogsPanel&&(0,e.jsx)(X.K,{name:"search",className:re?c.controlButtonActive:c.controlButton,onClick:re?pe:le,tooltip:re?(0,x.t)("logs.logs-controls.hide-search","Close search"):(0,x.t)("logs.logs-controls.show-search","Search in logs result"),size:"lg"}),(0,e.jsx)(U.m,{overlay:Pe,placement:"auto-end",children:(0,e.jsx)(X.K,{name:"gf-logs",className:p&&p.length>0?c.controlButtonActive:c.controlButton,tooltip:(0,x.t)("logs.logs-controls.display-level","Display levels"),size:"lg"})}),W==="logs"&&j&&(0,e.jsx)(X.K,{name:"enter","aria-pressed":D,className:D?c.controlButtonActive:c.controlButton,onClick:l,tooltip:D?(0,x.t)("logs.logs-controls.remove-escaping","Remove escaping"):(0,x.t)("logs.logs-controls.escape-newlines","Fix incorrectly escaped newline and tab sequences in log lines"),size:"lg"})]}):(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(X.K,{name:w===$.uH.Descending?"sort-amount-up":"sort-amount-down",className:c.controlButton,onClick:be,tooltip:w===$.uH.Descending?(0,x.t)("logs.logs-controls.newest-first","Sorted by newest logs first - Click to show oldest first"):(0,x.t)("logs.logs-controls.oldest-first","Sorted by oldest logs first - Click to show newest first"),size:"lg"}),W==="logs"&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("div",{className:c.divider}),ce.$.featureToggles.newLogsPanel&&(0,e.jsx)(X.K,{name:"search",className:re?c.controlButtonActive:c.controlButton,onClick:re?pe:le,tooltip:re?(0,x.t)("logs.logs-controls.hide-search","Close search"):(0,x.t)("logs.logs-controls.show-search","Search in logs result"),size:"lg"}),(0,e.jsx)(U.m,{overlay:Ae,placement:"auto-end",children:(0,e.jsx)(X.K,{name:"filter",className:L!==$.fY.none?c.controlButtonActive:c.controlButton,tooltip:(0,x.t)("logs.logs-controls.deduplication","Deduplication"),size:"lg"})}),(0,e.jsx)(U.m,{overlay:Pe,placement:"auto-end",children:(0,e.jsx)(X.K,{name:"gf-logs",className:p&&p.length>0?c.controlButtonActive:c.controlButton,tooltip:(0,x.t)("logs.logs-controls.display-level","Display levels"),size:"lg"})}),(0,e.jsx)("div",{className:c.divider}),ce.$.featureToggles.newLogsPanel?(0,e.jsx)(he,{}):(0,e.jsx)(X.K,{name:"clock-nine","aria-pressed":u,className:u?c.controlButtonActive:c.controlButton,onClick:F,tooltip:u?(0,x.t)("logs.logs-controls.hide-timestamps","Hide timestamps"):(0,x.t)("logs.logs-controls.show-timestamps","Show timestamps"),size:"lg"}),g!==void 0&&b!==P.Jk.Unknown&&(0,e.jsx)(X.K,{name:"tag-alt","aria-pressed":g,className:g?c.controlButtonActive:c.controlButton,onClick:de,tooltip:g?(0,x.t)("logs.logs-controls.hide-unique-labels","Hide unique labels"):(0,x.t)("logs.logs-controls.show-unique-labels","Show unique labels"),size:"lg"}),ce.$.featureToggles.newLogsPanel?(0,e.jsx)(H,{}):(0,e.jsx)(X.K,{name:"wrap-text",className:N?c.controlButtonActive:c.controlButton,"aria-pressed":N,onClick:Qe,tooltip:N?(0,x.t)("logs.logs-controls.unwrap-lines","Unwrap lines"):(0,x.t)("logs.logs-controls.wrap-lines","Wrap lines"),size:"lg"}),Z!==void 0&&!ce.$.featureToggles.newLogsPanel&&(0,e.jsx)(X.K,{name:"brackets-curly","aria-pressed":Z,className:Z?c.controlButtonActive:c.controlButton,onClick:Se,tooltip:Z?(0,x.t)("logs.logs-controls.disable-prettify-json","Collapse JSON logs"):(0,x.t)("logs.logs-controls.prettify-json","Expand JSON logs"),size:"lg"}),k!==void 0&&(0,e.jsx)(X.K,{name:"brackets-curly",className:k?c.controlButtonActive:c.controlButton,"aria-pressed":k,onClick:We,tooltip:k?(0,x.t)("logs.logs-controls.disable-highlighting","Disable highlighting"):(0,x.t)("logs.logs-controls.enable-highlighting","Enable highlighting"),size:"lg"}),ce.$.featureToggles.newLogsPanel&&(0,e.jsx)(X.K,{name:"text-fields",className:n==="small"?c.controlButtonActive:c.controlButton,"aria-pressed":!!n,onClick:oe,tooltip:n==="default"?(0,x.t)("logs.logs-controls.font-size-default","Use small font size"):(0,x.t)("logs.logs-controls.font-size-small","Use default font size"),size:"lg"}),j&&(0,e.jsx)(X.K,{name:"enter","aria-pressed":D,className:D?c.controlButtonActive:c.controlButton,onClick:l,tooltip:D?(0,x.t)("logs.logs-controls.remove-escaping","Remove escaping"):(0,x.t)("logs.logs-controls.escape-newlines","Fix incorrectly escaped newline and tab sequences in log lines"),size:"lg"})]}),!ce.$.exploreHideLogsDownload&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("div",{className:c.divider}),(0,e.jsx)(U.m,{overlay:Ie,placement:"auto-end",children:(0,e.jsx)(X.K,{name:"download-alt",className:c.controlButton,tooltip:(0,x.t)("logs.logs-controls.download","Download logs"),size:"lg"})})]})]}),W==="logs"&&(0,e.jsx)(X.K,{name:"arrow-up","data-testid":"scrollToTop",className:c.scrollToTopButton,variant:"secondary",onClick:Te,tooltip:(0,x.t)("logs.logs-controls.scroll-top","Scroll to top"),size:"lg"})]})},he=()=>{const V=(0,y.of)(q),{setTimestampResolution:W,setShowTime:c,showTime:b,timestampResolution:L}=(0,ae.fl)(),v=(0,M.useCallback)(()=>{c(!1),(0,O.rR)("logs_log_list_controls_show_time_clicked",{show_time:!1})},[c]),p=(0,M.useCallback)(()=>{c(!0),W("ms"),(0,O.rR)("logs_log_list_controls_show_time_clicked",{show_time:!1,resolution:"ms"})},[c,W]),n=(0,M.useCallback)(()=>{c(!0),W("ns"),(0,O.rR)("logs_log_list_controls_show_time_clicked",{show_time:!1,resolution:"ns"})},[c,W]),D=(0,M.useMemo)(()=>(0,e.jsxs)(K.W,{children:[(0,e.jsx)(K.W.Item,{label:(0,x.t)("logs.logs-controls.timestamp.hide","Hide timestamps"),className:b?void 0:V.menuItemActive,onClick:v}),(0,e.jsx)(K.W.Item,{label:(0,x.t)("logs.logs-controls.timestamp.milliseconds","Show millisecond timestamps"),className:b&&L==="ms"?V.menuItemActive:void 0,onClick:p}),(0,e.jsx)(K.W.Item,{label:(0,x.t)("logs.logs-controls.timestamp.nanoseconds","Show nanosecond timestamps"),className:b&&L==="ns"?V.menuItemActive:void 0,onClick:n})]}),[v,p,n,b,V.menuItemActive,L]);return(0,e.jsx)(U.m,{overlay:D,placement:"auto-end",children:(0,e.jsx)("div",{children:(0,e.jsx)(ee.m,{content:(0,x.t)("logs.logs-controls.timestamp.label","Log timestamps"),children:(0,e.jsxs)("button",{"aria-pressed":b,"aria-label":(0,x.t)("logs.logs-controls.timestamp.label","Log timestamps"),className:`${V.customControlButton} ${b?V.controlButtonActive:V.controlButton}`,type:"button",children:[(0,e.jsx)(h.I,{name:"clock-nine",size:"lg",className:V.customControlIcon}),b&&(0,e.jsx)("span",{className:V.customControlTag,children:L==="ms"?(0,x.t)("logs.logs-controls.resolution-ms","ms"):(0,x.t)("logs.logs-controls.resolution-ns","ns")})]})})})})},H=()=>{const V=(0,y.of)(q),{prettifyJSON:W,setPrettifyJSON:c,setWrapLogMessage:b,wrapLogMessage:L}=(0,ae.fl)(),v=(0,M.useCallback)(()=>{b(!1),c(!1),(0,O.rR)("logs_log_list_controls_wrap_clicked",{state:!1,prettify:!1})},[c,b]),p=(0,M.useCallback)(()=>{b(!0),c(!1),(0,O.rR)("logs_log_list_controls_wrap_clicked",{state:!0,prettify:!1})},[c,b]),n=(0,M.useCallback)(()=>{b(!0),c(!0),(0,O.rR)("logs_log_list_controls_wrap_clicked",{state:!0,prettify:!0})},[c,b]),D=(0,M.useMemo)(()=>(0,e.jsxs)(K.W,{children:[(0,e.jsx)(K.W.Item,{label:(0,x.t)("logs.logs-controls.line-wrapping.hide","Disable line wrapping"),className:L?void 0:V.menuItemActive,onClick:v}),(0,e.jsx)(K.W.Item,{label:(0,x.t)("logs.logs-controls.line-wrapping.enable","Enable line wrapping"),className:L&&!W?V.menuItemActive:void 0,onClick:p}),(0,e.jsx)(K.W.Item,{label:(0,x.t)("logs.logs-controls.line-wrapping.enable-prettify","Enable line wrapping and prettify JSON"),className:L&&W?V.menuItemActive:void 0,onClick:n})]}),[v,W,V.menuItemActive,p,n,L]);return(0,e.jsx)(U.m,{overlay:D,placement:"auto-end",children:(0,e.jsx)("div",{children:(0,e.jsx)(ee.m,{content:(0,x.t)("logs.logs-controls.line-wrapping.label","Log line wrapping"),children:(0,e.jsxs)("button",{"aria-label":(0,x.t)("logs.logs-controls.line-wrapping.label","Log line wrapping"),"aria-pressed":L,className:`${V.customControlButton} ${L?V.controlButtonActive:V.controlButton}`,type:"button",children:[(0,e.jsx)(h.I,{name:"wrap-text",size:"lg",className:V.customControlIcon}),W&&(0,e.jsx)("span",{className:V.customControlTag,children:"+"})]})})})})},q=V=>({navContainer:(0,o.css)({maxHeight:"100%",display:"flex",gap:V.spacing(3),flexDirection:"column",justifyContent:"flex-start",width:V.spacing(4),paddingTop:V.spacing(.75),paddingLeft:V.spacing(1),borderLeft:`solid 1px ${V.colors.border.medium}`,overflow:"hidden",minWidth:V.spacing(4)}),scrollToTopButton:(0,o.css)({margin:0,marginTop:"auto",color:V.colors.text.secondary,height:V.spacing(2)}),controlButton:(0,o.css)({margin:0,color:V.colors.text.secondary,height:V.spacing(2)}),divider:(0,o.css)({borderTop:`solid 1px ${V.colors.border.medium}`,height:1,marginTop:V.spacing(-.25),marginBottom:V.spacing(-1.75)}),controlButtonActive:(0,o.css)({margin:0,color:V.colors.text.secondary,height:V.spacing(2),"&:after":{display:"block",content:'" "',position:"absolute",height:2,borderRadius:V.shape.radius.default,bottom:V.spacing(-1),backgroundImage:V.colors.gradients.brandHorizontal,width:"95%",opacity:1}}),menuItemActive:(0,o.css)({"&:before":{content:'""',position:"absolute",left:0,top:V.spacing(.5),height:`calc(100% - ${V.spacing(1)})`,width:"2px",backgroundColor:V.colors.warning.main}}),customControlButton:(0,o.css)({position:"relative",zIndex:0,margin:0,boxShadow:"none",border:"none",display:"flex",background:"transparent",justifyContent:"center",alignItems:"center",padding:0,overflow:"visible",width:"100%"}),customControlIcon:(0,o.css)({verticalAlign:"baseline"}),customControlTag:(0,o.css)({color:V.colors.primary.text,fontSize:10,position:"absolute",bottom:-4,right:1,lineHeight:"10px",backgroundColor:V.colors.background.primary,paddingLeft:2})})},95826:(ze,we,t)=>{t.d(we,{EF:()=>s,IQ:()=>o,Ln:()=>m,NS:()=>$,h5:()=>M});var e=t(55060),o=(P=>(P.Log="log",P.Metric="metric",P))(o||{}),m=(P=>(P.Aggregations="Aggregations",P.RangeFunctions="Range functions",P.Functions="Functions",P.Formats="Formats",P.LineFilters="Line filters",P.LabelFilters="Label filters",P.BinaryOps=`${e.T}`,P))(m||{}),s=(P=>(P.Json="json",P.Logfmt="logfmt",P.Regexp="regexp",P.Pattern="pattern",P.Unpack="unpack",P.LineFormat="line_format",P.LabelFormat="label_format",P.Decolorize="decolorize",P.Drop="drop",P.Keep="keep",P.Rate="rate",P.RateCounter="rate_counter",P.CountOverTime="count_over_time",P.SumOverTime="sum_over_time",P.AvgOverTime="avg_over_time",P.MaxOverTime="max_over_time",P.MinOverTime="min_over_time",P.FirstOverTime="first_over_time",P.LastOverTime="last_over_time",P.StdvarOverTime="stdvar_over_time",P.StddevOverTime="stddev_over_time",P.QuantileOverTime="quantile_over_time",P.BytesRate="bytes_rate",P.BytesOverTime="bytes_over_time",P.AbsentOverTime="absent_over_time",P.Sum="sum",P.Avg="avg",P.Min="min",P.Max="max",P.Stddev="stddev",P.Stdvar="stdvar",P.Count="count",P.TopK="topk",P.BottomK="bottomk",P.LineContains="__line_contains",P.LineContainsNot="__line_contains_not",P.LineContainsCaseInsensitive="__line_contains_case_insensitive",P.LineContainsNotCaseInsensitive="__line_contains_not_case_insensitive",P.LineMatchesRegex="__line_matches_regex",P.LineMatchesRegexNot="__line_matches_regex_not",P.LineFilterIpMatches="__line_filter_ip_matches",P.LabelFilter="__label_filter",P.LabelFilterNoErrors="__label_filter_no_errors",P.LabelFilterIpMatches="__label_filter_ip_marches",P.Unwrap="unwrap",P.SumBy="__sum_by",P.SumWithout="__sum_without",P.Addition="__addition",P.Subtraction="__subtraction",P.MultiplyBy="__multiply_by",P.DivideBy="__divide_by",P.Modulo="__modulo",P.Exponent="__exponent",P.NestedQuery="__nested_query",P.EqualTo="__equal_to",P.NotEqualTo="__not_equal_to",P.GreaterThan="__greater_than",P.LessThan="__less_than",P.GreaterOrEqual="__greater_or_equal",P.LessOrEqual="__less_or_equal",P))(s||{}),M=(P=>(P[P.LineFilters=1]="LineFilters",P[P.Parsers=2]="Parsers",P[P.PipeOperations=3]="PipeOperations",P[P.Unwrap=4]="Unwrap",P[P.NoErrors=5]="NoErrors",P[P.RangeVectorFunction=5]="RangeVectorFunction",P[P.Last=6]="Last",P))(M||{});const $={equals:{label:"=",value:"=",description:"Equals",isMultiValue:!1},doesNotEqual:{label:"!=",value:"!=",description:"Does not equal",isMultiValue:!1},matchesRegex:{label:"=~",value:"=~",description:"Matches regex",isMultiValue:!0},doesNotMatchRegex:{label:"!~",value:"!~",description:"Does not match regex",isMultiValue:!0},greaterThan:{label:">",value:">",description:"Greater than",isMultiValue:!1},greaterThanOrEqual:{label:">=",value:">=",description:"Greater than or equal to",isMultiValue:!1},lessThan:{label:"<",value:"<",description:"Less than",isMultiValue:!1},lessThanOrEqual:{label:"<=",value:"<=",description:"Less than or equal to",isMultiValue:!1},contains:{label:"|=",value:"|=",description:"Contains",isMultiValue:!1},doesNotContain:{label:"!=",value:"!=",description:"Does not contain",isMultiValue:!1}}},96195:(ze,we,t)=>{t.d(we,{gG:()=>j});var e=t(74848),o=t(22803),m=t(2543),s=t.n(m),M=t(96540),$=t(739),P=t(19379),I=t(78012),x=t(55386),ce=t(25229),O=t(1906),h=t(67770),X=t(28105),ee=t(92745),K=t(78282),U=t(43173),y=t(27489),Y=t(22787),ae=t(89599),Oe=t(45861),ne=t(41654),C=t(79233),_=t(43243),G=t(63142),he=t(35231),H=t(52763),q=t(37234),V=t(74746),W=t(17896),c=t(82212),b=t(284),L=t(82423),v=t(46464),p=t(55439);const n=100,D=72e5,j=(0,M.memo)(({log:i,logOptionsStorageKey:S,open:Q,sortOrder:J=S?I.M.get(`${S}.sortOrder`)??$.uH.Descending:$.uH.Descending,timeZone:R,getLogRowContextUi:r,getRowContextQuery:u,onClose:g,getRowContext:w,displayedFields:k=[],onClickShowField:N,onClickHideField:pe})=>{const re=(0,M.useRef)(null),[le,Te]=(0,M.useState)(null),[xe,l]=(0,M.useState)([]),[B,oe]=(0,M.useState)([]),[F,de]=(0,M.useState)(!1),be=(0,M.useMemo)(()=>[...xe,i,...B],[i,B,xe]),[Se,We]=(0,M.useState)(X.Gu.NotStarted),[Qe,Ae]=(0,M.useState)(X.Gu.NotStarted),[Pe,Ie]=(0,M.useState)(!1),[Be,z]=(0,M.useState)(null),Ee=S?I.M.get(`${S}.contextTimeWindow`)??D.toString():D.toString(),[te,Ce]=(0,M.useState)(parseInt(Ee,10)),me=(0,M.useRef)(new P.o),Le=(0,H.wA)(),_e=(0,G.$j)(),je=Z(_e),Me=(0,M.useMemo)(()=>{const Fe=J===$.uH.Ascending?be[0].timeEpochMs:be[be.length-1].timeEpochMs;let ke=J===$.uH.Ascending?be[be.length-1].timeEpochMs:be[0].timeEpochMs;Fe===ke&&(ke+=1);const Ye=(0,ce.KQ)(Fe),Ke=(0,ce.KQ)(ke);return{from:Ye,to:Ke,raw:{from:Ye,to:Ke}}},[be,J]),T=(0,M.useCallback)(async()=>{const Fe=u?await u(i):null;Te(Fe)},[i,u]);(0,M.useEffect)(()=>{Q&&(T(),(0,y.rR)("logs_log_line_context_open",{datasourceType:i.datasourceType,uid:i.uid}))},[T,Q,i]);const A=(0,M.useCallback)(async(Fe,ke,Ye)=>{const Ke=await w(f(ke),{limit:n,direction:E(Fe,J),timeWindowMs:Ye}),Je=(0,q.HT)(Ke.data).rows;return J===$.uH.Ascending&&Je.reverse(),Je.filter(tt=>!d(be,tt))},[be,w,J]),ge=(0,M.useCallback)(async(Fe,ke,Ye)=>{const Ke=Fe==="above"?We:Ae;Ke(X.Gu.Loading);try{const Je=(await A(Fe,ke,Ye)).map(Ve=>!Ve.searchWords||!Ve.searchWords?.length?{...Ve,searchWords:i.searchWords}:Ve),[tt,nt]=(0,m.partition)(Je,Ve=>Ve.timeEpochNs>i.timeEpochNs),et=J===$.uH.Ascending?nt:tt,qe=J===$.uH.Ascending?tt:nt;l(Ve=>et.length>0?(0,V.oR)([...et,...Ve],J):Ve),oe(Ve=>qe.length>0?(0,V.oR)([...Ve,...qe],J):Ve),Ke(X.Gu.NotStarted),!et.length&&Fe==="above"&&We(X.Gu.Done),!qe.length&&Fe==="below"&&Ae(X.Gu.Done)}catch{Ke(X.Gu.Error)}},[A,i,J]);(0,M.useEffect)(()=>{Q&&(F||(Promise.all([ge("above",i,te),ge("below",i,te)]),de(!0)))},[F,ge,i,Q,te]);const se=(0,M.useCallback)((Fe,ke)=>{ke===W.Dh.Bottom?ge("below",be[be.length-1]):ge("above",be[0])},[be,ge]),$e=(0,M.useCallback)(()=>{me.current.publish(new p._B({scrollTo:i.uid}))},[i.uid]),ie=(0,M.useCallback)(()=>{if(!le)return;let Fe=i.uid;i.dataFrame.refId&&(Fe=i.uid.replace(i.dataFrame.refId,le.refId)),Le((0,he.ve)({queries:[le],range:Me,datasourceUid:le.datasource.uid,panelsState:{logs:{id:Fe}}})),g(),(0,y.rR)("logs_log_line_context_open_in_split_clicked",{datasourceType:i.datasourceType})},[le,Le,i.dataFrame.refId,i.datasourceType,i.uid,g,Me]),fe=(0,M.useCallback)(Fe=>{S&&I.M.set(`${S}.contextTimeWindow`,Fe.value),Ce(parseInt(Fe.value,10)),l([]),oe([]),de(!1),(0,y.rR)("logs_log_line_context_time_window_change",{window_size:Fe.value})},[S]),ue=(0,M.useCallback)(()=>{(0,y.rR)("logs_log_line_context_closed",{datasourceType:i.datasourceType,uid:i.uid}),g()},[i.datasourceType,i.uid,g]),ve=(0,M.useCallback)(async()=>{l([]),oe([]),await T(),de(!1)},[T]),De=S?I.M.getBool(`${S}.wrapLogMessage`,!0):!0,Ne=S?I.M.getBool(`${S}.syntaxHighlighting`,!0):!0,Xe=(0,M.useMemo)(()=>i instanceof v.G?i:new v.G(i,{escape:!1,timeZone:R,wrapLogMessage:De}),[i,R,De]);return(0,M.useEffect)(()=>{i.datasourceUid&&(0,K.l)().get({uid:i.datasourceUid}).then(Fe=>{(0,h.Ol)(Fe)&&z(Fe)})},[i.datasourceUid]),(0,e.jsxs)(Y.a,{isOpen:Q,title:(0,ee.t)("logs.log-line-context.title-log-context","Log context"),contentClassName:je.flexColumn,className:je.modal,onDismiss:ue,children:[U.$.featureToggles.logsContextDatasourceUi&&r&&(0,e.jsx)("div",{children:r(i,ve)}),(0,e.jsx)(ae.S,{collapsible:!0,isOpen:Pe,onToggle:()=>Ie(!Pe),className:je.referenceLogLine,label:(0,ee.t)("logs.log-line-context.title-log-line","Referenced log line"),children:(0,e.jsx)(b.n,{log:Xe,syntaxHighlighting:Ne})}),(0,e.jsxs)("div",{className:je.controls,children:[Be?.supportsAdjustableWindow&&(0,e.jsxs)(ne.B,{children:[(0,e.jsx)(C.c,{htmlFor:"time-window-control",tooltip:(0,ee.t)("logs.log-line-context.time-window-tooltip","Amount of time before and after the referenced log"),width:"auto",children:(0,ee.t)("logs.log-line-context.time-window-label","Context time window")}),(0,e.jsx)(_.G,{id:"time-window-control",options:a(),onChange:fe,value:te.toString(),minWidth:5,width:"auto"})]}),(0,e.jsx)(Oe.$n,{variant:"secondary",onClick:$e,children:(0,e.jsx)(ee.x6,{i18nKey:"logs.log-line-context.center-matched-line",children:"Center matched line"})}),le?.datasource?.uid&&(0,e.jsx)(Oe.$n,{variant:"secondary",onClick:ie,children:(0,e.jsx)(ee.x6,{i18nKey:"logs.log-line-context.open-in-split-view",children:"Open in split view"})})]}),(0,e.jsxs)("div",{className:je.loadingIndicator,children:[Se===X.Gu.Loading&&(0,e.jsx)(c.I,{adjective:J===$.uH.Descending?(0,ee.t)("logs.log-line-context.newer-logs","newer"):(0,ee.t)("logs.log-line-context.older-logs","older")}),Se===X.Gu.Done&&(0,e.jsx)(ee.x6,{i18nKey:"logs.log-line-context.no-more-logs-available",children:"No more logs available."})]}),(0,e.jsx)("div",{className:je.wrapper,children:(0,e.jsx)("div",{className:je.logsContainer,ref:re,children:re.current&&(0,e.jsx)(L.Z,{app:O.Jk.Unknown,containerElement:re.current,dedupStrategy:$.fY.none,detailsMode:"inline",displayedFields:k,enableLogDetails:!0,eventBus:me.current,infiniteScrollMode:"unlimited",loadMore:se,logs:be,loading:Se===X.Gu.Loading||Qe===X.Gu.Loading,permalinkedLogId:i.uid,onClickHideField:pe,onClickShowField:N,showControls:!0,showTime:S?I.M.getBool(`${S}.showTime`,!0):!0,sortOrder:J,syntaxHighlighting:Ne,timeRange:Me,timeZone:R,wrapLogMessage:De})})}),(0,e.jsxs)("div",{className:je.loadingIndicator,children:[Qe===X.Gu.Loading&&(0,e.jsx)(c.I,{adjective:J===$.uH.Descending?(0,ee.t)("logs.log-line-context.older-logs","older"):(0,ee.t)("logs.log-line-context.newer-logs","newer")}),Qe===X.Gu.Done&&(0,e.jsx)(ee.x6,{i18nKey:"logs.log-line-context.no-more-logs-available",children:"No more logs available."})]})]})});j.displayName="LogLineContext";const Z=i=>({modal:(0,o.css)({width:"85vw",height:"80%",[i.breakpoints.down("md")]:{width:"100%",minHeight:"100%"},top:"50%",left:"50%",transform:"translate(-50%, -50%)"}),loadingIndicator:(0,o.css)({height:i.spacing(3),minHeight:i.spacing(3),textAlign:"center"}),referenceLogLine:(0,o.css)({flex:0}),wrapper:(0,o.css)({border:`1px solid ${i.colors.border.weak}`,padding:i.spacing(0,1,1,0),flex:"1 1 auto",minHeight:0}),logsContainer:(0,o.css)({height:"100%",overflow:"hidden"}),flexColumn:(0,o.css)({display:"flex",flexDirection:"column",padding:i.spacing(0,3,3,3),height:"100%",gap:i.spacing(.5)}),link:(0,o.css)({color:i.colors.text.secondary,fontSize:i.typography.bodySmall.fontSize,":hover":{color:i.colors.text.link}}),logPreview:(0,o.css)({overflow:"hidden",textAlign:"left",textOverflow:"ellipsis",width:"75vw",whiteSpace:"nowrap"}),controls:(0,o.css)({display:"flex",justifyContent:"flex-end",gap:i.spacing(2)})}),E=(i,S)=>i==="above"&&S===$.uH.Descending||i==="below"&&S===$.uH.Ascending?h.ZF.Forward:h.ZF.Backward,f=i=>({...i,dataFrame:{...i.dataFrame,refId:`context_${i.uid??i.dataFrame.refId??i.timeEpochMs}`}}),d=(i,S)=>i.some(Q=>Q.entry===S.entry&&Q.timeEpochNs===S.timeEpochNs);function a(){return[100,500,1e3,5e3,3e4,6e4,3e5,18e5,36e5,D].map(S=>({label:(0,x.cN)((0,x.j_)("ms")(S)),value:S.toString()}))}},96426:(ze,we,t)=>{t.d(we,{AA:()=>I,If:()=>P,Ql:()=>e,R1:()=>ce,qk:()=>M,rq:()=>x,xz:()=>m,z9:()=>o});const e=0;function o(h){return h.firstChild?o(h.firstChild):h}function m(h,X){return{text:I(h,X),from:X.from,to:X.to,parentType:X.parent?.name}}const s=/\$(\w+)|\[\[([\s\S]+?)(?::(\w+))?\]\]|\${(\w+)(?:\.([^:^\}]+))?(?::([^\}]+))?}/g;function M(h){return h.replace(s,(X,ee,K,U,y,Y,ae)=>{const Oe=U||ae;let ne=ee,C="0";return K&&(ne=K,C="1"),y&&(ne=y,C="2"),`__V_${C}__`+ne+"__V__"+(Oe?"__F__"+Oe+"__F__":"")})}const $=[(h,X)=>`$${h}`,(h,X)=>`[[${h}${X?`:${X}`:""}]]`,(h,X)=>`\${${h}${X?`:${X}`:""}}`];function P(h){return h.replace(/__V_(\d)__(.+?)__V__(?:__F__(\w+)__F__)?/g,(X,ee,K,U)=>$[parseInt(ee,10)](K,U))}function I(h,X){return X?P(h.substring(X.from,X.to)):""}function x(h,X,ee,K){const U=[parseFloat(I(X,ee))];return h.comparison&&U.push(K),{id:h.id,params:U}}function ce(h,X,ee){if(X.type.id===ee||X.name===ee)return[I(h,X)];const K=[];let U=0,y=X.childAfter(U);for(;y;)K.push(...ce(h,y,ee)),U=y.to,y=X.childAfter(U);return K}const O=h=>h.split(" ").map(ee=>`${ee}.*`).join("")},98102:(ze,we,t)=>{t.d(we,{P0:()=>q,Q5:()=>L,$f:()=>v});var e=t(74848),o=t(22803),m=t(96540),s=t(23257),M=t.n(s),$=t(84140),P=t(739),I=t(38388),x=t(92745),ce=t(45967),O=t(30703),h=t(45861),X=t(76487),ee=t(25461),K=t(24728),U=t(53622),y=t(87063),Y=t(88559),ae=t(76319),Oe=t(74746),ne=t(29457);const C=({log:n,styles:D})=>{const{enableLogDetails:j,detailsDisplayed:Z,getRowContextQuery:E,onOpenContext:f,onPermalinkClick:d,onPinLine:a,onUnpinLine:i,logLineMenuCustomItems:S=[],logSupportsContext:Q,toggleDetails:J,isAssistantAvailable:R,openAssistantByLog:r}=(0,ne.fl)(),u=(0,ne.u0)(n),g=(0,m.useRef)(null),w=(0,m.useCallback)(()=>{(0,Oe.Dk)(n.entry,g)},[n.entry]),k=(0,m.useCallback)(()=>{d?.(n)},[n,d]),N=(0,m.useMemo)(()=>Q?Q(n):!1,[n,Q]),pe=(0,m.useCallback)(async l=>{(0,Oe.R)(l,n,E,B=>f?.(B,()=>{}))},[f,E,n]),re=(0,m.useCallback)(()=>{J(n)},[n,J]),le=(0,m.useCallback)(()=>{u?i?.(n):a?.(n)},[n,a,i,u]),Te=j||N||a||i,xe=(0,m.useCallback)(()=>(0,e.jsxs)(y.W,{ref:g,children:[j&&(0,e.jsx)(y.W.Item,{onClick:re,label:Z(n)?(0,x.t)("logs.log-line-menu.show-details","Hide log details"):(0,x.t)("logs.log-line-menu.hide-details","Show log details")}),N&&(0,e.jsx)(y.W.Item,{onClick:pe,label:(0,x.t)("logs.log-line-menu.show-context","Show context")}),!u&&a&&(0,e.jsx)(y.W.Item,{onClick:le,label:(0,x.t)("logs.log-line-menu.pin-to-outline","Pin log")}),u&&i&&(0,e.jsx)(y.W.Item,{onClick:le,label:(0,x.t)("logs.log-line-menu.unpin-from-outline","Unpin log")}),Te&&(0,e.jsx)(y.W.Divider,{}),(0,e.jsx)(y.W.Item,{onClick:w,label:(0,x.t)("logs.log-line-menu.copy-log","Copy log line")}),d&&n.rowId!==void 0&&n.uid&&(0,e.jsx)(y.W.Item,{onClick:k,label:(0,x.t)("logs.log-line-menu.copy-link","Copy link to log line")}),S.map((l,B)=>_(l)?(0,e.jsx)(y.W.Divider,{},B):G(l)?(0,e.jsx)(y.W.Item,{onClick:()=>l.onClick(n),label:l.label},B):null),R&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(y.W.Divider,{}),(0,e.jsx)(y.W.Item,{onClick:()=>r?.(n),icon:"ai-sparkle",label:(0,x.t)("logs.log-line-menu.open-assistant","Explain log line in Assistant")})]})]}),[k,w,Z,j,R,n,S,d,a,i,r,u,N,pe,Te,re,le]);return(0,e.jsx)(Y.m,{overlay:xe,placement:"bottom-start",children:(0,e.jsx)(ae.K,{className:D.menuIcon,name:"ellipsis-v","aria-label":(0,x.t)("logs.log-line-menu.icon-label","Log menu"),role:"button"})})};function _(n){return"divider"in n&&n.divider}function G(n){return"onClick"in n&&"label"in n}var he=t(67897),H=t(55439);const q=({displayedFields:n,index:D,log:j,logs:Z,style:E,styles:f,onClick:d,onOverflow:a,showTime:i,timeRange:S,timeZone:Q,variant:J,virtualization:R,wrapLogMessage:r})=>(0,e.jsx)("div",{style:r?E:{...E,width:"max-content",minWidth:"100%"},children:(0,e.jsx)(V,{displayedFields:n,height:E.height,index:D,log:j,logs:Z,styles:f,onClick:d,onOverflow:a,showTime:i,timeRange:S,timeZone:Q,variant:J,virtualization:R,wrapLogMessage:r})}),V=(0,m.memo)(({displayedFields:n,height:D,index:j,log:Z,logs:E,styles:f,onClick:d,onOverflow:a,showTime:i,timeRange:S,timeZone:Q,variant:J,virtualization:R,wrapLogMessage:r})=>{const{detailsDisplayed:u,detailsMode:g,dedupStrategy:w,enableLogDetails:k,fontSize:N,hasLogsWithErrors:pe,hasSampledLogs:re,timestampResolution:le,onLogLineHover:Te}=(0,ne.fl)(),[xe,l]=(0,m.useState)(r&&Z.collapsed!==void 0?Z.collapsed:void 0),B=(0,m.useRef)(null),oe=(0,ne.u0)(Z),F=(0,ne.cQ)(Z);(0,m.useEffect)(()=>{if(!a||!B.current||!R||!D||!r)return;const Ae=typeof D=="number"?D:void 0,Pe=(0,H.SC)(R,B.current,Ae,Z.collapsed);Pe&&a(j,Z.uid,Pe)}),(0,m.useEffect)(()=>{r?(xe===void 0&&Z.collapsed!==void 0||xe!==void 0&&Z.collapsed===void 0)&&l(Z.collapsed):l(void 0)},[xe,Z.collapsed,r]);const de=(0,m.useCallback)(()=>Te?.(Z),[Z,Te]),be=(0,m.useCallback)(()=>{const Ae=!xe;Z.setCollapsedState(Ae),l(Ae),a?.(j,Z.uid)},[xe,j,Z,a]),Se=(0,m.useCallback)(Ae=>{p(Ae.target)&&d(Ae,Z)},[Z,d]),We=(0,m.useCallback)(()=>{if(!a||!B.current||!R)return;const Ae=(0,H.SC)(R,B.current,void 0,Z.collapsed);Ae&&a(j,Z.uid,Ae)},[j,Z.collapsed,Z.uid,a,R]),Qe=u(Z);return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsxs)("div",{className:`${f.logLine} ${J??""} ${oe?f.pinnedLogLine:""} ${F?f.permalinkedLogLine:""} ${Qe?f.detailsDisplayed:""} ${N==="small"?f.fontSizeSmall:""} ${k?f.clickable:""}`,ref:a?B:void 0,onMouseEnter:de,onFocus:de,onClick:Se,children:[(0,e.jsx)(C,{styles:f,log:Z}),w!==P.fY.none&&(0,e.jsx)("div",{className:`${f.duplicates}`,children:Z.duplicates&&Z.duplicates>0?`${Z.duplicates+1}x`:null}),pe&&(0,e.jsx)("div",{className:`${f.hasError}`,children:Z.hasError&&(0,e.jsx)(ce.m,{content:(0,x.t)("logs.log-line.tooltip-error","Error: {{errorMessage}}",{errorMessage:Z.errorMessage}),placement:"right",theme:"error",children:(0,e.jsx)(O.I,{className:f.logIconError,name:"exclamation-triangle","aria-label":(0,x.t)("logs.log-line.has-error","Has errors"),size:"xs"})})}),re&&(0,e.jsx)("div",{className:`${f.isSampled}`,children:Z.isSampled&&(0,e.jsx)(ce.m,{content:Z.sampledMessage??"",placement:"right",theme:"info",children:(0,e.jsx)(O.I,{className:f.logIconInfo,name:"info-circle",size:"xs","aria-label":(0,x.t)("logs.log-line.is-sampled","Is sampled")})})}),(0,e.jsx)("div",{className:`${f.fieldsWrapper} ${Qe?f.detailsDisplayed:""} ${r?f.wrappedLogLine:`${f.unwrappedLogLine} unwrapped-log-line`} ${xe===!0?f.collapsedLogLine:""}`,style:xe&&R?{maxHeight:`${R.getTruncationLineCount()*R.getLineHeight()}px`}:void 0,children:(0,e.jsx)(W,{collapsed:xe,displayedFields:n,log:Z,showTime:i,styles:f,timestampResolution:le,wrapLogMessage:r})})]}),xe===!0&&(0,e.jsx)("div",{className:f.expandCollapseControl,children:(0,e.jsx)(h.$n,{variant:"primary",fill:"text",size:"sm",className:f.expandCollapseControlButton,onClick:be,children:(0,x.t)("logs.log-line.show-more","show more")})}),xe===!1&&(0,e.jsx)("div",{className:f.expandCollapseControl,children:(0,e.jsx)(h.$n,{variant:"primary",fill:"text",size:"sm",className:f.expandCollapseControlButton,onClick:be,children:(0,x.t)("logs.log-line.show-less","show less")})}),g==="inline"&&Qe&&(0,e.jsx)(U.EO,{logs:E,log:Z,onResize:We,timeRange:S,timeZone:Q})]})});V.displayName="LogLineComponent";const W=(0,m.memo)(({displayedFields:n,log:D,showTime:j,styles:Z,timestampResolution:E,wrapLogMessage:f})=>(0,e.jsxs)(e.Fragment,{children:[j&&(0,e.jsx)("span",{className:`${Z.timestamp} level-${D.logLevel} field`,children:E==="ms"?D.timestamp:D.timestampNs}),(D.displayLevel||!f)&&(0,e.jsx)("span",{className:`${Z.level} level-${D.logLevel} field`,children:D.displayLevel}),n.length>0?(0,e.jsx)(c,{displayedFields:n,log:D,styles:Z}):(0,e.jsx)(b,{log:D,styles:Z})]}));W.displayName="Log";const c=({displayedFields:n,log:D,styles:j})=>{const{matchingUids:Z,search:E}=(0,he.fV)(),f=(0,m.useMemo)(()=>{const d=D.searchWords&&D.searchWords[0]?D.searchWords.slice():[];if(E&&Z?.includes(D.uid)&&d.push(E),!!d.length)return d},[D.searchWords,D.uid,Z,E]);return n.map(d=>d===X.I?(0,e.jsx)(b,{log:D,styles:j},d):(0,e.jsx)("span",{className:"field",title:d,children:f?(0,e.jsx)(M(),{textToHighlight:D.getDisplayedFieldValue(d),searchWords:f,findChunks:I.Oq,highlightClassName:j.matchHighLight}):D.getDisplayedFieldValue(d)},d))},b=({log:n,styles:D})=>{const{syntaxHighlighting:j}=(0,ne.fl)(),{matchingUids:Z,search:E}=(0,he.fV)(),f=(0,m.useMemo)(()=>{const d=j&&n.searchWords&&n.searchWords[0]?n.searchWords.slice():[];if(E&&Z?.includes(n.uid)&&d.push(E),!!d.length)return{searchWords:d,highlightClassName:D.matchHighLight}},[n.searchWords,n.uid,Z,E,D.matchHighLight,j]);return n.hasAnsi?(0,e.jsx)("span",{className:"field no-highlighting",children:(0,e.jsx)(ee.$,{value:n.body,highlight:f})}):j?(0,e.jsx)("span",{className:"field log-syntax-highlight",children:(0,e.jsx)(K.D,{log:n})}):f?(0,e.jsx)(M(),{textToHighlight:n.body,searchWords:f.searchWords,findChunks:I.Oq,highlightClassName:D.matchHighLight}):(0,e.jsx)("span",{className:"field no-highlighting",children:n.body})};function L(n,D){const j=n.map(E=>E.width).join("px "),Z=D.length>0?"":" 1fr";return`${j}px${Z}`}const v=(n,D)=>{const j={critical:"#B877D9",error:n.colors.error.text,warning:"#FBAD37",debug:"#6E9FFF",trace:"#6ed0e0",info:"#6CCF8E",metadata:n.colors.text.secondary,default:n.colors.text.primary,parsedField:n.colors.text.secondary},Z=(0,$.A)(n.colors.background.canvas).darken(5).toRgbString();return{logLine:(0,o.css)({color:j.default,display:"flex",gap:n.spacing(.5),flexDirection:"row",fontFamily:n.typography.fontFamilyMonospace,fontSize:n.typography.fontSize,lineHeight:n.typography.body.lineHeight,wordBreak:"break-all","&:hover":{background:Z},"&.infinite-scroll":{"&::before":{borderTop:`solid 1px ${n.colors.border.strong}`,content:'""',height:0,left:0,position:"absolute",top:-3,width:"100%"}},"& .log-syntax-highlight":{".log-token-string":{color:j.default},".log-token-duration":{color:n.colors.success.text},".log-token-size":{color:n.colors.success.text},".log-token-uuid":{color:n.colors.success.text},".log-token-key":{color:j.parsedField,fontWeight:n.typography.fontWeightMedium},".log-token-json-key":{color:j.parsedField,opacity:.9,fontWeight:n.typography.fontWeightMedium},".log-token-label":{color:j.metadata,fontWeight:n.typography.fontWeightBold},".log-token-method":{color:n.colors.info.shade},".log-search-match":{color:n.components.textHighlight.text,backgroundColor:n.components.textHighlight.background}},"& .no-highlighting":{color:n.colors.text.primary}}),matchHighLight:(0,o.css)({color:n.components.textHighlight.text,backgroundColor:n.components.textHighlight.background}),fontSizeSmall:(0,o.css)({fontSize:n.typography.bodySmall.fontSize,lineHeight:n.typography.bodySmall.lineHeight}),detailsDisplayed:(0,o.css)({background:(0,$.A)(n.colors.background.canvas).darken(2).toRgbString()}),pinnedLogLine:(0,o.css)({backgroundColor:(0,$.A)(n.colors.info.transparent).setAlpha(.25).toString()}),permalinkedLogLine:(0,o.css)({backgroundColor:(0,$.A)(n.colors.info.transparent).setAlpha(.25).toString()}),menuIcon:(0,o.css)({height:D?.getLineHeight()??H.Dj,margin:0,padding:n.spacing(0,0,0,.5)}),logLineMessage:(0,o.css)({fontFamily:n.typography.fontFamily,justifyContent:"center"}),timestamp:(0,o.css)({color:n.colors.text.disabled,display:"inline-block"}),duplicates:(0,o.css)({flexShrink:0,textAlign:"center",width:n.spacing(4.5)}),hasError:(0,o.css)({flexShrink:0,width:n.spacing(2),"& svg":{position:"relative",top:-1}}),isSampled:(0,o.css)({flexShrink:0,width:n.spacing(2),"& svg":{position:"relative",top:-1}}),logIconError:(0,o.css)({color:n.colors.warning.main}),logIconInfo:(0,o.css)({color:n.colors.info.main}),level:(0,o.css)({color:n.colors.text.secondary,fontWeight:n.typography.fontWeightBold,textTransform:"uppercase",display:"inline-block","&.level-critical":{color:j.critical},"&.level-error":{color:j.error},"&.level-warning":{color:j.warning},"&.level-info":{color:j.info},"&.level-debug":{color:j.debug}}),loadMoreButton:(0,o.css)({background:"transparent",border:"none",display:"inline"}),loadMoreTopContainer:(0,o.css)({backgroundColor:(0,$.A)(n.colors.background.primary).setAlpha(.75).toString(),left:0,position:"absolute",top:0,width:"100%",zIndex:n.zIndex.navbarFixed}),overflows:(0,o.css)({outline:"solid 1px red"}),clickable:(0,o.css)({cursor:"pointer"}),unwrappedLogLine:(0,o.css)({display:"grid",gridColumnGap:n.spacing(H.yb),whiteSpace:"pre",paddingBottom:n.spacing(.75)}),wrappedLogLine:(0,o.css)({alignSelf:"flex-start",paddingBottom:n.spacing(.75),whiteSpace:"pre-wrap","& .field":{marginRight:n.spacing(H.yb)},"& .field:last-child":{marginRight:0}}),fieldsWrapper:(0,o.css)({minHeight:D?D.getLineHeight()+D.getPaddingBottom():void 0,"&:hover":{background:Z}}),collapsedLogLine:(0,o.css)({overflow:"hidden"}),expandCollapseControl:(0,o.css)({display:"flex",justifyContent:"center"}),expandCollapseControlButton:(0,o.css)({fontWeight:n.typography.fontWeightLight,height:D?.getLineHeight()??H.Dj,margin:0})}};function p(n){return!(n instanceof HTMLButtonElement||n instanceof Element&&n.closest("button"))}}}]);

//# sourceMappingURL=3688.86d788020208b6e3d3e8.js.map