{"version":3,"file":"3003.4b94955d444cde3b1586.js","mappings":"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","sources":["webpack://grafana/./public/app/features/provisioning/hooks/useProvisionedFolderFormData.ts","webpack://grafana/./public/app/features/provisioning/components/Folders/DeleteProvisionedFolderForm.tsx","webpack://grafana/./public/app/features/browse-dashboards/components/FolderActionsButton.tsx","webpack://grafana/./public/app/features/provisioning/components/Shared/MoveActionAvailableTargetWarning.tsx","webpack://grafana/./public/app/features/browse-dashboards/components/BrowseActions/MoveModal.tsx","webpack://grafana/./public/app/features/browse-dashboards/components/BrowseActions/DeleteModal.tsx","webpack://grafana/./public/app/features/browse-dashboards/permissions.ts"],"sourcesContent":["import { useMemo } from 'react';\n\nimport { Folder } from 'app/api/clients/folder/v1beta1';\nimport { RepositoryView } from 'app/api/clients/provisioning/v0alpha1';\nimport { AnnoKeySourcePath } from 'app/features/apiserver/types';\nimport { getDefaultWorkflow, getWorkflowOptions } from 'app/features/provisioning/components/defaults';\nimport { useGetResourceRepositoryView } from 'app/features/provisioning/hooks/useGetResourceRepositoryView';\n\nimport { generateTimestamp } from '../components/utils/timestamp';\nimport { BaseProvisionedFormData } from '../types/form';\n\ninterface UseProvisionedFolderFormDataProps {\n  folderUid?: string;\n  title?: string;\n}\n\nexport interface ProvisionedFolderFormDataResult {\n  repository?: RepositoryView;\n  folder?: Folder;\n  workflowOptions: Array<{ label: string; value: string }>;\n  initialValues?: BaseProvisionedFormData;\n  isReadOnlyRepo: boolean;\n}\n\n/**\n * Hook for managing provisioned folder create/delete form data.\n */\nexport function useProvisionedFolderFormData({\n  folderUid,\n  title,\n}: UseProvisionedFolderFormDataProps): ProvisionedFolderFormDataResult {\n  const { repository, folder, isLoading, isReadOnlyRepo } = useGetResourceRepositoryView({ folderName: folderUid });\n\n  const timestamp = generateTimestamp();\n  const workflowOptions = getWorkflowOptions(repository);\n\n  const initialValues = useMemo(() => {\n    // Only create initial values when we have the data\n    if (!repository || isLoading) {\n      return undefined;\n    }\n    const defaultWorkflow = getDefaultWorkflow(repository);\n\n    return {\n      title: title || '',\n      comment: '',\n      ref: defaultWorkflow === 'branch' ? `folder/${timestamp}` : (repository?.branch ?? ''),\n      repo: repository.name || '',\n      path: folder?.metadata?.annotations?.[AnnoKeySourcePath] || '',\n      workflow: getDefaultWorkflow(repository),\n    };\n  }, [repository, isLoading, title, timestamp, folder?.metadata?.annotations]);\n\n  return {\n    repository,\n    folder,\n    workflowOptions,\n    initialValues,\n    isReadOnlyRepo,\n  };\n}\n","import { FormProvider, useForm } from 'react-hook-form';\nimport { useNavigate } from 'react-router-dom-v5-compat';\n\nimport { AppEvents } from '@grafana/data';\nimport { Trans, t } from '@grafana/i18n';\nimport { getAppEvents } from '@grafana/runtime';\nimport { Box, Button, Stack } from '@grafana/ui';\nimport { Folder } from 'app/api/clients/folder/v1beta1';\nimport { RepositoryView, useDeleteRepositoryFilesWithPathMutation } from 'app/api/clients/provisioning/v0alpha1';\nimport { AnnoKeySourcePath } from 'app/features/apiserver/types';\nimport { DescendantCount } from 'app/features/browse-dashboards/components/BrowseActions/DescendantCount';\nimport { getFolderURL } from 'app/features/browse-dashboards/components/utils';\nimport { FolderDTO } from 'app/types/folders';\n\nimport { useProvisionedFolderFormData } from '../../hooks/useProvisionedFolderFormData';\nimport { ProvisionedOperationInfo, useProvisionedRequestHandler } from '../../hooks/useProvisionedRequestHandler';\nimport { BaseProvisionedFormData } from '../../types/form';\nimport { buildResourceBranchRedirectUrl } from '../../utils/redirect';\nimport { RepoInvalidStateBanner } from '../Shared/RepoInvalidStateBanner';\nimport { ResourceEditFormSharedFields } from '../Shared/ResourceEditFormSharedFields';\n\ninterface FormProps extends DeleteProvisionedFolderFormProps {\n  initialValues: BaseProvisionedFormData;\n  repository?: RepositoryView;\n  workflowOptions: Array<{ label: string; value: string }>;\n  folder?: Folder;\n}\n\ninterface DeleteProvisionedFolderFormProps {\n  parentFolder?: FolderDTO;\n  onDismiss?: () => void;\n}\n\nfunction FormContent({ initialValues, parentFolder, repository, workflowOptions, folder, onDismiss }: FormProps) {\n  const resourceId = parentFolder?.uid || '';\n\n  const [deleteRepoFile, request] = useDeleteRepositoryFilesWithPathMutation();\n  const navigate = useNavigate();\n\n  const methods = useForm<BaseProvisionedFormData>({ defaultValues: initialValues });\n  const { handleSubmit, watch } = methods;\n  const workflow = watch('workflow');\n\n  const handleSubmitForm = async ({ repo, path, comment, ref }: BaseProvisionedFormData) => {\n    if (!repository?.name) {\n      return;\n    }\n\n    const commitMessage = comment || `Delete folder: ${folder?.metadata?.annotations?.[AnnoKeySourcePath]}`;\n    const targetRef = workflow === 'write' ? undefined : ref;\n\n    deleteRepoFile({\n      name: repo,\n      path: `${path}/`,\n      ref: targetRef,\n      message: commitMessage,\n    });\n  };\n\n  const onBranchSuccess = ({ urls }: { urls?: Record<string, string> }, info: ProvisionedOperationInfo) => {\n    const prUrl = urls?.newPullRequestURL;\n    if (prUrl) {\n      const url = buildResourceBranchRedirectUrl({\n        paramName: 'new_pull_request_url',\n        paramValue: prUrl,\n        repoType: info.repoType,\n      });\n      navigate(url);\n    }\n  };\n\n  const onWriteSuccess = () => {\n    // Navigate back to parent folder if it exists, otherwise go to dashboards root\n    if (parentFolder?.parentUid) {\n      window.location.href = getFolderURL(parentFolder.parentUid);\n    } else {\n      window.location.href = '/dashboards';\n    }\n  };\n\n  const onError = (error: unknown) => {\n    getAppEvents().publish({\n      type: AppEvents.alertError.name,\n      payload: [t('browse-dashboards.delete-provisioned-folder-form.api-error', 'Failed to delete folder'), error],\n    });\n  };\n\n  // Use the repository-type and resource-type aware provisioned request handler\n  useProvisionedRequestHandler({\n    request,\n    workflow,\n    successMessage: t(\n      'browse-dashboards.delete-provisioned-folder-form.success-message',\n      'Folder deleted successfully'\n    ),\n    resourceType: 'folder',\n    repository,\n    handlers: {\n      onDismiss,\n      onBranchSuccess,\n      onWriteSuccess,\n      onError,\n    },\n  });\n\n  return (\n    <FormProvider {...methods}>\n      <form onSubmit={handleSubmit(handleSubmitForm)}>\n        <Stack direction=\"column\" gap={2}>\n          <Box paddingBottom={2}>\n            <Trans i18nKey=\"browse-dashboards.delete-provisioned-folder-form.delete-warning\">\n              This will delete this folder and all its descendants. In total, this will affect:\n            </Trans>\n            <DescendantCount\n              selectedItems={{\n                folder: { [resourceId]: true },\n                dashboard: {},\n                panel: {},\n                $all: false,\n              }}\n            />\n          </Box>\n\n          <ResourceEditFormSharedFields\n            resourceType=\"folder\"\n            isNew={false}\n            workflow={workflow}\n            workflowOptions={workflowOptions}\n            repository={repository}\n          />\n\n          {/* Delete / Cancel button */}\n          <Stack gap={2}>\n            <Button variant=\"secondary\" fill=\"outline\" onClick={onDismiss}>\n              <Trans i18nKey=\"browse-dashboards.delete-provisioned-folder-form.button-cancel\">Cancel</Trans>\n            </Button>\n            <Button type=\"submit\" disabled={request.isLoading} variant=\"destructive\">\n              {request.isLoading\n                ? t('browse-dashboards.delete-provisioned-folder-form.button-deleting', 'Deleting...')\n                : t('browse-dashboards.delete-provisioned-folder-form.button-delete', 'Delete')}\n            </Button>\n          </Stack>\n        </Stack>\n      </form>\n    </FormProvider>\n  );\n}\n\nexport function DeleteProvisionedFolderForm({ parentFolder, onDismiss }: DeleteProvisionedFolderFormProps) {\n  const { workflowOptions, repository, folder, initialValues, isReadOnlyRepo } = useProvisionedFolderFormData({\n    folderUid: parentFolder?.uid,\n    title: parentFolder?.title,\n  });\n\n  if (isReadOnlyRepo || !initialValues) {\n    return (\n      <RepoInvalidStateBanner\n        noRepository={!initialValues}\n        isReadOnlyRepo={isReadOnlyRepo}\n        readOnlyMessage={t(\n          'browse-dashboards.delete-folder.read-only-message',\n          'To delete this folder, please remove the folder from your repository.'\n        )}\n      />\n    );\n  }\n\n  return (\n    <FormContent\n      parentFolder={parentFolder}\n      onDismiss={onDismiss}\n      initialValues={initialValues}\n      repository={repository}\n      workflowOptions={workflowOptions}\n      folder={folder}\n    />\n  );\n}\n","import { useState } from 'react';\n\nimport { AppEvents } from '@grafana/data';\nimport { Trans, t } from '@grafana/i18n';\nimport { locationService, reportInteraction } from '@grafana/runtime';\nimport { Button, Drawer, Dropdown, Icon, Menu, MenuItem } from '@grafana/ui';\nimport { Permissions } from 'app/core/components/AccessControl';\nimport { appEvents } from 'app/core/core';\nimport { RepoType } from 'app/features/provisioning/Wizard/types';\nimport { DeleteProvisionedFolderForm } from 'app/features/provisioning/components/Folders/DeleteProvisionedFolderForm';\nimport { getReadOnlyTooltipText } from 'app/features/provisioning/utils/repository';\nimport { ShowModalReactEvent } from 'app/types/events';\nimport { FolderDTO } from 'app/types/folders';\n\nimport { useDeleteFolderMutationFacade, useMoveFolderMutationFacade } from '../../../api/clients/folder/v1beta1/hooks';\nimport { ManagerKind } from '../../apiserver/types';\nimport { getFolderPermissions } from '../permissions';\n\nimport { DeleteModal } from './BrowseActions/DeleteModal';\nimport { MoveModal } from './BrowseActions/MoveModal';\n\ninterface Props {\n  folder: FolderDTO;\n  isReadOnlyRepo?: boolean;\n  repoType?: RepoType;\n}\n\nexport function FolderActionsButton({ folder, repoType, isReadOnlyRepo }: Props) {\n  const [isOpen, setIsOpen] = useState(false);\n  const [showPermissionsDrawer, setShowPermissionsDrawer] = useState(false);\n  const [showDeleteProvisionedFolderDrawer, setShowDeleteProvisionedFolderDrawer] = useState(false);\n  const [moveFolder] = useMoveFolderMutationFacade();\n\n  const deleteFolder = useDeleteFolderMutationFacade();\n\n  const { canEditFolders, canDeleteFolders, canViewPermissions, canSetPermissions } = getFolderPermissions(folder);\n  const isProvisionedFolder = folder.managedBy === ManagerKind.Repo;\n  // Can only move folders when the folder is not provisioned\n  const canMoveFolder = canEditFolders && !isProvisionedFolder;\n\n  const onMove = async (destinationUID: string) => {\n    await moveFolder({ folderUID: folder.uid, destinationUID: destinationUID });\n    reportInteraction('grafana_manage_dashboards_item_moved', {\n      item_counts: {\n        folder: 1,\n        dashboard: 0,\n      },\n      source: 'folder_actions',\n    });\n  };\n\n  const onDelete = async () => {\n    const result = await deleteFolder(folder);\n\n    if (result.error) {\n      appEvents.publish({\n        type: AppEvents.alertError.name,\n        payload: [\n          t(\n            'browse-dashboards.folder-actions-button.delete-folder-error',\n            'Error deleting folder. Please try again later.'\n          ),\n        ],\n      });\n      return;\n    }\n\n    reportInteraction('grafana_manage_dashboards_item_deleted', {\n      item_counts: {\n        folder: 1,\n        dashboard: 0,\n      },\n      source: 'folder_actions',\n    });\n    const { parents } = folder;\n    const parentUrl = parents && parents.length ? parents[parents.length - 1].url : '/dashboards';\n    locationService.push(parentUrl);\n  };\n\n  const showMoveModal = () => {\n    appEvents.publish(\n      new ShowModalReactEvent({\n        component: MoveModal,\n        props: {\n          selectedItems: {\n            folder: { [folder.uid]: true },\n            dashboard: {},\n            panel: {},\n            $all: false,\n          },\n          onConfirm: onMove,\n        },\n      })\n    );\n  };\n\n  const showDeleteModal = () => {\n    appEvents.publish(\n      new ShowModalReactEvent({\n        component: DeleteModal,\n        props: {\n          selectedItems: {\n            folder: { [folder.uid]: true },\n            dashboard: {},\n            panel: {},\n            $all: false,\n          },\n          onConfirm: onDelete,\n        },\n      })\n    );\n  };\n\n  const showDeleteProvisionedModal = () => {\n    setShowDeleteProvisionedFolderDrawer(true);\n  };\n\n  const managePermissionsLabel = t('browse-dashboards.folder-actions-button.manage-permissions', 'Manage permissions');\n  const moveLabel = t('browse-dashboards.folder-actions-button.move', 'Move');\n  const deleteLabel = t('browse-dashboards.folder-actions-button.delete', 'Delete');\n\n  const menu = (\n    <Menu>\n      {canViewPermissions && <MenuItem onClick={() => setShowPermissionsDrawer(true)} label={managePermissionsLabel} />}\n      {canMoveFolder && <MenuItem onClick={showMoveModal} label={moveLabel} />}\n      {canDeleteFolders && (\n        <MenuItem\n          destructive\n          onClick={isProvisionedFolder ? showDeleteProvisionedModal : showDeleteModal}\n          label={deleteLabel}\n        />\n      )}\n    </Menu>\n  );\n\n  if (!canViewPermissions && !canMoveFolder && !canDeleteFolders) {\n    return null;\n  }\n\n  return (\n    <>\n      <Dropdown overlay={menu} onVisibleChange={setIsOpen}>\n        <Button\n          variant=\"secondary\"\n          disabled={isReadOnlyRepo}\n          tooltip={isReadOnlyRepo ? getReadOnlyTooltipText({ isLocal: repoType === 'local' }) : undefined}\n        >\n          <Trans i18nKey=\"browse-dashboards.folder-actions-button.folder-actions\">Folder actions</Trans>\n          <Icon name={isOpen ? 'angle-up' : 'angle-down'} />\n        </Button>\n      </Dropdown>\n      {showPermissionsDrawer && (\n        <Drawer\n          title={t('browse-dashboards.action.manage-permissions-button', 'Manage permissions')}\n          subtitle={folder.title}\n          onClose={() => setShowPermissionsDrawer(false)}\n          size=\"md\"\n        >\n          <Permissions resource=\"folders\" resourceId={folder.uid} canSetPermissions={canSetPermissions} />\n        </Drawer>\n      )}\n      {showDeleteProvisionedFolderDrawer && (\n        <Drawer\n          title={t('browse-dashboards.action.delete-provisioned-folder', 'Delete provisioned folder')}\n          subtitle={folder.title}\n          onClose={() => setShowDeleteProvisionedFolderDrawer(false)}\n        >\n          <DeleteProvisionedFolderForm\n            parentFolder={folder}\n            onDismiss={() => setShowDeleteProvisionedFolderDrawer(false)}\n          />\n        </Drawer>\n      )}\n    </>\n  );\n}\n","import { t, Trans } from '@grafana/i18n';\nimport { Box, Icon, Tooltip } from '@grafana/ui';\n\nexport function MoveActionAvailableTargetWarning() {\n  return (\n    <Box>\n      <Trans i18nKey=\"browse-dashboards.bulk-move-resources-form.move-warning\">\n        This will move selected folders and their descendants. Available target folders depend on the selected\n        resources.\n      </Trans>\n      <Tooltip\n        content={t(\n          'browse-dashboards.bulk-move-resources-form.move-warning-tooltip',\n          'You can only move provisioned resources within their provisioned folder, and local resources to local folders.'\n        )}\n      >\n        <span style={{ marginLeft: '4px' }}>\n          <Icon name=\"info-circle\" size=\"sm\" />\n        </span>\n      </Tooltip>\n    </Box>\n  );\n}\n","import { useState } from 'react';\n\nimport { Trans, t } from '@grafana/i18n';\nimport { Alert, Button, Field, Modal, Text, Space, Box } from '@grafana/ui';\nimport { MoveActionAvailableTargetWarning } from 'app/features/provisioning/components/Shared/MoveActionAvailableTargetWarning';\nimport { ProvisioningAwareFolderPicker } from 'app/features/provisioning/components/Shared/ProvisioningAwareFolderPicker';\n\nimport { DashboardTreeSelection } from '../../types';\n\nimport { DescendantCount } from './DescendantCount';\n\nexport interface Props {\n  isOpen: boolean;\n  onConfirm: (targetFolderUid: string) => Promise<void>;\n  onDismiss: () => void;\n  selectedItems: DashboardTreeSelection;\n}\n\nexport const MoveModal = ({ onConfirm, onDismiss, selectedItems, ...props }: Props) => {\n  const [moveTarget, setMoveTarget] = useState<string>();\n  const [isMoving, setIsMoving] = useState(false);\n  const selectedFolders = Object.keys(selectedItems.folder).filter((uid) => selectedItems.folder[uid]);\n\n  const onMove = async () => {\n    if (moveTarget !== undefined) {\n      setIsMoving(true);\n      try {\n        await onConfirm(moveTarget);\n        setIsMoving(false);\n        onDismiss();\n      } catch {\n        setIsMoving(false);\n      }\n    }\n  };\n\n  return (\n    <Modal title={t('browse-dashboards.action.move-modal-title', 'Move')} onDismiss={onDismiss} {...props}>\n      {selectedFolders.length > 0 && (\n        <Alert\n          severity=\"info\"\n          title={t('browse-dashboards.action.move-modal-alert', 'Moving this item may change its permissions.')}\n        />\n      )}\n\n      <MoveActionAvailableTargetWarning />\n\n      <Box paddingTop={2}>\n        <Text element=\"p\">\n          <Trans i18nKey=\"browse-dashboards.action.move-modal-text\">This action will move the following content:</Trans>\n        </Text>\n\n        <DescendantCount selectedItems={selectedItems} />\n      </Box>\n\n      <Space v={3} />\n\n      <Field label={t('browse-dashboards.action.move-modal-field-label', 'Folder name')}>\n        <ProvisioningAwareFolderPicker\n          value={moveTarget}\n          excludeUIDs={selectedFolders}\n          onChange={setMoveTarget}\n          repositoryName={undefined} // is non-provisioned folder\n        />\n      </Field>\n\n      <Modal.ButtonRow>\n        <Button onClick={onDismiss} variant=\"secondary\" fill=\"outline\">\n          <Trans i18nKey=\"browse-dashboards.action.cancel-button\">Cancel</Trans>\n        </Button>\n        <Button disabled={moveTarget === undefined || isMoving} onClick={onMove} variant=\"primary\">\n          {isMoving\n            ? t('browse-dashboards.action.moving', 'Moving...')\n            : t('browse-dashboards.action.move-button', 'Move')}\n        </Button>\n      </Modal.ButtonRow>\n    </Modal>\n  );\n};\n","import { useState } from 'react';\n\nimport { Trans, t } from '@grafana/i18n';\nimport { config, reportInteraction } from '@grafana/runtime';\nimport { Alert, ConfirmModal, Text, Space } from '@grafana/ui';\n\nimport { useGetAffectedItemsQuery } from '../../api/browseDashboardsAPI';\nimport { DashboardTreeSelection } from '../../types';\n\nimport { DescendantCount } from './DescendantCount';\n\nexport interface Props {\n  isOpen: boolean;\n  onConfirm: () => Promise<void>;\n  onDismiss: () => void;\n  selectedItems: DashboardTreeSelection;\n}\n\nexport const DeleteModal = ({ onConfirm, onDismiss, selectedItems, ...props }: Props) => {\n  const { data } = useGetAffectedItemsQuery(selectedItems);\n  const deleteIsInvalid = Boolean(data && (data.alertRule || data.libraryPanel));\n  const [isDeleting, setIsDeleting] = useState(false);\n\n  const onDelete = async () => {\n    reportInteraction('grafana_manage_dashboards_delete_clicked', {\n      item_counts: {\n        dashboard: Object.keys(selectedItems.dashboard).length,\n        folder: Object.keys(selectedItems.folder).length,\n      },\n      source: 'browse_dashboards',\n      restore_enabled: Boolean(config.featureToggles.restoreDashboards),\n    });\n    setIsDeleting(true);\n    try {\n      await onConfirm();\n      setIsDeleting(false);\n      onDismiss();\n    } catch {\n      setIsDeleting(false);\n    }\n  };\n\n  return (\n    <ConfirmModal\n      body={\n        <>\n          {config.featureToggles.restoreDashboards && (\n            <>\n              <Text element=\"p\">\n                <Trans i18nKey=\"browse-dashboards.action.delete-modal-restore-dashboards-text\">\n                  This action will delete the selected folders immediately but the selected dashboards will be marked\n                  for deletion in 30 days. Your organization administrator can restore the dashboards anytime before the\n                  30 days expire. Folders cannot be restored.\n                </Trans>\n              </Text>\n              <Space v={2} />\n            </>\n          )}\n          <Text element=\"p\">\n            <Trans i18nKey=\"browse-dashboards.action.delete-modal-text\">\n              This action will delete the following content:\n            </Trans>\n          </Text>\n          <DescendantCount selectedItems={selectedItems} />\n          <Space v={2} />\n        </>\n      }\n      description={\n        <>\n          {deleteIsInvalid ? (\n            <Alert\n              severity=\"warning\"\n              title={t('browse-dashboards.action.delete-modal-invalid-title', 'Cannot delete folder')}\n            >\n              <Trans i18nKey=\"browse-dashboards.action.delete-modal-invalid-text\">\n                One or more folders contain library panels or alert rules. Delete these first in order to proceed.\n              </Trans>\n            </Alert>\n          ) : null}\n        </>\n      }\n      confirmationText={t('browse-dashboards.action.confirmation-text', 'Delete')}\n      confirmText={\n        isDeleting\n          ? t('browse-dashboards.action.deleting', 'Deleting...')\n          : t('browse-dashboards.action.delete-button', 'Delete')\n      }\n      onDismiss={onDismiss}\n      onConfirm={onDelete}\n      title={t('browse-dashboards.action.delete-modal-title', 'Delete')}\n      {...props}\n      disabled={deleteIsInvalid}\n    />\n  );\n};\n","import { contextSrv } from 'app/core/core';\nimport { AccessControlAction } from 'app/types/accessControl';\nimport { FolderDTO } from 'app/types/folders';\n\nfunction checkFolderPermission(action: AccessControlAction, folderDTO?: FolderDTO) {\n  return folderDTO ? contextSrv.hasPermissionInMetadata(action, folderDTO) : contextSrv.hasPermission(action);\n}\n\nfunction checkCanCreateFolders(folderDTO?: FolderDTO) {\n  return checkFolderPermission(AccessControlAction.FoldersCreate, folderDTO);\n}\n\nexport function getFolderPermissions(folderDTO?: FolderDTO) {\n  const canCreateDashboards = checkFolderPermission(AccessControlAction.DashboardsCreate, folderDTO);\n  const canCreateFolders = checkCanCreateFolders(folderDTO);\n  const canDeleteFolders = checkFolderPermission(AccessControlAction.FoldersDelete, folderDTO);\n  const canDeleteDashboards = checkFolderPermission(AccessControlAction.DashboardsDelete, folderDTO);\n  const canEditDashboards = checkFolderPermission(AccessControlAction.DashboardsWrite, folderDTO);\n  const canEditFolders = checkFolderPermission(AccessControlAction.FoldersWrite, folderDTO);\n  const canSetPermissions = checkFolderPermission(AccessControlAction.FoldersPermissionsWrite, folderDTO);\n  const canViewPermissions = checkFolderPermission(AccessControlAction.FoldersPermissionsRead, folderDTO);\n\n  return {\n    canCreateDashboards,\n    canCreateFolders,\n    canDeleteFolders,\n    canEditDashboards,\n    canEditFolders,\n    canSetPermissions,\n    canViewPermissions,\n    canDeleteDashboards,\n  };\n}\n"],"names":["useProvisionedFolderFormData","folderUid","title","repository","folder","isLoading","isReadOnlyRepo","timestamp","workflowOptions","initialValues","defaultWorkflow","FormContent","parentFolder","onDismiss","resourceId","deleteRepoFile","request","navigate","methods","handleSubmit","watch","workflow","handleSubmitForm","repo","path","comment","ref","commitMessage","targetRef","onBranchSuccess","urls","info","prUrl","url","onWriteSuccess","onError","error","useProvisionedRequestHandler","Stack","Box","DescendantCount","ResourceEditFormSharedFields","Button","DeleteProvisionedFolderForm","RepoInvalidStateBanner","FolderActionsButton","repoType","isOpen","setIsOpen","showPermissionsDrawer","setShowPermissionsDrawer","showDeleteProvisionedFolderDrawer","setShowDeleteProvisionedFolderDrawer","moveFolder","deleteFolder","canEditFolders","canDeleteFolders","canViewPermissions","canSetPermissions","isProvisionedFolder","canMoveFolder","onMove","destinationUID","onDelete","parents","parentUrl","showMoveModal","MoveModal","showDeleteModal","DeleteModal","showDeleteProvisionedModal","managePermissionsLabel","moveLabel","deleteLabel","menu","Menu","MenuItem","Dropdown","Icon","Drawer","MoveActionAvailableTargetWarning","onConfirm","selectedItems","props","moveTarget","setMoveTarget","isMoving","setIsMoving","selectedFolders","uid","data","deleteIsInvalid","isDeleting","setIsDeleting","checkFolderPermission","action","folderDTO","checkCanCreateFolders","getFolderPermissions","canCreateDashboards","canCreateFolders","canDeleteDashboards","canEditDashboards"],"sourceRoot":""}