"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[44,100,4312],{12266:(Y,E,a)=>{a.d(E,{e:()=>p});var t=a(74848),h=a(45861);const p=({isCollapsed:b,onToggle:g,idControlled:c,className:C,text:R,size:k="xl",...j})=>(0,t.jsx)(h.$n,{type:"button",fill:"text",variant:"secondary","aria-expanded":!b,"aria-controls":c,className:C,icon:b?"angle-right":"angle-down",onClick:()=>g(!b),...j,children:R})},31542:(Y,E,a)=>{a.r(E),a.d(E,{default:()=>c});var t=a(74848),h=a(88547),p=a(36826),b=a(90100);function g(){return(0,t.jsx)(p.d,{navId:"alerts-history",isLoading:!1,children:(0,t.jsx)(b.CentralAlertHistoryScene,{})})}const c=(0,h.S)(g)},90100:(Y,E,a)=>{a.r(E),a.d(E,{CentralAlertHistoryScene:()=>de,ClearFilterButtonObjectRenderer:()=>me,ClearFilterButtonScenesObject:()=>ge,LABELS_FILTER:()=>P,STATE_FILTER_FROM:()=>O,STATE_FILTER_TO:()=>B,default:()=>vt,getEventsScenesFlexItem:()=>ue});var t=a(74848),h=a(22803),p=a(96540),b=a(7389),g=a(92745),c=a(45863),C=a(739),R=a(45967),k=a(45861),j=a(63142),x=a(66404),D=a(30703),I=a(74268),ye=a(2863),fe=a(75421),ve=a(8535),W=a(59614),xe=a(54148),pe=a(49185),T=a(41654),q=a(34999),je=a(47327),Te=a(34213),_=a(36303),A=a(24619);let G=null;const Fe=e=>{if(!G)return null;const n=(0,_.Xc)(G,{title:(0,g.t)("alerting.ai.error-boundary.triage-button","AI Triage Button failed to load"),style:"alertbox",errorLogger:I.vV});return(0,p.createElement)(n,e)};function pt(e){G=e}var Ce=a(74048),H=a(86017),Se=a(52161),be=a(92367),Ee=a(7840),Re=a(12266),V=a(2543),Ie=a(44109),M=a(63895),Ae=a(94646),Le=a(1625),Ne=a(45746),Pe=a(88215),Be=a(50483),L=a(93571),Oe=a(68143),we=a(1506),$e=a(77256);function ee({error:e}){if((0,Oe.NF)(e)&&e.status===404)return(0,t.jsx)(we.L,{entity:"History"});const n=(0,g.t)("alerting.central-alert-history.error","Something went wrong loading the alert state history"),s=(0,$e.JZ)(e);return(0,t.jsx)(q.F,{title:n,children:s})}var N=a(95004),De=a(18600),He=a(33553),Ve=a(11576),te=a(92446);const f={all:"all",firing:"Alerting",normal:"Normal",pending:"Pending",recovering:"Recovering"},ne=10*1e3,J="var-";function se(e){const n=(0,M.Zc)(e),s={};return n.forEach(i=>{!i.isRegex&&i.isEqual&&(s[i.name]=i.value)}),s}const Me={labels:""};function Ue({data:e},n=Me){const[s=[],i=[]]=e?.values??[],l=((0,L.bF)(s)?s:[]).reduce((u,m,v)=>{const y=i[v];return(0,L.PA)(y)&&u.push({timestamp:m,line:y}),u},[]),o=(0,V.groupBy)(l,u=>JSON.stringify(u.line.labels)),d=Object.entries(o).map(([u,m])=>ze(u,m));return Ke(d,n)}function jt(){return new URLSearchParams(window.location.search).get(`${J}${LABELS_FILTER}`)??""}function Tt(){return new URLSearchParams(window.location.search).get(`${J}${STATE_FILTER_TO}`)??StateFilterValues.all}function Ft(){return new URLSearchParams(window.location.search).get(`${J}${STATE_FILTER_FROM}`)??StateFilterValues.all}function Ke(e,n){const s=n.labels,r=e.filter(u=>{const m=JSON.parse(u.name??""),v=s?(0,M.Zc)(s):[];return(0,H.Av)(m,v)}).flatMap(u=>u.fields.find(m=>m.name==="time")),l=(0,V.groupBy)(r?.flatMap(u=>u?.values),u=>Math.floor(u/ne)*ne),o={name:"time",type:N.PU.time,values:Object.keys(l).map(Number),config:{displayName:"Time",custom:{fillOpacity:100}}},d={name:"value",type:N.PU.number,values:Object.values(l).map(u=>u.length),config:{}};return[{fields:[o,d],length:o.values.length}]}function ze(e,n){const s={name:"time",type:N.PU.time,values:[...n.map(l=>l.timestamp)],config:{displayName:"Time",custom:{fillOpacity:100}}},i=s.values.map((l,o)=>o);return i.sort((0,te.i)(s)),{fields:[{...s,values:s.values.map((l,o)=>s.values[i[o]])},{name:e,type:N.PU.number,values:s.values.map(l=>1),config:{}}],length:s.values.length,name:e}}function We(e,n){const s={name:"time",type:N.PU.time,values:[...e.map(o=>o.timestamp),Date.now()],config:{displayName:"Time",custom:{fillOpacity:100}}},i=s.values.map((o,d)=>d);i.sort((0,te.i)(s));const r=[...e.map(o=>o.line.current),e.at(-1)?.line.current],l={fields:[{...s,values:s.values.map((o,d)=>s.values[i[d]])},{name:"State",type:N.PU.string,values:r.map((o,d)=>r[i[d]]),config:{displayName:"State",color:{mode:"thresholds"},custom:{fillOpacity:100},mappings:[{type:De.d.ValueToText,options:{Alerting:{color:n.colors.error.main},Pending:{color:n.colors.warning.main},Recovering:{color:n.colors.warning.main},Normal:{color:n.colors.success.main},NoData:{color:n.colors.info.main}}}],thresholds:{mode:He.O.Absolute,steps:[]}}}],length:s.values.length,name:""};return l.fields.forEach(o=>{o.display=(0,Ve.J)({field:o,theme:n})}),l}function Ge({record:e,addFilter:n,timeRange:s}){(0,p.useEffect)(()=>{(0,I.iW)()},[]);const i=e.line?.ruleUID??"",r=e.line?.labels,l=(0,p.useMemo)(()=>(0,Ae.qg)(i,!0),[i]),{error:o,loading:d,result:u}=(0,Ie.ZU)({ruleIdentifier:l,limitAlerts:0});return o?(0,t.jsx)(x.E,{children:(0,t.jsx)(g.x6,{i18nKey:"alerting.central-alert-history.details.error",children:"Error loading rule for this event."})}):d?(0,t.jsx)(x.E,{children:(0,t.jsx)(g.x6,{i18nKey:"alerting.central-alert-history.details.loading",children:"Loading..."})}):u?(0,t.jsxs)(T.B,{direction:"column",gap:.5,children:[(0,t.jsxs)(T.B,{direction:"row",gap:6,children:[(0,t.jsx)(Qe,{record:e,addFilter:n}),(0,t.jsx)(Ye,{record:e})]}),(0,t.jsx)(Xe,{rule:u}),(0,t.jsx)(Ze,{ruleUID:i,timeRange:s,labels:r??{}})]}):(0,t.jsx)(x.E,{children:(0,t.jsx)(g.x6,{i18nKey:"alerting.central-alert-history.details.not-found",children:"Rule not found for this event."})})}function Je(e,n){const s=(0,j.$j)();return(0,p.useMemo)(()=>{const i=n?.data?.values[0]??[],r=(0,L.bF)(i)?i:[],l=n?.data?.values[1]??[],o=r.reduce((y,S,F)=>{const w=l[F];return(0,L.PA)(w)&&y.push({timestamp:S,line:w}),y},[]),d=(0,V.groupBy)(o,y=>JSON.stringify(y.line.labels)),u=(0,M.Zc)(e),m=Object.entries(d).filter(([y])=>{const S=JSON.parse(y);return(0,H.Av)(S,u)});return{dataFrames:Object.values(m).map(y=>We(y[1],s))}},[n,e,s])}function Ze({ruleUID:e,timeRange:n,labels:s}){const{useGetRuleHistoryQuery:i}=W.U,{currentData:r,isLoading:l,isError:o,error:d}=i({ruleUid:e,from:n.from.unix(),to:n.to.unix(),limit:U},{refetchOnFocus:!0,refetchOnReconnect:!0}),{dataFrames:u}=Je(s?Object.entries(s).map(([S,F])=>`${S}=${F}`).join(","):"",r),{frameSubset:m,frameTimeRange:v}=(0,Be.useFrameSubset)(u);if(l)return(0,t.jsx)("div",{children:(0,t.jsx)(g.x6,{i18nKey:"alerting.central-alert-history.details.loading",children:"Loading..."})});if(o)return(0,t.jsx)(ee,{error:d});if(!m||m.length===0)return null;const y=u[0]?.fields[0]?.values?.length-1||0;return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(ke,{transitions:e?y:0}),(0,t.jsx)(Pe.A,{frames:m,timeRange:v})]})}function Qe({record:e,addFilter:n}){return(0,t.jsxs)(T.B,{gap:.5,direction:"column",children:[(0,t.jsx)(x.E,{variant:"body",weight:"light",color:"secondary",children:(0,t.jsx)(g.x6,{i18nKey:"alerting.central-alert-history.details.state-transitions",children:"State transition"})}),(0,t.jsxs)(T.B,{gap:.5,direction:"row",alignItems:"center",children:[(0,t.jsx)(K,{state:e.line.previous,showLabel:!0,addFilter:n,type:"from"}),(0,t.jsx)(D.I,{name:"arrow-right",size:"lg"}),(0,t.jsx)(K,{state:e.line.current,showLabel:!0,addFilter:n,type:"to"})]})]})}const Xe=({rule:e})=>{const n=(0,j.of)(re),s=e.annotations;return!s||Object.keys(s).length===0?null:(0,t.jsx)("div",{className:n.metadataWrapper,children:Object.entries(s).map(([i,r])=>{const l=(0,V.capitalize)(i);return(0,t.jsxs)(Le.P,{direction:"column",children:[l,(0,t.jsx)(Ne.$,{value:r})]},l)})})};function Ye({record:e}){const n=e?.line?.values?JSON.stringify(e.line.values):(0,g.t)("alerting.central-alert-history.details.no-values","No values");return(0,t.jsxs)(T.B,{gap:.5,direction:"column",children:[(0,t.jsx)(x.E,{variant:"body",weight:"light",color:"secondary",children:(0,t.jsx)(g.x6,{i18nKey:"alerting.central-alert-history.details.value-in-transition",children:"Value in transition"})}),(0,t.jsx)(T.B,{gap:.5,direction:"row",alignItems:"center",children:(0,t.jsx)(x.E,{variant:"body",weight:"light",children:n})})]})}function ke({transitions:e}){const n=(0,j.of)(re);return(0,t.jsxs)("div",{className:n.transitionsNumber,children:[(0,t.jsx)(x.E,{variant:"body",weight:"bold",color:"secondary",children:(0,t.jsx)(g.x6,{i18nKey:"alerting.central-alert-history.details.number-transitions",children:"State transitions for selected period:"})}),(0,t.jsx)(x.E,{variant:"body",weight:"light",children:e})]})}const re=e=>({metadataWrapper:(0,h.css)({display:"grid",gridTemplateColumns:"auto auto",rowGap:e.spacing(3),columnGap:e.spacing(12)}),transitionsNumber:(0,h.css)({display:"flex",flexDirection:"row",gap:e.spacing(.5),alignItems:"center",marginTop:e.spacing(1.5)})}),ae={labels:"",stateFrom:f.all,stateTo:f.all};function qe(e,n=ae){return(0,p.useMemo)(()=>_e(e,n),[n,e])}function _e(e,n=ae){const{labels:s,stateFrom:i=f.all,stateTo:r=f.all}=n;if(!e?.data)return{historyRecords:[]};const l=s?(0,M.Zc)(s):[],[o,d]=e.data.values;return{historyRecords:((0,L.bF)(o)?o:[]).reduce((v,y,S)=>{const F=d[S];if(!(0,L.PA)(F))return v;const w=F.labels&&(0,H.Av)(F.labels,l),Z=(0,A.lh)(F.current),Q=(0,A.lh)(F.previous),z=r!==f.all?r===Z:!0,X=i!==f.all?i===Q:!0;return w&&z&&X&&v.push({timestamp:y,line:F}),v},[])}}const U=5e3,et=100,ie=({timeRange:e,valueInLabelFilter:n,valueInStateToFilter:s,valueInStateFromFilter:i,addFilter:r,hideAlertRuleColumn:l})=>{const o=e?.from.unix(),d=e?.to.unix(),u=se(n.toString()),m=s.toString(),v=i.toString(),{data:y,isLoading:S,isError:F,error:w}=W.U.endpoints.getRuleHistory.useQuery({from:o,to:d,limit:U,labels:u,current:m!=="all"?m:void 0,previous:v!=="all"?v:void 0}),{historyRecords:Z}=qe(y,{labels:n.toString()}),Q=Z.sort((X,xt)=>xt.timestamp-X.timestamp);if(F)return(0,t.jsx)(ee,{error:w});const z=!S&&y?.data?.values?.[0]?.length===U;return z&&(0,I.Hs)({from:o,to:d}),(0,t.jsxs)(T.B,{direction:"column",gap:.5,children:[z&&(0,t.jsx)(q.F,{severity:"warning",title:(0,g.t)("alerting.central-alert-history.too-many-events.title","Unable to display all events"),children:(0,g.t)("alerting.central-alert-history.too-many-events.text","The selected time period has too many events to display. Displaying the latest 5000 events. Try using a shorter time period.")}),(0,t.jsx)(tt,{visible:S}),(0,t.jsx)(nt,{logRecords:Q,addFilter:r,timeRange:e,hideAlertRuleColumn:l})]})},tt=({visible:e=!1})=>{const[n,{width:s}]=(0,pe.A)();return(0,t.jsx)("div",{ref:n,children:e&&(0,t.jsx)(je.G,{width:s,"data-testid":"loading-bar"})})};function nt({logRecords:e,addFilter:n,timeRange:s,hideAlertRuleColumn:i}){const{page:r,pageItems:l,numberOfPages:o,onPageChange:d}=(0,Ce.W)(e,1,et),u=(0,j.of)($);return(0,t.jsxs)(T.B,{direction:"column",gap:0,children:[(0,t.jsxs)("div",{className:u.headerContainer,children:[(0,t.jsx)(st,{hideAlertRuleColumn:i}),(0,t.jsx)("div",{className:u.triageButtonContainer,children:(0,t.jsx)(Fe,{logRecords:e,timeRange:s})})]}),(0,t.jsx)("ul",{children:l.map(m=>(0,t.jsx)(rt,{record:m,addFilter:n,timeRange:s,hideAlertRuleColumn:i},m.timestamp+(m.line.fingerprint??"")))}),(0,t.jsx)(Te.d,{currentPage:r,numberOfPages:o,onNavigate:d,hideWhenSinglePage:!0})]})}function st({hideAlertRuleColumn:e}){const n=(0,j.of)($);return(0,t.jsxs)("div",{className:n.mainHeader,children:[(0,t.jsx)("div",{className:n.timeCol,children:(0,t.jsx)(x.E,{variant:"body",children:(0,t.jsx)(g.x6,{i18nKey:"alerting.central-alert-history.details.header.timestamp",children:"Timestamp"})})}),(0,t.jsx)("div",{className:n.transitionCol,children:(0,t.jsx)(x.E,{variant:"body",children:(0,t.jsx)(g.x6,{i18nKey:"alerting.central-alert-history.details.header.state",children:"State"})})}),!e&&(0,t.jsx)("div",{className:n.alertNameCol,children:(0,t.jsx)(x.E,{variant:"body",children:(0,t.jsx)(g.x6,{i18nKey:"alerting.central-alert-history.details.header.alert-rule",children:"Alert rule"})})}),(0,t.jsx)("div",{className:n.labelsCol,children:(0,t.jsx)(x.E,{variant:"body",children:(0,t.jsx)(g.x6,{i18nKey:"alerting.central-alert-history.details.header.instance",children:"Instance"})})})]})}function rt({record:e,addFilter:n,timeRange:s,hideAlertRuleColumn:i}){const r=(0,j.of)($),[l,o]=(0,p.useState)(!0);function d(u,m){n(u,m,"label")}return(0,t.jsxs)(T.B,{direction:"column",gap:0,children:[(0,t.jsxs)("div",{className:(0,h.cx)(r.header,l?r.collapsedHeader:r.notCollapsedHeader),"data-testid":"event-row-header",children:[(0,t.jsx)(Re.e,{size:"sm",className:r.collapseToggle,isCollapsed:l,onToggle:o}),(0,t.jsxs)(T.B,{gap:.5,direction:"row",alignItems:"center",children:[(0,t.jsx)("div",{className:r.timeCol,children:(0,t.jsx)(ot,{time:e.timestamp})}),(0,t.jsx)("div",{className:r.transitionCol,children:(0,t.jsx)(it,{previous:e.line.previous,current:e.line.current,addFilter:n})}),!i&&(0,t.jsx)("div",{className:r.alertNameCol,children:e.line.labels?(0,t.jsx)(at,{labels:e.line.labels,ruleUID:e.line.ruleUID}):null}),(0,t.jsx)("div",{className:r.labelsCol,children:(0,t.jsx)(Ee.m,{labels:e.line.labels??{},size:"xs",onClick:d})})]})]}),!l&&(0,t.jsx)("div",{className:r.expandedRow,children:(0,t.jsx)(Ge,{record:e,addFilter:n,timeRange:s})})]})}function at({labels:e,ruleUID:n}){const s=(0,j.of)($),{pathname:i,search:r}=(0,xe.zy)(),l=`${i}${r}`,o=e.alertname;if(!n)return(0,t.jsx)(x.E,{children:(0,t.jsx)(g.x6,{i18nKey:"alerting.central-alert-history.details.unknown-rule",children:"Unknown"})});const d=(0,be.G)(`/alerting/${Se.hY}/${n}/view`,{tab:"history",returnTo:l});return(0,t.jsx)(R.m,{content:o??"",children:(0,t.jsx)("a",{href:d,className:s.alertName,children:o})})}function it({previous:e,current:n,addFilter:s}){return(0,t.jsxs)(T.B,{gap:.5,direction:"row",children:[(0,t.jsx)(K,{state:e,addFilter:s,type:"from"}),(0,t.jsx)(D.I,{name:"arrow-right",size:"lg"}),(0,t.jsx)(K,{state:n,addFilter:s,type:"to"})]})}const oe=({iconName:e,iconColor:n,tooltipContent:s,labelText:i,showLabel:r})=>(0,t.jsx)(R.m,{content:s,placement:"top",children:(0,t.jsxs)(T.B,{gap:.5,direction:"row",alignItems:"center",children:[(0,t.jsx)(D.I,{name:e,size:"md",className:n}),r&&(0,t.jsx)(x.E,{variant:"body",weight:"light",children:i})]})});function K({state:e,showLabel:n=!1,addFilter:s,type:i}){const r=(0,j.of)($),l=(0,g.t)("alerting.central-alert-history.details.no-recognized-state","No recognized state");if(!(0,A.s1)(e)&&!(0,A.qr)(e))return(0,t.jsx)(oe,{iconName:"exclamation-triangle",tooltipContent:l,labelText:(0,t.jsx)(g.x6,{i18nKey:"alerting.central-alert-history.details.unknown-event-state",children:"Unknown"}),showLabel:n,iconColor:r.warningColor});const o=(0,A.lh)(e),d=(0,A.$k)(e),u={Normal:{iconName:"check-circle",iconColor:d?r.warningColor:r.normalColor,tooltipContent:d?`Normal (${d})`:"Normal",labelText:(0,t.jsx)(g.x6,{i18nKey:"alerting.central-alert-history.details.state.normal",children:"Normal"})},Alerting:{iconName:"exclamation-circle",iconColor:r.alertingColor,tooltipContent:"Alerting",labelText:(0,t.jsx)(g.x6,{i18nKey:"alerting.central-alert-history.details.state.alerting",children:"Alerting"})},NoData:{iconName:"exclamation-triangle",iconColor:r.warningColor,tooltipContent:"Insufficient data",labelText:(0,t.jsx)(g.x6,{i18nKey:"alerting.central-alert-history.details.state.no-data",children:"No data"})},Error:{iconName:"exclamation-circle",tooltipContent:"Error",iconColor:r.warningColor,labelText:(0,t.jsx)(g.x6,{i18nKey:"alerting.central-alert-history.details.state.error",children:"Error"})},Pending:{iconName:"circle",iconColor:r.warningColor,tooltipContent:d?`Pending (${d})`:"Pending",labelText:(0,t.jsx)(g.x6,{i18nKey:"alerting.central-alert-history.details.state.pending",children:"Pending"})},Recovering:{iconName:"circle",iconColor:r.warningColor,tooltipContent:d?`Recovering (${d})`:"Recovering",labelText:(0,t.jsx)(g.x6,{i18nKey:"alerting.central-alert-history.details.state.recovering",children:"Recovering"})}};function m(){s("state",o,i==="from"?"stateFrom":"stateTo")}const v=u[o]||{iconName:"exclamation-triangle",tooltipContent:"Unknown State"};return(0,t.jsx)("div",{onClick:m,onKeyDown:y=>{(y.key==="Enter"||y.key===" ")&&m()},className:r.state,role:"button",tabIndex:0,children:(0,t.jsx)(oe,{...v,showLabel:n})})}const ot=({time:e})=>{const s=new Date(e).toLocaleString("en-US",{month:"long",day:"numeric",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1});return(0,t.jsx)(x.E,{variant:"body",weight:"light",children:s})},Ct=(0,_.Xc)(ie,{style:"page"}),$=e=>({header:(0,h.css)({display:"flex",flexDirection:"row",alignItems:"center",padding:`${e.spacing(1)} ${e.spacing(1)} ${e.spacing(1)} 0`,flexWrap:"nowrap","&:hover":{backgroundColor:e.components.table.rowHoverBackground}}),collapsedHeader:(0,h.css)({borderBottom:`1px solid ${e.colors.border.weak}`}),notCollapsedHeader:(0,h.css)({borderBottom:"none"}),collapseToggle:(0,h.css)({background:"none",border:"none",marginTop:`-${e.spacing(1)}`,marginBottom:`-${e.spacing(1)}`,svg:{marginBottom:0}}),normalColor:(0,h.css)({fill:e.colors.success.text}),warningColor:(0,h.css)({fill:e.colors.warning.text}),alertingColor:(0,h.css)({fill:e.colors.error.text}),timeCol:(0,h.css)({width:"150px"}),transitionCol:(0,h.css)({width:"80px"}),alertNameCol:(0,h.css)({width:"300px"}),labelsCol:(0,h.css)({display:"flex",overflow:"hidden",alignItems:"center",paddingRight:e.spacing(2),flex:1}),alertName:(0,h.css)({whiteSpace:"nowrap",cursor:"pointer",overflow:"hidden",textOverflow:"ellipsis",display:"block",color:e.colors.text.link}),expandedRow:(0,h.css)({padding:e.spacing(2),marginLeft:e.spacing(2),borderLeft:`1px solid ${e.colors.border.weak}`}),colorIcon:(0,h.css)({color:e.colors.primary.text,"&:hover":{opacity:.8}}),state:(0,h.css)({"&:hover":{opacity:.8,cursor:"pointer"}}),mainHeader:(0,h.css)({display:"flex",flexDirection:"row",alignItems:"center",flexWrap:"nowrap",marginLeft:"30px",padding:`${e.spacing(1)} ${e.spacing(1)} ${e.spacing(1)} 0`,gap:e.spacing(.5)}),headerContainer:(0,h.css)({display:"flex",justifyContent:"space-between",alignItems:"center",borderBottom:`1px solid ${e.colors.border.weak}`}),triageButtonContainer:(0,h.css)({padding:`${e.spacing(1)} ${e.spacing(2)}`})});class lt extends c.Bs{constructor(){super(...arguments),this._variableDependency=new c.Sh(this,{variableNames:[P,O,B]})}static{this.Component=ct}}function ct({model:e}){const{hideAlertRuleColumn:n}=e.useState(),{value:s}=c.jh.getTimeRange(e).useState(),i=c.jh.lookupVariable(P,e),r=c.jh.lookupVariable(B,e),l=c.jh.lookupVariable(O,e),o=(d,u,m)=>{const v=`${d}=${u}`;if((0,I.P6)({type:m,key:d,value:u}),m==="stateTo"&&r instanceof c.yP&&r.changeValueTo(u),m==="stateFrom"&&l instanceof c.yP&&l.changeValueTo(u),m==="label"&&i instanceof c.TS){const y=(0,H.EU)(i.state.value.toString(),v);i.setValue(y)}};return r instanceof c.yP&&l instanceof c.yP&&i instanceof c.TS?(0,t.jsx)(ie,{timeRange:s,valueInLabelFilter:i.state.value,addFilter:o,valueInStateToFilter:r.state.value,valueInStateFromFilter:l.state.value,hideAlertRuleColumn:n}):null}const le="__history_api_ds_uid__",ce="__history_api_ds_pluginId__",dt={type:ce,uid:le,settings:void 0};function ut(){const e=(0,p.useMemo)(()=>new gt(le,ce),[]);(0,p.useEffect)(()=>{try{c.Go.registerRuntimeDataSource({dataSource:e})}catch{}},[e])}class gt extends c.UU{constructor(n,s){super(s,n)}async query(n){const s=n.range.from.unix(),i=n.range.to.unix(),r=n.targets[0],l=(0,ye.w)(),o=l.replace(r.labels??"",n.scopedVars),d=l.replace(r.stateTo??"",n.scopedVars),u=l.replace(r.stateFrom??"",n.scopedVars),m=se(o),v=await mt(s,i,m,d!=="all"?d:void 0,u!=="all"?u:void 0);return{data:Ue(v,{labels:o})}}testDatasource(){return Promise.resolve({status:"success",message:(0,g.t)("alerting.history-apidatasource.message.data-source-is-working","Data source is working"),title:(0,g.t)("alerting.history-apidatasource.title.success","Success")})}}const mt=(e,n,s,i,r)=>(0,ve.JD)(W.U.endpoints.getRuleHistory.initiate({from:e,to:n,limit:U,labels:s,current:i,previous:r},{forceRefetch:!!(0,fe.jG)().getAutoRefreshInteval().interval})).unwrap(),P="LABELS_FILTER",B="STATE_FILTER_TO",O="STATE_FILTER_FROM",de=({defaultLabelsFilter:e,defaultTimeRange:n={from:"now-1h",to:"now"},hideFilters:s,hideAlertRuleColumn:i}={})=>{(0,p.useEffect)(()=>{(0,I.fH)(I.le.loadedCentralAlertStateHistory)},[]),ut();const r=(0,p.useMemo)(()=>{const o=new c.TS({name:P,label:(0,g.t)("alerting.central-alert-history-scene.scene.labels-filter-variable.label.labels","Labels: "),...e&&{value:e}}),d=new c.yP({name:B,value:f.all,label:(0,g.t)("alerting.central-alert-history-scene.scene.transitions-to-filter-variable.label.end-state","End state:"),hide:b.zL.dontHide,query:`All : ${f.all}, To Firing : ${f.firing},To Normal : ${f.normal},To Pending : ${f.pending},To Recovering : ${f.recovering}`}),u=new c.yP({name:O,value:f.all,label:(0,g.t)("alerting.central-alert-history-scene.scene.transitions-from-filter-variable.label.start-state","Start state:"),hide:b.zL.dontHide,query:`All : ${f.all}, From Firing : ${f.firing},From Normal : ${f.normal},From Pending : ${f.pending},From Recovering : ${f.recovering}`});return new c.P1({controls:s?void 0:[new c.dM({component:yt}),new c.dM({component:ft}),new c.K8({}),new ge({}),new c.N0,new c.KE({}),new c.WM({})],$timeRange:new c.JZ(n),$variables:new c.Pj({variables:[o,u,d]}),body:new c.G1({direction:"column",children:[ue(),new c.vA({body:new lt({hideAlertRuleColumn:i})})]})})},[e,n,s,i]);return(0,c.Yg)(r)?(0,t.jsx)(r.Component,{model:r}):null};function ht(){return new c.dt({datasource:dt,queries:[{refId:"A",labels:"${LABELS_FILTER}",stateFrom:"${STATE_FILTER_FROM}",stateTo:"${STATE_FILTER_TO}"}]})}function ue(){return new c.vA({minHeight:300,ySizing:"content",body:c.d0.timeseries().setTitle("Alert Events").setDescription("Each alert event represents an alert instance that changed its state at a particular point in time. The history of the data is displayed over a period of time.").setData(ht()).setColor({mode:"continuous-BlPu"}).setCustomFieldConfig("fillOpacity",100).setCustomFieldConfig("drawStyle",C.GR.Bars).setCustomFieldConfig("lineInterpolation",C.dx.Linear).setCustomFieldConfig("lineWidth",1).setCustomFieldConfig("barAlignment",0).setCustomFieldConfig("spanNulls",!1).setCustomFieldConfig("insertNulls",!1).setCustomFieldConfig("showPoints",C.yL.Auto).setCustomFieldConfig("pointSize",5).setCustomFieldConfig("stacking",{mode:C.gs.None,group:"A"}).setCustomFieldConfig("gradientMode",C.on.Hue).setCustomFieldConfig("scaleDistribution",{type:C.L4.Linear}).setOption("legend",{showLegend:!1,displayMode:C.lm.Hidden}).setOption("tooltip",{mode:C.$N.Single}).setNoValue("No events found").build()})}class ge extends c.Bs{constructor(){super(...arguments),this._variableDependency=new c.Sh(this,{variableNames:[P,O,B]})}static{this.Component=me}}function me({model:e}){e.useState();const n=c.jh.interpolate(e,"${LABELS_FILTER}"),s=c.jh.interpolate(e,"${STATE_FILTER_TO}"),i=c.jh.interpolate(e,"${STATE_FILTER_FROM}");if(!n&&s===f.all&&i===f.all)return null;const r=()=>{const l=c.jh.lookupVariable(P,e);l instanceof c.TS&&l.setValue("");const o=c.jh.lookupVariable(B,e);o instanceof c.yP&&o.changeValueTo(f.all);const d=c.jh.lookupVariable(O,e);d instanceof c.yP&&d.changeValueTo(f.all)};return(0,t.jsx)(R.m,{content:(0,g.t)("alerting.clear-filter-button-object-renderer.content-clear-filter","Clear filter"),children:(0,t.jsx)(k.$n,{variant:"secondary",icon:"times",onClick:r,children:(0,t.jsx)(g.x6,{i18nKey:"alerting.central-alert-history.filter.clear",children:"Clear filters"})})})}const yt=()=>{const e=(0,j.of)(he);return(0,t.jsx)("div",{className:e.filterLabelContainer,children:(0,t.jsx)(x.E,{variant:"body",weight:"light",color:"secondary",children:(0,t.jsx)(g.x6,{i18nKey:"alerting.central-alert-history.filterBy",children:"Filter by:"})})})},ft=()=>{const e=(0,j.of)(he);return(0,t.jsx)("div",{className:e.filterInfoContainer,children:(0,t.jsx)(R.m,{content:(0,t.jsxs)("div",{children:[(0,t.jsx)(g.x6,{i18nKey:"alerting.central-alert-history.filter.info.label1",children:"Filter events using label querying without spaces, ex:"}),(0,t.jsx)("pre",{children:'{severity="critical", instance=~"cluster-us-.+"}'}),(0,t.jsx)(g.x6,{i18nKey:"alerting.central-alert-history.filter.info.label2",children:"Invalid use of spaces:"}),(0,t.jsx)("pre",{children:'{severity= "critical"}'}),(0,t.jsx)("pre",{children:'{severity ="critical"}'}),(0,t.jsx)(g.x6,{i18nKey:"alerting.central-alert-history.filter.info.label3",children:"Valid use of spaces:"}),(0,t.jsx)("pre",{children:'{severity=" critical"}'}),(0,t.jsx)(g.x6,{i18nKey:"alerting.central-alert-history.filter.info.label4",children:"Filter alerts using label querying without braces, ex:"}),(0,t.jsx)("pre",{children:'severity="critical", instance=~"cluster-us-.+"'})]}),children:(0,t.jsx)(D.I,{name:"info-circle",size:"sm"})})})},he=e=>({filterInfoContainer:(0,h.css)({padding:"0",alignSelf:"center",marginRight:e.spacing(-1)}),filterLabelContainer:(0,h.css)({padding:"0",alignSelf:"center"})}),vt=de}}]);

//# sourceMappingURL=HistoryPage.a891238c1f139af7fcce.js.map