{"version":3,"file":"FolderAlerting.ef3a68c9bd17b948770e.js","mappings":"4cAyBKA,GAAAA,IACHA,EAAA,UAAY,YACZA,EAAA,WAAa,aAFVA,IAAAA,GAAA,IAKL,MAAMC,EAAiD,CACrD,CAAE,MAAO,uBAAwB,MAAO,WAAoB,EAC5D,CAAE,MAAO,uBAAwB,MAAO,YAAqB,CAC/D,EAEaC,EAAmB,CAAC,CAAE,OAAAC,EAAQ,MAAAC,CAAM,IAAa,CAC5D,MAAMC,KAAS,MAAWC,EAAS,EAE7BC,EAAcC,GAAoB,CACtC,MAAMC,KAAiB,MAAsBC,EAAaF,CAAO,EACjEG,EAAeF,CAAc,CAC/B,EAEM,CAAE,WAAAG,EAAY,YAAAF,EAAa,UAAAG,EAAW,cAAAC,EAAe,eAAAH,EAAgB,aAAAI,CAAa,EACtFC,EAA0B,EAEtBC,EAAgBC,EAAmBd,EAAOQ,EAAYF,EAAaG,GAAa,WAAmB,EACnGM,EAAeF,EAAc,SAAW,EAExC,CAAE,KAAAG,EAAM,cAAAC,EAAe,aAAAC,EAAc,UAAAC,EAAU,KAAIC,EAAA,GAAcP,EAAe,EAAG,IAA2B,EAEpH,SACE,OAAC,OAAI,UAAWZ,EAAO,UACrB,oBAACoB,EAAA,EAAK,CAAC,UAAU,SAAS,IAAK,EAC7B,oBAACC,EAAA,GACC,MAAOd,EACP,SAAUE,EACV,eAAa,KACX,iFACA,4BACF,EACA,cAAY,cACd,KACA,QAACW,EAAA,EAAK,CAAC,UAAU,MACf,oBAACE,EAAA,IACC,MAAOd,EACP,SAAU,CAAC,CAAE,MAAAe,CAAM,IAAMA,GAASb,EAAaa,CAAK,EACpD,QAAS3B,EACT,MAAO,GACP,gBAAY,KAAE,8CAA+C,MAAM,EACnE,eAAa,KAAE,0DAA2D,oBAAoB,EAC9F,UAAQ,OAAC4B,EAAA,EAAI,CAAC,KAAMhB,IAAc,YAAsB,iBAAmB,mBAAoB,EACjG,KACA,OAACa,EAAA,GACC,MAAOhB,EACP,SAAUC,EACV,eAAa,KACX,+EACA,yBACF,EACA,UAAWN,EAAO,kBAClB,cAAY,eACd,GACF,KAEA,OAACoB,EAAA,EAAK,CAAC,UAAU,SAAS,IAAK,EAC5B,SAAAF,GAAU,IAAI,CAAC,CAAE,cAAAO,EAAe,OAAAC,EAAS,CAAC,CAAE,OAC3C,QAACC,EAAA,GAEC,KAAMC,EAA0BH,CAAa,EAC7C,UAAWzB,EAAO,KAClB,cAAY,iBAEZ,oBAAC2B,EAAA,EAAK,QAAL,CAAc,SAAAF,EAAc,MAAM,KACnC,OAACE,EAAA,EAAK,KAAL,CACC,mBAACE,EAAA,GACC,QAAS3B,EACT,KAAM,OAAO,QAAQwB,CAAM,EAAE,IAAI,CAAC,CAACI,GAAOP,EAAK,IAAM,GAAGO,EAAK,IAAIP,EAAK,EAAE,EAC1E,EACF,KACA,OAACI,EAAA,EAAK,KAAL,CACC,oBAAC,OACC,oBAACH,EAAA,EAAI,CAAC,KAAK,QAAS,GAAE,IAAE1B,EAAO,OACjC,EACF,IAhBK2B,EAAc,GAiBrB,CACD,EACH,EACCX,MACC,OAAC,OAAI,UAAWd,EAAO,UACrB,mBAAC,KAAK,CAAC,QAAQ,mDAAmD,gCAAoB,EACxF,KAEF,OAAC,OAAI,UAAWA,EAAO,WACrB,mBAAC+B,EAAA,GACC,YAAahB,EACb,cAAAC,EACA,WAAYC,EACZ,mBAAoB,GACtB,EACF,GACF,EACF,CAEJ,EAEA,IAAKe,GAAAA,IACHA,EAAA,WAAa,aACbA,EAAA,YAAc,cACdA,EAAA,UAAY,OAHTA,IAAAA,GAAA,IAML,SAASrB,GAA4B,CACnC,KAAM,CAACsB,EAAcC,CAAe,KAAIC,EAAA,GAAmB,EAErD,CAAC5B,EAAYE,CAAa,KAAI,YAASwB,EAAa,IAAI,YAAgC,GAAK,EAAE,EAC/F,CAAC5B,EAAaC,CAAc,KAAI,YAAS2B,EAAa,IAAI,aAAiC,GAAK,EAAE,EAElGG,EAAYH,EAAa,IAAI,MAA+B,EAC5DI,GAAoB,IAAM,CAC9B,GAAID,IAAc,YAChB,MAAO,YAET,GAAIA,IAAc,aAChB,MAAO,YAGX,GAAG,EACG,CAAC5B,EAAWE,CAAY,KAAI,YAAgC2B,CAAgB,EAElF,SAAAC,EAAA,GACE,IACEJ,EACE,CACG,cAAmC,MAAmB3B,CAAU,EAChE,eAAoC,MAAmBF,CAAW,EAClE,QAAkC,MAAmBG,CAAS,CACjE,EACA,EACF,EACF,IACA,CAACD,EAAYF,EAAaG,CAAS,CACrC,EAEO,CAAE,WAAAD,EAAY,YAAAF,EAAa,UAAAG,EAAW,cAAAC,EAAe,eAAAH,EAAgB,aAAAI,CAAa,CAC3F,CAEA,SAASG,EACP0B,EACAhC,EACAF,EACAG,EACA,CACA,MAAMgC,KAAW,MAAiCnC,CAAW,EACvDN,EAAQwC,EAAc,OAAQE,GAAS,CAC3C,MAAMC,EAAYD,EAAK,cAAc,MAAM,YAAY,EAAE,SAASlC,EAAW,YAAY,CAAC,EACpFoC,KAAa,MAAoBF,EAAK,QAAU,CAAC,EAAGD,CAAQ,EAClE,OAAOE,GAAaC,CACtB,CAAC,EAED,SAAO,WAAQ5C,EAAQ0C,GAASA,EAAK,cAAc,MAAM,YAAY,EAAG,CACtEjC,IAAc,YAAsB,MAAQ,MAC9C,CAAC,CACH,CAEA,SAASoB,EAA0BgB,EAA+C,CAChF,OAAO,KAAS,gBACd,KACA,CACE,IAAKA,EAAe,IACpB,eAAgB,IAClB,EACA,MACF,CACF,CAEO,MAAM3C,GAAa4C,IAA0B,CAClD,aAAW,OAAI,CACb,QAASA,EAAM,QAAQ,CAAC,CAC1B,CAAC,EACD,QAAM,OAAI,CACR,oBAAqB,eACrB,OAAQ,CACV,CAAC,EACD,cAAY,OAAI,CACd,UAAW,QACb,CAAC,EACD,qBAAmB,OAAI,CACrB,KAAM,EACN,MAAO,OACP,SAAU,OACZ,CAAC,EACD,aAAW,OAAI,CACb,QAASA,EAAM,QAAQ,CAAC,EACxB,gBAAiBA,EAAM,OAAO,WAAW,UACzC,UAAW,QACb,CAAC,CACH,G,gECxMA,KAAM,CAAE,uBAAAC,EAAuB,EAAIC,GAAA,GAE5B,SAASC,GAA2B,CACzC,KAAM,CAAE,IAAKC,EAAY,EAAG,KAAI,KAAU,EACpC,CAAE,KAAMC,EAAW,UAAWC,CAAgB,KAAI,MAAwBF,CAAS,EAEnF,CACJ,KAAMG,EAAiB,CAAC,EACxB,UAAWC,EACX,MAAOC,CACT,EAAIR,GAAuB,CACzB,YAAa,KACb,UAAWG,CACb,CAAC,EAEK,CAACM,CAAU,KAAI,MAAgB,EAE/BC,KAAW,WAAQ,IAAM,CAC7B,GAAI,CAACN,EACH,OAEF,MAAMO,KAAQ,MAAcP,CAAS,EAG/BQ,KAAgB,MAAiBR,EAAU,GAAG,EAC9CS,EAAcF,EAAM,UAAU,KAAMG,GAAUA,EAAM,KAAOF,CAAa,EAC9E,OAAIC,IACFA,EAAY,OAAS,IAEhBF,CACT,EAAG,CAACP,CAAS,CAAC,EAERW,EAAcZ,EAChB,MAAOa,GAAqB,CAC1B,GAAIZ,EAAW,CACb,MAAMa,EAAS,MAAMR,EAAW,CAC9B,GAAGL,EACH,MAAOY,CACT,CAAC,EACD,GAAI,UAAWC,EACb,MAAMA,EAAO,KAEjB,CACF,EACA,OAEEC,EAAYb,GAAmBE,EAC/BY,EAAc,OAAO,OAAOb,CAAc,EAC7C,QAASc,GAAUA,CAAK,EACxB,QAASA,GAAUA,EAAM,KAAK,EAC9B,OAAO,KAAc,QAAQ,IAAI,EAEpC,SACE,OAACC,EAAA,GACC,MAAM,oBACN,QAASX,EACT,YAAAK,EACA,WAAS,mBAAG,SAAAX,MAAa,OAACkB,GAAA,EAAmB,CAAC,OAAQlB,CAAA,CAAW,EAAG,EAEpE,oBAACiB,EAAA,EAAK,SAAL,CAAc,UAAAH,EACZ,WAACd,MACA,OAACmB,EAAA,GACC,SAAO,KAAE,uEAAwE,kBAAkB,EACrG,EAED,CAAC,CAACf,MACD,OAACe,EAAA,GACC,SAAO,KAAE,4EAA6E,mBAAmB,EACzG,SAAS,QAER,mBAAmBf,CAAmB,EACzC,EAEDJ,MAAa,OAACrD,EAAgB,CAAC,OAAQqD,EAAW,MAAOe,CAAA,CAAa,GACzE,EACF,CAEJ,CAEA,SAAejB,C","sources":["webpack://grafana/./public/app/features/alerting/unified/AlertsFolderView.tsx","webpack://grafana/./public/app/features/browse-dashboards/BrowseFolderAlertingPage.tsx"],"sourcesContent":["import { css } from '@emotion/css';\nimport { orderBy } from 'lodash';\nimport { useState } from 'react';\nimport { useDebounce } from 'react-use';\n\nimport { GrafanaTheme2, SelectableValue } from '@grafana/data';\nimport { Trans, t } from '@grafana/i18n';\nimport { Card, FilterInput, Icon, Pagination, Select, Stack, TagList, useStyles2 } from '@grafana/ui';\nimport { DEFAULT_PER_PAGE_PAGINATION } from 'app/core/constants';\nimport { getQueryParamValue } from 'app/core/utils/query';\nimport { FolderDTO } from 'app/types/folders';\nimport { GrafanaRuleDefinition, RulerGrafanaRuleDTO } from 'app/types/unified-alerting-dto';\n\nimport { usePagination } from './hooks/usePagination';\nimport { useURLSearchParams } from './hooks/useURLSearchParams';\nimport { combineMatcherStrings, labelsMatchMatchers } from './utils/alertmanager';\nimport { GRAFANA_RULES_SOURCE_NAME } from './utils/datasource';\nimport { parsePromQLStyleMatcherLooseSafe } from './utils/matchers';\nimport { rulesNav } from './utils/navigation';\n\ninterface Props {\n  folder: FolderDTO;\n  rules: RulerGrafanaRuleDTO[];\n}\n\nenum SortOrder {\n  Ascending = 'alpha-asc',\n  Descending = 'alpha-desc',\n}\n\nconst sortOptions: Array<SelectableValue<SortOrder>> = [\n  { label: 'Alphabetically [A-Z]', value: SortOrder.Ascending },\n  { label: 'Alphabetically [Z-A]', value: SortOrder.Descending },\n];\n\nexport const AlertsFolderView = ({ folder, rules }: Props) => {\n  const styles = useStyles2(getStyles);\n\n  const onTagClick = (tagName: string) => {\n    const matchersString = combineMatcherStrings(labelFilter, tagName);\n    setLabelFilter(matchersString);\n  };\n\n  const { nameFilter, labelFilter, sortOrder, setNameFilter, setLabelFilter, setSortOrder } =\n    useAlertsFolderViewParams();\n\n  const filteredRules = filterAndSortRules(rules, nameFilter, labelFilter, sortOrder ?? SortOrder.Ascending);\n  const hasNoResults = filteredRules.length === 0;\n\n  const { page, numberOfPages, onPageChange, pageItems } = usePagination(filteredRules, 1, DEFAULT_PER_PAGE_PAGINATION);\n\n  return (\n    <div className={styles.container}>\n      <Stack direction=\"column\" gap={3}>\n        <FilterInput\n          value={nameFilter}\n          onChange={setNameFilter}\n          placeholder={t(\n            'alerting.alerts-folder-view.name-filter-placeholder-search-alert-rules-by-name',\n            'Search alert rules by name'\n          )}\n          data-testid=\"name-filter\"\n        />\n        <Stack direction=\"row\">\n          <Select<SortOrder>\n            value={sortOrder}\n            onChange={({ value }) => value && setSortOrder(value)}\n            options={sortOptions}\n            width={25}\n            aria-label={t('alerting.alerts-folder-view.aria-label-sort', 'Sort')}\n            placeholder={t('alerting.alerts-folder-view.placeholder-sort-default-az', 'Sort (Default A-Z)')}\n            prefix={<Icon name={sortOrder === SortOrder.Ascending ? 'sort-amount-up' : 'sort-amount-down'} />}\n          />\n          <FilterInput\n            value={labelFilter}\n            onChange={setLabelFilter}\n            placeholder={t(\n              'alerting.alerts-folder-view.label-filter-placeholder-search-alerts-by-labels',\n              'Search alerts by labels'\n            )}\n            className={styles.filterLabelsInput}\n            data-testid=\"label-filter\"\n          />\n        </Stack>\n\n        <Stack direction=\"column\" gap={1}>\n          {pageItems.map(({ grafana_alert, labels = {} }) => (\n            <Card\n              key={grafana_alert.uid}\n              href={createGrafanaRuleViewLink(grafana_alert)}\n              className={styles.card}\n              data-testid=\"alert-card-row\"\n            >\n              <Card.Heading>{grafana_alert.title}</Card.Heading>\n              <Card.Tags>\n                <TagList\n                  onClick={onTagClick}\n                  tags={Object.entries(labels).map(([label, value]) => `${label}=${value}`)}\n                />\n              </Card.Tags>\n              <Card.Meta>\n                <div>\n                  <Icon name=\"folder\" /> {folder.title}\n                </div>\n              </Card.Meta>\n            </Card>\n          ))}\n        </Stack>\n        {hasNoResults && (\n          <div className={styles.noResults}>\n            <Trans i18nKey=\"alerting.alerts-folder-view.no-alert-rules-found\">No alert rules found</Trans>\n          </div>\n        )}\n        <div className={styles.pagination}>\n          <Pagination\n            currentPage={page}\n            numberOfPages={numberOfPages}\n            onNavigate={onPageChange}\n            hideWhenSinglePage={true}\n          />\n        </div>\n      </Stack>\n    </div>\n  );\n};\n\nenum AlertFolderViewParams {\n  nameFilter = 'nameFilter',\n  labelFilter = 'labelFilter',\n  sortOrder = 'sort',\n}\n\nfunction useAlertsFolderViewParams() {\n  const [searchParams, setSearchParams] = useURLSearchParams();\n\n  const [nameFilter, setNameFilter] = useState(searchParams.get(AlertFolderViewParams.nameFilter) ?? '');\n  const [labelFilter, setLabelFilter] = useState(searchParams.get(AlertFolderViewParams.labelFilter) ?? '');\n\n  const sortParam = searchParams.get(AlertFolderViewParams.sortOrder);\n  const defaultSortOrder = (() => {\n    if (sortParam === SortOrder.Ascending) {\n      return SortOrder.Ascending;\n    }\n    if (sortParam === SortOrder.Descending) {\n      return SortOrder.Descending;\n    }\n    return undefined;\n  })();\n  const [sortOrder, setSortOrder] = useState<SortOrder | undefined>(defaultSortOrder);\n\n  useDebounce(\n    () =>\n      setSearchParams(\n        {\n          [AlertFolderViewParams.nameFilter]: getQueryParamValue(nameFilter),\n          [AlertFolderViewParams.labelFilter]: getQueryParamValue(labelFilter),\n          [AlertFolderViewParams.sortOrder]: getQueryParamValue(sortOrder),\n        },\n        true\n      ),\n    400,\n    [nameFilter, labelFilter, sortOrder]\n  );\n\n  return { nameFilter, labelFilter, sortOrder, setNameFilter, setLabelFilter, setSortOrder };\n}\n\nfunction filterAndSortRules(\n  originalRules: RulerGrafanaRuleDTO[],\n  nameFilter: string,\n  labelFilter: string,\n  sortOrder: SortOrder\n) {\n  const matchers = parsePromQLStyleMatcherLooseSafe(labelFilter);\n  const rules = originalRules.filter((rule) => {\n    const nameMatch = rule.grafana_alert.title.toLowerCase().includes(nameFilter.toLowerCase());\n    const labelMatch = labelsMatchMatchers(rule.labels ?? {}, matchers);\n    return nameMatch && labelMatch;\n  });\n\n  return orderBy(rules, (rule) => rule.grafana_alert.title.toLowerCase(), [\n    sortOrder === SortOrder.Ascending ? 'asc' : 'desc',\n  ]);\n}\n\nfunction createGrafanaRuleViewLink(ruleDefinition: GrafanaRuleDefinition): string {\n  return rulesNav.detailsPageLink(\n    GRAFANA_RULES_SOURCE_NAME,\n    {\n      uid: ruleDefinition.uid,\n      ruleSourceName: GRAFANA_RULES_SOURCE_NAME,\n    },\n    undefined\n  );\n}\n\nexport const getStyles = (theme: GrafanaTheme2) => ({\n  container: css({\n    padding: theme.spacing(1),\n  }),\n  card: css({\n    gridTemplateColumns: 'auto 1fr 2fr',\n    margin: 0,\n  }),\n  pagination: css({\n    alignSelf: 'center',\n  }),\n  filterLabelsInput: css({\n    flex: 1,\n    width: 'auto',\n    minWidth: '240px',\n  }),\n  noResults: css({\n    padding: theme.spacing(2),\n    backgroundColor: theme.colors.background.secondary,\n    fontStyle: 'italic',\n  }),\n});\n","import { useMemo } from 'react';\nimport { useParams } from 'react-router-dom-v5-compat';\n\nimport { t } from '@grafana/i18n';\nimport { Alert } from '@grafana/ui';\nimport { useGetFolderQueryFacade, useUpdateFolder } from 'app/api/clients/folder/v1beta1/hooks';\nimport { Page } from 'app/core/components/Page/Page';\nimport { buildNavModel, getAlertingTabID } from 'app/features/folders/state/navModel';\n\nimport { AlertsFolderView } from '../alerting/unified/AlertsFolderView';\nimport { alertRuleApi } from '../alerting/unified/api/alertRuleApi';\nimport { GRAFANA_RULER_CONFIG } from '../alerting/unified/api/featureDiscoveryApi';\nimport { stringifyErrorLike } from '../alerting/unified/utils/misc';\nimport { rulerRuleType } from '../alerting/unified/utils/rules';\n\nimport { FolderActionsButton } from './components/FolderActionsButton';\n\nconst { useRulerNamespaceQuery } = alertRuleApi;\n\nexport function BrowseFolderAlertingPage() {\n  const { uid: folderUID = '' } = useParams();\n  const { data: folderDTO, isLoading: isFolderLoading } = useGetFolderQueryFacade(folderUID);\n\n  const {\n    data: rulerNamespace = {},\n    isLoading: isRulerNamespaceLoading,\n    error: rulerNamespaceError,\n  } = useRulerNamespaceQuery({\n    rulerConfig: GRAFANA_RULER_CONFIG,\n    namespace: folderUID,\n  });\n\n  const [saveFolder] = useUpdateFolder();\n\n  const navModel = useMemo(() => {\n    if (!folderDTO) {\n      return undefined;\n    }\n    const model = buildNavModel(folderDTO);\n\n    // Set the \"Alerting\" tab to active\n    const alertingTabID = getAlertingTabID(folderDTO.uid);\n    const alertingTab = model.children?.find((child) => child.id === alertingTabID);\n    if (alertingTab) {\n      alertingTab.active = true;\n    }\n    return model;\n  }, [folderDTO]);\n\n  const onEditTitle = folderUID\n    ? async (newValue: string) => {\n        if (folderDTO) {\n          const result = await saveFolder({\n            ...folderDTO,\n            title: newValue,\n          });\n          if ('error' in result) {\n            throw result.error;\n          }\n        }\n      }\n    : undefined;\n\n  const isLoading = isFolderLoading || isRulerNamespaceLoading;\n  const folderRules = Object.values(rulerNamespace)\n    .flatMap((group) => group)\n    .flatMap((group) => group.rules)\n    .filter(rulerRuleType.grafana.rule);\n\n  return (\n    <Page\n      navId=\"dashboards/browse\"\n      pageNav={navModel}\n      onEditTitle={onEditTitle}\n      actions={<>{folderDTO && <FolderActionsButton folder={folderDTO} />}</>}\n    >\n      <Page.Contents isLoading={isLoading}>\n        {!folderDTO && (\n          <Alert\n            title={t('browse-dashboards.browse-folder-alerting-page.title-folder-not-found', 'Folder not found')}\n          />\n        )}\n        {!!rulerNamespaceError && (\n          <Alert\n            title={t('browse-dashboards.browse-folder-alerting-page.title-ruler-namespace-error', 'Cannot load rules')}\n            severity=\"error\"\n          >\n            {stringifyErrorLike(rulerNamespaceError)}\n          </Alert>\n        )}\n        {folderDTO && <AlertsFolderView folder={folderDTO} rules={folderRules} />}\n      </Page.Contents>\n    </Page>\n  );\n}\n\nexport default BrowseFolderAlertingPage;\n"],"names":["SortOrder","sortOptions","AlertsFolderView","folder","rules","styles","getStyles","onTagClick","tagName","matchersString","labelFilter","setLabelFilter","nameFilter","sortOrder","setNameFilter","setSortOrder","useAlertsFolderViewParams","filteredRules","filterAndSortRules","hasNoResults","page","numberOfPages","onPageChange","pageItems","usePagination","Stack","FilterInput","Select","value","Icon","grafana_alert","labels","Card","createGrafanaRuleViewLink","TagList","label","Pagination","AlertFolderViewParams","searchParams","setSearchParams","useURLSearchParams","sortParam","defaultSortOrder","useDebounce","originalRules","matchers","rule","nameMatch","labelMatch","ruleDefinition","theme","useRulerNamespaceQuery","alertRuleApi","BrowseFolderAlertingPage","folderUID","folderDTO","isFolderLoading","rulerNamespace","isRulerNamespaceLoading","rulerNamespaceError","saveFolder","navModel","model","alertingTabID","alertingTab","child","onEditTitle","newValue","result","isLoading","folderRules","group","Page","FolderActionsButton","Alert"],"sourceRoot":""}