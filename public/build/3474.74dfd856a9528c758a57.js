"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[3474],{34072:(U,P,y)=>{y.d(P,{AG:()=>L,BJ:()=>_,BR:()=>h,CP:()=>F,K0:()=>v,Tl:()=>p,Xq:()=>E,_d:()=>l,a0:()=>I,tF:()=>C});var c=y(10279),i=y(14613),R=y(64394),D=y(95004),M=y(85195);function I(a,t,e,n=1){const o=a.x2-a.x1,s=a.y2-a.y1,d=Math.sqrt(o*o+s*s),f=(a.x2-a.x1)/d,m=(a.y2-a.y1)/d,G=n-n/10;return{x1:a.x1+f*(t+5),y1:a.y1+m*(t+5),x2:a.x2-f*(e+3+G),y2:a.y2-m*(e+3+G)}}function L(a){const t={...a,fields:a.fields.map(n=>({...n,name:n.name.toLowerCase()}))},e=new c.L(t);return{id:e.getFieldByName(i.u.id.toLowerCase()),title:e.getFieldByName(i.u.title.toLowerCase()),subTitle:e.getFieldByName(i.u.subTitle.toLowerCase()),mainStat:e.getFieldByName(i.u.mainStat.toLowerCase()),secondaryStat:e.getFieldByName(i.u.secondaryStat.toLowerCase()),arc:S(a,i.u.arc),details:S(a,i.u.detail),color:e.getFieldByName(i.u.color),icon:e.getFieldByName(i.u.icon),nodeRadius:e.getFieldByName(i.u.nodeRadius.toLowerCase()),highlighted:e.getFieldByName(i.u.highlighted.toLowerCase()),fixedX:e.getFieldByName(i.u.fixedX.toLowerCase()),fixedY:e.getFieldByName(i.u.fixedY.toLowerCase()),isInstrumented:e.getFieldByName(i.u.isInstrumented.toLowerCase())}}function C(a){const t={...a,fields:a.fields.map(n=>({...n,name:n.name.toLowerCase()}))},e=new c.L(t);return{id:e.getFieldByName(i.u.id.toLowerCase()),source:e.getFieldByName(i.u.source.toLowerCase()),target:e.getFieldByName(i.u.target.toLowerCase()),mainStat:e.getFieldByName(i.u.mainStat.toLowerCase()),secondaryStat:e.getFieldByName(i.u.secondaryStat.toLowerCase()),details:S(a,i.u.detail.toLowerCase()),highlighted:e.getFieldByName(i.u.highlighted.toLowerCase()),thickness:e.getFieldByName(i.u.thickness.toLowerCase()),color:e.getFieldByName(i.u.color.toLowerCase()),strokeDasharray:e.getFieldByName(i.u.strokeDasharray.toLowerCase())}}function S(a,t){return a.fields.filter(e=>e.name.match(new RegExp("^"+t)))}function _(a,t){if(!(t||a))return{nodes:[],edges:[]};if(a){const e=L(a);if(!e.id)throw new Error("id field is required for nodes data frame.");const n=e.fixedX&&e.fixedX.values.every(d=>Number.isFinite(d))&&e.fixedY&&e.fixedY.values.every(d=>Number.isFinite(d));if(!n&&(e.fixedX&&e.fixedX.values.some(f=>Number.isFinite(f))||e.fixedY&&e.fixedY.values.some(f=>Number.isFinite(f))))throw new Error("If fixedX and fixedY fields are present, the values have to be all filled and valid");const o={};for(let d=0;d<e.id.values.length;d++){const f=e.id.values[d];o[f]=O(f,e,d)}let s=t?w(t,C(t),o):[];for(const d of s)o[d.target].incoming++;return{nodes:Object.values(o),edges:s,hasFixedPositions:n,legend:e.arc.map(d=>({color:d.config.color?.fixedColor??"",name:d.config.displayName||d.name}))}}else{t=t;const e={},n=C(t);for(let d=0;d<t.length;d++){const{source:f,target:m}=T(n,d);e[m.id]=e[m.id]||m,e[f.id]=e[f.id]||f,x(n.mainStat)&&(e[m.id].mainStatNumeric=(e[m.id].mainStatNumeric??0)+n.mainStat.values[d]),x(n.secondaryStat)&&(e[m.id].secondaryStatNumeric=(e[m.id].secondaryStatNumeric??0)+n.secondaryStat.values[d]),e[m.id].incoming++}let o=w(t,n,e);return{nodes:B(e,n),edges:o,hasFixedPositions:!1}}}function w(a,t,e){if(!t.id)throw new Error("id field is required for edges data frame.");return t.id.values.map((n,o)=>{const s=t.target?.values[o],d=t.source?.values[o],f=e[d],m=e[s];return{id:n,dataFrameRowIndex:o,source:d,target:s,sourceNodeRadius:f.nodeRadius?f.nodeRadius.values[f.dataFrameRowIndex]:M.h,targetNodeRadius:m.nodeRadius?m.nodeRadius.values[m.dataFrameRowIndex]:M.h,mainStat:t.mainStat?E(t.mainStat.config,t.mainStat.values[o]):"",secondaryStat:t.secondaryStat?E(t.secondaryStat.config,t.secondaryStat.values[o]):"",highlighted:t.highlighted?.values[o]||!1,thickness:t.thickness?.values[o]||1,color:t.color?.values[o],strokeDasharray:t.strokeDasharray?.values[o]}})}function x(a){return a&&a.type===D.PU.number}function B(a,t){const e=[],n=[],o=x(t.secondaryStat)?{...t.secondaryStat,values:e}:void 0,s=x(t.mainStat)?{...t.mainStat,values:n}:void 0;return Object.values(a).map((d,f)=>{if(s||o){const m={...d};return s&&(m.mainStat=s,n.push(d.mainStatNumeric),m.dataFrameRowIndex=f),o&&(m.secondaryStat=o,e.push(d.secondaryStatNumeric),m.dataFrameRowIndex=f),m}return d})}function T(a,t){const e=a.target?.values[t],n=a.source?.values[t];return{target:N(e,t),source:N(n,t)}}function N(a,t){return{id:a,title:a,subTitle:"",dataFrameRowIndex:t,incoming:0,arcSections:[],highlighted:!1}}function O(a,t,e){return{id:a,title:t.title?.values[e]||"",subTitle:t.subTitle?.values[e]||"",dataFrameRowIndex:e,incoming:0,mainStat:t.mainStat,secondaryStat:t.secondaryStat,arcSections:t.arc,color:t.color,icon:t.icon?.values[e]||"",nodeRadius:t.nodeRadius,highlighted:t.highlighted?.values[e]||!1,x:t.fixedX?.values[e]??void 0,y:t.fixedY?.values[e]??void 0,isInstrumented:t.isInstrumented?.values[e]??!0}}function E(a,t){if(typeof t=="string")return t;{const e=a.decimals||2;return Number.isFinite(t)?t.toFixed(e)+(a.unit?" "+a.unit:""):""}}function A(a,t=[]){const e=j();for(let n=0;n<a;n++)e.add(b(n,t[n]));return e}function b(a,t={}){return{id:a.toString(),title:`service:${a}`,subtitle:"service",arc__success:.5,arc__errors:.5,mainstat:.1,secondarystat:2,color:.5,icon:"database",noderadius:40,isinstrumented:!0,...t}}function j(){const a={[NodeGraphDataFrameFieldNames.id]:{values:[],type:FieldType.string},[NodeGraphDataFrameFieldNames.title]:{values:[],type:FieldType.string},[NodeGraphDataFrameFieldNames.subTitle]:{values:[],type:FieldType.string},[NodeGraphDataFrameFieldNames.mainStat]:{values:[],type:FieldType.number},[NodeGraphDataFrameFieldNames.secondaryStat]:{values:[],type:FieldType.number},[NodeGraphDataFrameFieldNames.arc+"success"]:{values:[],type:FieldType.number,config:{color:{mode:FieldColorModeId.Fixed,fixedColor:"green"}}},[NodeGraphDataFrameFieldNames.arc+"errors"]:{values:[],type:FieldType.number,config:{color:{mode:FieldColorModeId.Fixed,fixedColor:"red"}}},[NodeGraphDataFrameFieldNames.color]:{values:[],type:FieldType.number,config:{color:{mode:FieldColorModeId.ContinuousGrYlRd}}},[NodeGraphDataFrameFieldNames.icon]:{values:[],type:FieldType.string},[NodeGraphDataFrameFieldNames.nodeRadius]:{values:[],type:FieldType.number},[NodeGraphDataFrameFieldNames.isInstrumented]:{values:[],type:FieldType.boolean}};return new MutableDataFrame({name:"nodes",fields:Object.entries(a).map(([t,e])=>({...e,name:t}))})}function r(a){const t=u();for(const e of a)t.add({id:e.source+"--"+e.target,...e});return t}function u(){const a={[NodeGraphDataFrameFieldNames.id]:{values:[],type:FieldType.string},[NodeGraphDataFrameFieldNames.source]:{values:[],type:FieldType.string},[NodeGraphDataFrameFieldNames.target]:{values:[],type:FieldType.string},[NodeGraphDataFrameFieldNames.mainStat]:{values:[],type:FieldType.number},[NodeGraphDataFrameFieldNames.secondaryStat]:{values:[],type:FieldType.number}};return new MutableDataFrame({name:"edges",fields:Object.entries(a).map(([t,e])=>({...e,name:t}))})}function l(a){if(a.length===0)return{top:0,right:0,bottom:0,left:0,center:{x:0,y:0}};const t=a.reduce((o,s)=>(s.x>o.right&&(o.right=s.x),s.x<o.left&&(o.left=s.x),s.y>o.bottom&&(o.bottom=s.y),s.y<o.top&&(o.top=s.y),o),{top:1/0,right:-1/0,bottom:-1/0,left:1/0}),e=t.top+(t.bottom-t.top)/2,n=t.left+(t.right-t.left)/2;return{...t,center:{x:n,y:e}}}function h(a,t){let e=a.filter(n=>!!(n.meta?.preferredVisualisationType==="nodeGraph"||n.name==="nodes"||n.name==="edges"||n.refId==="nodes"||n.refId==="edges"||new c.L(n).getFieldByName(i.u.id)));return t&&(e=g(e,t)),e}const g=(a,t)=>a.map(e=>{if(new c.L(e).getFieldByName(i.u.source.toLowerCase())){if(t?.edges?.mainStatUnit){const o=e.fields.find(s=>s.name.toLowerCase()===i.u.mainStat);o&&(o.config={...o.config,unit:t.edges.mainStatUnit})}if(t?.edges?.secondaryStatUnit){const o=e.fields.find(s=>s.name.toLowerCase()===i.u.secondaryStat);o&&(o.config={...o.config,unit:t.edges.secondaryStatUnit})}}else{if(t?.nodes?.mainStatUnit){const o=e.fields.find(s=>s.name.toLowerCase()===i.u.mainStat);o&&(o.config={...o.config,unit:t.nodes.mainStatUnit})}if(t?.nodes?.secondaryStatUnit){const o=e.fields.find(s=>s.name.toLowerCase()===i.u.secondaryStat);o&&(o.config={...o.config,unit:t.nodes.secondaryStatUnit})}if(t?.nodes?.arcs?.length)for(const o of t.nodes.arcs){const s=e.fields.find(d=>d.name.toLowerCase()===o.field?.toLowerCase());s&&o.color&&(s.config={...s.config,color:{fixedColor:o.color,mode:R.Y.Fixed}})}}return e}),v=(a,t,e)=>{const n=t.find(o=>o.id===e);return n?[...new Set(a.filter(o=>n.source===o.id||n.target===o.id).map(o=>o.id))]:[]},p=(a,t,e)=>{const n=a.find(o=>o.id===e);if(n){const o=t.filter(s=>s.source===n.id||s.target===n.id);return[...new Set(o.flatMap(s=>a.filter(d=>s.source===d.id||s.target===d.id).map(d=>d.id)))]}return[]},F=a=>a.reduce((t,e)=>{const n=e.fields.filter(o=>o.name==="source");return e.name==="edges"||n.length?t.edges.push(e):t.nodes.push(e),t},{edges:[],nodes:[]})},85195:(U,P,y)=>{y.d(P,{Hj:()=>N,bP:()=>O,h:()=>x});var c=y(74848),i=y(22803),R=y(46942),D=y.n(R),M=y(96540),I=y(84140),L=y(76637),C=y(92745),S=y(30703),_=y(63142),w=y(34072);const x=40,B="#a00",T=(r,u)=>({mainGroup:(0,i.css)({cursor:"pointer",fontSize:"10px",[r.transitions.handleMotion("no-preference","reduce")]:{transition:"opacity 300ms"},opacity:u==="inactive"?.5:1}),mainCircle:(0,i.css)({fill:r.components.panel.background}),filledCircle:(0,i.css)({fill:B}),hoverCircle:(0,i.css)({opacity:.5,fill:"transparent",stroke:r.colors.primary.text}),text:(0,i.css)({fill:r.colors.text.primary,pointerEvents:"none"}),titleText:(0,i.css)({textAlign:"center",textOverflow:"ellipsis",overflow:"hidden",whiteSpace:"nowrap",backgroundColor:(0,I.A)(r.colors.background.primary).setAlpha(.6).toHex8String(),width:"140px"}),statsText:(0,i.css)({textAlign:"center",textOverflow:"ellipsis",overflow:"hidden",whiteSpace:"nowrap",width:"70px"}),textHovering:(0,i.css)({width:"200px","& span":{backgroundColor:(0,I.A)(r.colors.background.primary).setAlpha(.8).toHex8String()}}),clickTarget:(0,i.css)({fill:"none",stroke:"none",pointerEvents:"fill"})}),N=r=>Math.ceil(r*.075),O=(0,M.memo)(function(u){const{node:l,onMouseEnter:h,onMouseLeave:g,onClick:v,hovering:p}=u,F=(0,_.$j)(),a=T(F,p),t=p==="active",e=l.nodeRadius?.values[l.dataFrameRowIndex]||x,n=N(e);return l.x!==void 0&&l.y!==void 0?(0,c.jsxs)("g",{"data-node-id":l.id,className:a.mainGroup,"aria-label":(0,C.t)("nodeGraph.node.aria-label-node-title","Node: {{nodeName}}",{nodeName:l.title}),children:[(0,c.jsx)("circle",{"data-testid":`node-circle-${l.id}`,className:l.highlighted?a.filledCircle:a.mainCircle,r:e,cx:l.x,cy:l.y}),t&&(0,c.jsx)("circle",{className:a.hoverCircle,r:e-3,cx:l.x,cy:l.y,strokeWidth:n}),(0,c.jsx)(A,{node:l}),(0,c.jsxs)("g",{className:a.text,style:{pointerEvents:"none"},children:[(0,c.jsx)(E,{node:l,hovering:p}),(0,c.jsx)("foreignObject",{x:l.x-(t?100:70),y:l.y+e+5,width:t?"200":"140",height:"40",children:(0,c.jsxs)("div",{className:D()(a.titleText,t&&a.textHovering),children:[(0,c.jsx)("span",{children:l.title}),(0,c.jsx)("br",{}),(0,c.jsx)("span",{children:l.subTitle})]})})]}),(0,c.jsx)("rect",{"data-testid":`node-click-rect-${l.id}`,onMouseEnter:()=>{h(l.id)},onMouseLeave:()=>{g(l.id)},onClick:o=>{v(o,l)},className:a.clickTarget,x:l.x-e-5,y:l.y-e-5,width:e*2+10,height:e*2+50})]}):null});function E({node:r,hovering:u}){const l=(0,_.$j)(),h=T(l,u),g=u==="active";return r.x!==void 0&&r.y!==void 0?r.icon?(0,c.jsx)("foreignObject",{x:r.x-35,y:r.y-20,width:"70",height:"40",children:(0,c.jsx)("div",{style:{width:70,overflow:"hidden",display:"flex",justifyContent:"center",marginTop:-4},children:(0,c.jsx)(S.I,{"data-testid":`node-icon-${r.icon}`,name:r.icon,size:"xxxl"})})}):(0,c.jsx)("foreignObject",{x:r.x-(g?100:35),y:r.y-15,width:g?"200":"70",height:"40",children:(0,c.jsxs)("div",{className:D()(h.statsText,g&&h.textHovering),children:[(0,c.jsx)("span",{children:r.mainStat&&(0,w.Xq)(r.mainStat.config,r.mainStat.values[r.dataFrameRowIndex])}),(0,c.jsx)("br",{}),(0,c.jsx)("span",{children:r.secondaryStat&&(0,w.Xq)(r.secondaryStat.config,r.secondaryStat.values[r.dataFrameRowIndex])})]})}):null}function A(r){const{node:u}=r,l=u.arcSections.find(a=>a.values[u.dataFrameRowIndex]>=1),h=(0,_.$j)(),g=u.nodeRadius?.values[u.dataFrameRowIndex]||x,v=N(g);if(l)return(0,c.jsx)("circle",{fill:"none",stroke:h.visualization.getColorByName(l.config.color?.fixedColor||""),strokeWidth:v,r:g,cx:u.x,cy:u.y});const p=u.arcSections.filter(a=>a.values[u.dataFrameRowIndex]!==0);if(p.length===0)return(0,c.jsx)("circle",{fill:"none",stroke:u.color?j(u.color,u.dataFrameRowIndex,h):"gray",strokeWidth:v,r:g,cx:u.x,cy:u.y});const{elements:F}=p.reduce((a,t,e)=>{const n=t.config.color?.fixedColor||"",o=t.values[u.dataFrameRowIndex],s=(0,c.jsx)(b,{r:g,x:u.x,y:u.y,startPercent:a.percent,percent:o+a.percent>1?1-a.percent:o,color:h.visualization.getColorByName(n),strokeWidth:v},e);return a.elements.push(s),a.percent=a.percent+o,a},{elements:[],percent:0});return(0,c.jsx)(c.Fragment,{children:F})}function b({r,x:u,y:l,startPercent:h,percent:g,color:v,strokeWidth:p=2}){const F=h+g,a=u+Math.sin(2*Math.PI*h)*r,t=l-Math.cos(2*Math.PI*h)*r,e=u+Math.sin(2*Math.PI*F)*r,n=l-Math.cos(2*Math.PI*F)*r,o=g>.5?"1":"0";return(0,c.jsx)("path",{fill:"none",d:`M ${a} ${t} A ${r} ${r} 0 ${o} 1 ${e} ${n}`,stroke:v,strokeWidth:p})}function j(r,u,l){return r.config.color?(0,L.Qi)(r).getCalculator(r,l)(0,r.values[u]):r.values[u]}}}]);

//# sourceMappingURL=3474.74dfd856a9528c758a57.js.map