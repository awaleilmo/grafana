"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[6199],{11686:(Y,I,t)=>{t.d(I,{K:()=>y,Q:()=>T});var v=t(739);const y={alignValue:"left",mergeValues:!0,perPage:20,rowHeight:.9,showValue:v.yL.Auto},T={fillOpacity:70,lineWidth:0}},16608:(Y,I,t)=>{t.d(I,{I:()=>x});var v=t(74848),y=t(96540),T=t(64394),E=t(95004),C=t(739),r=t(54735),g=t(4268),L=t(47220),M=t(68706);const A=["rowHeight","colWidth","showValue","mergeValues","alignValue","tooltip","paginationRev"];class x extends y.Component{constructor(){super(...arguments),this.getValueColor=(n,l,e)=>{const i=this.props.frames[n]?.fields[l];if(i?.display){const s=i.display(e);if(s.color)return s.color}return T.F},this.prepConfig=(n,l,e)=>(0,M.iE)({frame:n,getTimeRange:e,allFrames:this.props.frames,...this.props,timeZones:Array.isArray(this.props.timeZone)?this.props.timeZone:[this.props.timeZone],rowHeight:n.fields.length>2?this.props.rowHeight:1,getValueColor:this.getValueColor,hoverMulti:this.props.tooltip?.mode===C.$N.Multi}),this.renderLegend=n=>{const{legend:l,legendItems:e}=this.props;return!n||!e||!l||l.showLegend===!1?null:(0,v.jsx)(r.KU.Legend,{placement:l.placement,children:(0,v.jsx)(g.t,{placement:l.placement,items:e,displayMode:l.displayMode,readonly:!0})})}}render(){return(0,v.jsx)(L.o,{...this.props,fields:{x:n=>n.type===E.PU.time,y:n=>n.type===E.PU.number||n.type===E.PU.boolean||n.type===E.PU.string||n.type===E.PU.enum},prepConfig:this.prepConfig,propsToDiff:A,renderLegend:this.renderLegend,omitHideFromViz:!0})}}},16913:(Y,I,t)=>{t.d(I,{OG:()=>E,u6:()=>y});var v=t(73163);const y=(C,r)=>{const g=[];if((C.config.links?.length??0)>0&&C.getLinks!=null){const L=C.values[r],M=C.display?C.display(L):{text:`${L}`,numeric:+L},A=new Set;C.getLinks({calculatedValue:M,valueRowIndex:r}).forEach(x=>{const a=`${x.title}/${x.href}`;A.has(a)||(g.push(x),A.add(a))})}return g},T=C=>{},E=(C,r,g,L)=>{const M=[],A=new Set;return(0,v.ko)(C,r,r.state.scopedVars,g,r.config.actions??[],{valueRowIndex:L}).forEach(a=>{const n=`${a.title}`;A.has(n)||(M.push(a),A.add(n))}),M}},17669:(Y,I,t)=>{t.d(I,{m:()=>x});var v=t(95004),y=t(63409),T=t(79243),E=t(8721);function C(a,n,l){let e,i;for(let s=0;s<n.length;s++)if(n[s]==null)i==null&&e!=null&&(i=s);else{if(i!=null&&e!=null){if(a[s]-e<l)for(;i<s;)n[i++]=void 0;i=null}e=a[s]}return n}var r=t(739);function g(a){return a.type===v.PU.number&&a.config.custom?.drawStyle===r.GR.Bars&&!a.config.custom?.hideFrom?.viz}function L(a,n){return a.fields.find(l=>n!=null?l.name===n:l.type===v.PU.time)}function M(a,n){const l=L(a,n);let e=l?.values;for(let i=0;i<a.fields.length;i++){let s=a.fields[i];if(s===l||g(s))continue;let o=s.config.custom?.spanNulls;typeof o=="number"&&o!==-1&&e&&(s.values=C(e,s.values,o))}return a}function A(a,n,l){for(let e of n.fields)if(a.x(e,n,l))return e}function x(a,n,l){a=a.map(o=>{const d=A(n,o,a);return d!=null&&!d.state?.nullThresholdApplied?(0,y.M)({frame:o,refFieldName:d.name,refFieldPseudoMin:l?.from.valueOf(),refFieldPseudoMax:l?.to.valueOf()}):o});let e=a.reduce((o,d)=>o+d.fields.reduce((h,c)=>h+(g(c)?1:0),0),0),i=null;if(e>1){const o=new Set;a.forEach(d=>{if(!d.fields.some(g))return;const h=A(n,d,a);if(h==null)return;let c=1/0;const P=h.values;for(let R=0;R<P.length;R++)R>0&&(c=Math.min(c,P[R]-P[R-1]));c!==1/0&&(Number.isInteger(c)||(c=(0,T.h)(c,6)),o.add(c))}),o.size>1&&(i=Math.min(...o))}let s=(0,E.Fd)({frames:a,joinBy:n.x,keep:n.y,keepOriginIndices:!0,keepDisplayNames:!0,nullMode:o=>{if(g(o))return E.WO;let d=o.config.custom?.spanNulls;return d===!0?E.RC:d===-1?E.WO:E.JI}});return s?(s=M(s,s.fields[0].name),i!=null&&(s.fields.forEach((o,d)=>{let h=o.values;if(d===0){let c=h[h.length-1];h.push(c+i,c+2*i)}else g(o)?h.push(null,null):h.push(void 0,void 0)}),s.length+=2),s):null}},28343:(Y,I,t)=>{t.d(I,{W:()=>A,i:()=>L});var v=t(74848),y=t(22803),T=t(96540),E=t(49185),C=t(34213),r=t(68706),g=t(11686);const L={container:(0,y.css)({display:"flex",flexDirection:"column"})},M={paginationContainer:(0,y.css)({display:"flex",justifyContent:"center",width:"100%"}),paginationElement:(0,y.css)({marginTop:"8px"})};function A(x,a){const[n,l]=(0,T.useState)(1),[e,{height:i,width:s}]=(0,E.A)(),o=(0,T.useMemo)(()=>!a||x==null?x:(0,r.be)(x),[x,a]);if(!a||o==null)return{paginatedFrames:o,paginationRev:"disabled",paginationElement:void 0,paginationHeight:0};a||=g.K.perPage;const d=Math.ceil(o.length/a),h=Math.min(n,d),c=(h-1)*a,P=o.slice(c,c+a),R=`${h}/${a}`,N=s<550,D=(0,v.jsx)("div",{className:M.paginationContainer,ref:e,children:(0,v.jsx)(C.d,{className:M.paginationElement,currentPage:h,numberOfPages:d,showSmallVersion:N,onNavigate:l})});return{paginatedFrames:P,paginationRev:R,paginationElement:D,paginationHeight:i}}},44372:(Y,I,t)=>{t.r(I),t.d(I,{plugin:()=>ct});var v=t(16207),y=t(83340),T=t(64394),E=t(95004),C=t(38809),r=t(92745),g=t(739),L=t(45013),M=t(44017),A=t(41069),x=t(79277),a=t(17914),n=t(76548),l=t(74848),e=t(96540),i=t(84229),s=t(14477),o=t(63142),d=t(64400),h=t(18667),c=t(69234),P=t(16608),R=t(68706),N=t(36327),D=t(13507),W=t(76234),H=t(44391),Z=t(28343);const j=({data:p,timeRange:m,timeZone:u,options:f,width:O,height:U,fieldConfig:et,replaceVariables:X,onChangeTimeRange:V,id:_})=>{const G=(0,o.$j)(),[J,nt]=(0,e.useState)(null),{sync:mt,eventsScope:pt,canAddAnnotations:lt,dataLinkPostProcessor:ht,eventBus:vt,canExecuteActions:it}=(0,d.d2)(),Et=(0,e.useMemo)(()=>it?.()??!1,[it]),at=mt?.()??i.y.Off,{frames:Mt,warn:ot}=(0,e.useMemo)(()=>(0,R.Qe)(p.series,f.mergeValues??!0,m,G),[p.series,f.mergeValues,m,G]),{paginatedFrames:b,paginationRev:Pt,paginationElement:Dt,paginationHeight:Ot}=(0,Z.W)(Mt,f.perPage),Ct=(0,e.useMemo)(()=>(0,R.Or)(b,f.legend,G),[b,f.legend,G]),yt=(0,e.useMemo)(()=>(0,W.Fg)(f.timezone,u),[f.timezone,u]);if(!b||typeof ot=="string")return(0,l.jsx)(s.a,{panelId:_,fieldConfig:et,data:p,message:ot,needsTimeField:!0});const rt=!!(lt&&lt());return(0,l.jsxs)("div",{className:Z.i.container,children:[(0,l.jsx)(P.I,{theme:G,frames:b,structureRev:p.structureRev,paginationRev:Pt,timeRange:m,timeZone:yt,width:O,height:U-Ot,legendItems:Ct,...f,mode:R.pm.Changes,replaceVariables:X,dataLinkPostProcessor:ht,cursorSync:at,children:(k,q)=>(0,l.jsxs)(l.Fragment,{children:[at!==i.y.Off&&(0,l.jsx)(h.K,{config:k,eventBus:vt,frame:q}),f.tooltip.mode!==g.$N.None&&(0,l.jsx)(c.xl,{config:k,hoverMode:f.tooltip.mode===g.$N.Multi?c.b3.xAll:c.b3.xOne,queryZoom:V,syncMode:at,syncScope:pt,getDataLinks:(tt,st)=>q.fields[tt].getLinks?.({valueRowIndex:st})??[],render:(tt,st,Tt,xt,ut,dt,At,Rt)=>{if(rt&&dt!=null){nt(dt),ut();return}const Lt=()=>{let ft=tt.posToVal(tt.cursor.left,"x");nt({from:ft,to:ft}),ut()};return(0,l.jsx)(H.K,{series:q,dataIdxs:st,seriesIdx:Tt,mode:At?g.$N.Multi:f.tooltip.mode,sortOrder:f.tooltip.sort,isPinned:xt,timeRange:m,annotate:rt?Lt:void 0,withDuration:!0,maxHeight:f.tooltip.maxHeight,replaceVariables:X,dataLinks:Rt,canExecuteActions:Et})},maxWidth:f.tooltip.maxWidth}),q.fields[0].config.custom?.axisPlacement!==g.vM.Hidden&&(0,l.jsx)(N.W,{annotations:p.annotations??[],config:k,timeZone:u,newRange:J,setNewRange:nt,canvasRegionRendering:!1}),(0,l.jsx)(D.U,{config:k,onChangeTimeRange:V})]})}),Dt]})};var S=t(2543),B=t(18600);const K=(p,m,u)=>{let f=p.options??{};if(m==="natel-discrete-panel"&&u.angular){const O=u.angular,U=p.fieldConfig??{defaults:{},overrides:[]};O.units&&(U.defaults.unit=O.units);const et={fillOpacity:100,lineWidth:0};U.defaults.custom=et,f.mergeValues=!0;const X={type:B.d.ValueToText,options:{}};if(U.defaults.mappings=[X],(0,S.isArray)(O.colorMaps))for(const V of O.colorMaps){const _=V.color;_&&(X.options[V.text]={color:_})}if((0,S.isArray)(O.valueMaps))for(const V of O.valueMaps){const _=V.text,G=V.value;if(_&&G){let J=X.options[G];J?J.text=_:X.options[G]={text:_}}}if((0,S.isArray)(O.rangeMaps))for(const V of O.rangeMaps){let _=+V.from,G=+V.to;const J=V.text;J&&U.defaults.mappings.push({type:B.d.RangeToText,options:{from:_,to:G,result:{text:J}}})}U.defaults.mappings?.length&&(U.defaults.mappings=z(U.defaults.mappings)),p.fieldConfig=U}return f};function z(p){let m={};for(const u of p)if(F(u))for(const f in u.options){const O=u.options[f];O.color?.length&&(m[f]=O.color)}else if(Q(u)){const{text:f,color:O}=u.options.result;f?.length&&O?.length&&!m[f]&&(m[f]=O)}return p.map(u=>{if(F(u))for(const f in u.options){const O=u.options[f];if(!O.color?.length){let U=m[f];!U&&O.text&&(U=m[O.text]),U&&(O.color=U)}}else if(Q(u)){const{text:f,color:O}=u.options.result;!O&&f&&m[f]&&(u.options.result.color=m[f])}return u})}function F(p){return p.type===B.d.ValueToText}function Q(p){return p.type===B.d.RangeToText}var $=t(11686),w=t(73495);class gt{getSuggestionsForData(m){const{dataSummary:u}=m;if(!u.hasData||!u.hasTimeField||!u.hasStringField&&!u.hasNumberField||u.numberFieldCount>=30||u.preferredVisualisationType==="logs")return;m.getListAppender({name:"",pluginId:"state-timeline",options:{},fieldConfig:{defaults:{custom:{}},overrides:[]}}).append({name:w.m.StateTimeline})}}const ct=new v.m(j).setPanelChangeHandler(K).useFieldConfig({standardOptions:{[y.uo.Color]:{settings:{byValueSupport:!0},defaultValue:{mode:T.Y.ContinuousGrYlRd}},[y.uo.Links]:{settings:{showOneClick:!0}},[y.uo.Actions]:{hideFromDefaults:!1}},useCustomConfig:p=>{const m=[(0,r.t)("state-timeline.category-state-timeline","State timeline")];p.addSliderInput({path:"lineWidth",name:(0,r.t)("state-timeline.name-line-width","Line width"),category:m,defaultValue:$.Q.lineWidth,settings:{min:0,max:10,step:1}}).addSliderInput({path:"fillOpacity",name:(0,r.t)("state-timeline.name-fill-opacity","Fill opacity"),category:m,defaultValue:$.Q.fillOpacity,settings:{min:0,max:100,step:1}}).addCustomEditor({id:"spanNulls",path:"spanNulls",name:(0,r.t)("state-timeline.name-connect-null-values","Connect null values"),category:m,defaultValue:!1,editor:n.e,override:n.e,shouldApply:u=>u.type!==E.PU.time,process:C.hS,settings:{isTime:!0}}).addCustomEditor({id:"insertNulls",path:"insertNulls",name:(0,r.t)("state-timeline.name-disconnect-values","Disconnect values"),category:m,defaultValue:!1,editor:a.Z,override:a.Z,shouldApply:u=>u.type!==E.PU.time,process:C.hS,settings:{isTime:!0}}),L.e(p),M.Wq(p,u=>u===g.vM.Auto||u===g.vM.Hidden),M.T4(p)}}).setPanelOptions(p=>{const m=[(0,r.t)("state-timeline.category-state-timeline","State timeline")];p.addBooleanSwitch({path:"mergeValues",name:(0,r.t)("state-timeline.name-merge-equal-consecutive-values","Merge equal consecutive values"),category:m,defaultValue:$.K.mergeValues}).addRadio({path:"showValue",name:(0,r.t)("state-timeline.name-show-values","Show values"),category:m,settings:{options:[{value:g.yL.Auto,label:(0,r.t)("state-timeline.show-values-options.label-auto","Auto")},{value:g.yL.Always,label:(0,r.t)("state-timeline.show-values-options.label-always","Always")},{value:g.yL.Never,label:(0,r.t)("state-timeline.show-values-options.label-never","Never")}]},defaultValue:$.K.showValue}).addRadio({path:"alignValue",name:(0,r.t)("state-timeline.name-align-values","Align values"),category:m,settings:{options:[{value:"left",label:(0,r.t)("state-timeline.align-values-options.label-left","Left")},{value:"center",label:(0,r.t)("state-timeline.align-values-options.label-center","Center")},{value:"right",label:(0,r.t)("state-timeline.align-values-options.label-right","Right")}]},defaultValue:$.K.alignValue}).addSliderInput({path:"rowHeight",name:(0,r.t)("state-timeline.name-row-height","Row height"),category:m,settings:{min:0,max:1,step:.01},defaultValue:$.K.rowHeight}).addNumberInput({path:"perPage",name:(0,r.t)("state-timeline.name-page-size","Page size (enable pagination)"),category:m,settings:{min:1,step:1,integer:!0}}),A.H(p,!1),x.D(p)}).setSuggestionsSupplier(new gt).setDataSupport({annotations:!0})},44391:(Y,I,t)=>{t.d(I,{K:()=>a});var v=t(74848),y=t(95004),T=t(739),E=t(47466),C=t(39064),r=t(41530),g=t(61048),L=t(55302),M=t(68706),A=t(16913),x=t(76234);const a=({series:n,dataIdxs:l,seriesIdx:e,mode:i=T.$N.Single,sortOrder:s=T.xB.None,isPinned:o,annotate:d,timeRange:h,withDuration:c,maxHeight:P,replaceVariables:R,dataLinks:N})=>{const D=n.fields[0],W=e!=null?l[e]:l.find(K=>K!=null),H=D.display(D.values[W]).text;i=o?T.$N.Single:i;const Z=(0,L.cp)(n.fields,D,l,e,i,s);let j=null;if(c&&i===T.$N.Single){const K=n.fields[e],z=(0,M.GY)(K,W);let F;z&&(F=D.values[z]);const Q=D.values[W];let $;if(F)$=F&&(0,M.c5)(F-Q),j=F;else{const w=h.to.valueOf();$=(0,M.c5)(w-Q),j=w}Z.push({label:"Duration",value:$})}let S;if(e!=null){const K=n.fields[e],z=N.some(F=>F.oneClick===!0);if(o||z){const F=l[e],Q=(0,A.OG)(n,K,R,F);S=(0,v.jsx)(C.S,{dataLinks:N,actions:Q,annotate:d})}}const B={label:D.type===y.PU.time?"":D.state?.displayName??D.name,value:j?H+` - 
`+D.display(j).text:H};return(0,v.jsxs)(g.i,{children:[(0,v.jsx)(r.A,{item:B,isPinned:o}),(0,v.jsx)(E.o,{items:Z,isPinned:o,scrollable:(0,x.T5)({mode:i,maxHeight:P}),maxHeight:P}),S]})}},47220:(Y,I,t)=>{t.d(I,{o:()=>n});var v=t(74848),y=t(96540),T=t(36638),E=t(57866),C=t(60519),r=t(95004),g=t(54735),L=t(92790),M=t(36192),A=t(17669);function x(l,e,i=[]){for(const s of i)if(typeof s=="function"){if(!s(l,e))return!1}else if(e[s]!==l[s])return!1;return!0}const a={x:T.sJ.get(E.Ct.firstTimeField).get({}),y:T.sJ.get(E.Ct.byTypes).get(new Set([r.PU.number,r.PU.enum]))};class n extends y.Component{constructor(e){super(e),this.getTimeRange=()=>this.props.timeRange;let i=this.prepState(e);i.alignedData=i.config.prepData([i.alignedFrame]),this.state=i,this.plotInstance=y.createRef()}prepState(e,i=!0){let s=null;const{frames:o,fields:d=a,preparePlotFrame:h,replaceVariables:c,dataLinkPostProcessor:P}=e,R=h??A.m,N=o.some(W=>W.fields.some(H=>(H.config.links?.length??0)>0)),D=R(o,{...d,y:N?()=>!0:d.y},e.timeRange);if((0,M.uY)("GraphNG",!1,"data aligned",D),D){let W=D;if(N){const Z=Array.isArray(this.props.timeZone)?this.props.timeZone[0]:this.props.timeZone;let j=o.map((S,B)=>({...S,fields:D.fields.filter((K,z)=>z===0||K.state?.origin?.frameIndex===B),length:D.length}));j.forEach((S,B)=>{S.fields.forEach(K=>{K.getLinks=(0,C._M)(S,K,{...K.state?.scopedVars,__dataContext:{value:{data:j,field:K,frame:S,frameIndex:B}}},c,Z,P)})}),W={...D,fields:D.fields.filter((S,B)=>B===0||d.y(S,D,[D]))}}if(e.omitHideFromViz){const Z=W.fields.filter(j=>j.config.custom?.hideFrom?.viz!==!0);W={...W,fields:Z,length:Z.length}}let H=this.state?.config;i&&(H=e.prepConfig(W,this.props.frames,this.getTimeRange),(0,M.uY)("GraphNG",!1,"config prepared",H)),s={alignedFrame:W,config:H},(0,M.uY)("GraphNG",!1,"data prepared",s.alignedData)}return s}componentDidUpdate(e){const{frames:i,structureRev:s,timeZone:o,cursorSync:d,propsToDiff:h}=this.props,c=!x(e,this.props,h);if(i!==e.frames||c||o!==e.timeZone||d!==e.cursorSync){let P=this.prepState(this.props,!1);P&&((this.state.config===void 0||o!==e.timeZone||d!==e.cursorSync||s!==e.structureRev||!s||c)&&(P.config=this.props.prepConfig(P.alignedFrame,this.props.frames,this.getTimeRange),(0,M.uY)("GraphNG",!1,"config recreated",P.config)),P.alignedData=P.config.prepData([P.alignedFrame]),this.setState(P))}}render(){const{width:e,height:i,children:s,renderLegend:o}=this.props,{config:d,alignedFrame:h,alignedData:c}=this.state;return d?(0,v.jsx)(g.KU,{width:e,height:i,legend:o(d),children:(P,R)=>(0,v.jsx)(L.Z,{config:d,data:c,width:P,height:R,plotRef:N=>this.plotInstance.current=N,children:s?s(d,h):null})}):null}}}}]);

//# sourceMappingURL=stateTimelinePanel.54ef82e3eeb369c72dae.js.map