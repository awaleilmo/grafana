{"version":3,"file":"483.760b18b3fc5a3f6e5fbb.js","mappings":"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","sources":["webpack://grafana/./public/app/core/components/TimelineChart/TimelineChart.tsx","webpack://grafana/./packages/grafana-data/src/transformations/transformers/nulls/nullToUndefThreshold.ts","webpack://grafana/./public/app/core/components/GraphNG/utils.ts","webpack://grafana/./public/app/features/alerting/unified/components/rules/state-history/common.ts","webpack://grafana/./public/app/core/components/GraphNG/GraphNG.tsx","webpack://grafana/./public/app/features/alerting/unified/components/rules/state-history/ErrorMessageRow.tsx","webpack://grafana/./public/app/features/alerting/unified/components/rules/state-history/LogRecordViewer.tsx","webpack://grafana/./public/app/features/alerting/unified/components/rules/state-history/LokiStateHistory.tsx","webpack://grafana/./public/app/features/alerting/unified/api/stateHistoryApi.ts","webpack://grafana/./public/app/features/alerting/unified/components/rules/state-history/LogTimelineViewer.tsx","webpack://grafana/./public/app/features/alerting/unified/components/rules/state-history/useRuleHistoryRecords.tsx"],"sourcesContent":["import { Component } from 'react';\n\nimport { DataFrame, FALLBACK_COLOR, FieldType, TimeRange } from '@grafana/data';\nimport { VisibilityMode, TimelineValueAlignment, TooltipDisplayMode, VizTooltipOptions } from '@grafana/schema';\nimport { UPlotConfigBuilder, VizLayout, VizLegend, VizLegendItem } from '@grafana/ui';\n\nimport { GraphNG, GraphNGProps } from '../GraphNG/GraphNG';\n\nimport { preparePlotConfigBuilder, TimelineMode } from './utils';\n\n/**\n * @alpha\n */\nexport interface TimelineProps extends Omit<GraphNGProps, 'prepConfig' | 'propsToDiff' | 'renderLegend'> {\n  mode: TimelineMode;\n  rowHeight?: number;\n  showValue: VisibilityMode;\n  alignValue?: TimelineValueAlignment;\n  colWidth?: number;\n  legendItems?: VizLegendItem[];\n  tooltip?: VizTooltipOptions;\n  // Whenever `paginationRev` changes, the graph will be fully re-configured/rendered.\n  paginationRev?: string;\n}\n\nconst propsToDiff = ['rowHeight', 'colWidth', 'showValue', 'mergeValues', 'alignValue', 'tooltip', 'paginationRev'];\n\nexport class TimelineChart extends Component<TimelineProps> {\n  getValueColor = (frameIdx: number, fieldIdx: number, value: unknown) => {\n    const field = this.props.frames[frameIdx]?.fields[fieldIdx];\n\n    if (field?.display) {\n      const disp = field.display(value); // will apply color modes\n      if (disp.color) {\n        return disp.color;\n      }\n    }\n\n    return FALLBACK_COLOR;\n  };\n\n  prepConfig = (alignedFrame: DataFrame, allFrames: DataFrame[], getTimeRange: () => TimeRange) => {\n    return preparePlotConfigBuilder({\n      frame: alignedFrame,\n      getTimeRange,\n      allFrames: this.props.frames,\n      ...this.props,\n\n      // Ensure timezones is passed as an array\n      timeZones: Array.isArray(this.props.timeZone) ? this.props.timeZone : [this.props.timeZone],\n\n      // When there is only one row, use the full space\n      rowHeight: alignedFrame.fields.length > 2 ? this.props.rowHeight : 1,\n      getValueColor: this.getValueColor,\n\n      hoverMulti: this.props.tooltip?.mode === TooltipDisplayMode.Multi,\n    });\n  };\n\n  renderLegend = (config: UPlotConfigBuilder) => {\n    const { legend, legendItems } = this.props;\n\n    if (!config || !legendItems || !legend || legend.showLegend === false) {\n      return null;\n    }\n\n    return (\n      <VizLayout.Legend placement={legend.placement}>\n        <VizLegend placement={legend.placement} items={legendItems} displayMode={legend.displayMode} readonly />\n      </VizLayout.Legend>\n    );\n  };\n\n  render() {\n    return (\n      <GraphNG\n        {...this.props}\n        fields={{\n          x: (f) => f.type === FieldType.time,\n          y: (f) =>\n            f.type === FieldType.number ||\n            f.type === FieldType.boolean ||\n            f.type === FieldType.string ||\n            f.type === FieldType.enum,\n        }}\n        prepConfig={this.prepConfig}\n        propsToDiff={propsToDiff}\n        renderLegend={this.renderLegend}\n        omitHideFromViz={true}\n      />\n    );\n  }\n}\n","// mutates all nulls -> undefineds in the fieldValues array for value-less refValues ranges below maxThreshold\n// refValues is typically a time array and maxThreshold is the allowable distance between in time\nexport function nullToUndefThreshold(refValues: number[], fieldValues: unknown[], maxThreshold: number) {\n  let prevRef;\n  let nullIdx;\n\n  for (let i = 0; i < fieldValues.length; i++) {\n    let fieldVal = fieldValues[i];\n\n    if (fieldVal == null) {\n      if (nullIdx == null && prevRef != null) {\n        nullIdx = i;\n      }\n    } else {\n      if (nullIdx != null && prevRef != null) {\n        if (refValues[i] - prevRef < maxThreshold) {\n          while (nullIdx < i) {\n            fieldValues[nullIdx++] = undefined;\n          }\n        }\n\n        nullIdx = null;\n      }\n\n      prevRef = refValues[i];\n    }\n  }\n\n  return fieldValues;\n}\n","import {\n  DataFrame,\n  Field,\n  FieldType,\n  outerJoinDataFrames,\n  TimeRange,\n  applyNullInsertThreshold,\n  roundDecimals,\n} from '@grafana/data';\nimport { NULL_EXPAND, NULL_REMOVE, NULL_RETAIN, nullToUndefThreshold } from '@grafana/data/internal';\nimport { GraphDrawStyle } from '@grafana/schema';\n\nimport { XYFieldMatchers } from './types';\n\nfunction isVisibleBarField(f: Field) {\n  return (\n    f.type === FieldType.number && f.config.custom?.drawStyle === GraphDrawStyle.Bars && !f.config.custom?.hideFrom?.viz\n  );\n}\n\nexport function getRefField(frame: DataFrame, refFieldName?: string | null) {\n  return frame.fields.find((field) => {\n    // note: getFieldDisplayName() would require full DF[]\n    return refFieldName != null ? field.name === refFieldName : field.type === FieldType.time;\n  });\n}\n\n// will mutate the DataFrame's fields' values\nfunction applySpanNullsThresholds(frame: DataFrame, refFieldName?: string | null) {\n  const refField = getRefField(frame, refFieldName);\n\n  let refValues = refField?.values;\n\n  for (let i = 0; i < frame.fields.length; i++) {\n    let field = frame.fields[i];\n\n    if (field === refField || isVisibleBarField(field)) {\n      continue;\n    }\n\n    let spanNulls = field.config.custom?.spanNulls;\n\n    if (typeof spanNulls === 'number') {\n      if (spanNulls !== -1 && refValues) {\n        field.values = nullToUndefThreshold(refValues, field.values, spanNulls);\n      }\n    }\n  }\n\n  return frame;\n}\n\nfunction getXField(dimFields: XYFieldMatchers, frame: DataFrame, frames: DataFrame[]) {\n  for (let field of frame.fields) {\n    if (dimFields.x(field, frame, frames)) {\n      return field;\n    }\n  }\n\n  return;\n}\n\nexport function preparePlotFrame(frames: DataFrame[], dimFields: XYFieldMatchers, timeRange?: TimeRange | null) {\n  // apply null insertions at interval\n  frames = frames.map((frame) => {\n    const xField = getXField(dimFields, frame, frames);\n\n    if (xField != null && !xField.state?.nullThresholdApplied) {\n      return applyNullInsertThreshold({\n        frame,\n        refFieldName: xField.name,\n        refFieldPseudoMin: timeRange?.from.valueOf(),\n        refFieldPseudoMax: timeRange?.to.valueOf(),\n      });\n    } else {\n      return frame;\n    }\n  });\n\n  let numBarSeries = frames.reduce(\n    (acc, frame) => acc + frame.fields.reduce((acc, field) => acc + (isVisibleBarField(field) ? 1 : 0), 0),\n    0\n  );\n\n  // to make bar widths of all series uniform (equal to narrowest bar series), find smallest distance between x points\n  let minXDeltaGlobal: number | null = null;\n\n  if (numBarSeries > 1) {\n    // collect for each frame and only set minXDeltaGlobal if they're different\n    const minXDeltas = new Set<number>();\n\n    frames.forEach((frame) => {\n      if (!frame.fields.some(isVisibleBarField)) {\n        return;\n      }\n\n      const xField = getXField(dimFields, frame, frames);\n\n      if (xField == null) {\n        return;\n      }\n\n      let minXDeltaFrame = Infinity;\n\n      const xVals = xField.values;\n\n      for (let i = 0; i < xVals.length; i++) {\n        if (i > 0) {\n          minXDeltaFrame = Math.min(minXDeltaFrame, xVals[i] - xVals[i - 1]);\n        }\n      }\n\n      if (minXDeltaFrame !== Infinity) {\n        if (!Number.isInteger(minXDeltaFrame)) {\n          minXDeltaFrame = roundDecimals(minXDeltaFrame, 6);\n        }\n\n        minXDeltas.add(minXDeltaFrame);\n      }\n    });\n\n    if (minXDeltas.size > 1) {\n      minXDeltaGlobal = Math.min(...minXDeltas);\n    }\n  }\n\n  let alignedFrame = outerJoinDataFrames({\n    frames,\n    joinBy: dimFields.x,\n    keep: dimFields.y,\n    keepOriginIndices: true,\n\n    // the join transformer force-deletes our state.displayName cache unless keepDisplayNames: true\n    // https://github.com/grafana/grafana/pull/31121\n    // https://github.com/grafana/grafana/pull/71806\n    keepDisplayNames: true,\n\n    // prevent minesweeper-expansion of nulls (gaps) when joining bars\n    // since bar width is determined from the minimum distance between non-undefined values\n    // (this strategy will still retain any original pre-join nulls, though)\n    nullMode: (field) => {\n      if (isVisibleBarField(field)) {\n        return NULL_RETAIN;\n      }\n\n      let spanNulls = field.config.custom?.spanNulls;\n      return spanNulls === true ? NULL_REMOVE : spanNulls === -1 ? NULL_RETAIN : NULL_EXPAND;\n    },\n  });\n\n  if (alignedFrame) {\n    alignedFrame = applySpanNullsThresholds(alignedFrame, alignedFrame.fields[0].name);\n\n    // append 2 null vals at minXDeltaGlobal to bar series\n    if (minXDeltaGlobal != null) {\n      alignedFrame.fields.forEach((f, fi) => {\n        let vals = f.values;\n\n        if (fi === 0) {\n          let lastVal = vals[vals.length - 1];\n          vals.push(lastVal + minXDeltaGlobal, lastVal + 2 * minXDeltaGlobal);\n        } else if (isVisibleBarField(f)) {\n          vals.push(null, null);\n        } else {\n          vals.push(undefined, undefined);\n        }\n      });\n\n      alignedFrame.length += 2;\n    }\n\n    return alignedFrame;\n  }\n\n  return null;\n}\n","import { isEqual, uniqBy } from 'lodash';\n\nimport { GrafanaAlertStateWithReason } from 'app/types/unified-alerting-dto';\n\nexport interface Line {\n  previous: GrafanaAlertStateWithReason;\n  current: GrafanaAlertStateWithReason;\n  values?: Record<string, number>;\n  labels?: Record<string, string>;\n  fingerprint?: string;\n  ruleUID?: string;\n  error?: string;\n}\n\nexport interface LogRecord {\n  timestamp: number;\n  line: Line;\n}\n\nexport type Label = [string, string];\n\n// omit \"common\" labels from \"labels\"\nexport function omitLabels(labels: Label[], common: Label[]): Label[] {\n  return labels.filter((label) => {\n    return !common.find((commonLabel) => JSON.stringify(commonLabel) === JSON.stringify(label));\n  });\n}\n\n// find all common labels by looking at which ones occur in every record, then create a unique array of items for those\nexport function extractCommonLabels(labels: Label[][]): Label[] {\n  const flatLabels = labels.flatMap((label) => label);\n\n  const commonLabels = uniqBy(\n    flatLabels.filter((label) => {\n      const count = flatLabels.filter((l) => isEqual(label, l)).length;\n      return count === Object.keys(labels).length;\n    }),\n    (label) => JSON.stringify(label)\n  );\n\n  return commonLabels;\n}\n","import { Component } from 'react';\nimport * as React from 'react';\nimport uPlot, { AlignedData } from 'uplot';\n\nimport {\n  DataFrame,\n  DataLinkPostProcessor,\n  Field,\n  FieldMatcherID,\n  fieldMatchers,\n  FieldType,\n  getLinksSupplier,\n  InterpolateFunction,\n  TimeRange,\n  TimeZone,\n} from '@grafana/data';\nimport { DashboardCursorSync, VizLegendOptions } from '@grafana/schema';\nimport { Themeable2, VizLayout } from '@grafana/ui';\nimport { UPlotChart, AxisProps, Renderers, UPlotConfigBuilder, ScaleProps, pluginLog } from '@grafana/ui/internal';\n\nimport { GraphNGLegendEvent, XYFieldMatchers } from './types';\nimport { preparePlotFrame as defaultPreparePlotFrame } from './utils';\n\n/**\n * @internal -- not a public API\n */\nexport type PropDiffFn<T extends Record<string, unknown> = {}> = (prev: T, next: T) => boolean;\n\nexport interface GraphNGProps extends Themeable2 {\n  frames: DataFrame[];\n  structureRev?: number; // a number that will change when the frames[] structure changes\n  width: number;\n  height: number;\n  timeRange: TimeRange;\n  timeZone: TimeZone[] | TimeZone;\n  legend: VizLegendOptions;\n  fields?: XYFieldMatchers; // default will assume timeseries data\n  renderers?: Renderers;\n  tweakScale?: (opts: ScaleProps, forField: Field) => ScaleProps;\n  tweakAxis?: (opts: AxisProps, forField: Field) => AxisProps;\n  onLegendClick?: (event: GraphNGLegendEvent) => void;\n  children?: (builder: UPlotConfigBuilder, alignedFrame: DataFrame) => React.ReactNode;\n  prepConfig: (alignedFrame: DataFrame, allFrames: DataFrame[], getTimeRange: () => TimeRange) => UPlotConfigBuilder;\n  propsToDiff?: Array<string | PropDiffFn>;\n  preparePlotFrame?: (frames: DataFrame[], dimFields: XYFieldMatchers) => DataFrame | null;\n  renderLegend: (config: UPlotConfigBuilder) => React.ReactElement | null;\n  replaceVariables: InterpolateFunction;\n  dataLinkPostProcessor?: DataLinkPostProcessor;\n  cursorSync?: DashboardCursorSync;\n\n  // Remove fields that are hidden from the visualization before rendering\n  // The fields will still be available for other things like data links\n  // this is a temporary hack that only works when:\n  // 1. renderLegend (above) does not render <PlotLegend>\n  // 2. does not have legend series toggle\n  // 3. passes through all fields required for link/action gen (including those with hideFrom.viz)\n  omitHideFromViz?: boolean;\n\n  /**\n   * needed for propsToDiff to re-init the plot & config\n   * this is a generic approach to plot re-init, without having to specify which panel-level options\n   * should cause invalidation. we can drop this in favor of something like panelOptionsRev that gets passed in\n   * similar to structureRev. then we can drop propsToDiff entirely.\n   */\n  options?: Record<string, any>;\n}\n\nfunction sameProps<T extends Record<string, unknown>>(\n  prevProps: T,\n  nextProps: T,\n  propsToDiff: Array<string | PropDiffFn> = []\n) {\n  for (const propName of propsToDiff) {\n    if (typeof propName === 'function') {\n      if (!propName(prevProps, nextProps)) {\n        return false;\n      }\n    } else if (nextProps[propName] !== prevProps[propName]) {\n      return false;\n    }\n  }\n\n  return true;\n}\n\n/**\n * @internal -- not a public API\n */\nexport interface GraphNGState {\n  alignedFrame: DataFrame;\n  alignedData?: AlignedData;\n  config?: UPlotConfigBuilder;\n}\n\nconst defaultMatchers = {\n  x: fieldMatchers.get(FieldMatcherID.firstTimeField).get({}),\n  y: fieldMatchers.get(FieldMatcherID.byTypes).get(new Set([FieldType.number, FieldType.enum])),\n};\n\n/**\n * \"Time as X\" core component, expects ascending x\n */\nexport class GraphNG extends Component<GraphNGProps, GraphNGState> {\n  private plotInstance: React.RefObject<uPlot>;\n\n  constructor(props: GraphNGProps) {\n    super(props);\n    let state = this.prepState(props);\n    state.alignedData = state.config!.prepData!([state.alignedFrame]) as AlignedData;\n    this.state = state;\n    this.plotInstance = React.createRef();\n  }\n\n  getTimeRange = () => this.props.timeRange;\n\n  prepState(props: GraphNGProps, withConfig = true) {\n    let state: GraphNGState = null as any;\n\n    const { frames, fields = defaultMatchers, preparePlotFrame, replaceVariables, dataLinkPostProcessor } = props;\n\n    const preparePlotFrameFn = preparePlotFrame ?? defaultPreparePlotFrame;\n\n    const withLinks = frames.some((frame) => frame.fields.some((field) => (field.config.links?.length ?? 0) > 0));\n\n    const alignedFrame = preparePlotFrameFn(\n      frames,\n      {\n        ...fields,\n        // if there are data links, keep all fields during join so they're index-matched\n        y: withLinks ? () => true : fields.y,\n      },\n      props.timeRange\n    );\n\n    pluginLog('GraphNG', false, 'data aligned', alignedFrame);\n\n    if (alignedFrame) {\n      let alignedFrameFinal = alignedFrame;\n\n      if (withLinks) {\n        const timeZone = Array.isArray(this.props.timeZone) ? this.props.timeZone[0] : this.props.timeZone;\n\n        // for links gen we need to use original frames but with the aligned/joined data values\n        let linkFrames = frames.map((frame, frameIdx) => ({\n          ...frame,\n          fields: alignedFrame.fields.filter(\n            (field, fieldIdx) => fieldIdx === 0 || field.state?.origin?.frameIndex === frameIdx\n          ),\n          length: alignedFrame.length,\n        }));\n\n        linkFrames.forEach((linkFrame, frameIndex) => {\n          linkFrame.fields.forEach((field) => {\n            field.getLinks = getLinksSupplier(\n              linkFrame,\n              field,\n              {\n                ...field.state?.scopedVars,\n                __dataContext: {\n                  value: {\n                    data: linkFrames,\n                    field: field,\n                    frame: linkFrame,\n                    frameIndex,\n                  },\n                },\n              },\n              replaceVariables,\n              timeZone,\n              dataLinkPostProcessor\n            );\n          });\n        });\n\n        // filter join field and fields.y\n        alignedFrameFinal = {\n          ...alignedFrame,\n          fields: alignedFrame.fields.filter((field, i) => i === 0 || fields.y(field, alignedFrame, [alignedFrame])),\n        };\n      }\n\n      if (props.omitHideFromViz) {\n        const nonHiddenFields = alignedFrameFinal.fields.filter((field) => field.config.custom?.hideFrom?.viz !== true);\n        alignedFrameFinal = {\n          ...alignedFrameFinal,\n          fields: nonHiddenFields,\n          length: nonHiddenFields.length,\n        };\n      }\n\n      let config = this.state?.config;\n\n      if (withConfig) {\n        config = props.prepConfig(alignedFrameFinal, this.props.frames, this.getTimeRange);\n        pluginLog('GraphNG', false, 'config prepared', config);\n      }\n\n      state = {\n        alignedFrame: alignedFrameFinal,\n        config,\n      };\n\n      pluginLog('GraphNG', false, 'data prepared', state.alignedData);\n    }\n\n    return state;\n  }\n\n  componentDidUpdate(prevProps: GraphNGProps) {\n    const { frames, structureRev, timeZone, cursorSync, propsToDiff } = this.props;\n\n    const propsChanged = !sameProps(prevProps, this.props, propsToDiff);\n\n    if (\n      frames !== prevProps.frames ||\n      propsChanged ||\n      timeZone !== prevProps.timeZone ||\n      cursorSync !== prevProps.cursorSync\n    ) {\n      let newState = this.prepState(this.props, false);\n\n      if (newState) {\n        const shouldReconfig =\n          this.state.config === undefined ||\n          timeZone !== prevProps.timeZone ||\n          cursorSync !== prevProps.cursorSync ||\n          structureRev !== prevProps.structureRev ||\n          !structureRev ||\n          propsChanged;\n\n        if (shouldReconfig) {\n          newState.config = this.props.prepConfig(newState.alignedFrame, this.props.frames, this.getTimeRange);\n          pluginLog('GraphNG', false, 'config recreated', newState.config);\n        }\n\n        newState.alignedData = newState.config!.prepData!([newState.alignedFrame]) as AlignedData;\n\n        this.setState(newState);\n      }\n    }\n  }\n\n  render() {\n    const { width, height, children, renderLegend } = this.props;\n    const { config, alignedFrame, alignedData } = this.state;\n\n    if (!config) {\n      return null;\n    }\n\n    return (\n      <VizLayout width={width} height={height} legend={renderLegend(config)}>\n        {(vizWidth: number, vizHeight: number) => (\n          <UPlotChart\n            config={config}\n            data={alignedData!}\n            width={vizWidth}\n            height={vizHeight}\n            plotRef={(u) => ((this.plotInstance as React.MutableRefObject<uPlot>).current = u)}\n          >\n            {children ? children(config, alignedFrame) : null}\n          </UPlotChart>\n        )}\n      </VizLayout>\n    );\n  }\n}\n","import { t } from '@grafana/i18n';\nimport { Box, Stack, Text } from '@grafana/ui';\n\ninterface ErrorMessageRowProps {\n  message: string;\n}\n\nexport function ErrorMessageRow({ message }: ErrorMessageRowProps) {\n  return (\n    <div data-testid=\"state-history-error\">\n      <Box\n        display=\"block\"\n        backgroundColor=\"secondary\"\n        borderStyle=\"solid\"\n        borderColor=\"weak\"\n        borderRadius=\"default\"\n        paddingY={1}\n        paddingX={2}\n        marginTop={0.5}\n      >\n        <Stack direction=\"row\" alignItems=\"center\" gap={2} wrap={false}>\n          <Box shrink={0}>\n            <Text variant=\"bodySmall\" weight=\"medium\" element=\"span\">\n              {t('alerting.state-history.error-message-prefix', 'Error message:')}\n            </Text>\n          </Box>\n          <Box grow={1} shrink={1} minWidth={0}>\n            <Text variant=\"bodySmall\" truncate element=\"p\">\n              {message}\n            </Text>\n          </Box>\n        </Stack>\n      </Box>\n    </div>\n  );\n}\n","import { css } from '@emotion/css';\nimport { formatDistanceToNowStrict } from 'date-fns';\nimport { groupBy, uniqueId } from 'lodash';\nimport { Fragment, memo, useEffect, useRef } from 'react';\n\nimport { GrafanaTheme2, dateTimeFormat } from '@grafana/data';\nimport { Trans, t } from '@grafana/i18n';\nimport { Icon, Stack, TagList, useStyles2 } from '@grafana/ui';\nimport { GrafanaAlertState, mapStateWithReasonToBaseState } from 'app/types/unified-alerting-dto';\n\nimport { Label } from '../../Label';\nimport { AlertStateTag } from '../AlertStateTag';\n\nimport { ErrorMessageRow } from './ErrorMessageRow';\nimport { LogRecord, omitLabels } from './common';\n\ntype LogRecordViewerProps = {\n  records: LogRecord[];\n  commonLabels: Array<[string, string]>;\n};\n\ntype AdditionalLogRecordViewerProps = {\n  onRecordsRendered?: (timestampRefs: Map<number, HTMLElement>) => void;\n  onLabelClick?: (label: string) => void;\n};\n\nfunction groupRecordsByTimestamp(records: LogRecord[]) {\n  // groupBy has been replaced by the reduce to avoid back and forth conversion of timestamp from number to string\n  const groupedLines = records.reduce((acc, current) => {\n    const tsGroup = acc.get(current.timestamp);\n    if (tsGroup) {\n      tsGroup.push(current);\n    } else {\n      acc.set(current.timestamp, [current]);\n    }\n\n    return acc;\n  }, new Map<number, LogRecord[]>());\n\n  return new Map([...groupedLines].sort((a, b) => b[0] - a[0]));\n}\n\nexport const LogRecordViewerByTimestamp = memo(\n  ({\n    records,\n    commonLabels,\n    onLabelClick,\n    onRecordsRendered,\n  }: LogRecordViewerProps & AdditionalLogRecordViewerProps) => {\n    const styles = useStyles2(getStyles);\n\n    const groupedLines = groupRecordsByTimestamp(records);\n\n    const timestampRefs = useRef<Map<number, HTMLElement>>(new Map());\n    useEffect(() => {\n      onRecordsRendered && onRecordsRendered(timestampRefs.current);\n    }, [onRecordsRendered, records]);\n\n    return (\n      <ul\n        className={styles.logsScrollable}\n        aria-label={t(\n          'alerting.log-record-viewer-by-timestamp.aria-label-state-history-by-timestamp',\n          'State history by timestamp'\n        )}\n      >\n        {Array.from(groupedLines.entries()).map(([key, records]) => {\n          return (\n            <li\n              id={key.toString(10)}\n              key={key}\n              data-testid={key}\n              ref={(element) => {\n                if (element) {\n                  timestampRefs.current.set(key, element);\n                } else {\n                  timestampRefs.current.delete(key);\n                }\n              }}\n              className={styles.listItemWrapper}\n            >\n              <Timestamp time={key} />\n              {records.map(({ line }, idx) => {\n                const id = line.fingerprint ?? `${key}-${idx}`;\n\n                const isErrorRow =\n                  mapStateWithReasonToBaseState(line.current) === GrafanaAlertState.Error && Boolean(line.error);\n                return (\n                  <Fragment key={id}>\n                    <div className={styles.logsContainer}>\n                      <AlertStateTag state={line.previous} size=\"sm\" muted />\n                      <Icon name=\"arrow-right\" size=\"sm\" />\n                      <AlertStateTag state={line.current} />\n                      <Stack>{line.values && <AlertInstanceValues record={line.values} />}</Stack>\n                      <div>\n                        {line.labels && (\n                          <TagList\n                            tags={omitLabels(Object.entries(line.labels), commonLabels).map(\n                              ([key, value]) => `${key}=${value}`\n                            )}\n                            onClick={onLabelClick}\n                          />\n                        )}\n                      </div>\n                    </div>\n                    {isErrorRow && line.error && <ErrorMessageRow message={line.error} />}\n                  </Fragment>\n                );\n              })}\n            </li>\n          );\n        })}\n      </ul>\n    );\n  }\n);\nLogRecordViewerByTimestamp.displayName = 'LogRecordViewerByTimestamp';\n\nexport function LogRecordViewerByInstance({ records, commonLabels }: LogRecordViewerProps) {\n  const styles = useStyles2(getStyles);\n\n  const groupedLines = groupBy(records, (record: LogRecord) => {\n    return JSON.stringify(record.line.labels);\n  });\n\n  return (\n    <>\n      {Object.entries(groupedLines).map(([key, records]) => {\n        return (\n          <Stack direction=\"column\" key={key}>\n            <h4>\n              <TagList\n                tags={omitLabels(Object.entries(records[0].line.labels ?? {}), commonLabels).map(\n                  ([key, value]) => `${key}=${value}`\n                )}\n              />\n            </h4>\n            <div className={styles.logsContainer}>\n              {records.map(({ line, timestamp }) => (\n                <div key={uniqueId()}>\n                  <AlertStateTag state={line.previous} size=\"sm\" muted />\n                  <Icon name=\"arrow-right\" size=\"sm\" />\n                  <AlertStateTag state={line.current} />\n                  <Stack>{line.values && <AlertInstanceValues record={line.values} />}</Stack>\n                  <div>{dateTimeFormat(timestamp)}</div>\n                </div>\n              ))}\n            </div>\n          </Stack>\n        );\n      })}\n    </>\n  );\n}\n\ninterface TimestampProps {\n  time: number; // epoch timestamp\n}\n\nconst Timestamp = ({ time }: TimestampProps) => {\n  const dateTime = new Date(time);\n  const styles = useStyles2(getStyles);\n\n  return (\n    <div className={styles.timestampWrapper}>\n      <Stack alignItems=\"center\" gap={1}>\n        <Icon name=\"clock-nine\" size=\"sm\" />\n        <span className={styles.timestampText}>{dateTimeFormat(dateTime)}</span>\n        <small>\n          <Trans i18nKey=\"alerting.timestamp.time-ago\" values={{ time: formatDistanceToNowStrict(dateTime) }}>\n            ({'{{time}}'} ago)\n          </Trans>\n        </small>\n      </Stack>\n    </div>\n  );\n};\n\nconst AlertInstanceValues = memo(({ record }: { record: Record<string, number> }) => {\n  const values = Object.entries(record);\n\n  return (\n    <>\n      {values.map(([key, value]) => (\n        <Label key={key} label={key} value={value} />\n      ))}\n    </>\n  );\n});\nAlertInstanceValues.displayName = 'AlertInstanceValues';\n\nconst getStyles = (theme: GrafanaTheme2) => ({\n  logsContainer: css({\n    display: 'grid',\n    gridTemplateColumns: 'max-content max-content max-content auto max-content',\n    gap: theme.spacing(2, 1),\n    alignItems: 'center',\n  }),\n  logsScrollable: css({\n    height: '500px',\n    overflow: 'scroll',\n\n    flex: 1,\n  }),\n  timestampWrapper: css({\n    color: theme.colors.text.secondary,\n  }),\n  timestampText: css({\n    color: theme.colors.text.primary,\n    fontSize: theme.typography.bodySmall.fontSize,\n    fontWeight: theme.typography.fontWeightBold,\n  }),\n  listItemWrapper: css({\n    background: 'transparent',\n    outline: '1px solid transparent',\n    padding: `${theme.spacing(1)} ${theme.spacing(1.5)}`,\n    [theme.transitions.handleMotion('no-preference', 'reduce')]: {\n      transition: 'background 150ms, outline 150ms',\n    },\n  }),\n});\n","import { css } from '@emotion/css';\nimport { fromPairs, isEmpty, sortBy, take, uniq } from 'lodash';\nimport * as React from 'react';\nimport { useCallback, useMemo, useRef, useState } from 'react';\nimport { useForm } from 'react-hook-form';\n\nimport { DataFrame, GrafanaTheme2, TimeRange, dateTime } from '@grafana/data';\nimport { Trans, t } from '@grafana/i18n';\nimport { Alert, Button, Field, Icon, Input, Label, Stack, Text, Tooltip, useStyles2 } from '@grafana/ui';\n\nimport { stateHistoryApi } from '../../../api/stateHistoryApi';\nimport { combineMatcherStrings } from '../../../utils/alertmanager';\nimport { AlertLabels } from '../../AlertLabels';\nimport { PopupCard } from '../../HoverCard';\n\nimport { LogRecordViewerByTimestamp } from './LogRecordViewer';\nimport { LogTimelineViewer } from './LogTimelineViewer';\nimport { useRuleHistoryRecords } from './useRuleHistoryRecords';\n\ninterface Props {\n  ruleUID: string;\n}\n\nconst STATE_HISTORY_POLLING_INTERVAL = 10 * 1000; // 10 seconds\nconst MAX_TIMELINE_SERIES = 12;\n\nconst LokiStateHistory = ({ ruleUID }: Props) => {\n  const styles = useStyles2(getStyles);\n  const [instancesFilter, setInstancesFilter] = useState('');\n  const logsRef = useRef<Map<number, HTMLElement>>(new Map<number, HTMLElement>());\n\n  const { getValues, setValue, register, handleSubmit } = useForm({ defaultValues: { query: '' } });\n\n  const { useGetRuleHistoryQuery } = stateHistoryApi;\n\n  // We prefer log count-based limit rather than time-based, but the API doesn't support it yet\n  const queryTimeRange = useMemo(() => getDefaultTimeRange(), []);\n\n  const {\n    currentData: stateHistory,\n    isLoading,\n    isError,\n    error,\n  } = useGetRuleHistoryQuery(\n    {\n      ruleUid: ruleUID,\n      from: queryTimeRange.from.unix(),\n      to: queryTimeRange.to.unix(),\n      limit: 250,\n    },\n    {\n      refetchOnFocus: true,\n      refetchOnReconnect: true,\n      pollingInterval: STATE_HISTORY_POLLING_INTERVAL,\n    }\n  );\n\n  const { dataFrames, historyRecords, commonLabels, totalRecordsCount } = useRuleHistoryRecords(\n    stateHistory,\n    instancesFilter\n  );\n\n  const { frameSubset, frameTimeRange } = useFrameSubset(dataFrames);\n\n  const onLogRecordLabelClick = useCallback(\n    (label: string) => {\n      const matcherString = combineMatcherStrings(getValues('query'), label);\n      setInstancesFilter(matcherString);\n      setValue('query', matcherString);\n    },\n    [setInstancesFilter, setValue, getValues]\n  );\n\n  const onFilterCleared = useCallback(() => {\n    setInstancesFilter('');\n    setValue('query', '');\n  }, [setInstancesFilter, setValue]);\n\n  if (isLoading) {\n    return (\n      <div>\n        <Trans i18nKey=\"alerting.loki-state-history.loading\">Loading...</Trans>\n      </div>\n    );\n  }\n  if (isError) {\n    return (\n      <Alert\n        title={t(\n          'alerting.loki-state-history.title-error-fetching-the-state-history',\n          'Error fetching the state history'\n        )}\n        severity=\"error\"\n      >\n        {error instanceof Error\n          ? error.message\n          : t('alerting.loki-state-history.error-unable-to-fetch', 'Unable to fetch alert state history')}\n      </Alert>\n    );\n  }\n\n  const hasMoreInstances = frameSubset.length < dataFrames.length;\n  const emptyStateMessage =\n    totalRecordsCount > 0\n      ? `No matches were found for the given filters among the ${totalRecordsCount} instances`\n      : 'No state transitions have occurred in the last 30 days';\n\n  return (\n    <div className={styles.fullSize}>\n      <form onSubmit={handleSubmit((data) => setInstancesFilter(data.query))}>\n        <SearchFieldInput\n          {...register('query')}\n          showClearFilterSuffix={!!instancesFilter}\n          onClearFilterClick={onFilterCleared}\n        />\n        <input type=\"submit\" hidden />\n      </form>\n      {!isEmpty(commonLabels) && (\n        <Stack gap={1} alignItems=\"center\" wrap=\"wrap\">\n          <Stack gap={0.5} alignItems=\"center\" minWidth=\"fit-content\">\n            <Text variant=\"bodySmall\">\n              <Trans i18nKey=\"alerting.loki-state-history.common-labels\">Common labels</Trans>\n            </Text>\n            <Tooltip\n              content={t(\n                'alerting.loki-state-history.tooltip-common-labels',\n                'Common labels are the ones attached to all of the alert instances'\n              )}\n            >\n              <Icon name=\"info-circle\" size=\"sm\" />\n            </Tooltip>\n          </Stack>\n          <AlertLabels labels={fromPairs(commonLabels)} size=\"sm\" />\n        </Stack>\n      )}\n      {isEmpty(frameSubset) ? (\n        <div className={styles.emptyState}>\n          {emptyStateMessage}\n          {totalRecordsCount > 0 && (\n            <Button variant=\"secondary\" type=\"button\" onClick={onFilterCleared}>\n              <Trans i18nKey=\"alerting.loki-state-history.clear-filters\">Clear filters</Trans>\n            </Button>\n          )}\n        </div>\n      ) : (\n        <>\n          <div className={styles.graphWrapper}>\n            <LogTimelineViewer frames={frameSubset} timeRange={frameTimeRange} />\n          </div>\n          {hasMoreInstances && (\n            <div className={styles.moreInstancesWarning}>\n              <Stack direction=\"row\" alignItems=\"center\" gap={1}>\n                <Icon name=\"exclamation-triangle\" size=\"sm\" />\n                <small>{`Only showing ${frameSubset.length} out of ${dataFrames.length} instances. Click on the labels to narrow down the results`}</small>\n              </Stack>\n            </div>\n          )}\n          <LogRecordViewerByTimestamp\n            records={historyRecords}\n            commonLabels={commonLabels}\n            onRecordsRendered={(recordRefs) => (logsRef.current = recordRefs)}\n            onLabelClick={onLogRecordLabelClick}\n          />\n        </>\n      )}\n    </div>\n  );\n};\n\nexport function useFrameSubset(frames: DataFrame[]) {\n  return useMemo(() => {\n    const frameSubset = take(frames, MAX_TIMELINE_SERIES);\n    const frameSubsetTimestamps = sortBy(uniq(frameSubset.flatMap((frame) => frame.fields[0].values)));\n\n    const minTs = Math.min(...frameSubsetTimestamps);\n    const maxTs = Math.max(...frameSubsetTimestamps);\n\n    const rangeStart = dateTime(minTs);\n    const rangeStop = dateTime(maxTs);\n\n    const frameTimeRange: TimeRange = {\n      from: rangeStart,\n      to: rangeStop,\n      raw: {\n        from: rangeStart,\n        to: rangeStop,\n      },\n    };\n\n    return { frameSubset, frameSubsetTimestamps, frameTimeRange };\n  }, [frames]);\n}\n\ninterface SearchFieldInputProps extends Omit<React.ComponentProps<typeof Input>, 'prefix' | 'suffix' | 'placeholder'> {\n  showClearFilterSuffix: boolean;\n  onClearFilterClick: () => void;\n}\n\nconst SearchFieldInput = React.forwardRef<HTMLInputElement, SearchFieldInputProps>(\n  ({ showClearFilterSuffix, onClearFilterClick, ...rest }: SearchFieldInputProps, ref) => {\n    return (\n      <Field\n        label={\n          <Label htmlFor=\"instancesSearchInput\">\n            <Stack gap={0.5}>\n              <span>\n                <Trans i18nKey=\"alerting.search-field-input.filter-instances\">Filter instances</Trans>\n              </span>\n              <PopupCard\n                content={\n                  <>\n                    <Trans i18nKey=\"alerting.search-field-input.filter-instances-tooltip\">\n                      Use label matcher expression or click on an instance label to filter instances, for example:\n                    </Trans>\n                    <div>\n                      <code>{'{foo=bar}'}</code>\n                    </div>\n                  </>\n                }\n              >\n                <Icon name=\"info-circle\" size=\"sm\" />\n              </PopupCard>\n            </Stack>\n          </Label>\n        }\n      >\n        <Input\n          id=\"instancesSearchInput\"\n          prefix={<Icon name=\"search\" />}\n          suffix={\n            showClearFilterSuffix && (\n              <Button fill=\"text\" icon=\"times\" size=\"sm\" onClick={onClearFilterClick}>\n                <Trans i18nKey=\"alerting.search-field-input.clear\">Clear</Trans>\n              </Button>\n            )\n          }\n          placeholder={t(\n            'alerting.search-field-input.instancesSearchInput-placeholder-filter-instances',\n            'Filter instances'\n          )}\n          ref={ref}\n          {...rest}\n        />\n      </Field>\n    );\n  }\n);\nSearchFieldInput.displayName = 'SearchFieldInput';\n\nfunction getDefaultTimeRange(): TimeRange {\n  const fromDateTime = dateTime().subtract(30, 'days');\n  const toDateTime = dateTime();\n  return {\n    from: fromDateTime,\n    to: toDateTime,\n    raw: { from: fromDateTime, to: toDateTime },\n  };\n}\n\nexport const getStyles = (theme: GrafanaTheme2) => ({\n  fullSize: css({\n    minWidth: '100%',\n    height: '100%',\n\n    display: 'flex',\n    flexDirection: 'column',\n  }),\n  graphWrapper: css({\n    padding: `${theme.spacing()} 0`,\n  }),\n  emptyState: css({\n    color: theme.colors.text.secondary,\n\n    display: 'flex',\n    flexDirection: 'column',\n    gap: theme.spacing(2),\n    alignItems: 'center',\n    margin: 'auto auto',\n  }),\n  moreInstancesWarning: css({\n    color: theme.colors.warning.text,\n    padding: theme.spacing(),\n  }),\n  // we need !important here to override the list item default styles\n  highlightedLogRecord: css({\n    background: `${theme.colors.primary.transparent} !important`,\n    outline: `1px solid ${theme.colors.primary.shade} !important`,\n  }),\n});\n\nexport default LokiStateHistory;\n","import { DataFrameJSON } from '@grafana/data';\n\nimport { alertingApi } from './alertingApi';\n\nexport const stateHistoryApi = alertingApi.injectEndpoints({\n  endpoints: (build) => ({\n    getRuleHistory: build.query<\n      DataFrameJSON,\n      {\n        ruleUid?: string;\n        from?: number;\n        to?: number;\n        limit?: number;\n        labels?: Record<string, string>;\n        previous?: string;\n        current?: string;\n      }\n    >({\n      query: ({ ruleUid, from, to, limit = 100, labels, previous, current }) => {\n        const params: Record<string, string | number | undefined> = {\n          ruleUID: ruleUid,\n          from,\n          to,\n          limit,\n          previous,\n          current,\n        };\n\n        if (labels) {\n          Object.entries(labels).forEach(([key, value]) => {\n            params[`labels_${key}`] = value;\n          });\n        }\n\n        return {\n          url: '/api/v1/rules/history',\n          params,\n        };\n      },\n    }),\n  }),\n});\n","import { memo } from 'react';\nimport AutoSizer from 'react-virtualized-auto-sizer';\n\nimport { DataFrame, InterpolateFunction, TimeRange } from '@grafana/data';\nimport { t } from '@grafana/i18n';\nimport { VisibilityMode } from '@grafana/schema';\nimport { LegendDisplayMode, useTheme2 } from '@grafana/ui';\nimport { TimelineChart } from 'app/core/components/TimelineChart/TimelineChart';\nimport { TimelineMode } from 'app/core/components/TimelineChart/utils';\n\ninterface LogTimelineViewerProps {\n  frames: DataFrame[];\n  timeRange: TimeRange;\n}\n\n// noop\nconst replaceVariables: InterpolateFunction = (v) => v;\n\nexport const LogTimelineViewer = memo(({ frames, timeRange }: LogTimelineViewerProps) => {\n  const theme = useTheme2();\n\n  return (\n    <AutoSizer disableHeight>\n      {({ width }) => (\n        <TimelineChart\n          frames={frames}\n          timeRange={timeRange}\n          timeZone={'browser'}\n          mode={TimelineMode.Changes}\n          height={18 * frames.length + 50}\n          width={width}\n          showValue={VisibilityMode.Never}\n          theme={theme}\n          rowHeight={0.8}\n          legend={{\n            calcs: [],\n            displayMode: LegendDisplayMode.List,\n            placement: 'bottom',\n            showLegend: true,\n          }}\n          legendItems={[\n            {\n              label: t('alerting.log-timeline-viewer.label.normal', 'Normal'),\n              color: theme.colors.success.main,\n              yAxis: 1,\n            },\n            {\n              label: t('alerting.log-timeline-viewer.label.pending', 'Pending'),\n              color: theme.colors.warning.main,\n              yAxis: 1,\n            },\n            {\n              label: t('alerting.log-timeline-viewer.label.recovering', 'Recovering'),\n              color: theme.colors.warning.main,\n              yAxis: 1,\n            },\n            {\n              label: t('alerting.log-timeline-viewer.label.firing', 'Firing'),\n              color: theme.colors.error.main,\n              yAxis: 1,\n            },\n            {\n              label: t('alerting.log-timeline-viewer.label.no-data', 'No Data'),\n              color: theme.colors.info.main,\n              yAxis: 1,\n            },\n            {\n              label: t('alerting.log-timeline-viewer.label.mixed', 'Mixed'),\n              color: theme.colors.text.secondary,\n              yAxis: 1,\n            },\n          ]}\n          replaceVariables={replaceVariables}\n        />\n      )}\n    </AutoSizer>\n  );\n});\n\nLogTimelineViewer.displayName = 'LogTimelineViewer';\n","import { groupBy } from 'lodash';\nimport { useMemo } from 'react';\n\nimport {\n  DataFrame,\n  Field as DataFrameField,\n  DataFrameJSON,\n  FieldType,\n  GrafanaTheme2,\n  getDisplayProcessor,\n} from '@grafana/data';\nimport { fieldIndexComparer } from '@grafana/data/internal';\nimport { MappingType, ThresholdsMode } from '@grafana/schema';\nimport { useTheme2 } from '@grafana/ui';\n\nimport { labelsMatchMatchers } from '../../../utils/alertmanager';\nimport { parsePromQLStyleMatcherLooseSafe } from '../../../utils/matchers';\n\nimport { Line, LogRecord, extractCommonLabels, omitLabels } from './common';\n\nexport function useRuleHistoryRecords(stateHistory?: DataFrameJSON, filter?: string) {\n  const theme = useTheme2();\n\n  return useMemo(() => {\n    // merge timestamp with \"line\"\n    const tsValues = stateHistory?.data?.values[0] ?? [];\n    const timestamps: number[] = isNumbers(tsValues) ? tsValues : [];\n    const lines = stateHistory?.data?.values[1] ?? [];\n\n    const logRecords = timestamps.reduce((acc: LogRecord[], timestamp: number, index: number) => {\n      const line = lines[index];\n      // values property can be undefined for some instance states (e.g. NoData)\n      if (isLine(line)) {\n        acc.push({ timestamp, line });\n      }\n\n      return acc;\n    }, []);\n\n    // group all records by alert instance (unique set of labels)\n    const logRecordsByInstance = groupBy(logRecords, (record: LogRecord) => {\n      return JSON.stringify(record.line.labels);\n    });\n\n    // CommonLabels should not be affected by the filter\n    // find common labels so we can extract those from the instances\n    const groupLabels = Object.keys(logRecordsByInstance);\n    const groupLabelsArray: Array<Array<[string, string]>> = groupLabels.map((label) => {\n      return Object.entries(JSON.parse(label));\n    });\n\n    const commonLabels = extractCommonLabels(groupLabelsArray);\n\n    const filterMatchers = filter ? parsePromQLStyleMatcherLooseSafe(filter) : [];\n    const filteredGroupedLines = Object.entries(logRecordsByInstance).filter(([key]) => {\n      const labels = JSON.parse(key);\n      return labelsMatchMatchers(labels, filterMatchers);\n    });\n\n    const dataFrames: DataFrame[] = filteredGroupedLines.map<DataFrame>(([key, records]) => {\n      return logRecordsToDataFrame(key, records, commonLabels, theme);\n    });\n\n    return {\n      historyRecords: logRecords.filter(({ line }) => line.labels && labelsMatchMatchers(line.labels, filterMatchers)),\n      dataFrames,\n      commonLabels,\n      totalRecordsCount: logRecords.length,\n    };\n  }, [stateHistory, filter, theme]);\n}\n\nexport function isNumbers(value: unknown[]): value is number[] {\n  return value.every((v) => typeof v === 'number');\n}\n\nexport function isLine(value: unknown): value is Line {\n  return typeof value === 'object' && value !== null && 'current' in value && 'previous' in value;\n}\n\n// Each alert instance is represented by a data frame\n// Each frame consists of two fields: timestamp and state change\nexport function logRecordsToDataFrame(\n  instanceLabels: string,\n  records: LogRecord[],\n  commonLabels: Array<[string, string]>,\n  theme: GrafanaTheme2\n): DataFrame {\n  const parsedInstanceLabels = Object.entries<string>(JSON.parse(instanceLabels));\n\n  // There is an artificial element at the end meaning Date.now()\n  // It exist to draw the state change from when it happened to the current time\n  const timeField: DataFrameField = {\n    name: 'time',\n    type: FieldType.time,\n    values: [...records.map((record) => record.timestamp), Date.now()],\n    config: { displayName: 'Time', custom: { fillOpacity: 100 } },\n  };\n\n  const timeIndex = timeField.values.map((_, index) => index);\n  timeIndex.sort(fieldIndexComparer(timeField));\n\n  const stateValues = [...records.map((record) => record.line.current), records.at(-1)?.line.current];\n\n  const frame: DataFrame = {\n    fields: [\n      {\n        ...timeField,\n        values: timeField.values.map((_, i) => timeField.values[timeIndex[i]]),\n      },\n      {\n        name: 'State',\n        type: FieldType.string,\n        values: stateValues.map((_, i) => stateValues[timeIndex[i]]),\n        config: {\n          displayName: omitLabels(parsedInstanceLabels, commonLabels)\n            .map(([key, label]) => `${key}=${label}`)\n            .join(', '),\n          color: { mode: 'thresholds' },\n          custom: { fillOpacity: 100 },\n          mappings: [\n            {\n              type: MappingType.RegexToText,\n              options: {\n                //  Map as a regex so we capture `Normal`, and `Normal (Updated)`\n                pattern: '/^normal/i',\n                result: { color: theme.colors.success.main },\n              },\n            },\n            {\n              type: MappingType.RegexToText,\n              options: {\n                pattern: '/Alerting/',\n                result: { color: theme.colors.error.main },\n              },\n            },\n            {\n              type: MappingType.ValueToText,\n              options: {\n                Pending: {\n                  color: theme.colors.warning.main,\n                },\n                Recovering: {\n                  color: theme.colors.warning.main,\n                },\n                NoData: {\n                  color: theme.colors.info.main,\n                },\n              },\n            },\n          ],\n          thresholds: {\n            mode: ThresholdsMode.Absolute,\n            steps: [],\n          },\n        },\n      },\n    ],\n    length: timeField.values.length,\n    name: instanceLabels,\n  };\n\n  frame.fields.forEach((field) => {\n    field.display = getDisplayProcessor({ field, theme });\n  });\n\n  return frame;\n}\n"],"names":["propsToDiff","TimelineChart","frameIdx","fieldIdx","value","field","disp","alignedFrame","allFrames","getTimeRange","config","legend","legendItems","f","nullToUndefThreshold","refValues","fieldValues","maxThreshold","prevRef","nullIdx","i","isVisibleBarField","getRefField","frame","refFieldName","applySpanNullsThresholds","refField","spanNulls","getXField","dimFields","frames","preparePlotFrame","timeRange","xField","numBarSeries","acc","minXDeltaGlobal","minXDeltas","minXDeltaFrame","xVals","fi","vals","lastVal","omitLabels","labels","common","label","commonLabel","extractCommonLabels","flatLabels","l","sameProps","prevProps","nextProps","propName","defaultMatchers","GraphNG","props","state","withConfig","fields","replaceVariables","dataLinkPostProcessor","preparePlotFrameFn","withLinks","alignedFrameFinal","timeZone","linkFrames","linkFrame","frameIndex","nonHiddenFields","structureRev","cursorSync","propsChanged","newState","width","height","children","renderLegend","alignedData","vizWidth","vizHeight","u","ErrorMessageRow","message","Box","Text","groupRecordsByTimestamp","records","groupedLines","current","tsGroup","a","b","LogRecordViewerByTimestamp","commonLabels","onLabelClick","onRecordsRendered","styles","getStyles","timestampRefs","key","element","Timestamp","line","idx","id","isErrorRow","Fragment","AlertInstanceValues","LogRecordViewerByInstance","record","timestamp","time","dateTime","formatDistanceToNowStrict","values","theme","STATE_HISTORY_POLLING_INTERVAL","MAX_TIMELINE_SERIES","LokiStateHistory","ruleUID","instancesFilter","setInstancesFilter","logsRef","getValues","setValue","register","handleSubmit","useGetRuleHistoryQuery","stateHistoryApi","queryTimeRange","getDefaultTimeRange","stateHistory","isLoading","isError","error","dataFrames","historyRecords","totalRecordsCount","useRuleHistoryRecords","frameSubset","frameTimeRange","useFrameSubset","onLogRecordLabelClick","matcherString","onFilterCleared","Alert","hasMoreInstances","emptyStateMessage","data","SearchFieldInput","Tooltip","AlertLabels","Button","LogTimelineViewer","recordRefs","frameSubsetTimestamps","minTs","maxTs","rangeStart","rangeStop","showClearFilterSuffix","onClearFilterClick","rest","ref","Field","Label","Input","fromDateTime","toDateTime","build","ruleUid","from","to","limit","previous","params","v","filter","tsValues","timestamps","isNumbers","lines","logRecords","index","isLine","logRecordsByInstance","groupLabelsArray","filterMatchers","logRecordsToDataFrame","instanceLabels","parsedInstanceLabels","timeField","timeIndex","_","stateValues"],"sourceRoot":""}