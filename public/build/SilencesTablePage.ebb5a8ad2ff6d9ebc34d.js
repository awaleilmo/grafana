"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[1668,4312],{12266:(F,E,s)=>{s.d(E,{e:()=>g});var e=s(74848),d=s(45861);const g=({isCollapsed:y,onToggle:l,idControlled:v,className:R,text:L,size:I="xl",...p})=>(0,e.jsx)(d.$n,{type:"button",fill:"text",variant:"secondary","aria-expanded":!y,"aria-controls":v,className:R,icon:y?"angle-right":"angle-down",onClick:()=>l(!y),...p,children:L})},27911:(F,E,s)=>{s.d(E,{L:()=>d});var e=s(22803);const d=g=>({table:(0,e.css)({width:"100%",borderRadius:g.shape.radius.default,border:`solid 1px ${g.colors.border.weak}`,backgroundColor:g.colors.background.secondary,th:{padding:g.spacing(1)},td:{padding:`0 ${g.spacing(1)}`},tr:{height:"38px"}}),evenRow:(0,e.css)({backgroundColor:g.colors.background.primary}),colExpand:(0,e.css)({width:"36px"}),nameCell:(0,e.css)({gap:g.spacing(1)}),actionsCell:(0,e.css)({textAlign:"right",width:"1%",whiteSpace:"nowrap","& > * + *":{marginLeft:g.spacing(.5)}})})},46627:(F,E,s)=>{s.r(E),s.d(E,{default:()=>Fe});var e=s(74848),d=s(22803),g=s(96540),y=s(33239),l=s(92745),v=s(63142),R=s(6975),L=s(34999),I=s(41654),p=s(45861),V=s(74475),P=s(30703),Z=s(3271),w=s(20941),K=s(70958),B=s(62421),X=s(55143),$=s(95443),M=s(52161),C=s(84266),k=s(91984),T=s(16692),q=s(5358),U=s(63895),f=s(77256),_=s(88547),ee=s(36826),te=s(24898),se=s(6106),ne=s(35526),le=s(37658),re=s(86017);const ae=({matchers:t})=>{const i=(0,v.of)(ie);return(0,e.jsx)("div",{children:(0,e.jsx)(le.L,{className:i.tags,tags:t.map(r=>`${r.name}${(0,re.MN)(r)}${r.value}`)})})},ie=()=>({tags:(0,d.css)({justifyContent:"flex-start"})});var ce=s(50201),oe=s(43951),de=s(15130),ue=s(54);const xe=({alertManagerSourceName:t})=>{const i=(0,ue.jy)(t);return de.TP.hasPermission(i.create)?(0,e.jsx)(ce.p,{variant:"call-to-action",button:(0,e.jsx)(p.z9,{href:(0,f.nL)("alerting/silence/new",t),icon:"bell-slash",size:"lg",children:(0,e.jsx)(l.x6,{i18nKey:"silences.empty-state.button-title",children:"Create silence"})}),message:(0,l.t)("silences.empty-state.title","You haven't created any silences yet")}):(0,e.jsx)(oe.c,{callToActionElement:(0,e.jsx)("div",{}),message:"No silences found."})};var Q=s(74529),ge=s(27911),he=s(7840),me=s(12266),je=s(83903);const fe=({alert:t,className:i})=>{const[r,c]=(0,g.useState)(!0),a=(0,Q.dU)({start:new Date(t.startsAt),end:new Date(t.endsAt)}),u=Object.entries(t.labels).reduce((o,[x,n])=>((x==="alertname"||x==="__alert_rule_title__")&&(o=n),o),"");return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsxs)("tr",{className:i,children:[(0,e.jsx)("td",{children:(0,e.jsx)(me.e,{isCollapsed:r,onToggle:o=>c(o)})}),(0,e.jsx)("td",{children:(0,e.jsx)(je.y,{state:t.status.state})}),(0,e.jsx)("td",{children:(0,e.jsxs)(l.x6,{i18nKey:"alerting.silenced-alerts-table-row.silenced-for",children:["for ",{duration:a}]})}),(0,e.jsx)("td",{children:u})]}),!r&&(0,e.jsxs)("tr",{className:i,children:[(0,e.jsx)("td",{}),(0,e.jsx)("td",{colSpan:5,children:(0,e.jsx)(he.m,{labels:t.labels,size:"sm"})})]})]})},ye=({silencedAlerts:t})=>{const i=(0,v.of)(ge.L),r=(0,v.of)(ve);return t.length?(0,e.jsxs)("table",{className:(0,d.cx)(i.table,r.tableMargin),children:[(0,e.jsxs)("colgroup",{children:[(0,e.jsx)("col",{className:i.colExpand}),(0,e.jsx)("col",{className:r.colState}),(0,e.jsx)("col",{}),(0,e.jsx)("col",{className:r.colName})]}),(0,e.jsx)("thead",{children:(0,e.jsxs)("tr",{children:[(0,e.jsx)("th",{}),(0,e.jsx)("th",{children:(0,e.jsx)(l.x6,{i18nKey:"silences-table.header.state",children:"State"})}),(0,e.jsx)("th",{}),(0,e.jsx)("th",{children:(0,e.jsx)(l.x6,{i18nKey:"silences-table.header.alert-name",children:"Alert name"})})]})}),(0,e.jsx)("tbody",{children:t.map((c,a)=>(0,e.jsx)(fe,{alert:c,className:a%2===0?i.evenRow:""},c.fingerprint))})]}):null},ve=t=>({tableMargin:(0,d.css)({marginBottom:t.spacing(1)}),colState:(0,d.css)({width:"110px"}),colName:(0,d.css)({width:"65%"})}),pe=ye,Se=({silence:t})=>{const{startsAt:i,endsAt:r,comment:c,createdBy:a,silencedAlerts:u}=t,o=(0,v.of)(Ae),x="YYYY-MM-DD HH:mm",n=y.parse(i),h=y.parse(r),m=(0,Q.dU)({start:new Date(i),end:new Date(r)});return(0,e.jsxs)("div",{className:o.container,children:[(0,e.jsx)("div",{className:o.title,children:(0,e.jsx)(l.x6,{i18nKey:"alerting.silence-details.comment",children:"Comment"})}),(0,e.jsx)("div",{children:c}),(0,e.jsx)("div",{className:o.title,children:(0,e.jsx)(l.x6,{i18nKey:"alerting.silence-details.schedule",children:"Schedule"})}),(0,e.jsx)("div",{children:`${n?.format(x)} - ${h?.format(x)}`}),(0,e.jsx)("div",{className:o.title,children:(0,e.jsx)(l.x6,{i18nKey:"alerting.silence-details.duration",children:"Duration"})}),(0,e.jsx)("div",{children:m}),(0,e.jsx)("div",{className:o.title,children:(0,e.jsx)(l.x6,{i18nKey:"alerting.silence-details.created-by",children:"Created by"})}),(0,e.jsx)("div",{children:a}),Array.isArray(u)&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("div",{className:o.title,children:(0,e.jsx)(l.x6,{i18nKey:"alerting.silence-details.affected-alerts",children:"Affected alerts"})}),(0,e.jsx)(pe,{silencedAlerts:u})]})]})},Ae=t=>({container:(0,d.css)({display:"grid",gridTemplateColumns:"1fr 9fr",gridRowGap:"1rem",paddingBottom:t.spacing(2)}),title:(0,d.css)({color:t.colors.text.primary}),row:(0,d.css)({margin:t.spacing(1,0)})});var Ce=s(67834);const be={[C.RC.Active]:"good",[C.RC.Expired]:"neutral",[C.RC.Pending]:"neutral"},Ee=({state:t})=>(0,e.jsx)(Ce.O,{state:be[t],children:t});var O=s(2543),Ie=s(37386),Te=s(72636),De=s(45967),Le=s(63527);const Y=()=>(0,O.uniqueId)("query-string-"),Ne=()=>{const[t,i]=(0,g.useState)(Y()),[r,c]=(0,K.s)(),{queryString:a}=(0,f.qy)(r),u=(0,v.of)(Re),o=(0,O.debounce)(h=>{const m=h.target;c({queryString:m.value||null})},400),x=()=>{c({queryString:null,silenceState:null}),setTimeout(()=>i(Y()))};let n=a&&a.length>3;try{a?(0,U.S6)(a):n=!0}catch{n=!1}return(0,e.jsxs)("div",{className:u.flexRow,children:[(0,e.jsx)(Ie.D,{className:u.rowChild,label:(0,e.jsx)(Te.J,{children:(0,e.jsxs)(I.B,{gap:.5,children:[(0,e.jsx)(l.x6,{i18nKey:"alerting.common.search-by-matchers",children:"Search by matchers"}),(0,e.jsx)(De.m,{content:(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("div",{children:(0,e.jsx)(l.x6,{i18nKey:"alerting.silences-filter.search-by-matchers-tooltip",children:"Filter silences by using a comma separated list of matchers, e.g."})}),(0,e.jsx)("pre",{children:"severity=critical, env=production"})]}),children:(0,e.jsx)(P.I,{name:"info-circle",size:"sm"})})]})}),invalid:!n,error:n?null:"Query must use valid matcher syntax",children:(0,e.jsx)(Le.p,{className:u.searchInput,prefix:(0,e.jsx)(P.I,{name:"search"}),onChange:o,defaultValue:a??"",placeholder:(0,l.t)("alerting.silences-filter.search-query-input-placeholder-search","Search"),"data-testid":"search-query-input"},t)}),a&&(0,e.jsx)("div",{className:u.rowChild,children:(0,e.jsx)(p.$n,{variant:"secondary",icon:"times",onClick:x,children:(0,e.jsx)(l.x6,{i18nKey:"alerting.common.clear-filters",children:"Clear filters"})})})]})},Re=t=>({searchInput:(0,d.css)({width:"360px"}),flexRow:(0,d.css)({display:"flex",flexDirection:"row",alignItems:"flex-end",paddingBottom:t.spacing(3),borderBottom:`1px solid ${t.colors.border.medium}`}),rowChild:(0,d.css)({marginRight:t.spacing(1),marginBottom:0,maxHeight:"52px"}),fieldLabel:(0,d.css)({fontSize:"12px",fontWeight:500})}),W={pollingInterval:$.wG,refetchOnFocus:!0},Pe=()=>{const{selectedAlertmanager:t=""}=(0,q.VI)(),[i,r]=(0,T.L7)(T.QI.PreviewSilencedInstances),c=i&&r,{data:a=[],isLoading:u}=k.m.endpoints.getAlertmanagerAlerts.useQuery({amSourceName:t,filter:{silenced:!0,active:!0,inhibited:!0}},{...W,skip:!c}),{data:o=[],isLoading:x,error:n}=B.F.endpoints.getSilences.useQuery({datasourceUid:(0,M.w5)(t),ruleMetadata:!0,accessControl:!0},W),{currentData:h}=X.L.useDiscoverAmFeaturesQuery({amSourceName:t??""},{skip:!t}),m=(0,f.JZ)(n).includes("the Alertmanager is not configured")&&h?.lazyConfigInit,S=(0,v.of)(Ke),[A]=(0,K.s)(),N=G(o,!1),J=G(o,!0),{silenceState:Be}=(0,f.qy)(A),$e=Be===C.RC.Expired,Ue=(0,g.useMemo)(()=>{const D=j=>a.filter(b=>b.status.silencedBy.includes(j));return N.map(j=>{const b=c?D(j.id):void 0;return{id:j.id,data:{...j,silencedAlerts:b}}})},[N,a,c]),z=(0,g.useMemo)(()=>{const D=j=>a.filter(b=>b.status.silencedBy.includes(j));return J.map(j=>{const b=c?D(j.id):void 0;return{id:j.id,data:{...j,silencedAlerts:b}}})},[J,a,c]);if(x||u)return(0,e.jsx)(R._,{text:(0,l.t)("alerting.silences-table.text-loading-silences","Loading silences...")});if(m)return(0,e.jsx)(L.F,{title:(0,l.t)("alerting.silences-table.title-the-selected-alertmanager-has-no-configuration","The selected Alertmanager has no configuration"),severity:"warning",children:(0,e.jsx)(l.x6,{i18nKey:"silences.table.noConfig",children:"Create a new contact point to create a configuration using the default values or contact your administrator to set up the Alertmanager."})});if(n){const D=(0,f.JZ)(n)||"Unknown error.";return(0,e.jsx)(L.F,{severity:"error",title:(0,l.t)("alerting.silences-table.title-error-loading-silences","Error loading silences"),children:D})}return(0,e.jsxs)("div",{"data-testid":"silences-table",children:[(0,e.jsx)(ne.e,{currentAlertmanager:t}),!!o.length&&(0,e.jsxs)(I.B,{direction:"column",children:[(0,e.jsx)(Ne,{}),(0,e.jsx)(te._,{actions:[T.QI.CreateSilence],children:(0,e.jsx)(I.B,{justifyContent:"end",children:(0,e.jsx)(p.z9,{href:(0,f.nL)("/alerting/silence/new",t),icon:"plus",children:(0,e.jsx)(l.x6,{i18nKey:"silences.table.add-silence-button",children:"Add Silence"})})})}),(0,e.jsx)(H,{items:Ue,alertManagerSourceName:t,dataTestId:"not-expired-table"}),z.length>0&&(0,e.jsxs)(V.M,{label:(0,l.t)("alerting.silences-table.label-section-expired","Expired silences ({{numExpired}})",{numExpired:z.length}),isOpen:$e,children:[(0,e.jsxs)("div",{className:S.callout,children:[(0,e.jsx)(P.I,{className:S.calloutIcon,name:"info-circle"}),(0,e.jsx)("span",{children:(0,e.jsx)(l.x6,{i18nKey:"silences.table.expired-silences",children:"Expired silences are automatically deleted after 5 days."})})]}),(0,e.jsx)(H,{items:z,alertManagerSourceName:t,dataTestId:"expired-table"})]})]}),!o.length&&(0,e.jsx)(xe,{alertManagerSourceName:t})]})};function H({items:t,alertManagerSourceName:i,dataTestId:r}){const c=Me(i);return t.length?(0,e.jsx)(se.E,{pagination:{itemsPerPage:25},items:t,cols:c,isExpandable:!0,dataTestId:r,renderExpandedContent:({data:a})=>(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(Z.c,{}),(0,e.jsx)(Se,{silence:a})]})}):(0,e.jsx)(l.x6,{i18nKey:"silences.table.no-matching-silences",children:"No matching silences found;"})}const G=(t,i=!1)=>{const[r]=(0,K.s)();return(0,g.useMemo)(()=>{const{queryString:c}=(0,f.qy)(r),a=r?.silenceIds;return t.filter(u=>typeof a=="string"&&!a.split(",").includes(u.id)||c&&!(0,U.Zc)(c).every(n=>u.matchers?.some(({name:h,value:m,isEqual:S,isRegex:A})=>n.name===h&&n.value===m&&n.isEqual===S&&n.isRegex===A))?!1:i?u.status.state===C.RC.Expired:u.status.state!==C.RC.Expired)},[r,t,i])},Ke=t=>({callout:(0,d.css)({backgroundColor:t.colors.background.secondary,borderTop:`3px solid ${t.colors.info.border}`,borderRadius:t.shape.radius.default,height:"62px",display:"flex",flexDirection:"row",alignItems:"center","& > *":{marginLeft:t.spacing(1)}}),calloutIcon:(0,d.css)({color:t.colors.info.text})});function Me(t){const[i,r]=(0,T.L7)(T.QI.UpdateSilence),[c]=B.F.endpoints.expireSilence.useMutation(),a=t===M.hY;return(0,g.useMemo)(()=>{const u=x=>{c({datasourceUid:(0,M.w5)(t),silenceId:x})},o=[{id:"state",label:(0,l.t)("alerting.use-columns.columns.label.state","State"),renderCell:function({data:{status:n}}){return(0,e.jsx)(Ee,{state:n.state})},size:3},{id:"alert-rule",label:(0,l.t)("alerting.use-columns.columns.label.alert-rule-targeted","Alert rule targeted"),renderCell:function({data:{metadata:n}}){return n?.rule_title?(0,e.jsx)(w.N,{href:`/alerting/grafana/${n?.rule_uid}/view?returnTo=${encodeURIComponent("/alerting/silences")}`,children:n.rule_title}):"None"},size:8},{id:"matchers",label:(0,l.t)("alerting.use-columns.columns.label.matching-labels","Matching labels"),renderCell:function({data:{matchers:n}}){const h=n?.filter(m=>m.name!==$.kW)||[];return(0,e.jsx)(ae,{matchers:h})},size:7},{id:"alerts",label:(0,l.t)("alerting.use-columns.columns.label.alerts-silenced","Alerts silenced"),renderCell:function({data:{silencedAlerts:n}}){return(0,e.jsx)("span",{"data-testid":"alerts",children:Array.isArray(n)?n.length:"-"})},size:2},{id:"schedule",label:(0,l.t)("alerting.use-columns.columns.label.schedule","Schedule"),renderCell:function({data:{startsAt:n,endsAt:h}}){const m=y.parse(n),S=y.parse(h),A="YYYY-MM-DD HH:mm";return`${m?.format(A)} - ${S?.format(A)}`},size:7}];return i&&o.push({id:"actions",label:(0,l.t)("alerting.use-columns.label.actions","Actions"),renderCell:function({data:n}){const h=n.status.state===C.RC.Expired,m=n?.accessControl?.create,S=n?.accessControl?.write,A=h&&(a?m:r),N=!h&&(a?S:r);return(0,e.jsxs)(I.B,{gap:.5,wrap:"wrap",children:[A&&(0,e.jsx)(p.z9,{title:(0,l.t)("alerting.use-columns.title-recreate","Recreate"),size:"sm",variant:"secondary",icon:"sync",href:(0,f.nL)(`/alerting/silence/${n.id}/edit`,t),children:(0,e.jsx)(l.x6,{i18nKey:"silences.table.recreate-button",children:"Recreate"})}),N&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(p.z9,{title:(0,l.t)("alerting.use-columns.title-unsilence","Unsilence"),size:"sm",variant:"secondary",icon:"bell",onClick:()=>u(n.id),children:(0,e.jsx)(l.x6,{i18nKey:"silences.table.unsilence-button",children:"Unsilence"})}),(0,e.jsx)(p.z9,{title:(0,l.t)("alerting.use-columns.title-edit","Edit"),size:"sm",variant:"secondary",icon:"pen",href:(0,f.nL)(`/alerting/silence/${n.id}/edit`,t),children:(0,e.jsx)(l.x6,{i18nKey:"silences.table.edit-button",children:"Edit"})})]})]})},size:5}),o},[t,c,a,r,i])}function ze(){return(0,e.jsx)(ee.y,{navId:"silences",accessType:"instance",children:(0,e.jsx)(Pe,{})})}const Fe=(0,_.S)(ze)}}]);

//# sourceMappingURL=SilencesTablePage.ebb5a8ad2ff6d9ebc34d.js.map