"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[5074],{6370:(B,j,c)=>{c.d(j,{A:()=>P});var i=c(96540),g=c(88941);const P=({children:p,...x})=>i.createElement(g.x,{...x,kind:"section"},p)},65074:(B,j,c)=>{c.d(j,{NN:()=>w,_r:()=>pe});var i=c(96540),g=c(37386),P=c(18857),p=c(63527),x=c(93256),V=c(7895),K=c(89599),D=c(48480),O=c(43173);const k=["af-south-1","ap-east-1","ap-northeast-1","ap-northeast-2","ap-northeast-3","ap-south-1","ap-south-2","ap-southeast-1","ap-southeast-2","ap-southeast-3","ap-southeast-4","ca-central-1","ca-west-1","cn-north-1","cn-northwest-1","eu-central-1","eu-central-2","eu-north-1","eu-south-1","eu-south-2","eu-west-1","eu-west-2","eu-west-3","il-central-1","me-central-1","me-south-1","sa-east-1","us-east-1","us-east-2","us-gov-east-1","us-gov-west-1","us-iso-east-1","us-isob-east-1","us-west-1","us-west-2"];var A=(e=>(e.Keys="keys",e.Credentials="credentials",e.Default="default",e.EC2IAMRole="ec2_iam_role",e.ARN="arn",e.GrafanaAssumeRole="grafana_assume_role",e))(A||{});const M=[{label:"Workspace IAM Role",value:A.EC2IAMRole},{label:"Grafana Assume Role",value:A.GrafanaAssumeRole},{label:"AWS SDK Default",value:A.Default},{label:"Access & secret key",value:A.Keys},{label:"Credentials file",value:A.Credentials}];var J=c(22803);const Q=(0,J.css)({maxWidth:"715px"});var N=c(6370),T=c(85480);const ae=28,q=["cloudwatch","grafana-athena-datasource"],G=e=>({value:e,label:e}),$=e=>typeof e=="string"&&M.some(t=>t.value===e),w=e=>{var t,n,a,o,l,r,u,s,h;const[d,S]=(0,i.useState)(!1),[m,b]=(0,i.useState)((e.standardRegions||k).map(G)),{loadRegions:_,onOptionsChange:E,skipHeader:y=!1,skipEndpoint:I=!1,options:f,hideAssumeRoleArn:te=!1}=e;let Ee=f.jsonData.profile;Ee===void 0&&(Ee=f.database);const Re=O.$.featureToggles.awsDatasourcesTempCredentials&&q.includes(f.type),ct=(t=O.$.awsAssumeRoleEnabled)!=null?t:!0,W=(0,i.useMemo)(()=>O.$.awsAllowedAuthProviders.filter(C=>C===A.GrafanaAssumeRole?Re:!0).filter($),[Re]),ne=M.find(C=>C.value===f.jsonData.authType);return(0,i.useEffect)(()=>{!ne&&W.length&&E({...f,jsonData:{...f.jsonData,authType:W[0]}})},[ne,f,E,W]),(0,i.useEffect)(()=>{_&&_().then(C=>b(C.map(G)))},[_]),i.createElement("div",{"data-testid":"connection-config"},i.createElement(N.A,{title:y?"":"Connection Details","data-testid":"connection-config"},i.createElement(T.I,{title:"Authentication"},i.createElement(g.D,{label:"Authentication Provider",description:"Specify which AWS credentials chain to use.",htmlFor:"authProvider"},i.createElement(P.l6,{"aria-label":"Authentication Provider",inputId:"authProvider",value:ne,options:M.filter(C=>W.includes(C.value)),defaultValue:f.jsonData.authType,onChange:C=>{(0,D.BD)(e,"authType")(C)},menuShouldPortal:!0})),f.jsonData.authType==="credentials"&&i.createElement(g.D,{label:"Credentials Profile Name",description:"Credentials profile name, as specified in ~/.aws/credentials, leave blank for default.",htmlFor:"credentialsProfileName"},i.createElement(p.p,{id:"credentialsProfileName",placeholder:"default",value:f.jsonData.profile,onChange:(0,D.PG)(e,"profile")})),f.jsonData.authType==="keys"&&i.createElement(i.Fragment,null,i.createElement(g.D,{label:"Access Key ID",htmlFor:"accessKeyId"},(n=e.options.secureJsonFields)!=null&&n.accessKey?i.createElement(x.e,null,i.createElement(p.p,{disabled:!0,placeholder:"Configured",id:"accessKeyId"}),i.createElement(V.I,{icon:"edit",tooltip:"Edit Access Key ID",type:"button",onClick:(0,D.yV)(e,"accessKey")})):i.createElement(p.p,{id:"accessKeyId",value:(o=(a=f.secureJsonData)==null?void 0:a.accessKey)!=null?o:"",onChange:(0,D.mn)(e,"accessKey")})),i.createElement(g.D,{label:"Secret Access Key",htmlFor:"secretKey"},(l=e.options.secureJsonFields)!=null&&l.secretKey?i.createElement(x.e,null,i.createElement(p.p,{disabled:!0,placeholder:"Configured"}),i.createElement(V.I,{id:"secretKey",icon:"edit",type:"button",tooltip:"Edit Secret Access Key",onClick:(0,D.yV)(e,"secretKey")})):i.createElement(p.p,{id:"secretKey",value:(u=(r=f.secureJsonData)==null?void 0:r.secretKey)!=null?u:"",onChange:(0,D.mn)(e,"secretKey")})))),!te&&i.createElement(T.I,{title:"Assume Role"},f.jsonData.authType===A.GrafanaAssumeRole&&i.createElement("div",{className:Q},i.createElement(K.S,{label:"How to create an IAM role for grafana to assume:",collapsible:!0,isOpen:d,onToggle:()=>S(!d)},i.createElement("ol",null,i.createElement("li",null,i.createElement("p",null,"1. Create a new IAM role in the AWS console, and select ",i.createElement("code",null,"Another AWS account")," as the"," ",i.createElement("code",null,"Trusted entity"),".")),i.createElement("li",null,i.createElement("p",null,"2. Enter the account ID of the Grafana account that has permission to assume this role:",i.createElement("code",null," 008923505280 ")," and check the ",i.createElement("code",null,"Require external ID")," box.")),i.createElement("li",null,i.createElement("p",null,"3. Enter the following external ID:"," ",i.createElement("code",null,e.externalId||"External Id is currently unavailable")," and click"," ",i.createElement("code",null,"Next"),".")),i.createElement("li",null,i.createElement("p",null,"4. Add any required permissions you would like Grafana to be able to access on your behalf. For more details on our permissions please"," ",i.createElement("a",{href:"https://grafana.com/docs/grafana/latest/datasources/aws-cloudwatch/",target:"_blank",rel:"noreferrer"},"read through our documentation"),".")),i.createElement("li",null,i.createElement("p",null,"5. Give the role a name and description, and click ",i.createElement("code",null,"Create role"),".")),i.createElement("li",null,i.createElement("p",null,"6. Copy the ARN of the role you just created and paste it into the ",i.createElement("code",null,"Assume Role ARN")," ","field below."))))),ct&&i.createElement(i.Fragment,null,i.createElement(g.D,{htmlFor:"assumeRoleArn",label:"Assume Role ARN",description:`Optional. Specifying the ARN of a role will ensure that the
                     selected authentication provider is used to assume the role rather than the
                     credentials directly.`},i.createElement(p.p,{id:"assumeRoleArn",placeholder:"arn:aws:iam:*",value:f.jsonData.assumeRoleArn||"",onChange:(0,D.PG)(e,"assumeRoleArn")})),f.jsonData.authType!==A.GrafanaAssumeRole&&i.createElement(g.D,{htmlFor:"externalId",label:"External ID",description:"If you are assuming a role in another account, that has been created with an external ID, specify the external ID here."},i.createElement(p.p,{id:"externalId",placeholder:"External ID",value:f.jsonData.externalId||"",onChange:(0,D.PG)(e,"externalId")})))),i.createElement(T.I,{title:"Additional Settings"},!I&&f.jsonData.authType!==A.GrafanaAssumeRole&&i.createElement(g.D,{label:"Endpoint",description:"Optionally, specify a custom endpoint for the service",htmlFor:"endpoint"},i.createElement(p.p,{id:"endpoint",placeholder:(s=e.defaultEndpoint)!=null?s:"https://{service}.{region}.amazonaws.com",value:f.jsonData.endpoint||"",onChange:(0,D.PG)(e,"endpoint")})),i.createElement(g.D,{label:"Default Region",description:"Specify the region, such as for US West (Oregon) use ` us-west-2 ` as the region.",htmlFor:"defaultRegion"},i.createElement(P.l6,{inputId:"defaultRegion",value:(h=m.find(C=>C.value===f.jsonData.defaultRegion))!=null?h:f.jsonData.defaultRegion?{label:f.jsonData.defaultRegion,value:f.jsonData.defaultRegion}:void 0,options:m,defaultValue:f.jsonData.defaultRegion,allowCustomValue:!0,onChange:(0,D.BD)(e,"defaultRegion"),formatCreateLabel:C=>`Use region: ${C}`,menuShouldPortal:!0}))),e.children))};var dt=c(2543);const Se=/^(\d+)(?:\.(\d+))?(?:\.(\d+))?(?:-([0-9A-Za-z\.]+))?/;class H{constructor(t){this.major=0,this.minor=0,this.patch=0,this.meta="";const n=Se.exec(t);n&&(this.major=Number(n[1]),this.minor=Number(n[2]||0),this.patch=Number(n[3]||0),this.meta=n[4])}isGtOrEq(t){const n=new H(t);for(let a=0;a<this.comparable.length;++a){if(this.comparable[a]>n.comparable[a])return!0;if(this.comparable[a]<n.comparable[a])return!1}return!0}isValid(){return isNumber(this.major)}get comparable(){return[this.major,this.minor,this.patch]}}function ft(e,t){return new H(e).isGtOrEq(t)}function ht(){const e=useTheme2();return isVersionGtOrEq(config.buildInfo.version,"10.1.0")?React.createElement(Divider$1,null):React.createElement("div",{style:{borderTop:`1px solid ${e.colors.border.weak}`,margin:e.spacing(2,0),width:"100%"}})}const pe=e=>{var t,n,a,o;const{onOptionsChange:l,options:r}=e,u={onOptionsChange:s=>{var h,d,S,m;const b={...r,jsonData:{...r.jsonData,sigV4AuthType:s.jsonData.authType,sigV4Profile:s.jsonData.profile,sigV4AssumeRoleArn:s.jsonData.assumeRoleArn,sigV4ExternalId:s.jsonData.externalId,sigV4Region:s.jsonData.defaultRegion,sigV4Endpoint:s.jsonData.endpoint},secureJsonFields:{sigV4AccessKey:(h=s.secureJsonFields)==null?void 0:h.accessKey,sigV4SecretKey:(d=s.secureJsonFields)==null?void 0:d.secretKey},secureJsonData:{sigV4AccessKey:(S=s.secureJsonData)==null?void 0:S.accessKey,sigV4SecretKey:(m=s.secureJsonData)==null?void 0:m.secretKey}};l(b)},options:{...r,jsonData:{...r.jsonData,authType:r.jsonData.sigV4AuthType,profile:r.jsonData.sigV4Profile,assumeRoleArn:r.jsonData.sigV4AssumeRoleArn,externalId:r.jsonData.sigV4ExternalId,defaultRegion:r.jsonData.sigV4Region,endpoint:r.jsonData.sigV4Endpoint},secureJsonFields:{accessKey:(t=r.secureJsonFields)==null?void 0:t.sigV4AccessKey,secretKey:(n=r.secureJsonFields)==null?void 0:n.sigV4SecretKey},secureJsonData:{accessKey:(a=r.secureJsonData)==null?void 0:a.sigV4AccessKey,secretKey:(o=r.secureJsonData)==null?void 0:o.sigV4SecretKey}},inExperimentalAuthComponent:e.inExperimentalAuthComponent};return i.createElement(i.Fragment,null,i.createElement("div",{className:"gf-form"},i.createElement("h6",null,"SigV4 Auth Details")),i.createElement(w,{...u,skipHeader:!0,skipEndpoint:!0}))};function mt(e){const t=e.dependencies,n=e.onChange,a=useRef(e.dependencies),o=useRef(!1),l=useRef(e.value||e.default||null),[r,u]=useState(l.current?[l.current]:[]),[s,h]=useState(!1),d=useMemo(()=>{const y=[{label:`default (${e.default})`,value:defaultKey,description:"Default value set in the data source"}];return e.value&&e.value!==defaultKey&&y.push({label:e.value,value:e.value}),y},[e.default,e.value]),[S,m]=useState(e.default?d:[]);useEffect(()=>{e.resources!==void 0&&u(e.resources)},[e.resources]),useEffect(()=>{const y=e.default?d:[];r.length?(r.forEach(I=>{const f=typeof I=="string"?I:I.value;y.find(te=>te.value===f)||(typeof I=="string"?y.push({label:I,value:I}):y.push(I))}),m(y)):m([])},[r,d,e.default]),useEffect(()=>{isEqual(t,a.current)||(o.current=!1,l.current=null,a.current=t,n(null))},[t,n]);const b=async()=>{var y;if(!o.current){e.saveOptions&&await e.saveOptions();try{const I=await((y=e.fetch)==null?void 0:y.call(e))||[];u(I)}finally{o.current=!0}}},_=y=>{n(y),y.value&&(l.current=y.value)},E=async()=>{h(!0);try{await b()}finally{h(!1)}};return React.createElement(Select,{...e,id:e.id,inputId:e.id,"aria-label":e.label,options:S,onChange:_,isLoading:s,className:e.className||"min-width-6",onOpenMenu:()=>e.fetch&&E(),menuShouldPortal:!0})}function vt(e){var t,n,a;const{jsonData:o}=e.options,l={title:o.defaultRegion?"":"select a default region",labelWidth:(t=e.labelWidth)!=null?t:DEFAULT_LABEL_WIDTH,className:"width-30"},r=[e.options.jsonData.assumeRoleArn,e.options.jsonData.authType,e.options.jsonData.defaultRegion,e.options.jsonData.endpoint,e.options.jsonData.externalId,e.options.jsonData.profile,(n=e.options.secureJsonData)==null?void 0:n.accessKey,(a=e.options.secureJsonData)==null?void 0:a.secretKey].concat(e.dependencies);return React.createElement(ResourceSelector,{id:e.id,label:e.label,"data-testid":e["data-testid"],onChange:e.onChange,fetch:e.fetch,value:e.value,saveOptions:e.saveOptions,dependencies:r,hidden:e.hidden,disabled:e.disabled||!o.defaultRegion,allowCustomValue:e.allowCustomValue,autoFocus:e.autoFocus,backspaceRemovesValue:e.backspaceRemovesValue,invalid:e.invalid,isClearable:e.isClearable,isMulti:e.isMulti,inputId:e.inputId,showAllSelectedWhenOpen:e.showAllSelectedWhenOpen,maxMenuHeight:e.maxMenuHeight,minMenuHeight:e.minMenuHeight,maxVisibleValues:e.maxVisibleValues,menuPlacement:e.menuPlacement,menuPosition:e.menuPosition,noOptionsMessage:e.noOptionsMessage,placeholder:e.placeholder,width:e.width,onBlur:e.onBlur,onCreateOption:e.onCreateOption,onInputChange:e.onInputChange,isOptionDisabled:e.isOptionDisabled,...l})}function yt(e){var t;return React.createElement(InlineField,{label:e.label,labelWidth:(t=e.labelWidth)!=null?t:DEFAULT_LABEL_WIDTH,tooltip:e.tooltip,hidden:e.hidden,disabled:e.disabled},React.createElement(Input,{"data-testid":e["data-testid"],className:"width-30",value:e.value,onChange:e.onChange,placeholder:e.placeholder,disabled:e.disabled}))}function gt(e){const{getSuggestions:t,query:n}=e,{rawSQL:a}=defaults(e.query,{rawSQL:""}),o=r=>{const u={...e.query,rawSQL:r};e.onChange(u),e.onRunQuery()},l=useRef([]);return useEffect(()=>{l.current=t(n)},[t,n]),React.createElement(CodeEditor,{language:e.language,value:a,onBlur:o,showMiniMap:!1,showLineNumbers:!0,getSuggestions:()=>l.current,height:"240px",...e.editorProps})}var De=c(36580),Ae=c(68143),re=c(38866),oe=c(62467),Ce=c(44240),Ie=c(99589),F=c(28105),Pe=c(88483);const le=10,ie=1e4/le;function xe(e,t){return new Pe.c(n=>{let a,o,l=F.Gu.Loading,r=1,u=1,s=!1;const h={next:d=>{l=d.state;let S=!1;if(l!==F.Gu.Error){a=t.getNextQuery(d);const b=t.shouldCancel();a&&b&&(s=b,a=void 0),S=!0}const m=t.process(d.data);S&&(a?(m.length&&m[0].length?l=F.Gu.Streaming:l=F.Gu.Loading,r=r*2>ie?ie:r*2):(l=F.Gu.Done,r=0)),n.next({...d,data:m,state:l,key:e.requestId})},error:d=>{n.error(d)},complete:()=>{if(o&&(o.unsubscribe(),o=void 0),a){const d=a;setTimeout(()=>{o=t.query({...e,requestId:`${e.requestId}.${++u}`,targets:[d]}).subscribe(h),a=void 0},r*le)}else n.complete()}};return o=t.query(e).subscribe(h),function(){h.complete(),(a||s)&&t.onCancel(),a=void 0}})}function R(e){return typeof e=="function"}function Oe(e){return R(e?.lift)}function se(e){return function(t){if(Oe(t))return t.lift(function(n){try{return e(n,this)}catch(a){this.error(a)}});throw new TypeError("Unable to lift unknown Observable type")}}var v=c(31635);function Te(e){var t=function(a){Error.call(a),a.stack=new Error().stack},n=e(t);return n.prototype=Object.create(Error.prototype),n.prototype.constructor=n,n}var Y=Te(function(e){return function(n){e(this),this.message=n?n.length+` errors occurred during unsubscription:
`+n.map(function(a,o){return o+1+") "+a.toString()}).join(`
  `):"",this.name="UnsubscriptionError",this.errors=n}});function ue(e,t){if(e){var n=e.indexOf(t);0<=n&&e.splice(n,1)}}var z=function(){function e(t){this.initialTeardown=t,this.closed=!1,this._parentage=null,this._finalizers=null}return e.prototype.unsubscribe=function(){var t,n,a,o,l;if(!this.closed){this.closed=!0;var r=this._parentage;if(r)if(this._parentage=null,Array.isArray(r))try{for(var u=(0,v.__values)(r),s=u.next();!s.done;s=u.next()){var h=s.value;h.remove(this)}}catch(E){t={error:E}}finally{try{s&&!s.done&&(n=u.return)&&n.call(u)}finally{if(t)throw t.error}}else r.remove(this);var d=this.initialTeardown;if(R(d))try{d()}catch(E){l=E instanceof Y?E.errors:[E]}var S=this._finalizers;if(S){this._finalizers=null;try{for(var m=(0,v.__values)(S),b=m.next();!b.done;b=m.next()){var _=b.value;try{de(_)}catch(E){l=l??[],E instanceof Y?l=(0,v.__spreadArray)((0,v.__spreadArray)([],(0,v.__read)(l)),(0,v.__read)(E.errors)):l.push(E)}}}catch(E){a={error:E}}finally{try{b&&!b.done&&(o=m.return)&&o.call(m)}finally{if(a)throw a.error}}}if(l)throw new Y(l)}},e.prototype.add=function(t){var n;if(t&&t!==this)if(this.closed)de(t);else{if(t instanceof e){if(t.closed||t._hasParent(this))return;t._addParent(this)}(this._finalizers=(n=this._finalizers)!==null&&n!==void 0?n:[]).push(t)}},e.prototype._hasParent=function(t){var n=this._parentage;return n===t||Array.isArray(n)&&n.includes(t)},e.prototype._addParent=function(t){var n=this._parentage;this._parentage=Array.isArray(n)?(n.push(t),n):n?[n,t]:t},e.prototype._removeParent=function(t){var n=this._parentage;n===t?this._parentage=null:Array.isArray(n)&&ue(n,t)},e.prototype.remove=function(t){var n=this._finalizers;n&&ue(n,t),t instanceof e&&t._removeParent(this)},e.EMPTY=function(){var t=new e;return t.closed=!0,t}(),e}();z.EMPTY;function ce(e){return e instanceof z||e&&"closed"in e&&R(e.remove)&&R(e.add)&&R(e.unsubscribe)}function de(e){R(e)?e():e.unsubscribe()}var we={setTimeout:function(e,t){for(var n=[],a=2;a<arguments.length;a++)n[a-2]=arguments[a];return setTimeout.apply(void 0,(0,v.__spreadArray)([e,t],(0,v.__read)(n)))},clearTimeout:function(e){return clearTimeout(e)},delegate:void 0};function fe(e){we.setTimeout(function(){throw e})}function he(){}var X=function(e){(0,v.__extends)(t,e);function t(n){var a=e.call(this)||this;return a.isStopped=!1,n?(a.destination=n,ce(n)&&n.add(a)):a.destination=Le,a}return t.create=function(n,a,o){return new Z(n,a,o)},t.prototype.next=function(n){this.isStopped||this._next(n)},t.prototype.error=function(n){this.isStopped||(this.isStopped=!0,this._error(n))},t.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},t.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,e.prototype.unsubscribe.call(this),this.destination=null)},t.prototype._next=function(n){this.destination.next(n)},t.prototype._error=function(n){try{this.destination.error(n)}finally{this.unsubscribe()}},t.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},t}(z),_e=function(){function e(t){this.partialObserver=t}return e.prototype.next=function(t){var n=this.partialObserver;if(n.next)try{n.next(t)}catch(a){U(a)}},e.prototype.error=function(t){var n=this.partialObserver;if(n.error)try{n.error(t)}catch(a){U(a)}else U(t)},e.prototype.complete=function(){var t=this.partialObserver;if(t.complete)try{t.complete()}catch(n){U(n)}},e}(),Z=function(e){(0,v.__extends)(t,e);function t(n,a,o){var l=e.call(this)||this,r;return R(n)||!n?r={next:n??void 0,error:a??void 0,complete:o??void 0}:r=n,l.destination=new _e(r),l}return t}(X);function U(e){fe(e)}function je(e){throw e}var Le={closed:!0,next:he,error:je,complete:he};function me(e,t,n,a,o){return new Ke(e,t,n,a,o)}var Ke=function(e){(0,v.__extends)(t,e);function t(n,a,o,l,r,u){var s=e.call(this,n)||this;return s.onFinalize=r,s.shouldUnsubscribe=u,s._next=a?function(h){try{a(h)}catch(d){n.error(d)}}:e.prototype._next,s._error=l?function(h){try{l(h)}catch(d){n.error(d)}finally{this.unsubscribe()}}:e.prototype._error,s._complete=o?function(){try{o()}catch(h){n.error(h)}finally{this.unsubscribe()}}:e.prototype._complete,s}return t.prototype.unsubscribe=function(){var n;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){var a=this.closed;e.prototype.unsubscribe.call(this),!a&&((n=this.onFinalize)===null||n===void 0||n.call(this))}},t}(X);function Me(e,t){return se(function(n,a){var o=0;n.subscribe(me(a,function(l){a.next(e.call(t,l,o++))}))})}var Fe=function(e){return e&&typeof e.length=="number"&&typeof e!="function"};function Ve(e){return R(e?.then)}var ee=function(){return typeof Symbol=="function"&&Symbol.observable||"@@observable"}();function Qe(e){return e}function Ne(e){return e.length===0?Qe:e.length===1?e[0]:function(n){return e.reduce(function(a,o){return o(a)},n)}}var Ge={Promise:void 0};function Ue(e){e()}var L=function(){function e(t){t&&(this._subscribe=t)}return e.prototype.lift=function(t){var n=new e;return n.source=this,n.operator=t,n},e.prototype.subscribe=function(t,n,a){var o=this,l=Be(t)?t:new Z(t,n,a);return Ue(function(){var r=o,u=r.operator,s=r.source;l.add(u?u.call(l,s):s?o._subscribe(l):o._trySubscribe(l))}),l},e.prototype._trySubscribe=function(t){try{return this._subscribe(t)}catch(n){t.error(n)}},e.prototype.forEach=function(t,n){var a=this;return n=ve(n),new n(function(o,l){var r=new Z({next:function(u){try{t(u)}catch(s){l(s),r.unsubscribe()}},error:l,complete:o});a.subscribe(r)})},e.prototype._subscribe=function(t){var n;return(n=this.source)===null||n===void 0?void 0:n.subscribe(t)},e.prototype[ee]=function(){return this},e.prototype.pipe=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return Ne(t)(this)},e.prototype.toPromise=function(t){var n=this;return t=ve(t),new t(function(a,o){var l;n.subscribe(function(r){return l=r},function(r){return o(r)},function(){return a(l)})})},e.create=function(t){return new e(t)},e}();function ve(e){var t;return(t=e??Ge.Promise)!==null&&t!==void 0?t:Promise}function We(e){return e&&R(e.next)&&R(e.error)&&R(e.complete)}function Be(e){return e&&e instanceof X||We(e)&&ce(e)}function ke(e){return R(e[ee])}function Je(e){return Symbol.asyncIterator&&R(e?.[Symbol.asyncIterator])}function qe(e){return new TypeError("You provided "+(e!==null&&typeof e=="object"?"an invalid object":"'"+e+"'")+" where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.")}function $e(){return typeof Symbol!="function"||!Symbol.iterator?"@@iterator":Symbol.iterator}var He=$e();function Ye(e){return R(e?.[He])}function ze(e){return(0,v.__asyncGenerator)(this,arguments,function(){var n,a,o,l;return(0,v.__generator)(this,function(r){switch(r.label){case 0:n=e.getReader(),r.label=1;case 1:r.trys.push([1,,9,10]),r.label=2;case 2:return[4,(0,v.__await)(n.read())];case 3:return a=r.sent(),o=a.value,l=a.done,l?[4,(0,v.__await)(void 0)]:[3,5];case 4:return[2,r.sent()];case 5:return[4,(0,v.__await)(o)];case 6:return[4,r.sent()];case 7:return r.sent(),[3,2];case 8:return[3,10];case 9:return n.releaseLock(),[7];case 10:return[2]}})})}function Xe(e){return R(e?.getReader)}function Ze(e){if(e instanceof L)return e;if(e!=null){if(ke(e))return et(e);if(Fe(e))return tt(e);if(Ve(e))return nt(e);if(Je(e))return ye(e);if(Ye(e))return at(e);if(Xe(e))return rt(e)}throw qe(e)}function et(e){return new L(function(t){var n=e[ee]();if(R(n.subscribe))return n.subscribe(t);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}function tt(e){return new L(function(t){for(var n=0;n<e.length&&!t.closed;n++)t.next(e[n]);t.complete()})}function nt(e){return new L(function(t){e.then(function(n){t.closed||(t.next(n),t.complete())},function(n){return t.error(n)}).then(null,fe)})}function at(e){return new L(function(t){var n,a;try{for(var o=(0,v.__values)(e),l=o.next();!l.done;l=o.next()){var r=l.value;if(t.next(r),t.closed)return}}catch(u){n={error:u}}finally{try{l&&!l.done&&(a=o.return)&&a.call(o)}finally{if(n)throw n.error}}t.complete()})}function ye(e){return new L(function(t){ot(e,t).catch(function(n){return t.error(n)})})}function rt(e){return ye(ze(e))}function ot(e,t){var n,a,o,l;return(0,v.__awaiter)(this,void 0,void 0,function(){var r,u;return(0,v.__generator)(this,function(s){switch(s.label){case 0:s.trys.push([0,5,6,11]),n=(0,v.__asyncValues)(e),s.label=1;case 1:return[4,n.next()];case 2:if(a=s.sent(),!!a.done)return[3,4];if(r=a.value,t.next(r),t.closed)return[2];s.label=3;case 3:return[3,1];case 4:return[3,11];case 5:return u=s.sent(),o={error:u},[3,11];case 6:return s.trys.push([6,,9,10]),a&&!a.done&&(l=n.return)?[4,l.call(n)]:[3,8];case 7:s.sent(),s.label=8;case 8:return[3,10];case 9:if(o)throw o.error;return[7];case 10:return[7];case 11:return t.complete(),[2]}})})}function ge(e){return se(function(t,n){var a=null,o=!1,l;a=t.subscribe(me(n,void 0,void 0,function(r){l=Ze(e(r,ge(e)(t))),a?(a.unsubscribe(),a=null,l.subscribe(n)):o=!0})),o&&(a.unsubscribe(),a=null,l.subscribe(n))})}const lt=["started","submitted","running"],be=(e="")=>lt.includes(e),it=e=>!!(typeof e=="object"&&e?.hasOwnProperty("queryID")&&e?.hasOwnProperty("status"));class bt extends De.iy{constructor(t){var n;super(t),this.runningQueries={},this.requestCounter=100,this.cancel=a=>{this.storeQuery(a,{shouldCancel:!0})},this.requestIdPrefix=(n=t.uid)!=null?n:t.id}query(t){const n=this.filterQuery?t.targets.filter(this.filterQuery):t.targets;if(!n.length)return(0,oe.of)({data:[]});const a=[];for(let o of n)o.hide||a.push(this.doSingle(o,t));return(0,Ce.h)(...a)}storeQuery(t,n){const a=JSON.stringify(t),o=this.runningQueries[a]||{};this.runningQueries[a]={...o,...n}}getQuery(t){const n=JSON.stringify(t);return this.runningQueries[n]||{}}removeQuery(t){const n=JSON.stringify(t);delete this.runningQueries[n]}doSingle(t,n){let a,o,l=[];return xe({...n,targets:[t],requestId:`${this.requestIdPrefix}_${this.requestCounter++}`},{getNextQuery:r=>{var u,s;if((u=r.data)!=null&&u.length){const d=(s=r.data[0].meta)==null?void 0:s.custom;if(it(d)&&be(d.status))return a=d.queryID,o=d.status,this.storeQuery(t,{queryID:a}),{...t,queryID:a}}this.removeQuery(t)},query:r=>{const{range:u,targets:s,requestId:h,intervalMs:d,maxDataPoints:S}=r,[m]=s,b={...m,meta:{queryFlow:"async"},intervalMs:d,maxDataPoints:S,datasource:this==null?void 0:this.getRef(),datasourceId:this.id,...this.applyTemplateVariables(m,r.scopedVars)};return!O.$.featureToggles.awsAsyncQueryCaching&&be(o)?(0,Ie.lt)(O.$.buildInfo.version,"10.2.3")?(0,Ae.AI)().fetch({method:"POST",url:"/api/ds/query",headers:{"X-Cache-Skip":!0},requestId:h,data:{queries:[b],range:u,from:u.from.valueOf().toString(),to:u.to.valueOf().toString()}}).pipe(Me(y=>({data:(0,re.bE)(y).data})),ge(y=>(0,oe.of)((0,re.bE)(y)))):super.query({...r,targets:[b],skipQueryCache:!0}):super.query({...r,targets:[b]})},process:r=>{for(const u of r)u.fields.length>0&&l.push(u);return l},shouldCancel:()=>{const{shouldCancel:r}=this.getQuery(t);return!!r},onCancel:()=>{a&&(this.removeQuery(t),this.postResource("cancel",{queryId:a}).catch(r=>{r.isHandled=!0,console.error(`error cancelling query ID: ${a}`,r)}))}})}}const Et=e=>{const{state:t}=e,[n,a]=useState(!1),[o,l]=useState(!1),[r,u]=useState(t),[s,h]=useState(e.query);useEffect(()=>{t&&r!==t&&t!==LoadingState.Loading&&(a(!1),l(!1)),u(t)},[t,r]);const d=()=>{a(!0),h(e.query),e.onRunQuery()},S=e.onCancelQuery?()=>{var m;(m=e.onCancelQuery)==null||m.call(e,s),l(!0)}:void 0;return React.createElement(React.Fragment,null,React.createElement(Button,{variant:e.enableRun?"primary":"secondary",size:"sm",onClick:d,icon:n&&!o?"fa fa-spinner":void 0,disabled:t===LoadingState.Loading||!e.enableRun},"Run query"),React.createElement(Button,{variant:n&&!o?"primary":"secondary",size:"sm",disabled:!n||o,icon:o?"fa fa-spinner":void 0,onClick:S},"Stop query"))};function Rt({query:e,showAsyncQueryButtons:t,extraHeaderElementLeft:n,extraHeaderElementRight:a,enableRunButton:o,onRunQuery:l,data:r,cancel:u}){return React.createElement(EditorHeader,null,n,React.createElement(FlexItem,{grow:1}),t?React.createElement(RunQueryButtons,{onRunQuery:l,enableRun:o,query:e,onCancelQuery:s=>{u?.(s)},state:r?.state}):React.createElement(Button,{variant:o?"primary":"secondary",size:"sm",onClick:l,icon:r?.state===LoadingState.Loading?"fa fa-spinner":void 0,disabled:r?.state===LoadingState.Loading||!o},"Run queries"),a)}function St(e){var t;const n=a=>{var o;e.onChange({...e.query,format:a.value||0}),(o=e.onRunQuery)==null||o.call(e)};return React.createElement(Select,{"aria-label":"Format data frames as",id:(t=e.id)!=null?t:"formatAs",options:e.options,value:e.query.format,onChange:n,menuShouldPortal:!0})}var st=(e=>(e[e.Previous=0]="Previous",e[e.Null=1]="Null",e[e.Value=2]="Value",e))(st||{});const ut=[{label:"Previous Value",value:0},{label:"NULL",value:1},{label:"Value",value:2}];function pt(e){var t,n,a;return React.createElement(React.Fragment,null,React.createElement(EditorField,{label:"Fill with",tooltip:"value to fill missing points",htmlFor:"fillWith"},React.createElement(Select,{id:"fillWith","aria-label":"Fill with","data-testid":"table-fill-with-select",options:ut,value:(n=(t=e.query.fillMode)==null?void 0:t.mode)!=null?n:0,onChange:({value:o})=>{var l;e.onChange({...e.query,fillMode:{...e.query.fillMode,mode:o}}),(l=e.onRunQuery)==null||l.call(e)},menuShouldPortal:!0})),((a=e.query.fillMode)==null?void 0:a.mode)===2&&React.createElement(EditorField,{label:"Value",htmlFor:"valueToFill",width:6},React.createElement(Input,{id:"valueToFill","aria-label":"Value",type:"number",value:e.query.fillMode.value,onChange:({currentTarget:o})=>e.onChange({...e.query,fillMode:{mode:2,value:o.valueAsNumber}}),onBlur:()=>{var o;return(o=e.onRunQuery)==null?void 0:o.call(e)}})))}},85480:(B,j,c)=>{c.d(j,{I:()=>P});var i=c(96540),g=c(88941);const P=({children:p,...x})=>i.createElement(g.x,{...x,kind:"sub-section"},p)},88941:(B,j,c)=>{c.d(j,{x:()=>x});var i=c(96540),g=c(22803),P=c(76319),p=c(63142);const x=({children:V,title:K,description:D,isCollapsible:O=!1,isInitiallyOpen:k=!0,kind:A="section",className:M})=>{const{colors:J,typography:Q,spacing:N}=(0,p.$j)(),[T,ae]=(0,i.useState)(O?k:!0),q=T?"angle-up":"angle-down",G=A==="sub-section",$=`${T?"Collapse":"Expand"} section ${K}`,w={header:(0,g.css)({display:"flex",justifyContent:"space-between",alignItems:"center"}),title:(0,g.css)({margin:0}),subtitle:(0,g.css)({margin:0,fontWeight:Q.fontWeightRegular}),descriptionText:(0,g.css)({marginTop:N(G?.25:.5),marginBottom:0,...Q.bodySmall,color:J.text.secondary}),content:(0,g.css)({marginTop:N(2)})};return i.createElement("div",{className:M},i.createElement("div",{className:w.header},A==="section"?i.createElement("h3",{className:w.title},K):i.createElement("h6",{className:w.subtitle},K),O&&i.createElement(P.K,{name:q,onClick:()=>ae(!T),type:"button",size:"xl","aria-label":$})),D&&i.createElement("p",{className:w.descriptionText},D),T&&i.createElement("div",{className:w.content},V))}}}]);

//# sourceMappingURL=5074.92e2d1ae98dcd913506e.js.map