{"version":3,"file":"influxdbPlugin.9ddd5f36f2fced5908b8.js","mappings":"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AC5C,CAEA,OAAIT,EAAI,SAAS,SAAS,OACxBE,GAAY,aAAaF,EAAI,QAAQ,SAAS,IAAI,MAGhDA,EAAI,SAAS,SAAS,MAAQA,EAAI,mBACpCE,GAAY,GAAGF,EAAI,gBAAgB,KAIjCU,GAAQV,EAAI,KAAK,IACnBE,GAAY,SAASF,EAAI,KAAK,IAGzBE,CACT,CAIA,SAASI,GAAgBK,EAAuC,CAC9D,OAAIA,IAAc,IACTA,EAGF,IAAIA,CAAS,GACtB,CAEA,MAAMD,GAAWE,GAAuCA,IAAU,QAAaA,GAAS,EAGjF,SAASC,GAA2BzI,EAAe,CACxD,OAAO0I,GAAkB1I,CAAK,EAAIA,EAAQ,IAAKA,CAAK,GACtD,CAMO,SAAS0I,GAAkBC,EAA6B,CAC7D,MAAMC,EAAc,6BAA6B,KAAKD,CAAU,EAEhE,MAAO,CADgBE,GAAe,SAASF,EAAW,YAAY,CAAC,GAC7CC,CAC5B,CAEA,MAAMC,GAAiB,CACrB,aACA,MACA,MACA,QACA,UACA,MACA,KACA,MACA,aACA,SACA,UACA,SACA,SACA,OACA,OACA,KACA,OACA,UACA,OACA,SACA,OACA,YACA,QACA,UACA,SACA,YACA,aACA,WACA,UACA,SACA,QACA,OACA,YACA,eACA,eACA,oBACA,eACA,SACA,WACA,YACA,WACA,kBACA,aACA,aACA,MACA,UACA,UACA,UACA,UACA,SACA,aACA,OACA,WACA,gBACA,WACA,cACA,MACA,SACA,OACA,OACA,OACA,OACA,SACA,QACA,WACA,UACA,SACA,SACA,OACA,UACA,QACA,QACA,cACA,QACA,SACA,SACA,MACA,QACA,UACA,OACA,WACA,WACA,YACA,MACA,QACA,QACA,WACA,SACA,SACA,gBACA,mBACA,cACA,cACA,KACA,SACA,KACA,QACA,SACA,QACA,QACA,cACA,SACA,MACA,OACA,OACA,OACA,OACA,OACA,UACA,YACA,WACA,OACA,iBACA,kBACA,KACA,UACA,OACA,aACA,MACA,OACA,OACA,MACA,aACA,UACA,OACA,UACA,QACA,OACA,OACA,QACA,SACA,QACA,OACA,YACA,iBACA,OACA,OACA,WACA,WACA,OACA,eACA,cACA,gCACA,QACA,WACA,aACA,YACA,aACA,YACA,qBACA,gBACA,MACA,WACA,UACA,MACA,qBACA,YACA,QACA,OACA,UACA,KACA,KACA,WACA,kBACA,SACA,aACA,KACA,QACA,MACA,QACA,UACA,OACA,YACA,eACA,YACA,UACA,YACA,QACA,QACA,OACA,OACA,QACA,aACA,OACA,YACA,aACA,SACA,UACA,SACA,SACA,UACA,UACA,WACA,WACA,SACA,SACA,QACA,QACA,MACA,OACA,aACA,SACA,UACA,qBACA,SACA,YACA,YACA,MACA,OACA,SACA,WACA,UACA,WACA,MACA,eACA,WACA,aACA,iBACA,sBACA,mBACA,MACA,WACA,SACA,gBACA,SACA,QACA,aACA,OACA,WACA,UACA,WACA,KACA,WACA,UACA,OACA,OACA,QACA,SACA,SACA,WACA,SACA,QACA,MACA,QACA,WACA,WACA,gBACA,SACA,YACA,UACA,eACA,UACA,UACA,OACA,QACA,QACA,SACA,OACA,QACA,MACA,aACA,UACF,ECvWO,SAASC,GAAgBC,EAAkB,CAEhD,MAAO,yEADUA,IAAY,OAAYC,GAAoBD,CAAO,EAAI,YACgB,sBAC1F,CAEO,SAASE,IAAgB,CAC9B,MAAO,qHACT,CAEO,SAASC,GAAiBrB,EAAesB,EAAiB,CAC/D,IAAIxF,EAAQ,uEACZ,OAAAA,GAASyF,GAAqBvB,EAAOsB,CAAM,EAE3CxF,GAAS,wBAEFA,CACT,CAEO,SAASyF,GAAqBvB,EAAesB,EAAiB,CACnE,IAAIxF,EAAQ,GAGZ,GAAIkE,EAAM,SAAS,GAAG,EAAG,CACvB,MAAMjE,EAAQiE,EAAM,MAAM,GAAG,EAC7B,OAAAlE,EAAQ,kBAAoBqF,GAAoBpF,EAAM,CAAC,CAAC,EACxDD,GAAS,qBAAuBqF,GAAoBpF,EAAM,CAAC,CAAC,EACrDD,CACT,KAEE,QAAAA,EAAQ,kBADSwF,IAAW,OAAYH,GAAoBG,CAAM,EAAI,YACpC,qBAAuBH,GAAoBnB,CAAK,EAE3ElE,CAEX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","sources":["webpack://grafana/./node_modules/@grafana/plugin-ui/dist/esm/components/QueryEditor/AccessoryButton.js","webpack://grafana/./public/app/plugins/datasource/influxdb/constants.ts","webpack://grafana/./public/app/plugins/datasource/influxdb/types.ts","webpack://grafana/./public/app/plugins/datasource/influxdb/components/editor/config/constants.ts","webpack://grafana/./public/app/plugins/datasource/influxdb/components/editor/config/trackingv1.ts","webpack://grafana/./public/app/plugins/datasource/influxdb/components/editor/config/InfluxFluxConfig.tsx","webpack://grafana/./public/app/plugins/datasource/influxdb/components/editor/config/InfluxInfluxQLConfig.tsx","webpack://grafana/./public/app/plugins/datasource/influxdb/components/editor/config/InfluxSQLConfig.tsx","webpack://grafana/./public/app/plugins/datasource/influxdb/components/editor/config/ConfigEditor.tsx","webpack://grafana/./public/app/plugins/datasource/influxdb/components/editor/config-v2/constants.ts","webpack://grafana/./public/app/plugins/datasource/influxdb/components/editor/config-v2/tracking.ts","webpack://grafana/./public/app/plugins/datasource/influxdb/components/editor/config-v2/AdvancedDBConnectionSettings.tsx","webpack://grafana/./public/app/plugins/datasource/influxdb/components/editor/config-v2/InfluxFluxDBConnection.tsx","webpack://grafana/./public/app/plugins/datasource/influxdb/components/editor/config-v2/InfluxInfluxQLDBConnection.tsx","webpack://grafana/./public/app/plugins/datasource/influxdb/components/editor/config-v2/InfluxSQLDBConnection.tsx","webpack://grafana/./public/app/plugins/datasource/influxdb/components/editor/config-v2/DatabaseConnectionSection.tsx","webpack://grafana/./public/app/plugins/datasource/influxdb/components/editor/config-v2/LeftSideBar.tsx","webpack://grafana/./public/app/plugins/datasource/influxdb/components/editor/config-v2/AdvancedHttpSettings.tsx","webpack://grafana/./public/app/plugins/datasource/influxdb/components/editor/config-v2/AuthSettings.tsx","webpack://grafana/./public/app/plugins/datasource/influxdb/components/editor/config-v2/versions.ts","webpack://grafana/./public/app/plugins/datasource/influxdb/components/editor/config-v2/UrlAndAuthenticationSection.tsx","webpack://grafana/./public/app/plugins/datasource/influxdb/components/editor/config-v2/ConfigEditor.tsx","webpack://grafana/./public/app/plugins/datasource/influxdb/query_part.ts","webpack://grafana/./public/app/plugins/datasource/influxdb/influx_query_model.ts","webpack://grafana/./public/app/plugins/datasource/influxdb/queryUtils.ts","webpack://grafana/./public/app/plugins/datasource/influxdb/components/editor/query/flux/FluxQueryEditor.tsx","webpack://grafana/./public/app/plugins/datasource/influxdb/fsql/fields.ts","webpack://grafana/./public/app/plugins/datasource/influxdb/fsql/sqlUtil.ts","webpack://grafana/./public/app/plugins/datasource/influxdb/fsql/flightsqlMetaQuery.ts","webpack://grafana/./public/app/plugins/datasource/influxdb/fsql/sqlCompletionProvider.ts","webpack://grafana/./public/app/plugins/datasource/influxdb/fsql/datasource.flightsql.ts","webpack://grafana/./public/app/plugins/datasource/influxdb/components/editor/query/fsql/FSQLEditor.tsx","webpack://grafana/./public/app/plugins/datasource/influxdb/components/editor/query/influxql/QueryEditorModeSwitcher.tsx","webpack://grafana/./public/app/plugins/datasource/influxdb/components/editor/constants.ts","webpack://grafana/./public/app/plugins/datasource/influxdb/components/editor/query/influxql/hooks/useShadowedState.ts","webpack://grafana/./public/app/plugins/datasource/influxdb/components/editor/query/influxql/code/RawInfluxQLEditor.tsx","webpack://grafana/./public/app/plugins/datasource/influxdb/influxql_query_builder.ts","webpack://grafana/./public/app/plugins/datasource/influxdb/influxql_metadata_query.ts","webpack://grafana/./public/app/plugins/datasource/influxdb/components/editor/query/influxql/utils/filterTags.ts","webpack://grafana/./public/app/plugins/datasource/influxdb/components/editor/query/influxql/utils/toSelectableValue.ts","webpack://grafana/./public/app/plugins/datasource/influxdb/components/editor/query/influxql/utils/unwrap.ts","webpack://grafana/./public/app/plugins/datasource/influxdb/components/editor/query/influxql/utils/partListUtils.tsx","webpack://grafana/./public/app/plugins/datasource/influxdb/components/editor/query/influxql/utils/getTemplateVariableOptions.ts","webpack://grafana/./public/app/plugins/datasource/influxdb/components/editor/query/influxql/utils/withTemplateVariableOptions.ts","webpack://grafana/./public/app/plugins/datasource/influxdb/components/editor/query/influxql/utils/wrapper.ts","webpack://grafana/./public/app/plugins/datasource/influxdb/components/editor/query/influxql/visual/styles.ts","webpack://grafana/./public/app/plugins/datasource/influxdb/components/editor/query/influxql/visual/FormatAsSection.tsx","webpack://grafana/./public/app/plugins/datasource/influxdb/components/editor/query/influxql/visual/Seg.tsx","webpack://grafana/./public/app/plugins/datasource/influxdb/components/editor/query/influxql/visual/FromSection.tsx","webpack://grafana/./public/app/plugins/datasource/influxdb/components/editor/query/influxql/visual/InputSection.tsx","webpack://grafana/./public/app/plugins/datasource/influxdb/components/editor/query/influxql/visual/OrderByTimeSection.tsx","webpack://grafana/./public/app/plugins/datasource/influxdb/components/editor/query/influxql/visual/AddButton.tsx","webpack://grafana/./public/app/plugins/datasource/influxdb/components/editor/query/influxql/visual/PartListSection.tsx","webpack://grafana/./public/app/plugins/datasource/influxdb/components/editor/query/influxql/utils/tagUtils.ts","webpack://grafana/./public/app/plugins/datasource/influxdb/components/editor/query/influxql/visual/TagsSection.tsx","webpack://grafana/./public/app/plugins/datasource/influxdb/components/editor/query/influxql/visual/VisualInfluxQLEditor.tsx","webpack://grafana/./public/app/plugins/datasource/influxdb/components/editor/query/QueryEditor.tsx","webpack://grafana/./public/app/plugins/datasource/influxdb/components/editor/query/influxql/InfluxCheatSheet.tsx","webpack://grafana/./public/app/plugins/datasource/influxdb/components/editor/query/influxql/InfluxStartPage.tsx","webpack://grafana/./public/app/plugins/datasource/influxdb/components/editor/annotation/AnnotationEditor.tsx","webpack://grafana/./public/app/plugins/datasource/influxdb/influx_series.ts","webpack://grafana/./public/app/plugins/datasource/influxdb/migrations.ts","webpack://grafana/./public/app/plugins/datasource/influxdb/response_parser.ts","webpack://grafana/./public/app/plugins/datasource/influxdb/components/editor/variable/VariableQueryEditor.tsx","webpack://grafana/./public/app/plugins/datasource/influxdb/variables.ts","webpack://grafana/./public/app/plugins/datasource/influxdb/datasource.ts","webpack://grafana/./public/app/plugins/datasource/influxdb/module.ts","webpack://grafana/./node_modules/@grafana/plugin-ui/dist/esm/components/ConfigEditor/Auth/types.js","webpack://grafana/./node_modules/@grafana/plugin-ui/dist/esm/components/ConfigEditor/Auth/utils.js"],"sourcesContent":["import { cx, css } from '@emotion/css';\nimport React__default from 'react';\nimport '@grafana/data';\nimport { useStyles2, Button } from '@grafana/ui';\n\nconst AccessoryButton = ({ className, ...props }) => {\n  const styles = useStyles2(getButtonStyles);\n  return /* @__PURE__ */ React__default.createElement(Button, { ...props, className: cx(className, styles.button) });\n};\nconst getButtonStyles = (theme) => ({\n  button: css({\n    paddingLeft: theme.spacing(3 / 2),\n    paddingRight: theme.spacing(3 / 2)\n  })\n});\n\nexport { AccessoryButton };\n//# sourceMappingURL=AccessoryButton.js.map\n","export const BROWSER_MODE_DISABLED_MESSAGE =\n  'Direct browser access in the InfluxDB datasource is no longer available. Switch to server access mode.';\n","import { AdHocVariableFilter, DataQuery, DataSourceJsonData } from '@grafana/data';\n\nexport const DEFAULT_POLICY = 'default';\n\nexport enum InfluxVersion {\n  InfluxQL = 'InfluxQL',\n  Flux = 'Flux',\n  SQL = 'SQL',\n}\n\nexport interface InfluxOptions extends DataSourceJsonData {\n  version?: InfluxVersion;\n\n  timeInterval?: string;\n  httpMode?: string;\n  showTagTime?: string;\n\n  dbName?: string;\n  product?: string;\n  pdcInjected?: boolean;\n  oauthPassThru?: boolean;\n\n  // With Flux\n  organization?: string;\n  defaultBucket?: string;\n  maxSeries?: number;\n\n  // With SQL\n  metadata?: Array<Record<string, string>>;\n  insecureGrpc?: boolean;\n}\n\n/**\n * @deprecated\n */\nexport interface InfluxOptionsV1 extends InfluxOptions {\n  user?: string;\n  database?: string;\n}\n\nexport interface InfluxSecureJsonData {\n  // For Flux\n  token?: string;\n\n  // In 1x a different password can be sent than then HTTP auth\n  password?: string;\n}\n\nexport interface InfluxQueryPart {\n  type: string;\n  params?: Array<string | number>;\n  // FIXME: `interval` does not seem to be used.\n  // check all the influxdb parts (query-generation etc.),\n  // if it is really so, and if yes, remove it\n  interval?: string;\n}\n\nexport interface InfluxQueryTag {\n  key: string;\n  operator?: string;\n  condition?: string;\n  value: string;\n}\n\nexport type ResultFormat = 'time_series' | 'table' | 'logs';\n\nexport interface InfluxVariableQuery extends DataQuery {\n  query: string;\n  maxDataPoints?: number;\n}\n\nexport interface InfluxQuery extends DataQuery {\n  policy?: string;\n  measurement?: string;\n  resultFormat?: ResultFormat;\n  orderByTime?: string;\n  tags?: InfluxQueryTag[];\n  groupBy?: InfluxQueryPart[];\n  select?: InfluxQueryPart[][];\n  limit?: string | number;\n  slimit?: string | number;\n  tz?: string;\n  // NOTE: `fill` is not used in the query-editor anymore, and is removed\n  // if any change happens in the query-editor. the query-generation still\n  // supports it for now.\n  fill?: string;\n  rawQuery?: boolean;\n  query?: string;\n  alias?: string;\n  // for migrated InfluxQL annotations\n  queryType?: string;\n  fromAnnotations?: boolean;\n  tagsColumn?: string;\n  textColumn?: string;\n  timeEndColumn?: string;\n  titleColumn?: string;\n  name?: string;\n  matchAny?: boolean;\n  type?: string;\n\n  textEditor?: boolean;\n  adhocFilters?: AdHocVariableFilter[];\n}\n\nexport type MetadataQueryType = 'TAG_KEYS' | 'TAG_VALUES' | 'MEASUREMENTS' | 'FIELDS' | 'RETENTION_POLICIES';\n","export const WIDTH_SHORT = 20;\n","import { reportInteraction } from '@grafana/runtime';\n\nexport const trackInfluxDBConfigV1QueryLanguageSelection = (props: { version: string }) => {\n  reportInteraction('influxdb-configv1-query-language-dropdown', props);\n};\n\n// Flux Database Fields\nexport const trackInfluxDBConfigV1FluxOrgInputField = () => {\n  reportInteraction('influxdb-configv1-flux-dbdetails-organization-input-field');\n};\n\nexport const trackInfluxDBConfigV1FluxTokenInputField = () => {\n  reportInteraction('influxdb-configv1-flux-dbdetails-token-input-field');\n};\n\nexport const trackInfluxDBConfigV1FluxDefaultBucketInputField = () => {\n  reportInteraction('influxdb-configv1-flux-dbdetails-default-bucket-input-field');\n};\n\n// InfluxQL Database Fields\nexport const trackInfluxDBConfigV1InfluxQLDatabaseInputField = () => {\n  reportInteraction('influxdb-configv1-influxql-dbdetails-database-input-field');\n};\n\nexport const trackInfluxDBConfigV1InfluxQLUserInputField = () => {\n  reportInteraction('influxdb-configv1-influxql-dbdetails-user-input-field');\n};\n\nexport const trackInfluxDBConfigV1InfluxQLPasswordInputField = () => {\n  reportInteraction('influxdb-configv1-influxql-dbdetails-password-input-field');\n};\n\n// SQL Database Fields\nexport const trackInfluxDBConfigV1SQLDatabaseInputField = () => {\n  reportInteraction('influxdb-configv1-sql-dbdetails-database-input-field');\n};\n\nexport const trackInfluxDBConfigV1SQLTokenInputField = () => {\n  reportInteraction('influxdb-configv1-sql-dbdetails-token-input-field');\n};\n","import { uniqueId } from 'lodash';\n\nimport {\n  DataSourcePluginOptionsEditorProps,\n  onUpdateDatasourceJsonDataOption,\n  onUpdateDatasourceSecureJsonDataOption,\n  updateDatasourcePluginResetOption,\n} from '@grafana/data';\nimport { InlineField, InlineFieldRow, Input, SecretInput } from '@grafana/ui';\n\nimport { InfluxOptions, InfluxSecureJsonData } from '../../../types';\n\nimport { WIDTH_SHORT } from './constants';\nimport {\n  trackInfluxDBConfigV1FluxDefaultBucketInputField,\n  trackInfluxDBConfigV1FluxOrgInputField,\n  trackInfluxDBConfigV1FluxTokenInputField,\n} from './trackingv1';\n\nexport type Props = DataSourcePluginOptionsEditorProps<InfluxOptions, InfluxSecureJsonData>;\n\nexport const InfluxFluxConfig = (props: Props) => {\n  const {\n    options: { jsonData, secureJsonData, secureJsonFields },\n  } = props;\n  const htmlPrefix = uniqueId('influxdb-flux-config');\n\n  return (\n    <>\n      <InlineFieldRow>\n        <InlineField labelWidth={WIDTH_SHORT} label=\"Organization\" htmlFor={`${htmlPrefix}-org`}>\n          <Input\n            id={`${htmlPrefix}-org`}\n            className=\"width-20\"\n            value={jsonData.organization || ''}\n            onChange={onUpdateDatasourceJsonDataOption(props, 'organization')}\n            onBlur={trackInfluxDBConfigV1FluxOrgInputField}\n          />\n        </InlineField>\n      </InlineFieldRow>\n      <InlineFieldRow>\n        <InlineField labelWidth={WIDTH_SHORT} label=\"Token\">\n          <SecretInput\n            isConfigured={Boolean(secureJsonFields && secureJsonFields.token)}\n            value={secureJsonData?.token || ''}\n            label=\"Token\"\n            aria-label=\"Token\"\n            className=\"width-20\"\n            onReset={() => updateDatasourcePluginResetOption(props, 'token')}\n            onChange={onUpdateDatasourceSecureJsonDataOption(props, 'token')}\n            onBlur={trackInfluxDBConfigV1FluxTokenInputField}\n          />\n        </InlineField>\n      </InlineFieldRow>\n      <InlineFieldRow>\n        <InlineField labelWidth={WIDTH_SHORT} label=\"Default Bucket\">\n          <Input\n            className=\"width-20\"\n            placeholder=\"default bucket\"\n            value={jsonData.defaultBucket || ''}\n            onChange={onUpdateDatasourceJsonDataOption(props, 'defaultBucket')}\n            onBlur={trackInfluxDBConfigV1FluxDefaultBucketInputField}\n          />\n        </InlineField>\n      </InlineFieldRow>\n\n      <InlineFieldRow>\n        <InlineField\n          labelWidth={WIDTH_SHORT}\n          label=\"Min time interval\"\n          tooltip=\"A lower limit for the auto group by time interval. Recommended to be set to write frequency,\n\t\t\t\tfor example 1m if your data is written every minute.\"\n        >\n          <Input\n            className=\"width-20\"\n            placeholder=\"10s\"\n            value={jsonData.timeInterval || ''}\n            onChange={onUpdateDatasourceJsonDataOption(props, 'timeInterval')}\n          />\n        </InlineField>\n      </InlineFieldRow>\n    </>\n  );\n};\n","import { css } from '@emotion/css';\nimport { uniqueId } from 'lodash';\n\nimport {\n  DataSourcePluginOptionsEditorProps,\n  GrafanaTheme2,\n  onUpdateDatasourceJsonDataOption,\n  onUpdateDatasourceJsonDataOptionSelect,\n  onUpdateDatasourceOption,\n  onUpdateDatasourceSecureJsonDataOption,\n  SelectableValue,\n  updateDatasourcePluginResetOption,\n} from '@grafana/data';\nimport { Alert, Field, InlineLabel, Input, SecretInput, Select, useStyles2 } from '@grafana/ui';\n\nimport { InfluxOptions, InfluxSecureJsonData } from '../../../types';\n\nimport { WIDTH_SHORT } from './constants';\nimport {\n  trackInfluxDBConfigV1InfluxQLDatabaseInputField,\n  trackInfluxDBConfigV1InfluxQLPasswordInputField,\n  trackInfluxDBConfigV1InfluxQLUserInputField,\n} from './trackingv1';\n\nconst httpModes: SelectableValue[] = [\n  { label: 'GET', value: 'GET' },\n  { label: 'POST', value: 'POST' },\n];\n\nexport type Props = DataSourcePluginOptionsEditorProps<InfluxOptions, InfluxSecureJsonData>;\n\nexport const InfluxInfluxQLConfig = (props: Props) => {\n  const { options, onOptionsChange } = props;\n  const { database, jsonData, secureJsonData, secureJsonFields } = options;\n  const styles = useStyles2(getStyles);\n\n  const htmlPrefix = uniqueId('influxdb-influxql-config');\n\n  return (\n    <>\n      <Alert severity=\"info\" title=\"Database Access\">\n        <p>\n          Setting the database for this datasource does not deny access to other databases. The InfluxDB query syntax\n          allows switching the database in the query. For example:\n          <code>SHOW MEASUREMENTS ON _internal</code> or\n          <code>SELECT * FROM &quot;_internal&quot;..&quot;database&quot; LIMIT 10</code>\n          <br />\n          <br />\n          To support data isolation and security, make sure appropriate permissions are configured in InfluxDB.\n        </p>\n      </Alert>\n\n      <Field\n        horizontal\n        label={<InlineLabel width={WIDTH_SHORT}>Database</InlineLabel>}\n        className={styles.horizontalField}\n        htmlFor={`${htmlPrefix}-db`}\n        noMargin\n      >\n        <Input\n          id={`${htmlPrefix}-db`}\n          className=\"width-20\"\n          value={jsonData.dbName ?? database}\n          onChange={(event) => {\n            onOptionsChange({\n              ...options,\n              database: '',\n              jsonData: {\n                ...jsonData,\n                dbName: event.currentTarget.value,\n              },\n            });\n          }}\n          onBlur={trackInfluxDBConfigV1InfluxQLDatabaseInputField}\n        />\n      </Field>\n      <Field\n        horizontal\n        label={<InlineLabel width={WIDTH_SHORT}>User</InlineLabel>}\n        className={styles.horizontalField}\n        htmlFor={`${htmlPrefix}-user`}\n        noMargin\n      >\n        <Input\n          id={`${htmlPrefix}-user`}\n          className=\"width-20\"\n          value={options.user || ''}\n          onChange={onUpdateDatasourceOption(props, 'user')}\n          onBlur={trackInfluxDBConfigV1InfluxQLUserInputField}\n        />\n      </Field>\n      <Field\n        horizontal\n        label={<InlineLabel width={WIDTH_SHORT}>Password</InlineLabel>}\n        className={styles.horizontalField}\n        noMargin\n      >\n        <SecretInput\n          isConfigured={Boolean(secureJsonFields && secureJsonFields.password)}\n          value={secureJsonData?.password || ''}\n          label=\"Password\"\n          aria-label=\"Password\"\n          className=\"width-20\"\n          onReset={() => updateDatasourcePluginResetOption(props, 'password')}\n          onChange={onUpdateDatasourceSecureJsonDataOption(props, 'password')}\n          onBlur={trackInfluxDBConfigV1InfluxQLPasswordInputField}\n        />\n      </Field>\n      <Field\n        horizontal\n        label={\n          <InlineLabel\n            width={WIDTH_SHORT}\n            tooltip=\"You can use either GET or POST HTTP method to query your InfluxDB database. The POST\n          method allows you to perform heavy requests (with a lots of WHERE clause) while the GET method\n          will restrict you and return an error if the query is too large.\"\n          >\n            HTTP Method\n          </InlineLabel>\n        }\n        htmlFor={`${htmlPrefix}-http-method`}\n        className={styles.horizontalField}\n        noMargin\n      >\n        <Select\n          inputId={`${htmlPrefix}-http-method`}\n          className=\"width-20\"\n          value={httpModes.find((httpMode) => httpMode.value === options.jsonData.httpMode)}\n          options={httpModes}\n          defaultValue={options.jsonData.httpMode}\n          onChange={onUpdateDatasourceJsonDataOptionSelect(props, 'httpMode')}\n        />\n      </Field>\n\n      <Field\n        horizontal\n        label={\n          <InlineLabel\n            width={WIDTH_SHORT}\n            tooltip=\"A lower limit for the auto group by time interval. Recommended to be set to write frequency, for example 1m if your data is written every minute.\"\n          >\n            Min time interval\n          </InlineLabel>\n        }\n        className={styles.horizontalField}\n        noMargin\n      >\n        <Input\n          className=\"width-20\"\n          placeholder=\"10s\"\n          value={options.jsonData.timeInterval || ''}\n          onChange={onUpdateDatasourceJsonDataOption(props, 'timeInterval')}\n        />\n      </Field>\n\n      <Field\n        horizontal\n        label={\n          <InlineLabel\n            width={WIDTH_SHORT}\n            tooltip=\"This time range is used in the query editor's autocomplete to reduce the execution time of tag filter queries.\"\n          >\n            Autocomplete range\n          </InlineLabel>\n        }\n        className={styles.horizontalField}\n        noMargin\n      >\n        <Input\n          className=\"width-20\"\n          placeholder=\"12h\"\n          value={options.jsonData.showTagTime || ''}\n          onChange={onUpdateDatasourceJsonDataOption(props, 'showTagTime')}\n        />\n      </Field>\n    </>\n  );\n};\n\nconst getStyles = (theme: GrafanaTheme2) => ({\n  horizontalField: css({\n    justifyContent: 'initial',\n    margin: `0 ${theme.spacing(0.5)} ${theme.spacing(0.5)} 0`,\n  }),\n});\n","import { css } from '@emotion/css';\nimport { uniqueId } from 'lodash';\n\nimport {\n  DataSourcePluginOptionsEditorProps,\n  GrafanaTheme2,\n  onUpdateDatasourceSecureJsonDataOption,\n  updateDatasourcePluginResetOption,\n} from '@grafana/data';\nimport { Field, InlineLabel, InlineSwitch, Input, SecretInput, useStyles2 } from '@grafana/ui';\n\nimport { InfluxOptions, InfluxSecureJsonData } from '../../../types';\n\nimport { WIDTH_SHORT } from './constants';\nimport { trackInfluxDBConfigV1SQLDatabaseInputField, trackInfluxDBConfigV1SQLTokenInputField } from './trackingv1';\n\nexport type Props = DataSourcePluginOptionsEditorProps<InfluxOptions, InfluxSecureJsonData>;\n\nexport const InfluxSqlConfig = (props: Props) => {\n  const { options, onOptionsChange } = props;\n  const { jsonData, secureJsonData, secureJsonFields } = options;\n  const styles = useStyles2(getStyles);\n  const htmlPrefix = uniqueId('influxdb-sql-config');\n\n  return (\n    <div>\n      <Field\n        horizontal\n        label={<InlineLabel width={WIDTH_SHORT}>Database</InlineLabel>}\n        className={styles.horizontalField}\n        htmlFor={`${htmlPrefix}-dbName`}\n      >\n        <Input\n          id={`${htmlPrefix}-dbName`}\n          className=\"width-20\"\n          aria-label=\"Database or bucket name\"\n          value={jsonData.dbName}\n          onChange={(event) => {\n            onOptionsChange({\n              ...options,\n              jsonData: {\n                ...jsonData,\n                dbName: event.currentTarget.value,\n              },\n            });\n          }}\n          onBlur={trackInfluxDBConfigV1SQLDatabaseInputField}\n        />\n      </Field>\n      <Field horizontal label={<InlineLabel width={WIDTH_SHORT}>Token</InlineLabel>} className={styles.horizontalField}>\n        <SecretInput\n          label=\"Token\"\n          aria-label=\"Token\"\n          className=\"width-20\"\n          value={secureJsonData?.token || ''}\n          onReset={() => updateDatasourcePluginResetOption(props, 'token')}\n          onChange={onUpdateDatasourceSecureJsonDataOption(props, 'token')}\n          isConfigured={Boolean(secureJsonFields && secureJsonFields.token)}\n          onBlur={trackInfluxDBConfigV1SQLTokenInputField}\n        />\n      </Field>\n      <Field\n        horizontal\n        label={<InlineLabel width={WIDTH_SHORT}>Insecure Connection</InlineLabel>}\n        className={styles.horizontalField}\n      >\n        <InlineSwitch\n          id={`${htmlPrefix}-insecure-grpc`}\n          value={jsonData.insecureGrpc ?? false}\n          onChange={(event) => {\n            onOptionsChange({\n              ...options,\n              jsonData: {\n                ...jsonData,\n                insecureGrpc: event.currentTarget.checked,\n              },\n            });\n          }}\n        />\n      </Field>\n    </div>\n  );\n};\n\nconst getStyles = (theme: GrafanaTheme2) => ({\n  horizontalField: css({\n    justifyContent: 'initial',\n    margin: `0 ${theme.spacing(0.5)} ${theme.spacing(0.5)} 0`,\n  }),\n});\n","import { uniqueId } from 'lodash';\nimport { PureComponent } from 'react';\n\nimport {\n  DataSourcePluginOptionsEditorProps,\n  DataSourceSettings,\n  SelectableValue,\n  updateDatasourcePluginJsonDataOption,\n} from '@grafana/data';\nimport { config } from '@grafana/runtime';\nimport { Alert, DataSourceHttpSettings, InlineField, Select, Field, Input, FieldSet, TextLink } from '@grafana/ui';\n\nimport { BROWSER_MODE_DISABLED_MESSAGE } from '../../../constants';\nimport { InfluxOptions, InfluxOptionsV1, InfluxVersion } from '../../../types';\n\nimport { InfluxFluxConfig } from './InfluxFluxConfig';\nimport { InfluxInfluxQLConfig } from './InfluxInfluxQLConfig';\nimport { InfluxSqlConfig } from './InfluxSQLConfig';\nimport { trackInfluxDBConfigV1QueryLanguageSelection } from './trackingv1';\n\nconst versionMap: Record<InfluxVersion, SelectableValue<InfluxVersion>> = {\n  [InfluxVersion.InfluxQL]: {\n    label: 'InfluxQL',\n    value: InfluxVersion.InfluxQL,\n    description: 'The InfluxDB SQL-like query language.',\n  },\n  [InfluxVersion.SQL]: {\n    label: 'SQL',\n    value: InfluxVersion.SQL,\n    description: 'Native SQL language. Supported in InfluxDB 3.0',\n  },\n  [InfluxVersion.Flux]: {\n    label: 'Flux',\n    value: InfluxVersion.Flux,\n    description: 'Supported in InfluxDB 2.x and 1.8+',\n  },\n};\n\nconst versions: Array<SelectableValue<InfluxVersion>> = [\n  versionMap[InfluxVersion.InfluxQL],\n  versionMap[InfluxVersion.SQL],\n  versionMap[InfluxVersion.Flux],\n];\n\nexport type Props = DataSourcePluginOptionsEditorProps<InfluxOptions>;\ntype State = {\n  maxSeries: string | undefined;\n};\n\nexport class ConfigEditor extends PureComponent<Props, State> {\n  state = {\n    maxSeries: '',\n  };\n\n  htmlPrefix: string;\n\n  constructor(props: Props) {\n    super(props);\n    this.state.maxSeries = props.options.jsonData.maxSeries?.toString() || '';\n    this.htmlPrefix = uniqueId('influxdb-config');\n  }\n\n  versionNotice = {\n    Flux: 'Support for Flux in Grafana is currently in beta',\n    SQL: 'Support for SQL in Grafana is currently in alpha',\n  };\n\n  onVersionChanged = (selected: SelectableValue<InfluxVersion>) => {\n    const { options, onOptionsChange } = this.props;\n\n    if (selected.value) {\n      trackInfluxDBConfigV1QueryLanguageSelection({ version: selected.value });\n    }\n\n    const copy: DataSourceSettings<InfluxOptionsV1, {}> = {\n      ...options,\n      jsonData: {\n        ...options.jsonData,\n        version: selected.value,\n      },\n    };\n    if (selected.value === InfluxVersion.Flux) {\n      copy.access = 'proxy';\n      copy.basicAuth = true;\n      copy.jsonData.httpMode = 'POST';\n\n      // Remove old 1x configs\n      const { user, database, ...rest } = copy;\n\n      onOptionsChange(rest as DataSourceSettings<InfluxOptions, {}>);\n    } else {\n      onOptionsChange(copy);\n    }\n  };\n\n  renderJsonDataOptions() {\n    switch (this.props.options.jsonData.version) {\n      case InfluxVersion.InfluxQL:\n        return <InfluxInfluxQLConfig {...this.props} />;\n      case InfluxVersion.Flux:\n        return <InfluxFluxConfig {...this.props} />;\n      case InfluxVersion.SQL:\n        return <InfluxSqlConfig {...this.props} />;\n      default:\n        return <InfluxInfluxQLConfig {...this.props} />;\n    }\n  }\n\n  render() {\n    const { options, onOptionsChange } = this.props;\n    const isDirectAccess = options.access === 'direct';\n\n    return (\n      <>\n        <FieldSet>\n          <h3 className=\"page-heading\">Query language</h3>\n          <Field>\n            <Select\n              aria-label=\"Query language\"\n              className=\"width-30\"\n              value={versionMap[options.jsonData.version ?? InfluxVersion.InfluxQL]}\n              options={versions}\n              defaultValue={versionMap[InfluxVersion.InfluxQL]}\n              onChange={this.onVersionChanged}\n            />\n          </Field>\n        </FieldSet>\n\n        {options.jsonData.version !== InfluxVersion.InfluxQL && (\n          <Alert severity=\"info\" title={this.versionNotice[options.jsonData.version!]}>\n            <p>\n              Please report any issues to: <br />\n              <TextLink href=\"https://github.com/grafana/grafana/issues/new/choose\" external>\n                https://github.com/grafana/grafana/issues\n              </TextLink>\n            </p>\n          </Alert>\n        )}\n\n        {isDirectAccess && (\n          <Alert title=\"Error\" severity=\"error\">\n            {BROWSER_MODE_DISABLED_MESSAGE}\n          </Alert>\n        )}\n\n        <DataSourceHttpSettings\n          showAccessOptions={isDirectAccess}\n          dataSourceConfig={options}\n          defaultUrl=\"http://localhost:8086\"\n          onChange={onOptionsChange}\n          secureSocksDSProxyEnabled={config.secureSocksDSProxyEnabled}\n        />\n        <FieldSet>\n          <h3 className=\"page-heading\">InfluxDB Details</h3>\n          {this.renderJsonDataOptions()}\n          <InlineField\n            labelWidth={20}\n            label=\"Max series\"\n            tooltip=\"Limit the number of series/tables that Grafana will process. Lower this number to prevent abuse, and increase it if you have lots of small time series and not all are shown. Defaults to 1000.\"\n          >\n            <Input\n              placeholder=\"1000\"\n              type=\"number\"\n              className=\"width-20\"\n              value={this.state.maxSeries}\n              onChange={(event: { currentTarget: { value: string } }) => {\n                // We duplicate this state so that we allow to write freely inside the input. We don't have\n                // any influence over saving so this seems to be only way to do this.\n                this.setState({ maxSeries: event.currentTarget.value });\n                const val = parseInt(event.currentTarget.value, 10);\n                updateDatasourcePluginJsonDataOption(this.props, 'maxSeries', Number.isFinite(val) ? val : undefined);\n              }}\n            />\n          </InlineField>\n        </FieldSet>\n      </>\n    );\n  }\n}\n\nexport default ConfigEditor;\n","import { css } from '@emotion/css';\n\nimport { GrafanaTheme2 } from '@grafana/data';\nimport { selectors } from '@grafana/e2e-selectors';\nimport { AuthMethod } from '@grafana/plugin-ui';\nimport { ComboboxOption } from '@grafana/ui';\n\nexport const RADIO_BUTTON_OPTIONS = [\n  { label: 'Enabled', value: true },\n  { label: 'Disabled', value: false },\n];\n\nexport const AUTH_RADIO_BUTTON_OPTIONS = [\n  { label: 'No Authentication', value: AuthMethod.NoAuth },\n  { label: 'Basic Authentication', value: AuthMethod.BasicAuth },\n  { label: 'Forward OAuth Identity', value: AuthMethod.OAuthForward },\n];\n\nexport const CONFIG_SECTION_HEADERS = [\n  { label: 'URL and authentication', id: 'url', isOpen: true },\n  { label: 'Database settings', id: 'tls', isOpen: true },\n  { label: 'Save & test', id: `${selectors.pages.DataSource.saveAndTest}`, isOpen: true },\n];\n\nexport const CONFIG_SECTION_HEADERS_WITH_PDC = [\n  { label: 'URL and authentication', id: 'url', isOpen: true },\n  { label: 'Database settings', id: 'tls', isOpen: true },\n  { label: 'Private data source connect', id: 'pdc', isOpen: true },\n  { label: 'Save & test', id: `${selectors.pages.DataSource.saveAndTest}`, isOpen: true },\n];\n\nexport const HTTP_MODES: ComboboxOption[] = [\n  { label: 'POST', value: 'POST' },\n  { label: 'GET', value: 'GET' },\n];\n\nexport const getInlineLabelStyles = (theme: GrafanaTheme2, transparent = false, width?: number | 'auto') => {\n  return {\n    label: css({\n      display: 'flex',\n      alignItems: 'center',\n      justifyContent: 'space-between',\n      flexShrink: 0,\n      padding: theme.spacing(0, 1),\n      fontWeight: theme.typography.fontWeightMedium,\n      fontSize: theme.typography.size.md,\n      backgroundColor: transparent ? 'transparent' : theme.colors.background.secondary,\n      height: theme.spacing(theme.components.height.md),\n      lineHeight: theme.spacing(theme.components.height.md),\n      marginRight: theme.spacing(0.5),\n      borderRadius: theme.shape.radius.default,\n      border: 'none',\n      width: '220px',\n      color: theme.colors.text.primary,\n    }),\n  };\n};\n\nexport const DB_SETTINGS_LABEL_WIDTH = 18;\nexport const CONTAINER_MIN_WIDTH = '450px';\n","import { reportInteraction } from '@grafana/runtime';\n\n// Config Section\nexport const trackInfluxDBConfigV2FeedbackButtonClicked = () => {\n  reportInteraction('influxdb-config-v2-feedback-button-clicked');\n};\n\n// URL and Auth Section\nexport const trackInfluxDBConfigV2URLInputField = () => {\n  reportInteraction('influxdb-config-v2-url-input-field');\n};\n\nexport const trackInfluxDBConfigV2QueryLanguageSelected = (props: { version: string }) => {\n  reportInteraction('influxdb-config-v2-query-language-dropdown', props);\n};\n\nexport const trackInfluxDBConfigV2ProductSelected = (props: { product: string }) => {\n  reportInteraction('influxdb-config-v2-product-selection-dropdown', props);\n};\n\n// Flux Database Details Fields\nexport const trackInfluxDBConfigV2FluxDBDetailsOrgInputField = () => {\n  reportInteraction('influxdb-config-v2-flux-dbdetails-org-input-field');\n};\n\nexport const trackInfluxDBConfigV2FluxDBDetailsDefaultBucketInputField = () => {\n  reportInteraction('influxdb-config-v2-flux-dbdetails-default-bucket-input-field');\n};\n\nexport const trackInfluxDBConfigV2FluxDBDetailsTokenInputField = () => {\n  reportInteraction('influxdb-config-v2-flux-dbdetails-token-input-field');\n};\n\n// InfluxQL Database Details Fields\nexport const trackInfluxDBConfigV2InfluxQLDBDetailsDatabaseInputField = () => {\n  reportInteraction('influxdb-config-v2-influxql-dbdetails-database-input-field');\n};\n\nexport const trackInfluxDBConfigV2InfluxQLDBDetailsUserInputField = () => {\n  reportInteraction('influxdb-config-v2-influxql-dbdetails-user-input-field');\n};\n\nexport const trackInfluxDBConfigV2InfluxQLDBDetailsPasswordInputField = () => {\n  reportInteraction('influxdb-config-v2-influxql-dbdetails-password-input-field');\n};\n\n// SQL Database Details Fields\nexport const trackInfluxDBConfigV2SQLDBDetailsDatabaseInputField = () => {\n  reportInteraction('influxdb-config-v2-sql-dbdetails-database-input-field');\n};\n\nexport const trackInfluxDBConfigV2SQLDBDetailsTokenInputField = () => {\n  reportInteraction('influxdb-config-v2-sql-dbdetails-token-input-field');\n};\n\n// Advanced DB Connection Settings\nexport const trackInfluxDBConfigV2AdvancedDbConnectionSettingsToggleClicked = () => {\n  reportInteraction('influxdb-config-v2-advanceddb-settings-toggle-clicked');\n};\n\nexport const trackInfluxDBConfigV2AdvancedDbConnectionSettingsHTTPMethodClicked = () => {\n  reportInteraction('influxdb-config-v2-advanceddb-settings-http-method-clicked');\n};\n\nexport const trackInfluxDBConfigV2AdvancedDbConnectionSettingsInsecureConnectClicked = () => {\n  reportInteraction('influxdb-config-v2-advanceddb-settings-insecure-connection-clicked');\n};\n\nexport const trackInfluxDBConfigV2AdvancedDbConnectionSettingsMinTimeClicked = () => {\n  reportInteraction('influxdb-config-v2-advanceddb-settings-min-time-clicked');\n};\n\nexport const trackInfluxDBConfigV2AdvancedDbConnectionSettingsAutocompleteClicked = () => {\n  reportInteraction('influxdb-config-v2-advanceddb-settings-autocomplete-range-clicked');\n};\n\nexport const trackInfluxDBConfigV2AdvancedDbConnectionSettingsMaxSeriesClicked = () => {\n  reportInteraction('influxdb-config-v2-advanceddb-settings-max-series-clicked');\n};\n\n// Advanced HTTP Settings\nexport const trackInfluxDBConfigV2AdvancedHTTPSettingsToggleClicked = () => {\n  reportInteraction('influxdb-config-v2-advanced-http-settings-toggle-clicked');\n};\n\nexport const trackInfluxDBConfigV2AdvancedHTTPSettingsTimeoutField = () => {\n  reportInteraction('influxdb-config-v2-advanced-http-settings-timeout-field');\n};\n\n// Auth Settings\nexport const trackInfluxDBConfigV2AuthSettingsToggleClicked = () => {\n  reportInteraction('influxdb-config-v2-auth-settings-toggle-clicked');\n};\n\nexport const trackInfluxDBConfigV2AuthSettingsAuthMethodSelected = (props: { authMethod: string }) => {\n  reportInteraction('influxdb-config-v2-advanced-http-settings-timeout-field', props);\n};\n","import { cx } from '@emotion/css';\nimport { useState } from 'react';\n\nimport {\n  onUpdateDatasourceJsonDataOption,\n  onUpdateDatasourceJsonDataOptionChecked,\n  onUpdateDatasourceJsonDataOptionSelect,\n  updateDatasourcePluginJsonDataOption,\n} from '@grafana/data';\nimport { InlineFieldRow, InlineField, Combobox, InlineSwitch, Input, Space, useStyles2 } from '@grafana/ui';\n\nimport { InfluxVersion } from '../../../types';\n\nimport { DB_SETTINGS_LABEL_WIDTH, getInlineLabelStyles, HTTP_MODES } from './constants';\nimport {\n  trackInfluxDBConfigV2AdvancedDbConnectionSettingsAutocompleteClicked,\n  trackInfluxDBConfigV2AdvancedDbConnectionSettingsHTTPMethodClicked,\n  trackInfluxDBConfigV2AdvancedDbConnectionSettingsInsecureConnectClicked,\n  trackInfluxDBConfigV2AdvancedDbConnectionSettingsMaxSeriesClicked,\n  trackInfluxDBConfigV2AdvancedDbConnectionSettingsMinTimeClicked,\n  trackInfluxDBConfigV2AdvancedDbConnectionSettingsToggleClicked,\n} from './tracking';\nimport { Props } from './types';\n\nexport const AdvancedDbConnectionSettings = (props: Props) => {\n  const { options } = props;\n  const styles = useStyles2(getInlineLabelStyles);\n  const [maxSeriesValue, setMaxSeriesValue] = useState(options.jsonData.maxSeries?.toString() || '');\n\n  const [advancedDbConnectionSettingsIsOpen, setAdvancedDbConnectionSettingsIsOpen] = useState(\n    () => !!options.jsonData.timeInterval || !!options.jsonData.insecureGrpc || !!options.jsonData.maxSeries\n  );\n\n  const onMaxSeriesChange = (e: { currentTarget: { value: string } }) => {\n    setMaxSeriesValue(e.currentTarget.value);\n    const val = parseInt(e.currentTarget.value, 10);\n    updateDatasourcePluginJsonDataOption(props, 'maxSeries', Number.isFinite(val) ? val : undefined);\n  };\n\n  return (\n    <>\n      <Space v={2} />\n      <InlineField label={<div className={cx(styles.label)}>Advanced Database Settings</div>} labelWidth={40}>\n        <InlineSwitch\n          data-testid=\"influxdb-v2-config-toggle-switch\"\n          value={advancedDbConnectionSettingsIsOpen}\n          onChange={() => setAdvancedDbConnectionSettingsIsOpen(!advancedDbConnectionSettingsIsOpen)}\n          onBlur={trackInfluxDBConfigV2AdvancedDbConnectionSettingsToggleClicked}\n        />\n      </InlineField>\n\n      {advancedDbConnectionSettingsIsOpen && (\n        <>\n          {options.jsonData.version === InfluxVersion.InfluxQL && (\n            <InlineFieldRow>\n              <InlineField\n                label=\"HTTP Method\"\n                labelWidth={DB_SETTINGS_LABEL_WIDTH}\n                tooltip=\"You can use either GET or POST HTTP method to query your InfluxDB database. The POST\n                        method allows you to perform heavy requests (with a lots of WHERE clause) while the GET method\n                        will restrict you and return an error if the query is too large.\"\n                grow\n              >\n                <Combobox\n                  value={HTTP_MODES.find((httpMode) => httpMode.value === options.jsonData.httpMode)}\n                  options={HTTP_MODES}\n                  onChange={onUpdateDatasourceJsonDataOptionSelect(props, 'httpMode')}\n                  onBlur={trackInfluxDBConfigV2AdvancedDbConnectionSettingsHTTPMethodClicked}\n                  data-testid=\"influxdb-v2-config-http-method-select\"\n                />\n              </InlineField>\n            </InlineFieldRow>\n          )}\n\n          {(options.jsonData.version === InfluxVersion.InfluxQL || options.jsonData.version === InfluxVersion.Flux) && (\n            <InlineFieldRow>\n              <InlineField\n                label=\"Min time interval\"\n                labelWidth={DB_SETTINGS_LABEL_WIDTH}\n                tooltip=\"A lower limit for the auto group by time interval. Recommended to be set to write frequency, for example 1m if your data is written every minute.\"\n                grow\n              >\n                <Input\n                  data-testid=\"influxdb-v2-config-time-interval\"\n                  onBlur={trackInfluxDBConfigV2AdvancedDbConnectionSettingsMinTimeClicked}\n                  onChange={onUpdateDatasourceJsonDataOption(props, 'timeInterval')}\n                  placeholder=\"10s\"\n                  value={options.jsonData.timeInterval || ''}\n                />\n              </InlineField>\n            </InlineFieldRow>\n          )}\n\n          {options.jsonData.version === InfluxVersion.InfluxQL && (\n            <InlineFieldRow>\n              <InlineField\n                label=\"Autocomplete Range\"\n                labelWidth={DB_SETTINGS_LABEL_WIDTH}\n                tooltip=\"This time range is used in the query editor's autocomplete to reduce the execution time of tag filter queries.\"\n                grow\n              >\n                <Input\n                  data-testid=\"influxdb-v2-config-autocomplete-range\"\n                  onBlur={trackInfluxDBConfigV2AdvancedDbConnectionSettingsAutocompleteClicked}\n                  onChange={onUpdateDatasourceJsonDataOption(props, 'showTagTime')}\n                  placeholder=\"12h\"\n                  value={options.jsonData.showTagTime || ''}\n                />\n              </InlineField>\n            </InlineFieldRow>\n          )}\n\n          <InlineFieldRow>\n            <InlineField\n              label=\"Max series\"\n              labelWidth={DB_SETTINGS_LABEL_WIDTH}\n              tooltip=\"Limit the number of series/tables that Grafana will process. Lower this number to prevent abuse, and increase it if you have lots of small time series and not all are shown. Defaults to 1000.\"\n              grow\n            >\n              <Input\n                data-testid=\"influxdb-v2-config-max-series\"\n                onBlur={trackInfluxDBConfigV2AdvancedDbConnectionSettingsMaxSeriesClicked}\n                onChange={onMaxSeriesChange}\n                placeholder=\"1000\"\n                value={maxSeriesValue}\n                type=\"number\"\n              />\n            </InlineField>\n          </InlineFieldRow>\n          {options.jsonData.version === InfluxVersion.SQL && (\n            <InlineFieldRow>\n              <InlineField label=\"Insecure Connection\" labelWidth={DB_SETTINGS_LABEL_WIDTH} grow>\n                <InlineSwitch\n                  data-testid=\"influxdb-v2-config-insecure-switch\"\n                  value={options.jsonData.insecureGrpc ?? false}\n                  onChange={onUpdateDatasourceJsonDataOptionChecked(props, 'insecureGrpc')}\n                  onBlur={trackInfluxDBConfigV2AdvancedDbConnectionSettingsInsecureConnectClicked}\n                />\n              </InlineField>\n            </InlineFieldRow>\n          )}\n        </>\n      )}\n    </>\n  );\n};\n","import {\n  onUpdateDatasourceJsonDataOption,\n  onUpdateDatasourceSecureJsonDataOption,\n  updateDatasourcePluginResetOption,\n} from '@grafana/data';\nimport { InlineFieldRow, InlineField, Input, SecretInput } from '@grafana/ui';\n\nimport { DB_SETTINGS_LABEL_WIDTH } from './constants';\nimport {\n  trackInfluxDBConfigV2FluxDBDetailsDefaultBucketInputField,\n  trackInfluxDBConfigV2FluxDBDetailsOrgInputField,\n  trackInfluxDBConfigV2FluxDBDetailsTokenInputField,\n} from './tracking';\nimport { Props } from './types';\n\nexport const InfluxFluxDBConnection = (props: Props) => {\n  const {\n    options: { jsonData, secureJsonData, secureJsonFields },\n  } = props;\n\n  return (\n    <>\n      <InlineFieldRow>\n        <InlineField label=\"Organization\" labelWidth={DB_SETTINGS_LABEL_WIDTH} grow required>\n          <Input\n            id=\"organization\"\n            placeholder=\"myorg\"\n            onBlur={trackInfluxDBConfigV2FluxDBDetailsOrgInputField}\n            onChange={onUpdateDatasourceJsonDataOption(props, 'organization')}\n            value={jsonData.organization || ''}\n          />\n        </InlineField>\n      </InlineFieldRow>\n      <InlineFieldRow>\n        <InlineField labelWidth={DB_SETTINGS_LABEL_WIDTH} label=\"Default Bucket\" grow required>\n          <Input\n            id=\"default-bucket\"\n            onBlur={trackInfluxDBConfigV2FluxDBDetailsDefaultBucketInputField}\n            onChange={onUpdateDatasourceJsonDataOption(props, 'defaultBucket')}\n            placeholder=\"mybucket\"\n            value={jsonData.defaultBucket || ''}\n          />\n        </InlineField>\n      </InlineFieldRow>\n      <InlineFieldRow>\n        <InlineField labelWidth={DB_SETTINGS_LABEL_WIDTH} label=\"Token\" grow required>\n          <SecretInput\n            id=\"token\"\n            isConfigured={Boolean(secureJsonFields && secureJsonFields.token)}\n            onBlur={trackInfluxDBConfigV2FluxDBDetailsTokenInputField}\n            onChange={onUpdateDatasourceSecureJsonDataOption(props, 'token')}\n            onReset={() => updateDatasourcePluginResetOption(props, 'token')}\n            value={secureJsonData?.token || ''}\n          />\n        </InlineField>\n      </InlineFieldRow>\n    </>\n  );\n};\n","import {\n  onUpdateDatasourceJsonDataOption,\n  onUpdateDatasourceOption,\n  onUpdateDatasourceSecureJsonDataOption,\n  updateDatasourcePluginResetOption,\n} from '@grafana/data';\nimport { InlineFieldRow, InlineField, Input, SecretInput } from '@grafana/ui';\n\nimport { DB_SETTINGS_LABEL_WIDTH } from './constants';\nimport {\n  trackInfluxDBConfigV2InfluxQLDBDetailsDatabaseInputField,\n  trackInfluxDBConfigV2InfluxQLDBDetailsPasswordInputField,\n  trackInfluxDBConfigV2InfluxQLDBDetailsUserInputField,\n} from './tracking';\nimport { Props } from './types';\n\nexport const InfluxInfluxQLDBConnection = (props: Props) => {\n  const { options } = props;\n\n  return (\n    <>\n      <InlineFieldRow>\n        <InlineField label=\"Database\" labelWidth={DB_SETTINGS_LABEL_WIDTH} grow required>\n          <Input\n            id=\"database\"\n            placeholder=\"mydb\"\n            value={options.jsonData.dbName}\n            onChange={onUpdateDatasourceJsonDataOption(props, 'dbName')}\n            onBlur={trackInfluxDBConfigV2InfluxQLDBDetailsDatabaseInputField}\n          />\n        </InlineField>\n      </InlineFieldRow>\n      <InlineFieldRow>\n        <InlineField label=\"User\" labelWidth={DB_SETTINGS_LABEL_WIDTH} grow required>\n          <Input\n            id=\"user\"\n            placeholder=\"myuser\"\n            value={options.user || ''}\n            onChange={onUpdateDatasourceOption(props, 'user')}\n            onBlur={trackInfluxDBConfigV2InfluxQLDBDetailsUserInputField}\n          />\n        </InlineField>\n      </InlineFieldRow>\n      <InlineFieldRow>\n        <InlineField\n          label=\"Password\"\n          labelWidth={DB_SETTINGS_LABEL_WIDTH}\n          tooltip=\"Enter the token used to query the database. You can find this on the Tokens page in the InfluxDB UI.\"\n          grow\n          required\n        >\n          <SecretInput\n            id=\"password\"\n            isConfigured={Boolean(options.secureJsonFields && options.secureJsonFields.password)}\n            value={options.secureJsonData?.password || ''}\n            onReset={() => updateDatasourcePluginResetOption(props, 'password')}\n            onChange={onUpdateDatasourceSecureJsonDataOption(props, 'password')}\n            onBlur={trackInfluxDBConfigV2InfluxQLDBDetailsPasswordInputField}\n          />\n        </InlineField>\n      </InlineFieldRow>\n    </>\n  );\n};\n","import {\n  onUpdateDatasourceJsonDataOption,\n  onUpdateDatasourceSecureJsonDataOption,\n  updateDatasourcePluginResetOption,\n} from '@grafana/data';\nimport { InlineFieldRow, InlineField, Input, SecretInput } from '@grafana/ui';\n\nimport { DB_SETTINGS_LABEL_WIDTH } from './constants';\nimport {\n  trackInfluxDBConfigV2SQLDBDetailsDatabaseInputField,\n  trackInfluxDBConfigV2SQLDBDetailsTokenInputField,\n} from './tracking';\nimport { Props } from './types';\n\nexport const InfluxSQLDBConnection = (props: Props) => {\n  const { options } = props;\n  const { secureJsonData, secureJsonFields } = options;\n\n  return (\n    <>\n      <InlineFieldRow>\n        <InlineField label=\"Database\" labelWidth={DB_SETTINGS_LABEL_WIDTH} grow required>\n          <Input\n            id=\"database\"\n            placeholder=\"mydb\"\n            value={options.jsonData.dbName}\n            onChange={onUpdateDatasourceJsonDataOption(props, 'dbName')}\n            onBlur={trackInfluxDBConfigV2SQLDBDetailsDatabaseInputField}\n          />\n        </InlineField>\n      </InlineFieldRow>\n      <InlineFieldRow>\n        <InlineField labelWidth={DB_SETTINGS_LABEL_WIDTH} label=\"Token\" grow required>\n          <SecretInput\n            id=\"token\"\n            isConfigured={Boolean(secureJsonFields && secureJsonFields.token)}\n            onBlur={trackInfluxDBConfigV2SQLDBDetailsTokenInputField}\n            onChange={onUpdateDatasourceSecureJsonDataOption(props, 'token')}\n            onReset={() => updateDatasourcePluginResetOption(props, 'token')}\n            value={secureJsonData?.token || ''}\n          />\n        </InlineField>\n      </InlineFieldRow>\n    </>\n  );\n};\n","import { Box, CollapsableSection, Alert, Space, Text } from '@grafana/ui';\n\nimport { InfluxVersion } from '../../../types';\n\nimport { AdvancedDbConnectionSettings } from './AdvancedDBConnectionSettings';\nimport { InfluxFluxDBConnection } from './InfluxFluxDBConnection';\nimport { InfluxInfluxQLDBConnection } from './InfluxInfluxQLDBConnection';\nimport { InfluxSQLDBConnection } from './InfluxSQLDBConnection';\nimport { CONFIG_SECTION_HEADERS, CONTAINER_MIN_WIDTH } from './constants';\nimport { Props } from './types';\n\nexport const DatabaseConnectionSection = ({ options, onOptionsChange }: Props) => (\n  <>\n    <Box\n      borderStyle=\"solid\"\n      borderColor=\"weak\"\n      padding={2}\n      marginBottom={4}\n      id={`${CONFIG_SECTION_HEADERS[1].id}`}\n      minWidth={CONTAINER_MIN_WIDTH}\n    >\n      <CollapsableSection\n        label={<Text element=\"h3\">2. {CONFIG_SECTION_HEADERS[1].label}</Text>}\n        isOpen={CONFIG_SECTION_HEADERS[1].isOpen}\n      >\n        {!options.jsonData.version && (\n          <Alert severity=\"info\" title=\"Query language required\">\n            <p>To view connection settings, first choose a query language in the URL and Connection section.</p>\n          </Alert>\n        )}\n        {options.jsonData.version === InfluxVersion.InfluxQL && (\n          <>\n            <Alert severity=\"info\" title=\"Database Access\">\n              <p>\n                Setting the database for this datasource does not deny access to other databases. The InfluxDB query\n                syntax allows switching the database in the query. To support data isolation and security, make sure\n                appropriate permissions are configured in InfluxDB.\n              </p>\n            </Alert>\n          </>\n        )}\n        {options.jsonData.version && (\n          <>\n            <Text color=\"secondary\">\n              Provide the necessary database connection details based on your selected InfluxDB product and query\n              language.\n            </Text>\n            <Space v={2} />\n          </>\n        )}\n        <>\n          {options.jsonData.version === InfluxVersion.InfluxQL && (\n            <InfluxInfluxQLDBConnection options={options} onOptionsChange={onOptionsChange} />\n          )}\n          {options.jsonData.version === InfluxVersion.Flux && (\n            <InfluxFluxDBConnection options={options} onOptionsChange={onOptionsChange} />\n          )}\n          {options.jsonData.version === InfluxVersion.SQL && (\n            <InfluxSQLDBConnection options={options} onOptionsChange={onOptionsChange} />\n          )}\n          {options.jsonData.version && (\n            <AdvancedDbConnectionSettings options={options} onOptionsChange={onOptionsChange} />\n          )}\n        </>\n      </CollapsableSection>\n    </Box>\n  </>\n);\n","import { Box, InlineField, LinkButton, Space, Stack, Text } from '@grafana/ui';\n\nimport { CONFIG_SECTION_HEADERS, CONFIG_SECTION_HEADERS_WITH_PDC } from './constants';\n\ninterface LeftSideBarProps {\n  pdcInjected: boolean;\n}\n\nexport const LeftSideBar = ({ pdcInjected }: LeftSideBarProps) => {\n  const headers = pdcInjected ? CONFIG_SECTION_HEADERS_WITH_PDC : CONFIG_SECTION_HEADERS;\n  return (\n    <Stack>\n      <Box flex={1} marginY={10}>\n        <Box height=\"75px\"></Box>\n        <Text element=\"h4\">InfluxDB</Text>\n        <Box paddingTop={2}>\n          {headers.map((header, index) => (\n            <div key={index} data-testid={`${header.label}-sidebar`}>\n              <InlineField label={`${index + 1}`} style={{ display: 'flex', alignItems: 'center' }} grow>\n                <LinkButton\n                  variant=\"secondary\"\n                  fill=\"text\"\n                  onClick={(e) => {\n                    e.preventDefault();\n                    const target = document.getElementById(header.id);\n                    if (target) {\n                      target.scrollIntoView({ behavior: 'smooth', block: 'start' });\n                    }\n                  }}\n                >\n                  {header.label}\n                </LinkButton>\n              </InlineField>\n              <Space v={1} />\n            </div>\n          ))}\n        </Box>\n      </Box>\n    </Stack>\n  );\n};\n","import { cx } from '@emotion/css';\nimport { useState } from 'react';\n\nimport { DataSourcePluginOptionsEditorProps } from '@grafana/data';\nimport {\n  Box,\n  InlineField,\n  InlineSwitch,\n  Field,\n  TagsInput,\n  Input,\n  CustomHeadersSettings,\n  useStyles2,\n} from '@grafana/ui';\n\nimport { InfluxOptions } from '../../../types';\n\nimport { getInlineLabelStyles } from './constants';\nimport {\n  trackInfluxDBConfigV2AdvancedHTTPSettingsTimeoutField,\n  trackInfluxDBConfigV2AdvancedHTTPSettingsToggleClicked,\n} from './tracking';\n\nexport type Props = DataSourcePluginOptionsEditorProps<InfluxOptions>;\n\nexport const AdvancedHttpSettings = ({ options, onOptionsChange }: Props) => {\n  const styles = useStyles2(getInlineLabelStyles);\n\n  const [advancedHttpSettingsIsOpen, setAdvancedHttpSettingsIsOpen] = useState(() => {\n    const keys = Object.keys(options.jsonData);\n    return (\n      'keepCookies' in options.jsonData ||\n      'timeout' in options.jsonData ||\n      keys.some((key) => key.includes('httpHeaderName'))\n    );\n  });\n\n  return (\n    <>\n      <Box display=\"flex\" alignItems=\"center\">\n        <InlineField label={<div className={cx(styles.label)}>Advanced HTTP Settings</div>} labelWidth={40}>\n          <InlineSwitch\n            data-testid=\"influxdb-v2-config-advanced-http-settings-toggle\"\n            value={advancedHttpSettingsIsOpen}\n            onChange={() => setAdvancedHttpSettingsIsOpen(!advancedHttpSettingsIsOpen)}\n            onBlur={trackInfluxDBConfigV2AdvancedHTTPSettingsToggleClicked}\n          />\n        </InlineField>\n      </Box>\n      {advancedHttpSettingsIsOpen && options.access === 'proxy' && (\n        <>\n          <Box paddingLeft={1} marginY={1}>\n            <Box width=\"50%\" marginBottom={2}>\n              <Field\n                label=\"Allowed cookies\"\n                description=\"Grafana proxy deletes forwarded cookies by default. Specify cookies by name that should\n                be forwarded to the data source.\"\n                disabled={options.readOnly}\n                noMargin\n              >\n                <TagsInput\n                  id=\"advanced-http-cookies\"\n                  placeholder=\"New cookie (hit enter to add)\"\n                  tags={\n                    'keepCookies' in options.jsonData && Array.isArray(options.jsonData.keepCookies)\n                      ? options.jsonData.keepCookies\n                      : []\n                  }\n                  onChange={(e) => {\n                    onOptionsChange({\n                      ...options,\n                      jsonData: {\n                        ...options.jsonData,\n                        ...{ keepCookies: e },\n                      },\n                    });\n                  }}\n                />\n              </Field>\n            </Box>\n\n            <Box width=\"50%\" marginBottom={2}>\n              <Field\n                htmlFor=\"advanced-http-timeout\"\n                label=\"Timeout\"\n                description=\"HTTP request timeout in seconds.\"\n                disabled={options.readOnly}\n                noMargin\n              >\n                <Input\n                  id=\"advanced-http-timeout\"\n                  type=\"number\"\n                  min={0}\n                  placeholder=\"Timeout in seconds\"\n                  aria-label=\"Timeout in seconds\"\n                  value={\n                    'timeout' in options.jsonData && typeof options.jsonData.timeout === 'number'\n                      ? options.jsonData.timeout.toString()\n                      : ''\n                  }\n                  onChange={(e) => {\n                    const parsed = parseInt(e.currentTarget.value, 10);\n                    onOptionsChange({\n                      ...options,\n                      jsonData: {\n                        ...options.jsonData,\n                        ...{ timeout: parsed },\n                      },\n                    });\n                  }}\n                  onBlur={trackInfluxDBConfigV2AdvancedHTTPSettingsTimeoutField}\n                />\n              </Field>\n            </Box>\n\n            {advancedHttpSettingsIsOpen && (\n              <CustomHeadersSettings dataSourceConfig={options} onChange={onOptionsChange} />\n            )}\n          </Box>\n        </>\n      )}\n    </>\n  );\n};\n","import { cx } from '@emotion/css';\nimport { useCallback, useMemo, useState } from 'react';\nimport { useWindowSize } from 'react-use';\n\nimport {\n  onUpdateDatasourceOption,\n  onUpdateDatasourceSecureJsonDataOption,\n  updateDatasourcePluginResetOption,\n} from '@grafana/data';\nimport { AuthMethod, convertLegacyAuthProps } from '@grafana/plugin-ui';\nimport { config } from '@grafana/runtime';\nimport {\n  Box,\n  CertificationKey,\n  Field,\n  InlineField,\n  InlineSwitch,\n  Input,\n  Label,\n  RadioButtonGroup,\n  SecretInput,\n  useStyles2,\n  Text,\n  Stack,\n  InlineLabel,\n} from '@grafana/ui';\n\nimport {\n  AUTH_RADIO_BUTTON_OPTIONS,\n  DB_SETTINGS_LABEL_WIDTH,\n  getInlineLabelStyles,\n  RADIO_BUTTON_OPTIONS,\n} from './constants';\nimport {\n  trackInfluxDBConfigV2AuthSettingsAuthMethodSelected,\n  trackInfluxDBConfigV2AuthSettingsToggleClicked,\n} from './tracking';\nimport { Props } from './types';\n\ntype AuthOptionState = {\n  noAuth: boolean;\n  basicAuth: boolean;\n  tlsClientAuth: boolean;\n  caCert: boolean;\n  skipTLS: boolean;\n  oAuthForward: boolean;\n  withCredentials: boolean;\n};\n\nexport const AuthSettings = (props: Props) => {\n  const { options, onOptionsChange } = props;\n  const styles = useStyles2(getInlineLabelStyles);\n  const { width } = useWindowSize();\n\n  const authProps = useMemo(\n    () =>\n      convertLegacyAuthProps({\n        config: options,\n        onChange: onOptionsChange,\n      }),\n    [options, onOptionsChange]\n  );\n\n  const isAuthMethod = (v: unknown): v is AuthMethod =>\n    v === AuthMethod.NoAuth || v === AuthMethod.BasicAuth || v === AuthMethod.OAuthForward;\n\n  const [authOptions, setAuthOptions] = useState<AuthOptionState>({\n    noAuth: (!options.basicAuth && !options.jsonData.oauthPassThru) ?? false,\n    basicAuth: options.basicAuth ?? false,\n    tlsClientAuth: authProps.TLS?.TLSClientAuth.enabled ?? false,\n    caCert: authProps.TLS?.selfSignedCertificate.enabled ?? false,\n    skipTLS: authProps.TLS?.skipTLSVerification.enabled ?? false,\n    oAuthForward: options.jsonData.oauthPassThru ?? false,\n    withCredentials: options.withCredentials ?? false,\n  });\n\n  const selectedMethod = useMemo<AuthMethod | undefined>(() => {\n    if (isAuthMethod(authProps.selectedMethod) && authProps.selectedMethod !== AuthMethod.CrossSiteCredentials) {\n      return authProps.selectedMethod;\n    }\n\n    switch (!!authOptions) {\n      case authOptions.basicAuth:\n        return AuthMethod.BasicAuth;\n      case authOptions.oAuthForward:\n        return AuthMethod.OAuthForward;\n      case authOptions.noAuth:\n        return AuthMethod.NoAuth;\n      default:\n        return undefined;\n    }\n  }, [authProps.selectedMethod, authOptions]);\n\n  const [authenticationSettingsIsOpen, setAuthenticationSettingsIsOpen] = useState(() =>\n    Object.entries(authOptions).some(([key, value]) => key !== 'noAuth' && Boolean(value))\n  );\n\n  const toggleOpen = useCallback(() => {\n    setAuthenticationSettingsIsOpen((prev) => {\n      trackInfluxDBConfigV2AuthSettingsToggleClicked();\n      return !prev;\n    });\n  }, []);\n\n  const handleAuthMethodChange = useCallback(\n    (option: AuthMethod) => {\n      authProps.onAuthMethodSelect(option);\n      setAuthOptions((prev) => ({\n        ...prev,\n        noAuth: option === AuthMethod.NoAuth,\n        basicAuth: option === AuthMethod.BasicAuth,\n        oAuthForward: option === AuthMethod.OAuthForward,\n        withCredentials: prev.withCredentials,\n      }));\n      trackInfluxDBConfigV2AuthSettingsAuthMethodSelected({ authMethod: option });\n    },\n    [authProps]\n  );\n\n  /**\n   * Wraps the toggle of an auth option, updates the local state and calls the onToggle callback\n   * provided by the legacy `authProps` provided by `@grafana/plugin-ui`.\n   */\n  const toggleOption = useCallback((key: keyof AuthOptionState, onToggle: (value: boolean) => void) => {\n    setAuthOptions((prev) => {\n      const nextValue = !prev[key];\n      const next = { ...prev, [key]: nextValue };\n      onToggle(nextValue);\n      return next;\n    });\n  }, []);\n\n  return (\n    <Stack direction=\"column\">\n      <Box alignItems=\"center\">\n        <InlineField label={<div className={cx(styles.label)}>Auth and TLS/SSL Settings</div>} labelWidth={35}>\n          <InlineSwitch\n            data-testid=\"influxdb-v2-config-auth-settings-toggle\"\n            value={authenticationSettingsIsOpen}\n            onChange={toggleOpen}\n          />\n        </InlineField>\n      </Box>\n\n      {authenticationSettingsIsOpen && (\n        <Box paddingLeft={1}>\n          <Box marginBottom={1}>\n            <Field label={<Text element=\"h5\">Authentication Method</Text>} noMargin>\n              <Box width=\"50%\" marginY={2}>\n                <RadioButtonGroup\n                  options={AUTH_RADIO_BUTTON_OPTIONS}\n                  value={selectedMethod}\n                  onChange={handleAuthMethodChange}\n                  size={width < 1100 ? 'sm' : 'md'}\n                />\n              </Box>\n            </Field>\n          </Box>\n\n          {authOptions.basicAuth && (\n            <Box marginBottom={2}>\n              <>\n                <Box display=\"flex\" direction=\"column\" marginBottom={2}>\n                  <InlineField label=\"User\" labelWidth={DB_SETTINGS_LABEL_WIDTH} grow>\n                    <Input\n                      placeholder=\"User\"\n                      onChange={onUpdateDatasourceOption(props, 'basicAuthUser')}\n                      value={options.basicAuthUser || ''}\n                    />\n                  </InlineField>\n                  <InlineField label=\"Password\" labelWidth={DB_SETTINGS_LABEL_WIDTH} grow>\n                    <SecretInput\n                      placeholder=\"Password\"\n                      isConfigured={options.secureJsonFields.basicAuthPassword || false}\n                      onChange={onUpdateDatasourceSecureJsonDataOption(props, 'basicAuthPassword')}\n                      onReset={() => updateDatasourcePluginResetOption(props, 'basicAuthPassword')}\n                      value={options.secureJsonData?.basicAuthPassword || ''}\n                    />\n                  </InlineField>\n                </Box>\n              </>\n            </Box>\n          )}\n          <Box display=\"flex\" direction=\"row\" alignItems=\"center\" marginBottom={2}>\n            <InlineLabel\n              style={{ width: '150px' }}\n              tooltip={'Whether credentials such as cookies or auth headers should be sent with cross-site requests.'}\n            >\n              With Credentials\n            </InlineLabel>\n            <InlineSwitch\n              data-testid=\"influxdb-v2-config-auth-settings-with-credentials\"\n              value={authOptions.withCredentials}\n              onChange={(e) => {\n                authProps.onAuthMethodSelect(selectedMethod!);\n                onOptionsChange({\n                  ...options,\n                  withCredentials: e.currentTarget.checked,\n                  jsonData: {\n                    ...options.jsonData,\n                    oauthPassThru: selectedMethod === AuthMethod.OAuthForward,\n                  },\n                });\n                setAuthOptions({\n                  ...authOptions,\n                  noAuth: selectedMethod === AuthMethod.NoAuth,\n                  basicAuth: selectedMethod === AuthMethod.BasicAuth,\n                  oAuthForward: selectedMethod === AuthMethod.OAuthForward,\n                  withCredentials: e.currentTarget.checked,\n                });\n              }}\n            />\n          </Box>\n          <Box marginBottom={2}>\n            <Field noMargin>\n              <>\n                <Text element=\"h5\">TLS Settings</Text>\n                <Box\n                  display=\"flex\"\n                  alignItems=\"center\"\n                  data-testid=\"influxdb-v2-config-auth-settings-tls-client-auth-toggle\"\n                  marginTop={2}\n                >\n                  <Label style={{ width: '125px' }}>TLS Client Auth</Label>\n                  <RadioButtonGroup\n                    options={RADIO_BUTTON_OPTIONS}\n                    value={authOptions.tlsClientAuth}\n                    onChange={() => toggleOption('tlsClientAuth', authProps.TLS!.TLSClientAuth.onToggle)}\n                    size=\"sm\"\n                  />\n                </Box>\n\n                {authOptions.tlsClientAuth && (\n                  <Box marginTop={2}>\n                    <InlineField label=\"Server Name\" labelWidth={14} grow>\n                      <Input\n                        placeholder=\"domain.example.com\"\n                        onChange={(e) => authProps.TLS?.TLSClientAuth.onServerNameChange(e.currentTarget.value)}\n                        value={authProps.TLS?.TLSClientAuth.serverName || ''}\n                      />\n                    </InlineField>\n                    <CertificationKey\n                      label=\"Client Cert\"\n                      placeholder=\"Begins with -----BEGIN CERTIFICATE-----\"\n                      onChange={(e) => authProps.TLS?.TLSClientAuth.onClientCertificateChange(e.currentTarget.value)}\n                      hasCert={!!authProps.TLS?.TLSClientAuth.clientCertificateConfigured}\n                      onClick={() => authProps.TLS?.TLSClientAuth.onClientCertificateReset()}\n                      useGrow={config.featureToggles.newInfluxDSConfigPageDesign}\n                    />\n                    <CertificationKey\n                      label=\"Client Key\"\n                      placeholder=\"Begins with -----BEGIN RSA PRIVATE KEY-----\"\n                      onChange={(e) => authProps.TLS?.TLSClientAuth.onClientKeyChange(e.currentTarget.value)}\n                      hasCert={!!authProps.TLS?.TLSClientAuth.clientKeyConfigured}\n                      onClick={() => authProps.TLS?.TLSClientAuth.onClientKeyReset()}\n                      useGrow={config.featureToggles.newInfluxDSConfigPageDesign}\n                    />\n                  </Box>\n                )}\n              </>\n            </Field>\n          </Box>\n\n          <Box marginBottom={2}>\n            <Field noMargin>\n              <>\n                <Box display=\"flex\" alignItems=\"center\" data-testid=\"influxdb-v2-config-auth-settings-ca-cert-toggle\">\n                  <Label style={{ width: '125px' }}>CA Cert</Label>\n                  <RadioButtonGroup\n                    options={RADIO_BUTTON_OPTIONS}\n                    value={authOptions.caCert}\n                    onChange={() => toggleOption('caCert', authProps.TLS!.selfSignedCertificate.onToggle)}\n                    size=\"sm\"\n                  />\n                </Box>\n                {authOptions.caCert && (\n                  <Box marginTop={3}>\n                    <CertificationKey\n                      label=\"CA Cert\"\n                      placeholder=\"Begins with -----BEGIN CERTIFICATE-----\"\n                      onChange={(e) => authProps.TLS?.selfSignedCertificate.onCertificateChange(e.currentTarget.value)}\n                      hasCert={!!authProps.TLS?.selfSignedCertificate.certificateConfigured}\n                      onClick={() => authProps.TLS?.selfSignedCertificate.onCertificateReset()}\n                      useGrow={config.featureToggles.newInfluxDSConfigPageDesign}\n                    />\n                  </Box>\n                )}\n              </>\n            </Field>\n          </Box>\n\n          <Box display=\"flex\" direction=\"row\" alignItems=\"center\">\n            <InlineLabel style={{ width: '150px' }}>Skip TLS Verify</InlineLabel>\n            <InlineSwitch\n              data-testid=\"influxdb-v2-config-auth-settings-skip-tls-verify\"\n              value={authOptions.skipTLS}\n              onChange={() => toggleOption('skipTLS', authProps.TLS!.skipTLSVerification.onToggle)}\n            />\n          </Box>\n        </Box>\n      )}\n    </Stack>\n  );\n};\n","import { InfluxVersion } from '../../../types';\n\ninterface AuthMethod {\n  type: 'Basic' | 'Token';\n  fields: string[];\n}\n\ninterface QueryLanguageConfig {\n  name: InfluxVersion;\n  fields: Array<string | AuthMethod>;\n}\n\ninterface DetectionMethod {\n  urlContains?: string[];\n  pingHeaderResponse?: Record<string, string>;\n}\nexport interface InfluxDBProduct {\n  name: string;\n  queryLanguages?: QueryLanguageConfig[];\n  detectionMethod?: DetectionMethod;\n}\n\n// Complete Data Structure:\nexport const INFLUXDB_VERSION_MAP: InfluxDBProduct[] = [\n  {\n    name: 'InfluxDB Cloud Dedicated',\n    queryLanguages: [\n      { name: InfluxVersion.SQL, fields: ['Host', 'Database', 'Token'] },\n      { name: InfluxVersion.InfluxQL, fields: ['Host', 'Database', 'Token'] },\n    ],\n    detectionMethod: {\n      urlContains: ['influxdb.io'],\n    },\n  },\n  {\n    name: 'InfluxDB Cloud Serverless',\n    queryLanguages: [\n      { name: InfluxVersion.SQL, fields: ['Host', 'Bucket', 'Token'] },\n      { name: InfluxVersion.InfluxQL, fields: ['Host', 'Bucket', 'Token'] },\n      { name: InfluxVersion.Flux, fields: ['Host', 'Organization', 'Token', 'Default bucket'] },\n    ],\n    detectionMethod: {\n      urlContains: ['us-east-1-1.aws.cloud2.influxdata.com', 'eu-central-1-1.aws.cloud2.influxdata.com'],\n    },\n  },\n  {\n    name: 'InfluxDB Clustered',\n    queryLanguages: [\n      { name: InfluxVersion.SQL, fields: ['Host', 'Database', 'Token'] },\n      { name: InfluxVersion.InfluxQL, fields: ['URL', 'Database', 'Token'] },\n    ],\n    detectionMethod: {\n      pingHeaderResponse: {\n        'x-influxdb-version': '\\\\s*influxqlbridged-development',\n      },\n    },\n  },\n  {\n    name: 'InfluxDB Enterprise 1.x',\n    queryLanguages: [\n      { name: InfluxVersion.InfluxQL, fields: ['URL', 'Database', 'User', 'Password'] },\n      { name: InfluxVersion.Flux, fields: ['URL', 'User', 'Password', 'Default database'] },\n    ],\n    detectionMethod: {\n      pingHeaderResponse: {\n        'x-influxdb-build': 'Enterprise (needs confirmation)',\n      },\n    },\n  },\n  {\n    name: 'InfluxDB Enterprise 3.x',\n    queryLanguages: [\n      { name: InfluxVersion.SQL, fields: ['URL', 'Token'] },\n      { name: InfluxVersion.InfluxQL, fields: ['URL', 'Token'] },\n    ],\n    detectionMethod: {\n      pingHeaderResponse: {\n        'x-influxdb-build': 'TBD',\n      },\n    },\n  },\n  {\n    name: 'InfluxDB Cloud (TSM)',\n    queryLanguages: [\n      { name: InfluxVersion.InfluxQL, fields: ['URL', 'Database', 'Token'] },\n      { name: InfluxVersion.Flux, fields: ['URL', 'Organization', 'Token', 'Default bucket'] },\n    ],\n    detectionMethod: {\n      urlContains: [\n        'us-west-2-1.aws.cloud2.influxdata.com',\n        'us-west-2-2.aws.cloud2.influxdata.com',\n        'us-east-1-1.aws.cloud2.influxdata.com',\n        'eu-central-1-1.aws.cloud2.influxdata.com',\n        'us-central1-1.gcp.cloud2.influxdata.com',\n        'westeurope-1.azure.cloud2.influxdata.com',\n        'eastus-1.azure.cloud2.influxdata.com',\n      ],\n    },\n  },\n  {\n    name: 'InfluxDB Cloud 1',\n    queryLanguages: [{ name: InfluxVersion.InfluxQL, fields: ['URL', 'Database', 'Username', 'Password'] }],\n    detectionMethod: {\n      urlContains: ['influxcloud.net'],\n    },\n  },\n  {\n    name: 'InfluxDB OSS 1.x',\n    queryLanguages: [\n      { name: InfluxVersion.InfluxQL, fields: ['URL', 'Database', 'Username', 'Password'] },\n      { name: InfluxVersion.Flux, fields: ['URL', 'Username', 'Password', 'Default database'] },\n    ],\n    detectionMethod: {\n      pingHeaderResponse: {\n        'x-influxdb-build': 'OSS',\n        'x-influxdb-version': '^1\\\\.',\n      },\n    },\n  },\n  {\n    name: 'InfluxDB OSS 2.x',\n    queryLanguages: [\n      {\n        name: InfluxVersion.InfluxQL,\n        fields: [\n          'URL',\n          'Database',\n          { type: 'Basic', fields: ['Username', 'Password'] },\n          { type: 'Token', fields: ['Token'] },\n        ],\n      },\n      { name: InfluxVersion.Flux, fields: ['URL', 'Token', 'Default bucket'] },\n    ],\n    detectionMethod: {\n      pingHeaderResponse: {\n        'x-influxdb-build': 'OSS',\n        'x-influxdb-version': '^2\\\\.',\n      },\n    },\n  },\n];\n","import { onUpdateDatasourceJsonDataOptionSelect, onUpdateDatasourceOption } from '@grafana/data';\nimport {\n  Box,\n  CollapsableSection,\n  TextLink,\n  Field,\n  Input,\n  Combobox,\n  Space,\n  Stack,\n  Text,\n  ComboboxOption,\n  Alert,\n} from '@grafana/ui';\n\nimport { InfluxVersion } from '../../../types';\n\nimport { AdvancedHttpSettings } from './AdvancedHttpSettings';\nimport { AuthSettings } from './AuthSettings';\nimport { CONFIG_SECTION_HEADERS, CONTAINER_MIN_WIDTH } from './constants';\nimport {\n  trackInfluxDBConfigV2ProductSelected,\n  trackInfluxDBConfigV2QueryLanguageSelected,\n  trackInfluxDBConfigV2URLInputField,\n} from './tracking';\nimport { Props } from './types';\nimport { INFLUXDB_VERSION_MAP, InfluxDBProduct } from './versions';\n\nconst getQueryLanguageOptions = (productName: string): Array<{ value: string }> => {\n  const product = INFLUXDB_VERSION_MAP.find(({ name }) => name === productName);\n  return product?.queryLanguages?.map(({ name }) => ({ value: name })) ?? [];\n};\n\nexport const UrlAndAuthenticationSection = (props: Props) => {\n  const { options, onOptionsChange } = props;\n\n  const isInfluxVersion = (v: string): v is InfluxVersion =>\n    typeof v === 'string' && (v === InfluxVersion.Flux || v === InfluxVersion.InfluxQL || v === InfluxVersion.SQL);\n\n  // Database + Retention Policy (DBRP) mapping is required for InfluxDB OSS 1.x and 2.x when using InfluxQL\n  const requiresDbrpMapping =\n    options.jsonData.product &&\n    options.jsonData.version === InfluxVersion.InfluxQL &&\n    [\n      'InfluxDB OSS 1.x',\n      'InfluxDB OSS 2.x',\n      'InfluxDB Enterprise 1.x',\n      'InfluxDB Cloud (TSM)',\n      'InfluxDB Cloud Serverless',\n    ].includes(options.jsonData.product);\n\n  const onProductChange = ({ value }: ComboboxOption) => {\n    trackInfluxDBConfigV2ProductSelected({ product: value });\n    onOptionsChange({ ...options, jsonData: { ...options.jsonData, product: value, version: undefined } });\n  };\n\n  const onQueryLanguageChange = (option: ComboboxOption) => {\n    const { value } = option;\n    trackInfluxDBConfigV2QueryLanguageSelected({ version: value });\n\n    if (isInfluxVersion(value)) {\n      onUpdateDatasourceJsonDataOptionSelect(props, 'version')(option);\n    }\n  };\n\n  const onUrlChange = (event: React.ChangeEvent<HTMLInputElement>) => {\n    onUpdateDatasourceOption(props, 'url')(event);\n  };\n\n  const pingInfluxForProductDetection = async (urlValue: string) => {\n    const base = urlValue.replace(/\\/$/, '');\n\n    try {\n      const res = await fetch(`${base}/ping`);\n      if (res.ok) {\n        const product = res.headers.get('x-influxdb-build') ?? undefined;\n        const version = res.headers.get('x-influxdb-version') ?? undefined;\n\n        if (product || version) {\n          return { product, version };\n        }\n      }\n    } catch (err) {\n      console.error('Failed to get InfluxDB version:', err);\n    }\n\n    return { product: undefined, version: undefined };\n  };\n\n  const matchUrlContains = async (urlValue: string) => {\n    let product: InfluxDBProduct | undefined;\n    product = INFLUXDB_VERSION_MAP.find((product: InfluxDBProduct) => {\n      if (product.detectionMethod?.urlContains) {\n        return product.detectionMethod.urlContains.some((url) => {\n          return urlValue.includes(url);\n        });\n      }\n      return false;\n    });\n\n    if (!product) {\n      const pingUrl = await pingInfluxForProductDetection(urlValue);\n\n      if (pingUrl) {\n        product = INFLUXDB_VERSION_MAP.find((product: InfluxDBProduct) => {\n          if (product.detectionMethod?.pingHeaderResponse) {\n            const productBuild = product.detectionMethod.pingHeaderResponse['x-influxdb-build'];\n            const productVersion = product.detectionMethod.pingHeaderResponse['x-influxdb-version'];\n            const pingUrlVersion = pingUrl.version ?? '';\n            const pingUrlBuild = pingUrl.product ?? '';\n            const versionMatch = new RegExp(productVersion).test(pingUrlVersion);\n            const buildMatch = pingUrlBuild.includes(productBuild);\n            return versionMatch && buildMatch;\n          }\n          return false;\n        });\n      }\n    }\n\n    onOptionsChange({\n      ...options,\n      jsonData: {\n        ...options.jsonData,\n        product: product ? product.name : undefined,\n        version: undefined,\n      },\n    });\n  };\n\n  const detectProductFromUrl = (event: React.ChangeEvent<HTMLInputElement>) => {\n    matchUrlContains(event.target.value);\n  };\n\n  return (\n    <Box\n      borderStyle=\"solid\"\n      borderColor=\"weak\"\n      padding={2}\n      marginBottom={4}\n      id={`${CONFIG_SECTION_HEADERS[0].id}`}\n      minWidth={CONTAINER_MIN_WIDTH}\n    >\n      <CollapsableSection\n        label={<Text element=\"h3\">1. {CONFIG_SECTION_HEADERS[0].label}</Text>}\n        isOpen={CONFIG_SECTION_HEADERS[0].isOpen}\n      >\n        <Text color=\"secondary\">\n          Enter the URL of your InfluxDB instance, then select your product and query language. This will determine the\n          available settings and authentication methods in the next steps.\n        </Text>\n\n        <Box direction=\"column\" gap={2} marginTop={3}>\n          <Field label={<div style={{ marginBottom: '5px' }}>URL *</div>} noMargin required>\n            <Input\n              data-testid=\"influxdb-v2-config-url-input\"\n              placeholder=\"example: http://localhost:8086/\"\n              onChange={onUrlChange}\n              value={options.url || ''}\n              onBlur={(e) => {\n                detectProductFromUrl(e);\n                trackInfluxDBConfigV2URLInputField();\n              }}\n            />\n          </Field>\n\n          <Box marginTop={2}>\n            <Stack direction=\"row\" gap={2}>\n              <Box flex={1}>\n                <Field label={<div style={{ marginBottom: '5px' }}>Product *</div>} noMargin required>\n                  <Combobox\n                    data-testid=\"influxdb-v2-config-product-select\"\n                    value={options.jsonData.product}\n                    options={INFLUXDB_VERSION_MAP.map(({ name }) => ({ value: name }))}\n                    onChange={onProductChange}\n                  />\n                </Field>\n              </Box>\n              <Box flex={1}>\n                <Field label={<div style={{ marginBottom: '5px' }}>Query language *</div>} noMargin>\n                  <Combobox\n                    data-testid=\"influxdb-v2-config-query-language-select\"\n                    value={options.jsonData.product !== '' ? options.jsonData.version : ''}\n                    options={getQueryLanguageOptions(options.jsonData.product || '')}\n                    onChange={onQueryLanguageChange}\n                  />\n                </Field>\n              </Box>\n            </Stack>\n          </Box>\n\n          <Space v={2} />\n\n          {requiresDbrpMapping && (\n            <Alert severity=\"warning\" title=\"InfluxQL requires DBRP mapping\">\n              {`${options.jsonData.product} requires a Database + Retention Policy (DBRP) mapping via the CLI or\n              API before data can be queried.`}{' '}\n              <TextLink href=\"https://docs.influxdata.com/influxdb/cloud/query-data/influxql/dbrp/\" external>\n                Learn how to set this up\n              </TextLink>\n            </Alert>\n          )}\n\n          <AdvancedHttpSettings options={options} onOptionsChange={onOptionsChange} />\n          <AuthSettings options={options} onOptionsChange={onOptionsChange} />\n        </Box>\n      </CollapsableSection>\n    </Box>\n  );\n};\n","import { css } from '@emotion/css';\nimport React from 'react';\n\nimport { GrafanaTheme2 } from '@grafana/data';\nimport { Alert, Box, Stack, TextLink, Text, useStyles2 } from '@grafana/ui';\n\nimport { DatabaseConnectionSection } from './DatabaseConnectionSection';\nimport { LeftSideBar } from './LeftSideBar';\nimport { UrlAndAuthenticationSection } from './UrlAndAuthenticationSection';\nimport { CONTAINER_MIN_WIDTH } from './constants';\nimport { trackInfluxDBConfigV2FeedbackButtonClicked } from './tracking';\nimport { Props } from './types';\n\nexport const ConfigEditor: React.FC<Props> = ({ onOptionsChange, options }: Props) => {\n  const styles = useStyles2(getStyles);\n  return (\n    <Stack justifyContent=\"space-between\">\n      <div className={styles.hideOnSmallScreen}>\n        <Box width=\"100%\" flex=\"1 1 auto\">\n          <LeftSideBar pdcInjected={options?.jsonData?.pdcInjected!!} />\n        </Box>\n      </div>\n      <Box width=\"60%\" flex=\"1 1 auto\" minWidth={CONTAINER_MIN_WIDTH}>\n        <Stack direction=\"column\">\n          <Alert\n            severity=\"info\"\n            title=\"You are viewing a new design for the InfluxDB configuration settings.\"\n            className={styles.alertHeight}\n          >\n            <>\n              <TextLink\n                href=\"https://docs.google.com/forms/d/e/1FAIpQLSdi-zyX3c51vh937UKhNYYxhljUnFi6dQSlZv50mES9NrK-ig/viewform\"\n                external\n                onClick={trackInfluxDBConfigV2FeedbackButtonClicked}\n              >\n                Share your thoughts\n              </TextLink>{' '}\n              to help us make it even better.\n            </>\n          </Alert>\n          <Text color=\"secondary\" element=\"p\" italic>\n            Fields marked with * are required\n          </Text>\n          <UrlAndAuthenticationSection options={options} onOptionsChange={onOptionsChange} />\n          <DatabaseConnectionSection options={options} onOptionsChange={onOptionsChange} />\n        </Stack>\n      </Box>\n      <Box width=\"20%\" flex=\"0 0 20%\">\n        {/* TODO: Right sidebar */}\n      </Box>\n    </Stack>\n  );\n};\n\nconst getStyles = (theme: GrafanaTheme2) => {\n  return {\n    hideOnSmallScreen: css({\n      width: '250px',\n      flex: '0 0 250px',\n      [theme.breakpoints.down('sm')]: {\n        display: 'none',\n      },\n    }),\n    alertHeight: css({\n      height: '100px',\n    }),\n  };\n};\n","import { clone, map } from 'lodash';\n\nimport { functionRenderer, QueryPart, QueryPartDef, suffixRenderer } from 'app/features/alerting/state/query_part';\n\nconst index: QueryPartDef[] = [];\nconst categories = {\n  Aggregations: [],\n  GroupByTimeFunctions: [],\n  Selectors: [],\n  Transformations: [],\n  Predictors: [],\n  Math: [],\n  Aliasing: [],\n  Fields: [],\n};\n\nfunction createPart(part: any) {\n  const def = index[part.type];\n  if (!def) {\n    throw { message: 'Could not find query part ' + part.type };\n  }\n\n  return new QueryPart(part, def);\n}\n\nfunction register(options: any) {\n  index[options.type] = new QueryPartDef(options);\n  options.category.push(index[options.type]);\n}\n\nfunction aliasRenderer(part: { params: string[] }, innerExpr: string) {\n  return innerExpr + ' AS ' + '\"' + part.params[0] + '\"';\n}\n\nfunction fieldRenderer(part: { params: string[] }) {\n  const param = part.params[0];\n\n  if (param === '*') {\n    return '*';\n  }\n\n  let escapedParam = `\"${param}\"`;\n\n  if (param.endsWith('::tag')) {\n    escapedParam = `\"${param.slice(0, -5)}\"::tag`;\n  }\n\n  if (param.endsWith('::field')) {\n    escapedParam = `\"${param.slice(0, -7)}\"::field`;\n  }\n\n  return escapedParam;\n}\n\nfunction replaceAggregationAddStrategy(selectParts: any[], partModel: { def: { type: string } }) {\n  // look for existing aggregation\n  for (let i = 0; i < selectParts.length; i++) {\n    const part = selectParts[i];\n    if (part.def.category === categories.Aggregations) {\n      if (part.def.type === partModel.def.type) {\n        return;\n      }\n      // count distinct is allowed\n      if (part.def.type === 'count' && partModel.def.type === 'distinct') {\n        break;\n      }\n      // remove next aggregation if distinct was replaced\n      if (part.def.type === 'distinct') {\n        const morePartsAvailable = selectParts.length >= i + 2;\n        if (partModel.def.type !== 'count' && morePartsAvailable) {\n          const nextPart = selectParts[i + 1];\n          if (nextPart.def.category === categories.Aggregations) {\n            selectParts.splice(i + 1, 1);\n          }\n        } else if (partModel.def.type === 'count') {\n          if (!morePartsAvailable || selectParts[i + 1].def.type !== 'count') {\n            selectParts.splice(i + 1, 0, partModel);\n          }\n          return;\n        }\n      }\n      selectParts[i] = partModel;\n      return;\n    }\n    if (part.def.category === categories.Selectors) {\n      selectParts[i] = partModel;\n      return;\n    }\n  }\n\n  selectParts.splice(1, 0, partModel);\n}\n\nfunction addTransformationStrategy(selectParts: any[], partModel: any) {\n  let i;\n  // look for index to add transformation\n  for (i = 0; i < selectParts.length; i++) {\n    const part = selectParts[i];\n    if (part.def.category === categories.Math || part.def.category === categories.Aliasing) {\n      break;\n    }\n  }\n\n  selectParts.splice(i, 0, partModel);\n}\n\nfunction addMathStrategy(selectParts: any[], partModel: any) {\n  const partCount = selectParts.length;\n  if (partCount > 0) {\n    // if last is math, replace it\n    if (selectParts[partCount - 1].def.type === 'math') {\n      selectParts[partCount - 1] = partModel;\n      return;\n    }\n    // if next to last is math, replace it\n    if (partCount > 1 && selectParts[partCount - 2].def.type === 'math') {\n      selectParts[partCount - 2] = partModel;\n      return;\n    } else if (selectParts[partCount - 1].def.type === 'alias') {\n      // if last is alias add it before\n      selectParts.splice(partCount - 1, 0, partModel);\n      return;\n    }\n  }\n  selectParts.push(partModel);\n}\n\nfunction addAliasStrategy(selectParts: any[], partModel: any) {\n  const partCount = selectParts.length;\n  if (partCount > 0) {\n    // if last is alias, replace it\n    if (selectParts[partCount - 1].def.type === 'alias') {\n      selectParts[partCount - 1] = partModel;\n      return;\n    }\n  }\n  selectParts.push(partModel);\n}\n\nfunction addFieldStrategy(selectParts: any, partModel: any, query: { selectModels: any[][] }) {\n  // copy all parts\n  const parts = map(selectParts, (part) => {\n    return createPart({ type: part.def.type, params: clone(part.params) });\n  });\n\n  query.selectModels.push(parts);\n}\n\nregister({\n  type: 'field',\n  addStrategy: addFieldStrategy,\n  category: categories.Fields,\n  params: [{ type: 'field', dynamicLookup: true }],\n  defaultParams: ['value'],\n  renderer: fieldRenderer,\n});\n\n// Aggregations\nregister({\n  type: 'count',\n  addStrategy: replaceAggregationAddStrategy,\n  category: categories.Aggregations,\n  params: [],\n  defaultParams: [],\n  renderer: functionRenderer,\n});\n\nregister({\n  type: 'distinct',\n  addStrategy: replaceAggregationAddStrategy,\n  category: categories.Aggregations,\n  params: [],\n  defaultParams: [],\n  renderer: functionRenderer,\n});\n\nregister({\n  type: 'integral',\n  addStrategy: replaceAggregationAddStrategy,\n  category: categories.Aggregations,\n  params: [],\n  defaultParams: [],\n  renderer: functionRenderer,\n});\n\nregister({\n  type: 'mean',\n  addStrategy: replaceAggregationAddStrategy,\n  category: categories.Aggregations,\n  params: [],\n  defaultParams: [],\n  renderer: functionRenderer,\n});\n\nregister({\n  type: 'median',\n  addStrategy: replaceAggregationAddStrategy,\n  category: categories.Aggregations,\n  params: [],\n  defaultParams: [],\n  renderer: functionRenderer,\n});\n\nregister({\n  type: 'mode',\n  addStrategy: replaceAggregationAddStrategy,\n  category: categories.Aggregations,\n  params: [],\n  defaultParams: [],\n  renderer: functionRenderer,\n});\n\nregister({\n  type: 'sum',\n  addStrategy: replaceAggregationAddStrategy,\n  category: categories.Aggregations,\n  params: [],\n  defaultParams: [],\n  renderer: functionRenderer,\n});\n\n// transformations\n\nregister({\n  type: 'derivative',\n  addStrategy: addTransformationStrategy,\n  category: categories.Transformations,\n  params: [\n    {\n      name: 'duration',\n      type: 'interval',\n      options: ['1s', '10s', '1m', '5m', '10m', '15m', '1h'],\n    },\n  ],\n  defaultParams: ['10s'],\n  renderer: functionRenderer,\n});\n\nregister({\n  type: 'spread',\n  addStrategy: addTransformationStrategy,\n  category: categories.Transformations,\n  params: [],\n  defaultParams: [],\n  renderer: functionRenderer,\n});\n\nregister({\n  type: 'non_negative_derivative',\n  addStrategy: addTransformationStrategy,\n  category: categories.Transformations,\n  params: [\n    {\n      name: 'duration',\n      type: 'interval',\n      options: ['1s', '10s', '1m', '5m', '10m', '15m', '1h'],\n    },\n  ],\n  defaultParams: ['10s'],\n  renderer: functionRenderer,\n});\n\nregister({\n  type: 'difference',\n  addStrategy: addTransformationStrategy,\n  category: categories.Transformations,\n  params: [],\n  defaultParams: [],\n  renderer: functionRenderer,\n});\n\nregister({\n  type: 'non_negative_difference',\n  addStrategy: addTransformationStrategy,\n  category: categories.Transformations,\n  params: [],\n  defaultParams: [],\n  renderer: functionRenderer,\n});\n\nregister({\n  type: 'moving_average',\n  addStrategy: addTransformationStrategy,\n  category: categories.Transformations,\n  params: [{ name: 'window', type: 'int', options: [5, 10, 20, 30, 40] }],\n  defaultParams: [10],\n  renderer: functionRenderer,\n});\n\nregister({\n  type: 'cumulative_sum',\n  addStrategy: addTransformationStrategy,\n  category: categories.Transformations,\n  params: [],\n  defaultParams: [],\n  renderer: functionRenderer,\n});\n\nregister({\n  type: 'stddev',\n  addStrategy: addTransformationStrategy,\n  category: categories.Transformations,\n  params: [],\n  defaultParams: [],\n  renderer: functionRenderer,\n});\n\nregister({\n  type: 'time',\n  category: categories.GroupByTimeFunctions,\n  params: [\n    {\n      name: 'interval',\n      type: 'time',\n      options: ['$__interval', '1s', '10s', '1m', '5m', '10m', '15m', '1h'],\n    },\n  ],\n  defaultParams: ['$__interval'],\n  renderer: functionRenderer,\n});\n\nregister({\n  type: 'fill',\n  category: categories.GroupByTimeFunctions,\n  params: [\n    {\n      name: 'fill',\n      type: 'string',\n      options: ['none', 'null', '0', 'previous', 'linear'],\n    },\n  ],\n  defaultParams: ['null'],\n  renderer: functionRenderer,\n});\n\nregister({\n  type: 'elapsed',\n  addStrategy: addTransformationStrategy,\n  category: categories.Transformations,\n  params: [\n    {\n      name: 'duration',\n      type: 'interval',\n      options: ['1s', '10s', '1m', '5m', '10m', '15m', '1h'],\n    },\n  ],\n  defaultParams: ['10s'],\n  renderer: functionRenderer,\n});\n\n// predictions\nregister({\n  type: 'holt_winters',\n  addStrategy: addTransformationStrategy,\n  category: categories.Predictors,\n  params: [\n    { name: 'number', type: 'int', options: [5, 10, 20, 30, 40] },\n    { name: 'season', type: 'int', options: [0, 1, 2, 5, 10] },\n  ],\n  defaultParams: [10, 2],\n  renderer: functionRenderer,\n});\n\nregister({\n  type: 'holt_winters_with_fit',\n  addStrategy: addTransformationStrategy,\n  category: categories.Predictors,\n  params: [\n    { name: 'number', type: 'int', options: [5, 10, 20, 30, 40] },\n    { name: 'season', type: 'int', options: [0, 1, 2, 5, 10] },\n  ],\n  defaultParams: [10, 2],\n  renderer: functionRenderer,\n});\n\n// Selectors\nregister({\n  type: 'bottom',\n  addStrategy: replaceAggregationAddStrategy,\n  category: categories.Selectors,\n  params: [{ name: 'count', type: 'int' }],\n  defaultParams: [3],\n  renderer: functionRenderer,\n});\n\nregister({\n  type: 'first',\n  addStrategy: replaceAggregationAddStrategy,\n  category: categories.Selectors,\n  params: [],\n  defaultParams: [],\n  renderer: functionRenderer,\n});\n\nregister({\n  type: 'last',\n  addStrategy: replaceAggregationAddStrategy,\n  category: categories.Selectors,\n  params: [],\n  defaultParams: [],\n  renderer: functionRenderer,\n});\n\nregister({\n  type: 'max',\n  addStrategy: replaceAggregationAddStrategy,\n  category: categories.Selectors,\n  params: [],\n  defaultParams: [],\n  renderer: functionRenderer,\n});\n\nregister({\n  type: 'min',\n  addStrategy: replaceAggregationAddStrategy,\n  category: categories.Selectors,\n  params: [],\n  defaultParams: [],\n  renderer: functionRenderer,\n});\n\nregister({\n  type: 'percentile',\n  addStrategy: replaceAggregationAddStrategy,\n  category: categories.Selectors,\n  params: [{ name: 'nth', type: 'int' }],\n  defaultParams: [95],\n  renderer: functionRenderer,\n});\n\nregister({\n  type: 'top',\n  addStrategy: replaceAggregationAddStrategy,\n  category: categories.Selectors,\n  params: [{ name: 'count', type: 'int' }],\n  defaultParams: [3],\n  renderer: functionRenderer,\n});\n\nregister({\n  type: 'tag',\n  category: categories.GroupByTimeFunctions,\n  params: [{ name: 'tag', type: 'string', dynamicLookup: true }],\n  defaultParams: ['tag'],\n  renderer: fieldRenderer,\n});\n\nregister({\n  type: 'math',\n  addStrategy: addMathStrategy,\n  category: categories.Math,\n  params: [{ name: 'expr', type: 'string' }],\n  defaultParams: [' / 100'],\n  renderer: suffixRenderer,\n});\n\nregister({\n  type: 'alias',\n  addStrategy: addAliasStrategy,\n  category: categories.Aliasing,\n  params: [{ name: 'name', type: 'string', quote: 'double' }],\n  defaultParams: ['alias'],\n  renderMode: 'suffix',\n  renderer: aliasRenderer,\n});\n\nexport default {\n  create: createPart,\n  getCategories: () => {\n    return categories;\n  },\n  replaceAggregationAdd: replaceAggregationAddStrategy,\n};\n","import { filter, find, indexOf, map } from 'lodash';\n\nimport { AdHocVariableFilter, escapeRegex, ScopedVars } from '@grafana/data';\nimport { TemplateSrv } from '@grafana/runtime';\nimport { QueryPart } from 'app/features/alerting/state/query_part';\n\nimport { removeRegexWrapper } from './queryUtils';\nimport queryPart from './query_part';\nimport { DEFAULT_POLICY, InfluxQuery, InfluxQueryTag } from './types';\n\nexport default class InfluxQueryModel {\n  target: InfluxQuery;\n  selectModels: QueryPart[][] = [];\n  groupByParts: QueryPart[] = [];\n  templateSrv: any;\n  scopedVars: ScopedVars | undefined;\n  refId?: string;\n\n  constructor(target: InfluxQuery, templateSrv?: TemplateSrv, scopedVars?: ScopedVars) {\n    this.target = target;\n    this.templateSrv = templateSrv;\n    this.scopedVars = scopedVars;\n\n    target.policy = target.policy || DEFAULT_POLICY;\n    target.resultFormat = target.resultFormat || 'time_series';\n    target.orderByTime = target.orderByTime || 'ASC';\n    target.tags = target.tags || [];\n    target.groupBy = target.groupBy || [\n      { type: 'time', params: ['$__interval'] },\n      { type: 'fill', params: ['null'] },\n    ];\n    target.select = target.select || [\n      [\n        { type: 'field', params: ['value'] },\n        { type: 'mean', params: [] },\n      ],\n    ];\n\n    this.updateProjection();\n  }\n\n  updateProjection() {\n    this.selectModels = map(this.target.select, (parts) => {\n      return map(parts, queryPart.create);\n    });\n    this.groupByParts = map(this.target.groupBy, queryPart.create);\n  }\n\n  updatePersistedParts() {\n    this.target.select = map(this.selectModels, (selectParts) => {\n      return map(selectParts, (part) => {\n        return { type: part.def.type, params: part.params };\n      });\n    });\n  }\n\n  hasGroupByTime() {\n    return find(this.target.groupBy, (g) => g.type === 'time');\n  }\n\n  hasFill() {\n    return find(this.target.groupBy, (g) => g.type === 'fill');\n  }\n\n  addGroupBy(value: string) {\n    let stringParts = value.match(/^(\\w+)\\((.*)\\)$/);\n\n    if (!stringParts || !this.target.groupBy) {\n      return;\n    }\n\n    const typePart = stringParts[1];\n    const arg = stringParts[2];\n    const partModel = queryPart.create({ type: typePart, params: [arg] });\n    const partCount = this.target.groupBy.length;\n\n    if (partCount === 0) {\n      this.target.groupBy.push(partModel.part);\n    } else if (typePart === 'time') {\n      this.target.groupBy.splice(0, 0, partModel.part);\n    } else if (typePart === 'tag') {\n      if (this.target.groupBy[partCount - 1].type === 'fill') {\n        this.target.groupBy.splice(partCount - 1, 0, partModel.part);\n      } else {\n        this.target.groupBy.push(partModel.part);\n      }\n    } else {\n      this.target.groupBy.push(partModel.part);\n    }\n\n    this.updateProjection();\n  }\n\n  removeGroupByPart(part: { def: { type: string } }, index: number) {\n    const categories = queryPart.getCategories();\n\n    if (part.def.type === 'time') {\n      // remove fill\n      this.target.groupBy = filter(this.target.groupBy, (g) => g.type !== 'fill');\n      // remove aggregations\n      this.target.select = map(this.target.select, (s) => {\n        return filter(s, (part) => {\n          const partModel = queryPart.create(part);\n          if (partModel.def.category === categories.Aggregations) {\n            return false;\n          }\n          if (partModel.def.category === categories.Selectors) {\n            return false;\n          }\n          return true;\n        });\n      });\n    }\n\n    this.target.groupBy!.splice(index, 1);\n    this.updateProjection();\n  }\n\n  removeSelect(index: number) {\n    this.target.select!.splice(index, 1);\n    this.updateProjection();\n  }\n\n  removeSelectPart(selectParts: QueryPart[], part: QueryPart) {\n    // if we remove the field remove the whole statement\n    if (part.def.type === 'field') {\n      if (this.selectModels.length > 1) {\n        const modelsIndex = indexOf(this.selectModels, selectParts);\n        this.selectModels.splice(modelsIndex, 1);\n      }\n    } else {\n      const partIndex = indexOf(selectParts, part);\n      selectParts.splice(partIndex, 1);\n    }\n\n    this.updatePersistedParts();\n  }\n\n  addSelectPart(selectParts: QueryPart[], type: string) {\n    const partModel = queryPart.create({ type: type });\n    partModel.def.addStrategy(selectParts, partModel, this);\n    this.updatePersistedParts();\n  }\n\n  private isOperatorTypeHandler(operator: string, value: string, fieldName: string) {\n    let textValue;\n    if (operator === 'Is Not') {\n      operator = '!=';\n    } else {\n      operator = '=';\n    }\n\n    // Tags should always quote\n    if (fieldName.endsWith('::tag')) {\n      textValue = \"'\" + removeRegexWrapper(value.replace(/\\\\/g, '\\\\\\\\').replace(/\\'/g, \"\\\\'\")) + \"'\";\n      return {\n        operator: operator,\n        value: textValue,\n      };\n    }\n\n    let lowerValue = value.toLowerCase();\n\n    // Try and discern type\n    if (!isNaN(parseFloat(value))) {\n      // Integer or float, don't quote\n      textValue = value;\n    } else if (['true', 'false'].includes(lowerValue)) {\n      // It's a boolean, don't quite\n      textValue = lowerValue;\n    } else {\n      // String or unrecognised: quote\n      textValue = \"'\" + removeRegexWrapper(value.replace(/\\\\/g, '\\\\\\\\').replace(/\\'/g, \"\\\\'\")) + \"'\";\n    }\n    return {\n      operator: operator,\n      value: textValue,\n    };\n  }\n\n  private renderTagCondition(tag: InfluxQueryTag, index: number, interpolate?: boolean) {\n    // FIXME: merge this function with query_builder/renderTagCondition\n    let str = '';\n    let operator = tag.operator;\n    let value = tag.value;\n    if (index > 0) {\n      str = (tag.condition || 'AND') + ' ';\n    }\n\n    if (!operator) {\n      if (/^\\/.*\\/$/.test(value)) {\n        operator = '=~';\n      } else {\n        operator = '=';\n      }\n    }\n\n    // quote value unless regex\n    if (operator !== '=~' && operator !== '!~') {\n      if (interpolate) {\n        value = this.templateSrv.replace(value, this.scopedVars);\n      }\n      value = removeRegexWrapper(value);\n      if (operator.startsWith('Is')) {\n        let r = this.isOperatorTypeHandler(operator, value, tag.key);\n        operator = r.operator;\n        value = r.value;\n      } else if ((!operator.startsWith('>') && !operator.startsWith('<')) || operator === '<>') {\n        value = \"'\" + value.replace(/\\\\/g, '\\\\\\\\').replace(/\\'/g, \"\\\\'\") + \"'\";\n      }\n    } else if (interpolate) {\n      value = this.templateSrv.replace(value, this.scopedVars, 'regex');\n    }\n\n    let escapedKey = `\"${tag.key}\"`;\n\n    if (tag.key.endsWith('::tag')) {\n      escapedKey = `\"${tag.key.slice(0, -5)}\"::tag`;\n    }\n\n    if (tag.key.endsWith('::field')) {\n      escapedKey = `\"${tag.key.slice(0, -7)}\"::field`;\n    }\n\n    return str + escapedKey + ' ' + operator + ' ' + value;\n  }\n\n  getMeasurementAndPolicy(interpolate?: boolean) {\n    let policy = this.target.policy;\n    let measurement = this.target.measurement || 'measurement';\n\n    if (!measurement.match('^/.*/$')) {\n      measurement = '\"' + measurement + '\"';\n    } else if (interpolate) {\n      measurement = this.templateSrv.replace(measurement, this.scopedVars, 'regex');\n    }\n\n    if (policy !== DEFAULT_POLICY) {\n      policy = '\"' + this.target.policy + '\".';\n    } else {\n      policy = '';\n    }\n\n    return policy + measurement;\n  }\n\n  interpolateQueryStr(value: string | string[], variable: { multi: boolean; includeAll: boolean }) {\n    // if no multi or include all do not regexEscape\n    if (!variable.multi && !variable.includeAll) {\n      return value;\n    }\n\n    if (typeof value === 'string') {\n      return escapeRegex(value);\n    }\n\n    const escapedValues = map(value, escapeRegex);\n    return '(' + escapedValues.join('|') + ')';\n  }\n\n  render(interpolate?: boolean) {\n    const target = this.target;\n\n    if (target.rawQuery) {\n      if (interpolate) {\n        return this.templateSrv.replace(target.query, this.scopedVars, this.interpolateQueryStr);\n      } else {\n        return target.query;\n      }\n    }\n\n    let query = 'SELECT ';\n    let i, y;\n    for (i = 0; i < this.selectModels.length; i++) {\n      const parts = this.selectModels[i];\n      let selectText = '';\n      for (y = 0; y < parts.length; y++) {\n        const part = parts[y];\n        selectText = part.render(selectText);\n      }\n\n      if (i > 0) {\n        query += ', ';\n      }\n      query += selectText;\n    }\n\n    query += ' FROM ' + this.getMeasurementAndPolicy(interpolate) + ' WHERE ';\n    const conditions = map(target.tags, (tag, index) => {\n      return this.renderTagCondition(tag, index, interpolate);\n    });\n\n    if (conditions.length > 0) {\n      query += '(' + conditions.join(' ') + ') AND ';\n    }\n\n    query += '$timeFilter';\n\n    let groupBySection = '';\n    for (i = 0; i < this.groupByParts.length; i++) {\n      const part = this.groupByParts[i];\n      if (i > 0) {\n        // for some reason fill has no separator\n        groupBySection += part.def.type === 'fill' ? ' ' : ', ';\n      }\n      groupBySection += part.render('');\n    }\n\n    if (groupBySection.length) {\n      query += ' GROUP BY ' + groupBySection;\n    }\n\n    if (target.fill) {\n      query += ' fill(' + target.fill + ')';\n    }\n\n    if (target.orderByTime === 'DESC') {\n      query += ' ORDER BY time DESC';\n    }\n\n    if (target.limit) {\n      query += ' LIMIT ' + target.limit;\n    }\n\n    if (target.slimit) {\n      query += ' SLIMIT ' + target.slimit;\n    }\n\n    if (target.tz) {\n      query += \" tz('\" + target.tz + \"')\";\n    }\n\n    return query;\n  }\n\n  renderAdhocFilters(filters: AdHocVariableFilter[]) {\n    const conditions = map(filters, (tag, index) => {\n      return this.renderTagCondition(tag, index, true);\n    });\n    return conditions.join(' ');\n  }\n}\n","import { cloneDeep } from 'lodash';\n\nimport InfluxQueryModel from './influx_query_model';\nimport { InfluxQuery } from './types'; // FIXME: these functions are a beginning of a refactoring of influx_query_model.ts\n\n// FIXME: these functions are a beginning of a refactoring of influx_query_model.ts\n// into a simpler approach with full typescript types.\n// later we should be able to migrate the unit-tests\n// that relate to these functions here, and then perhaps even move the implementation\n// to this place\n\nexport function buildRawQuery(query: InfluxQuery): string {\n  const queryCopy = cloneDeep(query); // the query-model mutates the query\n  const model = new InfluxQueryModel(queryCopy);\n  return model.render(false);\n}\n\nexport function normalizeQuery(query: InfluxQuery): InfluxQuery {\n  // we return the original query if there is no need to update it\n  if (\n    query.policy !== undefined &&\n    query.resultFormat !== undefined &&\n    query.orderByTime !== undefined &&\n    query.tags !== undefined &&\n    query.groupBy !== undefined &&\n    query.select !== undefined\n  ) {\n    return query;\n  }\n\n  // FIXME: we should move the whole normalizeQuery logic here,\n  // and then have influxQueryModel call this function,\n  // to concentrate the whole logic here\n\n  const queryCopy = cloneDeep(query); // the query-model mutates the query\n  return new InfluxQueryModel(queryCopy).target;\n}\n\nexport function addNewSelectPart(query: InfluxQuery, type: string, index: number): InfluxQuery {\n  const queryCopy = cloneDeep(query); // the query-model mutates the query\n  const model = new InfluxQueryModel(queryCopy);\n  model.addSelectPart(model.selectModels[index], type);\n  return model.target;\n}\n\nexport function removeSelectPart(query: InfluxQuery, partIndex: number, index: number): InfluxQuery {\n  const queryCopy = cloneDeep(query); // the query-model mutates the query\n  const model = new InfluxQueryModel(queryCopy);\n  const selectModel = model.selectModels[index];\n  model.removeSelectPart(selectModel, selectModel[partIndex]);\n  return model.target;\n}\n\nexport function changeSelectPart(\n  query: InfluxQuery,\n  listIndex: number,\n  partIndex: number,\n  newParams: string[]\n): InfluxQuery {\n  // we need to make shallow copy of `query.select` down to `query.select[listIndex][partIndex]`\n  const newSel = [...(query.select ?? [])];\n  newSel[listIndex] = [...newSel[listIndex]];\n  newSel[listIndex][partIndex] = {\n    ...newSel[listIndex][partIndex],\n    params: newParams,\n  };\n  return { ...query, select: newSel };\n}\n\nexport function addNewGroupByPart(query: InfluxQuery, type: string): InfluxQuery {\n  const queryCopy = cloneDeep(query); // the query-model mutates the query\n  const model = new InfluxQueryModel(queryCopy);\n  model.addGroupBy(type);\n  return model.target;\n}\n\nexport function removeGroupByPart(query: InfluxQuery, partIndex: number): InfluxQuery {\n  const queryCopy = cloneDeep(query); // the query-model mutates the query\n  const model = new InfluxQueryModel(queryCopy);\n  model.removeGroupByPart(model.groupByParts[partIndex], partIndex);\n  return model.target;\n}\n\nexport function changeGroupByPart(query: InfluxQuery, partIndex: number, newParams: string[]): InfluxQuery {\n  // we need to make shallow copy of `query.groupBy` down to `query.groupBy[partIndex]`\n  const newGroupBy = [...(query.groupBy ?? [])];\n  newGroupBy[partIndex] = {\n    ...newGroupBy[partIndex],\n    params: newParams,\n  };\n  return { ...query, groupBy: newGroupBy };\n}\n\nexport function removeRegexWrapper(str: string) {\n  const regex = /\\/\\^(.*?)\\$\\//; // match any string that starts with \"/^\" and ends with \"$/\", capturing the characters in between\n  const match = str.match(regex);\n\n  if (match && match.length > 1) {\n    return match[1];\n  }\n\n  return str;\n}\n","import { css, cx } from '@emotion/css';\nimport { PureComponent } from 'react';\n\nimport { GrafanaTheme2, SelectableValue } from '@grafana/data';\nimport { getTemplateSrv } from '@grafana/runtime';\nimport {\n  CodeEditor,\n  CodeEditorSuggestionItem,\n  CodeEditorSuggestionItemKind,\n  InlineFormLabel,\n  LinkButton,\n  MonacoEditor,\n  Segment,\n  Themeable2,\n  withTheme2,\n} from '@grafana/ui';\n\nimport InfluxDatasource from '../../../../datasource';\nimport { InfluxQuery } from '../../../../types';\n\ninterface Props extends Themeable2 {\n  onChange: (query: InfluxQuery) => void;\n  query: InfluxQuery;\n  // `datasource` is not used internally, but this component is used at some places\n  // directly, where the `datasource` prop has to exist. later, when the whole\n  // query-editor gets converted to react we can stop using this component directly\n  // and then we can probably remove the datasource attribute.\n  datasource: InfluxDatasource;\n}\n\nconst samples: Array<SelectableValue<string>> = [\n  { label: 'Show buckets', description: 'List the available buckets (table)', value: 'buckets()' },\n  {\n    label: 'Simple query',\n    description: 'filter by measurement and field',\n    value: `from(bucket: \"db/rp\")\n  |> range(start: v.timeRangeStart, stop:v.timeRangeStop)\n  |> filter(fn: (r) =>\n    r._measurement == \"example-measurement\" and\n    r._field == \"example-field\"\n  )`,\n  },\n  {\n    label: 'Grouped Query',\n    description: 'Group by (min/max/sum/median)',\n    value: `// v.windowPeriod is a variable referring to the current optimized window period (currently: $interval)\nfrom(bucket: v.bucket)\n  |> range(start: v.timeRangeStart, stop: v.timeRangeStop)\n  |> filter(fn: (r) => r[\"_measurement\"] == \"measurement1\" or r[\"_measurement\"] =~ /^.*?regex.*$/)\n  |> filter(fn: (r) => r[\"_field\"] == \"field2\" or r[\"_field\"] =~ /^.*?regex.*$/)\n  |> aggregateWindow(every: v.windowPeriod, fn: mean|median|max|count|derivative|sum)\n  |> yield(name: \"some-name\")`,\n  },\n  {\n    label: 'Filter by value',\n    description: 'Results between a min/max',\n    value: `// v.bucket, v.timeRangeStart, and v.timeRange stop are all variables supported by the flux plugin and influxdb\nfrom(bucket: v.bucket)\n  |> range(start: v.timeRangeStart, stop: v.timeRangeStop)\n  |> filter(fn: (r) => r[\"_value\"] >= 10 and r[\"_value\"] <= 20)`,\n  },\n  {\n    label: 'Schema Exploration: (measurements)',\n    description: 'Get a list of measurement using flux',\n    value: `import \"influxdata/influxdb/v1\"\nv1.measurements(bucket: v.bucket)`,\n  },\n  {\n    label: 'Schema Exploration: (fields)',\n    description: 'Return every possible key in a single table',\n    value: `from(bucket: v.bucket)\n  |> range(start: v.timeRangeStart, stop:v.timeRangeStop)\n  |> keys()\n  |> keep(columns: [\"_value\"])\n  |> group()\n  |> distinct()`,\n  },\n  {\n    label: 'Schema Exploration: (tag keys)',\n    description: 'Get a list of tag keys using flux',\n    value: `import \"influxdata/influxdb/v1\"\nv1.tagKeys(bucket: v.bucket)`,\n  },\n  {\n    label: 'Schema Exploration: (tag values)',\n    description: 'Get a list of tag values using flux',\n    value: `import \"influxdata/influxdb/v1\"\nv1.tagValues(\n    bucket: v.bucket,\n    tag: \"host\",\n    predicate: (r) => true,\n    start: -1d\n)`,\n  },\n];\n\nclass UnthemedFluxQueryEditor extends PureComponent<Props> {\n  onFluxQueryChange = (query: string) => {\n    this.props.onChange({ ...this.props.query, query });\n  };\n\n  onSampleChange = (val: SelectableValue<string>) => {\n    this.props.onChange({\n      ...this.props.query,\n      query: val.value!,\n    });\n\n    // Angular HACK: Since the target does not actually change!\n    this.forceUpdate();\n  };\n\n  getSuggestions = (): CodeEditorSuggestionItem[] => {\n    const sugs: CodeEditorSuggestionItem[] = [\n      {\n        label: 'v.timeRangeStart',\n        kind: CodeEditorSuggestionItemKind.Property,\n        detail: 'The start time',\n      },\n      {\n        label: 'v.timeRangeStop',\n        kind: CodeEditorSuggestionItemKind.Property,\n        detail: 'The stop time',\n      },\n      {\n        label: 'v.windowPeriod',\n        kind: CodeEditorSuggestionItemKind.Property,\n        detail: 'based on max data points',\n      },\n      {\n        label: 'v.defaultBucket',\n        kind: CodeEditorSuggestionItemKind.Property,\n        detail: 'bucket configured in the datsource',\n      },\n      {\n        label: 'v.organization',\n        kind: CodeEditorSuggestionItemKind.Property,\n        detail: 'org configured for the datsource',\n      },\n    ];\n\n    const templateSrv = getTemplateSrv();\n    templateSrv.getVariables().forEach((variable) => {\n      const label = '${' + variable.name + '}';\n      let val = templateSrv.replace(label);\n      if (val === label) {\n        val = '';\n      }\n      sugs.push({\n        label,\n        kind: CodeEditorSuggestionItemKind.Text,\n        detail: `(Template Variable) ${val}`,\n      });\n    });\n\n    return sugs;\n  };\n\n  // For some reason in angular, when this component gets re-mounted, the width\n  // is not set properly.  This forces the layout shortly after mount so that it\n  // displays OK.  Note: this is not an issue when used directly in react\n  editorDidMountCallbackHack = (editor: MonacoEditor) => {\n    setTimeout(() => editor.layout(), 100);\n  };\n\n  render() {\n    const { query, theme } = this.props;\n    const styles = getStyles(theme);\n\n    const helpTooltip = (\n      <div>\n        Type: <i>ctrl+space</i> to show template variable suggestions <br />\n        Many queries can be copied from Chronograf\n      </div>\n    );\n\n    return (\n      <>\n        <CodeEditor\n          height={'100%'}\n          containerStyles={styles.editorContainerStyles}\n          language=\"sql\"\n          value={query.query || ''}\n          onBlur={this.onFluxQueryChange}\n          onSave={this.onFluxQueryChange}\n          showMiniMap={false}\n          showLineNumbers={true}\n          getSuggestions={this.getSuggestions}\n          onEditorDidMount={this.editorDidMountCallbackHack}\n        />\n        <div className={cx('gf-form-inline', styles.editorActions)}>\n          <LinkButton\n            icon=\"external-link-alt\"\n            variant=\"secondary\"\n            target=\"blank\"\n            href=\"https://docs.influxdata.com/influxdb/latest/query-data/get-started/\"\n          >\n            Flux language syntax\n          </LinkButton>\n          <Segment\n            options={samples}\n            value=\"Sample query\"\n            onChange={this.onSampleChange}\n            className={css({\n              marginTop: theme.spacing(-0.5),\n              marginLeft: theme.spacing(0.5),\n            })}\n          />\n          <div className=\"gf-form gf-form--grow\">\n            <div className=\"gf-form-label gf-form-label--grow\"></div>\n          </div>\n          <InlineFormLabel width={5} tooltip={helpTooltip}>\n            Help\n          </InlineFormLabel>\n        </div>\n      </>\n    );\n  }\n}\n\nconst getStyles = (theme: GrafanaTheme2) => ({\n  editorContainerStyles: css({\n    height: '200px',\n    maxWidth: '100%',\n    resize: 'vertical',\n    overflow: 'auto',\n    backgroundColor: theme.isDark ? theme.colors.background.canvas : theme.colors.background.primary,\n    paddingBottom: theme.spacing(1),\n  }),\n  editorActions: css({\n    marginTop: '6px',\n  }),\n});\n\nexport const FluxQueryEditor = withTheme2(UnthemedFluxQueryEditor);\n","import { RAQBFieldTypes, SQLSelectableValue } from '@grafana/sql';\n\nexport function mapFieldsToTypes(columns: SQLSelectableValue[]) {\n  const fields: SQLSelectableValue[] = [];\n  for (const col of columns) {\n    let type: RAQBFieldTypes = 'text';\n    switch (col.type?.toUpperCase()) {\n      case 'BOOLEAN':\n      case 'BOOL': {\n        type = 'boolean';\n        break;\n      }\n      case 'BYTES':\n      case 'VARCHAR': {\n        type = 'text';\n        break;\n      }\n      case 'FLOAT':\n      case 'FLOAT64':\n      case 'INT':\n      case 'INTEGER':\n      case 'INT64':\n      case 'NUMERIC':\n      case 'BIGNUMERIC': {\n        type = 'number';\n        break;\n      }\n      case 'DATE': {\n        type = 'date';\n        break;\n      }\n      case 'TIMESTAMP(NANOSECOND, NONE)':\n      case 'DATETIME': {\n        type = 'datetime';\n        break;\n      }\n      case 'TIME': {\n        type = 'time';\n        break;\n      }\n      case 'TIMESTAMP': {\n        type = 'datetime';\n        break;\n      }\n      case 'GEOGRAPHY': {\n        type = 'text';\n        break;\n      }\n      default:\n        break;\n    }\n\n    fields.push({ ...col, raqbFieldType: type, icon: mapColumnTypeToIcon(col.type!.toUpperCase()) });\n  }\n  return fields;\n}\n\nexport function mapColumnTypeToIcon(type: string) {\n  switch (type) {\n    case 'TIME':\n    case 'DATETIME':\n    case 'TIMESTAMP':\n      return 'clock-nine';\n    case 'BOOLEAN':\n      return 'toggle-off';\n    case 'INTEGER':\n    case 'FLOAT':\n    case 'FLOAT64':\n    case 'INT':\n    case 'SMALLINT':\n    case 'BIGINT':\n    case 'TINYINT':\n    case 'BYTEINT':\n    case 'INT64':\n    case 'NUMERIC':\n    case 'DECIMAL':\n      return 'calculator-alt';\n    case 'CHAR':\n    case 'VARCHAR':\n    case 'STRING':\n    case 'BYTES':\n    case 'TEXT':\n    case 'TINYTEXT':\n    case 'MEDIUMTEXT':\n    case 'LONGTEXT':\n      return 'text';\n    case 'GEOGRAPHY':\n      return 'map';\n    default:\n      return undefined;\n  }\n}\n","import { isEmpty } from 'lodash';\n\nimport { createSelectClause, haveColumns, SQLQuery } from '@grafana/sql';\n\n// remove identifier quoting from identifier to use in metadata queries\nexport function unquoteIdentifier(value: string) {\n  if (value[0] === '\"' && value[value.length - 1] === '\"') {\n    return value.substring(1, value.length - 1).replace(/\"\"/g, '\"');\n  } else if (value[0] === '`' && value[value.length - 1] === '`') {\n    return value.substring(1, value.length - 1);\n  } else {\n    return value;\n  }\n}\n\nexport function quoteLiteral(value: string) {\n  return \"'\" + value.replace(/'/g, \"''\") + \"'\";\n}\n\nexport function toRawSql({ sql, table }: SQLQuery): string {\n  let rawQuery = '';\n\n  // Return early with empty string if there is no sql column\n  if (!sql || !haveColumns(sql.columns)) {\n    return rawQuery;\n  }\n\n  // wrapping the column name with quotes\n  const sc = sql.columns.map((c) => ({\n    ...c,\n    parameters: c.parameters?.map((p) => ({ ...p, name: formatTableName(p.name) })),\n  }));\n  rawQuery += createSelectClause(sc);\n\n  if (table) {\n    rawQuery += `FROM \"${table}\" `;\n  }\n\n  // $__timeFrom and $__timeTo will be interpolated on the backend\n  rawQuery += `WHERE \"time\" >= $__timeFrom AND \"time\" <= $__timeTo `;\n  if (sql.whereString) {\n    // whereString is generated by the react-awesome-query-builder\n    // we use SQLWhereRow as a common component\n    // in order to not mess with common component here we just modify the string\n    const wherePattern = new RegExp('(\\\\s?)([^\\\\(]\\\\S+)(\\\\s?=)', 'g');\n    const subst = `$1\"$2\"$3`;\n    const whereString = sql.whereString.replace(wherePattern, subst);\n    rawQuery += `AND ${whereString} `;\n  }\n\n  if (sql.groupBy?.[0]?.property.name) {\n    const groupBy = sql.groupBy.map((g) => `\"${g.property.name}\"`).filter((g) => !isEmpty(g));\n    rawQuery += `GROUP BY ${groupBy.join(', ')} `;\n  }\n\n  if (sql.orderBy?.property.name) {\n    rawQuery += `ORDER BY \"${sql.orderBy.property.name}\" `;\n  }\n\n  if (sql.orderBy?.property.name && sql.orderByDirection) {\n    rawQuery += `${sql.orderByDirection} `;\n  }\n\n  // Although LIMIT 0 doesn't make sense, it is still possible to have LIMIT 0\n  if (isLimit(sql.limit)) {\n    rawQuery += `LIMIT ${sql.limit}`;\n  }\n\n  return rawQuery;\n}\n\n// When the column name is *, do not wrap the column name in double-quotes.\n// See: https://github.com/grafana/grafana/issues/88008\nfunction formatTableName(parameter: string | undefined): string {\n  if (parameter === '*') {\n    return parameter;\n  }\n\n  return `\"${parameter}\"`;\n}\n\nconst isLimit = (limit: number | undefined): boolean => limit !== undefined && limit >= 0;\n\n// Puts double quotes (\") around the identifier if it is necessary.\nexport function quoteIdentifierIfNecessary(value: string) {\n  return isValidIdentifier(value) ? value : `\\\"${value}\\\"`;\n}\n\n/**\n * Validates the identifier from MySql and returns true if it\n * doesn't need to be escaped.\n */\nexport function isValidIdentifier(identifier: string): boolean {\n  const isValidName = /^[a-zA-Z_][a-zA-Z0-9_$]*$/g.test(identifier);\n  const isReservedWord = RESERVED_WORDS.includes(identifier.toUpperCase());\n  return !isReservedWord && isValidName;\n}\n\nconst RESERVED_WORDS = [\n  'ACCESSIBLE',\n  'ADD',\n  'ALL',\n  'ALTER',\n  'ANALYZE',\n  'AND',\n  'AS',\n  'ASC',\n  'ASENSITIVE',\n  'BEFORE',\n  'BETWEEN',\n  'BIGINT',\n  'BINARY',\n  'BLOB',\n  'BOTH',\n  'BY',\n  'CALL',\n  'CASCADE',\n  'CASE',\n  'CHANGE',\n  'CHAR',\n  'CHARACTER',\n  'CHECK',\n  'COLLATE',\n  'COLUMN',\n  'CONDITION',\n  'CONSTRAINT',\n  'CONTINUE',\n  'CONVERT',\n  'CREATE',\n  'CROSS',\n  'CUBE',\n  'CUME_DIST',\n  'CURRENT_DATE',\n  'CURRENT_TIME',\n  'CURRENT_TIMESTAMP',\n  'CURRENT_USER',\n  'CURSOR',\n  'DATABASE',\n  'DATABASES',\n  'DAY_HOUR',\n  'DAY_MICROSECOND',\n  'DAY_MINUTE',\n  'DAY_SECOND',\n  'DEC',\n  'DECIMAL',\n  'DECLARE',\n  'DEFAULT',\n  'DELAYED',\n  'DELETE',\n  'DENSE_RANK',\n  'DESC',\n  'DESCRIBE',\n  'DETERMINISTIC',\n  'DISTINCT',\n  'DISTINCTROW',\n  'DIV',\n  'DOUBLE',\n  'DROP',\n  'DUAL',\n  'EACH',\n  'ELSE',\n  'ELSEIF',\n  'EMPTY',\n  'ENCLOSED',\n  'ESCAPED',\n  'EXCEPT',\n  'EXISTS',\n  'EXIT',\n  'EXPLAIN',\n  'FALSE',\n  'FETCH',\n  'FIRST_VALUE',\n  'FLOAT',\n  'FLOAT4',\n  'FLOAT8',\n  'FOR',\n  'FORCE',\n  'FOREIGN',\n  'FROM',\n  'FULLTEXT',\n  'FUNCTION',\n  'GENERATED',\n  'GET',\n  'GRANT',\n  'GROUP',\n  'GROUPING',\n  'GROUPS',\n  'HAVING',\n  'HIGH_PRIORITY',\n  'HOUR_MICROSECOND',\n  'HOUR_MINUTE',\n  'HOUR_SECOND',\n  'IF',\n  'IGNORE',\n  'IN',\n  'INDEX',\n  'INFILE',\n  'INNER',\n  'INOUT',\n  'INSENSITIVE',\n  'INSERT',\n  'INT',\n  'INT1',\n  'INT2',\n  'INT3',\n  'INT4',\n  'INT8',\n  'INTEGER',\n  'INTERSECT',\n  'INTERVAL',\n  'INTO',\n  'IO_AFTER_GTIDS',\n  'IO_BEFORE_GTIDS',\n  'IS',\n  'ITERATE',\n  'JOIN',\n  'JSON_TABLE',\n  'KEY',\n  'KEYS',\n  'KILL',\n  'LAG',\n  'LAST_VALUE',\n  'LATERAL',\n  'LEAD',\n  'LEADING',\n  'LEAVE',\n  'LEFT',\n  'LIKE',\n  'LIMIT',\n  'LINEAR',\n  'LINES',\n  'LOAD',\n  'LOCALTIME',\n  'LOCALTIMESTAMP',\n  'LOCK',\n  'LONG',\n  'LONGBLOB',\n  'LONGTEXT',\n  'LOOP',\n  'LOW_PRIORITY',\n  'MASTER_BIND',\n  'MASTER_SSL_VERIFY_SERVER_CERT',\n  'MATCH',\n  'MAXVALUE',\n  'MEDIUMBLOB',\n  'MEDIUMINT',\n  'MEDIUMTEXT',\n  'MIDDLEINT',\n  'MINUTE_MICROSECOND',\n  'MINUTE_SECOND',\n  'MOD',\n  'MODIFIES',\n  'NATURAL',\n  'NOT',\n  'NO_WRITE_TO_BINLOG',\n  'NTH_VALUE',\n  'NTILE',\n  'NULL',\n  'NUMERIC',\n  'OF',\n  'ON',\n  'OPTIMIZE',\n  'OPTIMIZER_COSTS',\n  'OPTION',\n  'OPTIONALLY',\n  'OR',\n  'ORDER',\n  'OUT',\n  'OUTER',\n  'OUTFILE',\n  'OVER',\n  'PARTITION',\n  'PERCENT_RANK',\n  'PRECISION',\n  'PRIMARY',\n  'PROCEDURE',\n  'PURGE',\n  'RANGE',\n  'RANK',\n  'READ',\n  'READS',\n  'READ_WRITE',\n  'REAL',\n  'RECURSIVE',\n  'REFERENCES',\n  'REGEXP',\n  'RELEASE',\n  'RENAME',\n  'REPEAT',\n  'REPLACE',\n  'REQUIRE',\n  'RESIGNAL',\n  'RESTRICT',\n  'RETURN',\n  'REVOKE',\n  'RIGHT',\n  'RLIKE',\n  'ROW',\n  'ROWS',\n  'ROW_NUMBER',\n  'SCHEMA',\n  'SCHEMAS',\n  'SECOND_MICROSECOND',\n  'SELECT',\n  'SENSITIVE',\n  'SEPARATOR',\n  'SET',\n  'SHOW',\n  'SIGNAL',\n  'SMALLINT',\n  'SPATIAL',\n  'SPECIFIC',\n  'SQL',\n  'SQLEXCEPTION',\n  'SQLSTATE',\n  'SQLWARNING',\n  'SQL_BIG_RESULT',\n  'SQL_CALC_FOUND_ROWS',\n  'SQL_SMALL_RESULT',\n  'SSL',\n  'STARTING',\n  'STORED',\n  'STRAIGHT_JOIN',\n  'SYSTEM',\n  'TABLE',\n  'TERMINATED',\n  'THEN',\n  'TINYBLOB',\n  'TINYINT',\n  'TINYTEXT',\n  'TO',\n  'TRAILING',\n  'TRIGGER',\n  'TRUE',\n  'UNDO',\n  'UNION',\n  'UNIQUE',\n  'UNLOCK',\n  'UNSIGNED',\n  'UPDATE',\n  'USAGE',\n  'USE',\n  'USING',\n  'UTC_DATE',\n  'UTC_TIME',\n  'UTC_TIMESTAMP',\n  'VALUES',\n  'VARBINARY',\n  'VARCHAR',\n  'VARCHARACTER',\n  'VARYING',\n  'VIRTUAL',\n  'WHEN',\n  'WHERE',\n  'WHILE',\n  'WINDOW',\n  'WITH',\n  'WRITE',\n  'XOR',\n  'YEAR_MONTH',\n  'ZEROFILL',\n];\n","import { quoteLiteral, unquoteIdentifier } from './sqlUtil';\n\nexport function buildTableQuery(dataset?: string) {\n  const database = dataset !== undefined ? quoteIdentAsLiteral(dataset) : 'database()';\n  return `SELECT table_name FROM information_schema.tables WHERE table_schema = ${database} ORDER BY table_name`;\n}\n\nexport function showDatabases() {\n  return `SELECT DISTINCT TABLE_SCHEMA from information_schema.TABLES where TABLE_TYPE != 'SYSTEM VIEW' ORDER BY TABLE_SCHEMA`;\n}\n\nexport function buildColumnQuery(table: string, dbName?: string) {\n  let query = 'SELECT column_name, data_type FROM information_schema.columns WHERE ';\n  query += buildTableConstraint(table, dbName);\n\n  query += ' ORDER BY column_name';\n\n  return query;\n}\n\nexport function buildTableConstraint(table: string, dbName?: string) {\n  let query = '';\n\n  // check for schema qualified table\n  if (table.includes('.')) {\n    const parts = table.split('.');\n    query = 'table_schema = ' + quoteIdentAsLiteral(parts[0]);\n    query += ' AND table_name = ' + quoteIdentAsLiteral(parts[1]);\n    return query;\n  } else {\n    const database = dbName !== undefined ? quoteIdentAsLiteral(dbName) : 'database()';\n    query = `table_schema = ${database} AND table_name = ` + quoteIdentAsLiteral(table);\n\n    return query;\n  }\n}\n\nexport function quoteIdentAsLiteral(value: string) {\n  return quoteLiteral(unquoteIdentifier(value));\n}\n","import {\n  CompletionItemKind,\n  CompletionItemPriority,\n  getStandardSQLCompletionProvider,\n  LanguageCompletionProvider,\n  LinkedToken,\n  PositionContext,\n  StatementPlacementProvider,\n  SuggestionKind,\n  SuggestionKindProvider,\n  TableDefinition,\n  TableIdentifier,\n  TokenType,\n} from '@grafana/plugin-ui';\n\ninterface CompletionProviderGetterArgs {\n  getMeta: (t?: TableIdentifier) => Promise<TableDefinition[]>;\n}\n\nexport const getSqlCompletionProvider: (args: CompletionProviderGetterArgs) => LanguageCompletionProvider =\n  ({ getMeta }) =>\n  (monaco, language) => ({\n    ...(language && getStandardSQLCompletionProvider(monaco, language)),\n    customStatementPlacement: customStatementPlacementProvider,\n    customSuggestionKinds: customSuggestionKinds(getMeta),\n  });\n\nconst customStatementPlacement = {\n  afterDatabase: 'afterDatabase',\n};\n\nconst customSuggestionKind = {\n  tablesWithinDatabase: 'tablesWithinDatabase',\n};\n\nconst FROMKEYWORD = 'FROM';\n\nexport const customStatementPlacementProvider: StatementPlacementProvider = () => [\n  {\n    id: customStatementPlacement.afterDatabase,\n    resolve: (currentToken, previousKeyword, previousNonWhiteSpace) => {\n      return Boolean(\n        currentToken?.is(TokenType.Delimiter, '.') &&\n          previousKeyword?.value === FROMKEYWORD &&\n          (previousNonWhiteSpace?.is(TokenType.IdentifierQuote) || previousNonWhiteSpace?.isIdentifier()) &&\n          // don't match after table name\n          currentToken\n            ?.getPreviousUntil(TokenType.Keyword, [TokenType.IdentifierQuote], FROMKEYWORD)\n            ?.filter((t) => t.isIdentifier()).length === 1\n      );\n    },\n  },\n];\n\nexport const customSuggestionKinds: (getMeta: CompletionProviderGetterArgs['getMeta']) => SuggestionKindProvider =\n  (getMeta) => () => [\n    {\n      id: SuggestionKind.Tables,\n      overrideDefault: true,\n      suggestionsResolver: async (ctx) => {\n        const databaseName = getDatabaseName(ctx.currentToken);\n\n        const suggestions = await getMeta({ schema: databaseName });\n\n        return suggestions.map(mapToSuggestion(ctx));\n      },\n    },\n    {\n      id: SuggestionKind.Columns,\n      overrideDefault: true,\n      suggestionsResolver: async (ctx) => {\n        const databaseToken = getDatabaseToken(ctx.currentToken);\n        const databaseName = getDatabaseName(databaseToken);\n        const tableName = getTableName(databaseToken);\n\n        if (!databaseName || !tableName) {\n          return [];\n        }\n\n        const suggestions = await getMeta({ schema: databaseName, table: tableName });\n\n        return suggestions.map(mapToSuggestion(ctx));\n      },\n    },\n    {\n      id: customSuggestionKind.tablesWithinDatabase,\n      applyTo: [customStatementPlacement.afterDatabase],\n      suggestionsResolver: async (ctx) => {\n        const databaseName = getDatabaseName(ctx.currentToken);\n\n        const suggestions = await getMeta({ schema: databaseName });\n\n        return suggestions.map(mapToSuggestion(ctx));\n      },\n    },\n  ];\n\nfunction mapToSuggestion(ctx: PositionContext) {\n  return function (tableDefinition: TableDefinition) {\n    return {\n      label: tableDefinition.name,\n      insertText: tableDefinition.completion ?? tableDefinition.name,\n      command: { id: 'editor.action.triggerSuggest', title: '' },\n      kind: CompletionItemKind.Field,\n      sortText: CompletionItemPriority.High,\n      range: {\n        ...ctx.range,\n        startColumn: ctx.range.endColumn,\n        endColumn: ctx.range.endColumn,\n      },\n    };\n  };\n}\n\nfunction getDatabaseName(token: LinkedToken | null | undefined) {\n  if (token?.isIdentifier() && token.value[token.value.length - 1] !== '.') {\n    return token.value;\n  }\n\n  if (token?.is(TokenType.Delimiter, '.')) {\n    return token.getPreviousOfType(TokenType.Identifier)?.value;\n  }\n\n  if (token?.is(TokenType.IdentifierQuote)) {\n    return token.getPreviousOfType(TokenType.Identifier)?.value || token.getNextOfType(TokenType.Identifier)?.value;\n  }\n  return;\n}\n\nfunction getTableName(token: LinkedToken | null | undefined) {\n  const identifier = token?.getNextOfType(TokenType.Identifier);\n  return identifier?.value;\n}\n\nconst getFromKeywordToken = (currentToken: LinkedToken | null) => {\n  const selectToken = currentToken?.getPreviousOfType(TokenType.Keyword, 'SELECT') ?? null;\n  return selectToken?.getNextOfType(TokenType.Keyword, FROMKEYWORD);\n};\n\nconst getDatabaseToken = (currentToken: LinkedToken | null) => {\n  const fromToken = getFromKeywordToken(currentToken);\n  const nextIdentifier = fromToken?.getNextOfType(TokenType.Identifier);\n  if (nextIdentifier?.isKeyword() && nextIdentifier.next?.is(TokenType.Parenthesis, '(')) {\n    return null;\n  } else {\n    return nextIdentifier;\n  }\n};\n","import { v4 as uuidv4 } from 'uuid';\n\nimport { DataSourceInstanceSettings, TimeRange } from '@grafana/data';\nimport { CompletionItemKind, LanguageDefinition, TableIdentifier } from '@grafana/plugin-ui';\nimport { TemplateSrv, getTemplateSrv } from '@grafana/runtime';\nimport { COMMON_FNS, DB, FuncParameter, SQLQuery, SqlDatasource, formatSQL } from '@grafana/sql';\n\nimport { mapFieldsToTypes } from './fields';\nimport { buildColumnQuery, buildTableQuery } from './flightsqlMetaQuery';\nimport { getSqlCompletionProvider } from './sqlCompletionProvider';\nimport { quoteIdentifierIfNecessary, quoteLiteral, toRawSql } from './sqlUtil';\nimport { FlightSQLOptions } from './types';\n\nexport class FlightSQLDatasource extends SqlDatasource {\n  sqlLanguageDefinition: LanguageDefinition | undefined;\n\n  constructor(\n    private instanceSettings: DataSourceInstanceSettings<FlightSQLOptions>,\n    protected readonly templateSrv: TemplateSrv = getTemplateSrv()\n  ) {\n    super(instanceSettings);\n  }\n\n  getQueryModel() {\n    return { quoteLiteral };\n  }\n\n  getSqlLanguageDefinition(): LanguageDefinition {\n    if (this.sqlLanguageDefinition !== undefined) {\n      return this.sqlLanguageDefinition;\n    }\n\n    const args = {\n      getMeta: (identifier?: TableIdentifier) => this.fetchMeta(identifier),\n    };\n    this.sqlLanguageDefinition = {\n      id: 'sql',\n      completionProvider: getSqlCompletionProvider(args),\n      formatter: formatSQL,\n    };\n    return this.sqlLanguageDefinition;\n  }\n\n  async fetchDatasets(): Promise<string[]> {\n    return Promise.resolve(['iox']);\n  }\n\n  async fetchTables(dataset?: string): Promise<string[]> {\n    const query = buildTableQuery(dataset);\n    const tables = await this.runSql<string[]>(query, { refId: 'tables' });\n    const tableNames = tables.map((t) => quoteIdentifierIfNecessary(t[0]));\n    tableNames.unshift(...this.getTemplateVariables());\n    return tableNames;\n  }\n\n  async fetchFields(query: Partial<SQLQuery>) {\n    if (!query.dataset || !query.table) {\n      return [];\n    }\n    const interpolatedTable = this.templateSrv.replace(query.table);\n    const queryString = buildColumnQuery(interpolatedTable, query.dataset);\n    const frame = await this.runSql<string[]>(queryString, { refId: `fields-${uuidv4}` });\n    const fields = frame.map((f) => ({\n      name: f[0],\n      text: f[0],\n      value: quoteIdentifierIfNecessary(f[0]),\n      type: f[1],\n      label: f[0],\n    }));\n    fields.unshift(\n      ...this.getTemplateVariables().map((v) => ({\n        name: v,\n        text: v,\n        value: quoteIdentifierIfNecessary(v),\n        type: '',\n        label: v,\n      }))\n    );\n    return mapFieldsToTypes(fields);\n  }\n\n  getTemplateVariables() {\n    return this.templateSrv.getVariables().map((v) => `$${v.name}`);\n  }\n\n  async fetchMeta(identifier?: TableIdentifier) {\n    const defaultDB = this.instanceSettings.jsonData.database;\n    if (!identifier?.schema && defaultDB) {\n      const tables = await this.fetchTables(defaultDB);\n      return tables.map((t) => ({ name: t, completion: `${defaultDB}.${t}`, kind: CompletionItemKind.Class }));\n    } else if (!identifier?.schema && !defaultDB) {\n      const datasets = await this.fetchDatasets();\n      return datasets.map((d) => ({ name: d, completion: `${d}.`, kind: CompletionItemKind.Module }));\n    } else {\n      if (!identifier?.table && (!defaultDB || identifier?.schema)) {\n        const tables = await this.fetchTables(identifier?.schema);\n        return tables.map((t) => ({ name: t, completion: t, kind: CompletionItemKind.Class }));\n      } else if (identifier?.table && identifier.schema) {\n        const fields = await this.fetchFields({ dataset: identifier.schema, table: identifier.table });\n        return fields.map((t) => ({ name: t.name, completion: t.value, kind: CompletionItemKind.Field }));\n      } else {\n        return [];\n      }\n    }\n  }\n\n  getFunctions = (): ReturnType<DB['functions']> => {\n    const fns = [...COMMON_FNS, { name: 'VARIANCE' }, { name: 'STDDEV' }];\n    const columnParam: FuncParameter = {\n      name: 'Column',\n      required: true,\n      options: (query) => this.fetchFields(query),\n    };\n    const intervalParam: FuncParameter = {\n      name: 'Interval',\n      required: true,\n      options: () => {\n        return Promise.resolve([{ label: '$__interval', value: '$__interval' }]);\n      },\n    };\n\n    return [\n      ...fns.map((fn) => ({ ...fn, parameters: [columnParam] })),\n      {\n        name: '$__timeGroup',\n        description: 'Time grouping function',\n        parameters: [columnParam, intervalParam],\n      },\n      {\n        name: '$__timeGroupAlias',\n        description: 'Time grouping function with time as alias',\n        parameters: [columnParam, intervalParam],\n      },\n    ];\n  };\n\n  getDB(): DB {\n    if (this.db !== undefined) {\n      return this.db;\n    }\n    return {\n      datasets: () => this.fetchDatasets(),\n      tables: (dataset?: string) => this.fetchTables(dataset),\n      fields: (query: SQLQuery) => this.fetchFields(query),\n      validateQuery: (query: SQLQuery, range?: TimeRange) =>\n        Promise.resolve({ query, error: '', isError: false, isValid: true }),\n      dsID: () => this.id,\n      toRawSql,\n      functions: () => this.getFunctions(),\n      getEditorLanguageDefinition: () => this.getSqlLanguageDefinition(),\n    };\n  }\n}\n","import { css, cx } from '@emotion/css';\nimport { PureComponent } from 'react';\n\nimport { GrafanaTheme2 } from '@grafana/data';\nimport { SQLQuery, SqlQueryEditorLazy, applyQueryDefaults } from '@grafana/sql';\nimport { InlineFormLabel, LinkButton, Themeable2, withTheme2 } from '@grafana/ui';\n\nimport InfluxDatasource from '../../../../datasource';\nimport { FlightSQLDatasource } from '../../../../fsql/datasource.flightsql';\nimport { InfluxQuery } from '../../../../types';\n\ninterface Props extends Themeable2 {\n  onChange: (query: InfluxQuery) => void;\n  onRunQuery: () => void;\n  query: InfluxQuery;\n  datasource: InfluxDatasource;\n}\n\nclass UnthemedSQLQueryEditor extends PureComponent<Props> {\n  datasource: FlightSQLDatasource;\n\n  constructor(props: Props) {\n    super(props);\n    const { datasource: influxDatasource } = props;\n\n    this.datasource = new FlightSQLDatasource(\n      {\n        url: influxDatasource.urls[0],\n        access: influxDatasource.access,\n        id: influxDatasource.id,\n\n        jsonData: {\n          // TODO Clean this\n          allowCleartextPasswords: false,\n          tlsAuth: false,\n          tlsAuthWithCACert: false,\n          tlsSkipVerify: false,\n          maxIdleConns: 1,\n          maxOpenConns: 1,\n          maxIdleConnsAuto: true,\n          connMaxLifetime: 1,\n          timezone: '',\n          user: '',\n          database: '',\n          url: influxDatasource.urls[0],\n          timeInterval: '',\n        },\n        meta: influxDatasource.meta,\n        name: influxDatasource.name,\n        readOnly: false,\n        type: influxDatasource.type,\n        uid: influxDatasource.uid,\n      },\n      influxDatasource.templateSrv\n    );\n  }\n\n  transformQuery(query: InfluxQuery & SQLQuery): SQLQuery {\n    const defaultQuery = applyQueryDefaults(query);\n    return {\n      ...defaultQuery,\n      dataset: 'iox',\n      sql: {\n        ...defaultQuery.sql,\n        limit: undefined,\n      },\n    };\n  }\n\n  render() {\n    const { query, theme, onRunQuery, onChange } = this.props;\n    const styles = getStyles(theme);\n\n    const onRunSQLQuery = () => {\n      return onRunQuery();\n    };\n\n    const onSQLChange = (query: SQLQuery) => {\n      // query => rawSql for now\n      onChange({ ...query });\n    };\n\n    const helpTooltip = (\n      <div>\n        Type: <i>ctrl+space</i> to show template variable suggestions <br />\n        Many queries can be copied from Chronograf\n      </div>\n    );\n\n    return (\n      <>\n        <SqlQueryEditorLazy\n          datasource={this.datasource}\n          query={this.transformQuery(query)}\n          onRunQuery={onRunSQLQuery}\n          onChange={onSQLChange}\n          queryHeaderProps={{ dialect: 'influx' }}\n        />\n        <div className={cx('gf-form-inline', styles.editorActions)}>\n          <LinkButton\n            icon=\"external-link-alt\"\n            variant=\"secondary\"\n            target=\"blank\"\n            href=\"https://docs.influxdata.com/influxdb/cloud-serverless/query-data/sql/\"\n          >\n            SQL language syntax\n          </LinkButton>\n          <div className=\"gf-form gf-form--grow\">\n            <div className=\"gf-form-label gf-form-label--grow\"></div>\n          </div>\n          <InlineFormLabel width={5} tooltip={helpTooltip}>\n            Help\n          </InlineFormLabel>\n        </div>\n      </>\n    );\n  }\n}\n\nconst getStyles = (theme: GrafanaTheme2) => ({\n  editorContainerStyles: css({\n    height: '200px',\n    maxWidth: '100%',\n    resize: 'vertical',\n    overflow: 'auto',\n    backgroundColor: theme.isDark ? theme.colors.background.canvas : theme.colors.background.primary,\n    paddingBottom: theme.spacing(1),\n  }),\n  editorActions: css({\n    marginTop: '6px',\n  }),\n});\n\nexport const FSQLEditor = withTheme2(UnthemedSQLQueryEditor);\n","import { useEffect, useState } from 'react';\n\nimport { Button, ConfirmModal } from '@grafana/ui';\n\ntype Props = {\n  isRaw: boolean;\n  onChange: (newIsRaw: boolean) => void;\n};\n\nexport const QueryEditorModeSwitcher = ({ isRaw, onChange }: Props): JSX.Element => {\n  const [isModalOpen, setModalOpen] = useState(false);\n\n  useEffect(() => {\n    // if the isRaw changes, we hide the modal\n    setModalOpen(false);\n  }, [isRaw]);\n\n  if (isRaw) {\n    return (\n      <>\n        <Button\n          aria-label=\"Switch to visual editor\"\n          icon=\"pen\"\n          variant=\"secondary\"\n          type=\"button\"\n          onClick={() => {\n            // we show the are-you-sure modal\n            setModalOpen(true);\n          }}\n        ></Button>\n        <ConfirmModal\n          isOpen={isModalOpen}\n          title=\"Switch to visual editor mode\"\n          body=\"Are you sure to switch to visual editor mode? You will lose the changes done in raw query mode.\"\n          confirmText=\"Yes, switch to editor mode\"\n          dismissText=\"No, stay in raw query mode\"\n          onConfirm={() => {\n            onChange(false);\n          }}\n          onDismiss={() => {\n            setModalOpen(false);\n          }}\n        />\n      </>\n    );\n  } else {\n    return (\n      <Button\n        aria-label=\"Switch to text editor\"\n        icon=\"pen\"\n        variant=\"secondary\"\n        type=\"button\"\n        onClick={() => {\n          onChange(true);\n        }}\n      ></Button>\n    );\n  }\n};\n","import { SelectableValue } from '@grafana/data';\n\nimport { ResultFormat } from '../../types';\n\nexport const RESULT_FORMATS: Array<SelectableValue<ResultFormat>> = [\n  { label: 'Time series', value: 'time_series' },\n  { label: 'Table', value: 'table' },\n  { label: 'Logs', value: 'logs' },\n];\n\nexport const DEFAULT_RESULT_FORMAT: ResultFormat = 'time_series';\n","import { useState, useEffect } from 'react';\nimport { usePrevious } from 'react-use';\n\nexport function useShadowedState<T>(outsideVal: T): [T, (newVal: T) => void] {\n  const [currentVal, setCurrentVal] = useState(outsideVal);\n  const prevOutsideVal = usePrevious(outsideVal);\n\n  useEffect(() => {\n    const isOutsideValChanged = prevOutsideVal !== outsideVal;\n    // if the value changes from the outside, we accept it into the state\n    // (we only set it if it is different from the current value)\n    if (isOutsideValChanged && currentVal !== outsideVal) {\n      setCurrentVal(outsideVal);\n    }\n  }, [outsideVal, currentVal, prevOutsideVal]);\n\n  return [currentVal, setCurrentVal];\n}\n","import { useId } from 'react';\n\nimport { Stack, InlineField, Input, Select, TextArea } from '@grafana/ui';\n\nimport { InfluxQuery } from '../../../../../types';\nimport { DEFAULT_RESULT_FORMAT, RESULT_FORMATS } from '../../../constants';\nimport { useShadowedState } from '../hooks/useShadowedState';\n\ntype Props = {\n  query: InfluxQuery;\n  onChange: (query: InfluxQuery) => void;\n  onRunQuery: () => void;\n};\n\n// we handle 3 fields: \"query\", \"alias\", \"resultFormat\"\n// \"resultFormat\" changes are applied immediately\n// \"query\" and \"alias\" changes only happen on onblur\nexport const RawInfluxQLEditor = ({ query, onChange, onRunQuery }: Props): JSX.Element => {\n  const [currentQuery, setCurrentQuery] = useShadowedState(query.query);\n  const [currentAlias, setCurrentAlias] = useShadowedState(query.alias);\n  const aliasElementId = useId();\n  const selectElementId = useId();\n\n  const resultFormat = query.resultFormat ?? DEFAULT_RESULT_FORMAT;\n\n  const applyDelayedChangesAndRunQuery = () => {\n    onChange({\n      ...query,\n      query: currentQuery,\n      alias: currentAlias,\n      resultFormat,\n    });\n    onRunQuery();\n  };\n\n  return (\n    <Stack direction={'column'}>\n      <TextArea\n        aria-label=\"query\"\n        rows={3}\n        spellCheck={false}\n        placeholder=\"InfluxDB Query\"\n        onBlur={applyDelayedChangesAndRunQuery}\n        onChange={(e) => {\n          setCurrentQuery(e.currentTarget.value);\n        }}\n        value={currentQuery ?? ''}\n      />\n      <Stack>\n        <InlineField htmlFor={selectElementId} label=\"Format as\">\n          <Select\n            inputId={selectElementId}\n            onChange={(v) => {\n              onChange({ ...query, resultFormat: v.value });\n              onRunQuery();\n            }}\n            value={resultFormat}\n            options={RESULT_FORMATS}\n          />\n        </InlineField>\n        <InlineField htmlFor={aliasElementId} label=\"Alias by\">\n          <Input\n            id={aliasElementId}\n            type=\"text\"\n            spellCheck={false}\n            placeholder=\"Naming pattern\"\n            onBlur={applyDelayedChangesAndRunQuery}\n            onChange={(e) => {\n              setCurrentAlias(e.currentTarget.value);\n            }}\n            value={currentAlias ?? ''}\n          />\n        </InlineField>\n      </Stack>\n    </Stack>\n  );\n};\n","import { reduce } from 'lodash';\n\nimport { escapeRegex, ScopedVars } from '@grafana/data';\nimport { TemplateSrv } from '@grafana/runtime';\n\nimport { DEFAULT_POLICY, InfluxQueryTag, MetadataQueryType } from './types';\n\nexport const buildMetadataQuery = (params: {\n  type: MetadataQueryType;\n  templateService: TemplateSrv;\n  scopedVars?: ScopedVars;\n  database?: string;\n  measurement?: string;\n  retentionPolicy?: string;\n  tags?: InfluxQueryTag[];\n  withKey?: string;\n  withMeasurementFilter?: string;\n  withTimeFilter?: string;\n}): string => {\n  let query = '';\n  let {\n    type,\n    templateService,\n    scopedVars,\n    database,\n    measurement,\n    retentionPolicy,\n    tags,\n    withKey,\n    withMeasurementFilter,\n    withTimeFilter,\n  } = params;\n\n  switch (type) {\n    case 'RETENTION_POLICIES':\n      return 'SHOW RETENTION POLICIES on \"' + database + '\"';\n    case 'FIELDS':\n      if (!measurement || measurement === '') {\n        return 'SHOW FIELD KEYS';\n      }\n\n      // If there is a measurement and it is not empty string\n      if (measurement && !measurement.match(/^\\/.*\\/|^$/)) {\n        measurement = '\"' + measurement + '\"';\n\n        if (retentionPolicy && retentionPolicy !== DEFAULT_POLICY) {\n          retentionPolicy = '\"' + retentionPolicy + '\"';\n          measurement = retentionPolicy + '.' + measurement;\n        }\n      }\n\n      return 'SHOW FIELD KEYS FROM ' + measurement;\n    case 'TAG_KEYS':\n      query = 'SHOW TAG KEYS';\n      break;\n    case 'TAG_VALUES':\n      query = 'SHOW TAG VALUES';\n      break;\n    case 'MEASUREMENTS':\n      query = 'SHOW MEASUREMENTS';\n      if (withMeasurementFilter) {\n        // we do a case-insensitive regex-based lookup\n        query += ' WITH MEASUREMENT =~ /(?i)' + escapeRegex(withMeasurementFilter) + '/';\n      }\n      break;\n    default:\n      return query;\n  }\n  if (measurement) {\n    if (!measurement.match('^/.*/') && !measurement.match(/^merge\\(.*\\)/)) {\n      measurement = '\"' + measurement + '\"';\n    }\n\n    if (retentionPolicy && retentionPolicy !== DEFAULT_POLICY) {\n      retentionPolicy = '\"' + retentionPolicy + '\"';\n      measurement = retentionPolicy + '.' + measurement;\n    }\n\n    if (measurement !== '') {\n      query += ' FROM ' + measurement;\n    }\n  }\n\n  if (withKey) {\n    let keyIdentifier = withKey;\n\n    if (keyIdentifier.endsWith('::tag')) {\n      keyIdentifier = keyIdentifier.slice(0, -5);\n    }\n\n    query += ' WITH KEY = \"' + keyIdentifier + '\"';\n  }\n\n  let whereConditions: string[] = [];\n  if (tags && tags.length > 0) {\n    whereConditions = reduce<InfluxQueryTag, string[]>(\n      tags,\n      (memo, tag) => {\n        // do not add a condition for the key we want to explore for\n        if (tag.key && tag.key === withKey) {\n          return memo;\n        }\n\n        // value operators not supported in these types of queries\n        if (tag.operator === '>' || tag.operator === '<') {\n          return memo;\n        }\n\n        memo.push(renderTagCondition(tag, memo.length, templateService, scopedVars, true));\n        return memo;\n      },\n      []\n    );\n  }\n\n  let shouldUseTime = isValidTimeFilter(withTimeFilter) && type !== 'MEASUREMENTS';\n  if (whereConditions.length > 0) {\n    query += ' WHERE ' + whereConditions.join(' ') + (shouldUseTime ? ' AND time > now() - ' + withTimeFilter : '');\n  } else {\n    query += shouldUseTime ? ' WHERE time > now() - ' + withTimeFilter : '';\n  }\n\n  if (type === 'MEASUREMENTS') {\n    query += ' LIMIT 100';\n    //Solve issue #2524 by limiting the number of measurements returned\n    //LIMIT must be after WITH MEASUREMENT and WHERE clauses\n    //This also could be used for TAG KEYS and TAG VALUES, if desired\n  }\n\n  return query;\n};\n\n// Function to validate the provided time filter value\nexport function isValidTimeFilter(value?: string): boolean {\n  if (!value || typeof value !== 'string') {\n    return false;\n  }\n\n  // Normalize microseconds unit\n  const normalizedValue = value.replace(//g, 'u');\n\n  const validUnits = new Set(['ns', 'u', 'ms', 's', 'm', 'h', 'd', 'w']);\n  const pattern = /(\\d+)(ns|u|ms|s|m|h|d|w)/g;\n  const usedUnits = new Set<string>();\n\n  let match: RegExpExecArray | null;\n  let totalLength = 0;\n\n  while ((match = pattern.exec(normalizedValue)) !== null) {\n    const [fullMatch, numberPart, unit] = match;\n    totalLength += fullMatch.length;\n\n    if (!validUnits.has(unit) || usedUnits.has(unit) || numberPart.startsWith('0')) {\n      return false;\n    }\n    usedUnits.add(unit);\n  }\n  return totalLength === normalizedValue.length;\n}\n\n// A merge of query_builder/renderTagCondition and influx_query_model/renderTagCondition\nexport function renderTagCondition(\n  tag: InfluxQueryTag,\n  index: number,\n  templateSrv: TemplateSrv,\n  scopedVars?: ScopedVars,\n  interpolate?: boolean\n) {\n  let str = '';\n  let operator = tag.operator;\n  let value = tag.value;\n  if (index > 0) {\n    str = (tag.condition || 'AND') + ' ';\n  }\n\n  if (!operator) {\n    if (/^\\/.*\\/$/.test(tag.value)) {\n      operator = '=~';\n    } else {\n      operator = '=';\n    }\n  }\n\n  // quote value unless regex or empty-string\n  // Influx versions before 0.13 had inconsistent requirements on if (numeric) tags are quoted or not.\n  if (value === '' || (operator !== '=~' && operator !== '!~')) {\n    value = \"'\" + value.replace(/\\\\/g, '\\\\\\\\').replace(/\\'/g, \"\\\\'\") + \"'\";\n  }\n\n  // quote value unless regex\n  if (operator !== '=~' && operator !== '!~') {\n    if (interpolate) {\n      value = templateSrv.replace(value, scopedVars);\n    } else if (operator !== '>' && operator !== '<') {\n      value = \"'\" + value.replace(/\\\\/g, '\\\\\\\\').replace(/\\'/g, \"\\\\'\") + \"'\";\n    }\n  } else if (interpolate) {\n    value = templateSrv.replace(value, scopedVars, 'regex');\n  }\n\n  let escapedKey = `\"${tag.key}\"`;\n\n  if (tag.key.endsWith('::tag')) {\n    escapedKey = `\"${tag.key.slice(0, -5)}\"::tag`;\n  }\n\n  if (tag.key.endsWith('::field')) {\n    escapedKey = `\"${tag.key.slice(0, -7)}\"::field`;\n  }\n\n  return str + escapedKey + ' ' + operator + ' ' + value;\n}\n","import { ScopedVars } from '@grafana/data';\nimport config from 'app/core/config';\n\nimport InfluxDatasource from './datasource';\nimport { buildMetadataQuery } from './influxql_query_builder';\nimport { InfluxQuery, InfluxQueryTag, MetadataQueryType } from './types';\n\ntype MetadataQueryOptions = {\n  type: MetadataQueryType;\n  datasource: InfluxDatasource;\n  scopedVars?: ScopedVars;\n  measurement?: string;\n  retentionPolicy?: string;\n  tags?: InfluxQueryTag[];\n  withKey?: string;\n  withMeasurementFilter?: string;\n  withTimeFilter?: string;\n};\n\nconst runExploreQuery = async (options: MetadataQueryOptions): Promise<Array<{ text: string }>> => {\n  const { type, datasource, scopedVars, measurement, retentionPolicy, tags, withKey, withMeasurementFilter } = options;\n  const query = buildMetadataQuery({\n    type,\n    scopedVars,\n    measurement,\n    retentionPolicy,\n    tags,\n    withKey,\n    withMeasurementFilter,\n    withTimeFilter: datasource.showTagTime,\n    templateService: datasource.templateSrv,\n    database: datasource.database,\n  });\n  const policy = retentionPolicy ? datasource.templateSrv.replace(retentionPolicy, {}, 'regex') : '';\n  const target: InfluxQuery = {\n    query,\n    policy,\n    rawQuery: true,\n    refId: 'metadataQuery',\n  };\n  if (config.featureToggles.influxdbBackendMigration) {\n    return datasource.runMetadataQuery(target);\n  } else {\n    const options = { policy: target.policy };\n    return datasource.metricFindQuery({ refId: 'run-explore-query', query }, options);\n  }\n};\n\nexport async function getAllPolicies(datasource: InfluxDatasource): Promise<string[]> {\n  const data = await runExploreQuery({ type: 'RETENTION_POLICIES', datasource });\n  return data.map((item) => item.text);\n}\n\nexport async function getAllMeasurements(\n  datasource: InfluxDatasource,\n  tags: InfluxQueryTag[],\n  withMeasurementFilter?: string\n): Promise<string[]> {\n  const data = await runExploreQuery({ type: 'MEASUREMENTS', datasource, tags, withMeasurementFilter });\n  return data.map((item) => item.text);\n}\n\nexport async function getTagKeys(\n  datasource: InfluxDatasource,\n  measurement?: string,\n  retentionPolicy?: string\n): Promise<string[]> {\n  const data = await runExploreQuery({ type: 'TAG_KEYS', datasource, measurement, retentionPolicy });\n  return data.map((item) => item.text);\n}\n\nexport async function getTagValues(\n  datasource: InfluxDatasource,\n  tags: InfluxQueryTag[],\n  withKey: string,\n  measurement?: string,\n  retentionPolicy?: string\n): Promise<string[]> {\n  if (withKey.endsWith('::field')) {\n    return [];\n  }\n  const data = await runExploreQuery({\n    type: 'TAG_VALUES',\n    tags,\n    withKey,\n    datasource,\n    measurement,\n    retentionPolicy,\n  });\n  return data.map((item) => item.text);\n}\n\nexport async function getFieldKeys(\n  datasource: InfluxDatasource,\n  measurement: string,\n  retentionPolicy?: string\n): Promise<string[]> {\n  const data = await runExploreQuery({ type: 'FIELDS', datasource, measurement, retentionPolicy });\n  return data.map((item) => item.text);\n}\n","// it is possible to add fields into the `InfluxQueryTag` structures, and they do work,\n// but in some cases, when we do metadata queries, we have to remove them from the queries.\nimport { InfluxQueryTag } from '../../../../../types';\n\nexport function filterTags(parts: InfluxQueryTag[], allTagKeys: Set<string>): InfluxQueryTag[] {\n  return parts.filter((t) => t.key.endsWith('::tag') || allTagKeys.has(t.key + '::tag'));\n}\n","import { SelectableValue } from '@grafana/data';\n\nexport function toSelectableValue<T extends string>(t: T): SelectableValue<T> {\n  return { label: t, value: t };\n}\n","export function unwrap<T>(value: T | null | undefined): T {\n  if (value == null) {\n    throw new Error('value must not be nullish');\n  }\n  return value;\n}\n","import { SelectableValue } from '@grafana/data';\nimport { QueryPartDef } from 'app/features/alerting/state/query_part';\n\nimport InfluxQueryModel from '../../../../../influx_query_model';\nimport queryPart from '../../../../../query_part';\nimport { InfluxQuery, InfluxQueryPart } from '../../../../../types';\nimport { PartParams } from '../visual/PartListSection';\n\nimport { toSelectableValue } from './toSelectableValue';\nimport { unwrap } from './unwrap';\n\ntype Categories = Record<string, QueryPartDef[]>;\n\nexport function getNewSelectPartOptions(): SelectableValue[] {\n  const categories: Categories = queryPart.getCategories();\n  const options: SelectableValue[] = [];\n\n  const keys = Object.keys(categories);\n\n  keys.forEach((key) => {\n    const children: SelectableValue[] = categories[key].map((x) => toSelectableValue(x.type));\n\n    options.push({\n      label: key,\n      options: children,\n    });\n  });\n\n  return options;\n}\n\nexport async function getNewGroupByPartOptions(\n  query: InfluxQuery,\n  getTagKeys: () => Promise<string[]>\n): Promise<Array<SelectableValue<string>>> {\n  const tagKeys = await getTagKeys();\n  const queryCopy = { ...query }; // the query-model mutates the query\n  const model = new InfluxQueryModel(queryCopy);\n  const options: Array<SelectableValue<string>> = [];\n  if (!model.hasFill()) {\n    options.push(toSelectableValue('fill(null)'));\n  }\n  if (!model.hasGroupByTime()) {\n    options.push(toSelectableValue('time($interval)'));\n  }\n  tagKeys.forEach((key) => {\n    options.push(toSelectableValue(`tag(${key})`));\n  });\n  return options;\n}\n\ntype Part = {\n  name: string;\n  params: PartParams;\n};\n\nfunction getPartParams(part: InfluxQueryPart, dynamicParamOptions: Map<string, () => Promise<string[]>>): PartParams {\n  // NOTE: the way the system is constructed,\n  // there always can only be one possible dynamic-lookup\n  // field. in case of select it is the field,\n  // in case of group-by it is the tag\n  const def = queryPart.create(part).def;\n\n  // we switch the numbers to strings, it will work that way too,\n  // and it makes the code simpler\n  const paramValues = (part.params ?? []).map((p) => p.toString());\n\n  if (paramValues.length !== def.params.length) {\n    throw new Error('Invalid query-segment');\n  }\n\n  return paramValues.map((val, index) => {\n    const defParam = def.params[index];\n    if (defParam.dynamicLookup) {\n      return {\n        value: val,\n        options: unwrap(dynamicParamOptions.get(`${def.type}_${index}`)),\n      };\n    }\n\n    if (defParam.options != null) {\n      return {\n        value: val,\n        options: () => Promise.resolve(defParam.options),\n      };\n    }\n\n    return {\n      value: val,\n      options: null,\n    };\n  });\n}\n\nexport function makePartList(\n  queryParts: InfluxQueryPart[],\n  dynamicParamOptions: Map<string, () => Promise<string[]>>\n): Part[] {\n  return queryParts.map((qp) => {\n    return {\n      name: qp.type,\n      params: getPartParams(qp, dynamicParamOptions),\n    };\n  });\n}\n","import { TypedVariableModel } from '@grafana/data';\nimport { getTemplateSrv } from '@grafana/runtime';\n\nexport function getTemplateVariableOptions(wrapper: (v: TypedVariableModel) => string) {\n  return (\n    getTemplateSrv()\n      .getVariables()\n      // we make them regex-params, i'm not 100% sure why.\n      // probably because this way multi-value variables work ok too.\n      .map(wrapper)\n  );\n}\n","// helper function to make it easy to call this from the widget-render-code\nimport { TypedVariableModel } from '@grafana/data';\n\nimport { getTemplateVariableOptions } from './getTemplateVariableOptions';\n\nexport function withTemplateVariableOptions(\n  optionsPromise: Promise<string[]>,\n  wrapper: (v: TypedVariableModel) => string,\n  filter?: string\n): Promise<string[]> {\n  let templateVariableOptions = getTemplateVariableOptions(wrapper);\n  if (filter) {\n    templateVariableOptions = templateVariableOptions.filter((tvo) => tvo.indexOf(filter) > -1);\n  }\n  return optionsPromise.then((options) => [...templateVariableOptions, ...options]);\n}\n","import { TypedVariableModel } from '@grafana/data';\n\nexport function wrapRegex(v: TypedVariableModel): string {\n  return `/^$${v.name}$/`;\n}\n\nexport function wrapPure(v: TypedVariableModel): string {\n  return `$${v.name}`;\n}\n","import { css } from '@emotion/css';\n\nexport const paddingRightClass = css({\n  paddingRight: '4px',\n});\n","import { cx } from '@emotion/css';\n\nimport { Select } from '@grafana/ui';\n\nimport { ResultFormat } from '../../../../../types';\nimport { RESULT_FORMATS } from '../../../constants';\nimport { unwrap } from '../utils/unwrap';\n\nimport { paddingRightClass } from './styles';\n\ntype Props = {\n  inputId?: string;\n  format: ResultFormat;\n  onChange: (newFormat: ResultFormat) => void;\n};\n\nconst className = cx('width-8', paddingRightClass);\n\nexport const FormatAsSection = ({ format, inputId, onChange }: Props): JSX.Element => {\n  return (\n    <Select<ResultFormat>\n      inputId={inputId}\n      className={className}\n      onChange={(v) => {\n        onChange(unwrap(v.value));\n      }}\n      value={format}\n      options={RESULT_FORMATS}\n    />\n  );\n};\n","import { css, cx } from '@emotion/css';\nimport debouncePromise from 'debounce-promise';\nimport { useEffect, useState } from 'react';\nimport { useAsyncFn } from 'react-use';\n\nimport { SelectableValue } from '@grafana/data';\nimport { AsyncSelect, InlineLabel, Input, Select } from '@grafana/ui';\n\nimport { useShadowedState } from '../hooks/useShadowedState';\n\n// this file is a simpler version of `grafana-ui / SegmentAsync.tsx`\n// with some changes:\n// 1. click-outside does not select the value. i think it's better to be explicit here.\n// 2. we set a min-width on the select-element to handle cases where the `value`\n//    is very short, like \"x\", and then you click on it and the select opens,\n//    and it tries to be as short as \"x\" and it does not work well.\n\n// NOTE: maybe these changes could be migrated into the SegmentAsync later\n\ntype SelVal = SelectableValue<string>;\n\n// when allowCustomValue is true, there is no way to enforce the selectableValue\n// enum-type, so i just go with `string`\n\ntype LoadOptions = (filter: string) => Promise<SelVal[]>;\n\ntype Props = {\n  value: string;\n  buttonClassName?: string;\n  loadOptions?: LoadOptions;\n  // if filterByLoadOptions is false,\n  // loadOptions is only executed once,\n  // when the select-box opens,\n  // and as you write, the list gets filtered\n  // by the select-box.\n  // if filterByLoadOptions is true,\n  // as you write the loadOptions is executed again and again,\n  // and it is relied on to filter the results.\n  filterByLoadOptions?: boolean;\n  onChange: (v: SelVal) => void;\n  allowCustomValue?: boolean;\n};\n\nconst selectClass = css({\n  minWidth: '160px',\n});\n\ntype SelProps = {\n  loadOptions: LoadOptions;\n  filterByLoadOptions?: boolean;\n  onClose: () => void;\n  onChange: (v: SelVal) => void;\n  allowCustomValue?: boolean;\n};\n\ntype SelReloadProps = {\n  loadOptions: (filter: string) => Promise<SelVal[]>;\n  onClose: () => void;\n  onChange: (v: SelVal) => void;\n  allowCustomValue?: boolean;\n};\n\n// when a custom value is written into a select-box,\n// by default the new value is prefixed with \"Create:\",\n// and that sounds confusing because here we do not create\n// anything. we change this to just be the entered string.\nconst formatCreateLabel = (v: string) => v;\n\nconst SelReload = ({ loadOptions, allowCustomValue, onChange, onClose }: SelReloadProps): JSX.Element => {\n  // here we rely on the fact that writing text into the <AsyncSelect/>\n  // does not cause a re-render of the current react component.\n  // this way there is only a single render-call,\n  // so there is only a single `debouncedLoadOptions`.\n  // if we want ot make this \"re-render safe,\n  // we will have to put the debounced call into an useRef,\n  // and probably have an useEffect\n  const debouncedLoadOptions = debouncePromise(loadOptions, 1000, { leading: true });\n  return (\n    <div className={selectClass}>\n      <AsyncSelect\n        formatCreateLabel={formatCreateLabel}\n        defaultOptions\n        autoFocus\n        isOpen\n        onCloseMenu={onClose}\n        allowCustomValue={allowCustomValue}\n        loadOptions={debouncedLoadOptions}\n        onChange={onChange}\n        createOptionPosition=\"first\"\n      />\n    </div>\n  );\n};\n\ntype SelSingleLoadProps = {\n  loadOptions: (filter: string) => Promise<SelVal[]>;\n  onClose: () => void;\n  onChange: (v: SelVal) => void;\n  allowCustomValue?: boolean;\n};\n\nconst SelSingleLoad = ({ loadOptions, allowCustomValue, onChange, onClose }: SelSingleLoadProps): JSX.Element => {\n  const [loadState, doLoad] = useAsyncFn(loadOptions, [loadOptions]);\n\n  useEffect(() => {\n    doLoad('');\n  }, [doLoad, loadOptions]);\n\n  return (\n    <div className={selectClass}>\n      <Select\n        isLoading={loadState.loading}\n        formatCreateLabel={formatCreateLabel}\n        autoFocus\n        isOpen={!loadState.loading}\n        onCloseMenu={onClose}\n        allowCustomValue={allowCustomValue}\n        options={loadState.value ?? []}\n        onChange={onChange}\n        createOptionPosition=\"first\"\n      />\n    </div>\n  );\n};\n\nconst Sel = ({ loadOptions, filterByLoadOptions, allowCustomValue, onChange, onClose }: SelProps): JSX.Element => {\n  // unfortunately <Segment/> and <SegmentAsync/> have somewhat different behavior,\n  // so the simplest approach was to just create two separate wrapper-components\n  return filterByLoadOptions ? (\n    <SelReload loadOptions={loadOptions} allowCustomValue={allowCustomValue} onChange={onChange} onClose={onClose} />\n  ) : (\n    <SelSingleLoad\n      loadOptions={loadOptions}\n      allowCustomValue={allowCustomValue}\n      onChange={onChange}\n      onClose={onClose}\n    />\n  );\n};\n\ntype InpProps = {\n  initialValue: string;\n  onChange: (newVal: string) => void;\n  onClose: () => void;\n};\n\nconst Inp = ({ initialValue, onChange, onClose }: InpProps): JSX.Element => {\n  const [currentValue, setCurrentValue] = useShadowedState(initialValue);\n\n  return (\n    <Input\n      autoFocus\n      type=\"text\"\n      spellCheck={false}\n      onBlur={onClose}\n      onKeyDown={(e) => {\n        if (e.key === 'Enter') {\n          onChange(currentValue);\n        }\n      }}\n      onChange={(e) => {\n        setCurrentValue(e.currentTarget.value);\n      }}\n      value={currentValue}\n    />\n  );\n};\n\nconst defaultButtonClass = css({\n  width: 'auto',\n  cursor: 'pointer',\n});\n\nexport const Seg = ({\n  value,\n  buttonClassName,\n  loadOptions,\n  filterByLoadOptions,\n  allowCustomValue,\n  onChange,\n}: Props): JSX.Element => {\n  const [isOpen, setOpen] = useState(false);\n  if (!isOpen) {\n    const className = cx(defaultButtonClass, buttonClassName);\n    return (\n      <InlineLabel\n        as=\"button\"\n        className={className}\n        onClick={() => {\n          setOpen(true);\n        }}\n      >\n        {value}\n      </InlineLabel>\n    );\n  } else {\n    if (loadOptions !== undefined) {\n      return (\n        <Sel\n          loadOptions={loadOptions}\n          filterByLoadOptions={filterByLoadOptions ?? false}\n          allowCustomValue={allowCustomValue}\n          onChange={(v) => {\n            setOpen(false);\n            onChange(v);\n          }}\n          onClose={() => {\n            setOpen(false);\n          }}\n        />\n      );\n    } else {\n      return (\n        <Inp\n          initialValue={value}\n          onClose={() => {\n            setOpen(false);\n          }}\n          onChange={(v) => {\n            setOpen(false);\n            onChange({ value: v, label: v });\n          }}\n        />\n      );\n    }\n  }\n};\n","import { AccessoryButton } from '@grafana/plugin-ui';\n\nimport { DEFAULT_POLICY } from '../../../../../types';\nimport { toSelectableValue } from '../utils/toSelectableValue';\n\nimport { Seg } from './Seg';\n\n// we use the value \"default\" as a magic-value, it means\n// we use the default retention-policy.\n// unfortunately, IF the user has a retention-policy named \"default\",\n// and it is not the default-retention-policy in influxdb,\n// bad things will happen.\n// https://github.com/grafana/grafana/issues/4347 :-(\n// FIXME: we could maybe at least detect here that problem-is-happening,\n// and show an error message or something.\n// unfortunately, currently the ResponseParser does not return the\n// is-default info for the retention-policies, so that should change first.\n\ntype Props = {\n  onChange: (policy: string | undefined, measurement: string | undefined) => void;\n  policy: string | undefined;\n  measurement: string | undefined;\n  getPolicyOptions: () => Promise<string[]>;\n  getMeasurementOptions: (filter: string) => Promise<string[]>;\n};\n\nexport const FromSection = ({\n  policy,\n  measurement,\n  onChange,\n  getPolicyOptions,\n  getMeasurementOptions,\n}: Props): JSX.Element => {\n  const handlePolicyLoadOptions = async () => {\n    const allPolicies = await getPolicyOptions();\n    // if `default` does not exist in the list of policies, we add it\n    const allPoliciesWithDefault = allPolicies.some((p) => p === DEFAULT_POLICY)\n      ? allPolicies\n      : [DEFAULT_POLICY, ...allPolicies];\n\n    return allPoliciesWithDefault.map(toSelectableValue);\n  };\n\n  const handleMeasurementLoadOptions = async (filter: string) => {\n    const allMeasurements = await getMeasurementOptions(filter);\n    return allMeasurements.map(toSelectableValue);\n  };\n\n  return (\n    <>\n      <Seg\n        allowCustomValue\n        value={policy ?? 'using default policy'}\n        loadOptions={handlePolicyLoadOptions}\n        onChange={(v) => {\n          onChange(v.value, measurement);\n        }}\n      />\n      <Seg\n        allowCustomValue\n        value={measurement ?? 'select measurement'}\n        loadOptions={handleMeasurementLoadOptions}\n        filterByLoadOptions\n        onChange={(v) => {\n          onChange(policy, v.value);\n        }}\n      />\n      {measurement && (\n        <AccessoryButton\n          style={{ marginRight: '4px' }}\n          aria-label=\"remove\"\n          icon=\"times\"\n          variant=\"secondary\"\n          onClick={() => {\n            onChange(policy, undefined);\n          }}\n        />\n      )}\n    </>\n  );\n};\n","import { cx } from '@emotion/css';\n\nimport { Input } from '@grafana/ui';\n\nimport { useShadowedState } from '../hooks/useShadowedState';\n\nimport { paddingRightClass } from './styles';\n\ntype Props = {\n  value: string | undefined;\n  onChange: (value: string | undefined) => void;\n  isWide?: boolean;\n  placeholder?: string;\n};\n\nexport const InputSection = ({ value, onChange, isWide, placeholder }: Props): JSX.Element => {\n  const [currentValue, setCurrentValue] = useShadowedState(value);\n\n  const onBlur = () => {\n    // we send empty-string as undefined\n    const newValue = currentValue === '' ? undefined : currentValue;\n    onChange(newValue);\n  };\n\n  return (\n    <>\n      <Input\n        placeholder={placeholder}\n        className={cx((isWide ?? false) ? 'width-14' : 'width-8', paddingRightClass)}\n        type=\"text\"\n        spellCheck={false}\n        onBlur={onBlur}\n        onChange={(e) => {\n          setCurrentValue(e.currentTarget.value);\n        }}\n        value={currentValue ?? ''}\n      />\n    </>\n  );\n};\n","import { cx } from '@emotion/css';\n\nimport { SelectableValue } from '@grafana/data';\nimport { Select } from '@grafana/ui';\n\nimport { unwrap } from '../utils/unwrap';\n\nimport { paddingRightClass } from './styles';\n\ntype Mode = 'ASC' | 'DESC';\n\nconst OPTIONS: Array<SelectableValue<Mode>> = [\n  { label: 'ascending', value: 'ASC' },\n  { label: 'descending', value: 'DESC' },\n];\n\nconst className = cx('width-9', paddingRightClass);\n\ntype Props = {\n  value: Mode;\n  onChange: (value: Mode) => void;\n  inputId?: string;\n};\n\nexport const OrderByTimeSection = ({ value, onChange, inputId }: Props): JSX.Element => {\n  return (\n    <>\n      <Select<Mode>\n        inputId={inputId}\n        className={className}\n        onChange={(v) => {\n          onChange(unwrap(v.value));\n        }}\n        value={value}\n        options={OPTIONS}\n      />\n    </>\n  );\n};\n","import { SelectableValue } from '@grafana/data';\n\nimport { unwrap } from '../utils/unwrap';\n\nimport { Seg } from './Seg';\n\ntype Props = {\n  loadOptions: () => Promise<SelectableValue[]>;\n  allowCustomValue?: boolean;\n  onAdd: (v: string) => void;\n};\n\nexport const AddButton = ({ loadOptions, allowCustomValue, onAdd }: Props): JSX.Element => {\n  return (\n    <Seg\n      value=\"+\"\n      loadOptions={loadOptions}\n      allowCustomValue={allowCustomValue}\n      onChange={(v) => {\n        onAdd(unwrap(v.value));\n      }}\n    />\n  );\n};\n","import { css, cx } from '@emotion/css';\nimport { Fragment, useMemo } from 'react';\n\nimport { GrafanaTheme2, SelectableValue } from '@grafana/data';\nimport { AccessoryButton } from '@grafana/plugin-ui';\nimport { useTheme2 } from '@grafana/ui';\n\nimport { toSelectableValue } from '../utils/toSelectableValue';\nimport { unwrap } from '../utils/unwrap';\n\nimport { AddButton } from './AddButton';\nimport { Seg } from './Seg';\n\nexport type PartParams = Array<{\n  value: string;\n  options: (() => Promise<string[]>) | null;\n}>;\n\ntype Props = {\n  parts: Array<{\n    name: string;\n    params: PartParams;\n  }>;\n  getNewPartOptions: () => Promise<SelectableValue[]>;\n  onChange: (partIndex: number, paramValues: string[]) => void;\n  onRemovePart: (index: number) => void;\n  onAddNewPart: (type: string) => void;\n};\n\nconst noRightMarginPaddingClass = css({\n  paddingRight: '0',\n  marginRight: '0',\n});\n\ntype PartProps = {\n  name: string;\n  params: PartParams;\n  onRemove: () => void;\n  onChange: (paramValues: string[]) => void;\n};\n\nconst noHorizMarginPaddingClass = css({\n  paddingLeft: '0',\n  paddingRight: '0',\n  marginLeft: '0',\n  marginRight: '0',\n});\n\nconst getPartClass = (theme: GrafanaTheme2) => {\n  return cx(\n    'gf-form-label',\n    css({\n      paddingLeft: '0',\n      // gf-form-label class makes certain css attributes incorrect\n      // for the selectbox-dropdown, so we have to \"reset\" them back\n      lineHeight: theme.typography.body.lineHeight,\n      fontSize: theme.typography.body.fontSize,\n    })\n  );\n};\n\nconst Part = ({ name, params, onChange }: PartProps): JSX.Element => {\n  const theme = useTheme2();\n  const partClass = useMemo(() => getPartClass(theme), [theme]);\n\n  const onParamChange = (par: string, i: number) => {\n    const newParams = params.map((p) => p.value);\n    newParams[i] = par;\n    onChange(newParams);\n  };\n  return (\n    <div className={partClass}>\n      <button className={cx('gf-form-label', noRightMarginPaddingClass)}>{name}</button>(\n      {params.map((p, i) => {\n        const { value, options } = p;\n        const isLast = i === params.length - 1;\n        const loadOptions =\n          options !== null ? () => options().then((items) => items.map(toSelectableValue)) : undefined;\n        return (\n          <Fragment key={i}>\n            <Seg\n              allowCustomValue\n              value={value}\n              buttonClassName={noHorizMarginPaddingClass}\n              loadOptions={loadOptions}\n              onChange={(v) => {\n                onParamChange(unwrap(v.value), i);\n              }}\n            />\n            {!isLast && ','}\n          </Fragment>\n        );\n      })}\n      )\n    </div>\n  );\n};\n\nexport const PartListSection = ({\n  parts,\n  getNewPartOptions,\n  onAddNewPart,\n  onRemovePart,\n  onChange,\n}: Props): JSX.Element => {\n  return (\n    <>\n      {parts.map((part, index) => (\n        <Fragment key={index}>\n          <Part\n            name={part.name}\n            params={part.params}\n            onRemove={() => {\n              onRemovePart(index);\n            }}\n            onChange={(pars) => {\n              onChange(index, pars);\n            }}\n          />\n          <AccessoryButton\n            style={{ marginRight: '4px' }}\n            aria-label=\"remove\"\n            icon=\"times\"\n            variant=\"secondary\"\n            onClick={() => {\n              onRemovePart(index);\n            }}\n          />\n        </Fragment>\n      ))}\n      <AddButton loadOptions={getNewPartOptions} onAdd={onAddNewPart} />\n    </>\n  );\n};\n","import { InfluxQueryTag } from '../../../../../types';\n\nfunction isRegex(text: string): boolean {\n  return /^\\/.*\\/$/.test(text);\n}\n\n// FIXME: sync these to the query-string-generation-code\n// probably it's in influx_query_model.ts\nexport function getOperator(tag: InfluxQueryTag): string {\n  return tag.operator ?? (isRegex(tag.value) ? '=~' : '=');\n}\n\n// FIXME: sync these to the query-string-generation-code\n// probably it's in influx_query_model.ts\nexport function getCondition(tag: InfluxQueryTag, isFirst: boolean): string | undefined {\n  return isFirst ? undefined : (tag.condition ?? 'AND');\n}\n\nexport function adjustOperatorIfNeeded(currentOperator: string, newTagValue: string): string {\n  const isCurrentOperatorRegex = currentOperator === '=~' || currentOperator === '!~';\n  const isNewTagValueRegex = isRegex(newTagValue);\n\n  if (isNewTagValueRegex) {\n    return isCurrentOperatorRegex ? currentOperator : '=~';\n  } else {\n    return isCurrentOperatorRegex ? '=' : currentOperator;\n  }\n}\n","import { SelectableValue } from '@grafana/data';\nimport { AccessoryButton } from '@grafana/plugin-ui';\n\nimport { InfluxQueryTag } from '../../../../../types';\nimport { adjustOperatorIfNeeded, getCondition, getOperator } from '../utils/tagUtils';\nimport { toSelectableValue } from '../utils/toSelectableValue';\n\nimport { AddButton } from './AddButton';\nimport { Seg } from './Seg';\n\ntype KnownOperator = '=' | '!=' | '<>' | '<' | '>' | '>=' | '<=' | '=~' | '!~' | 'Is' | 'Is Not';\nconst knownOperators: KnownOperator[] = ['=', '!=', '<>', '<', '>', '>=', '<=', '=~', '!~', 'Is', 'Is Not'];\n\ntype KnownCondition = 'AND' | 'OR';\nconst knownConditions: KnownCondition[] = ['AND', 'OR'];\n\nconst operatorOptions: Array<SelectableValue<KnownOperator>> = knownOperators.map(toSelectableValue);\nconst condititonOptions: Array<SelectableValue<KnownCondition>> = knownConditions.map(toSelectableValue);\n\ntype Props = {\n  tags: InfluxQueryTag[];\n  onChange: (tags: InfluxQueryTag[]) => void;\n  getTagKeyOptions: () => Promise<string[]>;\n  getTagValueOptions: (key: string) => Promise<string[]>;\n};\n\ntype TagProps = {\n  tag: InfluxQueryTag;\n  isFirst: boolean;\n  onRemove: () => void;\n  onChange: (tag: InfluxQueryTag) => void;\n  getTagKeyOptions: () => Promise<string[]>;\n  getTagValueOptions: (key: string) => Promise<string[]>;\n};\n\nconst loadConditionOptions = () => Promise.resolve(condititonOptions);\n\nconst loadOperatorOptions = () => Promise.resolve(operatorOptions);\n\nconst Tag = ({ tag, isFirst, onRemove, onChange, getTagKeyOptions, getTagValueOptions }: TagProps): JSX.Element => {\n  const operator = getOperator(tag);\n  const condition = getCondition(tag, isFirst);\n\n  const getTagKeySegmentOptions = () => {\n    return getTagKeyOptions()\n      .catch((err) => {\n        // in this UI element we add a special item to the list of options,\n        // that is used to remove the element.\n        // this causes a problem: if `getTagKeyOptions` fails with an error,\n        // the remove-filter option is never added to the list,\n        // and the UI element can not be removed.\n        // to avoid it, we catch any potential errors coming from `getTagKeyOptions`,\n        // log the error, and pretend that the list of options is an empty list.\n        // this way the remove-item option can always be added to the list.\n        console.error(err);\n        return [];\n      })\n      .then((tags) => tags.map(toSelectableValue));\n  };\n\n  const getTagValueSegmentOptions = () => {\n    return getTagValueOptions(tag.key).then((tags) => tags.map(toSelectableValue));\n  };\n\n  return (\n    <div className=\"gf-form\">\n      {condition != null && (\n        <Seg\n          value={condition}\n          loadOptions={loadConditionOptions}\n          onChange={(v) => {\n            onChange({ ...tag, condition: v.value });\n          }}\n        />\n      )}\n      <Seg\n        allowCustomValue\n        value={tag.key}\n        loadOptions={getTagKeySegmentOptions}\n        onChange={(v) => {\n          const { value } = v;\n          if (value === undefined) {\n            onRemove();\n          } else {\n            onChange({ ...tag, key: value ?? '' });\n          }\n        }}\n      />\n      <Seg\n        value={operator}\n        loadOptions={loadOperatorOptions}\n        onChange={(op) => {\n          onChange({ ...tag, operator: op.value });\n        }}\n      />\n      <Seg\n        allowCustomValue\n        value={tag.value}\n        loadOptions={getTagValueSegmentOptions}\n        onChange={(v) => {\n          const value = v.value ?? '';\n          onChange({ ...tag, value, operator: adjustOperatorIfNeeded(operator, value) });\n        }}\n      />\n      <AccessoryButton\n        style={{ marginRight: '4px' }}\n        aria-label=\"remove\"\n        icon=\"times\"\n        variant=\"secondary\"\n        onClick={() => {\n          onRemove();\n        }}\n      />\n    </div>\n  );\n};\n\nexport const TagsSection = ({ tags, onChange, getTagKeyOptions, getTagValueOptions }: Props): JSX.Element => {\n  const onTagChange = (newTag: InfluxQueryTag, index: number) => {\n    const newTags = tags.map((tag, i) => {\n      return index === i ? newTag : tag;\n    });\n    onChange(newTags);\n  };\n\n  const onTagRemove = (index: number) => {\n    const newTags = tags.filter((t, i) => i !== index);\n    onChange(newTags);\n  };\n\n  const getTagKeySegmentOptions = () => {\n    return getTagKeyOptions().then((tags) => tags.map(toSelectableValue));\n  };\n\n  const addNewTag = (tagKey: string, isFirst: boolean) => {\n    const minimalTag: InfluxQueryTag = {\n      key: tagKey,\n      value: 'select tag value',\n    };\n\n    const newTag: InfluxQueryTag = {\n      key: minimalTag.key,\n      value: minimalTag.value,\n      operator: getOperator(minimalTag),\n      condition: getCondition(minimalTag, isFirst),\n    };\n\n    onChange([...tags, newTag]);\n  };\n\n  return (\n    <>\n      {tags.map((t, i) => (\n        <Tag\n          tag={t}\n          isFirst={i === 0}\n          key={i}\n          onChange={(newT) => {\n            onTagChange(newT, i);\n          }}\n          onRemove={() => {\n            onTagRemove(i);\n          }}\n          getTagKeyOptions={getTagKeyOptions}\n          getTagValueOptions={getTagValueOptions}\n        />\n      ))}\n      <AddButton\n        allowCustomValue\n        loadOptions={getTagKeySegmentOptions}\n        onAdd={(v) => {\n          addNewTag(v, tags.length === 0);\n        }}\n      />\n    </>\n  );\n};\n","import { css } from '@emotion/css';\nimport { useId, useMemo } from 'react';\n\nimport { GrafanaTheme2 } from '@grafana/data';\nimport { InlineLabel, SegmentSection, useStyles2 } from '@grafana/ui';\n\nimport InfluxDatasource from '../../../../../datasource';\nimport {\n  getAllMeasurements,\n  getAllPolicies,\n  getFieldKeys,\n  getTagKeys,\n  getTagValues,\n} from '../../../../../influxql_metadata_query';\nimport {\n  addNewGroupByPart,\n  addNewSelectPart,\n  changeGroupByPart,\n  changeSelectPart,\n  normalizeQuery,\n  removeGroupByPart,\n  removeSelectPart,\n} from '../../../../../queryUtils';\nimport { InfluxQuery, InfluxQueryTag } from '../../../../../types';\nimport { DEFAULT_RESULT_FORMAT } from '../../../constants';\nimport { filterTags } from '../utils/filterTags';\nimport { getNewGroupByPartOptions, getNewSelectPartOptions, makePartList } from '../utils/partListUtils';\nimport { withTemplateVariableOptions } from '../utils/withTemplateVariableOptions';\nimport { wrapPure, wrapRegex } from '../utils/wrapper';\n\nimport { FormatAsSection } from './FormatAsSection';\nimport { FromSection } from './FromSection';\nimport { InputSection } from './InputSection';\nimport { OrderByTimeSection } from './OrderByTimeSection';\nimport { PartListSection } from './PartListSection';\nimport { TagsSection } from './TagsSection';\n\ntype Props = {\n  query: InfluxQuery;\n  onChange: (query: InfluxQuery) => void;\n  onRunQuery: () => void;\n  datasource: InfluxDatasource;\n};\n\nexport const VisualInfluxQLEditor = (props: Props): JSX.Element => {\n  const uniqueId = useId();\n  const formatAsId = `influxdb-qe-format-as-${uniqueId}`;\n  const orderByTimeId = `influxdb-qe-order-by${uniqueId}`;\n\n  const styles = useStyles2(getStyles);\n  const query = normalizeQuery(props.query);\n  const { datasource } = props;\n  const { measurement, policy } = query;\n\n  const allTagKeys = useMemo(async () => {\n    const tagKeys = (await getTagKeys(datasource, measurement, policy)).map((tag) => `${tag}::tag`);\n\n    const fieldKeys = (await getFieldKeys(datasource, measurement || '', policy)).map((field) => `${field}::field`);\n\n    return new Set([...tagKeys, ...fieldKeys]);\n  }, [measurement, policy, datasource]);\n\n  const selectLists = useMemo(() => {\n    const dynamicSelectPartOptions = new Map([\n      [\n        'field_0',\n        () => {\n          return measurement !== undefined ? getFieldKeys(datasource, measurement, policy) : Promise.resolve([]);\n        },\n      ],\n    ]);\n    return (query.select ?? []).map((sel) => makePartList(sel, dynamicSelectPartOptions));\n  }, [measurement, policy, query.select, datasource]);\n\n  // the following function is not complicated enough to memoize, but it's result\n  // is used in both memoized and un-memoized parts, so we have no choice\n  const getMemoizedTagKeys = useMemo(\n    () => async () => {\n      return [...(await allTagKeys)];\n    },\n    [allTagKeys]\n  );\n\n  const groupByList = useMemo(() => {\n    const dynamicGroupByPartOptions = new Map([['tag_0', getMemoizedTagKeys]]);\n\n    return makePartList(query.groupBy ?? [], dynamicGroupByPartOptions);\n  }, [getMemoizedTagKeys, query.groupBy]);\n\n  const onAppliedChange = (newQuery: InfluxQuery) => {\n    props.onChange(newQuery);\n    props.onRunQuery();\n  };\n  const handleFromSectionChange = (p: string | undefined, m: string | undefined) => {\n    onAppliedChange({\n      ...query,\n      policy: p,\n      measurement: m,\n    });\n  };\n\n  const handleTagsSectionChange = (tags: InfluxQueryTag[]) => {\n    // we set empty-arrays to undefined\n    onAppliedChange({\n      ...query,\n      tags: tags.length === 0 ? undefined : tags,\n    });\n  };\n\n  return (\n    <div>\n      <SegmentSection label=\"FROM\" fill={true}>\n        <FromSection\n          policy={policy}\n          measurement={measurement}\n          getPolicyOptions={() => withTemplateVariableOptions(getAllPolicies(datasource), wrapPure)}\n          getMeasurementOptions={(filter) =>\n            withTemplateVariableOptions(\n              allTagKeys.then((keys) =>\n                getAllMeasurements(datasource, filterTags(query.tags ?? [], keys), filter === '' ? undefined : filter)\n              ),\n              wrapRegex,\n              filter\n            )\n          }\n          onChange={handleFromSectionChange}\n        />\n        <InlineLabel width=\"auto\" className={styles.inlineLabel}>\n          WHERE\n        </InlineLabel>\n        <TagsSection\n          tags={query.tags ?? []}\n          onChange={handleTagsSectionChange}\n          getTagKeyOptions={getMemoizedTagKeys}\n          getTagValueOptions={(key) =>\n            withTemplateVariableOptions(\n              allTagKeys.then((keys) => getTagValues(datasource, filterTags(query.tags ?? [], keys), key, measurement)),\n              wrapRegex\n            )\n          }\n        />\n      </SegmentSection>\n      {selectLists.map((sel, index) => (\n        <SegmentSection key={index} label={index === 0 ? 'SELECT' : ''} fill={true}>\n          <PartListSection\n            parts={sel}\n            getNewPartOptions={() => Promise.resolve(getNewSelectPartOptions())}\n            onChange={(partIndex, newParams) => {\n              const newQuery = changeSelectPart(query, index, partIndex, newParams);\n              onAppliedChange(newQuery);\n            }}\n            onAddNewPart={(type) => {\n              onAppliedChange(addNewSelectPart(query, type, index));\n            }}\n            onRemovePart={(partIndex) => {\n              onAppliedChange(removeSelectPart(query, partIndex, index));\n            }}\n          />\n        </SegmentSection>\n      ))}\n      <SegmentSection label=\"GROUP BY\" fill={true}>\n        <PartListSection\n          parts={groupByList}\n          getNewPartOptions={() => getNewGroupByPartOptions(query, getMemoizedTagKeys)}\n          onChange={(partIndex, newParams) => {\n            const newQuery = changeGroupByPart(query, partIndex, newParams);\n            onAppliedChange(newQuery);\n          }}\n          onAddNewPart={(type) => {\n            onAppliedChange(addNewGroupByPart(query, type));\n          }}\n          onRemovePart={(partIndex) => {\n            onAppliedChange(removeGroupByPart(query, partIndex));\n          }}\n        />\n      </SegmentSection>\n      <SegmentSection label=\"TIMEZONE\" fill={true}>\n        <InputSection\n          placeholder=\"(optional)\"\n          value={query.tz}\n          onChange={(tz) => {\n            onAppliedChange({ ...query, tz });\n          }}\n        />\n        <InlineLabel htmlFor={orderByTimeId} width=\"auto\" className={styles.inlineLabel}>\n          ORDER BY TIME\n        </InlineLabel>\n        <OrderByTimeSection\n          inputId={orderByTimeId}\n          value={query.orderByTime === 'DESC' ? 'DESC' : 'ASC' /* FIXME: make this shared with influx_query_model */}\n          onChange={(v) => {\n            onAppliedChange({ ...query, orderByTime: v });\n          }}\n        />\n      </SegmentSection>\n      {/* query.fill is ignored in the query-editor, and it is deleted whenever\n          query-editor changes. the influx_query_model still handles it, but the new\n          approach seem to be to handle \"fill\" inside query.groupBy. so, if you\n          have a panel where in the json you have query.fill, it will be applied,\n          as long as you do not edit that query. */}\n      <SegmentSection label=\"LIMIT\" fill={true}>\n        <InputSection\n          placeholder=\"(optional)\"\n          value={query.limit?.toString()}\n          onChange={(limit) => {\n            onAppliedChange({ ...query, limit });\n          }}\n        />\n        <InlineLabel width=\"auto\" className={styles.inlineLabel}>\n          SLIMIT\n        </InlineLabel>\n        <InputSection\n          placeholder=\"(optional)\"\n          value={query.slimit?.toString()}\n          onChange={(slimit) => {\n            onAppliedChange({ ...query, slimit });\n          }}\n        />\n      </SegmentSection>\n      <SegmentSection htmlFor={formatAsId} label=\"FORMAT AS\" fill={true}>\n        <FormatAsSection\n          inputId={formatAsId}\n          format={query.resultFormat ?? DEFAULT_RESULT_FORMAT}\n          onChange={(format) => {\n            onAppliedChange({ ...query, resultFormat: format });\n          }}\n        />\n        {query.resultFormat !== 'table' && (\n          <>\n            <InlineLabel width=\"auto\" className={styles.inlineLabel}>\n              ALIAS\n            </InlineLabel>\n            <InputSection\n              isWide\n              placeholder=\"Naming pattern\"\n              value={query.alias}\n              onChange={(alias) => {\n                onAppliedChange({ ...query, alias });\n              }}\n            />\n          </>\n        )}\n      </SegmentSection>\n    </div>\n  );\n};\n\nfunction getStyles(theme: GrafanaTheme2) {\n  return {\n    inlineLabel: css({\n      color: theme.colors.primary.text,\n    }),\n  };\n}\n","import { css } from '@emotion/css';\n\nimport { QueryEditorProps } from '@grafana/data';\n\nimport InfluxDatasource from '../../../datasource';\nimport { buildRawQuery } from '../../../queryUtils';\nimport { InfluxOptions, InfluxQuery, InfluxVersion } from '../../../types';\n\nimport { FluxQueryEditor } from './flux/FluxQueryEditor';\nimport { FSQLEditor } from './fsql/FSQLEditor';\nimport { QueryEditorModeSwitcher } from './influxql/QueryEditorModeSwitcher';\nimport { RawInfluxQLEditor } from './influxql/code/RawInfluxQLEditor';\nimport { VisualInfluxQLEditor as VisualInfluxQLEditor } from './influxql/visual/VisualInfluxQLEditor';\n\ntype Props = QueryEditorProps<InfluxDatasource, InfluxQuery, InfluxOptions>;\n\nexport const QueryEditor = ({ query, onChange, onRunQuery, datasource }: Props) => {\n  switch (datasource.version) {\n    case InfluxVersion.Flux:\n      return (\n        <div className=\"gf-form-query-content\">\n          <FluxQueryEditor query={query} onChange={onChange} datasource={datasource} />\n        </div>\n      );\n    case InfluxVersion.SQL:\n      return <FSQLEditor datasource={datasource} query={query} onChange={onChange} onRunQuery={onRunQuery} />;\n    case InfluxVersion.InfluxQL:\n    default:\n      return (\n        <div className={css({ display: 'flex' })}>\n          <div className={css({ flexGrow: 1 })}>\n            {query.rawQuery ? (\n              <RawInfluxQLEditor query={query} onChange={onChange} onRunQuery={onRunQuery} />\n            ) : (\n              <VisualInfluxQLEditor query={query} onChange={onChange} onRunQuery={onRunQuery} datasource={datasource} />\n            )}\n          </div>\n          <QueryEditorModeSwitcher\n            isRaw={query.rawQuery ?? false}\n            onChange={(value) => {\n              onChange({ ...query, query: buildRawQuery(query), rawQuery: value });\n              onRunQuery();\n            }}\n          />\n        </div>\n      );\n  }\n};\n","import { css } from '@emotion/css';\n\nimport { GrafanaTheme2 } from '@grafana/data';\nimport { useStyles2 } from '@grafana/ui';\n\nconst CHEAT_SHEET_ITEMS = [\n  {\n    title: 'Getting started',\n    label:\n      'Start by selecting a measurement and field from the dropdown above. You can then use the tag selector to further narrow your search.',\n  },\n];\n\nexport const InfluxCheatSheet = () => {\n  const styles = useStyles2(getStyles);\n\n  return (\n    <div>\n      <h2>InfluxDB Cheat Sheet</h2>\n      {CHEAT_SHEET_ITEMS.map((item) => (\n        <div className={styles.cheatSheetItem} key={item.title}>\n          <div className={styles.cheatSheetItemTitle}>{item.title}</div>\n          {item.label}\n        </div>\n      ))}\n    </div>\n  );\n};\n\nconst getStyles = (theme: GrafanaTheme2) => ({\n  cheatSheetItem: css({\n    margin: theme.spacing(3, 0),\n  }),\n  cheatSheetItemTitle: css({\n    fontSize: theme.typography.h3.fontSize,\n  }),\n});\n","import { InfluxCheatSheet } from './InfluxCheatSheet';\n\nexport function InfluxStartPage() {\n  return <InfluxCheatSheet />;\n}\n","import { useState } from 'react';\n\nimport { QueryEditorProps } from '@grafana/data';\nimport { InlineFormLabel, Input, Stack } from '@grafana/ui';\n\nimport InfluxDatasource from '../../../datasource';\nimport { InfluxOptions, InfluxQuery } from '../../../types';\n\nexport const AnnotationEditor = (props: QueryEditorProps<InfluxDatasource, InfluxQuery, InfluxOptions>) => {\n  const { query, onChange } = props;\n  const [eventQuery, setEventQuery] = useState<string>(query.query ?? '');\n\n  const [textColumn, setTextColumn] = useState<string>(query.textColumn ?? '');\n  const [tagsColumn, setTagsColumn] = useState<string>(query.tagsColumn ?? '');\n  const [timeEndColumn, setTimeEndColumn] = useState<string>(query?.timeEndColumn ?? '');\n  const [titleColumn] = useState<string>(query?.titleColumn ?? '');\n  const updateValue = <K extends keyof InfluxQuery, V extends InfluxQuery[K]>(key: K, val: V) => {\n    onChange({\n      ...query,\n      [key]: val,\n      rawQuery: true,\n      fromAnnotations: true,\n      textEditor: true,\n    });\n  };\n  return (\n    <Stack gap={5} direction=\"column\">\n      <Stack gap={0.5} direction=\"column\">\n        <Stack gap={0}>\n          <InlineFormLabel width={12}>InfluxQL Query</InlineFormLabel>\n          <Input\n            value={eventQuery}\n            onChange={(e) => setEventQuery(e.currentTarget.value ?? '')}\n            onBlur={() => updateValue('query', eventQuery)}\n            placeholder=\"select text from events where $timeFilter limit 1000\"\n          />\n        </Stack>\n        <InlineFormLabel\n          width={12}\n          tooltip={\n            <div>\n              If your influxdb query returns more than one field you need to specify the column names below. An\n              annotation event is composed of a title, tags, and an additional text field. Optionally you can map the\n              timeEnd column for region annotation usage.\n            </div>\n          }\n        >\n          Field mappings\n        </InlineFormLabel>\n        <Stack gap={0.5} alignItems={'flex-start'} wrap={'wrap'}>\n          <Stack gap={0}>\n            <InlineFormLabel width={12}>Text</InlineFormLabel>\n            <Input\n              value={textColumn}\n              onChange={(e) => setTextColumn(e.currentTarget.value ?? '')}\n              onBlur={() => updateValue('textColumn', textColumn)}\n            />\n          </Stack>\n          <Stack gap={0}>\n            <InlineFormLabel width={12}>Tags</InlineFormLabel>\n            <Input\n              value={tagsColumn}\n              onChange={(e) => setTagsColumn(e.currentTarget.value ?? '')}\n              onBlur={() => updateValue('tagsColumn', tagsColumn)}\n            />\n          </Stack>\n\n          <Stack gap={0}>\n            <InlineFormLabel width={12}>TimeEnd</InlineFormLabel>\n            <Input\n              value={timeEndColumn}\n              onChange={(e) => setTimeEndColumn(e.currentTarget.value ?? '')}\n              onBlur={() => updateValue('timeEndColumn', timeEndColumn)}\n            />\n          </Stack>\n          <div className=\"gf-form ng-hide\">\n            <InlineFormLabel width={12}>Title</InlineFormLabel>\n            <Input defaultValue={titleColumn} />\n          </div>\n        </Stack>\n      </Stack>\n      {/*Empty div to preserve the bottom margin */}\n      <div />\n    </Stack>\n  );\n};\n","import { each, map, includes, flatten, keys } from 'lodash';\n\nimport { FieldType, QueryResultMeta, TimeSeries, TableData } from '@grafana/data';\nimport TableModel from 'app/core/TableModel';\n\nimport { InfluxQuery } from './types';\n\nexport default class InfluxSeries {\n  refId?: string;\n  series: any;\n  alias?: string;\n  annotation?: InfluxQuery;\n  meta?: QueryResultMeta;\n\n  constructor(options: {\n    series: any;\n    alias?: string;\n    annotation?: InfluxQuery;\n    meta?: QueryResultMeta;\n    refId?: string;\n  }) {\n    this.series = options.series;\n    this.alias = options.alias;\n    this.annotation = options.annotation;\n    this.meta = options.meta;\n    this.refId = options.refId;\n  }\n\n  getTimeSeries(): TimeSeries[] {\n    const output: TimeSeries[] = [];\n    let i, j;\n\n    if (this.series.length === 0) {\n      return output;\n    }\n\n    each(this.series, (series) => {\n      const columns = series.columns.length;\n      const tags = map(series.tags, (value, key) => {\n        return key + ': ' + value;\n      });\n\n      for (j = 1; j < columns; j++) {\n        let seriesName = series.name;\n        const columnName = series.columns[j];\n        if (columnName !== 'value') {\n          seriesName = seriesName + '.' + columnName;\n        }\n\n        if (this.alias) {\n          seriesName = this._getSeriesName(series, j);\n        } else if (series.tags) {\n          seriesName = seriesName + ' {' + tags.join(', ') + '}';\n        }\n\n        const datapoints = [];\n        if (series.values) {\n          for (i = 0; i < series.values.length; i++) {\n            datapoints[i] = [series.values[i][j], series.values[i][0]];\n          }\n        }\n\n        output.push({\n          title: seriesName,\n          target: seriesName,\n          datapoints: datapoints,\n          tags: series.tags,\n          meta: this.meta,\n          refId: this.refId,\n        });\n      }\n    });\n\n    return output;\n  }\n\n  _getSeriesName(series: any, index: number) {\n    const regex = /\\$(\\w+)|\\[\\[([\\s\\S]+?)\\]\\]/g;\n    const segments = series.name.split('.');\n\n    return this.alias?.replace(regex, (match, g1, g2) => {\n      const group = g1 || g2;\n      const segIndex = parseInt(group, 10);\n\n      if (group === 'm' || group === 'measurement') {\n        return series.name;\n      }\n      if (group === 'col') {\n        return series.columns[index];\n      }\n      if (!isNaN(segIndex)) {\n        return segments[segIndex] ?? match;\n      }\n      if (group.indexOf('tag_') !== 0) {\n        return match;\n      }\n\n      const tag = group.replace('tag_', '');\n      if (!series.tags) {\n        return match;\n      }\n      return series.tags[tag];\n    });\n  }\n\n  getAnnotations() {\n    const list: any[] = [];\n\n    each(this.series, (series) => {\n      let titleCol: any = null;\n      let timeCol: any = null;\n      let timeEndCol: any = null;\n      const tagsCol: string[] = [];\n      let textCol: any = null;\n\n      each(series.columns, (column, index) => {\n        if (column === 'time') {\n          timeCol = index;\n          return;\n        }\n        if (column === 'sequence_number') {\n          return;\n        }\n        if (column === this.annotation?.titleColumn) {\n          titleCol = index;\n          return;\n        }\n        if (includes((this.annotation?.tagsColumn || '').replace(' ', '').split(','), column)) {\n          tagsCol.push(index);\n          return;\n        }\n        if (column === this.annotation?.textColumn) {\n          textCol = index;\n          return;\n        }\n        if (column === this.annotation?.timeEndColumn) {\n          timeEndCol = index;\n          return;\n        }\n        // legacy case\n        if (!titleCol && textCol !== index) {\n          titleCol = index;\n        }\n      });\n\n      each(series.values, (value) => {\n        const data = {\n          annotation: this.annotation,\n          time: +new Date(value[timeCol]),\n          title: value[titleCol],\n          timeEnd: value[timeEndCol],\n          // Remove empty values, then split in different tags for comma separated values\n          tags: flatten(\n            tagsCol\n              .filter((t) => {\n                return value[t];\n              })\n              .map((t) => {\n                return value[t].split(',');\n              })\n          ),\n          text: value[textCol],\n        };\n\n        list.push(data);\n      });\n    });\n\n    return list;\n  }\n\n  getTable(): TableData {\n    const table = new TableModel();\n    let i, j;\n\n    table.refId = this.refId;\n    table.meta = this.meta;\n\n    if (this.series.length === 0) {\n      return table;\n    }\n\n    // the order is:\n    // - first the first item from the value-array (this is often (always?) the timestamp)\n    // - then all the tag-values\n    // - then the rest of the value-array\n    //\n    // we have to keep this order both in table.columns and table.rows\n\n    each(this.series, (series, seriesIndex: number) => {\n      if (seriesIndex === 0) {\n        const firstCol = series.columns[0];\n        // Check the first column's name, if it is `time`, we\n        // mark it as having the type time\n        const firstTableCol = firstCol === 'time' ? { text: 'Time', type: FieldType.time } : { text: firstCol };\n        table.columns.push(firstTableCol);\n        each(keys(series.tags), (key) => {\n          table.columns.push({ text: key });\n        });\n        for (j = 1; j < series.columns.length; j++) {\n          table.columns.push({ text: series.columns[j] });\n        }\n      }\n\n      if (series.values) {\n        for (i = 0; i < series.values.length; i++) {\n          const values = series.values[i];\n          const reordered = [values[0]];\n          if (series.tags) {\n            for (const key in series.tags) {\n              if (series.tags.hasOwnProperty(key)) {\n                reordered.push(series.tags[key]);\n              }\n            }\n          }\n          for (j = 1; j < values.length; j++) {\n            reordered.push(values[j]);\n          }\n          table.rows.push(reordered);\n        }\n      }\n    });\n\n    return table;\n  }\n}\n","import { AnnotationQuery, AnnotationSupport } from '@grafana/data';\n\nimport { InfluxQuery, InfluxQueryTag } from './types';\n\ntype LegacyAnnotation = {\n  query?: string;\n  queryType?: string;\n  fromAnnotations?: boolean;\n  tagsColumn?: string;\n  textColumn?: string;\n  timeEndColumn?: string;\n  titleColumn?: string;\n  name?: string;\n  target?: {\n    limit?: string | number | undefined;\n    matchAny?: boolean;\n    tags?: InfluxQueryTag[];\n    type?: string;\n  };\n};\n\n// this becomes the target in the migrated annotations\nconst migrateLegacyAnnotation = (json: LegacyAnnotation) => {\n  // eslint-ignore-next-line\n  const target: InfluxQuery = {\n    refId: '',\n    query: json.query ?? '',\n    queryType: 'tags',\n    fromAnnotations: true,\n    tagsColumn: json.tagsColumn ?? '',\n    textColumn: json.textColumn ?? '',\n    timeEndColumn: json.timeEndColumn ?? '',\n    titleColumn: json.titleColumn ?? '',\n    name: json.name ?? '',\n  };\n\n  // handle json target fields\n  if (json.target && json.target.limit) {\n    target.limit = json.target.limit;\n  }\n\n  if (json.target && json.target.matchAny) {\n    target.matchAny = json.target.matchAny;\n  }\n\n  if (json.target && json.target.tags) {\n    target.tags = json.target.tags;\n  }\n\n  if (json.target && json.target.type) {\n    target.type = json.target.type;\n  }\n\n  return target;\n};\n\nexport const prepareAnnotation: AnnotationSupport<InfluxQuery, AnnotationQuery<InfluxQuery>>['prepareAnnotation'] = (\n  json\n) => {\n  // make sure that any additional target fields are migrated\n  json.target = json.target && !json.target?.query ? migrateLegacyAnnotation(json) : json.target;\n\n  return json;\n};\n","import { each, flatten, groupBy, isArray } from 'lodash';\n\nimport { AnnotationEvent, DataFrame, FieldType, QueryResultMeta } from '@grafana/data';\nimport { BackendDataSourceResponse, FetchResponse, toDataQueryResponse } from '@grafana/runtime';\nimport TableModel from 'app/core/TableModel';\n\nimport { InfluxQuery } from './types';\n\nexport default class ResponseParser {\n  parse(query: string, results: { results: any }) {\n    if (!results?.results || results.results.length === 0) {\n      return [];\n    }\n\n    const influxResults = results.results[0];\n    if (!influxResults.series) {\n      return [];\n    }\n\n    const normalizedQuery = query.toLowerCase();\n    const isRetentionPolicyQuery = normalizedQuery.indexOf('show retention policies') >= 0;\n    const isValueFirst = normalizedQuery.indexOf('show field keys') >= 0 || isRetentionPolicyQuery;\n\n    const res = new Set<string>();\n    each(influxResults.series, (serie) => {\n      each(serie.values, (value) => {\n        if (isArray(value)) {\n          // In general, there are 2 possible shapes for the returned value.\n          // The first one is a two-element array,\n          // where the first element is somewhat a metadata value:\n          // the tag name for SHOW TAG VALUES queries,\n          // the time field for SELECT queries, etc.\n          // The second shape is an one-element array,\n          // that is containing an immediate value.\n          // For example, SHOW FIELD KEYS queries return such shape.\n          // Note, pre-0.11 versions return\n          // the second shape for SHOW TAG VALUES queries\n          // (while the newer versionsfirst).\n\n          if (isValueFirst) {\n            res.add(value[0].toString());\n          } else if (value[1] !== undefined) {\n            res.add(value[1].toString());\n          } else {\n            res.add(value[0].toString());\n          }\n        } else {\n          res.add(value.toString());\n        }\n      });\n    });\n\n    // NOTE: it is important to keep the order of items in the parsed output\n    // the same as it was in the influxdb-response.\n    // we use a `Set` to collect the unique-results, and `Set` iteration\n    // order is insertion-order, so this should be ok.\n    return Array.from(res).map((v) => ({ text: v }));\n  }\n\n  getTable(dfs: DataFrame[], target: InfluxQuery, meta: QueryResultMeta): TableModel {\n    let table = new TableModel();\n\n    if (dfs.length > 0) {\n      table.meta = {\n        ...meta,\n        executedQueryString: dfs[0].meta?.executedQueryString,\n      };\n\n      table.refId = target.refId;\n      table = getTableCols(dfs, table, target);\n\n      // if group by tag(s) added\n      if (dfs[0].fields[1] && dfs[0].fields[1].labels) {\n        let dfsByLabels = groupBy(dfs, (df: DataFrame) =>\n          df.fields[1].labels ? Object.values(df.fields[1].labels!) : null\n        );\n        const labels = Object.keys(dfsByLabels);\n        const dfsByLabelValues = Object.values(dfsByLabels);\n\n        for (let i = 0; i < dfsByLabelValues.length; i++) {\n          table = getTableRows(dfsByLabelValues[i], table, [...labels[i].split(',')]);\n        }\n      } else {\n        table = getTableRows(dfs, table, []);\n      }\n    }\n\n    return table;\n  }\n\n  async transformAnnotationResponse(\n    annotation: InfluxQuery,\n    data: FetchResponse<BackendDataSourceResponse>,\n    target: InfluxQuery\n  ): Promise<AnnotationEvent[]> {\n    const rsp = toDataQueryResponse(data, [target]);\n\n    if (!rsp) {\n      return [];\n    }\n\n    const table = this.getTable(rsp.data, target, {});\n    const list: AnnotationEvent[] = [];\n    let titleColIndex = 0;\n    let timeColIndex = 0;\n    let timeEndColIndex = 0;\n    let textColIndex = 0;\n    const tagsColIndexes: number[] = [];\n\n    each(table.columns, (column, index) => {\n      if (column.text.toLowerCase() === 'time') {\n        timeColIndex = index;\n        return;\n      }\n      if (column.text === annotation.titleColumn) {\n        titleColIndex = index;\n        return;\n      }\n      if (colContainsTag(column.text, annotation.tagsColumn)) {\n        tagsColIndexes.push(index);\n        return;\n      }\n      if (annotation.textColumn && column.text.includes(annotation.textColumn)) {\n        textColIndex = index;\n        return;\n      }\n      if (column.text === annotation.timeEndColumn) {\n        timeEndColIndex = index;\n        return;\n      }\n      // legacy case\n      if (!titleColIndex && textColIndex !== index) {\n        titleColIndex = index;\n      }\n    });\n\n    each(table.rows, (value) => {\n      const data = {\n        annotation: annotation,\n        time: +new Date(value[timeColIndex]),\n        title: value[titleColIndex],\n        timeEnd: value[timeEndColIndex],\n        // Remove empty values, then split in different tags for comma separated values\n        tags: flatten(\n          tagsColIndexes\n            .filter((t) => {\n              return value[t];\n            })\n            .map((t) => {\n              return value[t].split(',');\n            })\n        ),\n        text: value[textColIndex],\n      };\n\n      list.push(data);\n    });\n\n    return list;\n  }\n}\n\nfunction colContainsTag(colText: string, tagsColumn?: string): boolean {\n  const tags = (tagsColumn || '').replace(' ', '').split(',');\n  for (const tag of tags) {\n    if (tag !== '' && colText.includes(tag)) {\n      return true;\n    }\n  }\n  return false;\n}\n\nfunction getTableCols(dfs: DataFrame[], table: TableModel, target: InfluxQuery): TableModel {\n  const selectedParams = getSelectedParams(target);\n\n  dfs[0].fields.forEach((field) => {\n    // Time col\n    if (field.name.toLowerCase() === 'time') {\n      table.columns.push({ text: 'Time', type: FieldType.time });\n    }\n\n    // Group by (label) column(s)\n    else if (field.name.toLowerCase() === 'value') {\n      if (field.labels) {\n        Object.keys(field.labels).forEach((key) => {\n          table.columns.push({ text: key });\n        });\n      }\n    }\n  });\n\n  // Get cols for annotationQuery\n  if (dfs[0].refId === 'metricFindQuery') {\n    dfs.forEach((field) => {\n      if (field.name) {\n        table.columns.push({ text: field.name });\n      }\n    });\n  }\n\n  // Select (metric) column(s)\n  for (let i = 0; i < selectedParams.length; i++) {\n    table.columns.push({ text: selectedParams[i] });\n  }\n\n  // ISSUE: https://github.com/grafana/grafana/issues/63842\n  // if rawQuery and\n  // has other selected fields in the query and\n  // dfs field names are in the rawQuery but\n  // the selected params object doesn't exist in the query then\n  // add columns to the table\n  if (\n    target.rawQuery &&\n    selectedParams.length === 0 &&\n    rawQuerySelectedFieldsInDataframe(target.query, dfs) &&\n    dfs[0].refId !== 'metricFindQuery'\n  ) {\n    dfs.map((df) => {\n      if (df.name) {\n        table.columns.push({ text: df.name });\n      }\n    });\n  }\n\n  return table;\n}\n\nfunction getTableRows(dfs: DataFrame[], table: TableModel, labels: string[]): TableModel {\n  const values = dfs[0].fields[0].values;\n\n  for (let i = 0; i < values.length; i++) {\n    const time = values[i];\n    const metrics = dfs.map((df: DataFrame) => {\n      return df.fields[1] ? df.fields[1].values[i] : null;\n    });\n    if (metrics.indexOf(null) < 0) {\n      table.rows.push([time, ...labels, ...metrics]);\n    }\n  }\n  return table;\n}\n\nexport function getSelectedParams(target: InfluxQuery): string[] {\n  let allParams: string[] = [];\n  target.select?.forEach((select) => {\n    const selector = select.filter((x) => x.type !== 'field');\n    if (selector.length > 0) {\n      const aliasIfExist = selector.find((s) => s.type === 'alias');\n      if (aliasIfExist) {\n        allParams.push(aliasIfExist.params?.[0].toString() ?? '');\n      } else {\n        allParams.push(selector[0].type);\n      }\n    } else {\n      if (select[0] && select[0].params && select[0].params[0]) {\n        allParams.push(select[0].params[0].toString());\n      }\n    }\n  });\n\n  let uniqueParams: string[] = [];\n  allParams.forEach((param) => {\n    uniqueParams.push(incrementName(param, param, uniqueParams, 0));\n  });\n\n  return uniqueParams;\n}\n\nfunction incrementName(name: string, nameIncrement: string, params: string[], index: number): string {\n  if (params.indexOf(nameIncrement) > -1) {\n    index++;\n    return incrementName(name, name + '_' + index, params, index);\n  }\n  return nameIncrement;\n}\n\nfunction rawQuerySelectedFieldsInDataframe(query: string | undefined, dfs: DataFrame[]) {\n  const names: Array<string | undefined> = dfs.map((df: DataFrame) => df.name);\n\n  const colsInRawQuery = names.every((name: string | undefined) => {\n    if (name && query) {\n      // table name and field, i.e. cpu.usage_guest_nice becomes ['cpu', 'usage_guest_nice']\n      const nameParts = name.split('.');\n\n      return nameParts.every((np) => query.toLowerCase().includes(np.toLowerCase()));\n    }\n\n    return false;\n  });\n\n  const queryChecks = ['*', 'SHOW'];\n\n  const otherChecks: boolean = queryChecks.some((qc: string) => {\n    if (query) {\n      return query.toLowerCase().includes(qc.toLowerCase());\n    }\n\n    return false;\n  });\n\n  return colsInRawQuery || otherChecks;\n}\n","import { QueryEditorProps } from '@grafana/data';\nimport { InlineField, InlineFieldRow, Input, TextArea } from '@grafana/ui';\n\nimport InfluxDatasource from '../../../datasource';\nimport { InfluxOptions, InfluxQuery, InfluxVariableQuery, InfluxVersion } from '../../../types';\nimport { FluxQueryEditor } from '../query/flux/FluxQueryEditor';\n\ntype Props = QueryEditorProps<InfluxDatasource, InfluxQuery, InfluxOptions, InfluxVariableQuery>;\n\nconst refId = 'InfluxVariableQueryEditor-VariableQuery';\n\nexport const InfluxVariableEditor = ({ onChange, datasource, query }: Props) => {\n  const getVariableQuery = (q: InfluxVariableQuery | string) => {\n    // in legacy variable support query can be only a string\n    // in new variable support query can be an object and hold more information\n    // to be able to support old version we check the query here\n    if (typeof q !== 'string') {\n      return q;\n    }\n\n    return {\n      refId,\n      query: q,\n      ...(datasource.version === InfluxVersion.Flux ? { maxDataPoints: 1000 } : {}),\n    };\n  };\n\n  switch (datasource.version) {\n    case InfluxVersion.Flux:\n      return (\n        <>\n          <FluxQueryEditor\n            datasource={datasource}\n            query={getVariableQuery(query)}\n            onChange={(q) => {\n              onChange({ ...query, query: q.query ?? '' });\n            }}\n          />\n          <InlineFieldRow>\n            <InlineField\n              label=\"Max Data Points\"\n              labelWidth={20}\n              required\n              grow\n              aria-labelledby=\"flux-maxdatapoints\"\n              tooltip={<div>Upper boundary of data points will return for the variable query.</div>}\n            >\n              <Input\n                id=\"influx-sql-variable-maxdatapoints\"\n                aria-label=\"flux-maxdatapoints\"\n                type=\"number\"\n                defaultValue={query.maxDataPoints ?? 1000}\n                placeholder=\"Default is 1000\"\n                onBlur={(e) => {\n                  onChange({\n                    refId,\n                    query: query.query,\n                    maxDataPoints: Number.parseInt(e.currentTarget.value, 10),\n                  });\n                }}\n              />\n            </InlineField>\n          </InlineFieldRow>\n        </>\n      );\n    default:\n      return (\n        <InlineFieldRow>\n          <InlineField label=\"Query\" labelWidth={20} required grow aria-labelledby=\"influx-variable-query\">\n            <TextArea\n              aria-label=\"influx-variable-query\"\n              defaultValue={getVariableQuery(query).query}\n              placeholder=\"metric name or tags query\"\n              rows={1}\n              onBlur={(e) => {\n                onChange({ refId, query: e.currentTarget.value ?? '' });\n              }}\n            />\n          </InlineField>\n        </InlineFieldRow>\n      );\n  }\n};\n","import { from, Observable, of } from 'rxjs';\nimport { map } from 'rxjs/operators';\n\nimport { CustomVariableSupport, DataQueryRequest, DataQueryResponse } from '@grafana/data';\nimport { getTemplateSrv, TemplateSrv } from '@grafana/runtime';\n\nimport { InfluxVariableEditor } from './components/editor/variable/VariableQueryEditor';\nimport InfluxDatasource from './datasource';\nimport { InfluxVariableQuery } from './types';\n\nexport class InfluxVariableSupport extends CustomVariableSupport<InfluxDatasource> {\n  editor = InfluxVariableEditor;\n\n  constructor(\n    private readonly datasource: InfluxDatasource,\n    private readonly templateSrv: TemplateSrv = getTemplateSrv()\n  ) {\n    super();\n  }\n\n  query(request: DataQueryRequest<InfluxVariableQuery>): Observable<DataQueryResponse> {\n    let query: string | undefined;\n    if (typeof request.targets[0] === 'string') {\n      query = request.targets[0];\n    } else {\n      query = request.targets[0].query;\n    }\n\n    if (!query) {\n      return of({ data: [] });\n    }\n\n    const q = this.templateSrv.replace(query, request.scopedVars, this.datasource.interpolateQueryExpr);\n    const timeFilter = this.datasource.getTimeFilter({ rangeRaw: request.range.raw, timezone: request.timezone });\n    const interpolated = q.replace('$timeFilter', timeFilter);\n    const metricFindStream = from(\n      this.datasource.metricFindQuery(\n        {\n          refId: request.targets[0].refId,\n          query: interpolated,\n          maxDataPoints: request.targets[0].maxDataPoints ?? 1000,\n        },\n        { range: request.range }\n      )\n    );\n    return metricFindStream.pipe(map((results) => ({ data: results })));\n  }\n}\n","import { map as _map, cloneDeep, extend, has, isString, omit, pick, reduce } from 'lodash';\nimport { lastValueFrom, merge, Observable, of, throwError } from 'rxjs';\nimport { catchError, map } from 'rxjs/operators';\n\nimport {\n  AdHocVariableFilter,\n  AnnotationEvent,\n  DataFrame,\n  DataQueryError,\n  DataQueryRequest,\n  DataQueryResponse,\n  DataSourceGetTagKeysOptions,\n  DataSourceGetTagValuesOptions,\n  DataSourceInstanceSettings,\n  dateMath,\n  DateTime,\n  escapeRegex,\n  FieldType,\n  MetricFindValue,\n  QueryResultMeta,\n  QueryVariableModel,\n  RawTimeRange,\n  ScopedVars,\n  TIME_SERIES_TIME_FIELD_NAME,\n  TIME_SERIES_VALUE_FIELD_NAME,\n  TimeSeries,\n  toDataFrame,\n} from '@grafana/data';\nimport {\n  BackendDataSourceResponse,\n  DataSourceWithBackend,\n  FetchResponse,\n  getBackendSrv,\n  getTemplateSrv,\n  TemplateSrv,\n} from '@grafana/runtime';\nimport { QueryFormat, SQLQuery } from '@grafana/sql';\nimport config from 'app/core/config';\n\nimport { AnnotationEditor } from './components/editor/annotation/AnnotationEditor';\nimport { FluxQueryEditor } from './components/editor/query/flux/FluxQueryEditor';\nimport { BROWSER_MODE_DISABLED_MESSAGE } from './constants';\nimport { toRawSql } from './fsql/sqlUtil';\nimport InfluxQueryModel from './influx_query_model';\nimport InfluxSeries from './influx_series';\nimport { buildMetadataQuery } from './influxql_query_builder';\nimport { prepareAnnotation } from './migrations';\nimport { buildRawQuery, removeRegexWrapper } from './queryUtils';\nimport ResponseParser from './response_parser';\nimport { DEFAULT_POLICY, InfluxOptions, InfluxQuery, InfluxVariableQuery, InfluxVersion } from './types';\nimport { InfluxVariableSupport } from './variables';\n\nexport default class InfluxDatasource extends DataSourceWithBackend<InfluxQuery, InfluxOptions> {\n  type: string;\n  urls: string[];\n  username: string;\n  password: string;\n  name: string;\n  database?: string;\n  basicAuth?: string;\n  withCredentials?: boolean;\n  access: 'direct' | 'proxy';\n  responseParser: ResponseParser;\n  httpMode: string;\n  version?: InfluxVersion;\n  isProxyAccess: boolean;\n  showTagTime: string;\n\n  constructor(\n    instanceSettings: DataSourceInstanceSettings<InfluxOptions>,\n    readonly templateSrv: TemplateSrv = getTemplateSrv()\n  ) {\n    super(instanceSettings);\n\n    this.type = 'influxdb';\n    this.urls = (instanceSettings.url ?? '').split(',').map((url) => {\n      return url.trim();\n    });\n\n    this.username = instanceSettings.username ?? '';\n    this.password = instanceSettings.password ?? '';\n    this.name = instanceSettings.name;\n    this.basicAuth = instanceSettings.basicAuth;\n    this.withCredentials = instanceSettings.withCredentials;\n    this.access = instanceSettings.access;\n    const settingsData: InfluxOptions = instanceSettings.jsonData ?? {};\n    this.database = settingsData.dbName ?? instanceSettings.database;\n    this.interval = settingsData.timeInterval;\n    this.showTagTime = settingsData.showTagTime || '';\n    this.httpMode = settingsData.httpMode || 'GET';\n    this.responseParser = new ResponseParser();\n    this.version = settingsData.version ?? InfluxVersion.InfluxQL;\n    this.isProxyAccess = instanceSettings.access === 'proxy';\n    this.variables = new InfluxVariableSupport(this, this.templateSrv);\n\n    if (this.version === InfluxVersion.Flux) {\n      // When flux, use an annotation processor rather than the `annotationQuery` lifecycle\n      this.annotations = {\n        QueryEditor: FluxQueryEditor,\n      };\n    } else {\n      this.annotations = {\n        QueryEditor: AnnotationEditor,\n        prepareAnnotation,\n      };\n    }\n  }\n\n  query(request: DataQueryRequest<InfluxQuery>): Observable<DataQueryResponse> {\n    if (!this.isProxyAccess) {\n      const error = new Error(BROWSER_MODE_DISABLED_MESSAGE);\n      return throwError(() => error);\n    }\n\n    return this._query(request);\n  }\n\n  _query(request: DataQueryRequest<InfluxQuery>): Observable<DataQueryResponse> {\n    // for not-flux queries we call `this.classicQuery`, and that\n    // handles the is-hidden situation.\n    // for the flux-case, we do the filtering here\n    const filteredRequest = {\n      ...request,\n      targets: request.targets.filter((t) => t.hide !== true),\n    };\n\n    // migrate annotations\n    if (filteredRequest.targets.some((target: InfluxQuery) => target.fromAnnotations)) {\n      const streams: Array<Observable<DataQueryResponse>> = [];\n\n      for (const target of filteredRequest.targets) {\n        if (target.query) {\n          streams.push(\n            new Observable((subscriber) => {\n              this.annotationEvents(filteredRequest, target)\n                .then((events) => subscriber.next({ data: [toDataFrame(events)] }))\n                .catch((ex) => subscriber.error(new Error(ex)))\n                .finally(() => subscriber.complete());\n            })\n          );\n        }\n      }\n\n      return merge(...streams);\n    }\n\n    if (this.version === InfluxVersion.InfluxQL && !this.isMigrationToggleOnAndIsAccessProxy()) {\n      // Fallback to classic query support\n      return this.classicQuery(request);\n    }\n\n    return super.query(filteredRequest);\n  }\n\n  getQueryDisplayText(query: InfluxQuery) {\n    switch (this.version) {\n      case InfluxVersion.Flux:\n        return query.query;\n      case InfluxVersion.SQL:\n        return toRawSql(query);\n      case InfluxVersion.InfluxQL:\n        return new InfluxQueryModel(query).render(false);\n      default:\n        return '';\n    }\n  }\n\n  /**\n   * Returns false if the query should be skipped\n   */\n  filterQuery(query: InfluxQuery): boolean {\n    if (this.version === InfluxVersion.Flux) {\n      return !!query.query;\n    }\n    return true;\n  }\n\n  applyTemplateVariables(\n    query: InfluxQuery,\n    scopedVars: ScopedVars,\n    filters?: AdHocVariableFilter[]\n  ): InfluxQuery & SQLQuery {\n    const variables = scopedVars || {};\n\n    // We want to interpolate these variables on backend.\n    // The pre-calculated values are replaced with the variable strings.\n    variables.__interval = {\n      value: '$__interval',\n    };\n    variables.__interval_ms = {\n      value: '$__interval_ms',\n    };\n\n    if (this.version === InfluxVersion.Flux) {\n      return {\n        ...query,\n        query: this.templateSrv.replace(query.query ?? '', variables), // The raw query text\n      };\n    }\n\n    if (this.version === InfluxVersion.SQL || this.isMigrationToggleOnAndIsAccessProxy()) {\n      query = this.applyVariables(query, variables, filters);\n      if (query.adhocFilters?.length) {\n        query.adhocFilters = (query.adhocFilters ?? []).map((af) => {\n          const { condition, ...asTag } = af;\n          asTag.value = this.templateSrv.replace(asTag.value ?? '', variables);\n          return asTag;\n        });\n        query.tags = [...(query.tags ?? []), ...query.adhocFilters];\n      }\n    }\n\n    return query;\n  }\n\n  targetContainsTemplate(target: InfluxQuery) {\n    // for flux-mode we just take target.query,\n    // for influxql-mode we use InfluxQueryModel to create the text-representation\n    const queryText = this.version === InfluxVersion.Flux ? target.query : buildRawQuery(target);\n\n    return this.templateSrv.containsTemplate(queryText);\n  }\n\n  interpolateVariablesInQueries(\n    queries: InfluxQuery[],\n    scopedVars: ScopedVars,\n    filters?: AdHocVariableFilter[]\n  ): InfluxQuery[] {\n    if (!queries || queries.length === 0) {\n      return [];\n    }\n\n    return queries.map((query) => {\n      if (this.version === InfluxVersion.Flux) {\n        return {\n          ...query,\n          datasource: this.getRef(),\n          query: this.templateSrv.replace(\n            query.query ?? '',\n            scopedVars,\n            (value: string | string[] = [], variable: QueryVariableModel) =>\n              this.interpolateQueryExpr(value, variable, query.query)\n          ), // The raw query text\n        };\n      }\n\n      const queryWithVariables = this.applyVariables(query, scopedVars, filters);\n      if (queryWithVariables.adhocFilters?.length) {\n        queryWithVariables.adhocFilters = (queryWithVariables.adhocFilters ?? []).map((af) => {\n          const { condition, ...asTag } = af;\n          asTag.value = this.templateSrv.replace(asTag.value ?? '', scopedVars);\n          return asTag;\n        });\n        queryWithVariables.tags = [...(queryWithVariables.tags ?? []), ...queryWithVariables.adhocFilters];\n      }\n\n      return {\n        ...queryWithVariables,\n        datasource: this.getRef(),\n      };\n    });\n  }\n\n  applyVariables(query: InfluxQuery & SQLQuery, scopedVars: ScopedVars, filters?: AdHocVariableFilter[]) {\n    const expandedQuery = { ...query };\n    if (query.groupBy) {\n      expandedQuery.groupBy = query.groupBy.map((groupBy) => {\n        return {\n          ...groupBy,\n          params: groupBy.params?.map((param) => this.templateSrv.replace(param.toString(), undefined)),\n        };\n      });\n    }\n\n    if (query.select) {\n      expandedQuery.select = query.select.map((selects) => {\n        return selects.map((select) => {\n          return {\n            ...select,\n            params: select.params?.map((param) => this.templateSrv.replace(param.toString(), scopedVars)),\n          };\n        });\n      });\n    }\n\n    if (query.tags) {\n      expandedQuery.tags = query.tags.map((tag) => {\n        // Remove the regex wrapper if the operator is not a regex operator\n        if (tag.operator !== '=~' && tag.operator !== '!~') {\n          tag.value = removeRegexWrapper(tag.value);\n        }\n\n        return {\n          ...tag,\n          key: this.templateSrv.replace(tag.key, scopedVars),\n          value: this.templateSrv.replace(\n            tag.value ?? '',\n            scopedVars,\n            (value: string | string[] = [], variable: QueryVariableModel) =>\n              this.interpolateQueryExpr(value, variable, tag.value)\n          ),\n        };\n      });\n    }\n\n    return {\n      ...expandedQuery,\n      adhocFilters: filters ?? [],\n      query: this.templateSrv.replace(\n        query.query ?? '',\n        scopedVars,\n        (value: string | string[] = [], variable: QueryVariableModel) =>\n          this.interpolateQueryExpr(value, variable, query.query)\n      ), // The raw sql query text\n      rawSql: this.templateSrv.replace(\n        query.rawSql ?? '',\n        scopedVars,\n        (value: string | string[] = [], variable: QueryVariableModel) =>\n          this.interpolateQueryExpr(value, variable, query.rawSql)\n      ), // The raw sql query text\n      alias: this.templateSrv.replace(query.alias ?? '', scopedVars),\n      limit: this.templateSrv.replace(query.limit?.toString() ?? '', scopedVars),\n      measurement: this.templateSrv.replace(\n        query.measurement ?? '',\n        scopedVars,\n        (value: string | string[] = [], variable: QueryVariableModel) =>\n          this.interpolateQueryExpr(value, variable, query.measurement)\n      ),\n      policy: this.templateSrv.replace(query.policy ?? '', scopedVars),\n      slimit: this.templateSrv.replace(query.slimit?.toString() ?? '', scopedVars),\n      tz: this.templateSrv.replace(query.tz ?? '', scopedVars),\n    };\n  }\n\n  interpolateQueryExpr(value: string | string[] = [], variable: QueryVariableModel, query?: string) {\n    if (typeof value === 'string') {\n      // Check the value is a number. If not run to escape special characters\n      if (!isNaN(parseFloat(value))) {\n        return value;\n      }\n    }\n\n    // If template variable is a multi-value variable\n    // we always want to deal with special chars.\n    if (variable.multi) {\n      if (typeof value === 'string') {\n        // Check the value is a number. If not run to escape special characters\n        if (isNaN(parseFloat(value))) {\n          return escapeRegex(value);\n        }\n        return value;\n      }\n\n      // If the value is a string array first escape them then join them with pipe\n      // then put inside parenthesis.\n      return `(${value.map((v) => escapeRegex(v)).join('|')})`;\n    }\n\n    // If the variable is not a multi-value variable\n    // we want to see how it's been used. If it is used in a regex expression\n    // we escape it. Otherwise, we return it directly.\n    // The regex below searches for regexes within the query string\n    const regexMatcher = new RegExp(\n      /(\\s*(=|!)~\\s*)\\/((?![*+?])(?:[^\\r\\n\\[/\\\\]|\\\\.|\\[(?:[^\\r\\n\\]\\\\]|\\\\.)*\\])+)\\/((?:g(?:im?|mi?)?|i(?:gm?|mg?)?|m(?:gi?|ig?)?)?)/,\n      'gm'\n    );\n    // If matches are found this regex is evaluated to check if the variable is contained in the regex /^...$/ (^ and $ is optional)\n    // i.e. /^$myVar$/ or /$myVar/ or /^($myVar)$/\n    const regex = new RegExp(`\\\\/(?:\\\\^)?(.*)(\\\\$${variable.name})(.*)(?:\\\\$)?\\\\/`, 'gm');\n\n    // We need to validate the type of the query as some legacy cases can pass a query value with a different type\n    if (!query || typeof query !== 'string') {\n      return value;\n    }\n\n    const queryMatches = query.match(regexMatcher);\n    if (!queryMatches) {\n      return value;\n    }\n    for (const match of queryMatches) {\n      if (!match.match(regex)) {\n        continue;\n      }\n\n      // If the value is a string array first escape them then join them with pipe\n      // then put inside parenthesis.\n      return typeof value === 'string' ? escapeRegex(value) : `(${value.map((v) => escapeRegex(v)).join('|')})`;\n    }\n\n    return value;\n  }\n\n  async runMetadataQuery(target: InfluxQuery): Promise<MetricFindValue[]> {\n    return lastValueFrom(\n      super.query({\n        targets: [target],\n      } as DataQueryRequest)\n    ).then(this.toMetricFindValue);\n  }\n\n  async metricFindQuery(query: InfluxVariableQuery, options?: any): Promise<MetricFindValue[]> {\n    if (\n      this.version === InfluxVersion.Flux ||\n      this.version === InfluxVersion.SQL ||\n      this.isMigrationToggleOnAndIsAccessProxy()\n    ) {\n      const target: InfluxQuery & SQLQuery = {\n        refId: 'metricFindQuery',\n        query: query.query,\n        rawQuery: true,\n        ...(this.version === InfluxVersion.SQL ? { rawSql: query.query, format: QueryFormat.Table } : {}),\n      };\n      return lastValueFrom(\n        super.query({\n          ...(options ?? {}), // includes 'range'\n          maxDataPoints: query.maxDataPoints,\n          targets: [target],\n        })\n      ).then(this.toMetricFindValue);\n    }\n\n    const interpolated = this.templateSrv.replace(\n      query.query,\n      options?.scopedVars,\n      (value: string | string[] = [], variable: QueryVariableModel) =>\n        this.interpolateQueryExpr(value, variable, query.query)\n    );\n\n    return lastValueFrom(this._seriesQuery(interpolated, options)).then((resp) => {\n      return this.responseParser.parse(query.query, resp);\n    });\n  }\n\n  toMetricFindValue(rsp: DataQueryResponse): MetricFindValue[] {\n    const valueMap = new Map<string, MetricFindValue>();\n    // Create MetricFindValue object for all frames\n    rsp?.data?.forEach((frame: DataFrame) => {\n      if (frame && frame.length > 0) {\n        let field = frame.fields.find((f) => f.type === FieldType.string);\n        if (!field) {\n          field = frame.fields.find((f) => f.type !== FieldType.time);\n        }\n        if (field) {\n          field.values.forEach((v) => {\n            valueMap.set(v.toString(), { text: v.toString() });\n          });\n        }\n      }\n    });\n    return Array.from(valueMap.values());\n  }\n  // By implementing getTagKeys and getTagValues we add ad-hoc filters functionality\n  // Used in public/app/features/variables/adhoc/picker/AdHocFilterKey.tsx::fetchFilterKeys\n  getTagKeys(options?: DataSourceGetTagKeysOptions<InfluxQuery>) {\n    const query = buildMetadataQuery({\n      type: 'TAG_KEYS',\n      templateService: this.templateSrv,\n      database: this.database,\n      withTimeFilter: this.showTagTime,\n    });\n\n    return this.metricFindQuery({ refId: 'get-tag-keys', query });\n  }\n\n  getTagValues(options: DataSourceGetTagValuesOptions<InfluxQuery>) {\n    const query = buildMetadataQuery({\n      type: 'TAG_VALUES',\n      templateService: this.templateSrv,\n      database: this.database,\n      withKey: options.key,\n      withTimeFilter: this.showTagTime,\n    });\n\n    return this.metricFindQuery({ refId: 'get-tag-values', query });\n  }\n\n  /**\n   * @deprecated\n   */\n  _seriesQuery(query: string, options?: any) {\n    if (!query) {\n      return of({ results: [] });\n    }\n\n    if (options && options.range) {\n      const timeFilter = this.getTimeFilter({ rangeRaw: options.range, timezone: options.timezone });\n      query = query.replace('$timeFilter', timeFilter);\n    }\n\n    return this._influxRequest(this.httpMode, '/query', { q: query, epoch: 'ms' }, options);\n  }\n\n  /**\n   * @deprecated\n   */\n  serializeParams(params: any) {\n    if (!params) {\n      return '';\n    }\n\n    return reduce(\n      params,\n      (memo: string[], value, key) => {\n        if (value === null || value === undefined) {\n          return memo;\n        }\n        memo.push(encodeURIComponent(key) + '=' + encodeURIComponent(value));\n        return memo;\n      },\n      []\n    ).join('&');\n  }\n\n  /**\n   * @deprecated\n   */\n  _influxRequest(method: string, url: string, data: any, options?: any) {\n    const currentUrl = this.urls.shift()!;\n    this.urls.push(currentUrl);\n\n    const params: any = {};\n\n    if (this.username) {\n      params.u = this.username;\n      params.p = this.password;\n    }\n\n    if (options && options.database) {\n      params.db = options.database;\n    } else if (this.database) {\n      params.db = this.database;\n    }\n\n    if (options?.policy && options.policy !== DEFAULT_POLICY) {\n      params.rp = options.policy;\n    }\n\n    const { q } = data;\n\n    if (method === 'POST' && has(data, 'q')) {\n      // verb is POST and 'q' param is defined\n      extend(params, omit(data, ['q']));\n      data = this.serializeParams(pick(data, ['q']));\n    } else if (method === 'GET' || method === 'POST') {\n      // verb is GET, or POST without 'q' param\n      extend(params, data);\n      data = null;\n    }\n\n    const req: any = {\n      method: method,\n      url: currentUrl + url,\n      params: params,\n      data: data,\n      precision: 'ms',\n      inspect: { type: 'influxdb' },\n      paramSerializer: this.serializeParams,\n    };\n\n    req.headers = req.headers || {};\n    if (this.basicAuth || this.withCredentials) {\n      req.withCredentials = true;\n    }\n    if (this.basicAuth) {\n      req.headers.Authorization = this.basicAuth;\n    }\n\n    if (method === 'POST') {\n      req.headers['Content-type'] = 'application/x-www-form-urlencoded';\n    }\n\n    return getBackendSrv()\n      .fetch(req)\n      .pipe(\n        map((result: FetchResponse) => {\n          const { data } = result;\n          if (data) {\n            data.executedQueryString = q;\n            if (data.results) {\n              const errors = result.data.results.filter((elem: any) => elem.error);\n\n              if (errors.length > 0) {\n                throw {\n                  message: 'InfluxDB Error: ' + errors[0].error,\n                  data,\n                };\n              }\n            }\n          }\n          return data;\n        }),\n        catchError((err) => {\n          if (err.cancelled) {\n            return of(err);\n          }\n\n          return throwError(this.handleErrors(err));\n        })\n      );\n  }\n\n  /**\n   * @deprecated\n   */\n  handleErrors(err: any) {\n    const error: DataQueryError = {\n      message:\n        (err && err.status) ||\n        (err && err.message) ||\n        'Unknown error during query transaction. Please check JS console logs.',\n    };\n\n    if ((Number.isInteger(err.status) && err.status !== 0) || err.status >= 300) {\n      if (err.data && err.data.error) {\n        error.message = 'InfluxDB Error: ' + err.data.error;\n        error.data = err.data;\n        // @ts-ignore\n        error.config = err.config;\n      } else {\n        error.message = 'Network Error: ' + err.statusText + '(' + err.status + ')';\n        error.data = err.data;\n        // @ts-ignore\n        error.config = err.config;\n      }\n    }\n\n    return error;\n  }\n\n  getTimeFilter(options: { rangeRaw: RawTimeRange; timezone: string }) {\n    const from = this.getInfluxTime(options.rangeRaw.from, false, options.timezone);\n    const until = this.getInfluxTime(options.rangeRaw.to, true, options.timezone);\n\n    return 'time >= ' + from + ' and time <= ' + until;\n  }\n\n  getInfluxTime(date: DateTime | string, roundUp: boolean, timezone: string) {\n    let outPutDate;\n    if (isString(date)) {\n      if (date === 'now') {\n        return 'now()';\n      }\n\n      const parts = /^now-(\\d+)([dhms])$/.exec(date);\n      if (parts) {\n        const amount = parseInt(parts[1], 10);\n        const unit = parts[2];\n        return 'now() - ' + amount + unit;\n      }\n      outPutDate = dateMath.parse(date, roundUp, timezone);\n      if (!outPutDate) {\n        throw new Error('unable to parse date');\n      }\n      date = outPutDate;\n    }\n\n    return date.valueOf() + 'ms';\n  }\n\n  // ------------------------ Legacy Code - Before Backend Migration ---------------\n\n  isMigrationToggleOnAndIsAccessProxy() {\n    return config.featureToggles.influxdbBackendMigration && this.access === 'proxy';\n  }\n\n  /**\n   * The unchanged pre 7.1 query implementation\n   * @deprecated\n   */\n  classicQuery(options: any): Observable<DataQueryResponse> {\n    let timeFilter = this.getTimeFilter(options);\n    const scopedVars = options.scopedVars;\n    const targets = cloneDeep(options.targets);\n    const queryTargets: any[] = [];\n\n    let i, y;\n\n    let allQueries = _map(targets, (target) => {\n      if (target.hide) {\n        return '';\n      }\n\n      queryTargets.push(target);\n\n      // backward compatibility\n      scopedVars.interval = scopedVars.__interval;\n\n      return new InfluxQueryModel(target, this.templateSrv, scopedVars).render(true);\n    }).reduce((acc, current) => {\n      if (current !== '') {\n        acc += ';' + current;\n      }\n      return acc;\n    });\n\n    if (allQueries === '') {\n      return of({ data: [] });\n    }\n\n    // add global adhoc filters to timeFilter\n    const adhocFilters = options.filters;\n    const adhocFiltersFromDashboard = options.targets.flatMap((target: InfluxQuery) => target.adhocFilters ?? []);\n    if (adhocFilters?.length || adhocFiltersFromDashboard?.length) {\n      const ahFilters = adhocFilters?.length ? adhocFilters : adhocFiltersFromDashboard;\n      const tmpQuery = new InfluxQueryModel({ refId: 'A' }, this.templateSrv, scopedVars);\n      timeFilter += ' AND ' + tmpQuery.renderAdhocFilters(ahFilters);\n    }\n    // replace grafana variables\n    scopedVars.timeFilter = { value: timeFilter };\n\n    // replace templated variables\n    allQueries = this.templateSrv.replace(allQueries, scopedVars);\n\n    return this._seriesQuery(allQueries, options).pipe(\n      map((data) => {\n        if (!data || !data.results) {\n          return { data: [] };\n        }\n\n        const seriesList = [];\n        for (i = 0; i < data.results.length; i++) {\n          const result = data.results[i];\n          if (!result || !result.series) {\n            continue;\n          }\n\n          const target = queryTargets[i];\n          let alias = target.alias;\n          if (alias) {\n            alias = this.templateSrv.replace(target.alias, options.scopedVars);\n          }\n\n          const meta: QueryResultMeta = {\n            executedQueryString: data.executedQueryString,\n          };\n\n          const influxSeries = new InfluxSeries({\n            refId: target.refId,\n            series: data.results[i].series,\n            alias: alias,\n            meta,\n          });\n\n          switch (target.resultFormat) {\n            case 'logs':\n              meta.preferredVisualisationType = 'logs';\n            case 'table': {\n              seriesList.push(influxSeries.getTable());\n              break;\n            }\n            default: {\n              const timeSeries = influxSeries.getTimeSeries();\n              for (y = 0; y < timeSeries.length; y++) {\n                seriesList.push(timeSeriesToDataFrame(timeSeries[y]));\n              }\n              break;\n            }\n          }\n        }\n\n        return { data: seriesList };\n      })\n    );\n  }\n\n  async annotationEvents(options: DataQueryRequest, annotation: InfluxQuery): Promise<AnnotationEvent[]> {\n    if (this.version === InfluxVersion.Flux) {\n      return Promise.reject({\n        message: 'Flux requires the standard annotation query',\n      });\n    }\n\n    // InfluxQL puts a query string on the annotation\n    if (!annotation.query) {\n      return Promise.reject({\n        message: 'Query missing in annotation definition',\n      });\n    }\n\n    if (this.isMigrationToggleOnAndIsAccessProxy()) {\n      // We want to send our query to the backend as a raw query\n      const target: InfluxQuery = {\n        refId: 'metricFindQuery',\n        datasource: this.getRef(),\n        query: this.templateSrv.replace(\n          annotation.query,\n          undefined,\n          (value: string | string[] = [], variable: QueryVariableModel) =>\n            this.interpolateQueryExpr(value, variable, annotation.query)\n        ),\n        rawQuery: true,\n      };\n\n      return lastValueFrom(\n        getBackendSrv()\n          .fetch<BackendDataSourceResponse>({\n            url: '/api/ds/query',\n            method: 'POST',\n            headers: this.getRequestHeaders(),\n            data: {\n              from: options.range.from.valueOf().toString(),\n              to: options.range.to.valueOf().toString(),\n              queries: [target],\n            },\n            requestId: annotation.name,\n          })\n          .pipe(\n            map(\n              async (res: FetchResponse<BackendDataSourceResponse>) =>\n                await this.responseParser.transformAnnotationResponse(annotation, res, target)\n            )\n          )\n      );\n    }\n\n    const timeFilter = this.getTimeFilter({ rangeRaw: options.range.raw, timezone: options.timezone });\n    let query = annotation.query.replace('$timeFilter', timeFilter);\n    query = this.templateSrv.replace(query, undefined, (value: string | string[] = [], variable: QueryVariableModel) =>\n      this.interpolateQueryExpr(value, variable, query)\n    );\n\n    return lastValueFrom(this._seriesQuery(query, options)).then((data) => {\n      if (!data || !data.results || !data.results[0]) {\n        throw { message: 'No results in response from InfluxDB' };\n      }\n      return new InfluxSeries({\n        series: data.results[0].series,\n        annotation: annotation,\n      }).getAnnotations();\n    });\n  }\n}\n\n// we detect the field type based on the value-array\nfunction getFieldType(values: unknown[]): FieldType {\n  // the values-array may contain a lot of nulls.\n  // we need the first not-null item\n  const firstNotNull = values.find((v) => v !== null);\n\n  if (firstNotNull === undefined) {\n    // we could not find any not-null values\n    return FieldType.number;\n  }\n\n  const valueType = typeof firstNotNull;\n\n  switch (valueType) {\n    case 'string':\n      return FieldType.string;\n    case 'boolean':\n      return FieldType.boolean;\n    case 'number':\n      return FieldType.number;\n    default:\n      // this should never happen, influxql values\n      // can only be numbers, strings and booleans.\n      throw new Error(`InfluxQL: invalid value type ${valueType}`);\n  }\n}\n\n// this conversion function is specialized to work with the timeseries\n// data returned by InfluxDatasource.getTimeSeries()\nfunction timeSeriesToDataFrame(timeSeries: TimeSeries): DataFrame {\n  const times: number[] = [];\n  const values: unknown[] = [];\n\n  // the data we process here is not correctly typed.\n  // the typescript types say every data-point is number|null,\n  // but in fact it can be string or boolean too.\n\n  const points = timeSeries.datapoints;\n  for (const point of points) {\n    values.push(point[0]);\n    times.push(point[1] as number);\n  }\n\n  const timeField = {\n    name: TIME_SERIES_TIME_FIELD_NAME,\n    type: FieldType.time,\n    config: {},\n    values: times,\n  };\n\n  const valueField = {\n    name: TIME_SERIES_VALUE_FIELD_NAME,\n    type: getFieldType(values),\n    config: {\n      displayNameFromDS: timeSeries.title,\n    },\n    values: values,\n    labels: timeSeries.tags,\n  };\n\n  const fields = [timeField, valueField];\n\n  return {\n    name: timeSeries.target,\n    refId: timeSeries.refId,\n    meta: timeSeries.meta,\n    fields,\n    length: values.length,\n  };\n}\n","import { DataSourcePlugin } from '@grafana/data';\nimport { config } from '@grafana/runtime';\n\nimport { ConfigEditor as ConfigEditorV1 } from './components/editor/config/ConfigEditor';\nimport { ConfigEditor as ConfigEditorV2 } from './components/editor/config-v2/ConfigEditor';\nimport { QueryEditor } from './components/editor/query/QueryEditor';\nimport { InfluxStartPage } from './components/editor/query/influxql/InfluxStartPage';\nimport InfluxDatasource from './datasource';\n\n// ConfigEditorV2 is the new design for the InfluxDB configuration page\nconst configEditor = config.featureToggles.newInfluxDSConfigPageDesign ? ConfigEditorV2 : ConfigEditorV1;\n\nexport const plugin = new DataSourcePlugin(InfluxDatasource)\n  .setConfigEditor(configEditor)\n  .setQueryEditor(QueryEditor)\n  .setQueryEditorHelp(InfluxStartPage);\n","import 'react';\n\nvar AuthMethod = /* @__PURE__ */ ((AuthMethod2) => {\n  AuthMethod2[\"NoAuth\"] = \"NoAuth\";\n  AuthMethod2[\"BasicAuth\"] = \"BasicAuth\";\n  AuthMethod2[\"OAuthForward\"] = \"OAuthForward\";\n  AuthMethod2[\"CrossSiteCredentials\"] = \"CrossSiteCredentials\";\n  return AuthMethod2;\n})(AuthMethod || {});\n\nexport { AuthMethod };\n//# sourceMappingURL=types.js.map\n","import 'react';\nimport '@emotion/css';\nimport { AuthMethod } from './types.js';\nimport './auth-method/AuthMethodSettings.js';\nimport '@grafana/ui';\nimport '@grafana/data';\n\nconst headerNamePrefix = \"httpHeaderName\";\nconst headerValuePrefix = \"httpHeaderValue\";\nfunction convertLegacyAuthProps({\n  config,\n  onChange\n}) {\n  const props = {\n    selectedMethod: getSelectedMethod(config),\n    onAuthMethodSelect: getOnAuthMethodSelectHandler(config, onChange),\n    basicAuth: getBasicAuthProps(config, onChange),\n    TLS: getTLSProps(config, onChange),\n    customHeaders: getCustomHeaders(config, onChange),\n    readOnly: config.readOnly\n  };\n  return props;\n}\nfunction getSelectedMethod(config) {\n  if (config.basicAuth) {\n    return AuthMethod.BasicAuth;\n  }\n  if (config.withCredentials) {\n    return AuthMethod.CrossSiteCredentials;\n  }\n  if (config.jsonData.oauthPassThru) {\n    return AuthMethod.OAuthForward;\n  }\n  return AuthMethod.NoAuth;\n}\nfunction getOnAuthMethodSelectHandler(config, onChange) {\n  return (method) => {\n    onChange({\n      ...config,\n      basicAuth: method === AuthMethod.BasicAuth,\n      withCredentials: method === AuthMethod.CrossSiteCredentials,\n      jsonData: {\n        ...config.jsonData,\n        oauthPassThru: method === AuthMethod.OAuthForward\n      }\n    });\n  };\n}\nfunction getBasicAuthProps(config, onChange) {\n  return {\n    user: config.basicAuthUser,\n    passwordConfigured: config.secureJsonFields.basicAuthPassword,\n    onUserChange: (user) => onChange({ ...config, basicAuthUser: user }),\n    onPasswordChange: (password) => onChange({\n      ...config,\n      secureJsonData: {\n        ...config.secureJsonData,\n        basicAuthPassword: password\n      }\n    }),\n    onPasswordReset: () => onChange({\n      ...config,\n      secureJsonData: { ...config.secureJsonData, basicAuthPassword: \"\" },\n      secureJsonFields: {\n        ...config.secureJsonFields,\n        basicAuthPassword: false\n      }\n    })\n  };\n}\nfunction getTLSProps(config, onChange) {\n  var _a, _b, _c;\n  return {\n    selfSignedCertificate: {\n      enabled: Boolean(config.jsonData.tlsAuthWithCACert),\n      certificateConfigured: !!((_a = config.secureJsonFields) == null ? undefined : _a.tlsCACert),\n      onToggle: (enabled) => enabled ? onChange({\n        ...config,\n        jsonData: { ...config.jsonData, tlsAuthWithCACert: enabled }\n      }) : onChange({\n        ...config,\n        jsonData: { ...config.jsonData, tlsAuthWithCACert: enabled },\n        secureJsonData: { ...config.secureJsonData, tlsCACert: \"\" },\n        secureJsonFields: { ...config.secureJsonFields, tlsCACert: false }\n      }),\n      onCertificateChange: (certificate) => onChange({\n        ...config,\n        secureJsonData: { ...config.secureJsonData, tlsCACert: certificate }\n      }),\n      onCertificateReset: () => onChange({\n        ...config,\n        secureJsonData: { ...config.secureJsonData, tlsCACert: \"\" },\n        secureJsonFields: { ...config.secureJsonFields, tlsCACert: false }\n      })\n    },\n    TLSClientAuth: {\n      enabled: config.jsonData.tlsAuth,\n      serverName: config.jsonData.serverName,\n      clientCertificateConfigured: !!((_b = config.secureJsonFields) == null ? undefined : _b.tlsClientCert),\n      clientKeyConfigured: !!((_c = config.secureJsonFields) == null ? undefined : _c.tlsClientKey),\n      onToggle: (enabled) => enabled ? onChange({\n        ...config,\n        jsonData: { ...config.jsonData, tlsAuth: enabled }\n      }) : onChange({\n        ...config,\n        jsonData: { ...config.jsonData, tlsAuth: enabled, serverName: \"\" },\n        secureJsonData: { ...config.secureJsonData, tlsClientCert: \"\", tlsClientKey: \"\" },\n        secureJsonFields: { ...config.secureJsonFields, tlsClientCert: false, tlsClientKey: false }\n      }),\n      onServerNameChange: (serverName) => onChange({\n        ...config,\n        jsonData: { ...config.jsonData, serverName }\n      }),\n      onClientCertificateChange: (clientCertificate) => onChange({\n        ...config,\n        secureJsonData: {\n          ...config.secureJsonData,\n          tlsClientCert: clientCertificate\n        }\n      }),\n      onClientCertificateReset: () => onChange({\n        ...config,\n        secureJsonData: {\n          ...config.secureJsonData,\n          tlsClientCert: \"\"\n        },\n        secureJsonFields: {\n          ...config.secureJsonFields,\n          tlsClientCert: false\n        }\n      }),\n      onClientKeyChange: (clientKey) => onChange({\n        ...config,\n        secureJsonData: {\n          ...config.secureJsonData,\n          tlsClientKey: clientKey\n        }\n      }),\n      onClientKeyReset: () => onChange({\n        ...config,\n        secureJsonData: {\n          ...config.secureJsonData,\n          tlsClientKey: \"\"\n        },\n        secureJsonFields: {\n          ...config.secureJsonFields,\n          tlsClientKey: false\n        }\n      })\n    },\n    skipTLSVerification: {\n      enabled: config.jsonData.tlsSkipVerify,\n      onToggle: (enabled) => onChange({\n        ...config,\n        jsonData: { ...config.jsonData, tlsSkipVerify: enabled }\n      })\n    }\n  };\n}\nfunction getCustomHeaders(config, onChange) {\n  const headers = Object.keys(config.jsonData).filter((key) => key.startsWith(headerNamePrefix)).sort().map((key) => {\n    var _a;\n    const index = key.slice(headerNamePrefix.length);\n    return {\n      name: config.jsonData[key],\n      configured: (_a = config.secureJsonFields[`${headerValuePrefix}${index}`]) != null ? _a : false\n    };\n  });\n  return {\n    headers,\n    onChange: (headers2) => {\n      const newJsonData = Object.fromEntries(\n        Object.entries(config.jsonData).filter(([key]) => !key.startsWith(headerNamePrefix))\n      );\n      const newSecureJsonData = Object.fromEntries(\n        Object.entries(config.secureJsonData || {}).filter(([key]) => !key.startsWith(headerValuePrefix))\n      );\n      const newSecureJsonFields = Object.fromEntries(\n        Object.entries(config.secureJsonFields).filter(([key]) => !key.startsWith(headerValuePrefix))\n      );\n      headers2.forEach((header, index) => {\n        newJsonData[`${headerNamePrefix}${index + 1}`] = header.name;\n        if (header.configured) {\n          newSecureJsonFields[`${headerValuePrefix}${index + 1}`] = true;\n        } else {\n          newSecureJsonData[`${headerValuePrefix}${index + 1}`] = header.value;\n        }\n      });\n      onChange({\n        ...config,\n        jsonData: newJsonData,\n        secureJsonData: newSecureJsonData,\n        secureJsonFields: newSecureJsonFields\n      });\n    }\n  };\n}\n\nexport { convertLegacyAuthProps, getBasicAuthProps, getCustomHeaders, getOnAuthMethodSelectHandler, getSelectedMethod, getTLSProps };\n//# sourceMappingURL=utils.js.map\n"],"names":["AccessoryButton","className","props","styles","getButtonStyles","theme","BROWSER_MODE_DISABLED_MESSAGE","DEFAULT_POLICY","InfluxVersion","WIDTH_SHORT","trackInfluxDBConfigV1QueryLanguageSelection","trackInfluxDBConfigV1FluxOrgInputField","trackInfluxDBConfigV1FluxTokenInputField","trackInfluxDBConfigV1FluxDefaultBucketInputField","trackInfluxDBConfigV1InfluxQLDatabaseInputField","trackInfluxDBConfigV1InfluxQLUserInputField","trackInfluxDBConfigV1InfluxQLPasswordInputField","trackInfluxDBConfigV1SQLDatabaseInputField","trackInfluxDBConfigV1SQLTokenInputField","InfluxFluxConfig","jsonData","secureJsonData","secureJsonFields","htmlPrefix","InlineFieldRow","InlineField","Input","SecretInput","httpModes","InfluxInfluxQLConfig","options","onOptionsChange","database","getStyles","Alert","Field","InlineLabel","event","Select","httpMode","InfluxSqlConfig","versionMap","versions","ConfigEditor","selected","copy","user","rest","isDirectAccess","FieldSet","TextLink","DataSourceHttpSettings","config","val","RADIO_BUTTON_OPTIONS","AUTH_RADIO_BUTTON_OPTIONS","CONFIG_SECTION_HEADERS","selectors","CONFIG_SECTION_HEADERS_WITH_PDC","HTTP_MODES","getInlineLabelStyles","transparent","width","DB_SETTINGS_LABEL_WIDTH","CONTAINER_MIN_WIDTH","trackInfluxDBConfigV2FeedbackButtonClicked","trackInfluxDBConfigV2URLInputField","trackInfluxDBConfigV2QueryLanguageSelected","trackInfluxDBConfigV2ProductSelected","trackInfluxDBConfigV2FluxDBDetailsOrgInputField","trackInfluxDBConfigV2FluxDBDetailsDefaultBucketInputField","trackInfluxDBConfigV2FluxDBDetailsTokenInputField","trackInfluxDBConfigV2InfluxQLDBDetailsDatabaseInputField","trackInfluxDBConfigV2InfluxQLDBDetailsUserInputField","trackInfluxDBConfigV2InfluxQLDBDetailsPasswordInputField","trackInfluxDBConfigV2SQLDBDetailsDatabaseInputField","trackInfluxDBConfigV2SQLDBDetailsTokenInputField","trackInfluxDBConfigV2AdvancedDbConnectionSettingsToggleClicked","trackInfluxDBConfigV2AdvancedDbConnectionSettingsHTTPMethodClicked","trackInfluxDBConfigV2AdvancedDbConnectionSettingsInsecureConnectClicked","trackInfluxDBConfigV2AdvancedDbConnectionSettingsMinTimeClicked","trackInfluxDBConfigV2AdvancedDbConnectionSettingsAutocompleteClicked","trackInfluxDBConfigV2AdvancedDbConnectionSettingsMaxSeriesClicked","trackInfluxDBConfigV2AdvancedHTTPSettingsToggleClicked","trackInfluxDBConfigV2AdvancedHTTPSettingsTimeoutField","trackInfluxDBConfigV2AuthSettingsToggleClicked","trackInfluxDBConfigV2AuthSettingsAuthMethodSelected","AdvancedDbConnectionSettings","maxSeriesValue","setMaxSeriesValue","advancedDbConnectionSettingsIsOpen","setAdvancedDbConnectionSettingsIsOpen","onMaxSeriesChange","e","Space","Combobox","InfluxFluxDBConnection","InfluxInfluxQLDBConnection","InfluxSQLDBConnection","DatabaseConnectionSection","Box","CollapsableSection","Text","LeftSideBar","pdcInjected","headers","Stack","header","index","target","AdvancedHttpSettings","advancedHttpSettingsIsOpen","setAdvancedHttpSettingsIsOpen","keys","key","TagsInput","parsed","CustomHeadersSettings","AuthSettings","useWindowSize","authProps","isAuthMethod","v","authOptions","setAuthOptions","selectedMethod","authenticationSettingsIsOpen","setAuthenticationSettingsIsOpen","value","toggleOpen","prev","handleAuthMethodChange","option","toggleOption","onToggle","nextValue","next","RadioButtonGroup","Label","CertificationKey","INFLUXDB_VERSION_MAP","getQueryLanguageOptions","productName","name","UrlAndAuthenticationSection","isInfluxVersion","requiresDbrpMapping","onProductChange","onQueryLanguageChange","onUrlChange","pingInfluxForProductDetection","urlValue","base","res","product","version","err","matchUrlContains","url","pingUrl","productBuild","productVersion","pingUrlVersion","pingUrlBuild","versionMatch","buildMatch","detectProductFromUrl","categories","createPart","part","def","register","aliasRenderer","innerExpr","fieldRenderer","param","escapedParam","replaceAggregationAddStrategy","selectParts","partModel","i","morePartsAvailable","addTransformationStrategy","addMathStrategy","partCount","addAliasStrategy","addFieldStrategy","query","parts","InfluxQueryModel","templateSrv","scopedVars","g","stringParts","typePart","arg","s","modelsIndex","partIndex","type","operator","fieldName","textValue","removeRegexWrapper","lowerValue","tag","interpolate","str","r","escapedKey","policy","measurement","variable","y","selectText","conditions","groupBySection","filters","buildRawQuery","queryCopy","normalizeQuery","addNewSelectPart","model","removeSelectPart","selectModel","changeSelectPart","listIndex","newParams","newSel","addNewGroupByPart","removeGroupByPart","changeGroupByPart","newGroupBy","regex","match","samples","UnthemedFluxQueryEditor","sugs","label","editor","helpTooltip","CodeEditor","Segment","FluxQueryEditor","mapFieldsToTypes","columns","fields","col","mapColumnTypeToIcon","unquoteIdentifier","quoteLiteral","toRawSql","sql","table","rawQuery","sc","c","p","formatTableName","wherePattern","whereString","groupBy","isLimit","parameter","limit","quoteIdentifierIfNecessary","isValidIdentifier","identifier","isValidName","RESERVED_WORDS","buildTableQuery","dataset","quoteIdentAsLiteral","showDatabases","buildColumnQuery","dbName","buildTableConstraint","getSqlCompletionProvider","getMeta","monaco","language","customStatementPlacementProvider","customSuggestionKinds","customStatementPlacement","customSuggestionKind","FROMKEYWORD","currentToken","previousKeyword","previousNonWhiteSpace","t","ctx","databaseName","getDatabaseName","mapToSuggestion","databaseToken","getDatabaseToken","tableName","getTableName","tableDefinition","token","getFromKeywordToken","nextIdentifier","FlightSQLDatasource","instanceSettings","fns","columnParam","intervalParam","fn","args","tableNames","interpolatedTable","queryString","f","defaultDB","d","range","UnthemedSQLQueryEditor","influxDatasource","defaultQuery","onRunQuery","onChange","onRunSQLQuery","onSQLChange","FSQLEditor","QueryEditorModeSwitcher","isRaw","isModalOpen","setModalOpen","Button","ConfirmModal","RESULT_FORMATS","DEFAULT_RESULT_FORMAT","useShadowedState","outsideVal","currentVal","setCurrentVal","prevOutsideVal","usePrevious","RawInfluxQLEditor","currentQuery","setCurrentQuery","currentAlias","setCurrentAlias","aliasElementId","selectElementId","resultFormat","applyDelayedChangesAndRunQuery","TextArea","buildMetadataQuery","params","templateService","retentionPolicy","tags","withKey","withMeasurementFilter","withTimeFilter","keyIdentifier","whereConditions","memo","renderTagCondition","shouldUseTime","isValidTimeFilter","normalizedValue","validUnits","pattern","usedUnits","totalLength","fullMatch","numberPart","unit","runExploreQuery","datasource","getAllPolicies","item","getAllMeasurements","getTagKeys","getTagValues","getFieldKeys","filterTags","allTagKeys","toSelectableValue","unwrap","getNewSelectPartOptions","children","x","getNewGroupByPartOptions","tagKeys","getPartParams","dynamicParamOptions","paramValues","defParam","makePartList","queryParts","qp","getTemplateVariableOptions","wrapper","withTemplateVariableOptions","optionsPromise","filter","templateVariableOptions","tvo","wrapRegex","wrapPure","paddingRightClass","FormatAsSection","format","inputId","selectClass","formatCreateLabel","SelReload","loadOptions","allowCustomValue","onClose","debouncedLoadOptions","SelSingleLoad","loadState","doLoad","useAsyncFn","Sel","filterByLoadOptions","Inp","initialValue","currentValue","setCurrentValue","defaultButtonClass","Seg","buttonClassName","isOpen","setOpen","FromSection","getPolicyOptions","getMeasurementOptions","handlePolicyLoadOptions","allPolicies","handleMeasurementLoadOptions","InputSection","isWide","placeholder","onBlur","OPTIONS","OrderByTimeSection","AddButton","onAdd","noRightMarginPaddingClass","noHorizMarginPaddingClass","getPartClass","Part","partClass","onParamChange","par","isLast","items","Fragment","PartListSection","getNewPartOptions","onAddNewPart","onRemovePart","pars","isRegex","text","getOperator","getCondition","isFirst","adjustOperatorIfNeeded","currentOperator","newTagValue","isCurrentOperatorRegex","knownOperators","knownConditions","operatorOptions","condititonOptions","loadConditionOptions","loadOperatorOptions","Tag","onRemove","getTagKeyOptions","getTagValueOptions","condition","getTagKeySegmentOptions","getTagValueSegmentOptions","op","TagsSection","onTagChange","newTag","newTags","onTagRemove","addNewTag","tagKey","minimalTag","newT","VisualInfluxQLEditor","uniqueId","formatAsId","orderByTimeId","fieldKeys","field","selectLists","dynamicSelectPartOptions","sel","getMemoizedTagKeys","groupByList","dynamicGroupByPartOptions","onAppliedChange","newQuery","handleFromSectionChange","m","handleTagsSectionChange","SegmentSection","tz","slimit","alias","QueryEditor","CHEAT_SHEET_ITEMS","InfluxCheatSheet","InfluxStartPage","AnnotationEditor","eventQuery","setEventQuery","textColumn","setTextColumn","tagsColumn","setTagsColumn","timeEndColumn","setTimeEndColumn","titleColumn","updateValue","InfluxSeries","output","j","series","seriesName","columnName","datapoints","segments","g1","g2","group","segIndex","list","titleCol","timeCol","timeEndCol","tagsCol","textCol","column","data","TableModel","seriesIndex","firstCol","firstTableCol","values","reordered","migrateLegacyAnnotation","json","prepareAnnotation","ResponseParser","results","influxResults","normalizedQuery","isRetentionPolicyQuery","isValueFirst","serie","dfs","meta","getTableCols","dfsByLabels","df","labels","dfsByLabelValues","getTableRows","annotation","rsp","titleColIndex","timeColIndex","timeEndColIndex","textColIndex","tagsColIndexes","colContainsTag","colText","selectedParams","getSelectedParams","rawQuerySelectedFieldsInDataframe","time","metrics","allParams","select","selector","aliasIfExist","uniqueParams","incrementName","nameIncrement","colsInRawQuery","np","otherChecks","qc","refId","InfluxVariableEditor","getVariableQuery","q","InfluxVariableSupport","request","of","timeFilter","interpolated","from","map","InfluxDatasource","DataSourceWithBackend","settingsData","error","throwError","filteredRequest","streams","Observable","subscriber","events","ex","merge","variables","af","asTag","queryText","queries","queryWithVariables","expandedQuery","selects","regexMatcher","queryMatches","lastValueFrom","resp","valueMap","frame","method","currentUrl","req","result","errors","elem","catchError","until","date","roundUp","timezone","outPutDate","amount","targets","queryTargets","allQueries","acc","current","adhocFilters","adhocFiltersFromDashboard","ahFilters","tmpQuery","seriesList","influxSeries","timeSeries","timeSeriesToDataFrame","getFieldType","firstNotNull","valueType","times","points","point","timeField","valueField","configEditor","AuthMethod","AuthMethod2","headerNamePrefix","headerValuePrefix","convertLegacyAuthProps","getSelectedMethod","getOnAuthMethodSelectHandler","getBasicAuthProps","getTLSProps","getCustomHeaders","password","_a","_b","_c","enabled","certificate","serverName","clientCertificate","clientKey","headers2","newJsonData","newSecureJsonData","newSecureJsonFields"],"sourceRoot":""}