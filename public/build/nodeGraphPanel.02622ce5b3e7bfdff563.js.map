{"version":3,"file":"nodeGraphPanel.02622ce5b3e7bfdff563.js","mappings":"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","sources":["webpack://grafana/./public/app/plugins/panel/nodeGraph/NodeGraphPanel.tsx","webpack://grafana/./public/app/plugins/panel/nodeGraph/editor/ArcOptionsEditor.tsx","webpack://grafana/./public/app/plugins/panel/nodeGraph/suggestions.ts","webpack://grafana/./public/app/plugins/panel/nodeGraph/module.tsx"],"sourcesContent":["import memoizeOne from 'memoize-one';\nimport { useId } from 'react';\n\nimport { PanelProps } from '@grafana/data';\nimport { Trans } from '@grafana/i18n';\n\nimport { useLinks } from '../../../features/explore/utils/links';\n\nimport { NodeGraph } from './NodeGraph';\nimport { Options as NodeGraphOptions } from './panelcfg.gen';\nimport { getNodeGraphDataFrames } from './utils';\n\nexport const NodeGraphPanel = ({ width, height, data, options }: PanelProps<NodeGraphOptions>) => {\n  const getLinks = useLinks(data.timeRange);\n  const panelId = useId();\n\n  if (!data || !data.series.length) {\n    return (\n      <div className=\"panel-empty\">\n        <p>\n          <Trans i18nKey=\"nodeGraph.node-graph-panel.no-data-found-in-response\">No data found in response</Trans>\n        </p>\n      </div>\n    );\n  }\n\n  const memoizedGetNodeGraphDataFrames = memoizeOne(getNodeGraphDataFrames);\n  return (\n    <div style={{ width, height }}>\n      <NodeGraph\n        dataFrames={memoizedGetNodeGraphDataFrames(data.series, options)}\n        getLinks={getLinks}\n        panelId={panelId}\n        zoomMode={options.zoomMode}\n        layoutAlgorithm={options.layoutAlgorithm}\n      />\n    </div>\n  );\n};\n","import { css } from '@emotion/css';\n\nimport { Field, GrafanaTheme2, StandardEditorProps } from '@grafana/data';\nimport { Trans, t } from '@grafana/i18n';\nimport { Button, ColorPicker, useStyles2 } from '@grafana/ui';\nimport { FieldNamePicker } from '@grafana/ui/internal';\n\nimport { ArcOption, NodeGraphOptions } from '../types';\n\ntype Settings = { filter: (field: Field) => boolean };\ntype ArcOptionsEditorProps = StandardEditorProps<ArcOption[], Settings, NodeGraphOptions, undefined>;\n\nexport const ArcOptionsEditor = ({ value, onChange, context }: ArcOptionsEditorProps) => {\n  const styles = useStyles2(getStyles);\n\n  const addArc = () => {\n    const newArc = { field: '', color: '' };\n    onChange(value ? [...value, newArc] : [newArc]);\n  };\n\n  const removeArc = (idx: number) => {\n    const copy = value?.slice();\n    copy.splice(idx, 1);\n    onChange(copy);\n  };\n\n  const updateField = <K extends keyof ArcOption>(idx: number, field: K, newValue: ArcOption[K]) => {\n    let arcs = value?.slice() ?? [];\n    arcs[idx][field] = newValue;\n    onChange(arcs);\n  };\n\n  return (\n    <>\n      {value?.map((arc, i) => {\n        return (\n          <div className={styles.section} key={i}>\n            <FieldNamePicker\n              context={context}\n              value={arc.field ?? ''}\n              onChange={(val) => {\n                updateField(i, 'field', val);\n              }}\n              item={{\n                settings: {\n                  filter: (field: Field) => field.name.includes('arc__'),\n                },\n                id: `arc-field-${i}`,\n                name: `arc-field-${i}`,\n              }}\n            />\n            <ColorPicker\n              color={arc.color || '#808080'}\n              onChange={(val) => {\n                updateField(i, 'color', val);\n              }}\n            />\n            <Button\n              size=\"sm\"\n              icon=\"minus\"\n              variant=\"secondary\"\n              onClick={() => removeArc(i)}\n              aria-label={t('nodeGraph.arc-options-editor.title-remove-arc', 'Remove arc')}\n            />\n          </div>\n        );\n      })}\n      <Button size={'sm'} icon=\"plus\" onClick={addArc} variant=\"secondary\">\n        <Trans i18nKey=\"nodeGraph.arc-options-editor.add-arc\">Add arc</Trans>\n      </Button>\n    </>\n  );\n};\n\nconst getStyles = (theme: GrafanaTheme2) => {\n  return {\n    section: css({\n      display: 'flex',\n      alignItems: 'center',\n      justifyContent: 'space-between',\n      gap: `0 ${theme.spacing(1)}`,\n      marginBottom: theme.spacing(1),\n    }),\n  };\n};\n","import { DataFrame, FieldType, VisualizationSuggestionsBuilder, VisualizationSuggestionScore } from '@grafana/data';\nimport { SuggestionName } from 'app/types/suggestions';\n\nexport class NodeGraphSuggestionsSupplier {\n  getListWithDefaults(builder: VisualizationSuggestionsBuilder) {\n    return builder.getListAppender<{}, {}>({\n      name: SuggestionName.NodeGraph,\n      pluginId: 'nodeGraph',\n    });\n  }\n\n  hasCorrectFields(frames: DataFrame[]): boolean {\n    let hasNodesFrame = false;\n    let hasEdgesFrame = false;\n\n    const nodeFields: Array<[string, FieldType]> = [\n      ['id', FieldType.string],\n      ['title', FieldType.string],\n      ['mainstat', FieldType.number],\n    ];\n    const edgeFields: Array<[string, FieldType]> = [\n      ['id', FieldType.string],\n      ['source', FieldType.string],\n      ['target', FieldType.string],\n    ];\n\n    for (const frame of frames) {\n      if (this.checkFields(nodeFields, frame)) {\n        hasNodesFrame = true;\n      }\n      if (this.checkFields(edgeFields, frame)) {\n        hasEdgesFrame = true;\n      }\n    }\n\n    return hasNodesFrame && hasEdgesFrame;\n  }\n\n  checkFields(fields: Array<[string, FieldType]>, frame: DataFrame): boolean {\n    let hasCorrectFields = true;\n\n    for (const field of fields) {\n      const [name, type] = field;\n      const frameField = frame.fields.find((f) => f.name === name);\n      if (!frameField || type !== frameField.type) {\n        hasCorrectFields = false;\n        break;\n      }\n    }\n\n    return hasCorrectFields;\n  }\n\n  getSuggestionsForData(builder: VisualizationSuggestionsBuilder) {\n    if (!builder.data) {\n      return;\n    }\n\n    const hasCorrectFields = this.hasCorrectFields(builder.data.series);\n    const nodeGraphFrames = builder.data.series.filter(\n      (df) => df.meta && df.meta.preferredVisualisationType === 'nodeGraph'\n    );\n\n    if (hasCorrectFields || nodeGraphFrames.length === 2) {\n      this.getListWithDefaults(builder).append({\n        name: SuggestionName.NodeGraph,\n        score: VisualizationSuggestionScore.Best,\n      });\n    }\n  }\n}\n","import { FieldConfigProperty, PanelPlugin } from '@grafana/data';\nimport { t } from '@grafana/i18n';\n\nimport { NodeGraphPanel } from './NodeGraphPanel';\nimport { ArcOptionsEditor } from './editor/ArcOptionsEditor';\nimport { LayoutAlgorithm, Options as NodeGraphOptions } from './panelcfg.gen';\nimport { NodeGraphSuggestionsSupplier } from './suggestions';\n\nexport const plugin = new PanelPlugin<NodeGraphOptions>(NodeGraphPanel)\n  .useFieldConfig({\n    disableStandardOptions: Object.values(FieldConfigProperty).filter((v) => v !== FieldConfigProperty.Links),\n  })\n  .setPanelOptions((builder, context) => {\n    const category = [t('node-graph.category-node-graph', 'Node graph')];\n    builder.addSelect({\n      name: t('node-graph.name-zoom-mode', 'Zoom mode'),\n      category,\n      path: 'zoomMode',\n      defaultValue: 'cooperative',\n      settings: {\n        options: [\n          {\n            value: 'cooperative',\n            label: t('node-graph.zoom-mode-options.label-cooperative', 'Cooperative'),\n            description: t('node-graph.zoom-mode-options.description-cooperative', 'Lets you scroll the page normally'),\n          },\n          {\n            value: 'greedy',\n            label: t('node-graph.zoom-mode-options.label-greedy', 'Greedy'),\n            description: t('node-graph.zoom-mode-options.description-greedy', 'Reacts to all zoom gestures'),\n          },\n        ],\n      },\n    });\n    builder.addSelect({\n      name: t('node-graph.name-layout-algorithm', 'Layout algorithm'),\n      category,\n      path: 'layoutAlgorithm',\n      defaultValue: LayoutAlgorithm.Layered,\n      settings: {\n        options: [\n          {\n            label: t('node-graph.layout-algorithm-options.label-layered', 'Layered'),\n            value: LayoutAlgorithm.Layered,\n            description: t('node-graph.layout-algorithm-options.description-layered', 'Use a layered layout'),\n          },\n          {\n            label: t('node-graph.layout-algorithm-options.label-force', 'Force'),\n            value: LayoutAlgorithm.Force,\n            description: t('node-graph.layout-algorithm-options.description-force', 'Use a force-directed layout'),\n          },\n          {\n            label: t('node-graph.layout-algorithm-options.label-grid', 'Grid'),\n            value: LayoutAlgorithm.Grid,\n            description: t('node-graph.layout-algorithm-options.description-grid', 'Use a grid layout'),\n          },\n        ],\n      },\n    });\n    builder.addNestedOptions({\n      category: [t('node-graph.category-nodes', 'Nodes')],\n      path: 'nodes',\n      build: (builder) => {\n        builder.addUnitPicker({\n          name: t('node-graph.name-main-stat-unit', 'Main stat unit'),\n          path: 'mainStatUnit',\n        });\n        builder.addUnitPicker({\n          name: t('node-graph.name-secondary-stat-unit', 'Secondary stat unit'),\n          path: 'secondaryStatUnit',\n        });\n        builder.addCustomEditor({\n          name: t('node-graph.name-arc-sections', 'Arc sections'),\n          path: 'arcs',\n          id: 'arcs',\n          editor: ArcOptionsEditor,\n        });\n      },\n    });\n    builder.addNestedOptions({\n      category: [t('node-graph.category-edges', 'Edges')],\n      path: 'edges',\n      build: (builder) => {\n        builder.addUnitPicker({\n          name: t('node-graph.name-main-stat-unit', 'Main stat unit'),\n          path: 'mainStatUnit',\n        });\n        builder.addUnitPicker({\n          name: t('node-graph.name-secondary-stat-unit', 'Secondary stat unit'),\n          path: 'secondaryStatUnit',\n        });\n      },\n    });\n  })\n  .setSuggestionsSupplier(new NodeGraphSuggestionsSupplier());\n"],"names":["NodeGraphPanel","width","height","data","options","getLinks","panelId","memoizedGetNodeGraphDataFrames","NodeGraph","ArcOptionsEditor","value","onChange","context","styles","getStyles","addArc","newArc","removeArc","idx","copy","updateField","field","newValue","arcs","arc","FieldNamePicker","val","ColorPicker","Button","theme","NodeGraphSuggestionsSupplier","builder","frames","hasNodesFrame","hasEdgesFrame","nodeFields","edgeFields","frame","fields","hasCorrectFields","name","type","frameField","f","nodeGraphFrames","df","PanelPlugin","v","category"],"sourceRoot":""}