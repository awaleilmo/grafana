"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[4162],{1621:(K,M,n)=>{n.d(M,{g:()=>i});var a=n(74848),P=n(24619),g=n(52161),D=n(29442),m=n(45311),E=n(29609),_=n(92367),l=n(87154),r=n(78297);function i({rule:e,groupIdentifier:s,namespaceName:o,operation:c,showLocation:d=!0}){const{name:A,uid:L,labels:B,provenance:p}=e,f=D.TN.detailsPageLink(g.hY,s.namespace.uid,s.groupName),u={name:A,rulesSource:g.r6,group:s.groupName,groupUrl:f,namespace:o,href:(0,_.G)(`/alerting/grafana/${L}/view`),health:e?.health,error:e?.lastError,labels:B,isProvisioned:!!p,isPaused:e?.isPaused,application:"grafana",actions:(0,a.jsx)(r.l,{promRule:e,groupIdentifier:s,compact:!0}),querySourceUIDs:e?.queriedDatasourceUIDs};if(E.R$.grafana.alertingRule(e)){const O=e&&e.type===P.JS.Alerting?e:void 0,C=(0,m.U)(O?.totals??{});return(0,a.jsx)(l.WG,{...u,summary:e.annotations?.summary,state:O?.state,instancesCount:C,operation:c,showLocation:d})}return E.R$.grafana.recordingRule(e)?(0,a.jsx)(l.nh,{...u,showLocation:d}):(0,a.jsx)(l.Om,{ruleName:A,groupIdentifier:s,ruleDefinition:e})}},15079:(K,M,n)=>{n.d(M,{T:()=>g});var a=n(74848),P=n(70255);function g(){return(0,a.jsx)(P.A,{width:50,height:16})}},48760:(K,M,n)=>{n.d(M,{$:()=>d});var a=n(74848),P=n(22803),g=n(96540),D=n(92745),m=n(34999),E=n(41654),_=n(63142),l=n(76151),r=n(74048),i=n(95443),e=n(1621),s=n(78377),o=n(73346);const{useGetGrafanaGroupsQuery:c}=l.V;function d({groupIdentifier:L,namespaceName:B,expectedRulesCount:p=3}){const f=(0,_.of)(A),{data:u,isLoading:O}=c({folderUid:L.namespace.uid,groupName:L.groupName,limitAlerts:0},{pollingInterval:i.HH}),C=(0,g.useMemo)(()=>u?.data.groups.at(0)?.rules??[],[u]),{pageItems:N,hasMore:y,loadMore:F}=(0,r.J)(C,i.Tl);return O?(0,a.jsx)(a.Fragment,{children:Array.from({length:p}).map((W,j)=>(0,a.jsx)(s.l,{},j))}):u?C.length===0?(0,a.jsx)(m.F,{title:(0,D.t)("alerting.group-loader.no-rules","No rules found in this group"),severity:"info"}):(0,a.jsxs)(E.B,{direction:"column",gap:0,children:[N.map(W=>(0,a.jsx)(e.g,{rule:W,groupIdentifier:L,namespaceName:B,showLocation:!1},W.uid)),y&&(0,a.jsx)("li",{"aria-selected":"false",role:"treeitem",className:f.loadMoreWrapper,children:(0,a.jsx)(o.s,{onClick:F})})]}):(0,a.jsx)(m.F,{title:(0,D.t)("alerting.group-loader.group-load-failed","Failed to load rules from group {{ groupName }} in {{ namespaceName }}",{groupName:L.groupName,namespaceName:B}),severity:"error"})}const A=L=>({loadMoreWrapper:(0,P.css)({listStyle:"none",paddingTop:L.spacing(1)})})},70148:(K,M,n)=>{n.d(M,{l:()=>i});var a=n(74848),P=n(24619),g=n(39187),D=n(95443),m=n(29442),E=n(94646),_=n(29609),l=n(92367),r=n(87154);function i({rule:s,rulerRule:o,groupIdentifier:c,application:d,actions:A,showLocation:L=!0}){const B=(0,g.w)(),{rulesSource:p,namespace:f,groupName:u}=c,O=o?(0,E.P1)(p.name,f.name,u,o):(0,E.Lg)(p.name,f.name,u,s),C=e(O,B),N=(0,_.uo)(s),y=o?(0,_.qz)(o):s.name,F=o?o.labels:s.labels,W=m.TN.detailsPageLink(p.uid,f.name,u),j={name:y,rulesSource:p,application:d,group:u,groupUrl:W,namespace:f.name,href:C,health:s.health,error:s.lastError,labels:F,actions:A,origin:N,showLocation:L};switch(s.type){case P.JS.Alerting:const U=((_.p.any.alertingRule(o)?o.annotations:s.annotations)??{})[D.YH.summary];return(0,a.jsx)(r.WG,{...j,summary:U,state:s.state,instancesCount:s.alerts?.length});case P.JS.Recording:return(0,a.jsx)(r.nh,{...j});default:return(0,a.jsx)(r.Om,{ruleName:y,groupIdentifier:c,ruleDefinition:s})}}function e(s,o){const c=encodeURIComponent((0,E.$9)(s)),d=encodeURIComponent(s.ruleSourceName);return(0,l.G)(`/alerting/${d}/${c}/view`,o?{returnTo:o}:{})}},73346:(K,M,n)=>{n.d(M,{s:()=>D});var a=n(74848),P=n(92745),g=n(45861);function D({onClick:m,loading:E=!1}){const _=(0,P.t)("alerting.rule-list.pagination.next-page","Show more\u2026");return(0,a.jsx)(g.$n,{"data-testid":"load-more-rule-groups","aria-label":_,fill:"text",size:"sm",variant:"secondary",onClick:m,disabled:E,children:E?(0,a.jsx)(P.x6,{i18nKey:"alerting.rule-list.loading-more-groups",children:"Loading more groups\u2026"}):_})}},76151:(K,M,n)=>{n.d(M,{V:()=>E,a:()=>_});var a=n(96540),P=n(52763),g=n(52161),D=n(5709),m=n(78467);const E=D.H.injectEndpoints({endpoints:l=>({getGroups:l.query({query:({ruleSource:r,namespace:i,groupName:e,ruleName:s,groupLimit:o,excludeAlerts:c,groupNextToken:d,notificationOptions:A})=>{if(r.uid===g.hY)throw new Error("Please use getGrafanaGroups endpoint for grafana rules");return{url:`api/prometheus/${r.uid}/api/v1/rules`,params:{file:i,"file[]":i,rule_group:e,"rule_group[]":e,rule_name:s,"rule_name[]":s,exclude_alerts:c?.toString(),group_limit:o?.toFixed(0),group_next_token:d},notificationOptions:A}},transformResponse:r=>({...r,data:{...r.data,groups:r.data.groups.map(m.JY)}})}),getGrafanaGroups:l.query({query:({folderUid:r,groupName:i,ruleName:e,contactPoint:s,health:o,state:c,groupLimit:d,limitAlerts:A,groupNextToken:L})=>({url:"api/prometheus/grafana/api/v1/rules",params:{folder_uid:r,rule_group:i,rule_name:e,receiver_name:s,health:o,state:c,limit_alerts:A,group_limit:d?.toFixed(0),group_next_token:L}}),providesTags:(r,i,{folderUid:e,groupName:s,ruleName:o})=>[{type:"GrafanaPrometheusGroups",id:`grafana/${e??"__any__"}/${s??"__any__"}/${o??"__any__"}`}]})})});function _(){const l=(0,P.wA)();return{populateGroupsResponseCache:(0,a.useCallback)(i=>{l(E.util.upsertQueryEntries(i.map(e=>({endpointName:"getGrafanaGroups",arg:{folderUid:e.folderUid,groupName:e.name,limitAlerts:0},value:{data:{groups:[e]},status:"success"}}))))},[l])}}},78297:(K,M,n)=>{n.d(M,{l:()=>L});var a=n(74848),P=n(2543),g=n.n(P),D=n(96540),m=n(92745),E=n(45861),_=n(41654),l=n(94380),r=n(53567),i=n(14050),e=n(2218),s=n(74268),o=n(16692),c=n(94646),d=n(29609),A=n(92367);function L({compact:f,rule:u,promRule:O,groupIdentifier:C}){const N=!f,[y,F]=(0,r.w)(N),[W,j]=(0,D.useState)(!1),[R,U]=(0,D.useState)(void 0),$=B(u,O),[T,x]=(0,o.mW)(u,C,o.j5.Update),[z,Y]=(0,o.Es)(d.R$.grafana.rule(O)?O:o.hT,o.j5.Update),H=T&&x||z&&Y,h=[],Q=f?"sm":"md",S=p(C,u,O);if(!S)return null;const G=(0,d.xE)(u??O),v=(0,P.isString)(G)&&(d.p.grafana.alertingRule(u)||d.R$.grafana.alertingRule(O));if(H){const I=(0,A.G)(`/alerting/${encodeURIComponent(c.$9(S))}/edit`);h.push((0,a.jsx)(E.z9,{title:(0,m.t)("alerting.rule-actions-buttons.title-edit","Edit"),size:Q,variant:"secondary",fill:"text",href:I,children:(0,a.jsx)(m.x6,{i18nKey:"common.edit",children:"Edit"})},"edit"))}return(0,a.jsxs)(_.B,{gap:0,alignItems:"center",wrap:"nowrap",children:[h,(0,a.jsx)(l.A,{buttonSize:Q,fill:"text",rulerRule:u,promRule:O,groupIdentifier:C,identifier:S,handleDelete:(I,Z)=>F(I,Z),handleSilence:()=>j(!0),handleDuplicateRule:()=>U({identifier:S,isProvisioned:$})}),y,v&&W&&(0,a.jsx)(e.A,{ruleUid:G,onClose:()=>j(!1)}),R?.identifier&&(0,a.jsx)(i.Z,{identifier:R.identifier,isProvisioned:R.isProvisioned,onDismiss:()=>U(void 0)})]})}function B(f,u){return f?(0,d.Nv)(f):u?(0,d.bL)(u):!1}function p(f,u,O){if(u)return c.co(f,u);if(d.R$.grafana.rule(O))return{ruleSourceName:"grafana",uid:O.uid};(0,s.FF)("Unable to construct an editable rule identifier")}},78377:(K,M,n)=>{n.d(M,{l:()=>_});var a=n(74848),P=n(70255),g=n(77256),D=n(51592),m=n(15079),E=n(87672);function _(){return(0,a.jsx)(D.c,{title:(0,a.jsx)(P.A,{width:64}),icon:(0,a.jsx)(E.c,{isPaused:!1}),description:(0,a.jsx)(P.A,{width:256}),actions:(0,a.jsx)(m.T,{}),"data-testid":"alert-rule-list-item-loader","aria-disabled":!0})}function l({ruleIdentifier:r,error:i}){const e=i?stringifyErrorLike(i):t("alerting.rule-list.rulerrule-loading-error","Failed to load the rule");return jsx(ListItem,{title:r.uid,description:e,"data-testid":"ruler-rule-loading-error"})}},93167:(K,M,n)=>{n.d(M,{e:()=>F});var a=n(74848),P=n(22803),g=n(29189),D=n(96540),m=n(92745),E=n(68143),_=n(34999),l=n(63142),r=n(70327),i=n(55143),e=n(76151),s=n(74048),o=n(95443),c=n(94646),d=n(29609),A=n(70148),L=n(87154),B=n(78377),p=n(73346),f=n(78297),u=n(87672),O=n(95081);const{useDiscoverDsFeaturesQuery:C}=i.L,{useGetGroupsQuery:N}=e.V,{useGetRuleGroupForNamespaceQuery:y}=r.hK;function F({groupIdentifier:R,expectedRulesCount:U=3}){const{namespace:$,groupName:T}=R,x=$.name,{data:z,isLoading:Y,isError:H}=N({ruleSource:{uid:R.rulesSource.uid},namespace:x,groupName:T},{pollingInterval:o.HH}),{data:h,isLoading:Q,isError:S}=C({uid:R.rulesSource.uid}),{data:G,error:v,isFetching:I,isError:Z}=y(h?.rulerConfig?{rulerConfig:h?.rulerConfig,namespace:x,group:T}:g.hT);if(Y||Q||I)return(0,a.jsx)(a.Fragment,{children:Array.from({length:U}).map((V,X)=>(0,a.jsx)(B.l,{},X))});if(H||S||Z)return(0,E.NF)(v)&&v.status===404?(0,a.jsx)(_.F,{severity:"warning",title:(0,m.t)("alerting.ds-group-loader.group-deleting","The group is being deleted")}):(0,a.jsx)(_.F,{title:(0,m.t)("alerting.ds-group-loader.group-load-failed","Failed to load rules from group {{ groupName }} in {{ namespaceName }}",{groupName:T,namespaceName:x}),severity:"error"});const J=z?.data.groups.find(V=>V.file===x&&V.name===T);return h?.rulerConfig&&G&&(0,d.x6)(G)&&J?(0,a.jsx)(W,{groupIdentifier:R,promGroup:J,rulerGroup:G,application:h.application}):J?(0,a.jsx)(a.Fragment,{children:J.rules.map(V=>(0,a.jsx)(A.l,{rule:V,groupIdentifier:R,application:h?.application,showLocation:!1},(0,c.jY)(V)))}):(0,a.jsx)(_.F,{title:(0,m.t)("alerting.ds-group-loader.group-load-failed","Failed to load rules from group {{ groupName }} in {{ namespaceName }}",{groupName:T,namespaceName:x}),severity:"warning"})}function W({groupIdentifier:R,application:U,promGroup:$,rulerGroup:T}){const x=(0,l.of)(j),{namespace:z,groupName:Y}=R,{matches:H,promOnlyRules:h}=(0,D.useMemo)(()=>(0,O.Y1)(T,$),[$,T]),{pageItems:Q,hasMore:S,loadMore:G}=(0,s.J)(T.rules,o.Tl);return(0,a.jsxs)(a.Fragment,{children:[Q.map(v=>{const I=H.get(v);return I?(0,a.jsx)(A.l,{rule:I,rulerRule:v,groupIdentifier:R,application:U,actions:(0,a.jsx)(f.l,{rule:v,promRule:I,groupIdentifier:R,compact:!0}),showLocation:!1},(0,c.jY)(I)):(0,a.jsx)(L.B3,{name:(0,d.qz)(v),namespace:z.name,group:Y,rulesSource:R.rulesSource,application:U,operation:u.s.Creating,showLocation:!1},(0,d.qz)(v))}),h.map(v=>(0,a.jsx)(L.B3,{name:v.name,namespace:z.name,group:Y,rulesSource:R.rulesSource,application:U,operation:u.s.Deleting,showLocation:!1},v.name)),S&&(0,a.jsx)("li",{"aria-selected":"false",role:"treeitem",className:x.loadMoreWrapper,children:(0,a.jsx)(p.s,{onClick:G})})]})}const j=R=>({loadMoreWrapper:(0,P.css)({listStyle:"none",paddingTop:R.spacing(1)})})},95081:(K,M,n)=>{n.d(M,{SF:()=>g,Y1:()=>m});var a=n(94646),P=n(29609);function g(E,_){const l=E.rules.filter(e=>(0,P.qz)(e)===_.name);if(l.length===1)return l[0];const r=l.filter(e=>(0,a.vL)(e,!1).join("-")===(0,a.Tn)(_,!1).join("-"));if(r.length===1)return r[0];const i=l.filter(e=>(0,a.vL)(e,!0).join("-")===(0,a.Tn)(_,!0).join("-"));if(i.length===1)return i[0]}function D(E,_){const l=E.rules.filter(e=>e.name===(0,P.qz)(_));if(l.length===1)return l[0];const r=l.filter(e=>(0,a.Tn)(e,!1).join("-")===(0,a.vL)(_,!1).join("-"));if(r.length===1)return r[0];const i=l.filter(e=>(0,a.Tn)(e,!0).join("-")===(0,a.vL)(_,!0).join("-"));if(i.length===1)return i[0]}function m(E,_){const l=E.rules.reduce((r,i)=>{const{matches:e,unmatchedPromRules:s}=r,o=D(_,i);return o&&(e.set(i,o),s.delete(o)),r},{matches:new Map,unmatchedPromRules:new Set(_.rules)});return{matches:l.matches,promOnlyRules:Array.from(l.unmatchedPromRules)}}}}]);

//# sourceMappingURL=4162.a0dc9d0149bcc67a5989.js.map