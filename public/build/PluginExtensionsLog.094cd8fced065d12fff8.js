"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[5902],{79682:(qe,te,b)=>{b.r(te),b.d(te,{default:()=>Ye});var A=b(74848),ve=b(43561),S=b(96540),pe=b(70713),w=b(45863),x=b(2543);function O(s,e,...t){let i=!1;typeof window<"u"&&(i=localStorage.getItem("grafana.debug.scenes")==="true"),i&&console.log(`${s}: `,e,...t)}class ie extends w.Bs{constructor(e){var t,i;super({...e,children:(t=e?.children)!=null?t:[],childContexts:(i=e?.childContexts)!=null?i:[]})}addToScene(e){this.publishEvent(new w.sU(e),!0),this.setState({children:[...this.state.children,e]}),O("SceneContext",`Adding to scene: ${e.constructor.name} key: ${e.state.key}`);const t=e.activate();return()=>{O("SceneContext",`Removing from scene: ${e.constructor.name} key: ${e.state.key}`),this.setState({children:this.state.children.filter(i=>i!==e)}),t()}}findByKey(e){return this.state.children.find(t=>t.state.key===e)}findVariable(e){const t=this.state.$variables;if(t)return t.getByName(e)}addVariable(e){let t=this.state.$variables;return this.publishEvent(new w.sU(e),!0),t?t.setState({variables:[...t.state.variables,e]}):(t=new w.Pj({variables:[e]}),this.setState({$variables:t})),O("SceneContext",`Adding variable: ${e.constructor.name} key: ${e.state.key}`),()=>{t.setState({variables:t.state.variables.filter(i=>i!==e)}),O("SceneContext",`Removing variable: ${e.constructor.name} key: ${e.state.key}`)}}addChildContext(e){var t;this.publishEvent(new w.sU(e),!0),this.setState({childContexts:[...(t=this.state.childContexts)!=null?t:[],e]}),O("SceneContext",`Adding child context: ${e.constructor.name} key: ${e.state.key}`)}removeChildContext(e){var t;this.setState({childContexts:(t=this.state.childContexts)==null?void 0:t.filter(i=>e!==i)}),O("SceneContext",`Remvoing child context: ${e.constructor.name} key: ${e.state.key}`)}}const $=(0,S.createContext)(null);function ye({children:s,timeRange:e,withQueryController:t}){const i=(0,S.useContext)($),[n,r]=(0,S.useState)(),a=e;if((0,S.useEffect)(()=>{const l={children:[]};t&&(l.$behaviors=[new w.Gg.Hf]),a&&(l.$timeRange=new w.JZ(a));const f=new ie(l);i&&i.addChildContext(f);const h=f.activate();return r(f),()=>{h(),i&&i.removeChildContext(f)}},[i,t]),!n)return null;const o=S.createElement($.Provider,{value:n},s);return i?o:S.createElement(w.$L,{scene:n,updateUrlOnInit:!0,createBrowserHistorySteps:!0},o)}function R(){const s=(0,S.useContext)($);if(!s)throw new Error("Cannot find a SceneContext");return s}function Xe(){const s=R(),e=sceneGraph.getTimeRange(s),{value:t}=e.useState();return[t,e]}function et(){const s=R();return sceneGraph.getVariables(s).useState().variables}function Se({timeRange:s,variables:e=[]}){const t=R(),[i,n]=useState();return useEffect(()=>{const r=new Subscription;if(e&&e.length>0)for(const a of e){const o=sceneGraph.lookupVariable(a,t);o&&r.add(o.subscribeToEvent(SceneVariableValueChangedEvent,()=>{n({variableName:o.state.name,variableValue:o.getValue()})}))}return s&&sceneGraph.getTimeRange(t).subscribeToState((o,l)=>{o.value!==l.value&&n({timeRange:o.value})}),()=>r.unsubscribe()},[t,s,...e]),i}function tt(s){const e=R();return Se(s),useCallback(t=>sceneGraph.interpolate(e,t),[e])}const V=typeof performance=="object"&&performance&&typeof performance.now=="function"?performance:Date,se=new Set,B=typeof process=="object"&&process?process:{},ne=(s,e,t,i)=>{typeof B.emitWarning=="function"?B.emitWarning(s,e,t,i):console.error(`[${t}] ${e}: ${s}`)};let j=globalThis.AbortController,re=globalThis.AbortSignal;if(typeof j>"u"){re=class{onabort;_onabort=[];reason;aborted=!1;addEventListener(i,n){this._onabort.push(n)}},j=class{constructor(){e()}signal=new re;abort(i){if(!this.signal.aborted){this.signal.reason=i,this.signal.aborted=!0;for(const n of this.signal._onabort)n(i);this.signal.onabort?.(i)}}};let s=B.env?.LRU_CACHE_IGNORE_AC_WARNING!=="1";const e=()=>{s&&(s=!1,ne("AbortController is not defined. If using lru-cache in node 14, load an AbortController polyfill from the `node-abort-controller` package. A minimal polyfill is provided for use by LRUCache.fetch(), but it should not be relied upon in other contexts (eg, passing it to other APIs that use AbortController/AbortSignal might have undesirable effects). You may disable this with LRU_CACHE_IGNORE_AC_WARNING=1 in the env.","NO_ABORT_CONTROLLER","ENOTSUP",e))}}const be=s=>!se.has(s),it=Symbol("type"),T=s=>s&&s===Math.floor(s)&&s>0&&isFinite(s),ae=s=>T(s)?s<=Math.pow(2,8)?Uint8Array:s<=Math.pow(2,16)?Uint16Array:s<=Math.pow(2,32)?Uint32Array:s<=Number.MAX_SAFE_INTEGER?G:null:null;class G extends Array{constructor(e){super(e),this.fill(0)}}class L{heap;length;static#l=!1;static create(e){const t=ae(e);if(!t)return[];L.#l=!0;const i=new L(e,t);return L.#l=!1,i}constructor(e,t){if(!L.#l)throw new TypeError("instantiate Stack using Stack.create(n)");this.heap=new t(e),this.length=0}push(e){this.heap[this.length++]=e}pop(){return this.heap[--this.length]}}class _{#l;#u;#m;#v;#O;#R;ttl;ttlResolution;ttlAutopurge;updateAgeOnGet;updateAgeOnHas;allowStale;noDisposeOnSet;noUpdateTTL;maxEntrySize;sizeCalculation;noDeleteOnFetchRejection;noDeleteOnStaleGet;allowStaleOnFetchAbort;allowStaleOnFetchRejection;ignoreFetchAbort;#n;#p;#s;#i;#e;#h;#f;#o;#r;#y;#a;#S;#b;#d;#w;#A;#c;static unsafeExposeInternals(e){return{starts:e.#b,ttls:e.#d,sizes:e.#S,keyMap:e.#s,keyList:e.#i,valList:e.#e,next:e.#h,prev:e.#f,get head(){return e.#o},get tail(){return e.#r},free:e.#y,isBackgroundFetch:t=>e.#t(t),backgroundFetch:(t,i,n,r)=>e.#L(t,i,n,r),moveToTail:t=>e.#P(t),indexes:t=>e.#x(t),rindexes:t=>e.#C(t),isStale:t=>e.#g(t)}}get max(){return this.#l}get maxSize(){return this.#u}get calculatedSize(){return this.#p}get size(){return this.#n}get fetchMethod(){return this.#O}get memoMethod(){return this.#R}get dispose(){return this.#m}get disposeAfter(){return this.#v}constructor(e){const{max:t=0,ttl:i,ttlResolution:n=1,ttlAutopurge:r,updateAgeOnGet:a,updateAgeOnHas:o,allowStale:l,dispose:f,disposeAfter:h,noDisposeOnSet:c,noUpdateTTL:d,maxSize:u=0,maxEntrySize:E=0,sizeCalculation:y,fetchMethod:v,memoMethod:m,noDeleteOnFetchRejection:p,noDeleteOnStaleGet:C,allowStaleOnFetchRejection:g,allowStaleOnFetchAbort:I,ignoreFetchAbort:F}=e;if(t!==0&&!T(t))throw new TypeError("max option must be a nonnegative integer");const P=t?ae(t):Array;if(!P)throw new Error("invalid max value: "+t);if(this.#l=t,this.#u=u,this.maxEntrySize=E||this.#u,this.sizeCalculation=y,this.sizeCalculation){if(!this.#u&&!this.maxEntrySize)throw new TypeError("cannot set sizeCalculation without setting maxSize or maxEntrySize");if(typeof this.sizeCalculation!="function")throw new TypeError("sizeCalculation set to non-function")}if(m!==void 0&&typeof m!="function")throw new TypeError("memoMethod must be a function if defined");if(this.#R=m,v!==void 0&&typeof v!="function")throw new TypeError("fetchMethod must be a function if specified");if(this.#O=v,this.#A=!!v,this.#s=new Map,this.#i=new Array(t).fill(void 0),this.#e=new Array(t).fill(void 0),this.#h=new P(t),this.#f=new P(t),this.#o=0,this.#r=0,this.#y=L.create(t),this.#n=0,this.#p=0,typeof f=="function"&&(this.#m=f),typeof h=="function"?(this.#v=h,this.#a=[]):(this.#v=void 0,this.#a=void 0),this.#w=!!this.#m,this.#c=!!this.#v,this.noDisposeOnSet=!!c,this.noUpdateTTL=!!d,this.noDeleteOnFetchRejection=!!p,this.allowStaleOnFetchRejection=!!g,this.allowStaleOnFetchAbort=!!I,this.ignoreFetchAbort=!!F,this.maxEntrySize!==0){if(this.#u!==0&&!T(this.#u))throw new TypeError("maxSize must be a positive integer if specified");if(!T(this.maxEntrySize))throw new TypeError("maxEntrySize must be a positive integer if specified");this.#k()}if(this.allowStale=!!l,this.noDeleteOnStaleGet=!!C,this.updateAgeOnGet=!!a,this.updateAgeOnHas=!!o,this.ttlResolution=T(n)||n===0?n:1,this.ttlAutopurge=!!r,this.ttl=i||0,this.ttl){if(!T(this.ttl))throw new TypeError("ttl must be a positive integer if specified");this.#D()}if(this.#l===0&&this.ttl===0&&this.#u===0)throw new TypeError("At least one of max, maxSize, or ttl is required");if(!this.ttlAutopurge&&!this.#l&&!this.#u){const H="LRU_CACHE_UNBOUNDED";be(H)&&(se.add(H),ne("TTL caching without ttlAutopurge, max, or maxSize can result in unbounded memory consumption.","UnboundedCacheWarning",H,_))}}getRemainingTTL(e){return this.#s.has(e)?1/0:0}#D(){const e=new G(this.#l),t=new G(this.#l);this.#d=e,this.#b=t,this.#W=(r,a,o=V.now())=>{if(t[r]=a!==0?o:0,e[r]=a,a!==0&&this.ttlAutopurge){const l=setTimeout(()=>{this.#g(r)&&this.#E(this.#i[r],"expire")},a+1);l.unref&&l.unref()}},this.#T=r=>{t[r]=e[r]!==0?V.now():0},this.#I=(r,a)=>{if(e[a]){const o=e[a],l=t[a];if(!o||!l)return;r.ttl=o,r.start=l,r.now=i||n();const f=r.now-l;r.remainingTTL=o-f}};let i=0;const n=()=>{const r=V.now();if(this.ttlResolution>0){i=r;const a=setTimeout(()=>i=0,this.ttlResolution);a.unref&&a.unref()}return r};this.getRemainingTTL=r=>{const a=this.#s.get(r);if(a===void 0)return 0;const o=e[a],l=t[a];if(!o||!l)return 1/0;const f=(i||n())-l;return o-f},this.#g=r=>{const a=t[r],o=e[r];return!!o&&!!a&&(i||n())-a>o}}#T=()=>{};#I=()=>{};#W=()=>{};#g=()=>!1;#k(){const e=new G(this.#l);this.#p=0,this.#S=e,this.#F=t=>{this.#p-=e[t],e[t]=0},this.#U=(t,i,n,r)=>{if(this.#t(i))return 0;if(!T(n))if(r){if(typeof r!="function")throw new TypeError("sizeCalculation must be a function");if(n=r(i,t),!T(n))throw new TypeError("sizeCalculation return invalid (expect positive integer)")}else throw new TypeError("invalid size value (must be positive integer). When maxSize or maxEntrySize is used, sizeCalculation or size must be set.");return n},this.#z=(t,i,n)=>{if(e[t]=i,this.#u){const r=this.#u-e[t];for(;this.#p>r;)this.#V(!0)}this.#p+=e[t],n&&(n.entrySize=i,n.totalCalculatedSize=this.#p)}}#F=e=>{};#z=(e,t,i)=>{};#U=(e,t,i,n)=>{if(i||n)throw new TypeError("cannot set size without setting maxSize or maxEntrySize on cache");return 0};*#x({allowStale:e=this.allowStale}={}){if(this.#n)for(let t=this.#r;!(!this.#$(t)||((e||!this.#g(t))&&(yield t),t===this.#o));)t=this.#f[t]}*#C({allowStale:e=this.allowStale}={}){if(this.#n)for(let t=this.#o;!(!this.#$(t)||((e||!this.#g(t))&&(yield t),t===this.#r));)t=this.#h[t]}#$(e){return e!==void 0&&this.#s.get(this.#i[e])===e}*entries(){for(const e of this.#x())this.#e[e]!==void 0&&this.#i[e]!==void 0&&!this.#t(this.#e[e])&&(yield[this.#i[e],this.#e[e]])}*rentries(){for(const e of this.#C())this.#e[e]!==void 0&&this.#i[e]!==void 0&&!this.#t(this.#e[e])&&(yield[this.#i[e],this.#e[e]])}*keys(){for(const e of this.#x()){const t=this.#i[e];t!==void 0&&!this.#t(this.#e[e])&&(yield t)}}*rkeys(){for(const e of this.#C()){const t=this.#i[e];t!==void 0&&!this.#t(this.#e[e])&&(yield t)}}*values(){for(const e of this.#x())this.#e[e]!==void 0&&!this.#t(this.#e[e])&&(yield this.#e[e])}*rvalues(){for(const e of this.#C())this.#e[e]!==void 0&&!this.#t(this.#e[e])&&(yield this.#e[e])}[Symbol.iterator](){return this.entries()}[Symbol.toStringTag]="LRUCache";find(e,t={}){for(const i of this.#x()){const n=this.#e[i],r=this.#t(n)?n.__staleWhileFetching:n;if(r!==void 0&&e(r,this.#i[i],this))return this.get(this.#i[i],t)}}forEach(e,t=this){for(const i of this.#x()){const n=this.#e[i],r=this.#t(n)?n.__staleWhileFetching:n;r!==void 0&&e.call(t,r,this.#i[i],this)}}rforEach(e,t=this){for(const i of this.#C()){const n=this.#e[i],r=this.#t(n)?n.__staleWhileFetching:n;r!==void 0&&e.call(t,r,this.#i[i],this)}}purgeStale(){let e=!1;for(const t of this.#C({allowStale:!0}))this.#g(t)&&(this.#E(this.#i[t],"expire"),e=!0);return e}info(e){const t=this.#s.get(e);if(t===void 0)return;const i=this.#e[t],n=this.#t(i)?i.__staleWhileFetching:i;if(n===void 0)return;const r={value:n};if(this.#d&&this.#b){const a=this.#d[t],o=this.#b[t];if(a&&o){const l=a-(V.now()-o);r.ttl=l,r.start=Date.now()}}return this.#S&&(r.size=this.#S[t]),r}dump(){const e=[];for(const t of this.#x({allowStale:!0})){const i=this.#i[t],n=this.#e[t],r=this.#t(n)?n.__staleWhileFetching:n;if(r===void 0||i===void 0)continue;const a={value:r};if(this.#d&&this.#b){a.ttl=this.#d[t];const o=V.now()-this.#b[t];a.start=Math.floor(Date.now()-o)}this.#S&&(a.size=this.#S[t]),e.unshift([i,a])}return e}load(e){this.clear();for(const[t,i]of e){if(i.start){const n=Date.now()-i.start;i.start=V.now()-n}this.set(t,i.value,i)}}set(e,t,i={}){if(t===void 0)return this.delete(e),this;const{ttl:n=this.ttl,start:r,noDisposeOnSet:a=this.noDisposeOnSet,sizeCalculation:o=this.sizeCalculation,status:l}=i;let{noUpdateTTL:f=this.noUpdateTTL}=i;const h=this.#U(e,t,i.size||0,o);if(this.maxEntrySize&&h>this.maxEntrySize)return l&&(l.set="miss",l.maxEntrySizeExceeded=!0),this.#E(e,"set"),this;let c=this.#n===0?void 0:this.#s.get(e);if(c===void 0)c=this.#n===0?this.#r:this.#y.length!==0?this.#y.pop():this.#n===this.#l?this.#V(!1):this.#n,this.#i[c]=e,this.#e[c]=t,this.#s.set(e,c),this.#h[this.#r]=c,this.#f[c]=this.#r,this.#r=c,this.#n++,this.#z(c,h,l),l&&(l.set="add"),f=!1;else{this.#P(c);const d=this.#e[c];if(t!==d){if(this.#A&&this.#t(d)){d.__abortController.abort(new Error("replaced"));const{__staleWhileFetching:u}=d;u!==void 0&&!a&&(this.#w&&this.#m?.(u,e,"set"),this.#c&&this.#a?.push([u,e,"set"]))}else a||(this.#w&&this.#m?.(d,e,"set"),this.#c&&this.#a?.push([d,e,"set"]));if(this.#F(c),this.#z(c,h,l),this.#e[c]=t,l){l.set="replace";const u=d&&this.#t(d)?d.__staleWhileFetching:d;u!==void 0&&(l.oldValue=u)}}else l&&(l.set="update")}if(n!==0&&!this.#d&&this.#D(),this.#d&&(f||this.#W(c,n,r),l&&this.#I(l,c)),!a&&this.#c&&this.#a){const d=this.#a;let u;for(;u=d?.shift();)this.#v?.(...u)}return this}pop(){try{for(;this.#n;){const e=this.#e[this.#o];if(this.#V(!0),this.#t(e)){if(e.__staleWhileFetching)return e.__staleWhileFetching}else if(e!==void 0)return e}}finally{if(this.#c&&this.#a){const e=this.#a;let t;for(;t=e?.shift();)this.#v?.(...t)}}}#V(e){const t=this.#o,i=this.#i[t],n=this.#e[t];return this.#A&&this.#t(n)?n.__abortController.abort(new Error("evicted")):(this.#w||this.#c)&&(this.#w&&this.#m?.(n,i,"evict"),this.#c&&this.#a?.push([n,i,"evict"])),this.#F(t),e&&(this.#i[t]=void 0,this.#e[t]=void 0,this.#y.push(t)),this.#n===1?(this.#o=this.#r=0,this.#y.length=0):this.#o=this.#h[t],this.#s.delete(i),this.#n--,t}has(e,t={}){const{updateAgeOnHas:i=this.updateAgeOnHas,status:n}=t,r=this.#s.get(e);if(r!==void 0){const a=this.#e[r];if(this.#t(a)&&a.__staleWhileFetching===void 0)return!1;if(this.#g(r))n&&(n.has="stale",this.#I(n,r));else return i&&this.#T(r),n&&(n.has="hit",this.#I(n,r)),!0}else n&&(n.has="miss");return!1}peek(e,t={}){const{allowStale:i=this.allowStale}=t,n=this.#s.get(e);if(n===void 0||!i&&this.#g(n))return;const r=this.#e[n];return this.#t(r)?r.__staleWhileFetching:r}#L(e,t,i,n){const r=t===void 0?void 0:this.#e[t];if(this.#t(r))return r;const a=new j,{signal:o}=i;o?.addEventListener("abort",()=>a.abort(o.reason),{signal:a.signal});const l={signal:a.signal,options:i,context:n},f=(y,v=!1)=>{const{aborted:m}=a.signal,p=i.ignoreFetchAbort&&y!==void 0;if(i.status&&(m&&!v?(i.status.fetchAborted=!0,i.status.fetchError=a.signal.reason,p&&(i.status.fetchAbortIgnored=!0)):i.status.fetchResolved=!0),m&&!p&&!v)return c(a.signal.reason);const C=u;return this.#e[t]===u&&(y===void 0?C.__staleWhileFetching?this.#e[t]=C.__staleWhileFetching:this.#E(e,"fetch"):(i.status&&(i.status.fetchUpdated=!0),this.set(e,y,l.options))),y},h=y=>(i.status&&(i.status.fetchRejected=!0,i.status.fetchError=y),c(y)),c=y=>{const{aborted:v}=a.signal,m=v&&i.allowStaleOnFetchAbort,p=m||i.allowStaleOnFetchRejection,C=p||i.noDeleteOnFetchRejection,g=u;if(this.#e[t]===u&&(!C||g.__staleWhileFetching===void 0?this.#E(e,"fetch"):m||(this.#e[t]=g.__staleWhileFetching)),p)return i.status&&g.__staleWhileFetching!==void 0&&(i.status.returnedStale=!0),g.__staleWhileFetching;if(g.__returned===g)throw y},d=(y,v)=>{const m=this.#O?.(e,r,l);m&&m instanceof Promise&&m.then(p=>y(p===void 0?void 0:p),v),a.signal.addEventListener("abort",()=>{(!i.ignoreFetchAbort||i.allowStaleOnFetchAbort)&&(y(void 0),i.allowStaleOnFetchAbort&&(y=p=>f(p,!0)))})};i.status&&(i.status.fetchDispatched=!0);const u=new Promise(d).then(f,h),E=Object.assign(u,{__abortController:a,__staleWhileFetching:r,__returned:void 0});return t===void 0?(this.set(e,E,{...l.options,status:void 0}),t=this.#s.get(e)):this.#e[t]=E,E}#t(e){if(!this.#A)return!1;const t=e;return!!t&&t instanceof Promise&&t.hasOwnProperty("__staleWhileFetching")&&t.__abortController instanceof j}async fetch(e,t={}){const{allowStale:i=this.allowStale,updateAgeOnGet:n=this.updateAgeOnGet,noDeleteOnStaleGet:r=this.noDeleteOnStaleGet,ttl:a=this.ttl,noDisposeOnSet:o=this.noDisposeOnSet,size:l=0,sizeCalculation:f=this.sizeCalculation,noUpdateTTL:h=this.noUpdateTTL,noDeleteOnFetchRejection:c=this.noDeleteOnFetchRejection,allowStaleOnFetchRejection:d=this.allowStaleOnFetchRejection,ignoreFetchAbort:u=this.ignoreFetchAbort,allowStaleOnFetchAbort:E=this.allowStaleOnFetchAbort,context:y,forceRefresh:v=!1,status:m,signal:p}=t;if(!this.#A)return m&&(m.fetch="get"),this.get(e,{allowStale:i,updateAgeOnGet:n,noDeleteOnStaleGet:r,status:m});const C={allowStale:i,updateAgeOnGet:n,noDeleteOnStaleGet:r,ttl:a,noDisposeOnSet:o,size:l,sizeCalculation:f,noUpdateTTL:h,noDeleteOnFetchRejection:c,allowStaleOnFetchRejection:d,allowStaleOnFetchAbort:E,ignoreFetchAbort:u,status:m,signal:p};let g=this.#s.get(e);if(g===void 0){m&&(m.fetch="miss");const I=this.#L(e,g,C,y);return I.__returned=I}else{const I=this.#e[g];if(this.#t(I)){const me=i&&I.__staleWhileFetching!==void 0;return m&&(m.fetch="inflight",me&&(m.returnedStale=!0)),me?I.__staleWhileFetching:I.__returned=I}const F=this.#g(g);if(!v&&!F)return m&&(m.fetch="hit"),this.#P(g),n&&this.#T(g),m&&this.#I(m,g),I;const P=this.#L(e,g,C,y),ee=P.__staleWhileFetching!==void 0&&i;return m&&(m.fetch=F?"stale":"refresh",ee&&F&&(m.returnedStale=!0)),ee?P.__staleWhileFetching:P.__returned=P}}async forceFetch(e,t={}){const i=await this.fetch(e,t);if(i===void 0)throw new Error("fetch() returned undefined");return i}memo(e,t={}){const i=this.#R;if(!i)throw new Error("no memoMethod provided to constructor");const{context:n,forceRefresh:r,...a}=t,o=this.get(e,a);if(!r&&o!==void 0)return o;const l=i(e,o,{options:a,context:n});return this.set(e,l,a),l}get(e,t={}){const{allowStale:i=this.allowStale,updateAgeOnGet:n=this.updateAgeOnGet,noDeleteOnStaleGet:r=this.noDeleteOnStaleGet,status:a}=t,o=this.#s.get(e);if(o!==void 0){const l=this.#e[o],f=this.#t(l);return a&&this.#I(a,o),this.#g(o)?(a&&(a.get="stale"),f?(a&&i&&l.__staleWhileFetching!==void 0&&(a.returnedStale=!0),i?l.__staleWhileFetching:void 0):(r||this.#E(e,"expire"),a&&i&&(a.returnedStale=!0),i?l:void 0)):(a&&(a.get="hit"),f?l.__staleWhileFetching:(this.#P(o),n&&this.#T(o),l))}else a&&(a.get="miss")}#j(e,t){this.#f[t]=e,this.#h[e]=t}#P(e){e!==this.#r&&(e===this.#o?this.#o=this.#h[e]:this.#j(this.#f[e],this.#h[e]),this.#j(this.#r,e),this.#r=e)}delete(e){return this.#E(e,"delete")}#E(e,t){let i=!1;if(this.#n!==0){const n=this.#s.get(e);if(n!==void 0)if(i=!0,this.#n===1)this.#G(t);else{this.#F(n);const r=this.#e[n];if(this.#t(r)?r.__abortController.abort(new Error("deleted")):(this.#w||this.#c)&&(this.#w&&this.#m?.(r,e,t),this.#c&&this.#a?.push([r,e,t])),this.#s.delete(e),this.#i[n]=void 0,this.#e[n]=void 0,n===this.#r)this.#r=this.#f[n];else if(n===this.#o)this.#o=this.#h[n];else{const a=this.#f[n];this.#h[a]=this.#h[n];const o=this.#h[n];this.#f[o]=this.#f[n]}this.#n--,this.#y.push(n)}}if(this.#c&&this.#a?.length){const n=this.#a;let r;for(;r=n?.shift();)this.#v?.(...r)}return i}clear(){return this.#G("delete")}#G(e){for(const t of this.#C({allowStale:!0})){const i=this.#e[t];if(this.#t(i))i.__abortController.abort(new Error("deleted"));else{const n=this.#i[t];this.#w&&this.#m?.(i,n,e),this.#c&&this.#a?.push([i,n,e])}}if(this.#s.clear(),this.#e.fill(void 0),this.#i.fill(void 0),this.#d&&this.#b&&(this.#d.fill(0),this.#b.fill(0)),this.#S&&this.#S.fill(0),this.#o=0,this.#r=0,this.#y.length=0,this.#p=0,this.#n=0,this.#c&&this.#a){const t=this.#a;let i;for(;i=t?.shift();)this.#v?.(...i)}}}var oe=s=>{throw TypeError(s)},le=(s,e,t)=>e.has(s)||oe("Cannot "+t),D=(s,e,t)=>(le(s,e,"read from private field"),t?t.call(s):e.get(s)),K=(s,e,t)=>e.has(s)?oe("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(s):e.set(s,t),he=(s,e,t,i)=>(le(s,e,"write to private field"),e.set(s,t),t),we=(s,e,t,i)=>({set _(n){he(s,e,n)},get _(){return D(s,e,i)}}),W,k,N;class xe{constructor(){K(this,W),K(this,k,new WeakMap),K(this,N,0),he(this,W,new _({max:500,ttl:1e3*60*5}))}add(e,t){D(this,W).set(e,t)}get(e){return D(this,W).get(e)}getHashKey(e,t){return Array.isArray(e)?`${t.name}-${e.map(i=>this.getHashKeyElement(i)).join()}`:`${t.name}-${this.getHashKeyElement(e)}`}getByRefHashKey(e){let t=D(this,k).get(e);return t==null&&(t=we(this,N)._++,D(this,k).set(e,t)),t}getHashKeyElement(e){return typeof e=="string"||typeof e=="boolean"||typeof e=="number"?e:Ee(e)}}W=new WeakMap,k=new WeakMap,N=new WeakMap;let Q;function Ce(){return Q||(Q=new xe)}function Ee(s){return JSON.stringify(s,(e,t)=>(0,x.isPlainObject)(t)?Object.keys(t).sort().reduce((i,n)=>(i[n]=t[n],i),{}):t)}function Ie(s){const e=R(),t=(0,S.useId)(),i=Ce();let n=s.cacheKey?i.getHashKey(s.cacheKey,s.objectConstructor):void 0,r=e.findByKey(t);return!r&&n&&(r=i.get(n),r&&r.parent!==e&&(w.jh.findObject(e,a=>a===r)?(console.error("A scene object cache key matched an object that is already in the scene"),r=void 0,n=void 0):r.clearParent())),r||(r=s.factory(t),n&&i.add(n,r)),(0,S.useEffect)(()=>e.addToScene(r),[r,e]),r}function Ae(s){const e=Ie({factory:t=>new w.dt({key:t,queries:s.queries,maxDataPoints:s.maxDataPoints,datasource:s.datasource,liveStreaming:s.liveStreaming,maxDataPointsFromWidth:s.maxDataPointsFromWidth}),objectConstructor:w.dt,cacheKey:s.cacheKey});return(0,S.useEffect)(()=>{(0,x.isEqual)(e.state.queries,s.queries)||(e.setState({queries:s.queries}),e.runQueries())},[e,s]),e}function Te(s){const e=R(),t=(0,S.useId)();let i=e.findByKey(t);return i||(i=new w.Es({key:t,$data:new w.wT({source:s.data.getRef()}),transformations:s.transformations})),(0,S.useEffect)(()=>e.addToScene(i),[i,e]),(0,S.useEffect)(()=>{(0,x.isEqual)(i.state.transformations,s.transformations)||(i.setState({transformations:s.transformations}),i.reprocessTransformations())},[i,s.transformations]),i}function st(s){const[e,t]=useTimeRange();return React.createElement(TimeRangePicker$1,{isOnCanvas:!0,value:e,onChange:t.onTimeRangeChange,timeZone:t.getTimeZone(),onMoveBackward:()=>{},onMoveForward:()=>{},onZoom:()=>{},onChangeTimeZone:()=>{},onChangeFiscalYearStartMonth:()=>{}})}function nt({name:s,hideLabel:e,layout:t}){const i=useSceneContext(),n=sceneGraph.lookupVariable(s,i);return n?React.createElement(VariableValueSelectWrapper,{key:n.state.key,variable:n,hideLabel:e,layout:t}):React.createElement("div",null,"Variable ",s," not found")}var Fe=b(84596),Pe=b(69168);function Oe(s){const{title:e,description:t,viz:i,dataProvider:n,displayMode:r,hoverHeader:a,hoverHeaderOffset:o,headerActions:l,menu:f,titleItems:h,extendPanelContext:c,seriesLimit:d,seriesLimitShowAll:u,collapsible:E,collapsed:y}=s,v=R(),m=(0,S.useId)(),p=(0,Fe.A)(s);let C=v.findByKey(m);return C||(C=new w.Eb({key:m,pluginId:i.pluginId,title:e,titleItems:h,description:t,options:i.options,fieldConfig:i.fieldConfig,pluginVersion:i.pluginVersion,$data:ce(n),displayMode:r,hoverHeader:a,hoverHeaderOffset:o,headerActions:l,menu:f,extendPanelContext:c,collapsible:E,collapsed:y,seriesLimit:d,seriesLimitShowAll:u})),(0,S.useEffect)(()=>v.addToScene(C),[C,v]),(0,S.useEffect)(()=>{const g={};if(p){if(e!==p.title&&(g.title=e),t!==p.description&&(g.description=t),r!==p.displayMode&&(g.displayMode=r),a!==p.hoverHeader&&(g.hoverHeader=a),o!==p.hoverHeaderOffset&&(g.hoverHeaderOffset=o),f!==p.menu&&(g.menu=f),h!==p.titleItems&&(g.titleItems=h),l!==p.headerActions&&(g.headerActions=l),n!==p.dataProvider&&(g.$data=ce(n)),d!==p.seriesLimit&&(g.seriesLimit=d),u!==p.seriesLimitShowAll&&(g.seriesLimitShowAll=u),E!==p.collapsible&&(g.collapsible=E),y!==p.collapsed&&(g.collapsed=y),i!==p.viz&&i.pluginId===p.viz.pluginId){const I=C.getPlugin();if(I){const F=(0,Pe.F)({plugin:I,currentOptions:i.options,currentFieldConfig:i.fieldConfig,isAfterPluginChange:!1});g.options=F.options,g.fieldConfig=F.fieldConfig,C.clearFieldConfigCache()}}Object.keys(g).length>0&&(C.setState(g),O("VizPanel","Updating VizPanel state",g))}},[C,e,t,r,a,o,l,f,h,i,n,d,u,E,y,p]),S.createElement(C.Component,{model:C})}function ce(s){return s&&!(s instanceof w.Zv)?new w.wT({source:s.getRef()}):s}function rt(s){const e=useSceneContext(),t=useId(),i=usePrevious(s);let n=e.findByKey(t);return n||(n=new SceneRefreshPicker({key:t,...s})),useEffect(()=>e.addToScene(n),[n,e]),useEffect(()=>{const r={};i&&(s.refresh!==i.refresh&&(r.refresh=s.refresh),s.withText!==i.withText&&(r.withText=s.withText),n.setState(r))},[n,s,i]),React.createElement(n.Component,{model:n})}function at({name:s}){const e=useSceneContext(),t=sceneGraph.getDataLayers(e),i=Re(t,s);return i?React.createElement(i.Component,{model:i}):React.createElement("div",null,"Annotation ",s," not found")}function Re(s,e){for(let t=0;t<s.length;t++){const i=s[t].state.layers.find(n=>n.state.name===e);if(i)return i}}function ot({query:s,name:e,label:t,hide:i,initialValue:n,isMulti:r,includeAll:a,skipUrlSync:o,children:l}){const f=useSceneContext(),[h,c]=useState();let d=f.findVariable(e);return d||(d=new CustomVariable$1({name:e,label:t,query:s,value:n,isMulti:r,includeAll:a,hide:i,skipUrlSync:o})),useEffect(()=>{const u=f.addVariable(d);return c(!0),u},[d,f,e]),useEffect(()=>{d?.setState({label:t,query:s,hide:i,isMulti:r,includeAll:a,skipUrlSync:o})},[o,i,a,r,t,s,d]),h?l:null}function lt({pluginId:s,regex:e,name:t,label:i,hide:n,initialValue:r,isMulti:a,includeAll:o,skipUrlSync:l,children:f}){const h=useSceneContext(),[c,d]=useState();let u=h.findVariable(t);return u||(u=new DataSourceVariable$1({pluginId:s,regex:e,name:t,label:i,value:r,isMulti:a,hide:n,includeAll:o,skipUrlSync:l})),useEffect(()=>{const E=h.addVariable(u);return d(!0),E},[u,h,t]),useEffect(()=>{c&&(u.state.pluginId===s&&u.state.regex===e&&u.state.label===i&&u.state.hide===n&&u.state.includeAll===o&&u.state.skipUrlSync===l||(u.setState({pluginId:s,regex:e,label:i,hide:n,includeAll:o,skipUrlSync:l}),u.refreshOptions()))},[l,n,o,i,s,e,u,c]),c?f:null}function ht({query:s,name:e,datasource:t,label:i,hide:n,regex:r,refresh:a,sort:o,initialValue:l,isMulti:f,includeAll:h,skipUrlSync:c,children:d}){const u=useSceneContext(),[E,y]=useState();let v=u.findVariable(e);return v||(v=new QueryVariable$1({name:e,label:i,query:s,datasource:t,refresh:a,sort:o,regex:r,value:l,isMulti:f,hide:n,includeAll:h,skipUrlSync:c})),useEffect(()=>{const m=u.addVariable(v);return y(!0),m},[v,u,e]),useEffect(()=>{E&&(isEqual(v.state.query,s)&&isEqual(v.state.datasource,t)&&v.state.regex===r&&v.state.label===i&&v.state.hide===n&&v.state.includeAll===h&&v.state.refresh===a&&v.state.sort===o&&v.state.skipUrlSync===c||(v.setState({label:i,query:s,datasource:t,refresh:a,sort:o,regex:r,hide:n,includeAll:h,skipUrlSync:c}),v.refreshOptions()))},[c,t,n,h,i,s,a,r,o,v,E]),E?d:null}const ue=(0,S.createContext)({breadcrumbs:[],addBreadcrumb:()=>{},removeBreadcrumb:()=>{}});function ct({children:s}){const[e,t]=useState([]);return React.createElement(ue.Provider,{value:{breadcrumbs:e,addBreadcrumb:useCallback(i=>t(n=>[...n,i]),[]),removeBreadcrumb:useCallback(i=>t(n=>n.filter(r=>r.url!==i.url)),[])}},s)}function ut({text:s,path:e,extraKeys:t}){const{addBreadcrumb:i,removeBreadcrumb:n}=useContext(ue),r=ze();return useEffect(()=>{const a={text:s,url:r(e,t)};return i(a),()=>{n(a)}},[s,e,t,i,r,n]),null}function ze(){const s=Ve()[0],e=useVariables(),[t,i]=useTimeRange();return useCallback((n,r)=>{const a={};for(const o of e)if(o.urlSync&&!o.state.skipUrlSync){const l=o.urlSync.getUrlState();Object.assign(a,l)}if(i.urlSync){const o=i.urlSync.getUrlState();Object.assign(a,o)}if(r)for(const o of r)s[o]&&(a[o]=s[o]);return urlUtil.renderUrl(n,a)},[e,s,i])}function Ve(){const{search:s}=useLocation(),e=useMemo(()=>locationSearchToObject(s||""),[s]),t=useCallback((i,n)=>locationService.partial(i,n),[]);return[e,t]}function ft(s){const e=useSceneContext(),t=sceneGraph.lookupVariable(s,e);if(!t)return[void 0,!1];t.useState();const n=t.parent.isVariableLoadingOrWaitingToUpdate(t);let r=t.getValue();return r==null?[void 0,n]:(Array.isArray(r)||(r=[r]),[r,n])}function dt(s){const e=useSceneContext();let t=sceneGraph.lookupVariable(s.name,e);return t||(t=new QueryVariable({name:s.name,datasource:{uid:s.datasource},query:s.query,regex:s.regex})),t instanceof QueryVariable||(t=null),useEffect(()=>{t&&e.addVariable(t)},[t,e]),useEffect(()=>{var i;(((i=t?.state.datasource)==null?void 0:i.uid)!==s.datasource||!isEqual(t?.state.query,s.query)||t?.state.regex!==s.regex)&&(t?.setState({datasource:{uid:s.datasource},query:s.query,regex:s.regex}),t?.refreshOptions())},[s,t]),t}function gt(s){const e=useSceneContext(),t=sceneGraph.lookupVariable(s,e);if(!t||t instanceof MultiValueVariable&&t.state.isMulti===!0)return[void 0,!1];t.useState();const n=t.parent.isVariableLoadingOrWaitingToUpdate(t);let r=t.getValue();return r==null?[void 0,n]:[r,n]}function mt({name:s,query:e,children:t}){const i=useSceneContext(),[n,r]=useState();let a=Le(i,s);return a||(a=new dataLayers.AnnotationsDataLayer({name:s,query:e})),useEffect(()=>{const o=De(i,a);return r(!0),o},[i,s,a]),useEffect(()=>{},[n]),n?t:null}function Le(s,e){const t=s.state.$data;if(t)return t.state.layers.find(i=>i.state.name===e)}function De(s,e){let t=s.state.$data;return t?t.setState({layers:[...t.state.layers,e]}):(t=new SceneDataLayerSet({layers:[e]}),s.setState({$data:t})),writeSceneLog("SceneContext",`Adding annotation data layer: ${e.state.name} key: ${e.state.key}`),()=>{t.setState({layers:t.state.layers.filter(i=>i!==e)}),writeSceneLog("SceneContext",`Removing annotation data layer: ${e.state.name} key: ${e.state.key}`)}}class We extends w.P1{constructor(e){super({...e,context:new ie})}}We.Component=({model:s})=>S.createElement($.Provider,{value:s.state.context},S.createElement(w.P1.Component,{model:s}));var Ue=b(63142);function $e({children:s,minWidth:e=400,minHeight:t=320}){const i=(0,Ue.$j)(),n={display:"grid",flexGrow:1,gridTemplateColumns:`repeat(auto-fit, minmax(${e}px, 1fr))`,gridAutoRows:`minmax(${t}px, auto)`,columnGap:i.spacing(1),rowGap:i.spacing(1)};return S.createElement("div",{style:n},s)}var je=b(13791),M=b(92745),Ge=b(97095),Z=b(18027),Y=b(18857);function ke({provider:s,filteredProvider:e,filter:t,onChange:i}){const{pluginIds:n,extensionPointIds:r,severity:a}=Me(s,e,t),o=h=>{const c={...t,pluginIds:J(h)};(0,x.isEmpty)(t.extensionPointIds)&&(0,x.isEmpty)(t.severity)&&(c.initial=(0,x.isEmpty)(h)?void 0:"pluginId"),i(c)},l=h=>{const c={...t,extensionPointIds:J(h)};(0,x.isEmpty)(t.pluginIds)&&(0,x.isEmpty)(t.severity)&&(c.initial=(0,x.isEmpty)(h)?void 0:"extensionPointId"),i(c)},f=h=>{const c={...t,severity:J(h)};(0,x.isEmpty)(t.pluginIds)&&(0,x.isEmpty)(t.extensionPointIds)&&(c.initial=(0,x.isEmpty)(h)?void 0:"severity"),i(c)};return(0,A.jsxs)(Ge.C,{children:[(0,A.jsx)(Z.I,{label:(0,M.t)("plugins.log-view-filters.label-plugin-id","Plugin Id"),children:(0,A.jsx)(Y.KF,{options:n,onChange:o})}),(0,A.jsx)(Z.I,{label:(0,M.t)("plugins.log-view-filters.label-extension","Extension"),children:(0,A.jsx)(Y.KF,{options:r,onChange:l})}),(0,A.jsx)(Z.I,{label:(0,M.t)("plugins.log-view-filters.label-severity","Severity"),children:(0,A.jsx)(Y.KF,{options:a,onChange:f})})]})}function Me(s,e,t){const{data:i}=s.useState(),{data:n}=e.useState();return(0,S.useMemo)(()=>{i&&i?.series.length>1&&console.warn("LogViewFilter does not support multiple series in query result.");const r=i?.series[0],a=n?.series[0];if(!r)return{pluginIds:[],extensionPointIds:[],severity:[]};if(!a)return U({severity:r,pluginId:r,extensionPointId:r});switch(t.initial){case"extensionPointId":return U({severity:a,pluginId:a,extensionPointId:r});case"severity":return U({severity:r,pluginId:a,extensionPointId:a});case"pluginId":return U({severity:a,pluginId:r,extensionPointId:a});default:return U({severity:r,pluginId:r,extensionPointId:r})}},[i,n,t])}function J(s){if(!(s.length<=0))return s.reduce((e,t)=>(t.value&&e.add(t.value),e),new Set)}function q(s){return Array.from(s).reduce((e,t)=>(t&&e.push({value:t,label:t}),e),[])}function U(s){const{severity:e,pluginId:t,extensionPointId:i}=s,n=e.fields.findIndex(h=>h.name==="severity"),r=t.fields.findIndex(h=>h.name==="pluginId"),a=i.fields.findIndex(h=>h.name==="extensionPointId"),o=new Set(e.fields[n].values),l=new Set(t.fields[r].values),f=new Set(i.fields[a].values);return{severity:q(o),pluginIds:q(l),extensionPointIds:q(f)}}var fe=b(29405),de=b(28105),ge=b(41119),He=b(39443),z=b(95004);class Be extends w.UU{constructor(e,t,i){super(e,t),this.pluginId=e,this.uid=t,this.extensionsLog=i}query(e){const[t]=e.targets;return this.extensionsLog.asObservable().pipe((0,fe.S)((i,n)=>{const[r]=i.data;return{data:[_e(t,n,r)],key:t.key??t.refId,state:de.Gu.Streaming}},{data:[],key:t.key??t.refId,state:de.Gu.Streaming}))}testDatasource(){return Promise.resolve({status:"success",message:(0,M.t)("plugins.extensions-log-data-source.message.ok","OK")})}}function _e(s,e,t){const i=t?.fields?.[0]?.values??[],n=t?.fields?.[1]?.values??[],r=t?.fields?.[2]?.values??[],a=t?.fields?.[3]?.values??[],o=t?.fields?.[4]?.values??[],l=t?.fields?.[5]?.values??[],f=t?.fields?.[6]?.values??[];return(0,ge.EI)({refId:s.refId,meta:{type:He.m.LogLines},fields:[{name:"timestamp",type:z.PU.time,values:[e.timestamp,...i]},{name:"body",type:z.PU.string,values:[e.message,...n]},{name:"severity",type:z.PU.string,values:[e.level,...r]},{name:"id",type:z.PU.string,values:[e.id,...a]},{name:"labels",type:z.PU.other,values:[e.labels,...o]},{name:"pluginId",type:z.PU.string,values:[e.pluginId??null,...l]},{name:"extensionPointId",type:z.PU.string,values:[e.extensionPointId??null,...f]}]})}function Ke(s){return function(){return function(t){return t.pipe((0,fe.S)((i,n)=>{if((0,x.isEmpty)(s.extensionPointIds)&&(0,x.isEmpty)(s.pluginIds)&&(0,x.isEmpty)(s.severity))return n;for(const r of n){const a=r.fields.findIndex(h=>h.name==="pluginId"),o=r.fields.findIndex(h=>h.name==="extensionPointId"),l=r.fields.findIndex(h=>h.name==="severity");if(a===-1&&!(0,x.isEmpty)(s.pluginIds)||o===-1&&!(0,x.isEmpty)(s.extensionPointIds)||l===-1&&!(0,x.isEmpty)(s.severity))continue;const f={...r,fields:r.fields.map(h=>({...h,values:[]}))};for(let h=0;h<r.length;h++){const c=r.fields[a].values[h],d=r.fields[o].values[h],u=r.fields[l].values[h];!(0,x.isEmpty)(s.pluginIds)&&!s.pluginIds?.has(c)||!(0,x.isEmpty)(s.extensionPointIds)&&!s.extensionPointIds?.has(d)||!(0,x.isEmpty)(s.severity)&&!s.severity?.has(u)||Ne(r,f,h)}i.push((0,ge.EI)(f))}return i},[]))}}}function Ne(s,e,t){for(let i=0;i<s.fields.length;i++){const n=s.fields[i];e.fields[i]||(e.fields[i]={...n,values:[]});const r=s.fields[i].values[t];e.fields[i].values?.push(r)}}var Qe=b(96016);const X={uid:(0,ve.Ak)(),type:"grafana-extensionslog-datasource"},Ze=w.Uf.logs().setOption("wrapLogMessage",!0).build();w.Go.registerRuntimeDataSource({dataSource:new Be(X.type,X.uid,Qe.R)});function Ye(){return(0,A.jsx)(ye,{children:(0,A.jsx)(Je,{})})}function Je(){const[s,e]=(0,S.useState)({}),t=Ae({datasource:X,queries:[{refId:"A"}],liveStreaming:!0}),i=Te({transformations:[Ke(s)],data:t});return(0,A.jsx)(je.Y,{navId:"extensions",actions:(0,A.jsx)(ke,{provider:t,filteredProvider:i,filter:s,onChange:e}),children:(0,A.jsx)(pe.Ay,{children:({height:n,width:r})=>(0,A.jsx)($e,{minHeight:n,minWidth:r,children:(0,A.jsx)(Oe,{title:"",viz:Ze,dataProvider:i})})})})}}}]);

//# sourceMappingURL=PluginExtensionsLog.094cd8fced065d12fff8.js.map