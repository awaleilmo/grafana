"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[8054],{698:(he,D,o)=>{o.r(D),o.d(D,{UserAdminPage:()=>xe,default:()=>ze});var e=o(74848),u=o(96540),w=o(71468),T=o(54148),n=o(92745),k=o(62061),P=o(41654),R=o(13791),d=o(73427),h=o(11257),U=o(80011),x=o(45861),L=o(11297);const K="dddd YYYY-MM-DD HH:mm zz",q="/admin/authentication/ldap";class _ extends u.PureComponent{constructor(){super(...arguments),this.onUserSync=()=>{this.props.onUserSync()}}render(){const{ldapSyncInfo:s,user:i}=this.props,r=s&&s.nextSync?(0,U.LE)(s.nextSync,{format:K}):"",l=`${q}?user=${i&&i.login}`,g=d.TP.hasPermission(h.w.LDAPUsersRead),m=d.TP.hasPermission(h.w.LDAPUsersSync);return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("h3",{className:"page-heading",children:(0,e.jsx)(n.x6,{i18nKey:"admin.ldap-sync.title",children:"LDAP Synchronisation"})}),(0,e.jsxs)("div",{className:"gf-form-group",children:[(0,e.jsx)("div",{className:"gf-form",children:(0,e.jsx)("table",{className:"filter-table form-inline",children:(0,e.jsxs)("tbody",{children:[(0,e.jsxs)("tr",{children:[(0,e.jsx)("td",{children:(0,e.jsx)(n.x6,{i18nKey:"admin.ldap-sync.external-sync-label",children:"External sync"})}),(0,e.jsx)("td",{children:(0,e.jsx)(n.x6,{i18nKey:"admin.ldap-sync.external-sync-description",children:"User synced via LDAP. Some changes must be done in LDAP or mappings."})}),(0,e.jsx)("td",{children:(0,e.jsx)(L.E,{label:(0,n.t)("admin.user-ldap-sync-info.label-ldap","LDAP"),removeIcon:!1,count:0,onClick:void 0})})]}),(0,e.jsxs)("tr",{children:[(0,e.jsx)("td",{children:(0,e.jsx)(n.x6,{i18nKey:"admin.ldap-sync.next-sync-label",children:"Next scheduled synchronization"})}),(0,e.jsx)("td",{colSpan:2,children:s.enabled?r:(0,e.jsx)(n.x6,{i18nKey:"admin.ldap-sync.not-enabled",children:"Not enabled"})})]})]})})}),(0,e.jsxs)("div",{className:"gf-form-button-row",children:[m&&(0,e.jsx)(x.$n,{variant:"secondary",onClick:this.onUserSync,children:(0,e.jsx)(n.x6,{i18nKey:"admin.ldap-sync.sync-button",children:"Sync user"})}),g&&(0,e.jsx)(x.z9,{variant:"secondary",href:l,children:(0,e.jsx)(n.x6,{i18nKey:"admin.ldap-sync.debug-button",children:"Debug LDAP Mapping"})})]})]})]})}}var c=o(22803),E=o(90382),$=o(65240),A=o(7075),I=o(63142),V=o(22787),X=o(37386),Z=o(45967),H=o(89640),M=o(30703),J=o(91087),z=o(34418),F=o(41053),fe=o(68143),pe=o(18857);function ue(t){return{value:t,label:t.name}}function je({onSelected:t,className:s,inputId:i,autoFocus:a,excludeOrgs:r,defaultOrganization:l}){const[g,m]=(0,u.useState)(l?ue(l):void 0);(0,u.useEffect)(()=>{a&&i&&document.getElementById(i)?.focus()},[a,i]);const[O,p]=(0,F.A)(async()=>{const j=(await(0,fe.AI)().get("/api/orgs")).map(ue);if(r){let C=r.map(b=>b.orgId);return j.filter(b=>b.value!==void 0&&!C.includes(b.value.id))}else return j});return(0,e.jsx)(pe.DW,{inputId:i,className:s,isLoading:O.loading,defaultOptions:!0,loadOptions:p,filterOption:(f,j)=>{const C=j.toLowerCase();return!!f.value?.name.toLowerCase().includes(C)},onChange:f=>{t(f),m(f)},value:g,placeholder:(0,n.t)("org-picker.select-placeholder","Select organization"),noOptionsMessage:(0,n.t)("org-picker.noOptionsMessage-no-organizations-found","No organizations found")})}var ve=o(9390);class Ce extends u.PureComponent{constructor(){super(...arguments),this.addToOrgButtonRef=(0,u.createRef)(),this.state={showAddOrgModal:!1},this.showOrgAddModal=()=>{this.setState({showAddOrgModal:!0})},this.dismissOrgAddModal=()=>{this.setState({showAddOrgModal:!1},()=>{this.addToOrgButtonRef.current?.focus()})}}render(){const{user:s,orgs:i,isExternalUser:a,onOrgRoleChange:r,onOrgRemove:l,onOrgAdd:g}=this.props,{showAddOrgModal:m}=this.state,O=d.TP.hasPermission(h.w.OrgUsersAdd)&&!a;return(0,e.jsxs)("div",{children:[(0,e.jsx)("h3",{className:"page-heading",children:(0,e.jsx)(n.x6,{i18nKey:"admin.user-orgs.title",children:"Organizations"})}),(0,e.jsxs)(P.B,{gap:1.5,direction:"column",children:[(0,e.jsx)("table",{className:"filter-table form-inline",children:(0,e.jsx)("tbody",{children:i.map((p,f)=>(0,e.jsx)(Re,{isExternalUser:a,user:s,org:p,onOrgRoleChange:r,onOrgRemove:l},`${p.orgId}-${f}`))})}),(0,e.jsx)("div",{children:O&&(0,e.jsx)(x.$n,{variant:"secondary",onClick:this.showOrgAddModal,ref:this.addToOrgButtonRef,children:(0,e.jsx)(n.x6,{i18nKey:"admin.user-orgs.add-button",children:"Add user to organization"})})}),(0,e.jsx)(be,{user:s,userOrgs:i,isOpen:m,onOrgAdd:g,onDismiss:this.dismissOrgAddModal})]})]})}}const ye=(0,$.N)(t=>({removeButton:(0,c.css)({marginRight:"0.6rem",textDecoration:"underline",color:t.v1.palette.blue95}),label:(0,c.css)({fontWeight:500}),disabledTooltip:(0,c.css)({display:"flex"}),tooltipItem:(0,c.css)({marginLeft:"5px"}),tooltipItemLink:(0,c.css)({color:t.v1.palette.blue95}),rolePickerWrapper:(0,c.css)({display:"flex"}),rolePicker:(0,c.css)({flex:"auto",marginRight:t.spacing(1)})}));class Pe extends u.PureComponent{constructor(){super(...arguments),this.state={currentRole:this.props.org.role,isChangingRole:!1,roleOptions:[]},this.onOrgRemove=async()=>{const{org:s}=this.props;this.props.onOrgRemove(s.orgId)},this.onChangeRoleClick=()=>{const{org:s}=this.props;this.setState({isChangingRole:!0,currentRole:s.role})},this.onOrgRoleChange=s=>{this.setState({currentRole:s})},this.onOrgRoleSave=()=>{this.props.onOrgRoleChange(this.props.org.orgId,this.state.currentRole)},this.onCancelClick=()=>{this.setState({isChangingRole:!1})},this.onBasicRoleChange=s=>{this.props.onOrgRoleChange(this.props.org.orgId,s)}}componentDidMount(){d.TP.licensedAccessControlEnabled()&&d.TP.hasPermission(h.w.ActionRolesList)&&(0,z.RL)(this.props.org.orgId).then(s=>this.setState({roleOptions:s})).catch(s=>console.error(s))}render(){const{user:s,org:i,isExternalUser:a,theme:r}=this.props,l=s?.authLabels?.length&&s?.authLabels[0],g=l?`Synced via ${l}`:"",{currentRole:m,isChangingRole:O}=this.state,p=ye(r),f=(0,c.cx)("width-16",p.label),j=d.TP.hasPermission(h.w.OrgUsersWrite),C=d.TP.hasPermission(h.w.OrgUsersRemove)&&!a,b=a||!j,N=`${i.name}-input`;return(0,e.jsxs)("tr",{children:[(0,e.jsx)("td",{className:f,children:(0,e.jsx)("label",{htmlFor:N,children:i.name})}),d.TP.licensedAccessControlEnabled()?(0,e.jsx)("td",{children:(0,e.jsxs)("div",{className:p.rolePickerWrapper,children:[(0,e.jsx)("div",{className:p.rolePicker,children:(0,e.jsx)(J.y,{userId:s?.id||0,orgId:i.orgId,basicRole:i.role,roleOptions:this.state.roleOptions,onBasicRoleChange:this.onBasicRoleChange,basicRoleDisabled:b,basicRoleDisabledMessage:`This user's role is not editable because it is synchronized from your auth provider.
                    Refer to the Grafana authentication docs for details.`})}),a&&(0,e.jsx)(ge,{lockMessage:g})]})}):(0,e.jsxs)(e.Fragment,{children:[O?(0,e.jsx)("td",{children:(0,e.jsx)(ve.r,{inputId:N,value:m,onChange:this.onOrgRoleChange,autoFocus:!0})}):(0,e.jsx)("td",{className:"width-25",children:i.role}),(0,e.jsx)("td",{colSpan:1,children:j&&(0,e.jsx)(Ue,{lockMessage:g,isExternalUser:a,onChangeRoleClick:this.onChangeRoleClick,onCancelClick:this.onCancelClick,onOrgRoleSave:this.onOrgRoleSave})})]}),(0,e.jsx)("td",{colSpan:1,children:C&&(0,e.jsx)(A.Z,{confirmText:(0,n.t)("admin.un-themed-org-row.confirmText-confirm-removal","Confirm removal"),confirmVariant:"destructive",onCancel:this.onCancelClick,onConfirm:this.onOrgRemove,children:(0,n.t)("admin.user-orgs.remove-button","Remove from organization")})})]})}}const Re=(0,I.cV)(Pe),Oe=(0,$.N)(()=>({modal:(0,c.css)({width:"500px"}),buttonRow:(0,c.css)({textAlign:"center"}),modalContent:(0,c.css)({overflow:"visible"})}));class be extends u.PureComponent{constructor(){super(...arguments),this.state={selectedOrg:null,role:E.X.Viewer,roleOptions:[],pendingOrgId:null,pendingUserId:null,pendingRoles:[]},this.onOrgSelect=s=>{const i=this.props.userOrgs.find(a=>a.orgId===s.value?.id);this.setState({selectedOrg:s.value,role:i?.role||E.X.Viewer}),d.TP.licensedAccessControlEnabled()&&d.TP.hasPermission(h.w.ActionRolesList)&&(0,z.RL)(s.value?.id).then(a=>this.setState({roleOptions:a})).catch(a=>console.error(a))},this.onOrgRoleChange=s=>{this.setState({role:s})},this.onAddUserToOrg=async()=>{const{selectedOrg:s,role:i}=this.state;this.props.onOrgAdd(s.id,i),d.TP.licensedAccessControlEnabled()&&d.TP.hasPermission(h.w.ActionUserRolesAdd)&&this.state.pendingUserId&&(await(0,z.eA)(this.state.pendingRoles,this.state.pendingUserId,this.state.pendingOrgId),this.setState({pendingOrgId:null,pendingRoles:[],pendingUserId:null}))},this.onCancel=()=>{this.setState({selectedOrg:null,pendingRoles:[],pendingOrgId:null,pendingUserId:null}),this.props.onDismiss&&this.props.onDismiss()},this.onRoleUpdate=async(s,i,a)=>{this.setState({pendingRoles:s,pendingOrgId:a,pendingUserId:i})}}render(){const{isOpen:s,user:i,userOrgs:a}=this.props,{role:r,roleOptions:l,selectedOrg:g}=this.state,m=Oe();return(0,e.jsxs)(V.a,{className:m.modal,contentClassName:m.modalContent,title:(0,n.t)("admin.add-to-org-modal.title-add-to-an-organization","Add to an organization"),isOpen:s,onDismiss:this.onCancel,children:[(0,e.jsx)(X.D,{label:(0,n.t)("admin.add-to-org-modal.label-organization","Organization"),children:(0,e.jsx)(je,{inputId:"new-org-input",onSelected:this.onOrgSelect,excludeOrgs:a,autoFocus:!0})}),(0,e.jsx)(X.D,{label:(0,n.t)("admin.add-to-org-modal.label-role","Role"),disabled:g===null,children:(0,e.jsx)(J.y,{userId:i?.id||0,orgId:g?.id,basicRole:r,onBasicRoleChange:this.onOrgRoleChange,basicRoleDisabled:!1,roleOptions:l,apply:!0,onApplyRoles:this.onRoleUpdate,pendingRoles:this.state.pendingRoles})}),(0,e.jsx)(V.a.ButtonRow,{children:(0,e.jsxs)(P.B,{gap:2,justifyContent:"center",children:[(0,e.jsx)(x.$n,{variant:"secondary",fill:"outline",onClick:this.onCancel,children:(0,e.jsx)(n.x6,{i18nKey:"admin.user-orgs-modal.cancel-button",children:"Cancel"})}),(0,e.jsx)(x.$n,{variant:"primary",disabled:g===null,onClick:this.onAddUserToOrg,children:(0,e.jsx)(n.x6,{i18nKey:"admin.user-orgs-modal.add-button",children:"Add to organization"})})]})})]})}}const Se=t=>({disabledTooltip:(0,c.css)({display:"flex"}),tooltipItemLink:(0,c.css)({color:t.v1.palette.blue95}),lockMessageClass:(0,c.css)({fontStyle:"italic",marginLeft:"1.8rem",marginRight:"0.6rem"}),icon:(0,c.css)({lineHeight:2})});function Ue({lockMessage:t,onChangeRoleClick:s,isExternalUser:i,onOrgRoleSave:a,onCancelClick:r}){const l=(0,I.of)(Se);return(0,e.jsx)("div",{className:l.disabledTooltip,children:i?(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("span",{className:l.lockMessageClass,children:t}),(0,e.jsx)(Z.m,{placement:"right-end",interactive:!0,content:(0,e.jsx)("div",{children:(0,e.jsxs)(n.x6,{i18nKey:"admin.user-orgs.role-not-editable",children:["This user's role is not editable because it is synchronized from your auth provider. Refer to the\xA0",(0,e.jsx)(H.Y,{href:"https://grafana.com/docs/grafana/latest/auth",external:!0,children:"Grafana authentication docs"}),"\xA0for details."]})}),children:(0,e.jsx)("div",{className:l.icon,children:(0,e.jsx)(M.I,{name:"question-circle"})})})]}):(0,e.jsx)(A.Z,{confirmText:(0,n.t)("admin.change-org-button.confirmText-save","Save"),onClick:s,onCancel:r,onConfirm:a,disabled:i,children:(0,n.t)("admin.user-orgs.change-role-button","Change role")})})}const ge=({lockMessage:t})=>{const s=(0,I.of)(Ae);return(0,e.jsxs)("div",{className:s.disabledTooltip,children:[(0,e.jsx)("span",{className:s.lockMessageClass,children:t}),(0,e.jsx)(Z.m,{placement:"right-end",interactive:!0,content:(0,e.jsx)("div",{children:(0,e.jsxs)(n.x6,{i18nKey:"admin.user-orgs.external-user-tooltip",children:["This user's built-in role is not editable because it is synchronized from your auth provider. Refer to the\xA0",(0,e.jsx)(H.Y,{href:"https://grafana.com/docs/grafana/latest/auth",external:!0,children:"Grafana authentication docs"}),"\xA0for details."]})}),children:(0,e.jsx)(M.I,{name:"question-circle"})})]})},Ae=t=>({disabledTooltip:(0,c.css)({display:"flex"}),lockMessageClass:(0,c.css)({fontStyle:"italic",marginLeft:"1.8rem",marginRight:"0.6rem"})});var Te=o(77824);const Me=[{label:"Yes",value:!0},{label:"No",value:!1}];function De({isGrafanaAdmin:t,isExternalUser:s,lockMessage:i,onGrafanaAdminChange:a}){const[r,l]=(0,u.useState)(!1),[g,m]=(0,u.useState)(t),O=()=>l(!0),p=()=>{l(!1),m(t)},f=()=>a(g),j=d.TP.hasPermission(h.w.UsersPermissionsUpdate)&&!s,C=(0,I.of)(Le);return(0,e.jsxs)("div",{children:[(0,e.jsx)("h3",{className:"page-heading",children:(0,e.jsx)(n.x6,{i18nKey:"admin.user-permissions.title",children:"Permissions"})}),(0,e.jsx)("table",{className:"filter-table form-inline",children:(0,e.jsx)("tbody",{children:(0,e.jsxs)("tr",{children:[(0,e.jsx)("td",{className:"width-16",children:(0,e.jsx)(n.x6,{i18nKey:"admin.user-permissions.grafana-admin-key",children:"Grafana Admin"})}),r?(0,e.jsx)("td",{colSpan:2,children:(0,e.jsx)(Te.z,{options:Me,value:g,onChange:m,autoFocus:!0})}):(0,e.jsx)("td",{colSpan:2,children:t?(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(M.I,{name:"shield"})," ",(0,e.jsx)(n.x6,{i18nKey:"admin.user-permissions.grafana-admin-yes",children:"Yes"})]}):(0,e.jsx)(n.x6,{i18nKey:"admin.user-permissions.grafana-admin-no",children:"No"})}),(0,e.jsxs)("td",{children:[j&&(0,e.jsx)(A.Z,{onClick:O,onConfirm:f,onCancel:p,confirmText:(0,n.t)("admin.user-permissions.confirmText-change","Change"),children:(0,n.t)("admin.user-permissions.change-button","Change")}),s&&(0,e.jsx)("div",{className:C.lockMessageClass,children:(0,e.jsx)(ge,{lockMessage:i})})]})]})})})]})}const Le=t=>({lockMessageClass:(0,c.css)({display:"flex",justifyContent:"flex-end",fontStyle:"italic",marginRight:t.spacing(.6)})});var ee=o(71599),me=o(32581),Ee=o(63527);function Ie({user:t,onUserUpdate:s,onUserDelete:i,onUserDisable:a,onUserEnable:r,onPasswordChange:l}){const[g,m]=(0,u.useState)(!1),[O,p]=(0,u.useState)(!1),f=(0,u.useRef)(null),j=y=>()=>{m(y),!y&&f.current&&f.current.focus()},C=(0,u.useRef)(null),b=y=>()=>{p(y),!y&&C.current&&C.current.focus()},N=()=>i(t.uid),se=()=>a(t.uid),ne=()=>r(t.uid),te=y=>{s({...t,name:y})},Q=y=>{s({...t,email:y})},oe=y=>{s({...t,login:y})};let Y=t.authLabels?.length&&t.authLabels[0];t.isProvisioned&&(Y="SCIM");const B=Y?`Synced via ${Y}`:"",G=t.isExternal||t.isProvisioned||!d.TP.hasPermissionInMetadata(h.w.UsersWrite,t),ie=t.isExternal||t.isProvisioned||!d.TP.hasPermissionInMetadata(h.w.UsersPasswordUpdate,t),ae=d.TP.hasPermissionInMetadata(h.w.UsersDelete,t),re=d.TP.hasPermissionInMetadata(h.w.UsersDisable,t),le=d.TP.hasPermissionInMetadata(h.w.UsersEnable,t);return(0,e.jsxs)("div",{children:[(0,e.jsx)("h3",{className:"page-heading",children:(0,e.jsx)(n.x6,{i18nKey:"admin.user-profile.title",children:"User information"})}),(0,e.jsxs)(P.B,{direction:"column",gap:1.5,children:[(0,e.jsx)("div",{children:(0,e.jsx)("table",{className:"filter-table form-inline",children:(0,e.jsxs)("tbody",{children:[(0,e.jsx)(W,{label:(0,n.t)("admin.user-profile.label-numerical-identifier","Numerical identifier"),value:t.id.toString(),locked:!0}),(0,e.jsx)(W,{label:(0,n.t)("admin.user-profile.label-name","Name"),value:t.name,locked:G,lockMessage:B,onChange:te}),(0,e.jsx)(W,{label:(0,n.t)("admin.user-profile.label-email","Email"),value:t.email,locked:G,lockMessage:B,onChange:Q}),(0,e.jsx)(W,{label:(0,n.t)("admin.user-profile.label-username","Username"),value:t.login,locked:G,lockMessage:B,onChange:oe}),(0,e.jsx)(W,{label:(0,n.t)("admin.user-profile.label-password","Password"),value:"********",inputType:"password",locked:ie,lockMessage:B,onChange:l})]})})}),(0,e.jsxs)(P.B,{gap:2,children:[ae&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(x.$n,{variant:"destructive",onClick:j(!0),ref:f,children:(0,e.jsx)(n.x6,{i18nKey:"admin.user-profile.delete-button",children:"Delete user"})}),(0,e.jsx)(ee.u,{isOpen:g,title:(0,n.t)("admin.user-profile.title-delete-user","Delete user"),body:(0,n.t)("admin.user-profile.body-delete","Are you sure you want to delete this user?"),confirmText:(0,n.t)("admin.user-profile.confirmText-delete-user","Delete user"),onConfirm:N,onDismiss:j(!1)})]}),t.isDisabled&&le&&(0,e.jsx)(x.$n,{variant:"secondary",onClick:ne,children:(0,e.jsx)(n.x6,{i18nKey:"admin.user-profile.enable-button",children:"Enable user"})}),!t.isDisabled&&re&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(x.$n,{variant:"secondary",onClick:b(!0),ref:C,children:(0,e.jsx)(n.x6,{i18nKey:"admin.user-profile.disable-button",children:"Disable user"})}),(0,e.jsx)(ee.u,{isOpen:O,title:(0,n.t)("admin.user-profile.title-disable-user","Disable user"),body:(0,n.t)("admin.user-profile.body-disable","Are you sure you want to disable this user?"),confirmText:(0,n.t)("admin.user-profile.confirmText-disable-user","Disable user"),onConfirm:se,onDismiss:b(!1)})]})]})]})]})}class W extends u.PureComponent{constructor(){super(...arguments),this.state={editing:!1,value:this.props.value||""},this.setInputElem=s=>{this.inputElem=s},this.onEditClick=()=>{this.props.inputType==="password"?this.setState({editing:!0,value:""},this.focusInput):this.setState({editing:!0},this.focusInput)},this.onCancelClick=()=>{this.setState({editing:!1,value:this.props.value||""})},this.onInputChange=(s,i)=>{i!==me.O.Invalid&&this.setState({value:s.target.value})},this.onInputBlur=(s,i)=>{i!==me.O.Invalid&&this.setState({value:s.target.value})},this.focusInput=()=>{this.inputElem&&this.inputElem.focus&&this.inputElem.focus()},this.onSave=()=>{this.props.onChange&&this.props.onChange(this.state.value)}}static{this.defaultProps={value:"",locked:!1,lockMessage:"",inputType:"text"}}render(){const{label:s,locked:i,lockMessage:a,inputType:r}=this.props,{value:l}=this.state,g=(0,c.cx)("width-16",(0,c.css)({fontWeight:500}));if(i)return(0,e.jsx)(Ne,{label:s,value:l,lockMessage:a});const m=`${s}-input`;return(0,e.jsxs)("tr",{children:[(0,e.jsx)("td",{className:g,children:(0,e.jsx)("label",{htmlFor:m,children:s})}),(0,e.jsx)("td",{className:"width-25",colSpan:2,children:this.state.editing?(0,e.jsx)(Ee.p,{id:m,type:r,defaultValue:l,onBlur:this.onInputBlur,onChange:this.onInputChange,ref:this.setInputElem,width:30}):(0,e.jsx)("span",{children:this.props.value})}),(0,e.jsx)("td",{children:(0,e.jsx)(A.Z,{confirmText:(0,n.t)("admin.user-profile-row.confirmText-save","Save"),onClick:this.onEditClick,onConfirm:this.onSave,onCancel:this.onCancelClick,children:(0,n.t)("admin.user-profile.edit-button","Edit")})})]})}}const Ne=({label:t,value:s,lockMessage:i})=>{const a=(0,c.css)({fontStyle:"italic",marginRight:"0.6rem"}),r=(0,c.cx)("width-16",(0,c.css)({fontWeight:500}));return(0,e.jsxs)("tr",{children:[(0,e.jsx)("td",{className:r,children:t}),(0,e.jsx)("td",{className:"width-25",colSpan:2,children:s}),(0,e.jsx)("td",{children:(0,e.jsx)("span",{className:a,children:i})})]})};var Be=o(12810);class we extends u.PureComponent{constructor(){super(...arguments),this.forceAllLogoutButton=(0,u.createRef)(),this.state={showLogoutModal:!1},this.showLogoutConfirmationModal=()=>{this.setState({showLogoutModal:!0})},this.dismissLogoutConfirmationModal=()=>{this.setState({showLogoutModal:!1},()=>{this.forceAllLogoutButton.current?.focus()})},this.onSessionRevoke=s=>()=>{this.props.onSessionRevoke(s)},this.onAllSessionsRevoke=()=>{this.setState({showLogoutModal:!1}),this.props.onAllSessionsRevoke()}}render(){const{sessions:s}=this.props,{showLogoutModal:i}=this.state,a=d.TP.hasPermission(h.w.UsersLogout);return(0,e.jsxs)("div",{children:[(0,e.jsx)("h3",{className:"page-heading",children:(0,e.jsx)(n.x6,{i18nKey:"admin.user-sessions.title",children:"Sessions"})}),(0,e.jsxs)(P.B,{direction:"column",gap:1.5,children:[(0,e.jsx)("div",{children:(0,e.jsxs)("table",{className:"filter-table form-inline",children:[(0,e.jsx)("thead",{children:(0,e.jsxs)("tr",{children:[(0,e.jsx)("th",{children:(0,e.jsx)(n.x6,{i18nKey:"admin.user-sessions.last-seen-column",children:"Last seen"})}),(0,e.jsx)("th",{children:(0,e.jsx)(n.x6,{i18nKey:"admin.user-sessions.logged-on-column",children:"Logged on"})}),(0,e.jsx)("th",{children:(0,e.jsx)(n.x6,{i18nKey:"admin.user-sessions.ip-column",children:"IP address"})}),(0,e.jsx)("th",{children:(0,e.jsx)(n.x6,{i18nKey:"admin.user-sessions.browser-column",children:"Browser and OS"})}),(0,e.jsx)("th",{colSpan:2,children:(0,e.jsx)(n.x6,{i18nKey:"user-session.auth-module-column",children:"Identity Provider"})})]})}),(0,e.jsx)("tbody",{children:s&&s.map((r,l)=>(0,e.jsxs)("tr",{children:[(0,e.jsx)("td",{children:r.isActive?(0,n.t)("admin.user-sessions.now","Now"):r.seenAt}),(0,e.jsx)("td",{children:(0,Be.Y)(r.createdAt,{dateStyle:"long"})}),(0,e.jsx)("td",{children:r.clientIp}),(0,e.jsx)("td",{children:`${r.browser} on ${r.os} ${r.osVersion}`}),(0,e.jsx)("td",{children:r.authModule&&(0,e.jsx)(L.E,{label:r.authModule,removeIcon:!1,count:0})}),(0,e.jsx)("td",{children:a&&(0,e.jsx)(A.Z,{confirmText:(0,n.t)("admin.base-user-sessions.confirmText-confirm-logout","Confirm logout"),confirmVariant:"destructive",onConfirm:this.onSessionRevoke(r.id),children:(0,n.t)("admin.user-sessions.force-logout-button","Force logout")})})]},`${r.id}-${l}`))})]})}),(0,e.jsxs)("div",{children:[a&&s.length>0&&(0,e.jsx)(x.$n,{variant:"secondary",onClick:this.showLogoutConfirmationModal,ref:this.forceAllLogoutButton,children:(0,e.jsx)(n.x6,{i18nKey:"admin.user-sessions.force-logout-all-button",children:"Force logout from all devices"})}),(0,e.jsx)(ee.u,{isOpen:i,title:(0,n.t)("admin.base-user-sessions.title-force-logout-from-all-devices","Force logout from all devices"),body:(0,n.t)("admin.base-user-sessions.body-force-logout-from-all-devices","Are you sure you want to force logout from all devices?"),confirmText:(0,n.t)("admin.base-user-sessions.confirmText-force-logout","Force logout"),onConfirm:this.onAllSessionsRevoke,onDismiss:this.dismissLogoutConfirmationModal})]})]})]})}}const ke=we;var v=o(74267);const xe=({loadAdminUserPage:t,user:s,orgs:i,sessions:a,ldapSyncInfo:r,isLoading:l,updateUser:g,setUserPassword:m,deleteUser:O,disableUser:p,enableUser:f,updateUserPermissions:j,deleteOrgUser:C,updateOrgUserRole:b,addOrgUser:N,revokeSession:se,revokeAllSessions:ne,syncLdapUser:te})=>{const{id:Q=""}=(0,T.g)();(0,u.useEffect)(()=>{t(Q)},[Q,t]);const oe=S=>{s&&m(s.uid,S)},Y=S=>{s&&j(s.uid,S)},B=S=>{s&&C(s.uid,S)},G=(S,ce)=>{s&&b(s.uid,S,ce)},ie=(S,ce)=>{s&&N(s,S,ce)},ae=S=>{s&&se(S,s.uid)},re=()=>{s&&ne(s.uid)},le=()=>{s&&te(s.id,s.uid)},y=s?.isExternal&&s?.authLabels?.includes("LDAP"),Fe=d.TP.hasPermission(h.w.UsersAuthTokenList),We=d.TP.hasPermission(h.w.LDAPStatusRead);let de=s?.authLabels?.[0];s?.isProvisioned&&(de="SCIM");const Ye=de?`Synced via ${de}`:"",Ge={text:s?.login??"",icon:"shield",subTitle:(0,n.t)("admin.user-admin-page.page-nav.subTitle.manage-settings-for-an-individual-user","Manage settings for an individual user.")};return(0,e.jsx)(R.Y,{navId:"global-users",pageNav:Ge,children:(0,e.jsx)(R.Y.Contents,{isLoading:l,children:(0,e.jsxs)(P.B,{gap:5,direction:"column",children:[s&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(Ie,{user:s,onUserUpdate:g,onUserDelete:O,onUserDisable:p,onUserEnable:f,onPasswordChange:oe}),y&&s?.isExternallySynced&&(0,k.a)("ldapsync")&&r&&We&&(0,e.jsx)(_,{ldapSyncInfo:r,user:s,onUserSync:le}),(0,e.jsx)(De,{isGrafanaAdmin:s.isGrafanaAdmin,isExternalUser:s?.isGrafanaAdminExternallySynced,lockMessage:Ye,onGrafanaAdminChange:Y})]}),i&&(0,e.jsx)(Ce,{user:s,orgs:i,isExternalUser:s?.isExternallySynced,onOrgRemove:B,onOrgRoleChange:G,onOrgAdd:ie}),a&&Fe&&(0,e.jsx)(ke,{sessions:a,onSessionRevoke:ae,onAllSessionsRevoke:re})]})})})},Ke=t=>({user:t.userAdmin.user,sessions:t.userAdmin.sessions,orgs:t.userAdmin.orgs,ldapSyncInfo:t.ldap.syncInfo,isLoading:t.userAdmin.isLoading,error:t.userAdmin.error}),$e={loadAdminUserPage:v.kz,updateUser:v.TK,setUserPassword:v.ly,disableUser:v.MV,enableUser:v.nr,deleteUser:v.hG,updateUserPermissions:v.N6,addOrgUser:v.nh,updateOrgUserRole:v.P3,deleteOrgUser:v.Pi,revokeSession:v.T$,revokeAllSessions:v.VR,syncLdapUser:v.mI},ze=(0,w.connect)(Ke,$e)(xe)},9390:(he,D,o)=>{o.d(D,{r:()=>P});var e=o(74848),u=o(90382),w=o(92745),T=o(18857);const k=Object.values(u.X).filter(R=>R!==u.X.None).map(R=>({label:R,value:R}));function P({value:R,onChange:d,"aria-label":h,inputId:U,autoFocus:x,...L}){return(0,e.jsx)(T.l6,{inputId:U,value:R,options:k,onChange:K=>d(K.value??u.X.None),placeholder:(0,w.t)("admin.org-role-picker.placeholder-choose-role","Choose role..."),"aria-label":h,autoFocus:x,...L})}},91087:(he,D,o)=>{o.d(D,{y:()=>R});var e=o(74848),u=o(96540),w=o(41053),T=o(73427),n=o(11257),k=o(59812),P=o(34418);const R=({basicRole:d,roles:h,userId:U,orgId:x,onBasicRoleChange:L,roleOptions:K,disabled:q,basicRoleDisabled:_,basicRoleDisabledMessage:c,apply:E=!1,onApplyRoles:$,pendingRoles:A,maxWidth:I,width:V,isLoading:X})=>{const[{loading:Z,value:H=h||[]},M]=(0,w.A)(async()=>{try{if(h)return h;if(E&&A?.length)return A;if(T.TP.hasPermission(n.w.ActionUserRolesList)&&U>0)return await(0,P.Xh)(U,x)}catch{console.error("Error loading options")}return[]},[x,U,A,h]);(0,u.useEffect)(()=>{x&&M()},[M,x]);const J=async F=>{E?$&&$(F,U,x):(await(0,P.eA)(F,U,x),await M())},z=T.TP.hasPermission(n.w.ActionUserRolesAdd)&&T.TP.hasPermission(n.w.ActionUserRolesRemove);return(0,e.jsx)(k.n,{appliedRoles:H,basicRole:d,onRolesChange:J,onBasicRoleChange:L,roleOptions:K,isLoading:Z||X,disabled:q,basicRoleDisabled:_,basicRoleDisabledMessage:c,showBasicRole:!0,apply:E,canUpdateRoles:z,maxWidth:I,width:V})}}}]);

//# sourceMappingURL=UserAdminPage.3ca4ec937afbd15780e3.js.map