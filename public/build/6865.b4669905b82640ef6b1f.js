"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[6865],{59062:(vt,q,s)=>{s.d(q,{L:()=>mt});/**
 * @license
 * Copyright 2019 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const e=Symbol("Comlink.proxy"),c=Symbol("Comlink.endpoint"),d=Symbol("Comlink.releaseProxy"),L=Symbol("Comlink.finalizer"),W=Symbol("Comlink.thrown"),_=t=>typeof t=="object"&&t!==null||typeof t=="function",rt={canHandle:t=>_(t)&&t[e],serialize(t){const{port1:a,port2:o}=new MessageChannel;return U(t,a),[o,[o]]},deserialize(t){return t.start(),$(t)}},tt={canHandle:t=>_(t)&&W in t,serialize({value:t}){let a;return t instanceof Error?a={isError:!0,value:{message:t.message,name:t.name,stack:t.stack}}:a={isError:!1,value:t},[a,[]]},deserialize(t){throw t.isError?Object.assign(new Error(t.value.message),t.value):t.value}},S=new Map([["proxy",rt],["throw",tt]]);function ct(t,a){for(const o of t)if(a===o||o==="*"||o instanceof RegExp&&o.test(a))return!0;return!1}function U(t,a=globalThis,o=["*"]){a.addEventListener("message",function p(l){if(!l||!l.data)return;if(!ct(o,l.origin)){console.warn(`Invalid origin '${l.origin}' for comlink proxy`);return}const{id:f,type:w,path:x}=Object.assign({path:[]},l.data),P=(l.data.argumentList||[]).map(A);let m;try{const y=x.slice(0,-1).reduce((v,z)=>v[z],t),E=x.reduce((v,z)=>v[z],t);switch(w){case"GET":m=E;break;case"SET":y[x.slice(-1)[0]]=A(l.data.value),m=!0;break;case"APPLY":m=E.apply(y,P);break;case"CONSTRUCT":{const v=new E(...P);m=at(v)}break;case"ENDPOINT":{const{port1:v,port2:z}=new MessageChannel;U(t,z),m=gt(v,[v])}break;case"RELEASE":m=void 0;break;default:return}}catch(y){m={value:y,[W]:0}}Promise.resolve(m).catch(y=>({value:y,[W]:0})).then(y=>{const[E,v]=G(y);a.postMessage(Object.assign(Object.assign({},E),{id:f}),v),w==="RELEASE"&&(a.removeEventListener("message",p),nt(a),L in t&&typeof t[L]=="function"&&t[L]())}).catch(y=>{const[E,v]=G({value:new TypeError("Unserializable return value"),[W]:0});a.postMessage(Object.assign(Object.assign({},E),{id:f}),v)})}),a.start&&a.start()}function lt(t){return t.constructor.name==="MessagePort"}function nt(t){lt(t)&&t.close()}function $(t,a){const o=new Map;return t.addEventListener("message",function(l){const{data:f}=l;if(!f||!f.id)return;const w=o.get(f.id);if(w)try{w(f)}finally{o.delete(f.id)}}),Y(t,o,[],a)}function H(t){if(t)throw new Error("Proxy has been released and is not useable")}function V(t){return I(t,new Map,{type:"RELEASE"}).then(()=>{nt(t)})}const F=new WeakMap,K="FinalizationRegistry"in globalThis&&new FinalizationRegistry(t=>{const a=(F.get(t)||0)-1;F.set(t,a),a===0&&V(t)});function et(t,a){const o=(F.get(a)||0)+1;F.set(a,o),K&&K.register(t,a,t)}function dt(t){K&&K.unregister(t)}function Y(t,a,o=[],p=function(){}){let l=!1;const f=new Proxy(p,{get(w,x){if(H(l),x===d)return()=>{dt(f),V(t),a.clear(),l=!0};if(x==="then"){if(o.length===0)return{then:()=>f};const P=I(t,a,{type:"GET",path:o.map(m=>m.toString())}).then(A);return P.then.bind(P)}return Y(t,a,[...o,x])},set(w,x,P){H(l);const[m,y]=G(P);return I(t,a,{type:"SET",path:[...o,x].map(E=>E.toString()),value:m},y).then(A)},apply(w,x,P){H(l);const m=o[o.length-1];if(m===c)return I(t,a,{type:"ENDPOINT"}).then(A);if(m==="bind")return Y(t,a,o.slice(0,-1));const[y,E]=J(P);return I(t,a,{type:"APPLY",path:o.map(v=>v.toString()),argumentList:y},E).then(A)},construct(w,x){H(l);const[P,m]=J(x);return I(t,a,{type:"CONSTRUCT",path:o.map(y=>y.toString()),argumentList:P},m).then(A)}});return et(f,t),f}function ut(t){return Array.prototype.concat.apply([],t)}function J(t){const a=t.map(G);return[a.map(o=>o[0]),ut(a.map(o=>o[1]))]}const X=new WeakMap;function gt(t,a){return X.set(t,a),t}function at(t){return Object.assign(t,{[e]:!0})}function ht(t,a=globalThis,o="*"){return{postMessage:(p,l)=>t.postMessage(p,o,l),addEventListener:a.addEventListener.bind(a),removeEventListener:a.removeEventListener.bind(a)}}function G(t){for(const[a,o]of S)if(o.canHandle(t)){const[p,l]=o.serialize(t);return[{type:"HANDLER",name:a,value:p},l]}return[{type:"RAW",value:t},X.get(t)||[]]}function A(t){switch(t.type){case"HANDLER":return S.get(t.name).deserialize(t.value);case"RAW":return t.value}}function I(t,a,o,p){return new Promise(l=>{const f=ft();a.set(f,l),t.start&&t.start(),t.postMessage(Object.assign({id:f},o),p)})}function ft(){return new Array(4).fill(0).map(()=>Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString(16)).join("-")}var Q=s(96540),Z=s(74268),xt=s(81041);const pt=()=>new xt.c(new URL(s.p+s.u(4254),s.b));let R;function ot(){let t;if(R===void 0)try{t=pt(),R=$(t)}catch(o){o instanceof Error&&(0,Z.vV)(o)}return{disposeWorker:()=>{t&&R&&(R[d](),t.terminate(),R=void 0,t=void 0)}}}function st(t){if(!R)throw new Error("Route Matcher has not been initialized")}function mt(){(0,Q.useEffect)(()=>{const{disposeWorker:o}=ot();return o},[]);const t=(0,Q.useCallback)(async(o,p,l)=>{st(R);const f=performance.now(),w=await R.getRouteGroupsMap(o,p,l),x=performance.now()-f;return(0,Z.fH)(`Route Groups Matched in  ${x} ms`,{matchingTime:x.toString(),alertGroupsCount:p.length.toString(),topLevelRoutesCount:o.routes?.length.toString()??"0"}),w},[]),a=(0,Q.useCallback)(async(o,p,l)=>{st(R);const f=performance.now(),w=await R.matchInstancesToRoute(o,p,l),x=performance.now()-f;return(0,Z.fH)(`Instances Matched in  ${x} ms`,{matchingTime:x.toString(),instancesToMatchCount:p.length.toString(),topLevelRoutesCount:o.routes?.length.toString()??"0"}),w},[]);return{getRouteGroupsMap:t,matchInstancesToRoute:a}}},96865:(vt,q,s)=>{s.r(q),s.d(q,{default:()=>z});var e=s(74848),c=s(22803),d=s(92745),L=s(63142),W=s(34999),_=s(6975),rt=s(36303),tt=s(77256);function S(n){const i=(0,L.of)(ct,n);return(0,e.jsx)("div",{className:i.root,children:n.children})}const ct=(n,i)=>({root:(0,c.css)({display:"flex",flexDirection:i.direction??"row",flexWrap:i.wrap??!0?"wrap":void 0,alignItems:i.alignItems,gap:n.spacing(i.gap??2),flexGrow:i.flexGrow})});var U=s(2543),lt=s(55127),nt=s.n(lt),$=s(96540),H=s(42941),V=s(45861),F=s(48542),K=s(37658),et=s(86017),dt=s(12266),Y=s(1625),ut=s(49779),J=s(92125);function X(n){return n.path?.length===0}function gt(n){const i=new Map;function u(g,j=[]){i.set(g.id,{...g,path:j}),g.routes?.forEach(h=>u(h,[...j,g.id]))}return u(n,[]),i}function at(n){return n.object_matchers?.length===0}function ht({route:n,matcherFormatter:i}){const u=(0,L.of)(G);return X(n)?(0,e.jsx)("div",{className:u.defaultPolicy,children:(0,e.jsx)(d.x6,{i18nKey:"alerting.notification-policy-matchers.default-policy",children:"Default policy"})}):at(n)?(0,e.jsx)("div",{className:u.textMuted,children:(0,e.jsx)(d.x6,{i18nKey:"alerting.notification-policy-matchers.no-matchers",children:"No matchers"})}):(0,e.jsx)(J.s,{matchers:n.object_matchers??[],formatter:i})}const G=n=>({defaultPolicy:(0,c.css)({padding:n.spacing(.5),background:n.colors.background.secondary,width:"fit-content"}),textMuted:(0,c.css)({color:n.colors.text.secondary})});var A=s(22787),I=s(41654),ft=s(89640),Q=s(16692),Z=s(5358),xt=s(24898),pt=s(45967);const ot=({receiverName:n})=>(0,e.jsx)("span",{style:{cursor:"help"},children:(0,e.jsx)(pt.m,{content:(0,d.t)("alerting.unknown-contact-point-details.unknown-contact-point-tooltip","Details could not be found. This may be because you do not have access to the contact point"),children:(0,e.jsx)("span",{children:n||(0,e.jsx)(d.x6,{i18nKey:"alerting.unknown-contact-point-details.unknown-contact-point",children:"Unknown contact point"})})})});function st({route:n,routesByIdMap:i,matcherFormatter:u}){const g=(0,L.of)(t),j=n.path?.slice(1)??[],h=[...(0,U.compact)(j.map(r=>i.get(r))),n];return(0,e.jsxs)("div",{className:g.policyPathWrapper,children:[(0,e.jsx)("div",{className:g.defaultPolicy,children:(0,e.jsx)(d.x6,{i18nKey:"alerting.policy-path.default-policy",children:"Default policy"})}),h.map((r,M)=>(0,e.jsx)("div",{children:(0,e.jsx)("div",{className:g.policyInPath(M,M===h.length-1),children:at(r)?(0,e.jsx)("div",{className:g.textMuted,children:(0,e.jsx)(d.x6,{i18nKey:"alerting.policy-path.no-matchers",children:"No matchers"})}):(0,e.jsx)(J.s,{matchers:r.object_matchers??[],formatter:u})})},r.id))]})}function mt({onClose:n,route:i,receiver:u,receiverNameFromRoute:g,routesByIdMap:j,alertManagerSourceName:h}){const r=(0,L.of)(t),M=X(i);return(0,e.jsx)(Z.b9,{accessType:"notification",alertmanagerSourceName:h,children:(0,e.jsx)(A.a,{className:r.detailsModal,isOpen:!0,title:(0,d.t)("alerting.notification-route-details-modal.title-routing-details","Routing details"),onDismiss:n,onClickBackdrop:n,children:(0,e.jsxs)(I.B,{gap:0,direction:"column",children:[(0,e.jsx)("div",{className:(0,c.cx)(r.textMuted,r.marginBottom(2)),children:(0,e.jsx)(d.x6,{i18nKey:"alerting.notification-route-details-modal.alert-instances-routed-follows",children:"Your alert instances are routed as follows."})}),(0,e.jsx)("div",{children:(0,e.jsx)(d.x6,{i18nKey:"alerting.notification-route-details-modal.notification-policy-path",children:"Notification policy path"})}),M&&(0,e.jsx)("div",{className:r.textMuted,children:(0,e.jsx)(d.x6,{i18nKey:"alerting.notification-route-details-modal.default-policy",children:"Default policy"})}),(0,e.jsx)("div",{className:r.separator(1)}),!M&&(0,e.jsx)(st,{route:i,routesByIdMap:j,matcherFormatter:(0,et.VE)(h)}),(0,e.jsx)("div",{className:r.separator(4)}),(0,e.jsxs)("div",{className:r.contactPoint,children:[(0,e.jsxs)(I.B,{gap:1,direction:"column",children:[(0,e.jsx)(d.x6,{i18nKey:"alerting.notification-route-details-modal.contact-point",children:"Contact point"}),(0,e.jsx)("span",{className:r.textMuted,children:u?u.name:(0,e.jsx)(ot,{receiverName:g})})]}),(0,e.jsx)(xt._,{actions:[Q.QI.UpdateContactPoint],children:(0,e.jsx)(I.B,{gap:1,direction:"row",alignItems:"center",children:u?(0,e.jsx)(ft.Y,{href:(0,tt.bI)(u.name,h),external:!0,children:(0,e.jsx)(d.x6,{i18nKey:"alerting.notification-route-details-modal.see-details-link",children:"See details"})}):null})})]}),(0,e.jsx)("div",{className:r.button,children:(0,e.jsx)(V.$n,{variant:"primary",type:"button",onClick:n,children:(0,e.jsx)(d.x6,{i18nKey:"alerting.notification-route-details-modal.close",children:"Close"})})})]})})})}const t=n=>({textMuted:(0,c.css)({color:n.colors.text.secondary}),link:(0,c.css)({display:"block",color:n.colors.text.link}),button:(0,c.css)({justifyContent:"flex-end",display:"flex"}),detailsModal:(0,c.css)({maxWidth:"560px"}),defaultPolicy:(0,c.css)({padding:n.spacing(.5),background:n.colors.background.secondary,width:"fit-content"}),contactPoint:(0,c.css)({display:"flex",flexDirection:"row",gap:n.spacing(1),alignItems:"center",justifyContent:"space-between",marginBottom:n.spacing(1)}),policyPathWrapper:(0,c.css)({display:"flex",flexDirection:"column",marginTop:n.spacing(1)}),separator:i=>(0,c.css)({marginTop:n.spacing(i)}),marginBottom:i=>(0,c.css)({marginBottom:n.spacing(n.spacing(i))}),policyInPath:(i=0,u=!1)=>(0,c.css)({marginLeft:`${30+i*30}px`,padding:n.spacing(1),marginTop:n.spacing(1),border:`solid 1px ${u?n.colors.info.border:n.colors.border.weak}`,background:n.colors.background.secondary,width:"fit-content",position:"relative","&:before":{content:'""',position:"absolute",height:"calc(100% - 10px)",width:n.spacing(1),borderLeft:`solid 1px ${n.colors.border.weak}`,borderBottom:`solid 1px ${n.colors.border.weak}`,marginTop:n.spacing(-2),marginLeft:"-17px"}})});function a({route:n,receiver:i,receiverNameFromRoute:u,routesByIdMap:g,instancesCount:j,alertManagerSourceName:h,expandRoute:r,onExpandRouteClick:M}){const T=(0,L.of)(p),[k,b]=(0,$.useState)(!1),D=()=>{b(!0)};return(0,e.jsxs)("div",{className:T.routeHeader,children:[(0,e.jsx)(dt.e,{isCollapsed:!r,onToggle:C=>M(!C),"aria-label":(0,d.t)("alerting.notification-route-header.aria-label-expand-policy-route","Expand policy route")}),(0,e.jsxs)(S,{flexGrow:1,gap:1,children:[(0,e.jsx)("div",{onClick:()=>M(!r),className:T.expandable,children:(0,e.jsxs)(S,{gap:1,direction:"row",alignItems:"center",children:[(0,e.jsx)(d.x6,{i18nKey:"alerting.notification-route-header.notification-policy",children:"Notification policy"}),(0,e.jsx)(ht,{route:n,matcherFormatter:(0,et.VE)(h)})]})}),(0,e.jsx)(ut.h,{}),(0,e.jsxs)(S,{gap:2,direction:"row",alignItems:"center",children:[(0,e.jsxs)(Y.P,{icon:"layers-alt","data-testid":"matching-instances",children:[j??"-"," ",nt()("instance",j)]}),(0,e.jsxs)(S,{gap:1,direction:"row",alignItems:"center",children:[(0,e.jsxs)("div",{children:[(0,e.jsx)("span",{className:T.textMuted,children:(0,e.jsx)(d.x6,{i18nKey:"alerting.notification-route-header.delivered-to",children:"@ Delivered to"})})," ",i?i.name:(0,e.jsx)(ot,{receiverName:u})]}),(0,e.jsx)("div",{className:T.verticalBar}),(0,e.jsx)(V.$n,{type:"button",onClick:D,variant:"secondary",fill:"outline",size:"sm",children:(0,e.jsx)(d.x6,{i18nKey:"alerting.notification-route-header.see-details",children:"See details"})})]})]})]}),k&&(0,e.jsx)(mt,{onClose:()=>b(!1),route:n,receiver:i,receiverNameFromRoute:u,routesByIdMap:g,alertManagerSourceName:h})]})}function o({route:n,instanceMatches:i,receiver:u,receiverNameFromRoute:g,routesByIdMap:j,alertManagerSourceName:h}){const r=(0,L.of)(p),[M,T]=(0,H.A)(!1),k=9;return(0,e.jsxs)("div",{"data-testid":"matching-policy-route",children:[(0,e.jsx)(a,{route:n,receiver:u,receiverNameFromRoute:g,routesByIdMap:j,instancesCount:i.length,alertManagerSourceName:h,expandRoute:M,onExpandRouteClick:T}),M&&(0,e.jsx)(S,{gap:1,direction:"column",children:(0,e.jsx)("div",{className:r.routeInstances,"data-testid":"route-matching-instance",children:i.map(b=>{const D=Array.from(b.labelsMatch),C=D.map(([N,O])=>({label:`${N[0]}=${N[1]}`,match:O.match,colorIndex:O.match?(0,F.JF)(N[0]):k})),B=C.filter(N=>N.match),it=C.filter(N=>!N.match);return(0,e.jsx)("div",{className:r.tagListCard,children:D.length>0?(0,e.jsxs)(e.Fragment,{children:[B.length>0?(0,e.jsx)(K.L,{tags:B.map(N=>N.label),className:r.labelList,getColorIndex:(N,O)=>B[O].colorIndex}):(0,e.jsx)("div",{className:(0,c.cx)(r.textMuted,r.textItalic),children:(0,e.jsx)(d.x6,{i18nKey:"alerting.notification-route.no-matching-labels",children:"No matching labels"})}),(0,e.jsx)("div",{className:r.labelSeparator}),(0,e.jsx)(K.L,{tags:it.map(N=>N.label),className:r.labelList,getColorIndex:(N,O)=>it[O].colorIndex})]}):(0,e.jsx)("div",{className:r.textMuted,children:(0,e.jsx)(d.x6,{i18nKey:"alerting.notification-route.no-labels",children:"No labels"})})},(0,U.uniqueId)())})})})]})}const p=n=>({textMuted:(0,c.css)({color:n.colors.text.secondary}),textItalic:(0,c.css)({fontStyle:"italic"}),expandable:(0,c.css)({cursor:"pointer"}),routeHeader:(0,c.css)({display:"flex",flexDirection:"row",gap:n.spacing(1),alignItems:"center",borderBottom:`1px solid ${n.colors.border.weak}`,padding:n.spacing(.5,.5,.5,0),"&:hover":{backgroundColor:n.components.table.rowHoverBackground}}),labelList:(0,c.css)({flex:"0 1 auto",justifyContent:"flex-start"}),labelSeparator:(0,c.css)({width:"1px",backgroundColor:n.colors.border.weak}),tagListCard:(0,c.css)({display:"flex",flexDirection:"row",gap:n.spacing(2),position:"relative",background:n.colors.background.secondary,padding:n.spacing(1),borderRadius:n.shape.borderRadius(2),border:`solid 1px ${n.colors.border.weak}`}),routeInstances:(0,c.css)({padding:n.spacing(1,0,1,4),position:"relative",display:"flex",flexDirection:"column",gap:n.spacing(1),"&:before":{content:'""',position:"absolute",left:n.spacing(2),height:`calc(100% - ${n.spacing(2)})`,width:n.spacing(4),borderLeft:`solid 1px ${n.colors.border.weak}`}}),verticalBar:(0,c.css)({width:"1px",height:"20px",backgroundColor:n.colors.secondary.main,marginLeft:n.spacing(1),marginRight:n.spacing(1)})});var l=s(16817),f=s(97507),w=s(46202),x=s(59062),P=s(20443),m=s(52161),y=s(48442);const E=(n,i)=>{const{data:u,isLoading:g,error:j}=(0,w.yV)({alertmanager:n}),{contactPoints:h,isLoading:r,error:M}=(0,f.dK)({alertmanager:n,fetchPolicies:!1,fetchStatuses:!1}),{matchInstancesToRoute:T}=(0,x.L)(),[k]=u??[],b=(0,$.useMemo)(()=>{if(k)return(0,y.rJ)((0,P.QM)(k))},[k]),D=b?gt((0,y._I)(b)):new Map,C=(0,$.useMemo)(()=>h?h.reduce((O,yt)=>O.set(yt.name,yt),new Map):new Map,[h]),{value:B=new Map,loading:it,error:N}=(0,l.A)(async()=>{if(b)return await T(b,i,{unquoteMatchers:n!==m.hY})},[b,i]);return{routesByIdMap:D,receiversByName:C,matchingMap:B,loading:g||r||it,error:j??M??N}};function v({alertManagerSource:n,potentialInstances:i,onlyOneAM:u}){const g=(0,L.of)(jt),{routesByIdMap:j,receiversByName:h,matchingMap:r,loading:M,error:T}=E(n.name,i);if(T){const b=(0,d.t)("alerting.notification-preview.error","Could not load routing preview for {{alertmanager}}",{alertmanager:n.name});return(0,e.jsx)(W.F,{title:b,severity:"error",children:(0,tt.JZ)(T)})}return M?(0,e.jsx)(_._,{text:(0,d.t)("alerting.notification-preview-by-alert-manager.text-loading-routing-preview","Loading routing preview...")}):r.size>0?(0,e.jsxs)("div",{className:g.alertManagerRow,children:[!u&&(0,e.jsxs)(S,{direction:"row",alignItems:"center",children:[(0,e.jsx)("div",{className:g.firstAlertManagerLine}),(0,e.jsxs)("div",{className:g.alertManagerName,children:[(0,e.jsx)(d.x6,{i18nKey:"alerting.notification-preview.alertmanager",children:"Alertmanager:"}),(0,e.jsx)("img",{src:n.imgUrl,alt:"",className:g.img}),n.name]}),(0,e.jsx)("div",{className:g.secondAlertManagerLine})]}),(0,e.jsx)(S,{gap:1,direction:"column",children:Array.from(r.entries()).map(([b,D])=>{const C=j.get(b),B=C?.receiver&&h.get(C.receiver);return C?(0,e.jsx)(o,{instanceMatches:D,route:C,receiver:B||void 0,receiverNameFromRoute:C?.receiver?C.receiver:void 0,routesByIdMap:j,alertManagerSourceName:n.name},b):null})})]}):null}const z=(0,rt.Xc)(v),jt=n=>({alertManagerRow:(0,c.css)({display:"flex",flexDirection:"column",gap:n.spacing(1),width:"100%"}),firstAlertManagerLine:(0,c.css)({height:"1px",width:n.spacing(4),backgroundColor:n.colors.secondary.main}),alertManagerName:(0,c.css)({width:"fit-content"}),secondAlertManagerLine:(0,c.css)({height:"1px",width:"100%",flex:1,backgroundColor:n.colors.secondary.main}),img:(0,c.css)({marginLeft:n.spacing(2),width:n.spacing(3),height:n.spacing(3),marginRight:n.spacing(1)})})}}]);

//# sourceMappingURL=6865.b4669905b82640ef6b1f.js.map