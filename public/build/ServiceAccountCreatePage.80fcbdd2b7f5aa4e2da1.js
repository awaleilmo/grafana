"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[4176],{9390:(W,m,e)=>{e.d(m,{r:()=>D});var a=e(74848),o=e(90382),d=e(92745),u=e(18857);const g=Object.values(o.X).filter(t=>t!==o.X.None).map(t=>({label:t,value:t}));function D({value:t,onChange:P,"aria-label":c,inputId:l,autoFocus:r,...h}){return(0,a.jsx)(u.l6,{inputId:l,value:t,options:g,onChange:f=>P(f.value??o.X.None),placeholder:(0,d.t)("admin.org-role-picker.placeholder-choose-role","Choose role..."),"aria-label":c,autoFocus:r,...h})}},31908:(W,m,e)=>{e.d(m,{I:()=>r});var a=e(74848),o=e(49785),d=e(47184),u=e(90382),s=e(92745),g=e(8207),D=e(89640),t=e(37386),P=e(77824);const c=Object.keys(u.X).map(d.z),l=(0,a.jsxs)(s.x6,{i18nKey:"role-picker.title.description",children:["Assign roles to users to ensure granular control over access to Grafana\u2018s features and resources. Find out more in our"," ",(0,a.jsx)(D.Y,{external:!0,href:"https://grafana.com/docs/grafana/latest/administration/roles-and-permissions/#organization-roles",children:"documentation"}),"."]}),r=({onClose:h})=>{const f=(0,o.xW)(),{control:O,getValues:R,setValue:A}=f,[C,I]=R(["name","roles"]);return(0,a.jsx)(g._,{title:C,subtitle:l,onClose:h,children:(0,a.jsx)(t.D,{label:(0,s.t)("role-picker-drawer.basic-roles.label","Basic Roles"),children:(0,a.jsx)(o.xI,{name:"role",control:O,render:({field:{onChange:x,ref:i,...M}})=>(0,a.jsx)(P.z,{...M,options:c,onChange:B=>{A("roleCollection",[B,...I]),x(B)}})})})})}},41150:(W,m,e)=>{e.r(m),e.d(m,{ServiceAccountCreatePage:()=>S,default:()=>X});var a=e(74848),o=e(96540),d=e(49785),u=e(90382),s=e(92745),g=e(68143),D=e(36490),t=e(43173),P=e(16780),c=e(37386),l=e(63527),r=e(45861),h=e(74410),f=e(13791),O=e(91087),R=e(34418),A=e(47184),C=e(18857),I=e(31908);const x=({})=>{const[v,T]=(0,o.useState)(!1),{control:K}=(0,d.xW)(),y=()=>T(!v);return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(d.xI,{name:"role-collection",control:K,render:({field:{ref:$,value:p,...z}})=>(0,a.jsx)(C.KF,{...z,onOpenMenu:y,onChange:()=>{},value:p?.map(A.z)})}),v&&(0,a.jsx)(I.I,{onClose:y})]})};var i=e(73427),M=e(11257),B=e(9390);const F=async v=>{const T=await(0,g.AI)().post("/api/serviceaccounts/",v);return await i.TP.fetchUserPermissions(),T},N=async(v,T)=>(0,g.AI)().patch(`/api/serviceaccounts/${v}`,T),j={id:0,uid:"",orgId:i.TP.user.orgId,role:i.TP.licensedAccessControlEnabled()?u.X.None:u.X.Viewer,tokens:0,name:"",login:"",isDisabled:!1,createdAt:"",teams:[]},S=({})=>{const[v,T]=(0,o.useState)([]),[K,y]=(0,o.useState)([]),$=(0,d.mN)({defaultValues:{name:"",role:j.role,roleCollection:[j.role],roles:[]}}),{formState:{errors:p},register:z}=$,V=i.TP.user.orgId,[U,b]=(0,o.useState)(j);(0,o.useEffect)(()=>{async function E(){try{if(i.TP.hasPermission(M.w.ActionRolesList)){let n=await(0,R.RL)(V);T(n)}}catch(n){console.error("Error loading options",n)}}i.TP.licensedAccessControlEnabled()&&E()},[V]);const G=(0,o.useCallback)(async E=>{E.role=U.role;const n=await F(E);try{const L={avatarUrl:n.avatarUrl,id:n.id,uid:n.uid,isDisabled:n.isDisabled,login:n.login,name:n.name,orgId:n.orgId,role:n.role,tokens:n.tokens};await N(L.uid,E),i.TP.licensedAccessControlEnabled()&&i.TP.hasPermission(M.w.ActionUserRolesAdd)&&i.TP.hasPermission(M.w.ActionUserRolesRemove)&&await(0,R.eA)(K,L.id,L.orgId)}catch(L){console.error(L)}D.Ny.push(`/org/serviceaccounts/${n.uid}`)},[U.role,K]),Y=E=>{b({...U,role:E})},H=(E,n,L)=>{y(E)};return(0,a.jsx)(f.Y,{navId:"serviceaccounts",pageNav:{text:(0,s.t)("service-account-create-page.page-nav.label","Create service account")},children:(0,a.jsxs)(f.Y.Contents,{children:[t.$.featureToggles.rolePickerDrawer&&(0,a.jsx)(d.Op,{...$,children:(0,a.jsxs)("form",{children:[(0,a.jsxs)(P.n,{children:[(0,a.jsx)(c.D,{label:(0,s.t)("service-account-create-page.name.label","Display name"),required:!0,invalid:!!p.name,error:p.name?(0,s.t)("service-account-create-page.name.required-error","Display name is required"):void 0,children:(0,a.jsx)(l.p,{id:"name",...z("name",{required:!0}),autoFocus:!0})}),(0,a.jsx)(c.D,{label:(0,s.t)("service-account-create-page.role.label","Role"),children:(0,a.jsx)(x,{})})]}),(0,a.jsx)(r.$n,{type:"submit",children:(0,a.jsx)(s.x6,{i18nKey:"service-account-create-page.create.button",children:"Create"})})]})}),!t.$.featureToggles.rolePickerDrawer&&(0,a.jsx)(h.l,{onSubmit:G,validateOn:"onSubmit",children:({register:E,errors:n})=>(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(P.n,{children:[(0,a.jsx)(c.D,{label:(0,s.t)("service-account-create-page.name.label","Display name"),required:!0,invalid:!!n.name,error:n.name?(0,s.t)("service-account-create-page.name.required-error","Display name is required"):void 0,children:(0,a.jsx)(l.p,{id:"display-name-input",...E("name",{required:!0}),autoFocus:!0})}),(0,a.jsx)(c.D,{label:(0,s.t)("service-account-create-page.role.label","Role"),children:i.TP.licensedAccessControlEnabled()?(0,a.jsx)(O.y,{apply:!0,userId:U.id||0,orgId:U.orgId,basicRole:U.role,onBasicRoleChange:Y,roleOptions:v,onApplyRoles:H,pendingRoles:K,maxWidth:"100%"}):(0,a.jsx)(B.r,{"aria-label":(0,s.t)("service-account-create-page.role.label","Role"),value:U.role,onChange:Y})})]}),(0,a.jsx)(r.$n,{type:"submit",children:(0,a.jsx)(s.x6,{i18nKey:"service-account-create-page.create.button",children:"Create"})})]})})]})})},X=S},74410:(W,m,e)=>{e.d(m,{l:()=>s});var a=e(74848),o=e(22803),d=e(96540),u=e(49785);function s({defaultValues:g,onSubmit:D,validateOnMount:t=!1,validateFieldsOnMount:P,children:c,validateOn:l="onSubmit",maxWidth:r=600,...h}){const{handleSubmit:f,trigger:O,formState:R,...A}=(0,u.mN)({mode:l,defaultValues:g});return(0,d.useEffect)(()=>{t&&O(P)},[O,P,t]),(0,a.jsx)("form",{className:(0,o.css)({maxWidth:r!=="none"?r+"px":r,width:"100%"}),onSubmit:f(D),...h,children:c({errors:R.errors,formState:R,trigger:O,...A})})}},91087:(W,m,e)=>{e.d(m,{y:()=>t});var a=e(74848),o=e(96540),d=e(41053),u=e(73427),s=e(11257),g=e(59812),D=e(34418);const t=({basicRole:P,roles:c,userId:l,orgId:r,onBasicRoleChange:h,roleOptions:f,disabled:O,basicRoleDisabled:R,basicRoleDisabledMessage:A,apply:C=!1,onApplyRoles:I,pendingRoles:x,maxWidth:i,width:M,isLoading:B})=>{const[{loading:F,value:N=c||[]},j]=(0,d.A)(async()=>{try{if(c)return c;if(C&&x?.length)return x;if(u.TP.hasPermission(s.w.ActionUserRolesList)&&l>0)return await(0,D.Xh)(l,r)}catch{console.error("Error loading options")}return[]},[r,l,x,c]);(0,o.useEffect)(()=>{r&&j()},[j,r]);const S=async v=>{C?I&&I(v,l,r):(await(0,D.eA)(v,l,r),await j())},X=u.TP.hasPermission(s.w.ActionUserRolesAdd)&&u.TP.hasPermission(s.w.ActionUserRolesRemove);return(0,a.jsx)(g.n,{appliedRoles:N,basicRole:P,onRolesChange:S,onBasicRoleChange:h,roleOptions:f,isLoading:F||B,disabled:O,basicRoleDisabled:R,basicRoleDisabledMessage:A,showBasicRole:!0,apply:C,canUpdateRoles:X,maxWidth:i,width:M})}}}]);

//# sourceMappingURL=ServiceAccountCreatePage.80fcbdd2b7f5aa4e2da1.js.map