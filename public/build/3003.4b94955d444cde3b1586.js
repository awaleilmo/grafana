"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[3003],{21840:(L,m,e)=>{e.d(m,{Y:()=>t});var o=e(96540),n=e(75735),s=e(76701),a=e(55266),c=e(43385);function t({folderUid:h,title:d}){const{repository:r,folder:i,isLoading:u,isReadOnlyRepo:E}=(0,a.T)({folderName:h}),D=(0,c.g)(),v=(0,s.a)(r),f=(0,o.useMemo)(()=>{if(!r||u)return;const M=(0,s.r)(r);return{title:d||"",comment:"",ref:M==="branch"?`folder/${D}`:r?.branch??"",repo:r.name||"",path:i?.metadata?.annotations?.[n.Y_]||"",workflow:(0,s.r)(r)}},[r,u,d,D,i?.metadata?.annotations]);return{repository:r,folder:i,workflowOptions:v,initialValues:f,isReadOnlyRepo:E}}},43003:(L,m,e)=>{e.d(m,{m:()=>he});var o=e(74848),n=e(96540),s=e(32899),a=e(92745),c=e(27489),t=e(36490),h=e(87063),d=e(94535),r=e(88559),i=e(45861),u=e(30703),E=e(8207),D=e(54384),v=e(73427),f=e(49785),M=e(54148),g=e(75234),O=e(41654),P=e(31286),C=e(83793),j=e(75735),A=e(78059),w=e(62963),Y=e(21840),J=e(34621),se=e(49314),ae=e(96733),te=e(65411);function ne({initialValues:l,parentFolder:y,repository:x,workflowOptions:K,folder:U,onDismiss:b}){const p=y?.uid||"",[z,R]=(0,C.Qo)(),G=(0,M.Zp)(),_=(0,f.mN)({defaultValues:l}),{handleSubmit:H,watch:S}=_,I=S("workflow"),Q=async({repo:T,path:W,comment:B,ref:F})=>{if(!x?.name)return;const X=B||`Delete folder: ${U?.metadata?.annotations?.[j.Y_]}`,k=I==="write"?void 0:F;z({name:T,path:`${W}/`,ref:k,message:X})},$=({urls:T},W)=>{const B=T?.newPullRequestURL;if(B){const F=(0,se.q)({paramName:"new_pull_request_url",paramValue:B,repoType:W.repoType});G(F)}},N=()=>{y?.parentUid?window.location.href=(0,w._0)(y.parentUid):window.location.href="/dashboards"},Z=T=>{(0,g.J7)().publish({type:s.r1.alertError.name,payload:[(0,a.t)("browse-dashboards.delete-provisioned-folder-form.api-error","Failed to delete folder"),T]})};return(0,J.J)({request:R,workflow:I,successMessage:(0,a.t)("browse-dashboards.delete-provisioned-folder-form.success-message","Folder deleted successfully"),resourceType:"folder",repository:x,handlers:{onDismiss:b,onBranchSuccess:$,onWriteSuccess:N,onError:Z}}),(0,o.jsx)(f.Op,{..._,children:(0,o.jsx)("form",{onSubmit:H(Q),children:(0,o.jsxs)(O.B,{direction:"column",gap:2,children:[(0,o.jsxs)(P.a,{paddingBottom:2,children:[(0,o.jsx)(a.x6,{i18nKey:"browse-dashboards.delete-provisioned-folder-form.delete-warning",children:"This will delete this folder and all its descendants. In total, this will affect:"}),(0,o.jsx)(A.x,{selectedItems:{folder:{[p]:!0},dashboard:{},panel:{},$all:!1}})]}),(0,o.jsx)(te.x,{resourceType:"folder",isNew:!1,workflow:I,workflowOptions:K,repository:x}),(0,o.jsxs)(O.B,{gap:2,children:[(0,o.jsx)(i.$n,{variant:"secondary",fill:"outline",onClick:b,children:(0,o.jsx)(a.x6,{i18nKey:"browse-dashboards.delete-provisioned-folder-form.button-cancel",children:"Cancel"})}),(0,o.jsx)(i.$n,{type:"submit",disabled:R.isLoading,variant:"destructive",children:R.isLoading?(0,a.t)("browse-dashboards.delete-provisioned-folder-form.button-deleting","Deleting..."):(0,a.t)("browse-dashboards.delete-provisioned-folder-form.button-delete","Delete")})]})]})})})}function re({parentFolder:l,onDismiss:y}){const{workflowOptions:x,repository:K,folder:U,initialValues:b,isReadOnlyRepo:p}=(0,Y.Y)({folderUid:l?.uid,title:l?.title});return p||!b?(0,o.jsx)(ae.t,{noRepository:!b,isReadOnlyRepo:p,readOnlyMessage:(0,a.t)("browse-dashboards.delete-folder.read-only-message","To delete this folder, please remove the folder from your repository.")}):(0,o.jsx)(ne,{parentFolder:l,onDismiss:y,initialValues:b,repository:K,workflowOptions:x,folder:U})}var le=e(45942),q=e(87745),ee=e(98970),de=e(83485),ie=e(72472),ce=e(65542);function he({folder:l,repoType:y,isReadOnlyRepo:x}){const[K,U]=(0,n.useState)(!1),[b,p]=(0,n.useState)(!1),[z,R]=(0,n.useState)(!1),[G]=(0,ee.iy)(),_=(0,ee.yn)(),{canEditFolders:H,canDeleteFolders:S,canViewPermissions:I,canSetPermissions:Q}=(0,de.N)(l),$=l.managedBy===j.Sf.Repo,N=H&&!$,Z=async oe=>{await G({folderUID:l.uid,destinationUID:oe}),(0,c.rR)("grafana_manage_dashboards_item_moved",{item_counts:{folder:1,dashboard:0},source:"folder_actions"})},T=async()=>{if((await _(l)).error){v.lE.publish({type:s.r1.alertError.name,payload:[(0,a.t)("browse-dashboards.folder-actions-button.delete-folder-error","Error deleting folder. Please try again later.")]});return}(0,c.rR)("grafana_manage_dashboards_item_deleted",{item_counts:{folder:1,dashboard:0},source:"folder_actions"});const{parents:V}=l,fe=V&&V.length?V[V.length-1].url:"/dashboards";t.Ny.push(fe)},W=()=>{v.lE.publish(new q.S8({component:ce.J,props:{selectedItems:{folder:{[l.uid]:!0},dashboard:{},panel:{},$all:!1},onConfirm:Z}}))},B=()=>{v.lE.publish(new q.S8({component:ie.T,props:{selectedItems:{folder:{[l.uid]:!0},dashboard:{},panel:{},$all:!1},onConfirm:T}}))},F=()=>{R(!0)},X=(0,a.t)("browse-dashboards.folder-actions-button.manage-permissions","Manage permissions"),k=(0,a.t)("browse-dashboards.folder-actions-button.move","Move"),ve=(0,a.t)("browse-dashboards.folder-actions-button.delete","Delete"),me=(0,o.jsxs)(h.W,{children:[I&&(0,o.jsx)(d.D,{onClick:()=>p(!0),label:X}),N&&(0,o.jsx)(d.D,{onClick:W,label:k}),S&&(0,o.jsx)(d.D,{destructive:!0,onClick:$?F:B,label:ve})]});return!I&&!N&&!S?null:(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(r.m,{overlay:me,onVisibleChange:U,children:(0,o.jsxs)(i.$n,{variant:"secondary",disabled:x,tooltip:x?(0,le.Te)({isLocal:y==="local"}):void 0,children:[(0,o.jsx)(a.x6,{i18nKey:"browse-dashboards.folder-actions-button.folder-actions",children:"Folder actions"}),(0,o.jsx)(u.I,{name:K?"angle-up":"angle-down"})]})}),b&&(0,o.jsx)(E._,{title:(0,a.t)("browse-dashboards.action.manage-permissions-button","Manage permissions"),subtitle:l.title,onClose:()=>p(!1),size:"md",children:(0,o.jsx)(D.x,{resource:"folders",resourceId:l.uid,canSetPermissions:Q})}),z&&(0,o.jsx)(E._,{title:(0,a.t)("browse-dashboards.action.delete-provisioned-folder","Delete provisioned folder"),subtitle:l.title,onClose:()=>R(!1),children:(0,o.jsx)(re,{parentFolder:l,onDismiss:()=>R(!1)})})]})}},51552:(L,m,e)=>{e.d(m,{o:()=>t});var o=e(74848),n=e(92745),s=e(30703),a=e(45967),c=e(31286);function t(){return(0,o.jsxs)(c.a,{children:[(0,o.jsx)(n.x6,{i18nKey:"browse-dashboards.bulk-move-resources-form.move-warning",children:"This will move selected folders and their descendants. Available target folders depend on the selected resources."}),(0,o.jsx)(a.m,{content:(0,n.t)("browse-dashboards.bulk-move-resources-form.move-warning-tooltip","You can only move provisioned resources within their provisioned folder, and local resources to local folders."),children:(0,o.jsx)("span",{style:{marginLeft:"4px"},children:(0,o.jsx)(s.I,{name:"info-circle",size:"sm"})})})]})}},65542:(L,m,e)=>{e.d(m,{J:()=>v});var o=e(74848),n=e(96540),s=e(92745),a=e(22787),c=e(34999),t=e(45861),h=e(66404),d=e(31286),r=e(35137),i=e(37386),u=e(51552),E=e(94626),D=e(78059);const v=({onConfirm:f,onDismiss:M,selectedItems:g,...O})=>{const[P,C]=(0,n.useState)(),[j,A]=(0,n.useState)(!1),w=Object.keys(g.folder).filter(J=>g.folder[J]),Y=async()=>{if(P!==void 0){A(!0);try{await f(P),A(!1),M()}catch{A(!1)}}};return(0,o.jsxs)(a.a,{title:(0,s.t)("browse-dashboards.action.move-modal-title","Move"),onDismiss:M,...O,children:[w.length>0&&(0,o.jsx)(c.F,{severity:"info",title:(0,s.t)("browse-dashboards.action.move-modal-alert","Moving this item may change its permissions.")}),(0,o.jsx)(u.o,{}),(0,o.jsxs)(d.a,{paddingTop:2,children:[(0,o.jsx)(h.E,{element:"p",children:(0,o.jsx)(s.x6,{i18nKey:"browse-dashboards.action.move-modal-text",children:"This action will move the following content:"})}),(0,o.jsx)(D.x,{selectedItems:g})]}),(0,o.jsx)(r.$,{v:3}),(0,o.jsx)(i.D,{label:(0,s.t)("browse-dashboards.action.move-modal-field-label","Folder name"),children:(0,o.jsx)(E.a,{value:P,excludeUIDs:w,onChange:C,repositoryName:void 0})}),(0,o.jsxs)(a.a.ButtonRow,{children:[(0,o.jsx)(t.$n,{onClick:M,variant:"secondary",fill:"outline",children:(0,o.jsx)(s.x6,{i18nKey:"browse-dashboards.action.cancel-button",children:"Cancel"})}),(0,o.jsx)(t.$n,{disabled:P===void 0||j,onClick:Y,variant:"primary",children:j?(0,s.t)("browse-dashboards.action.moving","Moving..."):(0,s.t)("browse-dashboards.action.move-button","Move")})]})]})}},72472:(L,m,e)=>{e.d(m,{T:()=>E});var o=e(74848),n=e(96540),s=e(92745),a=e(43173),c=e(27489),t=e(71599),h=e(34999),d=e(66404),r=e(35137),i=e(15203),u=e(78059);const E=({onConfirm:D,onDismiss:v,selectedItems:f,...M})=>{const{data:g}=(0,i.G2)(f),O=!!(g&&(g.alertRule||g.libraryPanel)),[P,C]=(0,n.useState)(!1),j=async()=>{(0,c.rR)("grafana_manage_dashboards_delete_clicked",{item_counts:{dashboard:Object.keys(f.dashboard).length,folder:Object.keys(f.folder).length},source:"browse_dashboards",restore_enabled:!!a.$.featureToggles.restoreDashboards}),C(!0);try{await D(),C(!1),v()}catch{C(!1)}};return(0,o.jsx)(t.u,{body:(0,o.jsxs)(o.Fragment,{children:[a.$.featureToggles.restoreDashboards&&(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(d.E,{element:"p",children:(0,o.jsx)(s.x6,{i18nKey:"browse-dashboards.action.delete-modal-restore-dashboards-text",children:"This action will delete the selected folders immediately but the selected dashboards will be marked for deletion in 30 days. Your organization administrator can restore the dashboards anytime before the 30 days expire. Folders cannot be restored."})}),(0,o.jsx)(r.$,{v:2})]}),(0,o.jsx)(d.E,{element:"p",children:(0,o.jsx)(s.x6,{i18nKey:"browse-dashboards.action.delete-modal-text",children:"This action will delete the following content:"})}),(0,o.jsx)(u.x,{selectedItems:f}),(0,o.jsx)(r.$,{v:2})]}),description:(0,o.jsx)(o.Fragment,{children:O?(0,o.jsx)(h.F,{severity:"warning",title:(0,s.t)("browse-dashboards.action.delete-modal-invalid-title","Cannot delete folder"),children:(0,o.jsx)(s.x6,{i18nKey:"browse-dashboards.action.delete-modal-invalid-text",children:"One or more folders contain library panels or alert rules. Delete these first in order to proceed."})}):null}),confirmationText:(0,s.t)("browse-dashboards.action.confirmation-text","Delete"),confirmText:P?(0,s.t)("browse-dashboards.action.deleting","Deleting..."):(0,s.t)("browse-dashboards.action.delete-button","Delete"),onDismiss:v,onConfirm:j,title:(0,s.t)("browse-dashboards.action.delete-modal-title","Delete"),...M,disabled:O})}},83485:(L,m,e)=>{e.d(m,{N:()=>c});var o=e(73427),n=e(11257);function s(t,h){return h?o.TP.hasPermissionInMetadata(t,h):o.TP.hasPermission(t)}function a(t){return s(n.w.FoldersCreate,t)}function c(t){const h=s(n.w.DashboardsCreate,t),d=a(t),r=s(n.w.FoldersDelete,t),i=s(n.w.DashboardsDelete,t),u=s(n.w.DashboardsWrite,t),E=s(n.w.FoldersWrite,t),D=s(n.w.FoldersPermissionsWrite,t),v=s(n.w.FoldersPermissionsRead,t);return{canCreateDashboards:h,canCreateFolders:d,canDeleteFolders:r,canEditDashboards:u,canEditFolders:E,canSetPermissions:D,canViewPermissions:v,canDeleteDashboards:i}}}}]);

//# sourceMappingURL=3003.4b94955d444cde3b1586.js.map