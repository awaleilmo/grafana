{"version":3,"file":"stateTimelinePanel.54ef82e3eeb369c72dae.js","mappings":"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","sources":["webpack://grafana/./public/app/plugins/panel/state-timeline/panelcfg.gen.ts","webpack://grafana/./public/app/core/components/TimelineChart/TimelineChart.tsx","webpack://grafana/./public/app/plugins/panel/status-history/utils.ts","webpack://grafana/./packages/grafana-data/src/transformations/transformers/nulls/nullToUndefThreshold.ts","webpack://grafana/./public/app/core/components/GraphNG/utils.ts","webpack://grafana/./public/app/plugins/panel/state-timeline/utils.tsx","webpack://grafana/./public/app/plugins/panel/state-timeline/StateTimelinePanel.tsx","webpack://grafana/./public/app/plugins/panel/state-timeline/migrations.ts","webpack://grafana/./public/app/plugins/panel/state-timeline/suggestions.ts","webpack://grafana/./public/app/plugins/panel/state-timeline/module.tsx","webpack://grafana/./public/app/plugins/panel/state-timeline/StateTimelineTooltip2.tsx","webpack://grafana/./public/app/core/components/GraphNG/GraphNG.tsx"],"sourcesContent":["// Code generated - EDITING IS FUTILE. DO NOT EDIT.\n//\n// Generated by:\n//     public/app/plugins/gen.go\n// Using jennies:\n//     TSTypesJenny\n//     PluginTsTypesJenny\n//\n// Run 'make gen-cue' from repository root to regenerate.\n\nimport * as ui from '@grafana/schema';\n\nexport interface Options extends ui.OptionsWithLegend, ui.OptionsWithTooltip, ui.OptionsWithTimezones {\n  /**\n   * Controls value alignment on the timelines\n   */\n  alignValue?: ui.TimelineValueAlignment;\n  /**\n   * Merge equal consecutive values\n   */\n  mergeValues?: boolean;\n  /**\n   * Enables pagination when > 0\n   */\n  perPage?: number;\n  /**\n   * Controls the row height\n   */\n  rowHeight: number;\n  /**\n   * Show timeline values on chart\n   */\n  showValue: ui.VisibilityMode;\n}\n\nexport const defaultOptions: Partial<Options> = {\n  alignValue: 'left',\n  mergeValues: true,\n  perPage: 20,\n  rowHeight: 0.9,\n  showValue: ui.VisibilityMode.Auto,\n};\n\nexport interface FieldConfig extends ui.AxisConfig, ui.HideableFieldConfig {\n  fillOpacity?: number;\n  lineWidth?: number;\n}\n\nexport const defaultFieldConfig: Partial<FieldConfig> = {\n  fillOpacity: 70,\n  lineWidth: 0,\n};\n","import { Component } from 'react';\n\nimport { DataFrame, FALLBACK_COLOR, FieldType, TimeRange } from '@grafana/data';\nimport { VisibilityMode, TimelineValueAlignment, TooltipDisplayMode, VizTooltipOptions } from '@grafana/schema';\nimport { UPlotConfigBuilder, VizLayout, VizLegend, VizLegendItem } from '@grafana/ui';\n\nimport { GraphNG, GraphNGProps } from '../GraphNG/GraphNG';\n\nimport { preparePlotConfigBuilder, TimelineMode } from './utils';\n\n/**\n * @alpha\n */\nexport interface TimelineProps extends Omit<GraphNGProps, 'prepConfig' | 'propsToDiff' | 'renderLegend'> {\n  mode: TimelineMode;\n  rowHeight?: number;\n  showValue: VisibilityMode;\n  alignValue?: TimelineValueAlignment;\n  colWidth?: number;\n  legendItems?: VizLegendItem[];\n  tooltip?: VizTooltipOptions;\n  // Whenever `paginationRev` changes, the graph will be fully re-configured/rendered.\n  paginationRev?: string;\n}\n\nconst propsToDiff = ['rowHeight', 'colWidth', 'showValue', 'mergeValues', 'alignValue', 'tooltip', 'paginationRev'];\n\nexport class TimelineChart extends Component<TimelineProps> {\n  getValueColor = (frameIdx: number, fieldIdx: number, value: unknown) => {\n    const field = this.props.frames[frameIdx]?.fields[fieldIdx];\n\n    if (field?.display) {\n      const disp = field.display(value); // will apply color modes\n      if (disp.color) {\n        return disp.color;\n      }\n    }\n\n    return FALLBACK_COLOR;\n  };\n\n  prepConfig = (alignedFrame: DataFrame, allFrames: DataFrame[], getTimeRange: () => TimeRange) => {\n    return preparePlotConfigBuilder({\n      frame: alignedFrame,\n      getTimeRange,\n      allFrames: this.props.frames,\n      ...this.props,\n\n      // Ensure timezones is passed as an array\n      timeZones: Array.isArray(this.props.timeZone) ? this.props.timeZone : [this.props.timeZone],\n\n      // When there is only one row, use the full space\n      rowHeight: alignedFrame.fields.length > 2 ? this.props.rowHeight : 1,\n      getValueColor: this.getValueColor,\n\n      hoverMulti: this.props.tooltip?.mode === TooltipDisplayMode.Multi,\n    });\n  };\n\n  renderLegend = (config: UPlotConfigBuilder) => {\n    const { legend, legendItems } = this.props;\n\n    if (!config || !legendItems || !legend || legend.showLegend === false) {\n      return null;\n    }\n\n    return (\n      <VizLayout.Legend placement={legend.placement}>\n        <VizLegend placement={legend.placement} items={legendItems} displayMode={legend.displayMode} readonly />\n      </VizLayout.Legend>\n    );\n  };\n\n  render() {\n    return (\n      <GraphNG\n        {...this.props}\n        fields={{\n          x: (f) => f.type === FieldType.time,\n          y: (f) =>\n            f.type === FieldType.number ||\n            f.type === FieldType.boolean ||\n            f.type === FieldType.string ||\n            f.type === FieldType.enum,\n        }}\n        prepConfig={this.prepConfig}\n        propsToDiff={propsToDiff}\n        renderLegend={this.renderLegend}\n        omitHideFromViz={true}\n      />\n    );\n  }\n}\n","import { DataFrame, ActionModel, Field, InterpolateFunction, LinkModel } from '@grafana/data';\nimport { getActions } from 'app/features/actions/utils';\n\nexport const getDataLinks = (field: Field, rowIdx: number) => {\n  const links: Array<LinkModel<Field>> = [];\n\n  if ((field.config.links?.length ?? 0) > 0 && field.getLinks != null) {\n    const v = field.values[rowIdx];\n    const disp = field.display ? field.display(v) : { text: `${v}`, numeric: +v };\n\n    const linkLookup = new Set<string>();\n\n    field.getLinks({ calculatedValue: disp, valueRowIndex: rowIdx }).forEach((link) => {\n      const key = `${link.title}/${link.href}`;\n      if (!linkLookup.has(key)) {\n        links.push(link);\n        linkLookup.add(key);\n      }\n    });\n  }\n\n  return links;\n};\n\nexport const getAllFrameActions = (dataFrame: DataFrame) => {};\n\nexport const getFieldActions = (\n  dataFrame: DataFrame,\n  field: Field,\n  replaceVars: InterpolateFunction,\n  rowIndex: number\n) => {\n  const actions: Array<ActionModel<Field>> = [];\n  const actionLookup = new Set<string>();\n\n  const actionsModel = getActions(dataFrame, field, field.state!.scopedVars!, replaceVars, field.config.actions ?? [], {\n    valueRowIndex: rowIndex,\n  });\n\n  actionsModel.forEach((action) => {\n    const key = `${action.title}`;\n    if (!actionLookup.has(key)) {\n      actions.push(action);\n      actionLookup.add(key);\n    }\n  });\n\n  return actions;\n};\n","// mutates all nulls -> undefineds in the fieldValues array for value-less refValues ranges below maxThreshold\n// refValues is typically a time array and maxThreshold is the allowable distance between in time\nexport function nullToUndefThreshold(refValues: number[], fieldValues: unknown[], maxThreshold: number) {\n  let prevRef;\n  let nullIdx;\n\n  for (let i = 0; i < fieldValues.length; i++) {\n    let fieldVal = fieldValues[i];\n\n    if (fieldVal == null) {\n      if (nullIdx == null && prevRef != null) {\n        nullIdx = i;\n      }\n    } else {\n      if (nullIdx != null && prevRef != null) {\n        if (refValues[i] - prevRef < maxThreshold) {\n          while (nullIdx < i) {\n            fieldValues[nullIdx++] = undefined;\n          }\n        }\n\n        nullIdx = null;\n      }\n\n      prevRef = refValues[i];\n    }\n  }\n\n  return fieldValues;\n}\n","import {\n  DataFrame,\n  Field,\n  FieldType,\n  outerJoinDataFrames,\n  TimeRange,\n  applyNullInsertThreshold,\n  roundDecimals,\n} from '@grafana/data';\nimport { NULL_EXPAND, NULL_REMOVE, NULL_RETAIN, nullToUndefThreshold } from '@grafana/data/internal';\nimport { GraphDrawStyle } from '@grafana/schema';\n\nimport { XYFieldMatchers } from './types';\n\nfunction isVisibleBarField(f: Field) {\n  return (\n    f.type === FieldType.number && f.config.custom?.drawStyle === GraphDrawStyle.Bars && !f.config.custom?.hideFrom?.viz\n  );\n}\n\nexport function getRefField(frame: DataFrame, refFieldName?: string | null) {\n  return frame.fields.find((field) => {\n    // note: getFieldDisplayName() would require full DF[]\n    return refFieldName != null ? field.name === refFieldName : field.type === FieldType.time;\n  });\n}\n\n// will mutate the DataFrame's fields' values\nfunction applySpanNullsThresholds(frame: DataFrame, refFieldName?: string | null) {\n  const refField = getRefField(frame, refFieldName);\n\n  let refValues = refField?.values;\n\n  for (let i = 0; i < frame.fields.length; i++) {\n    let field = frame.fields[i];\n\n    if (field === refField || isVisibleBarField(field)) {\n      continue;\n    }\n\n    let spanNulls = field.config.custom?.spanNulls;\n\n    if (typeof spanNulls === 'number') {\n      if (spanNulls !== -1 && refValues) {\n        field.values = nullToUndefThreshold(refValues, field.values, spanNulls);\n      }\n    }\n  }\n\n  return frame;\n}\n\nfunction getXField(dimFields: XYFieldMatchers, frame: DataFrame, frames: DataFrame[]) {\n  for (let field of frame.fields) {\n    if (dimFields.x(field, frame, frames)) {\n      return field;\n    }\n  }\n\n  return;\n}\n\nexport function preparePlotFrame(frames: DataFrame[], dimFields: XYFieldMatchers, timeRange?: TimeRange | null) {\n  // apply null insertions at interval\n  frames = frames.map((frame) => {\n    const xField = getXField(dimFields, frame, frames);\n\n    if (xField != null && !xField.state?.nullThresholdApplied) {\n      return applyNullInsertThreshold({\n        frame,\n        refFieldName: xField.name,\n        refFieldPseudoMin: timeRange?.from.valueOf(),\n        refFieldPseudoMax: timeRange?.to.valueOf(),\n      });\n    } else {\n      return frame;\n    }\n  });\n\n  let numBarSeries = frames.reduce(\n    (acc, frame) => acc + frame.fields.reduce((acc, field) => acc + (isVisibleBarField(field) ? 1 : 0), 0),\n    0\n  );\n\n  // to make bar widths of all series uniform (equal to narrowest bar series), find smallest distance between x points\n  let minXDeltaGlobal: number | null = null;\n\n  if (numBarSeries > 1) {\n    // collect for each frame and only set minXDeltaGlobal if they're different\n    const minXDeltas = new Set<number>();\n\n    frames.forEach((frame) => {\n      if (!frame.fields.some(isVisibleBarField)) {\n        return;\n      }\n\n      const xField = getXField(dimFields, frame, frames);\n\n      if (xField == null) {\n        return;\n      }\n\n      let minXDeltaFrame = Infinity;\n\n      const xVals = xField.values;\n\n      for (let i = 0; i < xVals.length; i++) {\n        if (i > 0) {\n          minXDeltaFrame = Math.min(minXDeltaFrame, xVals[i] - xVals[i - 1]);\n        }\n      }\n\n      if (minXDeltaFrame !== Infinity) {\n        if (!Number.isInteger(minXDeltaFrame)) {\n          minXDeltaFrame = roundDecimals(minXDeltaFrame, 6);\n        }\n\n        minXDeltas.add(minXDeltaFrame);\n      }\n    });\n\n    if (minXDeltas.size > 1) {\n      minXDeltaGlobal = Math.min(...minXDeltas);\n    }\n  }\n\n  let alignedFrame = outerJoinDataFrames({\n    frames,\n    joinBy: dimFields.x,\n    keep: dimFields.y,\n    keepOriginIndices: true,\n\n    // the join transformer force-deletes our state.displayName cache unless keepDisplayNames: true\n    // https://github.com/grafana/grafana/pull/31121\n    // https://github.com/grafana/grafana/pull/71806\n    keepDisplayNames: true,\n\n    // prevent minesweeper-expansion of nulls (gaps) when joining bars\n    // since bar width is determined from the minimum distance between non-undefined values\n    // (this strategy will still retain any original pre-join nulls, though)\n    nullMode: (field) => {\n      if (isVisibleBarField(field)) {\n        return NULL_RETAIN;\n      }\n\n      let spanNulls = field.config.custom?.spanNulls;\n      return spanNulls === true ? NULL_REMOVE : spanNulls === -1 ? NULL_RETAIN : NULL_EXPAND;\n    },\n  });\n\n  if (alignedFrame) {\n    alignedFrame = applySpanNullsThresholds(alignedFrame, alignedFrame.fields[0].name);\n\n    // append 2 null vals at minXDeltaGlobal to bar series\n    if (minXDeltaGlobal != null) {\n      alignedFrame.fields.forEach((f, fi) => {\n        let vals = f.values;\n\n        if (fi === 0) {\n          let lastVal = vals[vals.length - 1];\n          vals.push(lastVal + minXDeltaGlobal, lastVal + 2 * minXDeltaGlobal);\n        } else if (isVisibleBarField(f)) {\n          vals.push(null, null);\n        } else {\n          vals.push(undefined, undefined);\n        }\n      });\n\n      alignedFrame.length += 2;\n    }\n\n    return alignedFrame;\n  }\n\n  return null;\n}\n","import { css } from '@emotion/css';\nimport { useMemo, useState } from 'react';\nimport { useMeasure } from 'react-use';\n\nimport { DataFrame } from '@grafana/data';\nimport { Pagination } from '@grafana/ui';\nimport { makeFramePerSeries } from 'app/core/components/TimelineChart/utils';\n\nimport { defaultOptions } from './panelcfg.gen';\n\nexport const containerStyles = {\n  container: css({\n    display: 'flex',\n    flexDirection: 'column',\n  }),\n};\n\nconst styles = {\n  paginationContainer: css({\n    display: 'flex',\n    justifyContent: 'center',\n    width: '100%',\n  }),\n  paginationElement: css({\n    marginTop: '8px',\n  }),\n};\n\nexport function usePagination(frames?: DataFrame[], perPage?: number) {\n  const [currentPage, setCurrentPage] = useState(1);\n\n  const [paginationWrapperRef, { height: paginationHeight, width: paginationWidth }] = useMeasure<HTMLDivElement>();\n\n  const pagedFrames = useMemo(\n    () => (!perPage || frames == null ? frames : makeFramePerSeries(frames)),\n    [frames, perPage]\n  );\n\n  if (!perPage || pagedFrames == null) {\n    return {\n      paginatedFrames: pagedFrames,\n      paginationRev: 'disabled',\n      paginationElement: undefined,\n      paginationHeight: 0,\n    };\n  }\n\n  perPage ||= defaultOptions.perPage!;\n\n  const numberOfPages = Math.ceil(pagedFrames.length / perPage);\n  // `perPage` changing might lead to temporarily too large values of `currentPage`.\n  const currentPageCapped = Math.min(currentPage, numberOfPages);\n  const pageOffset = (currentPageCapped - 1) * perPage;\n  const currentPageFrames = pagedFrames.slice(pageOffset, pageOffset + perPage);\n\n  // `paginationRev` needs to change value whenever any of the pagination settings changes.\n  // It's used in to trigger a reconfiguration of the underlying graphs (which is cached,\n  // hence an explicit nudge is required).\n  const paginationRev = `${currentPageCapped}/${perPage}`;\n\n  const showSmallVersion = paginationWidth < 550;\n  const paginationElement = (\n    <div className={styles.paginationContainer} ref={paginationWrapperRef}>\n      <Pagination\n        className={styles.paginationElement}\n        currentPage={currentPageCapped}\n        numberOfPages={numberOfPages}\n        showSmallVersion={showSmallVersion}\n        onNavigate={setCurrentPage}\n      />\n    </div>\n  );\n\n  return { paginatedFrames: currentPageFrames, paginationRev, paginationElement, paginationHeight };\n}\n","import { useMemo, useState } from 'react';\n\nimport { DashboardCursorSync, PanelProps } from '@grafana/data';\nimport { PanelDataErrorView } from '@grafana/runtime';\nimport {\n  AxisPlacement,\n  EventBusPlugin,\n  TooltipDisplayMode,\n  TooltipPlugin2,\n  usePanelContext,\n  useTheme2,\n} from '@grafana/ui';\nimport { TimeRange2, TooltipHoverMode } from '@grafana/ui/internal';\nimport { TimelineChart } from 'app/core/components/TimelineChart/TimelineChart';\nimport {\n  prepareTimelineFields,\n  prepareTimelineLegendItems,\n  TimelineMode,\n} from 'app/core/components/TimelineChart/utils';\n\nimport { AnnotationsPlugin2 } from '../timeseries/plugins/AnnotationsPlugin2';\nimport { OutsideRangePlugin } from '../timeseries/plugins/OutsideRangePlugin';\nimport { getTimezones } from '../timeseries/utils';\n\nimport { StateTimelineTooltip2 } from './StateTimelineTooltip2';\nimport { Options } from './panelcfg.gen';\nimport { containerStyles, usePagination } from './utils';\n\ninterface TimelinePanelProps extends PanelProps<Options> {}\n\n/**\n * @alpha\n */\nexport const StateTimelinePanel = ({\n  data,\n  timeRange,\n  timeZone,\n  options,\n  width,\n  height,\n  fieldConfig,\n  replaceVariables,\n  onChangeTimeRange,\n  id: panelId,\n}: TimelinePanelProps) => {\n  const theme = useTheme2();\n\n  // temp range set for adding new annotation set by TooltipPlugin2, consumed by AnnotationPlugin2\n  const [newAnnotationRange, setNewAnnotationRange] = useState<TimeRange2 | null>(null);\n  const { sync, eventsScope, canAddAnnotations, dataLinkPostProcessor, eventBus, canExecuteActions } =\n    usePanelContext();\n\n  const userCanExecuteActions = useMemo(() => canExecuteActions?.() ?? false, [canExecuteActions]);\n  const cursorSync = sync?.() ?? DashboardCursorSync.Off;\n\n  const { frames, warn } = useMemo(\n    () => prepareTimelineFields(data.series, options.mergeValues ?? true, timeRange, theme),\n    [data.series, options.mergeValues, timeRange, theme]\n  );\n\n  const { paginatedFrames, paginationRev, paginationElement, paginationHeight } = usePagination(\n    frames,\n    options.perPage\n  );\n\n  const legendItems = useMemo(\n    () => prepareTimelineLegendItems(paginatedFrames, options.legend, theme),\n    [paginatedFrames, options.legend, theme]\n  );\n\n  const timezones = useMemo(() => getTimezones(options.timezone, timeZone), [options.timezone, timeZone]);\n\n  if (!paginatedFrames || typeof warn === 'string') {\n    return <PanelDataErrorView panelId={panelId} fieldConfig={fieldConfig} data={data} message={warn} needsTimeField />;\n  }\n\n  const enableAnnotationCreation = Boolean(canAddAnnotations && canAddAnnotations());\n\n  return (\n    <div className={containerStyles.container}>\n      <TimelineChart\n        theme={theme}\n        frames={paginatedFrames}\n        structureRev={data.structureRev}\n        paginationRev={paginationRev}\n        timeRange={timeRange}\n        timeZone={timezones}\n        width={width}\n        height={height - paginationHeight}\n        legendItems={legendItems}\n        {...options}\n        mode={TimelineMode.Changes}\n        replaceVariables={replaceVariables}\n        dataLinkPostProcessor={dataLinkPostProcessor}\n        cursorSync={cursorSync}\n      >\n        {(builder, alignedFrame) => {\n          return (\n            <>\n              {cursorSync !== DashboardCursorSync.Off && (\n                <EventBusPlugin config={builder} eventBus={eventBus} frame={alignedFrame} />\n              )}\n              {options.tooltip.mode !== TooltipDisplayMode.None && (\n                <TooltipPlugin2\n                  config={builder}\n                  hoverMode={\n                    options.tooltip.mode === TooltipDisplayMode.Multi ? TooltipHoverMode.xAll : TooltipHoverMode.xOne\n                  }\n                  queryZoom={onChangeTimeRange}\n                  syncMode={cursorSync}\n                  syncScope={eventsScope}\n                  getDataLinks={(seriesIdx, dataIdx) =>\n                    alignedFrame.fields[seriesIdx].getLinks?.({ valueRowIndex: dataIdx }) ?? []\n                  }\n                  render={(u, dataIdxs, seriesIdx, isPinned, dismiss, timeRange2, viaSync, dataLinks) => {\n                    if (enableAnnotationCreation && timeRange2 != null) {\n                      setNewAnnotationRange(timeRange2);\n                      dismiss();\n                      return;\n                    }\n\n                    const annotate = () => {\n                      let xVal = u.posToVal(u.cursor.left!, 'x');\n\n                      setNewAnnotationRange({ from: xVal, to: xVal });\n                      dismiss();\n                    };\n\n                    return (\n                      <StateTimelineTooltip2\n                        series={alignedFrame}\n                        dataIdxs={dataIdxs}\n                        seriesIdx={seriesIdx}\n                        mode={viaSync ? TooltipDisplayMode.Multi : options.tooltip.mode}\n                        sortOrder={options.tooltip.sort}\n                        isPinned={isPinned}\n                        timeRange={timeRange}\n                        annotate={enableAnnotationCreation ? annotate : undefined}\n                        withDuration={true}\n                        maxHeight={options.tooltip.maxHeight}\n                        replaceVariables={replaceVariables}\n                        dataLinks={dataLinks}\n                        canExecuteActions={userCanExecuteActions}\n                      />\n                    );\n                  }}\n                  maxWidth={options.tooltip.maxWidth}\n                />\n              )}\n              {alignedFrame.fields[0].config.custom?.axisPlacement !== AxisPlacement.Hidden && (\n                <AnnotationsPlugin2\n                  annotations={data.annotations ?? []}\n                  config={builder}\n                  timeZone={timeZone}\n                  newRange={newAnnotationRange}\n                  setNewRange={setNewAnnotationRange}\n                  canvasRegionRendering={false}\n                />\n              )}\n              <OutsideRangePlugin config={builder} onChangeTimeRange={onChangeTimeRange} />\n            </>\n          );\n        }}\n      </TimelineChart>\n      {paginationElement}\n    </div>\n  );\n};\n","import { isArray } from 'lodash';\n\nimport { FieldConfigSource, MappingType, PanelModel, ValueMap, RangeMap, ValueMapping } from '@grafana/data';\n\nimport { FieldConfig, Options } from './panelcfg.gen';\n\n// This is called when the panel changes from another panel\nexport const timelinePanelChangedHandler = (\n  panel: PanelModel<Partial<Options>> | any,\n  prevPluginId: string,\n  prevOptions: any\n) => {\n  let options: Options = panel.options ?? {};\n\n  // Changing from angular singlestat\n  if (prevPluginId === 'natel-discrete-panel' && prevOptions.angular) {\n    const oldOptions = prevOptions.angular;\n    const fieldConfig: FieldConfigSource = panel.fieldConfig ?? { defaults: {}, overrides: [] };\n\n    if (oldOptions.units) {\n      fieldConfig.defaults.unit = oldOptions.units;\n    }\n\n    const custom: FieldConfig = {\n      fillOpacity: 100,\n      lineWidth: 0,\n    };\n    fieldConfig.defaults.custom = custom;\n    options.mergeValues = true;\n\n    // Convert mappings\n    const valuemap: ValueMap = { type: MappingType.ValueToText, options: {} };\n    fieldConfig.defaults.mappings = [valuemap];\n\n    if (isArray(oldOptions.colorMaps)) {\n      for (const p of oldOptions.colorMaps) {\n        const color: string = p.color;\n        if (color) {\n          valuemap.options[p.text] = { color };\n        }\n      }\n    }\n\n    if (isArray(oldOptions.valueMaps)) {\n      for (const p of oldOptions.valueMaps) {\n        const text: string = p.text;\n        const value: string = p.value;\n        if (text && value) {\n          let old = valuemap.options[value];\n          if (old) {\n            old.text = text;\n          } else {\n            valuemap.options[value] = { text };\n          }\n        }\n      }\n    }\n\n    if (isArray(oldOptions.rangeMaps)) {\n      for (const p of oldOptions.rangeMaps) {\n        let from = +p.from;\n        let to = +p.to;\n        const text: string = p.text;\n        if (text) {\n          fieldConfig.defaults.mappings.push({\n            type: MappingType.RangeToText,\n            options: {\n              from,\n              to,\n              result: { text },\n            },\n          });\n        }\n      }\n    }\n\n    if (fieldConfig.defaults.mappings?.length) {\n      fieldConfig.defaults.mappings = expandColorMappings(fieldConfig.defaults.mappings);\n    }\n\n    // mutates the input\n    panel.fieldConfig = fieldConfig;\n  }\n\n  return options;\n};\n\nfunction expandColorMappings(mappings: ValueMapping[]): ValueMapping[] {\n  let keyToColor: Record<string, string> = {};\n  for (const m of mappings) {\n    if (isValueToText(m)) {\n      for (const key in m.options) {\n        const target = m.options[key];\n        if (target.color?.length) {\n          keyToColor[key] = target.color;\n        }\n      }\n    } else if (isRangeMap(m)) {\n      const { text, color } = m.options.result;\n      if (text?.length && color?.length && !keyToColor[text]) {\n        keyToColor[text] = color;\n      }\n    }\n  }\n\n  // Set a color for values that match\n  return mappings.map((m) => {\n    if (isValueToText(m)) {\n      for (const key in m.options) {\n        const target = m.options[key];\n        if (!target.color?.length) {\n          let c = keyToColor[key];\n          if (!c && target.text) {\n            c = keyToColor[target.text];\n          }\n          if (c) {\n            target.color = c; // link the mapped color\n          }\n        }\n      }\n    } else if (isRangeMap(m)) {\n      const { text, color } = m.options.result;\n      if (!color && text && keyToColor[text]) {\n        m.options.result.color = keyToColor[text];\n      }\n    }\n    return m;\n  });\n}\n\nfunction isValueToText(m: ValueMapping): m is ValueMap {\n  return m.type === MappingType.ValueToText;\n}\n\nfunction isRangeMap(m: ValueMapping): m is RangeMap {\n  return m.type === MappingType.RangeToText;\n}\n","import { VisualizationSuggestionsBuilder } from '@grafana/data';\nimport { SuggestionName } from 'app/types/suggestions';\n\nimport { FieldConfig, Options } from './panelcfg.gen';\n\nexport class StatTimelineSuggestionsSupplier {\n  getSuggestionsForData(builder: VisualizationSuggestionsBuilder) {\n    const { dataSummary: ds } = builder;\n\n    if (!ds.hasData) {\n      return;\n    }\n\n    // This panel needs a time field and a string or number field\n    if (!ds.hasTimeField || (!ds.hasStringField && !ds.hasNumberField)) {\n      return;\n    }\n\n    // If there are many series then they won't fit on y-axis so this panel is not good fit\n    if (ds.numberFieldCount >= 30) {\n      return;\n    }\n\n    // Probably better ways to filter out this by inspecting the types of string values so view this as temporary\n    if (ds.preferredVisualisationType === 'logs') {\n      return;\n    }\n\n    const list = builder.getListAppender<Options, FieldConfig>({\n      name: '',\n      pluginId: 'state-timeline',\n      options: {},\n      fieldConfig: {\n        defaults: {\n          custom: {},\n        },\n        overrides: [],\n      },\n    });\n\n    list.append({ name: SuggestionName.StateTimeline });\n  }\n}\n","import {\n  FieldColorModeId,\n  FieldConfigProperty,\n  FieldType,\n  identityOverrideProcessor,\n  PanelPlugin,\n} from '@grafana/data';\nimport { t } from '@grafana/i18n';\nimport { AxisPlacement, VisibilityMode } from '@grafana/schema';\nimport { commonOptionsBuilder } from '@grafana/ui';\n\nimport { InsertNullsEditor } from '../timeseries/InsertNullsEditor';\nimport { SpanNullsEditor } from '../timeseries/SpanNullsEditor';\nimport { NullEditorSettings } from '../timeseries/config';\n\nimport { StateTimelinePanel } from './StateTimelinePanel';\nimport { timelinePanelChangedHandler } from './migrations';\nimport { defaultFieldConfig, defaultOptions, FieldConfig, Options } from './panelcfg.gen';\nimport { StatTimelineSuggestionsSupplier } from './suggestions';\n\nexport const plugin = new PanelPlugin<Options, FieldConfig>(StateTimelinePanel)\n  .setPanelChangeHandler(timelinePanelChangedHandler)\n  .useFieldConfig({\n    standardOptions: {\n      [FieldConfigProperty.Color]: {\n        settings: {\n          byValueSupport: true,\n        },\n        defaultValue: {\n          mode: FieldColorModeId.ContinuousGrYlRd,\n        },\n      },\n      [FieldConfigProperty.Links]: {\n        settings: {\n          showOneClick: true,\n        },\n      },\n      [FieldConfigProperty.Actions]: {\n        hideFromDefaults: false,\n      },\n    },\n    useCustomConfig: (builder) => {\n      const category = [t('state-timeline.category-state-timeline', 'State timeline')];\n      builder\n        .addSliderInput({\n          path: 'lineWidth',\n          name: t('state-timeline.name-line-width', 'Line width'),\n          category,\n          defaultValue: defaultFieldConfig.lineWidth,\n          settings: {\n            min: 0,\n            max: 10,\n            step: 1,\n          },\n        })\n        .addSliderInput({\n          path: 'fillOpacity',\n          name: t('state-timeline.name-fill-opacity', 'Fill opacity'),\n          category,\n          defaultValue: defaultFieldConfig.fillOpacity,\n          settings: {\n            min: 0,\n            max: 100,\n            step: 1,\n          },\n        })\n        .addCustomEditor<NullEditorSettings, boolean>({\n          id: 'spanNulls',\n          path: 'spanNulls',\n          name: t('state-timeline.name-connect-null-values', 'Connect null values'),\n          category,\n          defaultValue: false,\n          editor: SpanNullsEditor,\n          override: SpanNullsEditor,\n          shouldApply: (field) => field.type !== FieldType.time,\n          process: identityOverrideProcessor,\n          settings: { isTime: true },\n        })\n        .addCustomEditor<NullEditorSettings, boolean>({\n          id: 'insertNulls',\n          path: 'insertNulls',\n          name: t('state-timeline.name-disconnect-values', 'Disconnect values'),\n          category,\n          defaultValue: false,\n          editor: InsertNullsEditor,\n          override: InsertNullsEditor,\n          shouldApply: (field) => field.type !== FieldType.time,\n          process: identityOverrideProcessor,\n          settings: { isTime: true },\n        });\n\n      commonOptionsBuilder.addHideFrom(builder);\n      commonOptionsBuilder.addAxisPlacement(\n        builder,\n        (placement) => placement === AxisPlacement.Auto || placement === AxisPlacement.Hidden\n      );\n      commonOptionsBuilder.addAxisWidth(builder);\n    },\n  })\n  .setPanelOptions((builder) => {\n    const category = [t('state-timeline.category-state-timeline', 'State timeline')];\n    builder\n      .addBooleanSwitch({\n        path: 'mergeValues',\n        name: t('state-timeline.name-merge-equal-consecutive-values', 'Merge equal consecutive values'),\n        category,\n        defaultValue: defaultOptions.mergeValues,\n      })\n      .addRadio({\n        path: 'showValue',\n        name: t('state-timeline.name-show-values', 'Show values'),\n        category,\n        settings: {\n          options: [\n            { value: VisibilityMode.Auto, label: t('state-timeline.show-values-options.label-auto', 'Auto') },\n            { value: VisibilityMode.Always, label: t('state-timeline.show-values-options.label-always', 'Always') },\n            { value: VisibilityMode.Never, label: t('state-timeline.show-values-options.label-never', 'Never') },\n          ],\n        },\n        defaultValue: defaultOptions.showValue,\n      })\n      .addRadio({\n        path: 'alignValue',\n        name: t('state-timeline.name-align-values', 'Align values'),\n        category,\n        settings: {\n          options: [\n            { value: 'left', label: t('state-timeline.align-values-options.label-left', 'Left') },\n            { value: 'center', label: t('state-timeline.align-values-options.label-center', 'Center') },\n            { value: 'right', label: t('state-timeline.align-values-options.label-right', 'Right') },\n          ],\n        },\n        defaultValue: defaultOptions.alignValue,\n      })\n      .addSliderInput({\n        path: 'rowHeight',\n        name: t('state-timeline.name-row-height', 'Row height'),\n        category,\n        settings: {\n          min: 0,\n          max: 1,\n          step: 0.01,\n        },\n        defaultValue: defaultOptions.rowHeight,\n      })\n      .addNumberInput({\n        path: 'perPage',\n        name: t('state-timeline.name-page-size', 'Page size (enable pagination)'),\n        category,\n        settings: {\n          min: 1,\n          step: 1,\n          integer: true,\n        },\n      });\n\n    commonOptionsBuilder.addLegendOptions(builder, false);\n    commonOptionsBuilder.addTooltipOptions(builder);\n  })\n  .setSuggestionsSupplier(new StatTimelineSuggestionsSupplier())\n  .setDataSupport({ annotations: true });\n","import { ReactNode } from 'react';\n\nimport { FieldType, TimeRange } from '@grafana/data';\nimport { SortOrder } from '@grafana/schema/dist/esm/common/common.gen';\nimport { TooltipDisplayMode } from '@grafana/ui';\nimport {\n  VizTooltipContent,\n  VizTooltipFooter,\n  VizTooltipHeader,\n  VizTooltipWrapper,\n  getContentItems,\n  VizTooltipItem,\n} from '@grafana/ui/internal';\nimport { findNextStateIndex, fmtDuration } from 'app/core/components/TimelineChart/utils';\n\nimport { getFieldActions } from '../status-history/utils';\nimport { TimeSeriesTooltipProps } from '../timeseries/TimeSeriesTooltip';\nimport { isTooltipScrollable } from '../timeseries/utils';\n\ninterface StateTimelineTooltip2Props extends TimeSeriesTooltipProps {\n  timeRange: TimeRange;\n  withDuration: boolean;\n}\n\nexport const StateTimelineTooltip2 = ({\n  series,\n  dataIdxs,\n  seriesIdx,\n  mode = TooltipDisplayMode.Single,\n  sortOrder = SortOrder.None,\n  isPinned,\n  annotate,\n  timeRange,\n  withDuration,\n  maxHeight,\n  replaceVariables,\n  dataLinks,\n}: StateTimelineTooltip2Props) => {\n  const xField = series.fields[0];\n\n  const dataIdx = seriesIdx != null ? dataIdxs[seriesIdx] : dataIdxs.find((idx) => idx != null);\n\n  const xVal = xField.display!(xField.values[dataIdx!]).text;\n\n  mode = isPinned ? TooltipDisplayMode.Single : mode;\n\n  const contentItems = getContentItems(series.fields, xField, dataIdxs, seriesIdx, mode, sortOrder);\n  let endTime = null;\n\n  // append duration in single mode\n  if (withDuration && mode === TooltipDisplayMode.Single) {\n    const field = series.fields[seriesIdx!];\n    const nextStateIdx = findNextStateIndex(field, dataIdx!);\n    let nextStateTs;\n    if (nextStateIdx) {\n      nextStateTs = xField.values[nextStateIdx!];\n    }\n\n    const stateTs = xField.values[dataIdx!];\n    let duration: string;\n\n    if (nextStateTs) {\n      duration = nextStateTs && fmtDuration(nextStateTs - stateTs);\n      endTime = nextStateTs;\n    } else {\n      const to = timeRange.to.valueOf();\n      duration = fmtDuration(to - stateTs);\n      endTime = to;\n    }\n\n    contentItems.push({ label: 'Duration', value: duration });\n  }\n\n  let footer: ReactNode;\n\n  if (seriesIdx != null) {\n    const field = series.fields[seriesIdx];\n    const hasOneClickLink = dataLinks.some((dataLink) => dataLink.oneClick === true);\n\n    if (isPinned || hasOneClickLink) {\n      const dataIdx = dataIdxs[seriesIdx]!;\n      const actions = getFieldActions(series, field, replaceVariables!, dataIdx);\n\n      footer = <VizTooltipFooter dataLinks={dataLinks} actions={actions} annotate={annotate} />;\n    }\n  }\n\n  const headerItem: VizTooltipItem = {\n    label: xField.type === FieldType.time ? '' : (xField.state?.displayName ?? xField.name),\n    value: endTime ? xVal + ' - \\n' + xField.display!(endTime).text : xVal,\n  };\n\n  return (\n    <VizTooltipWrapper>\n      <VizTooltipHeader item={headerItem} isPinned={isPinned} />\n      <VizTooltipContent\n        items={contentItems}\n        isPinned={isPinned}\n        scrollable={isTooltipScrollable({ mode, maxHeight })}\n        maxHeight={maxHeight}\n      />\n      {footer}\n    </VizTooltipWrapper>\n  );\n};\n","import { Component } from 'react';\nimport * as React from 'react';\nimport uPlot, { AlignedData } from 'uplot';\n\nimport {\n  DataFrame,\n  DataLinkPostProcessor,\n  Field,\n  FieldMatcherID,\n  fieldMatchers,\n  FieldType,\n  getLinksSupplier,\n  InterpolateFunction,\n  TimeRange,\n  TimeZone,\n} from '@grafana/data';\nimport { DashboardCursorSync, VizLegendOptions } from '@grafana/schema';\nimport { Themeable2, VizLayout } from '@grafana/ui';\nimport { UPlotChart, AxisProps, Renderers, UPlotConfigBuilder, ScaleProps, pluginLog } from '@grafana/ui/internal';\n\nimport { GraphNGLegendEvent, XYFieldMatchers } from './types';\nimport { preparePlotFrame as defaultPreparePlotFrame } from './utils';\n\n/**\n * @internal -- not a public API\n */\nexport type PropDiffFn<T extends Record<string, unknown> = {}> = (prev: T, next: T) => boolean;\n\nexport interface GraphNGProps extends Themeable2 {\n  frames: DataFrame[];\n  structureRev?: number; // a number that will change when the frames[] structure changes\n  width: number;\n  height: number;\n  timeRange: TimeRange;\n  timeZone: TimeZone[] | TimeZone;\n  legend: VizLegendOptions;\n  fields?: XYFieldMatchers; // default will assume timeseries data\n  renderers?: Renderers;\n  tweakScale?: (opts: ScaleProps, forField: Field) => ScaleProps;\n  tweakAxis?: (opts: AxisProps, forField: Field) => AxisProps;\n  onLegendClick?: (event: GraphNGLegendEvent) => void;\n  children?: (builder: UPlotConfigBuilder, alignedFrame: DataFrame) => React.ReactNode;\n  prepConfig: (alignedFrame: DataFrame, allFrames: DataFrame[], getTimeRange: () => TimeRange) => UPlotConfigBuilder;\n  propsToDiff?: Array<string | PropDiffFn>;\n  preparePlotFrame?: (frames: DataFrame[], dimFields: XYFieldMatchers) => DataFrame | null;\n  renderLegend: (config: UPlotConfigBuilder) => React.ReactElement | null;\n  replaceVariables: InterpolateFunction;\n  dataLinkPostProcessor?: DataLinkPostProcessor;\n  cursorSync?: DashboardCursorSync;\n\n  // Remove fields that are hidden from the visualization before rendering\n  // The fields will still be available for other things like data links\n  // this is a temporary hack that only works when:\n  // 1. renderLegend (above) does not render <PlotLegend>\n  // 2. does not have legend series toggle\n  // 3. passes through all fields required for link/action gen (including those with hideFrom.viz)\n  omitHideFromViz?: boolean;\n\n  /**\n   * needed for propsToDiff to re-init the plot & config\n   * this is a generic approach to plot re-init, without having to specify which panel-level options\n   * should cause invalidation. we can drop this in favor of something like panelOptionsRev that gets passed in\n   * similar to structureRev. then we can drop propsToDiff entirely.\n   */\n  options?: Record<string, any>;\n}\n\nfunction sameProps<T extends Record<string, unknown>>(\n  prevProps: T,\n  nextProps: T,\n  propsToDiff: Array<string | PropDiffFn> = []\n) {\n  for (const propName of propsToDiff) {\n    if (typeof propName === 'function') {\n      if (!propName(prevProps, nextProps)) {\n        return false;\n      }\n    } else if (nextProps[propName] !== prevProps[propName]) {\n      return false;\n    }\n  }\n\n  return true;\n}\n\n/**\n * @internal -- not a public API\n */\nexport interface GraphNGState {\n  alignedFrame: DataFrame;\n  alignedData?: AlignedData;\n  config?: UPlotConfigBuilder;\n}\n\nconst defaultMatchers = {\n  x: fieldMatchers.get(FieldMatcherID.firstTimeField).get({}),\n  y: fieldMatchers.get(FieldMatcherID.byTypes).get(new Set([FieldType.number, FieldType.enum])),\n};\n\n/**\n * \"Time as X\" core component, expects ascending x\n */\nexport class GraphNG extends Component<GraphNGProps, GraphNGState> {\n  private plotInstance: React.RefObject<uPlot>;\n\n  constructor(props: GraphNGProps) {\n    super(props);\n    let state = this.prepState(props);\n    state.alignedData = state.config!.prepData!([state.alignedFrame]) as AlignedData;\n    this.state = state;\n    this.plotInstance = React.createRef();\n  }\n\n  getTimeRange = () => this.props.timeRange;\n\n  prepState(props: GraphNGProps, withConfig = true) {\n    let state: GraphNGState = null as any;\n\n    const { frames, fields = defaultMatchers, preparePlotFrame, replaceVariables, dataLinkPostProcessor } = props;\n\n    const preparePlotFrameFn = preparePlotFrame ?? defaultPreparePlotFrame;\n\n    const withLinks = frames.some((frame) => frame.fields.some((field) => (field.config.links?.length ?? 0) > 0));\n\n    const alignedFrame = preparePlotFrameFn(\n      frames,\n      {\n        ...fields,\n        // if there are data links, keep all fields during join so they're index-matched\n        y: withLinks ? () => true : fields.y,\n      },\n      props.timeRange\n    );\n\n    pluginLog('GraphNG', false, 'data aligned', alignedFrame);\n\n    if (alignedFrame) {\n      let alignedFrameFinal = alignedFrame;\n\n      if (withLinks) {\n        const timeZone = Array.isArray(this.props.timeZone) ? this.props.timeZone[0] : this.props.timeZone;\n\n        // for links gen we need to use original frames but with the aligned/joined data values\n        let linkFrames = frames.map((frame, frameIdx) => ({\n          ...frame,\n          fields: alignedFrame.fields.filter(\n            (field, fieldIdx) => fieldIdx === 0 || field.state?.origin?.frameIndex === frameIdx\n          ),\n          length: alignedFrame.length,\n        }));\n\n        linkFrames.forEach((linkFrame, frameIndex) => {\n          linkFrame.fields.forEach((field) => {\n            field.getLinks = getLinksSupplier(\n              linkFrame,\n              field,\n              {\n                ...field.state?.scopedVars,\n                __dataContext: {\n                  value: {\n                    data: linkFrames,\n                    field: field,\n                    frame: linkFrame,\n                    frameIndex,\n                  },\n                },\n              },\n              replaceVariables,\n              timeZone,\n              dataLinkPostProcessor\n            );\n          });\n        });\n\n        // filter join field and fields.y\n        alignedFrameFinal = {\n          ...alignedFrame,\n          fields: alignedFrame.fields.filter((field, i) => i === 0 || fields.y(field, alignedFrame, [alignedFrame])),\n        };\n      }\n\n      if (props.omitHideFromViz) {\n        const nonHiddenFields = alignedFrameFinal.fields.filter((field) => field.config.custom?.hideFrom?.viz !== true);\n        alignedFrameFinal = {\n          ...alignedFrameFinal,\n          fields: nonHiddenFields,\n          length: nonHiddenFields.length,\n        };\n      }\n\n      let config = this.state?.config;\n\n      if (withConfig) {\n        config = props.prepConfig(alignedFrameFinal, this.props.frames, this.getTimeRange);\n        pluginLog('GraphNG', false, 'config prepared', config);\n      }\n\n      state = {\n        alignedFrame: alignedFrameFinal,\n        config,\n      };\n\n      pluginLog('GraphNG', false, 'data prepared', state.alignedData);\n    }\n\n    return state;\n  }\n\n  componentDidUpdate(prevProps: GraphNGProps) {\n    const { frames, structureRev, timeZone, cursorSync, propsToDiff } = this.props;\n\n    const propsChanged = !sameProps(prevProps, this.props, propsToDiff);\n\n    if (\n      frames !== prevProps.frames ||\n      propsChanged ||\n      timeZone !== prevProps.timeZone ||\n      cursorSync !== prevProps.cursorSync\n    ) {\n      let newState = this.prepState(this.props, false);\n\n      if (newState) {\n        const shouldReconfig =\n          this.state.config === undefined ||\n          timeZone !== prevProps.timeZone ||\n          cursorSync !== prevProps.cursorSync ||\n          structureRev !== prevProps.structureRev ||\n          !structureRev ||\n          propsChanged;\n\n        if (shouldReconfig) {\n          newState.config = this.props.prepConfig(newState.alignedFrame, this.props.frames, this.getTimeRange);\n          pluginLog('GraphNG', false, 'config recreated', newState.config);\n        }\n\n        newState.alignedData = newState.config!.prepData!([newState.alignedFrame]) as AlignedData;\n\n        this.setState(newState);\n      }\n    }\n  }\n\n  render() {\n    const { width, height, children, renderLegend } = this.props;\n    const { config, alignedFrame, alignedData } = this.state;\n\n    if (!config) {\n      return null;\n    }\n\n    return (\n      <VizLayout width={width} height={height} legend={renderLegend(config)}>\n        {(vizWidth: number, vizHeight: number) => (\n          <UPlotChart\n            config={config}\n            data={alignedData!}\n            width={vizWidth}\n            height={vizHeight}\n            plotRef={(u) => ((this.plotInstance as React.MutableRefObject<uPlot>).current = u)}\n          >\n            {children ? children(config, alignedFrame) : null}\n          </UPlotChart>\n        )}\n      </VizLayout>\n    );\n  }\n}\n"],"names":["defaultOptions","defaultFieldConfig","propsToDiff","TimelineChart","frameIdx","fieldIdx","value","field","disp","alignedFrame","allFrames","getTimeRange","config","legend","legendItems","f","getDataLinks","rowIdx","links","v","linkLookup","link","key","getAllFrameActions","dataFrame","getFieldActions","replaceVars","rowIndex","actions","actionLookup","action","nullToUndefThreshold","refValues","fieldValues","maxThreshold","prevRef","nullIdx","i","isVisibleBarField","getRefField","frame","refFieldName","applySpanNullsThresholds","refField","spanNulls","getXField","dimFields","frames","preparePlotFrame","timeRange","xField","numBarSeries","acc","minXDeltaGlobal","minXDeltas","minXDeltaFrame","xVals","fi","vals","lastVal","containerStyles","styles","usePagination","perPage","currentPage","setCurrentPage","paginationWrapperRef","paginationHeight","paginationWidth","pagedFrames","numberOfPages","currentPageCapped","pageOffset","currentPageFrames","paginationRev","showSmallVersion","paginationElement","StateTimelinePanel","data","timeZone","options","width","height","fieldConfig","replaceVariables","onChangeTimeRange","panelId","theme","newAnnotationRange","setNewAnnotationRange","sync","eventsScope","canAddAnnotations","dataLinkPostProcessor","eventBus","canExecuteActions","userCanExecuteActions","cursorSync","warn","paginatedFrames","timezones","PanelDataErrorView","enableAnnotationCreation","builder","EventBusPlugin","TooltipPlugin2","seriesIdx","dataIdx","u","dataIdxs","isPinned","dismiss","timeRange2","viaSync","dataLinks","annotate","xVal","StateTimelineTooltip2","AnnotationsPlugin2","OutsideRangePlugin","timelinePanelChangedHandler","panel","prevPluginId","prevOptions","oldOptions","custom","valuemap","p","color","text","old","from","to","expandColorMappings","mappings","keyToColor","m","isValueToText","target","isRangeMap","c","StatTimelineSuggestionsSupplier","ds","PanelPlugin","category","SpanNullsEditor","InsertNullsEditor","placement","series","mode","sortOrder","withDuration","maxHeight","idx","contentItems","endTime","nextStateIdx","nextStateTs","stateTs","duration","footer","hasOneClickLink","dataLink","headerItem","sameProps","prevProps","nextProps","propName","defaultMatchers","GraphNG","props","state","withConfig","fields","preparePlotFrameFn","withLinks","alignedFrameFinal","linkFrames","linkFrame","frameIndex","nonHiddenFields","structureRev","propsChanged","newState","children","renderLegend","alignedData","vizWidth","vizHeight"],"sourceRoot":""}