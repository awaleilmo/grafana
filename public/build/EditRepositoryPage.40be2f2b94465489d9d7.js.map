{"version":3,"file":"EditRepositoryPage.40be2f2b94465489d9d7.js","mappings":"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","sources":["webpack://grafana/./public/app/features/provisioning/components/InlineSecureValueWarning.tsx","webpack://grafana/./public/app/features/provisioning/Config/ConfigFormGithubCollapse.tsx","webpack://grafana/./public/app/features/provisioning/Config/ConfigForm.tsx","webpack://grafana/./public/app/features/provisioning/Repository/EditRepositoryPage.tsx"],"sourcesContent":["import { t } from '@grafana/i18n';\nimport { Alert } from '@grafana/ui';\nimport { Repository } from 'app/api/clients/provisioning/v0alpha1';\n\ninterface Props {\n  repo?: Repository;\n  items?: Repository[];\n}\n\n// TODO: remove this after 12.2\nexport function InlineSecureValueWarning({ repo, items }: Props) {\n  const isRepoValid = (r?: Repository) => r?.spec?.type === 'local' || !!r?.secure?.token?.name;\n\n  if (isRepoValid(repo)) {\n    return null;\n  }\n\n  // When a list is passed in, show an error if anything is missing\n  if (items?.every(isRepoValid)) {\n    return null;\n  }\n\n  return (\n    <Alert\n      title={t(\n        'provisioning.inline-secure-values-warning',\n        'You need to save your access tokens again due to a system update'\n      )}\n      severity=\"error\"\n    />\n  );\n}\n","import { UseFormRegister } from 'react-hook-form';\n\nimport { Trans, t } from '@grafana/i18n';\nimport { Checkbox, ControlledCollapse, Field, Text, TextLink } from '@grafana/ui';\n\nimport { checkImageRenderer, checkPublicAccess } from '../GettingStarted/features';\nimport { GETTING_STARTED_URL } from '../constants';\nimport { RepositoryFormData } from '../types';\n\nexport interface ConfigFormGithubCollapseProps {\n  register: UseFormRegister<RepositoryFormData>;\n}\n\nexport function ConfigFormGithubCollapse({ register }: ConfigFormGithubCollapseProps) {\n  const isPublic = checkPublicAccess();\n  const hasImageRenderer = checkImageRenderer();\n\n  return (\n    <ControlledCollapse\n      label={t('provisioning.config-form-github-collapse.label-git-hub-features', 'GitHub features')}\n      isOpen={true}\n    >\n      <Field>\n        <Checkbox\n          disabled={!hasImageRenderer || !isPublic}\n          label={t('provisioning.finish-step.label-enable-previews', 'Enable dashboard previews in pull requests')}\n          description={\n            <>\n              <Trans i18nKey=\"provisioning.finish-step.description-enable-previews\">\n                Adds an image preview of dashboard changes in pull requests. Images of your Grafana dashboards will be\n                shared in your Git repository and visible to anyone with repository access.\n              </Trans>{' '}\n              <Text italic>\n                <Trans i18nKey=\"provisioning.finish-step.description-image-rendering\">\n                  Requires image rendering.{' '}\n                  <TextLink\n                    variant=\"bodySmall\"\n                    external\n                    href=\"https://grafana.com/grafana/plugins/grafana-image-renderer\"\n                  >\n                    Set up image rendering\n                  </TextLink>\n                </Trans>\n              </Text>\n            </>\n          }\n          {...register('generateDashboardPreviews')}\n        />\n      </Field>\n\n      {!isPublic && (\n        <Field label={t('provisioning.config-form-github-collapse.label-realtime-feedback', 'Realtime feedback')}>\n          <Text variant=\"bodySmall\" color={'secondary'}>\n            <Trans i18nKey={'provisioning.config-form-github-collapse.description-realtime-feedback'}>\n              <TextLink variant={'bodySmall'} href={GETTING_STARTED_URL}>\n                Configure webhooks\n              </TextLink>{' '}\n              to get instant updates in Grafana as soon as changes are committed. Review and approve changes using pull\n              requests before they go live.\n            </Trans>\n          </Text>\n        </Field>\n      )}\n    </ControlledCollapse>\n  );\n}\n","import { skipToken } from '@reduxjs/toolkit/query/react';\nimport { useEffect, useMemo, useState } from 'react';\nimport { Controller, useForm } from 'react-hook-form';\nimport { useNavigate } from 'react-router-dom-v5-compat';\n\nimport { t } from '@grafana/i18n';\nimport {\n  Button,\n  Checkbox,\n  Combobox,\n  ControlledCollapse,\n  Field,\n  Input,\n  RadioButtonGroup,\n  SecretInput,\n  Stack,\n  Switch,\n} from '@grafana/ui';\nimport { Repository, useGetRepositoryRefsQuery } from 'app/api/clients/provisioning/v0alpha1';\nimport { FormPrompt } from 'app/core/components/FormPrompt/FormPrompt';\n\nimport { TokenPermissionsInfo } from '../Shared/TokenPermissionsInfo';\nimport { getGitProviderFields, getLocalProviderFields } from '../Wizard/fields';\nimport { InlineSecureValueWarning } from '../components/InlineSecureValueWarning';\nimport { useCreateOrUpdateRepository } from '../hooks/useCreateOrUpdateRepository';\nimport { RepositoryFormData } from '../types';\nimport { dataToSpec } from '../utils/data';\nimport { getHasTokenInstructions } from '../utils/git';\nimport { getRepositoryTypeConfig, isGitProvider } from '../utils/repositoryTypes';\n\nimport { ConfigFormGithubCollapse } from './ConfigFormGithubCollapse';\nimport { getDefaultValues } from './defaults';\n\n// This needs to be a function for translations to work\nconst getTargetOptions = () => {\n  return [\n    { value: 'instance', label: t('provisioning.config-form.option-entire-instance', 'Entire instance') },\n    { value: 'folder', label: t('provisioning.config-form.option-managed-folder', 'Managed folder') },\n  ];\n};\n\nexport interface ConfigFormProps {\n  data?: Repository;\n}\nexport function ConfigForm({ data }: ConfigFormProps) {\n  const repositoryName = data?.metadata?.name;\n  const [submitData, request] = useCreateOrUpdateRepository(repositoryName);\n  const {\n    register,\n    handleSubmit,\n    reset,\n    control,\n    formState: { errors, isDirty },\n    setValue,\n    setError,\n    watch,\n    getValues,\n  } = useForm<RepositoryFormData>({ defaultValues: getDefaultValues(data?.spec) });\n\n  const isEdit = Boolean(repositoryName);\n  const [tokenConfigured, setTokenConfigured] = useState(isEdit);\n  const [isLoading, setIsLoading] = useState(false);\n  const navigate = useNavigate();\n  const [type, readOnly] = watch(['type', 'readOnly']);\n  const targetOptions = useMemo(() => getTargetOptions(), []);\n  const isGitBased = isGitProvider(type);\n\n  const {\n    data: refsData,\n    isLoading: refsLoading,\n    error: refsError,\n  } = useGetRepositoryRefsQuery(!repositoryName || !isGitBased ? skipToken : { name: repositoryName });\n\n  const branchOptions = useMemo(() => {\n    if (!refsData?.items) {\n      return [];\n    }\n\n    return refsData.items.map((ref) => ({\n      label: ref.name,\n      value: ref.name,\n    }));\n  }, [refsData?.items]);\n\n  // Get field configurations based on provider type\n  const gitFields = isGitBased ? getGitProviderFields(type) : null;\n  const localFields = type === 'local' ? getLocalProviderFields(type) : null;\n  const hasTokenInstructions = getHasTokenInstructions(type);\n\n  // TODO: this should be removed after 12.2 is released\n  useEffect(() => {\n    if (isGitBased && !data?.secure?.token) {\n      setTokenConfigured(false);\n      setError('token', {\n        type: 'manual',\n        message: `Enter your ${gitFields?.tokenConfig.label ?? 'access token'}`,\n      });\n    }\n  }, [data, gitFields, setTokenConfigured, setError, isGitBased]);\n\n  useEffect(() => {\n    if (request.isSuccess) {\n      const formData = getValues();\n      reset(formData);\n      setTimeout(() => {\n        navigate('/admin/provisioning');\n      }, 300);\n    }\n  }, [request.isSuccess, reset, getValues, navigate]);\n\n  const onSubmit = async (form: RepositoryFormData) => {\n    setIsLoading(true);\n    try {\n      const spec = dataToSpec(form);\n      await submitData(spec, form.token);\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  return (\n    <form onSubmit={handleSubmit(onSubmit)} style={{ maxWidth: 700 }}>\n      <FormPrompt onDiscard={reset} confirmRedirect={isDirty} />\n      <Stack direction=\"column\" gap={2}>\n        <Field noMargin label={t('provisioning.config-form.label-repository-type', 'Repository type')}>\n          <Input value={getRepositoryTypeConfig(type)?.label || type} disabled />\n        </Field>\n        <Field\n          noMargin\n          label={t('provisioning.config-form.label-title', 'Title')}\n          description={t('provisioning.config-form.description-title', 'A human-readable name for the config')}\n          invalid={!!errors.title}\n          error={errors?.title?.message}\n        >\n          <Input\n            {...register('title', {\n              required: t('provisioning.config-form.error-required', 'This field is required.'),\n            })}\n            placeholder={t('provisioning.config-form.placeholder-my-config', 'My config')}\n          />\n        </Field>\n        {gitFields && (\n          <>\n            <InlineSecureValueWarning repo={data} />\n            <Field\n              noMargin\n              label={gitFields.tokenConfig.label}\n              required={gitFields.tokenConfig.required}\n              error={errors?.token?.message}\n              invalid={!!errors.token}\n              description={gitFields.tokenConfig.description}\n            >\n              <Controller\n                name={'token'}\n                control={control}\n                rules={{\n                  required: isEdit ? false : gitFields.tokenConfig.validation?.required,\n                }}\n                render={({ field: { ref, ...field } }) => {\n                  return (\n                    <SecretInput\n                      {...field}\n                      invalid={!!errors.token}\n                      id={'token'}\n                      placeholder={gitFields.tokenConfig.placeholder}\n                      isConfigured={tokenConfigured}\n                      onReset={() => {\n                        setValue('token', '');\n                        setTokenConfigured(false);\n                      }}\n                    />\n                  );\n                }}\n              />\n            </Field>\n            {gitFields.tokenUserConfig && (\n              <Field\n                noMargin\n                label={gitFields.tokenUserConfig.label}\n                required={gitFields.tokenUserConfig.required}\n                error={errors?.tokenUser?.message}\n                invalid={!!errors?.tokenUser}\n                description={gitFields.tokenUserConfig.description}\n              >\n                <Input\n                  {...register('tokenUser', {\n                    required: gitFields.tokenUserConfig.validation?.required,\n                  })}\n                  placeholder={gitFields.tokenUserConfig.placeholder}\n                />\n              </Field>\n            )}\n            {hasTokenInstructions && <TokenPermissionsInfo type={type} />}\n            <Field\n              noMargin\n              label={gitFields.urlConfig.label}\n              error={errors?.url?.message}\n              invalid={!!errors?.url}\n              description={gitFields.urlConfig.description}\n              required={gitFields.urlConfig.required}\n            >\n              <Input\n                {...register('url', {\n                  required: gitFields.urlConfig.validation?.required,\n                  pattern: gitFields.urlConfig.validation?.pattern,\n                })}\n                placeholder={gitFields.urlConfig.placeholder}\n              />\n            </Field>\n            <Field\n              noMargin\n              label={gitFields.branchConfig.label}\n              description={gitFields.branchConfig.description}\n              error={\n                errors?.branch?.message ||\n                (refsError ? t('provisioning.config-form.error-fetch-branches', 'Failed to fetch branches') : undefined)\n              }\n              invalid={Boolean(errors?.branch?.message || refsError)}\n            >\n              <Controller\n                name=\"branch\"\n                control={control}\n                rules={gitFields.branchConfig.validation}\n                render={({ field: { ref, onChange, ...field } }) => (\n                  <Combobox\n                    invalid={Boolean(errors?.branch?.message || refsError)}\n                    onChange={(option) => onChange(option?.value || '')}\n                    placeholder={gitFields.branchConfig.placeholder}\n                    options={branchOptions}\n                    loading={refsLoading}\n                    isClearable\n                    {...field}\n                  />\n                )}\n              />\n            </Field>\n            <Field noMargin label={gitFields.pathConfig.label} description={gitFields.pathConfig.description}>\n              <Input {...register('path')} />\n            </Field>\n          </>\n        )}\n\n        {localFields && (\n          <Field\n            noMargin\n            label={localFields.pathConfig.label}\n            error={errors?.path?.message}\n            invalid={!!errors?.path}\n            description={localFields.pathConfig.description}\n            required={localFields.pathConfig.required}\n          >\n            <Input\n              {...register('path', {\n                required: localFields.pathConfig.validation?.required,\n              })}\n              placeholder={localFields.pathConfig.placeholder}\n            />\n          </Field>\n        )}\n\n        <Field noMargin>\n          <Checkbox\n            {...register('readOnly', {\n              onChange: (e) => {\n                if (e.target.checked) {\n                  setValue('prWorkflow', false);\n                }\n              },\n            })}\n            label={t('provisioning.finish-step.label-read-only', 'Read only')}\n            description={t(\n              'provisioning.config-form.description-read-only',\n              \"Resources can't be modified through Grafana.\"\n            )}\n          />\n        </Field>\n\n        {gitFields && (\n          <Field noMargin>\n            <Checkbox\n              disabled={readOnly}\n              {...register('prWorkflow')}\n              label={gitFields.prWorkflowConfig.label}\n              description={gitFields.prWorkflowConfig.description}\n            />\n          </Field>\n        )}\n        {type === 'github' && <ConfigFormGithubCollapse register={register} />}\n\n        {isGitBased && (\n          <ControlledCollapse\n            label={t('provisioning.config-form.label-automatic-pulling', 'Automatic pulling')}\n            isOpen={false}\n          >\n            <Stack direction=\"column\" gap={2}>\n              <Field\n                noMargin\n                label={t('provisioning.config-form.label-enabled', 'Enabled')}\n                description={t(\n                  'provisioning.config-form.description-enabled',\n                  'Once automatic pulling is enabled, the target cannot be changed.'\n                )}\n              >\n                <Switch {...register('sync.enabled')} id={'sync.enabled'} />\n              </Field>\n              <Field\n                noMargin\n                label={t('provisioning.config-form.label-target', 'Target')}\n                required\n                error={errors?.sync?.target?.message}\n                invalid={!!errors?.sync?.target}\n              >\n                <Controller\n                  name={'sync.target'}\n                  control={control}\n                  rules={{ required: t('provisioning.config-form.error-required', 'This field is required.') }}\n                  render={({ field: { ref, onChange, ...field } }) => {\n                    return (\n                      <RadioButtonGroup\n                        options={targetOptions}\n                        onChange={onChange}\n                        disabled={Boolean(data?.status?.sync.state)}\n                        {...field}\n                      />\n                    );\n                  }}\n                />\n              </Field>\n              <Field noMargin label={t('provisioning.config-form.label-interval-seconds', 'Interval (seconds)')}>\n                <Input\n                  {...register('sync.intervalSeconds', { valueAsNumber: true })}\n                  type={'number'}\n                  placeholder={t('provisioning.config-form.placeholder-interval-seconds', '60')}\n                />\n              </Field>\n            </Stack>\n          </ControlledCollapse>\n        )}\n\n        <Stack gap={2}>\n          <Button type={'submit'} disabled={isLoading}>\n            {isLoading\n              ? t('provisioning.config-form.button-saving', 'Saving...')\n              : t('provisioning.config-form.button-save', 'Save')}\n          </Button>\n        </Stack>\n      </Stack>\n    </form>\n  );\n}\n","import { useParams } from 'react-router-dom-v5-compat';\n\nimport { Trans, t } from '@grafana/i18n';\nimport { EmptyState, Text, TextLink } from '@grafana/ui';\nimport { useGetRepositoryQuery } from 'app/api/clients/provisioning/v0alpha1';\nimport { Page } from 'app/core/components/Page/Page';\n\nimport { ConfigForm } from '../Config/ConfigForm';\nimport { PROVISIONING_URL } from '../constants';\n\nexport default function EditRepositoryPage() {\n  const { name = '' } = useParams();\n  const query = useGetRepositoryQuery({ name });\n  //@ts-expect-error TODO add error types\n  const notFound = query.isError && query.error?.status === 404;\n  return (\n    <Page\n      navId=\"provisioning\"\n      pageNav={{\n        text: t('provisioning.edit-repository-page.text.configure-repository', 'Configure repository'),\n        subTitle: t(\n          'provisioning.edit-repository-page.subTitle.configure-repository-storing-resources',\n          'Configure a repository for storing your resources.'\n        ),\n      }}\n    >\n      <Page.Contents isLoading={query.isLoading}>\n        {notFound ? (\n          <EmptyState message={`Repository config not found`} variant=\"not-found\">\n            <Text element={'p'}>\n              <Trans i18nKey=\"provisioning.edit-repository-page.repository-config-exists-configuration\">\n                Make sure the repository config exists in the configuration file.\n              </Trans>\n            </Text>\n            <TextLink href={PROVISIONING_URL}>\n              <Trans i18nKey=\"provisioning.edit-repository-page.back-to-repositories\">Back to repositories</Trans>\n            </TextLink>\n          </EmptyState>\n        ) : (\n          <ConfigForm data={query.data} />\n        )}\n      </Page.Contents>\n    </Page>\n  );\n}\n"],"names":["InlineSecureValueWarning","repo","items","isRepoValid","r","ConfigFormGithubCollapse","register","isPublic","hasImageRenderer","Field","Checkbox","Text","TextLink","getTargetOptions","ConfigForm","data","repositoryName","submitData","request","useCreateOrUpdateRepository","handleSubmit","reset","control","errors","isDirty","setValue","setError","watch","getValues","isEdit","tokenConfigured","setTokenConfigured","isLoading","setIsLoading","navigate","type","readOnly","targetOptions","isGitBased","refsData","refsLoading","refsError","branchOptions","ref","gitFields","localFields","hasTokenInstructions","formData","onSubmit","form","spec","FormPrompt","Stack","Input","field","SecretInput","TokenPermissionsInfo","onChange","Combobox","option","e","Switch","RadioButtonGroup","Button","EditRepositoryPage","name","query","notFound","Page","EmptyState"],"sourceRoot":""}