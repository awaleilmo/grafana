"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[8259],{11686:(_,R,t)=>{t.d(R,{K:()=>C,Q:()=>T});var m=t(739);const C={alignValue:"left",mergeValues:!0,perPage:20,rowHeight:.9,showValue:m.yL.Auto},T={fillOpacity:70,lineWidth:0}},16608:(_,R,t)=>{t.d(R,{I:()=>p});var m=t(74848),C=t(96540),T=t(64394),u=t(95004),f=t(739),x=t(54735),P=t(4268),A=t(47220),O=t(68706);const d=["rowHeight","colWidth","showValue","mergeValues","alignValue","tooltip","paginationRev"];class p extends C.Component{constructor(){super(...arguments),this.getValueColor=(a,l,e)=>{const i=this.props.frames[a]?.fields[l];if(i?.display){const n=i.display(e);if(n.color)return n.color}return T.F},this.prepConfig=(a,l,e)=>(0,O.iE)({frame:a,getTimeRange:e,allFrames:this.props.frames,...this.props,timeZones:Array.isArray(this.props.timeZone)?this.props.timeZone:[this.props.timeZone],rowHeight:a.fields.length>2?this.props.rowHeight:1,getValueColor:this.getValueColor,hoverMulti:this.props.tooltip?.mode===f.$N.Multi}),this.renderLegend=a=>{const{legend:l,legendItems:e}=this.props;return!a||!e||!l||l.showLegend===!1?null:(0,m.jsx)(x.KU.Legend,{placement:l.placement,children:(0,m.jsx)(P.t,{placement:l.placement,items:e,displayMode:l.displayMode,readonly:!0})})}}render(){return(0,m.jsx)(A.o,{...this.props,fields:{x:a=>a.type===u.PU.time,y:a=>a.type===u.PU.number||a.type===u.PU.boolean||a.type===u.PU.string||a.type===u.PU.enum},prepConfig:this.prepConfig,propsToDiff:d,renderLegend:this.renderLegend,omitHideFromViz:!0})}}},16913:(_,R,t)=>{t.d(R,{OG:()=>u,u6:()=>C});var m=t(73163);const C=(f,x)=>{const P=[];if((f.config.links?.length??0)>0&&f.getLinks!=null){const A=f.values[x],O=f.display?f.display(A):{text:`${A}`,numeric:+A},d=new Set;f.getLinks({calculatedValue:O,valueRowIndex:x}).forEach(p=>{const s=`${p.title}/${p.href}`;d.has(s)||(P.push(p),d.add(s))})}return P},T=f=>{},u=(f,x,P,A)=>{const O=[],d=new Set;return(0,m.ko)(f,x,x.state.scopedVars,P,x.config.actions??[],{valueRowIndex:A}).forEach(s=>{const a=`${s.title}`;d.has(a)||(O.push(s),d.add(a))}),O}},17669:(_,R,t)=>{t.d(R,{m:()=>p});var m=t(95004),C=t(63409),T=t(79243),u=t(8721);function f(s,a,l){let e,i;for(let n=0;n<a.length;n++)if(a[n]==null)i==null&&e!=null&&(i=n);else{if(i!=null&&e!=null){if(s[n]-e<l)for(;i<n;)a[i++]=void 0;i=null}e=s[n]}return a}var x=t(739);function P(s){return s.type===m.PU.number&&s.config.custom?.drawStyle===x.GR.Bars&&!s.config.custom?.hideFrom?.viz}function A(s,a){return s.fields.find(l=>a!=null?l.name===a:l.type===m.PU.time)}function O(s,a){const l=A(s,a);let e=l?.values;for(let i=0;i<s.fields.length;i++){let n=s.fields[i];if(n===l||P(n))continue;let o=n.config.custom?.spanNulls;typeof o=="number"&&o!==-1&&e&&(n.values=f(e,n.values,o))}return s}function d(s,a,l){for(let e of a.fields)if(s.x(e,a,l))return e}function p(s,a,l){s=s.map(o=>{const r=d(a,o,s);return r!=null&&!r.state?.nullThresholdApplied?(0,C.M)({frame:o,refFieldName:r.name,refFieldPseudoMin:l?.from.valueOf(),refFieldPseudoMax:l?.to.valueOf()}):o});let e=s.reduce((o,r)=>o+r.fields.reduce((h,c)=>h+(P(c)?1:0),0),0),i=null;if(e>1){const o=new Set;s.forEach(r=>{if(!r.fields.some(P))return;const h=d(a,r,s);if(h==null)return;let c=1/0;const E=h.values;for(let L=0;L<E.length;L++)L>0&&(c=Math.min(c,E[L]-E[L-1]));c!==1/0&&(Number.isInteger(c)||(c=(0,T.h)(c,6)),o.add(c))}),o.size>1&&(i=Math.min(...o))}let n=(0,u.Fd)({frames:s,joinBy:a.x,keep:a.y,keepOriginIndices:!0,keepDisplayNames:!0,nullMode:o=>{if(P(o))return u.WO;let r=o.config.custom?.spanNulls;return r===!0?u.RC:r===-1?u.WO:u.JI}});return n?(n=O(n,n.fields[0].name),i!=null&&(n.fields.forEach((o,r)=>{let h=o.values;if(r===0){let c=h[h.length-1];h.push(c+i,c+2*i)}else P(o)?h.push(null,null):h.push(void 0,void 0)}),n.length+=2),n):null}},24181:(_,R,t)=>{t.r(R),t.d(R,{plugin:()=>W});var m=t(16207),C=t(83340),T=t(64394),u=t(92745),f=t(739),x=t(45013),P=t(44017),A=t(41069),O=t(79277),d=t(74848),p=t(96540),s=t(84229),a=t(14477),l=t(63142),e=t(64400),i=t(18667),n=t(69234),o=t(16608),r=t(68706),h=t(44391),c=t(28343),E=t(36327),L=t(13507),U=t(76234);const v=({data:M,timeRange:g,timeZone:D,options:y,width:K,height:j,fieldConfig:G,replaceVariables:J,onChangeTimeRange:Q,id:st})=>{const V=(0,l.$j)(),[at,z]=(0,p.useState)(null),{sync:it,eventsScope:ot,canAddAnnotations:w,dataLinkPostProcessor:lt,eventBus:rt,canExecuteActions:b}=(0,e.d2)(),Y=it?.()??s.y.Off,k=!!(w&&w()),ut=(0,p.useMemo)(()=>b?.()??!1,[b]),{frames:dt,warn:q}=(0,p.useMemo)(()=>(0,r.Qe)(M.series,!1,g,V),[M.series,g,V]),{paginatedFrames:N,paginationRev:ft,paginationElement:gt,paginationHeight:ct}=(0,c.W)(dt,y.perPage),ht=(0,p.useMemo)(()=>(0,r.Or)(N,y.legend,V),[N,y.legend,V]),mt=(0,p.useMemo)(()=>(0,U.Fg)(y.timezone,D),[y.timezone,D]);return!N||typeof q=="string"?(0,d.jsx)(a.a,{panelId:st,fieldConfig:G,data:M,message:q,needsTimeField:!0}):N[0].length>K/2?(0,d.jsx)("div",{className:"panel-empty",children:(0,d.jsx)("p",{children:(0,d.jsxs)(u.x6,{i18nKey:"status-history.status-history-panel.too-many-points",count:N[0].length,children:["Too many points to visualize properly. ",(0,d.jsx)("br",{}),"Update the query to return fewer points. ",(0,d.jsx)("br",{}),"(","{{count}}"," points received)"]})})}):(0,d.jsxs)("div",{className:c.i.container,children:[(0,d.jsx)(o.I,{theme:V,frames:N,structureRev:M.structureRev,paginationRev:ft,timeRange:g,timeZone:mt,width:K,height:j-ct,legendItems:ht,...y,mode:r.pm.Samples,replaceVariables:J,dataLinkPostProcessor:lt,cursorSync:Y,children:(H,$)=>(0,d.jsxs)(d.Fragment,{children:[Y!==s.y.Off&&(0,d.jsx)(i.K,{config:H,eventBus:rt,frame:$}),y.tooltip.mode!==f.$N.None&&(0,d.jsx)(n.xl,{config:H,hoverMode:y.tooltip.mode===f.$N.Multi?n.b3.xAll:n.b3.xOne,queryZoom:Q,syncMode:Y,syncScope:ot,getDataLinks:(Z,X)=>$.fields[Z].getLinks?.({valueRowIndex:X})??[],render:(Z,X,pt,Et,tt,et,vt,Mt)=>{if(k&&et!=null){z(et),tt();return}const yt=()=>{let nt=Z.posToVal(Z.cursor.left,"x");z({from:nt,to:nt}),tt()};return(0,d.jsx)(h.K,{series:$,dataIdxs:X,seriesIdx:pt,mode:vt?f.$N.Multi:y.tooltip.mode,sortOrder:y.tooltip.sort,isPinned:Et,timeRange:g,annotate:k?yt:void 0,withDuration:!1,maxHeight:y.tooltip.maxHeight,replaceVariables:J,dataLinks:Mt,canExecuteActions:ut})},maxWidth:y.tooltip.maxWidth}),$.fields[0].config.custom?.axisPlacement!==f.vM.Hidden&&(0,d.jsx)(E.W,{annotations:M.annotations??[],config:H,timeZone:D,newRange:at,setNewRange:z,canvasRegionRendering:!1}),(0,d.jsx)(L.U,{config:H,onChangeTimeRange:Q})]})}),gt]})},I={colWidth:.9,perPage:20,rowHeight:.9,showValue:f.yL.Auto},S={fillOpacity:70,lineWidth:1};var B=t(73495);class F{getSuggestionsForData(g){const{dataSummary:D}=g;if(!D.hasData||!D.hasTimeField||!D.hasStringField&&!D.hasNumberField||D.numberFieldCount>=30||D.rowCountMax>100||D.preferredVisualisationType==="logs")return;g.getListAppender({name:"",pluginId:"status-history",options:{},fieldConfig:{defaults:{color:{mode:T.Y.ContinuousGrYlRd},custom:{}},overrides:[]},cardOptions:{previewModifier:K=>{K.options.colWidth=.7}}}).append({name:B.m.StatusHistory})}}const W=new m.m(v).useFieldConfig({standardOptions:{[C.uo.Color]:{settings:{byValueSupport:!0},defaultValue:{mode:T.Y.Thresholds}},[C.uo.Links]:{settings:{showOneClick:!0}},[C.uo.Actions]:{hideFromDefaults:!1}},useCustomConfig:M=>{const g=[(0,u.t)("status-history.category-status-history","Status history")];M.addSliderInput({path:"lineWidth",name:(0,u.t)("status-history.name-line-width","Line width"),category:g,defaultValue:S.lineWidth,settings:{min:0,max:10,step:1}}).addSliderInput({path:"fillOpacity",name:(0,u.t)("status-history.name-fill-opacity","Fill opacity"),category:g,defaultValue:S.fillOpacity,settings:{min:0,max:100,step:1}}),x.e(M),P.Wq(M,D=>D===f.vM.Auto||D===f.vM.Hidden),P.T4(M)}}).setPanelOptions(M=>{const g=[(0,u.t)("status-history.category-status-history","Status history")];M.addRadio({path:"showValue",name:(0,u.t)("status-history.name-show-values","Show values"),category:g,settings:{options:[{value:f.yL.Auto,label:(0,u.t)("status-history.show-values-options.label-auto","Auto")},{value:f.yL.Always,label:(0,u.t)("status-history.show-values-options.label-always","Always")},{value:f.yL.Never,label:(0,u.t)("status-history.show-values-options.label-never","Never")}]},defaultValue:f.yL.Auto}).addSliderInput({path:"rowHeight",name:(0,u.t)("status-history.name-row-height","Row height"),category:g,defaultValue:.9,settings:{min:0,max:1,step:.01}}).addSliderInput({path:"colWidth",name:(0,u.t)("status-history.name-column-width","Column width"),category:g,defaultValue:.9,settings:{min:0,max:1,step:.01}}).addNumberInput({path:"perPage",name:(0,u.t)("status-history.name-page-size","Page size (enable pagination)"),category:g,settings:{min:1,step:1,integer:!0}}),A.H(M,!1),O.D(M)}).setSuggestionsSupplier(new F).setDataSupport({annotations:!0})},28343:(_,R,t)=>{t.d(R,{W:()=>d,i:()=>A});var m=t(74848),C=t(22803),T=t(96540),u=t(49185),f=t(34213),x=t(68706),P=t(11686);const A={container:(0,C.css)({display:"flex",flexDirection:"column"})},O={paginationContainer:(0,C.css)({display:"flex",justifyContent:"center",width:"100%"}),paginationElement:(0,C.css)({marginTop:"8px"})};function d(p,s){const[a,l]=(0,T.useState)(1),[e,{height:i,width:n}]=(0,u.A)(),o=(0,T.useMemo)(()=>!s||p==null?p:(0,x.be)(p),[p,s]);if(!s||o==null)return{paginatedFrames:o,paginationRev:"disabled",paginationElement:void 0,paginationHeight:0};s||=P.K.perPage;const r=Math.ceil(o.length/s),h=Math.min(a,r),c=(h-1)*s,E=o.slice(c,c+s),L=`${h}/${s}`,U=n<550,v=(0,m.jsx)("div",{className:O.paginationContainer,ref:e,children:(0,m.jsx)(f.d,{className:O.paginationElement,currentPage:h,numberOfPages:r,showSmallVersion:U,onNavigate:l})});return{paginatedFrames:E,paginationRev:L,paginationElement:v,paginationHeight:i}}},44391:(_,R,t)=>{t.d(R,{K:()=>s});var m=t(74848),C=t(95004),T=t(739),u=t(47466),f=t(39064),x=t(41530),P=t(61048),A=t(55302),O=t(68706),d=t(16913),p=t(76234);const s=({series:a,dataIdxs:l,seriesIdx:e,mode:i=T.$N.Single,sortOrder:n=T.xB.None,isPinned:o,annotate:r,timeRange:h,withDuration:c,maxHeight:E,replaceVariables:L,dataLinks:U})=>{const v=a.fields[0],I=e!=null?l[e]:l.find(g=>g!=null),S=v.display(v.values[I]).text;i=o?T.$N.Single:i;const B=(0,A.cp)(a.fields,v,l,e,i,n);let F=null;if(c&&i===T.$N.Single){const g=a.fields[e],D=(0,O.GY)(g,I);let y;D&&(y=v.values[D]);const K=v.values[I];let j;if(y)j=y&&(0,O.c5)(y-K),F=y;else{const G=h.to.valueOf();j=(0,O.c5)(G-K),F=G}B.push({label:"Duration",value:j})}let W;if(e!=null){const g=a.fields[e],D=U.some(y=>y.oneClick===!0);if(o||D){const y=l[e],K=(0,d.OG)(a,g,L,y);W=(0,m.jsx)(f.S,{dataLinks:U,actions:K,annotate:r})}}const M={label:v.type===C.PU.time?"":v.state?.displayName??v.name,value:F?S+` - 
`+v.display(F).text:S};return(0,m.jsxs)(P.i,{children:[(0,m.jsx)(x.A,{item:M,isPinned:o}),(0,m.jsx)(u.o,{items:B,isPinned:o,scrollable:(0,p.T5)({mode:i,maxHeight:E}),maxHeight:E}),W]})}},47220:(_,R,t)=>{t.d(R,{o:()=>a});var m=t(74848),C=t(96540),T=t(36638),u=t(57866),f=t(60519),x=t(95004),P=t(54735),A=t(92790),O=t(36192),d=t(17669);function p(l,e,i=[]){for(const n of i)if(typeof n=="function"){if(!n(l,e))return!1}else if(e[n]!==l[n])return!1;return!0}const s={x:T.sJ.get(u.Ct.firstTimeField).get({}),y:T.sJ.get(u.Ct.byTypes).get(new Set([x.PU.number,x.PU.enum]))};class a extends C.Component{constructor(e){super(e),this.getTimeRange=()=>this.props.timeRange;let i=this.prepState(e);i.alignedData=i.config.prepData([i.alignedFrame]),this.state=i,this.plotInstance=C.createRef()}prepState(e,i=!0){let n=null;const{frames:o,fields:r=s,preparePlotFrame:h,replaceVariables:c,dataLinkPostProcessor:E}=e,L=h??d.m,U=o.some(I=>I.fields.some(S=>(S.config.links?.length??0)>0)),v=L(o,{...r,y:U?()=>!0:r.y},e.timeRange);if((0,O.uY)("GraphNG",!1,"data aligned",v),v){let I=v;if(U){const B=Array.isArray(this.props.timeZone)?this.props.timeZone[0]:this.props.timeZone;let F=o.map((W,M)=>({...W,fields:v.fields.filter((g,D)=>D===0||g.state?.origin?.frameIndex===M),length:v.length}));F.forEach((W,M)=>{W.fields.forEach(g=>{g.getLinks=(0,f._M)(W,g,{...g.state?.scopedVars,__dataContext:{value:{data:F,field:g,frame:W,frameIndex:M}}},c,B,E)})}),I={...v,fields:v.fields.filter((W,M)=>M===0||r.y(W,v,[v]))}}if(e.omitHideFromViz){const B=I.fields.filter(F=>F.config.custom?.hideFrom?.viz!==!0);I={...I,fields:B,length:B.length}}let S=this.state?.config;i&&(S=e.prepConfig(I,this.props.frames,this.getTimeRange),(0,O.uY)("GraphNG",!1,"config prepared",S)),n={alignedFrame:I,config:S},(0,O.uY)("GraphNG",!1,"data prepared",n.alignedData)}return n}componentDidUpdate(e){const{frames:i,structureRev:n,timeZone:o,cursorSync:r,propsToDiff:h}=this.props,c=!p(e,this.props,h);if(i!==e.frames||c||o!==e.timeZone||r!==e.cursorSync){let E=this.prepState(this.props,!1);E&&((this.state.config===void 0||o!==e.timeZone||r!==e.cursorSync||n!==e.structureRev||!n||c)&&(E.config=this.props.prepConfig(E.alignedFrame,this.props.frames,this.getTimeRange),(0,O.uY)("GraphNG",!1,"config recreated",E.config)),E.alignedData=E.config.prepData([E.alignedFrame]),this.setState(E))}}render(){const{width:e,height:i,children:n,renderLegend:o}=this.props,{config:r,alignedFrame:h,alignedData:c}=this.state;return r?(0,m.jsx)(P.KU,{width:e,height:i,legend:o(r),children:(E,L)=>(0,m.jsx)(A.Z,{config:r,data:c,width:E,height:L,plotRef:U=>this.plotInstance.current=U,children:n?n(r,h):null})}):null}}}}]);

//# sourceMappingURL=statusHistoryPanel.87fa1aa5a8ad338d40a6.js.map