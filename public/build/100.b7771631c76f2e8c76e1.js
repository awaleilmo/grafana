"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[100,4312],{12266:(he,O,i)=>{i.d(O,{e:()=>p});var t=i(74848),h=i(45861);const p=({isCollapsed:C,onToggle:g,idControlled:c,className:b,text:E,size:Y="xl",...j})=>(0,t.jsx)(h.$n,{type:"button",fill:"text",variant:"secondary","aria-expanded":!C,"aria-controls":c,className:b,icon:C?"angle-right":"angle-down",onClick:()=>g(!C),...j,children:E})},90100:(he,O,i)=>{i.r(O),i.d(O,{CentralAlertHistoryScene:()=>ce,ClearFilterButtonObjectRenderer:()=>ge,ClearFilterButtonScenesObject:()=>ue,LABELS_FILTER:()=>A,STATE_FILTER_FROM:()=>P,STATE_FILTER_TO:()=>w,default:()=>vt,getEventsScenesFlexItem:()=>de});var t=i(74848),h=i(22803),p=i(96540),C=i(7389),g=i(92745),c=i(45863),b=i(739),E=i(45967),Y=i(45861),j=i(63142),x=i(66404),V=i(30703),R=i(74268),ye=i(2863),fe=i(75421),ve=i(8535),G=i(59614),xe=i(54148),pe=i(49185),T=i(41654),k=i(34999),je=i(47327),Te=i(34213),q=i(36303),I=i(24619);let W=null;const Fe=e=>{if(!W)return null;const n=(0,q.Xc)(W,{title:(0,g.t)("alerting.ai.error-boundary.triage-button","AI Triage Button failed to load"),style:"alertbox",errorLogger:R.vV});return(0,p.createElement)(n,e)};function pt(e){W=e}var be=i(74048),H=i(86017),Se=i(52161),Ce=i(92367),Ee=i(7840),Re=i(12266),D=i(2543),Ie=i(44109),M=i(63895),Ne=i(94646),Le=i(1625),Ae=i(45746),we=i(88215),Pe=i(50483),N=i(93571),Be=i(68143),$e=i(1506),Oe=i(77256);function _({error:e}){if((0,Be.NF)(e)&&e.status===404)return(0,t.jsx)($e.L,{entity:"History"});const n=(0,g.t)("alerting.central-alert-history.error","Something went wrong loading the alert state history"),s=(0,Oe.JZ)(e);return(0,t.jsx)(k.F,{title:n,children:s})}var L=i(95004),Ve=i(18600),He=i(33553),De=i(11576),ee=i(92446);const f={all:"all",firing:"Alerting",normal:"Normal",pending:"Pending",recovering:"Recovering"},te=10*1e3,J="var-";function ne(e){const n=(0,M.Zc)(e),s={};return n.forEach(r=>{!r.isRegex&&r.isEqual&&(s[r.name]=r.value)}),s}const Me={labels:""};function Ue({data:e},n=Me){const[s=[],r=[]]=e?.values??[],l=((0,N.bF)(s)?s:[]).reduce((u,m,v)=>{const y=r[v];return(0,N.PA)(y)&&u.push({timestamp:m,line:y}),u},[]),o=(0,D.groupBy)(l,u=>JSON.stringify(u.line.labels)),d=Object.entries(o).map(([u,m])=>ze(u,m));return Ke(d,n)}function jt(){return new URLSearchParams(window.location.search).get(`${J}${LABELS_FILTER}`)??""}function Tt(){return new URLSearchParams(window.location.search).get(`${J}${STATE_FILTER_TO}`)??StateFilterValues.all}function Ft(){return new URLSearchParams(window.location.search).get(`${J}${STATE_FILTER_FROM}`)??StateFilterValues.all}function Ke(e,n){const s=n.labels,a=e.filter(u=>{const m=JSON.parse(u.name??""),v=s?(0,M.Zc)(s):[];return(0,H.Av)(m,v)}).flatMap(u=>u.fields.find(m=>m.name==="time")),l=(0,D.groupBy)(a?.flatMap(u=>u?.values),u=>Math.floor(u/te)*te),o={name:"time",type:L.PU.time,values:Object.keys(l).map(Number),config:{displayName:"Time",custom:{fillOpacity:100}}},d={name:"value",type:L.PU.number,values:Object.values(l).map(u=>u.length),config:{}};return[{fields:[o,d],length:o.values.length}]}function ze(e,n){const s={name:"time",type:L.PU.time,values:[...n.map(l=>l.timestamp)],config:{displayName:"Time",custom:{fillOpacity:100}}},r=s.values.map((l,o)=>o);return r.sort((0,ee.i)(s)),{fields:[{...s,values:s.values.map((l,o)=>s.values[r[o]])},{name:e,type:L.PU.number,values:s.values.map(l=>1),config:{}}],length:s.values.length,name:e}}function Ge(e,n){const s={name:"time",type:L.PU.time,values:[...e.map(o=>o.timestamp),Date.now()],config:{displayName:"Time",custom:{fillOpacity:100}}},r=s.values.map((o,d)=>d);r.sort((0,ee.i)(s));const a=[...e.map(o=>o.line.current),e.at(-1)?.line.current],l={fields:[{...s,values:s.values.map((o,d)=>s.values[r[d]])},{name:"State",type:L.PU.string,values:a.map((o,d)=>a[r[d]]),config:{displayName:"State",color:{mode:"thresholds"},custom:{fillOpacity:100},mappings:[{type:Ve.d.ValueToText,options:{Alerting:{color:n.colors.error.main},Pending:{color:n.colors.warning.main},Recovering:{color:n.colors.warning.main},Normal:{color:n.colors.success.main},NoData:{color:n.colors.info.main}}}],thresholds:{mode:He.O.Absolute,steps:[]}}}],length:s.values.length,name:""};return l.fields.forEach(o=>{o.display=(0,De.J)({field:o,theme:n})}),l}function We({record:e,addFilter:n,timeRange:s}){(0,p.useEffect)(()=>{(0,R.iW)()},[]);const r=e.line?.ruleUID??"",a=e.line?.labels,l=(0,p.useMemo)(()=>(0,Ne.qg)(r,!0),[r]),{error:o,loading:d,result:u}=(0,Ie.ZU)({ruleIdentifier:l,limitAlerts:0});return o?(0,t.jsx)(x.E,{children:(0,t.jsx)(g.x6,{i18nKey:"alerting.central-alert-history.details.error",children:"Error loading rule for this event."})}):d?(0,t.jsx)(x.E,{children:(0,t.jsx)(g.x6,{i18nKey:"alerting.central-alert-history.details.loading",children:"Loading..."})}):u?(0,t.jsxs)(T.B,{direction:"column",gap:.5,children:[(0,t.jsxs)(T.B,{direction:"row",gap:6,children:[(0,t.jsx)(Qe,{record:e,addFilter:n}),(0,t.jsx)(Ye,{record:e})]}),(0,t.jsx)(Xe,{rule:u}),(0,t.jsx)(Ze,{ruleUID:r,timeRange:s,labels:a??{}})]}):(0,t.jsx)(x.E,{children:(0,t.jsx)(g.x6,{i18nKey:"alerting.central-alert-history.details.not-found",children:"Rule not found for this event."})})}function Je(e,n){const s=(0,j.$j)();return(0,p.useMemo)(()=>{const r=n?.data?.values[0]??[],a=(0,N.bF)(r)?r:[],l=n?.data?.values[1]??[],o=a.reduce((y,S,F)=>{const B=l[F];return(0,N.PA)(B)&&y.push({timestamp:S,line:B}),y},[]),d=(0,D.groupBy)(o,y=>JSON.stringify(y.line.labels)),u=(0,M.Zc)(e),m=Object.entries(d).filter(([y])=>{const S=JSON.parse(y);return(0,H.Av)(S,u)});return{dataFrames:Object.values(m).map(y=>Ge(y[1],s))}},[n,e,s])}function Ze({ruleUID:e,timeRange:n,labels:s}){const{useGetRuleHistoryQuery:r}=G.U,{currentData:a,isLoading:l,isError:o,error:d}=r({ruleUid:e,from:n.from.unix(),to:n.to.unix(),limit:U},{refetchOnFocus:!0,refetchOnReconnect:!0}),{dataFrames:u}=Je(s?Object.entries(s).map(([S,F])=>`${S}=${F}`).join(","):"",a),{frameSubset:m,frameTimeRange:v}=(0,Pe.useFrameSubset)(u);if(l)return(0,t.jsx)("div",{children:(0,t.jsx)(g.x6,{i18nKey:"alerting.central-alert-history.details.loading",children:"Loading..."})});if(o)return(0,t.jsx)(_,{error:d});if(!m||m.length===0)return null;const y=u[0]?.fields[0]?.values?.length-1||0;return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(ke,{transitions:e?y:0}),(0,t.jsx)(we.A,{frames:m,timeRange:v})]})}function Qe({record:e,addFilter:n}){return(0,t.jsxs)(T.B,{gap:.5,direction:"column",children:[(0,t.jsx)(x.E,{variant:"body",weight:"light",color:"secondary",children:(0,t.jsx)(g.x6,{i18nKey:"alerting.central-alert-history.details.state-transitions",children:"State transition"})}),(0,t.jsxs)(T.B,{gap:.5,direction:"row",alignItems:"center",children:[(0,t.jsx)(K,{state:e.line.previous,showLabel:!0,addFilter:n,type:"from"}),(0,t.jsx)(V.I,{name:"arrow-right",size:"lg"}),(0,t.jsx)(K,{state:e.line.current,showLabel:!0,addFilter:n,type:"to"})]})]})}const Xe=({rule:e})=>{const n=(0,j.of)(se),s=e.annotations;return!s||Object.keys(s).length===0?null:(0,t.jsx)("div",{className:n.metadataWrapper,children:Object.entries(s).map(([r,a])=>{const l=(0,D.capitalize)(r);return(0,t.jsxs)(Le.P,{direction:"column",children:[l,(0,t.jsx)(Ae.$,{value:a})]},l)})})};function Ye({record:e}){const n=e?.line?.values?JSON.stringify(e.line.values):(0,g.t)("alerting.central-alert-history.details.no-values","No values");return(0,t.jsxs)(T.B,{gap:.5,direction:"column",children:[(0,t.jsx)(x.E,{variant:"body",weight:"light",color:"secondary",children:(0,t.jsx)(g.x6,{i18nKey:"alerting.central-alert-history.details.value-in-transition",children:"Value in transition"})}),(0,t.jsx)(T.B,{gap:.5,direction:"row",alignItems:"center",children:(0,t.jsx)(x.E,{variant:"body",weight:"light",children:n})})]})}function ke({transitions:e}){const n=(0,j.of)(se);return(0,t.jsxs)("div",{className:n.transitionsNumber,children:[(0,t.jsx)(x.E,{variant:"body",weight:"bold",color:"secondary",children:(0,t.jsx)(g.x6,{i18nKey:"alerting.central-alert-history.details.number-transitions",children:"State transitions for selected period:"})}),(0,t.jsx)(x.E,{variant:"body",weight:"light",children:e})]})}const se=e=>({metadataWrapper:(0,h.css)({display:"grid",gridTemplateColumns:"auto auto",rowGap:e.spacing(3),columnGap:e.spacing(12)}),transitionsNumber:(0,h.css)({display:"flex",flexDirection:"row",gap:e.spacing(.5),alignItems:"center",marginTop:e.spacing(1.5)})}),ae={labels:"",stateFrom:f.all,stateTo:f.all};function qe(e,n=ae){return(0,p.useMemo)(()=>_e(e,n),[n,e])}function _e(e,n=ae){const{labels:s,stateFrom:r=f.all,stateTo:a=f.all}=n;if(!e?.data)return{historyRecords:[]};const l=s?(0,M.Zc)(s):[],[o,d]=e.data.values;return{historyRecords:((0,N.bF)(o)?o:[]).reduce((v,y,S)=>{const F=d[S];if(!(0,N.PA)(F))return v;const B=F.labels&&(0,H.Av)(F.labels,l),Z=(0,I.lh)(F.current),Q=(0,I.lh)(F.previous),z=a!==f.all?a===Z:!0,X=r!==f.all?r===Q:!0;return B&&z&&X&&v.push({timestamp:y,line:F}),v},[])}}const U=5e3,et=100,re=({timeRange:e,valueInLabelFilter:n,valueInStateToFilter:s,valueInStateFromFilter:r,addFilter:a,hideAlertRuleColumn:l})=>{const o=e?.from.unix(),d=e?.to.unix(),u=ne(n.toString()),m=s.toString(),v=r.toString(),{data:y,isLoading:S,isError:F,error:B}=G.U.endpoints.getRuleHistory.useQuery({from:o,to:d,limit:U,labels:u,current:m!=="all"?m:void 0,previous:v!=="all"?v:void 0}),{historyRecords:Z}=qe(y,{labels:n.toString()}),Q=Z.sort((X,xt)=>xt.timestamp-X.timestamp);if(F)return(0,t.jsx)(_,{error:B});const z=!S&&y?.data?.values?.[0]?.length===U;return z&&(0,R.Hs)({from:o,to:d}),(0,t.jsxs)(T.B,{direction:"column",gap:.5,children:[z&&(0,t.jsx)(k.F,{severity:"warning",title:(0,g.t)("alerting.central-alert-history.too-many-events.title","Unable to display all events"),children:(0,g.t)("alerting.central-alert-history.too-many-events.text","The selected time period has too many events to display. Displaying the latest 5000 events. Try using a shorter time period.")}),(0,t.jsx)(tt,{visible:S}),(0,t.jsx)(nt,{logRecords:Q,addFilter:a,timeRange:e,hideAlertRuleColumn:l})]})},tt=({visible:e=!1})=>{const[n,{width:s}]=(0,pe.A)();return(0,t.jsx)("div",{ref:n,children:e&&(0,t.jsx)(je.G,{width:s,"data-testid":"loading-bar"})})};function nt({logRecords:e,addFilter:n,timeRange:s,hideAlertRuleColumn:r}){const{page:a,pageItems:l,numberOfPages:o,onPageChange:d}=(0,be.W)(e,1,et),u=(0,j.of)($);return(0,t.jsxs)(T.B,{direction:"column",gap:0,children:[(0,t.jsxs)("div",{className:u.headerContainer,children:[(0,t.jsx)(st,{hideAlertRuleColumn:r}),(0,t.jsx)("div",{className:u.triageButtonContainer,children:(0,t.jsx)(Fe,{logRecords:e,timeRange:s})})]}),(0,t.jsx)("ul",{children:l.map(m=>(0,t.jsx)(at,{record:m,addFilter:n,timeRange:s,hideAlertRuleColumn:r},m.timestamp+(m.line.fingerprint??"")))}),(0,t.jsx)(Te.d,{currentPage:a,numberOfPages:o,onNavigate:d,hideWhenSinglePage:!0})]})}function st({hideAlertRuleColumn:e}){const n=(0,j.of)($);return(0,t.jsxs)("div",{className:n.mainHeader,children:[(0,t.jsx)("div",{className:n.timeCol,children:(0,t.jsx)(x.E,{variant:"body",children:(0,t.jsx)(g.x6,{i18nKey:"alerting.central-alert-history.details.header.timestamp",children:"Timestamp"})})}),(0,t.jsx)("div",{className:n.transitionCol,children:(0,t.jsx)(x.E,{variant:"body",children:(0,t.jsx)(g.x6,{i18nKey:"alerting.central-alert-history.details.header.state",children:"State"})})}),!e&&(0,t.jsx)("div",{className:n.alertNameCol,children:(0,t.jsx)(x.E,{variant:"body",children:(0,t.jsx)(g.x6,{i18nKey:"alerting.central-alert-history.details.header.alert-rule",children:"Alert rule"})})}),(0,t.jsx)("div",{className:n.labelsCol,children:(0,t.jsx)(x.E,{variant:"body",children:(0,t.jsx)(g.x6,{i18nKey:"alerting.central-alert-history.details.header.instance",children:"Instance"})})})]})}function at({record:e,addFilter:n,timeRange:s,hideAlertRuleColumn:r}){const a=(0,j.of)($),[l,o]=(0,p.useState)(!0);function d(u,m){n(u,m,"label")}return(0,t.jsxs)(T.B,{direction:"column",gap:0,children:[(0,t.jsxs)("div",{className:(0,h.cx)(a.header,l?a.collapsedHeader:a.notCollapsedHeader),"data-testid":"event-row-header",children:[(0,t.jsx)(Re.e,{size:"sm",className:a.collapseToggle,isCollapsed:l,onToggle:o}),(0,t.jsxs)(T.B,{gap:.5,direction:"row",alignItems:"center",children:[(0,t.jsx)("div",{className:a.timeCol,children:(0,t.jsx)(ot,{time:e.timestamp})}),(0,t.jsx)("div",{className:a.transitionCol,children:(0,t.jsx)(it,{previous:e.line.previous,current:e.line.current,addFilter:n})}),!r&&(0,t.jsx)("div",{className:a.alertNameCol,children:e.line.labels?(0,t.jsx)(rt,{labels:e.line.labels,ruleUID:e.line.ruleUID}):null}),(0,t.jsx)("div",{className:a.labelsCol,children:(0,t.jsx)(Ee.m,{labels:e.line.labels??{},size:"xs",onClick:d})})]})]}),!l&&(0,t.jsx)("div",{className:a.expandedRow,children:(0,t.jsx)(We,{record:e,addFilter:n,timeRange:s})})]})}function rt({labels:e,ruleUID:n}){const s=(0,j.of)($),{pathname:r,search:a}=(0,xe.zy)(),l=`${r}${a}`,o=e.alertname;if(!n)return(0,t.jsx)(x.E,{children:(0,t.jsx)(g.x6,{i18nKey:"alerting.central-alert-history.details.unknown-rule",children:"Unknown"})});const d=(0,Ce.G)(`/alerting/${Se.hY}/${n}/view`,{tab:"history",returnTo:l});return(0,t.jsx)(E.m,{content:o??"",children:(0,t.jsx)("a",{href:d,className:s.alertName,children:o})})}function it({previous:e,current:n,addFilter:s}){return(0,t.jsxs)(T.B,{gap:.5,direction:"row",children:[(0,t.jsx)(K,{state:e,addFilter:s,type:"from"}),(0,t.jsx)(V.I,{name:"arrow-right",size:"lg"}),(0,t.jsx)(K,{state:n,addFilter:s,type:"to"})]})}const ie=({iconName:e,iconColor:n,tooltipContent:s,labelText:r,showLabel:a})=>(0,t.jsx)(E.m,{content:s,placement:"top",children:(0,t.jsxs)(T.B,{gap:.5,direction:"row",alignItems:"center",children:[(0,t.jsx)(V.I,{name:e,size:"md",className:n}),a&&(0,t.jsx)(x.E,{variant:"body",weight:"light",children:r})]})});function K({state:e,showLabel:n=!1,addFilter:s,type:r}){const a=(0,j.of)($),l=(0,g.t)("alerting.central-alert-history.details.no-recognized-state","No recognized state");if(!(0,I.s1)(e)&&!(0,I.qr)(e))return(0,t.jsx)(ie,{iconName:"exclamation-triangle",tooltipContent:l,labelText:(0,t.jsx)(g.x6,{i18nKey:"alerting.central-alert-history.details.unknown-event-state",children:"Unknown"}),showLabel:n,iconColor:a.warningColor});const o=(0,I.lh)(e),d=(0,I.$k)(e),u={Normal:{iconName:"check-circle",iconColor:d?a.warningColor:a.normalColor,tooltipContent:d?`Normal (${d})`:"Normal",labelText:(0,t.jsx)(g.x6,{i18nKey:"alerting.central-alert-history.details.state.normal",children:"Normal"})},Alerting:{iconName:"exclamation-circle",iconColor:a.alertingColor,tooltipContent:"Alerting",labelText:(0,t.jsx)(g.x6,{i18nKey:"alerting.central-alert-history.details.state.alerting",children:"Alerting"})},NoData:{iconName:"exclamation-triangle",iconColor:a.warningColor,tooltipContent:"Insufficient data",labelText:(0,t.jsx)(g.x6,{i18nKey:"alerting.central-alert-history.details.state.no-data",children:"No data"})},Error:{iconName:"exclamation-circle",tooltipContent:"Error",iconColor:a.warningColor,labelText:(0,t.jsx)(g.x6,{i18nKey:"alerting.central-alert-history.details.state.error",children:"Error"})},Pending:{iconName:"circle",iconColor:a.warningColor,tooltipContent:d?`Pending (${d})`:"Pending",labelText:(0,t.jsx)(g.x6,{i18nKey:"alerting.central-alert-history.details.state.pending",children:"Pending"})},Recovering:{iconName:"circle",iconColor:a.warningColor,tooltipContent:d?`Recovering (${d})`:"Recovering",labelText:(0,t.jsx)(g.x6,{i18nKey:"alerting.central-alert-history.details.state.recovering",children:"Recovering"})}};function m(){s("state",o,r==="from"?"stateFrom":"stateTo")}const v=u[o]||{iconName:"exclamation-triangle",tooltipContent:"Unknown State"};return(0,t.jsx)("div",{onClick:m,onKeyDown:y=>{(y.key==="Enter"||y.key===" ")&&m()},className:a.state,role:"button",tabIndex:0,children:(0,t.jsx)(ie,{...v,showLabel:n})})}const ot=({time:e})=>{const s=new Date(e).toLocaleString("en-US",{month:"long",day:"numeric",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1});return(0,t.jsx)(x.E,{variant:"body",weight:"light",children:s})},bt=(0,q.Xc)(re,{style:"page"}),$=e=>({header:(0,h.css)({display:"flex",flexDirection:"row",alignItems:"center",padding:`${e.spacing(1)} ${e.spacing(1)} ${e.spacing(1)} 0`,flexWrap:"nowrap","&:hover":{backgroundColor:e.components.table.rowHoverBackground}}),collapsedHeader:(0,h.css)({borderBottom:`1px solid ${e.colors.border.weak}`}),notCollapsedHeader:(0,h.css)({borderBottom:"none"}),collapseToggle:(0,h.css)({background:"none",border:"none",marginTop:`-${e.spacing(1)}`,marginBottom:`-${e.spacing(1)}`,svg:{marginBottom:0}}),normalColor:(0,h.css)({fill:e.colors.success.text}),warningColor:(0,h.css)({fill:e.colors.warning.text}),alertingColor:(0,h.css)({fill:e.colors.error.text}),timeCol:(0,h.css)({width:"150px"}),transitionCol:(0,h.css)({width:"80px"}),alertNameCol:(0,h.css)({width:"300px"}),labelsCol:(0,h.css)({display:"flex",overflow:"hidden",alignItems:"center",paddingRight:e.spacing(2),flex:1}),alertName:(0,h.css)({whiteSpace:"nowrap",cursor:"pointer",overflow:"hidden",textOverflow:"ellipsis",display:"block",color:e.colors.text.link}),expandedRow:(0,h.css)({padding:e.spacing(2),marginLeft:e.spacing(2),borderLeft:`1px solid ${e.colors.border.weak}`}),colorIcon:(0,h.css)({color:e.colors.primary.text,"&:hover":{opacity:.8}}),state:(0,h.css)({"&:hover":{opacity:.8,cursor:"pointer"}}),mainHeader:(0,h.css)({display:"flex",flexDirection:"row",alignItems:"center",flexWrap:"nowrap",marginLeft:"30px",padding:`${e.spacing(1)} ${e.spacing(1)} ${e.spacing(1)} 0`,gap:e.spacing(.5)}),headerContainer:(0,h.css)({display:"flex",justifyContent:"space-between",alignItems:"center",borderBottom:`1px solid ${e.colors.border.weak}`}),triageButtonContainer:(0,h.css)({padding:`${e.spacing(1)} ${e.spacing(2)}`})});class lt extends c.Bs{constructor(){super(...arguments),this._variableDependency=new c.Sh(this,{variableNames:[A,P,w]})}static{this.Component=ct}}function ct({model:e}){const{hideAlertRuleColumn:n}=e.useState(),{value:s}=c.jh.getTimeRange(e).useState(),r=c.jh.lookupVariable(A,e),a=c.jh.lookupVariable(w,e),l=c.jh.lookupVariable(P,e),o=(d,u,m)=>{const v=`${d}=${u}`;if((0,R.P6)({type:m,key:d,value:u}),m==="stateTo"&&a instanceof c.yP&&a.changeValueTo(u),m==="stateFrom"&&l instanceof c.yP&&l.changeValueTo(u),m==="label"&&r instanceof c.TS){const y=(0,H.EU)(r.state.value.toString(),v);r.setValue(y)}};return a instanceof c.yP&&l instanceof c.yP&&r instanceof c.TS?(0,t.jsx)(re,{timeRange:s,valueInLabelFilter:r.state.value,addFilter:o,valueInStateToFilter:a.state.value,valueInStateFromFilter:l.state.value,hideAlertRuleColumn:n}):null}const oe="__history_api_ds_uid__",le="__history_api_ds_pluginId__",dt={type:le,uid:oe,settings:void 0};function ut(){const e=(0,p.useMemo)(()=>new gt(oe,le),[]);(0,p.useEffect)(()=>{try{c.Go.registerRuntimeDataSource({dataSource:e})}catch{}},[e])}class gt extends c.UU{constructor(n,s){super(s,n)}async query(n){const s=n.range.from.unix(),r=n.range.to.unix(),a=n.targets[0],l=(0,ye.w)(),o=l.replace(a.labels??"",n.scopedVars),d=l.replace(a.stateTo??"",n.scopedVars),u=l.replace(a.stateFrom??"",n.scopedVars),m=ne(o),v=await mt(s,r,m,d!=="all"?d:void 0,u!=="all"?u:void 0);return{data:Ue(v,{labels:o})}}testDatasource(){return Promise.resolve({status:"success",message:(0,g.t)("alerting.history-apidatasource.message.data-source-is-working","Data source is working"),title:(0,g.t)("alerting.history-apidatasource.title.success","Success")})}}const mt=(e,n,s,r,a)=>(0,ve.JD)(G.U.endpoints.getRuleHistory.initiate({from:e,to:n,limit:U,labels:s,current:r,previous:a},{forceRefetch:!!(0,fe.jG)().getAutoRefreshInteval().interval})).unwrap(),A="LABELS_FILTER",w="STATE_FILTER_TO",P="STATE_FILTER_FROM",ce=({defaultLabelsFilter:e,defaultTimeRange:n={from:"now-1h",to:"now"},hideFilters:s,hideAlertRuleColumn:r}={})=>{(0,p.useEffect)(()=>{(0,R.fH)(R.le.loadedCentralAlertStateHistory)},[]),ut();const a=(0,p.useMemo)(()=>{const o=new c.TS({name:A,label:(0,g.t)("alerting.central-alert-history-scene.scene.labels-filter-variable.label.labels","Labels: "),...e&&{value:e}}),d=new c.yP({name:w,value:f.all,label:(0,g.t)("alerting.central-alert-history-scene.scene.transitions-to-filter-variable.label.end-state","End state:"),hide:C.zL.dontHide,query:`All : ${f.all}, To Firing : ${f.firing},To Normal : ${f.normal},To Pending : ${f.pending},To Recovering : ${f.recovering}`}),u=new c.yP({name:P,value:f.all,label:(0,g.t)("alerting.central-alert-history-scene.scene.transitions-from-filter-variable.label.start-state","Start state:"),hide:C.zL.dontHide,query:`All : ${f.all}, From Firing : ${f.firing},From Normal : ${f.normal},From Pending : ${f.pending},From Recovering : ${f.recovering}`});return new c.P1({controls:s?void 0:[new c.dM({component:yt}),new c.dM({component:ft}),new c.K8({}),new ue({}),new c.N0,new c.KE({}),new c.WM({})],$timeRange:new c.JZ(n),$variables:new c.Pj({variables:[o,u,d]}),body:new c.G1({direction:"column",children:[de(),new c.vA({body:new lt({hideAlertRuleColumn:r})})]})})},[e,n,s,r]);return(0,c.Yg)(a)?(0,t.jsx)(a.Component,{model:a}):null};function ht(){return new c.dt({datasource:dt,queries:[{refId:"A",labels:"${LABELS_FILTER}",stateFrom:"${STATE_FILTER_FROM}",stateTo:"${STATE_FILTER_TO}"}]})}function de(){return new c.vA({minHeight:300,ySizing:"content",body:c.d0.timeseries().setTitle("Alert Events").setDescription("Each alert event represents an alert instance that changed its state at a particular point in time. The history of the data is displayed over a period of time.").setData(ht()).setColor({mode:"continuous-BlPu"}).setCustomFieldConfig("fillOpacity",100).setCustomFieldConfig("drawStyle",b.GR.Bars).setCustomFieldConfig("lineInterpolation",b.dx.Linear).setCustomFieldConfig("lineWidth",1).setCustomFieldConfig("barAlignment",0).setCustomFieldConfig("spanNulls",!1).setCustomFieldConfig("insertNulls",!1).setCustomFieldConfig("showPoints",b.yL.Auto).setCustomFieldConfig("pointSize",5).setCustomFieldConfig("stacking",{mode:b.gs.None,group:"A"}).setCustomFieldConfig("gradientMode",b.on.Hue).setCustomFieldConfig("scaleDistribution",{type:b.L4.Linear}).setOption("legend",{showLegend:!1,displayMode:b.lm.Hidden}).setOption("tooltip",{mode:b.$N.Single}).setNoValue("No events found").build()})}class ue extends c.Bs{constructor(){super(...arguments),this._variableDependency=new c.Sh(this,{variableNames:[A,P,w]})}static{this.Component=ge}}function ge({model:e}){e.useState();const n=c.jh.interpolate(e,"${LABELS_FILTER}"),s=c.jh.interpolate(e,"${STATE_FILTER_TO}"),r=c.jh.interpolate(e,"${STATE_FILTER_FROM}");if(!n&&s===f.all&&r===f.all)return null;const a=()=>{const l=c.jh.lookupVariable(A,e);l instanceof c.TS&&l.setValue("");const o=c.jh.lookupVariable(w,e);o instanceof c.yP&&o.changeValueTo(f.all);const d=c.jh.lookupVariable(P,e);d instanceof c.yP&&d.changeValueTo(f.all)};return(0,t.jsx)(E.m,{content:(0,g.t)("alerting.clear-filter-button-object-renderer.content-clear-filter","Clear filter"),children:(0,t.jsx)(Y.$n,{variant:"secondary",icon:"times",onClick:a,children:(0,t.jsx)(g.x6,{i18nKey:"alerting.central-alert-history.filter.clear",children:"Clear filters"})})})}const yt=()=>{const e=(0,j.of)(me);return(0,t.jsx)("div",{className:e.filterLabelContainer,children:(0,t.jsx)(x.E,{variant:"body",weight:"light",color:"secondary",children:(0,t.jsx)(g.x6,{i18nKey:"alerting.central-alert-history.filterBy",children:"Filter by:"})})})},ft=()=>{const e=(0,j.of)(me);return(0,t.jsx)("div",{className:e.filterInfoContainer,children:(0,t.jsx)(E.m,{content:(0,t.jsxs)("div",{children:[(0,t.jsx)(g.x6,{i18nKey:"alerting.central-alert-history.filter.info.label1",children:"Filter events using label querying without spaces, ex:"}),(0,t.jsx)("pre",{children:'{severity="critical", instance=~"cluster-us-.+"}'}),(0,t.jsx)(g.x6,{i18nKey:"alerting.central-alert-history.filter.info.label2",children:"Invalid use of spaces:"}),(0,t.jsx)("pre",{children:'{severity= "critical"}'}),(0,t.jsx)("pre",{children:'{severity ="critical"}'}),(0,t.jsx)(g.x6,{i18nKey:"alerting.central-alert-history.filter.info.label3",children:"Valid use of spaces:"}),(0,t.jsx)("pre",{children:'{severity=" critical"}'}),(0,t.jsx)(g.x6,{i18nKey:"alerting.central-alert-history.filter.info.label4",children:"Filter alerts using label querying without braces, ex:"}),(0,t.jsx)("pre",{children:'severity="critical", instance=~"cluster-us-.+"'})]}),children:(0,t.jsx)(V.I,{name:"info-circle",size:"sm"})})})},me=e=>({filterInfoContainer:(0,h.css)({padding:"0",alignSelf:"center",marginRight:e.spacing(-1)}),filterLabelContainer:(0,h.css)({padding:"0",alignSelf:"center"})}),vt=ce}}]);

//# sourceMappingURL=100.b7771631c76f2e8c76e1.js.map