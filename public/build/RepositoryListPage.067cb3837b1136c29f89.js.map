{"version":3,"file":"RepositoryListPage.067cb3837b1136c29f89.js","mappings":"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","sources":["webpack://grafana/./public/app/features/provisioning/components/InlineSecureValueWarning.tsx","webpack://grafana/./public/app/features/provisioning/Repository/RepositoryCard.tsx","webpack://grafana/./public/app/features/provisioning/utils/checkSyncSettings.ts","webpack://grafana/./public/app/features/provisioning/Shared/ConnectRepositoryButton.tsx","webpack://grafana/./public/app/features/provisioning/Shared/RepositoryList.tsx","webpack://grafana/./public/app/features/provisioning/hooks/useRepositoryList.ts","webpack://grafana/./public/app/features/provisioning/HomePage.tsx","webpack://grafana/./public/app/features/provisioning/Repository/SyncRepository.tsx","webpack://grafana/./public/app/features/provisioning/Shared/StatusBadge.tsx"],"sourcesContent":["import { t } from '@grafana/i18n';\nimport { Alert } from '@grafana/ui';\nimport { Repository } from 'app/api/clients/provisioning/v0alpha1';\n\ninterface Props {\n  repo?: Repository;\n  items?: Repository[];\n}\n\n// TODO: remove this after 12.2\nexport function InlineSecureValueWarning({ repo, items }: Props) {\n  const isRepoValid = (r?: Repository) => r?.spec?.type === 'local' || !!r?.secure?.token?.name;\n\n  if (isRepoValid(repo)) {\n    return null;\n  }\n\n  // When a list is passed in, show an error if anything is missing\n  if (items?.every(isRepoValid)) {\n    return null;\n  }\n\n  return (\n    <Alert\n      title={t(\n        'provisioning.inline-secure-values-warning',\n        'You need to save your access tokens again due to a system update'\n      )}\n      severity=\"error\"\n    />\n  );\n}\n","import { ReactNode } from 'react';\n\nimport { t, Trans } from '@grafana/i18n';\nimport { Stack, Text, TextLink, Icon, Card, LinkButton, Badge } from '@grafana/ui';\nimport { Repository, ResourceCount } from 'app/api/clients/provisioning/v0alpha1';\n\nimport { RepoIcon } from '../Shared/RepoIcon';\nimport { StatusBadge } from '../Shared/StatusBadge';\nimport { PROVISIONING_URL } from '../constants';\nimport { getIsReadOnlyWorkflows } from '../utils/repository';\n\nimport { SyncRepository } from './SyncRepository';\n\ninterface Props {\n  repository: Repository;\n}\n\nexport function RepositoryCard({ repository }: Props) {\n  const isReadOnlyRepo = getIsReadOnlyWorkflows(repository.spec?.workflows);\n  const { metadata, spec, status } = repository;\n  const name = metadata?.name ?? '';\n\n  const getRepositoryMeta = (): ReactNode[] => {\n    const meta: ReactNode[] = [];\n\n    if (spec?.type === 'github') {\n      const { url = '', branch } = spec.github ?? {};\n      const branchUrl = branch ? `${url}/tree/${branch}` : url;\n\n      meta.push(\n        <TextLink key=\"link\" external href={branchUrl}>\n          {branchUrl}\n        </TextLink>\n      );\n\n      if (status?.webhook?.id) {\n        const webhookUrl = `${url}/settings/hooks/${status.webhook.id}`;\n        meta.push(\n          <Stack gap={1} direction=\"row\" alignItems=\"center\">\n            <TextLink key=\"webhook\" href={webhookUrl}>\n              <Trans i18nKey=\"provisioning.repository-card.get-repository-meta.webhook\">Webhook</Trans>\n            </TextLink>\n            <Icon name=\"check\" className=\"text-success\" />\n          </Stack>\n        );\n      }\n    } else if (spec?.type === 'local') {\n      meta.push(\n        <Text variant=\"bodySmall\" key=\"path\">\n          {spec.local?.path ?? ''}\n        </Text>\n      );\n    }\n\n    return meta;\n  };\n\n  return (\n    <Card noMargin key={name}>\n      <Card.Figure>\n        <RepoIcon type={spec?.type} />\n      </Card.Figure>\n      <Card.Heading>\n        <Stack gap={2} direction=\"row\" alignItems=\"center\">\n          {spec?.title && <Text variant=\"h3\">{spec.title}</Text>}\n          <StatusBadge repo={repository} />\n          {isReadOnlyRepo && (\n            <Badge color=\"darkgrey\" text={t('provisioning.repository-card.read-only-badge', 'Read only')} />\n          )}\n        </Stack>\n      </Card.Heading>\n\n      <Card.Description>\n        <Stack gap={2} direction=\"column\">\n          {spec?.description && <Text>{spec.description}</Text>}\n          {status?.stats?.length && (\n            <Stack gap={1} direction=\"row\" wrap>\n              {status.stats.map((stat, index) => (\n                <LinkButton\n                  key={index}\n                  fill=\"outline\"\n                  size=\"md\"\n                  variant=\"secondary\"\n                  href={getListURL(repository, stat)}\n                >\n                  {stat.count} {stat.resource}\n                </LinkButton>\n              ))}\n            </Stack>\n          )}\n        </Stack>\n      </Card.Description>\n\n      <Card.Meta>\n        <Stack gap={2} direction=\"row\" wrap>\n          {getRepositoryMeta()}\n        </Stack>\n      </Card.Meta>\n\n      <Card.Actions>\n        <Stack gap={1} direction=\"row\">\n          <LinkButton icon=\"eye\" href={`${PROVISIONING_URL}/${name}`} variant=\"primary\" size=\"md\">\n            <Trans i18nKey=\"provisioning.repository-card.view\">View</Trans>\n          </LinkButton>\n          <SyncRepository repository={repository} />\n          <LinkButton variant=\"secondary\" icon=\"cog\" href={`${PROVISIONING_URL}/${name}/edit`} size=\"md\">\n            <Trans i18nKey=\"provisioning.repository-card.settings\">Settings</Trans>\n          </LinkButton>\n        </Stack>\n      </Card.Actions>\n    </Card>\n  );\n}\n\n// Helper function\nfunction getListURL(repo: Repository, stats: ResourceCount): string {\n  if (stats.resource === 'playlists') {\n    return '/playlists';\n  }\n  if (repo.spec?.sync.target === 'folder') {\n    return `/dashboards/f/${repo.metadata?.name}`;\n  }\n  return '/dashboards';\n}\n","import { Repository } from 'app/api/clients/provisioning/v0alpha1';\n\ntype syncState = {\n  instanceConnected: boolean;\n  folderConnected: boolean;\n  repoCount: number;\n  maxReposReached: boolean;\n};\n\nexport function checkSyncSettings(repos?: Repository[]): syncState {\n  if (!repos?.length) {\n    return {\n      instanceConnected: false,\n      folderConnected: false,\n      repoCount: 0,\n      maxReposReached: false,\n    };\n  }\n  return {\n    instanceConnected: repos.some((item) => item.spec?.sync.target === 'instance'),\n    folderConnected: repos.some((item) => item.spec?.sync.target === 'folder'),\n    maxReposReached: Boolean((repos ?? []).length >= 10),\n    repoCount: repos.length,\n  };\n}\n","import { useNavigate } from 'react-router-dom-v5-compat';\n\nimport { Trans } from '@grafana/i18n';\nimport { Alert, Button, Dropdown, Icon, Menu, Stack } from '@grafana/ui';\nimport { Repository } from 'app/api/clients/provisioning/v0alpha1';\nimport { useGetFrontendSettingsQuery } from 'app/api/clients/provisioning/v0alpha1/endpoints.gen';\n\nimport { CONNECT_URL, DEFAULT_REPOSITORY_TYPES } from '../constants';\nimport { checkSyncSettings } from '../utils/checkSyncSettings';\nimport { getOrderedRepositoryConfigs } from '../utils/repositoryTypes';\n\ninterface Props {\n  items?: Repository[];\n}\n\nexport function ConnectRepositoryButton({ items }: Props) {\n  const state = checkSyncSettings(items);\n  const navigate = useNavigate();\n  const { data: frontendSettings } = useGetFrontendSettingsQuery();\n\n  if (state.instanceConnected) {\n    return null;\n  }\n\n  if (state.maxReposReached) {\n    return (\n      <Alert title=\"\" severity=\"info\">\n        <Trans\n          i18nKey=\"provisioning.connect-repository-button.repository-limit-info-alert\"\n          values={{ count: state.repoCount }}\n        >\n          Repository limit reached ({'{{count}}'})\n        </Trans>\n      </Alert>\n    );\n  }\n\n  const availableTypes = frontendSettings?.availableRepositoryTypes || DEFAULT_REPOSITORY_TYPES;\n  const { orderedConfigs } = getOrderedRepositoryConfigs(availableTypes);\n\n  return (\n    <Dropdown\n      overlay={\n        <Menu>\n          {orderedConfigs.map((config) => {\n            return (\n              <Menu.Item\n                key={config.type}\n                icon={config.icon}\n                label={config.label}\n                onClick={() => navigate(`${CONNECT_URL}/${config.type}`)}\n              />\n            );\n          })}\n        </Menu>\n      }\n    >\n      <Button variant=\"primary\">\n        <Stack alignItems=\"center\">\n          <Trans i18nKey=\"provisioning.connect-repository-button.configure\">Configure</Trans>\n          <Icon name={'angle-down'} />\n        </Stack>\n      </Button>\n    </Dropdown>\n  );\n}\n","import { useState } from 'react';\n\nimport { t } from '@grafana/i18n';\nimport { EmptyState, FilterInput, Stack } from '@grafana/ui';\nimport { Repository } from 'app/api/clients/provisioning/v0alpha1';\n\nimport { RepositoryCard } from '../Repository/RepositoryCard';\nimport { checkSyncSettings } from '../utils/checkSyncSettings';\n\nimport { ConnectRepositoryButton } from './ConnectRepositoryButton';\n\ninterface Props {\n  items: Repository[];\n}\n\nexport function RepositoryList({ items }: Props) {\n  const [query, setQuery] = useState('');\n\n  const filteredItems = items.filter((item) => item.metadata?.name?.includes(query));\n  const { instanceConnected } = checkSyncSettings(items);\n  return (\n    <Stack direction={'column'} gap={3}>\n      {!instanceConnected && (\n        <Stack gap={2}>\n          <FilterInput\n            placeholder={t('provisioning.folder-repository-list.placeholder-search', 'Search')}\n            value={query}\n            onChange={setQuery}\n          />\n          <ConnectRepositoryButton items={items} />\n        </Stack>\n      )}\n      <Stack direction={'column'} gap={2}>\n        {filteredItems.length ? (\n          filteredItems.map((item) => <RepositoryCard key={item.metadata?.name} repository={item} />)\n        ) : (\n          <EmptyState\n            variant=\"not-found\"\n            message={t(\n              'provisioning.folder-repository-list.no-results-matching-your-query',\n              'No results matching your query'\n            )}\n          />\n        )}\n      </Stack>\n    </Stack>\n  );\n}\n","import { skipToken } from '@reduxjs/toolkit/query';\n\nimport { ListRepositoryApiArg, Repository, useListRepositoryQuery } from 'app/api/clients/provisioning/v0alpha1';\n\n// Sort repositories alphabetically by title\nexport function useRepositoryList(\n  options: ListRepositoryApiArg | typeof skipToken = {}\n): [Repository[] | undefined, boolean] {\n  const query = useListRepositoryQuery(options);\n  const collator = new Intl.Collator(undefined, { numeric: true });\n\n  const sortedItems = query.data?.items?.slice().sort((a, b) => {\n    const titleA = a.spec?.title ?? '';\n    const titleB = b.spec?.title ?? '';\n    return collator.compare(titleA, titleB);\n  });\n\n  return [sortedItems, query.isLoading];\n}\n","import { useMemo, useState } from 'react';\n\nimport { Trans, t } from '@grafana/i18n';\nimport { Alert, ConfirmModal, Stack, Tab, TabContent, TabsBar } from '@grafana/ui';\nimport {\n  useDeletecollectionRepositoryMutation,\n  useGetFrontendSettingsQuery,\n} from 'app/api/clients/provisioning/v0alpha1';\nimport { Page } from 'app/core/components/Page/Page';\n\nimport GettingStarted from './GettingStarted/GettingStarted';\nimport GettingStartedPage from './GettingStarted/GettingStartedPage';\nimport { RepositoryList } from './Shared/RepositoryList';\nimport { InlineSecureValueWarning } from './components/InlineSecureValueWarning';\nimport { useRepositoryList } from './hooks/useRepositoryList';\n\nenum TabSelection {\n  Repositories = 'repositories',\n  GettingStarted = 'getting-started',\n}\n\nexport default function HomePage() {\n  const [items, isLoading] = useRepositoryList({ watch: true });\n  const settings = useGetFrontendSettingsQuery();\n  const [deleteAll] = useDeletecollectionRepositoryMutation();\n  const [showDeleteModal, setShowDeleteModal] = useState(false);\n  const [activeTab, setActiveTab] = useState<TabSelection>(TabSelection.Repositories);\n\n  const tabInfo = useMemo(\n    () => [\n      {\n        value: TabSelection.Repositories,\n        label: t('provisioning.home-page.tab-repositories', 'Repositories'),\n        title: t('provisioning.home-page.tab-repositories-title', 'List of repositories'),\n      },\n      {\n        value: TabSelection.GettingStarted,\n        label: t('provisioning.home-page.tab-getting-started', 'Getting started'),\n        title: t('provisioning.home-page.tab-getting-started-title', 'Getting started'),\n      },\n    ],\n    []\n  );\n\n  // Early return for onboarding\n  if (!items?.length && !isLoading) {\n    return <GettingStartedPage items={items ?? []} />;\n  }\n\n  const onConfirmDelete = () => {\n    deleteAll({});\n    setShowDeleteModal(false);\n  };\n\n  const renderTabContent = () => {\n    switch (activeTab) {\n      case TabSelection.Repositories:\n        return <RepositoryList items={items ?? []} />;\n      case TabSelection.GettingStarted:\n        return <GettingStarted items={items ?? []} />;\n      default:\n        return null;\n    }\n  };\n\n  return (\n    <Page\n      navId=\"provisioning\"\n      subTitle={t('provisioning.home-page.subtitle', 'View and manage your configured repositories')}\n    >\n      <Page.Contents isLoading={isLoading}>\n        {settings.data?.legacyStorage && (\n          <Alert\n            title={t('provisioning.home-page.title-legacy-storage-detected', 'Legacy storage detected')}\n            severity=\"error\"\n            buttonContent={\n              <Trans i18nKey=\"provisioning.home-page.remove-all-configured-repositories\">\n                Remove all configured repositories\n              </Trans>\n            }\n            onRemove={() => {\n              setShowDeleteModal(true);\n            }}\n          >\n            <Trans i18nKey=\"provisioning.home-page.configured-repositories-while-running-legacy-storage\">\n              Configured repositories will not work while running legacy storage.\n            </Trans>\n          </Alert>\n        )}\n        <InlineSecureValueWarning items={items} />\n        <ConfirmModal\n          isOpen={showDeleteModal}\n          title={t(\n            'provisioning.home-page.title-delete-all-configured-repositories',\n            'Delete all configured repositories'\n          )}\n          body={t(\n            'provisioning.home-page.confirm-delete-repositories',\n            'Are you sure you want to delete all configured repositories? This action cannot be undone.'\n          )}\n          confirmText={t('provisioning.home-page.button-delete-repositories', 'Delete repositories')}\n          onConfirm={onConfirmDelete}\n          onDismiss={() => setShowDeleteModal(false)}\n        />\n        <Stack direction=\"column\" gap={2}>\n          <TabsBar>\n            {tabInfo.map((t) => (\n              <Tab\n                key={t.value}\n                label={t.label}\n                active={activeTab === t.value}\n                onChangeTab={() => setActiveTab(t.value)}\n                title={t.title}\n              />\n            ))}\n          </TabsBar>\n          <TabContent>{renderTabContent()}</TabContent>\n        </Stack>\n      </Page.Contents>\n    </Page>\n  );\n}\n","import { useState } from 'react';\nimport { useNavigate } from 'react-router-dom-v5-compat';\n\nimport { Trans, t } from '@grafana/i18n';\nimport { Button, ConfirmModal } from '@grafana/ui';\nimport { Repository, useCreateRepositoryJobsMutation } from 'app/api/clients/provisioning/v0alpha1';\n\nimport { PROVISIONING_URL } from '../constants';\n\ninterface Props {\n  repository: Repository;\n}\n\nexport function SyncRepository({ repository }: Props) {\n  const [createJob, jobQuery] = useCreateRepositoryJobsMutation();\n  const [isModalOpen, setIsModalOpen] = useState(false);\n  const navigate = useNavigate();\n\n  const name = repository.metadata?.name;\n\n  const onClick = () => {\n    if (!name) {\n      return;\n    }\n    createJob({\n      name,\n      jobSpec: {\n        pull: {\n          incremental: false, // will queue a full resync job\n        },\n      },\n    });\n    setIsModalOpen(false);\n  };\n\n  const isHealthy = Boolean(repository.status?.health.healthy);\n\n  return (\n    <>\n      <Button\n        icon=\"cloud-download\"\n        variant={'secondary'}\n        tooltip={\n          isHealthy\n            ? undefined\n            : t('provisioning.sync-repository.tooltip-unhealthy-repository', 'Unable to pull an unhealthy repository')\n        }\n        disabled={jobQuery.isLoading || !name || !isHealthy}\n        onClick={onClick}\n      >\n        <Trans i18nKey=\"provisioning.sync-repository.pull\">Pull</Trans>\n      </Button>\n      {!repository.spec?.sync.enabled && (\n        <ConfirmModal\n          isOpen={isModalOpen}\n          title={t('provisioning.sync-repository.title-pull-not-enabled', 'Pull is not enabled')}\n          body={t('provisioning.sync-repository.body-edit-configuration', 'Edit the configuration')}\n          confirmText={t('provisioning.sync-repository.button-edit', 'Edit')}\n          onConfirm={() => navigate(`${PROVISIONING_URL}/${name}/edit`)}\n          onDismiss={() => setIsModalOpen(false)}\n        />\n      )}\n    </>\n  );\n}\n","import { t } from '@grafana/i18n';\nimport { locationService } from '@grafana/runtime';\nimport { Badge, BadgeColor, IconName } from '@grafana/ui';\nimport { Repository } from 'app/api/clients/provisioning/v0alpha1';\n\nimport { PROVISIONING_URL } from '../constants';\n\ninterface StatusBadgeProps {\n  repo?: Repository;\n}\n\nexport function StatusBadge({ repo }: StatusBadgeProps) {\n  if (!repo) {\n    return null;\n  }\n\n  // TODO: remove after 12.2\n  if (repo.spec?.type !== 'local' && !repo.secure?.token?.name) {\n    return (\n      <Badge\n        color={'red'}\n        icon={'exclamation-triangle'}\n        style={{ cursor: 'pointer' }}\n        text={t('provisioning.inline-token-warning-badge-text', 'Token needs to be saved again')}\n        tooltip={t(\n          'inline-token-warning-badge-tooltip',\n          'The method to save the token is to re-enter it in the repository settings.'\n        )}\n        onClick={() => {\n          // navigate to edit page, rather than view page\n          locationService.push(`${PROVISIONING_URL}/${repo.metadata?.name}/edit`);\n        }}\n      />\n    );\n  }\n\n  let tooltip: string | undefined = undefined;\n  let color: BadgeColor = 'purple';\n  let text = 'Unknown';\n  let icon: IconName = 'exclamation-triangle';\n\n  if (repo.metadata?.deletionTimestamp) {\n    color = 'red';\n    text = 'Deleting';\n    icon = 'spinner';\n  } else if (!repo.spec?.sync?.enabled) {\n    color = 'red';\n    text = 'Automatic pulling disabled';\n    icon = 'info-circle';\n  } else if (!repo.status?.sync?.state?.length) {\n    color = 'darkgrey';\n    text = 'Pending';\n    icon = 'spinner';\n    tooltip = 'Waiting for health check to run';\n  } else {\n    // Sync state\n    switch (repo.status?.sync?.state) {\n      case 'success':\n        icon = 'check';\n        text = 'Up-to-date';\n        color = 'green';\n        break;\n      case 'working':\n      case 'warning':\n        color = 'orange';\n        text = 'warning';\n        icon = 'exclamation-triangle';\n        break;\n      case 'pending':\n        color = 'darkgrey';\n        text = 'Pulling';\n        icon = 'spinner';\n        break;\n      case 'error':\n        color = 'red';\n        text = 'Error';\n        icon = 'exclamation-triangle';\n        break;\n      default:\n        break;\n    }\n  }\n\n  return (\n    <Badge\n      color={color}\n      icon={icon}\n      text={text}\n      style={{ cursor: 'pointer' }}\n      tooltip={tooltip}\n      onClick={() => {\n        locationService.push(`${PROVISIONING_URL}/${repo.metadata?.name}/?tab=overview`);\n      }}\n    />\n  );\n}\n"],"names":["InlineSecureValueWarning","repo","items","isRepoValid","r","RepositoryCard","repository","isReadOnlyRepo","metadata","spec","status","name","getRepositoryMeta","meta","url","branch","branchUrl","TextLink","webhookUrl","Stack","Icon","Text","Card","RepoIcon","StatusBadge","Badge","stat","index","getListURL","SyncRepository","stats","checkSyncSettings","repos","item","ConnectRepositoryButton","state","navigate","frontendSettings","Alert","availableTypes","orderedConfigs","Dropdown","Menu","config","Button","RepositoryList","query","setQuery","filteredItems","instanceConnected","FilterInput","EmptyState","useRepositoryList","options","collator","a","b","titleA","titleB","TabSelection","HomePage","isLoading","settings","deleteAll","showDeleteModal","setShowDeleteModal","activeTab","setActiveTab","tabInfo","GettingStartedPage","onConfirmDelete","renderTabContent","GettingStarted","Page","ConfirmModal","TabsBar","t","Tab","TabContent","createJob","jobQuery","isModalOpen","setIsModalOpen","onClick","isHealthy","tooltip","color","text","icon"],"sourceRoot":""}