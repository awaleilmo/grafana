"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[9996],{4392:(A,f,s)=>{s.d(f,{A:()=>E});var o=s(94701),e=function(c){(0,o.A)(function(){c()})};const E=e},9996:(A,f,s)=>{s.r(f),s.d(f,{ChangePasswordPage:()=>y,default:()=>U});var o=s(74848),e=s(71468),E=s(4392),c=s(13791),v=s(96540),i=s(92745),w=s(37386),P=s(41654),m=s(45861),u=s(74410),d=s(10501),t=s(65642),x=s(10180);const r=({user:h,onChangePassword:a,isSaving:n})=>{const[O,T]=(0,v.useState)(!1),[S,B]=(0,v.useState)(!0),{disableLoginForm:K}=t.Ay,j=h.authLabels?.length&&h.authLabels[0];return j==="LDAP"||j==="Auth Proxy"?(0,o.jsx)("p",{children:(0,o.jsx)(i.x6,{i18nKey:"profile.change-password.ldap-auth-proxy-message",children:"You cannot change password when signed in with LDAP or auth proxy."})}):j&&K?(0,o.jsx)("p",{children:(0,o.jsx)(i.x6,{i18nKey:"profile.change-password.cannot-change-password-message",children:"Password cannot be changed here."})}):(0,o.jsx)(u.l,{onSubmit:a,maxWidth:400,children:({register:L,errors:D,getValues:I,watch:R})=>{const W=R("newPassword");return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(w.D,{label:(0,i.t)("profile.change-password.old-password-label","Old password"),invalid:!!D.oldPassword,error:D?.oldPassword?.message,children:(0,o.jsx)(x.s,{id:"current-password",autoComplete:"current-password",...L("oldPassword",{required:(0,i.t)("profile.change-password.old-password-required","Old password is required")})})}),(0,o.jsx)(w.D,{label:(0,i.t)("profile.change-password.new-password-label","New password"),invalid:!!D.newPassword,error:D?.newPassword?.message,children:(0,o.jsx)(x.s,{id:"new-password",autoComplete:"new-password",onFocus:()=>T(!0),...L("newPassword",{onBlur:()=>B(!1),required:(0,i.t)("profile.change-password.new-password-required","New password is required"),validate:{strongPasswordValidationRegister:d.DP,confirm:C=>C===I().confirmNew||(0,i.t)("profile.change-password.passwords-must-match","Passwords must match"),old:C=>C!==I().oldPassword||(0,i.t)("profile.change-password.new-password-same-as-old","New password can't be the same as the old one.")}})})}),O&&(0,o.jsx)(d.zJ,{pristine:S,password:W,strongPasswordValidations:d.NQ}),(0,o.jsx)(w.D,{label:(0,i.t)("profile.change-password.confirm-password-label","Confirm password"),invalid:!!D.confirmNew,error:D?.confirmNew?.message,children:(0,o.jsx)(x.s,{id:"confirm-new-password",autoComplete:"new-password",...L("confirmNew",{required:(0,i.t)("profile.change-password.confirm-password-required","New password confirmation is required"),validate:C=>C===I().newPassword||(0,i.t)("profile.change-password.passwords-must-match","Passwords must match")})})}),(0,o.jsxs)(P.B,{children:[(0,o.jsx)(m.$n,{variant:"primary",disabled:n,type:"submit",children:(0,o.jsx)(i.x6,{i18nKey:"profile.change-password.change-password-button",children:"Change Password"})}),(0,o.jsx)(m.z9,{variant:"secondary",href:`${t.Ay.appSubUrl}/profile`,fill:"outline",children:(0,o.jsx)(i.x6,{i18nKey:"profile.change-password.cancel-button",children:"Cancel"})})]})]})}})};var l=s(88482);function p(h){const a=h.user,{isUpdating:n,user:O}=a;return{isUpdating:n,user:O}}const g={loadUser:l.YW,changePassword:l.ec},M=(0,e.connect)(p,g);function y({loadUser:h,isUpdating:a,user:n,changePassword:O}){return(0,E.A)(()=>h()),(0,o.jsx)(c.Y,{navId:"profile/password",children:(0,o.jsx)(c.Y.Contents,{isLoading:!n,children:n?(0,o.jsx)(o.Fragment,{children:(0,o.jsx)(r,{user:n,onChangePassword:O,isSaving:a})}):null})})}const U=M(y)},10180:(A,f,s)=>{s.d(f,{s:()=>w});var o=s(74848),e=s(96540),E=s(51898),c=s(92745),v=s(76319),i=s(63527);const w=(0,e.forwardRef)((P,m)=>{const[u,d]=(0,e.useState)(!1);return(0,o.jsx)(i.p,{...P,type:u?"text":"password","data-testid":E.Tp.pages.Login.password,ref:m,suffix:(0,o.jsx)(v.K,{name:u?"eye-slash":"eye","aria-controls":P.id,role:"switch","aria-checked":u,onClick:()=>{d(!u)},tooltip:u?(0,c.t)("grafana-ui.password-field.tooltip-hide","Hide password"):(0,c.t)("grafana-ui.password-field.tooltip-show","Show password")})})});w.displayName="PasswordField"},10501:(A,f,s)=>{s.d(f,{DP:()=>u,NQ:()=>m,zJ:()=>d});var o=s(74848),e=s(22803),E=s(92745),c=s(30703),v=s(66404),i=s(31286),w=s(63142),P=s(65642);const m=[{message:"At least 12 characters",validation:r=>r.length>=12},{message:"One uppercase letter",validation:r=>/[A-Z]+/.test(r)},{message:"One lowercase letter",validation:r=>/[a-z]+/.test(r)},{message:"One number",validation:r=>/[0-9]+/.test(r)},{message:"One symbol",validation:r=>/[\W]/.test(r)}],u=r=>!P.Ay.auth.basicAuthStrongPasswordPolicy||m.every(l=>l.validation(r))||(0,E.t)("profile.change-password.strong-password-validation-register","Password does not comply with the strong password policy"),d=({strongPasswordValidations:r,password:l,pristine:p})=>(0,o.jsx)(i.a,{marginBottom:2,children:r.map(g=>(0,o.jsx)(t,{strongPasswordValidation:g,password:l,pristine:p},g.message))}),t=({strongPasswordValidation:r,password:l,pristine:p})=>{const g=(0,w.of)(x),{basicAuthStrongPasswordPolicy:M}=P.Ay.auth;if(!M)return null;const{message:y,validation:U}=r,h=l.length>0&&U(l),a=h||p?"check":"exclamation-triangle",n=h?"secondary":p?"primary":"error";let O;return h?O=g.icon.valid:p?O=g.icon.pending:O=g.icon.error,(0,o.jsxs)(i.a,{display:"flex",alignItems:"center",marginTop:1,children:[(0,o.jsx)(c.I,{className:(0,e.cx)(g.icon.style,O),name:a}),(0,o.jsx)(v.E,{color:n,children:y})]},y)},x=r=>({icon:{style:(0,e.css)({marginRight:r.spacing(1)}),valid:(0,e.css)({color:r.colors.success.text}),pending:(0,e.css)({color:r.colors.secondary.text}),error:(0,e.css)({color:r.colors.error.text})}})},74410:(A,f,s)=>{s.d(f,{l:()=>v});var o=s(74848),e=s(22803),E=s(96540),c=s(49785);function v({defaultValues:i,onSubmit:w,validateOnMount:P=!1,validateFieldsOnMount:m,children:u,validateOn:d="onSubmit",maxWidth:t=600,...x}){const{handleSubmit:r,trigger:l,formState:p,...g}=(0,c.mN)({mode:d,defaultValues:i});return(0,E.useEffect)(()=>{P&&l(m)},[l,m,P]),(0,o.jsx)("form",{className:(0,e.css)({maxWidth:t!=="none"?t+"px":t,width:"100%"}),onSubmit:r(w),...x,children:u({errors:p.errors,formState:p,trigger:l,...g})})}},88482:(A,f,s)=>{s.d(f,{ec:()=>x,Aj:()=>U,Qe:()=>r,YW:()=>l,_O:()=>y,eg:()=>h});var o=s(43173),e=s(68143);async function E(a){try{await(0,e.AI)().put("/api/user/password",a)}catch(n){console.error(n)}}function c(){return(0,e.AI)().get("/api/user")}function v(){return(0,e.AI)().get("/api/user/teams")}function i(){return(0,e.AI)().get("/api/user/orgs")}function w(){return(0,e.AI)().get("/api/user/auth-tokens")}async function P(a){await(0,e.AI)().post("/api/user/revoke-auth-token",{authTokenId:a})}async function m(a){await(0,e.AI)().post("/api/user/using/"+a.orgId,{})}async function u(a){try{await(0,e.AI)().put("/api/user",a)}catch(n){console.error(n)}}const d={changePassword:E,revokeUserSession:P,loadUser:c,loadSessions:w,loadOrgs:i,loadTeams:v,setUserOrg:m,updateUserProfile:u};var t=s(69289);function x(a){return async function(n){n((0,t.Nm)({updating:!0})),await d.changePassword(a),n((0,t.Nm)({updating:!1}))}}function r(){return async function(a){await a(l()),a(p()),a(g()),a(M())}}function l(){return async function(a){const n=await d.loadUser();a((0,t.HO)({user:n}))}}function p(){return async function(a){a((0,t.ri)());const n=await d.loadTeams();a((0,t.Q9)({teams:n}))}}function g(){return async function(a){a((0,t.Mj)());const n=await d.loadOrgs();a((0,t.ny)({orgs:n}))}}function M(){return async function(a){a((0,t.uh)());const n=await d.loadSessions();a((0,t.RS)({sessions:n}))}}function y(a){return async function(n){n((0,t.Nm)({updating:!0})),await d.revokeUserSession(a),n((0,t.g$)({tokenId:a}))}}function U(a){return async function(n){n((0,t.Nm)({updating:!0})),await d.setUserOrg(a),window.location.href=o.$.appSubUrl+"/profile"}}function h(a){return async function(n){n((0,t.Nm)({updating:!0})),await d.updateUserProfile(a),await n(l()),n((0,t.Nm)({updating:!1}))}}}}]);

//# sourceMappingURL=9996.21c451f22ff76b4bb683.js.map