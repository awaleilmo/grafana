"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[4312,8427],{12266:(te,B,t)=>{t.d(B,{e:()=>l});var e=t(74848),g=t(45861);const l=({isCollapsed:f,onToggle:C,idControlled:z,className:E,text:G,size:M="xl",...F})=>(0,e.jsx)(g.$n,{type:"button",fill:"text",variant:"secondary","aria-expanded":!f,"aria-controls":z,className:E,icon:f?"angle-right":"angle-down",onClick:()=>C(!f),...F,children:G})},62950:(te,B,t)=>{t.r(B),t.d(B,{default:()=>ie});var e=t(74848),g=t(96540),l=t(92745),f=t(6975),C=t(34999),z=t(31286),E=t(66404),G=t(70958),M=t(52763),F=t(84266),Q=t(91984),W=t(36826),J=t(82658),P=t(22803),D=t(63142),H=t(45861),O=t(77256),$=t(72636),T=t(45967),K=t(30703),Y=t(77824);const R=({onStateFilterChange:r,stateFilter:h})=>{const j=Object.entries(F.Or).sort(([i],[s])=>i<s?-1:1).map(([i,s])=>({label:i,value:s}));return(0,e.jsxs)("div",{children:[(0,e.jsxs)($.J,{children:[(0,e.jsxs)("span",{children:[(0,e.jsx)(l.x6,{i18nKey:"alerting.alert-state-filter.notification-state",children:"Notification state"}),"\xA0"]}),(0,e.jsx)(T.m,{content:(0,e.jsx)("div",{children:(0,e.jsxs)("ul",{children:[(0,e.jsx)("li",{children:(0,e.jsx)(l.x6,{i18nKey:"alerting.alert-state-filter.active-the-alert-is-firing",children:"Active: The alert notification has been handled. The alert is still firing and continues to be managed."})}),(0,e.jsx)("li",{children:(0,e.jsx)(l.x6,{i18nKey:"alerting.alert-state-filter.suppressed-the-alert-has-been-silenced",children:"Suppressed: The alert has been silenced."})}),(0,e.jsx)("li",{children:(0,e.jsx)(l.x6,{i18nKey:"alerting.alert-state-filter.unprocessed-the-alert-is-received",children:"Unprocessed: The alert is received but its notification has not been processed yet."})})]})}),children:(0,e.jsx)(K.I,{name:"info-circle",size:"sm"})})]}),(0,e.jsx)(Y.z,{options:j,value:h,onChange:r})]})};var I=t(2543),U=t(18857),V=t(39659);const X=({groups:r,groupBy:h,onGroupingChange:j})=>{const i=(0,I.uniq)(r.flatMap(s=>s.alerts).flatMap(({labels:s})=>Object.keys(s))).filter(s=>!(0,V.F2)(s)).map(s=>({label:s,value:s}));return(0,e.jsxs)("div",{"data-testid":"group-by-container",children:[(0,e.jsxs)($.J,{children:[(0,e.jsxs)("span",{children:[(0,e.jsx)(l.x6,{i18nKey:"alerting.group-by.custom-group-by",children:"Custom group by"}),"\xA0"]}),(0,e.jsx)(T.m,{content:(0,e.jsx)("div",{children:(0,e.jsx)(l.x6,{i18nKey:"alerting.group-by.tooltip-group-by",children:"Group notifications using a different combination of labels. This option can help validate the grouping settings of your notification policies."})}),children:(0,e.jsx)(K.I,{name:"info-circle",size:"sm"})})]}),(0,e.jsx)(U.KF,{"aria-label":(0,l.t)("alerting.group-by.aria-label-group-by-label-keys","Group by label keys"),value:h,placeholder:(0,l.t)("alerting.group-by.placeholder-group-by","Group by"),prefix:(0,e.jsx)(K.I,{name:"tag-alt"}),onChange:s=>{j(s.map(({value:c})=>c))},options:i,width:34})]})};var Z=t(9514);const w=new Intl.Collator("en",{sensitivity:"accent"}),k=({groups:r,receivers:h,onReceiversChange:j})=>{const i=(0,I.uniq)(r.map(s=>s.receiver.name)).map(s=>({label:s==="NONE"?(0,l.t)("alerting.receiver-filter.no-grouping","No grouping"):s,value:s})).sort((s,c)=>w.compare(s.label||"",c.label||""));return(0,e.jsxs)("div",{"data-testid":"receiver-filter-container",children:[(0,e.jsxs)($.J,{children:[(0,e.jsxs)("span",{children:[(0,e.jsx)(l.x6,{i18nKey:"alerting.receiver-filter.contact-point",children:"Contact point"}),"\xA0"]}),(0,e.jsx)(T.m,{content:(0,e.jsx)(l.x6,{i18nKey:"alerting.receiver-filter.tooltip-contact-point",children:"Filter notifications by the contact point they are being delivered to."}),children:(0,e.jsx)(K.I,{name:"info-circle",size:"sm"})})]}),(0,e.jsx)(U.KF,{"aria-label":(0,l.t)("alerting.receiver-filter.aria-label-contact-points","Filter by contact points"),value:h,placeholder:(0,l.t)("alerting.receiver-filter.placeholder-contact-point","Filter by contact point"),prefix:(0,e.jsx)(K.I,{name:"at"}),onChange:s=>{j(s.map(({value:c})=>c).filter(c=>c!==void 0))},options:i,width:34})]})},q=({groups:r})=>{const[h,j]=(0,g.useState)(Math.floor(Math.random()*100)),[i,s]=(0,G.s)(),{groupBy:c=[],queryString:d,alertState:o,receivers:p=[]}=(0,O.Ht)(i),y=`matcher-${h}`,A=(0,D.of)(_),L=()=>{s({groupBy:null,queryString:null,alertState:null,contactPoint:null,receivers:null}),setTimeout(()=>j(h+1),100)},b=!!(c.length>0||d||o||p.length>0);return(0,e.jsx)("div",{className:A.wrapper,children:(0,e.jsxs)("div",{className:A.filterSection,children:[(0,e.jsx)(Z.X,{defaultQueryString:d,onFilterChange:u=>s({queryString:u||null})},y),(0,e.jsx)(X,{groups:r,groupBy:c,onGroupingChange:u=>s({groupBy:u.length?u.join(","):null})}),(0,e.jsx)(k,{groups:r,receivers:p,onReceiversChange:u=>s({receivers:u.length?u.join(","):null})}),(0,e.jsx)(R,{stateFilter:o,onStateFilterChange:u=>s({alertState:u||null})}),b&&(0,e.jsx)(H.$n,{className:A.clearButton,variant:"secondary",icon:"times",onClick:L,children:(0,e.jsx)(l.x6,{i18nKey:"alerting.alert-group-filter.clear-filters",children:"Clear filters"})})]})})},_=r=>({wrapper:(0,P.css)({borderBottom:`1px solid ${r.colors.border.medium}`,marginBottom:r.spacing(3)}),filterSection:(0,P.css)({display:"flex",flexDirection:"row",marginBottom:r.spacing(3),gap:r.spacing(1)}),clearButton:(0,P.css)({marginLeft:r.spacing(1),marginTop:"19px"})});var ee=t(86017),n=t(63895);const v=r=>{const[h]=(0,G.s)(),{queryString:j,alertState:i,receivers:s}=(0,O.Ht)(h);return(0,g.useMemo)(()=>{const c=j?(0,n.Zc)(j):[];return r.reduce((d,o)=>{if(!(s&&s.length>0?s.includes(o.receiver.name):!0))return d;const y=o.alerts.filter(({labels:A,status:L})=>{const b=(0,ee.Av)(A,c),u=i?L.state===i:!0;return b&&u});return y.length>0&&(Object.keys(o.labels).length===0?d.unshift({...o,alerts:y}):d.push({...o,alerts:y})),d},[])},[j,r,i,s])},x=(r,h)=>(0,g.useMemo)(()=>h.length===0?r.filter(s=>Object.keys(s.labels).length===0).length>1?r.reduce((s,c)=>{if(Object.keys(c.labels).length===0){const d=s.find(({labels:o})=>Object.keys(o));d?d.alerts=(0,I.uniqBy)([...d.alerts,...c.alerts],"labels"):s.push({alerts:c.alerts,labels:{},receiver:{name:"NONE"}})}else s.push(c);return s},[]):r:(0,I.uniqBy)(r.flatMap(({alerts:i})=>i),i=>i.fingerprint).reduce((i,s)=>{if(h.every(d=>Object.keys(s.labels).includes(d)))s.receivers.map(o=>({alerts:[s],labels:h.reduce((p,y)=>(p={...p,[y]:s.labels[y]},p),{}),receiver:o})).forEach(o=>{const p=i.find(y=>Object.keys(o.labels).every(A=>y.labels[A]===o.labels[A])&&y.receiver.name===o.receiver.name);p?p.alerts.push(s):i.push(o)});else{const d=i.find(o=>Object.keys(o.labels).length===0);d?d.alerts.push(s):i.push({alerts:[s],labels:{},receiver:{name:"NONE"}})}return i},[]),[r,h]);var S=t(98127),m=t(5358),a=t(11018),N=t(95443),se=t(52161),ne=t(36200),re=t(88547);const ae=()=>{const{selectedAlertmanager:r}=(0,m.VI)(),h=(0,M.wA)(),[j]=(0,G.s)(),{groupBy:i=[]}=(0,O.Ht)(j),{currentData:s}=Q.m.endpoints.getGrafanaAlertingConfigurationStatus.useQuery(),c=(0,S.$)(b=>b.amAlertGroups),{loading:d,error:o,result:p=[]}=c[r||""]??ne.jA,y=x(p,i),A=v(y),L=r===se.hY&&s?.alertmanagersChoice===F.nA.External;return(0,g.useEffect)(()=>{function b(){r&&h((0,a.D3)(r))}b();const u=setInterval(b,N.U3);return()=>{clearInterval(u)}},[h,r]),(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(q,{groups:p}),d&&(0,e.jsx)(f._,{text:(0,l.t)("alerting.alert-groups.text-loading-notifications","Loading notifications")}),o&&!d&&(0,e.jsx)(C.F,{title:(0,l.t)("alerting.alert-groups.title-error-loading-notifications","Error loading notifications"),severity:"error",children:o.message||"Unknown error"}),L&&(0,e.jsx)(C.F,{title:(0,l.t)("alerting.alert-groups.title-grafana-alerts-delivered-alertmanager","Grafana alerts are not delivered to Grafana Alertmanager"),children:(0,e.jsx)(l.x6,{i18nKey:"alerting.alert-groups.body-grafana-alerted-delivered",children:"Grafana is configured to send alerts to external alertmanagers only. No alerts are expected to be available here for the selected Alertmanager."})}),p&&A.map((b,u)=>(0,e.jsxs)(g.Fragment,{children:[(u===1&&Object.keys(A[0].labels).length===0||u===0&&Object.keys(b.labels).length>0)&&(0,e.jsx)(z.a,{paddingY:2,children:(0,e.jsx)(E.E,{element:"h2",variant:"body",children:(0,e.jsxs)(l.x6,{i18nKey:"alerting.alert-groups.grouped-by",values:{labels:Object.keys(b.labels).join(", ")},children:["Grouped by: ","{{labels}}"]})})}),(0,e.jsx)(J._,{alertManagerSourceName:r||"",group:b})]},`${JSON.stringify(b.labels)}-group-${u}`)),p&&!A.length&&(0,e.jsx)("p",{children:(0,e.jsx)(l.x6,{i18nKey:"alerting.alert-groups.no-results",children:"No results."})})]})};function le(){return(0,e.jsx)(W.y,{navId:"groups",accessType:"instance",children:(0,e.jsx)(ae,{})})}const ie=(0,re.S)(le)},82658:(te,B,t)=>{t.d(B,{_:()=>_});var e=t(74848),g=t(22803),l=t(96540),f=t(92745),C=t(63142),z=t(41654),E=t(89640),G=t(77256),M=t(7840),F=t(12266),Q=t(1625),W=t(74529),J=t(57487),P=t(83903),D=t(45861),H=t(15130),O=t(84266),$=t(11257),T=t(16692),K=t(52161),Y=t(83750),R=t(24898);const I=({alert:n,alertManagerSourceName:v})=>{const x=(0,C.of)(U),S=(0,K.z2)(v),m=S?H.TP.hasPermission($.w.AlertingRuleRead):!0;return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsxs)("div",{className:x.actionsRow,children:[n.status.state===O.Or.Suppressed&&(0,e.jsx)(R._,{actions:[T.QI.CreateSilence,T.QI.UpdateSilence],children:(0,e.jsx)(D.z9,{href:`${(0,G.nL)("/alerting/silences",v)}&silenceIds=${n.status.silencedBy.join(",")}`,className:x.button,icon:"bell",size:"sm",children:(0,e.jsx)(f.x6,{i18nKey:"alerting.alert-details.manage-silences",children:"Manage silences"})})}),n.status.state===O.Or.Active&&(0,e.jsx)(R._,{actions:[T.QI.CreateSilence],children:(0,e.jsx)(D.z9,{href:(0,G.BK)(v,n.labels),className:x.button,icon:"bell-slash",size:"sm",children:(0,e.jsx)(f.x6,{i18nKey:"alerting.alert-details.silence",children:"Silence"})})}),m&&n.generatorURL&&(0,e.jsx)(D.z9,{className:x.button,href:n.generatorURL,icon:"chart-line",size:"sm",children:S?(0,f.t)("alerting.alert-details.button-see-rule","See alert rule"):(0,f.t)("alerting.alert-details.button-see-source","See source")})]}),Object.entries(n.annotations).map(([a,N])=>(0,e.jsx)(Y.s,{annotationKey:a,value:N},a)),(0,e.jsx)("div",{className:x.receivers,children:(0,e.jsxs)(f.x6,{i18nKey:"alerting.alert-details.receivers-list",values:{receivers:n.receivers.map(({name:a})=>a).filter(a=>!!a).join(", ")},children:["Receivers: ","{{receivers}}"]})})]})},U=n=>({button:(0,g.css)({"& + &":{marginLeft:n.spacing(1)}}),actionsRow:(0,g.css)({padding:`${n.spacing(2,0)} !important`,borderBottom:`1px solid ${n.colors.border.medium}`}),receivers:(0,g.css)({padding:n.spacing(1,0)})}),V=({alerts:n,alertManagerSourceName:v})=>{const x=(0,C.of)(X),S=(0,l.useMemo)(()=>[{id:"state",label:(0,f.t)("alerting.alert-group-alerts-table.columns.label.notification-state","Notification state"),renderCell:({data:a})=>(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(P.y,{state:a.status.state}),(0,e.jsx)("span",{className:x.duration,children:(0,e.jsxs)(f.x6,{i18nKey:"alerting.alert-group-alerts-table.duration",values:{time:(0,W.dU)({start:new Date(a.startsAt),end:new Date(a.endsAt)})},children:["for ","{{time}}"]})})]}),size:"220px"},{id:"labels",label:(0,f.t)("alerting.alert-group-alerts-table.columns.label.instance-labels","Instance labels"),renderCell:({data:{labels:a}})=>(0,e.jsx)(M.m,{labels:a,size:"sm"}),size:1}],[x]),m=(0,l.useMemo)(()=>n.map(a=>({id:a.fingerprint,data:a})),[n]);return(0,e.jsx)("div",{className:x.tableWrapper,"data-testid":"alert-group-table",children:(0,e.jsx)(J.B,{cols:S,items:m,isExpandable:!0,renderExpandedContent:({data:a})=>(0,e.jsx)(I,{alert:a,alertManagerSourceName:v})})})},X=n=>({tableWrapper:(0,g.css)({marginTop:n.spacing(3),[n.breakpoints.up("md")]:{marginLeft:n.spacing(4.5)}}),duration:(0,g.css)({marginLeft:n.spacing(1),fontSize:n.typography.bodySmall.fontSize})});var Z=t(55127),w=t.n(Z);const k=n=>({[O.Or.Active]:(0,g.css)({color:n.colors.error.text}),[O.Or.Suppressed]:(0,g.css)({color:n.colors.primary.text}),[O.Or.Unprocessed]:(0,g.css)({color:n.colors.secondary.text})}),q=({group:n})=>{const v=(0,C.of)(k),x=n.alerts.length,S=n.alerts.reduce((m,a)=>(m[a.status.state]?m[a.status.state]+=1:m[a.status.state]=1,m),{});return(0,e.jsxs)("div",{children:[`${x} ${w()("alert",x)}: `,Object.entries(S).map(([m,a],N)=>(0,e.jsxs)("span",{className:v[m],children:[N>0&&", ",`${a} ${m}`]},`${JSON.stringify(n.labels)}-notifications-${N}`))]})},_=({alertManagerSourceName:n,group:v})=>{const[x,S]=(0,l.useState)(!0),m=(0,C.of)(ee),a=v.receiver.name!=="NONE",N=v.receiver.name;return(0,e.jsxs)("div",{className:m.wrapper,children:[(0,e.jsxs)("div",{className:m.header,children:[(0,e.jsxs)("div",{className:m.group,"data-testid":"alert-group",children:[(0,e.jsx)(F.e,{size:"sm",isCollapsed:x,onToggle:()=>S(!x),"data-testid":"alert-group-collapse-toggle"}),Object.keys(v.labels).length?(0,e.jsxs)(z.B,{direction:"row",alignItems:"center",children:[(0,e.jsx)(M.m,{labels:v.labels,size:"sm"}),a&&(0,e.jsx)(Q.P,{icon:"at",children:(0,e.jsxs)(f.x6,{i18nKey:"alerting.alert-group.delivered-to",values:{name:v.receiver.name},children:["Delivered to"," ",(0,e.jsx)(E.Y,{href:(0,G.bI)(N,n),variant:"bodySmall",color:"primary",inline:!1,children:"{{name}}"})]})})]}):(0,e.jsx)("span",{children:(0,e.jsx)(f.x6,{i18nKey:"alerting.alert-group.no-grouping",children:"No grouping"})})]}),(0,e.jsx)(q,{group:v})]}),!x&&(0,e.jsx)(V,{alertManagerSourceName:n,alerts:v.alerts})]})},ee=n=>({wrapper:(0,g.css)({"& + &":{marginTop:n.spacing(2)}}),header:(0,g.css)({display:"flex",flexDirection:"row",flexWrap:"wrap",alignItems:"center",justifyContent:"space-between",padding:n.spacing(1),backgroundColor:n.colors.background.secondary,width:"100%"}),group:(0,g.css)({display:"flex",flexDirection:"row",alignItems:"center"})})}}]);

//# sourceMappingURL=AlertGroups.e0a87803daa30c932672.js.map