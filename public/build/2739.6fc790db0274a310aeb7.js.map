{"version":3,"file":"2739.6fc790db0274a310aeb7.js","mappings":"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","sources":["webpack://grafana/./node_modules/ol/control/ScaleLine.js","webpack://grafana/./public/app/plugins/panel/geomap/GeomapOverlay.tsx","webpack://grafana/./public/app/features/visualization/data-hover/DataHoverRow.tsx","webpack://grafana/./public/app/features/visualization/data-hover/DataHoverRows.tsx","webpack://grafana/./public/app/features/visualization/data-hover/DataHoverTabs.tsx","webpack://grafana/./public/app/features/visualization/data-hover/ComplexDataHoverView.tsx","webpack://grafana/./public/app/plugins/panel/geomap/GeomapTooltip.tsx","webpack://grafana/./public/app/plugins/panel/geomap/components/DebugOverlay.tsx","webpack://grafana/./public/app/plugins/panel/geomap/utils/measure.ts","webpack://grafana/./node_modules/ol/featureloader.js","webpack://grafana/./node_modules/ol/loadingstrategy.js","webpack://grafana/./node_modules/ol/structs/RBush.js","webpack://grafana/./node_modules/ol/source/Source.js","webpack://grafana/./node_modules/ol/source/Vector.js","webpack://grafana/./node_modules/ol/interaction/Modify.js","webpack://grafana/./node_modules/ol/geom/Circle.js","webpack://grafana/./node_modules/ol/interaction/Draw.js","webpack://grafana/./public/app/plugins/panel/geomap/components/MeasureVectorLayer.ts","webpack://grafana/./public/app/plugins/panel/geomap/components/MeasureOverlay.tsx","webpack://grafana/./public/app/plugins/panel/geomap/globalStyles.ts","webpack://grafana/./public/app/features/geo/utils/frameVectorSource.ts","webpack://grafana/./public/app/plugins/panel/geomap/components/MarkersLegend.tsx","webpack://grafana/./public/app/plugins/panel/geomap/components/ObservablePropsWrapper.tsx","webpack://grafana/./public/app/plugins/panel/geomap/style/markers.ts","webpack://grafana/./public/app/plugins/panel/geomap/style/utils.ts","webpack://grafana/./public/app/plugins/panel/geomap/editor/StyleEditor.tsx","webpack://grafana/./public/app/plugins/panel/geomap/layers/data/markersLayer.tsx","webpack://grafana/./node_modules/ol/tilegrid/TileGrid.js","webpack://grafana/./node_modules/ol/tilegrid.js","webpack://grafana/./node_modules/ol/uri.js","webpack://grafana/./node_modules/ol/tileurlfunction.js","webpack://grafana/./node_modules/ol/source/Tile.js","webpack://grafana/./node_modules/ol/source/TileEventType.js","webpack://grafana/./node_modules/ol/source/UrlTile.js","webpack://grafana/./node_modules/ol/source/TileImage.js","webpack://grafana/./node_modules/ol/source/XYZ.js","webpack://grafana/./public/app/plugins/panel/geomap/layers/basemaps/carto.ts","webpack://grafana/./public/app/plugins/panel/geomap/layers/basemaps/generic.ts","webpack://grafana/./public/app/plugins/panel/geomap/layers/basemaps/esri.ts","webpack://grafana/./node_modules/ol/source/OSM.js","webpack://grafana/./public/app/plugins/panel/geomap/layers/basemaps/index.ts","webpack://grafana/./public/app/plugins/panel/geomap/layers/basemaps/osm.ts","webpack://grafana/./node_modules/ol-ext/source/DayNight.js","webpack://grafana/./public/app/plugins/panel/geomap/layers/data/dayNightLayer.tsx","webpack://grafana/./public/app/plugins/panel/geomap/utils/checkFeatureMatchesStyleRule.ts","webpack://grafana/./public/app/plugins/panel/geomap/utils/getFeatures.ts","webpack://grafana/./public/app/plugins/panel/geomap/layers/data/geojsonDynamic.ts","webpack://grafana/./public/app/plugins/panel/geomap/utils/selection.ts","webpack://grafana/./public/app/plugins/panel/geomap/editor/StyleRuleEditor.tsx","webpack://grafana/./public/app/plugins/panel/geomap/editor/GeomapStyleRulesEditor.tsx","webpack://grafana/./public/app/plugins/panel/geomap/layers/data/geojsonLayer.ts","webpack://grafana/./node_modules/ol/render/webgl/MixedGeometryBatch.js","webpack://grafana/./node_modules/ol/render/webgl/renderinstructions.js","webpack://grafana/./node_modules/ol/render/webgl/VectorStyleRenderer.js","webpack://grafana/./node_modules/ol/renderer/webgl/VectorLayer.js","webpack://grafana/./node_modules/ol/layer/Heatmap.js","webpack://grafana/./public/app/plugins/panel/geomap/layers/data/heatMap.tsx","webpack://grafana/./public/app/plugins/panel/geomap/layers/data/lastPointTracker.ts","webpack://grafana/./node_modules/ol-ext/geom/GeomUtils.js","webpack://grafana/./node_modules/ol-ext/style/FlowLine.js","webpack://grafana/./public/app/plugins/panel/geomap/layers/data/networkLayer.tsx","webpack://grafana/./node_modules/ol-ext/style/Photo.js","webpack://grafana/./public/app/plugins/panel/geomap/layers/data/photosLayer.tsx","webpack://grafana/./public/app/plugins/panel/geomap/layers/data/routeLayer.tsx","webpack://grafana/./public/app/plugins/panel/geomap/layers/data/index.ts","webpack://grafana/./public/app/plugins/panel/geomap/layers/registry.ts","webpack://grafana/./public/app/plugins/panel/geomap/panelcfg.gen.ts","webpack://grafana/./public/app/plugins/panel/geomap/utils/layers.ts","webpack://grafana/./public/app/plugins/panel/geomap/utils/actions.ts","webpack://grafana/./public/app/plugins/panel/geomap/utils/getLayersExtent.ts","webpack://grafana/./public/app/plugins/panel/geomap/utils/tooltip.ts","webpack://grafana/./public/app/plugins/panel/geomap/view.ts","webpack://grafana/./public/app/plugins/panel/geomap/GeomapPanel.tsx","webpack://grafana/./public/app/core/components/Layers/LayerDragDropList.tsx","webpack://grafana/./public/app/plugins/panel/geomap/editor/LayersEditor.tsx","webpack://grafana/./public/app/plugins/panel/geomap/editor/CoordinatesMapViewEditor.tsx","webpack://grafana/./public/app/plugins/panel/geomap/editor/FitMapViewEditor.tsx","webpack://grafana/./public/app/plugins/panel/geomap/editor/MapViewEditor.tsx","webpack://grafana/./public/app/plugins/panel/geomap/editor/layerEditor.tsx","webpack://grafana/./public/app/plugins/panel/geomap/migrations.ts","webpack://grafana/./public/app/plugins/panel/geomap/module.tsx","webpack://grafana/./public/app/core/components/ColorScale/ColorScale.tsx"],"sourcesContent":["/**\n * @module ol/control/ScaleLine\n */\nimport {CLASS_UNSELECTABLE} from '../css.js';\nimport {METERS_PER_UNIT, getPointResolution} from '../proj.js';\nimport Control from './Control.js';\n\n/**\n * @type {string}\n */\nconst UNITS_PROP = 'units';\n\n/**\n * @typedef {'degrees' | 'imperial' | 'nautical' | 'metric' | 'us'} Units\n * Units for the scale line.\n */\n\n/**\n * @const\n * @type {Array<number>}\n */\nconst LEADING_DIGITS = [1, 2, 5];\n\n/**\n * @const\n * @type {number}\n */\nconst DEFAULT_DPI = 25.4 / 0.28;\n\n/***\n * @template Return\n * @typedef {import(\"../Observable\").OnSignature<import(\"../Observable\").EventTypes, import(\"../events/Event.js\").default, Return> &\n *   import(\"../Observable\").OnSignature<import(\"../ObjectEventType\").Types|\n *     'change:units', import(\"../Object\").ObjectEvent, Return> &\n *   import(\"../Observable\").CombinedOnSignature<import(\"../Observable\").EventTypes|import(\"../ObjectEventType\").Types\n *     |'change:units', Return>} ScaleLineOnSignature\n */\n\n/**\n * @typedef {Object} Options\n * @property {string} [className] CSS class name. The default is `ol-scale-bar` when configured with\n * `bar: true`. Otherwise the default is `ol-scale-line`.\n * @property {number} [minWidth=64] Minimum width in pixels at the OGC default dpi. The width will be\n * adjusted to match the dpi used.\n * @property {number} [maxWidth] Maximum width in pixels at the OGC default dpi. The width will be\n * adjusted to match the dpi used.\n * @property {function(import(\"../MapEvent.js\").default):void} [render] Function called when the control\n * should be re-rendered. This is called in a `requestAnimationFrame` callback.\n * @property {HTMLElement|string} [target] Specify a target if you want the control\n * to be rendered outside of the map's viewport.\n * @property {Units} [units='metric'] Units.\n * @property {boolean} [bar=false] Render scalebars instead of a line.\n * @property {number} [steps=4] Number of steps the scalebar should use. Use even numbers\n * for best results. Only applies when `bar` is `true`.\n * @property {boolean} [text=false] Render the text scale above of the scalebar. Only applies\n * when `bar` is `true`.\n * @property {number|undefined} [dpi=undefined] dpi of output device such as printer. Only applies\n * when `bar` is `true`. If undefined the OGC default screen pixel size of 0.28mm will be assumed.\n */\n\n/**\n * @classdesc\n * A control displaying rough y-axis distances, calculated for the center of the\n * viewport. For conformal projections (e.g. EPSG:3857, the default view\n * projection in OpenLayers), the scale is valid for all directions.\n * No scale line will be shown when the y-axis distance of a pixel at the\n * viewport center cannot be calculated in the view projection.\n * By default the scale line will show in the bottom left portion of the map,\n * but this can be changed by using the css selector `.ol-scale-line`.\n * When specifying `bar` as `true`, a scalebar will be rendered instead\n * of a scaleline.\n * For cartesian measurements of the scaleline, you need to set the\n * `getPointResolution` method of your projection to simply return the input\n * value, e.g. `projection.setGetPointResolution(r => r);`\n *\n * @api\n */\nclass ScaleLine extends Control {\n  /**\n   * @param {Options} [options] Scale line options.\n   */\n  constructor(options) {\n    options = options ? options : {};\n\n    const element = document.createElement('div');\n    element.style.pointerEvents = 'none';\n\n    super({\n      element: element,\n      render: options.render,\n      target: options.target,\n    });\n\n    /***\n     * @type {ScaleLineOnSignature<import(\"../events\").EventsKey>}\n     */\n    this.on;\n\n    /***\n     * @type {ScaleLineOnSignature<import(\"../events\").EventsKey>}\n     */\n    this.once;\n\n    /***\n     * @type {ScaleLineOnSignature<void>}\n     */\n    this.un;\n\n    const className =\n      options.className !== undefined\n        ? options.className\n        : options.bar\n          ? 'ol-scale-bar'\n          : 'ol-scale-line';\n\n    /**\n     * @private\n     * @type {HTMLElement}\n     */\n    this.innerElement_ = document.createElement('div');\n    this.innerElement_.className = className + '-inner';\n\n    this.element.className = className + ' ' + CLASS_UNSELECTABLE;\n    this.element.appendChild(this.innerElement_);\n\n    /**\n     * @private\n     * @type {?import(\"../View.js\").State}\n     */\n    this.viewState_ = null;\n\n    /**\n     * @private\n     * @type {number}\n     */\n    this.minWidth_ = options.minWidth !== undefined ? options.minWidth : 64;\n\n    /**\n     * @private\n     * @type {number|undefined}\n     */\n    this.maxWidth_ = options.maxWidth;\n\n    /**\n     * @private\n     * @type {boolean}\n     */\n    this.renderedVisible_ = false;\n\n    /**\n     * @private\n     * @type {number|undefined}\n     */\n    this.renderedWidth_ = undefined;\n\n    /**\n     * @private\n     * @type {string}\n     */\n    this.renderedHTML_ = '';\n\n    this.addChangeListener(UNITS_PROP, this.handleUnitsChanged_);\n\n    this.setUnits(options.units || 'metric');\n\n    /**\n     * @private\n     * @type {boolean}\n     */\n    this.scaleBar_ = options.bar || false;\n\n    /**\n     * @private\n     * @type {number}\n     */\n    this.scaleBarSteps_ = options.steps || 4;\n\n    /**\n     * @private\n     * @type {boolean}\n     */\n    this.scaleBarText_ = options.text || false;\n\n    /**\n     * @private\n     * @type {number|undefined}\n     */\n    this.dpi_ = options.dpi || undefined;\n  }\n\n  /**\n   * Return the units to use in the scale line.\n   * @return {Units} The units\n   * to use in the scale line.\n   * @observable\n   * @api\n   */\n  getUnits() {\n    return this.get(UNITS_PROP);\n  }\n\n  /**\n   * @private\n   */\n  handleUnitsChanged_() {\n    this.updateElement_();\n  }\n\n  /**\n   * Set the units to use in the scale line.\n   * @param {Units} units The units to use in the scale line.\n   * @observable\n   * @api\n   */\n  setUnits(units) {\n    this.set(UNITS_PROP, units);\n  }\n\n  /**\n   * Specify the dpi of output device such as printer.\n   * @param {number|undefined} dpi The dpi of output device.\n   * @api\n   */\n  setDpi(dpi) {\n    this.dpi_ = dpi;\n  }\n\n  /**\n   * @private\n   */\n  updateElement_() {\n    const viewState = this.viewState_;\n\n    if (!viewState) {\n      if (this.renderedVisible_) {\n        this.element.style.display = 'none';\n        this.renderedVisible_ = false;\n      }\n      return;\n    }\n\n    const center = viewState.center;\n    const projection = viewState.projection;\n    const units = this.getUnits();\n    const pointResolutionUnits = units == 'degrees' ? 'degrees' : 'm';\n    let pointResolution = getPointResolution(\n      projection,\n      viewState.resolution,\n      center,\n      pointResolutionUnits,\n    );\n\n    const minWidth =\n      (this.minWidth_ * (this.dpi_ || DEFAULT_DPI)) / DEFAULT_DPI;\n\n    const maxWidth =\n      this.maxWidth_ !== undefined\n        ? (this.maxWidth_ * (this.dpi_ || DEFAULT_DPI)) / DEFAULT_DPI\n        : undefined;\n\n    let nominalCount = minWidth * pointResolution;\n    let suffix = '';\n    if (units == 'degrees') {\n      const metersPerDegree = METERS_PER_UNIT.degrees;\n      nominalCount *= metersPerDegree;\n      if (nominalCount < metersPerDegree / 60) {\n        suffix = '\\u2033'; // seconds\n        pointResolution *= 3600;\n      } else if (nominalCount < metersPerDegree) {\n        suffix = '\\u2032'; // minutes\n        pointResolution *= 60;\n      } else {\n        suffix = '\\u00b0'; // degrees\n      }\n    } else if (units == 'imperial') {\n      if (nominalCount < 0.9144) {\n        suffix = 'in';\n        pointResolution /= 0.0254;\n      } else if (nominalCount < 1609.344) {\n        suffix = 'ft';\n        pointResolution /= 0.3048;\n      } else {\n        suffix = 'mi';\n        pointResolution /= 1609.344;\n      }\n    } else if (units == 'nautical') {\n      pointResolution /= 1852;\n      suffix = 'NM';\n    } else if (units == 'metric') {\n      if (nominalCount < 1e-6) {\n        suffix = 'nm';\n        pointResolution *= 1e9;\n      } else if (nominalCount < 0.001) {\n        suffix = 'm';\n        pointResolution *= 1000000;\n      } else if (nominalCount < 1) {\n        suffix = 'mm';\n        pointResolution *= 1000;\n      } else if (nominalCount < 1000) {\n        suffix = 'm';\n      } else {\n        suffix = 'km';\n        pointResolution /= 1000;\n      }\n    } else if (units == 'us') {\n      if (nominalCount < 0.9144) {\n        suffix = 'in';\n        pointResolution *= 39.37;\n      } else if (nominalCount < 1609.344) {\n        suffix = 'ft';\n        pointResolution /= 0.30480061;\n      } else {\n        suffix = 'mi';\n        pointResolution /= 1609.3472;\n      }\n    } else {\n      throw new Error('Invalid units');\n    }\n\n    let i = 3 * Math.floor(Math.log(minWidth * pointResolution) / Math.log(10));\n    let count, width, decimalCount;\n    let previousCount = 0;\n    let previousWidth, previousDecimalCount;\n    while (true) {\n      decimalCount = Math.floor(i / 3);\n      const decimal = Math.pow(10, decimalCount);\n      count = LEADING_DIGITS[((i % 3) + 3) % 3] * decimal;\n      width = Math.round(count / pointResolution);\n      if (isNaN(width)) {\n        this.element.style.display = 'none';\n        this.renderedVisible_ = false;\n        return;\n      }\n      if (maxWidth !== undefined && width >= maxWidth) {\n        count = previousCount;\n        width = previousWidth;\n        decimalCount = previousDecimalCount;\n        break;\n      } else if (width >= minWidth) {\n        break;\n      }\n      previousCount = count;\n      previousWidth = width;\n      previousDecimalCount = decimalCount;\n      ++i;\n    }\n    const html = this.scaleBar_\n      ? this.createScaleBar(width, count, suffix)\n      : count.toFixed(decimalCount < 0 ? -decimalCount : 0) + ' ' + suffix;\n\n    if (this.renderedHTML_ != html) {\n      this.innerElement_.innerHTML = html;\n      this.renderedHTML_ = html;\n    }\n\n    if (this.renderedWidth_ != width) {\n      this.innerElement_.style.width = width + 'px';\n      this.renderedWidth_ = width;\n    }\n\n    if (!this.renderedVisible_) {\n      this.element.style.display = '';\n      this.renderedVisible_ = true;\n    }\n  }\n\n  /**\n   * @private\n   * @param {number} width The current width of the scalebar.\n   * @param {number} scale The current scale.\n   * @param {string} suffix The suffix to append to the scale text.\n   * @return {string} The stringified HTML of the scalebar.\n   */\n  createScaleBar(width, scale, suffix) {\n    const resolutionScale = this.getScaleForResolution();\n    const mapScale =\n      resolutionScale < 1\n        ? Math.round(1 / resolutionScale).toLocaleString() + ' : 1'\n        : '1 : ' + Math.round(resolutionScale).toLocaleString();\n    const steps = this.scaleBarSteps_;\n    const stepWidth = width / steps;\n    const scaleSteps = [this.createMarker('absolute')];\n    for (let i = 0; i < steps; ++i) {\n      const cls =\n        i % 2 === 0 ? 'ol-scale-singlebar-odd' : 'ol-scale-singlebar-even';\n      scaleSteps.push(\n        '<div>' +\n          '<div ' +\n          `class=\"ol-scale-singlebar ${cls}\" ` +\n          `style=\"width: ${stepWidth}px;\"` +\n          '>' +\n          '</div>' +\n          this.createMarker('relative') +\n          // render text every second step, except when only 2 steps\n          (i % 2 === 0 || steps === 2\n            ? this.createStepText(i, width, false, scale, suffix)\n            : '') +\n          '</div>',\n      );\n    }\n    // render text at the end\n    scaleSteps.push(this.createStepText(steps, width, true, scale, suffix));\n\n    const scaleBarText = this.scaleBarText_\n      ? `<div class=\"ol-scale-text\" style=\"width: ${width}px;\">` +\n        mapScale +\n        '</div>'\n      : '';\n    return scaleBarText + scaleSteps.join('');\n  }\n\n  /**\n   * Creates a marker at given position\n   * @param {'absolute'|'relative'} position The position, absolute or relative\n   * @return {string} The stringified div containing the marker\n   */\n  createMarker(position) {\n    const top = position === 'absolute' ? 3 : -10;\n    return (\n      '<div ' +\n      'class=\"ol-scale-step-marker\" ' +\n      `style=\"position: ${position}; top: ${top}px;\"` +\n      '></div>'\n    );\n  }\n\n  /**\n   * Creates the label for a marker marker at given position\n   * @param {number} i The iterator\n   * @param {number} width The width the scalebar will currently use\n   * @param {boolean} isLast Flag indicating if we add the last step text\n   * @param {number} scale The current scale for the whole scalebar\n   * @param {string} suffix The suffix for the scale\n   * @return {string} The stringified div containing the step text\n   */\n  createStepText(i, width, isLast, scale, suffix) {\n    const length =\n      i === 0 ? 0 : Math.round((scale / this.scaleBarSteps_) * i * 100) / 100;\n    const lengthString = length + (i === 0 ? '' : ' ' + suffix);\n    const margin = i === 0 ? -3 : (width / this.scaleBarSteps_) * -1;\n    const minWidth = i === 0 ? 0 : (width / this.scaleBarSteps_) * 2;\n    return (\n      '<div ' +\n      'class=\"ol-scale-step-text\" ' +\n      'style=\"' +\n      `margin-left: ${margin}px;` +\n      `text-align: ${i === 0 ? 'left' : 'center'};` +\n      `min-width: ${minWidth}px;` +\n      `left: ${isLast ? width + 'px' : 'unset'};` +\n      '\">' +\n      lengthString +\n      '</div>'\n    );\n  }\n\n  /**\n   * Returns the appropriate scale for the given resolution and units.\n   * @return {number} The appropriate scale.\n   */\n  getScaleForResolution() {\n    const resolution = getPointResolution(\n      this.viewState_.projection,\n      this.viewState_.resolution,\n      this.viewState_.center,\n      'm',\n    );\n    const dpi = this.dpi_ || DEFAULT_DPI;\n    const inchesPerMeter = 1000 / 25.4;\n    return resolution * inchesPerMeter * dpi;\n  }\n\n  /**\n   * Update the scale line element.\n   * @param {import(\"../MapEvent.js\").default} mapEvent Map event.\n   * @override\n   */\n  render(mapEvent) {\n    const frameState = mapEvent.frameState;\n    if (!frameState) {\n      this.viewState_ = null;\n    } else {\n      this.viewState_ = frameState.viewState;\n    }\n    this.updateElement_();\n  }\n}\n\nexport default ScaleLine;\n","import { css } from '@emotion/css';\nimport { CSSProperties } from 'react';\nimport * as React from 'react';\n\nimport { GrafanaTheme2 } from '@grafana/data';\nimport { useStyles2 } from '@grafana/ui';\n\nexport interface OverlayProps {\n  topRight1?: React.ReactNode[];\n  topRight2?: React.ReactNode[];\n  bottomLeft?: React.ReactNode[];\n  blStyle?: CSSProperties;\n}\n\nexport const GeomapOverlay = ({ topRight1, topRight2, bottomLeft, blStyle }: OverlayProps) => {\n  const topRight1Exists = (topRight1 && topRight1.length > 0) ?? false;\n  const styles = useStyles2(getStyles(topRight1Exists));\n  return (\n    <div className={styles.overlay}>\n      {Boolean(topRight1?.length) && <div className={styles.TR1}>{topRight1}</div>}\n      {Boolean(topRight2?.length) && <div className={styles.TR2}>{topRight2}</div>}\n      {Boolean(bottomLeft?.length) && (\n        <div className={styles.BL} style={blStyle}>\n          {bottomLeft}\n        </div>\n      )}\n    </div>\n  );\n};\n\nconst getStyles = (topRight1Exists: boolean) => (theme: GrafanaTheme2) => ({\n  overlay: css({\n    position: 'absolute',\n    width: '100%',\n    height: '100%',\n    zIndex: 500,\n    pointerEvents: 'none',\n  }),\n  TR1: css({\n    right: '0.5em',\n    pointerEvents: 'auto',\n    position: 'absolute',\n    top: '0.5em',\n  }),\n  TR2: css({\n    position: 'absolute',\n    top: topRight1Exists ? '80px' : '8px',\n    right: '8px',\n    pointerEvents: 'auto',\n  }),\n  BL: css({\n    position: 'absolute',\n    bottom: '8px',\n    left: '8px',\n    pointerEvents: 'auto',\n  }),\n});\n","import { FeatureLike } from 'ol/Feature';\n\nimport { ArrayDataFrame, DataFrame } from '@grafana/data';\n\nimport { DataHoverView } from './DataHoverView';\n\ntype Props = {\n  feature?: FeatureLike;\n};\n\nexport const DataHoverRow = ({ feature }: Props) => {\n  let data: DataFrame;\n  let rowIndex = 0;\n  if (!feature) {\n    return null;\n  }\n\n  data = feature.get('frame');\n  if (data) {\n    rowIndex = feature.get('rowIndex');\n  } else {\n    const { geometry, ...properties } = feature.getProperties();\n    data = new ArrayDataFrame([properties]);\n  }\n\n  return <DataHoverView data={data} rowIndex={rowIndex} />;\n};\n","import { css } from '@emotion/css';\nimport { isString } from 'lodash';\nimport { FeatureLike } from 'ol/Feature';\nimport { useState } from 'react';\nimport * as React from 'react';\n\nimport { DataFrame, FieldType, getFieldDisplayName, GrafanaTheme2 } from '@grafana/data';\nimport { Collapse, TabContent, useStyles2 } from '@grafana/ui';\nimport { GeomapLayerHover } from 'app/plugins/panel/geomap/event';\nimport { renderValue } from 'app/plugins/panel/geomap/utils/uiUtils';\n\nimport { DataHoverRow } from './DataHoverRow';\n\ntype Props = {\n  layers: GeomapLayerHover[];\n  activeTabIndex: number;\n};\n\nexport const DataHoverRows = ({ layers, activeTabIndex }: Props) => {\n  const styles = useStyles2(getStyles);\n  const [rowMap, setRowMap] = useState(new Map<string | number, boolean>());\n\n  const updateRowMap = (key: string | number, value: boolean) => {\n    setRowMap(new Map(rowMap.set(key, value)));\n  };\n\n  return (\n    <TabContent>\n      {layers.map(\n        (geomapLayer, index) =>\n          index === activeTabIndex && (\n            <div key={geomapLayer.layer.getName()}>\n              <div>\n                {geomapLayer.features.map((feature, idx) => {\n                  const key = feature.getId() ?? idx;\n                  const shouldDisplayCollapse = geomapLayer.features.length > 1;\n\n                  return shouldDisplayCollapse ? (\n                    <Collapse\n                      key={key}\n                      collapsible\n                      label={generateLabel(feature, idx)}\n                      isOpen={rowMap.get(key)}\n                      onToggle={() => {\n                        updateRowMap(key, !rowMap.get(key));\n                      }}\n                      className={styles.collapsibleRow}\n                    >\n                      <DataHoverRow feature={feature} />\n                    </Collapse>\n                  ) : (\n                    <DataHoverRow key={key} feature={feature} />\n                  );\n                })}\n              </div>\n            </div>\n          )\n      )}\n    </TabContent>\n  );\n};\n\nexport const generateLabel = (feature: FeatureLike, idx: number): string | React.ReactNode => {\n  const names = ['Name', 'name', 'Title', 'ID', 'id'];\n  let props = feature.getProperties();\n  let first = '';\n  const frame = feature.get('frame') as DataFrame; // eslint-disable-line\n  if (frame) {\n    const rowIndex = feature.get('rowIndex');\n    for (const f of frame.fields) {\n      if (f.type === FieldType.string) {\n        const k = getFieldDisplayName(f, frame);\n        if (!first) {\n          first = k;\n        }\n        props[k] = f.values[rowIndex];\n      }\n    }\n  }\n\n  for (let k of names) {\n    const v = props[k];\n    if (v) {\n      return v;\n    }\n  }\n\n  if (first) {\n    return (\n      <span>\n        {first}: {renderValue(props[first])}\n      </span>\n    );\n  }\n\n  for (let k of Object.keys(props)) {\n    const v = props[k];\n    if (isString(v)) {\n      return (\n        <span>\n          {k}: {renderValue(v)}\n        </span>\n      );\n    }\n  }\n\n  return `Match: ${idx + 1}`;\n};\n\nconst getStyles = (theme: GrafanaTheme2) => ({\n  collapsibleRow: css({\n    marginBottom: 0,\n  }),\n});\n","import { Dispatch, SetStateAction } from 'react';\n\nimport { Tab, TabsBar } from '@grafana/ui';\nimport { GeomapLayerHover } from 'app/plugins/panel/geomap/event';\n\ntype Props = {\n  layers?: GeomapLayerHover[];\n  setActiveTabIndex: Dispatch<SetStateAction<number>>;\n  activeTabIndex: number;\n};\n\nexport const DataHoverTabs = ({ layers, setActiveTabIndex, activeTabIndex }: Props) => {\n  return (\n    <TabsBar>\n      {layers &&\n        layers.map((g, index) => (\n          <Tab\n            key={index}\n            label={g.layer.getName()}\n            active={index === activeTabIndex}\n            counter={g.features.length > 1 ? g.features.length : null}\n            onChangeTab={() => {\n              setActiveTabIndex(index);\n            }}\n          />\n        ))}\n    </TabsBar>\n  );\n};\n","import { useState } from 'react';\n\nimport { CloseButton } from 'app/core/components/CloseButton/CloseButton';\nimport { GeomapLayerHover } from 'app/plugins/panel/geomap/event';\n\nimport { DataHoverRows } from './DataHoverRows';\nimport { DataHoverTabs } from './DataHoverTabs';\n\nexport interface Props {\n  layers?: GeomapLayerHover[];\n  isOpen: boolean;\n  onClose: () => void;\n}\n\nexport const ComplexDataHoverView = ({ layers, onClose, isOpen }: Props) => {\n  const [activeTabIndex, setActiveTabIndex] = useState<number>(0);\n\n  if (!layers) {\n    return null;\n  }\n\n  return (\n    <>\n      {isOpen && <CloseButton style={{ zIndex: 1 }} onClick={onClose} />}\n      <DataHoverTabs layers={layers} setActiveTabIndex={setActiveTabIndex} activeTabIndex={activeTabIndex} />\n      <DataHoverRows layers={layers} activeTabIndex={activeTabIndex} />\n    </>\n  );\n};\n","import { useDialog } from '@react-aria/dialog';\nimport { useOverlay } from '@react-aria/overlays';\nimport { createRef } from 'react';\n\nimport { Portal, VizTooltipContainer } from '@grafana/ui';\nimport { ComplexDataHoverView } from 'app/features/visualization/data-hover/ComplexDataHoverView';\n\nimport { GeomapHoverPayload } from './event';\n\ninterface Props {\n  ttip?: GeomapHoverPayload;\n  isOpen: boolean;\n  onClose: () => void;\n}\n\nexport const GeomapTooltip = ({ ttip, onClose, isOpen }: Props) => {\n  const ref = createRef<HTMLElement>();\n  const { overlayProps } = useOverlay({ onClose, isDismissable: true, isOpen }, ref);\n  const { dialogProps } = useDialog({}, ref);\n\n  return (\n    <>\n      {ttip && ttip.layers && (\n        <Portal>\n          <VizTooltipContainer position={{ x: ttip.pageX, y: ttip.pageY }} offset={{ x: 10, y: 10 }} allowPointerEvents>\n            <section ref={ref} {...overlayProps} {...dialogProps}>\n              <ComplexDataHoverView layers={ttip.layers} isOpen={isOpen} onClose={onClose} />\n            </section>\n          </VizTooltipContainer>\n        </Portal>\n      )}\n    </>\n  );\n};\n","import { css } from '@emotion/css';\nimport Map from 'ol/Map';\nimport { Coordinate } from 'ol/coordinate';\nimport { transform } from 'ol/proj';\nimport { PureComponent } from 'react';\nimport tinycolor from 'tinycolor2';\n\nimport { GrafanaTheme2 } from '@grafana/data';\nimport { selectors } from '@grafana/e2e-selectors/src';\nimport { Trans } from '@grafana/i18n';\nimport { config } from 'app/core/config';\n\ninterface Props {\n  map: Map;\n}\n\ninterface State {\n  zoom?: number;\n  center: Coordinate;\n}\n\nexport class DebugOverlay extends PureComponent<Props, State> {\n  style = getStyles(config.theme2);\n\n  constructor(props: Props) {\n    super(props);\n    this.state = { zoom: 0, center: [0, 0] };\n  }\n\n  updateViewState = () => {\n    const view = this.props.map.getView();\n    this.setState({\n      zoom: view.getZoom(),\n      center: transform(view.getCenter()!, view.getProjection(), 'EPSG:4326'),\n    });\n  };\n\n  componentDidMount() {\n    this.props.map.on('moveend', this.updateViewState);\n    this.updateViewState();\n  }\n\n  render() {\n    const { zoom, center } = this.state;\n\n    return (\n      <div className={this.style.infoWrap} aria-label={selectors.components.DebugOverlay.wrapper}>\n        <table>\n          <tbody>\n            <tr>\n              <th>\n                <Trans i18nKey=\"geomap.debug-overlay.zoom\">Zoom:</Trans>\n              </th>\n              <td>{zoom?.toFixed(1)}</td>\n            </tr>\n            <tr>\n              <th>\n                <Trans i18nKey=\"geomap.debug-overlay.center\">Center:</Trans>&nbsp;\n              </th>\n              <td>\n                {center[0].toFixed(5)}, {center[1].toFixed(5)}\n              </td>\n            </tr>\n          </tbody>\n        </table>\n      </div>\n    );\n  }\n}\n\nconst getStyles = (theme: GrafanaTheme2) => ({\n  infoWrap: css({\n    color: theme.colors.text.primary,\n    background: tinycolor(theme.components.panel.background).setAlpha(0.7).toString(),\n    borderRadius: theme.shape.radius.default,\n    padding: theme.spacing(1),\n  }),\n});\n","import { FormattedValue, getValueFormat, SelectableValue, toFixedUnit } from '@grafana/data';\n\ntype MeasureAction = 'area' | 'length';\n\nexport interface MapMeasureOptions {\n  action: MeasureAction;\n  unit: string;\n  color?: string;\n}\n\nexport interface MapMeasure extends SelectableValue<MeasureAction> {\n  geometry: 'Polygon' | 'LineString';\n  units: MapUnit[];\n\n  /**\n   * This will get the best unit for the selected string or a default\n   * This is helpful when converting from area<>length, we should try to stay\n   * in the same category of unit if possible\n   */\n  getUnit: (v?: string) => MapUnit;\n}\n\nexport interface MapUnit extends SelectableValue<string> {\n  format: (si: number) => FormattedValue;\n}\n\nexport const measures: MapMeasure[] = [\n  {\n    value: 'length',\n    label: 'Length',\n    geometry: 'LineString',\n    units: [\n      {\n        label: 'Metric (m/km)',\n        value: 'm',\n        format: (m: number) => getValueFormat('lengthm')(m),\n      },\n      {\n        label: 'Feet (ft)',\n        value: 'ft',\n        format: (m: number) => getValueFormat('lengthft')(m * 3.28084),\n      },\n      {\n        label: 'Miles (mi)',\n        value: 'mi',\n        format: (m: number) => getValueFormat('lengthmi')(m / 1609.0),\n      },\n      {\n        label: 'Nautical miles (nmi)',\n        value: 'nmi',\n        format: (m: number) => getValueFormat('nmi')(m / 1852.0),\n      },\n    ],\n    getUnit: (v?: string) => {\n      const units = measures[0].units;\n      if (v?.endsWith('2')) {\n        v = v.substring(0, v.length - 1);\n      }\n      return units.find((u) => u.value === v) ?? units[0];\n    },\n  },\n  {\n    value: 'area',\n    label: 'Area',\n    geometry: 'Polygon',\n    units: [\n      {\n        label: 'Square Meters (m)',\n        value: 'm2',\n        format: (m2: number) => getValueFormat('areaM2')(m2),\n      },\n      {\n        label: 'Square Kilometers (km)',\n        value: 'km2',\n        format: (m2: number) => toFixedUnit('km')(m2 * 1e-6),\n      },\n      {\n        label: 'Square Feet (ft)',\n        value: 'ft2',\n        format: (m2: number) => getValueFormat('areaF2')(m2 * 10.76391),\n      },\n      {\n        label: 'Square Miles (mi)',\n        value: 'mi2',\n        format: (m2: number) => getValueFormat('areaMI2')(m2 * 3.861e-7),\n      },\n      {\n        label: 'Acres',\n        value: 'acre2',\n        format: (m2: number) => toFixedUnit('acre')(m2 * 2.47105e-4),\n      },\n      {\n        label: 'Hectare',\n        value: 'hectare2',\n        format: (m2: number) => toFixedUnit('ha')(m2 * 1e-4),\n      },\n    ],\n    getUnit: (v?: string) => {\n      const units = measures[1].units;\n      if (!v?.endsWith('2')) {\n        v += '2';\n      }\n      return units.find((u) => u.value === v) ?? units[0];\n    },\n  },\n];\n","/**\n * @module ol/featureloader\n */\n\n/**\n *\n * @type {boolean}\n * @private\n */\nlet withCredentials = false;\n\n/**\n * {@link module:ol/source/Vector~VectorSource} sources use a function of this type to\n * load features.\n *\n * This function takes up to 5 arguments. These are an {@link module:ol/extent~Extent} representing\n * the area to be loaded, a `{number}` representing the resolution (map units per pixel), a\n * {@link module:ol/proj/Projection~Projection} for the projection, an optional success callback that should get\n * the loaded features passed as an argument and an optional failure callback with no arguments. If\n * the callbacks are not used, the corresponding vector source will not fire `'featuresloadend'` and\n * `'featuresloaderror'` events. `this` within the function is bound to the\n * {@link module:ol/source/Vector~VectorSource} it's called from.\n *\n * The function is responsible for loading the features and adding them to the\n * source.\n *\n * @template {import(\"./Feature.js\").FeatureLike} [FeatureType=import(\"./Feature.js\").FeatureLike]\n * @typedef {(\n *           extent: import(\"./extent.js\").Extent,\n *           resolution: number,\n *           projection: import(\"./proj/Projection.js\").default,\n *           success?: (features: Array<FeatureType>) => void,\n *           failure?: () => void) => void} FeatureLoader\n * @api\n */\n\n/**\n * {@link module:ol/source/Vector~VectorSource} sources use a function of this type to\n * get the url to load features from.\n *\n * This function takes an {@link module:ol/extent~Extent} representing the area\n * to be loaded, a `{number}` representing the resolution (map units per pixel)\n * and an {@link module:ol/proj/Projection~Projection} for the projection  as\n * arguments and returns a `{string}` representing the URL.\n * @typedef {function(import(\"./extent.js\").Extent, number, import(\"./proj/Projection.js\").default): string} FeatureUrlFunction\n * @api\n */\n\n/**\n * @template {import(\"./Feature.js\").FeatureLike} [FeatureType=import(\"./Feature.js\").default]\n * @param {string|FeatureUrlFunction} url Feature URL service.\n * @param {import(\"./format/Feature.js\").default<FeatureType>} format Feature format.\n * @param {import(\"./extent.js\").Extent} extent Extent.\n * @param {number} resolution Resolution.\n * @param {import(\"./proj/Projection.js\").default} projection Projection.\n * @param {function(Array<FeatureType>, import(\"./proj/Projection.js\").default): void} success Success\n *      Function called with the loaded features and optionally with the data projection.\n * @param {function(): void} failure Failure\n *      Function called when loading failed.\n */\nexport function loadFeaturesXhr(\n  url,\n  format,\n  extent,\n  resolution,\n  projection,\n  success,\n  failure,\n) {\n  const xhr = new XMLHttpRequest();\n  xhr.open(\n    'GET',\n    typeof url === 'function' ? url(extent, resolution, projection) : url,\n    true,\n  );\n  if (format.getType() == 'arraybuffer') {\n    xhr.responseType = 'arraybuffer';\n  }\n  xhr.withCredentials = withCredentials;\n  /**\n   * @param {Event} event Event.\n   * @private\n   */\n  xhr.onload = function (event) {\n    // status will be 0 for file:// urls\n    if (!xhr.status || (xhr.status >= 200 && xhr.status < 300)) {\n      const type = format.getType();\n      try {\n        /** @type {Document|Node|Object|string|undefined} */\n        let source;\n        if (type == 'text' || type == 'json') {\n          source = xhr.responseText;\n        } else if (type == 'xml') {\n          source = xhr.responseXML || xhr.responseText;\n        } else if (type == 'arraybuffer') {\n          source = /** @type {ArrayBuffer} */ (xhr.response);\n        }\n        if (source) {\n          success(\n            /** @type {Array<FeatureType>} */\n            (\n              format.readFeatures(source, {\n                extent: extent,\n                featureProjection: projection,\n              })\n            ),\n            format.readProjection(source),\n          );\n        } else {\n          failure();\n        }\n      } catch {\n        failure();\n      }\n    } else {\n      failure();\n    }\n  };\n  /**\n   * @private\n   */\n  xhr.onerror = failure;\n  xhr.send();\n}\n\n/**\n * Create an XHR feature loader for a `url` and `format`. The feature loader\n * loads features (with XHR), parses the features, and adds them to the\n * vector source.\n *\n * @template {import(\"./Feature.js\").FeatureLike} [FeatureType=import(\"./Feature.js\").default]\n * @param {string|FeatureUrlFunction} url Feature URL service.\n * @param {import(\"./format/Feature.js\").default<FeatureType>} format Feature format.\n * @return {FeatureLoader<FeatureType>} The feature loader.\n * @api\n */\nexport function xhr(url, format) {\n  /**\n   * @param {import(\"./extent.js\").Extent} extent Extent.\n   * @param {number} resolution Resolution.\n   * @param {import(\"./proj/Projection.js\").default} projection Projection.\n   * @param {function(Array<FeatureType>): void} [success] Success\n   *      Function called when loading succeeded.\n   * @param {function(): void} [failure] Failure\n   *      Function called when loading failed.\n   * @this {import(\"./source/Vector.js\").default<FeatureType>}\n   */\n  return function (extent, resolution, projection, success, failure) {\n    loadFeaturesXhr(\n      url,\n      format,\n      extent,\n      resolution,\n      projection,\n      /**\n       * @param {Array<FeatureType>} features The loaded features.\n       * @param {import(\"./proj/Projection.js\").default} dataProjection Data\n       * projection.\n       */\n      (features, dataProjection) => {\n        this.addFeatures(features);\n        if (success !== undefined) {\n          success(features);\n        }\n      },\n      () => {\n        this.changed();\n        if (failure !== undefined) {\n          failure();\n        }\n      },\n    );\n  };\n}\n\n/**\n * Setter for the withCredentials configuration for the XHR.\n *\n * @param {boolean} xhrWithCredentials The value of withCredentials to set.\n * Compare https://developer.mozilla.org/en-US/docs/Web/API/XMLHttpRequest/\n * @api\n */\nexport function setWithCredentials(xhrWithCredentials) {\n  withCredentials = xhrWithCredentials;\n}\n","/**\n * @module ol/loadingstrategy\n */\n\nimport {fromUserExtent, fromUserResolution, toUserExtent} from './proj.js';\n\n/**\n * Strategy function for loading all features with a single request.\n * @param {import(\"./extent.js\").Extent} extent Extent.\n * @param {number} resolution Resolution.\n * @return {Array<import(\"./extent.js\").Extent>} Extents.\n * @api\n */\nexport function all(extent, resolution) {\n  return [[-Infinity, -Infinity, Infinity, Infinity]];\n}\n\n/**\n * Strategy function for loading features based on the view's extent and\n * resolution.\n * @param {import(\"./extent.js\").Extent} extent Extent.\n * @param {number} resolution Resolution.\n * @return {Array<import(\"./extent.js\").Extent>} Extents.\n * @api\n */\nexport function bbox(extent, resolution) {\n  return [extent];\n}\n\n/**\n * Creates a strategy function for loading features based on a tile grid.\n * @param {import(\"./tilegrid/TileGrid.js\").default} tileGrid Tile grid.\n * @return {function(import(\"./extent.js\").Extent, number, import(\"./proj.js\").Projection): Array<import(\"./extent.js\").Extent>} Loading strategy.\n * @api\n */\nexport function tile(tileGrid) {\n  return (\n    /**\n     * @param {import(\"./extent.js\").Extent} extent Extent.\n     * @param {number} resolution Resolution.\n     * @param {import(\"./proj.js\").Projection} projection Projection.\n     * @return {Array<import(\"./extent.js\").Extent>} Extents.\n     */\n    function (extent, resolution, projection) {\n      const z = tileGrid.getZForResolution(\n        fromUserResolution(resolution, projection),\n      );\n      const tileRange = tileGrid.getTileRangeForExtentAndZ(\n        fromUserExtent(extent, projection),\n        z,\n      );\n      /** @type {Array<import(\"./extent.js\").Extent>} */\n      const extents = [];\n      /** @type {import(\"./tilecoord.js\").TileCoord} */\n      const tileCoord = [z, 0, 0];\n      for (\n        tileCoord[1] = tileRange.minX;\n        tileCoord[1] <= tileRange.maxX;\n        ++tileCoord[1]\n      ) {\n        for (\n          tileCoord[2] = tileRange.minY;\n          tileCoord[2] <= tileRange.maxY;\n          ++tileCoord[2]\n        ) {\n          extents.push(\n            toUserExtent(tileGrid.getTileCoordExtent(tileCoord), projection),\n          );\n        }\n      }\n      return extents;\n    }\n  );\n}\n","/**\n * @module ol/structs/RBush\n */\nimport RBush_ from 'rbush';\nimport {createOrUpdate, equals} from '../extent.js';\nimport {isEmpty} from '../obj.js';\nimport {getUid} from '../util.js';\n\n/**\n * @typedef {import(\"rbush\").BBox & {value: T}} Entry\n * @template T\n */\n\n/**\n * @classdesc\n * Wrapper around the RBush by Vladimir Agafonkin.\n * See https://github.com/mourner/rbush.\n *\n * @template {Object} T\n */\nclass RBush {\n  /**\n   * @param {number} [maxEntries] Max entries.\n   */\n  constructor(maxEntries) {\n    /**\n     * @private\n     * @type {RBush_<Entry<T>>}\n     */\n    this.rbush_ = new RBush_(maxEntries);\n\n    /**\n     * A mapping between the objects added to this rbush wrapper\n     * and the objects that are actually added to the internal rbush.\n     * @private\n     * @type {Object<string, Entry<T>>}\n     */\n    this.items_ = {};\n  }\n\n  /**\n   * Insert a value into the RBush.\n   * @param {import(\"../extent.js\").Extent} extent Extent.\n   * @param {T} value Value.\n   */\n  insert(extent, value) {\n    /** @type {Entry<T>} */\n    const item = {\n      minX: extent[0],\n      minY: extent[1],\n      maxX: extent[2],\n      maxY: extent[3],\n      value: value,\n    };\n\n    this.rbush_.insert(item);\n    this.items_[getUid(value)] = item;\n  }\n\n  /**\n   * Bulk-insert values into the RBush.\n   * @param {Array<import(\"../extent.js\").Extent>} extents Extents.\n   * @param {Array<T>} values Values.\n   */\n  load(extents, values) {\n    const items = new Array(values.length);\n    for (let i = 0, l = values.length; i < l; i++) {\n      const extent = extents[i];\n      const value = values[i];\n\n      /** @type {Entry<T>} */\n      const item = {\n        minX: extent[0],\n        minY: extent[1],\n        maxX: extent[2],\n        maxY: extent[3],\n        value: value,\n      };\n      items[i] = item;\n      this.items_[getUid(value)] = item;\n    }\n    this.rbush_.load(items);\n  }\n\n  /**\n   * Remove a value from the RBush.\n   * @param {T} value Value.\n   * @return {boolean} Removed.\n   */\n  remove(value) {\n    const uid = getUid(value);\n\n    // get the object in which the value was wrapped when adding to the\n    // internal rbush. then use that object to do the removal.\n    const item = this.items_[uid];\n    delete this.items_[uid];\n    return this.rbush_.remove(item) !== null;\n  }\n\n  /**\n   * Update the extent of a value in the RBush.\n   * @param {import(\"../extent.js\").Extent} extent Extent.\n   * @param {T} value Value.\n   */\n  update(extent, value) {\n    const item = this.items_[getUid(value)];\n    const bbox = [item.minX, item.minY, item.maxX, item.maxY];\n    if (!equals(bbox, extent)) {\n      this.remove(value);\n      this.insert(extent, value);\n    }\n  }\n\n  /**\n   * Return all values in the RBush.\n   * @return {Array<T>} All.\n   */\n  getAll() {\n    const items = this.rbush_.all();\n    return items.map(function (item) {\n      return item.value;\n    });\n  }\n\n  /**\n   * Return all values in the given extent.\n   * @param {import(\"../extent.js\").Extent} extent Extent.\n   * @return {Array<T>} All in extent.\n   */\n  getInExtent(extent) {\n    /** @type {import(\"rbush\").BBox} */\n    const bbox = {\n      minX: extent[0],\n      minY: extent[1],\n      maxX: extent[2],\n      maxY: extent[3],\n    };\n    const items = this.rbush_.search(bbox);\n    return items.map(function (item) {\n      return item.value;\n    });\n  }\n\n  /**\n   * Calls a callback function with each value in the tree.\n   * If the callback returns a truthy value, this value is returned without\n   * checking the rest of the tree.\n   * @param {function(T): R} callback Callback.\n   * @return {R|undefined} Callback return value.\n   * @template R\n   */\n  forEach(callback) {\n    return this.forEach_(this.getAll(), callback);\n  }\n\n  /**\n   * Calls a callback function with each value in the provided extent.\n   * @param {import(\"../extent.js\").Extent} extent Extent.\n   * @param {function(T): R} callback Callback.\n   * @return {R|undefined} Callback return value.\n   * @template R\n   */\n  forEachInExtent(extent, callback) {\n    return this.forEach_(this.getInExtent(extent), callback);\n  }\n\n  /**\n   * @param {Array<T>} values Values.\n   * @param {function(T): R} callback Callback.\n   * @return {R|undefined} Callback return value.\n   * @template R\n   * @private\n   */\n  forEach_(values, callback) {\n    let result;\n    for (let i = 0, l = values.length; i < l; i++) {\n      result = callback(values[i]);\n      if (result) {\n        return result;\n      }\n    }\n    return result;\n  }\n\n  /**\n   * @return {boolean} Is empty.\n   */\n  isEmpty() {\n    return isEmpty(this.items_);\n  }\n\n  /**\n   * Remove all values from the RBush.\n   */\n  clear() {\n    this.rbush_.clear();\n    this.items_ = {};\n  }\n\n  /**\n   * @param {import(\"../extent.js\").Extent} [extent] Extent.\n   * @return {import(\"../extent.js\").Extent} Extent.\n   */\n  getExtent(extent) {\n    const data = this.rbush_.toJSON();\n    return createOrUpdate(data.minX, data.minY, data.maxX, data.maxY, extent);\n  }\n\n  /**\n   * @param {RBush<T>} rbush R-Tree.\n   */\n  concat(rbush) {\n    this.rbush_.load(rbush.rbush_.all());\n    for (const i in rbush.items_) {\n      this.items_[i] = rbush.items_[i];\n    }\n  }\n}\n\nexport default RBush;\n","/**\n * @module ol/source/Source\n */\nimport BaseObject from '../Object.js';\nimport {get as getProjection} from '../proj.js';\n\n/**\n * @typedef {'undefined' | 'loading' | 'ready' | 'error'} State\n * State of the source, one of 'undefined', 'loading', 'ready' or 'error'.\n */\n\n/**\n * A function that takes a {@link import(\"../View.js\").ViewStateLayerStateExtent} and returns a string or\n * an array of strings representing source attributions.\n *\n * @typedef {function(import(\"../View.js\").ViewStateLayerStateExtent): (string|Array<string>)} Attribution\n */\n\n/**\n * A type that can be used to provide attribution information for data sources.\n *\n * It represents either\n * a simple string (e.g. `' Acme Inc.'`)\n * an array of simple strings (e.g. `[' Acme Inc.', ' Bacme Inc.']`)\n * a function that returns a string or array of strings ({@link module:ol/source/Source~Attribution})\n *\n * @typedef {string|Array<string>|Attribution} AttributionLike\n */\n\n/**\n * @typedef {Object} Options\n * @property {AttributionLike} [attributions] Attributions.\n * @property {boolean} [attributionsCollapsible=true] Attributions are collapsible.\n * @property {import(\"../proj.js\").ProjectionLike} [projection] Projection. Default is the view projection.\n * @property {import(\"./Source.js\").State} [state='ready'] State.\n * @property {boolean} [wrapX=false] WrapX.\n * @property {boolean} [interpolate=false] Use interpolated values when resampling.  By default,\n * the nearest neighbor is used when resampling.\n */\n\n/**\n * @classdesc\n * Abstract base class; normally only used for creating subclasses and not\n * instantiated in apps.\n * Base class for {@link module:ol/layer/Layer~Layer} sources.\n *\n * A generic `change` event is triggered when the state of the source changes.\n * @abstract\n * @api\n */\nclass Source extends BaseObject {\n  /**\n   * @param {Options} options Source options.\n   */\n  constructor(options) {\n    super();\n\n    /**\n     * @protected\n     * @type {import(\"../proj/Projection.js\").default|null}\n     */\n    this.projection = getProjection(options.projection);\n\n    /**\n     * @private\n     * @type {?Attribution}\n     */\n    this.attributions_ = adaptAttributions(options.attributions);\n\n    /**\n     * @private\n     * @type {boolean}\n     */\n    this.attributionsCollapsible_ = options.attributionsCollapsible ?? true;\n\n    /**\n     * This source is currently loading data. Sources that defer loading to the\n     * map's tile queue never set this to `true`.\n     * @type {boolean}\n     */\n    this.loading = false;\n\n    /**\n     * @private\n     * @type {import(\"./Source.js\").State}\n     */\n    this.state_ = options.state !== undefined ? options.state : 'ready';\n\n    /**\n     * @private\n     * @type {boolean}\n     */\n    this.wrapX_ = options.wrapX !== undefined ? options.wrapX : false;\n\n    /**\n     * @private\n     * @type {boolean}\n     */\n    this.interpolate_ = !!options.interpolate;\n\n    /**\n     * @protected\n     * @type {function(import(\"../View.js\").ViewOptions):void}\n     */\n    this.viewResolver = null;\n\n    /**\n     * @protected\n     * @type {function(Error):void}\n     */\n    this.viewRejector = null;\n\n    const self = this;\n    /**\n     * @private\n     * @type {Promise<import(\"../View.js\").ViewOptions>}\n     */\n    this.viewPromise_ = new Promise(function (resolve, reject) {\n      self.viewResolver = resolve;\n      self.viewRejector = reject;\n    });\n  }\n\n  /**\n   * Get the attribution function for the source.\n   * @return {?Attribution} Attribution function.\n   * @api\n   */\n  getAttributions() {\n    return this.attributions_;\n  }\n\n  /**\n   * @return {boolean} Attributions are collapsible.\n   * @api\n   */\n  getAttributionsCollapsible() {\n    return this.attributionsCollapsible_;\n  }\n\n  /**\n   * Get the projection of the source.\n   * @return {import(\"../proj/Projection.js\").default|null} Projection.\n   * @api\n   */\n  getProjection() {\n    return this.projection;\n  }\n\n  /**\n   * @param {import(\"../proj/Projection\").default} [projection] Projection.\n   * @return {Array<number>|null} Resolutions.\n   */\n  getResolutions(projection) {\n    return null;\n  }\n\n  /**\n   * @return {Promise<import(\"../View.js\").ViewOptions>} A promise for view-related properties.\n   */\n  getView() {\n    return this.viewPromise_;\n  }\n\n  /**\n   * Get the state of the source, see {@link import(\"./Source.js\").State} for possible states.\n   * @return {import(\"./Source.js\").State} State.\n   * @api\n   */\n  getState() {\n    return this.state_;\n  }\n\n  /**\n   * @return {boolean|undefined} Wrap X.\n   */\n  getWrapX() {\n    return this.wrapX_;\n  }\n\n  /**\n   * @return {boolean} Use linear interpolation when resampling.\n   */\n  getInterpolate() {\n    return this.interpolate_;\n  }\n\n  /**\n   * Refreshes the source. The source will be cleared, and data from the server will be reloaded.\n   * @api\n   */\n  refresh() {\n    this.changed();\n  }\n\n  /**\n   * Set the attributions of the source.\n   * @param {AttributionLike|undefined} attributions Attributions.\n   *     Can be passed as `string`, `Array<string>`, {@link module:ol/source/Source~Attribution},\n   *     or `undefined`.\n   * @api\n   */\n  setAttributions(attributions) {\n    this.attributions_ = adaptAttributions(attributions);\n    this.changed();\n  }\n\n  /**\n   * Set the state of the source.\n   * @param {import(\"./Source.js\").State} state State.\n   */\n  setState(state) {\n    this.state_ = state;\n    this.changed();\n  }\n}\n\n/**\n * Turns the attributions option into an attributions function.\n * @param {AttributionLike|undefined} attributionLike The attribution option.\n * @return {Attribution|null} An attribution function (or null).\n */\nfunction adaptAttributions(attributionLike) {\n  if (!attributionLike) {\n    return null;\n  }\n  if (typeof attributionLike === 'function') {\n    return attributionLike;\n  }\n  if (!Array.isArray(attributionLike)) {\n    attributionLike = [attributionLike];\n  }\n  return (frameState) => attributionLike;\n}\n\nexport default Source;\n","/**\n * @module ol/source/Vector\n */\n\nimport Collection from '../Collection.js';\nimport CollectionEventType from '../CollectionEventType.js';\nimport ObjectEventType from '../ObjectEventType.js';\nimport {extend} from '../array.js';\nimport {assert} from '../asserts.js';\nimport Event from '../events/Event.js';\nimport EventType from '../events/EventType.js';\nimport {listen, unlistenByKey} from '../events.js';\nimport {containsExtent, equals, wrapAndSliceX} from '../extent.js';\nimport {xhr} from '../featureloader.js';\nimport {TRUE, VOID} from '../functions.js';\nimport {all as allStrategy} from '../loadingstrategy.js';\nimport {isEmpty} from '../obj.js';\nimport RenderFeature from '../render/Feature.js';\nimport RBush from '../structs/RBush.js';\nimport {getUid} from '../util.js';\nimport Source from './Source.js';\nimport VectorEventType from './VectorEventType.js';\n\n/**\n * A function that takes an {@link module:ol/extent~Extent} and a resolution as arguments, and\n * returns an array of {@link module:ol/extent~Extent} with the extents to load. Usually this\n * is one of the standard {@link module:ol/loadingstrategy} strategies.\n *\n * @typedef {function(import(\"../extent.js\").Extent, number, import(\"../proj/Projection.js\").default): Array<import(\"../extent.js\").Extent>} LoadingStrategy\n * @api\n */\n\n/**\n * @classdesc\n * Events emitted by {@link module:ol/source/Vector~VectorSource} instances are instances of this\n * type.\n * @template {import(\"../Feature.js\").FeatureLike} [FeatureType=import(\"../Feature.js\").default]\n */\nexport class VectorSourceEvent extends Event {\n  /**\n   * @param {string} type Type.\n   * @param {FeatureType} [feature] Feature.\n   * @param {Array<FeatureType>} [features] Features.\n   */\n  constructor(type, feature, features) {\n    super(type);\n\n    /**\n     * The added or removed feature for the `ADDFEATURE` and `REMOVEFEATURE` events, `undefined` otherwise.\n     * @type {FeatureType|undefined}\n     * @api\n     */\n    this.feature = feature;\n\n    /**\n     * The loaded features for the `FEATURESLOADED` event, `undefined` otherwise.\n     * @type {Array<FeatureType>|undefined}\n     * @api\n     */\n    this.features = features;\n  }\n}\n\n/***\n * @template {import(\"../Feature.js\").FeatureLike} [T=import(\"../Feature.js\").default]\n * @typedef {T extends RenderFeature ? T|Array<T> : T} FeatureClassOrArrayOfRenderFeatures\n */\n\n/***\n * @template Return\n * @template {import(\"../Feature.js\").FeatureLike} [FeatureType=import(\"../Feature.js\").default]\n * @typedef {import(\"../Observable\").OnSignature<import(\"../Observable\").EventTypes, import(\"../events/Event.js\").default, Return> &\n *   import(\"../Observable\").OnSignature<import(\"../ObjectEventType\").Types, import(\"../Object\").ObjectEvent, Return> &\n *   import(\"../Observable\").OnSignature<import(\"./VectorEventType\").VectorSourceEventTypes, VectorSourceEvent<FeatureType>, Return> &\n *   import(\"../Observable\").CombinedOnSignature<import(\"../Observable\").EventTypes|import(\"../ObjectEventType\").Types|\n *     import(\"./VectorEventType\").VectorSourceEventTypes, Return>} VectorSourceOnSignature\n */\n\n/**\n * @template {import(\"../Feature.js\").FeatureLike} [FeatureType=import(\"../Feature.js\").default]\n * @typedef {Object} Options\n * @property {import(\"./Source.js\").AttributionLike} [attributions] Attributions.\n * @property {Array<FeatureType>|Collection<FeatureType>} [features]\n * Features. If provided as {@link module:ol/Collection~Collection}, the features in the source\n * and the collection will stay in sync.\n * @property {import(\"../format/Feature.js\").default<FeatureType>} [format] The feature format used by the XHR\n * feature loader when `url` is set. Required if `url` is set, otherwise ignored.\n * @property {import(\"../featureloader.js\").FeatureLoader<FeatureType>} [loader]\n * The loader function used to load features, from a remote source for example.\n * If this is not set and `url` is set, the source will create and use an XHR\n * feature loader. The `'featuresloadend'` and `'featuresloaderror'` events\n * will only fire if the `success` and `failure` callbacks are used.\n *\n * Example:\n *\n * ```js\n * import Vector from 'ol/source/Vector.js';\n * import GeoJSON from 'ol/format/GeoJSON.js';\n * import {bbox} from 'ol/loadingstrategy.js';\n *\n * const vectorSource = new Vector({\n *   format: new GeoJSON(),\n *   loader: function(extent, resolution, projection, success, failure) {\n *      const proj = projection.getCode();\n *      const url = 'https://ahocevar.com/geoserver/wfs?service=WFS&' +\n *          'version=1.1.0&request=GetFeature&typename=osm:water_areas&' +\n *          'outputFormat=application/json&srsname=' + proj + '&' +\n *          'bbox=' + extent.join(',') + ',' + proj;\n *      const xhr = new XMLHttpRequest();\n *      xhr.open('GET', url);\n *      const onError = function() {\n *        vectorSource.removeLoadedExtent(extent);\n *        failure();\n *      }\n *      xhr.onerror = onError;\n *      xhr.onload = function() {\n *        if (xhr.status == 200) {\n *          const features = vectorSource.getFormat().readFeatures(xhr.responseText);\n *          vectorSource.addFeatures(features);\n *          success(features);\n *        } else {\n *          onError();\n *        }\n *      }\n *      xhr.send();\n *    },\n *    strategy: bbox,\n *  });\n * ```\n * @property {boolean} [overlaps=true] This source may have overlapping geometries.\n * Setting this to `false` (e.g. for sources with polygons that represent administrative\n * boundaries or TopoJSON sources) allows the renderer to optimise fill and\n * stroke operations.\n * @property {LoadingStrategy} [strategy] The loading strategy to use.\n * By default an {@link module:ol/loadingstrategy.all}\n * strategy is used, a one-off strategy which loads all features at once.\n * @property {string|import(\"../featureloader.js\").FeatureUrlFunction} [url]\n * Setting this option instructs the source to load features using an XHR loader\n * (see {@link module:ol/featureloader.xhr}). Use a `string` and an\n * {@link module:ol/loadingstrategy.all} for a one-off download of all features from\n * the given URL. Use a {@link module:ol/featureloader~FeatureUrlFunction} to generate the url with\n * other loading strategies.\n * Requires `format` to be set as well.\n * When default XHR feature loader is provided, the features will\n * be transformed from the data projection to the view projection\n * during parsing. If your remote data source does not advertise its projection\n * properly, this transformation will be incorrect. For some formats, the\n * default projection (usually EPSG:4326) can be overridden by setting the\n * dataProjection constructor option on the format.\n * Note that if a source contains non-feature data, such as a GeoJSON geometry\n * or a KML NetworkLink, these will be ignored. Use a custom loader to load these.\n * @property {boolean} [useSpatialIndex=true]\n * By default, an RTree is used as spatial index. When features are removed and\n * added frequently, and the total number of features is low, setting this to\n * `false` may improve performance.\n *\n * Note that\n * {@link module:ol/source/Vector~VectorSource#getFeaturesInExtent},\n * {@link module:ol/source/Vector~VectorSource#getClosestFeatureToCoordinate} and\n * {@link module:ol/source/Vector~VectorSource#getExtent} cannot be used when `useSpatialIndex` is\n * set to `false`, and {@link module:ol/source/Vector~VectorSource#forEachFeatureInExtent} will loop\n * through all features.\n *\n * When set to `false`, the features will be maintained in an\n * {@link module:ol/Collection~Collection}, which can be retrieved through\n * {@link module:ol/source/Vector~VectorSource#getFeaturesCollection}.\n * @property {boolean} [wrapX=true] Wrap the world horizontally. For vector editing across the\n * -180 and 180 meridians to work properly, this should be set to `false`. The\n * resulting geometry coordinates will then exceed the world bounds.\n */\n\n/**\n * @classdesc\n * Provides a source of features for vector layers. Vector features provided\n * by this source are suitable for editing. See {@link module:ol/source/VectorTile~VectorTile} for\n * vector data that is optimized for rendering.\n *\n * @fires VectorSourceEvent\n * @api\n * @template {import(\"../Feature.js\").FeatureLike} [FeatureType=import(\"../Feature.js\").default]\n */\nclass VectorSource extends Source {\n  /**\n   * @param {Options<FeatureType>} [options] Vector source options.\n   */\n  constructor(options) {\n    options = options || {};\n\n    super({\n      attributions: options.attributions,\n      interpolate: true,\n      projection: undefined,\n      state: 'ready',\n      wrapX: options.wrapX !== undefined ? options.wrapX : true,\n    });\n\n    /***\n     * @type {VectorSourceOnSignature<import(\"../events\").EventsKey, FeatureType>}\n     */\n    this.on;\n\n    /***\n     * @type {VectorSourceOnSignature<import(\"../events\").EventsKey, FeatureType>}\n     */\n    this.once;\n\n    /***\n     * @type {VectorSourceOnSignature<void>}\n     */\n    this.un;\n\n    /**\n     * @private\n     * @type {import(\"../featureloader.js\").FeatureLoader<import(\"../Feature.js\").FeatureLike>}\n     */\n    this.loader_ = VOID;\n\n    /**\n     * @private\n     * @type {import(\"../format/Feature.js\").default<FeatureType>|null}\n     */\n    this.format_ = options.format || null;\n\n    /**\n     * @private\n     * @type {boolean}\n     */\n    this.overlaps_ = options.overlaps === undefined ? true : options.overlaps;\n\n    /**\n     * @private\n     * @type {string|import(\"../featureloader.js\").FeatureUrlFunction|undefined}\n     */\n    this.url_ = options.url;\n\n    if (options.loader !== undefined) {\n      this.loader_ = options.loader;\n    } else if (this.url_ !== undefined) {\n      assert(this.format_, '`format` must be set when `url` is set');\n      // create a XHR feature loader for \"url\" and \"format\"\n      this.loader_ = xhr(this.url_, this.format_);\n    }\n\n    /**\n     * @private\n     * @type {LoadingStrategy}\n     */\n    this.strategy_ =\n      options.strategy !== undefined ? options.strategy : allStrategy;\n\n    const useSpatialIndex =\n      options.useSpatialIndex !== undefined ? options.useSpatialIndex : true;\n\n    /**\n     * @private\n     * @type {RBush<FeatureType>}\n     */\n    this.featuresRtree_ = useSpatialIndex ? new RBush() : null;\n\n    /**\n     * @private\n     * @type {RBush<{extent: import(\"../extent.js\").Extent}>}\n     */\n    this.loadedExtentsRtree_ = new RBush();\n\n    /**\n     * @type {number}\n     * @private\n     */\n    this.loadingExtentsCount_ = 0;\n\n    /**\n     * @private\n     * @type {!Object<string, FeatureType>}\n     */\n    this.nullGeometryFeatures_ = {};\n\n    /**\n     * A lookup of features by id (the return from feature.getId()).\n     * @private\n     * @type {!Object<string, import('../Feature.js').FeatureLike|Array<import('../Feature.js').FeatureLike>>}\n     */\n    this.idIndex_ = {};\n\n    /**\n     * A lookup of features by uid (using getUid(feature)).\n     * @private\n     * @type {!Object<string, FeatureType>}\n     */\n    this.uidIndex_ = {};\n\n    /**\n     * @private\n     * @type {Object<string, Array<import(\"../events.js\").EventsKey>>}\n     */\n    this.featureChangeKeys_ = {};\n\n    /**\n     * @private\n     * @type {Collection<FeatureType>|null}\n     */\n    this.featuresCollection_ = null;\n\n    /** @type {Collection<FeatureType>} */\n    let collection;\n    /** @type {Array<FeatureType>} */\n    let features;\n    if (Array.isArray(options.features)) {\n      features = options.features;\n    } else if (options.features) {\n      collection = options.features;\n      features = collection.getArray();\n    }\n    if (!useSpatialIndex && collection === undefined) {\n      collection = new Collection(features);\n    }\n    if (features !== undefined) {\n      this.addFeaturesInternal(features);\n    }\n    if (collection !== undefined) {\n      this.bindFeaturesCollection_(collection);\n    }\n  }\n\n  /**\n   * Add a single feature to the source.  If you want to add a batch of features\n   * at once, call {@link module:ol/source/Vector~VectorSource#addFeatures #addFeatures()}\n   * instead. A feature will not be added to the source if feature with\n   * the same id is already there. The reason for this behavior is to avoid\n   * feature duplication when using bbox or tile loading strategies.\n   * Note: this also applies if a {@link module:ol/Collection~Collection} is used for features,\n   * meaning that if a feature with a duplicate id is added in the collection, it will\n   * be removed from it right away.\n   * @param {FeatureType} feature Feature to add.\n   * @api\n   */\n  addFeature(feature) {\n    this.addFeatureInternal(feature);\n    this.changed();\n  }\n\n  /**\n   * Add a feature without firing a `change` event.\n   * @param {FeatureType} feature Feature.\n   * @protected\n   */\n  addFeatureInternal(feature) {\n    const featureKey = getUid(feature);\n\n    if (!this.addToIndex_(featureKey, feature)) {\n      if (this.featuresCollection_) {\n        this.featuresCollection_.remove(feature);\n      }\n      return;\n    }\n\n    this.setupChangeEvents_(featureKey, feature);\n\n    const geometry = feature.getGeometry();\n    if (geometry) {\n      const extent = geometry.getExtent();\n      if (this.featuresRtree_) {\n        this.featuresRtree_.insert(extent, feature);\n      }\n    } else {\n      this.nullGeometryFeatures_[featureKey] = feature;\n    }\n\n    this.dispatchEvent(\n      new VectorSourceEvent(VectorEventType.ADDFEATURE, feature),\n    );\n  }\n\n  /**\n   * @param {string} featureKey Unique identifier for the feature.\n   * @param {FeatureType} feature The feature.\n   * @private\n   */\n  setupChangeEvents_(featureKey, feature) {\n    if (feature instanceof RenderFeature) {\n      return;\n    }\n    this.featureChangeKeys_[featureKey] = [\n      listen(feature, EventType.CHANGE, this.handleFeatureChange_, this),\n      listen(\n        feature,\n        ObjectEventType.PROPERTYCHANGE,\n        this.handleFeatureChange_,\n        this,\n      ),\n    ];\n  }\n\n  /**\n   * @param {string} featureKey Unique identifier for the feature.\n   * @param {FeatureType} feature The feature.\n   * @return {boolean} The feature is \"valid\", in the sense that it is also a\n   *     candidate for insertion into the Rtree.\n   * @private\n   */\n  addToIndex_(featureKey, feature) {\n    let valid = true;\n    if (feature.getId() !== undefined) {\n      const id = String(feature.getId());\n      if (!(id in this.idIndex_)) {\n        this.idIndex_[id] = feature;\n      } else if (feature instanceof RenderFeature) {\n        const indexedFeature = this.idIndex_[id];\n        if (!(indexedFeature instanceof RenderFeature)) {\n          valid = false;\n        } else if (!Array.isArray(indexedFeature)) {\n          this.idIndex_[id] = [indexedFeature, feature];\n        } else {\n          indexedFeature.push(feature);\n        }\n      } else {\n        valid = false;\n      }\n    }\n    if (valid) {\n      assert(\n        !(featureKey in this.uidIndex_),\n        'The passed `feature` was already added to the source',\n      );\n      this.uidIndex_[featureKey] = feature;\n    }\n    return valid;\n  }\n\n  /**\n   * Add a batch of features to the source.\n   * @param {Array<FeatureType>} features Features to add.\n   * @api\n   */\n  addFeatures(features) {\n    this.addFeaturesInternal(features);\n    this.changed();\n  }\n\n  /**\n   * Add features without firing a `change` event.\n   * @param {Array<FeatureType>} features Features.\n   * @protected\n   */\n  addFeaturesInternal(features) {\n    const extents = [];\n    /** @type {Array<FeatureType>} */\n    const newFeatures = [];\n    /** @type {Array<FeatureType>} */\n    const geometryFeatures = [];\n\n    for (let i = 0, length = features.length; i < length; i++) {\n      const feature = features[i];\n      const featureKey = getUid(feature);\n      if (this.addToIndex_(featureKey, feature)) {\n        newFeatures.push(feature);\n      }\n    }\n\n    for (let i = 0, length = newFeatures.length; i < length; i++) {\n      const feature = newFeatures[i];\n      const featureKey = getUid(feature);\n      this.setupChangeEvents_(featureKey, feature);\n\n      const geometry = feature.getGeometry();\n      if (geometry) {\n        const extent = geometry.getExtent();\n        extents.push(extent);\n        geometryFeatures.push(feature);\n      } else {\n        this.nullGeometryFeatures_[featureKey] = feature;\n      }\n    }\n    if (this.featuresRtree_) {\n      this.featuresRtree_.load(extents, geometryFeatures);\n    }\n\n    if (this.hasListener(VectorEventType.ADDFEATURE)) {\n      for (let i = 0, length = newFeatures.length; i < length; i++) {\n        this.dispatchEvent(\n          new VectorSourceEvent(VectorEventType.ADDFEATURE, newFeatures[i]),\n        );\n      }\n    }\n  }\n\n  /**\n   * @param {!Collection<FeatureType>} collection Collection.\n   * @private\n   */\n  bindFeaturesCollection_(collection) {\n    let modifyingCollection = false;\n    this.addEventListener(\n      VectorEventType.ADDFEATURE,\n      /**\n       * @param {VectorSourceEvent<FeatureType>} evt The vector source event\n       */\n      function (evt) {\n        if (!modifyingCollection) {\n          modifyingCollection = true;\n          collection.push(evt.feature);\n          modifyingCollection = false;\n        }\n      },\n    );\n    this.addEventListener(\n      VectorEventType.REMOVEFEATURE,\n      /**\n       * @param {VectorSourceEvent<FeatureType>} evt The vector source event\n       */\n      function (evt) {\n        if (!modifyingCollection) {\n          modifyingCollection = true;\n          collection.remove(evt.feature);\n          modifyingCollection = false;\n        }\n      },\n    );\n    collection.addEventListener(\n      CollectionEventType.ADD,\n      /**\n       * @param {import(\"../Collection.js\").CollectionEvent<FeatureType>} evt The collection event\n       */\n      (evt) => {\n        if (!modifyingCollection) {\n          modifyingCollection = true;\n          this.addFeature(evt.element);\n          modifyingCollection = false;\n        }\n      },\n    );\n    collection.addEventListener(\n      CollectionEventType.REMOVE,\n      /**\n       * @param {import(\"../Collection.js\").CollectionEvent<FeatureType>} evt The collection event\n       */\n      (evt) => {\n        if (!modifyingCollection) {\n          modifyingCollection = true;\n          this.removeFeature(evt.element);\n          modifyingCollection = false;\n        }\n      },\n    );\n    this.featuresCollection_ = collection;\n  }\n\n  /**\n   * Remove all features from the source.\n   * @param {boolean} [fast] Skip dispatching of {@link module:ol/source/Vector.VectorSourceEvent#event:removefeature} events.\n   * @api\n   */\n  clear(fast) {\n    if (fast) {\n      for (const featureId in this.featureChangeKeys_) {\n        const keys = this.featureChangeKeys_[featureId];\n        keys.forEach(unlistenByKey);\n      }\n      if (!this.featuresCollection_) {\n        this.featureChangeKeys_ = {};\n        this.idIndex_ = {};\n        this.uidIndex_ = {};\n      }\n    } else {\n      if (this.featuresRtree_) {\n        this.featuresRtree_.forEach((feature) => {\n          this.removeFeatureInternal(feature);\n        });\n        for (const id in this.nullGeometryFeatures_) {\n          this.removeFeatureInternal(this.nullGeometryFeatures_[id]);\n        }\n      }\n    }\n    if (this.featuresCollection_) {\n      this.featuresCollection_.clear();\n    }\n\n    if (this.featuresRtree_) {\n      this.featuresRtree_.clear();\n    }\n    this.nullGeometryFeatures_ = {};\n\n    const clearEvent = new VectorSourceEvent(VectorEventType.CLEAR);\n    this.dispatchEvent(clearEvent);\n    this.changed();\n  }\n\n  /**\n   * Iterate through all features on the source, calling the provided callback\n   * with each one.  If the callback returns any \"truthy\" value, iteration will\n   * stop and the function will return the same value.\n   * Note: this function only iterate through the feature that have a defined geometry.\n   *\n   * @param {function(FeatureType): T} callback Called with each feature\n   *     on the source.  Return a truthy value to stop iteration.\n   * @return {T|undefined} The return value from the last call to the callback.\n   * @template T\n   * @api\n   */\n  forEachFeature(callback) {\n    if (this.featuresRtree_) {\n      return this.featuresRtree_.forEach(callback);\n    }\n    if (this.featuresCollection_) {\n      this.featuresCollection_.forEach(callback);\n    }\n  }\n\n  /**\n   * Iterate through all features whose geometries contain the provided\n   * coordinate, calling the callback with each feature.  If the callback returns\n   * a \"truthy\" value, iteration will stop and the function will return the same\n   * value.\n   *\n   * For {@link module:ol/render/Feature~RenderFeature} features, the callback will be\n   * called for all features.\n   *\n   * @param {import(\"../coordinate.js\").Coordinate} coordinate Coordinate.\n   * @param {function(FeatureType): T} callback Called with each feature\n   *     whose goemetry contains the provided coordinate.\n   * @return {T|undefined} The return value from the last call to the callback.\n   * @template T\n   */\n  forEachFeatureAtCoordinateDirect(coordinate, callback) {\n    const extent = [coordinate[0], coordinate[1], coordinate[0], coordinate[1]];\n    return this.forEachFeatureInExtent(extent, function (feature) {\n      const geometry = feature.getGeometry();\n      if (\n        geometry instanceof RenderFeature ||\n        geometry.intersectsCoordinate(coordinate)\n      ) {\n        return callback(feature);\n      }\n      return undefined;\n    });\n  }\n\n  /**\n   * Iterate through all features whose bounding box intersects the provided\n   * extent (note that the feature's geometry may not intersect the extent),\n   * calling the callback with each feature.  If the callback returns a \"truthy\"\n   * value, iteration will stop and the function will return the same value.\n   *\n   * If you are interested in features whose geometry intersects an extent, call\n   * the {@link module:ol/source/Vector~VectorSource#forEachFeatureIntersectingExtent #forEachFeatureIntersectingExtent()} method instead.\n   *\n   * When `useSpatialIndex` is set to false, this method will loop through all\n   * features, equivalent to {@link module:ol/source/Vector~VectorSource#forEachFeature #forEachFeature()}.\n   *\n   * @param {import(\"../extent.js\").Extent} extent Extent.\n   * @param {function(FeatureType): T} callback Called with each feature\n   *     whose bounding box intersects the provided extent.\n   * @return {T|undefined} The return value from the last call to the callback.\n   * @template T\n   * @api\n   */\n  forEachFeatureInExtent(extent, callback) {\n    if (this.featuresRtree_) {\n      return this.featuresRtree_.forEachInExtent(extent, callback);\n    }\n    if (this.featuresCollection_) {\n      this.featuresCollection_.forEach(callback);\n    }\n  }\n\n  /**\n   * Iterate through all features whose geometry intersects the provided extent,\n   * calling the callback with each feature.  If the callback returns a \"truthy\"\n   * value, iteration will stop and the function will return the same value.\n   *\n   * If you only want to test for bounding box intersection, call the\n   * {@link module:ol/source/Vector~VectorSource#forEachFeatureInExtent #forEachFeatureInExtent()} method instead.\n   *\n   * @param {import(\"../extent.js\").Extent} extent Extent.\n   * @param {function(FeatureType): T} callback Called with each feature\n   *     whose geometry intersects the provided extent.\n   * @return {T|undefined} The return value from the last call to the callback.\n   * @template T\n   * @api\n   */\n  forEachFeatureIntersectingExtent(extent, callback) {\n    return this.forEachFeatureInExtent(\n      extent,\n      /**\n       * @param {FeatureType} feature Feature.\n       * @return {T|undefined} The return value from the last call to the callback.\n       */\n      function (feature) {\n        const geometry = feature.getGeometry();\n        if (\n          geometry instanceof RenderFeature ||\n          geometry.intersectsExtent(extent)\n        ) {\n          const result = callback(feature);\n          if (result) {\n            return result;\n          }\n        }\n      },\n    );\n  }\n\n  /**\n   * Get the features collection associated with this source. Will be `null`\n   * unless the source was configured with `useSpatialIndex` set to `false`, or\n   * with a {@link module:ol/Collection~Collection} as `features`.\n   * @return {Collection<FeatureType>|null} The collection of features.\n   * @api\n   */\n  getFeaturesCollection() {\n    return this.featuresCollection_;\n  }\n\n  /**\n   * Get a snapshot of the features currently on the source in random order. The returned array\n   * is a copy, the features are references to the features in the source.\n   * @return {Array<FeatureType>} Features.\n   * @api\n   */\n  getFeatures() {\n    let features;\n    if (this.featuresCollection_) {\n      features = this.featuresCollection_.getArray().slice(0);\n    } else if (this.featuresRtree_) {\n      features = this.featuresRtree_.getAll();\n      if (!isEmpty(this.nullGeometryFeatures_)) {\n        extend(features, Object.values(this.nullGeometryFeatures_));\n      }\n    }\n    return features;\n  }\n\n  /**\n   * Get all features whose geometry intersects the provided coordinate.\n   * @param {import(\"../coordinate.js\").Coordinate} coordinate Coordinate.\n   * @return {Array<FeatureType>} Features.\n   * @api\n   */\n  getFeaturesAtCoordinate(coordinate) {\n    /** @type {Array<FeatureType>} */\n    const features = [];\n    this.forEachFeatureAtCoordinateDirect(coordinate, function (feature) {\n      features.push(feature);\n    });\n    return features;\n  }\n\n  /**\n   * Get all features whose bounding box intersects the provided extent.  Note that this returns an array of\n   * all features intersecting the given extent in random order (so it may include\n   * features whose geometries do not intersect the extent).\n   *\n   * When `useSpatialIndex` is set to false, this method will return all\n   * features.\n   *\n   * @param {import(\"../extent.js\").Extent} extent Extent.\n   * @param {import(\"../proj/Projection.js\").default} [projection] Include features\n   * where `extent` exceeds the x-axis bounds of `projection` and wraps around the world.\n   * @return {Array<FeatureType>} Features.\n   * @api\n   */\n  getFeaturesInExtent(extent, projection) {\n    if (this.featuresRtree_) {\n      const multiWorld = projection && projection.canWrapX() && this.getWrapX();\n\n      if (!multiWorld) {\n        return this.featuresRtree_.getInExtent(extent);\n      }\n\n      const extents = wrapAndSliceX(extent, projection);\n\n      return [].concat(\n        ...extents.map((anExtent) => this.featuresRtree_.getInExtent(anExtent)),\n      );\n    }\n    if (this.featuresCollection_) {\n      return this.featuresCollection_.getArray().slice(0);\n    }\n    return [];\n  }\n\n  /**\n   * Get the closest feature to the provided coordinate.\n   *\n   * This method is not available when the source is configured with\n   * `useSpatialIndex` set to `false` and the features in this source are of type\n   * {@link module:ol/Feature~Feature}.\n   * @param {import(\"../coordinate.js\").Coordinate} coordinate Coordinate.\n   * @param {function(FeatureType):boolean} [filter] Feature filter function.\n   *     The filter function will receive one argument, the {@link module:ol/Feature~Feature feature}\n   *     and it should return a boolean value. By default, no filtering is made.\n   * @return {FeatureType|null} Closest feature (or `null` if none found).\n   * @api\n   */\n  getClosestFeatureToCoordinate(coordinate, filter) {\n    // Find the closest feature using branch and bound.  We start searching an\n    // infinite extent, and find the distance from the first feature found.  This\n    // becomes the closest feature.  We then compute a smaller extent which any\n    // closer feature must intersect.  We continue searching with this smaller\n    // extent, trying to find a closer feature.  Every time we find a closer\n    // feature, we update the extent being searched so that any even closer\n    // feature must intersect it.  We continue until we run out of features.\n    const x = coordinate[0];\n    const y = coordinate[1];\n    let closestFeature = null;\n    const closestPoint = [NaN, NaN];\n    let minSquaredDistance = Infinity;\n    const extent = [-Infinity, -Infinity, Infinity, Infinity];\n    filter = filter ? filter : TRUE;\n    this.featuresRtree_.forEachInExtent(\n      extent,\n      /**\n       * @param {FeatureType} feature Feature.\n       */\n      function (feature) {\n        if (filter(feature)) {\n          const geometry = feature.getGeometry();\n          const previousMinSquaredDistance = minSquaredDistance;\n          minSquaredDistance =\n            geometry instanceof RenderFeature\n              ? 0\n              : geometry.closestPointXY(x, y, closestPoint, minSquaredDistance);\n          if (minSquaredDistance < previousMinSquaredDistance) {\n            closestFeature = feature;\n            // This is sneaky.  Reduce the extent that it is currently being\n            // searched while the R-Tree traversal using this same extent object\n            // is still in progress.  This is safe because the new extent is\n            // strictly contained by the old extent.\n            const minDistance = Math.sqrt(minSquaredDistance);\n            extent[0] = x - minDistance;\n            extent[1] = y - minDistance;\n            extent[2] = x + minDistance;\n            extent[3] = y + minDistance;\n          }\n        }\n      },\n    );\n    return closestFeature;\n  }\n\n  /**\n   * Get the extent of the features currently in the source.\n   *\n   * This method is not available when the source is configured with\n   * `useSpatialIndex` set to `false`.\n   * @param {import(\"../extent.js\").Extent} [extent] Destination extent. If provided, no new extent\n   *     will be created. Instead, that extent's coordinates will be overwritten.\n   * @return {import(\"../extent.js\").Extent} Extent.\n   * @api\n   */\n  getExtent(extent) {\n    return this.featuresRtree_.getExtent(extent);\n  }\n\n  /**\n   * Get a feature by its identifier (the value returned by feature.getId()). When `RenderFeature`s\n   * are used, `getFeatureById()` can return an array of `RenderFeature`s. This allows for handling\n   * of `GeometryCollection` geometries, where format readers create one `RenderFeature` per\n   * `GeometryCollection` member.\n   * Note that the index treats string and numeric identifiers as the same.  So\n   * `source.getFeatureById(2)` will return a feature with id `'2'` or `2`.\n   *\n   * @param {string|number} id Feature identifier.\n   * @return {FeatureClassOrArrayOfRenderFeatures<FeatureType>|null} The feature (or `null` if not found).\n   * @api\n   */\n  getFeatureById(id) {\n    const feature = this.idIndex_[id.toString()];\n    return feature !== undefined\n      ? /** @type {FeatureClassOrArrayOfRenderFeatures<FeatureType>} */ (\n          feature\n        )\n      : null;\n  }\n\n  /**\n   * Get a feature by its internal unique identifier (using `getUid`).\n   *\n   * @param {string} uid Feature identifier.\n   * @return {FeatureType|null} The feature (or `null` if not found).\n   */\n  getFeatureByUid(uid) {\n    const feature = this.uidIndex_[uid];\n    return feature !== undefined ? feature : null;\n  }\n\n  /**\n   * Get the format associated with this source.\n   *\n   * @return {import(\"../format/Feature.js\").default<FeatureType>|null}} The feature format.\n   * @api\n   */\n  getFormat() {\n    return this.format_;\n  }\n\n  /**\n   * @return {boolean} The source can have overlapping geometries.\n   */\n  getOverlaps() {\n    return this.overlaps_;\n  }\n\n  /**\n   * Get the url associated with this source.\n   *\n   * @return {string|import(\"../featureloader.js\").FeatureUrlFunction|undefined} The url.\n   * @api\n   */\n  getUrl() {\n    return this.url_;\n  }\n\n  /**\n   * @param {Event} event Event.\n   * @private\n   */\n  handleFeatureChange_(event) {\n    const feature = /** @type {FeatureType} */ (event.target);\n    const featureKey = getUid(feature);\n    const geometry = feature.getGeometry();\n    if (!geometry) {\n      if (!(featureKey in this.nullGeometryFeatures_)) {\n        if (this.featuresRtree_) {\n          this.featuresRtree_.remove(feature);\n        }\n        this.nullGeometryFeatures_[featureKey] = feature;\n      }\n    } else {\n      const extent = geometry.getExtent();\n      if (featureKey in this.nullGeometryFeatures_) {\n        delete this.nullGeometryFeatures_[featureKey];\n        if (this.featuresRtree_) {\n          this.featuresRtree_.insert(extent, feature);\n        }\n      } else {\n        if (this.featuresRtree_) {\n          this.featuresRtree_.update(extent, feature);\n        }\n      }\n    }\n    const id = feature.getId();\n    if (id !== undefined) {\n      const sid = id.toString();\n      if (this.idIndex_[sid] !== feature) {\n        this.removeFromIdIndex_(feature);\n        this.idIndex_[sid] = feature;\n      }\n    } else {\n      this.removeFromIdIndex_(feature);\n      this.uidIndex_[featureKey] = feature;\n    }\n    this.changed();\n    this.dispatchEvent(\n      new VectorSourceEvent(VectorEventType.CHANGEFEATURE, feature),\n    );\n  }\n\n  /**\n   * Returns true if the feature is contained within the source.\n   * @param {FeatureType} feature Feature.\n   * @return {boolean} Has feature.\n   * @api\n   */\n  hasFeature(feature) {\n    const id = feature.getId();\n    if (id !== undefined) {\n      return id in this.idIndex_;\n    }\n    return getUid(feature) in this.uidIndex_;\n  }\n\n  /**\n   * @return {boolean} Is empty.\n   */\n  isEmpty() {\n    if (this.featuresRtree_) {\n      return (\n        this.featuresRtree_.isEmpty() && isEmpty(this.nullGeometryFeatures_)\n      );\n    }\n    if (this.featuresCollection_) {\n      return this.featuresCollection_.getLength() === 0;\n    }\n    return true;\n  }\n\n  /**\n   * @param {import(\"../extent.js\").Extent} extent Extent.\n   * @param {number} resolution Resolution.\n   * @param {import(\"../proj/Projection.js\").default} projection Projection.\n   */\n  loadFeatures(extent, resolution, projection) {\n    const loadedExtentsRtree = this.loadedExtentsRtree_;\n    const extentsToLoad = this.strategy_(extent, resolution, projection);\n    for (let i = 0, ii = extentsToLoad.length; i < ii; ++i) {\n      const extentToLoad = extentsToLoad[i];\n      const alreadyLoaded = loadedExtentsRtree.forEachInExtent(\n        extentToLoad,\n        /**\n         * @param {{extent: import(\"../extent.js\").Extent}} object Object.\n         * @return {boolean} Contains.\n         */\n        function (object) {\n          return containsExtent(object.extent, extentToLoad);\n        },\n      );\n      if (!alreadyLoaded) {\n        ++this.loadingExtentsCount_;\n        this.dispatchEvent(\n          new VectorSourceEvent(VectorEventType.FEATURESLOADSTART),\n        );\n        this.loader_.call(\n          this,\n          extentToLoad,\n          resolution,\n          projection,\n          /**\n           * @param {Array<FeatureType>} features Loaded features\n           */\n          (features) => {\n            --this.loadingExtentsCount_;\n            this.dispatchEvent(\n              new VectorSourceEvent(\n                VectorEventType.FEATURESLOADEND,\n                undefined,\n                features,\n              ),\n            );\n          },\n          () => {\n            --this.loadingExtentsCount_;\n            this.dispatchEvent(\n              new VectorSourceEvent(VectorEventType.FEATURESLOADERROR),\n            );\n          },\n        );\n        loadedExtentsRtree.insert(extentToLoad, {extent: extentToLoad.slice()});\n      }\n    }\n    this.loading =\n      this.loader_.length < 4 ? false : this.loadingExtentsCount_ > 0;\n  }\n\n  /**\n   * @override\n   */\n  refresh() {\n    this.clear(true);\n    this.loadedExtentsRtree_.clear();\n    super.refresh();\n  }\n\n  /**\n   * Remove an extent from the list of loaded extents.\n   * @param {import(\"../extent.js\").Extent} extent Extent.\n   * @api\n   */\n  removeLoadedExtent(extent) {\n    const loadedExtentsRtree = this.loadedExtentsRtree_;\n    const obj = loadedExtentsRtree.forEachInExtent(extent, function (object) {\n      if (equals(object.extent, extent)) {\n        return object;\n      }\n    });\n    if (obj) {\n      loadedExtentsRtree.remove(obj);\n    }\n  }\n\n  /**\n   * Batch remove features from the source.  If you want to remove all features\n   * at once, use the {@link module:ol/source/Vector~VectorSource#clear #clear()} method\n   * instead.\n   * @param {Array<FeatureType>} features Features to remove.\n   * @api\n   */\n  removeFeatures(features) {\n    let removed = false;\n    for (let i = 0, ii = features.length; i < ii; ++i) {\n      removed = this.removeFeatureInternal(features[i]) || removed;\n    }\n    if (removed) {\n      this.changed();\n    }\n  }\n\n  /**\n   * Remove a single feature from the source. If you want to batch remove\n   * features, use the {@link module:ol/source/Vector~VectorSource#removeFeatures #removeFeatures()} method\n   * instead.\n   * @param {FeatureType} feature Feature to remove.\n   * @api\n   */\n  removeFeature(feature) {\n    if (!feature) {\n      return;\n    }\n    const removed = this.removeFeatureInternal(feature);\n    if (removed) {\n      this.changed();\n    }\n  }\n\n  /**\n   * Remove feature without firing a `change` event.\n   * @param {FeatureType} feature Feature.\n   * @return {boolean} True if the feature was removed, false if it was not found.\n   * @protected\n   */\n  removeFeatureInternal(feature) {\n    const featureKey = getUid(feature);\n    if (!(featureKey in this.uidIndex_)) {\n      return false;\n    }\n\n    if (featureKey in this.nullGeometryFeatures_) {\n      delete this.nullGeometryFeatures_[featureKey];\n    } else {\n      if (this.featuresRtree_) {\n        this.featuresRtree_.remove(feature);\n      }\n    }\n\n    const featureChangeKeys = this.featureChangeKeys_[featureKey];\n    featureChangeKeys?.forEach(unlistenByKey);\n    delete this.featureChangeKeys_[featureKey];\n\n    const id = feature.getId();\n    if (id !== undefined) {\n      const idString = id.toString();\n      const indexedFeature = this.idIndex_[idString];\n      if (indexedFeature === feature) {\n        delete this.idIndex_[idString];\n      } else if (Array.isArray(indexedFeature)) {\n        indexedFeature.splice(indexedFeature.indexOf(feature), 1);\n        if (indexedFeature.length === 1) {\n          this.idIndex_[idString] = indexedFeature[0];\n        }\n      }\n    }\n    delete this.uidIndex_[featureKey];\n    if (this.hasListener(VectorEventType.REMOVEFEATURE)) {\n      this.dispatchEvent(\n        new VectorSourceEvent(VectorEventType.REMOVEFEATURE, feature),\n      );\n    }\n    return true;\n  }\n\n  /**\n   * Remove a feature from the id index.  Called internally when the feature id\n   * may have changed.\n   * @param {FeatureType} feature The feature.\n   * @private\n   */\n  removeFromIdIndex_(feature) {\n    for (const id in this.idIndex_) {\n      if (this.idIndex_[id] === feature) {\n        delete this.idIndex_[id];\n        break;\n      }\n    }\n  }\n\n  /**\n   * Set the new loader of the source. The next render cycle will use the\n   * new loader.\n   * @param {import(\"../featureloader.js\").FeatureLoader} loader The loader to set.\n   * @api\n   */\n  setLoader(loader) {\n    this.loader_ = loader;\n  }\n\n  /**\n   * Points the source to a new url. The next render cycle will use the new url.\n   * @param {string|import(\"../featureloader.js\").FeatureUrlFunction} url Url.\n   * @api\n   */\n  setUrl(url) {\n    assert(this.format_, '`format` must be set when `url` is set');\n    this.url_ = url;\n    this.setLoader(xhr(url, this.format_));\n  }\n\n  /**\n   * @param {boolean} overlaps The source can have overlapping geometries.\n   */\n  setOverlaps(overlaps) {\n    this.overlaps_ = overlaps;\n    this.changed();\n  }\n}\n\nexport default VectorSource;\n","/**\n * @module ol/interaction/Modify\n */\nimport Collection from '../Collection.js';\nimport CollectionEventType from '../CollectionEventType.js';\nimport Feature from '../Feature.js';\nimport MapBrowserEventType from '../MapBrowserEventType.js';\nimport {equals} from '../array.js';\nimport {\n  closestOnSegment,\n  distance as coordinateDistance,\n  equals as coordinatesEqual,\n  squaredDistance as squaredCoordinateDistance,\n  squaredDistanceToSegment,\n} from '../coordinate.js';\nimport Event from '../events/Event.js';\nimport EventType from '../events/EventType.js';\nimport {\n  altKeyOnly,\n  always,\n  primaryAction,\n  singleClick,\n} from '../events/condition.js';\nimport {\n  boundingExtent,\n  buffer as bufferExtent,\n  createOrUpdateFromCoordinate as createExtent,\n} from '../extent.js';\nimport Point from '../geom/Point.js';\nimport {fromCircle} from '../geom/Polygon.js';\nimport VectorLayer from '../layer/Vector.js';\nimport {\n  fromUserCoordinate,\n  fromUserExtent,\n  getUserProjection,\n  toUserCoordinate,\n  toUserExtent,\n} from '../proj.js';\nimport VectorSource from '../source/Vector.js';\nimport VectorEventType from '../source/VectorEventType.js';\nimport RBush from '../structs/RBush.js';\nimport {createEditingStyle} from '../style/Style.js';\nimport {getUid} from '../util.js';\nimport PointerInteraction from './Pointer.js';\n\n/**\n * The segment index assigned to a circle's center when\n * breaking up a circle into ModifySegmentDataType segments.\n * @type {number}\n */\nconst CIRCLE_CENTER_INDEX = 0;\n\n/**\n * The segment index assigned to a circle's circumference when\n * breaking up a circle into ModifySegmentDataType segments.\n * @type {number}\n */\nconst CIRCLE_CIRCUMFERENCE_INDEX = 1;\n\nconst tempExtent = [0, 0, 0, 0];\nconst tempSegment = [];\n\n/**\n * @enum {string}\n */\nconst ModifyEventType = {\n  /**\n   * Triggered upon feature modification start\n   * @event ModifyEvent#modifystart\n   * @api\n   */\n  MODIFYSTART: 'modifystart',\n  /**\n   * Triggered upon feature modification end\n   * @event ModifyEvent#modifyend\n   * @api\n   */\n  MODIFYEND: 'modifyend',\n};\n\n/**\n * @typedef {Object} SegmentData\n * @property {Array<number>} [depth] Depth.\n * @property {Feature} feature Feature.\n * @property {import(\"../geom/SimpleGeometry.js\").default} geometry Geometry.\n * @property {number} [index] Index.\n * @property {Array<Array<number>>} segment Segment.\n * @property {Array<SegmentData>} [featureSegments] FeatureSegments.\n */\n\n/**\n * @typedef {[SegmentData, number]} DragSegment\n */\n\n/**\n * @typedef {Object} Options\n * @property {import(\"../events/condition.js\").Condition} [condition] A function that\n * takes a {@link module:ol/MapBrowserEvent~MapBrowserEvent} and returns a\n * boolean to indicate whether that event will be considered to add or move a\n * vertex to the sketch. Default is\n * {@link module:ol/events/condition.primaryAction}.\n * @property {import(\"../events/condition.js\").Condition} [deleteCondition] A function\n * that takes a {@link module:ol/MapBrowserEvent~MapBrowserEvent} and returns a\n * boolean to indicate whether that event should be handled. By default,\n * {@link module:ol/events/condition.singleClick} with\n * {@link module:ol/events/condition.altKeyOnly} results in a vertex deletion.\n * @property {import(\"../events/condition.js\").Condition} [insertVertexCondition] A\n * function that takes a {@link module:ol/MapBrowserEvent~MapBrowserEvent} and\n * returns a boolean to indicate whether a new vertex should be added to the sketch\n * features. Default is {@link module:ol/events/condition.always}.\n * @property {number} [pixelTolerance=10] Pixel tolerance for considering the\n * pointer close enough to a segment or vertex for editing.\n * @property {import(\"../style/Style.js\").StyleLike|import(\"../style/flat.js\").FlatStyleLike} [style]\n * Style used for the modification point or vertex. For linestrings and polygons, this will\n * be the affected vertex, for circles a point along the circle, and for points the actual\n * point. If not configured, the default edit style is used (see {@link module:ol/style/Style~Style}).\n * When using a style function, the point feature passed to the function will have an `existing` property -\n * indicating whether there is an existing vertex underneath or not, a `features`\n * property - an array whose entries are the features that are being modified, and a `geometries`\n * property - an array whose entries are the geometries that are being modified. Both arrays are\n * in the same order. The `geometries` are only useful when modifying geometry collections, where\n * the geometry will be the particular geometry from the collection that is being modified.\n * @property {VectorSource} [source] The vector source with\n * features to modify.  If a vector source is not provided, a feature collection\n * must be provided with the `features` option.\n * @property {boolean|import(\"../layer/BaseVector\").default} [hitDetection] When configured, point\n * features will be considered for modification based on their visual appearance, instead of being within\n * the `pixelTolerance` from the pointer location. When a {@link module:ol/layer/BaseVector~BaseVectorLayer} is\n * provided, only the rendered representation of the features on that layer will be considered.\n * @property {Collection<Feature>} [features]\n * The features the interaction works on.  If a feature collection is not\n * provided, a vector source must be provided with the `source` option.\n * @property {boolean} [wrapX=false] Wrap the world horizontally on the sketch\n * overlay.\n * @property {boolean} [snapToPointer=!hitDetection] The vertex, point or segment being modified snaps to the\n * pointer coordinate when clicked within the `pixelTolerance`.\n */\n\n/**\n * @classdesc\n * Events emitted by {@link module:ol/interaction/Modify~Modify} instances are\n * instances of this type.\n */\nexport class ModifyEvent extends Event {\n  /**\n   * @param {ModifyEventType} type Type.\n   * @param {Collection<Feature>} features\n   * The features modified.\n   * @param {import(\"../MapBrowserEvent.js\").default} mapBrowserEvent\n   * Associated {@link module:ol/MapBrowserEvent~MapBrowserEvent}.\n   */\n  constructor(type, features, mapBrowserEvent) {\n    super(type);\n\n    /**\n     * The features being modified.\n     * @type {Collection<Feature>}\n     * @api\n     */\n    this.features = features;\n\n    /**\n     * Associated {@link module:ol/MapBrowserEvent~MapBrowserEvent}.\n     * @type {import(\"../MapBrowserEvent.js\").default}\n     * @api\n     */\n    this.mapBrowserEvent = mapBrowserEvent;\n  }\n}\n\n/***\n * @template Return\n * @typedef {import(\"../Observable\").OnSignature<import(\"../Observable\").EventTypes, import(\"../events/Event.js\").default, Return> &\n *   import(\"../Observable\").OnSignature<import(\"../ObjectEventType\").Types|\n *     'change:active', import(\"../Object\").ObjectEvent, Return> &\n *   import(\"../Observable\").OnSignature<'modifyend'|'modifystart', ModifyEvent, Return> &\n *   import(\"../Observable\").CombinedOnSignature<import(\"../Observable\").EventTypes|import(\"../ObjectEventType\").Types|\n *     'change:active'|'modifyend'|'modifystart', Return>} ModifyOnSignature\n */\n\n/**\n * @classdesc\n * Interaction for modifying feature geometries.  To modify features that have\n * been added to an existing source, construct the modify interaction with the\n * `source` option.  If you want to modify features in a collection (for example,\n * the collection used by a select interaction), construct the interaction with\n * the `features` option.  The interaction must be constructed with either a\n * `source` or `features` option.\n *\n * Cartesian distance from the pointer is used to determine the features that\n * will be modified. This means that geometries will only be considered for\n * modification when they are within the configured `pixelTolerance`. For point\n * geometries, the `hitDetection` option can be used to match their visual\n * appearance.\n *\n * By default, the interaction will allow deletion of vertices when the `alt`\n * key is pressed.  To configure the interaction with a different condition\n * for deletion, use the `deleteCondition` option.\n * @fires ModifyEvent\n * @api\n */\nclass Modify extends PointerInteraction {\n  /**\n   * @param {Options} options Options.\n   */\n  constructor(options) {\n    super(/** @type {import(\"./Pointer.js\").Options} */ (options));\n\n    /***\n     * @type {ModifyOnSignature<import(\"../events\").EventsKey>}\n     */\n    this.on;\n\n    /***\n     * @type {ModifyOnSignature<import(\"../events\").EventsKey>}\n     */\n    this.once;\n\n    /***\n     * @type {ModifyOnSignature<void>}\n     */\n    this.un;\n\n    /** @private */\n    this.boundHandleFeatureChange_ = this.handleFeatureChange_.bind(this);\n\n    /**\n     * @private\n     * @type {import(\"../events/condition.js\").Condition}\n     */\n    this.condition_ = options.condition ? options.condition : primaryAction;\n\n    /**\n     * @private\n     * @param {import(\"../MapBrowserEvent.js\").default} mapBrowserEvent Browser event.\n     * @return {boolean} Combined condition result.\n     */\n    this.defaultDeleteCondition_ = function (mapBrowserEvent) {\n      return altKeyOnly(mapBrowserEvent) && singleClick(mapBrowserEvent);\n    };\n\n    /**\n     * @type {import(\"../events/condition.js\").Condition}\n     * @private\n     */\n    this.deleteCondition_ = options.deleteCondition\n      ? options.deleteCondition\n      : this.defaultDeleteCondition_;\n\n    /**\n     * @type {import(\"../events/condition.js\").Condition}\n     * @private\n     */\n    this.insertVertexCondition_ = options.insertVertexCondition\n      ? options.insertVertexCondition\n      : always;\n\n    /**\n     * Editing vertex.\n     * @type {Feature<Point>}\n     * @private\n     */\n    this.vertexFeature_ = null;\n\n    /**\n     * Segments intersecting {@link this.vertexFeature_} by segment uid.\n     * @type {Object<string, boolean>}\n     * @private\n     */\n    this.vertexSegments_ = null;\n\n    /**\n     * @type {import(\"../pixel.js\").Pixel}\n     * @private\n     */\n    this.lastPixel_ = [0, 0];\n\n    /**\n     * Tracks if the next `singleclick` event should be ignored to prevent\n     * accidental deletion right after vertex creation.\n     * @type {boolean}\n     * @private\n     */\n    this.ignoreNextSingleClick_ = false;\n\n    /**\n     * @type {Collection<Feature>}\n     * @private\n     */\n    this.featuresBeingModified_ = null;\n\n    /**\n     * Segment RTree for each layer\n     * @type {RBush<SegmentData>}\n     * @private\n     */\n    this.rBush_ = new RBush();\n\n    /**\n     * @type {number}\n     * @private\n     */\n    this.pixelTolerance_ =\n      options.pixelTolerance !== undefined ? options.pixelTolerance : 10;\n\n    /**\n     * @type {boolean}\n     * @private\n     */\n    this.snappedToVertex_ = false;\n\n    /**\n     * Indicate whether the interaction is currently changing a feature's\n     * coordinates.\n     * @type {boolean}\n     * @private\n     */\n    this.changingFeature_ = false;\n\n    /**\n     * @type {Array<DragSegment>}\n     * @private\n     */\n    this.dragSegments_ = [];\n\n    /**\n     * Draw overlay where sketch features are drawn.\n     * @type {VectorLayer}\n     * @private\n     */\n    this.overlay_ = new VectorLayer({\n      source: new VectorSource({\n        useSpatialIndex: false,\n        wrapX: !!options.wrapX,\n      }),\n      style: options.style ? options.style : getDefaultStyleFunction(),\n      updateWhileAnimating: true,\n      updateWhileInteracting: true,\n    });\n\n    /**\n     * @const\n     * @private\n     * @type {!Object<string, function(Feature, import(\"../geom/Geometry.js\").default): void>}\n     */\n    this.SEGMENT_WRITERS_ = {\n      'Point': this.writePointGeometry_.bind(this),\n      'LineString': this.writeLineStringGeometry_.bind(this),\n      'LinearRing': this.writeLineStringGeometry_.bind(this),\n      'Polygon': this.writePolygonGeometry_.bind(this),\n      'MultiPoint': this.writeMultiPointGeometry_.bind(this),\n      'MultiLineString': this.writeMultiLineStringGeometry_.bind(this),\n      'MultiPolygon': this.writeMultiPolygonGeometry_.bind(this),\n      'Circle': this.writeCircleGeometry_.bind(this),\n      'GeometryCollection': this.writeGeometryCollectionGeometry_.bind(this),\n    };\n\n    /**\n     * @type {VectorSource}\n     * @private\n     */\n    this.source_ = null;\n\n    /**\n     * @type {boolean|import(\"../layer/BaseVector\").default}\n     * @private\n     */\n    this.hitDetection_ = null;\n\n    /** @type {Collection<Feature>} */\n    let features;\n    if (options.features) {\n      features = options.features;\n    } else if (options.source) {\n      this.source_ = options.source;\n      features = new Collection(this.source_.getFeatures());\n      this.source_.addEventListener(\n        VectorEventType.ADDFEATURE,\n        this.handleSourceAdd_.bind(this),\n      );\n      this.source_.addEventListener(\n        VectorEventType.REMOVEFEATURE,\n        this.handleSourceRemove_.bind(this),\n      );\n    }\n    if (!features) {\n      throw new Error(\n        'The modify interaction requires features, a source or a layer',\n      );\n    }\n    if (options.hitDetection) {\n      this.hitDetection_ = options.hitDetection;\n    }\n\n    /**\n     * @type {Collection<Feature>}\n     * @private\n     */\n    this.features_ = features;\n\n    this.features_.forEach(this.addFeature_.bind(this));\n    this.features_.addEventListener(\n      CollectionEventType.ADD,\n      this.handleFeatureAdd_.bind(this),\n    );\n    this.features_.addEventListener(\n      CollectionEventType.REMOVE,\n      this.handleFeatureRemove_.bind(this),\n    );\n\n    /**\n     * @type {import(\"../MapBrowserEvent.js\").default}\n     * @private\n     */\n    this.lastPointerEvent_ = null;\n\n    /**\n     * Delta (x, y in map units) between matched rtree vertex and pointer vertex.\n     * @type {Array<number>}\n     * @private\n     */\n    this.delta_ = [0, 0];\n\n    /**\n     * @private\n     */\n    this.snapToPointer_ =\n      options.snapToPointer === undefined\n        ? !this.hitDetection_\n        : options.snapToPointer;\n  }\n\n  /**\n   * @param {Feature} feature Feature.\n   * @private\n   */\n  addFeature_(feature) {\n    const geometry = feature.getGeometry();\n    if (geometry) {\n      const writer = this.SEGMENT_WRITERS_[geometry.getType()];\n      if (writer) {\n        writer(feature, geometry);\n      }\n    }\n    const map = this.getMap();\n    if (map && map.isRendered() && this.getActive()) {\n      this.handlePointerAtPixel_(map.getCoordinateFromPixel(this.lastPixel_));\n    }\n    feature.addEventListener(EventType.CHANGE, this.boundHandleFeatureChange_);\n  }\n\n  /**\n   * @param {import(\"../MapBrowserEvent.js\").default} evt Map browser event.\n   * @param {Array<SegmentData>} segments The segments subject to modification.\n   * @private\n   */\n  willModifyFeatures_(evt, segments) {\n    if (!this.featuresBeingModified_) {\n      this.featuresBeingModified_ = new Collection();\n      const features = this.featuresBeingModified_.getArray();\n      for (let i = 0, ii = segments.length; i < ii; ++i) {\n        const feature = segments[i].feature;\n        if (feature && !features.includes(feature)) {\n          this.featuresBeingModified_.push(feature);\n        }\n      }\n      if (this.featuresBeingModified_.getLength() === 0) {\n        this.featuresBeingModified_ = null;\n      } else {\n        this.dispatchEvent(\n          new ModifyEvent(\n            ModifyEventType.MODIFYSTART,\n            this.featuresBeingModified_,\n            evt,\n          ),\n        );\n      }\n    }\n  }\n\n  /**\n   * @param {Feature} feature Feature.\n   * @private\n   */\n  removeFeature_(feature) {\n    this.removeFeatureSegmentData_(feature);\n    // Remove the vertex feature if the collection of candidate features is empty.\n    if (this.vertexFeature_ && this.features_.getLength() === 0) {\n      this.overlay_.getSource().removeFeature(this.vertexFeature_);\n      this.vertexFeature_ = null;\n    }\n    feature.removeEventListener(\n      EventType.CHANGE,\n      this.boundHandleFeatureChange_,\n    );\n  }\n\n  /**\n   * @param {Feature} feature Feature.\n   * @private\n   */\n  removeFeatureSegmentData_(feature) {\n    const rBush = this.rBush_;\n    /** @type {Array<SegmentData>} */\n    const nodesToRemove = [];\n    rBush.forEach(\n      /**\n       * @param {SegmentData} node RTree node.\n       */\n      function (node) {\n        if (feature === node.feature) {\n          nodesToRemove.push(node);\n        }\n      },\n    );\n    for (let i = nodesToRemove.length - 1; i >= 0; --i) {\n      const nodeToRemove = nodesToRemove[i];\n      for (let j = this.dragSegments_.length - 1; j >= 0; --j) {\n        if (this.dragSegments_[j][0] === nodeToRemove) {\n          this.dragSegments_.splice(j, 1);\n        }\n      }\n      rBush.remove(nodeToRemove);\n    }\n  }\n\n  /**\n   * Activate or deactivate the interaction.\n   * @param {boolean} active Active.\n   * @observable\n   * @api\n   * @override\n   */\n  setActive(active) {\n    if (this.vertexFeature_ && !active) {\n      this.overlay_.getSource().removeFeature(this.vertexFeature_);\n      this.vertexFeature_ = null;\n    }\n    super.setActive(active);\n  }\n\n  /**\n   * Remove the interaction from its current map and attach it to the new map.\n   * Subclasses may set up event handlers to get notified about changes to\n   * the map here.\n   * @param {import(\"../Map.js\").default} map Map.\n   * @override\n   */\n  setMap(map) {\n    this.overlay_.setMap(map);\n    super.setMap(map);\n  }\n\n  /**\n   * Get the overlay layer that this interaction renders the modification point or vertex to.\n   * @return {VectorLayer} Overlay layer.\n   * @api\n   */\n  getOverlay() {\n    return this.overlay_;\n  }\n\n  /**\n   * @param {import(\"../source/Vector.js\").VectorSourceEvent} event Event.\n   * @private\n   */\n  handleSourceAdd_(event) {\n    if (event.feature) {\n      this.features_.push(event.feature);\n    }\n  }\n\n  /**\n   * @param {import(\"../source/Vector.js\").VectorSourceEvent} event Event.\n   * @private\n   */\n  handleSourceRemove_(event) {\n    if (event.feature) {\n      this.features_.remove(event.feature);\n    }\n  }\n\n  /**\n   * @param {import(\"../Collection.js\").CollectionEvent<Feature>} evt Event.\n   * @private\n   */\n  handleFeatureAdd_(evt) {\n    this.addFeature_(evt.element);\n  }\n\n  /**\n   * @param {import(\"../events/Event.js\").default} evt Event.\n   * @private\n   */\n  handleFeatureChange_(evt) {\n    if (!this.changingFeature_) {\n      const feature = /** @type {Feature} */ (evt.target);\n      this.removeFeature_(feature);\n      this.addFeature_(feature);\n    }\n  }\n\n  /**\n   * @param {import(\"../Collection.js\").CollectionEvent<Feature>} evt Event.\n   * @private\n   */\n  handleFeatureRemove_(evt) {\n    this.removeFeature_(evt.element);\n  }\n\n  /**\n   * @param {Feature} feature Feature\n   * @param {Point} geometry Geometry.\n   * @private\n   */\n  writePointGeometry_(feature, geometry) {\n    const coordinates = geometry.getCoordinates();\n\n    /** @type {SegmentData} */\n    const segmentData = {\n      feature: feature,\n      geometry: geometry,\n      segment: [coordinates, coordinates],\n    };\n\n    this.rBush_.insert(geometry.getExtent(), segmentData);\n  }\n\n  /**\n   * @param {Feature} feature Feature\n   * @param {import(\"../geom/MultiPoint.js\").default} geometry Geometry.\n   * @private\n   */\n  writeMultiPointGeometry_(feature, geometry) {\n    const points = geometry.getCoordinates();\n    for (let i = 0, ii = points.length; i < ii; ++i) {\n      const coordinates = points[i];\n\n      /** @type {SegmentData} */\n      const segmentData = {\n        feature: feature,\n        geometry: geometry,\n        depth: [i],\n        index: i,\n        segment: [coordinates, coordinates],\n      };\n\n      this.rBush_.insert(geometry.getExtent(), segmentData);\n    }\n  }\n\n  /**\n   * @param {Feature} feature Feature\n   * @param {import(\"../geom/LineString.js\").default} geometry Geometry.\n   * @private\n   */\n  writeLineStringGeometry_(feature, geometry) {\n    const coordinates = geometry.getCoordinates();\n    for (let i = 0, ii = coordinates.length - 1; i < ii; ++i) {\n      const segment = coordinates.slice(i, i + 2);\n\n      /** @type {SegmentData} */\n      const segmentData = {\n        feature: feature,\n        geometry: geometry,\n        index: i,\n        segment: segment,\n      };\n\n      this.rBush_.insert(boundingExtent(segment), segmentData);\n    }\n  }\n\n  /**\n   * @param {Feature} feature Feature\n   * @param {import(\"../geom/MultiLineString.js\").default} geometry Geometry.\n   * @private\n   */\n  writeMultiLineStringGeometry_(feature, geometry) {\n    const lines = geometry.getCoordinates();\n    for (let j = 0, jj = lines.length; j < jj; ++j) {\n      const coordinates = lines[j];\n      for (let i = 0, ii = coordinates.length - 1; i < ii; ++i) {\n        const segment = coordinates.slice(i, i + 2);\n\n        /** @type {SegmentData} */\n        const segmentData = {\n          feature: feature,\n          geometry: geometry,\n          depth: [j],\n          index: i,\n          segment: segment,\n        };\n\n        this.rBush_.insert(boundingExtent(segment), segmentData);\n      }\n    }\n  }\n\n  /**\n   * @param {Feature} feature Feature\n   * @param {import(\"../geom/Polygon.js\").default} geometry Geometry.\n   * @private\n   */\n  writePolygonGeometry_(feature, geometry) {\n    const rings = geometry.getCoordinates();\n    for (let j = 0, jj = rings.length; j < jj; ++j) {\n      const coordinates = rings[j];\n      for (let i = 0, ii = coordinates.length - 1; i < ii; ++i) {\n        const segment = coordinates.slice(i, i + 2);\n\n        /** @type {SegmentData} */\n        const segmentData = {\n          feature: feature,\n          geometry: geometry,\n          depth: [j],\n          index: i,\n          segment: segment,\n        };\n\n        this.rBush_.insert(boundingExtent(segment), segmentData);\n      }\n    }\n  }\n\n  /**\n   * @param {Feature} feature Feature\n   * @param {import(\"../geom/MultiPolygon.js\").default} geometry Geometry.\n   * @private\n   */\n  writeMultiPolygonGeometry_(feature, geometry) {\n    const polygons = geometry.getCoordinates();\n    for (let k = 0, kk = polygons.length; k < kk; ++k) {\n      const rings = polygons[k];\n      for (let j = 0, jj = rings.length; j < jj; ++j) {\n        const coordinates = rings[j];\n        for (let i = 0, ii = coordinates.length - 1; i < ii; ++i) {\n          const segment = coordinates.slice(i, i + 2);\n\n          /** @type {SegmentData} */\n          const segmentData = {\n            feature: feature,\n            geometry: geometry,\n            depth: [j, k],\n            index: i,\n            segment: segment,\n          };\n\n          this.rBush_.insert(boundingExtent(segment), segmentData);\n        }\n      }\n    }\n  }\n\n  /**\n   * We convert a circle into two segments.  The segment at index\n   * {@link CIRCLE_CENTER_INDEX} is the\n   * circle's center (a point).  The segment at index\n   * {@link CIRCLE_CIRCUMFERENCE_INDEX} is\n   * the circumference, and is not a line segment.\n   *\n   * @param {Feature} feature Feature.\n   * @param {import(\"../geom/Circle.js\").default} geometry Geometry.\n   * @private\n   */\n  writeCircleGeometry_(feature, geometry) {\n    const coordinates = geometry.getCenter();\n\n    /** @type {SegmentData} */\n    const centerSegmentData = {\n      feature: feature,\n      geometry: geometry,\n      index: CIRCLE_CENTER_INDEX,\n      segment: [coordinates, coordinates],\n    };\n\n    /** @type {SegmentData} */\n    const circumferenceSegmentData = {\n      feature: feature,\n      geometry: geometry,\n      index: CIRCLE_CIRCUMFERENCE_INDEX,\n      segment: [coordinates, coordinates],\n    };\n\n    const featureSegments = [centerSegmentData, circumferenceSegmentData];\n    centerSegmentData.featureSegments = featureSegments;\n    circumferenceSegmentData.featureSegments = featureSegments;\n    this.rBush_.insert(createExtent(coordinates), centerSegmentData);\n    let circleGeometry = /** @type {import(\"../geom/Geometry.js\").default} */ (\n      geometry\n    );\n    const userProjection = getUserProjection();\n    if (userProjection && this.getMap()) {\n      const projection = this.getMap().getView().getProjection();\n      circleGeometry = circleGeometry\n        .clone()\n        .transform(userProjection, projection);\n      circleGeometry = fromCircle(\n        /** @type {import(\"../geom/Circle.js\").default} */ (circleGeometry),\n      ).transform(projection, userProjection);\n    }\n    this.rBush_.insert(circleGeometry.getExtent(), circumferenceSegmentData);\n  }\n\n  /**\n   * @param {Feature} feature Feature\n   * @param {import(\"../geom/GeometryCollection.js\").default} geometry Geometry.\n   * @private\n   */\n  writeGeometryCollectionGeometry_(feature, geometry) {\n    const geometries = geometry.getGeometriesArray();\n    for (let i = 0; i < geometries.length; ++i) {\n      const geometry = geometries[i];\n      const writer = this.SEGMENT_WRITERS_[geometry.getType()];\n      writer(feature, geometry);\n    }\n  }\n\n  /**\n   * @param {import(\"../coordinate.js\").Coordinate} coordinates Coordinates.\n   * @param {Array<Feature>} features The features being modified.\n   * @param {Array<import(\"../geom/SimpleGeometry.js\").default>} geometries The geometries being modified.\n   * @param {boolean} existing The vertex represents an existing vertex.\n   * @return {Feature} Vertex feature.\n   * @private\n   */\n  createOrUpdateVertexFeature_(coordinates, features, geometries, existing) {\n    let vertexFeature = this.vertexFeature_;\n    if (!vertexFeature) {\n      vertexFeature = new Feature(new Point(coordinates));\n      this.vertexFeature_ = vertexFeature;\n      this.overlay_.getSource().addFeature(vertexFeature);\n    } else {\n      const geometry = vertexFeature.getGeometry();\n      geometry.setCoordinates(coordinates);\n    }\n    vertexFeature.set('features', features);\n    vertexFeature.set('geometries', geometries);\n    vertexFeature.set('existing', existing);\n    return vertexFeature;\n  }\n\n  /**\n   * Handles the {@link module:ol/MapBrowserEvent~MapBrowserEvent map browser event} and may modify the geometry.\n   * @param {import(\"../MapBrowserEvent.js\").default} mapBrowserEvent Map browser event.\n   * @return {boolean} `false` to stop event propagation.\n   * @override\n   */\n  handleEvent(mapBrowserEvent) {\n    if (!mapBrowserEvent.originalEvent) {\n      return true;\n    }\n    this.lastPointerEvent_ = mapBrowserEvent;\n\n    let handled;\n    if (\n      !mapBrowserEvent.map.getView().getInteracting() &&\n      mapBrowserEvent.type == MapBrowserEventType.POINTERMOVE &&\n      !this.handlingDownUpSequence\n    ) {\n      this.handlePointerMove_(mapBrowserEvent);\n    }\n    if (this.vertexFeature_ && this.deleteCondition_(mapBrowserEvent)) {\n      if (\n        mapBrowserEvent.type != MapBrowserEventType.SINGLECLICK ||\n        !this.ignoreNextSingleClick_\n      ) {\n        handled = this.removePoint();\n      } else {\n        handled = true;\n      }\n    }\n\n    if (mapBrowserEvent.type == MapBrowserEventType.SINGLECLICK) {\n      this.ignoreNextSingleClick_ = false;\n    }\n\n    return super.handleEvent(mapBrowserEvent) && !handled;\n  }\n\n  findInsertVerticesAndUpdateDragSegments_(pixelCoordinate) {\n    this.handlePointerAtPixel_(pixelCoordinate);\n    this.dragSegments_.length = 0;\n    this.featuresBeingModified_ = null;\n    const vertexFeature = this.vertexFeature_;\n    if (!vertexFeature) {\n      return;\n    }\n\n    const projection = this.getMap().getView().getProjection();\n    const insertVertices = [];\n    const vertex = vertexFeature.getGeometry().getCoordinates();\n    const vertexExtent = boundingExtent([vertex]);\n    const segmentDataMatches = this.rBush_.getInExtent(vertexExtent);\n    const componentSegments = {};\n    segmentDataMatches.sort(compareIndexes);\n    for (let i = 0, ii = segmentDataMatches.length; i < ii; ++i) {\n      const segmentDataMatch = segmentDataMatches[i];\n      const segment = segmentDataMatch.segment;\n      let uid = getUid(segmentDataMatch.geometry);\n      const depth = segmentDataMatch.depth;\n      if (depth) {\n        uid += '-' + depth.join('-'); // separate feature components\n      }\n      if (!componentSegments[uid]) {\n        componentSegments[uid] = new Array(2);\n      }\n\n      if (\n        segmentDataMatch.geometry.getType() === 'Circle' &&\n        segmentDataMatch.index === CIRCLE_CIRCUMFERENCE_INDEX\n      ) {\n        const closestVertex = closestOnSegmentData(\n          pixelCoordinate,\n          segmentDataMatch,\n          projection,\n        );\n        if (\n          coordinatesEqual(closestVertex, vertex) &&\n          !componentSegments[uid][0]\n        ) {\n          this.dragSegments_.push([segmentDataMatch, 0]);\n          componentSegments[uid][0] = segmentDataMatch;\n        }\n        continue;\n      }\n\n      if (coordinatesEqual(segment[0], vertex) && !componentSegments[uid][0]) {\n        this.dragSegments_.push([segmentDataMatch, 0]);\n        componentSegments[uid][0] = segmentDataMatch;\n        continue;\n      }\n\n      if (coordinatesEqual(segment[1], vertex) && !componentSegments[uid][1]) {\n        if (\n          componentSegments[uid][0] &&\n          componentSegments[uid][0].index === 0\n        ) {\n          let coordinates = segmentDataMatch.geometry.getCoordinates();\n          switch (segmentDataMatch.geometry.getType()) {\n            // prevent dragging closed linestrings by the connecting node\n            case 'LineString':\n            case 'MultiLineString':\n              continue;\n            // if dragging the first vertex of a polygon, ensure the other segment\n            // belongs to the closing vertex of the linear ring\n            case 'MultiPolygon':\n              coordinates = coordinates[depth[1]];\n            /* falls through */\n            case 'Polygon':\n              if (segmentDataMatch.index !== coordinates[depth[0]].length - 2) {\n                continue;\n              }\n              break;\n            default:\n            // pass\n          }\n        }\n\n        this.dragSegments_.push([segmentDataMatch, 1]);\n        componentSegments[uid][1] = segmentDataMatch;\n        continue;\n      }\n\n      if (\n        getUid(segment) in this.vertexSegments_ &&\n        !componentSegments[uid][0] &&\n        !componentSegments[uid][1]\n      ) {\n        insertVertices.push(segmentDataMatch);\n      }\n    }\n\n    return insertVertices;\n  }\n\n  /**\n   * Handle pointer drag events.\n   * @param {import(\"../MapBrowserEvent.js\").default} evt Event.\n   * @override\n   */\n  handleDragEvent(evt) {\n    this.ignoreNextSingleClick_ = false;\n    this.willModifyFeatures_(\n      evt,\n      this.dragSegments_.map(([segment]) => segment),\n    );\n\n    const vertex = [\n      evt.coordinate[0] + this.delta_[0],\n      evt.coordinate[1] + this.delta_[1],\n    ];\n    const features = [];\n    const geometries = [];\n    for (let i = 0, ii = this.dragSegments_.length; i < ii; ++i) {\n      const dragSegment = this.dragSegments_[i];\n      const segmentData = dragSegment[0];\n      const feature = segmentData.feature;\n      if (!features.includes(feature)) {\n        features.push(feature);\n      }\n      const geometry = segmentData.geometry;\n      if (!geometries.includes(geometry)) {\n        geometries.push(geometry);\n      }\n      const depth = segmentData.depth;\n      let coordinates;\n      const segment = segmentData.segment;\n      const index = dragSegment[1];\n\n      while (vertex.length < geometry.getStride()) {\n        vertex.push(segment[index][vertex.length]);\n      }\n\n      switch (geometry.getType()) {\n        case 'Point':\n          coordinates = vertex;\n          segment[0] = vertex;\n          segment[1] = vertex;\n          break;\n        case 'MultiPoint':\n          coordinates = geometry.getCoordinates();\n          coordinates[segmentData.index] = vertex;\n          segment[0] = vertex;\n          segment[1] = vertex;\n          break;\n        case 'LineString':\n          coordinates = geometry.getCoordinates();\n          coordinates[segmentData.index + index] = vertex;\n          segment[index] = vertex;\n          break;\n        case 'MultiLineString':\n          coordinates = geometry.getCoordinates();\n          coordinates[depth[0]][segmentData.index + index] = vertex;\n          segment[index] = vertex;\n          break;\n        case 'Polygon':\n          coordinates = geometry.getCoordinates();\n          coordinates[depth[0]][segmentData.index + index] = vertex;\n          segment[index] = vertex;\n          break;\n        case 'MultiPolygon':\n          coordinates = geometry.getCoordinates();\n          coordinates[depth[1]][depth[0]][segmentData.index + index] = vertex;\n          segment[index] = vertex;\n          break;\n        case 'Circle':\n          const circle = /** @type {import(\"../geom/Circle.js\").default} */ (\n            geometry\n          );\n          segment[0] = vertex;\n          segment[1] = vertex;\n          if (segmentData.index === CIRCLE_CENTER_INDEX) {\n            this.changingFeature_ = true;\n            circle.setCenter(vertex);\n            this.changingFeature_ = false;\n          } else {\n            // We're dragging the circle's circumference:\n            this.changingFeature_ = true;\n            const projection = evt.map.getView().getProjection();\n            let radius = coordinateDistance(\n              fromUserCoordinate(circle.getCenter(), projection),\n              fromUserCoordinate(vertex, projection),\n            );\n            const userProjection = getUserProjection();\n            if (userProjection) {\n              const circleGeometry = circle\n                .clone()\n                .transform(userProjection, projection);\n              circleGeometry.setRadius(radius);\n              radius = circleGeometry\n                .transform(projection, userProjection)\n                .getRadius();\n            }\n            circle.setRadius(radius);\n            this.changingFeature_ = false;\n          }\n          break;\n        default:\n        // pass\n      }\n\n      if (coordinates) {\n        this.setGeometryCoordinates_(geometry, coordinates);\n      }\n    }\n    this.createOrUpdateVertexFeature_(vertex, features, geometries, true);\n  }\n\n  /**\n   * Handle pointer down events.\n   * @param {import(\"../MapBrowserEvent.js\").default} evt Event.\n   * @return {boolean} If the event was consumed.\n   * @override\n   */\n  handleDownEvent(evt) {\n    if (!this.condition_(evt)) {\n      return false;\n    }\n    const pixelCoordinate = evt.coordinate;\n    const insertVertices =\n      this.findInsertVerticesAndUpdateDragSegments_(pixelCoordinate);\n\n    if (insertVertices?.length && this.insertVertexCondition_(evt)) {\n      this.willModifyFeatures_(evt, insertVertices);\n\n      if (this.vertexFeature_) {\n        const vertex = this.vertexFeature_.getGeometry().getCoordinates();\n        for (let j = insertVertices.length - 1; j >= 0; --j) {\n          this.insertVertex_(insertVertices[j], vertex);\n        }\n        this.ignoreNextSingleClick_ = true;\n      }\n    }\n\n    return !!this.vertexFeature_;\n  }\n\n  /**\n   * Handle pointer up events.\n   * @param {import(\"../MapBrowserEvent.js\").default} evt Event.\n   * @return {boolean} If the event was consumed.\n   * @override\n   */\n  handleUpEvent(evt) {\n    for (let i = this.dragSegments_.length - 1; i >= 0; --i) {\n      const segmentData = this.dragSegments_[i][0];\n      const geometry = segmentData.geometry;\n      if (geometry.getType() === 'Circle') {\n        const circle = /** @type {import(\"../geom/Circle.js\").default} */ (\n          geometry\n        );\n        // Update a circle object in the R* bush:\n        const coordinates = circle.getCenter();\n        const centerSegmentData = segmentData.featureSegments[0];\n        const circumferenceSegmentData = segmentData.featureSegments[1];\n        centerSegmentData.segment[0] = coordinates;\n        centerSegmentData.segment[1] = coordinates;\n        circumferenceSegmentData.segment[0] = coordinates;\n        circumferenceSegmentData.segment[1] = coordinates;\n        this.rBush_.update(createExtent(coordinates), centerSegmentData);\n        /** @type {import(\"../geom/Circle.js\").default | import(\"../geom/Polygon.js\").default} */\n        let circleGeometry = circle;\n        const userProjection = getUserProjection();\n        if (userProjection) {\n          const projection = evt.map.getView().getProjection();\n          circleGeometry = circleGeometry\n            .clone()\n            .transform(userProjection, projection);\n          circleGeometry = fromCircle(circleGeometry).transform(\n            projection,\n            userProjection,\n          );\n        }\n        this.rBush_.update(\n          circleGeometry.getExtent(),\n          circumferenceSegmentData,\n        );\n      } else {\n        this.rBush_.update(boundingExtent(segmentData.segment), segmentData);\n      }\n    }\n    if (this.featuresBeingModified_) {\n      this.dispatchEvent(\n        new ModifyEvent(\n          ModifyEventType.MODIFYEND,\n          this.featuresBeingModified_,\n          evt,\n        ),\n      );\n      this.featuresBeingModified_ = null;\n    }\n    return false;\n  }\n\n  /**\n   * @param {import(\"../MapBrowserEvent.js\").default} evt Event.\n   * @private\n   */\n  handlePointerMove_(evt) {\n    this.lastPixel_ = evt.pixel;\n    this.handlePointerAtPixel_(evt.coordinate);\n  }\n\n  /**\n   * @param {import(\"../coordinate.js\").Coordinate} pixelCoordinate The pixel Coordinate.\n   * @private\n   */\n  handlePointerAtPixel_(pixelCoordinate) {\n    const map = this.getMap();\n    const pixel = map.getPixelFromCoordinate(pixelCoordinate);\n    const projection = map.getView().getProjection();\n    const sortByDistance = function (a, b) {\n      return (\n        projectedDistanceToSegmentDataSquared(pixelCoordinate, a, projection) -\n        projectedDistanceToSegmentDataSquared(pixelCoordinate, b, projection)\n      );\n    };\n\n    /** @type {Array<SegmentData>|undefined} */\n    let nodes;\n    /** @type {Point|undefined} */\n    let hitPointGeometry;\n    if (this.hitDetection_) {\n      const layerFilter =\n        typeof this.hitDetection_ === 'object'\n          ? (layer) => layer === this.hitDetection_\n          : undefined;\n      map.forEachFeatureAtPixel(\n        pixel,\n        (feature, layer, geometry) => {\n          if (geometry && geometry.getType() === 'Point') {\n            geometry = new Point(\n              toUserCoordinate(geometry.getCoordinates(), projection),\n            );\n          }\n          const geom = geometry || feature.getGeometry();\n\n          if (\n            geom &&\n            geom.getType() === 'Point' &&\n            feature instanceof Feature &&\n            this.features_.getArray().includes(feature)\n          ) {\n            hitPointGeometry = /** @type {Point} */ (geom);\n            const coordinate = /** @type {Point} */ (feature.getGeometry())\n              .getFlatCoordinates()\n              .slice(0, 2);\n            nodes = [\n              {\n                feature,\n                geometry: hitPointGeometry,\n                segment: [coordinate, coordinate],\n              },\n            ];\n          }\n          return true;\n        },\n        {layerFilter},\n      );\n    }\n    if (!nodes) {\n      const viewExtent = fromUserExtent(\n        createExtent(pixelCoordinate, tempExtent),\n        projection,\n      );\n      const buffer = map.getView().getResolution() * this.pixelTolerance_;\n      const box = toUserExtent(\n        bufferExtent(viewExtent, buffer, tempExtent),\n        projection,\n      );\n      nodes = this.rBush_.getInExtent(box);\n    }\n\n    if (nodes && nodes.length > 0) {\n      const node = nodes.sort(sortByDistance)[0];\n      const closestSegment = node.segment;\n      let vertex = closestOnSegmentData(pixelCoordinate, node, projection);\n      const vertexPixel = map.getPixelFromCoordinate(vertex);\n      let dist = coordinateDistance(pixel, vertexPixel);\n      if (hitPointGeometry || dist <= this.pixelTolerance_) {\n        /** @type {Object<string, boolean>} */\n        const vertexSegments = {};\n        vertexSegments[getUid(closestSegment)] = true;\n\n        if (!this.snapToPointer_) {\n          this.delta_[0] = vertex[0] - pixelCoordinate[0];\n          this.delta_[1] = vertex[1] - pixelCoordinate[1];\n        }\n        if (\n          node.geometry.getType() === 'Circle' &&\n          node.index === CIRCLE_CIRCUMFERENCE_INDEX\n        ) {\n          this.snappedToVertex_ = true;\n          this.createOrUpdateVertexFeature_(\n            vertex,\n            [node.feature],\n            [node.geometry],\n            this.snappedToVertex_,\n          );\n        } else {\n          const pixel1 = map.getPixelFromCoordinate(closestSegment[0]);\n          const pixel2 = map.getPixelFromCoordinate(closestSegment[1]);\n          const squaredDist1 = squaredCoordinateDistance(vertexPixel, pixel1);\n          const squaredDist2 = squaredCoordinateDistance(vertexPixel, pixel2);\n          dist = Math.sqrt(Math.min(squaredDist1, squaredDist2));\n          this.snappedToVertex_ = dist <= this.pixelTolerance_;\n          // Stop and cleanup overlay vertex feature if a segment was hit and new vertex creation is not allowed by the insertVertexCondition\n          if (\n            !this.snappedToVertex_ &&\n            !this.insertVertexCondition_(this.lastPointerEvent_)\n          ) {\n            if (this.vertexFeature_) {\n              this.overlay_.getSource().removeFeature(this.vertexFeature_);\n              this.vertexFeature_ = null;\n            }\n            return;\n          }\n          if (this.snappedToVertex_) {\n            vertex =\n              squaredDist1 > squaredDist2\n                ? closestSegment[1]\n                : closestSegment[0];\n          }\n          this.createOrUpdateVertexFeature_(\n            vertex,\n            [node.feature],\n            [node.geometry],\n            this.snappedToVertex_,\n          );\n          const geometries = {};\n          geometries[getUid(node.geometry)] = true;\n          for (let i = 1, ii = nodes.length; i < ii; ++i) {\n            const segment = nodes[i].segment;\n            if (\n              (coordinatesEqual(closestSegment[0], segment[0]) &&\n                coordinatesEqual(closestSegment[1], segment[1])) ||\n              (coordinatesEqual(closestSegment[0], segment[1]) &&\n                coordinatesEqual(closestSegment[1], segment[0]))\n            ) {\n              const geometryUid = getUid(nodes[i].geometry);\n              if (!(geometryUid in geometries)) {\n                geometries[geometryUid] = true;\n                vertexSegments[getUid(segment)] = true;\n              }\n            } else {\n              break;\n            }\n          }\n        }\n\n        this.vertexSegments_ = vertexSegments;\n        return;\n      }\n    }\n    if (this.vertexFeature_) {\n      this.overlay_.getSource().removeFeature(this.vertexFeature_);\n      this.vertexFeature_ = null;\n    }\n  }\n\n  /**\n   * @param {SegmentData} segmentData Segment data.\n   * @param {import(\"../coordinate.js\").Coordinate} vertex Vertex.\n   * @return {boolean} A vertex was inserted.\n   * @private\n   */\n  insertVertex_(segmentData, vertex) {\n    const segment = segmentData.segment;\n    const feature = segmentData.feature;\n    const geometry = segmentData.geometry;\n    const depth = segmentData.depth;\n    const index = segmentData.index;\n    let coordinates;\n\n    while (vertex.length < geometry.getStride()) {\n      vertex.push(0);\n    }\n\n    switch (geometry.getType()) {\n      case 'MultiLineString':\n        coordinates = geometry.getCoordinates();\n        coordinates[depth[0]].splice(index + 1, 0, vertex);\n        break;\n      case 'Polygon':\n        coordinates = geometry.getCoordinates();\n        coordinates[depth[0]].splice(index + 1, 0, vertex);\n        break;\n      case 'MultiPolygon':\n        coordinates = geometry.getCoordinates();\n        coordinates[depth[1]][depth[0]].splice(index + 1, 0, vertex);\n        break;\n      case 'LineString':\n        coordinates = geometry.getCoordinates();\n        coordinates.splice(index + 1, 0, vertex);\n        break;\n      default:\n        return false;\n    }\n\n    this.setGeometryCoordinates_(geometry, coordinates);\n    const rTree = this.rBush_;\n    rTree.remove(segmentData);\n    this.updateSegmentIndices_(geometry, index, depth, 1);\n\n    /** @type {SegmentData} */\n    const newSegmentData = {\n      segment: [segment[0], vertex],\n      feature: feature,\n      geometry: geometry,\n      depth: depth,\n      index: index,\n    };\n\n    rTree.insert(boundingExtent(newSegmentData.segment), newSegmentData);\n    this.dragSegments_.push([newSegmentData, 1]);\n\n    /** @type {SegmentData} */\n    const newSegmentData2 = {\n      segment: [vertex, segment[1]],\n      feature: feature,\n      geometry: geometry,\n      depth: depth,\n      index: index + 1,\n    };\n\n    rTree.insert(boundingExtent(newSegmentData2.segment), newSegmentData2);\n    this.dragSegments_.push([newSegmentData2, 0]);\n    return true;\n  }\n\n  updatePointer_(coordinate) {\n    if (coordinate) {\n      this.findInsertVerticesAndUpdateDragSegments_(coordinate);\n    }\n    return this.vertexFeature_?.getGeometry().getCoordinates();\n  }\n\n  /**\n   * Get the current pointer position.\n   * @return {import(\"../coordinate.js\").Coordinate | null} The current pointer coordinate.\n   */\n  getPoint() {\n    const coordinate = this.vertexFeature_?.getGeometry().getCoordinates();\n    if (!coordinate) {\n      return null;\n    }\n    return toUserCoordinate(\n      coordinate,\n      this.getMap().getView().getProjection(),\n    );\n  }\n\n  /**\n   * Check if a point can be removed from the current linestring or polygon at the current\n   * pointer position.\n   * @return {boolean} A point can be deleted at the current pointer position.\n   * @api\n   */\n  canRemovePoint() {\n    if (!this.vertexFeature_) {\n      return false;\n    }\n    if (\n      this.vertexFeature_\n        .get('geometries')\n        .every(\n          (geometry) =>\n            geometry.getType() === 'Circle' ||\n            geometry.getType().endsWith('Point'),\n        )\n    ) {\n      return false;\n    }\n    const coordinate = this.vertexFeature_.getGeometry().getCoordinates();\n    const segments = this.rBush_.getInExtent(boundingExtent([coordinate]));\n    return segments.some(\n      ({segment}) =>\n        coordinatesEqual(segment[0], coordinate) ||\n        coordinatesEqual(segment[1], coordinate),\n    );\n  }\n\n  /**\n   * Removes the vertex currently being pointed from the current linestring or polygon.\n   * @param {import('../coordinate.js').Coordinate} [coordinate] If provided, the pointer\n   * will be set to the provided coordinate. If not, the current pointer coordinate will be used.\n   * @return {boolean} True when a vertex was removed.\n   * @api\n   */\n  removePoint(coordinate) {\n    if (coordinate) {\n      coordinate = fromUserCoordinate(\n        coordinate,\n        this.getMap().getView().getProjection(),\n      );\n      this.updatePointer_(coordinate);\n    }\n    if (\n      !this.lastPointerEvent_ ||\n      (this.lastPointerEvent_ &&\n        this.lastPointerEvent_.type != MapBrowserEventType.POINTERDRAG)\n    ) {\n      const evt = this.lastPointerEvent_;\n      this.willModifyFeatures_(\n        evt,\n        this.dragSegments_.map(([segment]) => segment),\n      );\n      const removed = this.removeVertex_();\n      if (this.featuresBeingModified_) {\n        this.dispatchEvent(\n          new ModifyEvent(\n            ModifyEventType.MODIFYEND,\n            this.featuresBeingModified_,\n            evt,\n          ),\n        );\n      }\n\n      this.featuresBeingModified_ = null;\n      return removed;\n    }\n    return false;\n  }\n\n  /**\n   * Removes a vertex from all matching features.\n   * @return {boolean} True when a vertex was removed.\n   * @private\n   */\n  removeVertex_() {\n    const dragSegments = this.dragSegments_;\n    const segmentsByFeature = {};\n    let deleted = false;\n    let component, coordinates, dragSegment, geometry, i, index, left;\n    let newIndex, right, segmentData, uid;\n    for (i = dragSegments.length - 1; i >= 0; --i) {\n      dragSegment = dragSegments[i];\n      segmentData = dragSegment[0];\n      uid = getUid(segmentData.feature);\n      if (segmentData.depth) {\n        // separate feature components\n        uid += '-' + segmentData.depth.join('-');\n      }\n      if (!(uid in segmentsByFeature)) {\n        segmentsByFeature[uid] = {};\n      }\n      if (dragSegment[1] === 0) {\n        segmentsByFeature[uid].right = segmentData;\n        segmentsByFeature[uid].index = segmentData.index;\n      } else if (dragSegment[1] == 1) {\n        segmentsByFeature[uid].left = segmentData;\n        segmentsByFeature[uid].index = segmentData.index + 1;\n      }\n    }\n    for (uid in segmentsByFeature) {\n      right = segmentsByFeature[uid].right;\n      left = segmentsByFeature[uid].left;\n      index = segmentsByFeature[uid].index;\n      newIndex = index - 1;\n      if (left !== undefined) {\n        segmentData = left;\n      } else {\n        segmentData = right;\n      }\n      if (newIndex < 0) {\n        newIndex = 0;\n      }\n      geometry = segmentData.geometry;\n      coordinates = geometry.getCoordinates();\n      component = coordinates;\n      deleted = false;\n      switch (geometry.getType()) {\n        case 'MultiLineString':\n          if (coordinates[segmentData.depth[0]].length > 2) {\n            coordinates[segmentData.depth[0]].splice(index, 1);\n            deleted = true;\n          }\n          break;\n        case 'LineString':\n          if (coordinates.length > 2) {\n            coordinates.splice(index, 1);\n            deleted = true;\n          }\n          break;\n        case 'MultiPolygon':\n          component = component[segmentData.depth[1]];\n        /* falls through */\n        case 'Polygon':\n          component = component[segmentData.depth[0]];\n          if (component.length > 4) {\n            if (index == component.length - 1) {\n              index = 0;\n            }\n            component.splice(index, 1);\n            deleted = true;\n            if (index === 0) {\n              // close the ring again\n              component.pop();\n              component.push(component[0]);\n              newIndex = component.length - 1;\n            }\n          }\n          break;\n        default:\n        // pass\n      }\n\n      if (deleted) {\n        this.setGeometryCoordinates_(geometry, coordinates);\n        const segments = [];\n        if (left !== undefined) {\n          this.rBush_.remove(left);\n          segments.push(left.segment[0]);\n        }\n        if (right !== undefined) {\n          this.rBush_.remove(right);\n          segments.push(right.segment[1]);\n        }\n        if (left !== undefined && right !== undefined) {\n          /** @type {SegmentData} */\n          const newSegmentData = {\n            depth: segmentData.depth,\n            feature: segmentData.feature,\n            geometry: segmentData.geometry,\n            index: newIndex,\n            segment: segments,\n          };\n\n          this.rBush_.insert(\n            boundingExtent(newSegmentData.segment),\n            newSegmentData,\n          );\n        }\n        this.updateSegmentIndices_(geometry, index, segmentData.depth, -1);\n        if (this.vertexFeature_) {\n          this.overlay_.getSource().removeFeature(this.vertexFeature_);\n          this.vertexFeature_ = null;\n        }\n        dragSegments.length = 0;\n      }\n    }\n    return deleted;\n  }\n\n  /**\n   * Check if a point can be inserted to the current linestring or polygon at the current\n   * pointer position.\n   * @return {boolean} A point can be inserted at the current pointer position.\n   * @api\n   */\n  canInsertPoint() {\n    if (!this.vertexFeature_) {\n      return false;\n    }\n    if (\n      this.vertexFeature_\n        .get('geometries')\n        .every(\n          (geometry) =>\n            geometry.getType() === 'Circle' ||\n            geometry.getType().endsWith('Point'),\n        )\n    ) {\n      return false;\n    }\n    const coordinate = this.vertexFeature_.getGeometry().getCoordinates();\n    const segments = this.rBush_.getInExtent(boundingExtent([coordinate]));\n    return segments.some(\n      ({segment}) =>\n        !(\n          coordinatesEqual(segment[0], coordinate) ||\n          coordinatesEqual(segment[1], coordinate)\n        ),\n    );\n  }\n\n  /**\n   * Inserts the vertex currently being pointed to the current linestring or polygon.\n   * @param {import('../coordinate.js').Coordinate} [coordinate] If provided, the pointer\n   * will be set to the provided coordinate. If not, the current pointer coordinate will be used.\n   * @return {boolean} A vertex was inserted.\n   * @api\n   */\n  insertPoint(coordinate) {\n    const pixelCoordinate = coordinate\n      ? fromUserCoordinate(coordinate, this.getMap().getView().getProjection())\n      : this.vertexFeature_?.getGeometry().getCoordinates();\n    if (!pixelCoordinate) {\n      return false;\n    }\n    const insertVertices =\n      this.findInsertVerticesAndUpdateDragSegments_(pixelCoordinate);\n    return insertVertices.reduce(\n      (prev, segmentData) =>\n        prev || this.insertVertex_(segmentData, pixelCoordinate),\n      false,\n    );\n  }\n\n  /**\n   * @param {import(\"../geom/SimpleGeometry.js\").default} geometry Geometry.\n   * @param {Array} coordinates Coordinates.\n   * @private\n   */\n  setGeometryCoordinates_(geometry, coordinates) {\n    this.changingFeature_ = true;\n    geometry.setCoordinates(coordinates);\n    this.changingFeature_ = false;\n  }\n\n  /**\n   * @param {import(\"../geom/SimpleGeometry.js\").default} geometry Geometry.\n   * @param {number} index Index.\n   * @param {Array<number>|undefined} depth Depth.\n   * @param {number} delta Delta (1 or -1).\n   * @private\n   */\n  updateSegmentIndices_(geometry, index, depth, delta) {\n    this.rBush_.forEachInExtent(\n      geometry.getExtent(),\n      function (segmentDataMatch) {\n        if (\n          segmentDataMatch.geometry === geometry &&\n          (depth === undefined ||\n            segmentDataMatch.depth === undefined ||\n            equals(segmentDataMatch.depth, depth)) &&\n          segmentDataMatch.index > index\n        ) {\n          segmentDataMatch.index += delta;\n        }\n      },\n    );\n  }\n}\n\n/**\n * @param {SegmentData} a The first segment data.\n * @param {SegmentData} b The second segment data.\n * @return {number} The difference in indexes.\n */\nfunction compareIndexes(a, b) {\n  return a.index - b.index;\n}\n\n/**\n * Returns the distance from a point to a line segment.\n *\n * @param {import(\"../coordinate.js\").Coordinate} pointCoordinates The coordinates of the point from\n *        which to calculate the distance.\n * @param {SegmentData} segmentData The object describing the line\n *        segment we are calculating the distance to.\n * @param {import(\"../proj/Projection.js\").default} projection The view projection.\n * @return {number} The square of the distance between a point and a line segment.\n */\nfunction projectedDistanceToSegmentDataSquared(\n  pointCoordinates,\n  segmentData,\n  projection,\n) {\n  const geometry = segmentData.geometry;\n\n  if (geometry.getType() === 'Circle') {\n    let circleGeometry = /** @type {import(\"../geom/Circle.js\").default} */ (\n      geometry\n    );\n\n    if (segmentData.index === CIRCLE_CIRCUMFERENCE_INDEX) {\n      const userProjection = getUserProjection();\n      if (userProjection) {\n        circleGeometry = circleGeometry\n          .clone()\n          .transform(userProjection, projection);\n      }\n      const distanceToCenterSquared = squaredCoordinateDistance(\n        circleGeometry.getCenter(),\n        fromUserCoordinate(pointCoordinates, projection),\n      );\n      const distanceToCircumference =\n        Math.sqrt(distanceToCenterSquared) - circleGeometry.getRadius();\n      return distanceToCircumference * distanceToCircumference;\n    }\n  }\n\n  const coordinate = fromUserCoordinate(pointCoordinates, projection);\n  tempSegment[0] = fromUserCoordinate(segmentData.segment[0], projection);\n  tempSegment[1] = fromUserCoordinate(segmentData.segment[1], projection);\n  return squaredDistanceToSegment(coordinate, tempSegment);\n}\n\n/**\n * Returns the point closest to a given line segment.\n *\n * @param {import(\"../coordinate.js\").Coordinate} pointCoordinates The point to which a closest point\n *        should be found.\n * @param {SegmentData} segmentData The object describing the line\n *        segment which should contain the closest point.\n * @param {import(\"../proj/Projection.js\").default} projection The view projection.\n * @return {import(\"../coordinate.js\").Coordinate} The point closest to the specified line segment.\n */\nfunction closestOnSegmentData(pointCoordinates, segmentData, projection) {\n  const geometry = segmentData.geometry;\n\n  if (\n    geometry.getType() === 'Circle' &&\n    segmentData.index === CIRCLE_CIRCUMFERENCE_INDEX\n  ) {\n    let circleGeometry = /** @type {import(\"../geom/Circle.js\").default} */ (\n      geometry\n    );\n    const userProjection = getUserProjection();\n    if (userProjection) {\n      circleGeometry = circleGeometry\n        .clone()\n        .transform(userProjection, projection);\n    }\n    return toUserCoordinate(\n      circleGeometry.getClosestPoint(\n        fromUserCoordinate(pointCoordinates, projection),\n      ),\n      projection,\n    );\n  }\n  const coordinate = fromUserCoordinate(pointCoordinates, projection);\n  tempSegment[0] = fromUserCoordinate(segmentData.segment[0], projection);\n  tempSegment[1] = fromUserCoordinate(segmentData.segment[1], projection);\n  return toUserCoordinate(\n    closestOnSegment(coordinate, tempSegment),\n    projection,\n  );\n}\n\n/**\n * @return {import(\"../style/Style.js\").StyleFunction} Styles.\n */\nfunction getDefaultStyleFunction() {\n  const style = createEditingStyle();\n  return function (feature, resolution) {\n    return style['Point'];\n  };\n}\n\nexport default Modify;\n","/**\n * @module ol/geom/Circle\n */\nimport {createOrUpdate, forEachCorner, intersects} from '../extent.js';\nimport SimpleGeometry from './SimpleGeometry.js';\nimport {deflateCoordinate} from './flat/deflate.js';\nimport {rotate} from './flat/transform.js';\n\n/**\n * @classdesc\n * Circle geometry.\n *\n * @api\n */\nclass Circle extends SimpleGeometry {\n  /**\n   * @param {!import(\"../coordinate.js\").Coordinate} center Center.\n   *     For internal use, flat coordinates in combination with `layout` and no\n   *     `radius` are also accepted.\n   * @param {number} [radius] Radius in units of the projection.\n   * @param {import(\"./Geometry.js\").GeometryLayout} [layout] Layout.\n   */\n  constructor(center, radius, layout) {\n    super();\n    if (layout !== undefined && radius === undefined) {\n      this.setFlatCoordinates(layout, center);\n    } else {\n      radius = radius ? radius : 0;\n      this.setCenterAndRadius(center, radius, layout);\n    }\n  }\n\n  /**\n   * Make a complete copy of the geometry.\n   * @return {!Circle} Clone.\n   * @api\n   * @override\n   */\n  clone() {\n    const circle = new Circle(\n      this.flatCoordinates.slice(),\n      undefined,\n      this.layout,\n    );\n    circle.applyProperties(this);\n    return circle;\n  }\n\n  /**\n   * @param {number} x X.\n   * @param {number} y Y.\n   * @param {import(\"../coordinate.js\").Coordinate} closestPoint Closest point.\n   * @param {number} minSquaredDistance Minimum squared distance.\n   * @return {number} Minimum squared distance.\n   * @override\n   */\n  closestPointXY(x, y, closestPoint, minSquaredDistance) {\n    const flatCoordinates = this.flatCoordinates;\n    const dx = x - flatCoordinates[0];\n    const dy = y - flatCoordinates[1];\n    const squaredDistance = dx * dx + dy * dy;\n    if (squaredDistance < minSquaredDistance) {\n      if (squaredDistance === 0) {\n        for (let i = 0; i < this.stride; ++i) {\n          closestPoint[i] = flatCoordinates[i];\n        }\n      } else {\n        const delta = this.getRadius() / Math.sqrt(squaredDistance);\n        closestPoint[0] = flatCoordinates[0] + delta * dx;\n        closestPoint[1] = flatCoordinates[1] + delta * dy;\n        for (let i = 2; i < this.stride; ++i) {\n          closestPoint[i] = flatCoordinates[i];\n        }\n      }\n      closestPoint.length = this.stride;\n      return squaredDistance;\n    }\n    return minSquaredDistance;\n  }\n\n  /**\n   * @param {number} x X.\n   * @param {number} y Y.\n   * @return {boolean} Contains (x, y).\n   * @override\n   */\n  containsXY(x, y) {\n    const flatCoordinates = this.flatCoordinates;\n    const dx = x - flatCoordinates[0];\n    const dy = y - flatCoordinates[1];\n    return dx * dx + dy * dy <= this.getRadiusSquared_();\n  }\n\n  /**\n   * Return the center of the circle as {@link module:ol/coordinate~Coordinate coordinate}.\n   * @return {import(\"../coordinate.js\").Coordinate} Center.\n   * @api\n   */\n  getCenter() {\n    return this.flatCoordinates.slice(0, this.stride);\n  }\n\n  /**\n   * @param {import(\"../extent.js\").Extent} extent Extent.\n   * @protected\n   * @return {import(\"../extent.js\").Extent} extent Extent.\n   * @override\n   */\n  computeExtent(extent) {\n    const flatCoordinates = this.flatCoordinates;\n    const radius = flatCoordinates[this.stride] - flatCoordinates[0];\n    return createOrUpdate(\n      flatCoordinates[0] - radius,\n      flatCoordinates[1] - radius,\n      flatCoordinates[0] + radius,\n      flatCoordinates[1] + radius,\n      extent,\n    );\n  }\n\n  /**\n   * Return the radius of the circle.\n   * @return {number} Radius.\n   * @api\n   */\n  getRadius() {\n    return Math.sqrt(this.getRadiusSquared_());\n  }\n\n  /**\n   * @private\n   * @return {number} Radius squared.\n   */\n  getRadiusSquared_() {\n    const dx = this.flatCoordinates[this.stride] - this.flatCoordinates[0];\n    const dy = this.flatCoordinates[this.stride + 1] - this.flatCoordinates[1];\n    return dx * dx + dy * dy;\n  }\n\n  /**\n   * Get the type of this geometry.\n   * @return {import(\"./Geometry.js\").Type} Geometry type.\n   * @api\n   * @override\n   */\n  getType() {\n    return 'Circle';\n  }\n\n  /**\n   * Test if the geometry and the passed extent intersect.\n   * @param {import(\"../extent.js\").Extent} extent Extent.\n   * @return {boolean} `true` if the geometry and the extent intersect.\n   * @api\n   * @override\n   */\n  intersectsExtent(extent) {\n    const circleExtent = this.getExtent();\n    if (intersects(extent, circleExtent)) {\n      const center = this.getCenter();\n\n      if (extent[0] <= center[0] && extent[2] >= center[0]) {\n        return true;\n      }\n      if (extent[1] <= center[1] && extent[3] >= center[1]) {\n        return true;\n      }\n\n      return forEachCorner(extent, this.intersectsCoordinate.bind(this));\n    }\n    return false;\n  }\n\n  /**\n   * Set the center of the circle as {@link module:ol/coordinate~Coordinate coordinate}.\n   * @param {import(\"../coordinate.js\").Coordinate} center Center.\n   * @api\n   */\n  setCenter(center) {\n    const stride = this.stride;\n    const radius = this.flatCoordinates[stride] - this.flatCoordinates[0];\n    const flatCoordinates = center.slice();\n    flatCoordinates[stride] = flatCoordinates[0] + radius;\n    for (let i = 1; i < stride; ++i) {\n      flatCoordinates[stride + i] = center[i];\n    }\n    this.setFlatCoordinates(this.layout, flatCoordinates);\n    this.changed();\n  }\n\n  /**\n   * Set the center (as {@link module:ol/coordinate~Coordinate coordinate}) and the radius (as\n   * number) of the circle.\n   * @param {!import(\"../coordinate.js\").Coordinate} center Center.\n   * @param {number} radius Radius.\n   * @param {import(\"./Geometry.js\").GeometryLayout} [layout] Layout.\n   * @api\n   */\n  setCenterAndRadius(center, radius, layout) {\n    this.setLayout(layout, center, 0);\n    if (!this.flatCoordinates) {\n      this.flatCoordinates = [];\n    }\n    /** @type {Array<number>} */\n    const flatCoordinates = this.flatCoordinates;\n    let offset = deflateCoordinate(flatCoordinates, 0, center, this.stride);\n    flatCoordinates[offset++] = flatCoordinates[0] + radius;\n    for (let i = 1, ii = this.stride; i < ii; ++i) {\n      flatCoordinates[offset++] = flatCoordinates[i];\n    }\n    flatCoordinates.length = offset;\n    this.changed();\n  }\n\n  /**\n   * @override\n   */\n  getCoordinates() {\n    return null;\n  }\n\n  /**\n   * @override\n   */\n  setCoordinates(coordinates, layout) {}\n\n  /**\n   * Set the radius of the circle. The radius is in the units of the projection.\n   * @param {number} radius Radius.\n   * @api\n   */\n  setRadius(radius) {\n    this.flatCoordinates[this.stride] = this.flatCoordinates[0] + radius;\n    this.changed();\n  }\n\n  /**\n   * Rotate the geometry around a given coordinate. This modifies the geometry\n   * coordinates in place.\n   * @param {number} angle Rotation angle in counter-clockwise radians.\n   * @param {import(\"../coordinate.js\").Coordinate} anchor The rotation center.\n   * @api\n   * @override\n   */\n  rotate(angle, anchor) {\n    const center = this.getCenter();\n    const stride = this.getStride();\n    this.setCenter(\n      rotate(center, 0, center.length, stride, angle, anchor, center),\n    );\n    this.changed();\n  }\n}\n\n/**\n * Transform each coordinate of the circle from one coordinate reference system\n * to another. The geometry is modified in place.\n * If you do not want the geometry modified in place, first clone() it and\n * then use this function on the clone.\n *\n * Internally a circle is currently represented by two points: the center of\n * the circle `[cx, cy]`, and the point to the right of the circle\n * `[cx + r, cy]`. This `transform` function just transforms these two points.\n * So the resulting geometry is also a circle, and that circle does not\n * correspond to the shape that would be obtained by transforming every point\n * of the original circle.\n *\n * @param {import(\"../proj.js\").ProjectionLike} source The current projection.  Can be a\n *     string identifier or a {@link module:ol/proj/Projection~Projection} object.\n * @param {import(\"../proj.js\").ProjectionLike} destination The desired projection.  Can be a\n *     string identifier or a {@link module:ol/proj/Projection~Projection} object.\n * @return {Circle} This geometry.  Note that original geometry is\n *     modified in place.\n * @function\n * @api\n */\nCircle.prototype.transform;\nexport default Circle;\n","/**\n * @module ol/interaction/Draw\n */\nimport Feature from '../Feature.js';\nimport MapBrowserEvent from '../MapBrowserEvent.js';\nimport MapBrowserEventType from '../MapBrowserEventType.js';\nimport {\n  distance,\n  squaredDistance as squaredCoordinateDistance,\n} from '../coordinate.js';\nimport Event from '../events/Event.js';\nimport EventType from '../events/EventType.js';\nimport {\n  always,\n  never,\n  noModifierKeys,\n  shiftKeyOnly,\n} from '../events/condition.js';\nimport {\n  boundingExtent,\n  getBottomLeft,\n  getBottomRight,\n  getTopLeft,\n  getTopRight,\n} from '../extent.js';\nimport {FALSE, TRUE} from '../functions.js';\nimport Circle from '../geom/Circle.js';\nimport GeometryCollection from '../geom/GeometryCollection.js';\nimport LineString from '../geom/LineString.js';\nimport MultiLineString from '../geom/MultiLineString.js';\nimport MultiPoint from '../geom/MultiPoint.js';\nimport MultiPolygon from '../geom/MultiPolygon.js';\nimport Point from '../geom/Point.js';\nimport Polygon, {fromCircle, makeRegular} from '../geom/Polygon.js';\nimport {getStrideForLayout} from '../geom/SimpleGeometry.js';\nimport VectorLayer from '../layer/Vector.js';\nimport {clamp, squaredDistance, toFixed} from '../math.js';\nimport {fromUserCoordinate, getUserProjection} from '../proj.js';\nimport VectorSource from '../source/Vector.js';\nimport {createEditingStyle} from '../style/Style.js';\nimport PointerInteraction from './Pointer.js';\nimport InteractionProperty from './Property.js';\n\n/**\n * @typedef {Object} Options\n * @property {import(\"../geom/Geometry.js\").Type} type Geometry type of\n * the geometries being drawn with this instance.\n * @property {number} [clickTolerance=6] The maximum distance in pixels between\n * \"down\" and \"up\" for a \"up\" event to be considered a \"click\" event and\n * actually add a point/vertex to the geometry being drawn.  The default of `6`\n * was chosen for the draw interaction to behave correctly on mouse as well as\n * on touch devices.\n * @property {import(\"../Collection.js\").default<Feature>} [features]\n * Destination collection for the drawn features.\n * @property {VectorSource} [source] Destination source for\n * the drawn features.\n * @property {number} [dragVertexDelay=500] Delay in milliseconds after pointerdown\n * before the current vertex can be dragged to its exact position.\n * @property {number} [snapTolerance=12] Pixel distance for snapping to the\n * drawing finish. Must be greater than `0`.\n * @property {boolean} [stopClick=false] Stop click, singleclick, and\n * doubleclick events from firing during drawing.\n * @property {number} [maxPoints] The number of points that can be drawn before\n * a polygon ring or line string is finished. By default there is no\n * restriction.\n * @property {number} [minPoints] The number of points that must be drawn\n * before a polygon ring or line string can be finished. Default is `3` for\n * polygon rings and `2` for line strings.\n * @property {import(\"../events/condition.js\").Condition} [finishCondition] A function\n * that takes a {@link module:ol/MapBrowserEvent~MapBrowserEvent} and returns a\n * boolean to indicate whether the drawing can be finished. Not used when drawing\n * POINT or MULTI_POINT geometries.\n * @property {import(\"../style/Style.js\").StyleLike|import(\"../style/flat.js\").FlatStyleLike} [style]\n * Style for sketch features. The draw interaction can have up to three sketch features, depending on the mode.\n * It will always contain a feature with a `Point` geometry that corresponds to the current cursor position.\n * If the mode is `LineString` or `Polygon`, and there is at least one drawn point, it will also contain a feature with\n * a `LineString` geometry that corresponds to the line between the already drawn points and the current cursor position.\n * If the mode is `Polygon`, and there is at least one drawn point, it will also contain a feature with a `Polygon`\n * geometry that corresponds to the polygon between the already drawn points and the current cursor position\n * (note that this polygon has only two points if only one point is drawn).\n * If the mode is `Circle`, and there is one point drawn, it will also contain a feature with a `Circle` geometry whose\n * center is the drawn point and the radius is determined by the distance between the drawn point and the cursor.\n * @property {GeometryFunction} [geometryFunction]\n * Function that is called when a geometry's coordinates are updated.\n * @property {string} [geometryName] Geometry name to use for features created\n * by the draw interaction.\n * @property {import(\"../events/condition.js\").Condition} [condition] A function that\n * takes a {@link module:ol/MapBrowserEvent~MapBrowserEvent} and returns a\n * boolean to indicate whether that event should be handled.\n * By default {@link module:ol/events/condition.noModifierKeys}, i.e. a click,\n * adds a vertex or deactivates freehand drawing.\n * @property {boolean} [freehand=false] Operate in freehand mode for lines,\n * polygons, and circles.  This makes the interaction always operate in freehand\n * mode and takes precedence over any `freehandCondition` option.\n * @property {import(\"../events/condition.js\").Condition} [freehandCondition]\n * Condition that activates freehand drawing for lines and polygons. This\n * function takes a {@link module:ol/MapBrowserEvent~MapBrowserEvent} and\n * returns a boolean to indicate whether that event should be handled. The\n * default is {@link module:ol/events/condition.shiftKeyOnly}, meaning that the\n * Shift key activates freehand drawing.\n * @property {boolean|import(\"../events/condition.js\").Condition} [trace=false] Trace a portion of another geometry.\n * Ignored when in freehand mode.\n * @property {VectorSource} [traceSource] Source for features to trace.  If tracing is active and a `traceSource` is\n * not provided, the interaction's `source` will be used.  Tracing requires that the interaction is configured with\n * either a `traceSource` or a `source`.\n * @property {boolean} [wrapX=false] Wrap the world horizontally on the sketch\n * overlay.\n * @property {import(\"../geom/Geometry.js\").GeometryLayout} [geometryLayout='XY'] Layout of the\n * feature geometries created by the draw interaction.\n */\n\n/**\n * Coordinate type when drawing points.\n * @typedef {import(\"../coordinate.js\").Coordinate} PointCoordType\n */\n\n/**\n * Coordinate type when drawing lines.\n * @typedef {Array<import(\"../coordinate.js\").Coordinate>} LineCoordType\n */\n\n/**\n * Coordinate type when drawing polygons.\n * @typedef {Array<Array<import(\"../coordinate.js\").Coordinate>>} PolyCoordType\n */\n\n/**\n * Types used for drawing coordinates.\n * @typedef {PointCoordType|LineCoordType|PolyCoordType} SketchCoordType\n */\n\n/**\n * @typedef {Object} TraceState\n * @property {boolean} active Tracing active.\n * @property {import(\"../pixel.js\").Pixel} [startPx] The initially clicked pixel location.\n * @property {Array<TraceTarget>} [targets] Targets available for tracing.\n * @property {number} [targetIndex] The index of the currently traced target.  A value of -1 indicates\n * that no trace target is active.\n */\n\n/**\n * @typedef {Object} TraceTarget\n * @property {Array<import(\"../coordinate.js\").Coordinate>} coordinates Target coordinates.\n * @property {boolean} ring The target coordinates are a linear ring.\n * @property {number} startIndex The index of first traced coordinate.  A fractional index represents an\n * edge intersection.  Index values for rings will wrap (may be negative or larger than coordinates length).\n * @property {number} endIndex The index of last traced coordinate.  Details from startIndex also apply here.\n */\n\n/**\n * Function that takes an array of coordinates and an optional existing geometry\n * and a projection as arguments, and returns a geometry. The optional existing\n * geometry is the geometry that is returned when the function is called without\n * a second argument.\n * @typedef {function(!SketchCoordType, import(\"../geom/SimpleGeometry.js\").default,\n *     import(\"../proj/Projection.js\").default):\n *     import(\"../geom/SimpleGeometry.js\").default} GeometryFunction\n */\n\n/**\n * @typedef {'Point' | 'LineString' | 'Polygon' | 'Circle'} Mode\n * Draw mode.  This collapses multi-part geometry types with their single-part\n * cousins.\n */\n\n/**\n * @enum {string}\n */\nconst DrawEventType = {\n  /**\n   * Triggered upon feature draw start\n   * @event DrawEvent#drawstart\n   * @api\n   */\n  DRAWSTART: 'drawstart',\n  /**\n   * Triggered upon feature draw end\n   * @event DrawEvent#drawend\n   * @api\n   */\n  DRAWEND: 'drawend',\n  /**\n   * Triggered upon feature draw abortion\n   * @event DrawEvent#drawabort\n   * @api\n   */\n  DRAWABORT: 'drawabort',\n};\n\n/**\n * @classdesc\n * Events emitted by {@link module:ol/interaction/Draw~Draw} instances are\n * instances of this type.\n */\nexport class DrawEvent extends Event {\n  /**\n   * @param {DrawEventType} type Type.\n   * @param {Feature} feature The feature drawn.\n   */\n  constructor(type, feature) {\n    super(type);\n\n    /**\n     * The feature being drawn.\n     * @type {Feature}\n     * @api\n     */\n    this.feature = feature;\n  }\n}\n\n/**\n * @param {import(\"../coordinate.js\").Coordinate} coordinate The coordinate.\n * @param {Array<Feature>} features The candidate features.\n * @return {Array<TraceTarget>} The trace targets.\n */\nfunction getTraceTargets(coordinate, features) {\n  /**\n   * @type {Array<TraceTarget>}\n   */\n  const targets = [];\n\n  for (let i = 0; i < features.length; ++i) {\n    const feature = features[i];\n    const geometry = feature.getGeometry();\n    appendGeometryTraceTargets(coordinate, geometry, targets);\n  }\n\n  return targets;\n}\n\n/**\n * @param {import(\"../coordinate.js\").Coordinate} a One coordinate.\n * @param {import(\"../coordinate.js\").Coordinate} b Another coordinate.\n * @return {number} The squared distance between the two coordinates.\n */\nfunction getSquaredDistance(a, b) {\n  return squaredDistance(a[0], a[1], b[0], b[1]);\n}\n\n/**\n * @param {LineCoordType} coordinates The ring coordinates.\n * @param {number} index The index.  May be wrapped.\n * @return {import(\"../coordinate.js\").Coordinate} The coordinate.\n */\nfunction getCoordinate(coordinates, index) {\n  const count = coordinates.length;\n  if (index < 0) {\n    return coordinates[index + count];\n  }\n  if (index >= count) {\n    return coordinates[index - count];\n  }\n  return coordinates[index];\n}\n\n/**\n * Get the cumulative squared distance along a ring path.  The end index index may be \"wrapped\" and it may\n * be less than the start index to indicate the direction of travel.  The start and end index may have\n * a fractional part to indicate a point between two coordinates.\n * @param {LineCoordType} coordinates Ring coordinates.\n * @param {number} startIndex The start index.\n * @param {number} endIndex The end index.\n * @return {number} The cumulative squared distance along the ring path.\n */\nfunction getCumulativeSquaredDistance(coordinates, startIndex, endIndex) {\n  let lowIndex, highIndex;\n  if (startIndex < endIndex) {\n    lowIndex = startIndex;\n    highIndex = endIndex;\n  } else {\n    lowIndex = endIndex;\n    highIndex = startIndex;\n  }\n  const lowWholeIndex = Math.ceil(lowIndex);\n  const highWholeIndex = Math.floor(highIndex);\n\n  if (lowWholeIndex > highWholeIndex) {\n    // both start and end are on the same segment\n    const start = interpolateCoordinate(coordinates, lowIndex);\n    const end = interpolateCoordinate(coordinates, highIndex);\n    return getSquaredDistance(start, end);\n  }\n\n  let sd = 0;\n\n  if (lowIndex < lowWholeIndex) {\n    const start = interpolateCoordinate(coordinates, lowIndex);\n    const end = getCoordinate(coordinates, lowWholeIndex);\n    sd += getSquaredDistance(start, end);\n  }\n\n  if (highWholeIndex < highIndex) {\n    const start = getCoordinate(coordinates, highWholeIndex);\n    const end = interpolateCoordinate(coordinates, highIndex);\n    sd += getSquaredDistance(start, end);\n  }\n\n  for (let i = lowWholeIndex; i < highWholeIndex - 1; ++i) {\n    const start = getCoordinate(coordinates, i);\n    const end = getCoordinate(coordinates, i + 1);\n    sd += getSquaredDistance(start, end);\n  }\n\n  return sd;\n}\n\n/**\n * @param {import(\"../coordinate.js\").Coordinate} coordinate The coordinate.\n * @param {import(\"../geom/Geometry.js\").default} geometry The candidate geometry.\n * @param {Array<TraceTarget>} targets The trace targets.\n */\nfunction appendGeometryTraceTargets(coordinate, geometry, targets) {\n  if (geometry instanceof LineString) {\n    appendTraceTarget(coordinate, geometry.getCoordinates(), false, targets);\n    return;\n  }\n  if (geometry instanceof MultiLineString) {\n    const coordinates = geometry.getCoordinates();\n    for (let i = 0, ii = coordinates.length; i < ii; ++i) {\n      appendTraceTarget(coordinate, coordinates[i], false, targets);\n    }\n    return;\n  }\n  if (geometry instanceof Polygon) {\n    const coordinates = geometry.getCoordinates();\n    for (let i = 0, ii = coordinates.length; i < ii; ++i) {\n      appendTraceTarget(coordinate, coordinates[i], true, targets);\n    }\n    return;\n  }\n  if (geometry instanceof MultiPolygon) {\n    const polys = geometry.getCoordinates();\n    for (let i = 0, ii = polys.length; i < ii; ++i) {\n      const coordinates = polys[i];\n      for (let j = 0, jj = coordinates.length; j < jj; ++j) {\n        appendTraceTarget(coordinate, coordinates[j], true, targets);\n      }\n    }\n    return;\n  }\n  if (geometry instanceof GeometryCollection) {\n    const geometries = geometry.getGeometries();\n    for (let i = 0; i < geometries.length; ++i) {\n      appendGeometryTraceTargets(coordinate, geometries[i], targets);\n    }\n    return;\n  }\n  // other types cannot be traced\n}\n\n/**\n * @typedef {Object} TraceTargetUpdateInfo\n * @property {number} index The new target index.\n * @property {number} endIndex The new segment end index.\n */\n\n/**\n * @type {TraceTargetUpdateInfo}\n */\nconst sharedUpdateInfo = {index: -1, endIndex: NaN};\n\n/**\n * @param {import(\"../coordinate.js\").Coordinate} coordinate The coordinate.\n * @param {TraceState} traceState The trace state.\n * @param {import(\"../Map.js\").default} map The map.\n * @param {number} snapTolerance The snap tolerance.\n * @return {TraceTargetUpdateInfo} Information about the new trace target.  The returned\n * object is reused between calls and must not be modified by the caller.\n */\nfunction getTraceTargetUpdate(coordinate, traceState, map, snapTolerance) {\n  const x = coordinate[0];\n  const y = coordinate[1];\n\n  let closestTargetDistance = Infinity;\n\n  let newTargetIndex = -1;\n  let newEndIndex = NaN;\n\n  for (\n    let targetIndex = 0;\n    targetIndex < traceState.targets.length;\n    ++targetIndex\n  ) {\n    const target = traceState.targets[targetIndex];\n    const coordinates = target.coordinates;\n\n    let minSegmentDistance = Infinity;\n    let endIndex;\n    for (\n      let coordinateIndex = 0;\n      coordinateIndex < coordinates.length - 1;\n      ++coordinateIndex\n    ) {\n      const start = coordinates[coordinateIndex];\n      const end = coordinates[coordinateIndex + 1];\n      const rel = getPointSegmentRelationship(x, y, start, end);\n      if (rel.squaredDistance < minSegmentDistance) {\n        minSegmentDistance = rel.squaredDistance;\n        endIndex = coordinateIndex + rel.along;\n      }\n    }\n\n    if (minSegmentDistance < closestTargetDistance) {\n      closestTargetDistance = minSegmentDistance;\n      if (target.ring && traceState.targetIndex === targetIndex) {\n        // same target, maintain the same trace direction\n        if (target.endIndex > target.startIndex) {\n          // forward trace\n          if (endIndex < target.startIndex) {\n            endIndex += coordinates.length;\n          }\n        } else if (target.endIndex < target.startIndex) {\n          // reverse trace\n          if (endIndex > target.startIndex) {\n            endIndex -= coordinates.length;\n          }\n        }\n      }\n      newEndIndex = endIndex;\n      newTargetIndex = targetIndex;\n    }\n  }\n\n  const newTarget = traceState.targets[newTargetIndex];\n  let considerBothDirections = newTarget.ring;\n  if (traceState.targetIndex === newTargetIndex && considerBothDirections) {\n    // only consider switching trace direction if close to the start\n    const newCoordinate = interpolateCoordinate(\n      newTarget.coordinates,\n      newEndIndex,\n    );\n    const pixel = map.getPixelFromCoordinate(newCoordinate);\n    if (distance(pixel, traceState.startPx) > snapTolerance) {\n      considerBothDirections = false;\n    }\n  }\n\n  if (considerBothDirections) {\n    const coordinates = newTarget.coordinates;\n    const count = coordinates.length;\n    const startIndex = newTarget.startIndex;\n    const endIndex = newEndIndex;\n    if (startIndex < endIndex) {\n      const forwardDistance = getCumulativeSquaredDistance(\n        coordinates,\n        startIndex,\n        endIndex,\n      );\n      const reverseDistance = getCumulativeSquaredDistance(\n        coordinates,\n        startIndex,\n        endIndex - count,\n      );\n      if (reverseDistance < forwardDistance) {\n        newEndIndex -= count;\n      }\n    } else {\n      const reverseDistance = getCumulativeSquaredDistance(\n        coordinates,\n        startIndex,\n        endIndex,\n      );\n      const forwardDistance = getCumulativeSquaredDistance(\n        coordinates,\n        startIndex,\n        endIndex + count,\n      );\n      if (forwardDistance < reverseDistance) {\n        newEndIndex += count;\n      }\n    }\n  }\n\n  sharedUpdateInfo.index = newTargetIndex;\n  sharedUpdateInfo.endIndex = newEndIndex;\n  return sharedUpdateInfo;\n}\n\n/**\n * @param {import(\"../coordinate.js\").Coordinate} coordinate The clicked coordinate.\n * @param {Array<import(\"../coordinate.js\").Coordinate>} coordinates The geometry component coordinates.\n * @param {boolean} ring The coordinates represent a linear ring.\n * @param {Array<TraceTarget>} targets The trace targets.\n */\nfunction appendTraceTarget(coordinate, coordinates, ring, targets) {\n  const x = coordinate[0];\n  const y = coordinate[1];\n  for (let i = 0, ii = coordinates.length - 1; i < ii; ++i) {\n    const start = coordinates[i];\n    const end = coordinates[i + 1];\n    const rel = getPointSegmentRelationship(x, y, start, end);\n    if (rel.squaredDistance === 0) {\n      const index = i + rel.along;\n      targets.push({\n        coordinates: coordinates,\n        ring: ring,\n        startIndex: index,\n        endIndex: index,\n      });\n      return;\n    }\n  }\n}\n\n/**\n * @typedef {Object} PointSegmentRelationship\n * @property {number} along The closest point expressed as a fraction along the segment length.\n * @property {number} squaredDistance The squared distance of the point to the segment.\n */\n\n/**\n * @type {PointSegmentRelationship}\n */\nconst sharedRel = {along: 0, squaredDistance: 0};\n\n/**\n * @param {number} x The point x.\n * @param {number} y The point y.\n * @param {import(\"../coordinate.js\").Coordinate} start The segment start.\n * @param {import(\"../coordinate.js\").Coordinate} end The segment end.\n * @return {PointSegmentRelationship} The point segment relationship.  The returned object is\n * shared between calls and must not be modified by the caller.\n */\nfunction getPointSegmentRelationship(x, y, start, end) {\n  const x1 = start[0];\n  const y1 = start[1];\n  const x2 = end[0];\n  const y2 = end[1];\n  const dx = x2 - x1;\n  const dy = y2 - y1;\n  let along = 0;\n  let px = x1;\n  let py = y1;\n  if (dx !== 0 || dy !== 0) {\n    along = clamp(((x - x1) * dx + (y - y1) * dy) / (dx * dx + dy * dy), 0, 1);\n    px += dx * along;\n    py += dy * along;\n  }\n\n  sharedRel.along = along;\n  sharedRel.squaredDistance = toFixed(squaredDistance(x, y, px, py), 10);\n  return sharedRel;\n}\n\n/**\n * @param {LineCoordType} coordinates The coordinates.\n * @param {number} index The index.  May be fractional and may wrap.\n * @return {import(\"../coordinate.js\").Coordinate} The interpolated coordinate.\n */\nfunction interpolateCoordinate(coordinates, index) {\n  const count = coordinates.length;\n\n  let startIndex = Math.floor(index);\n  const along = index - startIndex;\n  if (startIndex >= count) {\n    startIndex -= count;\n  } else if (startIndex < 0) {\n    startIndex += count;\n  }\n\n  let endIndex = startIndex + 1;\n  if (endIndex >= count) {\n    endIndex -= count;\n  }\n\n  const start = coordinates[startIndex];\n  const x0 = start[0];\n  const y0 = start[1];\n  const end = coordinates[endIndex];\n  const dx = end[0] - x0;\n  const dy = end[1] - y0;\n\n  return [x0 + dx * along, y0 + dy * along];\n}\n\n/***\n * @template Return\n * @typedef {import(\"../Observable\").OnSignature<import(\"../Observable\").EventTypes, import(\"../events/Event.js\").default, Return> &\n *   import(\"../Observable\").OnSignature<import(\"../ObjectEventType\").Types|\n *     'change:active', import(\"../Object\").ObjectEvent, Return> &\n *   import(\"../Observable\").OnSignature<'drawabort'|'drawend'|'drawstart', DrawEvent, Return> &\n *   import(\"../Observable\").CombinedOnSignature<import(\"../Observable\").EventTypes|import(\"../ObjectEventType\").Types|\n *     'change:active'|'drawabort'|'drawend'|'drawstart', Return>} DrawOnSignature\n */\n\n/**\n * @classdesc\n * Interaction for drawing feature geometries.\n *\n * @fires DrawEvent\n * @api\n */\nclass Draw extends PointerInteraction {\n  /**\n   * @param {Options} options Options.\n   */\n  constructor(options) {\n    const pointerOptions = /** @type {import(\"./Pointer.js\").Options} */ (\n      options\n    );\n    if (!pointerOptions.stopDown) {\n      pointerOptions.stopDown = FALSE;\n    }\n\n    super(pointerOptions);\n\n    /***\n     * @type {DrawOnSignature<import(\"../events\").EventsKey>}\n     */\n    this.on;\n\n    /***\n     * @type {DrawOnSignature<import(\"../events\").EventsKey>}\n     */\n    this.once;\n\n    /***\n     * @type {DrawOnSignature<void>}\n     */\n    this.un;\n\n    /**\n     * @type {boolean}\n     * @private\n     */\n    this.shouldHandle_ = false;\n\n    /**\n     * @type {import(\"../pixel.js\").Pixel}\n     * @private\n     */\n    this.downPx_ = null;\n\n    /**\n     * @type {ReturnType<typeof setTimeout>}\n     * @private\n     */\n    this.downTimeout_;\n\n    /**\n     * @type {number|undefined}\n     * @private\n     */\n    this.lastDragTime_;\n\n    /**\n     * Pointer type of the last pointermove event\n     * @type {string}\n     * @private\n     */\n    this.pointerType_;\n\n    /**\n     * @type {boolean}\n     * @private\n     */\n    this.freehand_ = false;\n\n    /**\n     * Target source for drawn features.\n     * @type {VectorSource|null}\n     * @private\n     */\n    this.source_ = options.source ? options.source : null;\n\n    /**\n     * Target collection for drawn features.\n     * @type {import(\"../Collection.js\").default<Feature>|null}\n     * @private\n     */\n    this.features_ = options.features ? options.features : null;\n\n    /**\n     * Pixel distance for snapping.\n     * @type {number}\n     * @private\n     */\n    this.snapTolerance_ = options.snapTolerance ? options.snapTolerance : 12;\n\n    /**\n     * Geometry type.\n     * @type {import(\"../geom/Geometry.js\").Type}\n     * @private\n     */\n    this.type_ = /** @type {import(\"../geom/Geometry.js\").Type} */ (\n      options.type\n    );\n\n    /**\n     * Drawing mode (derived from geometry type.\n     * @type {Mode}\n     * @private\n     */\n    this.mode_ = getMode(this.type_);\n\n    /**\n     * Stop click, singleclick, and doubleclick events from firing during drawing.\n     * Default is `false`.\n     * @type {boolean}\n     * @private\n     */\n    this.stopClick_ = !!options.stopClick;\n\n    /**\n     * The number of points that must be drawn before a polygon ring or line\n     * string can be finished.  The default is 3 for polygon rings and 2 for\n     * line strings.\n     * @type {number}\n     * @private\n     */\n    this.minPoints_ = options.minPoints\n      ? options.minPoints\n      : this.mode_ === 'Polygon'\n        ? 3\n        : 2;\n\n    /**\n     * The number of points that can be drawn before a polygon ring or line string\n     * is finished. The default is no restriction.\n     * @type {number}\n     * @private\n     */\n    this.maxPoints_ =\n      this.mode_ === 'Circle'\n        ? 2\n        : options.maxPoints\n          ? options.maxPoints\n          : Infinity;\n\n    /**\n     * A function to decide if a potential finish coordinate is permissible\n     * @private\n     * @type {import(\"../events/condition.js\").Condition}\n     */\n    this.finishCondition_ = options.finishCondition\n      ? options.finishCondition\n      : TRUE;\n\n    /**\n     * @private\n     * @type {import(\"../geom/Geometry.js\").GeometryLayout}\n     */\n    this.geometryLayout_ = options.geometryLayout\n      ? options.geometryLayout\n      : 'XY';\n\n    let geometryFunction = options.geometryFunction;\n    if (!geometryFunction) {\n      const mode = this.mode_;\n      if (mode === 'Circle') {\n        /**\n         * @param {!LineCoordType} coordinates The coordinates.\n         * @param {import(\"../geom/SimpleGeometry.js\").default|undefined} geometry Optional geometry.\n         * @param {import(\"../proj/Projection.js\").default} projection The view projection.\n         * @return {import(\"../geom/SimpleGeometry.js\").default} A geometry.\n         */\n        geometryFunction = (coordinates, geometry, projection) => {\n          const circle = geometry\n            ? /** @type {Circle} */ (geometry)\n            : new Circle([NaN, NaN]);\n          const center = fromUserCoordinate(coordinates[0], projection);\n          const squaredLength = squaredCoordinateDistance(\n            center,\n            fromUserCoordinate(coordinates[coordinates.length - 1], projection),\n          );\n          circle.setCenterAndRadius(\n            center,\n            Math.sqrt(squaredLength),\n            this.geometryLayout_,\n          );\n          const userProjection = getUserProjection();\n          if (userProjection) {\n            circle.transform(projection, userProjection);\n          }\n          return circle;\n        };\n      } else {\n        let Constructor;\n        if (mode === 'Point') {\n          Constructor = Point;\n        } else if (mode === 'LineString') {\n          Constructor = LineString;\n        } else if (mode === 'Polygon') {\n          Constructor = Polygon;\n        }\n        /**\n         * @param {!LineCoordType} coordinates The coordinates.\n         * @param {import(\"../geom/SimpleGeometry.js\").default|undefined} geometry Optional geometry.\n         * @param {import(\"../proj/Projection.js\").default} projection The view projection.\n         * @return {import(\"../geom/SimpleGeometry.js\").default} A geometry.\n         */\n        geometryFunction = (coordinates, geometry, projection) => {\n          if (geometry) {\n            if (mode === 'Polygon') {\n              if (coordinates[0].length) {\n                // Add a closing coordinate to match the first\n                geometry.setCoordinates(\n                  [coordinates[0].concat([coordinates[0][0]])],\n                  this.geometryLayout_,\n                );\n              } else {\n                geometry.setCoordinates([], this.geometryLayout_);\n              }\n            } else {\n              geometry.setCoordinates(coordinates, this.geometryLayout_);\n            }\n          } else {\n            geometry = new Constructor(coordinates, this.geometryLayout_);\n          }\n          return geometry;\n        };\n      }\n    }\n\n    /**\n     * @type {GeometryFunction}\n     * @private\n     */\n    this.geometryFunction_ = geometryFunction;\n\n    /**\n     * @type {number}\n     * @private\n     */\n    this.dragVertexDelay_ =\n      options.dragVertexDelay !== undefined ? options.dragVertexDelay : 500;\n\n    /**\n     * Finish coordinate for the feature (first point for polygons, last point for\n     * linestrings).\n     * @type {import(\"../coordinate.js\").Coordinate}\n     * @private\n     */\n    this.finishCoordinate_ = null;\n\n    /**\n     * Sketch feature.\n     * @type {Feature<import('../geom/SimpleGeometry.js').default>}\n     * @private\n     */\n    this.sketchFeature_ = null;\n\n    /**\n     * Sketch point.\n     * @type {Feature<Point>}\n     * @private\n     */\n    this.sketchPoint_ = null;\n\n    /**\n     * Sketch coordinates. Used when drawing a line or polygon.\n     * @type {SketchCoordType}\n     * @private\n     */\n    this.sketchCoords_ = null;\n\n    /**\n     * Sketch line. Used when drawing polygon.\n     * @type {Feature<LineString>}\n     * @private\n     */\n    this.sketchLine_ = null;\n\n    /**\n     * Sketch line coordinates. Used when drawing a polygon or circle.\n     * @type {LineCoordType}\n     * @private\n     */\n    this.sketchLineCoords_ = null;\n\n    /**\n     * Squared tolerance for handling up events.  If the squared distance\n     * between a down and up event is greater than this tolerance, up events\n     * will not be handled.\n     * @type {number}\n     * @private\n     */\n    this.squaredClickTolerance_ = options.clickTolerance\n      ? options.clickTolerance * options.clickTolerance\n      : 36;\n\n    /**\n     * Draw overlay where our sketch features are drawn.\n     * @type {VectorLayer}\n     * @private\n     */\n    this.overlay_ = new VectorLayer({\n      source: new VectorSource({\n        useSpatialIndex: false,\n        wrapX: options.wrapX ? options.wrapX : false,\n      }),\n      style: options.style ? options.style : getDefaultStyleFunction(),\n      updateWhileInteracting: true,\n    });\n\n    /**\n     * Name of the geometry attribute for newly created features.\n     * @type {string|undefined}\n     * @private\n     */\n    this.geometryName_ = options.geometryName;\n\n    /**\n     * @private\n     * @type {import(\"../events/condition.js\").Condition}\n     */\n    this.condition_ = options.condition ? options.condition : noModifierKeys;\n\n    /**\n     * @private\n     * @type {import(\"../events/condition.js\").Condition}\n     */\n    this.freehandCondition_;\n    if (options.freehand) {\n      this.freehandCondition_ = always;\n    } else {\n      this.freehandCondition_ = options.freehandCondition\n        ? options.freehandCondition\n        : shiftKeyOnly;\n    }\n\n    /**\n     * @type {import(\"../events/condition.js\").Condition}\n     * @private\n     */\n    this.traceCondition_;\n    this.setTrace(options.trace || false);\n\n    /**\n     * @type {TraceState}\n     * @private\n     */\n    this.traceState_ = {active: false};\n\n    /**\n     * @type {VectorSource|null}\n     * @private\n     */\n    this.traceSource_ = options.traceSource || options.source || null;\n\n    this.addChangeListener(InteractionProperty.ACTIVE, this.updateState_);\n  }\n\n  /**\n   * Toggle tracing mode or set a tracing condition.\n   *\n   * @param {boolean|import(\"../events/condition.js\").Condition} trace A boolean to toggle tracing mode or an event\n   *     condition that will be checked when a feature is clicked to determine if tracing should be active.\n   */\n  setTrace(trace) {\n    let condition;\n    if (!trace) {\n      condition = never;\n    } else if (trace === true) {\n      condition = always;\n    } else {\n      condition = trace;\n    }\n    this.traceCondition_ = condition;\n  }\n\n  /**\n   * Remove the interaction from its current map and attach it to the new map.\n   * Subclasses may set up event handlers to get notified about changes to\n   * the map here.\n   * @param {import(\"../Map.js\").default} map Map.\n   * @override\n   */\n  setMap(map) {\n    super.setMap(map);\n    this.updateState_();\n  }\n\n  /**\n   * Get the overlay layer that this interaction renders sketch features to.\n   * @return {VectorLayer} Overlay layer.\n   * @api\n   */\n  getOverlay() {\n    return this.overlay_;\n  }\n\n  /**\n   * Handles the {@link module:ol/MapBrowserEvent~MapBrowserEvent map browser event} and may actually draw or finish the drawing.\n   * @param {import(\"../MapBrowserEvent.js\").default<PointerEvent>} event Map browser event.\n   * @return {boolean} `false` to stop event propagation.\n   * @api\n   * @override\n   */\n  handleEvent(event) {\n    if (event.originalEvent.type === EventType.CONTEXTMENU) {\n      // Avoid context menu for long taps when drawing on mobile\n      event.originalEvent.preventDefault();\n    }\n    this.freehand_ = this.mode_ !== 'Point' && this.freehandCondition_(event);\n    let move = event.type === MapBrowserEventType.POINTERMOVE;\n    let pass = true;\n    if (\n      !this.freehand_ &&\n      this.lastDragTime_ &&\n      event.type === MapBrowserEventType.POINTERDRAG\n    ) {\n      const now = Date.now();\n      if (now - this.lastDragTime_ >= this.dragVertexDelay_) {\n        this.downPx_ = event.pixel;\n        this.shouldHandle_ = !this.freehand_;\n        move = true;\n      } else {\n        this.lastDragTime_ = undefined;\n      }\n      if (this.shouldHandle_ && this.downTimeout_ !== undefined) {\n        clearTimeout(this.downTimeout_);\n        this.downTimeout_ = undefined;\n      }\n    }\n    if (\n      this.freehand_ &&\n      event.type === MapBrowserEventType.POINTERDRAG &&\n      this.sketchFeature_ !== null\n    ) {\n      this.addToDrawing_(event.coordinate);\n      pass = false;\n    } else if (\n      this.freehand_ &&\n      event.type === MapBrowserEventType.POINTERDOWN\n    ) {\n      pass = false;\n    } else if (move && this.getPointerCount() < 2) {\n      pass = event.type === MapBrowserEventType.POINTERMOVE;\n      if (pass && this.freehand_) {\n        this.handlePointerMove_(event);\n        if (this.shouldHandle_) {\n          // Avoid page scrolling when freehand drawing on mobile\n          event.originalEvent.preventDefault();\n        }\n      } else if (\n        event.originalEvent.pointerType === 'mouse' ||\n        (event.type === MapBrowserEventType.POINTERDRAG &&\n          this.downTimeout_ === undefined)\n      ) {\n        this.handlePointerMove_(event);\n      }\n    } else if (event.type === MapBrowserEventType.DBLCLICK) {\n      pass = false;\n    }\n\n    return super.handleEvent(event) && pass;\n  }\n\n  /**\n   * Handle pointer down events.\n   * @param {import(\"../MapBrowserEvent.js\").default<PointerEvent>} event Event.\n   * @return {boolean} If the event was consumed.\n   * @override\n   */\n  handleDownEvent(event) {\n    this.shouldHandle_ = !this.freehand_;\n\n    if (this.freehand_) {\n      this.downPx_ = event.pixel;\n      if (!this.finishCoordinate_) {\n        this.startDrawing_(event.coordinate);\n      }\n      return true;\n    }\n\n    if (!this.condition_(event)) {\n      this.lastDragTime_ = undefined;\n      return false;\n    }\n\n    this.lastDragTime_ = Date.now();\n    this.downTimeout_ = setTimeout(() => {\n      this.handlePointerMove_(\n        new MapBrowserEvent(\n          MapBrowserEventType.POINTERMOVE,\n          event.map,\n          event.originalEvent,\n          false,\n          event.frameState,\n        ),\n      );\n    }, this.dragVertexDelay_);\n    this.downPx_ = event.pixel;\n    return true;\n  }\n\n  /**\n   * @private\n   */\n  deactivateTrace_() {\n    this.traceState_ = {active: false};\n  }\n\n  /**\n   * Activate or deactivate trace state based on a browser event.\n   * @param {import(\"../MapBrowserEvent.js\").default} event Event.\n   * @private\n   */\n  toggleTraceState_(event) {\n    if (!this.traceSource_ || !this.traceCondition_(event)) {\n      return;\n    }\n\n    if (this.traceState_.active) {\n      this.deactivateTrace_();\n      return;\n    }\n\n    const map = this.getMap();\n    const lowerLeft = map.getCoordinateFromPixel([\n      event.pixel[0] - this.snapTolerance_,\n      event.pixel[1] + this.snapTolerance_,\n    ]);\n    const upperRight = map.getCoordinateFromPixel([\n      event.pixel[0] + this.snapTolerance_,\n      event.pixel[1] - this.snapTolerance_,\n    ]);\n    const extent = boundingExtent([lowerLeft, upperRight]);\n    const features = this.traceSource_.getFeaturesInExtent(extent);\n    if (features.length === 0) {\n      return;\n    }\n\n    const targets = getTraceTargets(event.coordinate, features);\n    if (targets.length) {\n      this.traceState_ = {\n        active: true,\n        startPx: event.pixel.slice(),\n        targets: targets,\n        targetIndex: -1,\n      };\n    }\n  }\n\n  /**\n   * @param {TraceTarget} target The trace target.\n   * @param {number} endIndex The new end index of the trace.\n   * @private\n   */\n  addOrRemoveTracedCoordinates_(target, endIndex) {\n    // three cases to handle:\n    //  1. traced in the same direction and points need adding\n    //  2. traced in the same direction and points need removing\n    //  3. traced in a new direction\n    const previouslyForward = target.startIndex <= target.endIndex;\n    const currentlyForward = target.startIndex <= endIndex;\n    if (previouslyForward === currentlyForward) {\n      // same direction\n      if (\n        (previouslyForward && endIndex > target.endIndex) ||\n        (!previouslyForward && endIndex < target.endIndex)\n      ) {\n        // case 1 - add new points\n        this.addTracedCoordinates_(target, target.endIndex, endIndex);\n      } else if (\n        (previouslyForward && endIndex < target.endIndex) ||\n        (!previouslyForward && endIndex > target.endIndex)\n      ) {\n        // case 2 - remove old points\n        this.removeTracedCoordinates_(endIndex, target.endIndex);\n      }\n    } else {\n      // case 3 - remove old points, add new points\n      this.removeTracedCoordinates_(target.startIndex, target.endIndex);\n      this.addTracedCoordinates_(target, target.startIndex, endIndex);\n    }\n  }\n\n  /**\n   * @param {number} fromIndex The start index.\n   * @param {number} toIndex The end index.\n   * @private\n   */\n  removeTracedCoordinates_(fromIndex, toIndex) {\n    if (fromIndex === toIndex) {\n      return;\n    }\n\n    let remove = 0;\n    if (fromIndex < toIndex) {\n      const start = Math.ceil(fromIndex);\n      let end = Math.floor(toIndex);\n      if (end === toIndex) {\n        end -= 1;\n      }\n      remove = end - start + 1;\n    } else {\n      const start = Math.floor(fromIndex);\n      let end = Math.ceil(toIndex);\n      if (end === toIndex) {\n        end += 1;\n      }\n      remove = start - end + 1;\n    }\n\n    if (remove > 0) {\n      this.removeLastPoints_(remove);\n    }\n  }\n\n  /**\n   * @param {TraceTarget} target The trace target.\n   * @param {number} fromIndex The start index.\n   * @param {number} toIndex The end index.\n   * @private\n   */\n  addTracedCoordinates_(target, fromIndex, toIndex) {\n    if (fromIndex === toIndex) {\n      return;\n    }\n\n    const coordinates = [];\n    if (fromIndex < toIndex) {\n      // forward trace\n      const start = Math.ceil(fromIndex);\n      let end = Math.floor(toIndex);\n      if (end === toIndex) {\n        // if end is snapped to a vertex, it will be added later\n        end -= 1;\n      }\n      for (let i = start; i <= end; ++i) {\n        coordinates.push(getCoordinate(target.coordinates, i));\n      }\n    } else {\n      // reverse trace\n      const start = Math.floor(fromIndex);\n      let end = Math.ceil(toIndex);\n      if (end === toIndex) {\n        end += 1;\n      }\n      for (let i = start; i >= end; --i) {\n        coordinates.push(getCoordinate(target.coordinates, i));\n      }\n    }\n    if (coordinates.length) {\n      this.appendCoordinates(coordinates);\n    }\n  }\n\n  /**\n   * Update the trace.\n   * @param {import(\"../MapBrowserEvent.js\").default} event Event.\n   * @private\n   */\n  updateTrace_(event) {\n    const traceState = this.traceState_;\n    if (!traceState.active) {\n      return;\n    }\n\n    if (traceState.targetIndex === -1) {\n      // check if we are ready to pick a target\n      if (distance(traceState.startPx, event.pixel) < this.snapTolerance_) {\n        return;\n      }\n    }\n\n    const updatedTraceTarget = getTraceTargetUpdate(\n      event.coordinate,\n      traceState,\n      this.getMap(),\n      this.snapTolerance_,\n    );\n\n    if (traceState.targetIndex !== updatedTraceTarget.index) {\n      // target changed\n      if (traceState.targetIndex !== -1) {\n        // remove points added during previous trace\n        const oldTarget = traceState.targets[traceState.targetIndex];\n        this.removeTracedCoordinates_(oldTarget.startIndex, oldTarget.endIndex);\n      }\n      // add points for the new target\n      const newTarget = traceState.targets[updatedTraceTarget.index];\n      this.addTracedCoordinates_(\n        newTarget,\n        newTarget.startIndex,\n        updatedTraceTarget.endIndex,\n      );\n    } else {\n      // target stayed the same\n      const target = traceState.targets[traceState.targetIndex];\n      this.addOrRemoveTracedCoordinates_(target, updatedTraceTarget.endIndex);\n    }\n\n    // modify the state with updated info\n    traceState.targetIndex = updatedTraceTarget.index;\n    const target = traceState.targets[traceState.targetIndex];\n    target.endIndex = updatedTraceTarget.endIndex;\n\n    // update event coordinate and pixel to match end point of final segment\n    const coordinate = interpolateCoordinate(\n      target.coordinates,\n      target.endIndex,\n    );\n    const pixel = this.getMap().getPixelFromCoordinate(coordinate);\n    event.coordinate = coordinate;\n    event.pixel = [Math.round(pixel[0]), Math.round(pixel[1])];\n  }\n\n  /**\n   * Handle pointer up events.\n   * @param {import(\"../MapBrowserEvent.js\").default<PointerEvent>} event Event.\n   * @return {boolean} If the event was consumed.\n   * @override\n   */\n  handleUpEvent(event) {\n    let pass = true;\n\n    if (this.getPointerCount() === 0) {\n      if (this.downTimeout_) {\n        clearTimeout(this.downTimeout_);\n        this.downTimeout_ = undefined;\n      }\n\n      this.handlePointerMove_(event);\n      const tracing = this.traceState_.active;\n      this.toggleTraceState_(event);\n\n      if (this.shouldHandle_) {\n        const startingToDraw = !this.finishCoordinate_;\n        if (startingToDraw) {\n          this.startDrawing_(event.coordinate);\n        }\n        if (!startingToDraw && this.freehand_) {\n          this.finishDrawing();\n        } else if (\n          !this.freehand_ &&\n          (!startingToDraw || this.mode_ === 'Point')\n        ) {\n          if (this.atFinish_(event.pixel, tracing)) {\n            if (this.finishCondition_(event)) {\n              this.finishDrawing();\n            }\n          } else {\n            this.addToDrawing_(event.coordinate);\n          }\n        }\n        pass = false;\n      } else if (this.freehand_) {\n        this.abortDrawing();\n      }\n    }\n\n    if (!pass && this.stopClick_) {\n      event.preventDefault();\n    }\n    return pass;\n  }\n\n  /**\n   * Handle move events.\n   * @param {import(\"../MapBrowserEvent.js\").default<PointerEvent>} event A move event.\n   * @private\n   */\n  handlePointerMove_(event) {\n    this.pointerType_ = event.originalEvent.pointerType;\n    if (\n      this.downPx_ &&\n      ((!this.freehand_ && this.shouldHandle_) ||\n        (this.freehand_ && !this.shouldHandle_))\n    ) {\n      const downPx = this.downPx_;\n      const clickPx = event.pixel;\n      const dx = downPx[0] - clickPx[0];\n      const dy = downPx[1] - clickPx[1];\n      const squaredDistance = dx * dx + dy * dy;\n      this.shouldHandle_ = this.freehand_\n        ? squaredDistance > this.squaredClickTolerance_\n        : squaredDistance <= this.squaredClickTolerance_;\n      if (!this.shouldHandle_) {\n        return;\n      }\n    }\n\n    if (!this.finishCoordinate_) {\n      this.createOrUpdateSketchPoint_(event.coordinate.slice());\n      return;\n    }\n\n    this.updateTrace_(event);\n    this.modifyDrawing_(event.coordinate);\n  }\n\n  /**\n   * Determine if an event is within the snapping tolerance of the start coord.\n   * @param {import(\"../pixel.js\").Pixel} pixel Pixel.\n   * @param {boolean} [tracing] Drawing in trace mode (only stop if at the starting point).\n   * @return {boolean} The event is within the snapping tolerance of the start.\n   * @private\n   */\n  atFinish_(pixel, tracing) {\n    let at = false;\n    if (this.sketchFeature_) {\n      let potentiallyDone = false;\n      let potentiallyFinishCoordinates = [this.finishCoordinate_];\n      const mode = this.mode_;\n      if (mode === 'Point') {\n        at = true;\n      } else if (mode === 'Circle') {\n        at = this.sketchCoords_.length === 2;\n      } else if (mode === 'LineString') {\n        potentiallyDone =\n          !tracing && this.sketchCoords_.length > this.minPoints_;\n      } else if (mode === 'Polygon') {\n        const sketchCoords = /** @type {PolyCoordType} */ (this.sketchCoords_);\n        potentiallyDone = sketchCoords[0].length > this.minPoints_;\n        potentiallyFinishCoordinates = [\n          sketchCoords[0][0],\n          sketchCoords[0][sketchCoords[0].length - 2],\n        ];\n        if (tracing) {\n          potentiallyFinishCoordinates = [sketchCoords[0][0]];\n        } else {\n          potentiallyFinishCoordinates = [\n            sketchCoords[0][0],\n            sketchCoords[0][sketchCoords[0].length - 2],\n          ];\n        }\n      }\n      if (potentiallyDone) {\n        const map = this.getMap();\n        for (let i = 0, ii = potentiallyFinishCoordinates.length; i < ii; i++) {\n          const finishCoordinate = potentiallyFinishCoordinates[i];\n          const finishPixel = map.getPixelFromCoordinate(finishCoordinate);\n          const dx = pixel[0] - finishPixel[0];\n          const dy = pixel[1] - finishPixel[1];\n          const snapTolerance = this.freehand_ ? 1 : this.snapTolerance_;\n          at = Math.sqrt(dx * dx + dy * dy) <= snapTolerance;\n          if (at) {\n            this.finishCoordinate_ = finishCoordinate;\n            break;\n          }\n        }\n      }\n    }\n    return at;\n  }\n\n  /**\n   * @param {import(\"../coordinate\").Coordinate} coordinates Coordinate.\n   * @private\n   */\n  createOrUpdateSketchPoint_(coordinates) {\n    if (!this.sketchPoint_) {\n      this.sketchPoint_ = new Feature(new Point(coordinates));\n      this.updateSketchFeatures_();\n    } else {\n      const sketchPointGeom = this.sketchPoint_.getGeometry();\n      sketchPointGeom.setCoordinates(coordinates);\n    }\n  }\n\n  /**\n   * @param {import(\"../geom/Polygon.js\").default} geometry Polygon geometry.\n   * @private\n   */\n  createOrUpdateCustomSketchLine_(geometry) {\n    if (!this.sketchLine_) {\n      this.sketchLine_ = new Feature();\n    }\n    const ring = geometry.getLinearRing(0);\n    let sketchLineGeom = this.sketchLine_.getGeometry();\n    if (!sketchLineGeom) {\n      sketchLineGeom = new LineString(\n        ring.getFlatCoordinates(),\n        ring.getLayout(),\n      );\n      this.sketchLine_.setGeometry(sketchLineGeom);\n    } else {\n      sketchLineGeom.setFlatCoordinates(\n        ring.getLayout(),\n        ring.getFlatCoordinates(),\n      );\n      sketchLineGeom.changed();\n    }\n  }\n\n  /**\n   * Start the drawing.\n   * @param {import(\"../coordinate.js\").Coordinate} start Start coordinate.\n   * @private\n   */\n  startDrawing_(start) {\n    const projection = this.getMap().getView().getProjection();\n    const stride = getStrideForLayout(this.geometryLayout_);\n    while (start.length < stride) {\n      start.push(0);\n    }\n    this.finishCoordinate_ = start;\n    if (this.mode_ === 'Point') {\n      this.sketchCoords_ = start.slice();\n    } else if (this.mode_ === 'Polygon') {\n      this.sketchCoords_ = [[start.slice(), start.slice()]];\n      this.sketchLineCoords_ = this.sketchCoords_[0];\n    } else {\n      this.sketchCoords_ = [start.slice(), start.slice()];\n    }\n    if (this.sketchLineCoords_) {\n      this.sketchLine_ = new Feature(new LineString(this.sketchLineCoords_));\n    }\n    const geometry = this.geometryFunction_(\n      this.sketchCoords_,\n      undefined,\n      projection,\n    );\n    this.sketchFeature_ = new Feature();\n    if (this.geometryName_) {\n      this.sketchFeature_.setGeometryName(this.geometryName_);\n    }\n    this.sketchFeature_.setGeometry(geometry);\n    this.updateSketchFeatures_();\n    this.dispatchEvent(\n      new DrawEvent(DrawEventType.DRAWSTART, this.sketchFeature_),\n    );\n  }\n\n  /**\n   * Modify the drawing.\n   * @param {import(\"../coordinate.js\").Coordinate} coordinate Coordinate.\n   * @private\n   */\n  modifyDrawing_(coordinate) {\n    const map = this.getMap();\n    const geometry = this.sketchFeature_.getGeometry();\n    const projection = map.getView().getProjection();\n    const stride = getStrideForLayout(this.geometryLayout_);\n    let coordinates, last;\n    while (coordinate.length < stride) {\n      coordinate.push(0);\n    }\n    if (this.mode_ === 'Point') {\n      last = this.sketchCoords_;\n    } else if (this.mode_ === 'Polygon') {\n      coordinates = /** @type {PolyCoordType} */ (this.sketchCoords_)[0];\n      last = coordinates[coordinates.length - 1];\n      if (this.atFinish_(map.getPixelFromCoordinate(coordinate))) {\n        // snap to finish\n        coordinate = this.finishCoordinate_.slice();\n      }\n    } else {\n      coordinates = this.sketchCoords_;\n      last = coordinates[coordinates.length - 1];\n    }\n    last[0] = coordinate[0];\n    last[1] = coordinate[1];\n    this.geometryFunction_(\n      /** @type {!LineCoordType} */ (this.sketchCoords_),\n      geometry,\n      projection,\n    );\n    if (this.sketchPoint_) {\n      const sketchPointGeom = this.sketchPoint_.getGeometry();\n      sketchPointGeom.setCoordinates(coordinate);\n    }\n    if (geometry.getType() === 'Polygon' && this.mode_ !== 'Polygon') {\n      this.createOrUpdateCustomSketchLine_(/** @type {Polygon} */ (geometry));\n    } else if (this.sketchLineCoords_) {\n      const sketchLineGeom = this.sketchLine_.getGeometry();\n      sketchLineGeom.setCoordinates(this.sketchLineCoords_);\n    }\n    this.updateSketchFeatures_();\n  }\n\n  /**\n   * Add a new coordinate to the drawing.\n   * @param {!PointCoordType} coordinate Coordinate\n   * @return {Feature<import(\"../geom/SimpleGeometry.js\").default>} The sketch feature.\n   * @private\n   */\n  addToDrawing_(coordinate) {\n    const geometry = this.sketchFeature_.getGeometry();\n    const projection = this.getMap().getView().getProjection();\n    let done;\n    let coordinates;\n    const mode = this.mode_;\n    if (mode === 'LineString' || mode === 'Circle') {\n      this.finishCoordinate_ = coordinate.slice();\n      coordinates = /** @type {LineCoordType} */ (this.sketchCoords_);\n      if (coordinates.length >= this.maxPoints_) {\n        if (this.freehand_) {\n          coordinates.pop();\n        } else {\n          done = true;\n        }\n      }\n      coordinates.push(coordinate.slice());\n      this.geometryFunction_(coordinates, geometry, projection);\n    } else if (mode === 'Polygon') {\n      coordinates = /** @type {PolyCoordType} */ (this.sketchCoords_)[0];\n      if (coordinates.length >= this.maxPoints_) {\n        if (this.freehand_) {\n          coordinates.pop();\n        } else {\n          done = true;\n        }\n      }\n      coordinates.push(coordinate.slice());\n      if (done) {\n        this.finishCoordinate_ = coordinates[0];\n      }\n      this.geometryFunction_(this.sketchCoords_, geometry, projection);\n    }\n    this.createOrUpdateSketchPoint_(coordinate.slice());\n    this.updateSketchFeatures_();\n    if (done) {\n      return this.finishDrawing();\n    }\n    return this.sketchFeature_;\n  }\n\n  /**\n   * @param {number} n The number of points to remove.\n   */\n  removeLastPoints_(n) {\n    if (!this.sketchFeature_) {\n      return;\n    }\n    const geometry = this.sketchFeature_.getGeometry();\n    const projection = this.getMap().getView().getProjection();\n    const mode = this.mode_;\n    for (let i = 0; i < n; ++i) {\n      let coordinates;\n      if (mode === 'LineString' || mode === 'Circle') {\n        coordinates = /** @type {LineCoordType} */ (this.sketchCoords_);\n        coordinates.splice(-2, 1);\n        if (coordinates.length >= 2) {\n          this.finishCoordinate_ = coordinates[coordinates.length - 2].slice();\n          const finishCoordinate = this.finishCoordinate_.slice();\n          coordinates[coordinates.length - 1] = finishCoordinate;\n          this.createOrUpdateSketchPoint_(finishCoordinate);\n        }\n        this.geometryFunction_(coordinates, geometry, projection);\n        if (geometry.getType() === 'Polygon' && this.sketchLine_) {\n          this.createOrUpdateCustomSketchLine_(\n            /** @type {Polygon} */ (geometry),\n          );\n        }\n      } else if (mode === 'Polygon') {\n        coordinates = /** @type {PolyCoordType} */ (this.sketchCoords_)[0];\n        coordinates.splice(-2, 1);\n        const sketchLineGeom = this.sketchLine_.getGeometry();\n        if (coordinates.length >= 2) {\n          const finishCoordinate = coordinates[coordinates.length - 2].slice();\n          coordinates[coordinates.length - 1] = finishCoordinate;\n          this.createOrUpdateSketchPoint_(finishCoordinate);\n        }\n        sketchLineGeom.setCoordinates(coordinates);\n        this.geometryFunction_(this.sketchCoords_, geometry, projection);\n      }\n\n      if (coordinates.length === 1) {\n        this.abortDrawing();\n        break;\n      }\n    }\n\n    this.updateSketchFeatures_();\n  }\n\n  /**\n   * Remove last point of the feature currently being drawn. Does not do anything when\n   * drawing POINT or MULTI_POINT geometries.\n   * @api\n   */\n  removeLastPoint() {\n    this.removeLastPoints_(1);\n  }\n\n  /**\n   * Stop drawing and add the sketch feature to the target layer.\n   * The {@link module:ol/interaction/Draw~DrawEventType.DRAWEND} event is\n   * dispatched before inserting the feature.\n   * @return {Feature<import(\"../geom/SimpleGeometry.js\").default>|null} The drawn feature.\n   * @api\n   */\n  finishDrawing() {\n    const sketchFeature = this.abortDrawing_();\n    if (!sketchFeature) {\n      return null;\n    }\n    let coordinates = this.sketchCoords_;\n    const geometry = sketchFeature.getGeometry();\n    const projection = this.getMap().getView().getProjection();\n    if (this.mode_ === 'LineString') {\n      // remove the redundant last point\n      coordinates.pop();\n      this.geometryFunction_(coordinates, geometry, projection);\n    } else if (this.mode_ === 'Polygon') {\n      // remove the redundant last point in ring\n      /** @type {PolyCoordType} */ (coordinates)[0].pop();\n      this.geometryFunction_(coordinates, geometry, projection);\n      coordinates = geometry.getCoordinates();\n    }\n\n    // cast multi-part geometries\n    if (this.type_ === 'MultiPoint') {\n      sketchFeature.setGeometry(\n        new MultiPoint([/** @type {PointCoordType} */ (coordinates)]),\n      );\n    } else if (this.type_ === 'MultiLineString') {\n      sketchFeature.setGeometry(\n        new MultiLineString([/** @type {LineCoordType} */ (coordinates)]),\n      );\n    } else if (this.type_ === 'MultiPolygon') {\n      sketchFeature.setGeometry(\n        new MultiPolygon([/** @type {PolyCoordType} */ (coordinates)]),\n      );\n    }\n\n    // First dispatch event to allow full set up of feature\n    this.dispatchEvent(new DrawEvent(DrawEventType.DRAWEND, sketchFeature));\n\n    // Then insert feature\n    if (this.features_) {\n      this.features_.push(sketchFeature);\n    }\n    if (this.source_) {\n      this.source_.addFeature(sketchFeature);\n    }\n    return sketchFeature;\n  }\n\n  /**\n   * Stop drawing without adding the sketch feature to the target layer.\n   * @return {Feature<import(\"../geom/SimpleGeometry.js\").default>|null} The sketch feature (or null if none).\n   * @private\n   */\n  abortDrawing_() {\n    this.finishCoordinate_ = null;\n    const sketchFeature = this.sketchFeature_;\n    this.sketchFeature_ = null;\n    this.sketchPoint_ = null;\n    this.sketchLine_ = null;\n    this.overlay_.getSource().clear(true);\n    this.deactivateTrace_();\n    return sketchFeature;\n  }\n\n  /**\n   * Stop drawing without adding the sketch feature to the target layer.\n   * @api\n   */\n  abortDrawing() {\n    const sketchFeature = this.abortDrawing_();\n    if (sketchFeature) {\n      this.dispatchEvent(new DrawEvent(DrawEventType.DRAWABORT, sketchFeature));\n    }\n  }\n\n  /**\n   * Append coordinates to the end of the geometry that is currently being drawn.\n   * This can be used when drawing LineStrings or Polygons. Coordinates will\n   * either be appended to the current LineString or the outer ring of the current\n   * Polygon. If no geometry is being drawn, a new one will be created.\n   * @param {!LineCoordType} coordinates Linear coordinates to be appended to\n   * the coordinate array.\n   * @api\n   */\n  appendCoordinates(coordinates) {\n    const mode = this.mode_;\n    const newDrawing = !this.sketchFeature_;\n    if (newDrawing) {\n      this.startDrawing_(coordinates[0]);\n    }\n    /** @type {LineCoordType} */\n    let sketchCoords;\n    if (mode === 'LineString' || mode === 'Circle') {\n      sketchCoords = /** @type {LineCoordType} */ (this.sketchCoords_);\n    } else if (mode === 'Polygon') {\n      sketchCoords =\n        this.sketchCoords_ && this.sketchCoords_.length\n          ? /** @type {PolyCoordType} */ (this.sketchCoords_)[0]\n          : [];\n    } else {\n      return;\n    }\n\n    if (newDrawing) {\n      sketchCoords.shift();\n    }\n\n    // Remove last coordinate from sketch drawing (this coordinate follows cursor position)\n    sketchCoords.pop();\n\n    // Append coordinate list\n    for (let i = 0; i < coordinates.length; i++) {\n      this.addToDrawing_(coordinates[i]);\n    }\n\n    const ending = coordinates[coordinates.length - 1];\n    // Duplicate last coordinate for sketch drawing (cursor position)\n    this.sketchFeature_ = this.addToDrawing_(ending);\n    this.modifyDrawing_(ending);\n  }\n\n  /**\n   * Initiate draw mode by starting from an existing geometry which will\n   * receive new additional points. This only works on features with\n   * `LineString` geometries, where the interaction will extend lines by adding\n   * points to the end of the coordinates array.\n   * This will change the original feature, instead of drawing a copy.\n   *\n   * The function will dispatch a `drawstart` event.\n   *\n   * @param {!Feature<LineString>} feature Feature to be extended.\n   * @api\n   */\n  extend(feature) {\n    const geometry = feature.getGeometry();\n    const lineString = geometry;\n    this.sketchFeature_ = feature;\n    this.sketchCoords_ = lineString.getCoordinates();\n    const last = this.sketchCoords_[this.sketchCoords_.length - 1];\n    this.finishCoordinate_ = last.slice();\n    this.sketchCoords_.push(last.slice());\n    this.sketchPoint_ = new Feature(new Point(last));\n    this.updateSketchFeatures_();\n    this.dispatchEvent(\n      new DrawEvent(DrawEventType.DRAWSTART, this.sketchFeature_),\n    );\n  }\n\n  /**\n   * Redraw the sketch features.\n   * @private\n   */\n  updateSketchFeatures_() {\n    const sketchFeatures = [];\n    if (this.sketchFeature_) {\n      sketchFeatures.push(this.sketchFeature_);\n    }\n    if (this.sketchLine_) {\n      sketchFeatures.push(this.sketchLine_);\n    }\n    if (this.sketchPoint_) {\n      sketchFeatures.push(this.sketchPoint_);\n    }\n    const overlaySource = this.overlay_.getSource();\n    overlaySource.clear(true);\n    overlaySource.addFeatures(sketchFeatures);\n  }\n\n  /**\n   * @private\n   */\n  updateState_() {\n    const map = this.getMap();\n    const active = this.getActive();\n    if (!map || !active) {\n      this.abortDrawing();\n    }\n    this.overlay_.setMap(active ? map : null);\n  }\n}\n\n/**\n * @return {import(\"../style/Style.js\").StyleFunction} Styles.\n */\nfunction getDefaultStyleFunction() {\n  const styles = createEditingStyle();\n  return function (feature, resolution) {\n    return styles[feature.getGeometry().getType()];\n  };\n}\n\n/**\n * Create a `geometryFunction` for `type: 'Circle'` that will create a regular\n * polygon with a user specified number of sides and start angle instead of a\n * {@link import(\"../geom/Circle.js\").Circle} geometry.\n * @param {number} [sides] Number of sides of the regular polygon.\n *     Default is 32.\n * @param {number} [angle] Angle of the first point in counter-clockwise\n *     radians. 0 means East.\n *     Default is the angle defined by the heading from the center of the\n *     regular polygon to the current pointer position.\n * @return {GeometryFunction} Function that draws a polygon.\n * @api\n */\nexport function createRegularPolygon(sides, angle) {\n  return function (coordinates, geometry, projection) {\n    const center = fromUserCoordinate(\n      /** @type {LineCoordType} */ (coordinates)[0],\n      projection,\n    );\n    const end = fromUserCoordinate(\n      /** @type {LineCoordType} */ (coordinates)[coordinates.length - 1],\n      projection,\n    );\n    const radius = Math.sqrt(squaredCoordinateDistance(center, end));\n    geometry = geometry || fromCircle(new Circle(center), sides);\n\n    let internalAngle = angle;\n    if (!angle && angle !== 0) {\n      const x = end[0] - center[0];\n      const y = end[1] - center[1];\n      internalAngle = Math.atan2(y, x);\n    }\n    makeRegular(\n      /** @type {Polygon} */ (geometry),\n      center,\n      radius,\n      internalAngle,\n    );\n\n    const userProjection = getUserProjection();\n    if (userProjection) {\n      geometry.transform(projection, userProjection);\n    }\n    return geometry;\n  };\n}\n\n/**\n * Create a `geometryFunction` that will create a box-shaped polygon (aligned\n * with the coordinate system axes).  Use this with the draw interaction and\n * `type: 'Circle'` to return a box instead of a circle geometry.\n * @return {GeometryFunction} Function that draws a box-shaped polygon.\n * @api\n */\nexport function createBox() {\n  return function (coordinates, geometry, projection) {\n    const extent = boundingExtent(\n      /** @type {LineCoordType} */ ([\n        coordinates[0],\n        coordinates[coordinates.length - 1],\n      ]).map(function (coordinate) {\n        return fromUserCoordinate(coordinate, projection);\n      }),\n    );\n    const boxCoordinates = [\n      [\n        getBottomLeft(extent),\n        getBottomRight(extent),\n        getTopRight(extent),\n        getTopLeft(extent),\n        getBottomLeft(extent),\n      ],\n    ];\n    if (geometry) {\n      geometry.setCoordinates(boxCoordinates);\n    } else {\n      geometry = new Polygon(boxCoordinates);\n    }\n    const userProjection = getUserProjection();\n    if (userProjection) {\n      geometry.transform(projection, userProjection);\n    }\n    return geometry;\n  };\n}\n\n/**\n * Get the drawing mode.  The mode for multi-part geometries is the same as for\n * their single-part cousins.\n * @param {import(\"../geom/Geometry.js\").Type} type Geometry type.\n * @return {Mode} Drawing mode.\n */\nfunction getMode(type) {\n  switch (type) {\n    case 'Point':\n    case 'MultiPoint':\n      return 'Point';\n    case 'LineString':\n    case 'MultiLineString':\n      return 'LineString';\n    case 'Polygon':\n    case 'MultiPolygon':\n      return 'Polygon';\n    case 'Circle':\n      return 'Circle';\n    default:\n      throw new Error('Invalid type: ' + type);\n  }\n}\n\nexport default Draw;\n","import { FeatureLike } from 'ol/Feature';\nimport Map from 'ol/Map';\nimport { Coordinate } from 'ol/coordinate';\nimport { Geometry, LineString, Point, Polygon } from 'ol/geom';\nimport { Type } from 'ol/geom/Geometry';\nimport { Draw, Modify } from 'ol/interaction';\nimport VectorLayer from 'ol/layer/Vector';\nimport VectorSource from 'ol/source/Vector';\nimport { getArea, getLength } from 'ol/sphere';\nimport { Circle as CircleStyle, Fill, RegularShape, Stroke, Style, Text } from 'ol/style';\n\nimport { formattedValueToString } from '@grafana/data';\n\nimport { MapMeasureOptions, measures } from '../utils/measure';\n\nexport class MeasureVectorLayer extends VectorLayer<VectorSource> {\n  opts: MapMeasureOptions = {\n    action: 'length',\n    unit: 'm',\n  };\n  constructor() {\n    super({\n      source: new VectorSource(),\n    });\n    this.setStyle((feature) => {\n      return this.styleFunction(feature, false);\n    });\n    this.setVisible(true);\n  }\n\n  setOptions(options: MapMeasureOptions) {\n    this.opts = options;\n    this.getSource()?.refresh();\n  }\n\n  getMapMeasurement(geo: Geometry): string {\n    let v = 0;\n    let action = measures[0];\n    if (this.opts.action === 'area') {\n      action = measures[1];\n      v = getArea(geo);\n    } else {\n      v = getLength(geo);\n    }\n    return formattedValueToString(action.getUnit(this.opts.unit).format(v));\n  }\n\n  segmentStyle = new Style({\n    text: new Text({\n      font: '12px Calibri,sans-serif',\n      fill: new Fill({\n        color: 'rgba(255, 255, 255, 1)',\n      }),\n      backgroundFill: new Fill({\n        color: 'rgba(0, 0, 0, 0.4)',\n      }),\n      padding: [2, 2, 2, 2],\n      textBaseline: 'bottom',\n      offsetY: -12,\n    }),\n    image: new RegularShape({\n      radius: 6,\n      points: 3,\n      angle: Math.PI,\n      displacement: [0, 8],\n      fill: new Fill({\n        color: 'rgba(0, 0, 0, 0.4)',\n      }),\n    }),\n  });\n\n  segmentStyles = [this.segmentStyle];\n\n  // Open Layer styles\n  shapeStyle = [\n    new Style({\n      fill: new Fill({\n        color: 'rgba(255, 255, 255, 0.2)',\n      }),\n      image: new CircleStyle({\n        radius: 5,\n        stroke: new Stroke({\n          color: 'rgba(0, 0, 0, 0.7)',\n        }),\n        fill: new Fill({\n          color: 'rgba(255, 255, 255, 0.2)',\n        }),\n      }),\n    }),\n    new Style({\n      stroke: new Stroke({\n        color: [0, 0, 0, 1],\n        width: 2,\n        lineDash: [4, 8],\n        lineDashOffset: 6,\n      }),\n    }),\n    new Style({\n      stroke: new Stroke({\n        color: [255, 255, 255, 1],\n        width: 2,\n        lineDash: [4, 8],\n      }),\n    }),\n  ];\n\n  labelStyle = new Style({\n    text: new Text({\n      font: '14px Calibri,sans-serif',\n      fill: new Fill({\n        color: 'rgba(255, 255, 255, 1)',\n      }),\n      backgroundFill: new Fill({\n        color: 'rgba(0, 0, 0, 0.7)',\n      }),\n      padding: [3, 3, 3, 3],\n      textBaseline: 'bottom',\n      offsetY: -15,\n    }),\n    image: new RegularShape({\n      radius: 8,\n      points: 3,\n      angle: Math.PI,\n      displacement: [0, 10],\n      fill: new Fill({\n        color: 'rgba(0, 0, 0, 0.7)',\n      }),\n    }),\n  });\n\n  tipStyle = new Style({\n    text: new Text({\n      font: '12px Calibri,sans-serif',\n      fill: new Fill({\n        color: 'rgba(255, 255, 255, 1)',\n      }),\n      backgroundFill: new Fill({\n        color: 'rgba(0, 0, 0, 0.4)',\n      }),\n      padding: [2, 2, 2, 2],\n      textAlign: 'left',\n      offsetX: 15,\n    }),\n  });\n\n  modifyStyle = new Style({\n    image: new CircleStyle({\n      radius: 5,\n      stroke: new Stroke({\n        color: 'rgba(0, 0, 0, 0.7)',\n      }),\n      fill: new Fill({\n        color: 'rgba(0, 0, 0, 0.4)',\n      }),\n    }),\n    text: new Text({\n      text: 'Drag to modify',\n      font: '12px Calibri,sans-serif',\n      fill: new Fill({\n        color: 'rgba(255, 255, 255, 1)',\n      }),\n      backgroundFill: new Fill({\n        color: 'rgba(0, 0, 0, 0.7)',\n      }),\n      padding: [2, 2, 2, 2],\n      textAlign: 'left',\n      offsetX: 15,\n    }),\n  });\n\n  readonly modify = new Modify({ source: this.getSource()!, style: this.modifyStyle });\n  tipPoint!: Geometry;\n  draw!: Draw; // global so we can remove it later\n\n  styleFunction(feature: FeatureLike, segments: boolean, drawType?: string, tip?: string): Style[] {\n    const styles = [...this.shapeStyle];\n    const geometry = feature.getGeometry();\n    if (geometry) {\n      const type = geometry.getType();\n      let point: Point;\n      let label: string;\n      let line: LineString;\n      if (!drawType || drawType === type) {\n        if (type === 'Polygon' && geometry instanceof Polygon) {\n          point = geometry.getInteriorPoint();\n          label = this.getMapMeasurement(geometry);\n          line = new LineString(geometry.getCoordinates()[0]);\n        } else if (type === 'LineString' && geometry instanceof LineString) {\n          point = new Point(geometry.getLastCoordinate());\n          label = this.getMapMeasurement(geometry);\n        }\n      }\n      if (segments && line!) {\n        let count = 0;\n        line.forEachSegment((a: Coordinate, b: Coordinate) => {\n          const segment = new LineString([a, b]);\n          const label = this.getMapMeasurement(segment);\n          if (this.segmentStyles.length - 1 < count) {\n            this.segmentStyles.push(this.segmentStyle.clone());\n          }\n          const segmentPoint = new Point(segment.getCoordinateAt(0.5));\n          this.segmentStyles[count].setGeometry(segmentPoint);\n          this.segmentStyles[count].getText()?.setText(label);\n          styles.push(this.segmentStyles[count]);\n          count++;\n        });\n      }\n      if (label!) {\n        this.labelStyle.setGeometry(point!);\n        this.labelStyle.getText()?.setText(label);\n        styles.push(this.labelStyle);\n      }\n      if (\n        tip &&\n        type === 'Point' &&\n        geometry instanceof Point &&\n        !this.modify.getOverlay().getSource()?.getFeatures().length\n      ) {\n        this.tipPoint = geometry;\n        this.tipStyle.getText()?.setText(tip);\n        styles.push(this.tipStyle);\n      }\n    }\n    return styles;\n  }\n\n  addInteraction(map: Map, typeSelect: Type, showSegments: boolean, clearPrevious: boolean) {\n    const drawType = typeSelect;\n    const activeTip =\n      ' Click to continue ' + (drawType === 'Polygon' ? 'polygon' : 'line') + ' \\n (double-click to end) ';\n    const idleTip = ' Click to start ';\n    let tip = idleTip;\n    this.draw = new Draw({\n      source: this.getSource()!,\n      type: drawType,\n      style: (feature) => {\n        return this.styleFunction(feature, showSegments, drawType, tip);\n      },\n    });\n    this.draw.on('drawstart', () => {\n      if (clearPrevious) {\n        this.getSource()!.clear();\n      }\n      this.modify.setActive(false);\n      tip = activeTip;\n    });\n    this.draw.on('drawend', () => {\n      this.modifyStyle.setGeometry(this.tipPoint);\n      this.modify.setActive(true);\n      map.once('pointermove', () => {\n        this.modifyStyle.setGeometry('');\n      });\n      tip = idleTip;\n    });\n    this.modify.setActive(true);\n    map.addInteraction(this.draw);\n  }\n}\n","import { css } from '@emotion/css';\nimport Map from 'ol/Map';\nimport { useMemo, useRef, useState } from 'react';\n\nimport { GrafanaTheme2, SelectableValue } from '@grafana/data';\nimport { selectors } from '@grafana/e2e-selectors';\nimport { t } from '@grafana/i18n';\nimport { Button, IconButton, RadioButtonGroup, Select } from '@grafana/ui';\nimport { config } from 'app/core/config';\n\nimport { MapMeasure, MapMeasureOptions, measures } from '../utils/measure';\n\nimport { MeasureVectorLayer } from './MeasureVectorLayer';\n\ntype Props = {\n  map: Map;\n  menuActiveState: (value: boolean) => void;\n};\n\nexport const MeasureOverlay = ({ map, menuActiveState }: Props) => {\n  const vector = useRef(new MeasureVectorLayer());\n  const measureStyle = getStyles(config.theme2);\n\n  // Menu State Management\n  const [firstLoad, setFirstLoad] = useState<boolean>(true);\n  const [menuActive, setMenuActive] = useState<boolean>(false);\n\n  // Options State\n  const [options, setOptions] = useState<MapMeasureOptions>({\n    action: measures[0].value!,\n    unit: measures[0].units[0].value!,\n  });\n  const unit = useMemo(() => {\n    const action = measures.find((m: MapMeasure) => m.value === options.action) ?? measures[0];\n    const current = action.getUnit(options.unit);\n    vector.current.setOptions(options);\n    return {\n      current,\n      options: action.units,\n    };\n  }, [options]);\n\n  const clearPrevious = true;\n  const showSegments = false;\n\n  function toggleMenu() {\n    setMenuActive(!menuActive);\n    // Lift menu state\n    // TODO: consolidate into one state\n    menuActiveState(!menuActive);\n    if (menuActive) {\n      map.removeInteraction(vector.current.draw);\n      vector.current.setVisible(false);\n    } else {\n      if (firstLoad) {\n        // Initialize on first load\n        setFirstLoad(false);\n        vector.current.setZIndex(1);\n        map.addLayer(vector.current);\n        map.addInteraction(vector.current.modify);\n      }\n      vector.current.setVisible(true);\n      map.removeInteraction(vector.current.draw); // Remove last interaction\n      const a = measures.find((v: MapMeasure) => v.value === options.action) ?? measures[0];\n      vector.current.addInteraction(map, a.geometry, showSegments, clearPrevious);\n    }\n  }\n\n  return (\n    <div className={`${measureStyle.infoWrap} ${!menuActive ? measureStyle.infoWrapClosed : null}`}>\n      {menuActive ? (\n        <div>\n          <div className={measureStyle.rowGroup}>\n            <RadioButtonGroup\n              value={options.action}\n              options={measures}\n              size=\"md\"\n              fullWidth={false}\n              onChange={(e: string) => {\n                map.removeInteraction(vector.current.draw);\n                const m = measures.find((v: MapMeasure) => v.value === e) ?? measures[0];\n                const unit = m.getUnit(options.unit);\n                setOptions({ ...options, action: m.value!, unit: unit.value! });\n                vector.current.addInteraction(map, m.geometry, showSegments, clearPrevious);\n              }}\n            />\n            <Button\n              aria-label={t('geomap.measure-overlay.aria-label-close', 'Close measure tools')}\n              className={measureStyle.button}\n              icon=\"times\"\n              variant=\"secondary\"\n              size=\"sm\"\n              onClick={toggleMenu}\n            />\n          </div>\n          <Select\n            className={measureStyle.unitSelect}\n            value={unit.current}\n            options={unit.options}\n            isSearchable={false}\n            onChange={(v: SelectableValue<string>) => {\n              const a = measures.find((v: SelectableValue<string>) => v.value === options.action) ?? measures[0];\n              const unit = a.getUnit(v.value) ?? a.units[0];\n              setOptions({ ...options, unit: unit.value! });\n            }}\n          />\n        </div>\n      ) : (\n        <IconButton\n          className={measureStyle.icon}\n          data-testid={selectors.components.PanelEditor.measureButton}\n          name=\"ruler-combined\"\n          tooltip={t('geomap.measure-overlay.tooltip-show-measure-tools', 'Show measure tools')}\n          tooltipPlacement=\"left\"\n          onClick={toggleMenu}\n        />\n      )}\n    </div>\n  );\n};\n\nconst getStyles = (theme: GrafanaTheme2) => ({\n  button: css({\n    marginLeft: 'auto',\n  }),\n  icon: css({\n    backgroundColor: theme.colors.secondary.main,\n    display: 'inline-block',\n    height: '19.25px',\n    margin: '1px',\n    width: '19.25px',\n  }),\n  infoWrap: css({\n    color: `${theme.colors.text}`,\n    backgroundColor: theme.colors.background.secondary,\n    // eslint-disable-next-line @grafana/no-border-radius-literal\n    borderRadius: '4px',\n    padding: '2px',\n  }),\n  infoWrapClosed: css({\n    height: '25.25px',\n    width: '25.25px',\n  }),\n  rowGroup: css({\n    display: 'flex',\n    justifyContent: 'flex-end',\n  }),\n  unitSelect: css({\n    minWidth: '200px',\n  }),\n});\n","import { css } from '@emotion/react';\n\nimport { GrafanaTheme2 } from '@grafana/data';\n\nimport 'ol/ol.css';\nimport 'ol-ext/dist/ol-ext.css';\n\n/**\n * Will be loaded *after* the css above\n */\nexport function getGlobalStyles(theme: GrafanaTheme2) {\n  // NOTE: this works with\n  //  node_modules/ol/ol.css\n  // use !important;\n  // This file keeps the rules\n\n  // .ol-box {\n  //   border: 2px solid blue;\n  // }\n\n  // .ol-scale-step-marker {\n  //   background-color: #000000;\n  // }\n  // .ol-scale-step-text {\n  //   color: #000000;\n  //   text-shadow: -2px 0 #FFFFFF, 0 2px #FFFFFF, 2px 0 #FFFFFF, 0 -2px #FFFFFF;\n  // }\n  // .ol-scale-text {\n  //   color: #000000;\n  //   text-shadow: -2px 0 #FFFFFF, 0 2px #FFFFFF, 2px 0 #FFFFFF, 0 -2px #FFFFFF;\n  // }\n  // .ol-scale-singlebar {\n  //   border: 1px solid black;\n  // }\n  // .ol-viewport, .ol-unselectable {\n  //   -webkit-tap-highlight-color: rgba(0,0,0,0);\n  // }\n\n  // .ol-overviewmap .ol-overviewmap-map {\n  //   border: 1px solid #7b98bc;\n  // }\n  // .ol-overviewmap:not(.ol-collapsed) {\n  //   background: rgba(255,255,255,0.8);\n  // }\n  // .ol-overviewmap-box {\n  //   border: 2px dotted rgba(0,60,136,0.7);\n  // }\n\n  return css({\n    '.ol-scale-line': {\n      background: theme.colors.border.weak, // rgba(0,60,136,0.3);\n    },\n    '.ol-scale-line-inner': {\n      border: `1px solid ${theme.colors.text.primary}`, // #eee;\n      borderTop: 0, // 0px;\n      color: theme.colors.text.primary, //  #eee;\n    },\n    '.ol-control': {\n      backgroundColor: theme.colors.background.primary, // rgba(255,255,255,0.4);\n    },\n    '.ol-control:hover': {\n      backgroundColor: theme.colors.background.secondary, // rgba(255,255,255,0.6);\n    },\n    '.ol-control button': {\n      color: theme.colors.secondary.text, // white;\n      backgroundColor: theme.colors.secondary.main, // rgba(0,60,136,0.5);\n    },\n    '.ol-control button:hover': {\n      color: theme.colors.secondary.text,\n      backgroundColor: theme.colors.secondary.shade, // rgba(0,60,136,0.5);\n    },\n    '.ol-control button:focus': {\n      color: theme.colors.secondary.text,\n      backgroundColor: theme.colors.secondary.main, // rgba(0,60,136,0.5);\n    },\n    '.ol-attribution ul': {\n      color: theme.colors.text.primary, //  #000;\n      textShadow: 'none',\n    },\n    '.ol-attribution:not(.ol-collapsed)': {\n      backgroundColor: theme.colors.background.secondary, // rgba(255,255,255,0.8);\n    },\n  });\n}\n","import Feature from 'ol/Feature';\nimport { Geometry } from 'ol/geom';\nimport VectorSource from 'ol/source/Vector';\n\nimport { DataFrame } from '@grafana/data';\n\nimport { getGeometryField, LocationFieldMatchers } from './location';\n\nexport interface FrameVectorSourceOptions {}\n\n// Helper function to create properly typed Features\nfunction createFeature<T extends Geometry>(properties: {\n  frame: DataFrame;\n  rowIndex: number;\n  geometry: T;\n}): Feature<T> {\n  const feature = new Feature(properties);\n  return feature;\n}\n\nexport class FrameVectorSource<T extends Geometry = Geometry> extends VectorSource<Feature<T>> {\n  constructor(public location: LocationFieldMatchers) {\n    super({});\n  }\n\n  update(frame: DataFrame) {\n    this.clear(true);\n    const info = getGeometryField(frame, this.location);\n    if (!info.field) {\n      this.changed();\n      return;\n    }\n\n    for (let i = 0; i < frame.length; i++) {\n      const geometry = info.field.values[i] as T;\n      this.addFeatureInternal(\n        createFeature({\n          frame,\n          rowIndex: i,\n          geometry,\n        })\n      );\n    }\n\n    // only call this at the end\n    this.changed();\n  }\n}\n","import { css, cx } from '@emotion/css';\nimport BaseLayer from 'ol/layer/Base';\nimport { useMemo } from 'react';\nimport { useObservable } from 'react-use';\nimport { of } from 'rxjs';\n\nimport {\n  getMinMaxAndDelta,\n  DataFrame,\n  formattedValueToString,\n  getFieldColorModeForField,\n  GrafanaTheme2,\n} from '@grafana/data';\nimport { t } from '@grafana/i18n';\nimport { useStyles2, VizLegendItem } from '@grafana/ui';\nimport { ColorScale } from 'app/core/components/ColorScale/ColorScale';\nimport { SanitizedSVG } from 'app/core/components/SVG/SanitizedSVG';\nimport { getThresholdItems } from 'app/core/components/TimelineChart/utils';\nimport { config } from 'app/core/config';\nimport { DimensionSupplier } from 'app/features/dimensions/types';\n\nimport { StyleConfigState } from '../style/types';\nimport { MapLayerState } from '../types';\n\nexport interface MarkersLegendProps {\n  size?: DimensionSupplier<number>;\n  layerName?: string;\n  styleConfig?: StyleConfigState;\n  layer?: BaseLayer;\n}\n\nexport function MarkersLegend(props: MarkersLegendProps) {\n  const { layerName, styleConfig, layer } = props;\n  const style = useStyles2(getStyles);\n\n  const hoverEvent = useObservable(((layer as any)?.__state as MapLayerState)?.mouseEvents ?? of(undefined));\n\n  const colorField = styleConfig?.dims?.color?.field;\n  const hoverValue = useMemo(() => {\n    if (!colorField || !hoverEvent) {\n      return undefined;\n    }\n\n    const props = hoverEvent.getProperties();\n    const frame: DataFrame = props.frame;\n\n    if (!frame) {\n      return undefined;\n    }\n\n    const rowIndex: number = props.rowIndex;\n    return colorField.values[rowIndex];\n  }, [hoverEvent, colorField]);\n\n  if (!styleConfig) {\n    return <></>;\n  }\n\n  const { color, opacity } = styleConfig?.base ?? {};\n  const symbol = styleConfig?.config.symbol?.fixed;\n\n  if (color && symbol && !colorField) {\n    return (\n      <div className={style.infoWrap}>\n        <div className={style.layerName}>{layerName}</div>\n        <div className={cx(style.layerBody, style.fixedColorContainer)}>\n          <SanitizedSVG\n            src={`${window.__grafana_public_path__}build/${symbol}`}\n            className={style.legendSymbol}\n            title={t('geomap.markers-legend.title-symbol', 'Symbol')}\n            style={{ fill: color, opacity: opacity }}\n          />\n        </div>\n      </div>\n    );\n  }\n\n  if (!colorField) {\n    return <></>;\n  }\n\n  const colorMode = getFieldColorModeForField(colorField);\n\n  if (colorMode.isContinuous && colorMode.getColors) {\n    const colors = colorMode.getColors(config.theme2);\n    const colorRange = getMinMaxAndDelta(colorField);\n    // TODO: explore showing mean on the gradient scale\n    // const stats = reduceField({\n    //   field: color.field!,\n    //   reducers: [\n    //     ReducerID.min,\n    //     ReducerID.max,\n    //     ReducerID.mean,\n    //     // std dev?\n    //   ]\n    // })\n\n    const display = colorField.display\n      ? (v: number) => formattedValueToString(colorField.display!(v))\n      : (v: number) => `${v}`;\n    return (\n      <div className={style.infoWrap}>\n        <div className={style.layerName}>{layerName}</div>\n        <div className={cx(style.layerBody, style.colorScaleWrapper)}>\n          <ColorScale\n            hoverValue={hoverValue}\n            colorPalette={colors}\n            min={colorRange.min ?? 0}\n            max={colorRange.max ?? 100}\n            display={display}\n            useStopsPercentage={false}\n          />\n        </div>\n      </div>\n    );\n  }\n\n  const thresholds = colorField?.config?.thresholds;\n  if (!thresholds || thresholds.steps.length < 2) {\n    return <div></div>; // don't show anything in the legend\n  }\n\n  const items = getThresholdItems(colorField!.config, config.theme2);\n  return (\n    <div className={style.infoWrap}>\n      <div className={style.layerName}>{layerName}</div>\n      <div className={cx(style.layerBody, style.legend)}>\n        {items.map((item: VizLegendItem, idx: number) => (\n          <div key={`${idx}/${item.label}`} className={style.legendItem}>\n            <i style={{ background: item.color }}></i>\n            {item.label}\n          </div>\n        ))}\n      </div>\n    </div>\n  );\n}\n\nconst getStyles = (theme: GrafanaTheme2) => ({\n  infoWrap: css({\n    display: 'flex',\n    flexDirection: 'column',\n    background: theme.colors.background.secondary,\n    // eslint-disable-next-line @grafana/no-border-radius-literal\n    borderRadius: '1px',\n    padding: theme.spacing(1),\n    borderBottom: `2px solid ${theme.colors.border.strong}`,\n    minWidth: '150px',\n  }),\n  layerName: css({\n    fontSize: theme.typography.body.fontSize,\n  }),\n  layerBody: css({\n    paddingLeft: '10px',\n  }),\n  legend: css({\n    lineHeight: '18px',\n    display: 'flex',\n    flexDirection: 'column',\n    fontSize: theme.typography.bodySmall.fontSize,\n    padding: '5px 10px 0',\n\n    i: {\n      width: '15px',\n      height: '15px',\n      float: 'left',\n      marginRight: '8px',\n      opacity: 0.7,\n      borderRadius: theme.shape.radius.circle,\n    },\n  }),\n  legendItem: css({\n    whiteSpace: 'nowrap',\n  }),\n  fixedColorContainer: css({\n    minWidth: '80px',\n    fontSize: theme.typography.bodySmall.fontSize,\n    paddingTop: '5px',\n  }),\n  legendSymbol: css({\n    height: '18px',\n    width: '18px',\n    margin: 'auto',\n  }),\n  colorScaleWrapper: css({\n    minWidth: '200px',\n    fontSize: theme.typography.bodySmall.fontSize,\n    paddingTop: '10px',\n  }),\n});\n","import { Component } from 'react';\nimport * as React from 'react';\nimport { Observable, Unsubscribable } from 'rxjs';\n\ninterface Props<T> {\n  watch: Observable<T>;\n  child: React.ComponentType<T>;\n  initialSubProps: T;\n}\n\ninterface State<T> {\n  subProps: T;\n}\n\nexport class ObservablePropsWrapper<T extends {}> extends Component<Props<T>, State<T>> {\n  sub?: Unsubscribable;\n\n  constructor(props: Props<T>) {\n    super(props);\n    this.state = {\n      subProps: props.initialSubProps,\n    };\n  }\n\n  componentDidMount() {\n    this.sub = this.props.watch.subscribe({\n      next: (subProps: T) => {\n        this.setState({ subProps });\n      },\n      complete: () => {},\n      error: (err) => {},\n    });\n  }\n\n  componentWillUnmount() {\n    if (this.sub) {\n      this.sub.unsubscribe();\n    }\n  }\n\n  render() {\n    const { subProps } = this.state;\n    return <this.props.child {...subProps} />;\n  }\n}\n","import { Fill, RegularShape, Stroke, Circle, Style, Icon, Text } from 'ol/style';\nimport type { FlatStyle } from 'ol/style/flat';\nimport tinycolor from 'tinycolor2';\n\nimport { Registry, RegistryItem, textUtil } from '@grafana/data';\nimport { config } from '@grafana/runtime';\nimport { getPublicOrAbsoluteUrl } from 'app/features/dimensions/resource';\n\nimport { defaultStyleConfig, DEFAULT_SIZE, StyleConfigValues, StyleMaker } from './types';\nimport { getDisplacement } from './utils';\n\ninterface SymbolMaker extends RegistryItem {\n  aliasIds: string[];\n  make: StyleMaker;\n}\n\nenum RegularShapeId {\n  circle = 'circle',\n  square = 'square',\n  triangle = 'triangle',\n  star = 'star',\n  cross = 'cross',\n  x = 'x',\n}\n\nconst MarkerShapePath = {\n  circle: 'img/icons/marker/circle.svg',\n  square: 'img/icons/marker/square.svg',\n  triangle: 'img/icons/marker/triangle.svg',\n  star: 'img/icons/marker/star.svg',\n  cross: 'img/icons/marker/cross.svg',\n  x: 'img/icons/marker/x-mark.svg',\n};\n\nexport function getFillColor(cfg: StyleConfigValues) {\n  const opacity = cfg.opacity == null ? 0.8 : cfg.opacity;\n  if (opacity === 1) {\n    return new Fill({ color: cfg.color });\n  }\n  if (opacity > 0) {\n    const color = tinycolor(cfg.color).setAlpha(opacity).toRgbString();\n    return new Fill({ color });\n  }\n  return undefined;\n}\n\nexport function getStrokeStyle(cfg: StyleConfigValues) {\n  const opacity = cfg.opacity == null ? 0.8 : cfg.opacity;\n  if (opacity === 1) {\n    return new Stroke({ color: cfg.color, width: cfg.lineWidth ?? 1 });\n  }\n  if (opacity > 0) {\n    const color = tinycolor(cfg.color).setAlpha(opacity).toRgbString();\n    return new Stroke({ color, width: cfg.lineWidth ?? 1 });\n  }\n  return undefined;\n}\n\nconst textLabel = (cfg: StyleConfigValues) => {\n  if (!cfg.text) {\n    return undefined;\n  }\n\n  const fontFamily = config.theme2.typography.fontFamily;\n  const textConfig = {\n    ...defaultStyleConfig.textConfig,\n    ...cfg.textConfig,\n  };\n  return new Text({\n    text: cfg.text,\n    fill: new Fill({ color: cfg.color ?? defaultStyleConfig.color.fixed }),\n    font: `normal ${textConfig.fontSize}px ${fontFamily}`,\n    ...textConfig,\n  });\n};\n\nexport const textMarker = (cfg: StyleConfigValues) => {\n  return new Style({\n    text: textLabel(cfg),\n  });\n};\n\nexport const circleMarker = (cfg: StyleConfigValues) => {\n  const stroke = new Stroke({ color: cfg.color, width: cfg.lineWidth ?? 1 });\n  const radius = cfg.size ?? DEFAULT_SIZE;\n  return new Style({\n    image: new Circle({\n      stroke,\n      fill: getFillColor(cfg),\n      radius,\n      displacement: getDisplacement(cfg.symbolAlign ?? defaultStyleConfig.symbolAlign, radius),\n    }),\n    text: textLabel(cfg),\n    stroke, // in case lines are sent to the markers layer\n  });\n};\n\n// Does not have image\nexport const polyStyle = (cfg: StyleConfigValues) => {\n  return new Style({\n    fill: getFillColor(cfg),\n    stroke: new Stroke({ color: cfg.color, width: cfg.lineWidth ?? 1 }),\n    text: textLabel(cfg),\n  });\n};\n\nexport const routeStyle = (cfg: StyleConfigValues) => {\n  return new Style({\n    fill: getFillColor(cfg),\n    stroke: getStrokeStyle(cfg),\n    text: textLabel(cfg),\n  });\n};\n\n// Square and cross\nconst errorMarker = (cfg: StyleConfigValues) => {\n  const radius = cfg.size ?? DEFAULT_SIZE;\n  const stroke = new Stroke({ color: '#F00', width: 1 });\n  return [\n    new Style({\n      image: new RegularShape({\n        stroke,\n        points: 4,\n        radius,\n        angle: Math.PI / 4,\n      }),\n    }),\n    new Style({\n      image: new RegularShape({\n        stroke,\n        points: 4,\n        radius,\n        radius2: 0,\n        angle: 0,\n      }),\n    }),\n  ];\n};\n\nconst makers: SymbolMaker[] = [\n  {\n    id: RegularShapeId.circle,\n    name: 'Circle',\n    aliasIds: [MarkerShapePath.circle],\n    make: circleMarker,\n  },\n  {\n    id: RegularShapeId.square,\n    name: 'Square',\n    aliasIds: [MarkerShapePath.square],\n    make: (cfg: StyleConfigValues) => {\n      const radius = cfg.size ?? DEFAULT_SIZE;\n      const rotation = cfg.rotation ?? 0;\n      return new Style({\n        image: new RegularShape({\n          stroke: new Stroke({ color: cfg.color, width: cfg.lineWidth ?? 1 }),\n          fill: getFillColor(cfg),\n          points: 4,\n          radius,\n          angle: Math.PI / 4,\n          rotation: (rotation * Math.PI) / 180,\n          displacement: getDisplacement(cfg.symbolAlign ?? defaultStyleConfig.symbolAlign, radius),\n        }),\n        text: textLabel(cfg),\n      });\n    },\n  },\n  {\n    id: RegularShapeId.triangle,\n    name: 'Triangle',\n    aliasIds: [MarkerShapePath.triangle],\n    make: (cfg: StyleConfigValues) => {\n      const radius = cfg.size ?? DEFAULT_SIZE;\n      const rotation = cfg.rotation ?? 0;\n      return new Style({\n        image: new RegularShape({\n          stroke: new Stroke({ color: cfg.color, width: cfg.lineWidth ?? 1 }),\n          fill: getFillColor(cfg),\n          points: 3,\n          radius,\n          rotation: (rotation * Math.PI) / 180,\n          angle: 0,\n          displacement: getDisplacement(cfg.symbolAlign ?? defaultStyleConfig.symbolAlign, radius),\n        }),\n        text: textLabel(cfg),\n      });\n    },\n  },\n  {\n    id: RegularShapeId.star,\n    name: 'Star',\n    aliasIds: [MarkerShapePath.star],\n    make: (cfg: StyleConfigValues) => {\n      const radius = cfg.size ?? DEFAULT_SIZE;\n      const rotation = cfg.rotation ?? 0;\n      return new Style({\n        image: new RegularShape({\n          stroke: new Stroke({ color: cfg.color, width: cfg.lineWidth ?? 1 }),\n          fill: getFillColor(cfg),\n          points: 5,\n          radius,\n          radius2: radius * 0.4,\n          angle: 0,\n          rotation: (rotation * Math.PI) / 180,\n          displacement: getDisplacement(cfg.symbolAlign ?? defaultStyleConfig.symbolAlign, radius),\n        }),\n        text: textLabel(cfg),\n      });\n    },\n  },\n  {\n    id: RegularShapeId.cross,\n    name: 'Cross',\n    aliasIds: [MarkerShapePath.cross],\n    make: (cfg: StyleConfigValues) => {\n      const radius = cfg.size ?? DEFAULT_SIZE;\n      const rotation = cfg.rotation ?? 0;\n      return new Style({\n        image: new RegularShape({\n          stroke: new Stroke({ color: cfg.color, width: cfg.lineWidth ?? 1 }),\n          points: 4,\n          radius,\n          radius2: 0,\n          angle: 0,\n          rotation: (rotation * Math.PI) / 180,\n          displacement: getDisplacement(cfg.symbolAlign ?? defaultStyleConfig.symbolAlign, radius),\n        }),\n        text: textLabel(cfg),\n      });\n    },\n  },\n  {\n    id: RegularShapeId.x,\n    name: 'X',\n    aliasIds: [MarkerShapePath.x],\n    make: (cfg: StyleConfigValues) => {\n      const radius = cfg.size ?? DEFAULT_SIZE;\n      const rotation = cfg.rotation ?? 0;\n      return new Style({\n        image: new RegularShape({\n          stroke: new Stroke({ color: cfg.color, width: cfg.lineWidth ?? 1 }),\n          points: 4,\n          radius,\n          radius2: 0,\n          angle: Math.PI / 4,\n          rotation: (rotation * Math.PI) / 180,\n          displacement: getDisplacement(cfg.symbolAlign ?? defaultStyleConfig.symbolAlign, radius),\n        }),\n        text: textLabel(cfg),\n      });\n    },\n  },\n];\n\nasync function prepareSVG(url: string, size?: number, backgroundOpacity?: number): Promise<string> {\n  return fetch(url, { method: 'GET' })\n    .then((res) => {\n      return res.text();\n    })\n    .then((text) => {\n      text = textUtil.sanitizeSVGContent(text);\n\n      const parser = new DOMParser();\n      const doc = parser.parseFromString(text, 'image/svg+xml');\n      const svg = doc.getElementsByTagName('svg')[0];\n      if (!svg) {\n        return '';\n      }\n\n      const svgSize = size ?? 100;\n      const width = svg.getAttribute('width') ?? svgSize;\n      const height = svg.getAttribute('height') ?? svgSize;\n\n      // open layers requires a white fill becaues it uses tint to set color\n      svg.setAttribute('fill', '#fff');\n      svg.setAttribute('width', `${width}px`);\n      svg.setAttribute('height', `${height}px`);\n\n      // add a mostly transparent circle behind the icon for webGL hit detection\n      // TODO open layers discards fully transparent elements for hit detection\n      if (backgroundOpacity) {\n        const viewBox = svg.getAttribute('viewBox')?.split(' ') ?? [0, 0, width, height];\n        const viewCenterX = Number(viewBox[2]) / 2;\n        const viewCenterY = Number(viewBox[3]) / 2;\n        const circleElement = doc.createElementNS('http://www.w3.org/2000/svg', 'circle');\n        circleElement.setAttribute('cx', viewCenterX.toString());\n        circleElement.setAttribute('cy', viewCenterY.toString());\n        circleElement.setAttribute('fill', 'none');\n        circleElement.setAttribute('r', (viewCenterX / 2).toString());\n        circleElement.setAttribute('stroke', `rgba(255,255,255,${backgroundOpacity})`);\n        circleElement.setAttribute('stroke-width', viewCenterX.toString());\n        svg.prepend(circleElement);\n      }\n\n      const svgString = new XMLSerializer().serializeToString(svg);\n      const svgURI = encodeURIComponent(svgString);\n      return `data:image/svg+xml,${svgURI}`;\n    })\n    .catch((error) => {\n      console.error(error); // eslint-disable-line no-console\n      return '';\n    });\n}\n\n// Really just a cache for the various symbol styles\nconst markerMakers = new Registry<SymbolMaker>(() => makers);\n\nexport function getMarkerAsPath(shape?: string): string | undefined {\n  const marker = markerMakers.getIfExists(shape);\n  if (marker?.aliasIds?.length) {\n    return marker.aliasIds[0];\n  }\n  return undefined;\n}\n\n// Common expressions used across different style types\nexport const colorExpression = ['color', ['get', 'red'], ['get', 'green'], ['get', 'blue'], ['get', 'opacity']];\nexport const sizeExpression = ['get', 'size'];\nexport const opacityExpression = ['get', 'opacity'];\nexport const rotationExpression = ['get', 'rotation'];\nexport const offsetExpression = ['array', ['get', 'offsetX'], ['get', 'offsetY']];\n\n// Base style for regular shapes\nexport const baseShapeStyle = {\n  'shape-radius': ['/', sizeExpression, 2],\n  'shape-fill-color': colorExpression,\n  'shape-stroke-color': colorExpression,\n  'shape-stroke-width': 1,\n  'shape-opacity': opacityExpression,\n  'shape-rotation': rotationExpression,\n  'shape-displacement': offsetExpression,\n};\n\n// Base style for circles\nexport const baseCircleStyle = {\n  'circle-radius': ['/', sizeExpression, 2],\n  'circle-fill-color': colorExpression,\n  'circle-stroke-color': colorExpression,\n  'circle-stroke-width': 1,\n  'circle-opacity': opacityExpression,\n  'circle-displacement': offsetExpression,\n};\n\n// Returns style configuration for WebGL markers\nexport async function getWebGLStyle(symbol?: string, opacity?: number): Promise<FlatStyle> {\n  // Handle circle explicitly (before generic SVG check)\n  if (symbol === MarkerShapePath.circle) {\n    return baseCircleStyle;\n  }\n\n  // Handle square as WebGL regular shape\n  if (symbol === MarkerShapePath.square) {\n    return {\n      ...baseShapeStyle,\n      'shape-points': 4,\n      'shape-angle': Math.PI / 4,\n    };\n  }\n\n  // Handle triangle as WebGL regular shape\n  if (symbol === MarkerShapePath.triangle) {\n    return {\n      ...baseShapeStyle,\n      'shape-points': 3,\n      'shape-angle': 0,\n    };\n  }\n\n  // Handle custom SVG symbols and other shapes as icons\n  if (symbol && symbol.endsWith('.svg')) {\n    const backgroundOpacity = opacity === 0 ? 0 : 0.1 / (opacity ?? 1);\n    return {\n      'icon-src': await prepareSVG(getPublicOrAbsoluteUrl(symbol), undefined, backgroundOpacity),\n      'icon-width': sizeExpression,\n      'icon-height': sizeExpression,\n      'icon-opacity': opacityExpression,\n      'icon-rotation': rotationExpression,\n      'icon-displacement': offsetExpression,\n      'icon-color': colorExpression,\n    };\n  }\n\n  // Default to circle (also handles MarkerShapePath.circle)\n  return baseCircleStyle;\n}\n\n// Will prepare symbols as necessary\nexport async function getMarkerMaker(symbol?: string, hasTextLabel?: boolean): Promise<StyleMaker> {\n  if (!symbol) {\n    return hasTextLabel ? textMarker : circleMarker;\n  }\n\n  let maker = markerMakers.getIfExists(symbol);\n  if (maker) {\n    return maker.make;\n  }\n\n  // Prepare svg as icon\n  if (symbol.endsWith('.svg')) {\n    const src = await prepareSVG(getPublicOrAbsoluteUrl(symbol));\n    maker = {\n      id: symbol,\n      name: symbol,\n      aliasIds: [],\n      make: src\n        ? (cfg: StyleConfigValues) => {\n            const radius = cfg.size ?? DEFAULT_SIZE;\n            const rotation = cfg.rotation ?? 0;\n            return [\n              new Style({\n                image: new Icon({\n                  src,\n                  color: cfg.color,\n                  opacity: cfg.opacity ?? 1,\n                  scale: (DEFAULT_SIZE + radius) / 100,\n                  rotation: (rotation * Math.PI) / 180,\n                  displacement: getDisplacement(cfg.symbolAlign ?? defaultStyleConfig.symbolAlign, radius / 2),\n                }),\n                text: !cfg?.text ? undefined : textLabel(cfg),\n              }),\n              // transparent bounding box for featureAtPixel detection\n              new Style({\n                image: new RegularShape({\n                  fill: new Fill({ color: 'rgba(0,0,0,0)' }),\n                  points: 4,\n                  radius: radius,\n                  rotation: (rotation * Math.PI) / 180 + Math.PI / 4,\n                }),\n              }),\n            ];\n          }\n        : errorMarker,\n    };\n    markerMakers.register(maker);\n    return maker.make;\n  }\n\n  // default to showing a circle\n  return errorMarker;\n}\n","import { config } from '@grafana/runtime';\nimport { TextDimensionMode } from '@grafana/schema';\n\nimport { getMarkerMaker } from './markers';\nimport {\n  HorizontalAlign,\n  VerticalAlign,\n  defaultStyleConfig,\n  StyleConfig,\n  StyleConfigFields,\n  StyleConfigState,\n  SymbolAlign,\n  ColorValue,\n} from './types';\n\n/** Indicate if the style wants to show text values */\nexport function styleUsesText(config: StyleConfig): boolean {\n  const text = config?.text;\n  if (!text) {\n    return false;\n  }\n  if (text.mode === TextDimensionMode.Fixed && text.fixed?.length) {\n    return true;\n  }\n  if (text.mode === TextDimensionMode.Field && text.field?.length) {\n    return true;\n  }\n  return false;\n}\n\n/** Return a distinct list of fields used to dynamically change the style */\nexport async function getStyleConfigState(cfg?: StyleConfig): Promise<StyleConfigState> {\n  if (!cfg) {\n    cfg = defaultStyleConfig;\n  }\n  const hasText = styleUsesText(cfg);\n  const fields: StyleConfigFields = {};\n  const maker = await getMarkerMaker(cfg.symbol?.fixed, hasText);\n  const state: StyleConfigState = {\n    config: cfg, // raw values\n    hasText,\n    fields,\n    base: {\n      color: config.theme2.visualization.getColorByName(cfg.color?.fixed ?? defaultStyleConfig.color.fixed),\n      opacity: cfg.opacity ?? defaultStyleConfig.opacity,\n      lineWidth: cfg.lineWidth ?? 1,\n      size: cfg.size?.fixed ?? defaultStyleConfig.size.fixed,\n      rotation: cfg.rotation?.fixed ?? defaultStyleConfig.rotation.fixed, // add ability follow path later\n      symbolAlign: cfg.symbolAlign ?? defaultStyleConfig.symbolAlign,\n    },\n    maker,\n  };\n\n  if (cfg.color?.field?.length) {\n    fields.color = cfg.color.field;\n  }\n  if (cfg.size?.field?.length) {\n    fields.size = cfg.size.field;\n  }\n  if (cfg.rotation?.field?.length) {\n    fields.rotation = cfg.rotation.field;\n  }\n\n  if (hasText) {\n    state.base.text = cfg.text?.fixed;\n    state.base.textConfig = cfg.textConfig ?? defaultStyleConfig.textConfig;\n\n    if (cfg.text?.field?.length) {\n      fields.text = cfg.text.field;\n    }\n  }\n\n  // Clear the fields if possible\n  if (!Object.keys(fields).length) {\n    state.fields = undefined;\n  }\n  return state;\n}\n\n/** Return a displacment array depending on alignment and icon radius */\nexport function getDisplacement(symbolAlign: SymbolAlign, radius: number) {\n  const displacement = [0, 0];\n  if (symbolAlign?.horizontal === HorizontalAlign.Left) {\n    displacement[0] = -radius;\n  } else if (symbolAlign?.horizontal === HorizontalAlign.Right) {\n    displacement[0] = radius;\n  }\n  if (symbolAlign?.vertical === VerticalAlign.Top) {\n    displacement[1] = radius;\n  } else if (symbolAlign?.vertical === VerticalAlign.Bottom) {\n    displacement[1] = -radius;\n  }\n  return displacement;\n}\n\nexport function getRGBValues(colorString: string): ColorValue | null {\n  // Check if it's a hex color\n  if (colorString.startsWith('#')) {\n    return getRGBFromHex(colorString);\n  }\n\n  // Check if it's an RGB color\n  else if (colorString.startsWith('rgb')) {\n    return getRGBFromRGBString(colorString);\n  }\n\n  // Handle other color formats if needed\n  else {\n    console.warn(`Unsupported color format: ${colorString}`);\n  }\n  return null;\n}\n\nfunction getRGBFromHex(hexColor: string): ColorValue {\n  // Remove the '#' character\n  hexColor = hexColor.slice(1);\n\n  // Convert hex to decimal values\n  const r = parseInt(hexColor.slice(0, 2), 16);\n  const g = parseInt(hexColor.slice(2, 4), 16);\n  const b = parseInt(hexColor.slice(4, 6), 16);\n\n  return { r, g, b };\n}\n\nfunction getRGBFromRGBString(rgbString: string): ColorValue | null {\n  // Use regex to extract the numbers, supporting both rgb(r,g,b) and rgba(r,g,b,a) formats\n  const matches = rgbString.match(/\\d+\\.?\\d*/g);\n\n  if (matches) {\n    if (matches.length === 3) {\n      return {\n        r: parseInt(matches[0], 10),\n        g: parseInt(matches[1], 10),\n        b: parseInt(matches[2], 10),\n      };\n    } else if (matches.length === 4) {\n      return {\n        r: parseInt(matches[0], 10),\n        g: parseInt(matches[1], 10),\n        b: parseInt(matches[2], 10),\n        a: parseFloat(matches[3]), // Using parseFloat for alpha as it can be decimal (0-1)\n      };\n    } else {\n      console.warn(`Unsupported color format: ${rgbString}`);\n    }\n  } else {\n    console.warn(`Unsupported color format: ${rgbString}`);\n  }\n  return null;\n}\n","import { capitalize } from 'lodash';\nimport { useId, useMemo } from 'react';\nimport { useObservable } from 'react-use';\nimport { Observable, of } from 'rxjs';\n\nimport { FieldConfigPropertyItem, StandardEditorProps, StandardEditorsRegistryItem, FrameMatcher } from '@grafana/data';\nimport { t } from '@grafana/i18n';\nimport {\n  ScaleDimensionConfig,\n  ResourceDimensionConfig,\n  ColorDimensionConfig,\n  TextDimensionConfig,\n  ScalarDimensionConfig,\n} from '@grafana/schema';\nimport { ColorPicker, Field, Stack, InlineField, InlineFieldRow, InlineLabel, RadioButtonGroup } from '@grafana/ui';\nimport { NumberValueEditor } from 'app/core/components/OptionsUI/number';\nimport { SliderValueEditor } from 'app/core/components/OptionsUI/slider';\nimport { ColorDimensionEditor } from 'app/features/dimensions/editors/ColorDimensionEditor';\nimport { ResourceDimensionEditor } from 'app/features/dimensions/editors/ResourceDimensionEditor';\nimport { ScalarDimensionEditor } from 'app/features/dimensions/editors/ScalarDimensionEditor';\nimport { ScaleDimensionEditor } from 'app/features/dimensions/editors/ScaleDimensionEditor';\nimport { TextDimensionEditor } from 'app/features/dimensions/editors/TextDimensionEditor';\nimport { ResourceFolderName, defaultTextConfig, MediaType } from 'app/features/dimensions/types';\n\nimport {\n  HorizontalAlign,\n  VerticalAlign,\n  defaultStyleConfig,\n  GeometryTypeId,\n  StyleConfig,\n  TextAlignment,\n  TextBaseline,\n} from '../style/types';\nimport { styleUsesText } from '../style/utils';\nimport { LayerContentInfo } from '../utils/getFeatures';\n\nexport interface StyleEditorOptions {\n  layerInfo?: Observable<LayerContentInfo>;\n  simpleFixedValues?: boolean;\n  displayRotation?: boolean;\n  hideSymbol?: boolean;\n  frameMatcher?: FrameMatcher;\n}\n\ntype Props = StandardEditorProps<StyleConfig, StyleEditorOptions>;\n\nexport const StyleEditor = (props: Props) => {\n  const { value, onChange, item } = props;\n  const context = useMemo(() => {\n    if (!item.settings?.frameMatcher) {\n      return props.context;\n    }\n\n    return { ...props.context, data: props.context.data.filter(item.settings.frameMatcher) };\n  }, [props.context, item.settings]);\n\n  const settings = item.settings;\n\n  const onSizeChange = (sizeValue: ScaleDimensionConfig | undefined) => {\n    onChange({ ...value, size: sizeValue });\n  };\n\n  const onSymbolChange = (symbolValue: ResourceDimensionConfig | undefined) => {\n    onChange({ ...value, symbol: symbolValue });\n  };\n\n  const onColorChange = (colorValue: ColorDimensionConfig | undefined) => {\n    onChange({ ...value, color: colorValue });\n  };\n\n  const onOpacityChange = (opacityValue: number | undefined) => {\n    onChange({ ...value, opacity: opacityValue });\n  };\n\n  const onRotationChange = (rotationValue: ScalarDimensionConfig | undefined) => {\n    onChange({ ...value, rotation: rotationValue });\n  };\n\n  const onTextChange = (textValue: TextDimensionConfig | undefined) => {\n    onChange({ ...value, text: textValue });\n  };\n\n  const onTextFontSizeChange = (fontSize: number | undefined) => {\n    onChange({ ...value, textConfig: { ...value.textConfig, fontSize } });\n  };\n\n  const onTextOffsetXChange = (offsetX: number | undefined) => {\n    onChange({ ...value, textConfig: { ...value.textConfig, offsetX } });\n  };\n\n  const onTextOffsetYChange = (offsetY: number | undefined) => {\n    onChange({ ...value, textConfig: { ...value.textConfig, offsetY } });\n  };\n\n  const onTextAlignChange = (textAlign: TextAlignment) => {\n    onChange({ ...value, textConfig: { ...value.textConfig, textAlign: textAlign } });\n  };\n\n  const onTextBaselineChange = (textBaseline: TextBaseline) => {\n    onChange({ ...value, textConfig: { ...value.textConfig, textBaseline: textBaseline } });\n  };\n\n  const onAlignHorizontalChange = (alignHorizontal: HorizontalAlign) => {\n    onChange({ ...value, symbolAlign: { ...value?.symbolAlign, horizontal: alignHorizontal } });\n  };\n\n  const onAlignVerticalChange = (alignVertical: VerticalAlign) => {\n    onChange({ ...value, symbolAlign: { ...value?.symbolAlign, vertical: alignVertical } });\n  };\n\n  const propertyOptions = useObservable(settings?.layerInfo ?? of());\n  const featuresHavePoints = propertyOptions?.geometryType === GeometryTypeId.Point;\n  const hasTextLabel = styleUsesText(value);\n  const maxFiles = 2000;\n\n  const symbolId = useId();\n  const rotationAngleId = useId();\n  const colorId = useId();\n  const opacityId = useId();\n  const sizeId = useId();\n  const symbol1Id = useId();\n  const symbolVertId = useId();\n  const color1Id = useId();\n  const fillOpacityId = useId();\n  const rotationAngle1Id = useId();\n  const textId = useId();\n  const fontSizeId = useId();\n  const xOffsetId = useId();\n  const yOffsetId = useId();\n\n  // Simple fixed value display\n  if (settings?.simpleFixedValues) {\n    return (\n      <>\n        {featuresHavePoints && (\n          <>\n            <InlineFieldRow>\n              <InlineField label={t('geomap.style-editor.label-symbol', 'Symbol')}>\n                <ResourceDimensionEditor\n                  id={symbolId}\n                  value={value?.symbol ?? defaultStyleConfig.symbol}\n                  context={context}\n                  onChange={onSymbolChange}\n                  item={\n                    {\n                      settings: {\n                        resourceType: 'icon',\n                        folderName: ResourceFolderName.Marker,\n                        placeholderText: hasTextLabel\n                          ? t('geomap.style-editor.placeholderText-select-symbol', 'Select a symbol')\n                          : t(\n                              'geomap.style-editor.placeholderText-select-symbol-or-add-text',\n                              'Select a symbol or add a text label'\n                            ),\n                        placeholderValue: defaultStyleConfig.symbol.fixed,\n                        showSourceRadio: false,\n                        maxFiles,\n                      },\n                    } as StandardEditorsRegistryItem\n                  }\n                />\n              </InlineField>\n            </InlineFieldRow>\n            <Field label={t('geomap.style-editor.label-rotation-angle', 'Rotation angle')}>\n              <ScalarDimensionEditor\n                id={rotationAngleId}\n                value={value?.rotation ?? defaultStyleConfig.rotation}\n                context={context}\n                onChange={onRotationChange}\n                item={\n                  {\n                    settings: {\n                      min: defaultStyleConfig.rotation.min,\n                      max: defaultStyleConfig.rotation.max,\n                    },\n                  } as StandardEditorsRegistryItem\n                }\n              />\n            </Field>\n          </>\n        )}\n        <InlineFieldRow>\n          <InlineField label={t('geomap.style-editor.label-color', 'Color')} labelWidth={10}>\n            <InlineLabel width={4}>\n              <ColorPicker\n                id={colorId}\n                color={value?.color?.fixed ?? defaultStyleConfig.color.fixed}\n                onChange={(v) => {\n                  onColorChange({ fixed: v });\n                }}\n              />\n            </InlineLabel>\n          </InlineField>\n        </InlineFieldRow>\n        <InlineFieldRow>\n          <InlineField label={t('geomap.style-editor.label-opacity', 'Opacity')} labelWidth={10} grow>\n            <SliderValueEditor\n              id={opacityId}\n              value={value?.opacity ?? defaultStyleConfig.opacity}\n              context={context}\n              onChange={onOpacityChange}\n              item={\n                {\n                  settings: {\n                    min: 0,\n                    max: 1,\n                    step: 0.1,\n                  },\n                } as FieldConfigPropertyItem\n              }\n            />\n          </InlineField>\n        </InlineFieldRow>\n      </>\n    );\n  }\n\n  return (\n    <>\n      <Field label={t('geomap.style-editor.label-size', 'Size')}>\n        <ScaleDimensionEditor\n          id={sizeId}\n          value={value?.size ?? defaultStyleConfig.size}\n          context={context}\n          onChange={onSizeChange}\n          item={\n            {\n              settings: {\n                min: 1,\n                max: 100,\n              },\n            } as StandardEditorsRegistryItem\n          }\n        />\n      </Field>\n      {!settings?.hideSymbol && (\n        <>\n          <Field label={t('geomap.style-editor.label-symbol', 'Symbol')}>\n            <ResourceDimensionEditor\n              id={symbol1Id}\n              value={value?.symbol ?? defaultStyleConfig.symbol}\n              context={context}\n              onChange={onSymbolChange}\n              item={\n                {\n                  settings: {\n                    resourceType: MediaType.Icon,\n                    folderName: ResourceFolderName.Marker,\n                    placeholderText: hasTextLabel\n                      ? t('geomap.style-editor.placeholderText-select-symbol', 'Select a symbol')\n                      : t(\n                          'geomap.style-editor.placeholderText-select-symbol-or-add-text',\n                          'Select a symbol or add a text label'\n                        ),\n                    placeholderValue: defaultStyleConfig.symbol.fixed,\n                    showSourceRadio: false,\n                    maxFiles,\n                  },\n                } as StandardEditorsRegistryItem\n              }\n            />\n          </Field>\n          <Field label={t('geomap.style-editor.label-symbol-vertical-align', 'Symbol vertical align')}>\n            <RadioButtonGroup\n              id={symbolVertId}\n              value={value?.symbolAlign?.vertical ?? defaultStyleConfig.symbolAlign.vertical}\n              onChange={onAlignVerticalChange}\n              options={[\n                { value: VerticalAlign.Top, label: t('geomap.style-editor.vertical-align-options.label-top', 'Top') },\n                {\n                  value: VerticalAlign.Center,\n                  label: t('geomap.style-editor.vertical-align-options.label-center', 'Center'),\n                },\n                {\n                  value: VerticalAlign.Bottom,\n                  label: t('geomap.style-editor.vertical-align-options.label-bottom', 'Bottom'),\n                },\n              ]}\n            />\n          </Field>\n          <Field label={t('geomap.style-editor.label-symbol-horizontal-align', 'Symbol horizontal align')}>\n            <RadioButtonGroup\n              value={value?.symbolAlign?.horizontal ?? defaultStyleConfig.symbolAlign.horizontal}\n              onChange={onAlignHorizontalChange}\n              options={[\n                {\n                  value: HorizontalAlign.Left,\n                  label: t('geomap.style-editor.horizontal-align-options.label-left', 'Left'),\n                },\n                {\n                  value: HorizontalAlign.Center,\n                  label: t('geomap.style-editor.horizontal-align-options.label-center', 'Center'),\n                },\n                {\n                  value: HorizontalAlign.Right,\n                  label: t('geomap.style-editor.horizontal-align-options.label-right', 'Right'),\n                },\n              ]}\n            />\n          </Field>\n        </>\n      )}\n      <Field label={t('geomap.style-editor.label-color', 'Color')}>\n        <ColorDimensionEditor\n          id={color1Id}\n          value={value?.color ?? defaultStyleConfig.color}\n          context={context}\n          onChange={onColorChange}\n          item={{} as StandardEditorsRegistryItem}\n        />\n      </Field>\n      <Field label={t('geomap.style-editor.label-fill-opacity', 'Fill opacity')}>\n        <SliderValueEditor\n          id={fillOpacityId}\n          value={value?.opacity ?? defaultStyleConfig.opacity}\n          context={context}\n          onChange={onOpacityChange}\n          item={\n            {\n              settings: {\n                min: 0,\n                max: 1,\n                step: 0.1,\n              },\n            } as FieldConfigPropertyItem\n          }\n        />\n      </Field>\n      {settings?.displayRotation && (\n        <Field label={t('geomap.style-editor.label-rotation-angle', 'Rotation angle')}>\n          <ScalarDimensionEditor\n            id={rotationAngle1Id}\n            value={value?.rotation ?? defaultStyleConfig.rotation}\n            context={context}\n            onChange={onRotationChange}\n            item={\n              {\n                settings: {\n                  min: defaultStyleConfig.rotation.min,\n                  max: defaultStyleConfig.rotation.max,\n                },\n              } as StandardEditorsRegistryItem\n            }\n          />\n        </Field>\n      )}\n      <Field label={t('geomap.style-editor.label-text-label', 'Text label')}>\n        <TextDimensionEditor\n          id={textId}\n          value={value?.text ?? defaultTextConfig}\n          context={context}\n          onChange={onTextChange}\n          item={{} as StandardEditorsRegistryItem}\n        />\n      </Field>\n\n      {hasTextLabel && (\n        <>\n          <Stack>\n            <Field label={t('geomap.style-editor.label-font-size', 'Font size')}>\n              <NumberValueEditor\n                id={fontSizeId}\n                value={value?.textConfig?.fontSize ?? defaultStyleConfig.textConfig.fontSize}\n                context={context}\n                onChange={onTextFontSizeChange}\n                item={{} as FieldConfigPropertyItem}\n              />\n            </Field>\n            <Field label={t('geomap.style-editor.label-x-offset', 'X offset')}>\n              <NumberValueEditor\n                id={xOffsetId}\n                value={value?.textConfig?.offsetX ?? defaultStyleConfig.textConfig.offsetX}\n                context={context}\n                onChange={onTextOffsetXChange}\n                item={{} as FieldConfigPropertyItem}\n              />\n            </Field>\n            <Field label={t('geomap.style-editor.label-y-offset', 'Y offset')}>\n              <NumberValueEditor\n                id={yOffsetId}\n                value={value?.textConfig?.offsetY ?? defaultStyleConfig.textConfig.offsetY}\n                context={context}\n                onChange={onTextOffsetYChange}\n                item={{} as FieldConfigPropertyItem}\n              />\n            </Field>\n          </Stack>\n          <Field label={t('geomap.style-editor.label-align', 'Align')}>\n            <RadioButtonGroup\n              value={value?.textConfig?.textAlign ?? defaultStyleConfig.textConfig.textAlign}\n              onChange={onTextAlignChange}\n              options={[\n                { value: TextAlignment.Left, label: capitalize(TextAlignment.Left) },\n                { value: TextAlignment.Center, label: capitalize(TextAlignment.Center) },\n                { value: TextAlignment.Right, label: capitalize(TextAlignment.Right) },\n              ]}\n            />\n          </Field>\n          <Field label={t('geomap.style-editor.label-baseline', 'Baseline')}>\n            <RadioButtonGroup\n              value={value?.textConfig?.textBaseline ?? defaultStyleConfig.textConfig.textBaseline}\n              onChange={onTextBaselineChange}\n              options={[\n                { value: TextBaseline.Top, label: capitalize(TextBaseline.Top) },\n                { value: TextBaseline.Middle, label: capitalize(TextBaseline.Middle) },\n                { value: TextBaseline.Bottom, label: capitalize(TextBaseline.Bottom) },\n              ]}\n            />\n          </Field>\n        </>\n      )}\n    </>\n  );\n};\n","import OpenLayersMap from 'ol/Map';\nimport { Point } from 'ol/geom';\nimport { VectorImage } from 'ol/layer';\nimport LayerGroup from 'ol/layer/Group';\nimport WebGLPointsLayer from 'ol/layer/WebGLPoints.js';\nimport { ReactNode } from 'react';\nimport { ReplaySubject } from 'rxjs';\nimport tinycolor from 'tinycolor2';\n\nimport {\n  MapLayerRegistryItem,\n  MapLayerOptions,\n  PanelData,\n  GrafanaTheme2,\n  FrameGeometrySourceMode,\n  EventBus,\n  PanelOptionsEditorBuilder,\n} from '@grafana/data';\nimport { t } from '@grafana/i18n';\nimport { FrameVectorSource } from 'app/features/geo/utils/frameVectorSource';\nimport { getLocationMatchers } from 'app/features/geo/utils/location';\n\nimport { MarkersLegend, MarkersLegendProps } from '../../components/MarkersLegend';\nimport { ObservablePropsWrapper } from '../../components/ObservablePropsWrapper';\nimport { StyleEditor } from '../../editor/StyleEditor';\nimport { getWebGLStyle, textMarker } from '../../style/markers';\nimport { DEFAULT_SIZE, defaultStyleConfig, StyleConfig, StyleConfigValues } from '../../style/types';\nimport { getDisplacement, getRGBValues, getStyleConfigState, styleUsesText } from '../../style/utils';\nimport { getStyleDimension } from '../../utils/utils';\n\n// Configuration options for Circle overlays\nexport interface MarkersConfig {\n  style: StyleConfig;\n  showLegend?: boolean;\n}\n\nconst defaultOptions: MarkersConfig = {\n  style: defaultStyleConfig,\n  showLegend: true,\n};\n\nexport const MARKERS_LAYER_ID = 'markers';\n\n// Used by default when nothing is configured\nexport const defaultMarkersConfig: MapLayerOptions<MarkersConfig> = {\n  type: MARKERS_LAYER_ID,\n  name: '', // will get replaced\n  config: defaultOptions,\n  location: {\n    mode: FrameGeometrySourceMode.Auto,\n  },\n  tooltip: true,\n};\n\n/**\n * Map layer configuration for circle overlay\n */\nexport const markersLayer: MapLayerRegistryItem<MarkersConfig> = {\n  id: MARKERS_LAYER_ID,\n  name: 'Markers',\n  description: 'Use markers to render each data point',\n  isBaseMap: false,\n  showLocation: true,\n  hideOpacity: true,\n\n  /**\n   * Function that configures transformation and returns a transformer\n   * @param map\n   * @param options\n   * @param theme\n   */\n  create: async (map: OpenLayersMap, options: MapLayerOptions<MarkersConfig>, eventBus: EventBus, theme: GrafanaTheme2) => {\n    // Assert default values\n    const config = {\n      ...defaultOptions,\n      ...options?.config,\n    };\n\n    const style = await getStyleConfigState(config.style);\n    const symbol = config.style.symbol?.fixed;\n    const webGLStyle = await getWebGLStyle(symbol, config.style.opacity);\n    const hasText = styleUsesText(config.style);\n    const location = await getLocationMatchers(options.location);\n    const source = new FrameVectorSource<Point>(location);\n    const symbolLayer = new WebGLPointsLayer({ source, style: webGLStyle });\n    const vectorLayer = new VectorImage({ source, declutter: true });\n    // Initialize hasVector with just text check, will be updated when features are available\n    let hasVector = hasText;\n\n    const layers = new LayerGroup({\n      layers: hasVector ? (symbol ? [symbolLayer, vectorLayer] : [vectorLayer]) : [symbolLayer],\n    });\n\n    const legendProps = new ReplaySubject<MarkersLegendProps>(1);\n    let legend: ReactNode = null;\n    if (config.showLegend) {\n      legend = <ObservablePropsWrapper watch={legendProps} initialSubProps={{}} child={MarkersLegend} />;\n    }\n\n    return {\n      init: () => layers,\n      legend: legend,\n      update: (data: PanelData) => {\n        if (!data.series?.length) {\n          source.clear();\n          return; // ignore empty\n        }\n\n        for (const frame of data.series) {\n          style.dims = getStyleDimension(frame, style, theme);\n\n          // Post updates to the legend component\n          if (legend) {\n            legendProps.next({\n              styleConfig: style,\n              size: style.dims?.size,\n              layerName: options.name,\n              layer: symbolLayer,\n            });\n          }\n\n          source.update(frame);\n\n          // Track if we find any line strings during feature processing\n          let hasLineString = false;\n          // Track coordinates to avoid rendering duplicate markers at the same location\n          const processedMarkers = new Set<string>();\n\n          // Helper function to create a robust uniqueness key\n          const createMarkerKey = (coordinates: number[], markerValues: StyleConfigValues): string => {\n            const coord = `${coordinates[0]},${coordinates[1]}`;\n            const { color, size, text, rotation } = markerValues;\n            return `markerAddressKey|${coord}|${color}|${size}|${text}|${rotation}`;\n          };\n\n          source.forEachFeature((feature) => {\n            const geometry = feature.getGeometry();\n            const isLineString = geometry?.getType() === 'LineString';\n\n            if (isLineString) {\n              hasLineString = true;\n            }\n\n            const idx: number = feature.get('rowIndex');\n            const dims = style.dims;\n            const values = { ...style.base };\n\n            if (dims?.color) {\n              values.color = dims.color.get(idx);\n            }\n            if (dims?.size) {\n              values.size = dims.size.get(idx);\n            }\n            if (dims?.text) {\n              values.text = dims.text.get(idx);\n            }\n            if (dims?.rotation) {\n              values.rotation = dims.rotation.get(idx);\n            }\n\n            // For point geometries, check if we've already processed this marker\n            if (geometry?.getType() === 'Point') {\n              const coordinates = geometry.getCoordinates();\n\n              // Skip this feature if coordinates are invalid\n              if (!coordinates || coordinates.length < 2) {\n                return;\n              }\n\n              const markerKey = createMarkerKey(coordinates, values);\n\n              // Skip this feature if we've already processed a marker with identical properties\n              if (processedMarkers.has(markerKey)) {\n                return;\n              }\n              processedMarkers.add(markerKey);\n            }\n\n            // Set style to be used by LineString\n            if (isLineString) {\n              const lineStringStyle = style.maker(values);\n              feature.setStyle(lineStringStyle);\n            } else {\n              const colorString = tinycolor(theme.visualization.getColorByName(values.color)).toString();\n              const colorValues = getRGBValues(colorString);\n\n              const radius = values.size ?? DEFAULT_SIZE;\n              const displacement = getDisplacement(values.symbolAlign ?? defaultStyleConfig.symbolAlign, radius);\n\n              // WebGLPointsLayer uses style expressions instead of style functions\n              feature.setProperties({ red: colorValues?.r ?? 255 });\n              feature.setProperties({ green: colorValues?.g ?? 255 });\n              feature.setProperties({ blue: colorValues?.b ?? 255 });\n              feature.setProperties({ size: (values.size ?? 1) * 2 }); // TODO unify sizing across all source types\n              feature.setProperties({ rotation: ((values.rotation ?? 0) * Math.PI) / 180 });\n              feature.setProperties({ opacity: (values.opacity ?? 1) * (colorValues?.a ?? 1) });\n              feature.setProperties({ offsetX: displacement[0] });\n              feature.setProperties({ offsetY: displacement[1] });\n            }\n\n            // Set style to be used by VectorLayer (text only)\n            if (hasText) {\n              const textStyle = textMarker(values);\n              feature.setStyle(textStyle);\n            }\n          });\n\n          // Update hasVector state after processing all features\n          hasVector = hasText || hasLineString;\n\n          // Update layer visibility based on current hasVector state\n          const layersArray = layers.getLayers();\n          layersArray.clear();\n          if (hasVector) {\n            layersArray.extend(symbol ? [symbolLayer, vectorLayer] : [vectorLayer]);\n          } else {\n            layersArray.extend([symbolLayer]);\n          }\n\n          break; // Only the first frame for now!\n        }\n      },\n\n      // Marker overlay options\n      registerOptionsUI: (builder: PanelOptionsEditorBuilder<MapLayerOptions<MarkersConfig>>) => {\n        builder\n          .addCustomEditor({\n            id: 'config.style',\n            path: 'config.style',\n            name: t('geomap.markers-layer.name-styles', 'Styles'),\n            editor: StyleEditor,\n            settings: {\n              displayRotation: true,\n            },\n            defaultValue: defaultOptions.style,\n          })\n          .addBooleanSwitch({\n            path: 'config.showLegend',\n            name: t('geomap.markers-layer.name-show-legend', 'Show legend'),\n            description: t('geomap.markers-layer.description-show-legend', 'Show map legend'),\n            defaultValue: defaultOptions.showLegend,\n          });\n      },\n    };\n  },\n\n  // fill in the default values\n  defaultOptions,\n};\n","/**\n * @module ol/tilegrid/TileGrid\n */\nimport TileRange, {\n  createOrUpdate as createOrUpdateTileRange,\n} from '../TileRange.js';\nimport {isSorted, linearFindNearest} from '../array.js';\nimport {assert} from '../asserts.js';\nimport {createOrUpdate, getTopLeft} from '../extent.js';\nimport {intersectsLinearRing} from '../geom/flat/intersectsextent.js';\nimport {ceil, clamp, floor} from '../math.js';\nimport {toSize} from '../size.js';\nimport {createOrUpdate as createOrUpdateTileCoord} from '../tilecoord.js';\nimport {DEFAULT_TILE_SIZE} from './common.js';\n\n/**\n * @private\n * @type {import(\"../tilecoord.js\").TileCoord}\n */\nconst tmpTileCoord = [0, 0, 0];\n\n/**\n * Number of decimal digits to consider in integer values when rounding.\n * @type {number}\n */\nconst DECIMALS = 5;\n\n/**\n * @typedef {Object} Options\n * @property {import(\"../extent.js\").Extent} [extent] Extent for the tile grid. No tiles outside this\n * extent will be requested by {@link module:ol/source/Tile~TileSource} sources. When no `origin` or\n * `origins` are configured, the `origin` will be set to the top-left corner of the extent.\n * @property {number} [minZoom=0] Minimum zoom.\n * @property {import(\"../coordinate.js\").Coordinate} [origin] The tile grid origin, i.e. where the `x`\n * and `y` axes meet (`[z, 0, 0]`). Tile coordinates increase left to right and downwards. If not\n * specified, `extent` or `origins` must be provided.\n * @property {Array<import(\"../coordinate.js\").Coordinate>} [origins] Tile grid origins, i.e. where\n * the `x` and `y` axes meet (`[z, 0, 0]`), for each zoom level. If given, the array length\n * should match the length of the `resolutions` array, i.e. each resolution can have a different\n * origin. Tile coordinates increase left to right and downwards. If not specified, `extent` or\n * `origin` must be provided.\n * @property {!Array<number>} resolutions Resolutions. The array index of each resolution needs\n * to match the zoom level. This means that even if a `minZoom` is configured, the resolutions\n * array will have a length of `maxZoom + 1`.\n * @property {Array<import(\"../size.js\").Size>} [sizes] Number of tile rows and columns\n * of the grid for each zoom level. If specified the values\n * define each zoom level's extent together with the `origin` or `origins`.\n * A grid `extent` can be configured in addition, and will further limit the extent\n * for which tile requests are made by sources. If the bottom-left corner of\n * an extent is used as `origin` or `origins`, then the `y` value must be\n * negative because OpenLayers tile coordinates use the top left as the origin.\n * @property {number|import(\"../size.js\").Size} [tileSize] Tile size.\n * Default is `[256, 256]`.\n * @property {Array<number|import(\"../size.js\").Size>} [tileSizes] Tile sizes. If given, the array length\n * should match the length of the `resolutions` array, i.e. each resolution can have a different\n * tile size.\n */\n\n/**\n * @classdesc\n * Base class for setting the grid pattern for sources accessing tiled-image\n * servers.\n * @api\n */\nclass TileGrid {\n  /**\n   * @param {Options} options Tile grid options.\n   */\n  constructor(options) {\n    /**\n     * @protected\n     * @type {number}\n     */\n    this.minZoom = options.minZoom !== undefined ? options.minZoom : 0;\n\n    /**\n     * @private\n     * @type {!Array<number>}\n     */\n    this.resolutions_ = options.resolutions;\n    assert(\n      isSorted(\n        this.resolutions_,\n        /**\n         * @param {number} a First resolution\n         * @param {number} b Second resolution\n         * @return {number} Comparison result\n         */\n        (a, b) => b - a,\n        true,\n      ),\n      '`resolutions` must be sorted in descending order',\n    );\n\n    // check if we've got a consistent zoom factor and origin\n    let zoomFactor;\n    if (!options.origins) {\n      for (let i = 0, ii = this.resolutions_.length - 1; i < ii; ++i) {\n        if (!zoomFactor) {\n          zoomFactor = this.resolutions_[i] / this.resolutions_[i + 1];\n        } else {\n          if (this.resolutions_[i] / this.resolutions_[i + 1] !== zoomFactor) {\n            zoomFactor = undefined;\n            break;\n          }\n        }\n      }\n    }\n\n    /**\n     * @private\n     * @type {number|undefined}\n     */\n    this.zoomFactor_ = zoomFactor;\n\n    /**\n     * @protected\n     * @type {number}\n     */\n    this.maxZoom = this.resolutions_.length - 1;\n\n    /**\n     * @private\n     * @type {import(\"../coordinate.js\").Coordinate|null}\n     */\n    this.origin_ = options.origin !== undefined ? options.origin : null;\n\n    /**\n     * @private\n     * @type {Array<import(\"../coordinate.js\").Coordinate>}\n     */\n    this.origins_ = null;\n    if (options.origins !== undefined) {\n      this.origins_ = options.origins;\n      assert(\n        this.origins_.length == this.resolutions_.length,\n        'Number of `origins` and `resolutions` must be equal',\n      );\n    }\n\n    const extent = options.extent;\n\n    if (extent !== undefined && !this.origin_ && !this.origins_) {\n      this.origin_ = getTopLeft(extent);\n    }\n\n    assert(\n      (!this.origin_ && this.origins_) || (this.origin_ && !this.origins_),\n      'Either `origin` or `origins` must be configured, never both',\n    );\n\n    /**\n     * @private\n     * @type {Array<number|import(\"../size.js\").Size>}\n     */\n    this.tileSizes_ = null;\n    if (options.tileSizes !== undefined) {\n      this.tileSizes_ = options.tileSizes;\n      assert(\n        this.tileSizes_.length == this.resolutions_.length,\n        'Number of `tileSizes` and `resolutions` must be equal',\n      );\n    }\n\n    /**\n     * @private\n     * @type {number|import(\"../size.js\").Size}\n     */\n    this.tileSize_ =\n      options.tileSize !== undefined\n        ? options.tileSize\n        : !this.tileSizes_\n          ? DEFAULT_TILE_SIZE\n          : null;\n    assert(\n      (!this.tileSize_ && this.tileSizes_) ||\n        (this.tileSize_ && !this.tileSizes_),\n      'Either `tileSize` or `tileSizes` must be configured, never both',\n    );\n\n    /**\n     * @private\n     * @type {import(\"../extent.js\").Extent}\n     */\n    this.extent_ = extent !== undefined ? extent : null;\n\n    /**\n     * @private\n     * @type {Array<import(\"../TileRange.js\").default>}\n     */\n    this.fullTileRanges_ = null;\n\n    /**\n     * @private\n     * @type {import(\"../size.js\").Size}\n     */\n    this.tmpSize_ = [0, 0];\n\n    /**\n     * @private\n     * @type {import(\"../extent.js\").Extent}\n     */\n    this.tmpExtent_ = [0, 0, 0, 0];\n\n    if (options.sizes !== undefined) {\n      this.fullTileRanges_ = options.sizes.map((size, z) => {\n        const tileRange = new TileRange(\n          Math.min(0, size[0]),\n          Math.max(size[0] - 1, -1),\n          Math.min(0, size[1]),\n          Math.max(size[1] - 1, -1),\n        );\n        if (extent) {\n          const restrictedTileRange = this.getTileRangeForExtentAndZ(extent, z);\n          tileRange.minX = Math.max(restrictedTileRange.minX, tileRange.minX);\n          tileRange.maxX = Math.min(restrictedTileRange.maxX, tileRange.maxX);\n          tileRange.minY = Math.max(restrictedTileRange.minY, tileRange.minY);\n          tileRange.maxY = Math.min(restrictedTileRange.maxY, tileRange.maxY);\n        }\n        return tileRange;\n      });\n    } else if (extent) {\n      this.calculateTileRanges_(extent);\n    }\n  }\n\n  /**\n   * Call a function with each tile coordinate for a given extent and zoom level.\n   *\n   * @param {import(\"../extent.js\").Extent} extent Extent.\n   * @param {number} zoom Integer zoom level.\n   * @param {function(import(\"../tilecoord.js\").TileCoord): void} callback Function called with each tile coordinate.\n   * @api\n   */\n  forEachTileCoord(extent, zoom, callback) {\n    const tileRange = this.getTileRangeForExtentAndZ(extent, zoom);\n    for (let i = tileRange.minX, ii = tileRange.maxX; i <= ii; ++i) {\n      for (let j = tileRange.minY, jj = tileRange.maxY; j <= jj; ++j) {\n        callback([zoom, i, j]);\n      }\n    }\n  }\n\n  /**\n   * @param {import(\"../tilecoord.js\").TileCoord} tileCoord Tile coordinate.\n   * @param {function(number, import(\"../TileRange.js\").default): boolean} callback Callback.\n   * @param {import(\"../TileRange.js\").default} [tempTileRange] Temporary import(\"../TileRange.js\").default object.\n   * @param {import(\"../extent.js\").Extent} [tempExtent] Temporary import(\"../extent.js\").Extent object.\n   * @return {boolean} Callback succeeded.\n   */\n  forEachTileCoordParentTileRange(\n    tileCoord,\n    callback,\n    tempTileRange,\n    tempExtent,\n  ) {\n    let tileRange, x, y;\n    let tileCoordExtent = null;\n    let z = tileCoord[0] - 1;\n    if (this.zoomFactor_ === 2) {\n      x = tileCoord[1];\n      y = tileCoord[2];\n    } else {\n      tileCoordExtent = this.getTileCoordExtent(tileCoord, tempExtent);\n    }\n    while (z >= this.minZoom) {\n      if (x !== undefined && y !== undefined) {\n        x = Math.floor(x / 2);\n        y = Math.floor(y / 2);\n        tileRange = createOrUpdateTileRange(x, x, y, y, tempTileRange);\n      } else {\n        tileRange = this.getTileRangeForExtentAndZ(\n          tileCoordExtent,\n          z,\n          tempTileRange,\n        );\n      }\n      if (callback(z, tileRange)) {\n        return true;\n      }\n      --z;\n    }\n    return false;\n  }\n\n  /**\n   * Get the extent for this tile grid, if it was configured.\n   * @return {import(\"../extent.js\").Extent} Extent.\n   * @api\n   */\n  getExtent() {\n    return this.extent_;\n  }\n\n  /**\n   * Get the maximum zoom level for the grid.\n   * @return {number} Max zoom.\n   * @api\n   */\n  getMaxZoom() {\n    return this.maxZoom;\n  }\n\n  /**\n   * Get the minimum zoom level for the grid.\n   * @return {number} Min zoom.\n   * @api\n   */\n  getMinZoom() {\n    return this.minZoom;\n  }\n\n  /**\n   * Get the origin for the grid at the given zoom level.\n   * @param {number} z Integer zoom level.\n   * @return {import(\"../coordinate.js\").Coordinate} Origin.\n   * @api\n   */\n  getOrigin(z) {\n    if (this.origin_) {\n      return this.origin_;\n    }\n    return this.origins_[z];\n  }\n\n  /**\n   * Get the resolution for the given zoom level.\n   * @param {number} z Integer zoom level.\n   * @return {number} Resolution.\n   * @api\n   */\n  getResolution(z) {\n    return this.resolutions_[z];\n  }\n\n  /**\n   * Get the list of resolutions for the tile grid.\n   * @return {Array<number>} Resolutions.\n   * @api\n   */\n  getResolutions() {\n    return this.resolutions_;\n  }\n\n  /**\n   * @param {import(\"../tilecoord.js\").TileCoord} tileCoord Tile coordinate.\n   * @param {import(\"../TileRange.js\").default} [tempTileRange] Temporary import(\"../TileRange.js\").default object.\n   * @param {import(\"../extent.js\").Extent} [tempExtent] Temporary import(\"../extent.js\").Extent object.\n   * @return {import(\"../TileRange.js\").default|null} Tile range.\n   */\n  getTileCoordChildTileRange(tileCoord, tempTileRange, tempExtent) {\n    if (tileCoord[0] < this.maxZoom) {\n      if (this.zoomFactor_ === 2) {\n        const minX = tileCoord[1] * 2;\n        const minY = tileCoord[2] * 2;\n        return createOrUpdateTileRange(\n          minX,\n          minX + 1,\n          minY,\n          minY + 1,\n          tempTileRange,\n        );\n      }\n      const tileCoordExtent = this.getTileCoordExtent(\n        tileCoord,\n        tempExtent || this.tmpExtent_,\n      );\n      return this.getTileRangeForExtentAndZ(\n        tileCoordExtent,\n        tileCoord[0] + 1,\n        tempTileRange,\n      );\n    }\n    return null;\n  }\n\n  /**\n   * @param {import(\"../tilecoord.js\").TileCoord} tileCoord Tile coordinate.\n   * @param {number} z Integer zoom level.\n   * @param {import(\"../TileRange.js\").default} [tempTileRange] Temporary import(\"../TileRange.js\").default object.\n   * @return {import(\"../TileRange.js\").default|null} Tile range.\n   */\n  getTileRangeForTileCoordAndZ(tileCoord, z, tempTileRange) {\n    if (z > this.maxZoom || z < this.minZoom) {\n      return null;\n    }\n\n    const tileCoordZ = tileCoord[0];\n    const tileCoordX = tileCoord[1];\n    const tileCoordY = tileCoord[2];\n\n    if (z === tileCoordZ) {\n      return createOrUpdateTileRange(\n        tileCoordX,\n        tileCoordY,\n        tileCoordX,\n        tileCoordY,\n        tempTileRange,\n      );\n    }\n\n    if (this.zoomFactor_) {\n      const factor = Math.pow(this.zoomFactor_, z - tileCoordZ);\n      const minX = Math.floor(tileCoordX * factor);\n      const minY = Math.floor(tileCoordY * factor);\n      if (z < tileCoordZ) {\n        return createOrUpdateTileRange(minX, minX, minY, minY, tempTileRange);\n      }\n\n      const maxX = Math.floor(factor * (tileCoordX + 1)) - 1;\n      const maxY = Math.floor(factor * (tileCoordY + 1)) - 1;\n      return createOrUpdateTileRange(minX, maxX, minY, maxY, tempTileRange);\n    }\n\n    const tileCoordExtent = this.getTileCoordExtent(tileCoord, this.tmpExtent_);\n    return this.getTileRangeForExtentAndZ(tileCoordExtent, z, tempTileRange);\n  }\n\n  /**\n   * Get a tile range for the given extent and integer zoom level.\n   * @param {import(\"../extent.js\").Extent} extent Extent.\n   * @param {number} z Integer zoom level.\n   * @param {import(\"../TileRange.js\").default} [tempTileRange] Temporary tile range object.\n   * @return {import(\"../TileRange.js\").default} Tile range.\n   */\n  getTileRangeForExtentAndZ(extent, z, tempTileRange) {\n    this.getTileCoordForXYAndZ_(extent[0], extent[3], z, false, tmpTileCoord);\n    const minX = tmpTileCoord[1];\n    const minY = tmpTileCoord[2];\n    this.getTileCoordForXYAndZ_(extent[2], extent[1], z, true, tmpTileCoord);\n    const maxX = tmpTileCoord[1];\n    const maxY = tmpTileCoord[2];\n    return createOrUpdateTileRange(minX, maxX, minY, maxY, tempTileRange);\n  }\n\n  /**\n   * @param {import(\"../tilecoord.js\").TileCoord} tileCoord Tile coordinate.\n   * @return {import(\"../coordinate.js\").Coordinate} Tile center.\n   */\n  getTileCoordCenter(tileCoord) {\n    const origin = this.getOrigin(tileCoord[0]);\n    const resolution = this.getResolution(tileCoord[0]);\n    const tileSize = toSize(this.getTileSize(tileCoord[0]), this.tmpSize_);\n    return [\n      origin[0] + (tileCoord[1] + 0.5) * tileSize[0] * resolution,\n      origin[1] - (tileCoord[2] + 0.5) * tileSize[1] * resolution,\n    ];\n  }\n\n  /**\n   * Get the extent of a tile coordinate.\n   *\n   * @param {import(\"../tilecoord.js\").TileCoord} tileCoord Tile coordinate.\n   * @param {import(\"../extent.js\").Extent} [tempExtent] Temporary extent object.\n   * @return {import(\"../extent.js\").Extent} Extent.\n   * @api\n   */\n  getTileCoordExtent(tileCoord, tempExtent) {\n    const origin = this.getOrigin(tileCoord[0]);\n    const resolution = this.getResolution(tileCoord[0]);\n    const tileSize = toSize(this.getTileSize(tileCoord[0]), this.tmpSize_);\n    const minX = origin[0] + tileCoord[1] * tileSize[0] * resolution;\n    const minY = origin[1] - (tileCoord[2] + 1) * tileSize[1] * resolution;\n    const maxX = minX + tileSize[0] * resolution;\n    const maxY = minY + tileSize[1] * resolution;\n    return createOrUpdate(minX, minY, maxX, maxY, tempExtent);\n  }\n\n  /**\n   * Get the tile coordinate for the given map coordinate and resolution.  This\n   * method considers that coordinates that intersect tile boundaries should be\n   * assigned the higher tile coordinate.\n   *\n   * @param {import(\"../coordinate.js\").Coordinate} coordinate Coordinate.\n   * @param {number} resolution Resolution.\n   * @param {import(\"../tilecoord.js\").TileCoord} [opt_tileCoord] Destination import(\"../tilecoord.js\").TileCoord object.\n   * @return {import(\"../tilecoord.js\").TileCoord} Tile coordinate.\n   * @api\n   */\n  getTileCoordForCoordAndResolution(coordinate, resolution, opt_tileCoord) {\n    return this.getTileCoordForXYAndResolution_(\n      coordinate[0],\n      coordinate[1],\n      resolution,\n      false,\n      opt_tileCoord,\n    );\n  }\n\n  /**\n   * Note that this method should not be called for resolutions that correspond\n   * to an integer zoom level.  Instead call the `getTileCoordForXYAndZ_` method.\n   * @param {number} x X.\n   * @param {number} y Y.\n   * @param {number} resolution Resolution (for a non-integer zoom level).\n   * @param {boolean} reverseIntersectionPolicy Instead of letting edge\n   *     intersections go to the higher tile coordinate, let edge intersections\n   *     go to the lower tile coordinate.\n   * @param {import(\"../tilecoord.js\").TileCoord} [opt_tileCoord] Temporary import(\"../tilecoord.js\").TileCoord object.\n   * @return {import(\"../tilecoord.js\").TileCoord} Tile coordinate.\n   * @private\n   */\n  getTileCoordForXYAndResolution_(\n    x,\n    y,\n    resolution,\n    reverseIntersectionPolicy,\n    opt_tileCoord,\n  ) {\n    const z = this.getZForResolution(resolution);\n    const scale = resolution / this.getResolution(z);\n    const origin = this.getOrigin(z);\n    const tileSize = toSize(this.getTileSize(z), this.tmpSize_);\n\n    let tileCoordX = (scale * (x - origin[0])) / resolution / tileSize[0];\n    let tileCoordY = (scale * (origin[1] - y)) / resolution / tileSize[1];\n\n    if (reverseIntersectionPolicy) {\n      tileCoordX = ceil(tileCoordX, DECIMALS) - 1;\n      tileCoordY = ceil(tileCoordY, DECIMALS) - 1;\n    } else {\n      tileCoordX = floor(tileCoordX, DECIMALS);\n      tileCoordY = floor(tileCoordY, DECIMALS);\n    }\n\n    return createOrUpdateTileCoord(z, tileCoordX, tileCoordY, opt_tileCoord);\n  }\n\n  /**\n   * Although there is repetition between this method and `getTileCoordForXYAndResolution_`,\n   * they should have separate implementations.  This method is for integer zoom\n   * levels.  The other method should only be called for resolutions corresponding\n   * to non-integer zoom levels.\n   * @param {number} x Map x coordinate.\n   * @param {number} y Map y coordinate.\n   * @param {number} z Integer zoom level.\n   * @param {boolean} reverseIntersectionPolicy Instead of letting edge\n   *     intersections go to the higher tile coordinate, let edge intersections\n   *     go to the lower tile coordinate.\n   * @param {import(\"../tilecoord.js\").TileCoord} [opt_tileCoord] Temporary import(\"../tilecoord.js\").TileCoord object.\n   * @return {import(\"../tilecoord.js\").TileCoord} Tile coordinate.\n   * @private\n   */\n  getTileCoordForXYAndZ_(x, y, z, reverseIntersectionPolicy, opt_tileCoord) {\n    const origin = this.getOrigin(z);\n    const resolution = this.getResolution(z);\n    const tileSize = toSize(this.getTileSize(z), this.tmpSize_);\n\n    let tileCoordX = (x - origin[0]) / resolution / tileSize[0];\n    let tileCoordY = (origin[1] - y) / resolution / tileSize[1];\n\n    if (reverseIntersectionPolicy) {\n      tileCoordX = ceil(tileCoordX, DECIMALS) - 1;\n      tileCoordY = ceil(tileCoordY, DECIMALS) - 1;\n    } else {\n      tileCoordX = floor(tileCoordX, DECIMALS);\n      tileCoordY = floor(tileCoordY, DECIMALS);\n    }\n\n    return createOrUpdateTileCoord(z, tileCoordX, tileCoordY, opt_tileCoord);\n  }\n\n  /**\n   * Get a tile coordinate given a map coordinate and zoom level.\n   * @param {import(\"../coordinate.js\").Coordinate} coordinate Coordinate.\n   * @param {number} z Integer zoom level, e.g. the result of a `getZForResolution()` method call\n   * @param {import(\"../tilecoord.js\").TileCoord} [opt_tileCoord] Destination import(\"../tilecoord.js\").TileCoord object.\n   * @return {import(\"../tilecoord.js\").TileCoord} Tile coordinate.\n   * @api\n   */\n  getTileCoordForCoordAndZ(coordinate, z, opt_tileCoord) {\n    return this.getTileCoordForXYAndZ_(\n      coordinate[0],\n      coordinate[1],\n      z,\n      false,\n      opt_tileCoord,\n    );\n  }\n\n  /**\n   * @param {import(\"../tilecoord.js\").TileCoord} tileCoord Tile coordinate.\n   * @return {number} Tile resolution.\n   */\n  getTileCoordResolution(tileCoord) {\n    return this.resolutions_[tileCoord[0]];\n  }\n\n  /**\n   * Get the tile size for a zoom level. The type of the return value matches the\n   * `tileSize` or `tileSizes` that the tile grid was configured with. To always\n   * get an {@link import(\"../size.js\").Size}, run the result through {@link module:ol/size.toSize}.\n   * @param {number} z Z.\n   * @return {number|import(\"../size.js\").Size} Tile size.\n   * @api\n   */\n  getTileSize(z) {\n    if (this.tileSize_) {\n      return this.tileSize_;\n    }\n    return this.tileSizes_[z];\n  }\n\n  /**\n   * @param {number} z Zoom level.\n   * @return {import(\"../TileRange.js\").default|null} Extent tile range for the specified zoom level.\n   */\n  getFullTileRange(z) {\n    if (!this.fullTileRanges_) {\n      return this.extent_\n        ? this.getTileRangeForExtentAndZ(this.extent_, z)\n        : null;\n    }\n    return this.fullTileRanges_[z];\n  }\n\n  /**\n   * @param {number} resolution Resolution.\n   * @param {number|import(\"../array.js\").NearestDirectionFunction} [opt_direction]\n   *     If 0, the nearest resolution will be used.\n   *     If 1, the nearest higher resolution (lower Z) will be used. If -1, the\n   *     nearest lower resolution (higher Z) will be used. Default is 0.\n   *     Use a {@link module:ol/array~NearestDirectionFunction} for more precise control.\n   *\n   * For example to change tile Z at the midpoint of zoom levels\n   * ```js\n   * function(value, high, low) {\n   *   return value - low * Math.sqrt(high / low);\n   * }\n   * ```\n   * @return {number} Z.\n   * @api\n   */\n  getZForResolution(resolution, opt_direction) {\n    const z = linearFindNearest(\n      this.resolutions_,\n      resolution,\n      opt_direction || 0,\n    );\n    return clamp(z, this.minZoom, this.maxZoom);\n  }\n\n  /**\n   * The tile with the provided tile coordinate intersects the given viewport.\n   * @param {import('../tilecoord.js').TileCoord} tileCoord Tile coordinate.\n   * @param {Array<number>} viewport Viewport as returned from {@link module:ol/extent.getRotatedViewport}.\n   * @return {boolean} The tile with the provided tile coordinate intersects the given viewport.\n   */\n  tileCoordIntersectsViewport(tileCoord, viewport) {\n    return intersectsLinearRing(\n      viewport,\n      0,\n      viewport.length,\n      2,\n      this.getTileCoordExtent(tileCoord),\n    );\n  }\n\n  /**\n   * @param {!import(\"../extent.js\").Extent} extent Extent for this tile grid.\n   * @private\n   */\n  calculateTileRanges_(extent) {\n    const length = this.resolutions_.length;\n    const fullTileRanges = new Array(length);\n    for (let z = this.minZoom; z < length; ++z) {\n      fullTileRanges[z] = this.getTileRangeForExtentAndZ(extent, z);\n    }\n    this.fullTileRanges_ = fullTileRanges;\n  }\n}\n\nexport default TileGrid;\n","/**\n * @module ol/tilegrid\n */\nimport {\n  containsCoordinate,\n  createOrUpdate,\n  getCorner,\n  getHeight,\n  getWidth,\n} from './extent.js';\nimport {METERS_PER_UNIT, get as getProjection} from './proj.js';\nimport {toSize} from './size.js';\nimport TileGrid from './tilegrid/TileGrid.js';\nimport {DEFAULT_MAX_ZOOM, DEFAULT_TILE_SIZE} from './tilegrid/common.js';\n\nexport {TileGrid};\nexport {default as WMTS} from './tilegrid/WMTS.js';\n\n/**\n * @param {import(\"./proj/Projection.js\").default} projection Projection.\n * @return {!TileGrid} Default tile grid for the\n * passed projection.\n */\nexport function getForProjection(projection) {\n  let tileGrid = projection.getDefaultTileGrid();\n  if (!tileGrid) {\n    tileGrid = createForProjection(projection);\n    projection.setDefaultTileGrid(tileGrid);\n  }\n  return tileGrid;\n}\n\n/**\n * @param {TileGrid} tileGrid Tile grid.\n * @param {import(\"./tilecoord.js\").TileCoord} tileCoord Tile coordinate.\n * @param {import(\"./proj/Projection.js\").default} projection Projection.\n * @return {import(\"./tilecoord.js\").TileCoord} Tile coordinate.\n */\nexport function wrapX(tileGrid, tileCoord, projection) {\n  const z = tileCoord[0];\n  const center = tileGrid.getTileCoordCenter(tileCoord);\n  const projectionExtent = extentFromProjection(projection);\n  if (!containsCoordinate(projectionExtent, center)) {\n    const worldWidth = getWidth(projectionExtent);\n    const worldsAway = Math.ceil(\n      (projectionExtent[0] - center[0]) / worldWidth,\n    );\n    center[0] += worldWidth * worldsAway;\n    return tileGrid.getTileCoordForCoordAndZ(center, z);\n  }\n  return tileCoord;\n}\n\n/**\n * @param {import(\"./extent.js\").Extent} extent Extent.\n * @param {number} [maxZoom] Maximum zoom level (default is\n *     DEFAULT_MAX_ZOOM).\n * @param {number|import(\"./size.js\").Size} [tileSize] Tile size (default uses\n *     DEFAULT_TILE_SIZE).\n * @param {import(\"./extent.js\").Corner} [corner] Extent corner (default is `'top-left'`).\n * @return {!TileGrid} TileGrid instance.\n */\nexport function createForExtent(extent, maxZoom, tileSize, corner) {\n  corner = corner !== undefined ? corner : 'top-left';\n\n  const resolutions = resolutionsFromExtent(extent, maxZoom, tileSize);\n\n  return new TileGrid({\n    extent: extent,\n    origin: getCorner(extent, corner),\n    resolutions: resolutions,\n    tileSize: tileSize,\n  });\n}\n\n/**\n * @typedef {Object} XYZOptions\n * @property {import(\"./extent.js\").Extent} [extent] Extent for the tile grid. The origin for an XYZ tile grid is the\n * top-left corner of the extent. If `maxResolution` is not provided the zero level of the grid is defined by the resolution\n * at which one tile fits in the provided extent. If not provided, the extent of the EPSG:3857 projection is used.\n * @property {number} [maxResolution] Resolution at level zero.\n * @property {number} [maxZoom] Maximum zoom. The default is `42`. This determines the number of levels\n * in the grid set. For example, a `maxZoom` of 21 means there are 22 levels in the grid set.\n * @property {number} [minZoom=0] Minimum zoom.\n * @property {number|import(\"./size.js\").Size} [tileSize=[256, 256]] Tile size in pixels.\n */\n\n/**\n * Creates a tile grid with a standard XYZ tiling scheme.\n * @param {XYZOptions} [options] Tile grid options.\n * @return {!TileGrid} Tile grid instance.\n * @api\n */\nexport function createXYZ(options) {\n  const xyzOptions = options || {};\n\n  const extent = xyzOptions.extent || getProjection('EPSG:3857').getExtent();\n\n  const gridOptions = {\n    extent: extent,\n    minZoom: xyzOptions.minZoom,\n    tileSize: xyzOptions.tileSize,\n    resolutions: resolutionsFromExtent(\n      extent,\n      xyzOptions.maxZoom,\n      xyzOptions.tileSize,\n      xyzOptions.maxResolution,\n    ),\n  };\n  return new TileGrid(gridOptions);\n}\n\n/**\n * Create a resolutions array from an extent.  A zoom factor of 2 is assumed.\n * @param {import(\"./extent.js\").Extent} extent Extent.\n * @param {number} [maxZoom] Maximum zoom level (default is\n *     DEFAULT_MAX_ZOOM).\n * @param {number|import(\"./size.js\").Size} [tileSize] Tile size (default uses\n *     DEFAULT_TILE_SIZE).\n * @param {number} [maxResolution] Resolution at level zero.\n * @return {!Array<number>} Resolutions array.\n */\nfunction resolutionsFromExtent(extent, maxZoom, tileSize, maxResolution) {\n  maxZoom = maxZoom !== undefined ? maxZoom : DEFAULT_MAX_ZOOM;\n  tileSize = toSize(tileSize !== undefined ? tileSize : DEFAULT_TILE_SIZE);\n\n  const height = getHeight(extent);\n  const width = getWidth(extent);\n\n  maxResolution =\n    maxResolution > 0\n      ? maxResolution\n      : Math.max(width / tileSize[0], height / tileSize[1]);\n\n  const length = maxZoom + 1;\n  const resolutions = new Array(length);\n  for (let z = 0; z < length; ++z) {\n    resolutions[z] = maxResolution / Math.pow(2, z);\n  }\n  return resolutions;\n}\n\n/**\n * @param {import(\"./proj.js\").ProjectionLike} projection Projection.\n * @param {number} [maxZoom] Maximum zoom level (default is\n *     DEFAULT_MAX_ZOOM).\n * @param {number|import(\"./size.js\").Size} [tileSize] Tile size (default uses\n *     DEFAULT_TILE_SIZE).\n * @param {import(\"./extent.js\").Corner} [corner] Extent corner (default is `'top-left'`).\n * @return {!TileGrid} TileGrid instance.\n */\nexport function createForProjection(projection, maxZoom, tileSize, corner) {\n  const extent = extentFromProjection(projection);\n  return createForExtent(extent, maxZoom, tileSize, corner);\n}\n\n/**\n * Generate a tile grid extent from a projection.  If the projection has an\n * extent, it is used.  If not, a global extent is assumed.\n * @param {import(\"./proj.js\").ProjectionLike} projection Projection.\n * @return {import(\"./extent.js\").Extent} Extent.\n */\nexport function extentFromProjection(projection) {\n  projection = getProjection(projection);\n  let extent = projection.getExtent();\n  if (!extent) {\n    const half =\n      (180 * METERS_PER_UNIT.degrees) / projection.getMetersPerUnit();\n    extent = createOrUpdate(-half, -half, half, half);\n  }\n  return extent;\n}\n","/**\n * @module ol/uri\n */\n\nimport {modulo} from './math.js';\nimport {hashZXY} from './tilecoord.js';\n\n/**\n * Appends query parameters to a URI.\n *\n * @param {string} uri The original URI, which may already have query data.\n * @param {!Object} params An object where keys are URI-encoded parameter keys,\n *     and the values are arbitrary types or arrays.\n * @return {string} The new URI.\n */\nexport function appendParams(uri, params) {\n  /** @type {Array<string>} */\n  const keyParams = [];\n  // Skip any null or undefined parameter values\n  Object.keys(params).forEach(function (k) {\n    if (params[k] !== null && params[k] !== undefined) {\n      keyParams.push(k + '=' + encodeURIComponent(params[k]));\n    }\n  });\n  const qs = keyParams.join('&');\n  // remove any trailing ? or &\n  uri = uri.replace(/[?&]$/, '');\n  // append ? or & depending on whether uri has existing parameters\n  uri += uri.includes('?') ? '&' : '?';\n  return uri + qs;\n}\n\nconst zRegEx = /\\{z\\}/g;\nconst xRegEx = /\\{x\\}/g;\nconst yRegEx = /\\{y\\}/g;\nconst dashYRegEx = /\\{-y\\}/g;\n\n/**\n * @param {string} template The URL template.  Should have `{x}`, `{y}`, and `{z}` placeholders.  If\n * the template has a `{-y}` placeholder, the `maxY` parameter must be supplied.\n * @param {number} z The tile z coordinate.\n * @param {number} x The tile x coordinate.\n * @param {number} y The tile y coordinate.\n * @param {number} [maxY] The maximum y coordinate at the given z level.\n * @return {string} The URL.\n */\nexport function renderXYZTemplate(template, z, x, y, maxY) {\n  return template\n    .replace(zRegEx, z.toString())\n    .replace(xRegEx, x.toString())\n    .replace(yRegEx, y.toString())\n    .replace(dashYRegEx, function () {\n      if (maxY === undefined) {\n        throw new Error(\n          'If the URL template has a {-y} placeholder, the grid extent must be known',\n        );\n      }\n      return (maxY - y).toString();\n    });\n}\n\n/**\n * @param {Array<string>} urls List of URLs.\n * @param {number} z The tile z coordinate.\n * @param {number} x The tile x coordinate.\n * @param {number} y The tile y coordinate.\n * @return {string} The chosen URL.\n */\nexport function pickUrl(urls, z, x, y) {\n  const hash = hashZXY(z, x, y);\n  const index = modulo(hash, urls.length);\n  return urls[index];\n}\n\n/**\n * @param {string} url URL.\n * @return {Array<string>} Array of urls.\n */\nexport function expandUrl(url) {\n  const urls = [];\n  let match = /\\{([a-z])-([a-z])\\}/.exec(url);\n  if (match) {\n    // char range\n    const startCharCode = match[1].charCodeAt(0);\n    const stopCharCode = match[2].charCodeAt(0);\n    let charCode;\n    for (charCode = startCharCode; charCode <= stopCharCode; ++charCode) {\n      urls.push(url.replace(match[0], String.fromCharCode(charCode)));\n    }\n    return urls;\n  }\n  match = /\\{(\\d+)-(\\d+)\\}/.exec(url);\n  if (match) {\n    // number range\n    const stop = parseInt(match[2], 10);\n    for (let i = parseInt(match[1], 10); i <= stop; i++) {\n      urls.push(url.replace(match[0], i.toString()));\n    }\n    return urls;\n  }\n  urls.push(url);\n  return urls;\n}\n","/**\n * @module ol/tileurlfunction\n */\nimport {modulo} from './math.js';\nimport {hash as tileCoordHash} from './tilecoord.js';\nimport {renderXYZTemplate} from './uri.js';\n\n/**\n * @param {string} template Template.\n * @param {import(\"./tilegrid/TileGrid.js\").default|null} tileGrid Tile grid.\n * @return {import(\"./Tile.js\").UrlFunction} Tile URL function.\n */\nexport function createFromTemplate(template, tileGrid) {\n  return (\n    /**\n     * @param {import(\"./tilecoord.js\").TileCoord} tileCoord Tile Coordinate.\n     * @param {number} pixelRatio Pixel ratio.\n     * @param {import(\"./proj/Projection.js\").default} projection Projection.\n     * @return {string|undefined} Tile URL.\n     */\n    function (tileCoord, pixelRatio, projection) {\n      if (!tileCoord) {\n        return undefined;\n      }\n      let maxY;\n      const z = tileCoord[0];\n      if (tileGrid) {\n        // The `{-y}` placeholder only works for sources that have a tile grid at construction\n        const range = tileGrid.getFullTileRange(z);\n        if (range) {\n          maxY = range.getHeight() - 1;\n        }\n      }\n      return renderXYZTemplate(template, z, tileCoord[1], tileCoord[2], maxY);\n    }\n  );\n}\n\n/**\n * @param {Array<string>} templates Templates.\n * @param {import(\"./tilegrid/TileGrid.js\").default} tileGrid Tile grid.\n * @return {import(\"./Tile.js\").UrlFunction} Tile URL function.\n */\nexport function createFromTemplates(templates, tileGrid) {\n  const len = templates.length;\n  const tileUrlFunctions = new Array(len);\n  for (let i = 0; i < len; ++i) {\n    tileUrlFunctions[i] = createFromTemplate(templates[i], tileGrid);\n  }\n  return createFromTileUrlFunctions(tileUrlFunctions);\n}\n\n/**\n * @param {Array<import(\"./Tile.js\").UrlFunction>} tileUrlFunctions Tile URL Functions.\n * @return {import(\"./Tile.js\").UrlFunction} Tile URL function.\n */\nexport function createFromTileUrlFunctions(tileUrlFunctions) {\n  if (tileUrlFunctions.length === 1) {\n    return tileUrlFunctions[0];\n  }\n  return (\n    /**\n     * @param {import(\"./tilecoord.js\").TileCoord} tileCoord Tile Coordinate.\n     * @param {number} pixelRatio Pixel ratio.\n     * @param {import(\"./proj/Projection.js\").default} projection Projection.\n     * @return {string|undefined} Tile URL.\n     */\n    function (tileCoord, pixelRatio, projection) {\n      if (!tileCoord) {\n        return undefined;\n      }\n      const h = tileCoordHash(tileCoord);\n      const index = modulo(h, tileUrlFunctions.length);\n      return tileUrlFunctions[index](tileCoord, pixelRatio, projection);\n    }\n  );\n}\n\n/**\n * @param {import(\"./tilecoord.js\").TileCoord} tileCoord Tile coordinate.\n * @param {number} pixelRatio Pixel ratio.\n * @param {import(\"./proj/Projection.js\").default} projection Projection.\n * @return {string|undefined} Tile URL.\n */\nexport function nullTileUrlFunction(tileCoord, pixelRatio, projection) {\n  return undefined;\n}\n","/**\n * @module ol/source/Tile\n */\nimport Event from '../events/Event.js';\nimport {scale as scaleSize, toSize} from '../size.js';\nimport {withinExtentAndZ} from '../tilecoord.js';\nimport {\n  getForProjection as getTileGridForProjection,\n  wrapX,\n} from '../tilegrid.js';\nimport {abstract, getUid} from '../util.js';\nimport Source from './Source.js';\n\n/***\n * @template Return\n * @typedef {import(\"../Observable\").OnSignature<import(\"../Observable\").EventTypes, import(\"../events/Event.js\").default, Return> &\n *   import(\"../Observable\").OnSignature<import(\"../ObjectEventType\").Types, import(\"../Object\").ObjectEvent, Return> &\n *   import(\"../Observable\").OnSignature<import(\"./TileEventType\").TileSourceEventTypes, TileSourceEvent, Return> &\n *   import(\"../Observable\").CombinedOnSignature<import(\"../Observable\").EventTypes|import(\"../ObjectEventType\").Types|\n *     import(\"./TileEventType\").TileSourceEventTypes, Return>} TileSourceOnSignature\n */\n\n/**\n * @typedef {Object} Options\n * @property {import(\"./Source.js\").AttributionLike} [attributions] Attributions.\n * @property {boolean} [attributionsCollapsible=true] Attributions are collapsible.\n * @property {number} [cacheSize] Deprecated.  Use the cacheSize option on the layer instead.\n * @property {number} [tilePixelRatio] TilePixelRatio.\n * @property {import(\"../proj.js\").ProjectionLike} [projection] Projection.\n * @property {import(\"./Source.js\").State} [state] State.\n * @property {import(\"../tilegrid/TileGrid.js\").default} [tileGrid] TileGrid.\n * @property {boolean} [wrapX=false] WrapX.\n * @property {number} [transition] Transition.\n * @property {string} [key] Key.\n * @property {number|import(\"../array.js\").NearestDirectionFunction} [zDirection=0] ZDirection.\n * @property {boolean} [interpolate=false] Use interpolated values when resampling.  By default,\n * the nearest neighbor is used when resampling.\n */\n\n/**\n * @classdesc\n * Abstract base class; normally only used for creating subclasses and not\n * instantiated in apps.\n * Base class for sources providing images divided into a tile grid.\n *\n * @template {import(\"../Tile.js\").default} [TileType=import(\"../Tile.js\").default]\n * @abstract\n * @api\n */\nclass TileSource extends Source {\n  /**\n   * @param {Options} options SourceTile source options.\n   */\n  constructor(options) {\n    super({\n      attributions: options.attributions,\n      attributionsCollapsible: options.attributionsCollapsible,\n      projection: options.projection,\n      state: options.state,\n      wrapX: options.wrapX,\n      interpolate: options.interpolate,\n    });\n\n    /***\n     * @type {TileSourceOnSignature<import(\"../events\").EventsKey>}\n     */\n    this.on;\n\n    /***\n     * @type {TileSourceOnSignature<import(\"../events\").EventsKey>}\n     */\n    this.once;\n\n    /***\n     * @type {TileSourceOnSignature<void>}\n     */\n    this.un;\n\n    /**\n     * @private\n     * @type {number}\n     */\n    this.tilePixelRatio_ =\n      options.tilePixelRatio !== undefined ? options.tilePixelRatio : 1;\n\n    /**\n     * @type {import(\"../tilegrid/TileGrid.js\").default|null}\n     * @protected\n     */\n    this.tileGrid = options.tileGrid !== undefined ? options.tileGrid : null;\n\n    const tileSize = [256, 256];\n    if (this.tileGrid) {\n      toSize(this.tileGrid.getTileSize(this.tileGrid.getMinZoom()), tileSize);\n    }\n\n    /**\n     * @protected\n     * @type {import(\"../size.js\").Size}\n     */\n    this.tmpSize = [0, 0];\n\n    /**\n     * @private\n     * @type {string}\n     */\n    this.key_ = options.key || getUid(this);\n\n    /**\n     * @protected\n     * @type {import(\"../Tile.js\").Options}\n     */\n    this.tileOptions = {\n      transition: options.transition,\n      interpolate: options.interpolate,\n    };\n\n    /**\n     * zDirection hint, read by the renderer. Indicates which resolution should be used\n     * by a renderer if the views resolution does not match any resolution of the tile source.\n     * If 0, the nearest resolution will be used. If 1, the nearest lower resolution\n     * will be used. If -1, the nearest higher resolution will be used.\n     * @type {number|import(\"../array.js\").NearestDirectionFunction}\n     */\n    this.zDirection = options.zDirection ? options.zDirection : 0;\n  }\n\n  /**\n   * @param {import(\"../proj/Projection.js\").default} projection Projection.\n   * @return {number} Gutter.\n   */\n  getGutterForProjection(projection) {\n    return 0;\n  }\n\n  /**\n   * Return the key to be used for all tiles in the source.\n   * @return {string} The key for all tiles.\n   */\n  getKey() {\n    return this.key_;\n  }\n\n  /**\n   * Set the value to be used as the key for all tiles in the source.\n   * @param {string} key The key for tiles.\n   * @protected\n   */\n  setKey(key) {\n    if (this.key_ !== key) {\n      this.key_ = key;\n      this.changed();\n    }\n  }\n\n  /**\n   * @param {import(\"../proj/Projection\").default} [projection] Projection.\n   * @return {Array<number>|null} Resolutions.\n   * @override\n   */\n  getResolutions(projection) {\n    const tileGrid = projection\n      ? this.getTileGridForProjection(projection)\n      : this.tileGrid;\n    if (!tileGrid) {\n      return null;\n    }\n    return tileGrid.getResolutions();\n  }\n\n  /**\n   * @abstract\n   * @param {number} z Tile coordinate z.\n   * @param {number} x Tile coordinate x.\n   * @param {number} y Tile coordinate y.\n   * @param {number} pixelRatio Pixel ratio.\n   * @param {import(\"../proj/Projection.js\").default} projection Projection.\n   * @return {TileType|null} Tile.\n   */\n  getTile(z, x, y, pixelRatio, projection) {\n    return abstract();\n  }\n\n  /**\n   * Return the tile grid of the tile source.\n   * @return {import(\"../tilegrid/TileGrid.js\").default|null} Tile grid.\n   * @api\n   */\n  getTileGrid() {\n    return this.tileGrid;\n  }\n\n  /**\n   * @param {import(\"../proj/Projection.js\").default} projection Projection.\n   * @return {!import(\"../tilegrid/TileGrid.js\").default} Tile grid.\n   */\n  getTileGridForProjection(projection) {\n    if (!this.tileGrid) {\n      return getTileGridForProjection(projection);\n    }\n    return this.tileGrid;\n  }\n\n  /**\n   * Get the tile pixel ratio for this source. Subclasses may override this\n   * method, which is meant to return a supported pixel ratio that matches the\n   * provided `pixelRatio` as close as possible.\n   * @param {number} pixelRatio Pixel ratio.\n   * @return {number} Tile pixel ratio.\n   */\n  getTilePixelRatio(pixelRatio) {\n    return this.tilePixelRatio_;\n  }\n\n  /**\n   * @param {number} z Z.\n   * @param {number} pixelRatio Pixel ratio.\n   * @param {import(\"../proj/Projection.js\").default} projection Projection.\n   * @return {import(\"../size.js\").Size} Tile size.\n   */\n  getTilePixelSize(z, pixelRatio, projection) {\n    const tileGrid = this.getTileGridForProjection(projection);\n    const tilePixelRatio = this.getTilePixelRatio(pixelRatio);\n    const tileSize = toSize(tileGrid.getTileSize(z), this.tmpSize);\n    if (tilePixelRatio == 1) {\n      return tileSize;\n    }\n    return scaleSize(tileSize, tilePixelRatio, this.tmpSize);\n  }\n\n  /**\n   * Returns a tile coordinate wrapped around the x-axis. When the tile coordinate\n   * is outside the resolution and extent range of the tile grid, `null` will be\n   * returned.\n   * @param {import(\"../tilecoord.js\").TileCoord} tileCoord Tile coordinate.\n   * @param {import(\"../proj/Projection.js\").default} [projection] Projection.\n   * @return {import(\"../tilecoord.js\").TileCoord} Tile coordinate to be passed to the tileUrlFunction or\n   *     null if no tile URL should be created for the passed `tileCoord`.\n   */\n  getTileCoordForTileUrlFunction(tileCoord, projection) {\n    const gridProjection =\n      projection !== undefined ? projection : this.getProjection();\n    const tileGrid =\n      projection !== undefined\n        ? this.getTileGridForProjection(gridProjection)\n        : this.tileGrid || this.getTileGridForProjection(gridProjection);\n    if (this.getWrapX() && gridProjection.isGlobal()) {\n      tileCoord = wrapX(tileGrid, tileCoord, gridProjection);\n    }\n    return withinExtentAndZ(tileCoord, tileGrid) ? tileCoord : null;\n  }\n\n  /**\n   * Remove all cached reprojected tiles from the source. The next render cycle will create new tiles.\n   * @api\n   */\n  clear() {}\n\n  /**\n   * @override\n   */\n  refresh() {\n    this.clear();\n    super.refresh();\n  }\n}\n\n/**\n * @classdesc\n * Events emitted by {@link module:ol/source/Tile~TileSource} instances are instances of this\n * type.\n */\nexport class TileSourceEvent extends Event {\n  /**\n   * @param {string} type Type.\n   * @param {import(\"../Tile.js\").default} tile The tile.\n   */\n  constructor(type, tile) {\n    super(type);\n\n    /**\n     * The tile related to the event.\n     * @type {import(\"../Tile.js\").default}\n     * @api\n     */\n    this.tile = tile;\n  }\n}\n\nexport default TileSource;\n","/**\n * @module ol/source/TileEventType\n */\n\n/**\n * @enum {string}\n */\nexport default {\n  /**\n   * Triggered when a tile starts loading.\n   * @event module:ol/source/Tile.TileSourceEvent#tileloadstart\n   * @api\n   */\n  TILELOADSTART: 'tileloadstart',\n\n  /**\n   * Triggered when a tile finishes loading, either when its data is loaded,\n   * or when loading was aborted because the tile is no longer needed.\n   * @event module:ol/source/Tile.TileSourceEvent#tileloadend\n   * @api\n   */\n  TILELOADEND: 'tileloadend',\n\n  /**\n   * Triggered if tile loading results in an error. Note that this is not the\n   * right place to re-fetch tiles. See {@link module:ol/ImageTile~ImageTile#load}\n   * for details.\n   * @event module:ol/source/Tile.TileSourceEvent#tileloaderror\n   * @api\n   */\n  TILELOADERROR: 'tileloaderror',\n};\n\n/**\n * @typedef {'tileloadstart'|'tileloadend'|'tileloaderror'} TileSourceEventTypes\n */\n","/**\n * @module ol/source/UrlTile\n */\nimport TileState from '../TileState.js';\nimport {createFromTemplates} from '../tileurlfunction.js';\nimport {expandUrl} from '../uri.js';\nimport {getUid} from '../util.js';\nimport TileSource, {TileSourceEvent} from './Tile.js';\nimport TileEventType from './TileEventType.js';\n\n/**\n * @typedef {Object} Options\n * @property {import(\"./Source.js\").AttributionLike} [attributions] Attributions.\n * @property {boolean} [attributionsCollapsible=true] Attributions are collapsible.\n * @property {number} [cacheSize] Deprecated.  Use the cacheSize option on the layer instead.\n * @property {import(\"../proj.js\").ProjectionLike} [projection] Projection.\n * @property {import(\"./Source.js\").State} [state] State.\n * @property {import(\"../tilegrid/TileGrid.js\").default} [tileGrid] TileGrid.\n * @property {import(\"../Tile.js\").LoadFunction} tileLoadFunction TileLoadFunction.\n * @property {number} [tilePixelRatio] TilePixelRatio.\n * @property {import(\"../Tile.js\").UrlFunction} [tileUrlFunction] Deprecated.  Use an ImageTile source and provide a function\n * for the url option instead.\n * @property {string} [url] Url.\n * @property {Array<string>} [urls] Urls.\n * @property {boolean} [wrapX=true] WrapX.\n * @property {number} [transition] Transition.\n * @property {string} [key] Key.\n * @property {number|import(\"../array.js\").NearestDirectionFunction} [zDirection=0] ZDirection.\n * @property {boolean} [interpolate=false] Use interpolated values when resampling.  By default,\n * the nearest neighbor is used when resampling.\n */\n\n/**\n * @deprecated Use the ol/source/ImageTile.js instead.\n *\n * @fires import(\"./Tile.js\").TileSourceEvent\n */\nclass UrlTile extends TileSource {\n  /**\n   * @param {Options} options Image tile options.\n   */\n  constructor(options) {\n    super({\n      attributions: options.attributions,\n      cacheSize: options.cacheSize,\n      projection: options.projection,\n      state: options.state,\n      tileGrid: options.tileGrid,\n      tilePixelRatio: options.tilePixelRatio,\n      wrapX: options.wrapX,\n      transition: options.transition,\n      interpolate: options.interpolate,\n      key: options.key,\n      attributionsCollapsible: options.attributionsCollapsible,\n      zDirection: options.zDirection,\n    });\n\n    /**\n     * @private\n     * @type {boolean}\n     */\n    this.generateTileUrlFunction_ =\n      this.tileUrlFunction === UrlTile.prototype.tileUrlFunction;\n\n    /**\n     * @protected\n     * @type {import(\"../Tile.js\").LoadFunction}\n     */\n    this.tileLoadFunction = options.tileLoadFunction;\n\n    if (options.tileUrlFunction) {\n      this.tileUrlFunction = options.tileUrlFunction;\n    }\n\n    /**\n     * @protected\n     * @type {!Array<string>|null}\n     */\n    this.urls = null;\n\n    if (options.urls) {\n      this.setUrls(options.urls);\n    } else if (options.url) {\n      this.setUrl(options.url);\n    }\n\n    /**\n     * @private\n     * @type {!Object<string, boolean>}\n     */\n    this.tileLoadingKeys_ = {};\n  }\n\n  /**\n   * Deprecated.  Use an ImageTile source instead.\n   * Return the tile load function of the source.\n   * @return {import(\"../Tile.js\").LoadFunction} TileLoadFunction\n   * @api\n   */\n  getTileLoadFunction() {\n    return this.tileLoadFunction;\n  }\n\n  /**\n   * Deprecated.  Use an ImageTile source instead.\n   * Return the tile URL function of the source.\n   * @return {import(\"../Tile.js\").UrlFunction} TileUrlFunction\n   * @api\n   */\n  getTileUrlFunction() {\n    return Object.getPrototypeOf(this).tileUrlFunction === this.tileUrlFunction\n      ? this.tileUrlFunction.bind(this)\n      : this.tileUrlFunction;\n  }\n\n  /**\n   * Deprecated.  Use an ImageTile source instead.\n   * Return the URLs used for this source.\n   * When a tileUrlFunction is used instead of url or urls,\n   * null will be returned.\n   * @return {!Array<string>|null} URLs.\n   * @api\n   */\n  getUrls() {\n    return this.urls;\n  }\n\n  /**\n   * Handle tile change events.\n   * @param {import(\"../events/Event.js\").default} event Event.\n   * @protected\n   */\n  handleTileChange(event) {\n    const tile = /** @type {import(\"../Tile.js\").default} */ (event.target);\n    const uid = getUid(tile);\n    const tileState = tile.getState();\n    let type;\n    if (tileState == TileState.LOADING) {\n      this.tileLoadingKeys_[uid] = true;\n      type = TileEventType.TILELOADSTART;\n    } else if (uid in this.tileLoadingKeys_) {\n      delete this.tileLoadingKeys_[uid];\n      type =\n        tileState == TileState.ERROR\n          ? TileEventType.TILELOADERROR\n          : tileState == TileState.LOADED\n            ? TileEventType.TILELOADEND\n            : undefined;\n    }\n    if (type != undefined) {\n      this.dispatchEvent(new TileSourceEvent(type, tile));\n    }\n  }\n\n  /**\n   * Deprecated.  Use an ImageTile source instead.\n   * Set the tile load function of the source.\n   * @param {import(\"../Tile.js\").LoadFunction} tileLoadFunction Tile load function.\n   * @api\n   */\n  setTileLoadFunction(tileLoadFunction) {\n    this.tileLoadFunction = tileLoadFunction;\n    this.changed();\n  }\n\n  /**\n   * Deprecated.  Use an ImageTile source instead.\n   * Set the tile URL function of the source.\n   * @param {import(\"../Tile.js\").UrlFunction} tileUrlFunction Tile URL function.\n   * @param {string} [key] Optional new tile key for the source.\n   * @api\n   */\n  setTileUrlFunction(tileUrlFunction, key) {\n    this.tileUrlFunction = tileUrlFunction;\n    if (typeof key !== 'undefined') {\n      this.setKey(key);\n    } else {\n      this.changed();\n    }\n  }\n\n  /**\n   * Set the URL to use for requests.\n   * @param {string} url URL.\n   * @api\n   */\n  setUrl(url) {\n    const urls = expandUrl(url);\n    this.urls = urls;\n    this.setUrls(urls);\n  }\n\n  /**\n   * Deprecated.  Use an ImageTile source instead.\n   * Set the URLs to use for requests.\n   * @param {Array<string>} urls URLs.\n   * @api\n   */\n  setUrls(urls) {\n    this.urls = urls;\n    const key = urls.join('\\n');\n    if (this.generateTileUrlFunction_) {\n      this.setTileUrlFunction(createFromTemplates(urls, this.tileGrid), key);\n    } else {\n      this.setKey(key);\n    }\n  }\n\n  /**\n   * @param {import(\"../tilecoord.js\").TileCoord} tileCoord Tile coordinate.\n   * @param {number} pixelRatio Pixel ratio.\n   * @param {import(\"../proj/Projection.js\").default} projection Projection.\n   * @return {string|undefined} Tile URL.\n   */\n  tileUrlFunction(tileCoord, pixelRatio, projection) {\n    return undefined;\n  }\n}\n\nexport default UrlTile;\n","/**\n * @module ol/source/TileImage\n */\nimport ImageTile from '../ImageTile.js';\nimport TileState from '../TileState.js';\nimport EventType from '../events/EventType.js';\nimport {equivalent, get as getProjection} from '../proj.js';\nimport ReprojTile from '../reproj/Tile.js';\nimport {getForProjection as getTileGridForProjection} from '../tilegrid.js';\nimport {getUid} from '../util.js';\nimport UrlTile from './UrlTile.js';\n\n/**\n * @typedef {Object} Options\n * @property {import(\"./Source.js\").AttributionLike} [attributions] Attributions.\n * @property {boolean} [attributionsCollapsible=true] Attributions are collapsible.\n * @property {number} [cacheSize] Deprecated.  Use the cacheSize option on the layer instead.\n * @property {null|string} [crossOrigin] The `crossOrigin` attribute for loaded images.  Note that\n * you must provide a `crossOrigin` value if you want to access pixel data with the Canvas renderer.\n * See https://developer.mozilla.org/en-US/docs/Web/HTML/CORS_enabled_image for more detail.\n * @property {boolean} [interpolate=true] Use interpolated values when resampling.  By default,\n * linear interpolation is used when resampling.  Set to false to use the nearest neighbor instead.\n * @property {import(\"../proj.js\").ProjectionLike} [projection] Projection. Default is the view projection.\n * @property {number} [reprojectionErrorThreshold=0.5] Maximum allowed reprojection error (in pixels).\n * Higher values can increase reprojection performance, but decrease precision.\n * @property {import(\"./Source.js\").State} [state] Source state.\n * @property {typeof import(\"../ImageTile.js\").default} [tileClass] Class used to instantiate image tiles.\n * Default is {@link module:ol/ImageTile~ImageTile}.\n * @property {import(\"../tilegrid/TileGrid.js\").default} [tileGrid] Tile grid.\n * @property {import(\"../Tile.js\").LoadFunction} [tileLoadFunction] Optional function to load a tile given a URL. The default is\n * ```js\n * function(imageTile, src) {\n *   imageTile.getImage().src = src;\n * };\n * ```\n * @property {number} [tilePixelRatio=1] The pixel ratio used by the tile service. For example, if the tile\n * service advertizes 256px by 256px tiles but actually sends 512px\n * by 512px images (for retina/hidpi devices) then `tilePixelRatio`\n * should be set to `2`.\n * @property {import(\"../Tile.js\").UrlFunction} [tileUrlFunction] Deprecated.  Use an ImageTile source and provide a function\n * for the url option instead.\n * @property {string} [url] URL template. Must include `{x}`, `{y}` or `{-y}`, and `{z}` placeholders.\n * A `{?-?}` template pattern, for example `subdomain{a-f}.domain.com`, may be\n * used instead of defining each one separately in the `urls` option.\n * @property {Array<string>} [urls] An array of URL templates.\n * @property {boolean} [wrapX] Whether to wrap the world horizontally. The default, is to\n * request out-of-bounds tiles from the server. When set to `false`, only one\n * world will be rendered. When set to `true`, tiles will be requested for one\n * world only, but they will be wrapped horizontally to render multiple worlds.\n * @property {number} [transition] Duration of the opacity transition for rendering.\n * To disable the opacity transition, pass `transition: 0`.\n * @property {string} [key] Optional tile key for proper cache fetching\n * @property {number|import(\"../array.js\").NearestDirectionFunction} [zDirection=0]\n * Choose whether to use tiles with a higher or lower zoom level when between integer\n * zoom levels. See {@link module:ol/tilegrid/TileGrid~TileGrid#getZForResolution}.\n */\n\n/**\n * @deprecated Use the ol/source/ImageTile.js instead.\n *\n * @fires import(\"./Tile.js\").TileSourceEvent\n * @api\n */\nclass TileImage extends UrlTile {\n  /**\n   * @param {!Options} options Image tile options.\n   */\n  constructor(options) {\n    super({\n      attributions: options.attributions,\n      cacheSize: options.cacheSize,\n      projection: options.projection,\n      state: options.state,\n      tileGrid: options.tileGrid,\n      tileLoadFunction: options.tileLoadFunction\n        ? options.tileLoadFunction\n        : defaultTileLoadFunction,\n      tilePixelRatio: options.tilePixelRatio,\n      tileUrlFunction: options.tileUrlFunction,\n      url: options.url,\n      urls: options.urls,\n      wrapX: options.wrapX,\n      transition: options.transition,\n      interpolate:\n        options.interpolate !== undefined ? options.interpolate : true,\n      key: options.key,\n      attributionsCollapsible: options.attributionsCollapsible,\n      zDirection: options.zDirection,\n    });\n\n    /**\n     * @protected\n     * @type {?string}\n     */\n    this.crossOrigin =\n      options.crossOrigin !== undefined ? options.crossOrigin : null;\n\n    /**\n     * @protected\n     * @type {typeof ImageTile}\n     */\n    this.tileClass =\n      options.tileClass !== undefined ? options.tileClass : ImageTile;\n\n    /**\n     * @protected\n     * @type {!Object<string, import(\"../tilegrid/TileGrid.js\").default>}\n     */\n    this.tileGridForProjection = {};\n\n    /**\n     * @private\n     * @type {number|undefined}\n     */\n    this.reprojectionErrorThreshold_ = options.reprojectionErrorThreshold;\n\n    /**\n     * @private\n     * @type {boolean}\n     */\n    this.renderReprojectionEdges_ = false;\n  }\n\n  /**\n   * @param {import(\"../proj/Projection.js\").default} projection Projection.\n   * @return {number} Gutter.\n   * @override\n   */\n  getGutterForProjection(projection) {\n    if (\n      this.getProjection() &&\n      projection &&\n      !equivalent(this.getProjection(), projection)\n    ) {\n      return 0;\n    }\n    return this.getGutter();\n  }\n\n  /**\n   * @return {number} Gutter.\n   */\n  getGutter() {\n    return 0;\n  }\n\n  /**\n   * Return the key to be used for all tiles in the source.\n   * @return {string} The key for all tiles.\n   * @override\n   */\n  getKey() {\n    let key = super.getKey();\n    if (!this.getInterpolate()) {\n      key += ':disable-interpolation';\n    }\n    return key;\n  }\n\n  /**\n   * @param {import(\"../proj/Projection.js\").default} projection Projection.\n   * @return {!import(\"../tilegrid/TileGrid.js\").default} Tile grid.\n   * @override\n   */\n  getTileGridForProjection(projection) {\n    const thisProj = this.getProjection();\n    if (this.tileGrid && (!thisProj || equivalent(thisProj, projection))) {\n      return this.tileGrid;\n    }\n    const projKey = getUid(projection);\n    if (!(projKey in this.tileGridForProjection)) {\n      this.tileGridForProjection[projKey] =\n        getTileGridForProjection(projection);\n    }\n    return this.tileGridForProjection[projKey];\n  }\n\n  /**\n   * @param {number} z Tile coordinate z.\n   * @param {number} x Tile coordinate x.\n   * @param {number} y Tile coordinate y.\n   * @param {number} pixelRatio Pixel ratio.\n   * @param {import(\"../proj/Projection.js\").default} projection Projection.\n   * @param {string} key The key set on the tile.\n   * @return {!ImageTile} Tile.\n   * @private\n   */\n  createTile_(z, x, y, pixelRatio, projection, key) {\n    const tileCoord = [z, x, y];\n    const urlTileCoord = this.getTileCoordForTileUrlFunction(\n      tileCoord,\n      projection,\n    );\n    const tileUrl = urlTileCoord\n      ? this.tileUrlFunction(urlTileCoord, pixelRatio, projection)\n      : undefined;\n    const tile = new this.tileClass(\n      tileCoord,\n      tileUrl !== undefined ? TileState.IDLE : TileState.EMPTY,\n      tileUrl !== undefined ? tileUrl : '',\n      this.crossOrigin,\n      this.tileLoadFunction,\n      this.tileOptions,\n    );\n    tile.key = key;\n    tile.addEventListener(EventType.CHANGE, this.handleTileChange.bind(this));\n    return tile;\n  }\n\n  /**\n   * @param {number} z Tile coordinate z.\n   * @param {number} x Tile coordinate x.\n   * @param {number} y Tile coordinate y.\n   * @param {number} pixelRatio Pixel ratio.\n   * @param {import(\"../proj/Projection.js\").default} projection Projection.\n   * @return {!(ImageTile|ReprojTile)} Tile.\n   * @override\n   */\n  getTile(z, x, y, pixelRatio, projection) {\n    const sourceProjection = this.getProjection();\n    if (\n      !sourceProjection ||\n      !projection ||\n      equivalent(sourceProjection, projection)\n    ) {\n      return this.getTileInternal(\n        z,\n        x,\n        y,\n        pixelRatio,\n        sourceProjection || projection,\n      );\n    }\n    const tileCoord = [z, x, y];\n    const key = this.getKey();\n    const sourceTileGrid = this.getTileGridForProjection(sourceProjection);\n    const targetTileGrid = this.getTileGridForProjection(projection);\n    const wrappedTileCoord = this.getTileCoordForTileUrlFunction(\n      tileCoord,\n      projection,\n    );\n    const tile = new ReprojTile(\n      sourceProjection,\n      sourceTileGrid,\n      projection,\n      targetTileGrid,\n      tileCoord,\n      wrappedTileCoord,\n      this.getTilePixelRatio(pixelRatio),\n      this.getGutter(),\n      (z, x, y, pixelRatio) =>\n        this.getTileInternal(z, x, y, pixelRatio, sourceProjection),\n      this.reprojectionErrorThreshold_,\n      this.renderReprojectionEdges_,\n      this.tileOptions,\n    );\n    tile.key = key;\n    return tile;\n  }\n\n  /**\n   * @param {number} z Tile coordinate z.\n   * @param {number} x Tile coordinate x.\n   * @param {number} y Tile coordinate y.\n   * @param {number} pixelRatio Pixel ratio.\n   * @param {!import(\"../proj/Projection.js\").default} projection Projection.\n   * @return {!ImageTile} Tile.\n   * @protected\n   */\n  getTileInternal(z, x, y, pixelRatio, projection) {\n    const key = this.getKey();\n    return this.createTile_(z, x, y, pixelRatio, projection, key);\n  }\n\n  /**\n   * Sets whether to render reprojection edges or not (usually for debugging).\n   * @param {boolean} render Render the edges.\n   * @api\n   */\n  setRenderReprojectionEdges(render) {\n    if (this.renderReprojectionEdges_ == render) {\n      return;\n    }\n    this.renderReprojectionEdges_ = render;\n    this.changed();\n  }\n\n  /**\n   * Sets the tile grid to use when reprojecting the tiles to the given\n   * projection instead of the default tile grid for the projection.\n   *\n   * This can be useful when the default tile grid cannot be created\n   * (e.g. projection has no extent defined) or\n   * for optimization reasons (custom tile size, resolutions, ...).\n   *\n   * @param {import(\"../proj.js\").ProjectionLike} projection Projection.\n   * @param {import(\"../tilegrid/TileGrid.js\").default} tilegrid Tile grid to use for the projection.\n   * @api\n   */\n  setTileGridForProjection(projection, tilegrid) {\n    const proj = getProjection(projection);\n    if (proj) {\n      const projKey = getUid(proj);\n      if (!(projKey in this.tileGridForProjection)) {\n        this.tileGridForProjection[projKey] = tilegrid;\n      }\n    }\n  }\n}\n\n/**\n * @param {ImageTile} imageTile Image tile.\n * @param {string} src Source.\n */\nfunction defaultTileLoadFunction(imageTile, src) {\n  /** @type {HTMLImageElement|HTMLVideoElement} */ (imageTile.getImage()).src =\n    src;\n}\n\nexport default TileImage;\n","/**\n * @module ol/source/XYZ\n */\n\nimport {createXYZ, extentFromProjection} from '../tilegrid.js';\nimport TileImage from './TileImage.js';\n\n/**\n * @typedef {Object} Options\n * @property {import(\"./Source.js\").AttributionLike} [attributions] Attributions.\n * @property {boolean} [attributionsCollapsible=true] Attributions are collapsible.\n * @property {number} [cacheSize] Deprecated.  Use the cacheSize option on the layer instead.\n * @property {null|string} [crossOrigin] The `crossOrigin` attribute for loaded images.  Note that\n * you must provide a `crossOrigin` value if you want to access pixel data with the Canvas renderer.\n * See https://developer.mozilla.org/en-US/docs/Web/HTML/CORS_enabled_image for more detail.\n * @property {boolean} [interpolate=true] Use interpolated values when resampling.  By default,\n * linear interpolation is used when resampling.  Set to false to use the nearest neighbor instead.\n * @property {import(\"../proj.js\").ProjectionLike} [projection='EPSG:3857'] Projection.\n * @property {number} [reprojectionErrorThreshold=0.5] Maximum allowed reprojection error (in pixels).\n * Higher values can increase reprojection performance, but decrease precision.\n * @property {number} [maxZoom=42] Optional max zoom level. Not used if `tileGrid` is provided.\n * @property {number} [minZoom=0] Optional min zoom level. Not used if `tileGrid` is provided.\n * @property {number} [maxResolution] Optional tile grid resolution at level zero. Not used if `tileGrid` is provided.\n * @property {import(\"../tilegrid/TileGrid.js\").default} [tileGrid] Tile grid.\n * @property {import(\"../Tile.js\").LoadFunction} [tileLoadFunction] Deprecated.  Use an ImageTile source with a loader\n * instead.  Optional function to load a tile given a URL. The default is\n * ```js\n * function(imageTile, src) {\n *   imageTile.getImage().src = src;\n * };\n * ```\n * @property {number} [tilePixelRatio=1] The pixel ratio used by the tile service.\n * For example, if the tile service advertizes 256px by 256px tiles but actually sends 512px\n * by 512px images (for retina/hidpi devices) then `tilePixelRatio`\n * should be set to `2`.\n * @property {number|import(\"../size.js\").Size} [tileSize=[256, 256]] The tile size used by the tile service.\n * Not used if `tileGrid` is provided.\n * @property {number} [gutter=0] The size in pixels of the gutter around image tiles to ignore.\n * This allows artifacts of rendering at tile edges to be ignored.\n * Supported images should be wider and taller than the tile size by a value of `2 x gutter`.\n * @property {import(\"../Tile.js\").UrlFunction} [tileUrlFunction] Deprecated.  Use an ImageTile source and provide a function\n * for the url option instead.\n * @property {string} [url] URL template. Must include `{x}`, `{y}` or `{-y}`,\n * and `{z}` placeholders. A `{?-?}` template pattern, for example `subdomain{a-f}.domain.com`,\n * may be used instead of defining each one separately in the `urls` option.\n * @property {Array<string>} [urls] Deprecated.  Use an ImageTile source and provide an array of URLs for the\n * url option instead.\n * @property {boolean} [wrapX=true] Whether to wrap the world horizontally.\n * @property {number} [transition=250] Duration of the opacity transition for rendering.\n * To disable the opacity transition, pass `transition: 0`.\n * @property {number|import(\"../array.js\").NearestDirectionFunction} [zDirection=0]\n * Choose whether to use tiles with a higher or lower zoom level when between integer\n * zoom levels. See {@link module:ol/tilegrid/TileGrid~TileGrid#getZForResolution}.\n */\n\n/**\n * @classdesc\n * Layer source for tile data with URLs in a set XYZ format that are\n * defined in a URL template. By default, this follows the widely-used\n * Google grid where `x` 0 and `y` 0 are in the top left. Grids like\n * TMS where `x` 0 and `y` 0 are in the bottom left can be used by\n * using the `{-y}` placeholder in the URL template, so long as the\n * source does not have a custom tile grid. In this case\n * a `tileUrlFunction` can be used, such as:\n * ```js\n *  tileUrlFunction: function(coordinate) {\n *    return 'http://mapserver.com/' + coordinate[0] + '/' +\n *      coordinate[1] + '/' + (-coordinate[2] - 1) + '.png';\n *  }\n * ```\n * @api\n */\nclass XYZ extends TileImage {\n  /**\n   * @param {Options} [options] XYZ options.\n   */\n  constructor(options) {\n    options = options || {};\n\n    const projection =\n      options.projection !== undefined ? options.projection : 'EPSG:3857';\n\n    const tileGrid =\n      options.tileGrid !== undefined\n        ? options.tileGrid\n        : createXYZ({\n            extent: extentFromProjection(projection),\n            maxResolution: options.maxResolution,\n            maxZoom: options.maxZoom,\n            minZoom: options.minZoom,\n            tileSize: options.tileSize,\n          });\n\n    super({\n      attributions: options.attributions,\n      cacheSize: options.cacheSize,\n      crossOrigin: options.crossOrigin,\n      interpolate: options.interpolate,\n      projection: projection,\n      reprojectionErrorThreshold: options.reprojectionErrorThreshold,\n      tileGrid: tileGrid,\n      tileLoadFunction: options.tileLoadFunction,\n      tilePixelRatio: options.tilePixelRatio,\n      tileUrlFunction: options.tileUrlFunction,\n      url: options.url,\n      urls: options.urls,\n      wrapX: options.wrapX !== undefined ? options.wrapX : true,\n      transition: options.transition,\n      attributionsCollapsible: options.attributionsCollapsible,\n      zDirection: options.zDirection,\n    });\n\n    /**\n     * @private\n     * @type {number}\n     */\n    this.gutter_ = options.gutter !== undefined ? options.gutter : 0;\n  }\n\n  /**\n   * @return {number} Gutter.\n   * @override\n   */\n  getGutter() {\n    return this.gutter_;\n  }\n}\n\nexport default XYZ;\n","import OpenLayersMap from 'ol/Map';\nimport TileLayer from 'ol/layer/Tile';\nimport XYZ from 'ol/source/XYZ';\n\nimport { MapLayerRegistryItem, MapLayerOptions, GrafanaTheme2, EventBus } from '@grafana/data';\n\n// https://carto.com/help/building-maps/basemap-list/\n\nexport enum LayerTheme {\n  Auto = 'auto',\n  Light = 'light',\n  Dark = 'dark',\n}\n\nexport interface CartoConfig {\n  theme?: LayerTheme;\n  showLabels?: boolean;\n}\n\nexport const defaultCartoConfig: CartoConfig = {\n  theme: LayerTheme.Auto,\n  showLabels: true,\n};\n\nexport const carto: MapLayerRegistryItem<CartoConfig> = {\n  id: 'carto',\n  name: 'CARTO basemap',\n  description: 'Add layer CARTO Raster basemaps',\n  isBaseMap: true,\n  defaultOptions: defaultCartoConfig,\n\n  /**\n   * Function that configures transformation and returns a transformer\n   * @param options\n   */\n  create: async (\n    map: OpenLayersMap,\n    options: MapLayerOptions<CartoConfig>,\n    eventBus: EventBus,\n    theme: GrafanaTheme2\n  ) => ({\n    init: () => {\n      const cfg = { ...defaultCartoConfig, ...options.config };\n      let style: string | undefined = cfg.theme;\n      if (!style || style === LayerTheme.Auto) {\n        style = theme.isDark ? 'dark' : 'light';\n      }\n      if (cfg.showLabels) {\n        style += '_all';\n      } else {\n        style += '_nolabels';\n      }\n      const scale = window.devicePixelRatio > 1 ? '@2x' : '';\n      const noRepeat = options.noRepeat ?? false;\n\n      return new TileLayer({\n        source: new XYZ({\n          attributions: `<a href=\"https://carto.com/attribution/\">CARTO</a> <a href=\"https://www.openstreetmap.org/copyright\">OpenStreetMap</a> contributors`,\n          url: `https://{1-4}.basemaps.cartocdn.com/${style}/{z}/{x}/{y}${scale}.png`,\n          wrapX: !noRepeat,\n        }),\n      });\n    },\n\n    registerOptionsUI: (builder) => {\n      builder\n        .addRadio({\n          path: 'config.theme',\n          name: 'Theme',\n          settings: {\n            options: [\n              { value: LayerTheme.Auto, label: 'Auto', description: 'Match grafana theme' },\n              { value: LayerTheme.Light, label: 'Light' },\n              { value: LayerTheme.Dark, label: 'Dark' },\n            ],\n          },\n          defaultValue: defaultCartoConfig.theme!,\n        })\n        .addBooleanSwitch({\n          path: 'config.showLabels',\n          name: 'Show labels',\n          description: '',\n          defaultValue: defaultCartoConfig.showLabels,\n        });\n    },\n  }),\n};\n\nexport const cartoLayers = [carto];\n","import OpenLayersMap from 'ol/Map';\nimport TileLayer from 'ol/layer/Tile';\nimport XYZ from 'ol/source/XYZ';\n\nimport { MapLayerRegistryItem, MapLayerOptions, GrafanaTheme2, EventBus } from '@grafana/data';\n\nexport interface XYZConfig {\n  url: string;\n  attribution: string;\n  minZoom?: number;\n  maxZoom?: number;\n}\n\nconst sampleURL = 'https://services.arcgisonline.com/ArcGIS/rest/services/World_Topo_Map/MapServer';\nexport const defaultXYZConfig: XYZConfig = {\n  url: sampleURL + '/tile/{z}/{y}/{x}',\n  attribution: `Tiles  <a href=\"${sampleURL}\">ArcGIS</a>`,\n};\n\nexport const xyzTiles: MapLayerRegistryItem<XYZConfig> = {\n  id: 'xyz',\n  name: 'XYZ Tile layer',\n  description: 'Add map from a generic tile layer',\n  isBaseMap: true,\n\n  create: async (\n    map: OpenLayersMap,\n    options: MapLayerOptions<XYZConfig>,\n    eventBus: EventBus,\n    theme: GrafanaTheme2\n  ) => ({\n    init: () => {\n      const cfg = { ...options.config };\n      if (!cfg.url) {\n        cfg.url = defaultXYZConfig.url;\n        cfg.attribution = cfg.attribution ?? defaultXYZConfig.attribution;\n      }\n      const noRepeat = options.noRepeat ?? false;\n\n      return new TileLayer({\n        source: new XYZ({\n          url: cfg.url,\n          attributions: cfg.attribution, // singular?\n          wrapX: !noRepeat,\n        }),\n        minZoom: cfg.minZoom,\n        maxZoom: cfg.maxZoom,\n      });\n    },\n    registerOptionsUI: (builder) => {\n      builder\n        .addTextInput({\n          path: 'config.url',\n          name: 'URL template',\n          description: 'Must include {x}, {y} or {-y}, and {z} placeholders',\n          settings: {\n            placeholder: defaultXYZConfig.url,\n          },\n        })\n        .addTextInput({\n          path: 'config.attribution',\n          name: 'Attribution',\n          settings: {\n            placeholder: defaultXYZConfig.attribution,\n          },\n        });\n    },\n  }),\n};\n\nexport const genericLayers = [xyzTiles];\n","import OpenLayersMap from 'ol/Map';\n\nimport { MapLayerRegistryItem, MapLayerOptions, GrafanaTheme2, RegistryItem, Registry, EventBus } from '@grafana/data';\n\nimport { xyzTiles, defaultXYZConfig, XYZConfig } from './generic';\n\ninterface PublicServiceItem extends RegistryItem {\n  slug: string;\n}\n\nconst CUSTOM_SERVICE = 'custom';\nconst DEFAULT_SERVICE = 'streets';\n\nexport const publicServiceRegistry = new Registry<PublicServiceItem>(() => [\n  {\n    id: DEFAULT_SERVICE,\n    name: 'World Street Map',\n    slug: 'World_Street_Map',\n  },\n  {\n    id: 'world-imagery',\n    name: 'World Imagery',\n    slug: 'World_Imagery',\n  },\n  {\n    id: 'world-physical',\n    name: 'World Physical',\n    slug: 'World_Physical_Map',\n  },\n  {\n    id: 'topo',\n    name: 'Topographic',\n    slug: 'World_Topo_Map',\n  },\n  {\n    id: 'usa-topo',\n    name: 'USA Topographic',\n    slug: 'USA_Topo_Maps',\n  },\n  {\n    id: 'ocean',\n    name: 'World Ocean',\n    slug: 'Ocean/World_Ocean_Base',\n  },\n  {\n    id: CUSTOM_SERVICE,\n    name: 'Custom MapServer',\n    description: 'Use a custom MapServer with pre-cached values',\n    slug: '',\n  },\n]);\n\nexport interface ESRIXYZConfig extends XYZConfig {\n  server: string;\n}\n\nexport const esriXYZTiles: MapLayerRegistryItem<ESRIXYZConfig> = {\n  id: 'esri-xyz',\n  name: 'ArcGIS MapServer',\n  description: 'Add layer from an ESRI ArcGIS MapServer',\n  isBaseMap: true,\n\n  create: async (\n    map: OpenLayersMap,\n    options: MapLayerOptions<ESRIXYZConfig>,\n    eventBus: EventBus,\n    theme: GrafanaTheme2\n  ) => {\n    const cfg = { ...options.config };\n    const svc = publicServiceRegistry.getIfExists(cfg.server ?? DEFAULT_SERVICE)!;\n    if (svc.id !== CUSTOM_SERVICE) {\n      const base = 'https://services.arcgisonline.com/ArcGIS/rest/services/';\n      cfg.url = `${base}${svc.slug}/MapServer/tile/{z}/{y}/{x}`;\n      cfg.attribution = `Tiles  <a href=\"${base}${svc.slug}/MapServer\">ArcGIS</a>`;\n    }\n    const opts = { ...options, config: cfg as XYZConfig };\n    return xyzTiles.create(map, opts, eventBus, theme).then((xyz) => {\n      xyz.registerOptionsUI = (builder) => {\n        builder\n          .addSelect({\n            path: 'config.server',\n            name: 'Server instance',\n            settings: {\n              options: publicServiceRegistry.selectOptions().options,\n            },\n          })\n          .addTextInput({\n            path: 'config.url',\n            name: 'URL template',\n            description: 'Must include {x}, {y} or {-y}, and {z} placeholders',\n            settings: {\n              placeholder: defaultXYZConfig.url,\n            },\n            showIf: (cfg) => cfg.config?.server === CUSTOM_SERVICE,\n          })\n          .addTextInput({\n            path: 'config.attribution',\n            name: 'Attribution',\n            settings: {\n              placeholder: defaultXYZConfig.attribution,\n            },\n            showIf: (cfg) => cfg.config?.server === CUSTOM_SERVICE,\n          });\n      };\n      return xyz;\n    });\n  },\n\n  defaultOptions: {\n    server: DEFAULT_SERVICE,\n  },\n};\n\nexport const esriLayers = [esriXYZTiles];\n","/**\n * @module ol/source/OSM\n */\n\nimport XYZ from './XYZ.js';\n\n/**\n * The attribution containing a link to the OpenStreetMap Copyright and License\n * page.\n * @const\n * @type {string}\n * @api\n */\nexport const ATTRIBUTION =\n  '&#169; ' +\n  '<a href=\"https://www.openstreetmap.org/copyright\" target=\"_blank\">OpenStreetMap</a> ' +\n  'contributors.';\n\n/**\n * @typedef {Object} Options\n * @property {import(\"./Source.js\").AttributionLike} [attributions] Attributions.\n * @property {number} [cacheSize] Deprecated.  Use the cacheSize option on the layer instead.\n * @property {null|string} [crossOrigin='anonymous'] The `crossOrigin` attribute for loaded images.  Note that\n * you must provide a `crossOrigin` value if you want to access pixel data with the Canvas renderer.\n * See https://developer.mozilla.org/en-US/docs/Web/HTML/CORS_enabled_image for more detail.\n * @property {boolean} [interpolate=true] Use interpolated values when resampling.  By default,\n * linear interpolation is used when resampling.  Set to false to use the nearest neighbor instead.\n * @property {number} [maxZoom=19] Max zoom.\n * @property {number} [reprojectionErrorThreshold=0.5] Maximum allowed reprojection error (in pixels).\n * Higher values can increase reprojection performance, but decrease precision.\n * @property {import(\"../Tile.js\").LoadFunction} [tileLoadFunction] Optional function to load a tile given a URL. The default is\n * ```js\n * function(imageTile, src) {\n *   imageTile.getImage().src = src;\n * };\n * ```\n * @property {number} [transition=250] Duration of the opacity transition for rendering.\n * To disable the opacity transition, pass `transition: 0`.\n * @property {string} [url='https://tile.openstreetmap.org/{z}/{x}/{y}.png'] URL template.\n * Must include `{x}`, `{y}` or `{-y}`, and `{z}` placeholders.\n * @property {boolean} [wrapX=true] Whether to wrap the world horizontally.\n * @property {number|import(\"../array.js\").NearestDirectionFunction} [zDirection=0]\n * Choose whether to use tiles with a higher or lower zoom level when between integer\n * zoom levels. See {@link module:ol/tilegrid/TileGrid~TileGrid#getZForResolution}.\n */\n\n/**\n * @classdesc\n * Layer source for the OpenStreetMap tile server.\n * @api\n */\nclass OSM extends XYZ {\n  /**\n   * @param {Options} [options] Open Street Map options.\n   */\n  constructor(options) {\n    options = options || {};\n\n    let attributions;\n    if (options.attributions !== undefined) {\n      attributions = options.attributions;\n    } else {\n      attributions = [ATTRIBUTION];\n    }\n\n    const crossOrigin =\n      options.crossOrigin !== undefined ? options.crossOrigin : 'anonymous';\n\n    const url =\n      options.url !== undefined\n        ? options.url\n        : 'https://tile.openstreetmap.org/{z}/{x}/{y}.png';\n\n    super({\n      attributions: attributions,\n      attributionsCollapsible: false,\n      cacheSize: options.cacheSize,\n      crossOrigin: crossOrigin,\n      interpolate: options.interpolate,\n      maxZoom: options.maxZoom !== undefined ? options.maxZoom : 19,\n      reprojectionErrorThreshold: options.reprojectionErrorThreshold,\n      tileLoadFunction: options.tileLoadFunction,\n      transition: options.transition,\n      url: url,\n      wrapX: options.wrapX,\n      zDirection: options.zDirection,\n    });\n  }\n}\n\nexport default OSM;\n","import { cartoLayers } from './carto';\nimport { esriLayers } from './esri';\nimport { genericLayers } from './generic';\nimport { osmLayers } from './osm';\n\n/**\n * Registry for layer handlers\n */\nexport const basemapLayers = [\n  ...osmLayers,\n  ...cartoLayers,\n  ...esriLayers, // keep formatting\n  ...genericLayers,\n];\n","import OpenLayersMap from 'ol/Map';\nimport TileLayer from 'ol/layer/Tile';\nimport OSM from 'ol/source/OSM';\n\nimport { MapLayerRegistryItem, MapLayerOptions, EventBus } from '@grafana/data';\n\nexport const standard: MapLayerRegistryItem = {\n  id: 'osm-standard',\n  name: 'Open Street Map',\n  description: 'Add map from a collaborative free geographic world database',\n  isBaseMap: true,\n\n  /**\n   * Function that configures transformation and returns a transformer\n   * @param options\n   */\n  create: async (map: OpenLayersMap, options: MapLayerOptions, eventBus: EventBus) => ({\n    init: () => {\n      const noRepeat = options.noRepeat ?? false;\n\n      return new TileLayer({\n        source: new OSM({ wrapX: !noRepeat }),\n      });\n    },\n  }),\n};\n\nexport const osmLayers = [standard];\n","/*\tCopyright (c) 2018 Jean-Marc VIGLINO, \r\n  released under the CeCILL-B license (French BSD license)\r\n  (http://www.cecill.info/licences/Licence_CeCILL-B_V1-en.txt).\r\n*/\r\n\r\nimport ol_geom_Polygon from 'ol/geom/Polygon.js'\r\nimport ol_Feature from 'ol/Feature.js'\r\nimport ol_source_Vector from 'ol/source/Vector.js'\r\nimport {all as ol_loadingstrategy_all} from 'ol/loadingstrategy.js'\r\n\r\n/** DayNight source: a source to display day/night on a map\r\n * @constructor \r\n * @extends {ol.source.Vector}\r\n * @param {any} options Vector source options\r\n *  @param {string|Date} time source date time\r\n *  @param {number} step step in degree for coordinate precision\r\n */\r\nvar ol_source_DayNight = class olsourceDayNight extends ol_source_Vector {\r\n  constructor(options) {\r\n    options = options || {};\r\n    options.strategy = ol_loadingstrategy_all;\r\n    super(options);\r\n    this.setLoader(this._loader);\r\n    this.set('time', options.time || new Date());\r\n    this.set('step', options.step || 1);\r\n  }\r\n  /** Compute the position of the Sun in ecliptic coordinates at julianDay.\r\n   * @see http://en.wikipedia.org/wiki/Position_of_the_Sun\r\n   * @param {number} julianDay\r\n   * @private\r\n   */\r\n  static _sunEclipticPosition(julianDay) {\r\n    var deg2rad = Math.PI / 180;\r\n    // Days since start of J2000.0\r\n    var n = julianDay - 2451545.0;\r\n    // mean longitude of the Sun\r\n    var L = 280.460 + 0.9856474 * n;\r\n    L %= 360;\r\n    // mean anomaly of the Sun\r\n    var g = 357.528 + 0.9856003 * n;\r\n    g %= 360;\r\n    // ecliptic longitude of Sun\r\n    var lambda = L + 1.915 * Math.sin(g * deg2rad) +\r\n      0.02 * Math.sin(2 * g * deg2rad);\r\n    // distance from Sun in AU\r\n    var R = 1.00014 - 0.01671 * Math.cos(g * deg2rad) -\r\n      0.0014 * Math.cos(2 * g * deg2rad);\r\n    return { lambda: lambda, R: R };\r\n  }\r\n  /**\r\n   * @see http://en.wikipedia.org/wiki/Axial_tilt#Obliquity_of_the_ecliptic_.28Earth.27s_axial_tilt.29\r\n   * @param {number} julianDay\r\n   * @private\r\n   */\r\n  static _eclipticObliquity(julianDay) {\r\n    var n = julianDay - 2451545.0;\r\n    // Julian centuries since J2000.0\r\n    var T = n / 36525;\r\n    var epsilon = 23.43929111 -\r\n      T * (46.836769 / 3600\r\n        - T * (0.0001831 / 3600\r\n          + T * (0.00200340 / 3600\r\n            - T * (0.576e-6 / 3600\r\n              - T * 4.34e-8 / 3600))));\r\n    return epsilon;\r\n  }\r\n  /* Compute the Sun's equatorial position from its ecliptic position.\r\n   * @param {number} sunEclLng sun lon in degrees\r\n   * @param {number} eclObliq secliptic position in degrees\r\n   * @return {number} position in degrees\r\n   * @private\r\n   */\r\n  static _sunEquatorialPosition(sunEclLon, eclObliq) {\r\n    var rad2deg = 180 / Math.PI;\r\n    var deg2rad = Math.PI / 180;\r\n\r\n    var alpha = Math.atan(Math.cos(eclObliq * deg2rad)\r\n      * Math.tan(sunEclLon * deg2rad)) * rad2deg;\r\n    var delta = Math.asin(Math.sin(eclObliq * deg2rad)\r\n      * Math.sin(sunEclLon * deg2rad)) * rad2deg;\r\n\r\n    var lQuadrant = Math.floor(sunEclLon / 90) * 90;\r\n    var raQuadrant = Math.floor(alpha / 90) * 90;\r\n    alpha = alpha + (lQuadrant - raQuadrant);\r\n\r\n    return { alpha: alpha, delta: delta };\r\n  }\r\n  /** Get the day/night separation latitude\r\n   * @param {number} lon\r\n   * @param {Date} time\r\n   * @returns {number}\r\n   */\r\n  static getNightLat(lon, time) {\r\n    var rad2deg = 180 / Math.PI;\r\n    var deg2rad = Math.PI / 180;\r\n\r\n    var date = time ? new Date(time) : new Date();\r\n\r\n    // Calculate the present UTC Julian Date. \r\n    // Function is valid after the beginning of the UNIX epoch 1970-01-01 and ignores leap seconds. \r\n    var julianDay = (date / 86400000) + 2440587.5;\r\n\r\n    // Calculate Greenwich Mean Sidereal Time (low precision equation).\r\n    // http://aa.usno.navy.mil/faq/docs/GAST.php \r\n    var gst = (18.697374558 + 24.06570982441908 * (julianDay - 2451545.0)) % 24;\r\n\r\n    var sunEclPos = ol_source_DayNight._sunEclipticPosition(julianDay);\r\n    var eclObliq = ol_source_DayNight._eclipticObliquity(julianDay);\r\n    var sunEqPos = ol_source_DayNight._sunEquatorialPosition(sunEclPos.lambda, eclObliq);\r\n\r\n    // Hour angle (indegrees) of the sun for a longitude on Earth.\r\n    var ha = (gst * 15 + lon) - sunEqPos.alpha;\r\n    // Latitude     \r\n    var lat = Math.atan(-Math.cos(ha * deg2rad) /\r\n      Math.tan(sunEqPos.delta * deg2rad)) * rad2deg;\r\n\r\n    return lat;\r\n  }\r\n  /** Loader\r\n   * @private\r\n   */\r\n  _loader(extent, resolution, projection) {\r\n    var lonlat = this.getCoordinates(this.get('time'));\r\n    var geom = new ol_geom_Polygon([lonlat]);\r\n    geom.transform('EPSG:4326', projection);\r\n    this.addFeature(new ol_Feature(geom));\r\n  }\r\n  /** Set source date time\r\n   * @param {string|Date} time source date time\r\n   */\r\n  setTime(time) {\r\n    this.set('time', time);\r\n    this.refresh();\r\n  }\r\n  /** Get sun coordinates on earth\r\n   * @param {string} time DateTime string, default yet\r\n   * @returns {ol.coordinate} position in lonlat\r\n   */\r\n  getSunPosition(time) {\r\n    var date = time ? new Date(time) : new Date();\r\n\r\n    // Calculate the present UTC Julian Date. \r\n    // Function is valid after the beginning of the UNIX epoch 1970-01-01 and ignores leap seconds. \r\n    var julianDay = (date / 86400000) + 2440587.5;\r\n\r\n    // Calculate Greenwich Mean Sidereal Time (low precision equation).\r\n    // http://aa.usno.navy.mil/faq/docs/GAST.php \r\n    var gst = (18.697374558 + 24.06570982441908 * (julianDay - 2451545.0)) % 24;\r\n\r\n    var sunEclPos = ol_source_DayNight._sunEclipticPosition(julianDay);\r\n    var eclObliq = ol_source_DayNight._eclipticObliquity(julianDay);\r\n    var sunEqPos = ol_source_DayNight._sunEquatorialPosition(sunEclPos.lambda, eclObliq);\r\n\r\n    return [sunEqPos.alpha - gst * 15, sunEqPos.delta];\r\n  }\r\n  /** Get night-day separation line\r\n   * @param {string} time DateTime string, default yet\r\n   * @param {string} options use 'line' to get the separation line, 'day' to get the day polygon, 'night' to get the night polygon or 'daynight' to get both polygon, default 'night'\r\n   * @return {Array<ol.Point>|Array<Array<ol.Point>>}\r\n   */\r\n  getCoordinates(time, options) {\r\n    var rad2deg = 180 / Math.PI;\r\n    var deg2rad = Math.PI / 180;\r\n\r\n    var date = time ? new Date(time) : new Date();\r\n\r\n    // Calculate the present UTC Julian Date. \r\n    // Function is valid after the beginning of the UNIX epoch 1970-01-01 and ignores leap seconds. \r\n    var julianDay = (date / 86400000) + 2440587.5;\r\n\r\n    // Calculate Greenwich Mean Sidereal Time (low precision equation).\r\n    // http://aa.usno.navy.mil/faq/docs/GAST.php \r\n    var gst = (18.697374558 + 24.06570982441908 * (julianDay - 2451545.0)) % 24;\r\n    var lonlat = [];\r\n\r\n    var sunEclPos = ol_source_DayNight._sunEclipticPosition(julianDay);\r\n    var eclObliq = ol_source_DayNight._eclipticObliquity(julianDay);\r\n    var sunEqPos = ol_source_DayNight._sunEquatorialPosition(sunEclPos.lambda, eclObliq);\r\n\r\n    var step = this.get('step') || 1;\r\n    for (var i = -180; i <= 180; i += step) {\r\n      var lon = i;\r\n      // Hour angle (indegrees) of the sun for a longitude on Earth.\r\n      var ha = (gst * 15 + lon) - sunEqPos.alpha;\r\n      // Latitude     \r\n      var lat = Math.atan(-Math.cos(ha * deg2rad) /\r\n        Math.tan(sunEqPos.delta * deg2rad)) * rad2deg;\r\n      // New point\r\n      lonlat.push([lon, lat]);\r\n    }\r\n    switch (options) {\r\n      case 'line': break;\r\n      case 'day': sunEqPos.delta *= -1;\r\n      // fallthrough\r\n      default: {\r\n        // Close polygon\r\n        lat = (sunEqPos.delta < 0) ? 90 : -90;\r\n        for (var tlon = 180; tlon >= -180; tlon -= step) {\r\n          lonlat.push([tlon, lat]);\r\n        }\r\n        lonlat.push(lonlat[0]);\r\n        break;\r\n      }\r\n    }\r\n    // Return night + day polygon\r\n    if (options === 'daynight') {\r\n      var day = [];\r\n      lonlat.forEach(function (t) { day.push(t.slice()); });\r\n      day[0][1] = -day[0][1];\r\n      day[day.length - 1][1] = -day[0][1];\r\n      day[day.length - 1][1] = -day[0][1];\r\n      lonlat = [lonlat, day];\r\n    }\r\n    // Return polygon\r\n    return lonlat;\r\n  }\r\n}\r\n\r\nexport default ol_source_DayNight\r\n","import Feature from 'ol/Feature';\nimport OpenLayersMap from 'ol/Map';\nimport Point from 'ol/geom/Point';\nimport { Group as LayerGroup } from 'ol/layer';\nimport VectorImage from 'ol/layer/VectorImage';\nimport { fromLonLat } from 'ol/proj';\nimport VectorSource from 'ol/source/Vector';\nimport { Fill, Stroke, Style, Circle } from 'ol/style';\nimport DayNight from 'ol-ext/source/DayNight';\nimport { Subscription } from 'rxjs';\n\nimport {\n  MapLayerRegistryItem,\n  MapLayerOptions,\n  PanelData,\n  GrafanaTheme2,\n  EventBus\n} from '@grafana/data';\n\nexport enum ShowTime {\n  From = 'from',\n  To = 'to',\n}\n\n// Configuration options for Circle overlays\nexport interface DayNightConfig {\n  show: ShowTime;\n  sun: boolean;\n  nightColor: string;\n}\n\nconst defaultConfig: DayNightConfig = {\n  show: ShowTime.To,\n  sun: false,\n  nightColor: '#a7a6ba4D',\n};\n\nexport const DAY_NIGHT_LAYER_ID = 'dayNight';\n\n// Used by default when nothing is configured\nexport const defaultDayNightConfig: MapLayerOptions<DayNightConfig> = {\n  type: DAY_NIGHT_LAYER_ID,\n  name: '', // will get replaced\n  config: defaultConfig,\n  tooltip: true,\n};\n\n/**\n * Map layer configuration for circle overlay\n */\nexport const dayNightLayer: MapLayerRegistryItem<DayNightConfig> = {\n  id: DAY_NIGHT_LAYER_ID,\n  name: 'Night / Day',\n  description: 'Show day and night regions',\n  isBaseMap: false,\n\n  /**\n   * Function that configures transformation and returns a transformer\n   * @param map\n   * @param options\n   * @param theme\n   */\n  create: async (map: OpenLayersMap, options: MapLayerOptions<DayNightConfig>, eventBus: EventBus, theme: GrafanaTheme2) => {\n    // Assert default values\n    const config = {\n      ...defaultConfig,\n      ...options?.config,\n    };\n\n    // DayNight source\n    const source = new DayNight({});\n    const sourceMethods = Object.getPrototypeOf(source);\n\n    // Night polygon\n    const vectorLayer = new VectorImage({\n      source,\n      style: new Style({\n        fill: new Fill({\n          color: theme.visualization.getColorByName(config.nightColor),\n        }),\n      }),\n    });\n\n    // Night line (for crosshair sharing)\n    const nightLineLayer = new VectorImage({\n      source: new VectorSource({\n        features: [],\n      }),\n      style: new Style({\n        stroke: new Stroke({\n          color: '#607D8B',\n          width: 1.5,\n          lineDash: [2, 3],\n        }),\n      }),\n    });\n\n    // Sun circle\n    const sunFeature = new Feature({\n      geometry: new Point([]),\n    });\n\n    const sunLayer = new VectorImage({\n      source: new VectorSource({\n        features: [sunFeature],\n      }),\n      style: new Style({\n        image: new Circle({\n          radius: 13,\n          fill: new Fill({ color: 'rgb(253,184,19)' }),\n        }),\n      }),\n    });\n\n    // Sun line (for crosshair sharing)\n    const sunLineFeature = new Feature({\n      geometry: new Point([]),\n    });\n\n    const sunLineStyle = new Style({\n      image: new Circle({\n        radius: 13,\n        stroke: new Stroke({\n          color: 'rgb(253,184,19)',\n          width: 1.5,\n        }),\n      }),\n    });\n\n    const sunLineStyleDash = new Style({\n      image: new Circle({\n        radius: 15,\n        stroke: new Stroke({\n          color: '#607D8B',\n          width: 1.5,\n          lineDash: [2, 3],\n        }),\n      }),\n    });\n\n    const sunLineLayer = new VectorImage({\n      source: new VectorSource({\n        features: [sunLineFeature],\n      }),\n      style: [sunLineStyleDash, sunLineStyle],\n    });\n\n    // Build group of layers\n    // TODO: add blended night region to \"connect\" current night region to lines\n    const layer = new LayerGroup({\n      layers: config.sun ? [vectorLayer, sunLayer, sunLineLayer, nightLineLayer] : [vectorLayer, nightLineLayer],\n    });\n\n    // Crosshair sharing subscriptions\n    const subscriptions = new Subscription();\n\n\n    return {\n      init: () => layer,\n      dispose: () => subscriptions.unsubscribe(),\n      update: (data: PanelData) => {\n        const from = new Date(data.timeRange.from.valueOf());\n        const to = new Date(data.timeRange.to.valueOf());\n        let selectedTime: Date = new Date();\n        let sunPos: number[] = [];\n        // TODO: add option for \"Both\"\n        if (config.show === ShowTime.From) {\n          selectedTime = from;\n        } else {\n          selectedTime = to;\n        }\n\n        source.setTime(selectedTime);\n        if (config.sun) {\n          sunPos = sourceMethods.getSunPosition(selectedTime);\n          sunFeature.getGeometry()?.setCoordinates(fromLonLat(sunPos));\n        }\n      },\n\n      // Marker overlay options\n      registerOptionsUI: (builder) => {\n        if (!options.config?.nightColor) {\n          options.config = { ...defaultConfig, ...options.config };\n        }\n\n        builder.addRadio({\n          path: 'config.show',\n          name: 'Show',\n          settings: {\n            options: [\n              { label: 'From', value: ShowTime.From },\n              { label: 'To', value: ShowTime.To },\n            ],\n          },\n          defaultValue: defaultConfig.show,\n        });\n        builder.addColorPicker({\n          path: 'config.nightColor',\n          name: 'Night region color',\n          description: 'Pick color of night region',\n          defaultValue: defaultConfig.nightColor,\n          settings: [{ enableNamedColors: false }],\n        });\n        builder.addBooleanSwitch({\n          path: 'config.sun',\n          name: 'Display sun',\n          description: 'Show the sun',\n          defaultValue: defaultConfig.sun,\n        });\n      },\n    };\n  },\n\n  // fill in the default values\n  defaultOptions: defaultConfig,\n};\n","import { FeatureLike } from 'ol/Feature';\n\nimport { compareValues } from '@grafana/data/internal';\n\nimport { FeatureRuleConfig } from '../types';\n\n/**\n * Check whether feature has property value that matches rule\n * @param rule - style rule with an operation, property, and value\n * @param feature - feature with properties and values\n * @returns boolean\n */\nexport const checkFeatureMatchesStyleRule = (rule: FeatureRuleConfig, feature: FeatureLike) => {\n  const val = feature.get(rule.property);\n  return compareValues(val, rule.operation, rule.value);\n};\n","import { FeatureLike } from 'ol/Feature';\n\nimport { SelectableValue } from '@grafana/data';\n\nimport { GeometryTypeId } from '../style/types';\n\nexport interface LayerContentInfo {\n  geometryType: GeometryTypeId;\n  propertes: Array<SelectableValue<string>>;\n}\n\nexport function getLayerPropertyInfo(features: FeatureLike[]): LayerContentInfo {\n  const types = new Set<string>();\n  const props = new Set<string>();\n  features.some((feature, idx) => {\n    for (const key in feature.getProperties()) {\n      if (key === 'geometry') {\n        continue;\n      }\n      props.add(key);\n      const g = feature.getGeometry();\n      if (g) {\n        types.add(g.getType());\n      }\n    }\n    return idx > 10; // first 10 items\n  });\n\n  let geometryType = GeometryTypeId.Any;\n  if (types.size === 1) {\n    switch (types.values().next().value) {\n      case 'Point':\n      case 'MultiPoint':\n        geometryType = GeometryTypeId.Point;\n        break;\n      case 'Line':\n      case 'MultiLine':\n        geometryType = GeometryTypeId.Line;\n        break;\n      case 'Polygon':\n        geometryType = GeometryTypeId.Polygon;\n    }\n  }\n\n  return {\n    geometryType,\n    propertes: Array.from(props.keys()).map((v) => ({ label: v, value: v })),\n  };\n}\n\nexport function getUniqueFeatureValues(features: FeatureLike[], key: string): string[] {\n  const unique = new Set<string>();\n  for (const feature of features) {\n    const v = feature.get(key);\n    if (v != null) {\n      unique.add(`${v}`); // always string\n    }\n  }\n  const buffer = Array.from(unique);\n  buffer.sort();\n  return buffer;\n}\n","import { FeatureLike } from 'ol/Feature';\nimport OpenLayersMap from 'ol/Map';\nimport { unByKey } from 'ol/Observable';\nimport GeoJSON from 'ol/format/GeoJSON';\nimport VectorImage from 'ol/layer/VectorImage';\nimport VectorSource from 'ol/source/Vector';\nimport { Fill, Stroke, Style } from 'ol/style';\nimport { ReplaySubject } from 'rxjs';\nimport { map as rxjsmap, first } from 'rxjs/operators';\n\nimport {\n  MapLayerRegistryItem,\n  MapLayerOptions,\n  PanelData,\n  GrafanaTheme2,\n  PluginState,\n  EventBus,\n  DataFrame,\n} from '@grafana/data';\nimport { ComparisonOperation } from '@grafana/schema';\nimport { findField } from 'app/features/dimensions/utils';\n\nimport { StyleEditor } from '../../editor/StyleEditor';\nimport { polyStyle } from '../../style/markers';\nimport { defaultStyleConfig, StyleConfig, StyleConfigState } from '../../style/types';\nimport { getStyleConfigState } from '../../style/utils';\nimport { FeatureRuleConfig, FeatureStyleConfig } from '../../types';\nimport { checkFeatureMatchesStyleRule } from '../../utils/checkFeatureMatchesStyleRule';\nimport { getLayerPropertyInfo } from '../../utils/getFeatures';\nimport { getStyleDimension, getPublicGeoJSONFiles } from '../../utils/utils';\n\n\nexport interface DynamicGeoJSONMapperConfig {\n  // URL for a geojson file\n  src?: string;\n\n  // The default style (applied if no rules match)\n  style: StyleConfig;\n\n  // Pick style based on a rule\n  rules: FeatureStyleConfig[];\n  idField?: string;\n  dataStyle: StyleConfig;\n}\n\nconst defaultOptions: DynamicGeoJSONMapperConfig = {\n  src: 'public/maps/countries.geojson',\n  rules: [],\n  style: defaultStyleConfig,\n  dataStyle: {},\n};\n\ninterface StyleCheckerState {\n  state: StyleConfigState;\n  poly?: Style | Style[];\n  point?: Style | Style[];\n  rule?: FeatureRuleConfig;\n}\n\nexport const DEFAULT_STYLE_RULE: FeatureStyleConfig = {\n  style: defaultStyleConfig,\n  check: {\n    property: '',\n    operation: ComparisonOperation.EQ,\n    value: '',\n  },\n};\n\n// Default configuration with tooltip support enabled\nexport const defaultDynamicGeoJSONConfig: MapLayerOptions<DynamicGeoJSONMapperConfig> = {\n  type: 'dynamic-geojson',\n  name: 'Dynamic GeoJSON',\n  config: defaultOptions,\n  tooltip: true,\n};\n\nexport const dynamicGeoJSONLayer: MapLayerRegistryItem<DynamicGeoJSONMapperConfig> = {\n  id: 'dynamic-geojson',\n  name: 'Dynamic GeoJSON',\n  description: 'Style a geojson file based on query results',\n  isBaseMap: false,\n  state: PluginState.alpha,\n\n  /**\n   * Function that configures transformation and returns a transformer\n   * @param map\n   * @param options\n   * @param theme\n   */\n  create: async (map: OpenLayersMap, options: MapLayerOptions<DynamicGeoJSONMapperConfig>, eventBus: EventBus, theme: GrafanaTheme2) => {\n    const config = { ...defaultOptions, ...options.config };\n\n    const source = new VectorSource({\n      url: config.src,\n      format: new GeoJSON(),\n    });\n\n    const features = new ReplaySubject<FeatureLike[]>();\n\n    // Function to update feature properties for tooltip support\n    const updateFeatureProperties = (frame?: DataFrame) => {\n      updateFeaturePropertiesForTooltip(source, frame, config.idField, idToIdx);\n    };\n\n    const key = source.on('change', () => {\n      //one geojson loads\n      if (source.getState() === 'ready') {\n        unByKey(key);\n        features.next(source.getFeatures());\n        // Apply current data to newly loaded features\n        if (currentFrame) {\n          updateFeatureProperties(currentFrame);\n        }\n      }\n    });\n\n    const styles: StyleCheckerState[] = [];\n    if (config.rules) {\n      for (const r of config.rules) {\n        if (r.style) {\n          const s = await getStyleConfigState(r.style);\n          styles.push({\n            state: s,\n            rule: r.check,\n          });\n        }\n      }\n    }\n\n    const s = await getStyleConfigState(config.style);\n    styles.push({\n      state: s,\n    });\n\n\n    const style = await getStyleConfigState(config.style);\n    const idToIdx = new Map<string, number>();\n    let currentFrame: DataFrame | undefined = undefined;\n\n    const vectorLayer = new VectorImage({\n      source,\n      style: (feature: FeatureLike) => {\n        const featureId = feature.getId();\n        const idx = featureId != null ? idToIdx.get(String(featureId)) : undefined;\n        const dims = style.dims;\n\n        if (idx !== undefined && dims) {\n          return new Style({\n            fill: new Fill({ color: dims.color?.get(idx) }),\n            stroke: new Stroke({ color: style.base.color, width: style.base.lineWidth ?? 1 }),\n          });\n        }\n\n        const isPoint = feature.getGeometry()?.getType() === 'Point';\n\n        for (const check of styles) {\n          if (check.rule && !checkFeatureMatchesStyleRule(check.rule, feature)) {\n            continue;\n          }\n\n          // Support dynamic values\n          if (check.state.fields) {\n            const values = { ...check.state.base };\n            const { text } = check.state.fields;\n\n            if (text) {\n              values.text = `${feature.get(text)}`;\n            }\n            if (isPoint) {\n              return check.state.maker(values);\n            }\n            return polyStyle(values);\n          }\n\n          // Lazy create the style object\n          if (isPoint) {\n            if (!check.point) {\n              check.point = check.state.maker(check.state.base);\n            }\n            return check.point;\n          }\n\n          if (!check.poly) {\n            check.poly = polyStyle(check.state.base);\n          }\n          return check.poly;\n        }\n        return undefined; // unreachable\n      },\n    });\n\n    return {\n      init: () => vectorLayer,\n      update: (data: PanelData) => {\n        const frame = data.series[0];\n        if (frame) {\n          currentFrame = frame;\n          \n          // Update feature properties for tooltip support\n          updateFeatureProperties(frame);\n          \n          // Update style dimensions for data-driven styling\n          style.dims = getStyleDimension(frame, style, theme, config.dataStyle);\n        }\n        vectorLayer.changed();\n      },\n      registerOptionsUI: (builder) => {\n        // get properties for first feature to use as ui options\n        const layerInfo = features.pipe(\n          first(),\n          rxjsmap((v) => getLayerPropertyInfo(v))\n        );\n\n        builder\n          .addSelect({\n            path: 'config.src',\n            name: 'GeoJSON URL',\n            settings: {\n              options: getPublicGeoJSONFiles() ?? [],\n              allowCustomValue: true,\n            },\n            defaultValue: defaultOptions.src,\n          })\n          .addFieldNamePicker({\n            path: 'config.idField',\n            name: 'ID Field',\n          })\n          .addCustomEditor({\n            id: 'config.dataStyle',\n            path: 'config.dataStyle',\n            name: 'Data style',\n            editor: StyleEditor,\n            settings: {\n              displayRotation: false,\n            },\n            defaultValue: defaultOptions.dataStyle,\n          })\n          .addCustomEditor({\n            id: 'config.style',\n            path: 'config.style',\n            name: 'Default style',\n            description: 'The style to apply when no rules above match',\n            editor: StyleEditor,\n            settings: {\n              simpleFixedValues: true,\n              layerInfo,\n            },\n            defaultValue: defaultOptions.style,\n          })\n      },\n    };\n  },\n  defaultOptions,\n};\n\n/**\n * Helper function to update feature properties for tooltip support\n * @param source - OpenLayers vector source containing features\n * @param frame - DataFrame containing the data\n * @param idField - Field name to use for matching feature IDs\n * @param idToIdx - Map to store ID to row index mappings\n */\nexport function updateFeaturePropertiesForTooltip(\n  source: VectorSource,\n  frame: DataFrame | undefined,\n  idField: string | undefined,\n  idToIdx: Map<string, number>\n): void {\n  if (!frame || !idField) {\n    return;\n  }\n  \n  const field = findField(frame, idField);\n  if (field) {\n    idToIdx.clear();\n    field.values.forEach((v, i) => idToIdx.set(String(v), i));\n    \n    source.forEachFeature((feature) => {\n      const featureId = feature.getId();\n      if (featureId != null) {\n        const rowIndex = idToIdx.get(String(featureId));\n        if (rowIndex !== undefined) {\n          // Set tooltip properties without overwriting existing GeoJSON properties\n          feature.set('frame', frame);\n          feature.set('rowIndex', rowIndex);\n        }\n      }\n    });\n  }\n}\n","import { SelectableValue } from '@grafana/data';\n\nexport interface SelectionInfo<T> {\n  options: Array<SelectableValue<T>>;\n  current?: SelectableValue<T>;\n}\n\n/**\n * The select component is really annoying -- if the current value is not in the list of options\n * it won't show up.  This is a wrapper to make that happen.\n */\nexport function getSelectionInfo<T>(v?: T, options?: Array<SelectableValue<T>>): SelectionInfo<T> {\n  if (v && !options) {\n    const current = { label: `${v}`, value: v };\n    return { options: [current], current };\n  }\n  if (!options) {\n    options = [];\n  }\n  let current = options.find((item) => item.value === v);\n\n  if (v && !current) {\n    current = {\n      label: `${v} (not found)`,\n      value: v,\n    };\n    options.push(current);\n  }\n  return {\n    options,\n    current,\n  };\n}\n","import { css } from '@emotion/css';\nimport { FeatureLike } from 'ol/Feature';\nimport { useCallback, useMemo } from 'react';\nimport { useObservable } from 'react-use';\nimport { Observable } from 'rxjs';\n\nimport { GrafanaTheme2, SelectableValue, StandardEditorProps, StandardEditorsRegistryItem } from '@grafana/data';\nimport { t } from '@grafana/i18n';\nimport { ComparisonOperation } from '@grafana/schema';\nimport { Button, InlineField, InlineFieldRow, Select, useStyles2 } from '@grafana/ui';\nimport { comparisonOperationOptions } from '@grafana/ui/internal';\nimport { NumberInput } from 'app/core/components/OptionsUI/NumberInput';\n\nimport { DEFAULT_STYLE_RULE } from '../layers/data/geojsonLayer';\nimport { defaultStyleConfig, StyleConfig } from '../style/types';\nimport { FeatureStyleConfig } from '../types';\nimport { getUniqueFeatureValues, LayerContentInfo } from '../utils/getFeatures';\nimport { getSelectionInfo } from '../utils/selection';\n\nimport { StyleEditor } from './StyleEditor';\n\nexport interface StyleRuleEditorSettings {\n  features: Observable<FeatureLike[]>;\n  layerInfo: Observable<LayerContentInfo>;\n}\n\ntype Props = StandardEditorProps<FeatureStyleConfig, StyleRuleEditorSettings, unknown>;\n\nexport const StyleRuleEditor = ({ value, onChange, item, context }: Props) => {\n  const settings = item.settings;\n  if (!settings) {\n    // Shouldn't be possible to hit this block, but just in case\n    throw Error('Settings not found');\n  }\n  const { features, layerInfo } = settings;\n\n  const propertyOptions = useObservable(layerInfo);\n  const feats = useObservable(features);\n\n  const uniqueSelectables = useMemo(() => {\n    const key = value?.check?.property;\n    if (key && feats && value.check?.operation === ComparisonOperation.EQ) {\n      return getUniqueFeatureValues(feats, key).map((v) => {\n        let newValue;\n        let isNewValueNumber = !isNaN(Number(v));\n\n        if (isNewValueNumber) {\n          newValue = {\n            value: Number(v),\n            label: v,\n          };\n        } else {\n          newValue = { value: v, label: v };\n        }\n\n        return newValue;\n      });\n    }\n    return [];\n  }, [feats, value]);\n\n  const styles = useStyles2(getStyles);\n\n  const LABEL_WIDTH = 10;\n\n  const onChangeProperty = useCallback(\n    (selection?: SelectableValue) => {\n      onChange({\n        ...value,\n        check: {\n          ...value.check!,\n          property: selection?.value,\n        },\n      });\n    },\n    [onChange, value]\n  );\n\n  const onChangeComparison = useCallback(\n    (selection: SelectableValue) => {\n      onChange({\n        ...value,\n        check: {\n          ...value.check!,\n          operation: selection.value ?? ComparisonOperation.EQ,\n        },\n      });\n    },\n    [onChange, value]\n  );\n\n  const onChangeValue = useCallback(\n    (selection?: SelectableValue) => {\n      onChange({\n        ...value,\n        check: {\n          ...value.check!,\n          value: selection?.value,\n        },\n      });\n    },\n    [onChange, value]\n  );\n\n  const onChangeNumericValue = useCallback(\n    (v?: number) => {\n      onChange({\n        ...value,\n        check: {\n          ...value.check!,\n          value: v!,\n        },\n      });\n    },\n    [onChange, value]\n  );\n\n  const onChangeStyle = useCallback(\n    (style?: StyleConfig) => {\n      onChange({ ...value, style });\n    },\n    [onChange, value]\n  );\n\n  const onDelete = useCallback(() => {\n    onChange(undefined);\n  }, [onChange]);\n\n  const check = value.check ?? DEFAULT_STYLE_RULE.check!;\n  const propv = getSelectionInfo(check.property, propertyOptions?.propertes);\n  const valuev = getSelectionInfo(check.value, uniqueSelectables);\n\n  return (\n    <div className={styles.rule}>\n      <InlineFieldRow className={styles.row}>\n        <InlineField label={t('geomap.style-rule-editor.label-rule', 'Rule')} labelWidth={LABEL_WIDTH} grow={true}>\n          <Select\n            placeholder={t('geomap.style-rule-editor.placeholder-feature-property', 'Feature property')}\n            value={propv.current}\n            options={propv.options}\n            onChange={onChangeProperty}\n            aria-label={t('geomap.style-rule-editor.aria-label-feature-property', 'Feature property')}\n            isClearable\n            allowCustomValue\n          />\n        </InlineField>\n        <InlineField className={styles.inline}>\n          <Select\n            value={comparisonOperationOptions.find((v) => v.value === check.operation)}\n            options={comparisonOperationOptions}\n            onChange={onChangeComparison}\n            aria-label={t('geomap.style-rule-editor.aria-label-comparison-operator', 'Comparison operator')}\n            width={8}\n          />\n        </InlineField>\n        <InlineField className={styles.inline} grow={true}>\n          <div className={styles.flexRow}>\n            {(check.operation === ComparisonOperation.EQ || check.operation === ComparisonOperation.NEQ) && (\n              <Select\n                placeholder={t('geomap.style-rule-editor.placeholder-value', 'value')}\n                value={valuev.current}\n                options={valuev.options}\n                onChange={onChangeValue}\n                aria-label={t('geomap.style-rule-editor.aria-label-comparison-value', 'Comparison value')}\n                isClearable\n                allowCustomValue\n              />\n            )}\n            {check.operation !== ComparisonOperation.EQ && (\n              <NumberInput\n                key={`${check.property}/${check.operation}`}\n                value={!isNaN(Number(check.value)) ? Number(check.value) : 0}\n                placeholder={t('geomap.style-rule-editor.placeholder-numeric-value', 'Numeric value')}\n                onChange={onChangeNumericValue}\n              />\n            )}\n          </div>\n        </InlineField>\n        <Button\n          size=\"md\"\n          icon=\"trash-alt\"\n          onClick={() => onDelete()}\n          variant=\"secondary\"\n          aria-label={t('geomap.style-rule-editor.aria-label-delete-style-rule', 'Delete style rule')}\n          className={styles.button}\n        ></Button>\n      </InlineFieldRow>\n      <div>\n        <StyleEditor\n          value={value.style ?? defaultStyleConfig}\n          context={context}\n          onChange={onChangeStyle}\n          item={\n            {\n              settings: {\n                simpleFixedValues: true,\n                layerInfo,\n              },\n            } as StandardEditorsRegistryItem\n          }\n        />\n      </div>\n    </div>\n  );\n};\n\nconst getStyles = (theme: GrafanaTheme2) => ({\n  rule: css({\n    marginBottom: theme.spacing(1),\n  }),\n  row: css({\n    display: 'flex',\n    marginBottom: '4px',\n  }),\n  inline: css({\n    marginBottom: 0,\n    marginLeft: '4px',\n  }),\n  button: css({\n    marginLeft: '4px',\n  }),\n  flexRow: css({\n    display: 'flex',\n    flexDirection: 'row',\n    alignItems: 'flex-start',\n  }),\n});\n","import { useCallback } from 'react';\n\nimport { StandardEditorProps, StandardEditorsRegistryItem } from '@grafana/data';\nimport { t } from '@grafana/i18n';\nimport { Button, useTheme2 } from '@grafana/ui';\n\nimport { DEFAULT_STYLE_RULE } from '../layers/data/geojsonLayer';\nimport { defaultStyleConfig } from '../style/types';\nimport { FeatureStyleConfig } from '../types';\n\nimport { StyleRuleEditor, StyleRuleEditorSettings } from './StyleRuleEditor';\n\ntype Props = StandardEditorProps<FeatureStyleConfig[], StyleRuleEditorSettings, unknown>;\n\nexport const GeomapStyleRulesEditor = ({ value, onChange, context, item }: Props) => {\n  const theme = useTheme2();\n\n  const settings = item.settings;\n  const onAddRule = useCallback(() => {\n    const { palette } = theme.visualization;\n    const color = {\n      fixed: palette[Math.floor(Math.random() * palette.length)],\n    };\n\n    const newRule = [...value, { ...DEFAULT_STYLE_RULE, style: { ...defaultStyleConfig, color } }];\n\n    onChange(newRule);\n  }, [onChange, value, theme.visualization]);\n\n  const onRuleChange = useCallback(\n    (idx: number) => (style: FeatureStyleConfig | undefined) => {\n      const copyStyles = [...value];\n      if (style) {\n        copyStyles[idx] = style;\n      } else {\n        //assume undefined is only returned on delete\n        copyStyles.splice(idx, 1);\n      }\n      onChange(copyStyles);\n    },\n    [onChange, value]\n  );\n\n  const styleOptions =\n    value &&\n    value.map((style, idx: number) => {\n      const itemSettings = {\n        settings,\n      } as StandardEditorsRegistryItem<FeatureStyleConfig, StyleRuleEditorSettings>;\n\n      return (\n        <StyleRuleEditor\n          value={style}\n          onChange={onRuleChange(idx)}\n          context={context}\n          item={itemSettings}\n          key={`${idx}-${style.check?.property}`}\n        />\n      );\n    });\n\n  return (\n    <>\n      {styleOptions}\n      <Button\n        size=\"sm\"\n        icon=\"plus\"\n        onClick={onAddRule}\n        variant=\"secondary\"\n        aria-label={t('geomap.geomap-style-rules-editor.aria-label-add-geomap-style-rule', 'Add geomap style rule')}\n      >\n        {'Add style rule'}\n      </Button>\n    </>\n  );\n};\n","import { FeatureLike } from 'ol/Feature';\nimport OpenLayersMap from 'ol/Map';\nimport { unByKey } from 'ol/Observable';\nimport GeoJSON from 'ol/format/GeoJSON';\nimport VectorImage from 'ol/layer/VectorImage';\nimport VectorSource from 'ol/source/Vector';\nimport { Style } from 'ol/style';\nimport { ReplaySubject } from 'rxjs';\nimport { map as rxjsmap, first } from 'rxjs/operators';\n\nimport { MapLayerRegistryItem, MapLayerOptions, GrafanaTheme2, EventBus } from '@grafana/data';\nimport { getTemplateSrv } from '@grafana/runtime';\nimport { ComparisonOperation } from '@grafana/schema';\n\nimport { GeomapStyleRulesEditor } from '../../editor/GeomapStyleRulesEditor';\nimport { StyleEditor } from '../../editor/StyleEditor';\nimport { polyStyle } from '../../style/markers';\nimport {\n  defaultStyleConfig,\n  GeoJSONLineStyles,\n  GeoJSONPointStyles,\n  GeoJSONPolyStyles,\n  StyleConfig,\n  StyleConfigState,\n  StyleConfigValues,\n} from '../../style/types';\nimport { getStyleConfigState } from '../../style/utils';\nimport { FeatureRuleConfig, FeatureStyleConfig } from '../../types';\nimport { checkFeatureMatchesStyleRule } from '../../utils/checkFeatureMatchesStyleRule';\nimport { getLayerPropertyInfo } from '../../utils/getFeatures';\nimport { getPublicGeoJSONFiles } from '../../utils/utils';\n\nexport interface GeoJSONMapperConfig {\n  // URL for a geojson file\n  src?: string;\n\n  // Pick style based on a rule\n  rules: FeatureStyleConfig[];\n\n  // The default style (applied if no rules match)\n  style: StyleConfig;\n}\n\nconst defaultOptions: GeoJSONMapperConfig = {\n  src: 'public/maps/countries.geojson',\n  rules: [],\n  style: defaultStyleConfig,\n};\n\ninterface StyleCheckerState {\n  state: StyleConfigState;\n  poly?: Style | Style[];\n  point?: Style | Style[];\n  rule?: FeatureRuleConfig;\n}\n\nexport const DEFAULT_STYLE_RULE: FeatureStyleConfig = {\n  style: defaultStyleConfig,\n  check: {\n    property: '',\n    operation: ComparisonOperation.EQ,\n    value: '',\n  },\n};\n\nexport const geojsonLayer: MapLayerRegistryItem<GeoJSONMapperConfig> = {\n  id: 'geojson',\n  name: 'GeoJSON',\n  description: 'Load static data from a geojson file',\n  isBaseMap: false,\n\n  /**\n   * Function that configures transformation and returns a transformer\n   * @param options\n   */\n  create: async (map: OpenLayersMap, options: MapLayerOptions<GeoJSONMapperConfig>, eventBus: EventBus, theme: GrafanaTheme2) => {\n    const config = { ...defaultOptions, ...options.config };\n\n    // Interpolate variables in the URL\n    const interpolatedUrl = getTemplateSrv().replace(config.src || '');\n    const isAbsoluteUrl = interpolatedUrl.startsWith('http');\n    const layerUrl = isAbsoluteUrl ? interpolatedUrl : `${window.__grafana_public_path__}${interpolatedUrl.replace(/^(public\\/)/, '')}`;\n\n    const source = new VectorSource({\n      url: layerUrl,\n      format: new GeoJSON(),\n    });\n\n    const features = new ReplaySubject<FeatureLike[]>();\n\n    const key = source.on('change', () => {\n      //one geojson loads\n      if (source.getState() === 'ready') {\n        unByKey(key);\n        features.next(source.getFeatures());\n      }\n    });\n\n    const styles: StyleCheckerState[] = [];\n    if (config.rules) {\n      for (const r of config.rules) {\n        if (r.style) {\n          const s = await getStyleConfigState(r.style);\n          styles.push({\n            state: s,\n            rule: r.check,\n          });\n        }\n      }\n    }\n\n    const s = await getStyleConfigState(config.style);\n    styles.push({\n      state: s,\n    });\n\n    const polyStyleStrings: string[] = Object.values(GeoJSONPolyStyles);\n    const pointStyleStrings: string[] = Object.values(GeoJSONPointStyles);\n    const lineStyleStrings: string[] = Object.values(GeoJSONLineStyles);\n    const vectorLayer = new VectorImage({\n      source,\n      style: (feature: FeatureLike) => {\n        const featureType = feature.getGeometry()?.getType();\n        const isPoint = featureType === 'Point' || featureType === 'MultiPoint';\n        const isPolygon = featureType === 'Polygon' || featureType === 'MultiPolygon';\n        const isLine = featureType === 'LineString' || featureType === 'MultiLineString';\n\n        for (const check of styles) {\n          if (check.rule && !checkFeatureMatchesStyleRule(check.rule, feature)) {\n            continue;\n          }\n\n          // Support dynamic values\n          if (check.state.fields) {\n            const values = { ...check.state.base };\n            const { text } = check.state.fields;\n\n            if (text) {\n              values.text = `${feature.get(text)}`;\n            }\n            if (isPoint) {\n              return check.state.maker(values);\n            }\n            return polyStyle(values);\n          }\n\n          // Support styling polygons from Feature properties\n          const featureProps = feature.getProperties();\n          if (isPolygon && Object.keys(featureProps).some((property) => polyStyleStrings.includes(property))) {\n            const values: StyleConfigValues = {\n              color: featureProps[GeoJSONPolyStyles.color] ?? check.state.base.color,\n              opacity: featureProps[GeoJSONPolyStyles.opacity] ?? check.state.base.opacity,\n              lineWidth: featureProps[GeoJSONPolyStyles.lineWidth] ?? check.state.base.lineWidth,\n            };\n            return polyStyle(values);\n          } else if (isLine && Object.keys(featureProps).some((property) => lineStyleStrings.includes(property))) {\n            const values: StyleConfigValues = {\n              color: featureProps[GeoJSONLineStyles.color] ?? check.state.base.color,\n              lineWidth: featureProps[GeoJSONLineStyles.lineWidth] ?? check.state.base.lineWidth,\n            };\n            return check.state.maker(values);\n          } else if (isPoint && Object.keys(featureProps).some((property) => pointStyleStrings.includes(property))) {\n            const values: StyleConfigValues = {\n              color: featureProps[GeoJSONPointStyles.color] ?? check.state.base.color,\n              size: featureProps[GeoJSONPointStyles.size] ?? check.state.base.size,\n            };\n            return check.state.maker(values);\n          }\n\n          // Lazy create the style object\n          if (isPoint) {\n            if (!check.point) {\n              check.point = check.state.maker(check.state.base);\n            }\n            return check.point;\n          }\n\n          if (!check.poly) {\n            check.poly = polyStyle(check.state.base);\n          }\n          return check.poly;\n        }\n        return undefined; // unreachable\n      },\n    });\n\n    return {\n      init: () => vectorLayer,\n      registerOptionsUI: (builder) => {\n        // get properties for first feature to use as ui options\n        const layerInfo = features.pipe(\n          first(),\n          rxjsmap((v) => getLayerPropertyInfo(v))\n        );\n\n        builder\n          .addSelect({\n            path: 'config.src',\n            name: 'GeoJSON URL',\n            settings: {\n              options: getPublicGeoJSONFiles() ?? [],\n              allowCustomValue: true,\n              supportVariables: true,\n            },\n            defaultValue: defaultOptions.src,\n          })\n          .addCustomEditor({\n            id: 'config.style',\n            path: 'config.style',\n            name: 'Default style',\n            description: 'The style to apply when no rules above match',\n            editor: StyleEditor,\n            settings: {\n              simpleFixedValues: true,\n              layerInfo,\n            },\n            defaultValue: defaultOptions.style,\n          })\n          .addCustomEditor({\n            id: 'config.rules',\n            path: 'config.rules',\n            name: 'Style rules',\n            description: 'Apply styles based on feature properties',\n            editor: GeomapStyleRulesEditor,\n            settings: {\n              features,\n              layerInfo,\n            },\n            defaultValue: [],\n          });\n      },\n    };\n  },\n  defaultOptions,\n};\n","/**\n * @module ol/render/webgl/MixedGeometryBatch\n */\nimport {inflateEnds} from '../../geom/flat/orient.js';\nimport RenderFeature from '../../render/Feature.js';\nimport {getUid} from '../../util.js';\n\n/**\n * @typedef {import(\"../../Feature.js\").default} Feature\n */\n/**\n * @typedef {import(\"../../geom/Geometry.js\").Type} GeometryType\n */\n\n/**\n * @typedef {Object} GeometryBatchItem Object that holds a reference to a feature as well as the raw coordinates of its various geometries\n * @property {Feature|RenderFeature} feature Feature\n * @property {Array<Array<number>>} flatCoordss Array of flat coordinates arrays, one for each geometry related to the feature\n * @property {number} [verticesCount] Only defined for linestring and polygon batches\n * @property {number} [ringsCount] Only defined for polygon batches\n * @property {Array<Array<number>>} [ringsVerticesCounts] Array of vertices counts in each ring for each geometry; only defined for polygons batches\n * @property {number} [ref] The reference in the global batch (used for hit detection)\n */\n\n/**\n * @typedef {PointGeometryBatch|LineStringGeometryBatch|PolygonGeometryBatch} GeometryBatch\n */\n\n/**\n * @typedef {Object} PolygonGeometryBatch A geometry batch specific to polygons\n * @property {Object<string, GeometryBatchItem>} entries Dictionary of all entries in the batch with associated computed values.\n * One entry corresponds to one feature. Key is feature uid.\n * @property {number} geometriesCount Amount of geometries in the batch.\n * @property {number} verticesCount Amount of vertices from geometries in the batch.\n * @property {number} ringsCount How many outer and inner rings in this batch.\n */\n\n/**\n * @typedef {Object} LineStringGeometryBatch A geometry batch specific to lines\n * @property {Object<string, GeometryBatchItem>} entries Dictionary of all entries in the batch with associated computed values.\n * One entry corresponds to one feature. Key is feature uid.\n * @property {number} geometriesCount Amount of geometries in the batch.\n * @property {number} verticesCount Amount of vertices from geometries in the batch.\n */\n\n/**\n * @typedef {Object} PointGeometryBatch A geometry batch specific to points\n * @property {Object<string, GeometryBatchItem>} entries Dictionary of all entries in the batch with associated computed values.\n * One entry corresponds to one feature. Key is feature uid.\n * @property {number} geometriesCount Amount of geometries in the batch.\n */\n\n/**\n * @classdesc This class is used to group several geometries of various types together for faster rendering.\n * Three inner batches are maintained for polygons, lines and points. Each time a feature is added, changed or removed\n * from the batch, these inner batches are modified accordingly in order to keep them up-to-date.\n *\n * A feature can be present in several inner batches, for example a polygon geometry will be present in the polygon batch\n * and its linear rings will be present in the line batch. Multi geometries are also broken down into individual geometries\n * and added to the corresponding batches in a recursive manner.\n *\n * Corresponding {@link module:ol/render/webgl/BatchRenderer} instances are then used to generate the render instructions\n * and WebGL buffers (vertices and indices) for each inner batches; render instructions are stored on the inner batches,\n * alongside the transform used to convert world coords to screen coords at the time these instructions were generated.\n * The resulting WebGL buffers are stored on the batches as well.\n *\n * An important aspect of geometry batches is that there is no guarantee that render instructions and WebGL buffers\n * are synchronized, i.e. render instructions can describe a new state while WebGL buffers might not have been written yet.\n * This is why two world-to-screen transforms are stored on each batch: one for the render instructions and one for\n * the WebGL buffers.\n */\nclass MixedGeometryBatch {\n  constructor() {\n    /**\n     * @private\n     */\n    this.globalCounter_ = 0;\n\n    /**\n     * Refs are used as keys for hit detection.\n     * @type {Map<number, Feature|RenderFeature>}\n     * @private\n     */\n    this.refToFeature_ = new Map();\n\n    /**\n     * Features are split in \"entries\", which are individual geometries. We use the following map to share a single ref for all those entries.\n     * @type {Map<string, number>}\n     * @private\n     */\n    this.uidToRef_ = new Map();\n\n    /**\n     * The precision in WebGL shaders is limited.\n     * To keep the refs as small as possible we maintain an array of freed up references.\n     * @type {Array<number>}\n     * @private\n     */\n    this.freeGlobalRef_ = [];\n\n    /**\n     * @type {PolygonGeometryBatch}\n     */\n    this.polygonBatch = {\n      entries: {},\n      geometriesCount: 0,\n      verticesCount: 0,\n      ringsCount: 0,\n    };\n\n    /**\n     * @type {PointGeometryBatch}\n     */\n    this.pointBatch = {\n      entries: {},\n      geometriesCount: 0,\n    };\n\n    /**\n     * @type {LineStringGeometryBatch}\n     */\n    this.lineStringBatch = {\n      entries: {},\n      geometriesCount: 0,\n      verticesCount: 0,\n    };\n  }\n\n  /**\n   * @param {Array<Feature|RenderFeature>} features Array of features to add to the batch\n   * @param {import(\"../../proj.js\").TransformFunction} [projectionTransform] Projection transform.\n   */\n  addFeatures(features, projectionTransform) {\n    for (let i = 0; i < features.length; i++) {\n      this.addFeature(features[i], projectionTransform);\n    }\n  }\n\n  /**\n   * @param {Feature|RenderFeature} feature Feature to add to the batch\n   * @param {import(\"../../proj.js\").TransformFunction} [projectionTransform] Projection transform.\n   */\n  addFeature(feature, projectionTransform) {\n    let geometry = feature.getGeometry();\n    if (!geometry) {\n      return;\n    }\n    if (projectionTransform) {\n      geometry = geometry.clone();\n      geometry.applyTransform(projectionTransform);\n    }\n    this.addGeometry_(geometry, feature);\n  }\n\n  /**\n   * @param {Feature|RenderFeature} feature Feature\n   * @return {GeometryBatchItem|void} the cleared entry\n   * @private\n   */\n  clearFeatureEntryInPointBatch_(feature) {\n    const featureUid = getUid(feature);\n    const entry = this.pointBatch.entries[featureUid];\n    if (!entry) {\n      return;\n    }\n    this.pointBatch.geometriesCount -= entry.flatCoordss.length;\n    delete this.pointBatch.entries[featureUid];\n    return entry;\n  }\n\n  /**\n   * @param {Feature|RenderFeature} feature Feature\n   * @return {GeometryBatchItem|void} the cleared entry\n   * @private\n   */\n  clearFeatureEntryInLineStringBatch_(feature) {\n    const featureUid = getUid(feature);\n    const entry = this.lineStringBatch.entries[featureUid];\n    if (!entry) {\n      return;\n    }\n    this.lineStringBatch.verticesCount -= entry.verticesCount;\n    this.lineStringBatch.geometriesCount -= entry.flatCoordss.length;\n    delete this.lineStringBatch.entries[featureUid];\n    return entry;\n  }\n\n  /**\n   * @param {Feature|RenderFeature} feature Feature\n   * @return {GeometryBatchItem|void} the cleared entry\n   * @private\n   */\n  clearFeatureEntryInPolygonBatch_(feature) {\n    const featureUid = getUid(feature);\n    const entry = this.polygonBatch.entries[featureUid];\n    if (!entry) {\n      return;\n    }\n    this.polygonBatch.verticesCount -= entry.verticesCount;\n    this.polygonBatch.ringsCount -= entry.ringsCount;\n    this.polygonBatch.geometriesCount -= entry.flatCoordss.length;\n    delete this.polygonBatch.entries[featureUid];\n    return entry;\n  }\n\n  /**\n   * @param {import(\"../../geom.js\").Geometry|RenderFeature} geometry Geometry\n   * @param {Feature|RenderFeature} feature Feature\n   * @private\n   */\n  addGeometry_(geometry, feature) {\n    const type = geometry.getType();\n    switch (type) {\n      case 'GeometryCollection': {\n        const geometries =\n          /** @type {import(\"../../geom.js\").GeometryCollection} */ (\n            geometry\n          ).getGeometriesArray();\n        for (const geometry of geometries) {\n          this.addGeometry_(geometry, feature);\n        }\n        break;\n      }\n      case 'MultiPolygon': {\n        const multiPolygonGeom =\n          /** @type {import(\"../../geom.js\").MultiPolygon} */ (geometry);\n        this.addCoordinates_(\n          type,\n          multiPolygonGeom.getFlatCoordinates(),\n          multiPolygonGeom.getEndss(),\n          feature,\n          getUid(feature),\n          multiPolygonGeom.getStride(),\n        );\n        break;\n      }\n      case 'MultiLineString': {\n        const multiLineGeom =\n          /** @type {import(\"../../geom.js\").MultiLineString|RenderFeature} */ (\n            geometry\n          );\n        this.addCoordinates_(\n          type,\n          multiLineGeom.getFlatCoordinates(),\n          multiLineGeom.getEnds(),\n          feature,\n          getUid(feature),\n          multiLineGeom.getStride(),\n        );\n        break;\n      }\n      case 'MultiPoint': {\n        const multiPointGeom =\n          /** @type {import(\"../../geom.js\").MultiPoint|RenderFeature} */ (\n            geometry\n          );\n        this.addCoordinates_(\n          type,\n          multiPointGeom.getFlatCoordinates(),\n          null,\n          feature,\n          getUid(feature),\n          multiPointGeom.getStride(),\n        );\n        break;\n      }\n      case 'Polygon': {\n        const polygonGeom =\n          /** @type {import(\"../../geom.js\").Polygon|RenderFeature} */ (\n            geometry\n          );\n        this.addCoordinates_(\n          type,\n          polygonGeom.getFlatCoordinates(),\n          polygonGeom.getEnds(),\n          feature,\n          getUid(feature),\n          polygonGeom.getStride(),\n        );\n        break;\n      }\n      case 'Point': {\n        const pointGeom = /** @type {import(\"../../geom.js\").Point} */ (\n          geometry\n        );\n        this.addCoordinates_(\n          type,\n          pointGeom.getFlatCoordinates(),\n          null,\n          feature,\n          getUid(feature),\n          pointGeom.getStride(),\n        );\n        break;\n      }\n      case 'LineString':\n      case 'LinearRing': {\n        const lineGeom = /** @type {import(\"../../geom.js\").LineString} */ (\n          geometry\n        );\n\n        const stride = lineGeom.getStride();\n\n        this.addCoordinates_(\n          type,\n          lineGeom.getFlatCoordinates(),\n          null,\n          feature,\n          getUid(feature),\n          stride,\n          lineGeom.getLayout?.(),\n        );\n        break;\n      }\n      default:\n      // pass\n    }\n  }\n\n  /**\n   * @param {GeometryType} type Geometry type\n   * @param {Array<number>} flatCoords Flat coordinates\n   * @param {Array<number> | Array<Array<number>> | null} ends Coordinate ends\n   * @param {Feature|RenderFeature} feature Feature\n   * @param {string} featureUid Feature uid\n   * @param {number} stride Stride\n   * @param {import('../../geom/Geometry.js').GeometryLayout} [layout] Layout\n   * @private\n   */\n  addCoordinates_(type, flatCoords, ends, feature, featureUid, stride, layout) {\n    /** @type {number} */\n    let verticesCount;\n    switch (type) {\n      case 'MultiPolygon': {\n        const multiPolygonEndss = /** @type {Array<Array<number>>} */ (ends);\n        for (let i = 0, ii = multiPolygonEndss.length; i < ii; i++) {\n          let polygonEnds = multiPolygonEndss[i];\n          const prevPolygonEnds = i > 0 ? multiPolygonEndss[i - 1] : null;\n          const startIndex = prevPolygonEnds\n            ? prevPolygonEnds[prevPolygonEnds.length - 1]\n            : 0;\n          const endIndex = polygonEnds[polygonEnds.length - 1];\n          polygonEnds =\n            startIndex > 0\n              ? polygonEnds.map((end) => end - startIndex)\n              : polygonEnds;\n          this.addCoordinates_(\n            'Polygon',\n            flatCoords.slice(startIndex, endIndex),\n            polygonEnds,\n            feature,\n            featureUid,\n            stride,\n            layout,\n          );\n        }\n        break;\n      }\n      case 'MultiLineString': {\n        const multiLineEnds = /** @type {Array<number>} */ (ends);\n        for (let i = 0, ii = multiLineEnds.length; i < ii; i++) {\n          const startIndex = i > 0 ? multiLineEnds[i - 1] : 0;\n          this.addCoordinates_(\n            'LineString',\n            flatCoords.slice(startIndex, multiLineEnds[i]),\n            null,\n            feature,\n            featureUid,\n            stride,\n            layout,\n          );\n        }\n        break;\n      }\n      case 'MultiPoint':\n        for (let i = 0, ii = flatCoords.length; i < ii; i += stride) {\n          this.addCoordinates_(\n            'Point',\n            flatCoords.slice(i, i + 2),\n            null,\n            feature,\n            featureUid,\n            null,\n            null,\n          );\n        }\n        break;\n      case 'Polygon': {\n        const polygonEnds = /** @type {Array<number>} */ (ends);\n        if (feature instanceof RenderFeature) {\n          const multiPolygonEnds = inflateEnds(flatCoords, polygonEnds);\n          if (multiPolygonEnds.length > 1) {\n            this.addCoordinates_(\n              'MultiPolygon',\n              flatCoords,\n              multiPolygonEnds,\n              feature,\n              featureUid,\n              stride,\n              layout,\n            );\n            return;\n          }\n        }\n        if (!this.polygonBatch.entries[featureUid]) {\n          this.polygonBatch.entries[featureUid] = this.addRefToEntry_(\n            featureUid,\n            {\n              feature: feature,\n              flatCoordss: [],\n              verticesCount: 0,\n              ringsCount: 0,\n              ringsVerticesCounts: [],\n            },\n          );\n        }\n        verticesCount = flatCoords.length / stride;\n        const ringsCount = ends.length;\n        const ringsVerticesCount = ends.map((end, ind, arr) =>\n          ind > 0 ? (end - arr[ind - 1]) / stride : end / stride,\n        );\n        this.polygonBatch.verticesCount += verticesCount;\n        this.polygonBatch.ringsCount += ringsCount;\n        this.polygonBatch.geometriesCount++;\n        this.polygonBatch.entries[featureUid].flatCoordss.push(\n          getFlatCoordinatesXY(flatCoords, stride),\n        );\n        this.polygonBatch.entries[featureUid].ringsVerticesCounts.push(\n          ringsVerticesCount,\n        );\n        this.polygonBatch.entries[featureUid].verticesCount += verticesCount;\n        this.polygonBatch.entries[featureUid].ringsCount += ringsCount;\n        for (let i = 0, ii = polygonEnds.length; i < ii; i++) {\n          const startIndex = i > 0 ? polygonEnds[i - 1] : 0;\n          this.addCoordinates_(\n            'LinearRing',\n            flatCoords.slice(startIndex, polygonEnds[i]),\n            null,\n            feature,\n            featureUid,\n            stride,\n            layout,\n          );\n        }\n        break;\n      }\n      case 'Point':\n        if (!this.pointBatch.entries[featureUid]) {\n          this.pointBatch.entries[featureUid] = this.addRefToEntry_(\n            featureUid,\n            {\n              feature: feature,\n              flatCoordss: [],\n            },\n          );\n        }\n        this.pointBatch.geometriesCount++;\n        this.pointBatch.entries[featureUid].flatCoordss.push(flatCoords);\n        break;\n      case 'LineString':\n      case 'LinearRing':\n        if (!this.lineStringBatch.entries[featureUid]) {\n          this.lineStringBatch.entries[featureUid] = this.addRefToEntry_(\n            featureUid,\n            {\n              feature: feature,\n              flatCoordss: [],\n              verticesCount: 0,\n            },\n          );\n        }\n        verticesCount = flatCoords.length / stride;\n        this.lineStringBatch.verticesCount += verticesCount;\n        this.lineStringBatch.geometriesCount++;\n        this.lineStringBatch.entries[featureUid].flatCoordss.push(\n          getFlatCoordinatesXYM(flatCoords, stride, layout),\n        );\n        this.lineStringBatch.entries[featureUid].verticesCount += verticesCount;\n        break;\n      default:\n      // pass\n    }\n  }\n\n  /**\n   * @param {string} featureUid Feature uid\n   * @param {GeometryBatchItem} entry The entry to add\n   * @return {GeometryBatchItem} the added entry\n   * @private\n   */\n  addRefToEntry_(featureUid, entry) {\n    const currentRef = this.uidToRef_.get(featureUid);\n\n    // the ref starts at 1 to distinguish from white color (no feature)\n    const ref =\n      currentRef || this.freeGlobalRef_.pop() || ++this.globalCounter_;\n    entry.ref = ref;\n    if (!currentRef) {\n      this.refToFeature_.set(ref, entry.feature);\n      this.uidToRef_.set(featureUid, ref);\n    }\n    return entry;\n  }\n\n  /**\n   * Return a ref to the pool of available refs.\n   * @param {number} ref the ref to return\n   * @param {string} featureUid the feature uid\n   * @private\n   */\n  removeRef_(ref, featureUid) {\n    if (!ref) {\n      throw new Error('This feature has no ref: ' + featureUid);\n    }\n    this.refToFeature_.delete(ref);\n    this.uidToRef_.delete(featureUid);\n    this.freeGlobalRef_.push(ref);\n  }\n\n  /**\n   * @param {Feature|RenderFeature} feature Feature\n   * @param {import(\"../../proj.js\").TransformFunction} [projectionTransform] Projection transform.\n   */\n  changeFeature(feature, projectionTransform) {\n    // the feature is not present in the batch; do not add it to avoid unexpected behaviors\n    if (!this.uidToRef_.get(getUid(feature))) {\n      return;\n    }\n    this.removeFeature(feature);\n    let geometry = feature.getGeometry();\n    if (!geometry) {\n      return;\n    }\n    if (projectionTransform) {\n      geometry = geometry.clone();\n      geometry.applyTransform(projectionTransform);\n    }\n    this.addGeometry_(geometry, feature);\n  }\n\n  /**\n   * @param {Feature|RenderFeature} feature Feature\n   */\n  removeFeature(feature) {\n    let entry = this.clearFeatureEntryInPointBatch_(feature);\n    entry = this.clearFeatureEntryInPolygonBatch_(feature) || entry;\n    entry = this.clearFeatureEntryInLineStringBatch_(feature) || entry;\n    if (entry) {\n      this.removeRef_(entry.ref, getUid(entry.feature));\n    }\n  }\n\n  clear() {\n    this.polygonBatch.entries = {};\n    this.polygonBatch.geometriesCount = 0;\n    this.polygonBatch.verticesCount = 0;\n    this.polygonBatch.ringsCount = 0;\n    this.lineStringBatch.entries = {};\n    this.lineStringBatch.geometriesCount = 0;\n    this.lineStringBatch.verticesCount = 0;\n    this.pointBatch.entries = {};\n    this.pointBatch.geometriesCount = 0;\n    this.globalCounter_ = 0;\n    this.freeGlobalRef_ = [];\n    this.refToFeature_.clear();\n    this.uidToRef_.clear();\n  }\n\n  /**\n   * Resolve the feature associated to a ref.\n   * @param {number} ref Hit detected ref\n   * @return {Feature|RenderFeature} feature\n   */\n  getFeatureFromRef(ref) {\n    return this.refToFeature_.get(ref);\n  }\n\n  isEmpty() {\n    return this.globalCounter_ === 0;\n  }\n\n  /**\n   * Will return a new instance of this class that only contains the features\n   * for which the provided callback returned true\n   * @param {function((Feature|RenderFeature)): boolean} featureFilter Feature filter callback\n   * @return {MixedGeometryBatch} Filtered geometry batch\n   */\n  filter(featureFilter) {\n    const filtered = new MixedGeometryBatch();\n    filtered.globalCounter_ = this.globalCounter_;\n    filtered.uidToRef_ = this.uidToRef_;\n    filtered.refToFeature_ = this.refToFeature_;\n    let empty = true;\n    for (const feature of this.refToFeature_.values()) {\n      if (featureFilter(feature)) {\n        filtered.addFeature(feature);\n        empty = false;\n      }\n    }\n    // no feature was added at all; simply return an empty batch for consistency downstream\n    if (empty) {\n      return new MixedGeometryBatch();\n    }\n    return filtered;\n  }\n}\n\n/**\n * @param {Array<number>} flatCoords Flat coords\n * @param {number} stride Stride\n * @return {Array<number>} Flat coords with only XY components\n */\nfunction getFlatCoordinatesXY(flatCoords, stride) {\n  if (stride === 2) {\n    return flatCoords;\n  }\n  return flatCoords.filter((v, i) => i % stride < 2);\n}\n\n/**\n * @param {Array<number>} flatCoords Flat coords\n * @param {number} stride Stride\n * @param {string} layout Layout\n * @return {Array<number>} Flat coords with only XY components\n */\nfunction getFlatCoordinatesXYM(flatCoords, stride, layout) {\n  if (stride === 3 && layout === 'XYM') {\n    return flatCoords;\n  }\n  // this is XYZM layout\n  if (stride === 4) {\n    return flatCoords.filter((v, i) => i % stride !== 2);\n  }\n  // this is XYZ layout\n  if (stride === 3) {\n    return flatCoords.map((v, i) => (i % stride !== 2 ? v : 0));\n  }\n  // this is XY layout\n  return new Array(flatCoords.length * 1.5)\n    .fill(0)\n    .map((v, i) => (i % 3 === 2 ? 0 : flatCoords[Math.round(i / 1.5)]));\n}\n\nexport default MixedGeometryBatch;\n","/**\n * @module ol/render/webgl/renderinstructions\n */\nimport {UNDEFINED_PROP_VALUE} from '../../expr/gpu.js';\nimport {transform2D} from '../../geom/flat/transform.js';\nimport {apply as applyTransform} from '../../transform.js';\n\n/**\n * @param {Float32Array} renderInstructions Render instructions\n * @param {import('./VectorStyleRenderer.js').AttributeDefinitions} customAttributes Custom attributes\n * @param {import(\"./MixedGeometryBatch.js\").GeometryBatchItem} batchEntry Batch item\n * @param {number} currentIndex Current index\n * @return {number} The amount of values pushed\n */\nfunction pushCustomAttributesInRenderInstructions(\n  renderInstructions,\n  customAttributes,\n  batchEntry,\n  currentIndex,\n) {\n  let shift = 0;\n  for (const key in customAttributes) {\n    const attr = customAttributes[key];\n    const value = attr.callback.call(batchEntry, batchEntry.feature);\n    let first = value?.[0] ?? value;\n    if (first === UNDEFINED_PROP_VALUE) {\n      console.warn('The \"has\" operator might return false positives.'); // eslint-disable-line no-console\n    }\n    if (first === undefined) {\n      first = UNDEFINED_PROP_VALUE;\n    } else if (first === null) {\n      first = 0;\n    }\n    renderInstructions[currentIndex + shift++] = first;\n    if (!attr.size || attr.size === 1) {\n      continue;\n    }\n    renderInstructions[currentIndex + shift++] = value[1];\n    if (attr.size < 3) {\n      continue;\n    }\n    renderInstructions[currentIndex + shift++] = value[2];\n    if (attr.size < 4) {\n      continue;\n    }\n    renderInstructions[currentIndex + shift++] = value[3];\n  }\n  return shift;\n}\n\n/**\n * @param {import('./VectorStyleRenderer.js').AttributeDefinitions} customAttributes Custom attributes\n * @return {number} Cumulated size of all attributes\n */\nexport function getCustomAttributesSize(customAttributes) {\n  return Object.keys(customAttributes).reduce(\n    (prev, curr) => prev + (customAttributes[curr].size || 1),\n    0,\n  );\n}\n\n/**\n * Render instructions for lines are structured like so:\n * [ x0, y0, customAttr0, ... , xN, yN, customAttrN ]\n * @param {import(\"./MixedGeometryBatch.js\").PointGeometryBatch} batch Point geometry batch\n * @param {Float32Array} renderInstructions Render instructions\n * @param {import('./VectorStyleRenderer.js').AttributeDefinitions} customAttributes Custom attributes\n * @param {import(\"../../transform.js\").Transform} transform Transform to apply to coordinates\n * @return {Float32Array} Generated render instructions\n */\nexport function generatePointRenderInstructions(\n  batch,\n  renderInstructions,\n  customAttributes,\n  transform,\n) {\n  // here we anticipate the amount of render instructions for points:\n  // 2 instructions per vertex for position (x and y)\n  // + 1 instruction per vertex per custom attributes\n  const totalInstructionsCount =\n    (2 + getCustomAttributesSize(customAttributes)) * batch.geometriesCount;\n  if (\n    !renderInstructions ||\n    renderInstructions.length !== totalInstructionsCount\n  ) {\n    renderInstructions = new Float32Array(totalInstructionsCount);\n  }\n\n  // loop on features to fill the render instructions\n  const tmpCoords = [];\n  let renderIndex = 0;\n  for (const featureUid in batch.entries) {\n    const batchEntry = batch.entries[featureUid];\n    for (let i = 0, ii = batchEntry.flatCoordss.length; i < ii; i++) {\n      tmpCoords[0] = batchEntry.flatCoordss[i][0];\n      tmpCoords[1] = batchEntry.flatCoordss[i][1];\n      applyTransform(transform, tmpCoords);\n\n      renderInstructions[renderIndex++] = tmpCoords[0];\n      renderInstructions[renderIndex++] = tmpCoords[1];\n      renderIndex += pushCustomAttributesInRenderInstructions(\n        renderInstructions,\n        customAttributes,\n        batchEntry,\n        renderIndex,\n      );\n    }\n  }\n  return renderInstructions;\n}\n\n/**\n * Render instructions for lines are structured like so:\n * [ customAttr0, ... , customAttrN, numberOfVertices0, x0, y0, ... , xN, yN, numberOfVertices1, ... ]\n * @param {import(\"./MixedGeometryBatch.js\").LineStringGeometryBatch} batch Line String geometry batch\n * @param {Float32Array} renderInstructions Render instructions\n * @param {import('./VectorStyleRenderer.js').AttributeDefinitions} customAttributes Custom attributes\n * @param {import(\"../../transform.js\").Transform} transform Transform to apply to coordinates\n * @return {Float32Array} Generated render instructions\n */\nexport function generateLineStringRenderInstructions(\n  batch,\n  renderInstructions,\n  customAttributes,\n  transform,\n) {\n  // here we anticipate the amount of render instructions for lines:\n  // 3 instructions per vertex for position (x, y and m)\n  // + 1 instruction per line per custom attributes\n  // + 1 instruction per line (for vertices count)\n  const totalInstructionsCount =\n    3 * batch.verticesCount +\n    (1 + getCustomAttributesSize(customAttributes)) * batch.geometriesCount;\n  if (\n    !renderInstructions ||\n    renderInstructions.length !== totalInstructionsCount\n  ) {\n    renderInstructions = new Float32Array(totalInstructionsCount);\n  }\n\n  // loop on features to fill the render instructions\n  const flatCoords = [];\n  let renderIndex = 0;\n  for (const featureUid in batch.entries) {\n    const batchEntry = batch.entries[featureUid];\n    for (let i = 0, ii = batchEntry.flatCoordss.length; i < ii; i++) {\n      flatCoords.length = batchEntry.flatCoordss[i].length;\n      transform2D(\n        batchEntry.flatCoordss[i],\n        0,\n        flatCoords.length,\n        3,\n        transform,\n        flatCoords,\n        3,\n      );\n      renderIndex += pushCustomAttributesInRenderInstructions(\n        renderInstructions,\n        customAttributes,\n        batchEntry,\n        renderIndex,\n      );\n\n      // vertices count\n      renderInstructions[renderIndex++] = flatCoords.length / 3;\n\n      // looping on points for positions\n      for (let j = 0, jj = flatCoords.length; j < jj; j += 3) {\n        renderInstructions[renderIndex++] = flatCoords[j];\n        renderInstructions[renderIndex++] = flatCoords[j + 1];\n        renderInstructions[renderIndex++] = flatCoords[j + 2];\n      }\n    }\n  }\n  return renderInstructions;\n}\n\n/**\n * Render instructions for polygons are structured like so:\n * [ customAttr0, ..., customAttrN, numberOfRings, numberOfVerticesInRing0, ..., numberOfVerticesInRingN, x0, y0, ..., xN, yN, numberOfRings,... ]\n * @param {import(\"./MixedGeometryBatch.js\").PolygonGeometryBatch} batch Polygon geometry batch\n * @param {Float32Array} renderInstructions Render instructions\n * @param {import('./VectorStyleRenderer.js').AttributeDefinitions} customAttributes Custom attributes\n * @param {import(\"../../transform.js\").Transform} transform Transform to apply to coordinates\n * @return {Float32Array} Generated render instructions\n */\nexport function generatePolygonRenderInstructions(\n  batch,\n  renderInstructions,\n  customAttributes,\n  transform,\n) {\n  // here we anticipate the amount of render instructions for polygons:\n  // 2 instructions per vertex for position (x and y)\n  // + 1 instruction per polygon per custom attributes\n  // + 1 instruction per polygon (for vertices count in polygon)\n  // + 1 instruction per ring (for vertices count in ring)\n  const totalInstructionsCount =\n    2 * batch.verticesCount +\n    (1 + getCustomAttributesSize(customAttributes)) * batch.geometriesCount +\n    batch.ringsCount;\n  if (\n    !renderInstructions ||\n    renderInstructions.length !== totalInstructionsCount\n  ) {\n    renderInstructions = new Float32Array(totalInstructionsCount);\n  }\n\n  // loop on features to fill the render instructions\n  const flatCoords = [];\n  let renderIndex = 0;\n  for (const featureUid in batch.entries) {\n    const batchEntry = batch.entries[featureUid];\n    for (let i = 0, ii = batchEntry.flatCoordss.length; i < ii; i++) {\n      flatCoords.length = batchEntry.flatCoordss[i].length;\n      transform2D(\n        batchEntry.flatCoordss[i],\n        0,\n        flatCoords.length,\n        2,\n        transform,\n        flatCoords,\n      );\n      renderIndex += pushCustomAttributesInRenderInstructions(\n        renderInstructions,\n        customAttributes,\n        batchEntry,\n        renderIndex,\n      );\n\n      // ring count\n      renderInstructions[renderIndex++] =\n        batchEntry.ringsVerticesCounts[i].length;\n\n      // vertices count in each ring\n      for (\n        let j = 0, jj = batchEntry.ringsVerticesCounts[i].length;\n        j < jj;\n        j++\n      ) {\n        renderInstructions[renderIndex++] =\n          batchEntry.ringsVerticesCounts[i][j];\n      }\n\n      // looping on points for positions\n      for (let j = 0, jj = flatCoords.length; j < jj; j += 2) {\n        renderInstructions[renderIndex++] = flatCoords[j];\n        renderInstructions[renderIndex++] = flatCoords[j + 1];\n      }\n    }\n  }\n  return renderInstructions;\n}\n","/**\n * @module ol/render/webgl/VectorStyleRenderer\n */\nimport {buildExpression, newEvaluationContext} from '../../expr/cpu.js';\nimport {\n  BooleanType,\n  computeGeometryType,\n  newParsingContext,\n} from '../../expr/expression.js';\nimport {\n  create as createTransform,\n  makeInverse as makeInverseTransform,\n} from '../../transform.js';\nimport WebGLArrayBuffer from '../../webgl/Buffer.js';\nimport {AttributeType} from '../../webgl/Helper.js';\nimport {ARRAY_BUFFER, DYNAMIC_DRAW, ELEMENT_ARRAY_BUFFER} from '../../webgl.js';\nimport {create as createWebGLWorker} from '../../worker/webgl.js';\nimport {WebGLWorkerMessageType} from './constants.js';\nimport {colorEncodeId} from './encodeUtil.js';\nimport {\n  generateLineStringRenderInstructions,\n  generatePointRenderInstructions,\n  generatePolygonRenderInstructions,\n  getCustomAttributesSize,\n} from './renderinstructions.js';\nimport {parseLiteralStyle} from './style.js';\n\nconst tmpColor = [];\n/** @type {Worker|undefined} */\nlet WEBGL_WORKER;\nfunction getWebGLWorker() {\n  if (!WEBGL_WORKER) {\n    WEBGL_WORKER = createWebGLWorker();\n  }\n  return WEBGL_WORKER;\n}\nlet workerMessageCounter = 0;\n\n/**\n * Names of attributes made available to the vertex shader.\n * Please note: changing these *will* break custom shaders!\n * @enum {string}\n */\nexport const Attributes = {\n  POSITION: 'a_position',\n  INDEX: 'a_index',\n  SEGMENT_START: 'a_segmentStart',\n  SEGMENT_END: 'a_segmentEnd',\n  MEASURE_START: 'a_measureStart',\n  MEASURE_END: 'a_measureEnd',\n  PARAMETERS: 'a_parameters',\n  JOIN_ANGLES: 'a_joinAngles',\n  DISTANCE: 'a_distance',\n};\n\n/**\n * @typedef {Object} AttributeDefinition A description of a custom attribute to be passed on to the GPU, with a value different\n * for each feature.\n * @property {number} [size] Amount of numerical values composing the attribute, either 1, 2, 3 or 4; in case size is > 1, the return value\n * of the callback should be an array; if unspecified, assumed to be a single float value\n * @property {function(this:import(\"./MixedGeometryBatch.js\").GeometryBatchItem, import(\"../../Feature\").FeatureLike):number|Array<number>} callback This callback computes the numerical value of the\n * attribute for a given feature.\n */\n\n/**\n * @typedef {Object<string, AttributeDefinition>} AttributeDefinitions\n * @typedef {Object<string, import(\"../../webgl/Helper\").UniformValue>} UniformDefinitions\n */\n\n/**\n * @typedef {Object} WebGLBuffers\n * @property {Array<WebGLArrayBuffer>} polygonBuffers Array containing indices and vertices buffers for polygons\n * @property {Array<WebGLArrayBuffer>} lineStringBuffers Array containing indices and vertices buffers for line strings\n * @property {Array<WebGLArrayBuffer>} pointBuffers Array containing indices and vertices buffers for points\n * @property {import(\"../../transform.js\").Transform} invertVerticesTransform Inverse of the transform applied when generating buffers\n */\n\n/**\n * @typedef {Object} RenderInstructions\n * @property {Float32Array|null} polygonInstructions Polygon instructions; null if nothing to render\n * @property {Float32Array|null} lineStringInstructions LineString instructions; null if nothing to render\n * @property {Float32Array|null} pointInstructions Point instructions; null if nothing to render\n */\n\n/**\n * @typedef {Object} ShaderProgram An object containing both shaders (vertex and fragment)\n * @property {string} vertex Vertex shader source\n * @property {string} fragment Fragment shader source\n */\n\n/**\n * @typedef {Object} AsShaders\n * @property {import(\"./ShaderBuilder.js\").ShaderBuilder} builder Shader builder with the appropriate presets.\n * @property {AttributeDefinitions} [attributes] Custom attributes made available in the vertex shaders.\n * Default shaders rely on the attributes in {@link Attributes}.\n * @property {UniformDefinitions} [uniforms] Additional uniforms usable in shaders.\n */\n\n/**\n * @typedef {Object} AsRule\n * @property {import('../../style/flat.js').FlatStyle} style Style\n * @property {import(\"../../expr/expression.js\").EncodedExpression} [filter] Filter\n */\n\n/**\n * @typedef {AsRule|AsShaders} VectorStyle\n */\n\n/**\n * @classdesc This class is responsible for:\n * 1. generate WebGL buffers according to a provided style, using a MixedGeometryBatch as input\n * 2. rendering geometries contained in said buffers\n *\n * A layer renderer will typically maintain several of these in order to have several styles rendered separately.\n *\n * A VectorStyleRenderer instance can be created either from a literal style or from shaders using either\n * `VectorStyleRenderer.fromStyle` or `VectorStyleRenderer.fromShaders`. The shaders should not be provided explicitly\n * but instead as a preconfigured ShaderBuilder instance.\n *\n * The `generateBuffers` method returns a promise resolving to WebGL buffers that are intended to be rendered by the\n * same renderer.\n */\nclass VectorStyleRenderer {\n  /**\n   * @param {VectorStyle} styleOrShaders Literal style or custom shaders\n   * @param {import('../../style/flat.js').StyleVariables} variables Style variables\n   * @param {import('../../webgl/Helper.js').default} helper Helper\n   * @param {boolean} [enableHitDetection] Whether to enable the hit detection (needs compatible shader)\n   * @param {import(\"../../expr/expression.js\").ExpressionValue} [filter] Optional filter expression\n   */\n  constructor(styleOrShaders, variables, helper, enableHitDetection, filter) {\n    /**\n     * @private\n     * @type {import('../../webgl/Helper.js').default}\n     */\n    this.helper_;\n\n    /**\n     * @private\n     */\n    this.hitDetectionEnabled_ = !!enableHitDetection;\n\n    let asShaders = /** @type {AsShaders} */ (styleOrShaders);\n    const isShaders = 'builder' in styleOrShaders;\n    if (!isShaders) {\n      const asRule = /** @type {AsRule} */ (styleOrShaders);\n      const parseResult = parseLiteralStyle(\n        asRule.style,\n        variables,\n        asRule.filter,\n      );\n      asShaders = {\n        builder: parseResult.builder,\n        attributes: parseResult.attributes,\n        uniforms: parseResult.uniforms,\n      };\n    }\n\n    /**\n     * @private\n     * @type {WebGLProgram}\n     */\n    this.fillProgram_;\n\n    /**\n     * @private\n     * @type {WebGLProgram}\n     */\n    this.strokeProgram_;\n\n    /**\n     * @private\n     * @type {WebGLProgram}\n     */\n    this.symbolProgram_;\n\n    /**\n     * @type {boolean}\n     * @private\n     */\n    this.hasFill_ = !!asShaders.builder.getFillVertexShader();\n    if (this.hasFill_) {\n      /**\n       * @private\n       */\n      this.fillVertexShader_ = asShaders.builder.getFillVertexShader();\n      /**\n       * @private\n       */\n      this.fillFragmentShader_ = asShaders.builder.getFillFragmentShader();\n    }\n\n    /**\n     * @type {boolean}\n     * @private\n     */\n    this.hasStroke_ = !!asShaders.builder.getStrokeVertexShader();\n    if (this.hasStroke_) {\n      /**\n       * @private\n       */\n      this.strokeVertexShader_ = asShaders.builder.getStrokeVertexShader();\n      /**\n       * @private\n       */\n      this.strokeFragmentShader_ = asShaders.builder.getStrokeFragmentShader();\n    }\n\n    /**\n     * @type {boolean}\n     * @private\n     */\n    this.hasSymbol_ = !!asShaders.builder.getSymbolVertexShader();\n    if (this.hasSymbol_) {\n      /**\n       * @private\n       */\n      this.symbolVertexShader_ = asShaders.builder.getSymbolVertexShader();\n      /**\n       * @private\n       */\n      this.symbolFragmentShader_ = asShaders.builder.getSymbolFragmentShader();\n    }\n\n    /**\n     * @type {function(import('../../Feature.js').FeatureLike): boolean}\n     * @private\n     */\n    this.featureFilter_ = null;\n    if (filter) {\n      this.featureFilter_ = this.computeFeatureFilter(filter);\n    }\n\n    const hitDetectionAttributes = this.hitDetectionEnabled_\n      ? {\n          hitColor: {\n            callback() {\n              return colorEncodeId(this.ref, tmpColor);\n            },\n            size: 4,\n          },\n        }\n      : {};\n\n    /**\n     * @private\n     */\n    this.customAttributes_ = Object.assign(\n      {},\n      hitDetectionAttributes,\n      asShaders.attributes,\n    );\n    /**\n     * @private\n     */\n    this.uniforms_ = asShaders.uniforms;\n\n    const customAttributesDesc = Object.entries(this.customAttributes_).map(\n      ([name, value]) => ({\n        name: `a_${name}`,\n        size: value.size || 1,\n        type: AttributeType.FLOAT,\n      }),\n    );\n    /**\n     * @type {Array<import('../../webgl/Helper.js').AttributeDescription>}\n     * @private\n     */\n    this.polygonAttributesDesc_ = [\n      {\n        name: Attributes.POSITION,\n        size: 2,\n        type: AttributeType.FLOAT,\n      },\n      ...customAttributesDesc,\n    ];\n    /**\n     * @type {Array<import('../../webgl/Helper.js').AttributeDescription>}\n     * @private\n     */\n    this.lineStringAttributesDesc_ = [\n      {\n        name: Attributes.SEGMENT_START,\n        size: 2,\n        type: AttributeType.FLOAT,\n      },\n      {\n        name: Attributes.MEASURE_START,\n        size: 1,\n        type: AttributeType.FLOAT,\n      },\n      {\n        name: Attributes.SEGMENT_END,\n        size: 2,\n        type: AttributeType.FLOAT,\n      },\n      {\n        name: Attributes.MEASURE_END,\n        size: 1,\n        type: AttributeType.FLOAT,\n      },\n      {\n        name: Attributes.JOIN_ANGLES,\n        size: 2,\n        type: AttributeType.FLOAT,\n      },\n      {\n        name: Attributes.DISTANCE,\n        size: 1,\n        type: AttributeType.FLOAT,\n      },\n      {\n        name: Attributes.PARAMETERS,\n        size: 1,\n        type: AttributeType.FLOAT,\n      },\n      ...customAttributesDesc,\n    ];\n    /**\n     * @type {Array<import('../../webgl/Helper.js').AttributeDescription>}\n     * @private\n     */\n    this.pointAttributesDesc_ = [\n      {\n        name: Attributes.POSITION,\n        size: 2,\n        type: AttributeType.FLOAT,\n      },\n      {\n        name: Attributes.INDEX,\n        size: 1,\n        type: AttributeType.FLOAT,\n      },\n      ...customAttributesDesc,\n    ];\n\n    this.setHelper(helper);\n  }\n\n  /**\n   * Will apply the style filter when generating geometry batches (if it can be evaluated outside a map context)\n   * @param {import(\"../../expr/expression.js\").ExpressionValue} filter Style filter\n   * @return {function(import('../../Feature.js').FeatureLike): boolean} Feature filter\n   * @private\n   */\n  computeFeatureFilter(filter) {\n    const parsingContext = newParsingContext();\n    /**\n     * @type {import('../../expr/cpu.js').ExpressionEvaluator}\n     */\n    let compiled;\n    try {\n      compiled = buildExpression(filter, BooleanType, parsingContext);\n    } catch {\n      // filter expression failed to compile for CPU: ignore it\n      return null;\n    }\n\n    // do not apply the filter if it depends on map state (e.g. zoom level) or any variable\n    if (parsingContext.mapState || parsingContext.variables.size > 0) {\n      return null;\n    }\n\n    const evalContext = newEvaluationContext();\n    return (feature) => {\n      evalContext.properties = feature.getPropertiesInternal();\n      if (parsingContext.featureId) {\n        const id = feature.getId();\n        if (id !== undefined) {\n          evalContext.featureId = id;\n        } else {\n          evalContext.featureId = null;\n        }\n      }\n      evalContext.geometryType = computeGeometryType(feature.getGeometry());\n      return /** @type {boolean} */ (compiled(evalContext));\n    };\n  }\n\n  /**\n   * @param {import('./MixedGeometryBatch.js').default} geometryBatch Geometry batch\n   * @param {import(\"../../transform.js\").Transform} transform Transform to apply to coordinates\n   * @return {Promise<WebGLBuffers|null>} A promise resolving to WebGL buffers; returns null if buffers are empty\n   */\n  async generateBuffers(geometryBatch, transform) {\n    let filteredBatch = geometryBatch;\n    if (this.featureFilter_) {\n      filteredBatch = filteredBatch.filter(this.featureFilter_);\n      if (filteredBatch.isEmpty()) {\n        return null;\n      }\n    }\n    const renderInstructions = this.generateRenderInstructions_(\n      filteredBatch,\n      transform,\n    );\n    const [polygonBuffers, lineStringBuffers, pointBuffers] = await Promise.all(\n      [\n        this.generateBuffersForType_(\n          renderInstructions.polygonInstructions,\n          'Polygon',\n          transform,\n        ),\n        this.generateBuffersForType_(\n          renderInstructions.lineStringInstructions,\n          'LineString',\n          transform,\n        ),\n        this.generateBuffersForType_(\n          renderInstructions.pointInstructions,\n          'Point',\n          transform,\n        ),\n      ],\n    );\n    // also return the inverse of the transform that was applied when generating buffers\n    const invertVerticesTransform = makeInverseTransform(\n      createTransform(),\n      transform,\n    );\n    return {\n      polygonBuffers: polygonBuffers,\n      lineStringBuffers: lineStringBuffers,\n      pointBuffers: pointBuffers,\n      invertVerticesTransform: invertVerticesTransform,\n    };\n  }\n\n  /**\n   * @param {import('./MixedGeometryBatch.js').default} geometryBatch Geometry batch\n   * @param {import(\"../../transform.js\").Transform} transform Transform to apply to coordinates\n   * @return {RenderInstructions} Render instructions\n   * @private\n   */\n  generateRenderInstructions_(geometryBatch, transform) {\n    const polygonInstructions = this.hasFill_\n      ? generatePolygonRenderInstructions(\n          geometryBatch.polygonBatch,\n          new Float32Array(0),\n          this.customAttributes_,\n          transform,\n        )\n      : null;\n    const lineStringInstructions = this.hasStroke_\n      ? generateLineStringRenderInstructions(\n          geometryBatch.lineStringBatch,\n          new Float32Array(0),\n          this.customAttributes_,\n          transform,\n        )\n      : null;\n    const pointInstructions = this.hasSymbol_\n      ? generatePointRenderInstructions(\n          geometryBatch.pointBatch,\n          new Float32Array(0),\n          this.customAttributes_,\n          transform,\n        )\n      : null;\n\n    return {\n      polygonInstructions,\n      lineStringInstructions,\n      pointInstructions,\n    };\n  }\n\n  /**\n   * @param {Float32Array|null} renderInstructions Render instructions\n   * @param {import(\"../../geom/Geometry.js\").Type} geometryType Geometry type\n   * @param {import(\"../../transform.js\").Transform} transform Transform to apply to coordinates\n   * @return {Promise<Array<WebGLArrayBuffer>>|null} Indices buffer and vertices buffer; null if nothing to render\n   * @private\n   */\n  generateBuffersForType_(renderInstructions, geometryType, transform) {\n    if (renderInstructions === null) {\n      return null;\n    }\n\n    const messageId = workerMessageCounter++;\n    let messageType;\n    switch (geometryType) {\n      case 'Polygon':\n        messageType = WebGLWorkerMessageType.GENERATE_POLYGON_BUFFERS;\n        break;\n      case 'LineString':\n        messageType = WebGLWorkerMessageType.GENERATE_LINE_STRING_BUFFERS;\n        break;\n      case 'Point':\n        messageType = WebGLWorkerMessageType.GENERATE_POINT_BUFFERS;\n        break;\n      default:\n      // pass\n    }\n\n    /** @type {import('./constants.js').WebGLWorkerGenerateBuffersMessage} */\n    const message = {\n      id: messageId,\n      type: messageType,\n      renderInstructions: renderInstructions.buffer,\n      renderInstructionsTransform: transform,\n      customAttributesSize: getCustomAttributesSize(this.customAttributes_),\n    };\n    const WEBGL_WORKER = getWebGLWorker();\n    WEBGL_WORKER.postMessage(message, [renderInstructions.buffer]);\n\n    // leave ownership of render instructions\n    renderInstructions = null;\n\n    return new Promise((resolve) => {\n      /**\n       * @param {*} event Event.\n       */\n      const handleMessage = (event) => {\n        const received = event.data;\n\n        // this is not the response to our request: skip\n        if (received.id !== messageId) {\n          return;\n        }\n\n        // we've received our response: stop listening\n        WEBGL_WORKER.removeEventListener('message', handleMessage);\n\n        // the helper has disposed in the meantime; the promise will not be resolved\n        if (!this.helper_.getGL()) {\n          return;\n        }\n\n        // copy & flush received buffers to GPU\n        const verticesBuffer = new WebGLArrayBuffer(\n          ARRAY_BUFFER,\n          DYNAMIC_DRAW,\n        ).fromArrayBuffer(received.vertexBuffer);\n        const indicesBuffer = new WebGLArrayBuffer(\n          ELEMENT_ARRAY_BUFFER,\n          DYNAMIC_DRAW,\n        ).fromArrayBuffer(received.indexBuffer);\n        this.helper_.flushBufferData(verticesBuffer);\n        this.helper_.flushBufferData(indicesBuffer);\n\n        resolve([indicesBuffer, verticesBuffer]);\n      };\n\n      WEBGL_WORKER.addEventListener('message', handleMessage);\n    });\n  }\n\n  /**\n   * Render the geometries in the given buffers.\n   * @param {WebGLBuffers} buffers WebGL Buffers to draw\n   * @param {import(\"../../Map.js\").FrameState} frameState Frame state\n   * @param {function(): void} preRenderCallback This callback will be called right before drawing, and can be used to set uniforms\n   */\n  render(buffers, frameState, preRenderCallback) {\n    this.hasFill_ &&\n      this.renderInternal_(\n        buffers.polygonBuffers[0],\n        buffers.polygonBuffers[1],\n        this.fillProgram_,\n        this.polygonAttributesDesc_,\n        frameState,\n        preRenderCallback,\n      );\n    this.hasStroke_ &&\n      this.renderInternal_(\n        buffers.lineStringBuffers[0],\n        buffers.lineStringBuffers[1],\n        this.strokeProgram_,\n        this.lineStringAttributesDesc_,\n        frameState,\n        preRenderCallback,\n      );\n    this.hasSymbol_ &&\n      this.renderInternal_(\n        buffers.pointBuffers[0],\n        buffers.pointBuffers[1],\n        this.symbolProgram_,\n        this.pointAttributesDesc_,\n        frameState,\n        preRenderCallback,\n      );\n  }\n\n  /**\n   * @param {WebGLArrayBuffer} indicesBuffer Indices buffer\n   * @param {WebGLArrayBuffer} verticesBuffer Vertices buffer\n   * @param {WebGLProgram} program Program\n   * @param {Array<import('../../webgl/Helper.js').AttributeDescription>} attributes Attribute descriptions\n   * @param {import(\"../../Map.js\").FrameState} frameState Frame state.\n   * @param {function(): void} preRenderCallback This callback will be called right before drawing, and can be used to set uniforms\n   * @private\n   */\n  renderInternal_(\n    indicesBuffer,\n    verticesBuffer,\n    program,\n    attributes,\n    frameState,\n    preRenderCallback,\n  ) {\n    const renderCount = indicesBuffer.getSize();\n    if (renderCount === 0) {\n      return;\n    }\n    this.helper_.useProgram(program, frameState);\n    this.helper_.bindBuffer(verticesBuffer);\n    this.helper_.bindBuffer(indicesBuffer);\n    this.helper_.enableAttributes(attributes);\n    preRenderCallback();\n    this.helper_.drawElements(0, renderCount);\n  }\n\n  /**\n   * @param {import('../../webgl/Helper.js').default} helper Helper\n   * @param {WebGLBuffers} buffers WebGL Buffers to reload if any\n   */\n  setHelper(helper, buffers = null) {\n    this.helper_ = helper;\n\n    if (this.hasFill_) {\n      this.fillProgram_ = this.helper_.getProgram(\n        this.fillFragmentShader_,\n        this.fillVertexShader_,\n      );\n    }\n    if (this.hasStroke_) {\n      this.strokeProgram_ = this.helper_.getProgram(\n        this.strokeFragmentShader_,\n        this.strokeVertexShader_,\n      );\n    }\n    if (this.hasSymbol_) {\n      this.symbolProgram_ = this.helper_.getProgram(\n        this.symbolFragmentShader_,\n        this.symbolVertexShader_,\n      );\n    }\n    this.helper_.addUniforms(this.uniforms_);\n\n    if (buffers) {\n      if (buffers.polygonBuffers) {\n        this.helper_.flushBufferData(buffers.polygonBuffers[0]);\n        this.helper_.flushBufferData(buffers.polygonBuffers[1]);\n      }\n      if (buffers.lineStringBuffers) {\n        this.helper_.flushBufferData(buffers.lineStringBuffers[0]);\n        this.helper_.flushBufferData(buffers.lineStringBuffers[1]);\n      }\n      if (buffers.pointBuffers) {\n        this.helper_.flushBufferData(buffers.pointBuffers[0]);\n        this.helper_.flushBufferData(buffers.pointBuffers[1]);\n      }\n    }\n  }\n}\n\nexport default VectorStyleRenderer;\n","/**\n * @module ol/renderer/webgl/VectorLayer\n */\nimport ViewHint from '../../ViewHint.js';\nimport {assert} from '../../asserts.js';\nimport {listen, unlistenByKey} from '../../events.js';\nimport {buffer, createEmpty, equals} from '../../extent.js';\nimport BaseVector from '../../layer/BaseVector.js';\nimport {\n  getTransformFromProjections,\n  getUserProjection,\n  toUserExtent,\n  toUserResolution,\n} from '../../proj.js';\nimport MixedGeometryBatch from '../../render/webgl/MixedGeometryBatch.js';\nimport VectorStyleRenderer from '../../render/webgl/VectorStyleRenderer.js';\nimport {colorDecodeId} from '../../render/webgl/encodeUtil.js';\nimport {breakDownFlatStyle} from '../../render/webgl/style.js';\nimport VectorEventType from '../../source/VectorEventType.js';\nimport {\n  apply as applyTransform,\n  create as createTransform,\n  makeInverse as makeInverseTransform,\n  multiply as multiplyTransform,\n  setFromArray as setFromTransform,\n  translate as translateTransform,\n} from '../../transform.js';\nimport {\n  create as createMat4,\n  fromTransform as mat4FromTransform,\n} from '../../vec/mat4.js';\nimport {DefaultUniform} from '../../webgl/Helper.js';\nimport WebGLRenderTarget from '../../webgl/RenderTarget.js';\nimport WebGLLayerRenderer from './Layer.js';\nimport {getWorldParameters} from './worldUtil.js';\n\nexport const Uniforms = {\n  ...DefaultUniform,\n  RENDER_EXTENT: 'u_renderExtent', // intersection of layer, source, and view extent\n  PATTERN_ORIGIN: 'u_patternOrigin',\n  GLOBAL_ALPHA: 'u_globalAlpha',\n};\n\n/**\n * @typedef {import('../../render/webgl/VectorStyleRenderer.js').AsShaders} StyleAsShaders\n */\n/**\n * @typedef {import('../../render/webgl/VectorStyleRenderer.js').AsRule} StyleAsRule\n */\n\n/**\n * @typedef {Object} Options\n * @property {string} [className='ol-layer'] A CSS class name to set to the canvas element.\n * @property {import('../../style/flat.js').FlatStyleLike | Array<StyleAsShaders> | StyleAsShaders} style Flat vector style; also accepts shaders\n * @property {Object<string, number|Array<number>|string|boolean>} variables Style variables\n * @property {boolean} [disableHitDetection=false] Setting this to true will provide a slight performance boost, but will\n * prevent all hit detection on the layer.\n * @property {Array<import(\"./Layer\").PostProcessesOptions>} [postProcesses] Post-processes definitions\n */\n\n/**\n * @classdesc\n * Experimental WebGL vector renderer. Supports polygons, lines and points:\n *  Polygons are broken down into triangles\n *  Lines are rendered as strips of quads\n *  Points are rendered as quads\n *\n * You need to provide vertex and fragment shaders as well as custom attributes for each type of geometry. All shaders\n * can access the uniforms in the {@link module:ol/webgl/Helper~DefaultUniform} enum.\n * The vertex shaders can access the following attributes depending on the geometry type:\n *  For polygons: {@link module:ol/render/webgl/PolygonBatchRenderer~Attributes}\n *  For line strings: {@link module:ol/render/webgl/LineStringBatchRenderer~Attributes}\n *  For points: {@link module:ol/render/webgl/PointBatchRenderer~Attributes}\n *\n * Please note that the fragment shaders output should have premultiplied alpha, otherwise visual anomalies may occur.\n *\n * Note: this uses {@link module:ol/webgl/Helper~WebGLHelper} internally.\n */\nclass WebGLVectorLayerRenderer extends WebGLLayerRenderer {\n  /**\n   * @param {import(\"../../layer/Layer.js\").default} layer Layer.\n   * @param {Options} options Options.\n   */\n  constructor(layer, options) {\n    const uniforms = {\n      [Uniforms.RENDER_EXTENT]: [0, 0, 0, 0],\n      [Uniforms.PATTERN_ORIGIN]: [0, 0],\n      [Uniforms.GLOBAL_ALPHA]: 1,\n    };\n\n    super(layer, {\n      uniforms: uniforms,\n      postProcesses: options.postProcesses,\n    });\n\n    /**\n     * @type {boolean}\n     * @private\n     */\n    this.hitDetectionEnabled_ = !options.disableHitDetection;\n\n    /**\n     * @type {WebGLRenderTarget}\n     * @private\n     */\n    this.hitRenderTarget_;\n\n    /**\n     * @private\n     */\n    this.sourceRevision_ = -1;\n\n    /**\n     * @private\n     */\n    this.previousExtent_ = createEmpty();\n\n    /**\n     * This transform is updated on every frame and is the composition of:\n     * - invert of the world->screen transform that was used when rebuilding buffers (see `this.renderTransform_`)\n     * - current world->screen transform\n     * @type {import(\"../../transform.js\").Transform}\n     * @private\n     */\n    this.currentTransform_ = createTransform();\n\n    /**\n     * @private\n     */\n    this.tmpCoords_ = [0, 0];\n    /**\n     * @private\n     */\n    this.tmpTransform_ = createTransform();\n    /**\n     * @private\n     */\n    this.tmpMat4_ = createMat4();\n\n    /**\n     * @type {import(\"../../transform.js\").Transform}\n     * @private\n     */\n    this.currentFrameStateTransform_ = createTransform();\n\n    /**\n     * @type {import('../../style/flat.js').StyleVariables}\n     * @private\n     */\n    this.styleVariables_ = {};\n\n    /**\n     * @type {Array<StyleAsRule | StyleAsShaders>}\n     * @private\n     */\n    this.styles_ = [];\n\n    /**\n     * @type {Array<VectorStyleRenderer>}\n     * @private\n     */\n    this.styleRenderers_ = [];\n\n    /**\n     * @type {Array<import('../../render/webgl/VectorStyleRenderer.js').WebGLBuffers>}\n     * @private\n     */\n    this.buffers_ = [];\n\n    this.applyOptions_(options);\n\n    /**\n     * @private\n     */\n    this.batch_ = new MixedGeometryBatch();\n\n    /**\n     * @private\n     * @type {boolean}\n     */\n    this.initialFeaturesAdded_ = false;\n\n    /**\n     * @private\n     * @type {Array<import(\"../../events.js\").EventsKey|null>}\n     */\n    this.sourceListenKeys_ = null;\n  }\n\n  /**\n   * @private\n   * @param {import(\"../../Map.js\").FrameState} frameState Frame state.\n   */\n  addInitialFeatures_(frameState) {\n    const source = this.getLayer().getSource();\n    const userProjection = getUserProjection();\n    let projectionTransform;\n    if (userProjection) {\n      projectionTransform = getTransformFromProjections(\n        userProjection,\n        frameState.viewState.projection,\n      );\n    }\n    this.batch_.addFeatures(source.getFeatures(), projectionTransform);\n    this.sourceListenKeys_ = [\n      listen(\n        source,\n        VectorEventType.ADDFEATURE,\n        this.handleSourceFeatureAdded_.bind(this, projectionTransform),\n      ),\n      listen(\n        source,\n        VectorEventType.CHANGEFEATURE,\n        this.handleSourceFeatureChanged_.bind(this, projectionTransform),\n        this,\n      ),\n      listen(\n        source,\n        VectorEventType.REMOVEFEATURE,\n        this.handleSourceFeatureDelete_,\n        this,\n      ),\n      listen(\n        source,\n        VectorEventType.CLEAR,\n        this.handleSourceFeatureClear_,\n        this,\n      ),\n    ];\n  }\n\n  /**\n   * @param {Options} options Options.\n   * @private\n   */\n  applyOptions_(options) {\n    this.styleVariables_ = options.variables;\n    this.styles_ = breakDownFlatStyle(options.style);\n  }\n\n  /**\n   * @private\n   */\n  createRenderers_() {\n    this.buffers_ = [];\n    this.styleRenderers_ = this.styles_.map(\n      (style) =>\n        new VectorStyleRenderer(\n          style,\n          this.styleVariables_,\n          this.helper,\n          this.hitDetectionEnabled_,\n          'filter' in style ? style.filter : null,\n        ),\n    );\n  }\n\n  /**\n   * @override\n   */\n  reset(options) {\n    this.applyOptions_(options);\n    if (this.helper) {\n      this.createRenderers_();\n    }\n    super.reset(options);\n  }\n\n  /**\n   * @override\n   */\n  afterHelperCreated() {\n    if (this.styleRenderers_.length) {\n      // To reuse buffers\n      this.styleRenderers_.forEach((renderer, i) =>\n        renderer.setHelper(this.helper, this.buffers_[i]),\n      );\n    } else {\n      this.createRenderers_();\n    }\n\n    if (this.hitDetectionEnabled_) {\n      this.hitRenderTarget_ = new WebGLRenderTarget(this.helper);\n    }\n  }\n\n  /**\n   * @param {import(\"../../proj.js\").TransformFunction} projectionTransform Transform function.\n   * @param {import(\"../../source/Vector.js\").VectorSourceEvent} event Event.\n   * @private\n   */\n  handleSourceFeatureAdded_(projectionTransform, event) {\n    const feature = event.feature;\n    this.batch_.addFeature(feature, projectionTransform);\n  }\n\n  /**\n   * @param {import(\"../../proj.js\").TransformFunction} projectionTransform Transform function.\n   * @param {import(\"../../source/Vector.js\").VectorSourceEvent} event Event.\n   * @private\n   */\n  handleSourceFeatureChanged_(projectionTransform, event) {\n    const feature = event.feature;\n    this.batch_.changeFeature(feature, projectionTransform);\n  }\n\n  /**\n   * @param {import(\"../../source/Vector.js\").VectorSourceEvent} event Event.\n   * @private\n   */\n  handleSourceFeatureDelete_(event) {\n    const feature = event.feature;\n    this.batch_.removeFeature(feature);\n  }\n\n  /**\n   * @private\n   */\n  handleSourceFeatureClear_() {\n    this.batch_.clear();\n  }\n\n  /**\n   * @param {import(\"../../transform.js\").Transform} batchInvertTransform Inverse of the transformation in which geometries are expressed\n   * @private\n   */\n  applyUniforms_(batchInvertTransform) {\n    // world to screen matrix\n    setFromTransform(this.tmpTransform_, this.currentFrameStateTransform_);\n    multiplyTransform(this.tmpTransform_, batchInvertTransform);\n    this.helper.setUniformMatrixValue(\n      Uniforms.PROJECTION_MATRIX,\n      mat4FromTransform(this.tmpMat4_, this.tmpTransform_),\n    );\n\n    // screen to world matrix\n    makeInverseTransform(this.tmpTransform_, this.tmpTransform_);\n    this.helper.setUniformMatrixValue(\n      Uniforms.SCREEN_TO_WORLD_MATRIX,\n      mat4FromTransform(this.tmpMat4_, this.tmpTransform_),\n    );\n\n    // pattern origin should always be [0, 0] in world coordinates\n    this.tmpCoords_[0] = 0;\n    this.tmpCoords_[1] = 0;\n    makeInverseTransform(this.tmpTransform_, batchInvertTransform);\n    applyTransform(this.tmpTransform_, this.tmpCoords_);\n    this.helper.setUniformFloatVec2(Uniforms.PATTERN_ORIGIN, this.tmpCoords_);\n  }\n\n  /**\n   * Render the layer.\n   * @param {import(\"../../Map.js\").FrameState} frameState Frame state.\n   * @return {HTMLElement} The rendered element.\n   * @override\n   */\n  renderFrame(frameState) {\n    const gl = this.helper.getGL();\n    this.preRender(gl, frameState);\n\n    const [startWorld, endWorld, worldWidth] = getWorldParameters(\n      frameState,\n      this.getLayer(),\n    );\n\n    // draw the normal canvas\n    this.helper.prepareDraw(frameState);\n    this.renderWorlds(frameState, false, startWorld, endWorld, worldWidth);\n    this.helper.finalizeDraw(\n      frameState,\n      this.dispatchPreComposeEvent,\n      this.dispatchPostComposeEvent,\n    );\n\n    const canvas = this.helper.getCanvas();\n\n    if (this.hitDetectionEnabled_) {\n      this.renderWorlds(frameState, true, startWorld, endWorld, worldWidth);\n      this.hitRenderTarget_.clearCachedData();\n    }\n\n    this.postRender(gl, frameState);\n\n    return canvas;\n  }\n\n  /**\n   * Determine whether renderFrame should be called.\n   * @param {import(\"../../Map.js\").FrameState} frameState Frame state.\n   * @return {boolean} Layer is ready to be rendered.\n   * @override\n   */\n  prepareFrameInternal(frameState) {\n    if (!this.initialFeaturesAdded_) {\n      this.addInitialFeatures_(frameState);\n      this.initialFeaturesAdded_ = true;\n    }\n\n    const layer = this.getLayer();\n    const vectorSource = layer.getSource();\n    const viewState = frameState.viewState;\n    const viewNotMoving =\n      !frameState.viewHints[ViewHint.ANIMATING] &&\n      !frameState.viewHints[ViewHint.INTERACTING];\n    const extentChanged = !equals(this.previousExtent_, frameState.extent);\n    const sourceChanged = this.sourceRevision_ < vectorSource.getRevision();\n\n    if (sourceChanged) {\n      this.sourceRevision_ = vectorSource.getRevision();\n    }\n\n    if (viewNotMoving && (extentChanged || sourceChanged)) {\n      const projection = viewState.projection;\n      const resolution = viewState.resolution;\n\n      const renderBuffer =\n        layer instanceof BaseVector ? layer.getRenderBuffer() : 0;\n      const extent = buffer(frameState.extent, renderBuffer * resolution);\n\n      const userProjection = getUserProjection();\n      if (userProjection) {\n        vectorSource.loadFeatures(\n          toUserExtent(extent, userProjection),\n          toUserResolution(resolution, projection),\n          userProjection,\n        );\n      } else {\n        vectorSource.loadFeatures(extent, resolution, projection);\n      }\n\n      this.ready = false;\n\n      const transform = this.helper.makeProjectionTransform(\n        frameState,\n        createTransform(),\n      );\n\n      const generatePromises = this.styleRenderers_.map((renderer, i) =>\n        renderer.generateBuffers(this.batch_, transform).then((buffers) => {\n          if (this.buffers_[i]) {\n            this.disposeBuffers(this.buffers_[i]);\n          }\n          this.buffers_[i] = buffers;\n        }),\n      );\n      Promise.all(generatePromises).then(() => {\n        this.ready = true;\n        this.getLayer().changed();\n      });\n\n      this.previousExtent_ = frameState.extent.slice();\n    }\n\n    return true;\n  }\n\n  /**\n   * Render the world, either to the main framebuffer or to the hit framebuffer\n   * @param {import(\"../../Map.js\").FrameState} frameState current frame state\n   * @param {boolean} forHitDetection whether the rendering is for hit detection\n   * @param {number} startWorld the world to render in the first iteration\n   * @param {number} endWorld the last world to render\n   * @param {number} worldWidth the width of the worlds being rendered\n   */\n  renderWorlds(frameState, forHitDetection, startWorld, endWorld, worldWidth) {\n    let world = startWorld;\n\n    if (forHitDetection) {\n      this.hitRenderTarget_.setSize([\n        Math.floor(frameState.size[0] / 2),\n        Math.floor(frameState.size[1] / 2),\n      ]);\n      this.helper.prepareDrawToRenderTarget(\n        frameState,\n        this.hitRenderTarget_,\n        true,\n      );\n    }\n\n    do {\n      this.helper.makeProjectionTransform(\n        frameState,\n        this.currentFrameStateTransform_,\n      );\n      translateTransform(\n        this.currentFrameStateTransform_,\n        world * worldWidth,\n        0,\n      );\n      for (let i = 0, ii = this.styleRenderers_.length; i < ii; i++) {\n        const renderer = this.styleRenderers_[i];\n        const buffers = this.buffers_[i];\n        if (!buffers) {\n          continue;\n        }\n        renderer.render(buffers, frameState, () => {\n          this.applyUniforms_(buffers.invertVerticesTransform);\n          this.helper.applyHitDetectionUniform(forHitDetection);\n        });\n      }\n    } while (++world < endWorld);\n  }\n\n  /**\n   * @param {import(\"../../coordinate.js\").Coordinate} coordinate Coordinate.\n   * @param {import(\"../../Map.js\").FrameState} frameState Frame state.\n   * @param {number} hitTolerance Hit tolerance in pixels.\n   * @param {import(\"../vector.js\").FeatureCallback<T>} callback Feature callback.\n   * @param {Array<import(\"../Map.js\").HitMatch<T>>} matches The hit detected matches with tolerance.\n   * @return {T|undefined} Callback result.\n   * @template T\n   * @override\n   */\n  forEachFeatureAtCoordinate(\n    coordinate,\n    frameState,\n    hitTolerance,\n    callback,\n    matches,\n  ) {\n    assert(\n      this.hitDetectionEnabled_,\n      '`forEachFeatureAtCoordinate` cannot be used on a WebGL layer if the hit detection logic has been disabled using the `disableHitDetection: true` option.',\n    );\n    if (!this.styleRenderers_.length || !this.hitDetectionEnabled_) {\n      return undefined;\n    }\n\n    const pixel = applyTransform(\n      frameState.coordinateToPixelTransform,\n      coordinate.slice(),\n    );\n\n    const data = this.hitRenderTarget_.readPixel(pixel[0] / 2, pixel[1] / 2);\n    const color = [data[0] / 255, data[1] / 255, data[2] / 255, data[3] / 255];\n    const ref = colorDecodeId(color);\n    const feature = this.batch_.getFeatureFromRef(ref);\n    if (feature) {\n      return callback(feature, this.getLayer(), null);\n    }\n    return undefined;\n  }\n\n  /**\n   * Will release a set of Webgl buffers\n   * @param {import('../../render/webgl/VectorStyleRenderer.js').WebGLBuffers} buffers Buffers\n   */\n  disposeBuffers(buffers) {\n    /**\n     * @param {Array<import('../../webgl/Buffer.js').default>} typeBuffers Buffers\n     */\n    const disposeBuffersOfType = (typeBuffers) => {\n      for (const buffer of typeBuffers) {\n        if (buffer) {\n          this.helper.deleteBuffer(buffer);\n        }\n      }\n    };\n    if (buffers.pointBuffers) {\n      disposeBuffersOfType(buffers.pointBuffers);\n    }\n    if (buffers.lineStringBuffers) {\n      disposeBuffersOfType(buffers.lineStringBuffers);\n    }\n    if (buffers.polygonBuffers) {\n      disposeBuffersOfType(buffers.polygonBuffers);\n    }\n  }\n\n  /**\n   * Clean up.\n   * @override\n   */\n  disposeInternal() {\n    this.buffers_.forEach((buffers) => {\n      if (buffers) {\n        this.disposeBuffers(buffers);\n      }\n    });\n    if (this.sourceListenKeys_) {\n      this.sourceListenKeys_.forEach(function (key) {\n        unlistenByKey(key);\n      });\n      this.sourceListenKeys_ = null;\n    }\n    super.disposeInternal();\n  }\n\n  renderDeclutter() {}\n}\n\nexport default WebGLVectorLayerRenderer;\n","/**\n * @module ol/layer/Heatmap\n */\nimport {createCanvasContext2D} from '../dom.js';\nimport {BooleanType, NumberType} from '../expr/expression.js';\nimport {newCompilationContext} from '../expr/gpu.js';\nimport {clamp} from '../math.js';\nimport {ShaderBuilder} from '../render/webgl/ShaderBuilder.js';\nimport {\n  applyContextToBuilder,\n  expressionToGlsl,\n  generateAttributesFromContext,\n  generateUniformsFromContext,\n} from '../render/webgl/compileUtil.js';\nimport WebGLVectorLayerRenderer from '../renderer/webgl/VectorLayer.js';\nimport BaseVector from './BaseVector.js';\n\n/**\n * @typedef {import(\"../style/flat.js\").NumberExpression|string|function(import(\"../Feature.js\").default):number} WeightExpression\n */\n\n/**\n * @template {import(\"../Feature.js\").FeatureLike} [FeatureType=import(\"../Feature.js\").default]\n * @template {import(\"../source/Vector.js\").default<FeatureType>} [VectorSourceType=import(\"../source/Vector.js\").default<FeatureType>]\n * @typedef {Object} Options\n * @property {string} [className='ol-layer'] A CSS class name to set to the layer element.\n * @property {number} [opacity=1] Opacity (0, 1).\n * @property {boolean} [visible=true] Visibility.\n * @property {import(\"../extent.js\").Extent} [extent] The bounding extent for layer rendering.  The layer will not be\n * rendered outside of this extent.\n * @property {number} [zIndex] The z-index for layer rendering.  At rendering time, the layers\n * will be ordered, first by Z-index and then by position. When `undefined`, a `zIndex` of 0 is assumed\n * for layers that are added to the map's `layers` collection, or `Infinity` when the layer's `setMap()`\n * method was used.\n * @property {number} [minResolution] The minimum resolution (inclusive) at which this layer will be\n * visible.\n * @property {number} [maxResolution] The maximum resolution (exclusive) below which this layer will\n * be visible.\n * @property {number} [minZoom] The minimum view zoom level (exclusive) above which this layer will be\n * visible.\n * @property {number} [maxZoom] The maximum view zoom level (inclusive) at which this layer will\n * be visible.\n * @property {Array<string>} [gradient=['#00f', '#0ff', '#0f0', '#ff0', '#f00']] The color gradient\n * of the heatmap, specified as an array of CSS color strings.\n * @property {import(\"../style/flat.js\").NumberExpression} [radius=8] Radius size in pixels. Note that for LineStrings,\n * the width of the line will be double the radius.\n * @property {import(\"../style/flat.js\").NumberExpression} [blur=15] Blur size in pixels. This is added to the `radius`\n * parameter above to create the final size of the blur effect.\n * @property {WeightExpression} [weight='weight'] The feature\n * attribute to use for the weight. This also supports expressions returning a number or a function that returns a weight from a feature. Weight values\n * should range from 0 to 1 (and values outside will be clamped to that range).\n * @property {import(\"../style/flat.js\").BooleanExpression} [filter] Optional filter expression.\n * @property {Object<string, number|Array<number>|string|boolean>} [variables] Variables used in expressions (optional)\n * @property {VectorSourceType} [source] Point source.\n * @property {Object<string, *>} [properties] Arbitrary observable properties. Can be accessed with `#get()` and `#set()`.\n */\n\n/**\n * @enum {string}\n * @private\n */\nconst Property = {\n  BLUR: 'blur',\n  GRADIENT: 'gradient',\n  RADIUS: 'radius',\n};\n\n/**\n * @const\n * @type {Array<string>}\n */\nconst DEFAULT_GRADIENT = ['#00f', '#0ff', '#0f0', '#ff0', '#f00'];\n\n/**\n * @classdesc\n * Layer for rendering vector data as a heatmap.\n * Note that any property set in the options is set as a {@link module:ol/Object~BaseObject}\n * property on the layer object; for example, setting `title: 'My Title'` in the\n * options means that `title` is observable, and has get/set accessors.\n *\n * @fires import(\"../render/Event.js\").RenderEvent#prerender\n * @fires import(\"../render/Event.js\").RenderEvent#postrender\n * @template {import(\"../Feature.js\").FeatureLike} [FeatureType=import(\"../Feature.js\").default]\n * @template {import(\"../source/Vector.js\").default<FeatureType>} [VectorSourceType=import(\"../source/Vector.js\").default<FeatureType>]\n * @extends {BaseVector<FeatureType, VectorSourceType, WebGLVectorLayerRenderer>}\n * @api\n */\nclass Heatmap extends BaseVector {\n  /**\n   * @param {Options<FeatureType, VectorSourceType>} [options] Options.\n   */\n  constructor(options) {\n    options = options ? options : {};\n\n    const baseOptions = Object.assign({}, options);\n\n    delete baseOptions.gradient;\n    delete baseOptions.radius;\n    delete baseOptions.blur;\n    delete baseOptions.weight;\n    super(baseOptions);\n\n    this.filter_ = options.filter ?? true;\n\n    /**\n     * @type {import('../style/flat.js').StyleVariables}\n     * @private\n     */\n    this.styleVariables_ = options.variables || {};\n\n    /**\n     * @private\n     * @type {HTMLCanvasElement}\n     */\n    this.gradient_ = null;\n\n    this.addChangeListener(Property.GRADIENT, this.handleGradientChanged_);\n\n    this.setGradient(options.gradient ? options.gradient : DEFAULT_GRADIENT);\n\n    this.setBlur(options.blur !== undefined ? options.blur : 15);\n\n    this.setRadius(options.radius !== undefined ? options.radius : 8);\n\n    const weight = options.weight ? options.weight : 'weight';\n\n    /**\n     * @private\n     */\n    this.weight_ = weight;\n\n    // For performance reasons, don't sort the features before rendering.\n    // The render order is not relevant for a heatmap representation.\n    this.setRenderOrder(null);\n  }\n\n  /**\n   * Return the blur size in pixels.\n   * @return {import(\"../style/flat.js\").NumberExpression} Blur size in pixels.\n   * @api\n   * @observable\n   */\n  getBlur() {\n    return /** @type {import(\"../style/flat.js\").NumberExpression} */ (\n      this.get(Property.BLUR)\n    );\n  }\n\n  /**\n   * Return the gradient colors as array of strings.\n   * @return {Array<string>} Colors.\n   * @api\n   * @observable\n   */\n  getGradient() {\n    return /** @type {Array<string>} */ (this.get(Property.GRADIENT));\n  }\n\n  /**\n   * Return the size of the radius in pixels.\n   * @return {import(\"../style/flat.js\").NumberExpression} Radius size in pixel.\n   * @api\n   * @observable\n   */\n  getRadius() {\n    return /** @type {import(\"../style/flat.js\").NumberExpression} */ (\n      this.get(Property.RADIUS)\n    );\n  }\n\n  /**\n   * @private\n   */\n  handleGradientChanged_() {\n    this.gradient_ = createGradient(this.getGradient());\n  }\n\n  /**\n   * Set the blur size in pixels.\n   * @param {import(\"../style/flat.js\").NumberExpression} blur Blur size in pixels (supports expressions).\n   * @api\n   * @observable\n   */\n  setBlur(blur) {\n    const previousValue = this.get(Property.BLUR);\n    this.set(Property.BLUR, blur);\n    // if the value stays numerical, simply refresh the layer\n    if (typeof blur === 'number' && typeof previousValue === 'number') {\n      this.changed();\n      return;\n    }\n    this.clearRenderer();\n  }\n\n  /**\n   * Set the gradient colors as array of strings.\n   * @param {Array<string>} colors Gradient.\n   * @api\n   * @observable\n   */\n  setGradient(colors) {\n    this.set(Property.GRADIENT, colors);\n  }\n\n  /**\n   * Set the size of the radius in pixels.\n   * @param {import(\"../style/flat.js\").NumberExpression} radius Radius size in pixel (supports expressions).\n   * @api\n   * @observable\n   */\n  setRadius(radius) {\n    const previousValue = this.get(Property.RADIUS);\n    this.set(Property.RADIUS, radius);\n    // if the value stays numerical, simply refresh the layer\n    if (typeof radius === 'number' && typeof previousValue === 'number') {\n      this.changed();\n      return;\n    }\n    this.clearRenderer();\n  }\n\n  /**\n   * Set the filter expression\n   * @param {import(\"../style/flat.js\").BooleanExpression} filter Filter expression\n   * @api\n   */\n  setFilter(filter) {\n    this.filter_ = filter;\n    this.changed();\n    this.clearRenderer();\n  }\n\n  /**\n   * Set the weight expression\n   * @param {WeightExpression} weight Weight expression\n   * @api\n   */\n  setWeight(weight) {\n    this.weight_ = weight;\n    this.changed();\n    this.clearRenderer();\n  }\n\n  /**\n   * @override\n   */\n  createRenderer() {\n    const builder = new ShaderBuilder();\n\n    const context = newCompilationContext();\n    const filterCompiled = expressionToGlsl(context, this.filter_, BooleanType);\n    let radiusCompiled = expressionToGlsl(\n      context,\n      this.getRadius(),\n      NumberType,\n    );\n    let blurCompiled = expressionToGlsl(context, this.getBlur(), NumberType);\n\n    /** @type {import('../render/webgl/VectorStyleRenderer.js').UniformDefinitions} */\n    const blurRadiusUniforms = {};\n    if (typeof this.getBlur() === 'number') {\n      blurCompiled = 'a_blur';\n      blurRadiusUniforms['a_blur'] = () => this.getBlur();\n      builder.addUniform('a_blur', 'float');\n    }\n    if (typeof this.getRadius() === 'number') {\n      radiusCompiled = 'a_radius';\n      blurRadiusUniforms['a_radius'] = () => this.getRadius();\n      builder.addUniform('a_radius', 'float');\n    }\n\n    /** @type {import('../render/webgl/VectorStyleRenderer.js').AttributeDefinitions} */\n    const weightAttribute = {};\n    let weightExpression = null;\n    if (\n      typeof this.weight_ === 'string' ||\n      typeof this.weight_ === 'function'\n    ) {\n      const weightFunction =\n        typeof this.weight_ === 'string'\n          ? (feature) => feature.get(this.weight_)\n          : this.weight_;\n      weightAttribute['prop_weight'] = {\n        size: 1,\n        callback: (feature) => {\n          const weightValue = weightFunction(feature);\n          return weightValue !== undefined ? clamp(weightValue, 0, 1) : 1;\n        },\n      };\n      weightExpression = 'a_prop_weight';\n      builder.addAttribute('a_prop_weight', 'float');\n    } else {\n      const clampedWeight = ['clamp', this.weight_, 0, 1];\n      weightExpression = expressionToGlsl(context, clampedWeight, NumberType);\n    }\n\n    builder\n      .addFragmentShaderFunction(\n        `float getBlurSlope() {\n  float blur = max(1., ${blurCompiled});\n  float radius = ${radiusCompiled};\n  return radius / blur;\n}`,\n      )\n      .setSymbolSizeExpression(`vec2(${radiusCompiled} + ${blurCompiled}) * 2.`)\n      .setSymbolColorExpression(\n        `vec4(smoothstep(0., 1., (1. - length(coordsPx * 2. / v_quadSizePx)) * getBlurSlope()) * ${weightExpression})`,\n      )\n      .setStrokeColorExpression(\n        `vec4(smoothstep(0., 1., (1. - length(currentRadiusPx * 2. / v_width)) * getBlurSlope()) * ${weightExpression})`,\n      )\n      .setStrokeWidthExpression(`(${radiusCompiled} + ${blurCompiled}) * 2.`)\n      .setFillColorExpression(`vec4(${weightExpression})`)\n      .setFragmentDiscardExpression(`!${filterCompiled}`);\n\n    applyContextToBuilder(builder, context);\n    const attributes = generateAttributesFromContext(context);\n    const uniforms = generateUniformsFromContext(context, this.styleVariables_);\n\n    return new WebGLVectorLayerRenderer(this, {\n      className: this.getClassName(),\n      variables: this.styleVariables_,\n      style: {\n        builder,\n        attributes: {\n          ...attributes,\n          ...weightAttribute,\n        },\n        uniforms: {\n          ...uniforms,\n          ...blurRadiusUniforms,\n        },\n      },\n      disableHitDetection: false,\n      postProcesses: [\n        {\n          fragmentShader: `\n            precision mediump float;\n\n            uniform sampler2D u_image;\n            uniform sampler2D u_gradientTexture;\n            uniform float u_opacity;\n\n            varying vec2 v_texCoord;\n\n            void main() {\n              vec4 color = texture2D(u_image, v_texCoord);\n              gl_FragColor.a = color.a * u_opacity;\n              gl_FragColor.rgb = texture2D(u_gradientTexture, vec2(0.5, color.a)).rgb;\n              gl_FragColor.rgb *= gl_FragColor.a;\n            }`,\n          uniforms: {\n            u_gradientTexture: () => this.gradient_,\n            u_opacity: () => this.getOpacity(),\n          },\n        },\n      ],\n    });\n  }\n\n  /**\n   * Update any variables used by the layer style and trigger a re-render.\n   * @param {import('../style/flat.js').StyleVariables} variables Variables to update.\n   */\n  updateStyleVariables(variables) {\n    Object.assign(this.styleVariables_, variables);\n    this.changed();\n  }\n\n  /**\n   * @override\n   */\n  renderDeclutter() {}\n}\n\n/**\n * @param {Array<string>} colors A list of colored.\n * @return {HTMLCanvasElement} canvas with gradient texture.\n */\nfunction createGradient(colors) {\n  const width = 1;\n  const height = 256;\n  const context = createCanvasContext2D(width, height);\n\n  const gradient = context.createLinearGradient(0, 0, width, height);\n  const step = 1 / (colors.length - 1);\n  for (let i = 0, ii = colors.length; i < ii; ++i) {\n    gradient.addColorStop(i * step, colors[i]);\n  }\n\n  context.fillStyle = gradient;\n  context.fillRect(0, 0, width, height);\n\n  return context.canvas;\n}\n\nexport default Heatmap;\n","import OpenLayersMap from 'ol/Map';\nimport { Point } from 'ol/geom';\nimport * as layer from 'ol/layer';\n\nimport {\n  EventBus,\n  FieldType,\n  getFieldColorModeForField,\n  GrafanaTheme2,\n  MapLayerOptions,\n  MapLayerRegistryItem,\n  PanelData,\n} from '@grafana/data';\nimport { ScaleDimensionConfig } from '@grafana/schema';\nimport { ScaleDimensionEditor } from 'app/features/dimensions/editors/ScaleDimensionEditor';\nimport { getScaledDimension } from 'app/features/dimensions/scale';\nimport { FrameVectorSource } from 'app/features/geo/utils/frameVectorSource';\nimport { getLocationMatchers } from 'app/features/geo/utils/location';\n\n// Configuration options for Heatmap overlays\nexport interface HeatmapConfig {\n  weight: ScaleDimensionConfig;\n  blur: number;\n  radius: number;\n}\n\nconst defaultOptions: HeatmapConfig = {\n  weight: {\n    fixed: 1,\n    min: 0,\n    max: 1,\n  },\n  blur: 15,\n  radius: 5,\n};\n\n/**\n * Map layer configuration for heatmap overlay\n */\nexport const heatmapLayer: MapLayerRegistryItem<HeatmapConfig> = {\n  id: 'heatmap',\n  name: 'Heatmap',\n  description: 'Visualizes a heatmap of the data',\n  isBaseMap: false,\n  showLocation: true,\n\n  /**\n   * Function that configures transformation and returns a transformer\n   * @param map\n   * @param options\n   * @param theme\n   */\n  create: async (map: OpenLayersMap, options: MapLayerOptions<HeatmapConfig>, eventBus: EventBus, theme: GrafanaTheme2) => {\n    const config = { ...defaultOptions, ...options.config };\n\n    const location = await getLocationMatchers(options.location);\n    const source = new FrameVectorSource<Point>(location);\n    const WEIGHT_KEY = \"_weight\";\n\n    // Create a new Heatmap layer\n    // Weight function takes a feature as attribute and returns a normalized weight value\n    const vectorLayer = new layer.Heatmap({\n      source,\n      blur: config.blur,\n      radius: config.radius,\n      weight: (feature) => {\n        return feature.get(WEIGHT_KEY);\n      },\n    });\n\n    return {\n      init: () => vectorLayer,\n      update: (data: PanelData) => {\n        const frame = data.series[0];\n        if (!frame) {\n          return;\n        }\n        source.update(frame);\n\n        const weightDim = getScaledDimension(frame, config.weight);\n        source.forEachFeature( (f) => {\n          const idx: number = f.get('rowIndex');\n          if(idx != null) {\n            f.set(WEIGHT_KEY, weightDim.get(idx));\n          }\n        });\n\n        // Set heatmap gradient colors\n        let colors = ['#00f', '#0ff', '#0f0', '#ff0', '#f00'];\n\n        // Either the configured field or the first numeric field value\n        const field = weightDim.field ?? frame.fields.find((field) => field.type === FieldType.number);\n        if (field) {\n          const colorMode = getFieldColorModeForField(field);\n          if (colorMode.isContinuous && colorMode.getColors) {\n            // getColors return an array of color string from the color scheme chosen\n            colors = colorMode.getColors(theme);\n          }\n        }\n        vectorLayer.setGradient(colors);\n      },\n\n      // Heatmap overlay options\n      registerOptionsUI: (builder) => {\n        builder\n          .addCustomEditor({\n            id: 'config.weight',\n            path: 'config.weight',\n            name: 'Weight values',\n            description: 'Scale the distribution for each row',\n            editor: ScaleDimensionEditor,\n            settings: {\n              min: 0, // no contribution\n              max: 1,\n              hideRange: true, // Don't show the scale factor\n            },\n            defaultValue: {\n              // Configured values\n              fixed: 1,\n              min: 0,\n              max: 1,\n            },\n          })\n          .addSliderInput({\n            path: 'config.radius',\n            description: 'Configures the size of clusters',\n            name: 'Radius',\n            defaultValue: defaultOptions.radius,\n            settings: {\n              min: 1,\n              max: 50,\n              step: 1,\n            },\n          })\n          .addSliderInput({\n            path: 'config.blur',\n            description: 'Configures the amount of blur of clusters',\n            name: 'Blur',\n            defaultValue: defaultOptions.blur,\n            settings: {\n              min: 1,\n              max: 50,\n              step: 1,\n            },\n          });\n      },\n    };\n  },\n  // fill in the default values\n  defaultOptions,\n};\n","import Feature from 'ol/Feature';\nimport OpenLayersMap from 'ol/Map';\nimport * as layer from 'ol/layer';\nimport * as source from 'ol/source';\nimport * as style from 'ol/style';\n\nimport { MapLayerRegistryItem, MapLayerOptions, PanelData, GrafanaTheme2, PluginState, EventBus } from '@grafana/data';\nimport { getGeometryField, getLocationMatchers } from 'app/features/geo/utils/location';\n\nexport interface LastPointConfig {\n  icon?: string;\n}\n\nconst defaultOptions: LastPointConfig = {\n  icon: 'https://openlayers.org/en/latest/examples/data/icon.png',\n};\n\nexport const lastPointTracker: MapLayerRegistryItem<LastPointConfig> = {\n  id: 'last-point-tracker',\n  name: 'Icon at last point',\n  description: 'Show an icon at the last point',\n  isBaseMap: false,\n  showLocation: true,\n  state: PluginState.alpha,\n\n  /**\n   * Function that configures transformation and returns a transformer\n   * @param map\n   * @param options\n   * @param theme\n   */\n  create: async (map: OpenLayersMap, options: MapLayerOptions<LastPointConfig>, eventBus: EventBus, theme: GrafanaTheme2) => {\n    const point = new Feature({});\n    const config = { ...defaultOptions, ...options.config };\n\n    point.setStyle(\n      new style.Style({\n        image: new style.Icon({\n          src: config.icon,\n        }),\n      })\n    );\n\n    const vectorSource = new source.Vector({\n      features: [point],\n    });\n\n    const vectorLayer = new layer.Vector({\n      source: vectorSource,\n    });\n\n    const matchers = await getLocationMatchers(options.location);\n    return {\n      init: () => vectorLayer,\n      update: (data: PanelData) => {\n        const frame = data.series[0];\n        if (frame && frame.length) {\n          const out = getGeometryField(frame, matchers);\n          if (!out.field) {\n            return; // ???\n          }\n          point.setGeometry(out.field.values[frame.length - 1]);\n        }\n      },\n    };\n  },\n\n  // fill in the default values\n  defaultOptions,\n};\n","/*\tCopyright (c) 2016 Jean-Marc VIGLINO, \r\n  released under the CeCILL-B license (French BSD license)\r\n  (http://www.cecill.info/licences/Licence_CeCILL-B_V1-en.txt).\r\n\r\n  Usefull function to handle geometric operations\r\n*/\r\n\r\nimport ol_geom_LineString from 'ol/geom/LineString.js'\r\nimport ol_geom_LinearRing from 'ol/geom/LinearRing.js'\r\nimport ol_geom_MultiLineString from 'ol/geom/MultiLineString.js'\r\nimport ol_geom_MultiPoint from 'ol/geom/MultiPoint.js'\r\nimport ol_geom_MultiPolygon from 'ol/geom/MultiPolygon.js'\r\nimport ol_geom_Point from 'ol/geom/Point.js'\r\nimport ol_geom_Polygon from 'ol/geom/Polygon.js'\r\nimport ol_geom_Circle from 'ol/geom/Circle.js'\r\nimport {getCenter as ol_extent_getCenter} from 'ol/extent.js'\r\nimport {buffer as ol_extent_buffer} from 'ol/extent.js'\r\n\r\n/** Distance beetween 2 points\r\n *\tUsefull geometric functions\r\n * @param {ol.Coordinate} p1 first point\r\n * @param {ol.Coordinate} p2 second point\r\n * @return {number} distance\r\n */\r\nvar ol_coordinate_dist2d = function(p1, p2) {\r\n  var dx = p1[0]-p2[0];\r\n  var dy = p1[1]-p2[1];\r\n  return Math.sqrt(dx*dx+dy*dy);\r\n}\r\n\r\n/** 2 points are equal\r\n *\tUsefull geometric functions\r\n * @param {ol.Coordinate} p1 first point\r\n * @param {ol.Coordinate} p2 second point\r\n * @return {boolean}\r\n */\r\nvar ol_coordinate_equal = function(p1, p2) {\r\n  return (p1[0]==p2[0] && p1[1]==p2[1]);\r\n}\r\n\r\n/** Get center coordinate of a feature\r\n * @param {ol.Feature} f\r\n * @return {ol.coordinate} the center\r\n */\r\nvar ol_coordinate_getFeatureCenter = function(f) {\r\n  return ol_coordinate_getGeomCenter (f.getGeometry());\r\n};\r\n\r\n/** Get center coordinate of a geometry\r\n* @param {ol.geom.Geometry} geom\r\n* @return {ol.Coordinate} the center\r\n*/\r\nvar ol_coordinate_getGeomCenter = function(geom) {\r\n  switch (geom.getType()) {\r\n    case 'Point': \r\n      return geom.getCoordinates();\r\n    case \"MultiPolygon\":\r\n      geom = geom.getPolygon(0);\r\n      // fallthrough\r\n    case \"Polygon\":\r\n      return geom.getInteriorPoint().getCoordinates();\r\n    default:\r\n      return geom.getClosestPoint(ol_extent_getCenter(geom.getExtent()));\r\n  }\r\n};\r\n\r\n/** Offset a polyline\r\n * @param {Array<ol.Coordinate>} coords\r\n * @param {number} offset\r\n * @return {Array<ol.Coordinate>} resulting coord\r\n * @see http://stackoverflow.com/a/11970006/796832\r\n * @see https://drive.google.com/viewerng/viewer?a=v&pid=sites&srcid=ZGVmYXVsdGRvbWFpbnxqa2dhZGdldHN0b3JlfGd4OjQ4MzI5M2Y0MjNmNzI2MjY\r\n */\r\nvar ol_coordinate_offsetCoords = function (coords, offset) {\r\n  var path = [];\r\n  var N = coords.length-1;\r\n  var max = N;\r\n  var mi, mi1, li, li1, ri, ri1, si, si1, Xi1, Yi1;\r\n  var p0, p1, p2;\r\n  var isClosed = ol_coordinate_equal(coords[0],coords[N]);\r\n  if (!isClosed) {\r\n    p0 = coords[0];\r\n    p1 = coords[1];\r\n    p2 = [\r\n      p0[0] + (p1[1] - p0[1]) / ol_coordinate_dist2d(p0,p1) *offset,\r\n      p0[1] - (p1[0] - p0[0]) / ol_coordinate_dist2d(p0,p1) *offset\r\n    ];\r\n    path.push(p2);\r\n    coords.push(coords[N])\r\n    N++;\r\n    max--;\r\n  }\r\n  for (var i = 0; i < max; i++) {\r\n    p0 = coords[i];\r\n    p1 = coords[(i+1) % N];\r\n    p2 = coords[(i+2) % N];\r\n\r\n    mi = (p1[1] - p0[1])/(p1[0] - p0[0]);\r\n    mi1 = (p2[1] - p1[1])/(p2[0] - p1[0]);\r\n    // Prevent alignements\r\n    if (Math.abs(mi-mi1) > 1e-10) {\r\n      li = Math.sqrt((p1[0] - p0[0])*(p1[0] - p0[0])+(p1[1] - p0[1])*(p1[1] - p0[1]));\r\n      li1 = Math.sqrt((p2[0] - p1[0])*(p2[0] - p1[0])+(p2[1] - p1[1])*(p2[1] - p1[1]));\r\n      ri = p0[0] + offset*(p1[1] - p0[1])/li;\r\n      ri1 = p1[0] + offset*(p2[1] - p1[1])/li1;\r\n      si = p0[1] - offset*(p1[0] - p0[0])/li;\r\n      si1 = p1[1] - offset*(p2[0] - p1[0])/li1;\r\n      Xi1 = (mi1*ri1-mi*ri+si-si1) / (mi1-mi);\r\n      Yi1 = (mi*mi1*(ri1-ri)+mi1*si-mi*si1) / (mi1-mi);\r\n\r\n      // Correction for vertical lines\r\n      if(p1[0] - p0[0] == 0) {\r\n        Xi1 = p1[0] + offset*(p1[1] - p0[1])/Math.abs(p1[1] - p0[1]);\r\n        Yi1 = mi1*Xi1 - mi1*ri1 + si1;\r\n      }\r\n      if (p2[0] - p1[0] == 0 ) {\r\n        Xi1 = p2[0] + offset*(p2[1] - p1[1])/Math.abs(p2[1] - p1[1]);\r\n        Yi1 = mi*Xi1 - mi*ri + si;\r\n      }\r\n\r\n      path.push([Xi1, Yi1]);\r\n    }\r\n  }\r\n  if (isClosed) {\r\n    path.push(path[0]);\r\n  } else {\r\n    coords.pop();\r\n    p0 = coords[coords.length-1];\r\n    p1 = coords[coords.length-2];\r\n    p2 = [\r\n      p0[0] - (p1[1] - p0[1]) / ol_coordinate_dist2d(p0,p1) *offset,\r\n      p0[1] + (p1[0] - p0[0]) / ol_coordinate_dist2d(p0,p1) *offset\r\n    ];\r\n    path.push(p2);\r\n  }\r\n  return path;\r\n}\r\n\r\n/** Find the segment a point belongs to\r\n * @param {ol.Coordinate} pt\r\n * @param {Array<ol.Coordinate>} coords\r\n * @return {} the index (-1 if not found) and the segment\r\n */\r\nvar ol_coordinate_findSegment = function (pt, coords) {\r\n  for (var i=0; i<coords.length-1; i++) {\r\n    var p0 = coords[i];\r\n    var p1 = coords[i+1];\r\n    if (ol_coordinate_equal(pt, p0) || ol_coordinate_equal(pt, p1)) {\r\n      return { index:1, segment: [p0,p1] };\r\n    } else {\r\n      var d0 = ol_coordinate_dist2d(p0,p1);\r\n      var v0 = [ (p1[0] - p0[0]) / d0, (p1[1] - p0[1]) / d0 ];\r\n      var d1 = ol_coordinate_dist2d(p0,pt);\r\n      var v1 = [ (pt[0] - p0[0]) / d1, (pt[1] - p0[1]) / d1 ];\r\n      if (Math.abs(v0[0]*v1[1] - v0[1]*v1[0]) < 1e-10) {\r\n        return { index:1, segment: [p0,p1] };\r\n      }\r\n    }\r\n  }\r\n  return { index: -1 };\r\n};\r\n\r\n/**\r\n * Split a Polygon geom with horizontal lines\r\n * @param {Array<ol.Coordinate>} geom\r\n * @param {number} y the y to split\r\n * @param {number} n contour index\r\n * @return {Array<Array<ol.Coordinate>>}\r\n */\r\nvar ol_coordinate_splitH = function (geom, y, n) {\r\n  var x, abs;\r\n  var list = [];\r\n  for (var i=0; i<geom.length-1; i++) {\r\n    // Hole separator?\r\n    if (!geom[i].length || !geom[i+1].length) continue;\r\n    // Intersect\r\n    if (geom[i][1]<=y && geom[i+1][1]>y || geom[i][1]>=y && geom[i+1][1]<y) {\r\n      abs = (y-geom[i][1]) / (geom[i+1][1]-geom[i][1]);\r\n      x = abs * (geom[i+1][0]-geom[i][0]) + geom[i][0];\r\n      list.push ({ contour: n, index: i, pt: [x,y], abs: abs });\r\n    }\r\n  }\r\n  // Sort x\r\n  list.sort(function(a,b) { return a.pt[0] - b.pt[0] });\r\n  // Horizontal segment\r\n  var result = [];\r\n  for (var j=0; j<list.length-1; j += 2) {\r\n    result.push([list[j], list[j+1]])\r\n  }\r\n  return result;\r\n};\r\n\r\n/** Create a geometry given a type and coordinates */\r\nvar ol_geom_createFromType = function (type, coordinates) {\r\n  switch (type) {\r\n    case 'LineString': return new ol_geom_LineString(coordinates);\r\n    case 'LinearRing': return new ol_geom_LinearRing(coordinates);\r\n    case 'MultiLineString': return new ol_geom_MultiLineString(coordinates);\r\n    case 'MultiPoint': return new ol_geom_MultiPoint(coordinates);\r\n    case 'MultiPolygon': return new ol_geom_MultiPolygon(coordinates);\r\n    case 'Point': return new ol_geom_Point(coordinates);\r\n    case 'Polygon': return new ol_geom_Polygon(coordinates);\r\n    default:\r\n      console.error('[createFromType] Unsupported type: '+type);\r\n      return null;\r\n  }\r\n};\r\n\r\nexport {ol_geom_createFromType}\r\nexport {ol_coordinate_dist2d, ol_coordinate_equal, ol_coordinate_findSegment, ol_coordinate_getFeatureCenter, ol_coordinate_getGeomCenter, ol_coordinate_offsetCoords, ol_coordinate_splitH}\r\n\r\n/** Intersect 2 lines\r\n * @param {Arrar<ol.coordinate>} d1\r\n * @param {Arrar<ol.coordinate>} d2\r\n */\r\nvar ol_coordinate_getIntersectionPoint = function (d1, d2) {\r\n  var d1x = d1[1][0] - d1[0][0];\r\n  var d1y = d1[1][1] - d1[0][1];\r\n  var d2x = d2[1][0] - d2[0][0];\r\n  var d2y = d2[1][1] - d2[0][1];\r\n  var det = d1x * d2y - d1y * d2x;\r\n  if (det != 0) {\r\n    var k = (d1x * d1[0][1] - d1x * d2[0][1] - d1y * d1[0][0] + d1y * d2[0][0]) / det;\r\n    return [d2[0][0] + k*d2x, d2[0][1] + k*d2y];\r\n  } else {\r\n    return false;\r\n  }\r\n};\r\n\r\nexport { ol_coordinate_getIntersectionPoint }\r\n\r\nvar ol_extent_intersection;\r\n\r\n(function() {\r\n// Split at x\r\nfunction splitX(pts, x) {\r\n  var pt;\r\n  for (let i=pts.length-1; i>0; i--) {\r\n    if ((pts[i][0]>x && pts[i-1][0]<x) || (pts[i][0]<x && pts[i-1][0]>x)) {\r\n      pt = [ x, (x - pts[i][0]) / (pts[i-1][0]-pts[i][0]) * (pts[i-1][1]-pts[i][1]) + pts[i][1]];\r\n      pts.splice(i, 0, pt);\r\n    }\r\n  }\r\n}\r\n// Split at y\r\nfunction splitY(pts, y) {\r\n  var pt;\r\n  for (let i=pts.length-1; i>0; i--) {\r\n    if ((pts[i][1]>y && pts[i-1][1]<y) || (pts[i][1]<y && pts[i-1][1]>y)) {\r\n      pt = [ (y - pts[i][1]) / (pts[i-1][1]-pts[i][1]) * (pts[i-1][0]-pts[i][0]) + pts[i][0], y];\r\n      pts.splice(i, 0, pt);\r\n    }\r\n  }\r\n}\r\n\r\n/** Fast polygon intersection with an extent (used for area calculation)\r\n * @param {ol_extent_Extent} extent\r\n * @param {ol_geom_Polygon|ol_geom_MultiPolygon} polygon\r\n * @returns {ol_geom_Polygon|ol_geom_MultiPolygon|null} return null if not a polygon geometry\r\n */\r\nol_extent_intersection = function(extent, polygon) {\r\n  var poly = (polygon.getType() === 'Polygon');\r\n  if (!poly && polygon.getType() !== 'MultiPolygon') return null;\r\n  var geom = polygon.getCoordinates();\r\n  if (poly) geom = [geom];\r\n  geom.forEach(function(g) {\r\n    g.forEach(function(c) {\r\n      splitX(c, extent[0]);\r\n      splitX(c, extent[2]);\r\n      splitY(c, extent[1]);\r\n      splitY(c, extent[3]);\r\n    });\r\n  })\r\n  // Snap geom to the extent \r\n  geom.forEach(function(g) {\r\n    g.forEach(function(c) {\r\n      c.forEach(function(p) {\r\n        if (p[0]<extent[0]) p[0] = extent[0];\r\n        else if (p[0]>extent[2]) p[0] = extent[2];\r\n        if (p[1]<extent[1]) p[1] = extent[1];\r\n        else if (p[1]>extent[3]) p[1] = extent[3];\r\n      })\r\n    })\r\n  })\r\n  if (poly) {\r\n    return new ol_geom_Polygon(geom[0]);\r\n  } else {\r\n    return new ol_geom_MultiPolygon(geom);\r\n  }\r\n};\r\n})();\r\n\r\nexport { ol_extent_intersection }\r\nexport { ol_extent_intersection as extentIntersection }\r\n\r\n/** Add points along a segment\r\n * @param {ol_Coordinate} p1 \r\n * @param {ol_Coordinate} p2 \r\n * @param {number} d \r\n * @param {boolean} start include starting point, default true\r\n * @returns {Array<ol_Coordinate>}\r\n */\r\nvar ol_coordinate_sampleAt = function(p1, p2, d, start) {\r\n  var pts = [];\r\n  if (start!==false) pts.push(p1);\r\n  var dl = ol_coordinate_dist2d(p1,p2);\r\n  if (dl) {\r\n    var nb = Math.round(dl/d);\r\n    if (nb>1) {\r\n      var dx = (p2[0]-p1[0]) / nb;\r\n      var dy = (p2[1]-p1[1]) / nb;\r\n      for (var i=1; i<nb; i++) {\r\n        pts.push([p1[0] + dx*i, p1[1] + dy*i])\r\n      }\r\n    }\r\n  }\r\n  pts.push(p2);\r\n  return pts;\r\n};\r\nexport { ol_coordinate_sampleAt }\r\n\r\n/** Sample a LineString at a distance\r\n * @param {number} d\r\n * @returns {ol_geom_LineString}\r\n */\r\nol_geom_LineString.prototype.sampleAt = function(d) {\r\n  var line = this.getCoordinates();\r\n  var result = [];\r\n  for (var i=1; i<line.length; i++) {\r\n    result = result.concat(ol_coordinate_sampleAt(line[i-1], line[i], d, i===1));\r\n  }\r\n  return new ol_geom_LineString(result);\r\n};\r\n\r\n/** Sample a MultiLineString at a distance\r\n * @param {number} d\r\n * @returns {ol_geom_MultiLineString}\r\n */\r\nol_geom_MultiLineString.prototype.sampleAt = function(d) {\r\n  var lines = this.getCoordinates();\r\n  var result = [];\r\n  lines.forEach(function(p) {\r\n    var l = [];\r\n    for (var i=1; i<p.length; i++) {\r\n      l = l.concat(ol_coordinate_sampleAt(p[i-1], p[i], d, i===1));\r\n    }\r\n    result.push(l);\r\n  })\r\n  return new ol_geom_MultiLineString(result);\r\n};\r\n\r\n/** Sample a Polygon at a distance\r\n * @param {number} d\r\n * @returns {ol_geom_Polygon}\r\n */\r\nol_geom_Polygon.prototype.sampleAt = function(res) {\r\n  var poly = this.getCoordinates();\r\n  var result = [];\r\n  poly.forEach(function(p) {\r\n    var l = [];\r\n    for (var i=1; i<p.length; i++) {\r\n      l = l.concat(ol_coordinate_sampleAt(p[i-1], p[i], res, i===1));\r\n    }\r\n    result.push(l);\r\n  })\r\n  return new ol_geom_Polygon(result);\r\n};\r\n\r\n/** Sample a MultiPolygon at a distance\r\n * @param {number} res\r\n * @returns {ol_geom_MultiPolygon}\r\n */\r\nol_geom_MultiPolygon.prototype.sampleAt = function(res) {\r\n  var mpoly = this.getCoordinates();\r\n  var result = [];\r\n  mpoly.forEach(function(poly) {\r\n    var a = [];\r\n    result.push(a);\r\n    poly.forEach(function(p) {\r\n      var l = [];\r\n      for (var i=1; i<p.length; i++) {\r\n        l = l.concat(ol_coordinate_sampleAt(p[i-1], p[i], res, i===1));\r\n      }\r\n      a.push(l);\r\n    })\r\n  });\r\n  return new ol_geom_MultiPolygon(result);\r\n};\r\n\r\n/** Intersect a geometry using a circle\r\n * @param {ol_geom_Geometry} geom\r\n * @param {number} resolution circle resolution to sample the polygon on the circle, default 1\r\n * @returns {ol_geom_Geometry}\r\n */\r\nol_geom_Circle.prototype.intersection = function(geom, resolution) {\r\n  if (geom.sampleAt) {\r\n    var ext = ol_extent_buffer(this.getCenter().concat(this.getCenter()), this.getRadius());\r\n    geom = ol_extent_intersection(ext, geom);\r\n    geom = geom.simplify(resolution);\r\n    var c = this.getCenter();\r\n    var r = this.getRadius();\r\n    //var res = (resolution||1) * r / 100;\r\n    var g = geom.sampleAt(resolution).getCoordinates();\r\n    switch (geom.getType()) {\r\n      case 'Polygon': g = [g];\r\n        // fallthrough\r\n      case 'MultiPolygon': {\r\n        var hasout = false;\r\n        // var hasin = false;\r\n        var result = [];\r\n        g.forEach(function(poly) {\r\n          var a = [];\r\n          result.push(a);\r\n          poly.forEach(function(ring) {\r\n            var l = [];\r\n            a.push(l);\r\n            ring.forEach(function(p) {\r\n              var d = ol_coordinate_dist2d(c, p);\r\n              if (d > r) {\r\n                hasout = true;\r\n                l.push([\r\n                  c[0] + r / d * (p[0]-c[0]),\r\n                  c[1] + r / d * (p[1]-c[1])\r\n                ]);\r\n              } else {\r\n                // hasin = true;\r\n                l.push(p);\r\n              }\r\n            });\r\n          })\r\n        });\r\n        if (!hasout) return geom;\r\n        if (geom.getType() === 'Polygon') {\r\n          return new ol_geom_Polygon(result[0]);\r\n        } else {\r\n          return new ol_geom_MultiPolygon(result);\r\n        }\r\n      }\r\n    }\r\n  } else {\r\n    console.warn('[ol/geom/Circle~intersection] Unsupported geometry type: '+geom.getType());\r\n  }\r\n  return geom;\r\n};\r\n","/*\tCopyright (c) 2019 Jean-Marc VIGLINO, \r\n  released under the CeCILL-B license (French BSD license)\r\n  (http://www.cecill.info/licences/Licence_CeCILL-B_V1-en.txt).\r\n*/\r\n\r\nimport ol_style_Style from 'ol/style/Style.js'\r\nimport {asString as ol_color_asString} from 'ol/color.js'\r\nimport {asArray as ol_color_asArray} from 'ol/color.js'\r\nimport {ol_coordinate_dist2d} from '../geom/GeomUtils.js'\r\n\r\n/** Flow line style\r\n * Draw LineString with a variable color / width\r\n * NB: the FlowLine style doesn't impress the hit-detection.\r\n * If you want your lines to be sectionable you have to add your own style to handle this.\r\n * (with transparent line: stroke color opacity to .1 or zero width)\r\n * @constructor\r\n * @extends {ol_style_Style}\r\n * @param {Object} options\r\n *  @param {boolean} options.visible draw only the visible part of the line, default true\r\n *  @param {number|function} options.width Stroke width or a function that gets a feature and the position (beetween [0,1]) and returns current width\r\n *  @param {number} options.width2 Final stroke width (if width is not a function)\r\n *  @param {number} options.arrow Arrow at start (-1), at end (1), at both (2), none (0), default geta\r\n *  @param {ol.colorLike|function} options.color Stroke color or a function that gets a feature and the position (beetween [0,1]) and returns current color\r\n *  @param {ol.colorLike} options.color2 Final sroke color if color is nor a function\r\n *  @param {ol.colorLike} options.arrowColor Color of arrows, if not defined used color or color2\r\n *  @param {string} options.lineCap CanvasRenderingContext2D.lineCap 'butt' | 'round' | 'square', default 'butt'\r\n *  @param {number|ol.size} options.arrowSize height and width of the arrow, default 16\r\n *  @param {boolean} [options.noOverlap=false] prevent segments overlaping\r\n *  @param {number} options.offset0 offset at line start\r\n *  @param {number} options.offset1 offset at line end\r\n */\r\nvar ol_style_FlowLine = class olstyleFlowLine extends ol_style_Style {\r\n  constructor(options) {\r\n    options = options || {}\r\n\r\n    super({\r\n      stroke: options.stroke,\r\n      text: options.text,\r\n      zIndex: options.zIndex,\r\n      geometry: options.geometry\r\n    })\r\n    this.setRenderer(this._render.bind(this))\r\n\r\n    // Draw only visible\r\n    this._visible = (options.visible !== false)\r\n\r\n    // Width\r\n    if (typeof options.width === 'function') {\r\n      this._widthFn = options.width\r\n    } else {\r\n      this.setWidth(options.width)\r\n    }\r\n    this.setWidth2(options.width2)\r\n    // Color\r\n    if (typeof options.color === 'function') {\r\n      this._colorFn = options.color\r\n    } else {\r\n      this.setColor(options.color)\r\n    }\r\n    this.setColor2(options.color2)\r\n    // LineCap\r\n    this.setLineCap(options.lineCap)\r\n    // Arrow\r\n    this.setArrow(options.arrow)\r\n    this.setArrowSize(options.arrowSize)\r\n    this.setArrowColor(options.arrowColor)\r\n    // Offset\r\n    this._offset = [0, 0]\r\n    this.setOffset(options.offset0, 0)\r\n    this.setOffset(options.offset1, 1)\r\n    // Overlap\r\n    this._noOverlap = options.noOverlap\r\n  }\r\n  /** Set the initial width\r\n   * @param {number} width width, default 0\r\n   */\r\n  setWidth(width) {\r\n    this._width = width || 0\r\n  }\r\n  /** Set the final width\r\n   * @param {number} width width, default 0\r\n   */\r\n  setWidth2(width) {\r\n    this._width2 = width\r\n  }\r\n  /** Get offset at start or end\r\n   * @param {number} where 0=start, 1=end\r\n   * @return {number} width\r\n   */\r\n  getOffset(where) {\r\n    return this._offset[where]\r\n  }\r\n  /** Add an offset at start or end\r\n   * @param {number} width\r\n   * @param {number} where 0=start, 1=end\r\n   */\r\n  setOffset(width, where) {\r\n    width = Math.max(0, parseFloat(width))\r\n    switch (where) {\r\n      case 0: {\r\n        this._offset[0] = width\r\n        break\r\n      }\r\n      case 1: {\r\n        this._offset[1] = width\r\n        break\r\n      }\r\n    }\r\n  }\r\n  /** Set the LineCap\r\n   * @param {steing} cap LineCap (round or butt), default butt\r\n   */\r\n  setLineCap(cap) {\r\n    this._lineCap = (cap === 'round' ? 'round' : 'butt')\r\n  }\r\n  /** Get the current width at step\r\n   * @param {ol.feature} feature\r\n   * @param {number} step current drawing step beetween [0,1]\r\n   * @return {number}\r\n   */\r\n  getWidth(feature, step) {\r\n    if (this._widthFn)\r\n      return this._widthFn(feature, step)\r\n    var w2 = (typeof (this._width2) === 'number') ? this._width2 : this._width\r\n    return this._width + (w2 - this._width) * step\r\n  }\r\n  /** Set the initial color\r\n   * @param {ol.colorLike} color\r\n   */\r\n  setColor(color) {\r\n    try {\r\n      this._color = ol_color_asArray(color)\r\n    } catch (e) {\r\n      this._color = [0, 0, 0, 1]\r\n    }\r\n  }\r\n  /** Set the final color\r\n   * @param {ol.colorLike} color\r\n   */\r\n  setColor2(color) {\r\n    try {\r\n      this._color2 = ol_color_asArray(color)\r\n    } catch (e) {\r\n      this._color2 = null\r\n    }\r\n  }\r\n  /** Set the arrow color\r\n   * @param {ol.colorLike} color\r\n   */\r\n  setArrowColor(color) {\r\n    try {\r\n      this._acolor = ol_color_asString(color)\r\n    } catch (e) {\r\n      this._acolor = null\r\n    }\r\n  }\r\n  /** Get the current color at step\r\n   * @param {ol.feature} feature\r\n   * @param {number} step current drawing step beetween [0,1]\r\n   * @return {string}\r\n   */\r\n  getColor(feature, step) {\r\n    if (this._colorFn)\r\n      return ol_color_asString(this._colorFn(feature, step))\r\n    var color = this._color\r\n    var color2 = this._color2 || this._color\r\n    return 'rgba(' +\r\n      +Math.round(color[0] + (color2[0] - color[0]) * step) + ','\r\n      + Math.round(color[1] + (color2[1] - color[1]) * step) + ','\r\n      + Math.round(color[2] + (color2[2] - color[2]) * step) + ','\r\n      + (color[3] + (color2[3] - color[3]) * step)\r\n      + ')'\r\n  }\r\n  /** Get arrow\r\n   */\r\n  getArrow() {\r\n    return this._arrow\r\n  }\r\n  /** Set arrow\r\n   * @param {number} n -1 | 0 | 1 | 2, default: 0\r\n   */\r\n  setArrow(n) {\r\n    this._arrow = parseInt(n)\r\n    if (this._arrow < -1 || this._arrow > 2)\r\n      this._arrow = 0\r\n  }\r\n  /** getArrowSize\r\n   * @return {ol.size}\r\n   */\r\n  getArrowSize() {\r\n    return this._arrowSize || [16, 16]\r\n  }\r\n  /** setArrowSize\r\n   * @param {number|ol.size} size\r\n   */\r\n  setArrowSize(size) {\r\n    if (Array.isArray(size))\r\n      this._arrowSize = size\r\n    else if (typeof (size) === 'number')\r\n      this._arrowSize = [size, size]\r\n  }\r\n  /** drawArrow\r\n   * @param {CanvasRenderingContext2D} ctx\r\n   * @param {ol.coordinate} p0\r\n   * @param ol.coordinate} p1\r\n   * @param {number} width\r\n   * @param {number} ratio pixelratio\r\n   * @private\r\n   */\r\n  drawArrow(ctx, p0, p1, width, ratio) {\r\n    var asize = this.getArrowSize()[0] * ratio\r\n    var l = ol_coordinate_dist2d(p0, p1)\r\n    var dx = (p0[0] - p1[0]) / l\r\n    var dy = (p0[1] - p1[1]) / l\r\n    width = Math.max(this.getArrowSize()[1] / 2, width / 2) * ratio\r\n    ctx.beginPath()\r\n    ctx.moveTo(p0[0], p0[1])\r\n    ctx.lineTo(p0[0] - asize * dx + width * dy, p0[1] - asize * dy - width * dx)\r\n    ctx.lineTo(p0[0] - asize * dx - width * dy, p0[1] - asize * dy + width * dx)\r\n    ctx.lineTo(p0[0], p0[1])\r\n    ctx.fill()\r\n  }\r\n  /** Renderer function\r\n   * @param {Array<ol.coordinate>} geom The pixel coordinates of the geometry in GeoJSON notation\r\n   * @param {ol.render.State} e The olx.render.State of the layer renderer\r\n   */\r\n  _render(geom, e) {\r\n    if (e.geometry.getType() === 'LineString') {\r\n      var i, g, p, ctx = e.context\r\n      // Get geometry used at drawing\r\n      if (!this._visible) {\r\n        var a = e.pixelRatio / e.resolution\r\n        var cos = Math.cos(e.rotation)\r\n        var sin = Math.sin(e.rotation)\r\n        g = e.geometry.getCoordinates()\r\n        var dx = geom[0][0] - g[0][0] * a * cos - g[0][1] * a * sin\r\n        var dy = geom[0][1] - g[0][0] * a * sin + g[0][1] * a * cos\r\n        geom = []\r\n        for (i = 0; p = g[i]; i++) {\r\n          geom[i] = [\r\n            dx + p[0] * a * cos + p[1] * a * sin,\r\n            dy + p[0] * a * sin - p[1] * a * cos,\r\n            p[2]\r\n          ]\r\n        }\r\n      }\r\n\r\n      var asize = this.getArrowSize()[0] * e.pixelRatio\r\n\r\n      ctx.save()\r\n      // Offsets\r\n      if (this.getOffset(0))\r\n        this._splitAsize(geom, this.getOffset(0) * e.pixelRatio)\r\n      if (this.getOffset(1))\r\n        this._splitAsize(geom, this.getOffset(1) * e.pixelRatio, true)\r\n      // Arrow 1\r\n      if (geom.length > 1 && (this.getArrow() === -1 || this.getArrow() === 2)) {\r\n        p = this._splitAsize(geom, asize)\r\n        if (this._acolor)\r\n          ctx.fillStyle = this._acolor\r\n        else\r\n          ctx.fillStyle = this.getColor(e.feature, 0)\r\n        this.drawArrow(ctx, p[0], p[1], this.getWidth(e.feature, 0), e.pixelRatio)\r\n      }\r\n      // Arrow 2 \r\n      if (geom.length > 1 && this.getArrow() > 0) {\r\n        p = this._splitAsize(geom, asize, true)\r\n        if (this._acolor)\r\n          ctx.fillStyle = this._acolor\r\n        else\r\n          ctx.fillStyle = this.getColor(e.feature, 1)\r\n        this.drawArrow(ctx, p[0], p[1], this.getWidth(e.feature, 1), e.pixelRatio)\r\n      }\r\n\r\n      // Split into\r\n      var geoms = this._splitInto(geom, 255, 2)\r\n      var k = 0\r\n      var nb = geoms.length\r\n\r\n      // Draw\r\n      ctx.lineJoin = 'round'\r\n      ctx.lineCap = this._lineCap || 'butt'\r\n\r\n      if (geoms.length > 1) {\r\n        for (k = 0; k < geoms.length; k++) {\r\n          var step = k / nb\r\n          g = geoms[k]\r\n          ctx.lineWidth = this.getWidth(e.feature, step) * e.pixelRatio\r\n          ctx.strokeStyle = this.getColor(e.feature, step)\r\n          ctx.beginPath()\r\n          ctx.moveTo(g[0][0], g[0][1])\r\n          for (i = 1; p = g[i]; i++) {\r\n            ctx.lineTo(p[0], p[1])\r\n          }\r\n          ctx.stroke()\r\n        }\r\n      }\r\n      ctx.restore()\r\n    }\r\n  }\r\n  /** Split extremity at\r\n   * @param {ol.geom.LineString} geom\r\n   * @param {number} asize\r\n   * @param {boolean} end start=false or end=true, default false (start)\r\n   */\r\n  _splitAsize(geom, asize, end) {\r\n    var p, p1, p0\r\n    var dl, d = 0\r\n    if (end)\r\n      p0 = geom.pop()\r\n    else\r\n      p0 = geom.shift()\r\n    p = p0\r\n    while (geom.length) {\r\n      if (end)\r\n        p1 = geom.pop()\r\n      else\r\n        p1 = geom.shift()\r\n      dl = ol_coordinate_dist2d(p, p1)\r\n      if (d + dl > asize) {\r\n        p = [p[0] + (p1[0] - p[0]) * (asize - d) / dl, p[1] + (p1[1] - p[1]) * (asize - d) / dl]\r\n        dl = ol_coordinate_dist2d(p, p0)\r\n        if (end) {\r\n          geom.push(p1)\r\n          geom.push(p)\r\n          geom.push([p[0] + (p0[0] - p[0]) / dl, p[1] + (p0[1] - p[1]) / dl])\r\n        } else {\r\n          geom.unshift(p1)\r\n          geom.unshift(p)\r\n          geom.unshift([p[0] + (p0[0] - p[0]) / dl, p[1] + (p0[1] - p[1]) / dl])\r\n        }\r\n        break\r\n      }\r\n      d += dl\r\n      p = p1\r\n    }\r\n    return [p0, p]\r\n  }\r\n  /** Split line geometry into equal length geometries\r\n   * @param {Array<ol.coordinate>} geom\r\n   * @param {number} nb number of resulting geometries, default 255\r\n   * @param {number} nim minimum length of the resulting geometries, default 1\r\n   */\r\n  _splitInto(geom, nb, min) {\r\n    var i, p\r\n    var dt = this._noOverlap ? 1 : .9\r\n    // Split geom into equal length geoms\r\n    var geoms = []\r\n    var dl, l = 0\r\n    for (i = 1; p = geom[i]; i++) {\r\n      l += ol_coordinate_dist2d(geom[i - 1], p)\r\n    }\r\n    var length = Math.max(min || 2, l / (nb || 255))\r\n    var p0 = geom[0]\r\n    l = 0\r\n    var g = [p0]\r\n    i = 1\r\n    p = geom[1]\r\n    while (i < geom.length) {\r\n      var dx = p[0] - p0[0]\r\n      var dy = p[1] - p0[1]\r\n      dl = Math.sqrt(dx * dx + dy * dy)\r\n      if (l + dl > length) {\r\n        var d = (length - l) / dl\r\n        g.push([\r\n          p0[0] + dx * d,\r\n          p0[1] + dy * d\r\n        ])\r\n        geoms.push(g)\r\n        p0 = [\r\n          p0[0] + dx * d * dt,\r\n          p0[1] + dy * d * dt\r\n        ]\r\n        g = [p0]\r\n        l = 0\r\n      } else {\r\n        l += dl\r\n        p0 = p\r\n        g.push(p0)\r\n        i++\r\n        p = geom[i]\r\n      }\r\n    }\r\n    geoms.push(g)\r\n    return geoms\r\n  }\r\n}\r\n\r\nexport default ol_style_FlowLine\r\n","import { isNumber } from 'lodash';\nimport Feature, { FeatureLike } from 'ol/Feature';\nimport OpenLayersMap from 'ol/Map';\nimport { Geometry, LineString, Point, SimpleGeometry } from 'ol/geom';\nimport VectorImage from 'ol/layer/VectorImage';\nimport { Fill, Stroke, Style, Text } from 'ol/style';\nimport FlowLine from 'ol-ext/style/FlowLine';\nimport { ReactNode } from 'react';\nimport { ReplaySubject } from 'rxjs';\nimport tinycolor from 'tinycolor2';\n\nimport {\n  MapLayerRegistryItem,\n  MapLayerOptions,\n  PanelData,\n  GrafanaTheme2,\n  FrameGeometrySourceMode,\n  EventBus,\n  DataFrame,\n  Field,\n  PluginState,\n} from '@grafana/data';\nimport { TextDimensionMode } from '@grafana/schema';\nimport { FrameVectorSource } from 'app/features/geo/utils/frameVectorSource';\nimport { getGeometryField, getLocationMatchers } from 'app/features/geo/utils/location';\nimport { GraphFrame } from 'app/plugins/panel/nodeGraph/types';\nimport { getGraphFrame } from 'app/plugins/panel/nodeGraph/utils';\n\nimport { MarkersLegendProps, MarkersLegend } from '../../components/MarkersLegend';\nimport { ObservablePropsWrapper } from '../../components/ObservablePropsWrapper';\nimport { StyleEditor } from '../../editor/StyleEditor';\nimport { StyleConfig, defaultStyleConfig } from '../../style/types';\nimport { getStyleConfigState } from '../../style/utils';\nimport { getStyleDimension } from '../../utils/utils';\n\nexport interface NetworkConfig {\n  style: StyleConfig;\n  showLegend?: boolean;\n  edgeStyle: StyleConfig;\n  arrow?: 0 | 1 | -1 | 2;\n}\n\nconst defaultOptions: NetworkConfig = {\n  style: defaultStyleConfig,\n  showLegend: false,\n  edgeStyle: defaultStyleConfig,\n  arrow: 0,\n};\n\nexport const NETWORK_LAYER_ID = 'network';\n\n// Used by default when nothing is configured\nexport const defaultMarkersConfig: MapLayerOptions<NetworkConfig> = {\n  type: NETWORK_LAYER_ID,\n  name: '', // will get replaced\n  config: defaultOptions,\n  location: {\n    mode: FrameGeometrySourceMode.Auto,\n  },\n};\n\n/**\n * Map layer configuration for network overlay\n */\nexport const networkLayer: MapLayerRegistryItem<NetworkConfig> = {\n  id: NETWORK_LAYER_ID,\n  name: 'Network',\n  description: 'Render a node graph as a map layer',\n  isBaseMap: false,\n  showLocation: true,\n  hideOpacity: true,\n  state: PluginState.beta,\n\n  /**\n   * Function that configures transformation and returns a transformer\n   * @param map\n   * @param options\n   * @param theme\n   */\n  create: async (map: OpenLayersMap, options: MapLayerOptions<NetworkConfig>, eventBus: EventBus, theme: GrafanaTheme2) => {\n    // Assert default values\n    const config = {\n      ...defaultOptions,\n      ...options?.config,\n    };\n\n    const style = await getStyleConfigState(config.style);\n    const edgeStyle = await getStyleConfigState(config.edgeStyle);\n    const location = await getLocationMatchers(options.location);\n    const source = new FrameVectorSource(location);\n    const vectorLayer = new VectorImage({\n      source\n    });\n    const hasArrows = config.arrow === 1 || config.arrow === -1 || config.arrow === 2;\n\n    // TODO update legend to display edges as well\n    const legendProps = new ReplaySubject<MarkersLegendProps>(1);\n    let legend: ReactNode = null;\n    if (config.showLegend) {\n      legend = <ObservablePropsWrapper watch={legendProps} initialSubProps={{}} child={MarkersLegend} />;\n    }\n\n    vectorLayer.setStyle((feature: FeatureLike) => {\n      const geom = feature.getGeometry();\n      const idx = feature.get('rowIndex');\n      const dims = style.dims;\n\n      if (!style.fields && !edgeStyle.fields && !hasArrows && geom?.getType() !== 'LineString') {\n        // Set a global style\n        return style.maker(style.base);\n      }\n\n      // For edges\n      if (geom?.getType() === 'LineString' && geom instanceof SimpleGeometry) {\n        const edgeDims = edgeStyle.dims;\n        const edgeTextConfig = edgeStyle.config.textConfig;\n        const edgeId = Number(feature.getId());\n        const coordinates = geom.getCoordinates();\n        const opacity = edgeStyle.config.opacity ?? 1;\n        if (coordinates && edgeDims) {\n          const segmentStartCoords = coordinates[0];\n          const segmentEndCoords = coordinates[1];\n          const color1 = tinycolor(\n            theme.visualization.getColorByName((edgeDims.color && edgeDims.color.get(edgeId)) ?? edgeStyle.base.color)\n          )\n            .setAlpha(opacity)\n            .toString();\n          const color2 = tinycolor(\n            theme.visualization.getColorByName((edgeDims.color && edgeDims.color.get(edgeId)) ?? edgeStyle.base.color)\n          )\n            .setAlpha(opacity)\n            .toString();\n          const arrowSize1 = (edgeDims.size && edgeDims.size.get(edgeId)) ?? edgeStyle.base.size;\n          const arrowSize2 = (edgeDims.size && edgeDims.size.get(edgeId)) ?? edgeStyle.base.size;\n          const styles = [];\n\n          const flowStyle = new FlowLine({\n            visible: true,\n            lineCap: config.arrow === 0 ? 'round' : 'square',\n            color: color1,\n            color2: color2,\n            width: (edgeDims.size && edgeDims.size.get(edgeId)) ?? edgeStyle.base.size,\n            width2: (edgeDims.size && edgeDims.size.get(edgeId)) ?? edgeStyle.base.size,\n          });\n\n          if (config.arrow) {\n            flowStyle.setArrow(config.arrow);\n            if (config.arrow > 0) {\n              flowStyle.setArrowColor(color2);\n              flowStyle.setArrowSize((arrowSize2 ?? 0) * 2);\n            } else {\n              flowStyle.setArrowColor(color1);\n              flowStyle.setArrowSize((arrowSize1 ?? 0) * 2);\n            }\n          }\n          const LS = new LineString([segmentStartCoords, segmentEndCoords]);\n          flowStyle.setGeometry(LS);\n\n          const fontFamily = theme.typography.fontFamily;\n          if (edgeDims.text || edgeStyle.config.text?.mode === TextDimensionMode.Fixed) {\n            const labelStyle = new Style({\n              zIndex: 10,\n              text: new Text({\n                text: edgeDims.text?.get(edgeId) ?? edgeStyle.config.text?.fixed,\n                font: `normal ${edgeTextConfig?.fontSize}px ${fontFamily}`,\n                fill: new Fill({ color: color1 ?? defaultStyleConfig.color.fixed }),\n                stroke: new Stroke({\n                  color: tinycolor(theme.visualization.getColorByName('text')).setAlpha(opacity).toString(),\n                  width: Math.max(edgeTextConfig?.fontSize! / 10, 1),\n                }),\n                ...edgeTextConfig,\n              }),\n            });\n            labelStyle.setGeometry(LS);\n            styles.push(labelStyle);\n          }\n          styles.push(flowStyle);\n          return styles;\n        }\n      }\n      if (!dims || !isNumber(idx)) {\n        return style.maker(style.base);\n      }\n\n      const values = { ...style.base };\n\n      if (dims.color) {\n        values.color = dims.color.get(idx);\n      }\n      if (dims.size) {\n        values.size = dims.size.get(idx);\n      }\n      if (dims.text) {\n        values.text = dims.text.get(idx);\n      }\n      if (dims.rotation) {\n        values.rotation = dims.rotation.get(idx);\n      }\n      return style.maker(values);\n    });\n\n    return {\n      init: () => vectorLayer,\n      legend: legend,\n      update: (data: PanelData) => {\n        if (!data.series?.length) {\n          source.clear();\n          return; // ignore empty\n        }\n\n        // Post updates to the legend component\n        if (legend) {\n          legendProps.next({\n            styleConfig: style,\n            size: style.dims?.size,\n            layerName: options.name,\n            layer: vectorLayer,\n          });\n        }\n        const graphFrames = getGraphFrame(data.series);\n\n        for (const frame of data.series) {\n          if (frame === graphFrames.edges[0]) {\n            edgeStyle.dims = getStyleDimension(frame, edgeStyle, theme);\n          } else {\n            style.dims = getStyleDimension(frame, style, theme);\n          }\n\n          updateEdge(source, graphFrames);\n        }\n      },\n\n      // Marker overlay options\n      registerOptionsUI: (builder, context) => {\n        const networkFrames = getGraphFrame(context.data);\n        const frameNodes = networkFrames.nodes[0];\n        const frameEdges = networkFrames.edges[0];\n\n        builder\n          .addCustomEditor({\n            id: 'config.style',\n            category: ['Node Styles'],\n            path: 'config.style',\n            name: 'Node Styles',\n            editor: StyleEditor,\n            settings: {\n              displayRotation: true,\n              frameMatcher: (frame: DataFrame) => frame === frameNodes,\n            },\n            defaultValue: defaultOptions.style,\n          })\n          .addCustomEditor({\n            id: 'config.edgeStyle',\n            category: ['Edge Styles'],\n            path: 'config.edgeStyle',\n            name: 'Edge Styles',\n            editor: StyleEditor,\n            settings: {\n              hideSymbol: true,\n              frameMatcher: (frame: DataFrame) => frame === frameEdges,\n            },\n            defaultValue: defaultOptions.style,\n          })\n          .addRadio({\n            path: 'config.arrow',\n            name: 'Arrow',\n            settings: {\n              options: [\n                { label: 'None', value: 0 },\n                { label: 'Forward', value: 1 },\n                { label: 'Reverse', value: -1 },\n                { label: 'Both', value: 2 },\n              ],\n            },\n            defaultValue: defaultOptions.arrow,\n          })\n          .addBooleanSwitch({\n            path: 'config.showLegend',\n            name: 'Show legend',\n            description: 'Show map legend',\n            defaultValue: defaultOptions.showLegend,\n          });\n      },\n    };\n  },\n\n  // fill in the default values\n  defaultOptions,\n};\n\nfunction updateEdge(source: FrameVectorSource, graphFrames: GraphFrame) {\n  source.clear(true);\n\n  const frameNodes = graphFrames.nodes[0];\n  const frameEdges = graphFrames.edges[0];\n\n  if (!frameNodes || !frameEdges) {\n    // TODO: provide helpful error message / link to docs for how to format data\n    return;\n  }\n\n  const info = getGeometryField(frameNodes, source.location);\n  if (!info.field) {\n    source.changed();\n    return;\n  }\n\n  // TODO: Fix this\n  // eslint-disable-next-line\n  const field = info.field as unknown as Field<Point>;\n\n  // TODO for nodes, don't hard code id field name\n  const nodeIdIndex = frameNodes.fields.findIndex((f: Field) => f.name === 'id');\n  const nodeIdValues = frameNodes.fields[nodeIdIndex].values;\n\n  // Edges\n  // TODO for edges, don't hard code source and target fields\n  const sourceIndex = frameEdges.fields.findIndex((f: Field) => f.name === 'source');\n  const targetIndex = frameEdges.fields.findIndex((f: Field) => f.name === 'target');\n\n  const sources = frameEdges.fields[sourceIndex].values;\n  const targets = frameEdges.fields[targetIndex].values;\n\n  // Loop through edges, referencing node locations\n  for (let i = 0; i < sources.length; i++) {\n    // Create linestring for each edge\n    const sourceId = sources[i];\n    const targetId = targets[i];\n\n    const sourceNodeIndex = nodeIdValues.findIndex((value: string) => value === sourceId);\n    const targetNodeIndex = nodeIdValues.findIndex((value: string) => value === targetId);\n\n    if (!field.values[sourceNodeIndex] || !field.values[targetNodeIndex]) {\n      continue;\n    }\n\n    const geometryEdge: Geometry = new LineString([\n      field.values[sourceNodeIndex].getCoordinates(),\n      field.values[targetNodeIndex].getCoordinates(),\n    ]);\n\n    const edgeFeature = new Feature({\n      geometry: geometryEdge,\n    });\n    edgeFeature.setId(i);\n    source['addFeatureInternal'](edgeFeature); // @TODO revisit?\n  }\n\n  // Nodes\n  for (let i = 0; i < frameNodes.length; i++) {\n    source['addFeatureInternal'](\n      new Feature({\n        frameNodes,\n        rowIndex: i,\n        geometry: info.field.values[i],\n      })\n    );\n  }\n\n  // only call source at the end\n  source.changed();\n}\n","/*\tCopyright (c) 2015 Jean-Marc VIGLINO, \r\n  released under the CeCILL-B license (French BSD license)\r\n  (http://www.cecill.info/licences/Licence_CeCILL-B_V1-en.txt).\r\n*\r\n*  Photo style for vector features\r\n*/\r\nimport ol_style_RegularShape from 'ol/style/RegularShape.js'\r\nimport {asString as ol_color_asString} from 'ol/color.js'\r\nimport ol_style_Stroke from 'ol/style/Stroke.js'\r\nimport ol_style_Fill from 'ol/style/Fill.js'\r\n\r\n/**\r\n * @classdesc\r\n * Set Photo style for vector features.\r\n *\r\n * @constructor\r\n * @param {} options\r\n *  @param { default | square | circle | anchored | folio } options.kind\r\n *  @param {boolean} options.crop crop within square, default is false\r\n *  @param {Number} options.radius symbol size\r\n *  @param {Number} [options.shadow=0] drop a shadow (the shadow width in pixel)\r\n *  @param {string} [options.declutterMode] Declutter mode \"declutter\" | \"obstacle\" | \"none\" | undefined\t\r\n *  @param {ol_style_Stroke} options.stroke\r\n *  @param {String} options.src image src\r\n *  @param {String} options.crossOrigin The crossOrigin attribute for loaded images. Note that you must provide a crossOrigin value if you want to access pixel data with the Canvas renderer.\r\n *  @param {Array<number>} [options.displacement] to use with ol > 6\r\n * \t@param {number} [options.offsetX=0] Horizontal offset in pixels, deprecated use displacement with ol>6\r\n * \t@param {number} [options.offsetY=0] Vertical offset in pixels, deprecated use displacement with ol>6\r\n *  @param {function} [options.onload] callback when image is loaded (to redraw the layer)\r\n *  @param {function} [options.onerror] callback when image is on error (not loaded)\r\n * @extends {ol_style_RegularShape}\r\n * @implements {ol.structs.IHasChecksum}\r\n * @api\r\n */\r\nvar ol_style_Photo = class olstylePhoto extends ol_style_RegularShape {\r\n  constructor(options) {\r\n    options = options || {}\r\n    if (!options.displacement){\r\n      options.displacement = [options.offsetX || 0, -options.offsetY || 0]\r\n    }\r\n    var sanchor = (options.kind === \"anchored\" ? 8 : 0)\r\n    var shadow = (Number(options.shadow) || 0)\r\n    if (!options.stroke) {\r\n      options.stroke = new ol_style_Stroke({ width: 0, color: \"#000\" })\r\n    }\r\n    var strokeWidth = options.stroke.getWidth()\r\n    if (strokeWidth < 0) strokeWidth = 0;\r\n    if (options.kind == 'folio') strokeWidth += 6;\r\n    options.stroke.setWidth(strokeWidth)\r\n\r\n    super({\r\n      radius: options.radius + strokeWidth + sanchor / 2 + shadow / 2,\r\n      points: 0,\r\n      displacement: [options.displacement[0] || 0, (options.displacement[1] || 0) + sanchor],\r\n      // No fill to create a hit detection Image (v5) or transparent (v6) \r\n      fill: ol_style_RegularShape.prototype.render ? new ol_style_Fill({ color: [0, 0, 0, 0] }) : null,\r\n      declutterMode: options.declutterMode,\r\n    })\r\n    this.sanchor_ = sanchor;\r\n    this._shadow = shadow;\r\n\r\n    // Hack to get the hit detection Image (v4.6.5 ?)\r\n    if (!this.getHitDetectionImage) {\r\n      var img = super.getImage.call(this)\r\n      if (!this.hitDetectionCanvas_) {\r\n        for (var i in this) {\r\n          if (this[i] && this[i].getContext && this[i] !== img) {\r\n            this.hitDetectionCanvas_ = this[i]\r\n            break\r\n          }\r\n        }\r\n      }\r\n      // Clone canvas for hit detection (old versions)\r\n      this.hitDetectionCanvas_ = document.createElement('canvas')\r\n      this.hitDetectionCanvas_.width = img.width\r\n      this.hitDetectionCanvas_.height = img.height\r\n      var hit = this.hitDetectionCanvas_\r\n      this.getHitDetectionImage = function () {\r\n        return hit\r\n      }\r\n    }\r\n\r\n    this._stroke = options.stroke\r\n    this._fill = options.fill\r\n    this._crop = options.crop\r\n    this._crossOrigin = options.crossOrigin\r\n    this._kind = options.kind || \"default\"\r\n\r\n    this._radius = options.radius\r\n    this._src = options.src\r\n\r\n    this._offset = [options.offsetX ? options.offsetX : 0, options.offsetY ? options.offsetY : 0]\r\n\r\n    this._onload = options.onload\r\n    this._onerror = options.onerror\r\n\r\n    if (typeof (options.opacity) == 'number'){\r\n      this.setOpacity(options.opacity)\r\n    }\r\n    if (typeof (options.rotation) == 'number'){\r\n      this.setRotation(options.rotation)\r\n    }\r\n\r\n    // Calculate image\r\n    this.render();\r\n    this.getImage()\r\n  }\r\n  /** Set photo offset\r\n   * @param {ol.pixel} offset\r\n   */\r\n  setOffset(offset) {\r\n    this._offset = [offset[0] || 0, offset[1] || 0]\r\n    this.render()\r\n    this.getImage()\r\n  }\r\n  /**\r\n   * Clones the style.\r\n   * @return {ol_style_Photo}\r\n   */\r\n  clone() {\r\n    var i = new ol_style_Photo({\r\n      stroke: this._stroke,\r\n      fill: this._fill,\r\n      shadow: this._shadow,\r\n      crop: this._crop,\r\n      crossOrigin: this._crossOrigin,\r\n      kind: this._kind,\r\n      radius: this._radius,\r\n      src: this._src,\r\n      offsetX: this._offset[0],\r\n      offsetY: this._offset[1],\r\n      opacity: this.getOpacity(),\r\n      rotation: this.getRotation(),\r\n      declutterMode: this.getDeclutterMode ? this.getDeclutterMode() : null,\r\n    })\r\n    i.render()\r\n    i.getImage()\r\n    return i\r\n  }\r\n  /**\r\n   * Draw the form without the image\r\n   * @private\r\n   */\r\n  drawBack_(context, color, strokeWidth, pixelratio) {\r\n    var shadow = this._shadow\r\n    var canvas = context.canvas\r\n    context.beginPath()\r\n    context.fillStyle = color\r\n    context.clearRect(0, 0, canvas.width, canvas.height)\r\n    var width = canvas.width / pixelratio\r\n    var height = canvas.height / pixelratio\r\n    switch (this._kind) {\r\n      case 'square': {\r\n        context.rect(0, 0, width - shadow, height - shadow)\r\n        break\r\n      }\r\n      case 'circle': {\r\n        context.arc(this._radius + strokeWidth, this._radius + strokeWidth, this._radius + strokeWidth, 0, 2 * Math.PI, false)\r\n        break\r\n      }\r\n      case 'folio': {\r\n        var offset = 6\r\n        strokeWidth -= offset\r\n        context.strokeStyle = 'rgba(0,0,0,0.5)'\r\n        context.lineWidth = 1\r\n        var w = width - shadow - 2 * offset\r\n        var a = Math.atan(6 / w)\r\n        context.save()\r\n        context.rotate(-a)\r\n        context.translate(-6, 2)\r\n        context.beginPath()\r\n        context.rect(offset, offset, w, w)\r\n        context.stroke()\r\n        context.fill()\r\n        context.restore()\r\n        context.save()\r\n        context.translate(6, -1)\r\n        context.rotate(a)\r\n        context.beginPath()\r\n        context.rect(offset, offset, w, w)\r\n        context.stroke()\r\n        context.fill()\r\n        context.restore()\r\n        context.beginPath()\r\n        context.rect(offset, offset, w, w)\r\n        context.stroke()\r\n        break\r\n      }\r\n      case 'anchored': {\r\n        context.roundRect(this.sanchor_ / 2, 0, width - this.sanchor_ - shadow, height - this.sanchor_ - shadow, strokeWidth)\r\n        context.moveTo(width / 2 - this.sanchor_ - shadow / 2, height - this.sanchor_ - shadow)\r\n        context.lineTo(width / 2 + this.sanchor_ - shadow / 2, height - this.sanchor_ - shadow)\r\n        context.lineTo(width / 2 - shadow / 2, height - shadow); break\r\n      }\r\n      default: {\r\n        // roundrect\r\n        context.roundRect(0, 0, width - shadow, height - shadow, strokeWidth)\r\n        break\r\n      }\r\n    }\r\n    context.closePath()\r\n  }\r\n  /**\r\n   * @return {RenderOptions}  The render options\r\n   */\r\n  createRenderOptions() {\r\n    var opt = super.createRenderOptions()\r\n    opt.photoOptions = [\r\n        'photo', \r\n        this._crossOrigin,\r\n        this._crop,\r\n        this._src,\r\n        this._shadow,\r\n        this._kind,\r\n      ].join('-')\r\n    return opt;\r\n  }\r\n  /**\r\n   * Get the image icon.\r\n   * @param {number} pixelRatio Pixel ratio.\r\n   * @return {HTMLCanvasElement} Image or Canvas element.\r\n   * @api\r\n   */\r\n  getImage(pixelratio) {\r\n    pixelratio = pixelratio || window.devicePixelRatio;\r\n    var canvas = super.getImage(pixelratio)\r\n    if ((this._gethit || this.img_) && this._currentRatio === pixelratio) return canvas;\r\n    // Calculate image at pixel ratio\r\n    this._currentRatio = pixelratio;\r\n\r\n    var strokeStyle\r\n    var strokeWidth = 0\r\n    if (this._stroke) {\r\n      strokeStyle = ol_color_asString(this._stroke.getColor())\r\n      strokeWidth = this._stroke.getWidth()\r\n    }\r\n\r\n    // Draw hitdetection image\r\n    this._gethit = true\r\n      var context = this.getHitDetectionImage().getContext('2d')\r\n      context.save()\r\n      context.setTransform(1, 0, 0, 1, 0, 0)\r\n      this.drawBack_(context, \"#000\", strokeWidth, 1)\r\n      context.fill()\r\n      context.restore()\r\n    this._gethit = false\r\n\r\n    // Draw the image\r\n    context = canvas.getContext('2d')\r\n    context.save()\r\n    context.setTransform(pixelratio, 0, 0, pixelratio, 0, 0)\r\n    this.drawBack_(context, strokeStyle, strokeWidth, pixelratio)\r\n\r\n    // Draw a shadow\r\n    if (this._shadow) {\r\n      context.shadowColor = 'rgba(0,0,0,0.5)'\r\n      context.shadowBlur = pixelratio * this._shadow / 2\r\n      context.shadowOffsetX = pixelratio * this._shadow / 2\r\n      context.shadowOffsetY = pixelratio * this._shadow / 2\r\n    }\r\n    context.fill()\r\n    context.restore()\r\n\r\n    var self = this\r\n    var img = this.img_ = new Image()\r\n    if (this._crossOrigin) img.crossOrigin = this._crossOrigin\r\n    img.src = this._src\r\n\r\n    // Draw image\r\n    if (img.width) {\r\n      self.drawImage_(canvas, img, pixelratio)\r\n    } else {\r\n      img.onload = function () {\r\n        self.drawImage_(canvas, img, pixelratio)\r\n        // Force change (?!)\r\n        // self.setScale(1);\r\n        if (self._onload) self._onload()\r\n      }\r\n      if (self._onerror) {\r\n        img.onerror = function () {\r\n          self._onerror()\r\n        }\r\n      }\r\n    }\r\n\r\n    // Set anchor (ol < 6)\r\n    if (!this.getDisplacement) {\r\n      var a = this.getAnchor()\r\n      a[0] = (canvas.width / pixelratio - this._shadow) / 2 - this._offset[0]\r\n      if (this.sanchor_) {\r\n        a[1] = canvas.height / pixelratio - this._shadow - this._offset[1]\r\n      } else {\r\n        a[1] = (canvas.height / pixelratio - this._shadow) / 2 - this._offset[1]\r\n      }\r\n    }\r\n\r\n    return canvas\r\n  }\r\n  /** Returns the photo image\r\n   * @returns {HTMLImageElement}\r\n   */\r\n  getPhoto() {\r\n    return this.img_\r\n  }\r\n  /**\r\n   * Draw an timage when loaded\r\n   * @private\r\n   */\r\n  drawImage_(canvas, img, pixelratio) {\r\n    // Remove the circle on the canvas\r\n    var context = (canvas.getContext('2d'))\r\n\r\n    var strokeWidth = 0\r\n    if (this._stroke)\r\n      strokeWidth = this._stroke.getWidth()\r\n    var size = 2 * this._radius\r\n\r\n    context.save()\r\n    if (ol_style_RegularShape.prototype.render)\r\n      context.setTransform(pixelratio, 0, 0, pixelratio, 0, 0)\r\n    if (this._kind == 'circle') {\r\n      context.beginPath()\r\n      context.arc(this._radius + strokeWidth, this._radius + strokeWidth, this._radius, 0, 2 * Math.PI, false)\r\n      context.clip()\r\n    }\r\n    var s, x, y, w, h, sx, sy, sw, sh\r\n    // Crop the image to a square vignette\r\n    if (this._crop) {\r\n      s = Math.min(img.width / size, img.height / size)\r\n      sw = sh = s * size\r\n      sx = (img.width - sw) / 2\r\n      sy = (img.height - sh) / 2\r\n\r\n      x = y = 0\r\n      w = h = size + 1\r\n    } else {\r\n      // Fit the image to the size\r\n      s = Math.min(size / img.width, size / img.height)\r\n      sx = sy = 0\r\n      sw = img.width\r\n      sh = img.height\r\n\r\n      w = s * sw\r\n      h = s * sh\r\n      x = (size - w) / 2\r\n      y = (size - h) / 2\r\n    }\r\n    x += strokeWidth + this.sanchor_ / 2\r\n    y += strokeWidth\r\n\r\n    context.drawImage(img, sx, sy, sw, sh, x, y, w, h)\r\n\r\n    // Draw a circle to avoid aliasing on clip\r\n    if (this._kind == 'circle' && strokeWidth) {\r\n      context.beginPath()\r\n      context.strokeStyle = ol_color_asString(this._stroke.getColor())\r\n      context.lineWidth = strokeWidth / 4\r\n      context.arc(this._radius + strokeWidth, this._radius + strokeWidth, this._radius, 0, 2 * Math.PI, false)\r\n      context.stroke()\r\n    }\r\n    context.restore()\r\n  }\r\n}\r\n\r\n/**\r\n * Draws a rounded rectangle using the current state of the canvas. \r\n * Draw a rectangle if the radius is null.\r\n * @param {Number} x The top left x coordinate\r\n * @param {Number} y The top left y coordinate \r\n * @param {Number} width The width of the rectangle \r\n * @param {Number} height The height of the rectangle\r\n * @param {Number} radius The corner radius.\r\n */\r\nCanvasRenderingContext2D.prototype.roundRect = function (x, y, w, h, r) {\r\n  if (!r) {\r\n    this.rect(x,y,w,h);\r\n  } else {\r\n    if (w < 2 * r) r = w / 2;\r\n    if (h < 2 * r) r = h / 2;\r\n    this.beginPath();\r\n    this.moveTo(x+r, y);\r\n    this.arcTo(x+w, y, x+w, y+h, r);\r\n    this.arcTo(x+w, y+h, x, y+h, r);\r\n    this.arcTo(x, y+h, x, y, r);\r\n    this.arcTo(x, y, x+w, y, r);\r\n    this.closePath();\r\n  }\r\n  return this;\r\n};\r\n\r\nexport default ol_style_Photo\r\n","import { FeatureLike } from 'ol/Feature';\nimport OpenLayersMap from 'ol/Map';\nimport VectorImage from 'ol/layer/VectorImage';\nimport { Stroke, Style } from 'ol/style';\nimport Photo from 'ol-ext/style/Photo';\n\nimport {\n  MapLayerRegistryItem,\n  PanelData,\n  GrafanaTheme2,\n  EventBus,\n  PluginState,\n  FieldType,\n  Field,\n  MapLayerOptions,\n} from '@grafana/data';\nimport { t } from '@grafana/i18n';\nimport { FrameGeometrySourceMode } from '@grafana/schema';\nimport { findField } from 'app/features/dimensions/utils';\nimport { FrameVectorSource } from 'app/features/geo/utils/frameVectorSource';\nimport { getLocationMatchers } from 'app/features/geo/utils/location';\n\n// Configuration options for Circle overlays\nexport interface PhotoConfig {\n  kind: 'square' | 'circle' | 'anchored' | 'folio';\n  border: number; // Sets border width around images\n  shadow: boolean; // Renders drop shadow behind images\n  crop: boolean; // Crops images to fill shape\n  src?: string; // Image source field\n  radius: number; // Image radius\n  color: string; // Border color\n}\n\nconst defaultOptions: PhotoConfig = {\n  kind: 'square',\n  border: 2,\n  shadow: true,\n  crop: true,\n  radius: 20,\n  color: 'rgb(200, 200, 200)',\n};\n\nexport const PHOTOS_LAYER_ID = 'photos';\n\n// Used by default when nothing is configured\nexport const defaultPhotosConfig: MapLayerOptions<PhotoConfig> = {\n  type: PHOTOS_LAYER_ID,\n  name: '', // will get replaced\n  config: defaultOptions,\n  location: {\n    mode: FrameGeometrySourceMode.Auto,\n  },\n  tooltip: true,\n};\n\n// TODO Find a way to use SVG scaled to behave like a png, currently using base64 conversion\n//const unknownImageSVG = '../../../../../public/img/icons/unicons/question-circle.svg';\nconst unknownImage =\n  'data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAyNCAyNCIgd2lkdGg9IjI0IiBoZWlnaHQ9IjI0IiBjbGFzcz0iY3NzLWV5eDRkbyI+PHBhdGggZD0iTTExLjI5LDE1LjI5YTEuNTgsMS41OCwwLDAsMC0uMTIuMTUuNzYuNzYsMCwwLDAtLjA5LjE4LjY0LjY0LDAsMCwwLS4wNi4xOCwxLjM2LDEuMzYsMCwwLDAsMCwuMi44NC44NCwwLDAsMCwuMDguMzguOS45LDAsMCwwLC41NC41NC45NC45NCwwLDAsMCwuNzYsMCwuOS45LDAsMCwwLC41NC0uNTRBMSwxLDAsMCwwLDEzLDE2YTEsMSwwLDAsMC0uMjktLjcxQTEsMSwwLDAsMCwxMS4yOSwxNS4yOVpNMTIsMkExMCwxMCwwLDEsMCwyMiwxMiwxMCwxMCwwLDAsMCwxMiwyWm0wLDE4YTgsOCwwLDEsMSw4LThBOCw4LDAsMCwxLDEyLDIwWk0xMiw3QTMsMywwLDAsMCw5LjQsOC41YTEsMSwwLDEsMCwxLjczLDFBMSwxLDAsMCwxLDEyLDlhMSwxLDAsMCwxLDAsMiwxLDEsMCwwLDAtMSwxdjFhMSwxLDAsMCwwLDIsMHYtLjE4QTMsMywwLDAsMCwxMiw3WiI+PC9wYXRoPjwvc3ZnPgo=';\nconst blankPixel =\n  'data:image/svg+xml;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mNk+M9QDwADhgGAWjR9awAAAABJRU5ErkJggg==';\nlet photoLoad: number[] = []; // TODO find a better way to manage this, used to track image load\n\n/**\n * Map layer configuration for circle overlay\n */\nexport const photosLayer: MapLayerRegistryItem<PhotoConfig> = {\n  id: PHOTOS_LAYER_ID,\n  name: 'Photos',\n  description: 'Render photos at each data point',\n  isBaseMap: false,\n  showLocation: true,\n  hideOpacity: true,\n  state: PluginState.beta,\n\n  /**\n   * Function that configures transformation and returns a transformer\n   * @param map\n   * @param options\n   * @param theme\n   */\n  create: async (map: OpenLayersMap, options: MapLayerOptions<PhotoConfig>, eventBus: EventBus, theme: GrafanaTheme2) => {\n    // Assert default values\n    const config = {\n      ...defaultOptions,\n      ...options?.config,\n    };\n\n    const location = await getLocationMatchers(options.location);\n    const source = new FrameVectorSource(location);\n    const vectorLayer = new VectorImage({\n      source,\n    });\n\n    let images: string[] = [];\n\n    vectorLayer.setStyle((feature: FeatureLike) => {\n      let src = unknownImage;\n      let idx = Infinity;\n      if (images.length > 0) {\n        idx = feature.get('rowIndex');\n        src = images[idx] ?? unknownImage;\n      }\n      const photoStyle = new Style({\n        image: new Photo({\n          src,\n          radius: config.radius,\n          crop: config.crop,\n          kind: config.kind,\n          shadow: 0,\n          stroke: new Stroke({\n            width: 0,\n            color: 'rgba(0,0,0,0)',\n          }),\n          onload: () => {\n            vectorLayer.changed(); // ensure vector layer is rendered properly after image load\n            if (photoLoad && !photoLoad.includes(idx)) {\n              photoLoad.push(idx);\n            }\n          },\n        }),\n      });\n      const blankStyle = new Style({\n        image: new Photo({\n          src: blankPixel,\n          radius: config.radius,\n          crop: false,\n          kind: config.kind,\n          shadow: config.shadow ? 2 : 0,\n          stroke: new Stroke({\n            width: config.border ?? 0,\n            color: theme.visualization.getColorByName(config.color),\n          }),\n          onload: () => {\n            vectorLayer.changed(); // ensure vector layer is rendered properly after image load\n          },\n        }),\n      });\n      const errorStyle = new Style({\n        image: new Photo({\n          src: unknownImage,\n          radius: config.radius,\n          crop: false,\n          kind: config.kind,\n          shadow: 0,\n          stroke: new Stroke({\n            width: 0,\n            color: 'rgba(0,0,0,0)',\n          }),\n          onload: () => {\n            vectorLayer.changed(); // ensure vector layer is rendered properly after image load\n          },\n        }),\n      });\n      if (photoLoad && photoLoad.includes(idx)) {\n        return [blankStyle, photoStyle];\n      }\n      // If image index is not in the loaded array, return layer stack with error\n      return [blankStyle, errorStyle, photoStyle];\n    });\n\n    return {\n      init: () => vectorLayer,\n      update: (data: PanelData) => {\n        if (!data.series?.length) {\n          source.clear();\n          return; // ignore empty\n        }\n\n        for (const frame of data.series) {\n          source.update(frame);\n\n          // Pick field from config, otherwise use first string field\n          if (config.src) {\n            const srcField: Field | undefined = findField(frame, config.src);\n            if (srcField) {\n              images = srcField?.values;\n            }\n          } else {\n            for (let i = 0; i < frame.fields.length; i++) {\n              const field = frame.fields[i];\n              if (field.type === FieldType.string) {\n                images = field.values;\n                break;\n              }\n            }\n          }\n          break; // Only the first frame for now!\n        }\n      },\n\n      // Marker overlay options\n      registerOptionsUI: (builder) => {\n        builder\n          .addFieldNamePicker({\n            path: `config.src`,\n            name: 'Image Source field',\n            settings: {\n              filter: (f: Field) => f.type === FieldType.string,\n              noFieldsMessage: t('geomap.photos-layer.noFieldsMessage-no-string-fields', 'No string fields found'),\n            },\n          })\n          .addRadio({\n            path: 'config.kind',\n            name: 'Kind',\n            settings: {\n              options: [\n                { label: 'Square', value: 'square' },\n                { label: 'Circle', value: 'circle' },\n                { label: 'Anchored', value: 'anchored' },\n                { label: 'Folio', value: 'folio' },\n              ],\n            },\n            defaultValue: defaultOptions.kind,\n          })\n          .addBooleanSwitch({\n            path: 'config.crop',\n            name: 'Crop',\n            settings: {},\n            defaultValue: defaultOptions.crop,\n          })\n          .addBooleanSwitch({\n            path: 'config.shadow',\n            name: 'Shadow',\n            settings: {},\n            defaultValue: defaultOptions.shadow,\n          })\n          .addSliderInput({\n            path: 'config.border',\n            name: 'Border',\n            settings: {\n              min: 0,\n              max: 10,\n            },\n            defaultValue: defaultOptions.border,\n          })\n          .addColorPicker({\n            path: 'config.color',\n            name: 'Border color',\n            defaultValue: defaultOptions.color,\n            settings: [{ enableNamedColors: false }],\n          })\n          .addSliderInput({\n            path: 'config.radius',\n            name: 'Radius',\n            settings: {\n              min: 1,\n              max: 100,\n            },\n            defaultValue: defaultOptions.radius,\n          });\n      },\n    };\n  },\n\n  // fill in the default values\n  defaultOptions,\n};\n","import { isNumber } from 'lodash';\nimport Feature, { FeatureLike } from 'ol/Feature';\nimport OpenLayersMap from 'ol/Map';\nimport { LineString, Point, SimpleGeometry } from 'ol/geom';\nimport { Group as LayerGroup } from 'ol/layer';\nimport VectorImage from 'ol/layer/VectorImage';\nimport VectorSource from 'ol/source/Vector';\nimport { Fill, Stroke, Style, Circle } from 'ol/style';\nimport FlowLine from 'ol-ext/style/FlowLine';\nimport { Subscription, throttleTime } from 'rxjs';\nimport tinycolor from 'tinycolor2';\n\nimport {\n  MapLayerRegistryItem,\n  PanelData,\n  GrafanaTheme2,\n  PluginState,\n  EventBus,\n  DataHoverEvent,\n  DataHoverClearEvent,\n  DataFrame,\n  FieldType,\n  colorManipulator,\n  MapLayerOptions,\n} from '@grafana/data';\nimport { FrameGeometrySourceMode } from '@grafana/schema';\nimport { FrameVectorSource } from 'app/features/geo/utils/frameVectorSource';\nimport { getGeometryField, getLocationMatchers } from 'app/features/geo/utils/location';\n\nimport { StyleEditor } from '../../editor/StyleEditor';\nimport { routeStyle } from '../../style/markers';\nimport { defaultStyleConfig, StyleConfig } from '../../style/types';\nimport { getStyleConfigState } from '../../style/utils';\nimport { getStyleDimension, isSegmentVisible } from '../../utils/utils';\n\n// Configuration options for Circle overlays\nexport interface RouteConfig {\n  style: StyleConfig;\n  arrow?: 0 | 1 | -1;\n}\n\nconst defaultOptions: RouteConfig = {\n  style: {\n    ...defaultStyleConfig,\n    opacity: 1,\n    lineWidth: 2,\n  },\n  arrow: 0,\n};\n\nexport const ROUTE_LAYER_ID = 'route';\n\n// Used by default when nothing is configured\nexport const defaultRouteConfig: MapLayerOptions<RouteConfig> = {\n  type: ROUTE_LAYER_ID,\n  name: '', // will get replaced\n  config: defaultOptions,\n  location: {\n    mode: FrameGeometrySourceMode.Auto,\n  },\n  tooltip: false,\n};\n\nenum mapIndex {\n  x1 = 0,\n  y1 = 1,\n  x2 = 2,\n  y2 = 3,\n}\n\nconst crosshairColor = '#607D8B';\n\n/**\n * Map layer configuration for circle overlay\n */\nexport const routeLayer: MapLayerRegistryItem<RouteConfig> = {\n  id: ROUTE_LAYER_ID,\n  name: 'Route',\n  description: 'Render data points as a route',\n  isBaseMap: false,\n  showLocation: true,\n  state: PluginState.beta,\n\n  /**\n   * Function that configures transformation and returns a transformer\n   * @param options\n   */\n  create: async (map: OpenLayersMap, options: MapLayerOptions<RouteConfig>, eventBus: EventBus, theme: GrafanaTheme2) => {\n    // Assert default values\n    const config = {\n      ...defaultOptions,\n      ...options?.config,\n    };\n\n    const style = await getStyleConfigState(config.style);\n    const location = await getLocationMatchers(options.location);\n    const source = new FrameVectorSource(location);\n    const vectorLayer = new VectorImage({ source });\n    const hasArrows = config.arrow === 1 || config.arrow === -1;\n\n    if (!style.fields && !hasArrows) {\n      // Set a global style\n      const styleBase = routeStyle(style.base);\n      if (style.config.size && style.config.size.fixed) {\n        // Applies width to base style if specified\n        styleBase.getStroke()?.setWidth(style.config.size.fixed);\n      }\n      vectorLayer.setStyle(styleBase);\n    } else {\n      vectorLayer.setStyle((feature: FeatureLike) => {\n        const idx: number = feature.get('rowIndex');\n        const dims = style.dims;\n        if (!dims || !isNumber(idx)) {\n          return routeStyle(style.base);\n        }\n\n        const styles = [];\n        const geom = feature.getGeometry();\n        const opacity = style.config.opacity ?? 1;\n        if (geom instanceof SimpleGeometry) {\n          const coordinates = geom.getCoordinates();\n          if (coordinates) {\n            let startIndex = 0; // Index start for segment optimization\n            const pixelTolerance = 2; // For segment to be visible, it must be > 2 pixels (due to round ends)\n            for (let i = 0; i < coordinates.length - 1; i++) {\n              const segmentStartCoords = coordinates[startIndex];\n              const segmentEndCoords = coordinates[i + 1];\n              const color1 = tinycolor(\n                theme.visualization.getColorByName((dims.color && dims.color.get(startIndex)) ?? style.base.color)\n              )\n                .setAlpha(opacity)\n                .toString();\n              const color2 = tinycolor(\n                theme.visualization.getColorByName((dims.color && dims.color.get(i + 1)) ?? style.base.color)\n              )\n                .setAlpha(opacity)\n                .toString();\n\n              const arrowSize1 = (dims.size && dims.size.get(startIndex)) ?? style.base.size;\n              const arrowSize2 = (dims.size && dims.size.get(i + 1)) ?? style.base.size;\n\n              const flowStyle = new FlowLine({\n                visible: true,\n                lineCap: config.arrow === 0 ? 'round' : 'square',\n                color: color1,\n                color2: color2,\n                width: (dims.size && dims.size.get(startIndex)) ?? style.base.size,\n                width2: (dims.size && dims.size.get(i + 1)) ?? style.base.size,\n              });\n              if (config.arrow) {\n                flowStyle.setArrow(config.arrow);\n                if (config.arrow > 0) {\n                  flowStyle.setArrowColor(color2);\n                  flowStyle.setArrowSize((arrowSize2 ?? 0) * 1.5);\n                } else {\n                  flowStyle.setArrowColor(color1);\n                  flowStyle.setArrowSize((arrowSize1 ?? 0) * 1.5);\n                }\n              }\n              // Only render segment if change in pixel coordinates is significant enough\n              if (isSegmentVisible(map, pixelTolerance, segmentStartCoords, segmentEndCoords)) {\n                const LS = new LineString([segmentStartCoords, segmentEndCoords]);\n                flowStyle.setGeometry(LS);\n                styles.push(flowStyle);\n                startIndex = i + 1; // Because a segment was created, move onto the next one\n              }\n            }\n            // If no segments created, render a single point\n            if (styles.length === 0) {\n              const P = new Point(coordinates[0]);\n              const radius = ((dims.size && dims.size.get(0)) ?? style.base.size ?? 10) / 2;\n              const color = tinycolor(\n                theme.visualization.getColorByName((dims.color && dims.color.get(0)) ?? style.base.color)\n              )\n                .setAlpha(opacity)\n                .toString();\n              const ZoomOutCircle = new Style({\n                image: new Circle({\n                  radius: radius,\n                  fill: new Fill({\n                    color: color,\n                  }),\n                }),\n              });\n              ZoomOutCircle.setGeometry(P);\n              styles.push(ZoomOutCircle);\n            }\n          }\n          return styles;\n        }\n\n        const values = { ...style.base };\n\n        if (dims.color) {\n          values.color = dims.color.get(idx);\n        }\n        return routeStyle(values);\n      });\n    }\n\n    // Crosshair layer\n    const crosshairFeature = new Feature({});\n    const hLineFeature = new Feature({});\n    const vLineFeature = new Feature({});\n    const lineFeatures = [hLineFeature, vLineFeature];\n    const crosshairRadius = (style.base.lineWidth || 6) + 3;\n    const crosshairStyle = new Style({\n      image: new Circle({\n        radius: crosshairRadius,\n        stroke: new Stroke({\n          color: colorManipulator.alpha(crosshairColor, 1),\n          width: 1,\n        }),\n        fill: new Fill({ color: colorManipulator.alpha(crosshairColor, 0.4) }),\n      }),\n    });\n    const lineStyle = new Style({\n      stroke: new Stroke({\n        color: crosshairColor,\n        width: 1,\n        lineDash: [3, 3],\n        lineCap: 'square',\n      }),\n    });\n\n    const crosshairLayer = new VectorImage({\n      source: new VectorSource({\n        features: [crosshairFeature],\n      }),\n      style: crosshairStyle,\n    });\n\n    const linesLayer = new VectorImage({\n      source: new VectorSource({\n        features: lineFeatures,\n      }),\n      style: lineStyle,\n    });\n\n    const layer = new LayerGroup({\n      layers: [vectorLayer, crosshairLayer, linesLayer],\n    });\n\n    // Crosshair sharing subscriptions\n    const subscriptions = new Subscription();\n\n    subscriptions.add(\n      eventBus\n        .getStream(DataHoverEvent)\n        .pipe(throttleTime(8))\n        .subscribe({\n          next: (event) => {\n            const mapExtents = map.getView().calculateExtent(map.getSize());\n            const feature = source.getFeatures()[0];\n            const frame: DataFrame = feature?.get('frame');\n            const time = event.payload?.point?.time;\n            if (frame && time) {\n              const timeField = frame.fields.find((f) => f.type === FieldType.time);\n              if (timeField) {\n                const timestamps: number[] = timeField.values;\n                const pointIdx = findNearestTimeIndex(timestamps, time);\n                if (pointIdx !== null) {\n                  const out = getGeometryField(frame, location);\n                  if (out.field) {\n                    const crosshairPoint: Point = out.field.values[pointIdx] as Point;\n                    const crosshairPointCoords = crosshairPoint.getCoordinates();\n                    crosshairFeature.setGeometry(crosshairPoint);\n                    crosshairFeature.setStyle(crosshairStyle);\n                    hLineFeature.setGeometry(\n                      new LineString([\n                        [mapExtents[mapIndex.x1], crosshairPointCoords[mapIndex.y1]],\n                        [mapExtents[mapIndex.x2], crosshairPointCoords[mapIndex.y1]],\n                      ])\n                    );\n                    vLineFeature.setGeometry(\n                      new LineString([\n                        [crosshairPointCoords[mapIndex.x1], mapExtents[mapIndex.y1]],\n                        [crosshairPointCoords[mapIndex.x1], mapExtents[mapIndex.y2]],\n                      ])\n                    );\n                    lineFeatures.forEach((feature) => feature.setStyle(lineStyle));\n                  }\n                }\n              }\n            }\n          },\n        })\n    );\n\n    subscriptions.add(\n      eventBus.subscribe(DataHoverClearEvent, (event) => {\n        crosshairFeature.setStyle(new Style({}));\n        lineFeatures.forEach((feature) => feature.setStyle(new Style({})));\n      })\n    );\n\n    return {\n      init: () => layer,\n      dispose: () => subscriptions.unsubscribe(),\n      update: (data: PanelData) => {\n        if (!data.series?.length) {\n          return; // ignore empty\n        }\n\n        for (const frame of data.series) {\n          if (style.fields || hasArrows) {\n            style.dims = getStyleDimension(frame, style, theme);\n          }\n\n          source.clear(true);\n          const info = getGeometryField(frame, location);\n          if (!info.field) {\n            source.changed();\n            break;\n          }\n          const coords: number[][] = [];\n          for (const v of info.field.values) {\n            if (v instanceof Point) {\n              coords.push(v.getCoordinates());\n            }\n          }\n          if (coords.length >= 2) {\n            const geometry = new LineString(coords);\n            source['addFeatureInternal'](\n              new Feature({\n                frame,\n                rowIndex: 0,\n                geometry,\n              })\n            );\n          }\n          source.changed();\n\n          break; // Only the first frame for now!\n        }\n      },\n\n      // Route layer options\n      registerOptionsUI: (builder) => {\n        builder\n          .addCustomEditor({\n            id: 'config.style',\n            path: 'config.style',\n            name: 'Style',\n            editor: StyleEditor,\n            settings: {\n              simpleFixedValues: false,\n            },\n            defaultValue: defaultOptions.style,\n          })\n          .addRadio({\n            path: 'config.arrow',\n            name: 'Arrow',\n            settings: {\n              options: [\n                { label: 'None', value: 0 },\n                { label: 'Forward', value: 1 },\n                { label: 'Reverse', value: -1 },\n              ],\n            },\n            defaultValue: defaultOptions.arrow,\n          });\n      },\n    };\n  },\n\n  // fill in the default values\n  defaultOptions,\n};\n\nfunction findNearestTimeIndex(timestamps: number[], time: number): number | null {\n  if (timestamps.length === 0) {\n    return null;\n  } else if (timestamps.length === 1) {\n    return 0;\n  }\n  const lastIdx = timestamps.length - 1;\n  if (time < timestamps[0]) {\n    return 0;\n  } else if (time > timestamps[lastIdx]) {\n    return lastIdx;\n  }\n\n  const probableIdx = Math.abs(Math.round((lastIdx * (time - timestamps[0])) / (timestamps[lastIdx] - timestamps[0])));\n  if (time < timestamps[probableIdx]) {\n    for (let i = probableIdx; i > 0; i--) {\n      if (time > timestamps[i]) {\n        return i < lastIdx ? i + 1 : lastIdx;\n      }\n    }\n    return 0;\n  } else {\n    for (let i = probableIdx; i < lastIdx; i++) {\n      if (time < timestamps[i]) {\n        return i > 0 ? i - 1 : 0;\n      }\n    }\n    return lastIdx;\n  }\n}\n","import { dayNightLayer } from './dayNightLayer';\nimport { dynamicGeoJSONLayer } from './geojsonDynamic';\nimport { geojsonLayer } from './geojsonLayer';\nimport { heatmapLayer } from './heatMap';\nimport { lastPointTracker } from './lastPointTracker';\nimport { markersLayer } from './markersLayer';\nimport { networkLayer } from './networkLayer';\nimport { photosLayer } from './photosLayer';\nimport { routeLayer } from './routeLayer';\n\n/**\n * Registry for layer handlers\n */\nexport const dataLayers = [\n  markersLayer,\n  heatmapLayer,\n  lastPointTracker,\n  geojsonLayer,\n  dynamicGeoJSONLayer,\n  dayNightLayer,\n  routeLayer,\n  photosLayer,\n  networkLayer,\n];\n","import OpenLayersMap from 'ol/Map';\n\nimport {\n  MapLayerRegistryItem,\n  Registry,\n  MapLayerOptions,\n  GrafanaTheme2,\n  EventBus,\n  SelectableValue,\n  PluginState,\n} from '@grafana/data';\nimport { config, hasAlphaPanels } from 'app/core/config';\n\nimport { basemapLayers } from './basemaps';\nimport { carto } from './basemaps/carto';\nimport { dataLayers } from './data';\n\nexport const DEFAULT_BASEMAP_CONFIG: MapLayerOptions = {\n  type: 'default',\n  name: '', // will get filled in with a non-empty name\n  config: {},\n};\n\n// Default base layer depending on the server setting\nexport const defaultBaseLayer: MapLayerRegistryItem = {\n  id: DEFAULT_BASEMAP_CONFIG.type,\n  name: 'Default base layer',\n  isBaseMap: true,\n\n  create: (map: OpenLayersMap, options: MapLayerOptions, eventBus: EventBus, theme: GrafanaTheme2) => {\n    const serverLayerType = config?.geomapDefaultBaseLayerConfig?.type;\n    if (serverLayerType) {\n      const layer = geomapLayerRegistry.getIfExists(serverLayerType);\n      if (!layer) {\n        throw new Error('Invalid basemap configuration on server');\n      }\n      return layer.create(map, config.geomapDefaultBaseLayerConfig!, eventBus, theme);\n    }\n\n    // For now use carto as our default basemap\n    return carto.create(map, options, eventBus, theme);\n  },\n};\n\n/**\n * Registry for layer handlers\n */\nexport const geomapLayerRegistry = new Registry<MapLayerRegistryItem<any>>(() => [\n  defaultBaseLayer,\n  ...basemapLayers, // simple basemaps\n  ...dataLayers, // Layers with update functions\n]);\n\ninterface RegistrySelectInfo {\n  options: Array<SelectableValue<string>>;\n  current: Array<SelectableValue<string>>;\n}\n\nfunction getLayersSelection(items: Array<MapLayerRegistryItem<any>>, current?: string): RegistrySelectInfo {\n  const registry: RegistrySelectInfo = { options: [], current: [] };\n  const alpha: Array<SelectableValue<string>> = [];\n\n  for (const layer of items) {\n    const option: SelectableValue<string> = { label: layer.name, value: layer.id, description: layer.description };\n\n    switch (layer.state) {\n      case PluginState.alpha:\n        if (!hasAlphaPanels) {\n          break;\n        }\n        option.label = `${layer.name} (Alpha)`;\n        option.icon = 'bolt';\n        alpha.push(option);\n        break;\n      case PluginState.beta:\n        option.label = `${layer.name} (Beta)`;\n      default:\n        registry.options.push(option);\n    }\n\n    if (layer.id === current) {\n      registry.current.push(option);\n    }\n  }\n\n  // Position alpha layers at the end of the layers list\n  for (const layer of alpha) {\n    registry.options.push(layer);\n  }\n\n  return registry;\n}\n\nexport function getLayersOptions(basemap: boolean, current?: string): RegistrySelectInfo {\n  if (basemap) {\n    return getLayersSelection([defaultBaseLayer, ...basemapLayers], current);\n  }\n\n  return getLayersSelection([...dataLayers, ...basemapLayers], current);\n}\n","// Code generated - EDITING IS FUTILE. DO NOT EDIT.\n//\n// Generated by:\n//     public/app/plugins/gen.go\n// Using jennies:\n//     TSTypesJenny\n//     PluginTsTypesJenny\n//\n// Run 'make gen-cue' from repository root to regenerate.\n\nimport * as ui from '@grafana/schema';\n\nexport interface Options {\n  basemap: ui.MapLayerOptions;\n  controls: ControlsOptions;\n  layers: Array<ui.MapLayerOptions>;\n  tooltip: TooltipOptions;\n  view: MapViewConfig;\n}\n\nexport const defaultOptions: Partial<Options> = {\n  layers: [],\n};\n\nexport interface MapViewConfig {\n  allLayers?: boolean;\n  id: string;\n  lastOnly?: boolean;\n  lat?: number;\n  layer?: string;\n  lon?: number;\n  maxZoom?: number;\n  minZoom?: number;\n  noRepeat?: boolean;\n  padding?: number;\n  shared?: boolean;\n  zoom?: number;\n}\n\nexport const defaultMapViewConfig: Partial<MapViewConfig> = {\n  allLayers: true,\n  id: 'zero',\n  lat: 0,\n  lon: 0,\n  noRepeat: false,\n  zoom: 1,\n};\n\nexport interface ControlsOptions {\n  /**\n   * let the mouse wheel zoom\n   */\n  mouseWheelZoom?: boolean;\n  /**\n   * Lower right\n   */\n  showAttribution?: boolean;\n  /**\n   * Show debug\n   */\n  showDebug?: boolean;\n  /**\n   * Show measure\n   */\n  showMeasure?: boolean;\n  /**\n   * Scale options\n   */\n  showScale?: boolean;\n  /**\n   * Zoom (upper left)\n   */\n  showZoom?: boolean;\n}\n\nexport interface TooltipOptions {\n  mode: TooltipMode;\n}\n\nexport enum TooltipMode {\n  Details = 'details',\n  None = 'none',\n}\n\nexport enum MapCenterID {\n  Coords = 'coords',\n  Fit = 'fit',\n  Zero = 'zero',\n}\n","import { FeatureLike } from 'ol/Feature';\nimport OpenLayersMap from 'ol/Map';\nimport BaseLayer from 'ol/layer/Base';\nimport LayerGroup from 'ol/layer/Group';\nimport WebGLPointsLayer from 'ol/layer/WebGLPoints';\nimport { Subject } from 'rxjs';\n\nimport { getFrameMatchers, MapLayerHandler, MapLayerOptions, PanelData, textUtil } from '@grafana/data';\nimport { config } from '@grafana/runtime';\n\nimport { GeomapPanel } from '../GeomapPanel';\nimport { MARKERS_LAYER_ID } from '../layers/data/markersLayer';\nimport { DEFAULT_BASEMAP_CONFIG, geomapLayerRegistry } from '../layers/registry';\nimport { MapLayerState } from '../types';\n\nimport { getNextLayerName } from './utils';\n\nconst layerStateMap = new WeakMap<BaseLayer, MapLayerState>();\n\nexport const applyLayerFilter = (\n  handler: MapLayerHandler<unknown>,\n  options: MapLayerOptions<unknown>,\n  panelDataProps: PanelData\n): void => {\n  if (handler.update) {\n    let panelData = panelDataProps;\n    if (options.filterData) {\n      const matcherFunc = getFrameMatchers(options.filterData);\n      panelData = {\n        ...panelData,\n        series: panelData.series.filter(matcherFunc),\n      };\n    }\n    handler.update(panelData);\n  }\n};\n\nexport async function updateLayer(panel: GeomapPanel, uid: string, newOptions: MapLayerOptions): Promise<boolean> {\n  if (!panel.map) {\n    return false;\n  }\n  const current = panel.byName.get(uid);\n  if (!current) {\n    return false;\n  }\n\n  let layerIndex = -1;\n  const group = panel.map?.getLayers()!;\n  for (let i = 0; i < group?.getLength(); i++) {\n    if (group.item(i) === current.layer) {\n      layerIndex = i;\n      break;\n    }\n  }\n\n  // Special handling for rename\n  if (newOptions.name !== uid) {\n    if (!newOptions.name) {\n      newOptions.name = uid;\n    } else if (panel.byName.has(newOptions.name)) {\n      return false;\n    }\n    panel.byName.delete(uid);\n\n    uid = newOptions.name;\n    panel.byName.set(uid, current);\n  }\n\n  // Type changed -- requires full re-initalization\n  if (current.options.type !== newOptions.type) {\n    // full init\n  } else {\n    // just update options\n  }\n\n  const layers = panel.layers.slice(0);\n  try {\n    const info = await initLayer(panel, panel.map, newOptions, current.isBasemap);\n    layers[layerIndex]?.handler.dispose?.();\n    layers[layerIndex] = info;\n    group.setAt(layerIndex, info.layer);\n\n    // initialize with new data\n    applyLayerFilter(info.handler, newOptions, panel.props.data);\n  } catch (err) {\n    console.warn('ERROR', err); // eslint-disable-line no-console\n    return false;\n  }\n\n  // Just to trigger a state update\n  panel.setState({ legends: [] });\n\n  panel.layers = layers;\n  panel.doOptionsUpdate(layerIndex);\n  return true;\n}\n\nexport async function initLayer(\n  panel: GeomapPanel,\n  map: OpenLayersMap,\n  options: MapLayerOptions,\n  isBasemap?: boolean\n): Promise<MapLayerState> {\n  if (isBasemap && (!options?.type || config.geomapDisableCustomBaseLayer)) {\n    options = DEFAULT_BASEMAP_CONFIG;\n  }\n\n  // Use default makers layer\n  if (!options?.type) {\n    options = {\n      type: MARKERS_LAYER_ID,\n      name: getNextLayerName(panel),\n      config: {},\n    };\n  }\n\n  const item = geomapLayerRegistry.getIfExists(options.type);\n  if (!item) {\n    return Promise.reject('unknown layer: ' + options.type);\n  }\n\n  if (options.config?.attribution) {\n    options.config.attribution = textUtil.sanitizeTextPanelContent(options.config.attribution);\n  }\n\n  const handler = await item.create(map, options, panel.props.eventBus, config.theme2);\n  const layer = handler.init(); // eslint-disable-line\n  if (options.opacity != null) {\n    layer.setOpacity(options.opacity);\n  }\n\n  if (!options.name) {\n    options.name = getNextLayerName(panel);\n  }\n\n  const UID = options.name;\n  const state: MapLayerState<unknown> = {\n    // UID, // unique name when added to the map (it may change and will need special handling)\n    isBasemap,\n    options,\n    layer,\n    handler,\n    mouseEvents: new Subject<FeatureLike | undefined>(),\n\n    getName: () => UID,\n\n    // Used by the editors\n    onChange: (cfg: MapLayerOptions) => {\n      updateLayer(panel, UID, cfg);\n    },\n  };\n\n  panel.byName.set(UID, state);\n  layerStateMap.set(state.layer, state);\n\n  // Pass state into WebGLPointsLayers contained in a LayerGroup\n  if (layer instanceof LayerGroup) {\n    layer\n      .getLayers()\n      .getArray()\n      .forEach((layer: BaseLayer) => {\n        if (layer instanceof WebGLPointsLayer) {\n          layerStateMap.set(layer, state);\n        }\n      });\n  }\n\n  applyLayerFilter(handler, options, panel.props.data);\n\n  return state;\n}\n\nexport const getMapLayerState = (l: BaseLayer | undefined): MapLayerState | undefined => {\n  return l ? layerStateMap.get(l) : undefined;\n};\n","import { cloneDeep } from 'lodash';\n\nimport { FrameGeometrySourceMode } from '@grafana/schema';\n\nimport { GeomapPanel } from '../GeomapPanel';\nimport { geomapLayerRegistry } from '../layers/registry';\nimport { defaultStyleConfig } from '../style/types';\nimport { GeomapLayerActions, MapLayerState } from '../types';\n\nimport { initLayer } from './layers';\nimport { getNextLayerName } from './utils';\n\nexport const getActions = (panel: GeomapPanel) => {\n  const actions: GeomapLayerActions = {\n    selectLayer: (uid: string) => {\n      const selected = panel.layers.findIndex((v) => v.options.name === uid);\n      if (panel.panelContext && panel.panelContext.onInstanceStateChange) {\n        panel.panelContext.onInstanceStateChange({\n          map: panel.map,\n          layers: panel.layers,\n          selected,\n          actions: panel.actions,\n        });\n      }\n    },\n    canRename: (v: string) => {\n      return !panel.byName.has(v);\n    },\n    deleteLayer: (uid: string) => {\n      const layers: MapLayerState[] = [];\n      for (const lyr of panel.layers) {\n        if (lyr.options.name === uid) {\n          panel.map?.removeLayer(lyr.layer);\n        } else {\n          layers.push(lyr);\n        }\n      }\n      panel.layers = layers;\n      panel.doOptionsUpdate(0);\n    },\n    addlayer: (type: string) => {\n      const item = geomapLayerRegistry.getIfExists(type);\n      if (!item) {\n        return; // ignore empty request\n      }\n      initLayer(\n        panel,\n        panel.map!,\n        {\n          type: item.id,\n          name: getNextLayerName(panel),\n          config: cloneDeep(item.defaultOptions),\n          location: item.showLocation ? { mode: FrameGeometrySourceMode.Auto } : undefined,\n          tooltip: true,\n          ...(!item.hideOpacity && { opacity: defaultStyleConfig.opacity }),\n        },\n        false\n      ).then((lyr) => {\n        panel.layers = panel.layers.slice(0);\n        panel.layers.push(lyr);\n        panel.map?.addLayer(lyr.layer);\n\n        panel.doOptionsUpdate(panel.layers.length - 1);\n      });\n    },\n    reorder: (startIndex: number, endIndex: number) => {\n      const result = Array.from(panel.layers);\n      const [removed] = result.splice(startIndex, 1);\n      result.splice(endIndex, 0, removed);\n      panel.layers = result;\n\n      panel.doOptionsUpdate(endIndex);\n\n      // Add the layers in the right order\n      const group = panel.map?.getLayers()!;\n      group.clear();\n      panel.layers.forEach((v) => group.push(v.layer));\n    },\n  };\n\n  return actions;\n};\n","import { createEmpty, extend, Extent } from 'ol/extent';\nimport LayerGroup from 'ol/layer/Group';\nimport VectorLayer from 'ol/layer/Vector';\nimport VectorImage from 'ol/layer/VectorImage';\nimport WebGLPointsLayer from 'ol/layer/WebGLPoints.js';\n\nimport { MapLayerState } from '../types';\n\nexport function getLayersExtent(\n  layers: MapLayerState[] = [],\n  allLayers = false,\n  lastOnly = false,\n  layer: string | undefined\n): Extent {\n  return layers\n    .filter((l) => l.layer instanceof VectorLayer || l.layer instanceof LayerGroup || l.layer instanceof VectorImage)\n    .flatMap((ll) => {\n      const layerName = ll.options.name;\n      const l = ll.layer;\n      if (l instanceof LayerGroup) {\n        // If not all layers check for matching layer name\n        if (!allLayers && layerName !== layer) {\n          return [];\n        }\n        return getLayerGroupExtent(l, lastOnly);\n      } else if (l instanceof VectorLayer || l instanceof VectorImage) {\n        if (allLayers) {\n          // Return everything from all layers\n          return [l.getSource().getExtent()];\n        } else if (lastOnly && layer === layerName) {\n          // Return last only for selected layer\n          const feat = l.getSource().getFeatures();\n          const featOfInterest = feat[feat.length - 1];\n          const geo = featOfInterest?.getGeometry();\n          if (geo) {\n            return [geo.getExtent()];\n          }\n          return [];\n        } else if (!lastOnly && layer === layerName) {\n          // Return all points for selected layer\n          return [l.getSource().getExtent()];\n        }\n        return [];\n      } else {\n        return [];\n      }\n    })\n    .reduce(extend, createEmpty());\n}\n\nexport function getLayerGroupExtent(lg: LayerGroup, lastOnly: boolean) {\n  return lg\n    .getLayers()\n    .getArray()\n    .filter((l) => l instanceof VectorLayer || l instanceof VectorImage || l instanceof WebGLPointsLayer)\n    .map((l) => {\n      if (l instanceof VectorLayer || l instanceof VectorImage || l instanceof WebGLPointsLayer) {\n        if (lastOnly) {\n          // Return last coordinate only\n          const feat = l.getSource().getFeatures();\n          const featOfInterest = feat[feat.length - 1];\n          const geo = featOfInterest?.getGeometry();\n          if (geo) {\n            // Look at flatCoordinates for more robust support including route layer\n            const flatCoordinates = geo.flatCoordinates;\n            const flatCoordinatesLength = flatCoordinates.length;\n            if (flatCoordinatesLength > 1) {\n              const lastX = flatCoordinates[flatCoordinatesLength - 2];\n              const lastY = flatCoordinates[flatCoordinatesLength - 1];\n              return [lastX, lastY, lastX, lastY];\n            }\n          }\n          return [];\n        }\n        return l.getSource().getExtent() ?? [];\n      } else {\n        return [];\n      }\n    });\n}\n","import { debounce } from 'lodash';\nimport { FeatureLike } from 'ol/Feature';\nimport MapBrowserEvent from 'ol/MapBrowserEvent';\nimport { Point } from 'ol/geom';\nimport WebGLPointsLayer from 'ol/layer/WebGLPoints';\nimport { toLonLat } from 'ol/proj';\nimport VectorSource from 'ol/source/Vector';\n\nimport { DataFrame, DataHoverClearEvent } from '@grafana/data';\n\nimport { GeomapPanel } from '../GeomapPanel';\nimport { GeomapHoverPayload, GeomapLayerHover } from '../event';\nimport { MapLayerState } from '../types';\n\nimport { getMapLayerState } from './layers';\n\nexport const setTooltipListeners = (panel: GeomapPanel) => {\n  // Tooltip listener\n  panel.map?.on('singleclick', (evt) => pointerClickListener(evt, panel));\n  panel.map?.on(\n    'pointermove',\n    debounce((evt) => pointerMoveListener(evt, panel), 200)\n  );\n  panel.map?.getViewport().addEventListener('mouseout', (evt: MouseEvent) => {\n    panel.props.eventBus.publish(new DataHoverClearEvent());\n  });\n};\n\nexport const pointerClickListener = (evt: MapBrowserEvent, panel: GeomapPanel) => {\n  if (pointerMoveListener(evt, panel)) {\n    evt.preventDefault();\n    evt.stopPropagation();\n    panel.mapDiv!.style.cursor = 'auto';\n    panel.setState({ ttipOpen: true });\n  }\n};\n\nexport const pointerMoveListener = (evt: MapBrowserEvent, panel: GeomapPanel) => {\n  // If measure menu is open, bypass tooltip logic and display measuring mouse events\n  if (panel.state.measureMenuActive) {\n    return true;\n  }\n\n  // Eject out of this function if map is not loaded or valid tooltip is already open\n  if (!panel.map || (panel.state.ttipOpen && panel.state?.ttip?.layers?.length)) {\n    return false;\n  }\n\n  if (!(evt.originalEvent instanceof MouseEvent)) {\n    return false;\n  }\n\n  const mouse = evt.originalEvent;\n  const pixel = panel.map.getEventPixel(mouse);\n  const hover = toLonLat(panel.map.getCoordinateFromPixel(pixel));\n\n  const { hoverPayload } = panel;\n  hoverPayload.pageX = mouse.pageX;\n  hoverPayload.pageY = mouse.pageY - window.scrollY;\n  hoverPayload.point = {\n    lat: hover[1],\n    lon: hover[0],\n  };\n  hoverPayload.data = undefined;\n  hoverPayload.columnIndex = undefined;\n  hoverPayload.rowIndex = undefined;\n  hoverPayload.layers = undefined;\n\n  const layers: GeomapLayerHover[] = [];\n  const layerLookup = new Map<MapLayerState, GeomapLayerHover>();\n\n  let ttip: GeomapHoverPayload = {} as GeomapHoverPayload;\n  panel.map.forEachFeatureAtPixel(\n    pixel,\n    (feature, layer, geo) => {\n      const s = getMapLayerState(layer);\n      //match hover layer to layer in layers\n      //check if the layer show tooltip is enabled\n      //then also pass the list of tooltip fields if exists\n      //this is used as the generic hover event\n      if (!hoverPayload.data) {\n        const props = feature.getProperties();\n        const frame: DataFrame = props['frame'];\n        if (frame) {\n          hoverPayload.data = ttip.data = frame;\n          hoverPayload.rowIndex = ttip.rowIndex = props['rowIndex'];\n        }\n\n        if (s?.mouseEvents) {\n          s.mouseEvents.next(feature);\n        }\n      }\n\n      if (s) {\n        let h = layerLookup.get(s);\n        if (!h) {\n          h = { layer: s, features: [] };\n          layerLookup.set(s, h);\n          layers.push(h);\n        }\n\n        // Only add if not already present\n        if (!h.features.some((f) => f === feature)) {\n          h.features.push(feature);\n        }\n\n        // For WebGLPointsLayer, check for additional features at the same coordinates\n        if (layer instanceof WebGLPointsLayer) {\n          const featureGeom = feature.getGeometry();\n          if (featureGeom instanceof Point) {\n            const featureCoords = featureGeom.getCoordinates();\n            const source = layer.getSource() as VectorSource;\n            let addedFeatures = false;\n            source.forEachFeature((otherFeature: FeatureLike) => {\n              // Ignore duplicates\n              if (otherFeature !== feature && !h.features.some((f) => f === otherFeature)) {\n                const otherGeom = otherFeature.getGeometry();\n                if (otherGeom instanceof Point) {\n                  const otherCoords = otherGeom.getCoordinates();\n                  // Check for matching coordinates\n                  if (otherCoords[0] === featureCoords[0] && otherCoords[1] === featureCoords[1]) {\n                    h.features.push(otherFeature);\n                    addedFeatures = true;\n                  }\n                }\n              }\n            });\n            // If we found multiple features at the same coordinates, sort them by rowIndex\n            if (addedFeatures) {\n              h.features.sort((a, b) => {\n                const aIndex =\n                  a.getProperties()['rowIndex'] !== undefined\n                    ? Number(a.getProperties()['rowIndex'])\n                    : Number.MAX_SAFE_INTEGER;\n                const bIndex =\n                  b.getProperties()['rowIndex'] !== undefined\n                    ? Number(b.getProperties()['rowIndex'])\n                    : Number.MAX_SAFE_INTEGER;\n                return aIndex - bIndex;\n              });\n            }\n          }\n        }\n      }\n    },\n    {\n      layerFilter: (l) => {\n        const hoverLayerState = getMapLayerState(l);\n        return hoverLayerState?.options?.tooltip !== false;\n      },\n    }\n  );\n  panel.hoverPayload.layers = layers.length ? layers : undefined;\n  panel.props.eventBus.publish(panel.hoverEvent);\n\n  // This check optimizes Geomap panel re-render behavior (without it, Geomap renders on every mouse move event)\n  if (panel.state.ttip === undefined || panel.state.ttip?.layers !== hoverPayload.layers || hoverPayload.layers) {\n    panel.setState({ ttip: { ...hoverPayload } });\n  }\n\n  if (!layers.length) {\n    // clear mouse events\n    panel.layers.forEach((layer) => {\n      layer.mouseEvents.next(undefined);\n    });\n  }\n\n  const found = Boolean(layers.length);\n  panel.mapDiv!.style.cursor = found ? 'pointer' : 'auto';\n  return found;\n};\n","import { Registry, RegistryItem } from '@grafana/data';\n\ninterface MapCenterItems extends RegistryItem {\n  lat?: number;\n  lon?: number;\n  zoom?: number;\n}\n\nexport enum MapCenterID {\n  Zero = 'zero',\n  Coordinates = 'coords',\n  Fit = 'fit',\n}\n\nexport const centerPointRegistry = new Registry<MapCenterItems>(() => [\n  {\n    id: MapCenterID.Fit,\n    name: 'Fit to data',\n    zoom: 15, // max zoom\n  },\n  {\n    id: MapCenterID.Zero,\n    name: '(0, 0)',\n    lat: 0,\n    lon: 0,\n  },\n  {\n    id: MapCenterID.Coordinates,\n    name: 'Coordinates',\n  },\n  {\n    id: 'north-america',\n    name: 'North America',\n    lat: 40,\n    lon: -100,\n    zoom: 4,\n  },\n  {\n    id: 'south-america',\n    name: 'South America',\n    lat: -20,\n    lon: -60,\n    zoom: 3,\n  },\n  {\n    id: 'europe',\n    name: 'Europe',\n    lat: 46,\n    lon: 14,\n    zoom: 4,\n  },\n  {\n    id: 'africa',\n    name: 'Africa',\n    lat: 0,\n    lon: 30,\n    zoom: 3,\n  },\n  {\n    id: 'west-asia',\n    name: 'West Asia',\n    lat: 26,\n    lon: 53,\n    zoom: 4,\n  },\n  {\n    id: 's-asia',\n    name: 'South Asia',\n    lat: 19.5,\n    lon: 80,\n    zoom: 4,\n  },\n  {\n    id: 'se-asia',\n    name: 'South-East Asia',\n    lat: 10,\n    lon: 106,\n    zoom: 4,\n  },\n  {\n    id: 'e-asia',\n    name: 'East Asia',\n    lat: 33,\n    lon: 120,\n    zoom: 4,\n  },\n  {\n    id: 'australia',\n    name: 'Australia',\n    lat: -25,\n    lon: 135,\n    zoom: 4,\n  },\n  {\n    id: 'oceania',\n    name: 'Oceania',\n    lat: -10,\n    lon: -140,\n    zoom: 3,\n  },\n]);\n","import { css } from '@emotion/css';\nimport { Global } from '@emotion/react';\nimport OpenLayersMap from 'ol/Map';\nimport MapBrowserEvent from 'ol/MapBrowserEvent';\nimport View, { ViewOptions } from 'ol/View';\nimport Attribution from 'ol/control/Attribution';\nimport ScaleLine from 'ol/control/ScaleLine';\nimport Zoom from 'ol/control/Zoom';\nimport { Coordinate } from 'ol/coordinate';\nimport { isEmpty } from 'ol/extent';\nimport MouseWheelZoom from 'ol/interaction/MouseWheelZoom';\nimport { fromLonLat, transformExtent } from 'ol/proj';\nimport { Component, ReactNode } from 'react';\nimport * as React from 'react';\nimport { Subscription } from 'rxjs';\n\nimport { DataHoverEvent, PanelData, PanelProps } from '@grafana/data';\nimport { t } from '@grafana/i18n';\nimport { config } from '@grafana/runtime';\nimport { PanelContext, PanelContextRoot } from '@grafana/ui';\nimport { appEvents } from 'app/core/app_events';\nimport { VariablesChanged } from 'app/features/variables/types';\nimport { PanelEditExitedEvent } from 'app/types/events';\n\nimport { GeomapOverlay, OverlayProps } from './GeomapOverlay';\nimport { GeomapTooltip } from './GeomapTooltip';\nimport { DebugOverlay } from './components/DebugOverlay';\nimport { MeasureOverlay } from './components/MeasureOverlay';\nimport { MeasureVectorLayer } from './components/MeasureVectorLayer';\nimport { GeomapHoverPayload } from './event';\nimport { getGlobalStyles } from './globalStyles';\nimport { defaultMarkersConfig } from './layers/data/markersLayer';\nimport { DEFAULT_BASEMAP_CONFIG } from './layers/registry';\nimport { ControlsOptions, Options, MapLayerState, MapViewConfig, TooltipMode } from './types';\nimport { getActions } from './utils/actions';\nimport { getLayersExtent } from './utils/getLayersExtent';\nimport { applyLayerFilter, initLayer } from './utils/layers';\nimport { pointerClickListener, pointerMoveListener, setTooltipListeners } from './utils/tooltip';\nimport {\n  updateMap,\n  getNewOpenLayersMap,\n  notifyPanelEditor,\n  hasVariableDependencies,\n  hasLayerData,\n} from './utils/utils';\nimport { centerPointRegistry, MapCenterID } from './view';\n\n// Allows multiple panels to share the same view instance\nlet sharedView: View | undefined = undefined;\n\ntype Props = PanelProps<Options>;\ninterface State extends OverlayProps {\n  ttip?: GeomapHoverPayload;\n  ttipOpen: boolean;\n  legends: ReactNode[];\n  measureMenuActive?: boolean;\n}\n\nexport class GeomapPanel extends Component<Props, State> {\n  declare context: React.ContextType<typeof PanelContextRoot>;\n  static contextType = PanelContextRoot;\n  panelContext: PanelContext | undefined = undefined;\n  private subs = new Subscription();\n\n  globalCSS = getGlobalStyles(config.theme2);\n\n  mouseWheelZoom?: MouseWheelZoom;\n  hoverPayload: GeomapHoverPayload = { point: {}, pageX: -1, pageY: -1 };\n  readonly hoverEvent = new DataHoverEvent(this.hoverPayload);\n\n  map?: OpenLayersMap;\n  mapDiv?: HTMLDivElement;\n  layers: MapLayerState[] = [];\n  readonly byName = new Map<string, MapLayerState>();\n\n  constructor(props: Props) {\n    super(props);\n    this.state = { ttipOpen: false, legends: [] };\n    this.subs.add(\n      this.props.eventBus.subscribe(PanelEditExitedEvent, (evt) => {\n        if (this.mapDiv && this.props.id === evt.payload) {\n          this.initMapRef(this.mapDiv);\n        }\n      })\n    );\n    // Subscribe to variable changes\n    this.subs.add(\n      appEvents.subscribe(VariablesChanged, () => {\n        if (this.mapDiv) {\n          // Check if any of the map's layers are dependent on variables\n          const hasDependencies = this.layers.some((layer) => {\n            const config = layer.options.config;\n            if (!config || typeof config !== 'object') {\n              return false;\n            }\n            return hasVariableDependencies(config);\n          });\n\n          if (hasDependencies) {\n            this.initMapRef(this.mapDiv);\n          }\n        }\n      })\n    );\n  }\n\n  componentDidMount() {\n    this.panelContext = this.context;\n  }\n\n  componentWillUnmount() {\n    this.subs.unsubscribe();\n    for (const lyr of this.layers) {\n      lyr.handler.dispose?.();\n    }\n    // Ensure map is disposed\n    this.map?.dispose();\n  }\n\n  shouldComponentUpdate(nextProps: Props) {\n    if (!this.map) {\n      return true; // not yet initialized\n    }\n\n    // Check for resize\n    if (this.props.height !== nextProps.height || this.props.width !== nextProps.width) {\n      this.map.updateSize();\n    }\n\n    // External data changed\n    if (this.props.data !== nextProps.data) {\n      this.dataChanged(nextProps.data);\n    }\n\n    return true; // always?\n  }\n\n  componentDidUpdate(prevProps: Props) {\n    if (this.map && (this.props.height !== prevProps.height || this.props.width !== prevProps.width)) {\n      this.map.updateSize();\n    }\n    // Check for a difference between previous data and component data\n    if (this.map && this.props.data !== prevProps.data) {\n      this.dataChanged(this.props.data);\n    }\n    // Handle options changes\n    if (this.props.options !== prevProps.options) {\n      this.optionsChanged(prevProps.options, this.props.options);\n    }\n  }\n\n  /** This function will actually update the JSON model */\n  doOptionsUpdate(selected: number) {\n    const { options, onOptionsChange } = this.props;\n    const layers = this.layers;\n    this.map?.getLayers().forEach((l) => {\n      if (l instanceof MeasureVectorLayer) {\n        this.map?.removeLayer(l);\n        this.map?.addLayer(l);\n      }\n    });\n    onOptionsChange({\n      ...options,\n      basemap: layers[0].options,\n      layers: layers.slice(1).map((v) => v.options),\n    });\n\n    notifyPanelEditor(this, layers, selected);\n    this.setState({ legends: this.getLegends() });\n  }\n\n  actions = getActions(this);\n\n  /**\n   * Called when the panel options change\n   *\n   * NOTE: changes to basemap and layers are handled independently\n   */\n  optionsChanged(oldOptions: Options, newOptions: Options) {\n    // First check if noRepeat changed - requires full map reinitialization\n    const noRepeatChanged = oldOptions.view?.noRepeat !== newOptions.view?.noRepeat;\n\n    if (noRepeatChanged) {\n      if (this.mapDiv) {\n        this.initMapRef(this.mapDiv);\n      }\n      // Skip other options processing\n      return;\n    }\n\n    // Handle incremental view changes\n    if (oldOptions.view !== newOptions.view) {\n      const view = this.initMapView(newOptions.view);\n      if (this.map && view) {\n        this.map.setView(view);\n      }\n    }\n\n    // Handle controls changes\n    if (newOptions.controls !== oldOptions.controls) {\n      this.initControls(newOptions.controls ?? { showZoom: true, showAttribution: true });\n    }\n  }\n\n  /**\n   * Called when PanelData changes (query results etc)\n   */\n  dataChanged(data: PanelData) {\n    // Only update if panel data matches component data\n    if (data === this.props.data) {\n      for (const state of this.layers) {\n        applyLayerFilter(state.handler, state.options, this.props.data);\n      }\n    }\n\n    // Because data changed, check map view and change if needed (data fit)\n    const v = centerPointRegistry.getIfExists(this.props.options.view.id);\n    if (v && v.id === MapCenterID.Fit) {\n      const view = this.initMapView(this.props.options.view);\n\n      if (this.map && view) {\n        this.map.setView(view);\n      }\n    }\n\n    // Update legends when data changes\n    this.setState({ legends: this.getLegends() });\n  }\n\n  initMapRef = async (div: HTMLDivElement) => {\n    if (!div) {\n      // Do not initialize new map or dispose old map\n      return;\n    }\n    this.mapDiv = div;\n    if (this.map) {\n      this.map.dispose();\n    }\n\n    const { options } = this.props;\n\n    const map = getNewOpenLayersMap(this, options, div);\n\n    this.byName.clear();\n    const layers: MapLayerState[] = [];\n    try {\n      // Pass noRepeat setting to basemap layer\n      const basemapOptions = {\n        ...(options.basemap ?? DEFAULT_BASEMAP_CONFIG),\n        noRepeat: options.view?.noRepeat ?? false,\n      };\n      layers.push(await initLayer(this, map, basemapOptions, true));\n\n      // Default layer values\n      if (!options.layers) {\n        options.layers = [defaultMarkersConfig];\n      }\n\n      for (const lyr of options.layers) {\n        layers.push(await initLayer(this, map, lyr, false));\n      }\n    } catch (ex) {\n      console.error('error loading layers', ex);\n    }\n\n    for (const lyr of layers) {\n      map.addLayer(lyr.layer);\n    }\n    this.layers = layers;\n    this.map = map; // redundant\n    this.initViewExtent(map.getView(), options.view);\n\n    this.mouseWheelZoom = new MouseWheelZoom();\n    this.map?.addInteraction(this.mouseWheelZoom);\n\n    updateMap(this, options);\n    setTooltipListeners(this);\n    notifyPanelEditor(this, layers, layers.length - 1);\n\n    this.setState({ legends: this.getLegends() });\n  };\n\n  clearTooltip = () => {\n    if (this.state.ttip && !this.state.ttipOpen) {\n      this.tooltipPopupClosed();\n    }\n  };\n\n  tooltipPopupClosed = () => {\n    this.setState({ ttipOpen: false, ttip: undefined });\n  };\n\n  pointerClickListener = (evt: MapBrowserEvent<PointerEvent>) => {\n    pointerClickListener(evt, this);\n  };\n\n  pointerMoveListener = (evt: MapBrowserEvent<PointerEvent>) => {\n    pointerMoveListener(evt, this);\n  };\n\n  initMapView = (config: MapViewConfig): View | undefined => {\n    const noRepeat = config.noRepeat ?? false;\n\n    let viewOptions: ViewOptions = {\n      center: [0, 0],\n      zoom: 1,\n    };\n\n    // Only apply constraints when no-repeat is enabled\n    if (noRepeat) {\n      // Define the world extent in EPSG:3857 (Web Mercator)\n      const worldExtent = [-180, -85.05112878, 180, 85.05112878]; // [minx, miny, maxx, maxy] in EPSG:4326\n      const projectedExtent = transformExtent(worldExtent, 'EPSG:4326', 'EPSG:3857');\n      viewOptions.extent = projectedExtent;\n      viewOptions.showFullExtent = false;\n      viewOptions.constrainOnlyCenter = false;\n    }\n\n    let view = new View(viewOptions);\n\n    // With shared views, all panels use the same view instance\n    if (config.shared) {\n      if (!sharedView) {\n        sharedView = view;\n      } else {\n        view = sharedView;\n      }\n    }\n\n    this.initViewExtent(view, config);\n    return view;\n  };\n\n  initViewExtent(view: View, config: MapViewConfig) {\n    const v = centerPointRegistry.getIfExists(config.id);\n    if (v) {\n      let coord: Coordinate | undefined = undefined;\n      if (v.lat == null) {\n        if (v.id === MapCenterID.Coordinates) {\n          coord = [config.lon ?? 0, config.lat ?? 0];\n        } else if (v.id === MapCenterID.Fit) {\n          const extent = getLayersExtent(this.layers, config.allLayers, config.lastOnly, config.layer);\n          if (!isEmpty(extent)) {\n            const padding = config.padding ?? 5;\n            const res = view.getResolutionForExtent(extent, this.map?.getSize());\n            const maxZoom = config.zoom ?? config.maxZoom;\n            view.fit(extent, {\n              maxZoom: maxZoom,\n            });\n            view.setResolution(res * (padding / 100 + 1));\n            const adjustedZoom = view.getZoom();\n            if (adjustedZoom && maxZoom && adjustedZoom > maxZoom) {\n              view.setZoom(maxZoom);\n            }\n          }\n        } else {\n          // TODO: view requires special handling\n        }\n      } else {\n        coord = [v.lon ?? 0, v.lat ?? 0];\n      }\n      if (coord) {\n        view.setCenter(fromLonLat(coord));\n      }\n    }\n\n    if (config.maxZoom) {\n      view.setMaxZoom(config.maxZoom);\n    }\n    if (config.minZoom) {\n      view.setMaxZoom(config.minZoom);\n    }\n    if (config.zoom && v?.id !== MapCenterID.Fit) {\n      view.setZoom(config.zoom);\n    }\n  }\n\n  initControls(options: ControlsOptions) {\n    if (!this.map) {\n      return;\n    }\n    this.map.getControls().clear();\n\n    if (options.showZoom) {\n      this.map.addControl(new Zoom());\n    }\n\n    if (options.showScale) {\n      this.map.addControl(\n        new ScaleLine({\n          units: options.scaleUnits,\n          minWidth: 100,\n        })\n      );\n    }\n\n    this.mouseWheelZoom?.setActive(Boolean(options.mouseWheelZoom));\n\n    if (options.showAttribution) {\n      this.map.addControl(new Attribution({ collapsed: true, collapsible: true }));\n    }\n\n    // Update the react overlays\n    let topRight1: ReactNode[] = [];\n    if (options.showMeasure) {\n      topRight1 = [\n        <MeasureOverlay\n          key=\"measure\"\n          map={this.map}\n          // Lifts menuActive state and resets tooltip state upon close\n          menuActiveState={(value: boolean) => {\n            this.setState({ ttipOpen: value, measureMenuActive: value });\n          }}\n        />,\n      ];\n    }\n\n    let topRight2: ReactNode[] = [];\n    if (options.showDebug) {\n      topRight2 = [<DebugOverlay key=\"debug\" map={this.map} />];\n    }\n\n    this.setState({ topRight1, topRight2 });\n  }\n\n  getLegends() {\n    const legends: ReactNode[] = [];\n    for (const state of this.layers) {\n      if (state.handler.legend) {\n        const hasData = hasLayerData(state.layer);\n        if (hasData) {\n          legends.push(<div key={state.options.name}>{state.handler.legend}</div>);\n        }\n      }\n    }\n\n    return legends;\n  }\n\n  render() {\n    let { ttip, ttipOpen, topRight1, legends, topRight2 } = this.state;\n    const { options } = this.props;\n    const showScale = options.controls.showScale;\n    if (!ttipOpen && options.tooltip?.mode === TooltipMode.None) {\n      ttip = undefined;\n    }\n\n    return (\n      <>\n        <Global styles={this.globalCSS} />\n        <div className={styles.wrap} onMouseLeave={this.clearTooltip}>\n          <div\n            role=\"application\"\n            className={styles.map}\n            // eslint-disable-next-line jsx-a11y/no-noninteractive-tabindex\n            tabIndex={0} // Interactivity is added through the ref\n            aria-label={t('geomap.geomap-panel.aria-label-map', 'Navigable map')}\n            ref={this.initMapRef}\n          ></div>\n          <GeomapOverlay\n            bottomLeft={legends}\n            topRight1={topRight1}\n            topRight2={topRight2}\n            blStyle={{ bottom: showScale ? '35px' : '8px' }}\n          />\n        </div>\n        <GeomapTooltip ttip={ttip} isOpen={ttipOpen} onClose={this.tooltipPopupClosed} />\n      </>\n    );\n  }\n}\n\nconst styles = {\n  wrap: css({\n    position: 'relative',\n    width: '100%',\n    height: '100%',\n  }),\n  map: css({\n    position: 'absolute',\n    zIndex: 0,\n    width: '100%',\n    height: '100%',\n  }),\n};\n","import { css, cx } from '@emotion/css';\nimport { DragDropContext, Draggable, Droppable, DropResult } from '@hello-pangea/dnd';\n\nimport { GrafanaTheme2 } from '@grafana/data';\nimport { t } from '@grafana/i18n';\nimport { Icon, IconButton, useStyles2 } from '@grafana/ui';\n\nimport { LayerName } from './LayerName';\nimport { LayerElement } from './types';\n\nexport const DATA_TEST_ID = 'layer-drag-drop-list';\n\nexport type LayerDragDropListProps<T extends LayerElement> = {\n  layers: T[];\n  getLayerInfo: (element: T) => string;\n  onDragEnd: (result: DropResult) => void;\n  onSelect: (element: T) => void;\n  onDelete: (element: T) => void;\n  onDuplicate?: (element: T) => void;\n  showActions: (element: T) => boolean;\n  selection?: string[]; // list of unique ids (names)\n  excludeBaseLayer?: boolean;\n  onNameChange: (element: T, newName: string) => void;\n  verifyLayerNameUniqueness?: (nameToCheck: string) => boolean;\n};\n\nexport const LayerDragDropList = <T extends LayerElement>({\n  layers,\n  getLayerInfo,\n  onDragEnd,\n  onSelect,\n  onDelete,\n  onDuplicate,\n  showActions,\n  selection,\n  excludeBaseLayer,\n  onNameChange,\n  verifyLayerNameUniqueness,\n}: LayerDragDropListProps<T>) => {\n  const style = useStyles2(getStyles);\n\n  const getRowStyle = (isSelected: boolean) => {\n    return isSelected ? `${style.row} ${style.sel}` : style.row;\n  };\n\n  return (\n    <DragDropContext onDragEnd={onDragEnd}>\n      <Droppable droppableId=\"droppable\">\n        {(provided, snapshot) => (\n          <div {...provided.droppableProps} ref={provided.innerRef} data-testid={DATA_TEST_ID}>\n            {(() => {\n              // reverse order\n              const rows: JSX.Element[] = [];\n              const lastLayerIndex = excludeBaseLayer ? 1 : 0;\n              const shouldRenderDragIconLengthThreshold = excludeBaseLayer ? 2 : 1;\n              for (let i = layers.length - 1; i >= lastLayerIndex; i--) {\n                const element = layers[i];\n                const uid = element.getName();\n\n                const isSelected = Boolean(selection?.includes(uid));\n                rows.push(\n                  <Draggable key={uid} draggableId={uid} index={rows.length}>\n                    {(provided, snapshot) => (\n                      <div\n                        className={getRowStyle(isSelected)}\n                        ref={provided.innerRef}\n                        {...provided.draggableProps}\n                        {...provided.dragHandleProps}\n                        onClick={() => onSelect(element)}\n                        onKeyDown={(e) => {\n                          if (e.key === 'Enter' || e.key === ' ') {\n                            e.preventDefault();\n                            onSelect(element);\n                          }\n                        }}\n                        role=\"button\"\n                        tabIndex={0}\n                      >\n                        <LayerName\n                          name={uid}\n                          onChange={(v) => onNameChange(element, v)}\n                          verifyLayerNameUniqueness={verifyLayerNameUniqueness ?? undefined}\n                        />\n                        <div className={style.textWrapper}>&nbsp; {getLayerInfo(element)}</div>\n\n                        {showActions(element) && (\n                          <>\n                            {onDuplicate ? (\n                              <IconButton\n                                name=\"copy\"\n                                tooltip={t('layers.layer-drag-drop-list.duplicate-tooltip', 'Duplicate')}\n                                className={style.actionIcon}\n                                onClick={() => onDuplicate(element)}\n                              />\n                            ) : null}\n\n                            <IconButton\n                              name=\"trash-alt\"\n                              tooltip={t('layers.layer-drag-drop-list.remove-tooltip', 'Remove')}\n                              className={cx(style.actionIcon, style.dragIcon)}\n                              onClick={() => onDelete(element)}\n                            />\n                          </>\n                        )}\n                        {layers.length > shouldRenderDragIconLengthThreshold && (\n                          <Icon\n                            aria-label={t(\n                              'layers.layer-drag-drop-list.draggable-aria-label',\n                              'Drag and drop to reorder'\n                            )}\n                            name=\"draggabledots\"\n                            size=\"lg\"\n                            className={style.dragIcon}\n                          />\n                        )}\n                      </div>\n                    )}\n                  </Draggable>\n                );\n              }\n\n              return rows;\n            })()}\n\n            {provided.placeholder}\n          </div>\n        )}\n      </Droppable>\n    </DragDropContext>\n  );\n};\n\nconst getStyles = (theme: GrafanaTheme2) => ({\n  wrapper: css({\n    marginBottom: theme.spacing(2),\n  }),\n  row: css({\n    padding: theme.spacing(0.5, 1),\n    borderRadius: theme.shape.radius.default,\n    background: theme.colors.background.secondary,\n    minHeight: theme.spacing(4),\n    display: 'flex',\n    alignItems: 'center',\n    justifyContent: 'space-between',\n    marginBottom: '3px',\n    cursor: 'pointer',\n\n    border: `1px solid ${theme.components.input.borderColor}`,\n    '&:hover': {\n      border: `1px solid ${theme.components.input.borderHover}`,\n    },\n  }),\n  sel: css({\n    border: `1px solid ${theme.colors.primary.border}`,\n    '&:hover': {\n      border: `1px solid ${theme.colors.primary.border}`,\n    },\n  }),\n  dragIcon: css({\n    cursor: 'drag',\n  }),\n  actionIcon: css({\n    color: theme.colors.text.secondary,\n    '&:hover': {\n      color: theme.colors.text.primary,\n    },\n  }),\n  typeWrapper: css({\n    color: theme.colors.primary.text,\n    marginRight: '5px',\n  }),\n  textWrapper: css({\n    display: 'flex',\n    alignItems: 'center',\n    flexGrow: 1,\n    overflow: 'hidden',\n    marginRight: theme.spacing(1),\n  }),\n});\n","import { DropResult } from '@hello-pangea/dnd';\n\nimport { StandardEditorProps } from '@grafana/data';\nimport { Trans, t } from '@grafana/i18n';\nimport { Container } from '@grafana/ui';\nimport { AddLayerButton } from 'app/core/components/Layers/AddLayerButton';\nimport { LayerDragDropList } from 'app/core/components/Layers/LayerDragDropList';\n\nimport { getLayersOptions } from '../layers/registry';\nimport { Options, MapLayerState, GeomapInstanceState } from '../types';\n\ntype LayersEditorProps = StandardEditorProps<unknown, unknown, Options, GeomapInstanceState>;\n\nexport const LayersEditor = (props: LayersEditorProps) => {\n  const { layers, selected, actions } = props.context.instanceState ?? {};\n  if (!layers || !actions) {\n    return (\n      <div>\n        <Trans i18nKey=\"geomap.layers-editor.no-layers\">No layers?</Trans>\n      </div>\n    );\n  }\n\n  const onDragEnd = (result: DropResult) => {\n    if (!result.destination) {\n      return;\n    }\n\n    const { layers, actions } = props.context.instanceState ?? {};\n    if (!layers || !actions) {\n      return;\n    }\n\n    // account for the reverse order and offset (0 is baselayer)\n    const count = layers.length - 1;\n    const src = (result.source.index - count) * -1;\n    const dst = (result.destination.index - count) * -1;\n\n    actions.reorder(src, dst);\n  };\n\n  const onSelect = (element: MapLayerState<unknown>) => {\n    actions.selectLayer(element.options.name);\n  };\n\n  const onDelete = (element: MapLayerState<unknown>) => {\n    actions.deleteLayer(element.options.name);\n  };\n\n  const getLayerInfo = (element: MapLayerState<unknown>) => {\n    return element.options.type;\n  };\n\n  const onNameChange = (element: MapLayerState<unknown>, name: string) => {\n    element.onChange({ ...element.options, name });\n  };\n\n  const selection = selected ? [layers[selected]?.getName()] : [];\n\n  return (\n    <>\n      <Container>\n        <AddLayerButton\n          onChange={(v) => actions.addlayer(v.value!)}\n          options={getLayersOptions(false).options}\n          label={t('geomap.layers-editor.label-add-layer', 'Add layer')}\n        />\n      </Container>\n      <br />\n\n      <LayerDragDropList\n        layers={layers}\n        showActions={() => layers.length > 2} // 2 because base layer is not counted!\n        getLayerInfo={getLayerInfo}\n        onDragEnd={onDragEnd}\n        onSelect={onSelect}\n        onDelete={onDelete}\n        selection={selection}\n        excludeBaseLayer\n        onNameChange={onNameChange}\n        verifyLayerNameUniqueness={actions.canRename}\n      />\n    </>\n  );\n};\n","import { t } from '@grafana/i18n';\nimport { InlineFieldRow, InlineField } from '@grafana/ui';\nimport { NumberInput } from 'app/core/components/OptionsUI/NumberInput';\n\nimport { MapViewConfig } from '../types';\n\ntype Props = {\n  labelWidth: number;\n  value: MapViewConfig;\n  onChange: (value?: MapViewConfig | undefined) => void;\n};\n\nexport const CoordinatesMapViewEditor = ({ labelWidth, value, onChange }: Props) => {\n  const onLatitudeChange = (latitude: number | undefined) => {\n    onChange({ ...value, lat: latitude });\n  };\n\n  const onLongitudeChange = (longitude: number | undefined) => {\n    onChange({ ...value, lon: longitude });\n  };\n\n  return (\n    <>\n      <InlineFieldRow>\n        <InlineField\n          label={t('geomap.coordinates-map-view-editor.label-latitude', 'Latitude')}\n          labelWidth={labelWidth}\n          grow={true}\n        >\n          <NumberInput value={value.lat} min={-90} max={90} step={0.001} onChange={onLatitudeChange} />\n        </InlineField>\n      </InlineFieldRow>\n      <InlineFieldRow>\n        <InlineField\n          label={t('geomap.coordinates-map-view-editor.label-longitude', 'Longitude')}\n          labelWidth={labelWidth}\n          grow={true}\n        >\n          <NumberInput value={value.lon} min={-180} max={180} step={0.001} onChange={onLongitudeChange} />\n        </InlineField>\n      </InlineFieldRow>\n    </>\n  );\n};\n","import { useCallback, useMemo } from 'react';\n\nimport { SelectableValue, StandardEditorContext } from '@grafana/data';\nimport { t } from '@grafana/i18n';\nimport { InlineFieldRow, InlineField, RadioButtonGroup, Select } from '@grafana/ui';\nimport { NumberInput } from 'app/core/components/OptionsUI/NumberInput';\n\nimport { GeomapInstanceState, Options, MapViewConfig } from '../types';\n\ntype Props = {\n  labelWidth: number;\n  value: MapViewConfig;\n  onChange: (value?: MapViewConfig | undefined) => void;\n  context: StandardEditorContext<Options, GeomapInstanceState>;\n};\n\n// Data scope options for 'Fit to data'\nenum DataScopeValues {\n  all = 'all',\n  layer = 'layer',\n  last = 'last',\n}\nenum DataScopeLabels {\n  all = 'All layers',\n  layer = 'Layer',\n  last = 'Last value',\n}\n\nconst ScopeOptions = Object.values(DataScopeValues);\n\nconst DataScopeOptions: Array<SelectableValue<DataScopeValues>> = ScopeOptions.map((dataScopeOption) => ({\n  label: DataScopeLabels[dataScopeOption],\n  value: dataScopeOption,\n}));\n\nexport const FitMapViewEditor = ({ labelWidth, value, onChange, context }: Props) => {\n  const layers = useMemo(() => {\n    if (context.options?.layers) {\n      return context.options.layers.map((layer) => ({\n        label: layer.name,\n        value: layer.name,\n        description: undefined,\n      }));\n    }\n    return [];\n  }, [context.options?.layers]);\n\n  const onSelectLayer = useCallback(\n    (selection: SelectableValue<string>) => {\n      onChange({ ...value, layer: selection.value });\n    },\n    [value, onChange]\n  );\n\n  const allLayersEditorFragment = (\n    <InlineFieldRow>\n      <InlineField\n        label={t('geomap.fit-map-view-editor.all-layers-editor-fragment.label-layer', 'Layer')}\n        labelWidth={labelWidth}\n        grow={true}\n      >\n        <Select options={layers} onChange={onSelectLayer} placeholder={layers[0]?.label} value={value.layer} />\n      </InlineField>\n    </InlineFieldRow>\n  );\n\n  const onChangePadding = (padding: number | undefined) => {\n    onChange({ ...value, padding: padding });\n  };\n\n  const lastOnlyEditorFragment = (\n    <InlineFieldRow>\n      <InlineField\n        label={t('geomap.fit-map-view-editor.last-only-editor-fragment.label-padding', 'Padding')}\n        labelWidth={labelWidth}\n        grow={true}\n        tooltip={t(\n          'geomap.fit-map-view-editor.last-only-editor-fragment.tooltip-padding-relative-percent-beyond-extent',\n          'Sets padding in relative percent beyond data extent'\n        )}\n      >\n        <NumberInput value={value?.padding ?? 5} min={0} step={1} onChange={onChangePadding} />\n      </InlineField>\n    </InlineFieldRow>\n  );\n\n  const currentDataScope = value.allLayers\n    ? DataScopeValues.all\n    : !value.allLayers && value.lastOnly\n      ? DataScopeValues.last\n      : DataScopeValues.layer;\n\n  const onDataScopeChange = (dataScope: DataScopeValues) => {\n    if (dataScope !== DataScopeValues.all && !value.layer) {\n      onChange({\n        ...value,\n        allLayers: dataScope === String(DataScopeValues.all),\n        lastOnly: dataScope === String(DataScopeValues.last),\n        layer: layers[0].value,\n      });\n    } else {\n      onChange({\n        ...value,\n        allLayers: dataScope === String(DataScopeValues.all),\n        lastOnly: dataScope === String(DataScopeValues.last),\n      });\n    }\n  };\n\n  return (\n    <>\n      <InlineFieldRow>\n        <InlineField label={t('geomap.fit-map-view-editor.label-data', 'Data')} labelWidth={labelWidth} grow={true}>\n          <RadioButtonGroup\n            value={currentDataScope}\n            options={DataScopeOptions}\n            onChange={onDataScopeChange}\n          ></RadioButtonGroup>\n        </InlineField>\n      </InlineFieldRow>\n      {!value?.allLayers && allLayersEditorFragment}\n      {!value?.lastOnly && lastOnlyEditorFragment}\n    </>\n  );\n};\n","import { toLonLat } from 'ol/proj';\nimport { useMemo, useCallback, useId } from 'react';\n\nimport { StandardEditorProps, SelectableValue } from '@grafana/data';\nimport { Trans, t } from '@grafana/i18n';\nimport { Button, InlineField, InlineFieldRow, Select, Stack } from '@grafana/ui';\nimport { NumberInput } from 'app/core/components/OptionsUI/NumberInput';\n\nimport { Options, MapViewConfig, GeomapInstanceState } from '../types';\nimport { centerPointRegistry, MapCenterID } from '../view';\n\nimport { CoordinatesMapViewEditor } from './CoordinatesMapViewEditor';\nimport { FitMapViewEditor } from './FitMapViewEditor';\n\nexport const MapViewEditor = ({\n  value,\n  onChange,\n  context,\n}: StandardEditorProps<MapViewConfig, unknown, Options, GeomapInstanceState>) => {\n  const labelWidth = 10;\n\n  const views = useMemo(() => {\n    const ids: string[] = [];\n    if (value?.id) {\n      ids.push(value.id);\n    } else {\n      ids.push(centerPointRegistry.list()[0].id);\n    }\n    return centerPointRegistry.selectOptions(ids);\n  }, [value?.id]);\n\n  const onSetCurrentView = useCallback(() => {\n    const map = context.instanceState?.map;\n    if (map) {\n      const view = map.getView();\n      const coords = view.getCenter();\n      if (coords) {\n        const center = toLonLat(coords, view.getProjection());\n        onChange({\n          ...value,\n          id: MapCenterID.Coordinates,\n          lon: +center[0].toFixed(6),\n          lat: +center[1].toFixed(6),\n          zoom: +view.getZoom()!.toFixed(2),\n        });\n      }\n    }\n  }, [value, onChange, context.instanceState]);\n\n  const onSelectView = useCallback(\n    (selection: SelectableValue<string>) => {\n      const v = centerPointRegistry.getIfExists(selection.value);\n      if (v) {\n        onChange({\n          ...value,\n          id: v.id,\n          lat: v.lat ?? value?.lat,\n          lon: v.lon ?? value?.lon,\n          zoom: v.zoom ?? value?.zoom,\n        });\n      }\n    },\n    [value, onChange]\n  );\n\n  const viewInputId = useId();\n  const zoomInputId = useId();\n\n  return (\n    <>\n      <InlineFieldRow>\n        <InlineField label={t('geomap.map-view-editor.label-view', 'View')} labelWidth={labelWidth} grow={true}>\n          <Select inputId={viewInputId} options={views.options} value={views.current} onChange={onSelectView} />\n        </InlineField>\n      </InlineFieldRow>\n      {value.id === MapCenterID.Coordinates && (\n        <CoordinatesMapViewEditor labelWidth={labelWidth} value={value} onChange={onChange} />\n      )}\n      {value.id === MapCenterID.Fit && (\n        <FitMapViewEditor labelWidth={labelWidth} value={value} onChange={onChange} context={context} />\n      )}\n\n      <InlineFieldRow>\n        <InlineField\n          label={\n            value?.id === MapCenterID.Fit\n              ? t('geomap.map-view-editor.label-max-zoom', 'Max Zoom')\n              : t('geomap.map-view-editor.label-zoom', 'Zoom')\n          }\n          labelWidth={labelWidth}\n          grow={true}\n        >\n          <NumberInput\n            id={zoomInputId}\n            value={value?.zoom ?? 1}\n            min={1}\n            max={18}\n            step={0.01}\n            onChange={(v) => {\n              onChange({ ...value, zoom: v });\n            }}\n          />\n        </InlineField>\n      </InlineFieldRow>\n\n      <Stack direction=\"column\">\n        <Button variant=\"secondary\" size=\"sm\" fullWidth onClick={onSetCurrentView}>\n          <span>\n            <Trans i18nKey=\"geomap.map-view-editor.use-current-map-settings\">Use current map settings</Trans>\n          </span>\n        </Button>\n      </Stack>\n    </>\n  );\n};\n","import { get as lodashGet, isEqual } from 'lodash';\n\nimport { FrameGeometrySourceMode, getFrameMatchers, MapLayerOptions } from '@grafana/data';\nimport { NestedPanelOptions, NestedValueAccess } from '@grafana/data/internal';\nimport { t } from '@grafana/i18n';\nimport { setOptionImmutably } from 'app/features/dashboard/components/PanelEditor/utils';\nimport { addLocationFields } from 'app/features/geo/editor/locationEditor';\n\nimport { defaultMarkersConfig } from '../layers/data/markersLayer';\nimport { DEFAULT_BASEMAP_CONFIG, geomapLayerRegistry, getLayersOptions } from '../layers/registry';\nimport { MapLayerState } from '../types';\n\nimport { FrameSelectionEditor } from './FrameSelectionEditor';\n\nexport interface LayerEditorOptions {\n  state: MapLayerState;\n  category: string[];\n  basemaps: boolean; // only basemaps\n}\n\nexport function getLayerEditor(opts: LayerEditorOptions): NestedPanelOptions<MapLayerOptions> {\n  return {\n    category: opts.category,\n    path: '--', // Not used\n    defaultValue: opts.basemaps ? DEFAULT_BASEMAP_CONFIG : defaultMarkersConfig,\n    values: (parent: NestedValueAccess) => ({\n      getContext: (parent) => {\n        return { ...parent, options: opts.state.options, instanceState: opts.state };\n      },\n      getValue: (path: string) => lodashGet(opts.state.options, path),\n      onChange: (path: string, value: string) => {\n        const { state } = opts;\n        const { options } = state;\n        if (path === 'type' && value) {\n          const layer = geomapLayerRegistry.getIfExists(value);\n          if (layer) {\n            const opts = {\n              ...options, // keep current shared options\n              type: layer.id,\n              config: { ...layer.defaultOptions }, // clone?\n            };\n            if (layer.showLocation) {\n              if (!opts.location?.mode) {\n                opts.location = { mode: FrameGeometrySourceMode.Auto };\n              } else {\n                delete opts.location;\n              }\n            }\n            state.onChange(opts);\n            return;\n          }\n        }\n        state.onChange(setOptionImmutably(options, path, value));\n      },\n    }),\n    build: (builder, context) => {\n      if (!opts.state) {\n        return;\n      }\n\n      const { handler, options } = opts.state;\n      const layer = geomapLayerRegistry.getIfExists(options?.type);\n\n      const layerTypes = getLayersOptions(\n        opts.basemaps,\n        options?.type // the selected value\n          ? options.type\n          : DEFAULT_BASEMAP_CONFIG.type\n      );\n\n      builder.addSelect({\n        path: 'type',\n        name: t('geomap.layer-editor.name-layer-type', 'Layer type'), // required, but hide space\n        settings: {\n          options: layerTypes.options,\n        },\n      });\n\n      // Show data filter if the layer type can do something with the data query results\n      if (handler.update) {\n        builder.addCustomEditor({\n          id: 'filterData',\n          path: 'filterData',\n          name: t('geomap.layer-editor.name-data', 'Data'),\n          editor: FrameSelectionEditor,\n          defaultValue: undefined,\n        });\n      }\n\n      if (!layer) {\n        return; // unknown layer type\n      }\n\n      // Don't show UI for default configuration\n      if (options.type === DEFAULT_BASEMAP_CONFIG.type) {\n        return;\n      }\n\n      if (layer.showLocation) {\n        let data = context.data;\n        // If `filterData` exists filter data feeding into location editor\n        if (options.filterData) {\n          const matcherFunc = getFrameMatchers(options.filterData);\n          data = data.filter(matcherFunc);\n        }\n\n        addLocationFields('Location', 'location.', builder, options.location, data);\n      }\n      if (handler.registerOptionsUI) {\n        handler.registerOptionsUI(builder, context);\n      }\n      if (!isEqual(opts.category, [t('geomap.layer-editor.category-base-layer', 'Base layer')])) {\n        if (!layer.hideOpacity) {\n          builder.addSliderInput({\n            path: 'opacity',\n            name: t('geomap.layer-editor.name-opacity', 'Opacity'),\n            defaultValue: 1,\n            settings: {\n              min: 0,\n              max: 1,\n              step: 0.1,\n            },\n          });\n        }\n        builder.addBooleanSwitch({\n          path: 'layer-tooltip',\n          name: t('geomap.layer-editor.name-display-tooltip', 'Display tooltip'),\n          description: t('geomap.layer-editor.description-display-tooltip', 'Show the tooltip for layer'),\n          defaultValue: true,\n        });\n      }\n    },\n  };\n}\n","import { cloneDeep } from 'lodash';\n\nimport {\n  FieldConfigSource,\n  PanelModel,\n  PanelTypeChangedHandler,\n  Threshold,\n  ThresholdsMode,\n  fieldReducers,\n  FrameGeometrySourceMode,\n  DataTransformerConfig,\n  DataTransformerID,\n} from '@grafana/data';\nimport { ResourceDimensionMode } from '@grafana/schema';\n\nimport { defaultMarkersConfig, MarkersConfig } from './layers/data/markersLayer';\nimport { getMarkerAsPath } from './style/markers';\nimport { defaultStyleConfig } from './style/types';\nimport { Options, TooltipMode } from './types';\nimport { MapCenterID } from './view';\n\n/**\n * This is called when the panel changes from another panel\n */\nexport const mapPanelChangedHandler: PanelTypeChangedHandler = (panel, prevPluginId, prevOptions, prevFieldConfig) => {\n  // Changing from angular/worldmap panel to react/openlayers\n  if (prevPluginId === 'grafana-worldmap-panel' && prevOptions.angular) {\n    const { fieldConfig, options, xform } = worldmapToGeomapOptions({\n      ...prevOptions.angular,\n      fieldConfig: prevFieldConfig,\n    });\n    if (xform?.id?.length) {\n      panel.transformations = panel.transformations ? [...panel.transformations, xform] : [xform];\n    }\n    panel.fieldConfig = fieldConfig; // Mutates the incoming panel\n    return options;\n  }\n\n  return {};\n};\n\nexport function worldmapToGeomapOptions(angular: any): {\n  fieldConfig: FieldConfigSource;\n  options: Options;\n  xform?: DataTransformerConfig;\n} {\n  const fieldConfig: FieldConfigSource = {\n    defaults: {},\n    overrides: [],\n  };\n\n  const markersLayer = cloneDeep(defaultMarkersConfig);\n  const options: Options = {\n    view: {\n      id: MapCenterID.Zero,\n    },\n    controls: {\n      showZoom: true,\n      mouseWheelZoom: Boolean(angular.mouseWheelZoom),\n    },\n    basemap: {\n      type: 'default', // was carto\n      name: 'Basemap',\n    },\n    layers: [markersLayer],\n    tooltip: { mode: TooltipMode.Details },\n  };\n\n  let v = asNumber(angular.decimals);\n  if (v) {\n    fieldConfig.defaults.decimals = v;\n  }\n\n  // Set the markers range\n  const style = markersLayer.config!.style;\n  v = asNumber(angular.circleMaxSize);\n  if (v) {\n    style.size!.max = v;\n  }\n  v = asNumber(angular.circleMinSize);\n  if (v) {\n    style.size!.min = v;\n  }\n\n  let xform: DataTransformerConfig | undefined = undefined;\n  const reducer = fieldReducers.getIfExists(angular.valueName);\n  if (reducer && angular.locationData?.length) {\n    xform = {\n      id: DataTransformerID.reduce,\n      options: {\n        reducers: [reducer.id],\n      },\n    };\n\n    switch (angular.locationData) {\n      case 'countries':\n      case 'countries_3letter':\n        markersLayer.location = {\n          mode: FrameGeometrySourceMode.Lookup,\n          gazetteer: 'public/gazetteer/countries.json',\n          lookup: undefined, // will default to first string field from reducer\n        };\n        break;\n\n      case 'states':\n        markersLayer.location = {\n          mode: FrameGeometrySourceMode.Lookup,\n          gazetteer: 'public/gazetteer/usa-states.json',\n          lookup: undefined, // will default to first string field from reducer\n        };\n        break;\n    }\n  }\n\n  // Convert thresholds and color values\n  if (angular.thresholds && angular.colors) {\n    const levels = angular.thresholds.split(',').map((strVale: string) => {\n      return Number(strVale.trim());\n    });\n\n    // One more color than threshold\n    const thresholds: Threshold[] = [];\n    for (const color of angular.colors) {\n      const idx = thresholds.length - 1;\n      if (idx >= 0) {\n        thresholds.push({ value: levels[idx], color });\n      } else {\n        thresholds.push({ value: -Infinity, color });\n      }\n    }\n\n    fieldConfig.defaults.thresholds = {\n      mode: ThresholdsMode.Absolute,\n      steps: thresholds,\n    };\n  }\n\n  v = asNumber(angular.initialZoom);\n  if (v) {\n    options.view.zoom = v;\n  }\n\n  // mapCenter: 'Europe',\n  // mapCenterLatitude: 46,\n  // mapCenterLongitude: 14,\n  //\n  // Map center (from worldmap)\n  const mapCenters: any = {\n    '(0, 0)': MapCenterID.Zero,\n    'North America': 'north-america',\n    Europe: 'europe',\n    'West Asia': 'west-asia',\n    'SE Asia': 'se-asia',\n    'Last GeoHash': MapCenterID.Coordinates, // MapCenterID.LastPoint,\n  };\n  options.view.id = mapCenters[angular.mapCenter];\n  options.view.lat = asNumber(angular.mapCenterLatitude);\n  options.view.lon = asNumber(angular.mapCenterLongitude);\n  return { fieldConfig, options, xform };\n}\n\nfunction asNumber(v: unknown): number | undefined {\n  const num = Number(v);\n  return isNaN(num) ? undefined : num;\n}\n\nexport const mapMigrationHandler = (panel: PanelModel): Partial<Options> => {\n  const pluginVersion = panel?.pluginVersion ?? '';\n\n  // before 8.3, only one layer was supported!\n  if (pluginVersion.startsWith('8.1') || pluginVersion.startsWith('8.2')) {\n    const layers = panel.options?.layers;\n    if (layers?.length === 1) {\n      const layer = panel.options.layers[0];\n      if (layer?.type === 'markers' && layer.config) {\n        // Moving style to child object\n        const oldConfig = layer.config;\n        const config: MarkersConfig = {\n          style: cloneDeep(defaultStyleConfig),\n          showLegend: Boolean(oldConfig.showLegend),\n        };\n\n        if (oldConfig.size) {\n          config.style.size = oldConfig.size;\n        }\n        if (oldConfig.color) {\n          config.style.color = oldConfig.color;\n        }\n        if (oldConfig.fillOpacity) {\n          config.style.opacity = oldConfig.fillOpacity;\n        }\n        const symbol = getMarkerAsPath(oldConfig.shape);\n        if (symbol) {\n          config.style.symbol = {\n            fixed: symbol,\n            mode: ResourceDimensionMode.Fixed,\n          };\n        }\n        return { ...panel.options, layers: [{ ...layer, config }] };\n      }\n    }\n  }\n  return panel.options;\n};\n","import { PanelPlugin } from '@grafana/data';\nimport { t, Trans } from '@grafana/i18n';\nimport { config } from '@grafana/runtime';\nimport { commonOptionsBuilder } from '@grafana/ui';\n\nimport { GeomapPanel } from './GeomapPanel';\nimport { LayersEditor } from './editor/LayersEditor';\nimport { MapViewEditor } from './editor/MapViewEditor';\nimport { getLayerEditor } from './editor/layerEditor';\nimport { mapPanelChangedHandler, mapMigrationHandler } from './migrations';\nimport { defaultMapViewConfig, Options, TooltipMode, GeomapInstanceState } from './types';\n\nexport const plugin = new PanelPlugin<Options>(GeomapPanel)\n  .setNoPadding()\n  .setPanelChangeHandler(mapPanelChangedHandler)\n  .setMigrationHandler(mapMigrationHandler)\n  .useFieldConfig({\n    useCustomConfig: (builder) => {\n      commonOptionsBuilder.addHideFrom(builder);\n    },\n  })\n  .setPanelOptions((builder, context) => {\n    let category = [t('geomap.category-map-view', 'Map view')];\n    builder.addCustomEditor({\n      category,\n      id: 'view',\n      path: 'view',\n      name: t('geomap.name-initial-view', 'Initial view'), // don't show it\n      description: t('geomap.description-initial-view', 'This location will show when the panel first loads.'),\n      editor: MapViewEditor,\n      defaultValue: defaultMapViewConfig,\n    });\n\n    builder.addBooleanSwitch({\n      category,\n      path: 'view.shared',\n      description: t(\n        'geomap.description-share-view',\n        'Use the same view across multiple panels.  Note: this may require a dashboard reload.'\n      ),\n      name: t('geomap.name-share-view', 'Share view'),\n      defaultValue: defaultMapViewConfig.shared,\n    });\n\n    builder.addBooleanSwitch({\n      category,\n      path: 'view.noRepeat',\n      name: t('geomap.name-no-repeat', 'No map repeating'),\n      description: t('geomap.description-no-repeat', 'Prevent the map from repeating horizontally'),\n      defaultValue: false,\n    });\n\n    // eslint-disable-next-line\n    const state = context.instanceState as GeomapInstanceState;\n    if (!state?.layers) {\n      // TODO? show spinner?\n    } else {\n      const layersCategory = [t('geomap.category-map-layers', 'Map layers')];\n      const basemapCategory = [t('geomap.category-basemap-layer', 'Basemap layer')];\n      builder.addCustomEditor({\n        category: layersCategory,\n        id: 'layers',\n        path: '',\n        name: '',\n        editor: LayersEditor,\n      });\n\n      const selected = state.layers[state.selected];\n      if (state.selected && selected) {\n        builder.addNestedOptions(\n          getLayerEditor({\n            state: selected,\n            category: layersCategory,\n            basemaps: false,\n          })\n        );\n      }\n\n      const baselayer = state.layers[0];\n      if (config.geomapDisableCustomBaseLayer) {\n        builder.addCustomEditor({\n          category: basemapCategory,\n          id: 'layers',\n          path: '',\n          name: '',\n          // eslint-disable-next-line react/display-name\n          editor: () => (\n            <div>\n              <Trans i18nKey=\"geomap.plugin.basemap-layer-configured-server-admin\">\n                The basemap layer is configured by the server admin.\n              </Trans>\n            </div>\n          ),\n        });\n      } else if (baselayer) {\n        builder.addNestedOptions(\n          getLayerEditor({\n            state: baselayer,\n            category: basemapCategory,\n            basemaps: true,\n          })\n        );\n      }\n    }\n\n    // The controls section\n    category = [t('geomap.category-map-controls', 'Map controls')];\n    builder\n      .addBooleanSwitch({\n        category,\n        path: 'controls.showZoom',\n        description: t('geomap.description-show-zoom', 'Show zoom control buttons in the upper left corner'),\n        name: t('geomap.name-show-zoom', 'Show zoom control'),\n        defaultValue: true,\n      })\n      .addBooleanSwitch({\n        category,\n        path: 'controls.mouseWheelZoom',\n        description: t('geomap.description-mouse-wheel-zoom', 'Enable zoom control via mouse wheel'),\n        name: t('geomap.name-mouse-wheel-zoom', 'Mouse wheel zoom'),\n        defaultValue: true,\n      })\n      .addBooleanSwitch({\n        category,\n        path: 'controls.showAttribution',\n        name: t('geomap.name-show-attribution', 'Show attribution'),\n        description: t(\n          'geomap.description-show-attribution',\n          'Show the map source attribution info in the lower right'\n        ),\n        defaultValue: true,\n      })\n      .addBooleanSwitch({\n        category,\n        path: 'controls.showScale',\n        name: t('geomap.name-show-scale', 'Show scale'),\n        description: t('geomap.description-show-scale', 'Indicate map scale'),\n        defaultValue: false,\n      })\n      .addBooleanSwitch({\n        category,\n        path: 'controls.showMeasure',\n        name: t('geomap.name-show-measure', 'Show measure tools'),\n        description: t('geomap.description-show-measure', 'Show tools for making measurements on the map'),\n        defaultValue: false,\n      })\n      .addBooleanSwitch({\n        category,\n        path: 'controls.showDebug',\n        name: t('geomap.name-show-debug', 'Show debug'),\n        description: t('geomap.description-show-debug', 'Show map info'),\n        defaultValue: false,\n      })\n      .addRadio({\n        category,\n        path: 'tooltip.mode',\n        name: t('geomap.name-tooltip', 'Tooltip'),\n        defaultValue: TooltipMode.Details,\n        settings: {\n          options: [\n            {\n              label: t('geomap.tooltip-options.label-none', 'None'),\n              value: TooltipMode.None,\n              description: t('geomap.tooltip-options.description-none', 'Show contents on click, not hover'),\n            },\n            {\n              label: t('geomap.tooltip-options.label-details', 'Details'),\n              value: TooltipMode.Details,\n              description: t('geomap.tooltip-options.description-details', 'Show popup on hover'),\n            },\n          ],\n        },\n      });\n  });\n","import { css } from '@emotion/css';\nimport { useState, useEffect } from 'react';\nimport * as React from 'react';\n\nimport { GrafanaTheme2 } from '@grafana/data';\nimport { useTheme2 } from '@grafana/ui';\n\ntype Props = {\n  colorPalette: string[];\n  min: number;\n  max: number;\n\n  // Show a value as string -- when not defined, the raw values will not be shown\n  display?: (v: number) => string;\n  hoverValue?: number;\n  useStopsPercentage?: boolean;\n};\n\ntype HoverState = {\n  isShown: boolean;\n  value: number;\n};\n\nconst GRADIENT_STOPS = 10;\n\nexport const ColorScale = ({ colorPalette, min, max, display, hoverValue, useStopsPercentage }: Props) => {\n  const [colors, setColors] = useState<string[]>([]);\n  const [scaleHover, setScaleHover] = useState<HoverState>({ isShown: false, value: 0 });\n  const [percent, setPercent] = useState<number | null>(null); // 0-100 for CSS percentage\n\n  const theme = useTheme2();\n  const styles = getStyles(theme, colors);\n\n  useEffect(() => {\n    setColors(getGradientStops({ colorArray: colorPalette, stops: GRADIENT_STOPS, useStopsPercentage }));\n  }, [colorPalette, useStopsPercentage]);\n\n  const onScaleMouseMove = (event: React.MouseEvent<HTMLDivElement>) => {\n    const divOffset = event.nativeEvent.offsetX;\n    const offsetWidth = event.currentTarget.offsetWidth;\n    const normPercentage = Math.floor((divOffset * 100) / offsetWidth + 1);\n    const scaleValue = Math.floor(((max - min) * normPercentage) / 100 + min);\n\n    setScaleHover({ isShown: true, value: scaleValue });\n    setPercent(normPercentage);\n  };\n\n  const onScaleMouseLeave = () => {\n    setScaleHover({ isShown: false, value: 0 });\n  };\n\n  useEffect(() => {\n    setPercent(hoverValue == null ? null : clampPercent100((hoverValue - min) / (max - min)));\n  }, [hoverValue, min, max]);\n\n  return (\n    <div className={styles.scaleWrapper} onMouseMove={onScaleMouseMove} onMouseLeave={onScaleMouseLeave}>\n      <div className={styles.scaleGradient}>\n        {display && (scaleHover.isShown || hoverValue !== undefined) && (\n          <div className={styles.followerContainer}>\n            <div className={styles.follower} style={{ left: `${percent}%` }} />\n          </div>\n        )}\n      </div>\n      {display && (\n        <div className={styles.followerContainer}>\n          <div className={styles.legendValues}>\n            <span className={styles.disabled}>{display(min)}</span>\n            <span className={styles.disabled}>{display(max)}</span>\n          </div>\n          {percent != null && (scaleHover.isShown || hoverValue !== undefined) && (\n            <span className={styles.hoverValue} style={{ left: `${percent}%` }}>\n              {display(hoverValue ?? scaleHover.value)}\n            </span>\n          )}\n        </div>\n      )}\n    </div>\n  );\n};\n\nconst getGradientStops = ({\n  colorArray,\n  stops,\n  useStopsPercentage = true,\n}: {\n  colorArray: string[];\n  stops: number;\n  useStopsPercentage?: boolean;\n}): string[] => {\n  const colorCount = colorArray.length;\n  if (useStopsPercentage && colorCount <= 20) {\n    const incr = (1 / colorCount) * 100;\n    let per = 0;\n    const stops: string[] = [];\n    for (const color of colorArray) {\n      if (per > 0) {\n        stops.push(`${color} ${per}%`);\n      } else {\n        stops.push(color);\n      }\n      per += incr;\n      stops.push(`${color} ${per}%`);\n    }\n    return stops;\n  }\n\n  const gradientEnd = colorArray[colorCount - 1];\n  const skip = Math.ceil(colorCount / stops);\n  const gradientStops = new Set<string>();\n\n  for (let i = 0; i < colorCount; i += skip) {\n    gradientStops.add(colorArray[i]);\n  }\n\n  gradientStops.add(gradientEnd);\n\n  return [...gradientStops];\n};\n\nfunction clampPercent100(v: number) {\n  if (v > 1) {\n    return 100;\n  }\n  if (v < 0) {\n    return 0;\n  }\n  return v * 100;\n}\n\nconst getStyles = (theme: GrafanaTheme2, colors: string[]) => ({\n  scaleWrapper: css({\n    width: '100%',\n    fontSize: '11px',\n    opacity: 1,\n  }),\n  scaleGradient: css({\n    background: `linear-gradient(90deg, ${colors.join()})`,\n    height: '9px',\n    pointerEvents: 'none',\n    borderRadius: theme.shape.radius.default,\n  }),\n  legendValues: css({\n    display: 'flex',\n    justifyContent: 'space-between',\n    pointerEvents: 'none',\n  }),\n  hoverValue: css({\n    position: 'absolute',\n    marginTop: '-14px',\n    padding: '3px 15px',\n    transform: 'translateX(-50%)',\n  }),\n  followerContainer: css({\n    position: 'relative',\n    pointerEvents: 'none',\n    whiteSpace: 'nowrap',\n  }),\n  follower: css({\n    position: 'absolute',\n    height: '13px',\n    width: '13px',\n    borderRadius: theme.shape.radius.default,\n    transform: 'translateX(-50%) translateY(-50%)',\n    border: `2px solid ${theme.colors.text.primary}`,\n    top: '5px',\n  }),\n  disabled: css({\n    color: theme.colors.text.disabled,\n  }),\n});\n"],"names":["UNITS_PROP","LEADING_DIGITS","DEFAULT_DPI","ScaleLine","Control","options","element","className","units","dpi","viewState","center","projection","pointResolutionUnits","pointResolution","minWidth","maxWidth","nominalCount","suffix","metersPerDegree","i","count","width","decimalCount","previousCount","previousWidth","previousDecimalCount","decimal","html","scale","resolutionScale","mapScale","steps","stepWidth","scaleSteps","cls","position","isLast","lengthString","margin","resolution","inchesPerMeter","mapEvent","frameState","GeomapOverlay","topRight1","topRight2","bottomLeft","blStyle","topRight1Exists","styles","getStyles","theme","DataHoverRow","feature","data","rowIndex","geometry","properties","ArrayDataFrame","DataHoverView","DataHoverRows","layers","activeTabIndex","rowMap","setRowMap","updateRowMap","key","value","TabContent","geomapLayer","index","idx","Collapse","generateLabel","names","props","first","frame","f","k","v","DataHoverTabs","setActiveTabIndex","TabsBar","g","Tab","ComplexDataHoverView","onClose","isOpen","CloseButton","GeomapTooltip","ttip","ref","overlayProps","useOverlay","dialogProps","useDialog","Portal","VizTooltipContainer","DebugOverlay","view","zoom","selectors","tinycolor","measures","m","u","m2","withCredentials","loadFeaturesXhr","url","format","extent","success","failure","xhr","event","type","source","features","dataProjection","setWithCredentials","xhrWithCredentials","bbox","tile","tileGrid","z","tileRange","extents","tileCoord","RBush","maxEntries","item","values","items","l","uid","callback","result","rbush","Source","adaptAttributions","self","resolve","reject","attributions","state","attributionLike","VectorSourceEvent","Event","VectorSource","useSpatialIndex","collection","Collection","featureKey","VectorEventType","EventType","ObjectEventType","valid","id","indexedFeature","newFeatures","geometryFeatures","length","modifyingCollection","evt","CollectionEventType","fast","featureId","clearEvent","coordinate","anExtent","filter","x","y","closestFeature","closestPoint","minSquaredDistance","previousMinSquaredDistance","minDistance","sid","loadedExtentsRtree","extentsToLoad","ii","extentToLoad","object","obj","removed","idString","loader","overlaps","CIRCLE_CENTER_INDEX","CIRCLE_CIRCUMFERENCE_INDEX","tempExtent","tempSegment","ModifyEventType","ModifyEvent","mapBrowserEvent","Modify","Pointer","Vector","getDefaultStyleFunction","writer","map","segments","rBush","nodesToRemove","node","nodeToRemove","j","active","coordinates","segmentData","points","segment","lines","jj","rings","polygons","kk","centerSegmentData","circumferenceSegmentData","featureSegments","circleGeometry","userProjection","geometries","existing","vertexFeature","Feature","Point","handled","MapBrowserEventType","pixelCoordinate","insertVertices","vertex","vertexExtent","segmentDataMatches","componentSegments","compareIndexes","segmentDataMatch","depth","closestVertex","closestOnSegmentData","dragSegment","circle","radius","pixel","sortByDistance","a","b","projectedDistanceToSegmentDataSquared","nodes","hitPointGeometry","layerFilter","layer","geom","viewExtent","buffer","box","closestSegment","vertexPixel","dist","vertexSegments","pixel1","pixel2","squaredDist1","squaredDist2","geometryUid","rTree","newSegmentData","newSegmentData2","dragSegments","segmentsByFeature","deleted","component","left","newIndex","right","prev","delta","pointCoordinates","distanceToCenterSquared","distanceToCircumference","style","SimpleGeometry","layout","flatCoordinates","dx","dy","squaredDistance","circleExtent","stride","offset","deflate","angle","anchor","DrawEventType","DrawEvent","getTraceTargets","targets","appendGeometryTraceTargets","getSquaredDistance","getCoordinate","getCumulativeSquaredDistance","startIndex","endIndex","lowIndex","highIndex","lowWholeIndex","highWholeIndex","start","interpolateCoordinate","end","sd","LineString","appendTraceTarget","MultiLineString","MultiPolygon","polys","GeometryCollection","sharedUpdateInfo","getTraceTargetUpdate","traceState","snapTolerance","closestTargetDistance","newTargetIndex","newEndIndex","targetIndex","target","minSegmentDistance","coordinateIndex","rel","getPointSegmentRelationship","newTarget","considerBothDirections","newCoordinate","forwardDistance","reverseDistance","ring","sharedRel","x1","y1","x2","y2","along","px","py","x0","y0","Draw","pointerOptions","getMode","geometryFunction","mode","squaredLength","Constructor","trace","condition","move","pass","MapBrowserEvent","lowerLeft","upperRight","previouslyForward","currentlyForward","fromIndex","toIndex","remove","updatedTraceTarget","oldTarget","tracing","startingToDraw","downPx","clickPx","at","potentiallyDone","potentiallyFinishCoordinates","sketchCoords","finishCoordinate","finishPixel","sketchLineGeom","last","done","n","sketchFeature","MultiPoint","newDrawing","ending","lineString","sketchFeatures","overlaySource","createRegularPolygon","sides","internalAngle","createBox","boxCoordinates","MeasureVectorLayer","Style","Text","Fill","RegularShape","Stroke","geo","action","drawType","tip","point","label","line","segmentPoint","typeSelect","showSegments","clearPrevious","activeTip","idleTip","MeasureOverlay","menuActiveState","vector","measureStyle","firstLoad","setFirstLoad","menuActive","setMenuActive","setOptions","unit","current","toggleMenu","RadioButtonGroup","e","Button","Select","IconButton","getGlobalStyles","createFeature","FrameVectorSource","location","info","MarkersLegend","layerName","styleConfig","hoverEvent","useObservable","of","colorField","hoverValue","color","opacity","symbol","SanitizedSVG","colorMode","colors","colorRange","display","ColorScale","thresholds","ObservablePropsWrapper","subProps","err","RegularShapeId","MarkerShapePath","getFillColor","cfg","getStrokeStyle","textLabel","fontFamily","config","textConfig","textMarker","circleMarker","stroke","getDisplacement","polyStyle","routeStyle","errorMarker","makers","rotation","prepareSVG","size","backgroundOpacity","res","text","doc","svg","svgSize","height","viewBox","viewCenterX","viewCenterY","circleElement","svgString","error","markerMakers","Registry","getMarkerAsPath","shape","marker","colorExpression","sizeExpression","opacityExpression","rotationExpression","offsetExpression","baseShapeStyle","baseCircleStyle","getWebGLStyle","getMarkerMaker","hasTextLabel","maker","src","Icon","styleUsesText","getStyleConfigState","hasText","fields","symbolAlign","displacement","getRGBValues","colorString","getRGBFromHex","getRGBFromRGBString","hexColor","r","rgbString","matches","StyleEditor","onChange","context","settings","onSizeChange","sizeValue","onSymbolChange","symbolValue","onColorChange","colorValue","onOpacityChange","opacityValue","onRotationChange","rotationValue","onTextChange","textValue","onTextFontSizeChange","fontSize","onTextOffsetXChange","offsetX","onTextOffsetYChange","offsetY","onTextAlignChange","textAlign","onTextBaselineChange","textBaseline","onAlignHorizontalChange","alignHorizontal","onAlignVerticalChange","alignVertical","featuresHavePoints","maxFiles","symbolId","rotationAngleId","colorId","opacityId","sizeId","symbol1Id","symbolVertId","color1Id","fillOpacityId","rotationAngle1Id","textId","fontSizeId","xOffsetId","yOffsetId","InlineFieldRow","InlineField","ResourceDimensionEditor","Field","ScalarDimensionEditor","InlineLabel","ColorPicker","ScaleDimensionEditor","ColorDimensionEditor","TextDimensionEditor","Stack","defaultOptions","MARKERS_LAYER_ID","defaultMarkersConfig","markersLayer","eventBus","webGLStyle","symbolLayer","WebGLPoints","vectorLayer","VectorImage","hasVector","legendProps","ReplaySubject","legend","hasLineString","processedMarkers","createMarkerKey","markerValues","coord","isLineString","dims","markerKey","lineStringStyle","colorValues","textStyle","layersArray","builder","tmpTileCoord","DECIMALS","TileGrid","zoomFactor","TileRange","restrictedTileRange","tempTileRange","tileCoordExtent","minX","minY","tileCoordZ","tileCoordX","tileCoordY","factor","maxX","maxY","origin","tileSize","opt_tileCoord","reverseIntersectionPolicy","opt_direction","viewport","fullTileRanges","getForProjection","createForProjection","wrapX","projectionExtent","extentFromProjection","worldWidth","worldsAway","createForExtent","maxZoom","corner","resolutions","resolutionsFromExtent","createXYZ","xyzOptions","gridOptions","maxResolution","half","appendParams","uri","params","keyParams","qs","zRegEx","xRegEx","yRegEx","dashYRegEx","renderXYZTemplate","template","pickUrl","urls","hash","expandUrl","match","startCharCode","stopCharCode","charCode","stop","createFromTemplate","pixelRatio","range","createFromTemplates","templates","len","tileUrlFunctions","createFromTileUrlFunctions","h","nullTileUrlFunction","TileSource","tilePixelRatio","gridProjection","TileSourceEvent","UrlTile","tileState","TileState","TileEventType","tileLoadFunction","tileUrlFunction","TileImage","defaultTileLoadFunction","ImageTile","thisProj","projKey","urlTileCoord","tileUrl","sourceProjection","sourceTileGrid","targetTileGrid","wrappedTileCoord","render","tilegrid","proj","imageTile","XYZ","LayerTheme","defaultCartoConfig","carto","noRepeat","Tile","cartoLayers","sampleURL","defaultXYZConfig","xyzTiles","genericLayers","CUSTOM_SERVICE","DEFAULT_SERVICE","publicServiceRegistry","esriLayers","svc","base","opts","xyz","ATTRIBUTION","OSM","crossOrigin","basemapLayers","ol_source_DayNight","julianDay","deg2rad","L","lambda","R","T","epsilon","sunEclLon","eclObliq","rad2deg","alpha","lQuadrant","raQuadrant","lon","time","date","gst","sunEclPos","sunEqPos","ha","lat","lonlat","step","tlon","day","t","ShowTime","defaultConfig","DAY_NIGHT_LAYER_ID","defaultDayNightConfig","dayNightLayer","DayNight","sourceMethods","nightLineLayer","sunFeature","sunLayer","sunLineFeature","sunLineStyle","sunLineStyleDash","sunLineLayer","subscriptions","Subscription","from","to","selectedTime","sunPos","checkFeatureMatchesStyleRule","rule","val","compareValues","getLayerPropertyInfo","types","geometryType","getUniqueFeatureValues","unique","DEFAULT_STYLE_RULE","defaultDynamicGeoJSONConfig","dynamicGeoJSONLayer","GeoJSON","updateFeatureProperties","updateFeaturePropertiesForTooltip","idToIdx","currentFrame","s","isPoint","check","layerInfo","idField","field","getSelectionInfo","StyleRuleEditor","propertyOptions","feats","uniqueSelectables","newValue","LABEL_WIDTH","onChangeProperty","selection","onChangeComparison","onChangeValue","onChangeNumericValue","onChangeStyle","onDelete","propv","valuev","NumberInput","GeomapStyleRulesEditor","onAddRule","palette","newRule","onRuleChange","copyStyles","styleOptions","itemSettings","geojsonLayer","interpolatedUrl","layerUrl","polyStyleStrings","pointStyleStrings","lineStyleStrings","featureType","isPolygon","isLine","featureProps","property","MixedGeometryBatch","projectionTransform","featureUid","entry","multiPolygonGeom","multiLineGeom","multiPointGeom","polygonGeom","pointGeom","lineGeom","flatCoords","ends","verticesCount","multiPolygonEndss","polygonEnds","prevPolygonEnds","multiLineEnds","multiPolygonEnds","ringsCount","ringsVerticesCount","ind","arr","getFlatCoordinatesXY","getFlatCoordinatesXYM","currentRef","featureFilter","filtered","empty","pushCustomAttributesInRenderInstructions","renderInstructions","customAttributes","batchEntry","currentIndex","shift","attr","getCustomAttributesSize","curr","generatePointRenderInstructions","batch","transform","totalInstructionsCount","tmpCoords","renderIndex","generateLineStringRenderInstructions","generatePolygonRenderInstructions","tmpColor","WEBGL_WORKER","getWebGLWorker","workerMessageCounter","Attributes","VectorStyleRenderer","styleOrShaders","variables","helper","enableHitDetection","asShaders","asRule","parseResult","hitDetectionAttributes","customAttributesDesc","name","parsingContext","compiled","evalContext","geometryBatch","filteredBatch","polygonBuffers","lineStringBuffers","pointBuffers","invertVerticesTransform","polygonInstructions","lineStringInstructions","pointInstructions","messageId","messageType","message","handleMessage","received","verticesBuffer","indicesBuffer","buffers","preRenderCallback","program","attributes","renderCount","Uniforms","WebGLVectorLayerRenderer","uniforms","renderer","batchInvertTransform","mat4","gl","startWorld","endWorld","canvas","vectorSource","viewNotMoving","ViewHint","extentChanged","sourceChanged","renderBuffer","BaseVector","generatePromises","forHitDetection","world","hitTolerance","disposeBuffersOfType","typeBuffers","DEFAULT_GRADIENT","Heatmap","baseOptions","weight","createGradient","blur","previousValue","ShaderBuilder","filterCompiled","radiusCompiled","blurCompiled","blurRadiusUniforms","weightAttribute","weightExpression","weightFunction","weightValue","clampedWeight","gradient","heatmapLayer","WEIGHT_KEY","weightDim","lastPointTracker","matchers","out","ol_coordinate_dist2d","p1","p2","ol_coordinate_equal","ol_coordinate_getFeatureCenter","ol_coordinate_getGeomCenter","ol_coordinate_offsetCoords","coords","path","N","max","mi","mi1","li","li1","ri","ri1","si","si1","Xi1","Yi1","p0","isClosed","ol_coordinate_findSegment","pt","d0","v0","d1","v1","ol_coordinate_splitH","abs","list","ol_geom_createFromType","ol_coordinate_getIntersectionPoint","d2","d1x","d1y","d2x","d2y","det","ol_extent_intersection","splitX","pts","splitY","polygon","poly","c","p","ol_coordinate_sampleAt","d","dl","nb","mpoly","ext","ol_extent","hasout","ol_style_FlowLine","where","cap","w2","ol_color","color2","ctx","ratio","asize","cos","sin","geoms","min","dt","NETWORK_LAYER_ID","networkLayer","edgeStyle","hasArrows","edgeDims","edgeTextConfig","edgeId","segmentStartCoords","segmentEndCoords","color1","arrowSize1","arrowSize2","flowStyle","FlowLine","LS","labelStyle","graphFrames","updateEdge","networkFrames","frameNodes","frameEdges","nodeIdIndex","nodeIdValues","sourceIndex","sources","sourceId","targetId","sourceNodeIndex","targetNodeIndex","geometryEdge","edgeFeature","ol_style_Photo","sanchor","shadow","strokeWidth","img","hit","pixelratio","w","opt","strokeStyle","sx","sy","sw","sh","PHOTOS_LAYER_ID","defaultPhotosConfig","unknownImage","blankPixel","photoLoad","photosLayer","images","photoStyle","Photo","blankStyle","errorStyle","srcField","ROUTE_LAYER_ID","defaultRouteConfig","mapIndex","crosshairColor","routeLayer","styleBase","pixelTolerance","P","ZoomOutCircle","crosshairFeature","hLineFeature","vLineFeature","lineFeatures","crosshairRadius","crosshairStyle","colorManipulator","lineStyle","crosshairLayer","linesLayer","throttleTime","mapExtents","timeField","timestamps","pointIdx","findNearestTimeIndex","crosshairPoint","crosshairPointCoords","lastIdx","probableIdx","dataLayers","DEFAULT_BASEMAP_CONFIG","defaultBaseLayer","serverLayerType","geomapLayerRegistry","getLayersSelection","registry","option","getLayersOptions","basemap","defaultMapViewConfig","TooltipMode","MapCenterID","layerStateMap","applyLayerFilter","handler","panelDataProps","panelData","matcherFunc","updateLayer","panel","newOptions","layerIndex","group","initLayer","isBasemap","UID","Subject","getMapLayerState","getActions","selected","lyr","getLayersExtent","allLayers","lastOnly","ll","getLayerGroupExtent","feat","lg","flatCoordinatesLength","lastX","lastY","setTooltipListeners","pointerClickListener","pointerMoveListener","mouse","hover","hoverPayload","layerLookup","featureGeom","featureCoords","addedFeatures","otherFeature","otherGeom","otherCoords","aIndex","bIndex","found","centerPointRegistry","sharedView","GeomapPanel","div","basemapOptions","ex","MouseWheelZoom","viewOptions","worldExtent","projectedExtent","View","PanelContext","nextProps","prevProps","onOptionsChange","oldOptions","padding","adjustedZoom","Zoom","Attribution","legends","ttipOpen","showScale","DATA_TEST_ID","LayerDragDropList","getLayerInfo","onDragEnd","onSelect","onDuplicate","showActions","excludeBaseLayer","onNameChange","verifyLayerNameUniqueness","getRowStyle","isSelected","provided","snapshot","rows","lastLayerIndex","shouldRenderDragIconLengthThreshold","LayerName","LayersEditor","actions","dst","AddLayerButton","CoordinatesMapViewEditor","labelWidth","onLatitudeChange","latitude","onLongitudeChange","longitude","DataScopeValues","DataScopeLabels","DataScopeOptions","dataScopeOption","FitMapViewEditor","onSelectLayer","allLayersEditorFragment","onChangePadding","lastOnlyEditorFragment","currentDataScope","onDataScopeChange","dataScope","MapViewEditor","views","ids","onSetCurrentView","onSelectView","viewInputId","zoomInputId","getLayerEditor","parent","lodash","layerTypes","FrameSelectionEditor","mapPanelChangedHandler","prevPluginId","prevOptions","prevFieldConfig","fieldConfig","xform","worldmapToGeomapOptions","angular","asNumber","reducer","fieldReducer","levels","strVale","mapCenters","num","mapMigrationHandler","pluginVersion","oldConfig","PanelPlugin","category","layersCategory","basemapCategory","baselayer","GRADIENT_STOPS","colorPalette","useStopsPercentage","setColors","scaleHover","setScaleHover","percent","setPercent","getGradientStops","onScaleMouseMove","divOffset","offsetWidth","normPercentage","scaleValue","onScaleMouseLeave","clampPercent100","colorArray","stops","colorCount","incr","per","gradientEnd","skip","gradientStops"],"sourceRoot":""}