(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[9570],{1667:(ee,U,m)=>{"use strict";m.d(U,{D:()=>S});var w=m(96540),R=m(46936);const S=({children:a})=>w.createElement(R.C,{gap:.5,direction:"column"},a)},6904:(ee,U,m)=>{"use strict";m.d(U,{X:()=>a});var w=m(22803),R=m(96540),S=m(63142);const a=({children:W})=>{const b=(0,S.of)(C);return R.createElement("div",{className:b.root},W)},C=W=>({root:(0,w.css)({display:"flex",flexWrap:"wrap",alignItems:"center",gap:W.spacing(3),minHeight:W.spacing(4)})})},20301:(ee,U,m)=>{"use strict";m.d(U,{Z:()=>C});var w=m(22803),R=m(96540),S=m(45861),a=m(63142);const C=({className:b,...A})=>{const G=(0,a.of)(W);return R.createElement(S.$n,{...A,className:(0,w.cx)(b,G.button)})},W=b=>({button:(0,w.css)({paddingLeft:b.spacing(3/2),paddingRight:b.spacing(3/2)})})},21397:(ee,U,m)=>{"use strict";m.r(U),m.d(U,{AFTER_SELECT_KEYWORDS:()=>dt,AGGREGATE_FUNCTIONS:()=>$t,ALL:()=>w,ALL_FUNCTIONS:()=>Dt,ALL_KEYWORDS:()=>mt,ALL_OPERATORS:()=>nr,AND:()=>R,ANY:()=>S,ARRAY_FUNCTIONS:()=>kt,AS:()=>a,ASC:()=>C,BETWEEN:()=>W,BY:()=>b,CASE:()=>A,CONDITIONAL_FUNCTIONS:()=>Qt,CONVERSION_FUNCTIONS:()=>vt,CUBE:()=>G,DATE_AND_TIMESTAMP_FUNCTIONS:()=>pt,DESC:()=>M,DISTINCT:()=>Y,DOUBLE_EQUALS:()=>Xt,ELSE:()=>B,END:()=>j,EQUAL:()=>be,ESCAPE:()=>_,EXISTS:()=>q,FALSE:()=>te,FILTER:()=>re,FIRST:()=>le,FROM:()=>ye,GREATER_THAN:()=>De,GREATER_THAN_EQUAL:()=>Jt,GROUP:()=>Se,GROUPING:()=>ge,HAVING:()=>Pe,ILIKE:()=>Ce,IN:()=>Ne,INNER:()=>Qe,IS:()=>Ye,JOIN:()=>T,JSON_FUNCTIONS:()=>gt,KEYWORDS:()=>nt,LAST:()=>Re,LEFT:()=>me,LESS_THAN:()=>qt,LESS_THAN_EQUAL:()=>er,LIKE:()=>ve,LIMIT:()=>ze,LOGICAL_OPERATORS:()=>tr,MATHEMATICAL_FUNCTIONS:()=>xt,MATH_OPERATORS:()=>rr,NOT:()=>We,NOT_EQUAL:()=>Mt,NULL:()=>xe,NULL_SAFE_EQUAL:()=>Zt,ON:()=>Ue,OR:()=>Ge,ORDER:()=>Xe,OUTER:()=>Ke,PREDICATE_FUNCTIONS:()=>bt,PREDICATE_OPERATORS:()=>sr,ROLLUP:()=>rt,SELECT:()=>ne,SETS:()=>Ze,SOME:()=>Be,STRING_FUNCTIONS:()=>Yt,THEN:()=>ue,TRUE:()=>Je,USING:()=>st,WHEN:()=>Ee,WHERE:()=>qe,WINDOW_FUNCTIONS:()=>zt,WITH:()=>ie,conf:()=>Pr,language:()=>_r});const w="ALL",R="AND",S="ANY",a="AS",C="ASC",W="BETWEEN",b="BY",A="CASE",G="CUBE",M="DESC",Y="DISTINCT",B="ELSE",j="END",_="ESCAPE",q="EXISTS",te="FALSE",re="FILTER",le="FIRST",ye="FROM",Se="GROUP",ge="GROUPING",Pe="HAVING",Ce="ILIKE",Ne="IN",Qe="INNER",Ye="IS",T="JOIN",Re="LAST",me="LEFT",ve="LIKE",ze="LIMIT",We="NOT",xe="NULL",Ue="ON",Ge="OR",Xe="ORDER",Ke="OUTER",rt="ROLLUP",ne="SELECT",Ze="SETS",Be="SOME",ue="THEN",Je="TRUE",st="USING",Ee="WHEN",qe="WHERE",ie="WITH",nt=[w,R,S,a,C,W,b,A,G,M,Y,B,j,_,q,te,re,le,ye,Se,ge,Pe,Ce,Ne,Qe,Ye,T,Re,me,ve,ze,We,xe,Ue,Ge,Xe,Ke,rt,ne,Ze,Be,ue,Je,st,Ee,qe,ie],dt=[w,Y],mt=[...nt,...dt],$t=["any","any_value","approx_count_distinct","approx_percentile","array_agg","avg","bit_and","bit_or","bit_xor","bitmap_construct_agg","bitmap_or_agg","bool_and","bool_or","collect_list","collect_set","count","count_if","count_min_sketch","covar_pop","covar_samp","every","first","first_value","grouping","grouping_id","histogram_numeric","hll_sketch_agg","hll_union_agg","kurtosis","last","last_value","max","max_by","mean","median","min","min_by","mode","percentile","percentile_approx","regr_avgx","regr_avgy","regr_count","regr_intercept","regr_r2","regr_slope","regr_sxx","regr_sxy","regr_syy","skewness","some","std","stddev","stddev_pop","stddev_samp","sum","try_avg","try_sum","var_pop","var_samp","variance"],kt=["array","array_append","array_compact","array_contains","array_distinct","array_except","array_insert","array_intersect","array_join","array_max","array_min","array_position","array_prepend","array_remove","array_repeat","array_union","arrays_overlap","arrays_zip","flatten","get","sequence","shuffle","slice","sort_array"],Qt=["coalesce","if","ifnull","nanvl","nullif","nvl","nvl2"],vt=["bigint","binary","boolean","cast","date","decimal","double","float","int","smallint","string","timestamp","tinyint"],pt=["add_months","convert_timezone","curdate","current_date","current_timestamp","current_timezone","date_add","date_diff","date_format","date_from_unix_date","date_part","date_sub","date_trunc","dateadd","datediff","datepart","day","dayofmonth","dayofweek","dayofyear","extract","from_unixtime","from_utc_timestamp","hour","last_day","localtimestamp","localtimestamp","make_date","make_dt_interval","make_interval","make_timestamp","make_timestamp_ltz","make_timestamp_ntz","make_ym_interval","minute","month","months_between","next_day","now","quarter","second","session_window","timestamp_micros","timestamp_millis","timestamp_seconds","to_date","to_timestamp","to_timestamp_ltz","to_timestamp_ntz","to_unix_timestamp","to_utc_timestamp","trunc","try_to_timestamp","unix_date","unix_micros","unix_millis","unix_seconds","unix_timestamp","weekday","weekofyear","window","window_time","year"],gt=["from_json","get_json_object","json_array_length","json_object_keys","json_tuple","schema_of_json","to_json"],xt=["abs","acos","acosh","asin","asinh","atan","atan2","atanh","bin","bround","cbrt","ceil","ceiling","conv","cos","cosh","cot","csc","degrees","e","exp","expm1","factorial","floor","greatest","hex","hypot","least","ln","log","log10","log1p","log2","negative","pi","pmod","positive","pow","power","radians","rand","randn","random","rint","round","sec","shiftleft","sign","signum","sin","sinh","sqrt","tan","tanh","try_add","try_divide","try_multiply","try_subtract","unhex","width_bucket"],bt=["isnan","isnotnull","isnull","regexp","regexp_like","rlike"],Yt=["ascii","base64","bit_length","btrim","char","char_length","character_length","chr","concat_ws","contains","decode","elt","encode","endswith","find_in_set","format_number","format_string","initcap","instr","lcase","left","len","length","levenshtein","locate","lower","lpad","ltrim","luhn_check","mask","octet_length","overlay","position","printf","regexp_count","regexp_extract","regexp_extract_all","regexp_instr","regexp_replace","regexp_substr","repeat","replace","right","rpad","rtrim","sentences","soundex","space","split","split_part","startswith","substr","substring","substring_index","to_binary","to_char","to_number","to_varchar","translate","trim","try_to_binary","try_to_number","ucase","unbase64","upper"],zt=["cume_dist","dense_rank","lag","lead","nth_value","ntile","percent_rank","rank","row_number"],Dt=[...$t,...kt,...Qt,...vt,...pt,...gt,...xt,...bt,...Yt,...zt],be="=",Xt="==",Zt="<=>",Mt="!=",De=">",Jt=">=",qt="<",er="<=",tr=[Ge,R],rr=["*","/","+","-","%","div","mod"],sr=[We,Ye,be,Xt,Zt,Mt,De,Jt,qt,er,ve,Ce,Ne],nr=[...rr,...tr,...sr],_r={defaultToken:"",ignoreCase:!0,brackets:[{open:"[",close:"]",token:"delimiter.square"},{open:"(",close:")",token:"delimiter.parenthesis"},{open:"{",close:"}",token:"delimiter.curly"}],keywords:mt,operators:nr,builtinFunctions:Dt,tokenizer:{root:[{include:"@comments"},{include:"@whitespace"},{include:"@customParams"},{include:"@numbers"},{include:"@binaries"},{include:"@strings"},{include:"@strings"},{include:"@complexIdentifiers"},[/[;,.]/,"delimiter"],[/[\(\)\[\]\{\}]/,"@brackets"],[/[\w@#$]+/,{cases:{"@operators":"operator","@builtinFunctions":"predefined","@keywords":"keyword","@default":"identifier"}}],[/[<>=!%&+\-*/|~^]/,"operator"]],whitespace:[[/[\s\t\r\n]+/,"white"]],comments:[[/--+.*/,"comment"],[/\/\*/,{token:"comment.quote",next:"@comment"}]],comment:[[/[^*/]+/,"comment"],[/\*\//,{token:"comment.quote",next:"@pop"}],[/./,"comment"]],customParams:[[/\${[A-Za-z0-9._-]*}/,"variable"],[/\@\@{[A-Za-z0-9._-]*}/,"variable"]],numbers:[[/0[xX][0-9a-fA-F]*/,"number"],[/[$][+-]*\d*(\.\d*)?/,"number"],[/((\d+(\.\d*)?)|(\.\d+))([eE][\-+]?\d+)?/,"number"]],binaries:[[/X'/i,{token:"binary",next:"@binarySingle"}],[/X"/i,{token:"binary",next:"@binaryDouble"}]],binarySingle:[[/\d+/,"binary.escape"],[/''/,"binary"],[/'/,{token:"binary",next:"@pop"}]],binaryDouble:[[/\d+/,"binary.escape"],[/""/,"binary"],[/"/,{token:"binary",next:"@pop"}]],strings:[[/'/,{token:"string",next:"@stringSingle"}],[/R'/i,{token:"string",next:"@stringSingle"}],[/"/,{token:"string",next:"@stringDouble"}],[/R"/i,{token:"string",next:"@stringDouble"}]],stringSingle:[[/[^']+/,"string.escape"],[/''/,"string"],[/'/,{token:"string",next:"@pop"}]],stringDouble:[[/[^"]+/,"string.escape"],[/""/,"string"],[/"/,{token:"string",next:"@pop"}]],complexIdentifiers:[[/`/,{token:"identifier",next:"@quotedIdentifier"}]],quotedIdentifier:[[/[^`]+/,"identifier"],[/``/,"identifier"],[/`/,{token:"identifier",next:"@pop"}]]}},Pr={comments:{lineComment:"--",blockComment:["/*","*/"]},brackets:[["{","}"],["[","]"],["(",")"]],autoClosingPairs:[{open:"{",close:"}"},{open:"[",close:"]"},{open:"(",close:")"},{open:'"',close:'"'},{open:"'",close:"'"},{open:"`",close:"`"}],surroundingPairs:[{open:"{",close:"}"},{open:"[",close:"]"},{open:"(",close:")"},{open:'"',close:'"'},{open:"'",close:"'"},{open:"`",close:"`"}]}},26774:(ee,U,m)=>{"use strict";m.d(U,{o:()=>a});var w=m(45861),R=m(96540),S=m(46936);const a=R.forwardRef(function({items:W,renderItem:b,onChange:A},G){const M=()=>{const j=[...W,{}];A(j)},Y=(j,_)=>{const q=[...W];q[j]=_,A(q)},B=j=>{const _=[...W];_.splice(j,1),A(_)};return R.createElement(S.C,null,W.map((j,_)=>R.createElement("div",{key:_},b(j,q=>Y(_,q),()=>B(_)))),R.createElement(w.$n,{ref:G,onClick:M,variant:"secondary",size:"md",icon:"plus","aria-label":"Add",type:"button"}))})},31731:(ee,U,m)=>{"use strict";m.d(U,{u:()=>W});var w=m(61701),R=m(92908),S=m(64878),a=m(15964),C=m(39697);function W(b){var A,G=1/0,M;return b!=null&&(typeof b=="object"?(A=b.count,G=A===void 0?1/0:A,M=b.delay):G=b),G<=0?function(){return w.w}:(0,R.N)(function(Y,B){var j=0,_,q=function(){if(_?.unsubscribe(),_=null,M!=null){var re=typeof M=="number"?(0,C.O)(M):(0,a.Tg)(M(j)),le=(0,S._)(B,function(){le.unsubscribe(),te()});re.subscribe(le)}else te()},te=function(){var re=!1;_=Y.subscribe((0,S._)(B,void 0,function(){++j<G?_?q():re=!0:B.complete()})),re&&q()};te()})}},32300:(ee,U,m)=>{"use strict";m.d(U,{U:()=>C});var w=m(22803),R=m(96540),S=m(63142),a=m(46936);const C=({children:b})=>{const A=(0,S.of)(W);return R.createElement("div",{className:A.root},R.createElement(a.C,{gap:2},b))},W=b=>({root:(0,w.css)({padding:b.spacing(1),backgroundColor:b.colors.background.secondary,borderRadius:b.shape.radius.default})})},40052:(ee,U,m)=>{"use strict";m.d(U,{K:()=>R});var w=Array.isArray;function R(S){return S.length===1&&w(S[0])?S[0]:S}},40263:(ee,U,m)=>{"use strict";m.d(U,{Z:()=>R});var w=m(96540);const R=({grow:S,shrink:a})=>w.createElement("div",{style:{display:"block",flexGrow:S,flexShrink:a}})},43431:(ee,U,m)=>{"use strict";m.d(U,{y:()=>A});var w=m(31635),R=m(88483),S=m(15964),a=m(40052),C=m(61701),W=m(64878),b=m(82100);function A(){for(var G=[],M=0;M<arguments.length;M++)G[M]=arguments[M];var Y=(0,b.ms)(G),B=(0,a.K)(G);return B.length?new R.c(function(j){var _=B.map(function(){return[]}),q=B.map(function(){return!1});j.add(function(){_=q=null});for(var te=function(le){(0,S.Tg)(B[le]).subscribe((0,W._)(j,function(ye){if(_[le].push(ye),_.every(function(ge){return ge.length})){var Se=_.map(function(ge){return ge.shift()});j.next(Y?Y.apply(void 0,(0,w.__spreadArray)([],(0,w.__read)(Se))):Se),_.some(function(ge,Pe){return!ge.length&&q[Pe]})&&j.complete()}},function(){q[le]=!0,!_[le].length&&j.complete()}))},re=0;!j.closed&&re<B.length;re++)te(re);return function(){_=q=null}}):C.w}},44419:(ee,U,m)=>{"use strict";m.r(U),m.d(U,{DEDUP:()=>G,DISPLAY:()=>w,FIELDS:()=>R,FILTER:()=>S,LIMIT:()=>b,LOGS_COMMANDS:()=>M,LOGS_FUNCTION_OPERATORS:()=>B,LOGS_KEYWORDS:()=>_,LOGS_LOGIC_OPERATORS:()=>Y,PARSE:()=>A,PATTERN:()=>a,SORT:()=>W,SORT_DIRECTION_KEYWORDS:()=>j,STATS:()=>C,conf:()=>te,language:()=>q});const w="display",R="fields",S="filter",a="pattern",C="stats",W="sort",b="limit",A="parse",G="dedup",M=[w,R,S,a,C,W,b,A,G],Y=["and","or","not"],B=["abs","ceil","floor","greatest","least","log","sqrt","bin","datefloor","dateceil","fromMillis","toMillis","ispresent","coalesce","isValidIp","isValidIpV4","isValidIpV6","isIpInSubnet","isIpv4InSubnet","isIpv6InSubnet","avg","count","count_distinct","max","min","pct","stddev","sum","earliest","latest","sortsFirst","sortsLast","isempty","isblank","concat","ltrim","rtrim","trim","strlen","toupper","tolower","substr","replace","strcontains","unmask"],j=["asc","desc"],_=["like","by","in","as",...j],q={defaultToken:"invalid",id:"logs",ignoreCase:!0,brackets:[{open:"[",close:"]",token:"delimiter.square"},{open:"(",close:")",token:"delimiter.parenthesis"}],commands:[...M,..._],operators:Y,builtinFunctions:B,tokenizer:{root:[{include:"@comments"},{include:"@regexes"},{include:"@whitespace"},{include:"@fieldNames"},{include:"@variables"},{include:"@strings"},{include:"@numbers"},[/\|\|/,"operator"],[/[,.:\|]/,"delimiter"],[/[()\[\]]/,"delimiter.parenthesis"],[/[\w@#$]+/,{cases:{"@commands":"keyword","@builtinFunctions":"predefined","@operators":"operator","@default":"identifier"}}],[/[+\-*/^%=!<>]/,"operator"]],variables:[[/\${/,{token:"variable",next:"@variable_bracket"}],[/\$[a-zA-Z0-9-_]+/,"variable"]],variable_bracket:[[/[a-zA-Z0-9-_:]+/,"variable"],[/}/,{token:"variable",next:"@pop"}]],fieldNames:[[/(@[_a-zA-Z]+[_.0-9a-zA-Z]*)|(`((\\`)|([^`]))*?`)/,"identifier"]],whitespace:[[/\s+/,"white"]],comments:[[/^#.*/,"comment"],[/\s+#.*/,"comment"]],numbers:[[/0[xX][0-9a-fA-F]*/,"number"],[/[$][+-]*\d*(\.\d*)?/,"number"],[/((\d+(\.\d*)?)|(\.\d+))([eE][\-+]?\d+)?/,"number"]],strings:[[/'/,{token:"string",next:"@string"}],[/"/,{token:"string",next:"@string_double"}],[/`/,{token:"identifier",next:"@string_backtick"}]],string:[[/[^']+/,"string"],[/''/,"string"],[/'/,{token:"string",next:"@pop"}]],string_double:[[/[^\\"]+/,"string"],[/"/,"string","@pop"]],string_backtick:[[/[^\\`]+/,"identifier"],[/`/,"identifier","@pop"]],regexes:[[/\/.*?\/(?=\s*\||\s*$|,)/,"regexp"]]}},te={comments:{lineComment:"#"},brackets:[["{","}"],["[","]"],["(",")"]],autoClosingPairs:[{open:"{",close:"}"},{open:"[",close:"]"},{open:"(",close:")"},{open:'"',close:'"'},{open:"'",close:"'"},{open:"`",close:"`"}],surroundingPairs:[{open:"{",close:"}"},{open:"[",close:"]"},{open:"(",close:")"},{open:'"',close:'"'},{open:"'",close:"'"},{open:"`",close:"`"}]}},46936:(ee,U,m)=>{"use strict";m.d(U,{C:()=>S});var w=m(96540),R=m(41654);const S=({children:a,wrap:C=!0,...W})=>{var b,A;return w.createElement(R.B,{wrap:C?"wrap":void 0,direction:(b=W.direction)!=null?b:"row",gap:(A=W.gap)!=null?A:2,...W},a)}},49921:(ee,U,m)=>{"use strict";m.r(U),m.d(U,{METRIC_MATH_FNS:()=>w,METRIC_MATH_KEYWORDS:()=>S,METRIC_MATH_OPERATORS:()=>a,METRIC_MATH_PERIODS:()=>C,METRIC_MATH_STATISTIC_KEYWORD_STRINGS:()=>R,conf:()=>b,language:()=>W});const w=["ABS","ANOMALY_DETECTION_BAND","AVG","CEIL","DATAPOINT_COUNT","DB_PERF_INSIGHTS","DIFF","DIFF_TIME","FILL","FIRST","LAST","FLOOR","IF","INSIGHT_RULE_METRIC","LOG","LOG10","MAX","METRIC_COUNT","METRICS","MIN","MINUTE","HOUR","DAY","DATE","MONTH","YEAR","EPOCH","PERIOD","RATE","REMOVE_EMPTY","RUNNING_SUM","SEARCH","SERVICE_QUOTA","SLICE","SORT","STDDEV","SUM","TIME_SERIES"],R=["Average","Maximum","Minimum","Sum","SampleCount"],S=["REPEAT","LINEAR","ASC","DSC"],a=["+","-","*","/","^","==","!=","<=",">=","<",">","AND","&&","OR","||"],C=[10,60,300,900,3e3,21600,86400],W={id:"metricMath",ignoreCase:!1,brackets:[{open:"[",close:"]",token:"delimiter.square"},{open:"(",close:")",token:"delimiter.parenthesis"},{open:"{",close:"}",token:"delimiter.curly"}],tokenizer:{root:[{include:"@nonNestableStates"},{include:"@strings"}],nonNestableStates:[{include:"@variables"},{include:"@macros"},{include:"@whitespace"},{include:"@numbers"},{include:"@assignment"},{include:"@keywords"},{include:"@operators"},{include:"@builtInFunctions"},[/[;,.]/,"delimiter"],[/[(){}\[\]]/,"@brackets"]],keywords:[[S.map(A).join("|"),"keyword"]],operators:[[a.map(A).join("|"),"operator"]],builtInFunctions:[[w.map(A).join("|"),"predefined"]],variables:[[/\$[a-zA-Z0-9-_]+/,"variable"]],macros:[[/\$__[a-zA-Z0-9-_]+/,"type"]],whitespace:[[/\s+/,"white"]],assignment:[[/=/,"tag"]],numbers:[[/0[xX][0-9a-fA-F]*/,"number"],[/[$][+-]*\d*(\.\d*)?/,"number"],[/((\d+(\.\d*)?)|(\.\d+))([eE][\-+]?\d+)?/,"number"]],strings:[[/'/,{token:"string",next:"@string"}],[/"/,{token:"type",next:"@string_double"}]],string:[[/{/,{token:"delimiter.curly",next:"@nestedCurly"}],[/\(/,{token:"delimiter.parenthesis",next:"@nestedParens"}],[/"/,{token:"type",next:"@string_double"}],[/'/,{token:"string",next:"@pop"}],{include:"@nonNestableStates"},[/[^']/,"string"]],string_double:[[/[^"]/,"type"],[/"/,{token:"type",next:"@pop"}]],nestedCurly:[[/}/,{token:"delimiter.curly",next:"@pop"}],[/'/,{token:"string",next:"@string"}],[/"/,{token:"type",next:"@string_double"}]],nestedParens:[[/\)/,{token:"delimiter.parenthesis",next:"@pop"}],[/'/,{token:"string",next:"@string"}],[/"/,{token:"type",next:"@string_double"}]]}},b={brackets:[["{","}"],["[","]"],["(",")"]],autoClosingPairs:[{open:"{",close:"}"},{open:"[",close:"]"},{open:"(",close:")"},{open:'"',close:'"'},{open:"'",close:"'"}],surroundingPairs:[{open:"{",close:"}"},{open:"[",close:"]"},{open:"(",close:")"},{open:'"',close:'"'},{open:"'",close:"'"}]};function A(G){return G.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}},50287:(ee,U,m)=>{ee.exports=m(53995)},53995:(ee,U)=>{(function(m){"use strict";m.stringify=function R(S){function a(G){return/[^\w-.]/.test(G)?G.replace(/[^\w-.]/g,function(M){return M==="$"?"!":(M=M.charCodeAt(0),M<256?"*"+("00"+M.toString(16)).slice(-2):"**"+("0000"+M.toString(16)).slice(-4))}):G}var C;switch(typeof S){case"number":return isFinite(S)?"~"+S:"~null";case"boolean":return"~"+S;case"string":return"~'"+a(S);case"object":if(!S)return"~null";if(C=[],Array.isArray(S)){for(var W=0;W<S.length;W++)C[W]=R(S[W])||"~null";return"~("+(C.join("")||"~")+")"}else{for(var b in S)if(S.hasOwnProperty(b)){var A=R(S[b]);A&&C.push(a(b)+A)}return"~("+C.join("~")+")"}default:return}};var w={true:!0,false:!1,null:null};m.parse=function(R){if(!R)return R;R=R.replace(/%(25)*27/g,"'");var S=0,a=R.length;function C(b){if(R.charAt(S)!==b)throw new Error("bad JSURL syntax: expected "+b+", got "+(R&&R.charAt(S)));S++}function W(){for(var b=S,A,G="";S<a&&(A=R.charAt(S))!=="~"&&A!==")";)switch(A){case"*":b<S&&(G+=R.substring(b,S)),R.charAt(S+1)==="*"?(G+=String.fromCharCode(parseInt(R.substring(S+2,S+6),16)),b=S+=6):(G+=String.fromCharCode(parseInt(R.substring(S+1,S+3),16)),b=S+=3);break;case"!":b<S&&(G+=R.substring(b,S)),G+="$",b=++S;break;default:S++}return G+R.substring(b,S)}return function b(){var A,G,M;switch(C("~"),G=R.charAt(S)){case"(":if(S++,R.charAt(S)==="~")if(A=[],R.charAt(S+1)===")")S++;else do A.push(b());while(R.charAt(S)==="~");else if(A={},R.charAt(S)!==")")do{var Y=W();A[Y]=b()}while(R.charAt(S)==="~"&&++S);C(")");break;case"'":S++,A=W();break;default:for(M=S++;S<a&&/[^)~]/.test(R.charAt(S));)S++;var B=R.substring(M,S);if(/[\d\-]/.test(G))A=parseFloat(B);else if(A=w[B],typeof A>"u")throw new Error("bad value keyword: "+B)}return A}()},m.tryParse=function(R,S){try{return m.parse(R)}catch{return S}}})(U)},58969:(ee,U,m)=>{"use strict";m.r(U),m.d(U,{AND:()=>_,ASC:()=>A,BY:()=>W,COMPARISON_OPERATORS:()=>le,DESC:()=>b,EQUALS:()=>te,FROM:()=>R,GROUP:()=>a,KEYWORDS:()=>B,LIMIT:()=>G,LOGICAL_OPERATORS:()=>q,NOT_EQUALS:()=>re,ORDER:()=>C,SCHEMA:()=>Y,SELECT:()=>w,STATISTICS:()=>j,WHERE:()=>S,WITH:()=>M,conf:()=>Se,language:()=>ye});const w="SELECT",R="FROM",S="WHERE",a="GROUP",C="ORDER",W="BY",b="DESC",A="ASC",G="LIMIT",M="WITH",Y="SCHEMA",B=[w,R,S,a,C,W,b,A,G,M,Y],j=["AVG","COUNT","MAX","MIN","SUM"],_="AND",q=[_],te="=",re="!=",le=[te,re],ye={defaultToken:"",tokenPostfix:".sql",ignoreCase:!0,brackets:[{open:"[",close:"]",token:"delimiter.square"},{open:"(",close:")",token:"delimiter.parenthesis"}],keywords:B,operators:q,builtinFunctions:j,tokenizer:{root:[[/\$[a-zA-Z0-9-_]+/,"variable"],{include:"@comments"},{include:"@whitespace"},{include:"@numbers"},{include:"@strings"},{include:"@complexIdentifiers"},[/[;,.]/,"delimiter"],[/[()]/,"@brackets"],[/[\w@#$]+/,{cases:{"@keywords":"keyword","@operators":"operator","@builtinFunctions":"predefined","@default":"identifier"}}],[/[=!%&+\-*/|~^]/,"operator"]],whitespace:[[/\s+/,"white"]],comments:[[/--+.*/,"comment"]],comment:[[/[^*/]+/,"comment"],[/./,"comment"]],numbers:[[/0[xX][0-9a-fA-F]*/,"number"],[/[$][+-]*\d*(\.\d*)?/,"number"],[/((\d+(\.\d*)?)|(\.\d+))([eE][\-+]?\d+)?/,"number"]],strings:[[/N'/,{token:"string",next:"@string"}],[/'/,{token:"string",next:"@string"}],[/"/,{token:"type",next:"@string_double"}]],string:[[/[^']+/,"string"],[/''/,"string"],[/'/,{token:"string",next:"@pop"}]],string_double:[[/[^\\"]+/,"type"],[/"/,"type","@pop"]],complexIdentifiers:[[/\[/,{token:"identifier.quote",next:"@bracketedIdentifier"}],[/"/,{token:"identifier.quote",next:"@quotedIdentifier"}]],bracketedIdentifier:[[/[^\]]+/,"identifier"],[/]]/,"identifier"],[/]/,{token:"identifier.quote",next:"@pop"}]],quotedIdentifier:[[/[^"]+/,"identifier"],[/""/,"identifier"],[/"/,{token:"identifier.quote",next:"@pop"}]]}},Se={comments:{lineComment:"--",blockComment:["/*","*/"]},brackets:[["{","}"],["[","]"],["(",")"]],autoClosingPairs:[{open:"{",close:"}"},{open:"[",close:"]"},{open:"(",close:")"},{open:'"',close:'"'},{open:"'",close:"'"}],surroundingPairs:[{open:"{",close:"}"},{open:"[",close:"]"},{open:"(",close:")"},{open:'"',close:'"'},{open:"'",close:"'"}]}},72500:(ee,U,m)=>{"use strict";m.d(U,{M:()=>a});var w=m(22803),R=m(63142),S=m(96540);const a=({children:b})=>{const A=(0,R.of)(W),G=S.Children.map(b,M=>(0,S.isValidElement)(M)&&M.props.invalid?(0,S.cloneElement)(M,{className:(0,w.cx)(M.props.className,A.invalidChild)}):M);return S.createElement("div",{className:A.root},G)},C=["","base","hovered","invalid","focused"],W=()=>({root:(0,w.css)({display:"flex","> *":{"&:not(:first-child)":{marginLeft:-1},"&:first-child":{borderTopRightRadius:0,borderBottomRightRadius:0},"&:last-child":{borderTopLeftRadius:0,borderBottomLeftRadius:0},"&:not(:first-child):not(:last-child)":{borderRadius:0},position:"relative",zIndex:C.indexOf("base"),"&:hover":{zIndex:C.indexOf("hovered")},"&:focus-within":{zIndex:C.indexOf("focused")}}}),invalidChild:(0,w.css)({zIndex:C.indexOf("invalid")})})},75349:(ee,U,m)=>{"use strict";m.d(U,{B:()=>S});var w=m(96540),R=m(46936);const S=({children:a})=>w.createElement(R.C,{gap:1},a)},75686:(ee,U,m)=>{"use strict";m.d(U,{W:()=>W});var w=m(22803),R=m(96540),S=m(73744),a=m(18857),C=m(63142);function W({label:M,...Y}){const[B]=(0,R.useState)(()=>Math.random().toString(16).slice(2)),j=(0,C.of)(G),_={SelectContainer:b,ValueContainer:A,SingleValue:A};return R.createElement("div",{className:j.root},M&&R.createElement("label",{className:j.label,htmlFor:B},M,":","\xA0"),R.createElement(a.l6,{openMenuOnFocus:!0,inputId:B,...Y,components:_}))}const b=M=>{const{children:Y}=M,B=(0,C.of)(G);return R.createElement(S.K,{...M,className:(0,w.cx)(M.className,B.container)},Y)},A=M=>{const{className:Y,children:B}=M,j=(0,C.of)(G);return R.createElement("div",{className:(0,w.cx)(Y,j.valueContainer)},B)},G=M=>({root:(0,w.css)({display:"flex",fontSize:12,alignItems:"center"}),label:(0,w.css)({color:M.colors.text.secondary,whiteSpace:"nowrap"}),container:(0,w.css)({background:"none",borderColor:"transparent"}),valueContainer:(0,w.css)({display:"flex",alignItems:"center",flex:"initial",color:M.colors.text.secondary,fontSize:12})})},78246:(ee,U,m)=>{"use strict";m.d(U,{C:()=>a});var w=m(22803),R=m(21285),S=m(96540);const a=W=>{const b=C();return S.createElement("div",{className:b.switch},S.createElement(R.d,{...W}))},C=()=>({switch:(0,w.css)({display:"flex",alignItems:"center",minHeight:30})})},79570:(ee,U,m)=>{"use strict";m.r(U),m.d(U,{plugin:()=>wo});var w=m(94644),R=m(57852),S=m(75234),a=m(74848),C=m(22803),W=m(28848),b=m.n(W),A=m(96540),G=m(89599),M=m(63142),Y=m(66404),B=m(89640),j=m(56103),_=m(43173),q=m(27489);const te=t=>t.queryMode==="Logs",re=t=>t.queryMode==="Metrics"||!t.hasOwnProperty("queryMode"),le=t=>t.queryMode==="Annotations",ye=t=>t.target?.queryMode==="Annotations";var Se=m(32017),ge=m.n(Se),Pe=m(87963);function Ce(t){const e={...t};(0,Pe.WB)(e);const r=Qe(e);return ge()(r,t)?t:r}const Ne={metric:"PROP('MetricName')",namespace:"PROP('Namespace')",period:"PROP('Period')",region:"PROP('Region')",stat:"PROP('Stat')",label:"LABEL"};function Qe(t){if(!t.hasOwnProperty("label")){const e={...t};if(!t.hasOwnProperty("label")){const r=/{{\s*(.+?)\s*}}/g;e.label=t.alias?.replace(r,(s,n)=>Ne.hasOwnProperty(n)?`\${${Ne[n]}}`:`\${PROP('Dim.${n}')}`)??""}return e}return t}var Ye=m(42809),T=m(51515);const Re=t=>({label:t,value:t}),me=(t,e)=>[...e,{label:"Template Variables",options:t.getVariables().map(Re)}],ve=t=>{const{region:e,metricQueryType:r,metricEditorMode:s,expression:n,metricName:i,namespace:o,sqlExpression:c,statistic:u}=t;return e?r===T.d$.Search&&s===T.Rx.Builder?!!o&&!!i&&!!u:r===T.d$.Search&&s===T.Rx.Code?!!n:r===T.d$.Insights?!!c:!1:!1},ze=({payload:{dashboardId:t,orgId:e,grafanaVersion:r,queries:s}})=>{try{const n=s[Ye.id];if(!n?.length)return;let i=[],o=[];for(const u of n)if(!u.hide){if(te(u))u.logGroupNames?.length&&i.push(u);else if(re(u)){const E=Ce(u);ve(E)&&o.push(u)}}const c={grafana_version:r,dashboard_id:t,org_id:e,logs_queries_count:i?.length,logs_cwli_queries_count:i?.filter(u=>!u.queryLanguage||u.queryLanguage===T._M.CWLI).length,logs_sql_queries_count:i?.filter(u=>u.queryLanguage===T._M.SQL).length,logs_ppl_queries_count:i?.filter(u=>u.queryLanguage===T._M.PPL).length,metrics_queries_count:o?.length,metrics_search_count:0,metrics_search_builder_count:0,metrics_search_code_count:0,metrics_search_match_exact_count:0,metrics_query_count:0,metrics_query_builder_count:0,metrics_query_code_count:0,metrics_queries_with_account_count:0};for(const u of o)c.metrics_search_count+=+(u.metricQueryType===T.d$.Search),c.metrics_search_builder_count+=+xe(u),c.metrics_search_code_count+=+(u.metricQueryType===T.d$.Search&&u.metricEditorMode===T.Rx.Code),c.metrics_search_match_exact_count+=+!!(xe(u)&&u.matchExact),c.metrics_query_count+=+(u.metricQueryType===T.d$.Insights),c.metrics_query_builder_count+=+(u.metricQueryType===T.d$.Insights&&u.metricEditorMode===T.Rx.Builder),c.metrics_query_code_count+=+(u.metricQueryType===T.d$.Insights&&u.metricEditorMode===T.Rx.Code),c.metrics_queries_with_account_count+=+!!(_.$.featureToggles.cloudWatchCrossAccountQuerying&&xe(u)&&u.accountId);(0,q.rR)("grafana_ds_cloudwatch_dashboard_loaded",c)}catch(n){console.error("error in cloudwatch tracking handler",n)}},We=t=>{const{queryLanguage:e,queryCategory:r}=t;(0,q.rR)("cloudwatch-logs-cheat-sheet-query-clicked",{queryLanguage:e,queryCategory:r})},xe=t=>t.metricQueryType===T.d$.Search&&t.metricEditorMode===T.Rx.Builder;var Ue=function(){function t(e,r){for(var s=0;s<r.length;s++){var n=r[s];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(e,r,s){return r&&t(e.prototype,r),s&&t(e,s),e}}(),Ge=Xe(["",""],["",""]);function Xe(t,e){return Object.freeze(Object.defineProperties(t,{raw:{value:Object.freeze(e)}}))}function Ke(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var rt=function(){function t(){for(var e=this,r=arguments.length,s=Array(r),n=0;n<r;n++)s[n]=arguments[n];return Ke(this,t),this.tag=function(i){for(var o=arguments.length,c=Array(o>1?o-1:0),u=1;u<o;u++)c[u-1]=arguments[u];return typeof i=="function"?e.interimTag.bind(e,i):typeof i=="string"?e.transformEndResult(i):(i=i.map(e.transformString.bind(e)),e.transformEndResult(i.reduce(e.processSubstitutions.bind(e,c))))},s.length>0&&Array.isArray(s[0])&&(s=s[0]),this.transformers=s.map(function(i){return typeof i=="function"?i():i}),this.tag}return Ue(t,[{key:"interimTag",value:function(r,s){for(var n=arguments.length,i=Array(n>2?n-2:0),o=2;o<n;o++)i[o-2]=arguments[o];return this.tag(Ge,r.apply(void 0,[s].concat(i)))}},{key:"processSubstitutions",value:function(r,s,n){var i=this.transformSubstitution(r.shift(),s);return"".concat(s,i,n)}},{key:"transformString",value:function(r){var s=function(i,o){return o.onString?o.onString(i):i};return this.transformers.reduce(s,r)}},{key:"transformSubstitution",value:function(r,s){var n=function(o,c){return c.onSubstitution?c.onSubstitution(o,s):o};return this.transformers.reduce(n,r)}},{key:"transformEndResult",value:function(r){var s=function(i,o){return o.onEndResult?o.onEndResult(i):i};return this.transformers.reduce(s,r)}}]),t}();const ne=rt;var Ze={separator:"",conjunction:"",serial:!1},Be=function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Ze;return{onSubstitution:function(s,n){if(Array.isArray(s)){var i=s.length,o=e.separator,c=e.conjunction,u=e.serial,E=n.match(/(\n?[^\S\n]+)$/);if(E?s=s.join(o+E[1]):s=s.join(o+" "),c&&i>1){var l=s.lastIndexOf(o);s=s.slice(0,l)+(u?o:"")+" "+c+s.slice(l+1)}}return s}}};const ue=Be;function Je(t){if(Array.isArray(t)){for(var e=0,r=Array(t.length);e<t.length;e++)r[e]=t[e];return r}else return Array.from(t)}var st=function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"initial";return{onEndResult:function(s){if(e==="initial"){var n=s.match(/^[^\S\n]*(?=\S)/gm),i=n&&Math.min.apply(Math,Je(n.map(function(c){return c.length})));if(i){var o=new RegExp("^.{"+i+"}","gm");return s.replace(o,"")}return s}if(e==="all")return s.replace(/^[^\S\n]+/gm,"");throw new Error("Unknown type: "+e)}}};const Ee=st;var qe=function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"";return{onEndResult:function(s){if(e==="")return s.trim();if(e=e.toLowerCase(),e==="start"||e==="left")return s.replace(/^\s*/,"");if(e==="end"||e==="right")return s.replace(/\s*$/,"");throw new Error("Side not supported: "+e)}}};const ie=qe;var nt=new ne(ue({separator:","}),Ee,ie);const dt=null;var mt=new ne(ue({separator:",",conjunction:"and"}),Ee,ie);const $t=null;var kt=new ne(ue({separator:",",conjunction:"or"}),Ee,ie);const Qt=null;var vt=function(e){return{onSubstitution:function(s,n){if(e!=null&&typeof e=="string")typeof s=="string"&&s.includes(e)&&(s=s.split(e));else throw new Error("You need to specify a string character to split by.");return s}}};const pt=vt;var gt=function(e){return e!=null&&!Number.isNaN(e)&&typeof e!="boolean"},xt=function(){return{onSubstitution:function(r){return Array.isArray(r)?r.filter(gt):gt(r)?r:""}}};const bt=xt;var Yt=new ne(pt(`
`),bt,ue,Ee,ie);const zt=null;var Dt=function(e,r){return{onSubstitution:function(n,i){if(e==null||r==null)throw new Error("replaceSubstitutionTransformer requires at least 2 arguments.");return n==null?n:n.toString().replace(e,r)}}};const be=Dt;var Xt=new ne(pt(`
`),ue,Ee,ie,be(/&/g,"&amp;"),be(/</g,"&lt;"),be(/>/g,"&gt;"),be(/"/g,"&quot;"),be(/'/g,"&#x27;"),be(/`/g,"&#x60;"));const Zt=null;var Mt=function(e,r){return{onEndResult:function(n){if(e==null||r==null)throw new Error("replaceResultTransformer requires at least 2 arguments.");return n.replace(e,r)}}};const De=Mt;var Jt=new ne(De(/(?:\n(?:\s*))+/g," "),ie);const qt=null;var er=new ne(De(/(?:\n\s*)/g,""),ie);const tr=null;var rr=new ne(ue({separator:","}),De(/(?:\s+)/g," "),ie);const sr=null;var nr=new ne(ue({separator:",",conjunction:"or"}),De(/(?:\s+)/g," "),ie);const _r=null;var Pr=new ne(ue({separator:",",conjunction:"and"}),De(/(?:\s+)/g," "),ie);const Fo=null;var _o=new ne(ue,Ee,ie);const Po=null;var Wo=new ne(ue,De(/(?:\s+)/g," "),ie);const Uo=null;var Go=new ne(Ee,ie);const Ko=null;var Ms=new ne(Ee("all"),ie);const y=Ms,ws=[{title:"Use the JOIN command to match events between two log groups (LogGroupA, LogGroupB), based on common user IDs across the logs.\xA0",expr:{SQL:y`SELECT A.transaction_id as txn_id_a, A.userId , A.instance_id as inst_id_a, B.instance_id as inst_id_b FROM \`LogGroupA\` as A INNER JOIN \`LogGroupB\` as B ON A.userId = B.userId WHERE B.Status='ERROR'`}},{title:"Find logs where duration is greater than the average duration of all log groups, using a sub-query",expr:{SQL:y`SELECT \`@duration\` FROM \`LogGroupA\`
 WHERE \`@duration\` > (
 SELECT avg(\`@duration\`) FROM \`LogGroupA\`
 WHERE \`@type\` = 'REPORT')`}},{title:"Find all logs relating to a Lambda function where level is ERROR, and order these logs by request id using a sub-query",expr:{SQL:y`select requestId, level, \`@timestamp\`, \`@message\` from \`LogGroupA\` where requestId IN (SELECT distinct
  requestId FROM \`LogGroupA\` where level = 'ERROR') order by requestId`}},{title:"Find error logs from high-volume log streams using a sub-query.\xA0",expr:{SQL:y`SELECT 
 \`@logStream\`,
 COUNT(*) as error_count
 FROM \`LogGroupA\`
 WHERE 
 \`start\` >= date_sub(current_timestamp(), 1)
 AND lower(\`@message\`) LIKE '%error%'
 AND \`@logStream\` IN (
 SELECT \`@logStream\`
 FROM \`logs\`
 GROUP BY \`@logStream\`
 HAVING COUNT(*) > 1000
 )
 GROUP BY \`@logStream\`
 ORDER BY error_count DESC`}},{title:"Extract parameter values from a JSON log group",expr:{SQL:y`SELECT query_name, get_json_object(\`@message\`, '$.answers[*].Rdata')
  AS answers FROM \`LogGroupA\` Where query_type = 'A'`}},{title:"Find the intersection of elements for two columns based on eventName.",expr:{SQL:y`SELECT array_intersect(
 array(get_json_object(\`column1\`, '$.eventName')),
 array(get_json_object(\`column2\`, '$.eventName'))
 ) as matching_events
 FROM \`LogGroupA\`;`}},{title:"Return the top 25 most recently added log events.",expr:{SQL:"SELECT `@timestamp`, `@message` FROM `LogGroupA` ORDER BY `@timestamp` DESC LIMIT 25;"}},{title:"Find the number of exceptions logged every five minutes.",expr:{SQL:"SELECT window.start, COUNT(*) AS exceptionCount FROM `LogGroupA` WHERE `@message` LIKE '%Exception%' GROUP BY window(`@timestamp`, '5 minute') ORDER BY exceptionCount DESC"}},{title:"Return a list of log events that are not exceptions.",expr:{SQL:"SELECT `@message` FROM `LogGroupA` WHERE `@message` NOT LIKE '%Exception%'"}},{title:"Identify faults on API calls.",expr:{SQL:'Select @timestamp, @logStream as instanceId, ExceptionMessage from `LogGroupA` where Operation = "x" and Fault > 0'}},{title:"Return the number of exceptions logged every five minutes using regex where exception is not case sensitive.",expr:{SQL:"SELECT window.start, COUNT(*) AS exceptionCount FROM `LogGroupA` WHERE `@message` LIKE '%Exception%' GROUP BY window(`@timestamp`, '5 minute') ORDER BY exceptionCount DESC"}},{title:"Count the number of logs per minute over the last 24 hours, grouping them into one-minute time buckets and sorting from newest to oldest, and only consider those groups that have error_count greater than zero.",expr:{SQL:y`SELECT 
 date(\`@timestamp\`) as log_date,
 \`@logStream\`,
 COUNT(*) as total_messages,
 SUM(CASE WHEN lower(\`@message\`) LIKE '%error%' THEN 1 ELSE 0 END) as error_count,
 SUM(CASE WHEN lower(\`@message\`) LIKE '%warn%' THEN 1 ELSE 0 END) as warning_count
 FROM \`LogGroupA\`
 WHERE \`@timestamp\` >= date_sub(current_timestamp(), 7)
 GROUP BY date(\`startTime\`), \`@logStream\`
 HAVING error_count > 0
 ORDER BY error_count DESC`}},{title:"Calculate the total count of logs and unique streams, along with the earliest and latest timestamps for all logs from the past 24 hours.",expr:{SQL:y`SELECT 
 COUNT(*) as total_logs,
 COUNT(DISTINCT \`@logStream\`) as unique_streams,
 MIN(\`@timestamp\`) as earliest_log,
 MAX(\`startTime\`) as latest_log
 FROM \`LogGroupA\`
 WHERE \`startTime\` >= date_sub(current_timestamp(), 1)`}},{title:"Show the top 10 most active log streams from the past 24 hours, displaying each stream's total log count and its first and last log timestamps, sorted by highest log count first.",expr:{SQL:y`SELECT \`@logStream\`, COUNT(*) as log_count, MIN(\`@timestamp\`) as first_seen, MAX(\`@timestamp\`) as last_seen FROM \`LogGroupA\`WHERE \`startTime\` >= date_sub(current_timestamp(), 24)GROUP BY \`@logStream\`ORDER BY log_count DESC LIMIT 10`}},{title:"Count the number of error messages per hour over the last 24 hours, sorted chronologically by hour.",expr:{SQL:y`SELECT 
 hour(\`@timestamp\`) as hour_of_day,
 COUNT(*) as error_count
 FROM \`LogGroupA\`
 WHERE lower(\`@message\`) LIKE '%error%'
 AND \`@timestamp\` >= date_sub(current_timestamp(), 24)
 GROUP BY hour(\`@timestamp\`)
 ORDER BY hour_of_day`}},{title:"Categorize and count all log messages from the last 24 hours into different log levels (ERROR, WARNING, INFO, OTHER), based on message content.",expr:{SQL:y`SELECT 
 CASE 
 WHEN lower(\`@message\`) LIKE '%error%' THEN 'ERROR'
 WHEN lower(\`@message\`) LIKE '%warn%' THEN 'WARNING'
 WHEN lower(\`@message\`) LIKE '%info%' THEN 'INFO'
 ELSE 'OTHER'
 END as log_level,
 COUNT(*) as message_count
 FROM \`LogGroupA\`
 WHERE \`startTime\` >= date_sub(current_timestamp(), 1)
 GROUP BY CASE 
 WHEN lower(\`@message\`) LIKE '%error%' THEN 'ERROR'
 WHEN lower(\`@message\`) LIKE '%warn%' THEN 'WARNING'
 WHEN lower(\`@message\`) LIKE '%info%' THEN 'INFO'
 ELSE 'OTHER'
 END
 ORDER BY message_count DESC`}},{title:"Count the number of logs per minute over the last 24 hours, and group them into one-minute time buckets and sort from newest to oldest.",expr:{SQL:y`SELECT 
 date_trunc('minute', startTime) as time_bucket,
 COUNT(*) as log_count
 FROM \`LogGroupA\`
 WHERE startTime >= date_sub(current_timestamp(), 1)
 GROUP BY date_trunc('minute', \`startTime\`)
 ORDER BY time_bucket DESC`}},{title:"Find log messages that were truncated, based on analysis of the length of the @message field in the log events.",expr:{SQL:y`SELECT 
 length(\`@message\`) as msg_length,
 COUNT(*) as count,
 MIN(\`@message\`) as sample_message
 FROM \`LogGroupA\`
 WHERE \`startTime\` >= date_sub(current_timestamp(), 1)
 GROUP BY length(\`@message\`)
 HAVING count > 10
 ORDER BY msg_length DESC
 LIMIT 10`}},{title:"Show the top 10 most common message lengths from the last 24 hours. It displays the length, count, and a sample message for each message length that appears more than 10 times, sorted by longest messages first.",expr:{SQL:"SELECT `@logStream`, MAX(`startTime`) as last_log_time, UNIX_TIMESTAMP() - UNIX_TIMESTAMP(MAX(`startTime`)) as seconds_since_last_log FROM `LogGroupA`GROUP BY `@logStream`HAVING seconds_since_last_log > 3600 ORDER BY seconds_since_last_log DESC"}},{title:"Find duplicate log messages that occurred more than 10 times in the last 24 hours, showing their count, first and last occurrence times, and number of streams they appeared in, sorted by most frequent messages first",expr:{SQL:y`SELECT 
 \`@message\`,
 COUNT(*) as occurrence_count,
 MIN(\`@timestamp\`) as first_seen,
 MAX(\`@timestamp\`) as last_seen,
 COUNT(DISTINCT \`@logStream\`) as stream_count
 FROM \`LogGroupA\`
 WHERE \`@timestamp\` >= date_sub(current_timestamp(), 1)
 GROUP BY \`@message\`
 HAVING occurrence_count > 10
 ORDER BY occurrence_count DESC"`}},{title:"Count unique message patterns per hour over the last 24 hours. When doing this, it considers only the first 50 characters of longer messages. Results are sorted from most recent hour to oldest.",expr:{SQL:y`SSELECT 
 date_trunc('hour', startTime) as hour_window,
 COUNT(DISTINCT 
 CASE 
 WHEN length(\`@message\`) < 50 THEN substr(\`@message\`, 1, length(\`@message\`))
 ELSE substr(\`@message\`, 1, 50)
 END
 ) as unique_patterns
 FROM \`LogGroupA\`
 WHERE startTime >= date_sub(current_timestamp(), 24)
 GROUP BY date_trunc('hour', startTime)
 ORDER BY hour_window DESC"`}},{title:"Calculate the success and failure rates of requests, based on occurrence of success or failure keywords in the log.",expr:{SQL:y`SELECT 
 date_trunc('minute', \`@timestamp\`) as minute,
 COUNT(*) as total_requests,
 SUM(CASE WHEN lower(\`@message\`) LIKE '%success%' THEN 1 ELSE 0 END) as successful_requests,
 SUM(CASE WHEN lower(\`@message\`) LIKE '%fail%' OR lower(\`@message\`) LIKE '%error%' THEN 1 ELSE 0 END) as failed_requests,
 ROUND(SUM(CASE WHEN lower(\`@message\`) LIKE '%success%' THEN 1 ELSE 0 END) * 100.0 / COUNT(*), 2) as success_rate
 FROM \`LogGroupA\`
 WHERE startTime >= date_sub(current_timestamp(), 1)
 GROUP BY date_trunc('minute', startTime)
 ORDER BY minute DESC"`}},{title:"Identify and extract specific patterns from messages.",expr:{SQL:y`SELECT 
 \`@logStream\`,
 regexp_extract(\`@message\`, '([A-Z0-9]{8})', 1) as id_pattern,
 substring_index(\`@message\`, ' ', 2) as first_two_words,
 left(\`@message\`, 10) as message_start,
 right(\`@message\`, 10) as message_end,
 length(trim(\`@message\`)) - length(replace(lower(\`@message\`), ' ', '')) + 1 as word_count
 FROM \`LogGroupA\`
 WHERE startTime >= date_sub(current_timestamp(), 1)"`}},{title:"Mask numbers in the log events, replacing them with asterisks.",expr:{SQL:y`SELECT 
 \`@logStream\`,
 translate(\`@message\`, '{}[]()',' ') as cleaned_message,
 regexp_replace(\`@message\`, '[0-9]', '*') as numbers_masked,
 concat_ws(' - ', \`@logStream\`, substr(\`@message\`, 1, 50)) as combined_log,
 repeat('*', length(\`@message\`)) as message_mask
 FROM \`LogGroupA\`
 WHERE startTime >= date_sub(current_timestamp(), 1)"`}},{title:"Find log streams that have more than 50 error logs in the last 24 hours",expr:{SQL:y`SELECT 
 \`@logStream\`,
 COUNT(*) as total_logs,
 COUNT(CASE WHEN lower(\`@message\`) LIKE '%error%' THEN 1 END) as error_count
 FROM \`LogGroupA\`
 WHERE \`@timestamp\` >= date_sub(current_timestamp(), 1)
 GROUP BY \`@logStream\`
 HAVING error_count > 50
 ORDER BY error_count DESC"`}}],Fs=[{title:"Calculate the total message length over five-minute intervals, and then find the average value across the five-minute intervals.	",expr:{PPL:"eval len_message = length(`@message`) | stats count(len_message) as log_bytes by span(`@timestamp`, 5m) | stats avg(log_bytes) | head 10"}},{title:"Return the top 25 most recently added log events.	",expr:{PPL:"fields `@timestamp`, `@message` | sort - `@timestamp` | head 25"}},{title:"Return a list of log events that are not exceptions.	",expr:{PPL:"eval result = LIKE(`@message`, '%Exception%') | where result = false"}},{title:"Identify faults on API calls.	",expr:{PPL:y`"where Operation = <operation> AND Fault > 0
 | fields \`@timestamp\`, \`@logStream\` as instanceId, ExceptionMessage"`}},{title:"Return the number of exceptions logged every five minutes using regex where exception is not case sensitive.	",expr:{PPL:"eval result = LIKE(`@message`, '%Exception%') | where result = true | stats count() as exceptionCount by span(`@timestamp`, \"5m\") | sort -exceptionCount"}},{title:"Parse the data and counts the number of fields.	",expr:{PPL:y`"eval result = LIKE(\`@message\`, 'EndTime') | eval result = true |
 parse \`@message\` '.+=(?<day>[A-Za-z]{3}), \d+' | stats count() by day | head 25"`}},{title:"Examine message length patterns per log stream to identify potential truncation issues or abnormal logging behavior that might indicate problems.	",expr:{PPL:y`eval msg_length = length(\`@message\`)| stats avg(msg_length) as avg_length, max(msg_length) as max_length, min(msg_length) as min_length by \`@logStream\`| sort - avg_length`}},{title:"Analyze log volume trends over time to identify patterns and potential issues in system behavior.	",expr:{PPL:y`"eval date = ADDDATE(CURRENT_DATE(), -1) | eval result = TIMESTAMP(date) | where \`@timestamp\` > result | 
 stats count() as log_count by span(\`@timestamp\`, 1h) 
 | sort - log_count
 | head 10"`}},{title:"Group and count error messages to identify the most frequent issues affecting the system.	",expr:{PPL:y`eval result = LIKE(\`@message\`, "%Error%") | where result = true | stats count() by \`@logStream\` | head 10`}},{title:"Find the top causes of error logs.	",expr:{PPL:y`eval result = LIKE(\`@message\`, "%Error%") | where result = true | top 2 \`@logStream\` | head 10`}},{title:"Find the log streams that contribute the least error log events.	",expr:{PPL:y`eval result = LIKE(\`@message\`, "%Error%") | where result = true | rare \`@logStream\` | head 10`}},{title:"Calculate the total message length over five-minute intervals, and then find the average value across the five-minute intervals.	",expr:{PPL:y`eval len_message = length(\`@message\`) | stats count(len_message) as log_bytes by span(\`@timestamp\`, 5m) | stats avg(log_bytes) | head 10`}},{title:"Find the log events that are not exceptions.	",expr:{PPL:y`eval isException = LIKE(\`@message\`, '%exception%') | where isException = false | fields \`@logStream\`, \`@message\` | head 10`}},{title:"Return the top 25 log events sorted by timestamp.	",expr:{PPL:y`fields \`@logStream\`, \`@message\` | sort -\`@timestamp\` | head 25`}},{title:"Find and display the error count.	",expr:{PPL:y`where Operation = "x" and Fault > 0 | fields \`@timestamp\`, \`@logStream\`, ExceptionMessage | head 20`}}],_s=[{title:"Find the 25 most recently added log events",expr:{CWLI:"fields @timestamp, @message | sort @timestamp desc | limit 25",SQL:y`SELECT \`@timestamp\`, \`@message\`
      FROM \`log_group\`
      ORDER BY \`@timestamp\` DESC
      LIMIT 25`,PPL:y`fields \`@timestamp\`, \`@message\`
| sort - \`@timestamp\`
| head 25
`}},{title:"Get a list of the number of exceptions per hour",expr:{CWLI:y`filter @message like /Exception/
| stats count(*) as exceptionCount by bin(1h)
| sort exceptionCount desc`,SQL:y`SELECT window.start, COUNT(*) AS exceptionCount
FROM \`log_group\`
WHERE \`@message\` LIKE '%Exception%'
GROUP BY window(\`@timestamp\`, '1 hour')
ORDER BY exceptionCount DESC`,PPL:y`where abs(\`@message\`, "%Exception%")
| stats count() as exceptionCount by span(\`@timestamp\`, 1h)
| sort - exceptionCount`}},{title:"Get a list of log events that aren't exceptions.",expr:{CWLI:"fields @message | filter @message not like /Exception/",SQL:y`SELECT \`@message\`
FROM \`log_group\`
WHERE \`@message\` NOT LIKE '%Exception%'`,PPL:y`fields \`@message\`
| where not like(\`@message\`, "%Exception%")`}},{title:"Get the most recent log event for each unique value of the server field",expr:{CWLI:y`fields @timestamp, server, severity, message
| sort @timestamp asc
| dedup server`,PPL:y`fields \`@timestamp\`, server, severity, message
| sort \`@timestamp\`
| dedup server`}},{title:"Get the most recent log event for each unique value of the server field for each severity type",expr:{CWLI:y`fields @timestamp, server, severity, message
| sort @timestamp desc
| dedup server, severity`,PPL:y`fields \`@timestamp\`, server, severity, message
| sort - \`@timestamp\`
| dedup server`}},{title:"Number of exceptions logged every 5 minutes",expr:{CWLI:"filter @message like /Exception/ | stats count(*) as exceptionCount by bin(5m) | sort exceptionCount desc",SQL:y`SELECT window.start, COUNT(*) AS exceptionCount
FROM \`log_group\`
WHERE \`@message\` LIKE '%Exception%'
GROUP BY window(\`@timestamp\`, '5 minute')
ORDER BY exceptionCount DESC`,PPL:y`where like(\`@message\`, "%Exception%")
| stats count() as exceptionCount by span(\`@timestamp\`, 5m)
| sort - exceptionCount`}},...ws,...Fs],Ps=[{title:"View latency statistics for 5-minute intervals",expr:{CWLI:y`filter @type = "REPORT" |
                           stats avg(@duration), max(@duration), min(@duration) by bin(5m)`,SQL:y`SELECT window.start, AVG(\`@duration\`) AS averageDuration,
                            MAX(\`@duration\`) AS maxDuration,
                            MIN(\`@duration\`) AS minDuration
                            FROM \`log_group\`
                            WHERE \`@type\` = 'REPORT'
                            GROUP BY window(\`@timestamp\`, '5 minute')`}},{title:"Determine the amount of overprovisioned memory",expr:{CWLI:y`filter @type = "REPORT"
          | stats max(@memorySize / 1000 / 1000) as provisionedMemoryMB,
            min(@maxMemoryUsed / 1000 / 1000) as smallestMemoryRequestMB,
            avg(@maxMemoryUsed / 1000 / 1000) as avgMemoryUsedMB,
            max(@maxMemoryUsed / 1000 / 1000) as maxMemoryUsedMB,
            provisionedMemoryMB - maxMemoryUsedMB as overProvisionedMB
        `,SQL:y`SELECT MAX(\`@memorySize\` / 1000 / 1000) AS provisonedMemoryMB,
          MIN(\`@maxMemoryUsed\` / 1000 / 1000) AS smallestMemoryRequestMB,
          AVG(\`@maxMemoryUsed\` / 1000 / 1000) AS avgMemoryUsedMB,
          MAX(\`@maxMemoryUsed\` / 1000 / 1000) AS maxMemoryUsedMB,
          MAX(\`@memorySize\` / 1000 / 1000) - MAX(\`@maxMemoryUsed\` / 1000 / 1000) AS overProvisionedMB
          FROM \`log_group\`
          WHERE \`@type\` = 'REPORT'`}},{title:"Find the most expensive requests",expr:{CWLI:y`filter @type = "REPORT"
        | fields @requestId, @billedDuration
        | sort by @billedDuration desc`,SQL:y`SELECT\`@requestId\`, \`@billedDuration\`
              FROM \`log_group\`
              WHERE \`@type\` = 'REPORT'
              ORDER BY \`@billedDuration\` DESC`,PPL:y`where \`@type\` = 'REPORT'
            | fields \`@requestId\`, \`@billedDuration\`
            | sort - \`@billedDuration\``}}],Ws=[{title:"Find the top 15 packet transfers across hosts",expr:{CWLI:y`stats sum(packets) as packetsTransferred by srcAddr, dstAddr
          | sort packetsTransferred  desc
          | limit 15`,SQL:y`SELECT \`srcAddr\`, \`dstAddr\`, SUM(\`packets\`) AS packetsTransferred
                FROM \`log_group\`
                GROUP BY \`srcAddr\`, \`dstAddr\`
                ORDER BY packetsTransferred DESC
                LIMIT 15;`}},{title:"Find the IP addresses that use UDP as a data transfer protocol",expr:{CWLI:"filter protocol=17 | stats count(*) by srcAddr",SQL:y`SELECT \`srcAddr\`, COUNT(*) AS totalCount
                FROM \`log_group\`
                WHERE \`protocol\` = 17
                GROUP BY srcAddr;`}},{title:"Find the IP addresses where flow records were skipped during the capture window",expr:{CWLI:y`filter logStatus="SKIPDATA"
                | stats count(*) by bin(1h) as t
                | sort t`,SQL:y`SELECT window.start, COUNT(*) AS totalCount
              FROM \`log_group\`
              WHERE \`logStatus\` = 'SKIPDATA'
              GROUP BY window(\`@timestamp\`, '1 minute')
              ORDER BY window.start`,PPL:y`where logStatus="SKIPDATA"
              | stats count() by span(\`@timestamp\`, 1h) as t
              | sort t`}},{title:"Average, min, and max byte transfers by source and destination IP addresses",expr:{CWLI:"stats sum(bytes) as bytesTransferred by srcAddr, dstAddr | sort bytesTransferred desc | limit 10",SQL:y`SELECT \`srcAddr\`, \`dstAddr\`, AVG(\`bytes\`),
    MIN(\`bytes\`), MAX(\`bytes\`)
    FROM \`log_group\`
    GROUP BY \`srcAddr\`, \`dstAddr\``}},{title:"Top 10 byte transfers by source and destination IP addresses",expr:{CWLI:"stats sum(bytes) as bytesTransferred by srcAddr, dstAddr | sort bytesTransferred desc | limit 10",SQL:y`SELECT \`srcAddr\`, \`dstAddr\`, SUM(\`bytes\`) as bytesTransferred
    FROM \`log_group\`
    GROUP BY \`srcAddr\`, \`dstAddr\`
    ORDER BY bytesTransferred DESC
    LIMIT 10`}},{title:"Top 20 source IP addresses with highest number of rejected requests",expr:{CWLI:'filter action="REJECT" | stats count(*) as numRejections by srcAddr | sort numRejections desc | limit 20',SQL:y`SELECT \`srcAddr\`, COUNT(*) AS numRejections
              FROM \`log_group\`
              WHERE \`action\` = 'REJECT'
              GROUP BY \`srcAddr\`
              ORDER BY numRejections DESC
              LIMIT 20`}},{title:"Find the 10 DNS resolvers with the highest number of requests.",expr:{CWLI:y`stats count(*) as numRequests by resolverIp
            | sort numRequests desc
            | limit 10`,SQL:y`SELECT \`resolverIp\`, COUNT(*) AS numRequests
                FROM \`log_group\`
                GROUP BY \`resolverIp\`
                ORDER BY numRequests DESC
                LIMIT 10`}},{title:"Find the number of records by domain and subdomain where the server failed to complete the DNS request.",expr:{CWLI:y`filter responseCode="SERVFAIL" | stats count(*) by queryName`,SQL:y`SELECT \`queryName\`, COUNT(*)
    FROM \`log_group\`
    WHERE \`responseCode\` = 'SERVFAIL'
    GROUP BY \`queryName\``,PPL:y`where \`responseCode\` = 'SERVFAIL'
    | stats count() by \`queryName\``}},{title:"Number of requests received every 10 minutes by edge location",expr:{CWLI:"stats count(*) by queryType, bin(10m)",SQL:y`SELECT window.start, \`queryType\`,
    COUNT(*) AS totalCount
    FROM \`log_group\`
    GROUP BY window(\`@timestamp\`, '10 minute'), \`queryType\``,PPL:"stats count() by queryType, span(`@timestamp`, 10m)"}}],Us=[{title:"Find the number of log entries for each service, event type, and AWS Region",expr:{CWLI:"stats count(*) by eventSource, eventName, awsRegion",PPL:"stats count() by `eventSource`, `eventName`, `awsRegion`",SQL:y`SELECT \`eventSource\`, \`eventName\`,
    \`awsRegion\`, COUNT(*)
    FROM \`log_group\`
    GROUP BY \`eventSource\`, \`eventName\`,
    \`awsRegion\``}},{title:"Find the Amazon EC2 hosts that were started or stopped in a given AWS Region",expr:{CWLI:'filter (eventName="StartInstances" or eventName="StopInstances") and awsRegion="us-east-2',PPL:y`where \`eventName\` = 'StartInstances'
    OR \`eventName\` = 'StopInstances'
    AND \`awsRegion\` = 'us-east-2'`,SQL:y`SELECT \`@timestamp\`, \`@message\`
    FROM \`log_group\`
    WHERE \`eventName\` = 'StartInstances'
    OR \`eventName\` = 'StopInstances'
    AND \`awsRegion\` = 'us-east-2'`}},{title:"Find the AWS Regions, user names, and ARNs of newly created IAM users",expr:{CWLI:y`filter eventName="CreateUser"
            | fields awsRegion, requestParameters.userName, responseElements.user.arn`,PPL:y`where \`eventName\` = 'CreateUser'
    | fields \`awsRegion\`, \`requestParameters.userName\`, \`responseElements.user.arn\``,SQL:y`SELECT \`awsRegion\`, \`requestParameters.userName\`,
            \`responseElements.user.arn\`
            FROM \`log_group\`
            WHERE \`eventName\` = 'CreateUser'`}},{title:"Find the number of records where an exception occurred while invoking the API UpdateTrail",expr:{CWLI:y`filter eventName="UpdateTrail" and ispresent(errorCode)
    | stats count(*) by errorCode, errorMessage`,PPL:y`where eventName = "UpdateTrail" and isnotnull(errorCode)
    | stats count() by errorCode, errorMessage`,SQL:y`SELECT \`errorCode\`, \`errorMessage\`, COUNT(*)
    FROM \`log_group\`
    WHERE \`eventName\` = 'UpdateTrail'
    AND \`errorCode\` IS NOT NULL
    GROUP BY \`errorCode\`, \`errorMessage\``}},{title:"Find log entries where TLS 1.0 or 1.1 was used",expr:{CWLI:y`filter tlsDetails.tlsVersion in [ "TLSv1", "TLSv1.1" ]
    | stats count(*) as numOutdatedTlsCalls by userIdentity.accountId, recipientAccountId, eventSource, eventName, awsRegion, tlsDetails.tlsVersion, tlsDetails.cipherSuite, userAgent
    | sort eventSource, eventName, awsRegion, tlsDetails.tlsVersion`,PPL:y`where tlsDetails.tlsVersion in ('TLSv1', 'TLSv1.1')
    | stats count() as numOutdatedTlsCalls by
    \`userIdentity.accountId\`, \`recipientAccountId\`,
    \`eventSource\`, \`eventName\`, \`awsRegion\`
    \`tlsDetails.tlsVersion\`, \`tlsDetails.cipherSuite\`
    \`userAgent\`
    | sort \`eventSource\`, \`eventName\`, \`awsRegion\`, \`tlsDetails.tlsVersion\``,SQL:y`SELECT \`userIdentity.accountId\`, \`recipientAccountId\`, \`eventSource\`,
    \`eventName\`, \`awsRegion\`, \`tlsDetails.tlsVersion\`,
    \`tlsDetails.cipherSuite\`, \`userAgent\`, COUNT(*) AS numOutdatedTlsCalls
    FROM \`log_group\`
    WHERE \`tlsDetails.tlsVersion\` IN ('TLSv1', 'TLSv1.1')
    GROUP BY \`userIdentity.accountId\`, \`recipientAccountId\`, \`eventSource\`,
    \`eventName\`, \`awsRegion\`, \`tlsDetails.tlsVersion\`,
    \`tlsDetails.cipherSuite\`, \`userAgent\`
    ORDER BY \`eventSource\`, \`eventName\`, \`awsRegion\`, \`tlsDetails.tlsVersion\``}},{title:"Find the number of calls per service that used TLS versions 1.0 or 1.1",expr:{CWLI:y`filter tlsDetails.tlsVersion in [ "TLSv1", "TLSv1.1" ]
    | stats count(*) as numOutdatedTlsCalls by eventSource
    | sort numOutdatedTlsCalls desc`,PPL:y`where \`tlsDetails.tlsVersion\` in ('TLSv1', 'TLSv1.1')
    | stats count() as numOutdatedTlsCalls by \`eventSource\`
    | sort - numOutdatedTlsCalls`,SQL:y`SELECT \`eventSource\`, COUNT(*) AS numOutdatedTlsCalls
    FROM \`log_group\`
    WHERE \`tlsDetails.tlsVersion\` IN ('TLSv1', 'TLSv1.1')
    GROUP BY \`eventSource\`
    ORDER BY numOutdatedTlsCalls DESC`}},{title:"Number of log entries by region and EC2 event type",expr:{CWLI:'filter eventSource="ec2.amazonaws.com" | stats count(*) as eventCount by eventName, awsRegion | sort eventCount desc',PPL:y`where \`eventSource\` = 'ec2.amazonaws.com'
    | stats count() as eventCount by \`eventName\`, \`awsRegion\`
    | sort - eventCount
    `,SQL:y`SELECT \`eventName\`, \`awsRegion\`,
    COUNT(*) AS eventCount
    FROM \`log_group\`
    WHERE \`eventSource\` = 'ec2.amazonaws.com'
    GROUP BY \`eventName\`, \`awsRegion\`
    ORDER BY eventCount DESC`}}],Gs=[{title:"Find the instances that are sending the most traffic through your NAT gateway",expr:{CWLI:y`filter (dstAddr like 'x.x.x.x' and srcAddr like 'y.y.')
    | stats sum(bytes) as bytesTransferred by srcAddr, dstAddr
    | sort bytesTransferred desc
    | limit 10`,PPL:y`where like(dstAddr, "x.x.x.x") and like(srcAddr like "y.y.")
    | stats sum(bytes) as bytesTransferred by srcAddr, dstAddr
    | sort - bytesTransferred
    | head 10`,SQL:y`SELECT \`srcAddr\`, \`dstAddr\`,
    SUM(\`bytes\`) AS bytesTransferred
    FROM \`log_group\`
    WHERE \`dstAddr\` LIKE 'x.x.x.x'
    AND \`srcAddr\` LIKE \`y.y.%\`
    GROUP BY \`srcAddr\`, \`dstAddr\`
    ORDER BY bytesTransferred DESC
    LIMIT 10`}},{title:"Determine the traffic that's going to and from the instances in your NAT gateways",expr:{CWLI:y`filter (dstAddr like 'x.x.x.x' and srcAddr like 'y.y.') or (srcAddr like 'xxx.xx.xx.xx' and dstAddr like 'y.y.')
    | stats sum(bytes) as bytesTransferred by srcAddr, dstAddr
    | sort bytesTransferred desc
    | limit 10`,PPL:y`where (like(dstAddr, "x.x.x.x") and like(srcAddr, "y.y.")) or (like(srcAddr, "xxx.xx.xx.xx") and like(dstAddr, "y.y.")
    | stats sum(bytes) as bytesTransferred by srcAddr, dstAddr
    | sort - bytesTransferred
    | limit 10`,SQL:y`SELECT \`srcAddr\`, \`dstAddr\`,
    SUM (\`bytes\`) AS bytesTransferred
    FROM \`log_group\`
    WHERE (\`dstAddr\` LIKE 'x.x.x.x' AND \`srcAddr\` LIKE 'y.y.%')
    OR (\`srcAddr\` LIKE 'xxx.xx.xx.xx' AND \`dstAddr\` LIKE 'y.y.%')
    GROUP BY \`srcAddr\`, \`dstAddr\`
    ORDER BY \`bytesTransferred\` DESC
    LIMIT 10`}},{title:"Determine the internet destinations that the instances in your VPC communicate with most often for uploads and downloads - for uploads",expr:{CWLI:y`filter (srcAddr like 'x.x.x.x' and dstAddr not like 'y.y.')
    | stats sum(bytes) as bytesTransferred by srcAddr, dstAddr
    | sort bytesTransferred desc
    | limit 10`,PPL:y`where like(srcAddr like "y.y.") and not like(dstAddr, "x.x.x.x")
    | stats sum(bytes) as bytesTransferred by srcAddr, dstAddr
    | sort - bytesTransferred
    | head 10`,SQL:y`SELECT \`srcAddr\`, \`dstAddr\`,
    SUM(\`bytes\`) AS bytesTransferred
    FROM \`log_group\`
    WHERE \`srcAddr\` LIKE 'x.x.x.x'
    AND \`dstAddr\` NOT LIKE \`y.y.%\`
    GROUP BY \`srcAddr\`, \`dstAddr\`
    ORDER BY bytesTransferred DESC
    LIMIT 10`}},{title:"Determine the internet destinations that the instances in your VPC communicate with most often for uploads and downloads - for downloads",expr:{CWLI:y`filter (dstAddr like 'x.x.x.x' and srcAddr not like 'y.y.')
    | stats sum(bytes) as bytesTransferred by srcAddr, dstAddr
    | sort bytesTransferred desc
    | limit 10`,PPL:y`where like(dstAddr, "x.x.x.x") and not like(srcAddr like "y.y.")
    | stats sum(bytes) as bytesTransferred by srcAddr, dstAddr
    | sort - bytesTransferred
    | head 10`,SQL:y`SELECT \`srcAddr\`, \`dstAddr\`,
    SUM(\`bytes\`) AS bytesTransferred
    FROM \`log_group\`
    WHERE \`dstAddr\` LIKE 'x.x.x.x'
    AND \`srcAddr\` NOT LIKE \`y.y.%\`
    GROUP BY \`srcAddr\`, \`dstAddr\`
    ORDER BY bytesTransferred DESC
    LIMIT 10`}}],Ks=[{title:"Number of unique HTTP status codes",expr:{CWLI:'fields ispresent(graphQLAPIId) as isApi | filter isApi | filter logType = "RequestSummary" | stats count() as statusCount by statusCode | sort statusCount desc',SQL:y`SELECT \`graphQLAPIId\`, \`statusCode\`,
    COUNT(*) AS statusCount
    FROM \`log_group\`
    WHERE \`logType\` = 'RequestSummary'
    AND \`graphQLAPIId\` IS NOT NULL
    GROUP BY \`graphQLAPIId\`, \`statusCode\`
    ORDER BY statusCount DESC`}},{title:"Most frequently invoked resolvers",expr:{CWLI:'fields ispresent(resolverArn) as isRes | stats count() as invocationCount by resolverArn | filter isRes | filter logType = "Tracing" | sort invocationCount desc | limit 10',PPL:y`where \`logType\` = 'Tracing'
    | fields \`resolverArn\`, \`duration\`
    | sort - duration
    | head 10`,SQL:y`SELECT \`resolverArn\`, COUNT(*) AS invocationCount
    FROM \`log_group\`
    WHERE \`logType\` = 'Tracing'
    AND \`resolverArn\` IS NOT NULL
    GROUP BY \`resolverArn\`
    ORDER BY invocationCount DESC
    LIMIT 10`}},{title:"Top 10 resolvers with maximum latency",expr:{CWLI:'fields resolverArn, duration | filter logType = "Tracing" | sort duration desc | limit 10',PPL:y`where \`logType\` = 'Tracing'
    | fields \`resolverArn\`, \`duration\`
    | sort - duration
    | head 10`,SQL:y`SELECT \`resolverArn\`, \`duration\`
    FROM \`log_group\`
    WHERE \`logType\` = 'Tracing'
    ORDER BY \`duration\` DESC
    LIMIT 10`}},{title:"Resolvers with most errors in mapping templates",expr:{CWLI:'fields ispresent(resolverArn) as isRes | stats count() as errorCount by resolverArn, logType | filter isRes and (logType = "RequestMapping" or logType = "ResponseMapping") and fieldInError | sort errorCount desc | limit 10',SQL:y`SELECT resolverArn, COUNT(*) AS errorCount
    FROM \`log_group\`
    WHERE ISNOTNULL(resolverArn) AND (logType = "RequestMapping" OR logType = "ResponseMapping") AND fieldInError
    GROUP BY resolverArn
    ORDER BY errorCount DESC
    LIMIT 10`}},{title:"Field latency statistics",expr:{CWLI:`stats min(duration), max(duration), avg(duration) as avgDur by concat(parentType, '/', fieldName) as fieldKey | filter logType = "Tracing" | sort avgDur desc | limit 10`,SQL:y`SELECT CONCAT(parentType, "/", fieldName) AS fieldKey, MIN(duration), MAX(duration), AVG(duration) as avgDur
    FROM \`log_group\`
    ORDER BY fieldKey
    WHERE logType="Tracing"
    SORTY BY avgDur DESC
    LIMIT 10`}},{title:"Resolver latency statistics",expr:{CWLI:'fields ispresent(resolverArn) as isRes | filter isRes | filter logType = "Tracing" | stats min(duration), max(duration), avg(duration) as avgDur by resolverArn | sort avgDur desc | limit 10 ',SQL:y`SELECT \`resolverArn\`, MIN(\`duration\`),
    MAX(\`duration\`), AVG(\`duration\`) as avgDur
    FROM \`log_group\`
    WHERE \`resolverArn\` IS NOT NULL
    AND \`logType\` = 'Tracing'
    GROUP BY \`resolverArn\`
    ORDER BY avgDur DESC
    LIMIT 10`}},{title:"Top 10 requests with maximum latency",expr:{CWLI:'fields requestId, latency | filter logType = "RequestSummary" | sort latency desc | limit 10',PPL:y`where \`logType\` = 'RequestSummary'
    | fields \`requestId\`, \`latency\`
    | sort - \`latency\`
    | head 10`,SQL:y`SELECT \`requestId\`, \`latency\`
    FROM \`log_group\`
    WHERE \`logType\` = 'RequestSummary'
    ORDER BY \`latency\` DESC
    LIMIT 10`}}],Bs=[{title:"Count IoT Events and status including errors",expr:{CWLI:"fields @timestamp, @message | stats count(*) by eventType, status",SQL:y`SELECT \`eventType\`, \`status\`, COUNT(*)
    FROM \`log_group\`
    GROUP BY \`eventType\`, \`status\``}},{title:"Count of Disconnect reasons",expr:{CWLI:'filter eventType="Disconnect" | stats count(*) by disconnectReason | sort disconnectReason desc',PPL:y`where \`eventType\` = \`Disconnect\`
    | stats count() by \`disconnectReason\`
    | sort - \`disconnectReason\``,SQL:y`SELECT \`disconnectReason\`, COUNT(*)
    FROM \`log_group\`
    WHERE \`eventType\` = 'Disconnect'
    GROUP BY \`disconnectReason\`
    ORDER BY \`disconnectReason\` DESC`}},{title:"Top 50 devices with Duplicate ClientId disconnect error",expr:{CWLI:'filter eventType="Disconnect" and disconnectReason="DUPLICATE_CLIENTID" | stats count(*) by clientId | sort numPublishIn desc | limit 50',SQL:y`SELECT \`clientId\`, COUNT(*) AS duplicateCount
    FROM \`log_group\`
    WHERE \`eventType\` = 'Disconnect'
    AND \`disconnectReason\` = 'DUPLICATE_CLIENTID'
    GROUP BY \`clientId\`
    ORDER BY duplicateCount DESC
    LIMIT 50`}},{title:"Top 10 failed connections by ClientId",expr:{CWLI:'filter eventType="Connect" and status="Failure" | stats count(*) by clientId | sort numPublishIn desc | limit 10',SQL:y`SELECT \`clientId\`, COUNT(*) AS failedConnectionCount
    FROM \`log_group\`
    WHERE \`eventType\` = 'Connect'
    AND \`status\` = 'Failure'
    GROUP BY \`clientId\`
    ORDER BY failedConnectionCount DESC
    LIMIT 10`}},{title:"Connectivity activity for a device",expr:{CWLI:"fields @timestamp, eventType, reason, clientId | filter clientId like /sampleClientID/ | filter eventType like /Connect|Disconnect/ | sort @timestamp desc | limit 20",PPL:y`fields \`@timestamp\`, eventType, reason, clientId
    | where like(clientId, "%sampleClientID%")
    | where like(eventType, "%Connect%") or like(eventType, "%Disconnect%")
    | sort - \`@timestamp\`
    | head 20`,SQL:y`SELECT \`@timestamp\`, \`eventType\`,
    \`reason\`, \`clientId\`
    FROM \`log_group\`
    WHERE \`clientId\` LIKE '%sampleClientID%'
    AND \`eventType\` LIKE ANY ('%Connect%', '%Disconnect%')
    ORDER BY \`@timestamp\` DESC
    LIMIT 20`}},{title:"View messages published to a topic",expr:{CWLI:`fields @timestamp, @message | sort @timestamp desc | filter ( eventType="Publish-In" ) and topicName like 'your/topic/here'`,PPL:y`fields \`@timestamp\`, \`@message\`
    | where eventType = "Publish-In" and like(topicName, "%your/topic/here%")
    | sort - \`@timestamp\``,SQL:y`SELECT \`@timestamp\`, \`@message\`
    FROM \`log_group\`
    WHERE \`eventType\` = 'Publish-In'
    AND \`topicName\` LIKE '%your/topic/here%'`}}],ir=[{label:"fields",documentation:"Retrieves the specified fields from log events"},{label:"display",documentation:"Specifies which fields to display in the query results"},{label:"filter",documentation:"Filters the results of a query based on one or more conditions"},{label:"stats",documentation:"Calculates aggregate statistics based on the values of log fields"},{label:"sort",documentation:"Sorts the retrieved log events"},{label:"limit",documentation:"Specifies the number of log events returned by the query"},{label:"parse",documentation:"Extracts data from a log field, creating one or more ephemeral fields that you can process further in the query"}],Bo=null,Ho=null,Wr=[{label:"abs",detail:"abs(a)",documentation:"Absolute value."},{label:"ceil",detail:"ceil(a)",documentation:"Round to ceiling (the smallest integer that is greater than the value of a)."},{label:"floor",detail:"floor(a)",documentation:"Round to floor (the largest integer that is smaller than the value of a)."},{label:"greatest",detail:"greatest(a,b, ... z)",documentation:"Returns the largest value."},{label:"least",detail:"least(a, b, ... z)",documentation:"Returns the smallest value."},{label:"log",detail:"log(a)",documentation:"Natural logarithm."},{label:"sqrt",detail:"sqrt(a)",documentation:"Square root."}],Hs=[{label:"ispresent",detail:"ispresent(fieldname)",documentation:"Returns true if the field exists."},{label:"coalesce",detail:"coalesce(fieldname1, fieldname2, ... fieldnamex)",documentation:"Returns the first non-null value from the list."}],Ur=[{label:"isempty",detail:"isempty(fieldname)",documentation:"Returns true if the field is missing or is an empty string."},{label:"isblank",detail:"isblank(fieldname)",documentation:"Returns true if the field is missing, an empty string, or contains only white space."},{label:"concat",detail:"concat(string1, string2, ... stringz)",documentation:"Concatenates the strings."},{label:"ltrim",detail:"ltrim(string) or ltrim(string1, string2)",documentation:"Remove white space from the left of the string. If the function has a second string argument, it removes the characters of string2 from the left of string1."},{label:"rtrim",detail:"rtrim(string) or rtrim(string1, string2)",documentation:"Remove white space from the right of the string. If the function has a second string argument, it removes the characters of string2 from the right of string1."},{label:"trim",detail:"trim(string) or trim(string1, string2)",documentation:"Remove white space from both ends of the string. If the function has a second string argument, it removes the characters of string2 from both sides of string1."},{label:"strlen",detail:"strlen(string)",documentation:"Returns the length of the string in Unicode code points."},{label:"toupper",detail:"toupper(string)",documentation:"Converts the string to uppercase."},{label:"tolower",detail:"tolower(string)",documentation:"Converts the string to lowercase."},{label:"substr",detail:"substr(string1, x), or substr(string1, x, y)",documentation:"Returns a substring from the index specified by the number argument to the end of the string. If the function has a second number argument, it contains the length of the substring to be retrieved."},{label:"replace",detail:"replace(string1, string2, string3)",documentation:"Replaces all instances of string2 in string1 with string3."},{label:"strcontains",detail:"strcontains(string1, string2)",documentation:"Returns 1 if string1 contains string2 and 0 otherwise."}],Gr=[{label:"bin",detail:"bin(period)",documentation:"Rounds the value of @timestamp to the given period and then truncates."},{label:"datefloor",detail:"datefloor(a, period)",documentation:"Truncates the timestamp to the given period."},{label:"dateceil",detail:"dateceil(a, period)",documentation:"Rounds up the timestamp to the given period and then truncates."},{label:"fromMillis",detail:"fromMillis(fieldname)",documentation:"Interprets the input field as the number of milliseconds since the Unix epoch and converts it to a timestamp."},{label:"toMillis",detail:"toMillis(fieldname)",documentation:"Converts the timestamp found in the named field into a number representing the milliseconds since the Unix epoch."}],ar=[{label:"isValidIp",detail:"isValidIp(fieldname)",documentation:"Returns true if the field is a valid v4 or v6 IP address."},{label:"isValidIpV4",detail:"isValidIpV4(fieldname)",documentation:"Returns true if the field is a valid v4 IP address."},{label:"isValidIpV6",detail:"isValidIpV6(fieldname)",documentation:"Returns true if the field is a valid v6 IP address."},{label:"isIpInSubnet",detail:"isIpInSubnet(fieldname, string)",documentation:"Returns true if the field is a valid v4 or v6 IP address within the specified v4 or v6 subnet."},{label:"isIpv4InSubnet",detail:"isIpv4InSubnet(fieldname, string)",documentation:"Returns true if the field is a valid v4 IP address within the specified v4 subnet."},{label:"isIpv6InSubnet",detail:"isIpv6InSubnet(fieldname, string)",documentation:"Returns true if the field is a valid v6 IP address within the specified v6 subnet."}],Kr=[{label:"ispresent",detail:"ispresent(fieldname)",documentation:"Returns true if the field exists."},{label:"isempty",detail:"isempty(fieldname)",documentation:"Returns true if the field is missing or is an empty string."},{label:"isblank",detail:"isblank(fieldname)",documentation:"Returns true if the field is missing, an empty string, or contains only white space."},{label:"strcontains",detail:"strcontains(string1, string2)",documentation:"Returns 1 if string1 contains string2 and 0 otherwise."},...ar],Br=[{label:"avg",detail:"avg(NumericFieldname)",documentation:"The average of the values in the specified field."},{label:"count",detail:"count(fieldname) or count(*)",documentation:"Counts the log records."},{label:"count_distinct",detail:"count_distinct(fieldname)",documentation:"Returns the number of unique values for the field."},{label:"max",detail:"max(fieldname)",documentation:"The maximum of the values for this log field in the queried logs."},{label:"min",detail:"min(fieldname)",documentation:"The minimum of the values for this log field in the queried logs."},{label:"pct",detail:"pct(fieldname, value)",documentation:"A percentile indicates the relative standing of a value in a datas."},{label:"stddev",detail:"stddev(NumericFieldname)",documentation:"The standard deviation of the values in the specified field."},{label:"sum",detail:"sum(NumericFieldname)",documentation:"The sum of the values in the specified field."}],Vs=[{label:"earliest",detail:"earliest(fieldname)",documentation:"Returns the value of fieldName from the log event that has the earliest time stamp in the queried logs."},{label:"latest",detail:"latest(fieldname)",documentation:"Returns the value of fieldName from the log event that has the latest time stamp in the queried logs."},{label:"sortsFirst",detail:"sortsFirst(fieldname)",documentation:"Returns the value of fieldName that sorts first in the queried logs."},{label:"sortsLast",detail:"sortsLast(fieldname)",documentation:"Returns the value of fieldName that sorts last in the queried logs."}],js=[...Br,...Vs],Hr=["as","like","by","in","desc","asc"],Vr=[...Wr,...Hs,...Ur,...Gr,...ar],jr=[...Vr,...js],$s={comment:{pattern:/^#.*/,greedy:!0},backticks:{pattern:/`.*?`/,alias:"string",greedy:!0},quote:{pattern:/".*?"/,alias:"string",greedy:!0},regex:{pattern:/\/.*?\/(?=\||\s*$|,)/,greedy:!0},"query-command":{pattern:new RegExp(`\\b(?:${ir.map(t=>t.label).join("|")})\\b`,"i"),alias:"function"},function:{pattern:new RegExp(`\\b(?:${jr.map(t=>t.label).join("|")})\\b`,"i")},keyword:{pattern:new RegExp(`(\\s+)(${Hr.join("|")})(?=\\s+)`,"i"),lookbehind:!0},"field-name":{pattern:/(@?[_a-zA-Z]+[_.0-9a-zA-Z]*)|(`((\\`)|([^`]))*?`)/,greedy:!0},number:/\b-?\d+((\.\d*)?([eE][+-]?\d+)?)?\b/,"command-separator":{pattern:/\|/,alias:"punctuation"},"comparison-operator":{pattern:/([<>]=?)|(!?=)/},punctuation:/[{}()`,.]/,whitespace:/\s+/};var f=m(21397),O=m(97969);const or=t=>({comment:{pattern:/^#.*/,greedy:!0},backticks:{pattern:/`.*?`/,alias:"string",greedy:!0},quote:{pattern:/[\"'].*?[\"']/,alias:"string",greedy:!0},regex:{pattern:/\/.*?\/(?=\||\s*$|,)/,greedy:!0},...t,"field-name":{pattern:/(@?[_a-zA-Z]+[_.0-9a-zA-Z]*)|(`((\\`)|([^`]))*?`)/,greedy:!0},number:/\b-?\d+((\.\d*)?([eE][+-]?\d+)?)?\b/,"command-separator":{pattern:/\|/,alias:"punctuation"},"comparison-operator":{pattern:/([<>]=?)|(!?=)/},punctuation:/[{}()`,.]/,whitespace:/\s+/}),ks={...or({"query-command":{pattern:new RegExp(`\\b(?:${ir.map(t=>t.label).join("|")})\\b`,"i"),alias:"function"},function:{pattern:new RegExp(`\\b(?:${jr.map(t=>t.label).join("|")})\\b`,"i")},keyword:{pattern:new RegExp(`(\\s+)(${Hr.join("|")})(?=\\s+)`,"i"),lookbehind:!0}})},Qs={...or({"query-command":{pattern:new RegExp(`\\b(?:${O.PPL_COMMANDS.join("|")})\\b`,"i"),alias:"function"},function:{pattern:new RegExp(`\\b(?:${O.ALL_FUNCTIONS.join("|")})\\b`,"i")},keyword:{pattern:new RegExp(`(\\s+)(${O.ALL_KEYWORDS.join("|")})(?=\\s+)`,"i"),lookbehind:!0},operator:{pattern:new RegExp(`\\b(?:${O.PPL_OPERATORS.map(t=>`\\${t}`).join("|")})\\b`,"i")}})},Ys={...or({function:{pattern:new RegExp(`\\b(?:${f.ALL_FUNCTIONS.join("|")})\\b(?!\\.)`,"i")},keyword:{pattern:new RegExp(`\\b(?:${f.ALL_KEYWORDS.join("|")})\\b(?=\\s)`,"i"),lookbehind:!0},operator:{pattern:new RegExp(`\\b(?:${f.ALL_OPERATORS.map(t=>`\\${t}`).join("|")})\\b`,"i")}})},zs=[{category:"General queries",examples:_s},{category:"Lambda",examples:Ps},{category:"VPC Flow Logs",examples:Ws},{category:"CloudTrail Logs",examples:Us},{category:"NAT Gateway",examples:Gs},{category:"AWS App Sync",examples:Ks},{category:"IOT queries",examples:Bs}];function Xs(t,e,r=T._M.CWLI){const s=tn(r),i=(0,j.R)(b().tokenize(t,s)).filter(o=>typeof o!="string").map((o,c)=>(0,a.jsx)("span",{className:`prism-token token ${o.types.join(" ")} ${o.aliases.join(" ")}`,children:o.content},`${e}-token-${c}`));return(0,a.jsx)("div",{className:"slate-query-field",children:i})}const Zs=t=>{const[e,r]=(0,A.useState)(!1);return(0,a.jsx)(G.S,{label:t.label,isOpen:e,onToggle:r,collapsible:!0,children:t.children},t.key)},Js=t=>t.queryMode==="Logs",qs=t=>{const e=(0,M.of)(en),r=Js(t.query)&&t.query.queryLanguage||T._M.CWLI,s=(n,i)=>{t.onClickExample({...t.query,refId:t.query.refId??"A",expression:n.expr[r],queryMode:"Logs",region:t.query.region,id:t.query.refId??"A",logGroupNames:"logGroupNames"in t.query?t.query.logGroupNames:[],logGroups:"logGroups"in t.query?t.query.logGroups:[]}),We({queryLanguage:r,queryCategory:i})};return(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:e.heading,children:(0,a.jsx)(Y.E,{variant:"h3",weight:"bold",children:"CloudWatch Logs cheat sheet"})}),zs.map((n,i)=>(0,a.jsx)(Zs,{label:n.category,children:(0,a.jsx)("div",{children:n.examples.map((o,c)=>(0,a.jsx)(a.Fragment,{children:o.expr[r]&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(Y.E,{variant:"h6",weight:"bold",children:o.title}),(0,a.jsx)("button",{type:"button",className:e.cheatSheetExample,onClick:()=>s(o,n.category),children:(0,a.jsx)("pre",{children:Xs(o.expr[r],`item-${c}`,r)})},o.expr[r])]})}))},`cat-${i}`)},n.category)),(0,a.jsxs)("div",{children:["Note: If you are seeing masked data, you may have CloudWatch logs data protection enabled."," ",(0,a.jsx)(B.Y,{href:"https://grafana.com/docs/grafana/latest/datasources/aws-cloudwatch/#cloudwatch-logs-data-protection",external:!0,children:"See documentation for details"}),"."]})]})},en=t=>({heading:(0,C.css)({marginBottom:t.spacing(2)}),cheatSheetExample:(0,C.css)({margin:t.spacing(.5,0),textAlign:"left",border:"none",background:"transparent",display:"block"})}),tn=t=>{switch(t){case T._M.CWLI:return ks;case T._M.PPL:return Qs;case T._M.SQL:return Ys}};var rn=m(40996),sn=m(65074),Et=m(48480),lr=m(17548),cr=m(6370),nn=m(77010),ur=m(78282),Me=m(34999),ht=m(37386),Te=m(63527),$r=m(3271),se=m(2543),ft=m(62467),an=m(44240),He=m(28105),on=m(36580),Ie=m(2863),kr=m(6904),At=m(75686),Ve=m(32300),z=m(30048),dr=m(78246),we=m(35137),ln=m(45214),mr=m(41053),ae=m(47184);const pr=t=>{const[e,r]=(0,A.useState)(!1),[s,n]=(0,A.useState)([{label:"default",value:"default"}]);return(0,A.useEffect)(()=>{r(!0);const i={label:"Template Variables",options:t.getVariables().map(ae.z)};t.resources.getRegions().then(o=>n([...o,i])).finally(()=>r(!1))},[t]),[s,e]},gr=t=>{const[e,r]=(0,A.useState)([]);return(0,A.useEffect)(()=>{t.resources.getNamespaces().then(s=>{r(me(t,s))})},[t]),e},Er=(t,{region:e,namespace:r,accountId:s})=>{const[n,i]=(0,A.useState)([]);return e&&(e=t.templateSrv.replace(e,{})),r&&(r=t.templateSrv.replace(r,{})),s&&(s=t.templateSrv.replace(s,{})),(0,A.useEffect)(()=>{t.resources.getMetrics({namespace:r,region:e,accountId:s}).then(o=>{i(me(t,o))})},[t,e,r,s]),n},Tt=(t,{region:e,namespace:r,metricName:s,dimensionFilters:n,accountId:i})=>{const[o,c]=(0,A.useState)([]);return e&&(e=t.templateSrv.replace(e,{})),r&&(r=t.templateSrv.replace(r,{})),s&&(s=t.templateSrv.replace(s,{})),i&&(i=t.templateSrv.replace(i,{})),n&&(n=t.resources.convertDimensionFormat(n,{},!1)),(0,ln.A)(()=>{t.resources.getDimensionKeys({namespace:r,region:e,metricName:s,accountId:i,dimensionFilters:n},!1).then(u=>{c(me(t,u))})},[t,r,e,s,i,n]),o},It=(t,e)=>{const[r,s]=(0,A.useState)(""),n=t.templateSrv.replace(e);return(0,A.useEffect)(()=>{if(t.resources.isVariableWithMultipleOptionsSelected(e)){const i=`Template variables with multiple selected options are not supported for ${e}`;r!==i&&s(i);return}r&&s("")},[t.resources,e,n,r]),r},Qr=(t,e)=>{const[r,s]=(0,A.useState)(!1);return e&&(e=t.templateSrv.replace(e,{})),(0,A.useEffect)(()=>{_.$.featureToggles.cloudWatchCrossAccountQuerying&&t.isMonitoringAccount(e).then(n=>s(n))},[e,t]),r},wt=(t,e)=>{e&&(e=t?.templateSrv.replace(e,{})??"");const r=async()=>{if(!_.$.featureToggles.cloudWatchCrossAccountQuerying)return Promise.resolve([]);const i=await t?.getAccounts({region:e})??[];if(i.length===0)return[];const o=i.map(E=>({label:E.label,value:E.id,description:E.id})),u={label:"Template Variables",options:t?.getVariables().map(ae.z)||[]};return[...o,u]},[s,n]=(0,mr.A)(r,[t,e]);return(0,A.useEffect)(()=>{n()},[t,e,n]),s};var Yr=m(1667),Ft=m(75349),oe=m(18857);const _t=["Average","Maximum","Minimum","Sum","SampleCount","IQM"],it={label:"All",value:"all",description:"Target all linked accounts"};function hr({accountId:t,onChange:e,accountOptions:r}){const s=(0,A.useMemo)(()=>r.find(n=>n.options?n.options.find(o=>o.value===t):n.value===t),[r,t]);return r.length===0?null:(0,a.jsx)(z.c,{label:"Account",width:26,tooltip:"A CloudWatch monitoring account views data from source accounts so you can centralize monitoring and troubleshooting activities across multiple accounts. Go to the CloudWatch settings page in the AWS console for more details.",children:(0,a.jsx)(oe.l6,{"aria-label":"Account Selection",value:s?t:it.value,options:[it,...r],onChange:({value:n})=>{e(n)}})})}var Pt=m(26774),yt=m(72500),St=m(20301);const zr={value:"*",label:"*"},cn=(t,e)=>Object.entries(t??{}).reduce((r,[s,n])=>s!==e?{...r,[s]:n}:r,{}),un=({filter:t,metricStat:e,datasource:r,disableExpressions:s,onChange:n,onDelete:i})=>{const{region:o,namespace:c,metricName:u,dimensions:E,accountId:l}=e,h=It(r,t.key),p=(0,A.useMemo)(()=>cn(E??{},t.key),[E,t]),I=Tt(r,{...e,dimensionFilters:p}),L=async()=>t.key?r.resources.getDimensionValues({dimensionKey:t.key,dimensionFilters:p,region:o,namespace:c,metricName:u,accountId:l}).then(P=>(P.length&&!s&&!P.some(X=>X.value===zr.value)&&P.unshift(zr),me(r,P))):[],[F,D]=(0,mr.A)(L,[t.key,E,o,c,u,l]),N=(0,M.of)(dn);return(0,a.jsxs)("div",{className:N.container,"data-testid":"cloudwatch-dimensions-filter-item",children:[(0,a.jsxs)(yt.M,{children:[(0,a.jsx)(oe.l6,{"aria-label":"Dimensions filter key",inputId:"cloudwatch-dimensions-filter-item-key",width:"auto",value:t.key?(0,ae.z)(t.key):null,allowCustomValue:!0,options:I,onChange:P=>{P.label&&n({key:P.label,value:void 0})}}),(0,a.jsx)("span",{className:(0,C.cx)(N.root),children:"="}),(0,a.jsx)(oe.l6,{"aria-label":"Dimensions filter value",inputId:"cloudwatch-dimensions-filter-item-value",onOpenMenu:D,width:"auto",value:t.value?(0,ae.z)(t.value):null,allowCustomValue:!0,isLoading:F.loading,options:F.value,onChange:P=>{P.value&&n({...t,value:P.value})}}),(0,a.jsx)(St.Z,{"aria-label":"remove",icon:"times",variant:"secondary",onClick:i,type:"button"})]}),h&&(0,a.jsx)(Me.F,{className:N.alert,title:h,severity:"error",topSpacing:1})]})},dn=t=>({root:(0,C.css)({padding:t.spacing(0,1),alignSelf:"center"}),container:(0,C.css)({display:"inline-block"}),alert:(0,C.css)({minWidth:"100%",width:"min-content"})}),mn=t=>Object.entries(t??{}).reduce((e,[r,s])=>{if(!s)return e;let n="";if(typeof s=="string"?n=s:Array.isArray(s)&&typeof s[0]=="string"&&(n=s[0]),!n)return e;const i={key:r,value:n,operator:"="};return[...e,i]},[]),pn=t=>t.reduce((e,{key:r,value:s})=>r&&s?{...e,[r]:s}:e,{}),Xr=({metricStat:t,datasource:e,disableExpressions:r,onChange:s})=>{const n=(0,A.useMemo)(()=>mn(t.dimensions),[t.dimensions]),[i,o]=(0,A.useState)(n),c=u=>{o(u);const E=pn(u);(0,se.isEqual)(E,t.dimensions)||s(E)};return(0,a.jsx)(Pt.o,{items:i,onChange:c,renderItem:gn(e,t,r)})};function gn(t,e,r){function s(n,i,o){return(0,a.jsx)(un,{filter:n,onChange:c=>i(c),datasource:t,metricStat:e,disableExpressions:r,onDelete:o})}return s}const En=/^(p|tm|tc|ts|wm)\d{2}(?:\.\d{1,2})?$/,hn="\\d*(\\.\\d+)?%?:\\d*(\\.\\d+)?%?",fn=new RegExp(`^(PR|TM|TC|TS|WM)\\((${hn})\\)$`),Zr=({refId:t,metricStat:e,datasource:r,disableExpressions:s=!1,onChange:n})=>{const i=gr(r),o=Er(r,e),c=wt(r.resources,e.region);(0,A.useEffect)(()=>{r.resources.isMonitoringAccount(e.region).then(l=>{l&&!c.loading&&c.value?.length&&!e.accountId&&n({...e,accountId:"all"}),!c.loading&&c.value&&!c.value.length&&e.accountId&&n({...e,accountId:void 0})})},[c,e,n,r.resources]);const u=async l=>{const h=await E(l);n(h)},E=async l=>{let{metricName:h,namespace:p,region:I}=l;return h?(await r.resources.getMetrics({namespace:p,region:I}).then(L=>{L.find(F=>F.value===h)||(h="")}),{...l,metricName:h}):l};return(0,a.jsxs)(Yr.D,{children:[(0,a.jsxs)(Ve.U,{children:[!s&&_.$.featureToggles.cloudWatchCrossAccountQuerying&&(0,a.jsx)(hr,{accountId:e.accountId,onChange:l=>{n({...e,accountId:l})},accountOptions:c?.value||[]}),(0,a.jsxs)(Ft.B,{children:[(0,a.jsx)(z.c,{label:"Namespace",width:26,children:(0,a.jsx)(oe.l6,{"aria-label":"Namespace",value:e?.namespace&&Re(e.namespace),allowCustomValue:!0,options:i,onChange:({value:l})=>{l&&u({...e,namespace:l})}})}),(0,a.jsx)(z.c,{label:"Metric name",width:16,children:(0,a.jsx)(oe.l6,{"aria-label":"Metric name",value:e?.metricName&&Re(e.metricName),allowCustomValue:!0,options:o,onChange:({value:l})=>{l&&n({...e,metricName:l})}})}),(0,a.jsx)(z.c,{label:"Statistic",width:16,children:(0,a.jsx)(oe.l6,{inputId:`${t}-metric-stat-editor-select-statistic`,allowCustomValue:!0,value:Re(e.statistic??_t[0]),options:me(r,_t.filter(l=>l!==e.statistic).map(Re)),onChange:({value:l})=>{!l||!_t.includes(l)&&!(En.test(l)||fn.test(l))&&!r.templateSrv.containsTemplate(l)||n({...e,statistic:l})}})})]})]}),(0,a.jsxs)(Ve.U,{children:[(0,a.jsx)(z.c,{label:"Dimensions",children:(0,a.jsx)(Xr,{metricStat:e,onChange:l=>n({...e,dimensions:l}),disableExpressions:s,datasource:r})}),!s&&(0,a.jsx)(z.c,{label:"Match exact",optional:!0,tooltip:(0,a.jsxs)(a.Fragment,{children:["Only show metrics that contain exactly the dimensions defined in the query and match the specified values. If this is enabled, all dimensions of the metric being queried must be specified so that the ",(0,a.jsx)(B.Y,{href:"https://docs.aws.amazon.com/AmazonCloudWatch/latest/monitoring/search-expression-syntax.html",external:!0,children:"metric schema"})," matches exactly. If this is disabled, metrics that match the schema and have additional dimensions will also be returned."]}),tooltipInteractive:!0,children:(0,a.jsx)(dr.C,{id:`${t}-cloudwatch-match-exact`,value:!!e.matchExact,onChange:l=>{n({...e,matchExact:l.currentTarget.checked})}})})]})]})},An=t=>{const{query:e,onChange:r,datasource:s}=t,[n,i]=pr(s);return le(e)?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(kr.X,{children:(0,a.jsx)(At.W,{label:"Region",value:n.find(o=>o.value===e.region),placeholder:"Select region",allowCustomValue:!0,onChange:({value:o})=>o&&r({...e,region:o}),options:n,isLoading:i})}),(0,a.jsx)(we.$,{v:.5}),(0,a.jsx)(Zr,{...t,refId:e.refId,metricStat:e,disableExpressions:!0,onChange:o=>r({...e,...o})}),(0,a.jsx)(we.$,{v:.5}),(0,a.jsxs)(Ve.U,{children:[(0,a.jsx)(z.c,{label:"Period",width:26,tooltip:"Minimum interval between points in seconds.",children:(0,a.jsx)(Te.p,{value:e.period||"",placeholder:"auto",onChange:o=>r({...e,period:o.target.value})})}),(0,a.jsx)(z.c,{label:"Enable Prefix Matching",optional:!0,children:(0,a.jsx)(dr.C,{value:e.prefixMatching,onChange:o=>{r({...e,prefixMatching:o.currentTarget.checked})}})}),(0,a.jsx)(z.c,{label:"Action",optional:!0,disabled:!e.prefixMatching,children:(0,a.jsx)(Te.p,{value:e.actionPrefix||"",onChange:o=>r({...e,actionPrefix:o.target.value})})}),(0,a.jsx)(z.c,{label:"Alarm Name",optional:!0,disabled:!e.prefixMatching,children:(0,a.jsx)(Te.p,{value:e.alarmNamePrefix||"",onChange:o=>r({...e,alarmNamePrefix:o.target.value})})})]})]}):(0,a.jsx)(Me.F,{severity:"error",title:"Invalid annotation query",topSpacing:2,children:JSON.stringify(e,null,4)})},Jr={queryMode:"Metrics",namespace:"",metricName:"",expression:"",dimensions:{},region:"default",id:"",statistic:"Average",period:"",metricQueryType:T.d$.Search,metricEditorMode:T.Rx.Builder,sql:void 0,sqlExpression:"",matchExact:!0},fr={queryMode:"Annotations",namespace:"",region:"default",statistic:"Average"},Tn=`fields @timestamp, @message |
sort @timestamp desc |
limit 20`,In="fields `@timestamp`, `@message`\n| sort - `@timestamp`\n| head 25s",yn="SELECT `@timestamp`, `@message`\nFROM `log_group`\nORDER BY `@timestamp` DESC\nLIMIT 25;",Sn=(t,e)=>({id:"",region:"default",logGroupNames:e,logGroups:t??[],queryLanguage:T._M.CWLI}),Rn={queryType:T.b4.Regions,region:"default"},Cn={prepareAnnotation:t=>ye(t)?t:{datasource:t.datasource,enable:t.enable,iconColor:t.iconColor,name:t.name,builtIn:t.builtIn,hide:t.hide,target:{...t.target,...t,statistic:t.statistic||fr.statistic,region:t.region||fr.region,queryMode:"Annotations",refId:t.refId||"annotationQuery"}},prepareQuery:t=>{if(!t.target)return;const{prefixMatching:e,actionPrefix:r,alarmNamePrefix:s,statistic:n,namespace:i,metricName:o}=t.target;if(!!e&&!!r&&!!s||!e&&!!i&&!!o&&!!n)return t.target},getDefaultQuery(){return fr},QueryEditor:An};var qr=m(75505),et=m(59258);const es=/\$(\w+)|\[\[(\w+?)(?::(\w+))?\]\]|\${(\w+)(?:\.([^:^\}]+))?(?::([^\}]+))?}/g,Ln=t=>(es.lastIndex=0,es.exec(t)),Wt=t=>{const e=Ln(t);return e?e.slice(1).find(s=>s!==void 0):null},Ar=(t,e,r,s)=>{s=s??"value";const n=s==="value"?"pipe":"text";let i=[];for(const o of e){const c=Wt(o),u=t.getVariables().find(({name:E})=>E===c);if(u&&"current"in u&&On(u.current)){const E=u.current[s];if(Array.isArray(E)){const l=n==="text"?" + ":"|";i.push(...t.replace(o,r,n).split(l))}else typeof E=="string"&&i.push(t.replace(o,r,n))}else i.push(o)}return i},ts=(t,e)=>{const r=Wt(e);return t.getVariables().some(({name:s})=>s===r)},On=t=>t.hasOwnProperty("value")&&t.hasOwnProperty("text"),Ut=async(t,e,r,s)=>{if(t.length===0)return[];const n=Ar(r,t.map(o=>o.name),{},"text"),i=await Promise.all(n.map(o=>s.getLogGroupFields(e,o).then(c=>c.filter(u=>u).map(u=>u.value.name??""))));return[...new Set(i.flat())]};class Nn extends w.Is{constructor(e,r){super(),this.started=!1,this.cleanText=s=>s.replace(/[()]/g,"").trim(),this.request=(s,n)=>(0,qr.s)(this.datasource.logsQueryRunner.awsRequest(s,n)),this.start=()=>(this.startTask||(this.startTask=Promise.resolve().then(()=>(this.started=!0,[]))),this.startTask),this.handleKeyword=async s=>{const n=await this.getFieldCompletionItems(s?.logGroups,s?.region||"default"),i=[{searchFunctionType:et.T.Prefix,label:"Functions",items:Ur.concat(Gr,ar)}];return n.suggestions.push(...i),n},this.handleCommand=async(s,n,i)=>{const o=s.content.toLowerCase(),c=at(n),u=c===s;if(o==="sort")return this.handleSortCommand(u,n,i);if(o==="parse"&&u)return await this.getFieldCompletionItems(i?.logGroups??[],i?.region||"default");const E=je(s.next,"whitespace")&&!s.next?.next,l=E||vn(s)===n,h=je(n,"punctuation",","),p=h||je(c,"punctuation",",");if(!(l||p))return{suggestions:[]};if(["display","fields"].includes(o)){const I=await this.getFieldCompletionItems(i?.logGroups??[],i?.region||"default");return I.suggestions.push(...this.getFieldAndFilterFunctionCompletionItems().suggestions),I}if(o==="stats"){const I=this.getStatsAggCompletionItems();return(h||E)&&I?.suggestions.forEach(L=>{L.skipFilter=!0}),I}if(o==="filter"&&u){const I=await this.getFieldCompletionItems(i?.logGroups,i?.region||"default"),L=this.getBoolFuncCompletionItems();return I.suggestions.push(...L.suggestions),I}return{suggestions:[]}},this.handleComparison=async s=>{const n=await this.getFieldCompletionItems(s?.logGroups,s?.region||"default"),i=this.getComparisonCompletionItems();return n.suggestions.push(...i.suggestions),n},this.getCommandCompletionItems=()=>({suggestions:[{searchFunctionType:et.T.Prefix,label:"Commands",items:ir}]}),this.getFieldAndFilterFunctionCompletionItems=()=>({suggestions:[{searchFunctionType:et.T.Prefix,label:"Functions",items:Vr}]}),this.getStatsAggCompletionItems=()=>({suggestions:[{searchFunctionType:et.T.Prefix,label:"Functions",items:Br}]}),this.getBoolFuncCompletionItems=()=>({suggestions:[{searchFunctionType:et.T.Prefix,label:"Functions",items:Kr}]}),this.getComparisonCompletionItems=()=>({suggestions:[{searchFunctionType:et.T.Prefix,label:"Functions",items:Wr.concat(Kr)}]}),this.getFieldCompletionItems=async(s,n)=>s?{suggestions:[{label:"Fields",items:(await Ut(s,n,this.templateSrv,this.datasource.resources)).map(o=>({label:o,insertText:o.match(/@?[_a-zA-Z]+[_.0-9a-zA-Z]*/)?void 0:`\`${o}\``}))}]}:{suggestions:[]},this.datasource=e,this.templateSrv=r??(0,Ie.w)()}getSyntax(){return $s}isStatsQuery(e){const r=this.getSyntax();return!!(b().tokenize(e,r)??[]).find(n=>typeof n!="string"&&n.content.toString().toLowerCase()==="stats"&&n.type==="query-command")}async provideCompletionItems(e,r){const{value:s}=e,n=s?.data.get("tokens");if(!n||!n.length)return{suggestions:[]};const i=n.filter(l=>l.offsets&&l.offsets.start<=s.selection?.start?.offset&&l.offsets.end>=s.selection?.start?.offset)[0],o=!i.prev,c=at(i);if(o||!o&&c?.types.includes("command-separator"))return this.getCommandCompletionItems();if(Dn(i))return await this.getFieldCompletionItems(r?.logGroups,r?.region||"default");if(Mn("by",i))return this.handleKeyword(r);if(c?.types.includes("comparison-operator"))return this.handleComparison(r);const E=xn(i);return E?await this.handleCommand(E,i,r):{suggestions:[]}}async handleSortCommand(e,r,s){return e?await this.getFieldCompletionItems(s?.logGroups,s?.region||"default"):je(at(r),"field-name")?{suggestions:[{searchFunctionType:et.T.Prefix,label:"Sort Order",items:[{label:"asc"},{label:"desc"}]}]}:{suggestions:[]}}}function vn(t){let e=t;for(;e.next;)if(e.next.types.includes("whitespace"))e=e.next;else return e.next;return null}function at(t){let e=t;for(;e.prev;)if(je(e.prev,"whitespace"))e=e.prev;else return e.prev;return null}function xn(t){let e=t;for(;e.prev;)if(e=e.prev,e.types.includes("query-command")&&(!e.prev||je(at(e),"command-separator")))return e;return null}const bn=["avg","count","count_distinct","earliest","latest","sortsFirst","sortsLast","max","min","pct","stddev","ispresent","fromMillis","toMillis","isempty","isblank","isValidIp","isValidIpV4","isValidIpV6","isIpInSubnet","isIpv4InSubnet","isIpv6InSubnet"].map(t=>t.toLowerCase());function Dn(t){const e=at(t);if(!e)return!1;const r=t.content==="("?t:e.content==="("?e:void 0;if(r){const s=at(r);if(s)return bn.includes(s.content.toLowerCase())&&s.types.includes("function")}return!1}function Mn(t,e){const r=rs(e,["whitespace","function","punctuation","field-name","number"]);if(je(r,"keyword","by")){const s=rs(e,["whitespace"]);if(s===r||je(s,"punctuation",","))return!0}return!1}function je(t,e,r){return!(!t?.types.includes(e)||r&&t?.content.toLowerCase()!==r)}function rs(t,e){let r=t.prev;e:for(;r;){for(const s of e)if(typeof s=="string"){if(r.types.includes(s)){r=r.prev;continue e}}else if(r.types.includes(s.type)&&r.content.toLowerCase()===s.value){r=r.prev;continue e}break}return r}class wn{constructor(e,r,s,n,i,o){this.type=e,this.value=r,this.range=s,this.previous=n,this.next=i,this.tokenTypes=o}isKeyword(){return this.type===this.tokenTypes.Keyword}isWhiteSpace(){return this.type===this.tokenTypes.Whitespace}isParenthesis(){return this.type===this.tokenTypes.Parenthesis}isIdentifier(){return this.type===this.tokenTypes.Identifier}isString(){return this.type===this.tokenTypes.String}isDoubleQuotedString(){return this.type===this.tokenTypes.Type}isVariable(){return this.type===this.tokenTypes.Variable}isFunction(){return this.type===this.tokenTypes.Function}isNumber(){return this.type===this.tokenTypes.Number}is(e,r){const s=this.type===e;return r!==void 0?s&&this.value===r:s}endsWith(e){return this.value===e||this.value[this.value.length-1]===e}getPreviousNonWhiteSpaceToken(){let e=this.previous;for(;e!=null;){if(!e.isWhiteSpace())return e;e=e.previous}return null}getPreviousOfType(e,r){let s=this.previous;for(;s!=null;){const n=s.type===e;if(r!==void 0?n&&s.value===r:n)return s;s=s.previous}return null}getPreviousUntil(e,r,s){let n=[],i=this.previous;for(;i!=null;){if(r.some(c=>c===i?.type)){i=i.previous;continue}const o=i.type===e;if(s!==void 0?o&&i.value===s:o)return n;i.isWhiteSpace()||n.push(i),i=i.previous}return n}getNextUntil(e,r,s){let n=[],i=this.next;for(;i!=null;){if(r.some(c=>c===i?.type)){i=i.next;continue}const o=i.type===e;if(s!==void 0?o&&i.value===s:o)return n;i.isWhiteSpace()||n.push(i),i=i.next}return n}getPreviousKeyword(){let e=this.previous;for(;e!=null;){if(e.isKeyword())return e;e=e.previous}return null}getNextNonWhiteSpaceToken(){let e=this.next;for(;e!=null;){if(!e.isWhiteSpace())return e;e=e.next}return null}getNextOfType(e,r){let s=this.next;for(;s!=null;){const n=s.type===e;if(r!==void 0?n&&s.value===r:n)return s;s=s.next}return null}}function ss(t,e,r,s,n){let i=null,o=null;const c=t.editor.tokenize(r.getValue()??"",e.id);for(let u=0;u<c.length;u++){const E=c[u];if(!E.length&&o){const l={offset:0,type:n.Whitespace,language:e.id,_tokenBrand:void 0};E.push(l)}for(let l=0;l<E.length;l++){const h=E[l];let p=E.length>l+1?E[l+1].offset+1:r.getLineLength(u+1)+1;const I={startLineNumber:u+1,startColumn:h.offset===0?0:h.offset+1,endLineNumber:u+1,endColumn:p},L=r.getValueInRange(I),F=new wn(h.type,L,I,o,null,n);t.Range.containsPosition(I,s)&&(i=F),o&&(o.next=F),o=F}}return i}var d=(t=>(t[t.Unknown=0]="Unknown",t[t.SelectKeyword=1]="SelectKeyword",t[t.AfterSelectKeyword=2]="AfterSelectKeyword",t[t.SelectExpression=3]="SelectExpression",t[t.AfterSelectExpression=4]="AfterSelectExpression",t[t.AfterSelectFuncFirstArgument=5]="AfterSelectFuncFirstArgument",t[t.PredefinedFunctionArgument=6]="PredefinedFunctionArgument",t[t.FromKeyword=7]="FromKeyword",t[t.AfterFrom=8]="AfterFrom",t[t.AfterFromKeyword=9]="AfterFromKeyword",t[t.AfterFromArguments=10]="AfterFromArguments",t[t.SchemaFuncFirstArgument=11]="SchemaFuncFirstArgument",t[t.SchemaFuncExtraArgument=12]="SchemaFuncExtraArgument",t[t.WhereKey=13]="WhereKey",t[t.WhereComparisonOperator=14]="WhereComparisonOperator",t[t.WhereValue=15]="WhereValue",t[t.AfterWhereValue=16]="AfterWhereValue",t[t.HavingKey=17]="HavingKey",t[t.HavingComparisonOperator=18]="HavingComparisonOperator",t[t.HavingValue=19]="HavingValue",t[t.AfterHavingValue=20]="AfterHavingValue",t[t.CaseKey=21]="CaseKey",t[t.CaseComparisonOperator=22]="CaseComparisonOperator",t[t.CaseValue=23]="CaseValue",t[t.AfterCaseValue=24]="AfterCaseValue",t[t.WhenKey=25]="WhenKey",t[t.WhenComparisonOperator=26]="WhenComparisonOperator",t[t.WhenValue=27]="WhenValue",t[t.AfterWhenValue=28]="AfterWhenValue",t[t.ThenExpression=29]="ThenExpression",t[t.AfterThenExpression=30]="AfterThenExpression",t[t.AfterElseKeyword=31]="AfterElseKeyword",t[t.OnKey=32]="OnKey",t[t.OnComparisonOperator=33]="OnComparisonOperator",t[t.OnValue=34]="OnValue",t[t.AfterOnValue=35]="AfterOnValue",t[t.AfterGroupByKeywords=36]="AfterGroupByKeywords",t[t.AfterGroupBy=37]="AfterGroupBy",t[t.AfterOrderByKeywords=38]="AfterOrderByKeywords",t[t.AfterOrderByFunction=39]="AfterOrderByFunction",t[t.AfterOrderByDirection=40]="AfterOrderByDirection",t[t.Subquery=41]="Subquery",t[t.PredefinedFunction=42]="PredefinedFunction",t[t.SearchFuncSecondArg=43]="SearchFuncSecondArg",t[t.SearchFuncThirdArg=44]="SearchFuncThirdArg",t[t.PredefinedFuncSecondArg=45]="PredefinedFuncSecondArg",t[t.AfterFunction=46]="AfterFunction",t[t.WithinString=47]="WithinString",t[t.NewCommand=48]="NewCommand",t[t.Comment=49]="Comment",t[t.DedupKeyword=50]="DedupKeyword",t[t.AfterDedupKeyword=51]="AfterDedupKeyword",t[t.DisplayKeyword=52]="DisplayKeyword",t[t.AfterDisplayKeyword=53]="AfterDisplayKeyword",t[t.FieldsKeyword=54]="FieldsKeyword",t[t.AfterFieldsKeyword=55]="AfterFieldsKeyword",t[t.FilterKeyword=56]="FilterKeyword",t[t.AfterFilterKeyword=57]="AfterFilterKeyword",t[t.FilterArg=58]="FilterArg",t[t.LimitKeyword=59]="LimitKeyword",t[t.AfterLimitKeyword=60]="AfterLimitKeyword",t[t.ParseKeyword=61]="ParseKeyword",t[t.AfterParseKeyword=62]="AfterParseKeyword",t[t.SortKeyword=63]="SortKeyword",t[t.AfterSortKeyword=64]="AfterSortKeyword",t[t.SortArg=65]="SortArg",t[t.StatsKeyword=66]="StatsKeyword",t[t.AfterStatsKeyword=67]="AfterStatsKeyword",t[t.AsKeyword=68]="AsKeyword",t[t.AfterAsKeyword=69]="AfterAsKeyword",t[t.ByKeyword=70]="ByKeyword",t[t.AfterByKeyword=71]="AfterByKeyword",t[t.InKeyword=72]="InKeyword",t[t.AfterInKeyword=73]="AfterInKeyword",t[t.LikeKeyword=74]="LikeKeyword",t[t.AfterLikeKeyword=75]="AfterLikeKeyword",t[t.Function=76]="Function",t[t.FunctionArg=77]="FunctionArg",t[t.CommandArg=78]="CommandArg",t[t.AfterCommand=79]="AfterCommand",t[t.ArithmeticOperator=80]="ArithmeticOperator",t[t.ArithmeticOperatorArg=81]="ArithmeticOperatorArg",t[t.BooleanOperator=82]="BooleanOperator",t[t.BooleanOperatorArg=83]="BooleanOperatorArg",t[t.ComparisonOperator=84]="ComparisonOperator",t[t.ComparisonOperatorArg=85]="ComparisonOperatorArg",t[t.BeforeLogicalExpression=86]="BeforeLogicalExpression",t[t.AfterArithmeticOperator=87]="AfterArithmeticOperator",t[t.AfterINKeyword=88]="AfterINKeyword",t[t.SortField=89]="SortField",t[t.AfterHeadCommand=90]="AfterHeadCommand",t[t.AfterFieldsCommand=91]="AfterFieldsCommand",t[t.FieldList=92]="FieldList",t[t.AfterDedupFieldNames=93]="AfterDedupFieldNames",t[t.AfterStatsCommand=94]="AfterStatsCommand",t[t.StatsFunctionArgument=95]="StatsFunctionArgument",t[t.AfterStatsBy=96]="AfterStatsBy",t[t.AfterBooleanArgument=97]="AfterBooleanArgument",t[t.EvalClause=98]="EvalClause",t[t.Expression=99]="Expression",t[t.SortFieldExpression=100]="SortFieldExpression",t))(d||{}),g=(t=>(t[t.SelectKeyword=0]="SelectKeyword",t[t.AfterSelectKeyword=1]="AfterSelectKeyword",t[t.AfterSelectExpression=2]="AfterSelectExpression",t[t.FunctionsWithArguments=3]="FunctionsWithArguments",t[t.Metrics=4]="Metrics",t[t.FromKeyword=5]="FromKeyword",t[t.AfterFromKeyword=6]="AfterFromKeyword",t[t.AfterFromArguments=7]="AfterFromArguments",t[t.JoinKeywords=8]="JoinKeywords",t[t.HavingKeywords=9]="HavingKeywords",t[t.SchemaKeyword=10]="SchemaKeyword",t[t.Namespaces=11]="Namespaces",t[t.LabelKeys=12]="LabelKeys",t[t.WhereKeyword=13]="WhereKeyword",t[t.GroupByKeywords=14]="GroupByKeywords",t[t.OrderByKeywords=15]="OrderByKeywords",t[t.FunctionsWithoutArguments=16]="FunctionsWithoutArguments",t[t.LimitKeyword=17]="LimitKeyword",t[t.SortOrderDirectionKeyword=18]="SortOrderDirectionKeyword",t[t.ComparisonOperators=19]="ComparisonOperators",t[t.LabelValues=20]="LabelValues",t[t.LogicalOperators=21]="LogicalOperators",t[t.CaseKeyword=22]="CaseKeyword",t[t.WhenKeyword=23]="WhenKeyword",t[t.ThenKeyword=24]="ThenKeyword",t[t.AfterThenExpression=25]="AfterThenExpression",t[t.KeywordArguments=26]="KeywordArguments",t[t.Operators=27]="Operators",t[t.Statistic=28]="Statistic",t[t.Period=29]="Period",t[t.Command=30]="Command",t[t.Function=31]="Function",t[t.InKeyword=32]="InKeyword",t[t.BooleanFunction=33]="BooleanFunction",t[t.LogicalExpression=34]="LogicalExpression",t[t.ValueExpression=35]="ValueExpression",t[t.FieldOperators=36]="FieldOperators",t[t.Field=37]="Field",t[t.BooleanLiteral=38]="BooleanLiteral",t[t.DedupParameter=39]="DedupParameter",t[t.StatsParameter=40]="StatsParameter",t[t.BooleanArgument=41]="BooleanArgument",t[t.StatsFunctions=42]="StatsFunctions",t[t.SpanClause=43]="SpanClause",t[t.SortFunctions=44]="SortFunctions",t))(g||{}),$=(t=>(t.High="a",t.MediumHigh="d",t.Medium="g",t.MediumLow="k",t.Low="q",t))($||{});class Rt{constructor(e,r=(0,Ie.w)()){this.resources=e,this.templateSrv=r,this.templateSrv=r,this.tokenTypes={Parenthesis:"delimiter.parenthesis",Whitespace:"white",Keyword:"keyword",Delimiter:"delimiter",Operator:"operator",Identifier:"identifier",Type:"type",Function:"predefined",Number:"number",String:"string",Variable:"variable",Comment:"comment",Regexp:"regexp"}}getStatementPosition(e){return d.Unknown}getSuggestionKinds(e){return[]}getSuggestions(e,r,s,n,i){return Promise.reject([])}getCompletionProvider(e,r){const s=r.id===O.CLOUDWATCH_PPL_LANGUAGE_DEFINITION_ID;return{triggerCharacters:[" ","$",",","(","'"].concat(s?["`"]:[]),provideCompletionItems:async(i,o)=>{const c=ss(e,r,i,o,this.tokenTypes),u=this.getStatementPosition(c),E=this.getSuggestionKinds(u);return{suggestions:await this.getSuggestions(e,c,E,u,o)}}}}}const v={id:"editor.action.triggerSuggest",title:""},he="cloudwatch-logs-sql",Tr={id:he,extensions:[],aliases:[],mimetypes:[],loader:()=>Promise.resolve().then(m.bind(m,21397))},k={Parenthesis:`delimiter.parenthesis.${he}`,Whitespace:`white.${he}`,Keyword:`keyword.${he}`,Delimiter:`delimiter.${he}`,Operator:`operator.${he}`,Identifier:`identifier.${he}`,Type:`type.${he}`,Function:`predefined.${he}`,Number:`number.${he}`,String:`string.${he}`,Variable:`variable.${he}`,Comment:`comment.${he}`,Regexp:`regexp.${he}`};function Fn(t){const e=t?.getPreviousNonWhiteSpaceToken(),r=t?.getPreviousKeyword(),s=e?.value?.toUpperCase()||"",n=r?.value?.toUpperCase()||"";let i=r,o=n;for(;o===f.AS;)i=i?.getPreviousKeyword(),o=i?.value.toUpperCase()||"";const c=o===f.SELECT||[f.ALL,f.DISTINCT].includes(o)&&i?.getPreviousKeyword()?.value.toUpperCase()===f.SELECT;if(t?.is(k.Comment)||t?.is("comment.quote.cloudwatch-logs-sql"))return d.Comment;if(t===null||t.previous===null&&t.isIdentifier()||t.previous===null&&t.isWhiteSpace()||t.previous===null&&t.isKeyword()&&t.value.toUpperCase()===f.SELECT)return d.SelectKeyword;if((t.isWhiteSpace()||t.is(k.Parenthesis,")"))&&s===f.SELECT)return d.AfterSelectKeyword;if(c&&(t.is(k.Delimiter,",")||t.isWhiteSpace()&&e?.is(k.Delimiter,",")||t.isWhiteSpace()&&e?.isKeyword()||t.is(k.Parenthesis,")")&&(e?.isKeyword()||e?.is(k.Delimiter,","))))return d.SelectExpression;if(c&&(t.isWhiteSpace()||t.is(k.Parenthesis,")"))&&(e?.isIdentifier()||e?.is(k.Parenthesis,")")||e?.is(k.Parenthesis,"()")||e?.is(k.Operator,"*")))return d.AfterSelectExpression;if(t.is(k.Parenthesis,"()")&&o===f.WHERE&&s===f.IN)return d.Subquery;if((t.is(k.Parenthesis,"()")||t.is(k.Parenthesis,"())"))&&e?.isFunction()||t.is(k.Delimiter,",")&&t.getPreviousOfType(k.Parenthesis,"(")?.getPreviousNonWhiteSpaceToken()?.isFunction()||t.isWhiteSpace()&&e?.is(k.Delimiter,",")&&t.getPreviousOfType(k.Parenthesis,"(")?.getPreviousNonWhiteSpaceToken()?.isFunction()||t.is(k.Parenthesis,")")&&e?.is(k.Delimiter,",")&&t.getPreviousOfType(k.Parenthesis,"(")?.getPreviousNonWhiteSpaceToken()?.isFunction())return d.PredefinedFunctionArgument;if((t.isWhiteSpace()||t.is(k.Parenthesis,")"))&&s===f.FROM)return d.AfterFromKeyword;if(o===f.FROM&&(e?.isIdentifier()||e?.isDoubleQuotedString()||e?.isVariable()||e?.is(k.Parenthesis,")")))return d.AfterFromArguments;if(f.LOGICAL_OPERATORS.includes(s)&&[f.WHERE,f.HAVING,f.ON,f.CASE,f.WHEN].includes(n)||(t.isWhiteSpace()||t.is(k.Parenthesis,")"))&&[f.WHERE,f.HAVING,f.ON,f.CASE,f.WHEN].includes(s))switch(n){case f.WHERE:return d.WhereKey;case f.HAVING:return d.HavingKey;case f.ON:return d.OnKey;case f.CASE:return d.CaseKey;case f.WHEN:return d.WhenKey}if(f.LOGICAL_OPERATORS.includes(s)&&[f.NULL,f.TRUE,f.FALSE].includes(n)||(t.isWhiteSpace()||t.is(k.Parenthesis,")"))&&[f.NULL,f.TRUE,f.FALSE].includes(s)){let u=r,E=n;for(;![f.WHERE,f.HAVING,f.ON,f.CASE,f.WHEN].includes(E);)u=u?.getPreviousKeyword(),E=u?.value.toUpperCase()||"";switch(E){case f.WHERE:return d.WhereKey;case f.HAVING:return d.HavingKey;case f.ON:return d.OnKey;case f.CASE:return d.CaseKey;case f.WHEN:return d.WhenKey}}if([f.WHERE,f.HAVING,f.ON,f.CASE,f.WHEN].includes(n)&&f.PREDICATE_OPERATORS.includes(s))switch(n){case f.WHERE:return d.WhereValue;case f.HAVING:return d.HavingValue;case f.ON:return d.OnValue;case f.CASE:return d.CaseValue;case f.WHEN:return d.WhenValue}if([f.NULL,f.TRUE,f.FALSE].includes(n)&&f.PREDICATE_OPERATORS.includes(s)){let u=r,E=n;for(;![f.WHERE,f.HAVING,f.ON,f.CASE,f.WHEN].includes(E);)u=u?.getPreviousKeyword(),E=u?.value.toUpperCase()||"";switch(E){case f.WHERE:return d.WhereValue;case f.HAVING:return d.HavingValue;case f.ON:return d.OnValue;case f.CASE:return d.CaseValue;case f.WHEN:return d.WhenValue}}if([f.WHERE,f.HAVING,f.ON,f.CASE,f.WHEN].includes(n)&&(e?.isIdentifier()||e?.isDoubleQuotedString()||e?.isFunction()||e?.isNumber()||e?.isString()||e?.is(k.Parenthesis,")")||e?.is(k.Parenthesis,"()"))){const u=t.getPreviousUntil(k.Keyword,[],n),E=u?.filter(h=>f.PREDICATE_OPERATORS.includes(h.value.toUpperCase())).length||0,l=u?.filter(h=>f.LOGICAL_OPERATORS.includes(h.value.toUpperCase())).length||0;if(E-l===0)switch(n){case f.WHERE:return d.WhereComparisonOperator;case f.HAVING:return d.HavingComparisonOperator;case f.ON:return d.OnComparisonOperator;case f.CASE:return d.CaseComparisonOperator;case f.WHEN:return d.WhenComparisonOperator}else switch(n){case f.WHERE:return d.AfterWhereValue;case f.HAVING:return d.AfterHavingValue;case f.ON:return d.AfterOnValue;case f.CASE:return d.AfterCaseValue;case f.WHEN:return d.AfterWhenValue}}if([f.NULL,f.TRUE,f.FALSE].includes(n)&&f.PREDICATE_OPERATORS.includes(r?.getPreviousNonWhiteSpaceToken()?.value.toUpperCase()||"")){let u=r?.getPreviousKeyword(),E=u?.value.toUpperCase()||"";for(;![f.WHERE,f.HAVING,f.ON,f.CASE,f.WHEN].includes(E);)u=u?.getPreviousKeyword(),E=u?.value.toUpperCase()||"";const l=t.getPreviousUntil(k.Keyword,[],E),h=l?.filter(I=>f.PREDICATE_OPERATORS.includes(I.value.toUpperCase())).length||0,p=l?.filter(I=>f.LOGICAL_OPERATORS.includes(I.value.toUpperCase())).length||0;if(h-p===0)switch(E){case f.WHERE:return d.WhereComparisonOperator;case f.HAVING:return d.HavingComparisonOperator;case f.ON:return d.OnComparisonOperator;case f.CASE:return d.CaseComparisonOperator;case f.WHEN:return d.WhenComparisonOperator}else switch(E){case f.WHERE:return d.AfterWhereValue;case f.HAVING:return d.AfterHavingValue;case f.ON:return d.AfterOnValue;case f.CASE:return d.AfterCaseValue;case f.WHEN:return d.AfterWhenValue}}if(t.isWhiteSpace()&&s===f.THEN)return d.ThenExpression;if(t.isWhiteSpace()&&n===f.THEN&&s!==f.THEN)return d.AfterThenExpression;if(t.isWhiteSpace()&&s===f.ELSE)return d.AfterElseKeyword;if(s===f.END&&t.isWhiteSpace()){let u=r;for(;f.CASE!==u?.value.toUpperCase();)u=u?.getPreviousKeyword();switch(u.getPreviousKeyword()?.value.toUpperCase()||""){case f.SELECT:return d.AfterSelectExpression;case f.WHERE:return d.AfterWhereValue}}return n===f.BY&&r?.getPreviousKeyword()?.value.toUpperCase()===f.GROUP&&(e?.value.toUpperCase()===f.BY||e?.is(k.Delimiter,","))?d.AfterGroupByKeywords:n===f.BY&&r?.getPreviousKeyword()?.value.toUpperCase()===f.GROUP&&(e?.isIdentifier()||e?.is(k.Parenthesis,")")||e?.is(k.Parenthesis,"()"))?d.AfterGroupBy:n===f.BY&&r?.getPreviousKeyword()?.value.toUpperCase()===f.ORDER?d.AfterOrderByKeywords:[f.DESC,f.ASC].includes(n)?d.AfterOrderByDirection:d.Unknown}function _n(t){switch(t){case d.SelectKeyword:return[g.SelectKeyword];case d.AfterSelectKeyword:return[g.AfterSelectKeyword,g.FunctionsWithArguments,g.Field,g.CaseKeyword];case d.SelectExpression:return[g.FunctionsWithArguments,g.Field,g.CaseKeyword];case d.AfterSelectExpression:return[g.FromKeyword,g.FunctionsWithArguments,g.Field,g.CaseKeyword];case d.FromKeyword:return[g.FromKeyword,g.FunctionsWithArguments,g.Field];case d.AfterFromKeyword:return[g.AfterFromKeyword];case d.AfterFromArguments:return[g.WhereKeyword,g.GroupByKeywords,g.OrderByKeywords,g.LimitKeyword,g.JoinKeywords,g.HavingKeywords];case d.WhereKey:return[g.FunctionsWithArguments,g.Field,g.CaseKeyword];case d.WhereComparisonOperator:return[g.ComparisonOperators];case d.WhereValue:return[g.FunctionsWithArguments,g.Field];case d.AfterWhereValue:return[g.LogicalOperators,g.GroupByKeywords,g.OrderByKeywords,g.LimitKeyword];case d.HavingKey:return[g.FunctionsWithArguments,g.Field];case d.HavingComparisonOperator:return[g.ComparisonOperators];case d.HavingValue:return[g.FunctionsWithArguments,g.Field];case d.AfterHavingValue:return[g.LogicalOperators,g.OrderByKeywords,g.LimitKeyword];case d.OnKey:return[g.FunctionsWithArguments,g.Field];case d.OnComparisonOperator:return[g.ComparisonOperators];case d.OnValue:return[g.FunctionsWithArguments,g.Field];case d.AfterOnValue:return[g.LogicalOperators,g.GroupByKeywords,g.OrderByKeywords,g.LimitKeyword];case d.CaseKey:return[g.WhenKeyword,g.Field,g.FunctionsWithArguments];case d.CaseComparisonOperator:return[g.ComparisonOperators,g.WhenKeyword];case d.CaseValue:return[g.FunctionsWithArguments,g.Field];case d.AfterCaseValue:return[g.WhenKeyword];case d.WhenKey:return[g.Field,g.FunctionsWithArguments];case d.WhenComparisonOperator:return[g.ComparisonOperators,g.ThenKeyword];case d.WhenValue:return[g.FunctionsWithArguments,g.Field];case d.AfterWhenValue:return[g.ThenKeyword];case d.ThenExpression:return[g.FunctionsWithArguments,g.Field];case d.AfterThenExpression:return[g.WhenKeyword,g.AfterThenExpression];case d.AfterElseKeyword:return[g.FunctionsWithArguments,g.Field];case d.AfterGroupByKeywords:return[g.Field,g.FunctionsWithArguments];case d.AfterGroupBy:return[g.OrderByKeywords,g.LimitKeyword,g.HavingKeywords];case d.AfterOrderByKeywords:return[g.SortOrderDirectionKeyword,g.LimitKeyword,g.Field];case d.AfterOrderByDirection:return[g.LimitKeyword];case d.PredefinedFunctionArgument:return[g.Field];case d.Subquery:return[g.SelectKeyword,g.FunctionsWithArguments,g.Field]}return[]}function Pn(t,e=(0,Ie.w)()){return r=>new Wn(t,e,r)}class Wn extends Rt{constructor(e,r=(0,Ie.w)(),s){super(e,r),this.region=e.getActualRegion()??"",this.getStatementPosition=Fn,this.getSuggestionKinds=_n,this.tokenTypes=k,this.queryContext=s}async getSuggestions(e,r,s,n,i){let o=[];const u=r?.isWhiteSpace()||r?.isParenthesis()||!r?.range?e.Range.fromPositions(i):r?.range,E=(h,p={})=>({label:h,insertText:h,kind:e.languages.CompletionItemKind.Field,range:u,sortText:$.Medium,...p});function l(h,p={}){o=[...o,E(h,p)]}for(const h of s)switch(h){case g.SelectKeyword:l(f.SELECT,{insertText:`${f.SELECT} $0`,insertTextRules:e.languages.CompletionItemInsertTextRule.InsertAsSnippet,kind:e.languages.CompletionItemKind.Keyword,command:v});break;case g.AfterSelectKeyword:l(f.ALL,{insertText:`${f.ALL} `,insertTextRules:e.languages.CompletionItemInsertTextRule.InsertAsSnippet,command:v,kind:e.languages.CompletionItemKind.Keyword}),l(f.DISTINCT,{insertText:`${f.DISTINCT} `,insertTextRules:e.languages.CompletionItemInsertTextRule.InsertAsSnippet,command:v,kind:e.languages.CompletionItemKind.Keyword});break;case g.FunctionsWithArguments:f.ALL_FUNCTIONS.map(I=>l(I,{insertText:`${I}($0)`,insertTextRules:e.languages.CompletionItemInsertTextRule.InsertAsSnippet,command:v,kind:e.languages.CompletionItemKind.Function}));break;case g.FromKeyword:l(f.FROM,{insertText:`${f.FROM} $0`,insertTextRules:e.languages.CompletionItemInsertTextRule.InsertAsSnippet,kind:e.languages.CompletionItemKind.Keyword,command:v,sortText:$.MediumHigh}),l(`${f.FROM} \`logGroups(logGroupIdentifier: [...])\``,{insertText:`${f.FROM} \`logGroups(logGroupIdentifier: [$0])\``,insertTextRules:e.languages.CompletionItemInsertTextRule.InsertAsSnippet,kind:e.languages.CompletionItemKind.Keyword,command:v,sortText:$.MediumHigh});break;case g.AfterFromKeyword:l("`logGroups(logGroupIdentifier: [...])`",{insertText:"`logGroups(logGroupIdentifier: [$0])`",insertTextRules:e.languages.CompletionItemInsertTextRule.InsertAsSnippet,kind:e.languages.CompletionItemKind.Function,command:v});break;case g.LogicalOperators:f.LOGICAL_OPERATORS.map(I=>l(`${I}`,{insertText:`${I} `,command:v,sortText:$.MediumHigh}));break;case g.WhereKeyword:l(`${f.WHERE}`,{insertText:`${f.WHERE} `,command:v,sortText:$.High});break;case g.HavingKeywords:l(`${f.HAVING}`,{insertText:`${f.HAVING} `,command:v});break;case g.ComparisonOperators:f.PREDICATE_OPERATORS.map(I=>l(`${I}`,{insertText:`${I} `,command:v}));break;case g.CaseKeyword:l(f.CASE,{insertText:`${f.CASE} `,kind:e.languages.CompletionItemKind.Keyword,command:v});break;case g.WhenKeyword:l(f.WHEN,{insertText:`${f.WHEN} `,kind:e.languages.CompletionItemKind.Keyword,command:v});break;case g.ThenKeyword:l(f.THEN,{insertText:`${f.THEN} `,kind:e.languages.CompletionItemKind.Keyword,command:v});break;case g.AfterThenExpression:l(`${f.ELSE} ... ${f.END}`,{insertText:`${f.ELSE} $0 ${f.END}`,insertTextRules:e.languages.CompletionItemInsertTextRule.InsertAsSnippet,kind:e.languages.CompletionItemKind.Keyword,command:v});break;case g.GroupByKeywords:l(`${f.GROUP} ${f.BY}`,{insertText:`${f.GROUP} ${f.BY} `,command:v,sortText:$.MediumHigh});break;case g.OrderByKeywords:l(`${f.ORDER} ${f.BY}`,{insertText:`${f.ORDER} ${f.BY} `,command:v,sortText:$.Medium});break;case g.JoinKeywords:l(`${f.INNER} ${f.JOIN} <log group> ${f.ON} <field>`,{insertText:`${f.INNER} ${f.JOIN} $1 ${f.ON} $2`,insertTextRules:e.languages.CompletionItemInsertTextRule.InsertAsSnippet,kind:e.languages.CompletionItemKind.Keyword,command:v,sortText:$.MediumLow}),l(`${f.LEFT} ${f.OUTER} ${f.JOIN} <log group> ${f.ON} <field>`,{insertText:`${f.LEFT} ${f.OUTER} ${f.JOIN} $1 ${f.ON} $2`,insertTextRules:e.languages.CompletionItemInsertTextRule.InsertAsSnippet,kind:e.languages.CompletionItemKind.Keyword,command:v,sortText:$.MediumLow});break;case g.LimitKeyword:l(f.LIMIT,{insertText:`${f.LIMIT} `});break;case g.SortOrderDirectionKeyword:[f.ASC,f.DESC].map(I=>l(I,{insertText:`${I} `,command:v}));break;case g.Field:(await Ut(this.queryContext.logGroups||[],this.queryContext.region,this.templateSrv,this.resources)).forEach(I=>{I!==""&&l(I,{label:I,insertText:`\`${I}\``,kind:e.languages.CompletionItemKind.Field})});break}return this.templateSrv.getVariables().map(h=>{const p=`$${h.name}`;l(p,{range:u,label:p,insertText:p,kind:e.languages.CompletionItemKind.Variable,sortText:$.Low})}),o}}const Z={Parenthesis:`delimiter.parenthesis.${O.CLOUDWATCH_PPL_LANGUAGE_DEFINITION_ID}`,Whitespace:`white.${O.CLOUDWATCH_PPL_LANGUAGE_DEFINITION_ID}`,Keyword:`keyword.${O.CLOUDWATCH_PPL_LANGUAGE_DEFINITION_ID}`,Command:`keyword.command.${O.CLOUDWATCH_PPL_LANGUAGE_DEFINITION_ID}`,Delimiter:`delimiter.${O.CLOUDWATCH_PPL_LANGUAGE_DEFINITION_ID}`,Pipe:`delimiter.pipe.${O.CLOUDWATCH_PPL_LANGUAGE_DEFINITION_ID}`,Operator:`operator.${O.CLOUDWATCH_PPL_LANGUAGE_DEFINITION_ID}`,Identifier:`identifier.${O.CLOUDWATCH_PPL_LANGUAGE_DEFINITION_ID}`,Type:`type.${O.CLOUDWATCH_PPL_LANGUAGE_DEFINITION_ID}`,Function:`predefined.${O.CLOUDWATCH_PPL_LANGUAGE_DEFINITION_ID}`,Number:`number.${O.CLOUDWATCH_PPL_LANGUAGE_DEFINITION_ID}`,String:`string.${O.CLOUDWATCH_PPL_LANGUAGE_DEFINITION_ID}`,Variable:`variable.${O.CLOUDWATCH_PPL_LANGUAGE_DEFINITION_ID}`,Comment:`comment.${O.CLOUDWATCH_PPL_LANGUAGE_DEFINITION_ID}`,Regexp:`regexp.${O.CLOUDWATCH_PPL_LANGUAGE_DEFINITION_ID}`,Backtick:`string.backtick.${O.CLOUDWATCH_PPL_LANGUAGE_DEFINITION_ID}`},Un=t=>{const e=t?.getPreviousNonWhiteSpaceToken(),r=t?.getNextNonWhiteSpaceToken(),s=e?.value?.toLowerCase();if(t===null||t?.isWhiteSpace()&&e===null&&r===null||e?.is(Z.Pipe)&&t?.isWhiteSpace()||e?.is(Z.Delimiter,"|"))return d.NewCommand;switch(s){case O.WHERE:return d.BeforeLogicalExpression;case O.DEDUP:return d.FieldList;case O.FIELDS:return d.AfterFieldsCommand;case O.EVENTSTATS:case O.STATS:return d.AfterStatsCommand;case O.SORT:return d.SortField;case O.PARSE:return d.Expression}if(t?.isWhiteSpace()||t?.is(Z.Backtick)||t?.is(Z.Delimiter,",")||t?.is(Z.Parenthesis)){const n=t?.getPreviousOfType(Z.Function)?.value.toLowerCase(),i=t?.getPreviousOfType(Z.Keyword)?.value.toLowerCase(),o=t?.getPreviousOfType(Z.Command)?.value.toLowerCase();if(s){if(o!==O.FIELDS&&o!==O.SORT&&O.ARITHMETIC_OPERATORS.includes(s))return d.AfterArithmeticOperator;if(O.PARAMETERS_WITH_BOOLEAN_VALUES.includes(s))return d.AfterBooleanArgument}const c=s&&(O.COMPARISON_OPERATORS.includes(s)||O.LOGICAL_EXPRESSION_OPERATORS.includes(s))||e?.is(Z.Regexp)||s===O.NOT||n&&O.CONDITION_FUNCTIONS.includes(n)&&s===")";if(o!==O.SORT&&o!==O.EVAL&&o!==O.STATS&&(Kn(t)||t?.is(Z.Backtick)))return d.FieldList;if(o!==O.EVAL&&c)return d.BeforeLogicalExpression;if(i===O.IN)return d.AfterINKeyword;if(i===O.BETWEEN)return d.FunctionArg;if(n&&(t?.is(Z.Parenthesis)||t?.getNextNonWhiteSpaceToken()?.value===")")){if([...O.EVAL_FUNCTIONS,...O.CONDITION_FUNCTIONS].includes(n))return d.FunctionArg;if(O.STATS_FUNCTIONS.includes(n))return d.StatsFunctionArgument;if(O.SORT_FIELD_FUNCTIONS.includes(n))return d.SortFieldExpression}switch(o){case O.SORT:{if(e){if(e.is(Z.Delimiter,","))return d.SortField;if(O.FIELD_OPERATORS.includes(e.value))return d.SortFieldExpression}break}case O.DEDUP:{const u=t.getPreviousUntil(Z.Number,[Z.Delimiter,Z.Whitespace]);return u?.length&&!Gn(u)?d.AfterDedupFieldNames:d.FieldList}case O.FIELDS:return d.FieldList;case O.STATS:case O.EVENTSTATS:return i===O.BY&&t.isWhiteSpace()?d.AfterStatsBy:n===O.SPAN&&t?.is(Z.Parenthesis)?d.FieldList:d.AfterStatsCommand;case O.RARE:return d.FieldList;case O.TOP:return d.FieldList;case O.HEAD:return d.AfterHeadCommand;case O.EVAL:if(e?.value==="=")return d.Expression;if(t?.isWhiteSpace()&&(s===O.EVAL||e?.is(Z.Delimiter,",")))return d.EvalClause;if(c)return d.BeforeLogicalExpression;break}}return d.Unknown},Gn=t=>t?.some(e=>e.type===Z.Pipe),Kn=t=>{const e=t?.getPreviousUntil(Z.Identifier,[Z.Whitespace]),r=t?.getPreviousUntil(Z.Backtick,[Z.Whitespace]),s=e?.length&&e.every(o=>o.is(Z.Delimiter,","))||r?.length&&r.every(o=>o.is(Z.Delimiter,",")),n=t?.isWhiteSpace()&&t?.getPreviousNonWhiteSpaceToken()?.is(Z.Delimiter,","),i=t?.getNextNonWhiteSpaceToken()?.value===")";return n&&s&&!i};function Bn(t){switch(t){case d.NewCommand:return[g.Command];case d.AfterHeadCommand:return[g.FromKeyword];case d.AfterStatsCommand:return[g.StatsParameter,g.StatsFunctions];case d.SortField:return[g.FieldOperators,g.Field,g.SortFunctions];case d.EvalClause:case d.StatsFunctionArgument:return[g.Field];case d.AfterFieldsCommand:return[g.FieldOperators,g.Field];case d.FieldList:return[g.Field];case d.AfterBooleanArgument:return[g.BooleanLiteral];case d.AfterDedupFieldNames:return[g.DedupParameter];case d.AfterStatsBy:return[g.Field,g.SpanClause];case d.SortFieldExpression:return[g.Field,g.SortFunctions];case d.FunctionArg:case d.AfterArithmeticOperator:case d.AfterINKeyword:return[g.ValueExpression];case d.Expression:case d.BeforeLogicalExpression:return[g.LogicalExpression,g.ValueExpression]}return[]}function Hn(t,e=(0,Ie.w)()){return r=>new Vn(t,e,r)}class Vn extends Rt{constructor(e,r=(0,Ie.w)(),s){super(e,r),this.getStatementPosition=Un,this.getSuggestionKinds=Bn,this.tokenTypes=Z,this.queryContext=s}async getSuggestions(e,r,s,n,i){const o=[],u=r?.isWhiteSpace()||r?.isParenthesis()||r?.is(Z.Backtick)||!r?.range?e.Range.fromPositions(i):r?.range;function E(h,p={}){return{label:h,insertText:h,kind:e.languages.CompletionItemKind.Field,range:u,sortText:$.Medium,...p}}function l(h,p={}){o.push(E(h,p))}for(const h of s)switch(h){case g.Command:O.PPL_COMMANDS.forEach(p=>{l(p,{insertText:`${p} $0`,insertTextRules:e.languages.CompletionItemInsertTextRule.InsertAsSnippet,kind:e.languages.CompletionItemKind.Method,command:v})});break;case g.LogicalExpression:O.CONDITION_FUNCTIONS.forEach(p=>{l(p,{insertText:`${p}($0)`,insertTextRules:e.languages.CompletionItemInsertTextRule.InsertAsSnippet,kind:e.languages.CompletionItemKind.Function,command:v})}),l(O.NOT,{insertText:`${O.NOT} $0`,insertTextRules:e.languages.CompletionItemInsertTextRule.InsertAsSnippet,kind:e.languages.CompletionItemKind.Operator,command:v});break;case g.ValueExpression:O.EVAL_FUNCTIONS.forEach(p=>{l(p,{insertText:`${p}($0)`,insertTextRules:e.languages.CompletionItemInsertTextRule.InsertAsSnippet,kind:e.languages.CompletionItemKind.Function,command:v})}),await this.addFieldSuggestions(l,e,u,r);break;case g.FieldOperators:O.FIELD_OPERATORS.forEach(p=>{l(p,{insertText:`${p}$0`,insertTextRules:e.languages.CompletionItemInsertTextRule.InsertAsSnippet,kind:e.languages.CompletionItemKind.Operator,command:v})});break;case g.BooleanLiteral:O.BOOLEAN_LITERALS.forEach(p=>l(`= ${p}`,{insertText:`= ${p} $0`,insertTextRules:e.languages.CompletionItemInsertTextRule.InsertAsSnippet,kind:e.languages.CompletionItemKind.Value,command:v}));break;case g.DedupParameter:O.DEDUP_PARAMETERS.forEach(p=>l(p,{insertText:`${p} $0`,insertTextRules:e.languages.CompletionItemInsertTextRule.InsertAsSnippet,kind:e.languages.CompletionItemKind.Property,command:v}));break;case g.StatsParameter:O.STATS_PARAMETERS.forEach(p=>{l(p,{insertText:`${p} $0`,insertTextRules:e.languages.CompletionItemInsertTextRule.InsertAsSnippet,kind:e.languages.CompletionItemKind.Property,command:v})});break;case g.StatsFunctions:O.STATS_FUNCTIONS.forEach(p=>{l(p,{insertText:`${p}($0)`,insertTextRules:e.languages.CompletionItemInsertTextRule.InsertAsSnippet,kind:e.languages.CompletionItemKind.Function,command:v})});break;case g.LogicalOperators:O.LOGICAL_EXPRESSION_OPERATORS.forEach(p=>{l(p,{insertText:`${p} $0`,insertTextRules:e.languages.CompletionItemInsertTextRule.InsertAsSnippet,kind:e.languages.CompletionItemKind.Operator,command:v})});break;case g.InKeyword:l(O.IN,{insertText:`${O.IN} $0`,insertTextRules:e.languages.CompletionItemInsertTextRule.InsertAsSnippet,kind:e.languages.CompletionItemKind.Keyword,command:v});break;case g.SpanClause:l(O.SPAN,{insertText:`${O.SPAN}($0)`,insertTextRules:e.languages.CompletionItemInsertTextRule.InsertAsSnippet,kind:e.languages.CompletionItemKind.Function,command:v});break;case g.Field:await this.addFieldSuggestions(l,e,u,r);break;case g.FromKeyword:l(O.FROM,{insertText:`${O.FROM} $0`,insertTextRules:e.languages.CompletionItemInsertTextRule.InsertAsSnippet,kind:e.languages.CompletionItemKind.Keyword,command:v});break;case g.SortFunctions:O.SORT_FIELD_FUNCTIONS.forEach(p=>{l(p,{insertText:`${p}($0)`,insertTextRules:e.languages.CompletionItemInsertTextRule.InsertAsSnippet,kind:e.languages.CompletionItemKind.Function,command:v})});break}return this.templateSrv.getVariables().map(h=>{const p=`$${h.name}`;l(p,{range:u,label:p,insertText:p,kind:e.languages.CompletionItemKind.Variable,sortText:$.Low})}),o}async addFieldSuggestions(e,r,s,n){if(this.queryContext.logGroups&&this.queryContext.logGroups.length>0)try{(await Ut(this.queryContext.logGroups,this.queryContext.region,this.templateSrv,this.resources)).forEach(o=>{o!==""&&e(o,{range:s,label:o,insertText:n?.is(Z.Backtick)?o:`\`${o}\``,kind:r.languages.CompletionItemKind.Field,sortText:$.High})})}catch{return}}}var x=m(58969);const Q={Parenthesis:"delimiter.parenthesis.sql",Whitespace:"white.sql",Keyword:"keyword.sql",Delimiter:"delimiter.sql",Operator:"operator.sql",Identifier:"identifier.sql",Type:"type.sql",Function:"predefined.sql",Number:"number.sql",String:"string.sql",Variable:"variable.sql",Comment:"comment.sql",Regexp:"regexp.sql"};function jn(t){const e=t?.getPreviousNonWhiteSpaceToken(),r=t?.getPreviousKeyword(),s=t?.getPreviousNonWhiteSpaceToken()?.is(Q.Operator,"/");return t===null||t.isWhiteSpace()&&t.previous===null||t.is(Q.Keyword,x.SELECT)&&t.previous===null||s||t.isIdentifier()&&(s||t?.previous===null)?d.SelectKeyword:e?.value===x.SELECT?d.AfterSelectKeyword:(e?.is(Q.Parenthesis,"(")||t?.is(Q.Parenthesis,"()"))&&r?.value===x.SELECT?d.AfterSelectFuncFirstArgument:r?.value===x.SELECT&&e?.isParenthesis()?d.FromKeyword:e?.value===x.FROM?d.AfterFromKeyword:(e?.is(Q.Parenthesis,"(")||t?.is(Q.Parenthesis,"()"))&&r?.value===x.SCHEMA?d.SchemaFuncFirstArgument:r?.value===x.SCHEMA&&e?.is(Q.Delimiter,",")?d.SchemaFuncExtraArgument:r?.value===x.FROM&&e?.isDoubleQuotedString()||r?.value===x.FROM&&e?.isVariable()||r?.value===x.SCHEMA&&e?.is(Q.Parenthesis,")")?d.AfterFrom:r?.value===x.WHERE&&(e?.isKeyword()||e?.is(Q.Parenthesis,"(")||e?.is(Q.Operator,x.AND))?d.WhereKey:r?.value===x.WHERE&&(e?.isIdentifier()||e?.isDoubleQuotedString())?d.WhereComparisonOperator:r?.value===x.WHERE&&(e?.is(Q.Operator,x.EQUALS)||e?.is(Q.Operator,x.NOT_EQUALS))?d.WhereValue:r?.value===x.WHERE&&(e?.isString()||e?.is(Q.Parenthesis,")"))?d.AfterWhereValue:r?.is(Q.Keyword,x.BY)&&r?.getPreviousKeyword()?.is(Q.Keyword,x.GROUP)&&(e?.is(Q.Keyword,x.BY)||e?.is(Q.Delimiter,","))?d.AfterGroupByKeywords:r?.is(Q.Keyword,x.BY)&&r?.getPreviousKeyword()?.is(Q.Keyword,x.GROUP)&&(e?.isIdentifier()||e?.isDoubleQuotedString())?d.AfterGroupBy:e?.is(Q.Keyword,x.BY)&&e?.getPreviousKeyword()?.is(Q.Keyword,x.ORDER)?d.AfterOrderByKeywords:r?.is(Q.Keyword,x.BY)&&r?.getPreviousKeyword()?.is(Q.Keyword,x.ORDER)&&e?.is(Q.Parenthesis)&&e?.getPreviousNonWhiteSpaceToken()?.is(Q.Function)?d.AfterOrderByFunction:r?.is(Q.Keyword,x.DESC)||r?.is(Q.Keyword,x.ASC)?d.AfterOrderByDirection:d.Unknown}function $n(t){switch(t){case d.SelectKeyword:return[g.SelectKeyword];case d.AfterSelectKeyword:return[g.FunctionsWithArguments];case d.AfterSelectFuncFirstArgument:return[g.Metrics];case d.AfterFromKeyword:return[g.Namespaces,g.SchemaKeyword];case d.SchemaFuncFirstArgument:return[g.Namespaces];case d.SchemaFuncExtraArgument:return[g.LabelKeys];case d.FromKeyword:return[g.FromKeyword];case d.AfterFrom:return[g.WhereKeyword,g.GroupByKeywords,g.OrderByKeywords,g.LimitKeyword];case d.WhereKey:return[g.LabelKeys];case d.WhereComparisonOperator:return[g.ComparisonOperators];case d.WhereValue:return[g.LabelValues];case d.AfterWhereValue:return[g.LogicalOperators,g.GroupByKeywords,g.OrderByKeywords,g.LimitKeyword];case d.AfterGroupByKeywords:return[g.LabelKeys];case d.AfterGroupBy:return[g.OrderByKeywords,g.LimitKeyword];case d.AfterOrderByKeywords:return[g.FunctionsWithoutArguments];case d.AfterOrderByFunction:return[g.SortOrderDirectionKeyword,g.LimitKeyword];case d.AfterOrderByDirection:return[g.LimitKeyword]}return[]}const ns=t=>t?.getPreviousOfType(Q.Keyword,x.SELECT)??null,kn=t=>{const e=ns(t)?.getNextNonWhiteSpaceToken();return e?.isVariable()||e?.isFunction()?e:null},Ir=t=>{const e=kn(t)?.next?.next;return e?.isVariable()||e?.isIdentifier()?e:null},Qn=t=>ns(t)?.getNextOfType(Q.Keyword,x.FROM),yr=t=>{const r=Qn(t)?.getNextNonWhiteSpaceToken();if(r?.isDoubleQuotedString()||r?.isVariable()&&r?.value.toUpperCase()!==x.SCHEMA)return r;if(r?.isKeyword()&&r.next?.is(Q.Parenthesis,"(")){const s=r.next?.next;if(s?.isDoubleQuotedString()||s?.isVariable())return s}return null};class Yn extends Rt{constructor(e,r=(0,Ie.w)()){super(e,r),this.region=e.getActualRegion()??"",this.getStatementPosition=jn,this.getSuggestionKinds=$n,this.tokenTypes=Q}setRegion(e){this.region=e}async getSuggestions(e,r,s,n,i){let o=[];const u=r?.isWhiteSpace()||r?.isParenthesis()||!r?.range?e.Range.fromPositions(i):r?.range,E=(h,p={})=>({label:h,insertText:h,kind:e.languages.CompletionItemKind.Field,range:u,sortText:$.Medium,...p});function l(h,p={}){o=[...o,E(h,p)]}for(const h of s)switch(h){case g.SelectKeyword:l(x.SELECT,{insertText:`${x.SELECT} $0`,insertTextRules:e.languages.CompletionItemInsertTextRule.InsertAsSnippet,kind:e.languages.CompletionItemKind.Keyword,command:v});break;case g.FunctionsWithArguments:x.STATISTICS.map(L=>l(L,{insertText:`${L}($0)`,insertTextRules:e.languages.CompletionItemInsertTextRule.InsertAsSnippet,command:v,kind:e.languages.CompletionItemKind.Function}));break;case g.FunctionsWithoutArguments:x.STATISTICS.map(L=>l(L,{insertText:`${L}() `,insertTextRules:e.languages.CompletionItemInsertTextRule.InsertAsSnippet,command:v,kind:e.languages.CompletionItemKind.Function}));break;case g.Metrics:{const L=yr(r);if(L?.value)(await this.resources.getMetrics({namespace:L?.value.replace(/\"/g,""),region:this.region})).forEach(D=>D.value&&l(D.value));else{const F=await this.resources.getAllMetrics({region:this.region});(0,se.uniq)(F.map(D=>D.metricName)).forEach(D=>D&&l(D,{insertText:D}))}}break;case g.FromKeyword:l(x.FROM,{insertText:`${x.FROM} `,command:v});break;case g.SchemaKeyword:l(x.SCHEMA,{sortText:$.High,insertText:`${x.SCHEMA}($0)`,insertTextRules:e.languages.CompletionItemInsertTextRule.InsertAsSnippet,command:v,kind:e.languages.CompletionItemKind.Function});break;case g.Namespaces:const p=Ir(r);let I=[];if(p?.value){const L=await this.resources.getMetrics({region:this.region}),F=this.templateSrv.replace(p.value);I=L.filter(D=>D.metricName===F).map(D=>D.namespace)}else I=(await this.resources.getNamespaces()).map(F=>F.value);I.map(L=>l(`"${L}"`,{insertText:`"${L}"`}));break;case g.LabelKeys:{const L=Ir(r),F=yr(r);if(F?.value){let D={},N;n===d.SchemaFuncExtraArgument?N=F?.getNextUntil(this.tokenTypes.Parenthesis,[this.tokenTypes.Delimiter,this.tokenTypes.Whitespace]):n===d.AfterGroupByKeywords&&(N=r?.getPreviousUntil(this.tokenTypes.Keyword,[this.tokenTypes.Delimiter,this.tokenTypes.Whitespace])),D=(N||[]).reduce((X,de)=>({...X,[de.value]:null}),{}),(await this.resources.getDimensionKeys({namespace:this.templateSrv.replace(F.value.replace(/\"/g,"")),region:this.templateSrv.replace(this.region),metricName:L?.value,dimensionFilters:D},!1)).map(X=>{const de=/[\s\.-]/.test(X.value??"")?`"${X.value}"`:X.value;de&&l(de)})}}break;case g.LabelValues:{const L=yr(r),F=Ir(r),D=r?.getPreviousNonWhiteSpaceToken()?.getPreviousNonWhiteSpaceToken();L?.value&&D?.value&&F?.value&&(await this.resources.getDimensionValues({region:this.region,namespace:L.value.replace(/\"/g,""),metricName:F.value,dimensionKey:D.value})).map(P=>l(`'${P.value}'`,{insertText:`'${P.value}' `,command:v}))}break;case g.LogicalOperators:x.LOGICAL_OPERATORS.map(L=>l(`${L}`,{insertText:`${L} `,command:v,sortText:$.MediumHigh}));break;case g.WhereKeyword:l(`${x.WHERE}`,{insertText:`${x.WHERE} `,command:v,sortText:$.High});break;case g.ComparisonOperators:x.COMPARISON_OPERATORS.map(L=>l(`${L}`,{insertText:`${L} `,command:v}));break;case g.GroupByKeywords:l(`${x.GROUP} ${x.BY}`,{insertText:`${x.GROUP} ${x.BY} `,command:v,sortText:$.MediumHigh});break;case g.OrderByKeywords:l(`${x.ORDER} ${x.BY}`,{insertText:`${x.ORDER} ${x.BY} `,command:v,sortText:$.Medium});break;case g.LimitKeyword:l(x.LIMIT,{insertText:`${x.LIMIT} `,sortText:$.MediumLow});break;case g.SortOrderDirectionKeyword:[x.ASC,x.DESC].map(L=>l(L,{insertText:`${L} `,command:v}));break}return this.templateSrv.getVariables().map(h=>{const p=`$${h.name}`;l(p,{range:u,label:p,insertText:p,kind:e.languages.CompletionItemKind.Variable,sortText:$.Low})}),o}}var J=m(44419);const fe="cloudwatch-logs",Sr={id:fe,extensions:[],aliases:[],mimetypes:[],loader:()=>Promise.resolve().then(m.bind(m,44419))},pe={Parenthesis:`delimiter.parenthesis.${fe}`,Whitespace:`white.${fe}`,Keyword:`keyword.${fe}`,Delimiter:`delimiter.${fe}`,Operator:`operator.${fe}`,Identifier:`identifier.${fe}`,Type:`type.${fe}`,Function:`predefined.${fe}`,Number:`number.${fe}`,String:`string.${fe}`,Variable:`variable.${fe}`,Comment:`comment.${fe}`,Regexp:`regexp.${fe}`},zn=t=>{const e=t?.getPreviousNonWhiteSpaceToken(),r=t?.getNextNonWhiteSpaceToken(),s=t?.value?.toLowerCase(),n=e?.value?.toLowerCase();if(t?.is(pe.Comment))return d.Comment;if(t?.isFunction())return d.Function;if(t===null||t?.isWhiteSpace()&&e===null&&r===null||e?.is(pe.Delimiter,"|")&&t?.isWhiteSpace()||t?.isIdentifier()&&(e?.is(pe.Delimiter,"|")||e===null))return d.NewCommand;if(t?.is(pe.Delimiter,")")||t?.isWhiteSpace()&&e?.is(pe.Delimiter,")")){const o=t?.getPreviousOfType(pe.Delimiter,"(")?.getPreviousNonWhiteSpaceToken()?.value?.toLowerCase();if(o){if(J.LOGS_COMMANDS.includes(o))return d.AfterCommand;if(J.LOGS_FUNCTION_OPERATORS.includes(o))return d.AfterFunction}}if(t?.isKeyword()&&s)switch(s){case J.DEDUP:return d.DedupKeyword;case J.DISPLAY:return d.DisplayKeyword;case J.FIELDS:return d.FieldsKeyword;case J.FILTER:return d.FilterKeyword;case J.LIMIT:return d.LimitKeyword;case J.PARSE:return d.ParseKeyword;case J.STATS:return d.StatsKeyword;case J.SORT:return d.SortKeyword;case"as":return d.AsKeyword;case"by":return d.ByKeyword;case"in":return d.InKeyword;case"like":return d.LikeKeyword}if(t?.isWhiteSpace()&&e?.isKeyword&&n)switch(n){case J.DEDUP:return d.AfterDedupKeyword;case J.DISPLAY:return d.AfterDisplayKeyword;case J.FIELDS:return d.AfterFieldsKeyword;case J.FILTER:return d.AfterFilterKeyword;case J.LIMIT:return d.AfterLimitKeyword;case J.PARSE:return d.AfterParseKeyword;case J.STATS:return d.AfterStatsKeyword;case J.SORT:return d.AfterSortKeyword;case"as":return d.AfterAsKeyword;case"by":return d.AfterByKeyword;case"in":return d.AfterInKeyword;case"like":return d.AfterLikeKeyword}if(t?.is(pe.Operator)&&s){if(["+","-","*","/","^","%"].includes(s))return d.ArithmeticOperator;if(["=","!=","<",">","<=",">="].includes(s))return d.ComparisonOperator;if(J.LOGS_LOGIC_OPERATORS.includes(s))return d.BooleanOperator}if(e?.is(pe.Operator)&&n){if(["+","-","*","/","^","%"].includes(n))return d.ArithmeticOperatorArg;if(["=","!=","<",">","<=",">="].includes(n))return d.ComparisonOperatorArg;if(J.LOGS_LOGIC_OPERATORS.includes(n))return d.BooleanOperatorArg}if(t?.isIdentifier()||t?.isNumber()||t?.is(pe.Parenthesis,"()")||t?.is(pe.Delimiter,",")||t?.is(pe.Parenthesis,")")||t?.isWhiteSpace()&&e?.is(pe.Delimiter,",")||t?.isWhiteSpace()&&e?.isIdentifier()||t?.isWhiteSpace()&&e?.isKeyword()&&n&&J.LOGS_COMMANDS.includes(n)){const i=t?.getPreviousOfType(pe.Keyword),o=t?.getPreviousOfType(pe.Function);if(i!==null&&o===null)return i.value===J.SORT?d.SortArg:i.value===J.FILTER?d.FilterArg:d.CommandArg;if(o!==null&&i===null)return d.FunctionArg;if(i!==null&&o!==null){if(i.range.startLineNumber>o.range.startLineNumber||i.range.endColumn>o.range.endColumn)return i.value===J.SORT?d.SortArg:i.value===J.FILTER?d.FilterArg:d.CommandArg;if(o.range.startLineNumber>i.range.startLineNumber||o.range.endColumn>i.range.endColumn)return d.FunctionArg}}return d.Unknown};function Xn(t){switch(t){case d.NewCommand:return[g.Command];case d.AfterSortKeyword:case d.SortArg:return[g.SortOrderDirectionKeyword,g.Function];case d.AfterDisplayKeyword:case d.AfterFieldsKeyword:case d.AfterFilterKeyword:case d.AfterStatsKeyword:case d.AfterLimitKeyword:case d.AfterParseKeyword:case d.AfterDedupKeyword:case d.CommandArg:case d.FunctionArg:case d.ArithmeticOperatorArg:case d.BooleanOperatorArg:case d.ComparisonOperatorArg:return[g.Function];case d.FilterArg:return[g.InKeyword,g.Function]}return[]}function Zn(t,e=(0,Ie.w)()){return r=>new Jn(t,e,r)}class Jn extends Rt{constructor(e,r=(0,Ie.w)(),s){super(e,r),this.getStatementPosition=zn,this.getSuggestionKinds=Xn,this.tokenTypes=pe,this.queryContext=s}async getSuggestions(e,r,s,n,i){const o=[],u=r?.isWhiteSpace()||r?.isParenthesis()||!r?.range?e.Range.fromPositions(i):r?.range;function E(h,p={}){return{label:h,insertText:h,kind:e.languages.CompletionItemKind.Field,range:u,sortText:$.Medium,...p}}function l(h,p={}){o.push(E(h,p))}for(const h of s)switch(h){case g.Command:J.LOGS_COMMANDS.forEach(p=>{l(p,{insertText:`${p} $0`,insertTextRules:e.languages.CompletionItemInsertTextRule.InsertAsSnippet,command:v,kind:e.languages.CompletionItemKind.Method})});break;case g.Function:if(J.LOGS_FUNCTION_OPERATORS.forEach(p=>{l(p,{insertText:`${p}($0)`,insertTextRules:e.languages.CompletionItemInsertTextRule.InsertAsSnippet,command:v,kind:e.languages.CompletionItemKind.Function})}),this.queryContext.logGroups&&this.queryContext.logGroups.length>0){let p=await Ut(this.queryContext.logGroups,this.queryContext.region,this.templateSrv,this.resources);p.push("@log"),p.forEach(I=>{I!==""&&l(I,{range:u,label:I,insertText:I,kind:e.languages.CompletionItemKind.Field,sortText:$.High})})}break;case g.SortOrderDirectionKeyword:J.SORT_DIRECTION_KEYWORDS.forEach(p=>{l(p,{sortText:$.High,kind:e.languages.CompletionItemKind.Operator})});break;case g.InKeyword:l("in []",{insertText:'in ["$0"]',insertTextRules:e.languages.CompletionItemInsertTextRule.InsertAsSnippet,kind:e.languages.CompletionItemKind.Snippet,sortText:$.High});break}return this.templateSrv.getVariables().map(h=>{const p=`$${h.name}`;l(p,{range:u,label:p,insertText:p,kind:e.languages.CompletionItemKind.Variable,sortText:$.Low})}),o}}var Ct=m(49921);const Lt={Parenthesis:"delimiter.parenthesis.cloudwatch-MetricMath",Whitespace:"white.cloudwatch-MetricMath",Keyword:"keyword.cloudwatch-MetricMath",Delimiter:"delimiter.cloudwatch-MetricMath",Operator:"operator.cloudwatch-MetricMath",Identifier:"identifier.cloudwatch-MetricMath",Type:"type.cloudwatch-MetricMath",Function:"predefined.cloudwatch-MetricMath",Number:"number.cloudwatch-MetricMath",String:"string.cloudwatch-MetricMath",Variable:"variable.cloudwatch-MetricMath",Comment:"comment.cloudwatch-MetricMath",Regexp:"regexp.cloudwatch-MetricMath"};function qn(t){const e=t?.getPreviousNonWhiteSpaceToken();if(t&&t.isString())return d.WithinString;if(t&&e){const r=t.getPreviousOfType(Lt.Function),s=e.is(Lt.Delimiter,","),n=r&&r.value==="SEARCH",i=t.getPreviousUntil(Lt.Function,[],"SEARCH")||[];if(n){if(i.filter(({value:c})=>c==="'").length===1)return d.WithinString;const o=e.getPreviousOfType(Lt.Delimiter,",");return o&&o.range.startColumn>r.range.startColumn&&o.range.startLineNumber>=r.range.startLineNumber?d.SearchFuncThirdArg:d.SearchFuncSecondArg}if(!n&&s)return d.PredefinedFuncSecondArg}return e?.endsWith(")")?d.AfterFunction:!t||!t.isString()?d.PredefinedFunction:d.Unknown}function ei(t){switch(t){case d.PredefinedFunction:return[g.FunctionsWithArguments];case d.PredefinedFuncSecondArg:return[g.FunctionsWithArguments,g.KeywordArguments];case d.AfterFunction:return[g.Operators];case d.SearchFuncSecondArg:return[g.Statistic];case d.SearchFuncThirdArg:return[g.Period]}return[]}class ti extends Rt{constructor(e,r=(0,Ie.w)()){super(e,r),this.getStatementPosition=qn,this.getSuggestionKinds=ei,this.tokenTypes=Lt}async getSuggestions(e,r,s,n,i){let o=[];const u=r?.isWhiteSpace()||r?.isParenthesis()||!r?.range?e.Range.fromPositions(i):r?.range,E=(h,p={})=>({label:h,insertText:h,kind:e.languages.CompletionItemKind.Field,range:u,sortText:$.Medium,...p});function l(h,p={}){o=[...o,E(h,p)]}for(const h of s)switch(h){case g.FunctionsWithArguments:Ct.METRIC_MATH_FNS.map(p=>l(p,{insertText:p==="SEARCH"?`${p}('$0')`:`${p}($0)`,insertTextRules:e.languages.CompletionItemInsertTextRule.InsertAsSnippet,command:v,kind:e.languages.CompletionItemKind.Function}));break;case g.KeywordArguments:Ct.METRIC_MATH_KEYWORDS.map(p=>l(p,{insertText:p,command:v,kind:e.languages.CompletionItemKind.Keyword,sortText:$.MediumHigh}));break;case g.Statistic:Ct.METRIC_MATH_STATISTIC_KEYWORD_STRINGS.map(p=>l(p,{insertText:`'${p}', `,command:v}));break;case g.Operators:Ct.METRIC_MATH_OPERATORS.map(p=>l(p,{insertText:`${p} `,command:v}));break;case g.Period:l("$__period_auto",{kind:e.languages.CompletionItemKind.Variable,sortText:"a",detail:"Sets period dynamically to adjust to selected time range."}),Ct.METRIC_MATH_PERIODS.map((p,I)=>l(p.toString(),{kind:e.languages.CompletionItemKind.Value,sortText:String.fromCharCode(97+I)}));break}return this.templateSrv.getVariables().map(h=>{const p=`$${h.name}`;l(p,{range:u,label:p,insertText:p,kind:e.languages.CompletionItemKind.Variable,sortText:$.Low})}),o}}var Gt=m(32899),is=m(68143);const as=(t,e=7e3)=>{const r=(0,se.memoize)((...s)=>(0,se.debounce)(t,e,{leading:!0}),(...s)=>JSON.stringify(s));return(...s)=>r(...s)(...s)};class Kt{constructor(e,r){this.instanceSettings=e,this.dsQueryEndpoint="/api/ds/query",this.debouncedCustomAlert=as(ri),this.templateSrv=r,this.ref=(0,Et.p$)(e)}awsRequest(e,r,s={}){const n={method:"POST",url:e,data:r,headers:s};return(0,is.AI)().fetch(n)}convertDimensionFormat(e,r,s=!0){return Object.entries(e).reduce((n,[i,o])=>{if(i=this.replaceVariableAndDisplayWarningIfMulti(i,r,s,"dimension keys"),Array.isArray(o))return{...n,[i]:o};if(!o)return{...n,[i]:null};const c=this.expandVariableToArray(o,r);return{...n,[i]:c}},{})}expandVariableToArray(e,r){const s=Wt(e),n=this.templateSrv.getVariables().find(({name:i})=>i===s);return s&&n?(n?.type==="custom"||n?.type==="query"||n?.type==="datasource")&&n.multi?this.templateSrv.replace(e,r,"pipe").split("|"):[this.templateSrv.replace(e,r)]:[e]}convertMultiFilterFormat(e,r){return Object.entries(e).reduce((s,[n,i])=>{const o=this.replaceVariableAndDisplayWarningIfMulti(n,{},!0,r);if(!i)return{...s,[o]:null};const c=[],u=i.reduce((E,l)=>{const h=this.expandVariableToArray(l,{});return[...E,...h]},c);return{...s,[o]:u}},{})}isMultiVariable(e){if(e){const s=this.templateSrv.getVariables().find(({name:i})=>i===Wt(e)),n=s?.type;return(n==="custom"||n==="query"||n==="datasource")&&s?.multi}return!1}isVariableWithMultipleOptionsSelected(e,r){return!e||!this.isMultiVariable(e)?!1:this.expandVariableToArray(e,r||{}).length>1}replaceVariableAndDisplayWarningIfMulti(e,r,s,n){return s&&this.isVariableWithMultipleOptionsSelected(e)&&this.debouncedCustomAlert("CloudWatch templating error",`Multi template variables are not supported for ${n||e}`),this.templateSrv.replace(e,r)}getActualRegion(e){return e==="default"||e===void 0||e===""?this.instanceSettings.jsonData.defaultRegion??"":e}getVariables(){return this.templateSrv.getVariables().map(e=>`$${e.name}`)}}const ri=(t,e)=>(0,S.J7)().publish({type:Gt.r1.alertError.name,payload:[t,e]});class si extends Kt{constructor(e,r){super(e,r)}handleAnnotationQuery(e,r,s){return s({...r,targets:e.map(n=>({...n,statistic:this.templateSrv.replace(n.statistic),region:this.templateSrv.replace(this.getActualRegion(n.region)),namespace:this.templateSrv.replace(n.namespace),metricName:this.templateSrv.replace(n.metricName),dimensions:this.convertDimensionFormat(n.dimensions??{},{}),period:n.period??"",actionPrefix:n.actionPrefix??"",alarmNamePrefix:n.alarmNamePrefix??"",type:"annotationQuery",datasource:this.ref}))})}}var os=m(69862),ls=m(65474),ni=m(95864),ii=m(31731),cs=m(1005),Ot=m(81160),ai=m(29405),oi=m(43431),li=m(59099),ci=m(46662),ui=m(69850),Rr=m(88483),Cr=m(67770),di=m(22592);const mi=m(50287),pi="console.aws.amazon.com",gi="console.amazonaws-us-gov.com",Ei="console.amazonaws.cn";function hi(t){let e=pi;return t.startsWith("us-gov-")&&(e=gi),t.startsWith("cn-")&&(e=Ei),`${t}.${e}`}function us(t,e){return`https://${hi(e)}/cloudwatch/home?region=${e}#logs-insights:queryDetail=${mi.stringify(t)}`}async function fi(t,e,r,s,n,i){const o=(u,E)=>r(u,e.scopedVars,!1,E),c=u=>s(u,e.scopedVars);for(const u of t.data){const E=e.targets.find(h=>h.refId===u.refId),l=n(o(E.region??"","region"));for(const h of u.fields)if(h.name==="@xrayTraceId"&&i){n(o(E.region??"","region"));const p=await Ai(i,l);p&&(h.config.links=[p])}else h.config.links=[Ti(E,e.range,l,o,c)]}}async function Ai(t,e){let r;try{r=await(0,ur.l)().get(t)}catch(s){console.error("Could not load linked xray data source, it was probably deleted after it was linked",s);return}return{title:r.name,url:"",internal:{query:{query:"${__value.raw}",queryType:"getTrace",region:e},datasourceUid:t,datasourceName:r.name}}}function Ti(t,e,r,s,n){const i=(t.logGroups??[]).filter(p=>p?.arn).map(p=>(p.arn??"").replace(/:\*$/,"")),o=t.logGroupNames??[],c=i?.length?i:o,u=t.expression?s(t.expression):"",E=c?.flatMap(n),l={end:e.to.toISOString(),start:e.from.toISOString(),timeType:"ABSOLUTE",tz:"UTC",editorString:u,isLiveTail:!1,source:E};return{url:us(l,r),title:"View in CloudWatch console",targetBlank:!0}}function Ii(t,e,r){const s=new Date;let n=0,i,o,c={data:[],errors:[]};const u=E=>Math.pow(2,E)*1e3+Math.random()*100;return new Rr.c(E=>{function l(h){o=t(h).subscribe({next(p){if(p.errors){const{refIdsForRequestsToRetry:I,errorsNotToRetry:L}=yi(p.errors);if(I.length>0&&!r(n,s.valueOf())){c.data=[...c.data,...p.data],c.errors=[...c.errors,...L],i=setTimeout(()=>{n++,l(h.filter(F=>I.includes(F.refId)))},u(n+1));return}}c.data=[...c.data,...p.data],c.errors=[...c.errors,...p.errors&&p.errors.length>0?p.errors:[]],E.next(c),E.complete()},error(p){E.error(p)}})}return l(e),()=>{clearTimeout(i),o.unsubscribe()}})}function yi(t){const e=[],r=[];return t.map(s=>{s?.refId&&(s.message?.includes("LimitExceededException")||s.message?.includes("ThrottlingException"))?e.push(s.refId):r.push(s)}),{refIdsForRequestsToRetry:e,errorsNotToRetry:r}}var Si=m(44838);const Ri=({startPeriod:t=0,endPeriod:e=5e3,step:r=1e3},s=Si.E)=>new Rr.c(n=>{const i={subscriber:n,counter:0,period:t,step:r,endPeriod:e};return n.add(s.schedule(Ci,t,i)),n});function Ci(t){if(!t)return;const{subscriber:e,counter:r,period:s,step:n,endPeriod:i}=t;e.next(r);const o=Math.min(s+n,i);this.schedule({subscriber:e,counter:r+1,period:o,step:n,endPeriod:i},o)}const Li="__log__grafana_internal__",Oi="__logstream__grafana_internal__";class Ni extends Kt{constructor(e,r){super(e,r),this.logQueries={},this.createTimeoutFn=()=>{const s=new Date;return()=>Date.now()>=s.valueOf()+lr.intervalToMs(this.logsTimeout)},this.handleLogQueries=(s,n,i)=>{const c=s.filter(this.filterQuery).map(E=>{const{expression:l,logGroups:h,logGroupNames:p}=this.interpolateLogsQueryVariables(E,n.scopedVars);return{refId:E.refId,region:this.templateSrv.replace(this.getActualRegion(E.region)),queryString:l??"",logGroups:h,logGroupNames:p,queryLanguage:E.queryLanguage}}),u=this.createTimeoutFn();return Ii(E=>this.makeLogActionRequest("StartQuery",E,i,n),c,u).pipe((0,os.Z)(E=>this.getQueryResults({logQueries:s,timeoutFunc:u,queryFn:i,startQueryResponse:E})),(0,os.Z)(E=>(0,ls.H)((async()=>(await fi(E,n,this.replaceVariableAndDisplayWarningIfMulti.bind(this),this.expandVariableToArray.bind(this),this.getActualRegion.bind(this),this.tracingDataSourceUid),E))())))},this.getLogRowContext=async(s,{limit:n=10,direction:i=Cr.ZF.Backward}={},o,c)=>{let u=null,E=null;for(const h of s.dataFrame.fields)if(h.name===Oi){if(u=h,E!==null)break}else if(h.name===Li&&(E=h,u!==null))break;const l={refId:c?.refId||"A",limit:n,startFromHead:i!==Cr.ZF.Backward,region:this.templateSrv.replace(this.getActualRegion(c?.region)),logGroupName:xi(E.values[s.rowIndex]),logStreamName:u.values[s.rowIndex]};return i===Cr.ZF.Backward?l.endTime=s.timeEpochMs:l.startTime=s.timeEpochMs,await(0,qr.s)(this.makeLogActionRequest("GetLogEvents",[l],o))},this.getQueryResults=({logQueries:s,timeoutFunc:n,queryFn:i,startQueryResponse:o})=>o.data.every(c=>[T.YZ.Complete,T.YZ.Cancelled,T.YZ.Failed].includes(c.meta?.custom?.Status))?(0,ft.of)({key:"test-key",state:He.Gu.Done,...o}):this.pollForLogQueryResults(o.data.map(c=>({queryId:c.fields[0].values[0],region:c.meta?.custom?.Region??"default",refId:c.refId,statsGroups:s.find(u=>u.refId===c.refId)?.statsGroups})),n,i,o.errors||[]),this.tracingDataSourceUid=e.jsonData.tracingDatasourceUid,this.logsTimeout=e.jsonData.logsTimeout||"30m"}interpolateLogsQueryVariables(e,r){const s=Ar(this.templateSrv,(e.logGroups||this.instanceSettings.jsonData.logGroups||[]).map(l=>l.arn),r),n=Ar(this.templateSrv,e.logGroupNames||this.instanceSettings.jsonData.defaultLogGroups||[],r,"text"),i=(0,se.uniq)(s).map(l=>({arn:l,name:l})),o=(0,se.uniq)(n),c=(l,h)=>{if(typeof l=="string"&&l.startsWith("arn:")&&l.endsWith(":*")||Array.isArray(l)&&l.every(p=>typeof p=="string"&&p.startsWith("arn:")&&p.endsWith(":*"))){const p=h.name||"",I=this.templateSrv.getVariables().find(({name:F})=>F===p),L=e.expression?.replaceAll(/[\r\n\t\s]+/g,"").includes(`\`logGroups(logGroupIdentifier:[$${p}])\``);if(I&&"current"in I&&"text"in I.current)return Array.isArray(I.current.text)?I.current.text.map(F=>L?`'${F}'`:F).join(","):L?`'${I.current.text}'`:I.current.text}return l},u=e.queryLanguage===T._M.SQL?c:void 0,E=this.templateSrv.replace(e.expression||"",r,u);return{logGroups:i,logGroupNames:o,expression:E}}pollForLogQueryResults(e,r,s,n){this.logQueries={},e.forEach(h=>{this.logQueries[h.refId]={id:h.queryId,region:h.region,statsQuery:(h.statsGroups?.length??0)>0}});const i=Ri({startPeriod:100,endPeriod:1e3,step:300}).pipe((0,ni.H)(h=>this.makeLogActionRequest("GetQueryResults",e,s)),(0,ii.u)(),(0,cs.u)());let o=[];const c=i.pipe((0,Ot.T)(h=>(h.errors&&(o=h.errors),h.data))),u={failures:0,prevRecordsMatched:{}},E=c.pipe((0,ai.S)(({failures:h,prevRecordsMatched:p},I)=>{h++;for(const L of I){const F=L.meta?.stats?.find(D=>D.displayName==="Records scanned")?.value;F>(p[L.refId]??0)&&(h=0),p[L.refId]=F}return{failures:h,prevRecordsMatched:p}},u),(0,Ot.T)(({failures:h})=>h),(0,cs.u)()),l=(0,oi.y)(c,E).pipe((0,li.M)(([h])=>{for(const p of h)[T.YZ.Complete,T.YZ.Cancelled,T.YZ.Failed].includes(p.meta?.custom?.Status)&&this.logQueries.hasOwnProperty(p.refId)&&delete this.logQueries[p.refId]}),(0,Ot.T)(([h,p])=>{const I=[...n,...o];if(r())for(const L of h)(0,se.set)(L,"meta.custom.Status",T.YZ.Cancelled),I.push({message:`Error: Query hit timeout before completing after ${p} attempts, partial results may be shown. To increase the timeout window update your datasource configuration.`,type:w.v2.Timeout,refId:L.refId});return{data:h,key:"test-key",state:h.every(L=>[T.YZ.Complete,T.YZ.Cancelled,T.YZ.Failed].includes(L.meta?.custom?.Status))?He.Gu.Done:He.Gu.Loading,errors:I}}),(0,ci.v)(({state:h})=>h!==He.Gu.Error&&h!==He.Gu.Done,!0));return vi(l,()=>this.stopQueries(s))}stopQueries(e){Object.keys(this.logQueries).length>0&&this.makeLogActionRequest("StopQuery",Object.values(this.logQueries).map(r=>({queryId:r.id,region:r.region,queryString:"",refId:""})),e).pipe((0,ui.j)(()=>{this.logQueries={}}))}makeLogActionRequest(e,r,s,n){const i=n?.range||(0,di.E2)(),o=n?.requestId?`${n?.requestId}-logs`:"",c={...n,range:i,skipQueryCache:!0,requestId:o,interval:n?.interval||"",intervalMs:n?.intervalMs||1,scopedVars:n?.scopedVars||{},timezone:n?.timezone||"",app:n?.app||"",startTime:n?.startTime||0,targets:r.map(u=>({...u,id:"",queryMode:"Logs",refId:u.refId||"A",intervalMs:1,maxDataPoints:1,datasource:this.ref,type:"logAction",subtype:e}))};return s(c)}filterQuery(e){const r=!e.logGroupNames?.length,s=!e.logGroups?.length,n=!e.expression?.length;return!(e.queryLanguage!=="SQL"&&s&&r||n)}}function vi(t,e){return new Rr.c(r=>{const s=t.subscribe({next:n=>r.next(n),error:n=>r.next(n),complete:()=>r.complete()});return()=>{s.unsubscribe(),e()}})}function xi(t){const e=t.lastIndexOf(":");return t.slice(e+1)}var bi=m(66847),Di=m(80011),Mi=m(95004);const wi=({region:t})=>(0,a.jsxs)("p",{children:["Please visit the\xA0",(0,a.jsx)(B.Y,{external:!0,href:`https://${t}.console.aws.amazon.com/servicequotas/home?region=${t}#!/services/monitoring/quotas/L-5E141212`,children:"AWS Service Quotas console"}),"\xA0to request a quota increase or see our\xA0",(0,a.jsx)(B.Y,{external:!0,href:"https://grafana.com/docs/grafana/latest/datasources/cloudwatch/#manage-service-quotas",children:"documentation"}),"\xA0to learn more."]}),Fi=(t,e)=>`Please visit the AWS Service Quotas console at https://${t}.console.aws.amazon.com/servicequotas/home?region=${t}#!/services/monitoring/quotas/L-5E141212 to request a quota increase or see our documentation at https://grafana.com/docs/grafana/latest/datasources/cloudwatch/#manage-service-quotas to learn more. ${e}`,_i=(t,e)=>(0,S.J7)().publish({type:Gt.r1.alertError.name,payload:[`CloudWatch request limit reached in ${e} for data source ${t}`,"",void 0,(0,A.createElement)(wi,{region:e},null)]});class Pi extends Kt{constructor(e,r){super(e,r),this.debouncedThrottlingAlert=as(_i),this.handleMetricQueries=(s,n,i)=>{const o=(0,Di.LE)(Date.now(),{timeZone:n.timezone,format:"Z"}).replace(":",""),c=s.filter(this.filterMetricQuery).map(E=>{const l=Ce(E),h=this.replaceMetricQueryVars(l,n.scopedVars);return{timezoneUTCOffset:o,intervalMs:n.intervalMs,maxDataPoints:n.maxDataPoints,...h,type:"timeSeriesQuery",datasource:this.ref}});if((0,se.isEmpty)(c))return(0,ft.of)({data:[]});const u={...n,requestId:n.requestId+"-metrics",targets:c};return this.performTimeSeriesQuery(u,i)}}interpolateMetricsQueryVariables(e,r){return{alias:this.replaceVariableAndDisplayWarningIfMulti(e.alias,r),metricName:this.replaceVariableAndDisplayWarningIfMulti(e.metricName,r),namespace:this.replaceVariableAndDisplayWarningIfMulti(e.namespace,r),period:this.replaceVariableAndDisplayWarningIfMulti(e.period,r),expression:this.templateSrv.replace(e.expression,r),sqlExpression:this.replaceVariableAndDisplayWarningIfMulti(e.sqlExpression,r),dimensions:this.convertDimensionFormat(e.dimensions??{},r)}}performTimeSeriesQuery(e,r){return r(e).pipe((0,Ot.T)(s=>{const n=s.data||[];return n.forEach(i=>{i.fields.forEach(o=>{o.type===Mi.PU.time&&(o.config.interval=i.meta?.custom?.period*1e3)})}),s.errors?.length&&this.alertOnThrottlingErrors(s.errors,e),{data:n,errors:this.enrichThrottlingErrorMessages(e,s.errors)}}),(0,bi.W)(s=>Array.isArray(s)?(0,ft.of)({data:[],errors:s}):(0,ft.of)({data:[],errors:[{message:s}]})))}enrichThrottlingErrorMessages(e,r){if(!r||r.length===0)return r;const s=[];return r.forEach(n=>{if(n.message&&(/^Throttling:.*/.test(n.message)||/^Rate exceeded.*/.test(n.message))){const i=this.getActualRegion(e.targets.find(o=>o.refId===n.refId)?.region);s.push({...n,message:Fi(i,n.message)})}else s.push(n)}),s}alertOnThrottlingErrors(e,r){if(e.some(n=>n.message&&(/^Throttling:.*/.test(n.message)||/^Rate exceeded.*/.test(n.message)))){const n=e.map(i=>i.refId).filter(i=>i);n.length>0&&Object.values(r.targets).reduce((o,{refId:c,region:u})=>c&&!n.includes(c)||o.includes(u)?o:[...o,u],[]).forEach(o=>{const c=this.getActualRegion(o);c&&this.debouncedThrottlingAlert(this.instanceSettings.name,c)})}}filterMetricQuery(e){return ve(e)}replaceMetricQueryVars(e,r){return e.region=this.templateSrv.replace(this.getActualRegion(e.region),r),e.namespace=this.replaceVariableAndDisplayWarningIfMulti(e.namespace,r,!0,"namespace"),e.metricName=this.replaceVariableAndDisplayWarningIfMulti(e.metricName,r,!0,"metric name"),e.dimensions=this.convertDimensionFormat(e.dimensions??{},r),e.statistic=this.templateSrv.replace(e.statistic,r),e.period=String(this.getPeriod(e,r)),e.id=this.templateSrv.replace(e.id,r),e.expression=this.templateSrv.replace(e.expression,r),e.sqlExpression=this.templateSrv.replace(e.sqlExpression,r,"raw"),e.accountId&&(e.accountId=this.templateSrv.replace(e.accountId,r)),e}getPeriod(e,r){let s=this.templateSrv.replace(e.period,r);if(s&&s.toLowerCase()!=="auto"){let n;return/^\d+$/.test(s)?n=parseInt(s,10):n=lr.intervalToSeconds(s),n<1&&(n=1),String(n)}return s}}class Wi extends Kt{constructor(e,r){super(e,r),this.memoizedGetRequest=(0,se.memoize)(this.getRequest.bind(this),(s,n)=>JSON.stringify({path:s,parameters:n}))}getRequest(e,r){return(0,is.AI)().get(`/api/datasources/${this.instanceSettings.id}/resources/${e}`,r)}async getExternalId(){return await this.memoizedGetRequest("external-id").then(({externalId:e})=>e)}getAccounts({region:e}){return this.memoizedGetRequest("accounts",{region:this.templateSrv.replace(this.getActualRegion(e))}).then(r=>r.map(s=>s.value))}isMonitoringAccount(e){return this.getAccounts({region:e}).then(r=>r.some(s=>s.isMonitoringAccount)).catch(()=>!1)}getRegions(){return this.memoizedGetRequest("regions").then(e=>[{label:"default",value:"default",text:"default"},...e.map(r=>({label:r.value.name,value:r.value.name,text:r.value.name}))].filter(r=>r.value))}getNamespaces(){return this.memoizedGetRequest("namespaces").then(e=>e.map(r=>({label:r.value,value:r.value})))}getLogGroups(e){return this.memoizedGetRequest("log-groups",{...e,region:this.templateSrv.replace(this.getActualRegion(e.region)),accountId:this.templateSrv.replace(e.accountId),listAllLogGroups:e.listAllLogGroups?"true":"false"})}getLogGroupFields(e,r){return this.memoizedGetRequest("log-group-fields",{region:this.templateSrv.replace(this.getActualRegion(e)),logGroupName:r})}getMetrics({region:e,namespace:r,accountId:s}){return r?this.memoizedGetRequest("metrics",{region:this.templateSrv.replace(this.getActualRegion(e)),namespace:this.templateSrv.replace(r),accountId:this.templateSrv.replace(s)}).then(n=>n.map(i=>({label:i.value.name,value:i.value.name}))):Promise.resolve([])}getAllMetrics({region:e,accountId:r}){return this.memoizedGetRequest("metrics",{region:this.templateSrv.replace(this.getActualRegion(e)),accountId:this.templateSrv.replace(r)}).then(s=>s.map(n=>({metricName:n.value.name,namespace:n.value.namespace})))}getDimensionKeys({region:e,namespace:r="",dimensionFilters:s={},metricName:n="",accountId:i},o){return this.memoizedGetRequest("dimension-keys",{region:this.templateSrv.replace(this.getActualRegion(e)),namespace:this.templateSrv.replace(r),accountId:this.templateSrv.replace(i),metricName:this.templateSrv.replace(n),dimensionFilters:JSON.stringify(this.convertDimensionFormat(s,{},o))}).then(c=>c.map(u=>({label:u.value,value:u.value})))}getDimensionValues({dimensionKey:e,region:r,namespace:s,dimensionFilters:n={},metricName:i="",accountId:o}){return!s||!i?Promise.resolve([]):this.memoizedGetRequest("dimension-values",{region:this.templateSrv.replace(this.getActualRegion(r)),namespace:this.templateSrv.replace(s),metricName:this.templateSrv.replace(i.trim()),dimensionKey:this.replaceVariableAndDisplayWarningIfMulti(e,{},!0),dimensionFilters:JSON.stringify(this.convertDimensionFormat(n,{})),accountId:this.templateSrv.replace(o)}).then(c=>c.map(u=>({label:u.value,value:u.value})))}getEbsVolumeIds(e,r){return this.memoizedGetRequest("ebs-volume-ids",{region:this.templateSrv.replace(this.getActualRegion(e)),instanceId:this.templateSrv.replace(r)})}getEc2InstanceAttribute(e,r,s){return this.memoizedGetRequest("ec2-instance-attribute",{region:this.templateSrv.replace(this.getActualRegion(e)),attributeName:this.templateSrv.replace(r),filters:JSON.stringify(this.convertMultiFilterFormat(s,"filter key"))})}getResourceARNs(e,r,s){return this.memoizedGetRequest("resource-arns",{region:this.templateSrv.replace(this.getActualRegion(e)),resourceType:this.templateSrv.replace(r),tags:JSON.stringify(this.convertMultiFilterFormat(s,"tag name"))})}legacyDescribeLogGroups(e,r){return this.memoizedGetRequest("legacy-log-groups",{region:this.templateSrv.replace(this.getActualRegion(e)),logGroupNamePrefix:r||""})}}var Ui=m(48592);const Lr=/\${(\w+):json}/g;function Gi(t){return typeof t!="string"&&typeof t.ec2Filters!="string"&&typeof t.tags!="string"}function Bt(t){const e=t.replace(Lr,'"$$$1"'),r=JSON.parse(e),s={};return Object.keys(r).forEach(n=>{const i=r[n];typeof i=="string"?s[n]=[i]:i!==void 0&&(s[n]=i)}),s}function ds(t){if(Gi(t))return t;if(typeof t!="string"){const E=(0,se.omit)(t,["dimensionFilters","ec2Filters","tags"]);if(E.dimensionFilters={},E.ec2Filters={},E.tags={},t.dimensionFilters!==""&&t.ec2Filters!=="[]"){const l=t.dimensionFilters.replace(Lr,'"$$$1"');try{E.dimensionFilters=JSON.parse(l)}catch{throw new Error(`unable to migrate poorly formed filters: ${t.dimensionFilters}`)}}if(t.ec2Filters!==""&&t.ec2Filters!=="[]")try{E.ec2Filters=Bt(t.ec2Filters)}catch{throw new Error(`unable to migrate poorly formed filters: ${t.ec2Filters}`)}if(t.tags!==""&&t.tags!=="[]")try{E.tags=Bt(t.tags)}catch{throw new Error(`unable to migrate poorly formed filters: ${t.tags}`)}return E}const e={refId:"CloudWatchVariableQueryEditor-VariableQuery",queryType:T.b4.Regions,namespace:"",region:"",metricName:"",dimensionKey:"",dimensionFilters:{},ec2Filters:{},instanceID:"",attributeName:"",resourceType:"",tags:{}};if(t===""||t.match(/^regions\(\)/))return e;if(t.match(/^namespaces\(\)/))return e.queryType=T.b4.Namespaces,e;const r=t.match(/^metrics\(([^\)]+?)(,\s?([^,]+?))?\)/);if(r)return e.queryType=T.b4.Metrics,e.namespace=r[1],e.region=r[3]||"",e;const s=t.match(/^dimension_keys\(([^\)]+?)(,\s?([^,]+?))?\)/);if(s)return e.queryType=T.b4.DimensionKeys,e.namespace=s[1],e.region=s[3]||"",e;const n=t.match(/^dimension_values\(([^,]+?),\s?([^,]+?),\s?([^,]+?),\s?([^,]+?)(,\s?(.+))?\)/);if(n){if(e.queryType=T.b4.DimensionValues,e.region=n[1],e.namespace=n[2],e.metricName=n[3],e.dimensionKey=n[4],e.dimensionFilters={},n[6]&&n[6]!=="[]"){const E=n[6].replace(Lr,'"$$$1"');try{e.dimensionFilters=JSON.parse(E)}catch{throw new Error(`unable to migrate poorly formed filters: ${n[6]}`)}}return e}const i=t.match(/^ebs_volume_ids\(([^,]+?),\s?([^,]+?)\)/);if(i)return e.queryType=T.b4.EBSVolumeIDs,e.region=i[1],e.instanceID=i[2],e;const o=t.match(/^ec2_instance_attribute\(([^,]+?),\s?([^,]+?),\s?(.+?)\)/);if(o){if(e.queryType=T.b4.EC2InstanceAttributes,e.region=o[1],e.attributeName=o[2],o[3]&&o[3]!=="[]")try{e.ec2Filters=Bt(o[3])}catch{throw new Error(`unable to migrate poorly formed filters: ${o[3]}`)}return e}const c=t.match(/^resource_arns\(([^,]+?),\s?([^,]+?),\s?(.+?)\)/);if(c){if(e.queryType=T.b4.ResourceArns,e.region=c[1],e.resourceType=c[2],c[3]&&c[3]!=="[]")try{e.tags=Bt(c[3])}catch{throw new Error(`unable to migrate poorly formed filters: ${c[3]}`)}return e}if(t.match(/^statistics\(\)/))return e.queryType=T.b4.Statistics,e;throw new Error("unable to parse old variable query")}const Ki=({filter:t,onChange:e,onDelete:r,keyPlaceholder:s,datasource:n})=>{const[i,o]=(0,A.useState)(t.key||""),[c,u]=(0,A.useState)(t.value?.join(", ")||""),E=It(n,t.key),l=(0,M.of)(Bi);return(0,a.jsxs)("div",{"data-testid":"cloudwatch-multifilter-item",children:[(0,a.jsxs)(yt.M,{children:[(0,a.jsx)(Te.p,{"data-testid":"cloudwatch-multifilter-item-key","aria-label":"Filter key",value:i,placeholder:s??"key",onChange:h=>o(h.currentTarget.value),onBlur:()=>{i&&i!==t.key&&e({...t,key:i})}}),(0,a.jsx)("span",{className:(0,C.cx)(l.root),children:"="}),(0,a.jsx)(Te.p,{"data-testid":"cloudwatch-multifilter-item-value","aria-label":"Filter value",value:c,placeholder:"value1, value2,...",onChange:h=>u(h.currentTarget.value),onBlur:()=>{const h=c.split(",").map(p=>p.trim());c&&h!==t.value&&e({...t,value:h}),u(h.join(", "))}}),(0,a.jsx)(St.Z,{"aria-label":"remove",icon:"times",variant:"secondary",onClick:r,type:"button"})]}),E&&(0,a.jsx)(Me.F,{title:E,severity:"error",topSpacing:1})]})},Bi=t=>({root:(0,C.css)({padding:t.spacing(0,1),alignSelf:"center"})}),Hi=t=>Object.keys(t).map(e=>({key:e,value:t[e],operator:"="})),Vi=t=>{const e={};return t.forEach(({key:r,value:s})=>{r&&s&&(e[r]=s)}),e},ms=({filters:t,onChange:e,keyPlaceholder:r,datasource:s})=>{const[n,i]=(0,A.useState)([]);(0,A.useEffect)(()=>i(t?Hi(t):[]),[t]);const o=c=>{i(c);const u=Vi(c);(0,se.isEqual)(u,t)||e(u)};return(0,a.jsx)(Pt.o,{items:n,onChange:o,renderItem:ji(s,r)})};function ji(t,e){function r(s,n,i){return(0,a.jsx)(Ki,{filter:s,onChange:o=>n(o),onDelete:i,keyPlaceholder:e,datasource:t})}return r}const $i=t=>({table:(0,C.css)({width:"100%",tableLayout:"fixed"}),selectedLogGroupsContainer:(0,C.css)({marginLeft:t.spacing(.5),marginBottom:t.spacing(.5),display:"flex",flexFlow:"wrap",gap:t.spacing(1),button:{margin:"unset"}}),limitLabel:(0,C.css)({color:t.colors.text.secondary,textAlign:"center",maxWidth:"none",svg:{marginRight:t.spacing(.5)},fontSize:12}),logGroupCountLabel:(0,C.css)({color:t.colors.text.secondary,maxWidth:"none"}),tableScroller:(0,C.css)({maxHeight:"40vh",overflow:"auto"}),row:(0,C.css)({borderBottom:`1px solid ${t.colors.border.weak}`,"&:last-of-type":{borderBottomColor:t.colors.border.medium}}),cell:(0,C.css)({padding:t.spacing(1,1,1,0),width:"25%","&:first-of-type":{width:"80%",padding:t.spacing(1,1,1,2)}}),nestedEntry:(0,C.css)({display:"flex",alignItems:"center"}),logGroupSearchResults:(0,C.css)({overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",width:"90%",verticalAlign:"middle"}),modal:(0,C.css)({width:t.breakpoints.values.lg}),selectAccountId:(0,C.css)({maxWidth:"100px"}),logGroupSelectionArea:(0,C.css)({display:"flex"}),searchField:(0,C.css)({width:"100%",marginRight:t.spacing(1)}),resultLimit:(0,C.css)({margin:"4px 0",fontStyle:"italic"}),removeButton:(0,C.css)({verticalAlign:"middle",marginLeft:t.spacing(.5)})}),ps=(0,C.css)({marginBottom:8}),gs=$i,tt=({label:t,onChange:e,value:r,options:s,allowCustomValue:n=!1,isLoading:i=!1,inputId:o=t,tooltip:c,interactive:u,error:E})=>(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(z.c,{label:t,tooltip:c,tooltipInteractive:u,htmlFor:o,className:ps,children:(0,a.jsx)(oe.l6,{"aria-label":t,allowCustomValue:n,value:r,onChange:({value:l})=>e(l),options:s,isLoading:i,inputId:o})}),E&&(0,a.jsx)(Me.F,{title:E,severity:"error",topSpacing:1})]}),Or=({interactive:t,label:e,onBlur:r,placeholder:s,value:n,tooltip:i})=>{const[o,c]=(0,A.useState)(n);return(0,a.jsx)(z.c,{label:e,tooltip:i,tooltipInteractive:t,className:ps,children:(0,a.jsx)(Te.p,{"aria-label":e,placeholder:s,value:o,onChange:u=>c(u.currentTarget.value),onBlur:()=>r(o)})})},ki=[{value:T.b4.Regions,label:"Regions"},{value:T.b4.Namespaces,label:"Namespaces"},{value:T.b4.Metrics,label:"Metrics"},{value:T.b4.DimensionKeys,label:"Dimension Keys"},{value:T.b4.DimensionValues,label:"Dimension Values"},{value:T.b4.EBSVolumeIDs,label:"EBS Volume IDs"},{value:T.b4.EC2InstanceAttributes,label:"EC2 Instance Attributes"},{value:T.b4.ResourceArns,label:"Resource ARNs"},{value:T.b4.Statistics,label:"Statistics"},{value:T.b4.LogGroups,label:"Log Groups"},..._.$.featureToggles.cloudWatchCrossAccountQuerying?[{value:T.b4.Accounts,label:"Accounts"}]:[]],Nr=["AmiLaunchIndex","Architecture","ClientToken","EbsOptimized","EnaSupport","Hypervisor","IamInstanceProfile","ImageId","InstanceId","InstanceLifecycle","InstanceType","KernelId","KeyName","LaunchTime","Platform","PrivateDnsName","PrivateIpAddress","PublicDnsName","PublicIpAddress","RamdiskId","RootDeviceName","RootDeviceType","SourceDestCheck","SpotInstanceRequestId","SriovNetSupport","SubnetId","VirtualizationType","VpcId"],Qi=({query:t,datasource:e,onChange:r})=>{const s=ds(t),{region:n,namespace:i,metricName:o,dimensionKey:c}=s,[u,E]=pr(e),l=gr(e),h=Er(e,{region:n,namespace:i}),p=Tt(e,{region:n,namespace:i,metricName:o}),I=wt(e.resources,t.region),L=It(e,c),F=async V=>{const Le=await P({...s,region:V,accountId:void 0});N(Le)},D=async V=>{const Le=await P({...s,namespace:V});N(Le)},N=V=>{r({...V,refId:"CloudWatchVariableQueryEditor-VariableQuery"})},P=async V=>{let{metricName:Le,dimensionKey:ut,dimensionFilters:jt,namespace:H,region:ce}=V;return Le&&await e.resources.getMetrics({namespace:H,region:ce}).then(Oe=>{Oe.find(_e=>_e.value===Le)||(Le="")}),ut&&await e.resources.getDimensionKeys({namespace:H,region:ce}).then(Oe=>{Oe.find(_e=>_e.value===ut)||(ut="",jt={})}),{...V,metricName:Le,dimensionKey:ut,dimensionFilters:jt}},de=(Nr.includes(s.attributeName)?Nr:[...Nr,s.attributeName]).map(ae.z),Fe=[T.b4.Metrics,T.b4.DimensionKeys,T.b4.DimensionValues,T.b4.EBSVolumeIDs,T.b4.EC2InstanceAttributes,T.b4.ResourceArns,T.b4.LogGroups,T.b4.Accounts].includes(s.queryType),Nt=[T.b4.Metrics,T.b4.DimensionKeys,T.b4.DimensionValues,T.b4.LogGroups].includes(s.queryType),ct=[T.b4.Metrics,T.b4.DimensionKeys,T.b4.DimensionValues].includes(s.queryType),Vt=(0,M.of)(Yi);return(0,a.jsxs)("div",{className:Vt.formStyles,children:[(0,a.jsx)(tt,{value:s.queryType,options:ki,onChange:V=>N({...s,queryType:V,accountId:void 0}),label:"Query type",inputId:`variable-query-type-${t.refId}`}),Fe&&(0,a.jsx)(tt,{value:n,options:u,onChange:V=>F(V),label:"Region",isLoading:E,inputId:`variable-query-region-${t.refId}`}),Nt&&I.value&&I.value?.length>0&&_.$.featureToggles.cloudWatchCrossAccountQuerying&&(0,a.jsx)(tt,{label:"Account",value:t.accountId??null,onChange:V=>N({...s,accountId:V}),options:[it,...I?.value],allowCustomValue:!1}),ct&&(0,a.jsx)(tt,{value:i,options:l,onChange:V=>D(V),label:"Namespace",inputId:`variable-query-namespace-${t.refId}`,allowCustomValue:!0}),s.queryType===T.b4.DimensionValues&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(tt,{value:o||null,options:h,onChange:V=>N({...s,metricName:V}),label:"Metric",inputId:`variable-query-metric-${t.refId}`,allowCustomValue:!0}),(0,a.jsx)(tt,{value:c||null,options:p,onChange:V=>N({...s,dimensionKey:V}),label:"Dimension key",inputId:`variable-query-dimension-key-${t.refId}`,allowCustomValue:!0,error:L}),(0,a.jsx)(z.c,{label:"Dimensions",className:Vt.dimensionsWidth,tooltip:"Dimensions to filter the returned values on",children:(0,a.jsx)(Xr,{metricStat:{...s,dimensions:s.dimensionFilters},onChange:V=>{r({...s,dimensionFilters:V})},disableExpressions:!0,datasource:e})})]}),s.queryType===T.b4.EBSVolumeIDs&&(0,a.jsx)(Or,{value:t.instanceID,placeholder:"i-XXXXXXXXXXXXXXXXX",onBlur:V=>N({...s,instanceID:V}),label:"Instance ID"}),s.queryType===T.b4.EC2InstanceAttributes&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(tt,{value:s.attributeName,options:de,onChange:V=>N({...s,attributeName:V}),label:"Attribute name",inputId:`variable-query-instance-attribute-${t.refId}`,allowCustomValue:!0,interactive:!0,tooltip:(0,a.jsxs)(a.Fragment,{children:['Attribute or tag to query on. Tags should be formatted "Tags.<name>". ',(0,a.jsx)(B.Y,{href:"https://grafana.com/docs/grafana/latest/datasources/aws-cloudwatch/template-queries-cloudwatch/#selecting-attributes",external:!0,children:"See the documentation for more details"})]})}),(0,a.jsx)(z.c,{label:"Filters",tooltipInteractive:!0,tooltip:(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(B.Y,{href:"https://grafana.com/docs/grafana/latest/datasources/aws-cloudwatch/template-queries-cloudwatch/#selecting-attributes",external:!0,children:"Pre-defined ec2:DescribeInstances filters/tags"})," and the values to filter on. Tags should be formatted tag:<name>."]}),children:(0,a.jsx)(ms,{filters:s.ec2Filters??{},onChange:V=>{r({...s,ec2Filters:V})},keyPlaceholder:"filter/tag",datasource:e})})]}),s.queryType===T.b4.ResourceArns&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(Or,{value:s.resourceType,onBlur:V=>N({...s,resourceType:V}),label:"Resource type"}),(0,a.jsx)(z.c,{label:"Tags",tooltip:"Tags to filter the returned values on.",children:(0,a.jsx)(ms,{filters:s.tags,onChange:V=>{r({...s,tags:V})},keyPlaceholder:"tag",datasource:e})})]}),s.queryType===T.b4.LogGroups&&(0,a.jsx)(Or,{value:t.logGroupPrefix??"",onBlur:V=>N({...s,logGroupPrefix:V}),label:"Log group prefix"})]})},Yi=t=>({formStyles:(0,C.css)({maxWidth:t.spacing(30)}),dimensionsWidth:(0,C.css)({width:t.spacing(50)})});class zi extends Ui.f5{constructor(e){super(),this.resources=e,this.editor=Qi,this.allMetricFindValue={text:"All",value:it.value,expandable:!0}}query(e){const r=ds(e.targets[0]);return(0,ls.H)(this.execute(r)).pipe((0,Ot.T)(s=>({data:s})))}async execute(e){try{switch(e.queryType){case T.b4.Regions:return this.handleRegionsQuery();case T.b4.Namespaces:return this.handleNamespacesQuery();case T.b4.Metrics:return this.handleMetricsQuery(e);case T.b4.DimensionKeys:return this.handleDimensionKeysQuery(e);case T.b4.DimensionValues:return this.handleDimensionValuesQuery(e);case T.b4.EBSVolumeIDs:return this.handleEbsVolumeIdsQuery(e);case T.b4.EC2InstanceAttributes:return this.handleEc2InstanceAttributeQuery(e);case T.b4.ResourceArns:return this.handleResourceARNsQuery(e);case T.b4.Statistics:return this.handleStatisticsQuery();case T.b4.LogGroups:return this.handleLogGroupsQuery(e);case T.b4.Accounts:return this.handleAccountsQuery(e)}}catch(r){return console.error(`Could not run CloudWatchMetricFindQuery ${e}`,r),[]}}async handleLogGroupsQuery({region:e,logGroupPrefix:r,accountId:s}){const n=this.resources.templateSrv.replace(r);return this.resources.getLogGroups({accountId:s,region:e,logGroupNamePrefix:n,listAllLogGroups:!0}).then(i=>i.map(o=>({text:o.value.name,value:o.value.arn,expandable:!0})))}async handleRegionsQuery(){return this.resources.getRegions().then(e=>e.map($e))}async handleNamespacesQuery(){return this.resources.getNamespaces().then(e=>e.map($e))}async handleMetricsQuery({namespace:e,region:r,accountId:s}){return this.resources.getMetrics({namespace:e,region:r,accountId:s}).then(n=>n.map($e))}async handleDimensionKeysQuery({namespace:e,region:r,accountId:s}){return this.resources.getDimensionKeys({namespace:e,region:r,accountId:s}).then(n=>n.map($e))}async handleDimensionValuesQuery({namespace:e,accountId:r,region:s,dimensionKey:n,metricName:i,dimensionFilters:o}){return!n||!i?[]:this.resources.getDimensionValues({region:s,accountId:r,namespace:e,metricName:i,dimensionKey:n,dimensionFilters:o}).then(c=>c.map($e))}async handleEbsVolumeIdsQuery({region:e,instanceID:r}){return r?this.resources.getEbsVolumeIds(e,r).then(s=>s.map($e)):[]}async handleEc2InstanceAttributeQuery({region:e,attributeName:r,ec2Filters:s}){return r?this.resources.getEc2InstanceAttribute(e,r,s??{}).then(n=>n.map($e)):[]}async handleResourceARNsQuery({region:e,resourceType:r,tags:s}){return r?(await this.resources.getResourceARNs(e,r,s??{})).map($e):[]}async handleStatisticsQuery(){return _t.map(e=>({text:e,value:e,expandable:!0}))}async handleAccountsQuery({region:e}){return this.resources.getAccounts({region:e}).then(r=>{const s=r.map(n=>({text:n.label,value:n.id,expandable:!0}));return s.length?[this.allMetricFindValue,...s]:[]})}getDefaultQuery(){return Rn}}function $e({label:t,value:e}){return{text:t??e??"",value:e,expandable:!0}}class Es extends on.iy{constructor(e,r=(0,Ie.w)()){super(e),this.instanceSettings=e,this.templateSrv=r,this.type="cloudwatch",this.defaultRegion=e.jsonData.defaultRegion,this.resources=new Wi(e,r),this.languageProvider=new Nn(this),this.sqlCompletionItemProvider=new Yn(this.resources,this.templateSrv),this.metricsQueryRunner=new Pi(e,r),this.logsQueryRunner=new Ni(e,r),this.annotationQueryRunner=new si(e,r),this.variables=new zi(this.resources),this.annotations=Cn,this.defaultLogGroups=e.jsonData.defaultLogGroups,this.metricMathCompletionItemProvider=new ti(this.resources,this.templateSrv),this.logsCompletionItemProviderFunc=Zn(this.resources,this.templateSrv),this.logsSqlCompletionItemProviderFunc=Pn(this.resources,r),this.pplCompletionItemProviderFunc=Hn(this.resources,this.templateSrv)}filterQuery(e){return e.hide!==!0||re(e)&&e.id!==""}query(e){e=(0,se.cloneDeep)(e);let r=e.targets.filter(this.filterQuery);const s=[],n=[],i=[];r.forEach(c=>{le(c)?i.push(c):te(c)?s.push(c):n.push(c)});const o=[];return s.length&&o.push(this.logsQueryRunner.handleLogQueries(s,e,super.query.bind(this))),n.length&&o.push(this.metricsQueryRunner.handleMetricQueries(n,e,super.query.bind(this))),i.length&&o.push(this.annotationQueryRunner.handleAnnotationQuery(i,e,super.query.bind(this))),(0,se.isEmpty)(o)?(0,ft.of)({data:[],state:He.Gu.Done}):(0,an.h)(...o)}interpolateVariablesInQueries(e,r){return e.length?e.map(s=>({...s,region:this.metricsQueryRunner.replaceVariableAndDisplayWarningIfMulti(this.getActualRegion(s.region),r),...re(s)&&this.metricsQueryRunner.interpolateMetricsQueryVariables(s,r),...te(s)&&this.logsQueryRunner.interpolateLogsQueryVariables(s,r)})):e}getLogRowContext(e,r,s){return this.logsQueryRunner.getLogRowContext(e,r,super.query.bind(this),s)}targetContainsTemplate(e){return this.templateSrv.containsTemplate(e.region)||this.templateSrv.containsTemplate(e.namespace)||this.templateSrv.containsTemplate(e.metricName)||this.templateSrv.containsTemplate(e.expression)||e.logGroupNames?.some(r=>this.templateSrv.containsTemplate(r))||(0,se.find)(e.dimensions,(r,s)=>this.templateSrv.containsTemplate(s)||this.templateSrv.containsTemplate(r))}getQueryDisplayText(e){return te(e)?e.expression??"":JSON.stringify(e)}getVariables(){return this.resources.getVariables()}getActualRegion(e){return e==="default"||e===void 0||e===""?this.defaultRegion??"":e}getDefaultQuery(e){return{...Sn(this.instanceSettings.jsonData.logGroups,this.instanceSettings.jsonData.defaultLogGroups),...Jr}}}const Xi=20,Zi=4,Ji=300,qi=({region:t,selectedLogGroups:e,onChange:r,datasource:s,onOpenMenu:n,width:i,saved:o=!0})=>{const[c,u]=(0,A.useState)(!1),[E,l]=(0,A.useState)([]),h=(0,A.useMemo)(()=>(0,se.unionBy)(E,e?.map(ae.z),"value"),[E,e]),p=(0,A.useCallback)(async(D,N)=>{if(!s)return[];try{return await s.resources.legacyDescribeLogGroups(D,N)}catch(P){return(0,S.J7)().publish({type:Gt.r1.alertError.name,payload:[typeof P=="string"?P:JSON.stringify(P)]}),[]}},[s]),I=async(D,N,P)=>{if(P.action!=="input-change"||!s)return;if(!/^[\.\-_/#A-Za-z0-9]+$/.test(D)){D!==""&&(0,S.J7)().publish({type:Gt.r1.alertError.name,payload:["Invalid Log Group name: "+D]});return}u(!0);const de=await p(N,D);l((0,se.unionBy)(E,de,"value")),u(!1)};(0,A.useEffect)(()=>{async function D(){if(!s||!s.getActualRegion(t)){l([]);return}return u(!0),p(s.getActualRegion(t)).then(N=>{l(N)}).finally(()=>{u(!1)})}return o&&D(),()=>{l([]),u(!1)}},[s,t,o]);const L=async()=>{n&&await n()},F=(0,se.debounce)(I,Ji);return(0,a.jsx)(oe.KF,{inputId:"default-log-groups","aria-label":"Log Groups",allowCustomValue:!0,options:s?me(s,h):h,value:e,onChange:D=>r(D.filter(({value:N})=>N).map(({value:N})=>N)),closeMenuOnSelect:!1,isClearable:!0,isOptionDisabled:()=>e.length>=Xi,placeholder:"Choose Log Groups",maxVisibleValues:Zi,noOptionsMessage:"No log groups available",isLoading:c,onOpenMenu:L,onInputChange:(D,N)=>{F(D,t,N)},width:i})},ea=(0,C.css)({gap:"3px"}),ta=({datasource:t,region:e,legacyLogGroupNames:r,onChange:s})=>(0,a.jsx)("div",{className:`gf-form gf-form--grow flex-grow-1 ${ea}`,children:(0,a.jsx)(qi,{region:e,selectedLogGroups:r,datasource:t,onChange:s})});var hs=m(22787),fs=m(30703),ra=m(6975),sa=m(32635),na=m(72636),ke=m(45861);const ia=({searchFn:t,searchPhrase:e})=>{const[r,s]=(0,A.useState)(e),n=(0,A.useMemo)(()=>(0,se.debounce)(t,600),[t]);return(0,A.useEffect)(()=>()=>{n?.cancel()},[n]),(0,a.jsx)(Te.p,{"aria-label":"log group search",prefix:(0,a.jsx)(fs.I,{name:"search"}),value:r,onChange:i=>{const o=i.currentTarget.value;s(o),n(o)},placeholder:"search by log group name prefix"})},aa=({accountOptions:t=[],variables:e=[],fetchLogGroups:r,onChange:s,onBeforeOpen:n,...i})=>{const[o,c]=(0,A.useState)(!1),[u,E]=(0,A.useState)([]),[l,h]=(0,A.useState)(i.selectedLogGroups??[]),[p,I]=(0,A.useState)(""),[L,F]=(0,A.useState)(it.value),[D,N]=(0,A.useState)(!1),P=(0,M.of)(gs),X=(0,A.useMemo)(()=>l.filter(H=>!H.name?.startsWith("$")).length,[l]),de=(0,A.useMemo)(()=>e.map(H=>({label:H,value:H})),[e]),Fe=(0,A.useMemo)(()=>l.find(H=>H.name?.startsWith("$"))?.name,[l]),Nt={label:Fe,value:Fe};(0,A.useEffect)(()=>{h(i.selectedLogGroups??[])},[i.selectedLogGroups]);const ct=()=>{c(!o),o||(h(l),V(p,L))},Vt=(0,A.useMemo)(()=>{const H={};return t.forEach(ce=>{ce.value&&ce.label&&(H[ce.value]=ce.label)}),H},[t]),V=async(H,ce)=>{N(!0);try{const Oe=await r({logGroupPattern:H,accountId:ce});E(Oe.map(_e=>({arn:_e.value.arn,name:_e.value.name,accountId:_e.accountId,accountLabel:_e.accountId?Vt[_e.accountId]:void 0})))}catch{E([])}N(!1)},Le=(H,ce)=>{h(ce?[...l,H]:l.filter(Oe=>Oe.arn!==H.arn))},ut=()=>{s(l),ct()},jt=()=>{h(l),ct()};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(hs.a,{className:P.modal,title:"Select log groups",isOpen:o,onDismiss:ct,children:[(0,a.jsxs)("div",{className:P.logGroupSelectionArea,children:[(0,a.jsx)("div",{className:P.searchField,children:(0,a.jsx)(z.c,{label:"Log group name prefix",children:(0,a.jsx)(ia,{searchFn:H=>{V(H,L),I(H)},searchPhrase:p})})}),(0,a.jsx)(hr,{onChange:H=>{V(p,H),F(H||it.value)},accountOptions:t,accountId:L})]}),(0,a.jsx)(we.$,{layout:"block",v:2}),(0,a.jsxs)("div",{children:[!D&&u.length>=25&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:P.limitLabel,children:[(0,a.jsx)(fs.I,{name:"info-circle"}),"Only the first 50 results can be shown. If you do not see an expected log group, try narrowing down your search.",(0,a.jsxs)("p",{children:["A"," ",(0,a.jsxs)(B.Y,{external:!0,href:"https://docs.aws.amazon.com/AmazonCloudWatch/latest/logs/cloudwatch_limits_cwl.html",children:["maximum"," "]})," ","of 50 Cloudwatch log groups can be queried at one time."]})]}),(0,a.jsx)(we.$,{layout:"block",v:1})]}),(0,a.jsx)("div",{className:P.tableScroller,children:(0,a.jsxs)("table",{className:P.table,children:[(0,a.jsx)("thead",{children:(0,a.jsxs)("tr",{className:P.row,children:[(0,a.jsx)("td",{className:P.cell,children:"Log Group"}),t.length>0&&(0,a.jsx)("td",{className:P.cell,children:"Account label"}),(0,a.jsx)("td",{className:P.cell,children:"Account ID"})]})}),(0,a.jsxs)("tbody",{children:[D&&(0,a.jsx)("tr",{className:P.row,children:(0,a.jsx)("td",{className:P.cell,children:(0,a.jsx)(ra._,{text:"Loading..."})})}),!D&&u.length===0&&(0,a.jsx)("tr",{className:P.row,children:(0,a.jsx)("td",{className:P.cell,children:"No log groups found"})}),!D&&u.map(H=>(0,a.jsxs)("tr",{className:P.row,children:[(0,a.jsx)("td",{className:P.cell,children:(0,a.jsxs)("div",{className:P.nestedEntry,children:[(0,a.jsx)(sa.S,{id:H.arn,onChange:ce=>Le(H,ce.currentTarget.checked),value:!!(H.arn&&l.some(ce=>ce.arn===H.arn))}),(0,a.jsx)(we.$,{layout:"inline",h:2}),(0,a.jsx)("label",{className:P.logGroupSearchResults,htmlFor:H.arn,title:H.name,children:H.name})]})}),t.length>0&&(0,a.jsx)("td",{className:P.cell,children:H.accountLabel}),(0,a.jsx)("td",{className:P.cell,children:H.accountId})]},`${H.arn}`))]})]})})]}),(0,a.jsx)(we.$,{layout:"block",v:2}),(0,a.jsxs)(na.J,{className:P.logGroupCountLabel,children:[X," log group",X!==1&&"s"," selected"]}),(0,a.jsx)(we.$,{layout:"block",v:1}),(0,a.jsx)(z.c,{label:"Template variable",width:26,tooltip:"Optionally you can specify a single or multi-valued template variable. Select a variable separately or in conjunction with log groups.",children:(0,a.jsx)(oe.l6,{isClearable:!0,"aria-label":"Template variable",value:Nt,allowCustomValue:!0,options:de,onChange:H=>{const ce=l.filter(Oe=>!Oe.name?.startsWith("$"));H?.label&&ce.push({name:H.label,arn:H.label}),h(ce)}})}),(0,a.jsxs)(hs.a.ButtonRow,{children:[(0,a.jsx)(ke.$n,{onClick:jt,variant:"secondary",type:"button",fill:"outline",children:"Cancel"}),(0,a.jsx)(ke.$n,{onClick:ut,type:"button",children:"Add log groups"})]})]}),(0,a.jsx)("div",{children:(0,a.jsx)(ke.$n,{variant:"secondary",onClick:()=>{try{n?.(),ct()}catch{}},type:"button",children:"Select log groups"})})]})};var As=m(71599);const Ts=6,oa=({selectedLogGroups:t=[],onChange:e,maxNoOfVisibleLogGroups:r=Ts})=>{const s=(0,M.of)(gs),[n,i]=(0,A.useState)(!1),[o,c]=(0,A.useState)(t.slice(0,Ts));return(0,A.useEffect)(()=>{c(t.slice(0,r))},[t,r]),(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:s.selectedLogGroupsContainer,children:[o.map(u=>(0,a.jsx)(ke.$n,{size:"sm",variant:"secondary",icon:"times",className:s.removeButton,onClick:()=>{e(t.filter(E=>E.arn!==u.arn))},children:`${u.name}${u.accountLabel?`(${u.accountLabel})`:""}`},u.arn)),o.length!==t.length&&(0,a.jsx)(ke.$n,{size:"sm",variant:"secondary",icon:"plus",fill:"outline",className:s.removeButton,onClick:()=>c(t),children:"Show all"}),t.length>0&&(0,a.jsx)(ke.$n,{size:"sm",variant:"secondary",icon:"times",fill:"outline",className:s.removeButton,onClick:()=>i(!0),children:"Clear selection"})]}),(0,a.jsx)(As.u,{isOpen:n,title:"Clear Log Group Selection",body:"Are you sure you want to clear all log groups?",confirmText:"Yes",dismissText:"No",icon:"exclamation-triangle",onConfirm:()=>{i(!1),e([])},onDismiss:()=>i(!1)})]})},la=(0,C.css)({display:"flex",flexDirection:"column",marginTop:8,"& div:first-child":{marginBottom:8}}),ca=({datasource:t,onChange:e,legacyLogGroupNames:r,logGroups:s,region:n,maxNoOfVisibleLogGroups:i,onBeforeOpen:o})=>{const c=wt(t?.resources,n),[u,E]=(0,A.useState)(!1);return(0,A.useEffect)(()=>{if(t&&!u&&!s?.length&&r?.length){E(!0);const l=r.filter(p=>ts(t.resources.templateSrv,p)),h=r.filter(p=>!ts(t.resources.templateSrv,p));Promise.all(h.map(p=>t.resources.getLogGroups({region:n,logGroupNamePrefix:p}))).then(p=>{const I=p.flatMap(L=>L.map(F=>({arn:F.value.arn,name:F.value.name,accountId:F.accountId})));e([...I,...l.map(L=>({name:L,arn:L}))])}).catch(p=>{console.error(p)})}},[t,r,s,e,n,u]),(0,a.jsxs)("div",{className:la,children:[(0,a.jsx)(aa,{fetchLogGroups:async l=>t?.resources.getLogGroups({region:n,...l})??[],onChange:e,accountOptions:c.value,selectedLogGroups:s,onBeforeOpen:o,variables:t?.getVariables()}),(0,a.jsx)(oa,{selectedLogGroups:s??[],onChange:e,maxNoOfVisibleLogGroups:i})]})},Is=t=>_.$.featureToggles.cloudWatchCrossAccountQuerying?(0,a.jsx)(ca,{...t}):(0,a.jsx)(ta,{...t,onChange:t.legacyOnChange,legacyLogGroupNames:t.legacyLogGroupNames||[]});var ua=m(21285);function da({options:t,onOptionsChange:e}){return(0,a.jsx)(cr.A,{title:"Secure Socks Proxy",children:(0,a.jsx)(ht.D,{label:"Enabled",description:"Connect to this datasource via the secure socks proxy.",children:(0,a.jsx)(ua.d,{value:t.jsonData.enableSecureSocksProxy??!1,onChange:r=>e({...t,jsonData:{...t.jsonData,enableSecureSocksProxy:r.currentTarget.checked}})})})})}var ys=m(80839),ma=m(18027);const pa=t=>({infoText:(0,C.css)({paddingBottom:t.spacing(2),color:t.colors.text.secondary})}),vr="grafana-x-ray-datasource";function ga({newFormStyling:t,datasourceUid:e,onChange:r}){const s=!!(0,ur.l)().getList({pluginId:vr}).length,n=(0,M.of)(pa);return t?(0,a.jsxs)(cr.A,{title:"X-ray trace link",description:"Grafana will automatically create a link to a trace in X-ray data source if logs contain @xrayTraceId field",children:[!s&&(0,a.jsx)(Me.F,{title:"There is no X-ray datasource to link to. First add an X-ray data source and then link it to Cloud Watch. ",severity:"info"}),(0,a.jsx)(ht.D,{htmlFor:"data-source-picker",label:"Data source",description:"X-ray data source containing traces",children:(0,a.jsx)(ys.s,{pluginId:vr,onChange:i=>r(i.uid),current:e,noDefault:!0})})]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("h3",{className:"page-heading",children:"X-ray trace link"}),(0,a.jsx)("div",{className:n.infoText,children:"Grafana will automatically create a link to a trace in X-ray data source if logs contain @xrayTraceId field"}),!s&&(0,a.jsx)(Me.F,{title:"There is no X-ray datasource to link to. First add an X-ray data source and then link it to Cloud Watch. ",severity:"info"}),(0,a.jsx)("div",{className:"gf-form-group",children:(0,a.jsx)(ma.I,{htmlFor:"data-source-picker",label:"Data source",labelWidth:28,tooltip:"X-ray data source containing traces",children:(0,a.jsx)(ys.s,{pluginId:vr,onChange:i=>r(i.uid),current:e,noDefault:!0})})})]})}const Ea='Since grafana 7.3 authentication type "arn" is deprecated, falling back to default SDK provider',ha=`As of grafana 7.3 authentication type "credentials" should be used only for shared file credentials. If you don't have a credentials file, switch to the default SDK provider for extracting credentials from environment variables or IAM roles`,fa=t=>{const{options:e,onOptionsChange:r}=t,{defaultLogGroups:s,logsTimeout:n,defaultRegion:i,logGroups:o}=e.jsonData,c=Aa(t),u=Ta(n),E=Ia(t),[l,h]=(0,A.useState)({invalid:!1});(0,A.useEffect)(()=>h({invalid:!1}),[t.options]);const p=(0,nn.G)();(0,A.useEffect)(()=>{const X=(0,S.J7)().subscribe(R.NI,()=>{p("grafana_plugin_cloudwatch_save_succeeded",{auth_type:e.jsonData.authType})}),de=(0,S.J7)().subscribe(R.LL,()=>{p("grafana_plugin_cloudwatch_save_failed",{auth_type:e.jsonData.authType})});return()=>{X.unsubscribe(),de.unsubscribe()}},[e.jsonData.authType,p]);const[I,L]=(0,A.useState)("");(0,A.useEffect)(()=>{!I&&c&&c.resources.getExternalId().then(L).catch(()=>L("Unable to fetch externalId"))},[c,I]);const[F,D]=(0,A.useState)(null),N=()=>{D(null)};(0,A.useEffect)(()=>{e.jsonData.authType==="arn"?D(Ea):e.jsonData.authType==="credentials"&&!e.jsonData.profile&&!e.jsonData.database&&D(ha)},[e.jsonData.authType,e.jsonData.database,e.jsonData.profile]);const P=(0,M.of)(ya);return(0,a.jsxs)("div",{className:P.formStyles,children:[F&&(0,a.jsx)(Me.F,{title:"CloudWatch Authentication",severity:"warning",onRemove:N,children:F}),(0,a.jsx)(sn.NN,{...t,loadRegions:c&&(async()=>c.resources.getRegions().then(X=>X.reduce((de,Fe)=>Fe.value?[...de,Fe.value]:de,[]))),externalId:I,children:(0,a.jsx)(ht.D,{label:"Namespaces of Custom Metrics",children:(0,a.jsx)(Te.p,{placeholder:"Namespace1,Namespace2",value:e.jsonData.customMetricsNamespaces||"",onChange:(0,Et.PG)(t,"customMetricsNamespaces")})})}),_.$.secureSocksDSProxyEnabled&&(0,a.jsx)(da,{options:e,onOptionsChange:r}),(0,a.jsx)($r.c,{}),(0,a.jsxs)(cr.A,{title:"Cloudwatch Logs",children:[(0,a.jsx)(ht.D,{htmlFor:"logsTimeout",label:"Query Result Timeout",description:'Grafana will poll for Cloudwatch Logs results every second until Done status is returned from AWS or timeout is exceeded, in which case Grafana will return an error. Note: For Alerting, the timeout from Grafana config file will take precedence. Must be a valid duration string, such as "30m" (default) "30s" "2000ms" etc.',invalid:!!u,children:(0,a.jsx)(Te.p,{id:"logsTimeout",width:60,placeholder:"30m",value:e.jsonData.logsTimeout||"",onChange:(0,Et.PG)(t,"logsTimeout"),title:'The timeout must be a valid duration string, such as "15m" "30s" "2000ms" etc.'})}),(0,a.jsx)(ht.D,{label:"Default Log Groups",description:"Optionally, specify default log groups for CloudWatch Logs queries.",...l,children:c?(0,a.jsx)(Is,{region:i??"",datasource:c,onBeforeOpen:()=>{if(E)return;let X="You need to save the data source before adding log groups.";throw t.options.version&&t.options.version>1&&(X="You have unsaved connection detail changes. You need to save the data source before adding log groups."),h({invalid:!0,error:X}),new Error(X)},legacyLogGroupNames:s,logGroups:o,onChange:X=>{r({...t.options,jsonData:{...t.options.jsonData,logGroups:X,defaultLogGroups:void 0}})},maxNoOfVisibleLogGroups:2,legacyOnChange:X=>{(0,Et.lO)(t,"defaultLogGroups",X)}}):(0,a.jsx)(a.Fragment,{})})]}),(0,a.jsx)($r.c,{}),(0,a.jsx)(ga,{newFormStyling:!0,onChange:X=>(0,Et.lO)(t,"tracingDatasourceUid",X),datasourceUid:e.jsonData.tracingDatasourceUid})]})};function Aa(t){const[e,r]=(0,A.useState)();return(0,A.useEffect)(()=>{t.options.version&&(0,ur.l)().get(t.options.name).then(s=>{s instanceof Es&&r(s)})},[t.options.version,t.options.name]),e}function Ta(t){const[e,r]=(0,A.useState)(void 0);return(0,rn.A)(()=>{if(t)try{lr.describeInterval(t),r(void 0)}catch(s){s instanceof Error&&r(s.toString())}else r(void 0)},350,[t]),e}function Ia(t){const[e,r]=(0,A.useState)(!!t.options.version&&t.options.version>1);return(0,A.useEffect)(()=>{r(!1)},[t.options.jsonData.assumeRoleArn,t.options.jsonData.authType,t.options.jsonData.defaultRegion,t.options.jsonData.endpoint,t.options.jsonData.externalId,t.options.jsonData.profile,t.options.secureJsonData?.accessKey,t.options.secureJsonData?.secretKey]),(0,A.useEffect)(()=>{t.options.version&&t.options.version>1&&r(!0)},[t.options.version]),e}const ya=t=>({formStyles:(0,C.css)({maxWidth:t.spacing(50)})});function Sa({data:t=[]}){const e=(0,A.useMemo)(()=>(0,se.groupBy)(t,"refId"),[t]);return(0,a.jsx)(a.Fragment,{children:(0,a.jsxs)("table",{className:"filter-table form-inline",children:[(0,a.jsx)("thead",{children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{children:"RefId"}),(0,a.jsx)("th",{children:"Metric Data Query ID"}),(0,a.jsx)("th",{children:"Metric Data Query Expression"}),(0,a.jsx)("th",{children:"Period"}),(0,a.jsx)("th",{})]})}),Object.entries(e).map(([r,s],n)=>{if(!s.length)return null;const i=s[0],o=i.meta?.custom;return o?(0,a.jsx)("tbody",{children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("td",{children:r}),(0,a.jsx)("td",{children:o.id}),(0,a.jsx)("td",{children:i.meta?.executedQueryString}),(0,a.jsx)("td",{children:o.period})]})},n):null})]})})}const Ra=(t,e)=>{const r=(0,A.useMemo)(()=>Ca(t),[t]);return(0,A.useEffect)(()=>{r!==t&&e(r)},[r,t,e]),r};function Ca(t){const e={...t};return e.queryMode||(e.queryMode="Metrics"),e.region||(e.region="default"),ge()(e,t)?t:e}const La=Ra;var Oa=m(94701),Na=m(84596);function va({panelData:t,query:e,datasource:r}){const[s,n]=(0,A.useState)(""),i=(0,Na.A)(t);return(0,A.useEffect)(()=>{if(i!==t&&t?.request?.range){const o=(e.logGroups??[]).filter(I=>I?.arn).map(I=>(I.arn??"").replace(/:\*$/,"")),c=e.logGroupNames;let u=o?.length?o:c;const E=t?.request?.range,l=E.from.toISOString(),p={end:E.to.toISOString(),start:l,timeType:"ABSOLUTE",tz:"UTC",editorString:e.expression??"",isLiveTail:!1,source:u??[]};n(us(p,r.resources.getActualRegion(e.region)))}},[t,i,r,e]),(0,a.jsx)(ke.z9,{variant:"secondary",icon:"share-alt",href:s,target:"_blank",rel:"noopener noreferrer",children:"CloudWatch Logs Insights"})}var ot=m(50992);const xr=async(t,e,r,s)=>{const{id:n,loader:i}=e;return s?.dispose(),i().then(o=>t.languages.registerCompletionItemProvider(n,r.getCompletionProvider(t,e)))},lt=async(t,e,r)=>{const{id:s,loader:n}=e;if(!t.languages.getLanguages().find(o=>o.id===s))return t.languages.register({id:s}),n().then(o=>(t.languages.setMonarchTokensProvider(s,o.language),t.languages.setLanguageConfiguration(s,o.conf),t.languages.registerCompletionItemProvider(s,r.getCompletionProvider(t,e))))},xa=/\s+by\s+/im,br=/([\w$@().]+)(?:(\s+as\s+)([\w$]+))?\s*,?\s*/iy;function Dr(t){let e=[],r;if(r=t.match(xa)){br.lastIndex=r.index+r[0].length;let s;for(;s=br.exec(t);)e.push(s[2]?s[3]:s[1]),br.lastIndex=s.index+s[0].length}return e}const Mr={id:O.CLOUDWATCH_PPL_LANGUAGE_DEFINITION_ID,extensions:[],aliases:[],mimetypes:[],loader:()=>Promise.resolve().then(m.bind(m,97969))},wr={height:"150px",width:"100%",showMiniMap:!1,monacoOptions:{scrollBeyondLastLine:!1,fontSize:14,lineNumbers:"off",renderLineHighlight:"none",scrollbar:{vertical:"hidden",horizontal:"hidden"},suggestFontSize:12,wordWrap:"on",padding:{top:6}}},ba=t=>{const{query:e,datasource:r,onChange:s}=t,n=(0,A.useRef)(),i=(0,A.useRef)(),o=(0,A.useCallback)(async()=>{i.current=await xr(n.current,Mr,r.pplCompletionItemProviderFunc({region:e.region,logGroups:e.logGroups}),i.current)},[r,e.logGroups,e.region]),c=(0,A.useCallback)(l=>{const h={...e,expression:l,statsGroups:Dr(l)};s(h)},[s,e]),u=(0,A.useCallback)((l,h)=>{l.onDidFocusEditorText(()=>l.trigger(v.id,v.id,{})),l.onDidChangeModelContent(()=>{l.getModel()?.getValue().trim()===""&&l.trigger(v.id,v.id,{})}),l.addCommand(h.KeyMod.Shift|h.KeyCode.Enter,()=>{const p=l.getValue();c(p)})},[c]),E=async l=>{n.current=l,i.current=await lt(l,Mr,r.pplCompletionItemProviderFunc({region:e.region,logGroups:e.logGroups}))};return(0,a.jsx)(ot.B,{...wr,language:Mr.id,value:e.expression??"",onBlur:l=>{l!==e.expression&&c(l),i.current?.dispose()},onFocus:o,onBeforeEditorMount:E,onEditorDidMount:u,onEditorWillUnmount:()=>i.current?.dispose()})},Da=t=>{const{query:e,datasource:r,onChange:s}=t,n=(0,A.useRef)(),i=(0,A.useRef)(),o=(0,A.useCallback)(async()=>{i.current=await xr(n.current,Sr,r.logsCompletionItemProviderFunc({region:e.region,logGroups:e.logGroups}),i.current)},[r,e.logGroups,e.region]),c=(0,A.useCallback)(l=>{const h={...e,expression:l,statsGroups:Dr(l)};s(h)},[s,e]),u=(0,A.useCallback)((l,h)=>{l.onDidFocusEditorText(()=>l.trigger(v.id,v.id,{})),l.onDidChangeModelContent(()=>{l.getModel()?.getValue().trim()===""&&l.trigger(v.id,v.id,{})}),l.addCommand(h.KeyMod.Shift|h.KeyCode.Enter,()=>{const p=l.getValue();c(p)})},[c]),E=async l=>{n.current=l,i.current=await lt(l,Sr,r.logsCompletionItemProviderFunc({region:e.region,logGroups:e.logGroups}))};return(0,a.jsx)(ot.B,{...wr,language:Sr.id,value:e.expression??"",onBlur:l=>{l!==e.expression&&c(l),i.current?.dispose()},onFocus:o,onBeforeEditorMount:E,onEditorDidMount:u,onEditorWillUnmount:()=>i.current?.dispose()})},Ma=t=>{const{query:e,datasource:r,onChange:s}=t,n=(0,A.useRef)(),i=(0,A.useRef)(),o=(0,A.useCallback)(async()=>{i.current=await xr(n.current,Tr,r.logsSqlCompletionItemProviderFunc({region:e.region,logGroups:e.logGroups}),i.current)},[r,e.logGroups,e.region]),c=(0,A.useCallback)(l=>{const h={...e,expression:l,statsGroups:Dr(l)};s(h)},[s,e]),u=(0,A.useCallback)((l,h)=>{l.onDidFocusEditorText(()=>l.trigger(v.id,v.id,{})),l.onDidChangeModelContent(()=>{l.getModel()?.getValue().trim()===""&&l.trigger(v.id,v.id,{})}),l.addCommand(h.KeyMod.Shift|h.KeyCode.Enter,()=>{const p=l.getValue();c(p)})},[c]),E=async l=>{n.current=l,i.current=await lt(l,Tr,r.logsSqlCompletionItemProviderFunc({region:e.region,logGroups:e.logGroups}))};return(0,a.jsx)(ot.B,{...wr,language:Tr.id,value:e.expression??"",onBlur:l=>{l!==e.expression&&c(l),i.current?.dispose()},onFocus:o,onBeforeEditorMount:E,onEditorDidMount:u,onEditorWillUnmount:()=>i.current?.dispose()})},wa=t=>{const{query:e,datasource:r,onChange:s,ExtraFieldElement:n}=t,i=(0,M.of)(Fa),o=(0,A.useCallback)(async c=>{s(c)},[s]);return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(Is,{region:e.region,datasource:r,legacyLogGroupNames:e.logGroupNames,logGroups:e.logGroups,onChange:c=>{o({...e,logGroups:c,logGroupNames:void 0})},legacyOnChange:c=>{o({...e,logGroupNames:c})}}),(0,a.jsxs)("div",{children:[_a(e,r,s),(0,a.jsx)("div",{className:i.editor,children:n})]})]})},Fa=t=>({editor:(0,C.css)({marginTop:t.spacing(1)})}),_a=(t,e,r)=>{switch(t.queryLanguage){case T._M.PPL:return(0,a.jsx)(ba,{query:t,datasource:e,onChange:r});case T._M.SQL:return(0,a.jsx)(Ma,{query:t,datasource:e,onChange:r});default:return(0,a.jsx)(Da,{query:t,datasource:e,onChange:r})}},Pa=[{label:"Logs Insights QL",value:T._M.CWLI},{label:"OpenSearch SQL",value:T._M.SQL},{label:"OpenSearch PPL",value:T._M.PPL}],Wa=(0,A.memo)(function(e){const{query:r,data:s,datasource:n,onChange:i,extraHeaderElementLeft:o}=e,[c,u]=(0,A.useState)(!0),E=(0,A.useCallback)(h=>{i(c?{...r,expression:Ss(h),queryLanguage:h??T._M.CWLI}:{...r,queryLanguage:h??T._M.CWLI})},[c,i,r]);(0,Oa.A)(()=>{r.expression&&u(!1)}),(0,A.useEffect)(()=>{c&&!r.expression&&i({...r,expression:Ss(r.queryLanguage)})},[i,r,c]),(0,A.useEffect)(()=>(o?.((0,a.jsx)(At.W,{label:"Query language",value:r.queryLanguage||T._M.CWLI,options:Pa,onChange:({value:h})=>{E(h)}})),()=>{o?.(void 0)}),[o,i,E,r]);const l=h=>{i(h),u(!1)};return(0,a.jsx)(wa,{...e,onChange:l,ExtraFieldElement:(0,a.jsx)(va,{query:r,panelData:s,datasource:n})})}),Ss=t=>{switch(t){case T._M.SQL:return yn;case T._M.PPL:return In;case T._M.CWLI:default:return Tn}};var Ua=m(77824);const Ga=(t,e)=>{const r=(0,A.useMemo)(()=>Ce(t),[t]);return(0,A.useEffect)(()=>{r!==t&&e(r)},[r,t,e]),r};var Ka=m(87667);class Ba{constructor(){this.tokenTypes={Parenthesis:"delimiter.parenthesis.cloudwatch-dynamicLabels",Whitespace:"white.cloudwatch-dynamicLabels",Keyword:"keyword.cloudwatch-dynamicLabels",Delimiter:"delimiter.cloudwatch-dynamicLabels",Operator:"operator.cloudwatch-dynamicLabels",Identifier:"identifier.cloudwatch-dynamicLabels",Type:"type.cloudwatch-dynamicLabels",Function:"predefined.cloudwatch-dynamicLabels",Number:"number.cloudwatch-dynamicLabels",String:"string.cloudwatch-dynamicLabels",Variable:"variable.cloudwatch-dynamicLabels",Comment:"comment.cloudwatch-dynamicLabels",Regexp:"regexp.cloudwatch-dynamicLabels"}}getCompletionProvider(e,r){return{triggerCharacters:[" ","$",",","(","'"],provideCompletionItems:async(s,n)=>{const i=ss(e,r,s,n,this.tokenTypes),c=i?.isWhiteSpace()||i?.isParenthesis()||!i?.range?e.Range.fromPositions(n):i?.range,u=(h,p={})=>({label:h,insertText:h,kind:e.languages.CompletionItemKind.Field,range:c,sortText:$.Medium,...p});let E=[];const l=i?.next;return!i?.isFunction()&&(!l||l.isWhiteSpace())&&(E=Ka.DYNAMIC_LABEL_PATTERNS.map(h=>u(h)),E.push(u("${PROP('Dim.')}",{sortText:$.High,insertText:"${PROP('Dim.$0')} ",insertTextRules:e.languages.CompletionItemInsertTextRule.InsertAsSnippet}))),{suggestions:E}}}}}const Rs={id:"cloudwatch-dynamicLabels",extensions:[],aliases:[],mimetypes:[],loader:()=>Promise.resolve().then(m.bind(m,87667))},Ha=new Ba;function Va({label:t,width:e,onChange:r}){const s=(0,M.$j)(),n=(0,Te.n)({theme:s,width:e}),i=(0,A.useRef)(null),o=(0,A.useCallback)((c,u)=>{c.onDidFocusEditorText(()=>c.trigger(v.id,v.id,{})),c.addCommand(u.KeyMod.Shift|u.KeyCode.Enter,()=>{const l=c.getValue();r(l)});const E=i.current;E!==null&&c.layout({width:E.clientWidth,height:E.clientHeight})},[r]);return(0,a.jsx)("div",{ref:i,className:(0,C.cx)(n.wrapper),children:(0,a.jsx)(ot.B,{containerStyles:(0,C.css)({border:`1px solid ${s.colors.action.disabledBackground}`,"&:hover":{borderColor:s.components.input.borderColor}}),monacoOptions:{scrollBeyondLastLine:!1,fontSize:14,lineNumbers:"off",renderLineHighlight:"none",overviewRulerLanes:0,scrollbar:{vertical:"hidden",horizontal:"hidden"},suggestFontSize:12,padding:{top:6}},language:Rs.id,value:t,onBlur:c=>{c!==t&&r(c)},onBeforeEditorMount:c=>lt(c,Rs,Ha),onEditorDidMount:o})})}const Cs={id:"cloudwatch-MetricMath",extensions:[],aliases:[],mimetypes:[],loader:()=>Promise.resolve().then(m.bind(m,49921))};function ja({expression:t,onChange:e,datasource:r}){const s=(0,A.useRef)(null),n=(0,A.useCallback)((i,o)=>{i.onDidFocusEditorText(()=>i.trigger(v.id,v.id,{})),i.addCommand(o.KeyMod.Shift|o.KeyCode.Enter,()=>{const u=i.getValue();e(u)});const c=()=>{const u=s.current;if(u!==null){const E=Math.min(200,i.getContentHeight()),l=Math.max(32,E);u.style.height=`${l}px`,u.style.width="100%";const h=u.clientWidth;i.layout({width:h,height:l})}};i.onDidContentSizeChange(c),c()},[e]);return(0,a.jsx)("div",{ref:s,children:(0,a.jsx)(ot.B,{monacoOptions:{scrollBeyondLastLine:!1,fontSize:14,lineNumbers:"off",renderLineHighlight:"none",scrollbar:{vertical:"hidden",horizontal:"hidden"},suggestFontSize:12,wordWrap:"on",padding:{top:6}},language:Cs.id,value:t,onBlur:i=>{i!==t&&e(i)},onBeforeEditorMount:i=>lt(i,Cs,r.metricMathCompletionItemProvider),onEditorDidMount:n})})}var K=m(38242);const $a=["ABORT","ABORTSESSION","ABS","ABSOLUTE","ACCESS","ACCESSIBLE","ACCESS_LOCK","ACCOUNT","ACOS","ACOSH","ACTION","ADD","ADD_MONTHS","ADMIN","AFTER","AGGREGATE","ALIAS","ALL","ALLOCATE","ALLOW","ALTER","ALTERAND","AMP","ANALYSE","ANALYZE","AND","ANSIDATE","ANY","ARE","ARRAY","ARRAY_AGG","ARRAY_EXISTS","ARRAY_MAX_CARDINALITY","AS","ASC","ASENSITIVE","ASIN","ASINH","ASSERTION","ASSOCIATE","ASUTIME","ASYMMETRIC","AT","ATAN","ATAN2","ATANH","ATOMIC","AUDIT","AUTHORIZATION","AUX","AUXILIARY","AVE","AVERAGE","AVG","BACKUP","BEFORE","BEGIN","BEGIN_FRAME","BEGIN_PARTITION","BETWEEN","BIGINT","BINARY","BIT","BLOB","BOOLEAN","BOTH","BREADTH","BREAK","BROWSE","BT","BUFFERPOOL","BULK","BUT","BY","BYTE","BYTEINT","BYTES","CALL","CALLED","CAPTURE","CARDINALITY","CASCADE","CASCADED","CASE","CASESPECIFIC","CASE_N","CAST","CATALOG","CCSID","CD","CEIL","CEILING","CHANGE","CHAR","CHAR2HEXINT","CHARACTER","CHARACTERS","CHARACTER_LENGTH","CHARS","CHAR_LENGTH","CHECK","CHECKPOINT","CLASS","CLASSIFIER","CLOB","CLONE","CLOSE","CLUSTER","CLUSTERED","CM","COALESCE","COLLATE","COLLATION","COLLECT","COLLECTION","COLLID","COLUMN","COLUMN_VALUE","COMMENT","COMMIT","COMPLETION","COMPRESS","COMPUTE","CONCAT","CONCURRENTLY","CONDITION","CONNECT","CONNECTION","CONSTRAINT","CONSTRAINTS","CONSTRUCTOR","CONTAINS","CONTAINSTABLE","CONTENT","CONTINUE","CONVERT","CONVERT_TABLE_HEADER","COPY","CORR","CORRESPONDING","COS","COSH","COUNT","COVAR_POP","COVAR_SAMP","CREATE","CROSS","CS","CSUM","CT","CUBE","CUME_DIST","CURRENT","CURRENT_CATALOG","CURRENT_DATE","CURRENT_DEFAULT_TRANSFORM_GROUP","CURRENT_LC_CTYPE","CURRENT_PATH","CURRENT_ROLE","CURRENT_ROW","CURRENT_SCHEMA","CURRENT_SERVER","CURRENT_TIME","CURRENT_TIMESTAMP","CURRENT_TIMEZONE","CURRENT_TRANSFORM_GROUP_FOR_TYPE","CURRENT_USER","CURRVAL","CURSOR","CV","CYCLE","DATA","DATABASE","DATABASES","DATABLOCKSIZE","DATE","DATEFORM","DAY","DAYS","DAY_HOUR","DAY_MICROSECOND","DAY_MINUTE","DAY_SECOND","DBCC","DBINFO","DEALLOCATE","DEC","DECFLOAT","DECIMAL","DECLARE","DEFAULT","DEFERRABLE","DEFERRED","DEFINE","DEGREES","DEL","DELAYED","DELETE","DENSE_RANK","DENY","DEPTH","DEREF","DESC","DESCRIBE","DESCRIPTOR","DESTROY","DESTRUCTOR","DETERMINISTIC","DIAGNOSTIC","DIAGNOSTICS","DICTIONARY","DISABLE","DISABLED","DISALLOW","DISCONNECT","DISK","DISTINCT","DISTINCTROW","DISTRIBUTED","DIV","DO","DOCUMENT","DOMAIN","DOUBLE","DROP","DSSIZE","DUAL","DUMP","DYNAMIC","EACH","ECHO","EDITPROC","ELEMENT","ELSE","ELSEIF","EMPTY","ENABLED","ENCLOSED","ENCODING","ENCRYPTION","END","END-EXEC","ENDING","END_FRAME","END_PARTITION","EQ","EQUALS","ERASE","ERRLVL","ERROR","ERRORFILES","ERRORTABLES","ESCAPE","ESCAPED","ET","EVERY","EXCEPT","EXCEPTION","EXCLUSIVE","EXEC","EXECUTE","EXISTS","EXIT","EXP","EXPLAIN","EXTERNAL","EXTRACT","FALLBACK","FALSE","FASTEXPORT","FENCED","FETCH","FIELDPROC","FILE","FILLFACTOR","FILTER","FINAL","FIRST","FIRST_VALUE","FLOAT","FLOAT4","FLOAT8","FLOOR","FOR","FORCE","FOREIGN","FORMAT","FOUND","FRAME_ROW","FREE","FREESPACE","FREETEXT","FREETEXTTABLE","FREEZE","FROM","FULL","FULLTEXT","FUNCTION","FUSION","GE","GENERAL","GENERATED","GET","GIVE","GLOBAL","GO","GOTO","GRANT","GRAPHIC","GROUP","GROUPING","GROUPS","GT","HANDLER","HASH","HASHAMP","HASHBAKAMP","HASHBUCKET","HASHROW","HAVING","HELP","HIGH_PRIORITY","HOLD","HOLDLOCK","HOUR","HOURS","HOUR_MICROSECOND","HOUR_MINUTE","HOUR_SECOND","IDENTIFIED","IDENTITY","IDENTITYCOL","IDENTITY_INSERT","IF","IGNORE","ILIKE","IMMEDIATE","IN","INCLUSIVE","INCONSISTENT","INCREMENT","INDEX","INDICATOR","INFILE","INHERIT","INITIAL","INITIALIZE","INITIALLY","INITIATE","INNER","INOUT","INPUT","INS","INSENSITIVE","INSERT","INSTEAD","INT","INT1","INT2","INT3","INT4","INT8","INTEGER","INTEGERDATE","INTERSECT","INTERSECTION","INTERVAL","INTO","IO_AFTER_GTIDS","IO_BEFORE_GTIDS","IS","ISNULL","ISOBID","ISOLATION","ITERATE","JAR","JOIN","JOURNAL","JSON_ARRAY","JSON_ARRAYAGG","JSON_EXISTS","JSON_OBJECT","JSON_OBJECTAGG","JSON_QUERY","JSON_TABLE","JSON_TABLE_PRIMITIVE","JSON_VALUE","KEEP","KEY","KEYS","KILL","KURTOSIS","LABEL","LAG","LANGUAGE","LARGE","LAST","LAST_VALUE","LATERAL","LC_CTYPE","LE","LEAD","LEADING","LEAVE","LEFT","LESS","LEVEL","LIKE","LIKE_REGEX","LIMIT","LINEAR","LINENO","LINES","LISTAGG","LN","LOAD","LOADING","LOCAL","LOCALE","LOCALTIME","LOCALTIMESTAMP","LOCATOR","LOCATORS","LOCK","LOCKING","LOCKMAX","LOCKSIZE","LOG","LOG10","LOGGING","LOGON","LONG","LONGBLOB","LONGTEXT","LOOP","LOWER","LOW_PRIORITY","LT","MACRO","MAINTAINED","MAP","MASTER_BIND","MASTER_SSL_VERIFY_SERVER_CERT","MATCH","MATCHES","MATCH_NUMBER","MATCH_RECOGNIZE","MATERIALIZED","MAVG","MAX","MAXEXTENTS","MAXIMUM","MAXVALUE","MCHARACTERS","MDIFF","MEDIUMBLOB","MEDIUMINT","MEDIUMTEXT","MEMBER","MERGE","METHOD","MICROSECOND","MICROSECONDS","MIDDLEINT","MIN","MINDEX","MINIMUM","MINUS","MINUTE","MINUTES","MINUTE_MICROSECOND","MINUTE_SECOND","MLINREG","MLOAD","MLSLABEL","MOD","MODE","MODIFIES","MODIFY","MODULE","MONITOR","MONRESOURCE","MONSESSION","MONTH","MONTHS","MSUBSTR","MSUM","MULTISET","NAMED","NAMES","NATIONAL","NATURAL","NCHAR","NCLOB","NE","NESTED_TABLE_ID","NEW","NEW_TABLE","NEXT","NEXTVAL","NO","NOAUDIT","NOCHECK","NOCOMPRESS","NONCLUSTERED","NONE","NORMALIZE","NOT","NOTNULL","NOWAIT","NO_WRITE_TO_BINLOG","NTH_VALUE","NTILE","NULL","NULLIF","NULLIFZERO","NULLS","NUMBER","NUMERIC","NUMPARTS","OBID","OBJECT","OBJECTS","OCCURRENCES_REGEX","OCTET_LENGTH","OF","OFF","OFFLINE","OFFSET","OFFSETS","OLD","OLD_TABLE","OMIT","ON","ONE","ONLINE","ONLY","OPEN","OPENDATASOURCE","OPENQUERY","OPENROWSET","OPENXML","OPERATION","OPTIMIZATION","OPTIMIZE","OPTIMIZER_COSTS","OPTION","OPTIONALLY","OR","ORDER","ORDINALITY","ORGANIZATION","OUT","OUTER","OUTFILE","OUTPUT","OVER","OVERLAPS","OVERLAY","OVERRIDE","PACKAGE","PAD","PADDED","PARAMETER","PARAMETERS","PART","PARTIAL","PARTITION","PARTITIONED","PARTITIONING","PASSWORD","PATH","PATTERN","PCTFREE","PER","PERCENT","PERCENTILE","PERCENTILE_CONT","PERCENTILE_DISC","PERCENT_RANK","PERIOD","PERM","PERMANENT","PIECESIZE","PIVOT","PLACING","PLAN","PORTION","POSITION","POSITION_REGEX","POSTFIX","POWER","PRECEDES","PRECISION","PREFIX","PREORDER","PREPARE","PRESERVE","PREVVAL","PRIMARY","PRINT","PRIOR","PRIQTY","PRIVATE","PRIVILEGES","PROC","PROCEDURE","PROFILE","PROGRAM","PROPORTIONAL","PROTECTION","PSID","PTF","PUBLIC","PURGE","QUALIFIED","QUALIFY","QUANTILE","QUERY","QUERYNO","RADIANS","RAISERROR","RANDOM","RANGE","RANGE_N","RANK","RAW","READ","READS","READTEXT","READ_WRITE","REAL","RECONFIGURE","RECURSIVE","REF","REFERENCES","REFERENCING","REFRESH","REGEXP","REGR_AVGX","REGR_AVGY","REGR_COUNT","REGR_INTERCEPT","REGR_R2","REGR_SLOPE","REGR_SXX","REGR_SXY","REGR_SYY","RELATIVE","RELEASE","RENAME","REPEAT","REPLACE","REPLICATION","REPOVERRIDE","REQUEST","REQUIRE","RESIGNAL","RESOURCE","RESTART","RESTORE","RESTRICT","RESULT","RESULT_SET_LOCATOR","RESUME","RET","RETRIEVE","RETURN","RETURNING","RETURNS","REVALIDATE","REVERT","REVOKE","RIGHT","RIGHTS","RLIKE","ROLE","ROLLBACK","ROLLFORWARD","ROLLUP","ROUND_CEILING","ROUND_DOWN","ROUND_FLOOR","ROUND_HALF_DOWN","ROUND_HALF_EVEN","ROUND_HALF_UP","ROUND_UP","ROUTINE","ROW","ROWCOUNT","ROWGUIDCOL","ROWID","ROWNUM","ROWS","ROWSET","ROW_NUMBER","RULE","RUN","RUNNING","SAMPLE","SAMPLEID","SAVE","SAVEPOINT","SCHEMA","SCHEMAS","SCOPE","SCRATCHPAD","SCROLL","SEARCH","SECOND","SECONDS","SECOND_MICROSECOND","SECQTY","SECTION","SECURITY","SECURITYAUDIT","SEEK","SEL","SELECT","SEMANTICKEYPHRASETABLE","SEMANTICSIMILARITYDETAILSTABLE","SEMANTICSIMILARITYTABLE","SENSITIVE","SEPARATOR","SEQUENCE","SESSION","SESSION_USER","SET","SETRESRATE","SETS","SETSESSRATE","SETUSER","SHARE","SHOW","SHUTDOWN","SIGNAL","SIMILAR","SIMPLE","SIN","SINH","SIZE","SKEW","SKIP","SMALLINT","SOME","SOUNDEX","SOURCE","SPACE","SPATIAL","SPECIFIC","SPECIFICTYPE","SPOOL","SQL","SQLEXCEPTION","SQLSTATE","SQLTEXT","SQLWARNING","SQL_BIG_RESULT","SQL_CALC_FOUND_ROWS","SQL_SMALL_RESULT","SQRT","SS","SSL","STANDARD","START","STARTING","STARTUP","STAT","STATE","STATEMENT","STATIC","STATISTICS","STAY","STDDEV_POP","STDDEV_SAMP","STEPINFO","STOGROUP","STORED","STORES","STRAIGHT_JOIN","STRING_CS","STRUCTURE","STYLE","SUBMULTISET","SUBSCRIBER","SUBSET","SUBSTR","SUBSTRING","SUBSTRING_REGEX","SUCCEEDS","SUCCESSFUL","SUM","SUMMARY","SUSPEND","SYMMETRIC","SYNONYM","SYSDATE","SYSTEM","SYSTEM_TIME","SYSTEM_USER","SYSTIMESTAMP","TABLE","TABLESAMPLE","TABLESPACE","TAN","TANH","TBL_CS","TEMPORARY","TERMINATE","TERMINATED","TEXTSIZE","THAN","THEN","THRESHOLD","TIME","TIMESTAMP","TIMEZONE_HOUR","TIMEZONE_MINUTE","TINYBLOB","TINYINT","TINYTEXT","TITLE","TO","TOP","TRACE","TRAILING","TRAN","TRANSACTION","TRANSLATE","TRANSLATE_CHK","TRANSLATE_REGEX","TRANSLATION","TREAT","TRIGGER","TRIM","TRIM_ARRAY","TRUE","TRUNCATE","TRY_CONVERT","TSEQUAL","TYPE","UC","UESCAPE","UID","UNDEFINED","UNDER","UNDO","UNION","UNIQUE","UNKNOWN","UNLOCK","UNNEST","UNPIVOT","UNSIGNED","UNTIL","UPD","UPDATE","UPDATETEXT","UPPER","UPPERCASE","USAGE","USE","USER","USING","UTC_DATE","UTC_TIME","UTC_TIMESTAMP","VALIDATE","VALIDPROC","VALUE","VALUES","VALUE_OF","VARBINARY","VARBYTE","VARCHAR","VARCHAR2","VARCHARACTER","VARGRAPHIC","VARIABLE","VARIADIC","VARIANT","VARYING","VAR_POP","VAR_SAMP","VCAT","VERBOSE","VERSIONING","VIEW","VIRTUAL","VOLATILE","VOLUMES","WAIT","WAITFOR","WHEN","WHENEVER","WHERE","WHILE","WIDTH_BUCKET","WINDOW","WITH","WITHIN","WITHIN_GROUP","WITHOUT","WLM","WORK","WRITE","WRITETEXT","XMLCAST","XMLEXISTS","XMLNAMESPACES","XOR","YEAR","YEARS","YEAR_MONTH","ZEROFILL","ZEROIFNULL","ZONE"],Ls=t=>!!(t&&t!=="all");class Os{constructor(e=(0,Ie.w)()){this.templateSrv=e}expressionToSqlQuery({select:e,from:r,where:s,groupBy:n,orderBy:i,orderByDirection:o,limit:c},u){if(!r||!e?.name||!e?.parameters?.length)return;let E=[];return this.appendSelect(e,E),this.appendFrom(r,E),this.appendAccountId(E,u),this.appendWhere(s,E,!0,s?.expressions?.length??0,u),this.appendGroupBy(n,E),this.appendOrderBy(i,o,E),this.appendLimit(c,E),E.join(" ")}appendSelect(e,r){r.push("SELECT"),this.appendFunction(e,r)}appendFrom(e,r){r.push("FROM"),e?.type===K._W.Function?this.appendFunction(e,r):r.push(this.formatValue(e?.property?.name??""))}appendAccountId(e,r){Ls(r)&&e.push(`WHERE AWS.AccountId = '${r}'`)}appendWhere(e,r,s,n,i){if(!e)return;const o="expressions"in e&&e.expressions.length>0;if(s&&o&&(Ls(i)?r.push("AND"):r.push("WHERE")),e.type===K._W.And){const c=[];if(e.expressions.map(l=>this.appendWhere(l,c,!1,n)),c.length===0)return;const u=c.join(" AND "),E=!s&&n>1&&c.length>1;return r.push(E?`(${u})`:u)}if(e.type===K._W.Or){const c=[];if(e.expressions.map(l=>this.appendWhere(l,c,!1,n)),c.length===0)return;const u=c.join(" OR "),E=!s&&n>1&&c.length>1;r.push(E?`(${u})`:u);return}if(e.type===K._W.Operator)return this.appendOperator(e,r)}appendGroupBy(e,r){const s=[];for(const n of e?.expressions??[])n?.type!==K._W.GroupBy||!n.property.name||s.push(this.formatValue(n.property.name));s.length>0&&r.push(`GROUP BY ${s.join(", ")}`)}appendOrderBy(e,r,s){e&&(s.push("ORDER BY"),this.appendFunction(e,s),s.push(r??"ASC"))}appendLimit(e,r){e&&r.push(`LIMIT ${e}`)}appendOperator(e,r,s){const{property:n,operator:i}=e;!n.name||!i.name||!i.value||r.push(`${this.formatValue(n.name)} ${i.name} '${i.value}'`)}appendFunction(e,r){if(!e?.name)return;const s=(e.parameters??[]).map(n=>n.name&&this.formatValue(n.name)).filter(Boolean).join(", ");r.push(`${e.name}(${s})`)}formatValue(e){const r=/[/\s\.%-]/,s=/^\d/,n=this.templateSrv.replace(e,{},"raw");return n!=="AWS.AccountId"&&(r.test(n)||s.test(n)||$a.some(i=>(0,se.toLower)(i)===(0,se.toLower)(n)))?`"${e}"`:e}}function Fr(t){return t?.parameters?.[0].name}function Ht(t){if(t?.type===K._W.Property)return t.property.name;if(t?.type===K._W.Function)return t.parameters?.[0].name}function ka(t){if(t?.type===K._W.Function&&t?.parameters?.length)return t?.parameters?.length<=1?[]:(t?.parameters.slice(1)).reduce((r,s)=>s.name?[...r,s.name]:r,[])}function Qa(t){return t?.type===K._W.Function&&t.name===x.SCHEMA}function Ya(t){const e=t.property?.name,r=t.operator?.value,s=t.operator?.name;if(e&&r&&s)return{type:K._W.Operator,property:{type:K.Dw.String,name:e},operator:{value:r,name:s}}}function Ns(t){return t.flatMap(e=>e.type===K._W.Operator?e:e.type===K._W.And||e.type===K._W.Or?Ns(e.expressions):[])}function za(t){const e=t.where;return Ns(e?.expressions??[])}function Xa(t){return t.flatMap(e=>e.type===K._W.GroupBy?e:[])}function Za(t){const e=t.groupBy;return Xa(e?.expressions??[])}function Ja(t){return t.reduce((e,r)=>r?{...e,[r]:null}:e,{})}function Ae(t,e){return{...t,sql:{...t.sql??{},...e}}}function qa(t,e){const r=t.sql??{};if(t.namespace=e||"",e===void 0)return Ae(t,{from:void 0});if(!r.from||r.from.type===K._W.Property)return Ae(t,{from:{type:K._W.Property,property:{type:K.Dw.String,name:e}}});if(r.from.type===K._W.Function){const s={type:K._W.FunctionParameter,name:e},n=(r.from.parameters??[]).slice(1);return Ae(t,{from:{type:K._W.Function,name:x.SCHEMA,parameters:[s,...n]}})}return t}function eo(t,e){const r=t.sql??{};if(e=Array.isArray(e)?e.map(s=>s.value):[e.value],r.from?.type===K._W.Function&&r.from.parameters?.length){const s=(e??[]).map(i=>({type:K._W.FunctionParameter,name:i})),n=(r.from.parameters??[])[0];return Ae(t,{from:{type:K._W.Function,name:x.SCHEMA,parameters:[n,...s]}})}return t}function to(t,e){const r={type:K._W.FunctionParameter,name:e};return Ae({...t,metricName:e},{select:{type:K._W.Function,...t.sql?.select??{},parameters:[r]}})}function ro(t){const e={...t};return delete e.sql?.select?.parameters,e}function vs(t,e){return Ae(t,{select:{type:K._W.Function,...t.sql?.select??{},name:e}})}function so(t,e){return Ae(t,{orderBy:{type:K._W.Function,name:e}})}function no(t,e){const r=Ht((t.sql??{}).from);if(e){const s={type:K._W.FunctionParameter,name:r};return Ae(t,{from:{type:K._W.Function,name:x.SCHEMA,parameters:[s]}})}return Ae(t,{from:{type:K._W.Property,property:{type:K.Dw.String,name:r}}})}function io(t,e){return{type:K._W.Operator,property:{type:K.Dw.String,name:e},operator:t.operator??{}}}function ao(t,e){return{type:K._W.Operator,property:t.property??{type:K.Dw.String},operator:{...t.operator,name:e}}}function oo(t,e){return{type:K._W.Operator,property:t.property??{type:K.Dw.String},operator:{...t.operator,value:e}}}function lo(t){return{type:K._W.GroupBy,property:{type:K.Dw.String,name:t}}}const co=x.STATISTICS.map(ae.z),uo=({datasource:t,query:e,onQueryChange:r})=>{const s=e.sql??{},n=s.select?.name;(0,A.useEffect)(()=>{n||r(vs(e,x.STATISTICS[0]))},[n,r,e]);const i=Fr(s.select),o=Ht(s.from),c=ka(s.from),u=Qa(s.from),E=gr(t),l=Er(t,{region:e.region,namespace:o,..._.$.featureToggles.cloudWatchCrossAccountQuerying&&{accountId:e.accountId}}),h=(0,A.useMemo)(()=>Ja(c??[]),[c]),p=Tt(t,{region:e.region,namespace:o,metricName:i,dimensionFilters:h,..._.$.featureToggles.cloudWatchCrossAccountQuerying&&{accountId:e.accountId}}),I=(0,A.useMemo)(()=>c?.length?[...p,...c.map(ae.z)]:p,[p,c]),L=async N=>{const P=await F(N);r(P)},F=async N=>{let{region:P,sql:X,namespace:de}=N;return await t.resources.getMetrics({namespace:de,region:P}).then(Fe=>{Fe.some(Nt=>Nt.value===i)||(X=ro(N).sql)}),{...N,sql:X}},D=wt(t.resources,e.region);return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(Ft.B,{children:[_.$.featureToggles.cloudWatchCrossAccountQuerying&&(0,a.jsx)(hr,{accountId:e.accountId,accountOptions:D.value||[],onChange:N=>{r({...e,accountId:N})}}),(0,a.jsx)(z.c,{label:"Namespace",width:16,children:(0,a.jsx)(oe.l6,{"aria-label":"Namespace",value:o?(0,ae.z)(o):null,inputId:`${e.refId}-cloudwatch-sql-namespace`,options:E,allowCustomValue:!0,onChange:({value:N})=>N&&L(qa(e,N))})}),(0,a.jsx)(z.c,{label:"With schema",children:(0,a.jsx)(dr.C,{id:`${e.refId}-cloudwatch-sql-withSchema`,value:u,onChange:N=>N.target instanceof HTMLInputElement&&r(no(e,N.target.checked))})}),u&&(0,a.jsx)(z.c,{label:"Schema labels",disabled:!o,children:(0,a.jsx)(oe.l6,{id:`${e.refId}-cloudwatch-sql-schema-label-keys`,width:"auto",isMulti:!0,value:c?c.map(ae.z):null,options:I,allowCustomValue:!0,onChange:N=>N&&r(eo(e,N))})})]}),(0,a.jsxs)(Ft.B,{children:[(0,a.jsx)(z.c,{label:"Metric name",width:16,children:(0,a.jsx)(oe.l6,{"aria-label":"Metric name",value:i?(0,ae.z)(i):null,options:l,allowCustomValue:!0,onChange:({value:N})=>N&&r(to(e,N))})}),(0,a.jsx)(z.c,{label:"Aggregation",width:16,children:(0,a.jsx)(oe.l6,{"aria-label":"Aggregation",value:n?(0,ae.z)(n):null,options:me(t,co),onChange:({value:N})=>N&&r(vs(e,N))})})]})]})},mo=x.COMPARISON_OPERATORS.map(ae.z),po=({query:t,onQueryChange:e,datasource:r})=>{const s=(0,A.useMemo)(()=>za(t.sql??{}),[t.sql]),[n,i]=(0,A.useState)(s),o=c=>{const u=c.map(h=>({type:K._W.Operator,property:h.property??{type:K.Dw.String},operator:h.operator??{name:x.EQUALS}}));i(u);const E=[];for(const h of u){const p=Ya(h);p&&E.push(p)}const l=E.length?{type:K._W.And,expressions:E}:void 0;e(Ae(t,{where:l}))};return(0,a.jsx)(Pt.o,{items:n,onChange:o,renderItem:go(r,t)})};function go(t,e){function r(s,n,i){return(0,a.jsx)(ho,{datasource:t,query:e,filter:s,onChange:n,onDelete:i})}return r}const Eo=po,ho=t=>{const{datasource:e,query:r,filter:s,onChange:n,onDelete:i}=t,o=(0,M.of)(fo),c=r.sql??{},u=Ht(c.from),E=Fr(c.select),l=Tt(e,{region:r.region,namespace:u,metricName:E,..._.$.featureToggles.cloudWatchCrossAccountQuerying&&{accountId:r.accountId}}),h=async()=>!s.property?.name||!u?[]:e.resources.getDimensionValues({region:r.region,namespace:u,metricName:E,dimensionKey:s.property.name,..._.$.featureToggles.cloudWatchCrossAccountQuerying&&{accountId:r.accountId}}).then(D=>me(e,D)),[p,I]=(0,mr.A)(h,[r.region,u,E,s.property?.name]),L=It(e,s.property?.name),F=It(e,typeof s.operator?.value=="string"?s.operator?.value:void 0);return(0,a.jsxs)("div",{className:o.container,children:[(0,a.jsxs)(yt.M,{children:[(0,a.jsx)(oe.l6,{width:"auto",value:s.property?.name?(0,ae.z)(s.property?.name):null,options:l,allowCustomValue:!0,onChange:({value:D})=>D&&n(io(s,D))}),(0,a.jsx)(oe.l6,{width:"auto",value:s.operator?.name&&(0,ae.z)(s.operator.name),options:mo,onChange:({value:D})=>D&&n(ao(s,D))}),(0,a.jsx)(oe.l6,{width:"auto",isLoading:p.loading,value:s.operator?.value&&typeof s.operator?.value=="string"?(0,ae.z)(s.operator?.value):null,options:p.value,allowCustomValue:!0,onOpenMenu:I,onChange:({value:D})=>D&&n(oo(s,D))}),(0,a.jsx)(St.Z,{"aria-label":"remove",icon:"times",variant:"secondary",onClick:i})]}),L&&(0,a.jsx)(Me.F,{className:o.alert,title:L,severity:"error",topSpacing:1}),F&&(0,a.jsx)(Me.F,{className:o.alert,title:F,severity:"error",topSpacing:1})]})},fo=()=>({container:(0,C.css)({display:"inline-block"}),alert:(0,C.css)({minWidth:"100%",width:"min-content"})}),Ao=({query:t,datasource:e,onQueryChange:r})=>{const s=t.sql??{},n=(0,A.useMemo)(()=>Za(t.sql??{}),[t.sql]),[i,o]=(0,A.useState)(n),c=Qr(e.resources,t.region),u=Ht(s.from),E=Fr(s.select),l=Tt(e,{region:t.region,namespace:u,metricName:E}),h=(0,A.useMemo)(()=>(_.$.featureToggles.cloudWatchCrossAccountQuerying&&c?[{label:"Account ID",value:"AWS.AccountId"},...l]:l).filter(F=>!n.some(D=>D.property.name===F.value)),[l,n,c]),p=I=>{const L=I.map(N=>({type:K._W.GroupBy,property:{type:K.Dw.String,name:N.property?.name}}));o(L);const F=L.filter(N=>N.property?.name),D=F.length?{type:K._W.And,expressions:F}:void 0;r(Ae(t,{groupBy:D}))};return(0,a.jsx)(Pt.o,{items:i,onChange:p,renderItem:To(h)})};function To(t){function e(r,s,n){return(0,a.jsx)(Io,{options:t,item:r,onChange:s,onDelete:n})}return e}const Io=t=>{const{options:e,item:r,onChange:s,onDelete:n}=t,i=r.property?.name;return(0,a.jsxs)(yt.M,{children:[(0,a.jsx)(oe.l6,{"aria-label":`Group by ${i??"filter key"}`,width:"auto",value:i?(0,ae.z)(i):null,options:e,allowCustomValue:!0,onChange:({value:o})=>o&&s(lo(o))}),(0,a.jsx)(St.Z,{"aria-label":"remove",icon:"times",variant:"secondary",onClick:n})]})},yo=Ao,xs=[{label:x.ASC,value:x.ASC},{label:x.DESC,value:x.DESC}],So=({query:t,onQueryChange:e,datasource:r})=>{const s=t.sql??{},n=s.orderBy?.name,i=s.orderByDirection;return(0,a.jsxs)(Ft.B,{children:[(0,a.jsx)(z.c,{label:"Order by",optional:!0,width:16,children:(0,a.jsxs)(yt.M,{children:[(0,a.jsx)(oe.l6,{"aria-label":"Order by",onChange:({value:o})=>o&&e(so(t,o)),options:me(r,x.STATISTICS.map(ae.z)),value:n?(0,ae.z)(n):null}),n&&(0,a.jsx)(St.Z,{"aria-label":"remove",icon:"times",variant:"secondary",onClick:()=>e(Ae(t,{orderBy:void 0}))})]})}),(0,a.jsx)(z.c,{label:"Direction",disabled:!n,width:16,children:(0,a.jsx)(oe.l6,{"aria-label":"Direction",inputId:"cloudwatch-sql-order-by-direction",value:i?(0,ae.z)(i):xs[0],options:me(r,xs),onChange:o=>o&&e(Ae(t,{orderByDirection:o.value}))})})]})},Ro=({query:t,datasource:e,onChange:r})=>{const s=t.sql??{},n=(0,A.useCallback)(c=>{const E=new Os().expressionToSqlQuery(c.sql??{},c.accountId),l={...c,sqlExpression:E};r(l)},[r]),[i,o]=(0,A.useState)();return(0,A.useEffect)(()=>{const u=new Os().expressionToSqlQuery(t.sql??{},t.accountId);i!==u&&o(u)},[t,i,o]),(0,a.jsxs)(Yr.D,{children:[(0,a.jsx)(Ve.U,{children:(0,a.jsx)(uo,{query:t,onQueryChange:n,datasource:e})}),(0,a.jsx)(Ve.U,{children:(0,a.jsx)(z.c,{label:"Filter",optional:!0,children:(0,a.jsx)(Eo,{query:t,onQueryChange:n,datasource:e})})}),(0,a.jsxs)(Ve.U,{children:[(0,a.jsx)(z.c,{label:"Group by",optional:!0,children:(0,a.jsx)(yo,{query:t,onQueryChange:n,datasource:e})}),(0,a.jsx)(So,{query:t,onQueryChange:n,datasource:e}),(0,a.jsx)(z.c,{label:"Limit",optional:!0,children:(0,a.jsx)(Te.p,{id:`${t.refId}-cloudwatch-sql-builder-editor-limit`,value:s.limit,onChange:c=>{const u=c.currentTarget.valueAsNumber;n(Ae(t,{limit:isNaN(u)?void 0:u}))},type:"number",min:1})})]}),i&&(0,a.jsxs)(Ve.U,{children:[!1,(0,a.jsx)("pre",{children:i??""})]})]})},bs={id:"cloudwatch-sql",extensions:[".cloudwatchSql"],aliases:["CloudWatch","cloudwatch","CloudWatchSQL"],mimetypes:[],loader:()=>Promise.resolve().then(m.bind(m,58969))},Co=({region:t,sql:e,onChange:r,datasource:s})=>{(0,A.useEffect)(()=>{s.sqlCompletionItemProvider.setRegion(t)},[t,s]);const n=(0,A.useCallback)((i,o)=>{i.onDidFocusEditorText(()=>i.trigger(v.id,v.id,{})),i.addCommand(o.KeyMod.Shift|o.KeyCode.Enter,()=>{const c=i.getValue();r(c)})},[r]);return(0,a.jsx)(ot.B,{height:"150px",language:bs.id,value:e,onBlur:i=>{i!==e&&r(i)},showMiniMap:!1,showLineNumbers:!0,onBeforeEditorMount:i=>lt(i,bs,s.sqlCompletionItemProvider),onEditorDidMount:n})},Ds=[{label:"Metric Search",value:T.d$.Search},{label:"Metric Insights",value:T.d$.Insights}],Lo=[{label:"Builder",value:T.Rx.Builder},{label:"Code",value:T.Rx.Code}],Oo=t=>{const{query:e,datasource:r,extraHeaderElementLeft:s,extraHeaderElementRight:n,onChange:i}=t,[o,c]=(0,A.useState)(!1),[u,E]=(0,A.useState)(!1),l=Ga(e,t.onChange),h=(0,A.useCallback)(I=>{if(u&&e.metricQueryType===T.d$.Insights&&e.metricEditorMode===T.Rx.Code){c(!0);return}i({...e,metricEditorMode:I})},[c,i,u,e]),p=()=>{_.$.featureToggles.cloudWatchCrossAccountQuerying&&e.accountId&&r.resources.isMonitoringAccount(e.region).then(I=>{!I&&e.accountId&&i({...e,accountId:void 0})})};return(0,A.useEffect)(p,[r,i,e]),(0,A.useEffect)(()=>(s?.((0,a.jsx)(At.W,{"aria-label":"Metric editor mode",value:Ds.find(I=>I.value===e.metricQueryType),options:Ds,onChange:({value:I})=>{if(u&&e.metricQueryType===T.d$.Search&&e.metricEditorMode===T.Rx.Builder){c(!0);return}i({...e,metricQueryType:I})}})),n?.((0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(Ua.z,{options:Lo,size:"sm",value:e.metricEditorMode,onChange:h}),(0,a.jsx)(As.u,{isOpen:o,title:"Are you sure?",body:"You will lose changes made to the query if you change to Metric Insights Builder mode.",confirmText:"Yes, I am sure.",dismissText:"No, continue editing the query.",icon:"exclamation-triangle",onConfirm:()=>{c(!1),E(!1),i({...e,...Jr,metricQueryType:T.d$.Insights,metricEditorMode:T.Rx.Builder})},onDismiss:()=>c(!1)})]})),()=>{s?.(void 0),n?.(void 0)}),[e,u,r,i,s,n,o,h]),(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(we.$,{v:.5}),e.metricQueryType===T.d$.Search&&(0,a.jsxs)(a.Fragment,{children:[e.metricEditorMode===T.Rx.Builder&&(0,a.jsx)(Zr,{...t,refId:e.refId,metricStat:e,onChange:I=>{u||E(!0),t.onChange({...e,...I})}}),e.metricEditorMode===T.Rx.Code&&(0,a.jsx)(ja,{expression:e.expression??"",onChange:I=>t.onChange({...e,expression:I}),datasource:r})]}),e.metricQueryType===T.d$.Insights&&(0,a.jsxs)(a.Fragment,{children:[e.metricEditorMode===T.Rx.Code&&(0,a.jsx)(Co,{region:e.region,sql:e.sqlExpression??"",onChange:I=>{u||E(!0),t.onChange({...l,sqlExpression:I})},datasource:r}),e.metricEditorMode===T.Rx.Builder&&(0,a.jsx)(a.Fragment,{children:(0,a.jsx)(Ro,{query:e,onChange:t.onChange,datasource:r})})]}),(0,a.jsx)(we.$,{v:.5}),(0,a.jsxs)(Ve.U,{children:[(0,a.jsx)(z.c,{label:"ID",width:26,optional:!0,tooltip:"ID can be used to reference other queries in math expressions. The ID can include numbers, letters, and underscore, and must start with a lowercase letter.",invalid:!!e.id&&!/^$|^[a-z][a-zA-Z0-9_]*$/.test(e.id),children:(0,a.jsx)(Te.p,{id:`${e.refId}-cloudwatch-metric-query-editor-id`,onChange:I=>i({...l,id:I.target.value}),type:"text",value:e.id})}),(0,a.jsx)(z.c,{label:"Period",width:26,tooltip:"Minimum interval between points in seconds.",children:(0,a.jsx)(Te.p,{id:`${e.refId}-cloudwatch-metric-query-editor-period`,value:e.period||"",placeholder:"auto",onChange:I=>i({...l,period:I.target.value})})}),(0,a.jsx)(z.c,{label:"Label",width:26,optional:!0,tooltip:"Change time series legend name using Dynamic labels. See documentation for details.",children:(0,a.jsx)(Va,{width:52,label:l.label??"",onChange:I=>t.onChange({...e,label:I})})})]})]})};var No=m(1906),vo=m(40263),xo=m(99887);const bo=[{label:"CloudWatch Metrics",value:"Metrics"},{label:"CloudWatch Logs",value:"Logs"}],Do=({query:t,onChange:e,datasource:r,extraHeaderElementLeft:s,extraHeaderElementRight:n,dataIsStale:i,data:o,onRunQuery:c})=>{const{queryMode:u,region:E}=t,l=Qr(r.resources,t.region),[h,p]=pr(r),I=te(t)?!t.expression:!1,L=({value:N})=>{N&&N!==u&&e({...r.getDefaultQuery(No.Jk.Unknown),...t,queryMode:N,expression:""})},F=async N=>{if(_.$.featureToggles.cloudWatchCrossAccountQuerying&&re(t)){const P=await r.resources.isMonitoringAccount(N);e({...t,logGroups:[],region:N,accountId:P?t.accountId:void 0})}else e({...t,logGroups:[],region:N})},D=_.$.featureToggles.cloudWatchCrossAccountQuerying&&l;return(0,a.jsx)(a.Fragment,{children:(0,a.jsxs)(kr.X,{children:[(0,a.jsx)(At.W,{label:"Region",value:E,placeholder:"Select region",allowCustomValue:!0,onChange:({value:N})=>N&&F(N),options:h,isLoading:p}),(0,a.jsx)(At.W,{"aria-label":"Query mode",value:u,options:bo,onChange:L,inputId:`cloudwatch-query-mode-${t.refId}`,id:`cloudwatch-query-mode-${t.refId}`}),s,(0,a.jsx)(vo.Z,{grow:1}),D&&(0,a.jsx)(a.Fragment,{children:(0,a.jsx)(xo.E,{text:"Monitoring account",color:"blue",tooltip:"AWS monitoring accounts view data from source accounts so you can centralize monitoring and troubleshoot activities"})}),(0,a.jsx)(ke.$n,{variant:i?"primary":"secondary",size:"sm",onClick:c,icon:o?.state===He.Gu.Loading?"spinner":void 0,disabled:o?.state===He.Gu.Loading||I,children:"Run queries"}),n]})})},Mo=t=>{const{query:e,onChange:r,data:s}=t,n=La(e,t.onChange),[i,o]=(0,A.useState)(!1),[c,u]=(0,A.useState)(),[E,l]=(0,A.useState)();(0,A.useEffect)(()=>{o(!1)},[s]);const h=(0,A.useCallback)(p=>{o(!0),r(p)},[r]);return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(Do,{...t,extraHeaderElementLeft:c,extraHeaderElementRight:E,dataIsStale:i}),re(n)&&(0,a.jsx)(Oo,{...t,query:n,onRunQuery:()=>{},onChange:h,extraHeaderElementLeft:u,extraHeaderElementRight:l}),te(n)&&(0,a.jsx)(Wa,{...t,query:n,onChange:h,extraHeaderElementLeft:u})]})},wo=new w.tD(Es).setQueryEditorHelp(qs).setConfigEditor(fa).setQueryEditor(Mo).setMetadataInspector(Sa);(0,S.J7)().subscribe(R.gc,ze)},87667:(ee,U,m)=>{"use strict";m.r(U),m.d(U,{DYNAMIC_LABEL_PATTERNS:()=>R,conf:()=>a,language:()=>S});var w=m(43173);const R=["${DATAPOINT_COUNT}","${FIRST}","${FIRST_LAST_RANGE}","${FIRST_LAST_TIME_RANGE}","${FIRST_TIME}","${FIRST_TIME_RELATIVE}","${LABEL}","${LAST}","${LAST_TIME}","${LAST_TIME_RELATIVE}","${MAX}","${MAX_TIME}","${MAX_TIME_RELATIVE}","${MIN}","${MIN_MAX_RANGE}","${MIN_MAX_TIME_RANGE}","${MIN_TIME}","${MIN_TIME_RELATIVE}","${PROP('AccountId')}","${PROP('MetricName')}","${PROP('Namespace')}","${PROP('Period')}","${PROP('Region')}","${PROP('Stat')}","${SUM}",...w.$.featureToggles.cloudWatchCrossAccountQuerying?["${PROP('AccountLabel')}"]:[]],S={id:"dynamicLabels",ignoreCase:!1,tokenizer:{root:[{include:"@whitespace"},{include:"@builtInFunctions"},{include:"@string"},[/\$\{PROP\('Dim.[a-zA-Z0-9-_]?.*'\)\}+/,"predefined"]],builtInFunctions:[[R.map(C).join("|"),"predefined"]],whitespace:[[/\s+/,"white"]],string:[]}},a={};function C(W){return W.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}},97969:(ee,U,m)=>{"use strict";m.r(U),m.d(U,{ALL_FUNCTIONS:()=>Ze,ALL_KEYWORDS:()=>me,ARITHMETIC_OPERATORS:()=>Ee,AS:()=>_,BETWEEN:()=>te,BOOLEAN_LITERALS:()=>T,BY:()=>q,CLOUDWATCH_PPL_LANGUAGE_DEFINITION_ID:()=>w,COMPARISON_OPERATORS:()=>qe,CONDITION_FUNCTIONS:()=>Ge,DATE_TIME_FUNCTIONS:()=>ze,DEDUP:()=>a,DEDUP_PARAMETERS:()=>Qe,EVAL:()=>A,EVAL_FUNCTIONS:()=>rt,EVENTSTATS:()=>W,FIELDS:()=>S,FIELD_OPERATORS:()=>st,FROM:()=>re,HEAD:()=>G,IN:()=>Re,LOGICAL_EXPRESSION_OPERATORS:()=>ie,MATH_FUNCTIONS:()=>ve,MINUS:()=>ue,NOT:()=>Je,PARAMETERS_WITH_BOOLEAN_VALUES:()=>Ye,PARSE:()=>B,PLUS:()=>Be,POSITION:()=>Ue,PPL_COMMANDS:()=>j,PPL_FUNCTIONS:()=>Ke,PPL_OPERATORS:()=>nt,RARE:()=>Y,SORT:()=>b,SORT_FIELD_FUNCTIONS:()=>Xe,SPAN:()=>xe,STATS:()=>C,STATS_FUNCTIONS:()=>ne,STATS_PARAMETERS:()=>Ne,TEXT_FUNCTIONS:()=>We,TOP:()=>M,WHERE:()=>R,conf:()=>mt,language:()=>dt});const w="logs-ppl",R="where",S="fields",a="dedup",C="stats",W="eventstats",b="sort",A="eval",G="head",M="top",Y="rare",B="parse",j=[R,S,C,W,a,b,M,Y,G,A,B],_="as",q="by",te="between",re="from",le="keepempty",ye="consecutive",Se="partitions",ge="allnum",Pe="delim",Ce="dedup_splitvalues",Ne=[Se,ge,Pe,Ce],Qe=[le,ye],Ye=[ge,Ce,le,ye],T=["true","false"],Re="in",me=[...Ne,...Qe,...T,_,q,Re,te,re],ve=["abs","acos","asin","atan","atan2","ceil","ceiling","conv","cos","cot","crc32","degrees","e","exp","floor","ln","log","log2","log10","mod","pi","pow","power","radians","rand","round","sign","sin","sqrt","cbrt"],ze=["datediff","day","dayofmonth","dayofweek","dayofyear","hour","minute","second","month","quarter","weekday","weekofyear","year","now","curdate","current_date"],We=["concat","concat_ws","length","lower","ltrim","reverse","rtrim","right","substring","substr","trim","upper"],xe="span",Ue="position",Ge=["like","isnull","isnotnull","exists","ifnull","nullif","if","ispresent"],Xe=["auto","str","ip","num"],Ke=[...ve,...ze,...We],rt=[...Ke,Ue],ne=["avg","count","sum","min","max","stddev_samp","stddev_pop","percentile","percentile_approx","distinct_count","dc"],Ze=[...Ke,...ne,...Ge,...Xe,Ue,xe],Be="+",ue="-",Je="not",st=[Be,ue],Ee=[Be,ue,"*","/","%"],qe=[">",">=","<","!=","<=","="],ie=["and","or","xor",Je],nt=[...Ee,...ie,...qe],dt={defaultToken:"",id:w,ignoreCase:!0,commands:j,operators:nt,keywords:me,builtinFunctions:Ze,brackets:[{open:"(",close:")",token:"delimiter.parenthesis"}],tokenizer:{root:[{include:"@comments"},{include:"@regexes"},{include:"@whitespace"},{include:"@variables"},{include:"@strings"},{include:"@numbers"},[/[,.:]/,"delimiter"],[/\|/,"delimiter.pipe"],[/[()\[\]]/,"delimiter.parenthesis"],[/[\w@#$]+/,{cases:{"@commands":"keyword.command","@keywords":"keyword","@builtinFunctions":"predefined","@operators":"operator","@default":"identifier"}}],[/[+\-*/^%=!<>]/,"operator"],[/[,.:]/,"operator"]],variables:[[/\${/,{token:"variable",next:"@variable_bracket"}],[/\$[a-zA-Z0-9-_]+/,"variable"]],variable_bracket:[[/[a-zA-Z0-9-_:]+/,"variable"],[/}/,{token:"variable",next:"@pop"}]],whitespace:[[/\s+/,"white"]],comments:[[/^#.*/,"comment"],[/\s+#.*/,"comment"]],numbers:[[/0[xX][0-9a-fA-F]*/,"number"],[/[$][+-]*\d*(\.\d*)?/,"number"],[/((\d+(\.\d*)?)|(\.\d+))([eE][\-+]?\d+)?/,"number"]],strings:[[/'/,{token:"string",next:"@string"}],[/"/,{token:"string",next:"@string_double"}],[/`/,{token:"string.backtick",next:"@string_backtick"}]],string:[[/[^']+/,"string"],[/''/,"string"],[/'/,{token:"string",next:"@pop"}]],string_double:[[/[^\\"]+/,"string"],[/"/,"string","@pop"]],string_backtick:[[/[^\\`]+/,"string.backtick"],[/`/,"string.backtick","@pop"]],regexes:[[/\/.*?\/(?!\s*\d)/,"regexp"]]}},mt={brackets:[["(",")"]],autoClosingPairs:[{open:"(",close:")"},{open:'"',close:'"'},{open:"'",close:"'"},{open:"`",close:"`"}],surroundingPairs:[{open:"(",close:")"},{open:'"',close:'"'},{open:"'",close:"'"},{open:"`",close:"`"}]}}}]);

//# sourceMappingURL=9570.c3cfe784e7f9ec76f9c4.js.map