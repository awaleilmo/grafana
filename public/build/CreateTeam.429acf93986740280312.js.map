{"version":3,"file":"CreateTeam.429acf93986740280312.js","mappings":"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","sources":["webpack://grafana/./public/app/features/teams/CreateTeam.tsx","webpack://grafana/./public/app/core/components/RolePicker/hooks.ts","webpack://grafana/./public/app/core/components/RolePicker/TeamRolePicker.tsx"],"sourcesContent":["import { JSX, useState } from 'react';\nimport { useForm } from 'react-hook-form';\n\nimport { NavModelItem } from '@grafana/data';\nimport { Trans, t } from '@grafana/i18n';\nimport { getBackendSrv, locationService } from '@grafana/runtime';\nimport { Button, Field, Input, FieldSet, Stack } from '@grafana/ui';\nimport { Page } from 'app/core/components/Page/Page';\nimport { TeamRolePicker } from 'app/core/components/RolePicker/TeamRolePicker';\nimport { updateTeamRoles } from 'app/core/components/RolePicker/api';\nimport { useRoleOptions } from 'app/core/components/RolePicker/hooks';\nimport { contextSrv } from 'app/core/core';\nimport { Role, AccessControlAction } from 'app/types/accessControl';\nimport { TeamDTO } from 'app/types/teams';\n\nconst pageNav: NavModelItem = {\n  icon: 'users-alt',\n  id: 'team-new',\n  text: 'New team',\n  subTitle: 'Create a new team. Teams let you grant permissions to a group of users.',\n};\n\nexport const CreateTeam = (): JSX.Element => {\n  const currentOrgId = contextSrv.user.orgId;\n  const [pendingRoles, setPendingRoles] = useState<Role[]>([]);\n  const [{ roleOptions }] = useRoleOptions(currentOrgId);\n  const {\n    handleSubmit,\n    register,\n    formState: { errors },\n  } = useForm<TeamDTO>();\n\n  const canUpdateRoles =\n    contextSrv.hasPermission(AccessControlAction.ActionUserRolesAdd) &&\n    contextSrv.hasPermission(AccessControlAction.ActionUserRolesRemove);\n\n  const createTeam = async (formModel: TeamDTO) => {\n    try {\n      const newTeam = await getBackendSrv().post('/api/teams', formModel);\n      if (newTeam.teamId) {\n        await contextSrv.fetchUserPermissions();\n        if (contextSrv.licensedAccessControlEnabled() && canUpdateRoles) {\n          await updateTeamRoles(pendingRoles, newTeam.teamId, newTeam.orgId);\n        }\n        locationService.push(`/org/teams/edit/${newTeam.uid}`);\n      }\n    } catch (e) {\n      console.error(e);\n    }\n  };\n\n  return (\n    <Page navId=\"teams\" pageNav={pageNav}>\n      <Page.Contents>\n        <form onSubmit={handleSubmit(createTeam)} style={{ maxWidth: '600px' }}>\n          <FieldSet>\n            <Stack direction=\"column\" gap={2}>\n              <Field\n                noMargin\n                label={t('teams.create-team.label-name', 'Name')}\n                required\n                invalid={!!errors.name}\n                error=\"Team name is required\"\n              >\n                <Input {...register('name', { required: true })} id=\"team-name\" />\n              </Field>\n              {contextSrv.licensedAccessControlEnabled() && (\n                <Field noMargin label={t('teams.create-team.label-role', 'Role')}>\n                  <TeamRolePicker\n                    teamId={0}\n                    roleOptions={roleOptions}\n                    disabled={false}\n                    apply={true}\n                    onApplyRoles={setPendingRoles}\n                    pendingRoles={pendingRoles}\n                    maxWidth=\"100%\"\n                  />\n                </Field>\n              )}\n              <Field\n                noMargin\n                label={t('teams.create-team.label-email', 'Email')}\n                description={t(\n                  'teams.create-team.description-email',\n                  'This is optional and is primarily used for allowing custom team avatars'\n                )}\n              >\n                {/* eslint-disable-next-line @grafana/i18n/no-untranslated-strings */}\n                <Input {...register('email')} type=\"email\" id=\"team-email\" placeholder=\"email@test.com\" />\n              </Field>\n            </Stack>\n          </FieldSet>\n          <Button type=\"submit\" variant=\"primary\">\n            <Trans i18nKey=\"teams.create-team.create\">Create</Trans>\n          </Button>\n        </form>\n      </Page.Contents>\n    </Page>\n  );\n};\n\nexport default CreateTeam;\n","import { difference } from 'lodash';\nimport { useState } from 'react';\nimport { useDeepCompareEffect } from 'react-use';\nimport useAsync from 'react-use/lib/useAsync';\n\nimport { contextSrv } from 'app/core/core';\nimport { Role, AccessControlAction } from 'app/types/accessControl';\n\nimport { fetchRoleOptions } from './api';\n\ntype MultiOrgRoleOptions = Record<number, Role[]>;\n\nexport const useRoleOptions = (organizationId: number) => {\n  const [orgId, setOrgId] = useState(organizationId);\n\n  const { value = [] } = useAsync(async () => {\n    if (contextSrv.licensedAccessControlEnabled() && contextSrv.hasPermission(AccessControlAction.ActionRolesList)) {\n      return fetchRoleOptions(orgId);\n    }\n    return Promise.resolve([]);\n  }, [orgId]);\n\n  return [{ roleOptions: value }, setOrgId] as const;\n};\n\nexport const useMultiOrgRoleOptions = (orgIDs: number[]): MultiOrgRoleOptions => {\n  const [orgRoleOptions, setOrgRoleOptions] = useState<MultiOrgRoleOptions>({});\n\n  useDeepCompareEffect(() => {\n    if (!contextSrv.licensedAccessControlEnabled() || !contextSrv.hasPermission(AccessControlAction.ActionRolesList)) {\n      return;\n    }\n\n    const currentOrgIDs = Object.keys(orgRoleOptions).map((o) => (typeof o === 'number' ? o : parseInt(o, 10)));\n    const newOrgIDs = difference(orgIDs, currentOrgIDs);\n\n    Promise.all(\n      newOrgIDs.map((orgID) => {\n        return fetchRoleOptions(orgID).then((roleOptions) => [orgID, roleOptions]);\n      })\n    ).then((value) => {\n      setOrgRoleOptions({\n        ...orgRoleOptions,\n        ...Object.fromEntries(value),\n      });\n    });\n  }, [orgIDs]);\n\n  return orgRoleOptions;\n};\n","import { useEffect } from 'react';\nimport { useAsyncFn } from 'react-use';\n\nimport { contextSrv } from 'app/core/core';\nimport { Role, AccessControlAction } from 'app/types/accessControl';\n\nimport { RolePicker } from './RolePicker';\nimport { fetchTeamRoles, updateTeamRoles } from './api';\n\nexport interface Props {\n  teamId: number;\n  orgId?: number;\n  roleOptions: Role[];\n  disabled?: boolean;\n  roles?: Role[];\n  onApplyRoles?: (newRoles: Role[]) => void;\n  pendingRoles?: Role[];\n  /**\n   * Set whether the component should send a request with the new roles to the\n   * backend in TeamRolePicker.onRolesChange (apply=false), or call {@link onApplyRoles}\n   * with the updated list of roles (apply=true).\n   *\n   * Besides it sets the RolePickerMenu's Button title to\n   *   * `Update` in case apply equals false\n   *   * `Apply` in case apply equals true\n   *\n   * @default false\n   */\n  apply?: boolean;\n  maxWidth?: string | number;\n  width?: string | number;\n  isLoading?: boolean;\n}\n\nexport const TeamRolePicker = ({\n  teamId,\n  roleOptions,\n  disabled,\n  roles,\n  onApplyRoles,\n  pendingRoles,\n  apply = false,\n  maxWidth,\n  width,\n  isLoading,\n}: Props) => {\n  const [{ loading, value: appliedRoles = roles || [] }, getTeamRoles] = useAsyncFn(async () => {\n    try {\n      if (roles) {\n        return roles;\n      }\n      if (apply && Boolean(pendingRoles?.length)) {\n        return pendingRoles;\n      }\n\n      if (contextSrv.hasPermission(AccessControlAction.ActionTeamsRolesList) && teamId > 0) {\n        return await fetchTeamRoles(teamId);\n      }\n    } catch (e) {\n      console.error('Error loading options', e);\n    }\n    return [];\n  }, [teamId, pendingRoles, roles]);\n\n  useEffect(() => {\n    getTeamRoles();\n  }, [getTeamRoles]);\n\n  const onRolesChange = async (roles: Role[]) => {\n    if (!apply) {\n      await updateTeamRoles(roles, teamId);\n      await getTeamRoles();\n    } else if (onApplyRoles) {\n      onApplyRoles(roles);\n    }\n  };\n\n  const canUpdateRoles =\n    contextSrv.hasPermission(AccessControlAction.ActionTeamsRolesAdd) &&\n    contextSrv.hasPermission(AccessControlAction.ActionTeamsRolesRemove);\n\n  return (\n    <RolePicker\n      apply={apply}\n      onRolesChange={onRolesChange}\n      roleOptions={roleOptions}\n      appliedRoles={appliedRoles}\n      isLoading={loading || isLoading}\n      disabled={disabled}\n      basicRoleDisabled={true}\n      canUpdateRoles={canUpdateRoles}\n      maxWidth={maxWidth}\n      width={width}\n    />\n  );\n};\n"],"names":["pageNav","CreateTeam","currentOrgId","pendingRoles","setPendingRoles","roleOptions","handleSubmit","register","errors","canUpdateRoles","createTeam","formModel","newTeam","e","useRoleOptions","organizationId","orgId","setOrgId","value","useMultiOrgRoleOptions","orgIDs","orgRoleOptions","setOrgRoleOptions","currentOrgIDs","o","newOrgIDs","orgID","TeamRolePicker","teamId","disabled","roles","onApplyRoles","apply","maxWidth","width","isLoading","loading","appliedRoles","getTeamRoles","onRolesChange"],"sourceRoot":""}