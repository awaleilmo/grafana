{"version":3,"file":"FileHistoryPage.006b02d1d9d90e3b9137.js","mappings":"0UAmBe,SAASA,GAAkB,CACxC,MAAMC,KAAS,KAAU,EACnBC,EAAOD,EAAO,MAAW,GACzBE,EAAOF,EAAO,GAAG,GAAK,GACtB,CAACG,CAAS,KAAI,KAAa,EAC3BC,EAAWD,EAAU,IAAI,WAAW,EACpCE,EAAsB,IAAC,KAAuBD,CAAQ,EACtDE,KAAQ,MAA4B,CAAE,KAAAL,CAAK,CAAC,EAC5CM,KAAU,MAAqCF,EAAsB,KAAY,CAAE,KAAAJ,EAAM,KAAAC,CAAK,CAAC,EAC/FM,EAAYF,EAAM,YAAW,KAAgBA,EAAM,KAAK,GAAMD,EAE9DI,EAAmBJ,KACrB,KAAE,uDAAwD,mDAAmD,KAC7G,KAAE,sDAAuD,sBAAsB,EAEnF,SACE,OAAC,KACC,MAAM,eACN,QAAS,CACP,KAAM,YAAYH,CAAI,GACtB,SAAUI,EAAM,MAAM,MAAM,OAAS,YACvC,EAEA,mBAAC,IAAK,SAAL,CAAc,UAAW,GACvB,SAAAE,KACC,QAAC,IAAU,CAAC,QAASC,EAAkB,QAAQ,YAC7C,oBAAC,IAAI,CAAC,QAAS,IAEZ,SAAAL,IAAa,UACZ,OAAC,KAAK,CAAC,QAAQ,wEAAwE,6EAEvF,EAEJ,KACA,OAAC,IAAQ,CAAC,KAAM,KACd,mBAAC,KAAK,CAAC,QAAQ,sDAAsD,gCAAoB,EAC3F,GACF,KAGA,OAAC,OAAK,SAAAG,EAAQ,QAAO,OAACG,EAAA,CAAY,QAASH,EAAQ,KAAM,KAAAL,EAAY,KAAMD,CAAA,CAAM,KAAK,OAAC,IAAO,EAAC,EAAG,EAEtG,EACF,CAEJ,CAQA,SAASS,EAAY,CAAE,QAAAH,EAAS,KAAAL,EAAM,KAAAS,CAAK,EAAU,CACnD,OAAKJ,EAAQ,SAKX,OAAC,IAAK,CAAC,UAAW,SACf,SAAAA,EAAQ,MAAM,IAAKK,MAClB,QAAC,IAAI,CAAC,KAAM,GAAG,IAAgB,IAAID,CAAI,SAAST,CAAI,QAAQU,EAAK,GAAG,GAClE,oBAAC,IAAK,QAAL,CAAc,SAAAA,EAAK,QAAQ,KAC5B,OAAC,IAAK,KAAL,CACC,mBAAC,QAAM,iBAAgBA,EAAK,SAAS,EAAE,EACzC,KACA,OAAC,IAAK,YAAL,CACC,mBAAC,IAAK,CACH,SAAAA,EAAK,QAAQ,IAAKC,MACjB,QAAC,QAAsB,MAAO,CAAE,QAAS,OAAQ,WAAY,SAAU,IAAK,KAAM,EAC/E,UAAAA,EAAE,cACD,OAAC,KACC,SAAU,CACR,KAAM,CAAE,KAAMA,EAAE,KAAM,UAAWA,EAAE,SAAU,EAC7C,aAAc,IAAI,KAAK,EAAE,YAAY,CACvC,EACA,YAAa,GACf,KAEF,OAAC,KAAE,KAAM,sBAAsBA,EAAE,QAAQ,GAAK,SAAAA,EAAE,KAAK,IAV5CA,EAAE,QAWb,CACD,EACH,EACF,IAtB2ED,EAAK,GAuBlF,CACD,EACH,KA/BO,OAAC,KAAK,CAAC,QAAQ,sCAAsC,qBAAS,CAiCzE,C,mCC3GO,SAASE,EAAuBV,EAAmC,CAExE,MAAO,CAAC,CAACA,GADkB,IAAI,IAAI,CAAC,SAAU,SAAU,WAAW,CAAC,EAC5B,IAAIA,CAAQ,CACtD,C,mCCHO,SAASW,EAAgBC,EAAoB,CAClD,OAAKA,EAGE,IAAI,KAAKA,CAAS,EAAE,eAAe,EAFjC,KAGX,C","sources":["webpack://grafana/./public/app/features/provisioning/File/FileHistoryPage.tsx","webpack://grafana/./public/app/features/provisioning/File/utils.ts","webpack://grafana/./public/app/features/provisioning/utils/time.ts"],"sourcesContent":["import { skipToken } from '@reduxjs/toolkit/query';\nimport { useParams } from 'react-router-dom-v5-compat';\n\nimport { Trans, t } from '@grafana/i18n';\nimport { Card, EmptyState, Spinner, Stack, Text, TextLink, UserIcon } from '@grafana/ui';\nimport {\n  useGetRepositoryHistoryWithPathQuery,\n  useGetRepositoryStatusQuery,\n} from 'app/api/clients/provisioning/v0alpha1';\nimport { Page } from 'app/core/components/Page/Page';\nimport { useUrlParams } from 'app/core/navigation/hooks';\nimport { isNotFoundError } from 'app/features/alerting/unified/api/util';\n\nimport { PROVISIONING_URL } from '../constants';\nimport { HistoryListResponse } from '../types';\nimport { formatTimestamp } from '../utils/time';\n\nimport { isFileHistorySupported } from './utils';\n\nexport default function FileHistoryPage() {\n  const params = useParams();\n  const name = params['name'] ?? '';\n  const path = params['*'] ?? '';\n  const [urlParams] = useUrlParams();\n  const repoType = urlParams.get('repo_type');\n  const historyNotSupported = !isFileHistorySupported(repoType);\n  const query = useGetRepositoryStatusQuery({ name });\n  const history = useGetRepositoryHistoryWithPathQuery(historyNotSupported ? skipToken : { name, path });\n  const notFound = (query.isError && isNotFoundError(query.error)) || historyNotSupported;\n\n  const notFoundErrorMsg = historyNotSupported\n    ? t('provisioning.file-history-page.history-not-supported', 'File history is not supported for this repository')\n    : t('provisioning.file-history-page.repository-not-found', 'Repository not found');\n\n  return (\n    <Page\n      navId=\"provisioning\"\n      pageNav={{\n        text: `History: ${path}`,\n        subTitle: query.data?.spec?.title ?? 'Repository',\n      }}\n    >\n      <Page.Contents isLoading={false}>\n        {notFound ? (\n          <EmptyState message={notFoundErrorMsg} variant=\"not-found\">\n            <Text element={'p'}>\n              {/* only show detail message if repoType is not git */}\n              {repoType !== 'git' && (\n                <Trans i18nKey=\"provisioning.file-history-page.repository-config-exists-configuration\">\n                  Make sure the repository config exists in the configuration file.\n                </Trans>\n              )}\n            </Text>\n            <TextLink href={PROVISIONING_URL}>\n              <Trans i18nKey=\"provisioning.file-history-page.back-to-repositories\">Back to repositories</Trans>\n            </TextLink>\n          </EmptyState>\n        ) : (\n          //@ts-expect-error TODO fix history response types\n          <div>{history.data ? <HistoryView history={history.data} path={path} repo={name} /> : <Spinner />}</div>\n        )}\n      </Page.Contents>\n    </Page>\n  );\n}\n\ninterface Props {\n  history: HistoryListResponse;\n  path: string;\n  repo: string;\n}\n\nfunction HistoryView({ history, path, repo }: Props) {\n  if (!history.items) {\n    return <Trans i18nKey=\"provisioning.history-view.not-found\">Not found</Trans>;\n  }\n\n  return (\n    <Stack direction={'column'}>\n      {history.items.map((item) => (\n        <Card href={`${PROVISIONING_URL}/${repo}/file/${path}?ref=${item.ref}`} key={item.ref}>\n          <Card.Heading>{item.message}</Card.Heading>\n          <Card.Meta>\n            <span>{formatTimestamp(item.createdAt)}</span>\n          </Card.Meta>\n          <Card.Description>\n            <Stack>\n              {item.authors.map((a) => (\n                <span key={a.username} style={{ display: 'flex', alignItems: 'center', gap: '4px' }}>\n                  {a.avatarURL && (\n                    <UserIcon\n                      userView={{\n                        user: { name: a.name, avatarUrl: a.avatarURL },\n                        lastActiveAt: new Date().toISOString(),\n                      }}\n                      showTooltip={false}\n                    />\n                  )}\n                  <a href={`https://github.com/${a.username}`}>{a.name}</a>\n                </span>\n              ))}\n            </Stack>\n          </Card.Description>\n        </Card>\n      ))}\n    </Stack>\n  );\n}\n","export function isFileHistorySupported(repoType?: string | null): boolean {\n  const supportedRepoTypes = new Set(['github', 'gitlab', 'bitbucket']);\n  return !!repoType && supportedRepoTypes.has(repoType);\n}\n","export function formatTimestamp(timestamp?: number) {\n  if (!timestamp) {\n    return 'N/A';\n  }\n  return new Date(timestamp).toLocaleString();\n}\n"],"names":["FileHistoryPage","params","name","path","urlParams","repoType","historyNotSupported","query","history","notFound","notFoundErrorMsg","HistoryView","repo","item","a","isFileHistorySupported","formatTimestamp","timestamp"],"sourceRoot":""}