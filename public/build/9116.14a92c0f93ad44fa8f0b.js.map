{"version":3,"file":"9116.14a92c0f93ad44fa8f0b.js","mappings":"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","sources":["webpack://grafana/./public/app/features/alerting/unified/api/labelsApi.ts","webpack://grafana/./public/app/features/alerting/unified/components/AlertLabelDropdown.tsx","webpack://grafana/./public/app/features/alerting/unified/components/rule-editor/labels/LabelsButtons.tsx","webpack://grafana/./public/app/features/alerting/unified/components/rule-editor/labels/LabelsField.tsx","webpack://grafana/./public/app/features/alerting/unified/components/CollapseToggle.tsx","webpack://grafana/./public/app/features/alerting/unified/enterprise-components/AI/AIGenImproveAnnotationsButton/addAIImproveAnnotationsButton.ts","webpack://grafana/./public/app/features/alerting/unified/components/rule-editor/CustomAnnotationHeaderField.tsx","webpack://grafana/./public/app/features/alerting/unified/components/rule-editor/AnnotationHeaderField.tsx","webpack://grafana/./public/app/features/alerting/unified/components/rule-editor/DashboardAnnotationField.tsx","webpack://grafana/./public/app/features/alerting/unified/api/dashboardApi.ts","webpack://grafana/./public/app/features/alerting/unified/components/rule-editor/useDashboardQuery.ts","webpack://grafana/./public/app/features/alerting/unified/components/rule-editor/DashboardPicker.tsx","webpack://grafana/./public/app/features/alerting/unified/components/rule-editor/alert-rule-form/extensions/NotificationMessageSectionExtension.tsx","webpack://grafana/./public/app/features/alerting/unified/components/rule-editor/AnnotationsStep.tsx","webpack://grafana/./public/app/features/alerting/unified/components/rule-editor/NeedHelpInfo.tsx","webpack://grafana/./public/app/features/alerting/unified/components/rule-editor/RuleEditorSection.tsx","webpack://grafana/./public/app/features/alerting/unified/components/rule-editor/useAlertRuleSuggestions.tsx","webpack://grafana/./public/app/features/alerting/unified/enterprise-components/AI/addAIFeedbackButton.tsx"],"sourcesContent":["import { SupportedPlugin } from '../types/pluginBridges';\n\nimport { alertingApi } from './alertingApi';\n\nexport interface LabelItem {\n  id: string;\n  name: string;\n  prescribed: boolean;\n}\n\nexport interface LabelKeyAndValues {\n  labelKey: LabelItem;\n  values: LabelItem[];\n}\n\nexport const labelsApi = alertingApi.injectEndpoints({\n  endpoints: (build) => ({\n    getLabels: build.query<LabelItem[], void>({\n      query: () => ({\n        url: `/api/plugins/${SupportedPlugin.Labels}/resources/v1/labels/keys`,\n      }),\n      providesTags: ['GrafanaLabels'],\n    }),\n    getLabelValues: build.query<LabelKeyAndValues, { key: string }>({\n      query: ({ key }) => ({\n        url: `/api/plugins/${SupportedPlugin.Labels}/resources/v1/labels/name/${key}`,\n      }),\n      providesTags: ['GrafanaLabels'],\n    }),\n  }),\n});\n","import { css } from '@emotion/css';\nimport { FC, forwardRef } from 'react';\n\nimport { SelectableValue } from '@grafana/data';\nimport { t } from '@grafana/i18n';\nimport { Combobox, ComboboxOption, Field, useStyles2 } from '@grafana/ui';\n\nexport interface AlertLabelDropdownProps {\n  onChange: (newValue: SelectableValue<string>) => void;\n  onOpenMenu?: () => void;\n  options: ComboboxOption[];\n  defaultValue?: SelectableValue;\n  type: 'key' | 'value';\n  isLoading?: boolean;\n}\n\nconst AlertLabelDropdown: FC<AlertLabelDropdownProps> = forwardRef<HTMLDivElement, AlertLabelDropdownProps>(\n  function LabelPicker({ onChange, options, defaultValue, type, onOpenMenu = () => {}, isLoading = false }, ref) {\n    const styles = useStyles2(getStyles);\n\n    const handleChange = (option: ComboboxOption<string> | null) => {\n      if (option) {\n        onChange({\n          label: option.label || option.value,\n          value: option.value,\n          description: option.description,\n        });\n      }\n    };\n\n    const currentValue = defaultValue\n      ? {\n          label: defaultValue.label || defaultValue.value,\n          value: defaultValue.value,\n          description: defaultValue.description,\n        }\n      : undefined;\n\n    return (\n      <div ref={ref}>\n        <Field disabled={false} data-testid={`alertlabel-${type}-picker`} className={styles.resetMargin}>\n          <Combobox<string>\n            placeholder={t('alerting.alert-label-dropdown.placeholder-select', 'Choose {{type}}', { type })}\n            width={25}\n            options={options}\n            value={currentValue}\n            onChange={handleChange}\n            createCustomValue={true}\n            data-testid={`alertlabel-${type}-combobox`}\n          />\n        </Field>\n      </div>\n    );\n  }\n);\n\nconst getStyles = () => ({\n  resetMargin: css({ marginBottom: 0 }),\n});\n\nexport default AlertLabelDropdown;\n","import { UseFieldArrayRemove } from 'react-hook-form';\n\nimport { Trans, t } from '@grafana/i18n';\nimport { Button } from '@grafana/ui';\n\ninterface RemoveButtonProps {\n  remove: UseFieldArrayRemove;\n  index: number;\n}\nexport function RemoveButton({ remove, index }: RemoveButtonProps) {\n  return (\n    <Button\n      aria-label={t('alerting.remove-button.aria-label-delete-label', 'delete label')}\n      icon=\"trash-alt\"\n      data-testid={`delete-label-${index}`}\n      variant=\"secondary\"\n      onClick={() => {\n        remove(index);\n      }}\n    />\n  );\n}\n\ninterface AddButtonProps {\n  append: () => void;\n}\nexport function AddButton({ append }: AddButtonProps) {\n  return (\n    <Button icon=\"plus\" type=\"button\" variant=\"secondary\" onClick={append}>\n      <Trans i18nKey=\"alerting.add-button.add-more\">Add more</Trans>\n    </Button>\n  );\n}\n","import { css, cx } from '@emotion/css';\nimport { FC, useCallback, useMemo, useState } from 'react';\nimport { Controller, FormProvider, useFieldArray, useForm, useFormContext } from 'react-hook-form';\n\nimport { GrafanaTheme2, SelectableValue } from '@grafana/data';\nimport { Trans, t } from '@grafana/i18n';\nimport { Button, ComboboxOption, Field, InlineLabel, Input, Space, Stack, Text, useStyles2 } from '@grafana/ui';\n\nimport { labelsApi } from '../../../api/labelsApi';\nimport { usePluginBridge } from '../../../hooks/usePluginBridge';\nimport { SupportedPlugin } from '../../../types/pluginBridges';\nimport { KBObjectArray, RuleFormType, RuleFormValues } from '../../../types/rule-form';\nimport { isPrivateLabelKey } from '../../../utils/labels';\nimport { isRecordingRuleByType } from '../../../utils/rules';\nimport AlertLabelDropdown from '../../AlertLabelDropdown';\nimport { AlertLabels } from '../../AlertLabels';\nimport { NeedHelpInfo } from '../NeedHelpInfo';\nimport { useGetLabelsFromDataSourceName } from '../useAlertRuleSuggestions';\n\nimport { AddButton, RemoveButton } from './LabelsButtons';\n\nconst useGetOpsLabelsKeys = (skip: boolean) => {\n  const { currentData, isLoading: isloadingLabels } = labelsApi.endpoints.getLabels.useQuery(undefined, {\n    skip,\n  });\n  return { loading: isloadingLabels, labelsOpsKeys: currentData };\n};\n\nfunction mapLabelsToOptions(\n  items: Iterable<string> = [],\n  labelsInSubForm?: Array<{ key: string; value: string }>\n): Array<ComboboxOption<string>> {\n  const existingKeys = new Set(labelsInSubForm ? labelsInSubForm.map((label) => label.key) : []);\n  return Array.from(items, (item) => ({\n    label: item,\n    value: item,\n    disabled: existingKeys.has(item),\n  }));\n}\n\nexport interface LabelsInRuleProps {\n  labels: Array<{ key: string; value: string }>;\n}\n\nexport const LabelsInRule = ({ labels }: LabelsInRuleProps) => {\n  const labelsObj: Record<string, string> = labels.reduce((acc: Record<string, string>, label) => {\n    if (label.key) {\n      acc[label.key] = label.value;\n    }\n    return acc;\n  }, {});\n\n  return <AlertLabels labels={labelsObj} />;\n};\n\nexport type LabelsSubformValues = {\n  labelsInSubform: Array<{ key: string; value: string }>;\n};\n\nexport interface LabelsSubFormProps {\n  dataSourceName: string;\n  initialLabels: Array<{ key: string; value: string }>;\n  onClose: (labelsToUodate?: KBObjectArray) => void;\n}\n\nexport function LabelsSubForm({ dataSourceName, onClose, initialLabels }: LabelsSubFormProps) {\n  const styles = useStyles2(getStyles);\n  const { watch } = useFormContext<RuleFormValues>();\n\n  const type = watch('type') ?? RuleFormType.grafana;\n\n  const onSave = (labels: LabelsSubformValues) => {\n    onClose(labels.labelsInSubform);\n  };\n  const onCancel = () => {\n    onClose();\n  };\n  // default values for the subform are the initial labels\n  const defaultValues: LabelsSubformValues = useMemo(() => {\n    return { labelsInSubform: initialLabels };\n  }, [initialLabels]);\n\n  const formAPI = useForm<LabelsSubformValues>({ defaultValues });\n  return (\n    <FormProvider {...formAPI}>\n      <form onSubmit={formAPI.handleSubmit(onSave)}>\n        <Stack direction=\"column\" gap={4}>\n          <Stack direction=\"column\" gap={1}>\n            <Text>{getLabelText(type)}</Text>\n            <Text variant=\"bodySmall\" color=\"secondary\">\n              {getDescriptionText()}\n            </Text>\n          </Stack>\n          <Stack direction=\"column\" gap={1}>\n            <LabelsWithSuggestions dataSourceName={dataSourceName} />\n            <Space v={2} />\n            <LabelsInRule labels={formAPI.watch('labelsInSubform')} />\n            <Space v={1} />\n            <div className={styles.confirmButton}>\n              <Button type=\"button\" variant=\"secondary\" onClick={onCancel}>\n                <Trans i18nKey=\"alerting.common.cancel\">Cancel</Trans>\n              </Button>\n              <Button type=\"submit\">\n                <Trans i18nKey=\"alerting.labels-sub-form.save\">Save</Trans>\n              </Button>\n            </div>\n          </Stack>\n        </Stack>\n      </form>\n    </FormProvider>\n  );\n}\n\nconst isKeyAllowed = (labelKey: string) => !isPrivateLabelKey(labelKey);\n\nexport function useCombinedLabels(\n  dataSourceName: string,\n  labelsPluginInstalled: boolean,\n  loadingLabelsPlugin: boolean,\n  labelsInSubform: Array<{ key: string; value: string }>,\n  selectedKey: string\n) {\n  // ------- Get labels keys and their values from existing alerts\n  const { labels: labelsByKeyFromExisingAlerts, isLoading } = useGetLabelsFromDataSourceName(dataSourceName);\n  // ------- Get only the keys from the ops labels, as we will fetch the values for the keys once the key is selected.\n  const { loading: isLoadingLabels, labelsOpsKeys = [] } = useGetOpsLabelsKeys(\n    !labelsPluginInstalled || loadingLabelsPlugin\n  );\n  //------ Convert the labelsOpsKeys to the same format as the labelsByKeyFromExisingAlerts\n  const labelsByKeyOps = useMemo(() => {\n    return labelsOpsKeys.reduce((acc: Record<string, Set<string>>, label) => {\n      acc[label.name] = new Set();\n      return acc;\n    }, {});\n  }, [labelsOpsKeys]);\n\n  //------- Convert the keys from the ops labels to options for the dropdown\n  const keysFromGopsLabels = useMemo(() => {\n    return mapLabelsToOptions(Object.keys(labelsByKeyOps).filter(isKeyAllowed), labelsInSubform);\n  }, [labelsByKeyOps, labelsInSubform]);\n\n  //------- Convert the keys from the existing alerts to options for the dropdown\n  const keysFromExistingAlerts = useMemo(() => {\n    return mapLabelsToOptions(Array.from(labelsByKeyFromExisingAlerts.keys()).filter(isKeyAllowed), labelsInSubform);\n  }, [labelsByKeyFromExisingAlerts, labelsInSubform]);\n\n  // create two groups of labels, one for ops and one for custom\n  const groupedOptions = [\n    {\n      label: t('alerting.use-combined-labels.grouped-options.label.from-alerts', 'From alerts'),\n      options: keysFromExistingAlerts,\n      expanded: true,\n    },\n    {\n      label: t('alerting.use-combined-labels.grouped-options.label.from-system', 'From system'),\n      options: keysFromGopsLabels,\n      expanded: true,\n    },\n  ];\n\n  const selectedKeyIsFromAlerts = labelsByKeyFromExisingAlerts.has(selectedKey);\n  const selectedKeyIsFromOps = labelsByKeyOps[selectedKey] !== undefined && labelsByKeyOps[selectedKey]?.size > 0;\n  const selectedKeyDoesNotExist = !selectedKeyIsFromAlerts && !selectedKeyIsFromOps;\n\n  const valuesAlreadyFetched = !selectedKeyIsFromAlerts && labelsByKeyOps[selectedKey]?.size > 0;\n\n  // Only fetch the values for the selected key if it is from ops and the values are not already fetched (the selected key is not in the labelsByKeyOps object)\n  const {\n    currentData: valuesData,\n    isLoading: isLoadingValues = false,\n    error,\n  } = labelsApi.endpoints.getLabelValues.useQuery(\n    { key: selectedKey },\n    {\n      skip:\n        !labelsPluginInstalled ||\n        !selectedKey ||\n        selectedKeyIsFromAlerts ||\n        valuesAlreadyFetched ||\n        selectedKeyDoesNotExist,\n    }\n  );\n\n  // these are the values for the selected key in case it is from ops\n  const valuesFromSelectedGopsKey = useMemo(() => {\n    // if it is from alerts, we need to fetch the values from the existing alerts\n    if (selectedKeyIsFromAlerts) {\n      return [];\n    }\n    // in case of a label from ops, we need to fetch the values from the plugin\n    // fetch values from ops only if there is no value for the key\n    const valuesForSelectedKey = labelsByKeyOps[selectedKey];\n    const valuesAlreadyFetched = valuesForSelectedKey?.size > 0;\n    if (valuesAlreadyFetched) {\n      return mapLabelsToOptions(valuesForSelectedKey);\n    }\n    if (!isLoadingValues && valuesData?.values?.length && !error) {\n      const values = valuesData?.values.map((value) => value.name);\n      labelsByKeyOps[selectedKey] = new Set(values);\n      return mapLabelsToOptions(values);\n    }\n    return [];\n  }, [selectedKeyIsFromAlerts, labelsByKeyOps, selectedKey, isLoadingValues, valuesData, error]);\n\n  const getValuesForLabel = useCallback(\n    (key: string) => {\n      if (!isKeyAllowed(key)) {\n        return [];\n      }\n\n      // values from existing alerts will take precedence over values from ops\n      if (selectedKeyIsFromAlerts || !labelsPluginInstalled) {\n        return mapLabelsToOptions(labelsByKeyFromExisingAlerts.get(key));\n      }\n      return valuesFromSelectedGopsKey;\n    },\n    [labelsByKeyFromExisingAlerts, labelsPluginInstalled, valuesFromSelectedGopsKey, selectedKeyIsFromAlerts]\n  );\n\n  return {\n    loading: isLoading || isLoadingLabels,\n    keysFromExistingAlerts,\n    groupedOptions,\n    getValuesForLabel,\n  };\n}\n\n/*\n  We will suggest labels from two sources: existing alerts and ops labels.\n  We only will suggest labels from ops if the grafana-labels-app plugin is installed\n  This component is only used by the alert rule form.\n  */\nexport interface LabelsWithSuggestionsProps {\n  dataSourceName: string;\n}\n\nexport function LabelsWithSuggestions({ dataSourceName }: LabelsWithSuggestionsProps) {\n  const styles = useStyles2(getStyles);\n  const {\n    control,\n    watch,\n    formState: { errors },\n  } = useFormContext<LabelsSubformValues>();\n\n  const labelsInSubform = watch('labelsInSubform');\n  const { fields, remove, append } = useFieldArray({ control, name: 'labelsInSubform' });\n  const appendLabel = useCallback(() => {\n    append({ key: '', value: '' });\n  }, [append]);\n\n  const [selectedKey, setSelectedKey] = useState('');\n  // check if the labels plugin is installed\n  const { installed: labelsPluginInstalled = false, loading: loadingLabelsPlugin } = usePluginBridge(\n    SupportedPlugin.Labels\n  );\n\n  const { loading, keysFromExistingAlerts, groupedOptions, getValuesForLabel } = useCombinedLabels(\n    dataSourceName,\n    labelsPluginInstalled,\n    loadingLabelsPlugin,\n    labelsInSubform,\n    selectedKey\n  );\n\n  const values = useMemo(() => {\n    return getValuesForLabel(selectedKey);\n  }, [selectedKey, getValuesForLabel]);\n\n  return (\n    <Stack direction=\"column\" gap={2} alignItems=\"flex-start\">\n      {fields.map((field, index) => {\n        return (\n          <div key={field.id} className={cx(styles.flexRow, styles.centerAlignRow)} id=\"hola\">\n            <Field\n              className={styles.labelInput}\n              invalid={Boolean(errors.labelsInSubform?.[index]?.key?.message)}\n              error={errors.labelsInSubform?.[index]?.key?.message}\n              data-testid={`labelsInSubform-key-${index}`}\n            >\n              <Controller\n                name={`labelsInSubform.${index}.key`}\n                control={control}\n                rules={{ required: Boolean(labelsInSubform[index]?.value) ? 'Required.' : false }}\n                render={({ field: { onChange, ref, ...rest } }) => {\n                  return (\n                    <AlertLabelDropdown\n                      {...rest}\n                      defaultValue={field.key ? { label: field.key, value: field.key } : undefined}\n                      options={\n                        labelsPluginInstalled\n                          ? groupedOptions.flatMap((group) => group.options)\n                          : keysFromExistingAlerts\n                      }\n                      isLoading={loading}\n                      onChange={(newValue: SelectableValue) => {\n                        if (newValue) {\n                          onChange(newValue.value || newValue.label || '');\n                          setSelectedKey(newValue.value);\n                        }\n                      }}\n                      type=\"key\"\n                    />\n                  );\n                }}\n              />\n            </Field>\n            <InlineLabel className={styles.equalSign}>=</InlineLabel>\n            <Field\n              className={styles.labelInput}\n              invalid={Boolean(errors.labelsInSubform?.[index]?.value?.message)}\n              error={errors.labelsInSubform?.[index]?.value?.message}\n              data-testid={`labelsInSubform-value-${index}`}\n            >\n              <Controller\n                control={control}\n                name={`labelsInSubform.${index}.value`}\n                rules={{ required: Boolean(labelsInSubform[index]?.value) ? 'Required.' : false }}\n                render={({ field: { onChange, ref, ...rest } }) => {\n                  return (\n                    <AlertLabelDropdown\n                      {...rest}\n                      defaultValue={field.value ? { label: field.value, value: field.value } : undefined}\n                      options={values}\n                      isLoading={loading}\n                      onChange={(newValue: SelectableValue) => {\n                        if (newValue) {\n                          onChange(newValue.value || newValue.label || '');\n                        }\n                      }}\n                      onOpenMenu={() => {\n                        setSelectedKey(labelsInSubform[index].key);\n                      }}\n                      type=\"value\"\n                    />\n                  );\n                }}\n              />\n            </Field>\n\n            <RemoveButton index={index} remove={remove} />\n          </div>\n        );\n      })}\n      <AddButton append={appendLabel} />\n    </Stack>\n  );\n}\n\nexport const LabelsWithoutSuggestions: FC = () => {\n  const styles = useStyles2(getStyles);\n  const {\n    register,\n    control,\n    watch,\n    formState: { errors },\n  } = useFormContext<RuleFormValues>();\n\n  const labels = watch('labels');\n  const { fields, remove, append } = useFieldArray({ control, name: 'labels' });\n  const appendLabel = useCallback(() => {\n    append({ key: '', value: '' });\n  }, [append]);\n\n  return (\n    <>\n      {fields.map((field, index) => {\n        return (\n          <div key={field.id}>\n            <div className={cx(styles.flexRow, styles.centerAlignRow)} data-testid=\"alertlabel-input-wrapper\">\n              <Field\n                className={styles.labelInput}\n                invalid={!!errors.labels?.[index]?.key?.message}\n                error={errors.labels?.[index]?.key?.message}\n              >\n                <Input\n                  {...register(`labels.${index}.key`, {\n                    required: {\n                      value: !!labels[index]?.value,\n                      message: t('alerting.labels-without-suggestions.message.required', 'Required.'),\n                    },\n                  })}\n                  placeholder={t('alerting.labels-without-suggestions.placeholder-key', 'key')}\n                  data-testid={`label-key-${index}`}\n                  defaultValue={field.key}\n                />\n              </Field>\n              <InlineLabel className={styles.equalSign}>=</InlineLabel>\n              <Field\n                className={styles.labelInput}\n                invalid={!!errors.labels?.[index]?.value?.message}\n                error={errors.labels?.[index]?.value?.message}\n              >\n                <Input\n                  {...register(`labels.${index}.value`, {\n                    required: {\n                      value: !!labels[index]?.key,\n                      message: t('alerting.labels-without-suggestions.message.required', 'Required.'),\n                    },\n                  })}\n                  placeholder={t('alerting.labels-without-suggestions.placeholder-value', 'value')}\n                  data-testid={`label-value-${index}`}\n                  defaultValue={field.value}\n                />\n              </Field>\n              <RemoveButton index={index} remove={remove} />\n            </div>\n          </div>\n        );\n      })}\n      <AddButton append={appendLabel} />\n    </>\n  );\n};\n\nfunction LabelsField() {\n  const { watch } = useFormContext<RuleFormValues>();\n\n  const type = watch('type') ?? RuleFormType.grafana;\n\n  return (\n    <div>\n      <Stack direction=\"column\" gap={1}>\n        <Text element=\"h5\">\n          <Trans i18nKey=\"alerting.labels-field.labels\">Labels</Trans>\n        </Text>\n        <Stack direction={'row'} gap={1}>\n          <Text variant=\"bodySmall\" color=\"secondary\">\n            {getLabelText(type)}\n          </Text>\n          <NeedHelpInfo\n            externalLink={'https://grafana.com/docs/grafana/latest/alerting/fundamentals/alert-rules/annotation-label/'}\n            linkText={`Read about labels`}\n            contentText=\"The dropdown only displays labels that you have previously used for alerts.\n            Select a label from the options below or type in a new one.\"\n            title={t('alerting.labels-field.title-labels', 'Labels')}\n          />\n        </Stack>\n      </Stack>\n      <LabelsWithoutSuggestions />\n    </div>\n  );\n}\n\nfunction getLabelText(type: RuleFormType) {\n  const isRecordingRule = type ? isRecordingRuleByType(type) : false;\n  const text = isRecordingRule\n    ? t('alerting.alertform.labels.recording', 'Add labels to your rule.')\n    : t(\n        'alerting.alertform.labels.alerting',\n        'Add labels to your rule for searching, silencing, or routing to a notification policy.'\n      );\n  return text;\n}\n\nfunction getDescriptionText() {\n  return t(\n    'alerting.labels-sub-form.description',\n    'Select a label key/value from the options below, or type a new one and press Enter.'\n  );\n}\n\nconst getStyles = (theme: GrafanaTheme2) => {\n  return {\n    flexColumn: css({\n      display: 'flex',\n      flexDirection: 'column',\n    }),\n    flexRow: css({\n      display: 'flex',\n      flexDirection: 'row',\n      justifyContent: 'flex-start',\n    }),\n    centerAlignRow: css({\n      alignItems: 'center',\n      gap: theme.spacing(0.5),\n    }),\n    equalSign: css({\n      alignSelf: 'flex-start',\n      width: '28px',\n      justifyContent: 'center',\n      margin: 0,\n    }),\n    labelInput: css({\n      width: '215px',\n      margin: 0,\n    }),\n    confirmButton: css({\n      display: 'flex',\n      flexDirection: 'row',\n      gap: theme.spacing(1),\n      marginLeft: 'auto',\n    }),\n  };\n};\n\nexport default LabelsField;\n","import { HTMLAttributes } from 'react';\n\nimport { Button, IconSize } from '@grafana/ui';\n\ninterface Props extends HTMLAttributes<HTMLButtonElement> {\n  isCollapsed: boolean;\n  onToggle: (isCollapsed: boolean) => void;\n  // Todo: this should be made compulsory for a11y purposes\n  idControlled?: string;\n  size?: IconSize;\n  className?: string;\n  text?: string;\n}\n\nexport const CollapseToggle = ({\n  isCollapsed,\n  onToggle,\n  idControlled,\n  className,\n  text,\n  size = 'xl',\n  ...restOfProps\n}: Props) => {\n  return (\n    <Button\n      type=\"button\"\n      fill=\"text\"\n      variant=\"secondary\"\n      aria-expanded={!isCollapsed}\n      aria-controls={idControlled}\n      className={className}\n      icon={isCollapsed ? 'angle-right' : 'angle-down'}\n      onClick={() => onToggle(!isCollapsed)}\n      {...restOfProps}\n    >\n      {text}\n    </Button>\n  );\n};\n","import { ComponentType, createElement } from 'react';\n\nimport { t } from '@grafana/i18n';\nimport { withErrorBoundary } from '@grafana/ui';\n\nimport { logError } from '../../../Analytics';\n\nexport interface GenAIImproveAnnotationsButtonProps {}\n\n// Internal variable to store the actual component\nlet InternalAIImproveAnnotationsButtonComponent: ComponentType<GenAIImproveAnnotationsButtonProps> | null = null;\n\nexport const AIImproveAnnotationsButtonComponent: ComponentType<GenAIImproveAnnotationsButtonProps> = (props) => {\n  if (!InternalAIImproveAnnotationsButtonComponent) {\n    return null;\n  }\n\n  // Wrap the component with error boundary\n  const WrappedComponent = withErrorBoundary(InternalAIImproveAnnotationsButtonComponent, {\n    title: t('alerting.ai.error-boundary.improve-annotations-button', 'AI Improve Annotations Button failed to load'),\n    style: 'alertbox',\n    errorLogger: logError,\n  });\n\n  return createElement(WrappedComponent, props);\n};\n\nexport function addAIImproveAnnotationsButton(component: ComponentType<GenAIImproveAnnotationsButtonProps> | null) {\n  InternalAIImproveAnnotationsButtonComponent = component;\n}\n","import { css } from '@emotion/css';\n\nimport { GrafanaTheme2 } from '@grafana/data';\nimport { Trans, t } from '@grafana/i18n';\nimport { Input, useStyles2 } from '@grafana/ui';\n\ninterface CustomAnnotationHeaderFieldProps {\n  field: { onChange: () => void; onBlur: () => void; value: string; name: string };\n}\n\nconst CustomAnnotationHeaderField = ({ field }: CustomAnnotationHeaderFieldProps) => {\n  const styles = useStyles2(getStyles);\n\n  return (\n    <div>\n      <span className={styles.annotationTitle}>\n        <Trans i18nKey=\"alerting.custom-annotation-header-field.custom-annotation-name-and-content\">\n          Custom annotation name and content\n        </Trans>\n      </span>\n      <Input\n        placeholder={t(\n          'alerting.custom-annotation-header-field.placeholder-enter-custom-annotation-name',\n          'Enter custom annotation name...'\n        )}\n        width={18}\n        {...field}\n        className={styles.customAnnotationInput}\n      />\n    </div>\n  );\n};\n\nconst getStyles = (theme: GrafanaTheme2) => ({\n  annotationTitle: css({\n    color: theme.colors.text.primary,\n    marginBottom: '3px',\n  }),\n\n  customAnnotationInput: css({\n    marginTop: '5px',\n    width: '100%',\n  }),\n});\n\nexport default CustomAnnotationHeaderField;\n","import { Controller, FieldArrayWithId, useFormContext } from 'react-hook-form';\n\nimport { t } from '@grafana/i18n';\nimport { Stack, Text } from '@grafana/ui';\n\nimport { RuleFormValues } from '../../types/rule-form';\nimport { Annotation, annotationDescriptions, annotationLabels } from '../../utils/constants';\n\nimport CustomAnnotationHeaderField from './CustomAnnotationHeaderField';\n\nconst AnnotationHeaderField = ({\n  annotationField,\n  annotations,\n  annotation,\n  index,\n  labelId,\n}: {\n  annotationField: FieldArrayWithId<RuleFormValues, 'annotations', 'id'>;\n  annotations: Array<{ key: string; value: string }>;\n  annotation: Annotation;\n  index: number;\n  labelId: string;\n}) => {\n  const { control } = useFormContext<RuleFormValues>();\n\n  return (\n    <Stack direction=\"column\" gap={0}>\n      <label htmlFor={labelId}>\n        {\n          <Controller\n            name={`annotations.${index}.key`}\n            defaultValue={annotationField.key}\n            render={({ field: { ref, ...field } }) => {\n              if (!annotationLabels[annotation]) {\n                return <CustomAnnotationHeaderField field={field} />;\n              }\n\n              let label;\n\n              switch (annotationField.key) {\n                case Annotation.dashboardUID:\n                  label = 'Dashboard and panel';\n                  break;\n                case Annotation.panelID:\n                  label = '';\n                  break;\n                default:\n                  label = annotationLabels[annotation] && annotationLabels[annotation] + ' (optional)';\n              }\n\n              return (\n                <span data-testid={`annotation-key-${index}`}>\n                  <Text color=\"primary\" variant=\"bodySmall\">\n                    {label}\n                  </Text>\n                </span>\n              );\n            }}\n            control={control}\n            rules={{\n              required: {\n                value: !!annotations[index]?.value,\n                message: t('alerting.annotation-header-field.message.required', 'Required.'),\n              },\n            }}\n          />\n        }\n      </label>\n      <Text variant=\"bodySmall\" color=\"secondary\">\n        {annotationDescriptions[annotation]}\n      </Text>\n    </Stack>\n  );\n};\n\nexport default AnnotationHeaderField;\n","import { css } from '@emotion/css';\n\nimport { GrafanaTheme2 } from '@grafana/data';\nimport { Trans } from '@grafana/i18n';\nimport { Icon, Text, useStyles2 } from '@grafana/ui';\nimport { DashboardDataDTO } from 'app/types/dashboard';\n\nimport { makeDashboardLink, makePanelLink } from '../../utils/misc';\n\nimport { PanelDTO } from './DashboardPicker';\n\nconst DashboardAnnotationField = ({\n  dashboard,\n  panel,\n  dashboardUid,\n  panelId,\n  onEditClick,\n  onDeleteClick,\n}: {\n  dashboard?: DashboardDataDTO;\n  panel?: PanelDTO;\n  dashboardUid: string; //fallback\n  panelId: string; //fallback\n  onEditClick: () => void;\n  onDeleteClick: () => void;\n}) => {\n  const styles = useStyles2(getStyles);\n\n  const dashboardLink = makeDashboardLink(dashboard?.uid || dashboardUid);\n  const panelLink = makePanelLink(dashboard?.uid || dashboardUid, panel?.id?.toString() || panelId);\n  return (\n    <div className={styles.container}>\n      {dashboard && (\n        <a\n          href={dashboardLink}\n          className={styles.link}\n          target=\"_blank\"\n          rel=\"noreferrer\"\n          data-testid=\"dashboard-annotation\"\n        >\n          {dashboard.title} <Icon name={'external-link-alt'} />\n        </a>\n      )}\n\n      {!dashboard && (\n        <Text color=\"secondary\">\n          <Trans i18nKey=\"alerting.annotations.dashboard-annotation-field.dashboard\" values={{ dashboardUid }}>\n            Dashboard {{ dashboardUid }}\n          </Trans>\n        </Text>\n      )}\n\n      {panel && (\n        <a href={panelLink} className={styles.link} target=\"_blank\" rel=\"noreferrer\" data-testid=\"panel-annotation\">\n          {panel.title || '<No title>'} <Icon name={'external-link-alt'} />\n        </a>\n      )}\n\n      {!panel && (\n        <>\n          <span> - </span>\n          <Text color=\"secondary\">\n            <Trans i18nKey=\"alerting.annotations.dashboard-annotation-field.panel\" values={{ panelId }}>\n              Panel {{ panelId }}\n            </Trans>\n          </Text>\n        </>\n      )}\n\n      {(dashboard || panel) && (\n        <>\n          <Icon name={'pen'} onClick={onEditClick} className={styles.icon} />\n          <Icon name={'trash-alt'} onClick={onDeleteClick} className={styles.icon} />\n        </>\n      )}\n    </div>\n  );\n};\n\nconst getStyles = (theme: GrafanaTheme2) => ({\n  container: css({\n    marginTop: '5px',\n  }),\n\n  noLink: css({\n    color: theme.colors.text.secondary,\n  }),\n  link: css({\n    color: theme.colors.text.link,\n    marginRight: theme.spacing(1.5),\n  }),\n\n  icon: css({\n    marginRight: theme.spacing(1),\n    cursor: 'pointer',\n  }),\n});\n\nexport default DashboardAnnotationField;\n","import { DashboardDTO } from 'app/types/dashboard';\n\nimport { DashboardSearchItem } from '../../../search/types';\n\nimport { alertingApi } from './alertingApi';\n\nexport const dashboardApi = alertingApi.injectEndpoints({\n  endpoints: (build) => ({\n    search: build.query<DashboardSearchItem[], { query?: string }>({\n      query: ({ query }) => {\n        const params = new URLSearchParams({ type: 'dash-db', limit: '1000', page: '1', sort: 'name_sort' });\n        if (query) {\n          params.set('query', query);\n        }\n\n        return { url: `/api/search?${params.toString()}` };\n      },\n    }),\n    dashboard: build.query<DashboardDTO, { uid: string }>({\n      query: ({ uid }) => ({ url: `/api/dashboards/uid/${uid}` }),\n    }),\n  }),\n});\n","import memoizeOne from 'memoize-one';\n\nimport { DashboardDTO } from 'app/types/dashboard';\n\nimport { DashboardModel } from '../../../../dashboard/state/DashboardModel';\nimport { dashboardApi } from '../../api/dashboardApi';\n\nconst convertToDashboardModel = memoizeOne((dashboardDTO: DashboardDTO) => {\n  // RTKQuery freezes all returned objects. DashboardModel constructor runs migrations which might change the internal object\n  // Hence we need to add structuredClone to make a deep copy of the API response object\n  const { dashboard, meta } = structuredClone(dashboardDTO);\n  return new DashboardModel(dashboard, meta);\n});\n\nexport function useDashboardQuery(dashboardUid?: string) {\n  const queryData = dashboardApi.endpoints.dashboard.useQuery(\n    { uid: dashboardUid ?? '' },\n    {\n      skip: !dashboardUid,\n      selectFromResult: ({ currentData, data, ...rest }) => ({\n        dashboardModel: currentData ? convertToDashboardModel(currentData) : undefined,\n        ...rest,\n      }),\n    }\n  );\n\n  return queryData;\n}\n","import { css, cx } from '@emotion/css';\nimport { noop } from 'lodash';\nimport { CSSProperties, useCallback, useMemo, useState } from 'react';\nimport { useDebounce } from 'react-use';\nimport AutoSizer from 'react-virtualized-auto-sizer';\nimport { FixedSizeList } from 'react-window';\n\nimport { GrafanaTheme2 } from '@grafana/data';\nimport { Trans, t } from '@grafana/i18n';\nimport {\n  Alert,\n  Button,\n  FilterInput,\n  Icon,\n  LoadingPlaceholder,\n  Modal,\n  Tooltip,\n  clearButtonStyles,\n  useStyles2,\n} from '@grafana/ui';\n\nimport { DashboardModel } from '../../../../dashboard/state/DashboardModel';\nimport { dashboardApi } from '../../api/dashboardApi';\n\nimport { useDashboardQuery } from './useDashboardQuery';\n\nexport interface PanelDTO {\n  id?: number;\n  title?: string;\n  type: string;\n  collapsed?: boolean;\n}\n\nfunction panelSort(a: PanelDTO, b: PanelDTO) {\n  if (a.title && b.title) {\n    return a.title.localeCompare(b.title);\n  }\n  if (a.title && !b.title) {\n    return 1;\n  } else if (!a.title && b.title) {\n    return -1;\n  }\n\n  return 0;\n}\n\ninterface DashboardPickerProps {\n  isOpen: boolean;\n  dashboardUid?: string;\n  panelId?: number;\n  onChange: (dashboardUid: string, panelId: number) => void;\n  onDismiss: () => void;\n}\n\nexport const DashboardPicker = ({ dashboardUid, panelId, isOpen, onChange, onDismiss }: DashboardPickerProps) => {\n  const styles = useStyles2(getPickerStyles);\n\n  const [selectedDashboardUid, setSelectedDashboardUid] = useState(dashboardUid);\n  const [selectedPanelId, setSelectedPanelId] = useState(panelId);\n\n  const [dashboardFilter, setDashboardFilter] = useState('');\n  const [debouncedDashboardFilter, setDebouncedDashboardFilter] = useState('');\n\n  const [panelFilter, setPanelFilter] = useState('');\n  const { useSearchQuery } = dashboardApi;\n\n  const { currentData: filteredDashboards = [], isFetching: isDashSearchFetching } = useSearchQuery({\n    query: debouncedDashboardFilter,\n  });\n  const { dashboardModel, isFetching: isDashboardFetching } = useDashboardQuery(selectedDashboardUid);\n\n  const handleDashboardChange = useCallback((dashboardUid: string) => {\n    setSelectedDashboardUid(dashboardUid);\n    setSelectedPanelId(undefined);\n  }, []);\n\n  const allDashboardPanels = getVisualPanels(dashboardModel);\n\n  const filteredPanels =\n    allDashboardPanels\n      .filter((panel) => panel.title?.toLowerCase().includes(panelFilter.toLowerCase()))\n      .sort(panelSort) ?? [];\n\n  const currentPanel: PanelDTO | undefined = allDashboardPanels.find(\n    (panel: PanelDTO) => isValidPanel(panel) && panel.id?.toString() === selectedPanelId\n  );\n\n  const selectedDashboardIndex = useMemo(() => {\n    return filteredDashboards.map((dashboard) => dashboard.uid).indexOf(selectedDashboardUid ?? '');\n  }, [filteredDashboards, selectedDashboardUid]);\n\n  const isDefaultSelection = dashboardUid && dashboardUid === selectedDashboardUid;\n  const selectedDashboardIsInPageResult = selectedDashboardIndex >= 0;\n\n  const scrollToItem = useCallback(\n    (node: FixedSizeList) => {\n      const canScroll = selectedDashboardIndex >= 0;\n\n      if (isDefaultSelection && canScroll) {\n        node?.scrollToItem(selectedDashboardIndex, 'smart');\n      }\n    },\n    [isDefaultSelection, selectedDashboardIndex]\n  );\n\n  useDebounce(\n    () => {\n      setDebouncedDashboardFilter(dashboardFilter);\n    },\n    500,\n    [dashboardFilter]\n  );\n\n  const DashboardRow = ({ index, style }: { index: number; style?: CSSProperties }) => {\n    const dashboard = filteredDashboards[index];\n    const isSelected = selectedDashboardUid === dashboard.uid;\n\n    return (\n      <button\n        type=\"button\"\n        title={dashboard.title}\n        style={style}\n        className={cx(styles.rowButton, { [styles.rowOdd]: index % 2 === 1, [styles.rowSelected]: isSelected })}\n        onClick={() => handleDashboardChange(dashboard.uid)}\n      >\n        <div className={cx(styles.dashboardTitle, styles.rowButtonTitle)}>{dashboard.title}</div>\n        <div className={styles.dashboardFolder}>\n          <Icon name=\"folder\" /> {dashboard.folderTitle ?? 'Dashboards'}\n        </div>\n      </button>\n    );\n  };\n\n  const PanelRow = ({ index, style }: { index: number; style: CSSProperties }) => {\n    const panel = filteredPanels[index];\n    const panelTitle = panel.title || '<No title>';\n    const isSelected = Boolean(panel.id) && selectedPanelId === panel.id;\n    const isAlertingCompatible = panel.type === 'graph' || panel.type === 'timeseries';\n    const disabled = !isValidPanel(panel);\n\n    return (\n      <button\n        type=\"button\"\n        style={style}\n        disabled={disabled}\n        className={cx(styles.rowButton, styles.panelButton, {\n          [styles.rowOdd]: index % 2 === 1,\n          [styles.rowSelected]: isSelected,\n        })}\n        onClick={() => (disabled ? noop : setSelectedPanelId(panel.id))}\n      >\n        <div className={styles.rowButtonTitle} title={panelTitle}>\n          {panelTitle}\n        </div>\n        {!isAlertingCompatible && !disabled && (\n          <Tooltip\n            content={t(\n              'alerting.dashboard-picker.panel-row.tooltip-alert-tab-support',\n              'The alert tab and alert annotations are only supported on graph and timeseries panels.'\n            )}\n          >\n            <Icon name=\"exclamation-triangle\" className={styles.warnIcon} data-testid=\"warning-icon\" />\n          </Tooltip>\n        )}\n        {disabled && (\n          <Tooltip\n            content={t(\n              'alerting.dashboard-picker.panel-row.content-panel-valid-identifier',\n              'This panel does not have a valid identifier.'\n            )}\n          >\n            <Icon name=\"info-circle\" data-testid=\"info-icon\" />\n          </Tooltip>\n        )}\n      </button>\n    );\n  };\n\n  const fallbackDashboardsString = t('alerting.dashboard-picker.fallback-dashboards-string', 'Dashboards');\n\n  return (\n    <Modal\n      title={t('alerting.dashboard-picker.title-select-dashboard-and-panel', 'Select dashboard and panel')}\n      closeOnEscape\n      isOpen={isOpen}\n      onDismiss={onDismiss}\n      className={styles.modal}\n      contentClassName={styles.modalContent}\n    >\n      {/* This alert shows if the selected dashboard is not found in the first page of dashboards */}\n      {!selectedDashboardIsInPageResult && dashboardUid && dashboardModel && (\n        <Alert\n          title={t('alerting.dashboard-picker.title-current-selection', 'Current selection')}\n          severity=\"info\"\n          topSpacing={0}\n          bottomSpacing={1}\n          className={styles.modalAlert}\n        >\n          <div>\n            <Trans\n              i18nKey=\"alerting.dashboard-picker.current-selection-dashboard\"\n              values={{\n                dashboardTitle: dashboardModel.title,\n                dashboardUid: dashboardModel.uid,\n                folderTitle: dashboardModel.meta?.folderTitle ?? fallbackDashboardsString,\n              }}\n            >\n              Dashboard: {'{{dashboardTitle}}'} ({'{{ dashboardUid }}'}) in folder {'{{ folderTitle }}'}\n            </Trans>\n          </div>\n          {currentPanel && (\n            <div>\n              <Trans\n                i18nKey=\"alerting.dashboard-picker.current-selection-panel\"\n                values={{ panelTitle: currentPanel.title, panelId: currentPanel.id }}\n              >\n                Panel: {'{{ panelTitle }}'} ({'{{ panelId }}'})\n              </Trans>\n            </div>\n          )}\n        </Alert>\n      )}\n      <div className={styles.container}>\n        <FilterInput\n          value={dashboardFilter}\n          onChange={setDashboardFilter}\n          title={t('alerting.dashboard-picker.title-search-dashboard', 'Search dashboard')}\n          placeholder={t('alerting.dashboard-picker.placeholder-search-dashboard', 'Search dashboard')}\n          autoFocus\n        />\n        <FilterInput\n          value={panelFilter}\n          onChange={setPanelFilter}\n          title={t('alerting.dashboard-picker.title-search-panel', 'Search panel')}\n          placeholder={t('alerting.dashboard-picker.placeholder-search-panel', 'Search panel')}\n        />\n\n        <div className={styles.column}>\n          {isDashSearchFetching && (\n            <LoadingPlaceholder\n              text={t('alerting.dashboard-picker.text-loading-dashboards', 'Loading dashboards...')}\n              className={styles.loadingPlaceholder}\n            />\n          )}\n\n          {!isDashSearchFetching && (\n            <AutoSizer>\n              {({ height, width }) => (\n                <FixedSizeList\n                  ref={scrollToItem}\n                  itemSize={50}\n                  height={height}\n                  width={width}\n                  itemCount={filteredDashboards.length}\n                >\n                  {DashboardRow}\n                </FixedSizeList>\n              )}\n            </AutoSizer>\n          )}\n        </div>\n\n        <div className={styles.column}>\n          {!selectedDashboardUid && !isDashboardFetching && (\n            <div className={styles.selectDashboardPlaceholder}>\n              <div>\n                <Trans i18nKey=\"alerting.dashboard-picker.select-dashboard-available-panels\">\n                  Select a dashboard to get a list of available panels\n                </Trans>\n              </div>\n            </div>\n          )}\n          {isDashboardFetching && (\n            <LoadingPlaceholder\n              text={t('alerting.dashboard-picker.text-loading-dashboard', 'Loading dashboard...')}\n              className={styles.loadingPlaceholder}\n            />\n          )}\n\n          {selectedDashboardUid && !isDashboardFetching && (\n            <AutoSizer>\n              {({ width, height }) => (\n                <FixedSizeList itemSize={32} height={height} width={width} itemCount={filteredPanels.length}>\n                  {PanelRow}\n                </FixedSizeList>\n              )}\n            </AutoSizer>\n          )}\n        </div>\n      </div>\n      <Modal.ButtonRow>\n        <Button type=\"button\" variant=\"secondary\" onClick={onDismiss} fill=\"text\">\n          <Trans i18nKey=\"alerting.common.cancel\">Cancel</Trans>\n        </Button>\n        <Button\n          type=\"button\"\n          variant=\"primary\"\n          disabled={!(selectedDashboardUid && selectedPanelId)}\n          onClick={() => {\n            if (selectedDashboardUid && selectedPanelId) {\n              onChange(selectedDashboardUid, selectedPanelId);\n            }\n          }}\n        >\n          <Trans i18nKey=\"alerting.dashboard-picker.confirm\">Confirm</Trans>\n        </Button>\n      </Modal.ButtonRow>\n    </Modal>\n  );\n};\n\nexport function getVisualPanels(dashboardModel: DashboardModel | undefined) {\n  if (!dashboardModel) {\n    return [];\n  }\n\n  const panelsWithoutRows = dashboardModel.panels.filter((panel) => panel.type !== 'row');\n  const panelsNestedInRows = dashboardModel.panels\n    .filter((rowPanel) => rowPanel.collapsed)\n    .flatMap((collapsedRow) => collapsedRow.panels ?? []);\n\n  const allDashboardPanels = [...panelsWithoutRows, ...panelsNestedInRows];\n  return allDashboardPanels;\n}\n\nconst isValidPanel = (panel: PanelDTO): boolean => {\n  const hasValidID = typeof panel.id === 'number';\n  const isValidPanelType = typeof panel.type === 'string';\n  const isLibraryPanel = 'libraryPanel' in panel;\n\n  return hasValidID && (isValidPanelType || isLibraryPanel);\n};\n\nconst getPickerStyles = (theme: GrafanaTheme2) => {\n  const clearButton = clearButtonStyles(theme);\n\n  return {\n    container: css({\n      display: 'grid',\n      gridTemplateColumns: '1fr 1fr',\n      gridTemplateRows: 'min-content auto',\n      gap: theme.spacing(2),\n      flex: 1,\n    }),\n    column: css({\n      flex: '1 1 auto',\n    }),\n    dashboardTitle: css({\n      height: '22px',\n      fontWeight: theme.typography.fontWeightBold,\n    }),\n    dashboardFolder: css({\n      height: '20px',\n      fontSize: theme.typography.bodySmall.fontSize,\n      color: theme.colors.text.secondary,\n      display: 'flex',\n      flexDirection: 'row',\n      justifyContent: 'flex-start',\n      columnGap: theme.spacing(1),\n      alignItems: 'center',\n    }),\n    rowButton: css(clearButton, {\n      padding: theme.spacing(0.5),\n      overflow: 'hidden',\n      textOverflow: 'ellipsis',\n      textAlign: 'left',\n      whiteSpace: 'nowrap',\n      cursor: 'pointer',\n      border: '2px solid transparent',\n\n      '&:disabled': {\n        cursor: 'not-allowed',\n        color: theme.colors.text.disabled,\n      },\n    }),\n    rowButtonTitle: css({\n      textOverflow: 'ellipsis',\n      overflow: 'hidden',\n    }),\n    rowSelected: css({\n      borderColor: theme.colors.primary.border,\n    }),\n    rowOdd: css({\n      backgroundColor: theme.colors.background.secondary,\n    }),\n    panelButton: css({\n      display: 'flex',\n      gap: theme.spacing(1),\n      justifyContent: 'space-between',\n      alignItems: 'center',\n    }),\n    loadingPlaceholder: css({\n      height: '100%',\n      display: 'flex',\n      justifyContent: 'center',\n      alignItems: 'center',\n    }),\n    selectDashboardPlaceholder: css({\n      width: '100%',\n      height: '100%',\n      display: 'flex',\n      flexDirection: 'column',\n      justifyContent: 'center',\n      textAlign: 'center',\n      fontWeight: theme.typography.fontWeightBold,\n    }),\n    modal: css({\n      height: '100%',\n    }),\n    modalContent: css({\n      flex: 1,\n      display: 'flex',\n      flexDirection: 'column',\n    }),\n    modalAlert: css({\n      flexGrow: 0,\n    }),\n    warnIcon: css({\n      fill: theme.colors.warning.main,\n    }),\n  };\n};\n","import { ComponentType } from 'react';\n\nimport { t } from '@grafana/i18n';\nimport { withErrorBoundary } from '@grafana/ui';\n\nimport { logError } from '../../../../Analytics';\n\nexport interface NotificationMessageSectionExtensionProps {}\n\n// Internal variable to store the extension component, for now only one component is supported\nlet InternalNotificationMessageSectionExtension: ComponentType<NotificationMessageSectionExtensionProps> | null = null;\n\n// This component is used to render the notification message section extension.\nexport const NotificationMessageSectionExtension: ComponentType<NotificationMessageSectionExtensionProps> = (props) => {\n  if (!InternalNotificationMessageSectionExtension) {\n    return null;\n  }\n\n  // Wrap the component with error boundary\n  const WrappedComponent = withErrorBoundary(InternalNotificationMessageSectionExtension, {\n    title: t(\n      'alerting.enrichment.error-boundary.notification-message-section-extension',\n      'Notification Message Section Extension failed to load'\n    ),\n    style: 'alertbox',\n    errorLogger: logError,\n  });\n\n  return <WrappedComponent {...props} />;\n};\n\nexport function addRuleFormEnrichmentSection(component: ComponentType<NotificationMessageSectionExtensionProps>) {\n  InternalNotificationMessageSectionExtension = component;\n}\n","import { css, cx } from '@emotion/css';\nimport { produce } from 'immer';\nimport { useEffect, useState } from 'react';\nimport { useFieldArray, useFormContext } from 'react-hook-form';\nimport { useToggle } from 'react-use';\n\nimport { GrafanaTheme2 } from '@grafana/data';\nimport { Trans, t } from '@grafana/i18n';\nimport { Button, Field, Input, Stack, Text, TextArea, useStyles2 } from '@grafana/ui';\n\nimport { DashboardModel } from '../../../../dashboard/state/DashboardModel';\nimport { AIImproveAnnotationsButtonComponent } from '../../enterprise-components/AI/AIGenImproveAnnotationsButton/addAIImproveAnnotationsButton';\nimport { RuleFormValues } from '../../types/rule-form';\nimport { Annotation, annotationLabels } from '../../utils/constants';\nimport { isGrafanaManagedRuleByType } from '../../utils/rules';\n\nimport AnnotationHeaderField from './AnnotationHeaderField';\nimport DashboardAnnotationField from './DashboardAnnotationField';\nimport { DashboardPicker, PanelDTO, getVisualPanels } from './DashboardPicker';\nimport { NeedHelpInfo } from './NeedHelpInfo';\nimport { RuleEditorSection } from './RuleEditorSection';\nimport { NotificationMessageSectionExtension } from './alert-rule-form/extensions/NotificationMessageSectionExtension';\nimport { useDashboardQuery } from './useDashboardQuery';\n\nconst AnnotationsStep = () => {\n  const styles = useStyles2(getStyles);\n  const [showPanelSelector, setShowPanelSelector] = useToggle(false);\n\n  const {\n    control,\n    register,\n    watch,\n    formState: { errors },\n    setValue,\n  } = useFormContext<RuleFormValues>();\n  const annotations = watch('annotations');\n  const type = watch('type');\n\n  const { fields, append, remove } = useFieldArray({ control, name: 'annotations' });\n\n  const selectedDashboardUid = annotations.find((annotation) => annotation.key === Annotation.dashboardUID)?.value;\n  const selectedPanelId = Number(annotations.find((annotation) => annotation.key === Annotation.panelID)?.value);\n\n  const [selectedDashboard, setSelectedDashboard] = useState<DashboardModel | undefined>(undefined);\n  const [selectedPanel, setSelectedPanel] = useState<PanelDTO | undefined>(undefined);\n\n  const { dashboardModel, isFetching: isDashboardFetching } = useDashboardQuery(selectedDashboardUid);\n\n  useEffect(() => {\n    if (isDashboardFetching || !dashboardModel) {\n      return;\n    }\n\n    setSelectedDashboard(dashboardModel);\n\n    const allPanels = getVisualPanels(dashboardModel);\n    const currentPanel = allPanels.find((panel) => panel.id === selectedPanelId);\n    setSelectedPanel(currentPanel);\n  }, [selectedPanelId, dashboardModel, isDashboardFetching]);\n\n  const setSelectedDashboardAndPanelId = (dashboardUid: string, panelId: number) => {\n    const updatedAnnotations = produce(annotations, (draft) => {\n      const dashboardAnnotation = draft.find((a) => a.key === Annotation.dashboardUID);\n      const panelAnnotation = draft.find((a) => a.key === Annotation.panelID);\n\n      if (dashboardAnnotation) {\n        dashboardAnnotation.value = dashboardUid;\n      } else {\n        draft.push({ key: Annotation.dashboardUID, value: dashboardUid });\n      }\n\n      if (panelAnnotation) {\n        panelAnnotation.value = panelId.toString();\n      } else {\n        draft.push({ key: Annotation.panelID, value: panelId.toString() });\n      }\n    });\n\n    setValue('annotations', updatedAnnotations);\n    setShowPanelSelector(false);\n  };\n\n  const handleDeleteDashboardAnnotation = () => {\n    const updatedAnnotations = annotations.filter(\n      (a) => a.key !== Annotation.dashboardUID && a.key !== Annotation.panelID\n    );\n    setValue('annotations', updatedAnnotations);\n    setSelectedDashboard(undefined);\n    setSelectedPanel(undefined);\n  };\n\n  const handleEditDashboardAnnotation = () => {\n    setShowPanelSelector(true);\n  };\n\n  function getAnnotationsSectionDescription() {\n    return (\n      <Stack direction=\"row\" gap={0.5} alignItems=\"center\">\n        <Text variant=\"bodySmall\" color=\"secondary\">\n          <Trans i18nKey=\"alerting.annotations.description\">Add more context to your alert notifications.</Trans>\n        </Text>\n        <NeedHelpInfo\n          externalLink={\n            'https://grafana.com/docs/grafana/latest/alerting/fundamentals/alert-rules/annotation-label/#annotations'\n          }\n          linkText={`Read about annotations`}\n          contentText={\n            <>\n              <p>\n                {t(\n                  'alerting.rule-form.annotations.description1',\n                  'Annotations add additional information to alerts, helping alert responders identify and address potential issues.'\n                )}\n              </p>\n              <p>\n                {t(\n                  'alerting.rule-form.annotations.description2',\n                  'For example, add a Summary annotation to tell you which value caused the alert to fire or which server it happened on.'\n                )}\n              </p>\n              {t(\n                'alerting.rule-form.annotations.description3',\n                'Annotations can contain a combination of text and template code, which is used to include data from queries.'\n              )}\n            </>\n          }\n          title={t('alerting.annotations-step.get-annotations-section-description.title-annotations', 'Annotations')}\n        />\n      </Stack>\n    );\n  }\n  // when using Grafana managed rules, the annotations step is the 6th step, as we have an additional step for the configure labels and notifications\n  const step = isGrafanaManagedRuleByType(type) ? 6 : 5;\n\n  return (\n    <RuleEditorSection\n      stepNo={step}\n      title={t('alerting.annotations.title', 'Configure notification message')}\n      description={getAnnotationsSectionDescription()}\n      fullWidth\n    >\n      <Stack direction=\"column\" gap={1}>\n        {isGrafanaManagedRuleByType(type) && <AIImproveAnnotationsButtonComponent />}\n        {fields.map((annotationField, index: number) => {\n          const isUrl = annotations[index]?.key?.toLocaleLowerCase().endsWith('url');\n          const ValueInputComponent = isUrl ? Input : TextArea;\n          // eslint-disable-next-line\n          const annotation = annotationField.key as Annotation;\n          return (\n            <div key={annotationField.id} className={styles.flexRow}>\n              <div>\n                <AnnotationHeaderField\n                  annotationField={annotationField}\n                  annotations={annotations}\n                  annotation={annotation}\n                  index={index}\n                  labelId={`annotation-${index}`}\n                />\n                {selectedDashboardUid && selectedPanelId && annotationField.key === Annotation.dashboardUID && (\n                  <DashboardAnnotationField\n                    dashboard={selectedDashboard}\n                    panel={selectedPanel}\n                    dashboardUid={selectedDashboardUid.toString()}\n                    panelId={selectedPanelId.toString()}\n                    onEditClick={handleEditDashboardAnnotation}\n                    onDeleteClick={handleDeleteDashboardAnnotation}\n                  />\n                )}\n                <div className={styles.annotationValueContainer}>\n                  <Field\n                    hidden={\n                      annotationField.key === Annotation.dashboardUID || annotationField.key === Annotation.panelID\n                    }\n                    className={cx(styles.flexRowItemMargin, styles.field)}\n                    invalid={!!errors.annotations?.[index]?.value?.message}\n                    error={errors.annotations?.[index]?.value?.message}\n                    noMargin\n                  >\n                    <ValueInputComponent\n                      data-testid={`annotation-value-${index}`}\n                      id={`annotation-${index}`}\n                      className={cx(styles.annotationValueInput, { [styles.textarea]: !isUrl })}\n                      {...register(`annotations.${index}.value`)}\n                      placeholder={\n                        isUrl\n                          ? // eslint-disable-next-line @grafana/i18n/no-untranslated-strings\n                            'https://'\n                          : (annotationField.key &&\n                              t('alerting.annotations-step.placeholder-value-input', 'Enter a {{key}}...', {\n                                key: annotationField.key,\n                              })) ||\n                            t(\n                              'alerting.annotations-step.placeholder-value-input-default',\n                              'Enter custom annotation content...'\n                            )\n                      }\n                      defaultValue={annotationField.value}\n                    />\n                  </Field>\n                  {!annotationLabels[annotation] && (\n                    <Button\n                      type=\"button\"\n                      className={styles.deleteAnnotationButton}\n                      aria-label={t('alerting.annotations-step.aria-label-delete-annotation', 'delete annotation')}\n                      icon=\"trash-alt\"\n                      variant=\"secondary\"\n                      onClick={() => remove(index)}\n                    />\n                  )}\n                </div>\n              </div>\n            </div>\n          );\n        })}\n        <Stack direction=\"row\" gap={1}>\n          <div className={styles.addAnnotationsButtonContainer}>\n            <Button\n              icon=\"plus\"\n              type=\"button\"\n              variant=\"secondary\"\n              onClick={() => {\n                append({ key: '', value: '' });\n              }}\n            >\n              <Trans i18nKey=\"alerting.annotations-step.add-custom-annotation\">Add custom annotation</Trans>\n            </Button>\n            {!selectedDashboard && (\n              <Button type=\"button\" variant=\"secondary\" icon=\"dashboard\" onClick={() => setShowPanelSelector(true)}>\n                <Trans i18nKey=\"alerting.annotations-step.link-dashboard-and-panel\">Link dashboard and panel</Trans>\n              </Button>\n            )}\n          </div>\n        </Stack>\n        {showPanelSelector && (\n          <DashboardPicker\n            isOpen={true}\n            dashboardUid={selectedDashboardUid}\n            panelId={selectedPanelId}\n            onChange={setSelectedDashboardAndPanelId}\n            onDismiss={() => setShowPanelSelector(false)}\n          />\n        )}\n        <NotificationMessageSectionExtension />\n      </Stack>\n    </RuleEditorSection>\n  );\n};\n\nconst getStyles = (theme: GrafanaTheme2) => ({\n  annotationValueInput: css({\n    width: '394px',\n  }),\n  textarea: css({\n    height: '76px',\n  }),\n  addAnnotationsButtonContainer: css({\n    marginTop: theme.spacing(1),\n    gap: theme.spacing(1),\n    display: 'flex',\n  }),\n  field: css({\n    marginBottom: theme.spacing(0.5),\n  }),\n  flexRow: css({\n    display: 'flex',\n    flexDirection: 'row',\n    justifyContent: 'flex-start',\n  }),\n  flexRowItemMargin: css({\n    marginTop: theme.spacing(1),\n  }),\n  deleteAnnotationButton: css({\n    display: 'inline-block',\n    marginTop: '10px',\n    marginLeft: '10px',\n  }),\n\n  annotationTitle: css({\n    color: theme.colors.text.primary,\n    marginBottom: '3px',\n  }),\n\n  annotationContainer: css({\n    marginTop: '5px',\n  }),\n\n  annotationDescription: css({\n    color: theme.colors.text.secondary,\n  }),\n\n  annotationValueContainer: css({\n    display: 'flex',\n  }),\n});\n\nexport default AnnotationsStep;\n","import { css } from '@emotion/css';\n\nimport { GrafanaTheme2 } from '@grafana/data';\nimport { Trans } from '@grafana/i18n';\nimport { Icon, Stack, Text, Toggletip, useStyles2 } from '@grafana/ui';\n\ninterface NeedHelpInfoProps {\n  contentText: string | JSX.Element;\n  externalLink?: string;\n  linkText?: string;\n  title?: string;\n}\nexport function NeedHelpInfo({ contentText, externalLink, linkText, title = 'Need help?' }: NeedHelpInfoProps) {\n  const styles = useStyles2(getStyles);\n\n  return (\n    <Toggletip\n      content={<div className={styles.mutedText}>{contentText}</div>}\n      title={\n        <Stack gap={0.5} direction=\"row\" alignItems=\"center\">\n          <Icon name=\"question-circle\" />\n          {title}\n        </Stack>\n      }\n      footer={\n        externalLink ? (\n          <a href={externalLink} target=\"_blank\" rel=\"noreferrer\">\n            <Stack direction=\"row\" gap={0.5} alignItems=\"center\">\n              <Text color=\"link\">\n                {linkText} <Icon size=\"sm\" name=\"external-link-alt\" />\n              </Text>\n            </Stack>\n          </a>\n        ) : undefined\n      }\n      closeButton={true}\n      placement=\"bottom-start\"\n    >\n      <div className={styles.helpInfo}>\n        <Stack direction=\"row\" alignItems=\"center\" gap={0.5}>\n          <Icon name=\"question-circle\" size=\"sm\" />\n          <Text variant=\"bodySmall\" color=\"primary\">\n            <Trans i18nKey=\"alerting.need-help-info.need-help\">Need help?</Trans>\n          </Text>\n        </Stack>\n      </div>\n    </Toggletip>\n  );\n}\n\nconst getStyles = (theme: GrafanaTheme2) => ({\n  mutedText: css({\n    color: theme.colors.text.secondary,\n    fontSize: theme.typography.size.sm,\n  }),\n  helpInfo: css({\n    cursor: 'pointer',\n    textDecoration: 'underline',\n  }),\n});\n","import { css, cx } from '@emotion/css';\nimport * as React from 'react';\nimport { ReactElement } from 'react';\n\nimport { GrafanaTheme2 } from '@grafana/data';\nimport { selectors } from '@grafana/e2e-selectors';\nimport { t } from '@grafana/i18n';\nimport { FieldSet, InlineSwitch, Stack, Text, useStyles2 } from '@grafana/ui';\n\nexport interface RuleEditorSectionProps {\n  title: string;\n  stepNo: number;\n  description?: string | ReactElement;\n  fullWidth?: boolean;\n  switchMode?: {\n    isAdvancedMode: boolean;\n    setAdvancedMode: (isAdvanced: boolean) => void;\n  };\n}\n\nexport const RuleEditorSection = ({\n  title,\n  stepNo,\n  children,\n  fullWidth = false,\n  description,\n  switchMode,\n}: React.PropsWithChildren<RuleEditorSectionProps>) => {\n  const styles = useStyles2(getStyles);\n\n  const AlertRuleSelectors = selectors.components.AlertRules;\n  return (\n    <div className={styles.parent} data-testid={AlertRuleSelectors.step(stepNo.toString())}>\n      <FieldSet\n        className={cx(fullWidth && styles.fullWidth)}\n        label={\n          <Stack direction=\"row\" alignItems=\"center\" justifyContent=\"space-between\">\n            <Text variant=\"h3\">\n              {stepNo}. {title}\n            </Text>\n            {switchMode && (\n              <Text variant=\"bodySmall\">\n                <InlineSwitch\n                  data-testid={AlertRuleSelectors.stepAdvancedModeSwitch(stepNo.toString())}\n                  value={switchMode.isAdvancedMode}\n                  onChange={(event) => {\n                    switchMode.setAdvancedMode(event.currentTarget.checked);\n                  }}\n                  label={t('alerting.rule-editor-section.label-advanced-options', 'Advanced options')}\n                  showLabel\n                  transparent\n                  className={styles.reverse}\n                />\n              </Text>\n            )}\n          </Stack>\n        }\n      >\n        <Stack direction=\"column\">\n          {description && <div className={styles.description}>{description}</div>}\n          {children}\n        </Stack>\n      </FieldSet>\n    </div>\n  );\n};\n\nconst getStyles = (theme: GrafanaTheme2) => ({\n  parent: css({\n    display: 'flex',\n    flexDirection: 'row',\n    border: `solid 1px ${theme.colors.border.weak}`,\n    borderRadius: theme.shape.radius.default,\n    padding: `${theme.spacing(2)} ${theme.spacing(3)}`,\n  }),\n  description: css({\n    marginTop: `-${theme.spacing(2)}`,\n  }),\n  fullWidth: css({\n    width: '100%',\n  }),\n  reverse: css({\n    flexDirection: 'row-reverse',\n    gap: theme.spacing(1),\n  }),\n});\n","import { skipToken } from '@reduxjs/toolkit/query';\nimport { useEffect, useMemo } from 'react';\n\nimport { RuleNamespace } from 'app/types/unified-alerting';\nimport { RulerRulesConfigDTO } from 'app/types/unified-alerting-dto';\n\nimport { alertRuleApi } from '../../api/alertRuleApi';\nimport { featureDiscoveryApi } from '../../api/featureDiscoveryApi';\nimport { shouldUsePrometheusRulesPrimary } from '../../featureToggles';\n\nconst { usePrometheusRuleNamespacesQuery, useLazyRulerRulesQuery, useRulerRulesQuery } = alertRuleApi;\nconst { useDiscoverDsFeaturesQuery } = featureDiscoveryApi;\n\nconst emptyRulerConfig: RulerRulesConfigDTO = {};\n\nconst prometheusRulesPrimary = shouldUsePrometheusRulesPrimary();\nexport function useGetLabelsFromDataSourceName(rulesSourceName: string) {\n  const { data: features, isLoading: isFeaturesLoading } = useDiscoverDsFeaturesQuery({ rulesSourceName });\n\n  // emptyRulerConfig is used to prevent from triggering  labels' useMemo all the time\n  // rulerRules = {} creates a new object and triggers useMemo to recalculate labels\n  const [fetchRulerRules, { data: rulerRules = emptyRulerConfig, isLoading: isRulerRulesLoading }] =\n    useLazyRulerRulesQuery();\n\n  const { data: promNamespaces = [], isLoading: isPrometheusRulesLoading } = usePrometheusRuleNamespacesQuery(\n    { ruleSourceName: rulesSourceName },\n    { skip: !prometheusRulesPrimary }\n  );\n\n  useEffect(() => {\n    if (features?.rulerConfig && !prometheusRulesPrimary) {\n      fetchRulerRules({ rulerConfig: features.rulerConfig }, true);\n    }\n  }, [features?.rulerConfig, fetchRulerRules]);\n\n  const labels = useMemo(() => {\n    if (isPrometheusRulesLoading || isRulerRulesLoading) {\n      return new Map<string, Set<string>>();\n    }\n\n    if (prometheusRulesPrimary) {\n      return promNamespacesToLabels(promNamespaces);\n    }\n\n    return rulerRulesToLabels(rulerRules);\n  }, [promNamespaces, rulerRules, isPrometheusRulesLoading, isRulerRulesLoading]);\n\n  return { labels, isLoading: isPrometheusRulesLoading || isRulerRulesLoading || isFeaturesLoading };\n}\n\nexport function useGetNameSpacesByDatasourceName(rulesSourceName?: string) {\n  const { data: features, isLoading: isFeaturesLoading } = useDiscoverDsFeaturesQuery(\n    rulesSourceName ? { rulesSourceName } : skipToken,\n    { skip: !rulesSourceName }\n  );\n\n  // emptyRulerConfig is used to prevent from triggering  labels' useMemo all the time\n  // rulerRules = {} creates a new object and triggers useMemo to recalculate labels\n  const [fetchRulerRules, { data: rulerRules = emptyRulerConfig, isLoading: isRulerRulesLoading }] =\n    useLazyRulerRulesQuery();\n\n  const { data: promNamespaces = [], isLoading: isPrometheusRulesLoading } = usePrometheusRuleNamespacesQuery(\n    rulesSourceName && prometheusRulesPrimary ? { ruleSourceName: rulesSourceName } : skipToken\n  );\n\n  useEffect(() => {\n    if (features?.rulerConfig && !prometheusRulesPrimary) {\n      fetchRulerRules({ rulerConfig: features.rulerConfig });\n    }\n  }, [features?.rulerConfig, fetchRulerRules]);\n\n  const namespaceGroups = useMemo(() => {\n    if (isPrometheusRulesLoading || isRulerRulesLoading) {\n      return new Map<string, string[]>();\n    }\n\n    if (prometheusRulesPrimary) {\n      return promNamespacesToNamespaceGroups(promNamespaces);\n    }\n\n    return rulerRulesToNamespaceGroups(rulerRules);\n  }, [promNamespaces, rulerRules, isPrometheusRulesLoading, isRulerRulesLoading]);\n\n  return {\n    namespaceGroups,\n    isLoading: isPrometheusRulesLoading || isRulerRulesLoading || isFeaturesLoading,\n    promNamespaces,\n  };\n}\n\nexport function useGetRulerRules(\n  /** Rules source name to fetch namespaces from */\n  rulesSourceName?: string\n) {\n  const { data: features, isLoading: isFeaturesLoading } = useDiscoverDsFeaturesQuery(\n    rulesSourceName ? { rulesSourceName } : skipToken\n  );\n\n  const { data: rulerRules = emptyRulerConfig, isLoading: isRulerRulesLoading } = useRulerRulesQuery(\n    features?.rulerConfig ? { rulerConfig: features.rulerConfig } : skipToken\n  );\n\n  return {\n    isLoading: isRulerRulesLoading || isFeaturesLoading,\n    rulerRules,\n  };\n}\n\nfunction promNamespacesToNamespaceGroups(promNamespaces: RuleNamespace[]) {\n  const groups = new Map<string, string[]>();\n  promNamespaces.forEach((namespace) => {\n    groups.set(\n      namespace.name,\n      namespace.groups.map((group) => group.name)\n    );\n  });\n  return groups;\n}\n\nexport function rulerRulesToNamespaceGroups(rulerConfig: RulerRulesConfigDTO) {\n  const result = new Map<string, string[]>();\n  Object.entries(rulerConfig).forEach(([namespace, groups]) => {\n    result.set(\n      namespace,\n      groups.map((group) => group.name)\n    );\n  });\n  return result;\n}\n\nfunction promNamespacesToLabels(promNamespace: RuleNamespace[]) {\n  const rules = promNamespace.flatMap((namespace) => namespace.groups).flatMap((group) => group.rules);\n\n  return rules.reduce((result, rule) => {\n    if (!rule.labels) {\n      return result;\n    }\n\n    Object.entries(rule.labels).forEach(([labelKey, labelValue]) => {\n      if (!labelKey || !labelValue) {\n        return;\n      }\n\n      const labelEntry = result.get(labelKey);\n      if (labelEntry) {\n        labelEntry.add(labelValue);\n      } else {\n        result.set(labelKey, new Set([labelValue]));\n      }\n    });\n    return result;\n  }, new Map<string, Set<string>>());\n}\n\nfunction rulerRulesToLabels(rulerConfig: RulerRulesConfigDTO) {\n  const result = new Map<string, Set<string>>();\n\n  const rules = Object.entries(rulerConfig)\n    .flatMap(([_, groups]) => groups)\n    .flatMap((group) => group.rules);\n\n  return rules.reduce((result, rule) => {\n    if (!rule.labels) {\n      return result;\n    }\n\n    Object.entries(rule.labels).forEach(([labelKey, labelValue]) => {\n      if (!labelKey || !labelValue) {\n        return;\n      }\n\n      const labelEntry = result.get(labelKey);\n      if (labelEntry) {\n        labelEntry.add(labelValue);\n      } else {\n        result.set(labelKey, new Set([labelValue]));\n      }\n    });\n    return result;\n  }, result);\n}\n","import { ComponentType, createElement } from 'react';\n\nimport { t } from '@grafana/i18n';\nimport { withErrorBoundary } from '@grafana/ui';\n\nimport { logError } from '../../Analytics';\n\nexport type AIFeedbackOrigin = 'alert-rule' | 'template' | 'triage';\n\nexport interface GenAIFeedbackButtonProps {\n  origin: AIFeedbackOrigin;\n  shouldShowFeedbackButton?: boolean;\n  // If true, the component will use the route detection to determine if the feedback should be shown\n  // this is necessary for example in alerting rule form, where the feedback button is shown in the same page as the rule form\n  useRouteDetection?: boolean;\n}\n\nlet InternalAIFeedbackButtonComponent: ComponentType<GenAIFeedbackButtonProps> | null = null;\n\nexport const AIFeedbackButtonComponent: ComponentType<GenAIFeedbackButtonProps> = (props) => {\n  if (!InternalAIFeedbackButtonComponent) {\n    return null;\n  }\n\n  // Wrap the component with error boundary\n  const WrappedComponent = withErrorBoundary(InternalAIFeedbackButtonComponent, {\n    title: t('alerting.ai.error-boundary.feedback-button', 'AI Feedback Button failed to load'),\n    style: 'alertbox',\n    errorLogger: logError,\n  });\n\n  // Provide default value for shouldShowFeedbackButton\n  const propsWithDefaults = {\n    shouldShowFeedbackButton: true,\n    useRouteDetection: false,\n    ...props,\n  };\n\n  return createElement(WrappedComponent, propsWithDefaults);\n};\n\nexport function addAIFeedbackButton(component: ComponentType<GenAIFeedbackButtonProps> | null) {\n  InternalAIFeedbackButtonComponent = component;\n}\n"],"names":["labelsApi","alertingApi","build","key","AlertLabelDropdown","onChange","options","defaultValue","type","onOpenMenu","isLoading","ref","styles","getStyles","handleChange","option","currentValue","Field","Combobox","RemoveButton","remove","index","Button","AddButton","append","useGetOpsLabelsKeys","skip","currentData","isloadingLabels","mapLabelsToOptions","items","labelsInSubForm","existingKeys","label","item","LabelsInRule","labels","labelsObj","acc","AlertLabels","LabelsSubForm","dataSourceName","onClose","initialLabels","watch","onSave","onCancel","defaultValues","formAPI","Stack","Text","getLabelText","getDescriptionText","LabelsWithSuggestions","Space","isKeyAllowed","labelKey","useCombinedLabels","labelsPluginInstalled","loadingLabelsPlugin","labelsInSubform","selectedKey","labelsByKeyFromExisingAlerts","isLoadingLabels","labelsOpsKeys","labelsByKeyOps","keysFromGopsLabels","keysFromExistingAlerts","groupedOptions","selectedKeyIsFromAlerts","selectedKeyIsFromOps","selectedKeyDoesNotExist","valuesAlreadyFetched","valuesData","isLoadingValues","error","valuesFromSelectedGopsKey","valuesForSelectedKey","values","value","getValuesForLabel","control","errors","fields","appendLabel","setSelectedKey","usePluginBridge","loading","field","rest","group","newValue","InlineLabel","LabelsWithoutSuggestions","register","Input","LabelsField","NeedHelpInfo","theme","CollapseToggle","isCollapsed","onToggle","idControlled","className","text","size","restOfProps","InternalAIImproveAnnotationsButtonComponent","AIImproveAnnotationsButtonComponent","props","WrappedComponent","addAIImproveAnnotationsButton","component","CustomAnnotationHeaderField","annotationField","annotations","annotation","labelId","DashboardAnnotationField","dashboard","panel","dashboardUid","panelId","onEditClick","onDeleteClick","dashboardLink","panelLink","Icon","dashboardApi","query","params","uid","convertToDashboardModel","dashboardDTO","meta","DashboardModel","useDashboardQuery","data","panelSort","a","b","DashboardPicker","isOpen","onDismiss","getPickerStyles","selectedDashboardUid","setSelectedDashboardUid","selectedPanelId","setSelectedPanelId","dashboardFilter","setDashboardFilter","debouncedDashboardFilter","setDebouncedDashboardFilter","panelFilter","setPanelFilter","useSearchQuery","filteredDashboards","isDashSearchFetching","dashboardModel","isDashboardFetching","handleDashboardChange","allDashboardPanels","getVisualPanels","filteredPanels","currentPanel","isValidPanel","selectedDashboardIndex","isDefaultSelection","selectedDashboardIsInPageResult","scrollToItem","node","canScroll","useDebounce","DashboardRow","style","isSelected","PanelRow","panelTitle","isAlertingCompatible","disabled","Tooltip","fallbackDashboardsString","Modal","Alert","FilterInput","LoadingPlaceholder","height","width","panelsWithoutRows","panelsNestedInRows","rowPanel","collapsedRow","hasValidID","isValidPanelType","isLibraryPanel","clearButton","InternalNotificationMessageSectionExtension","NotificationMessageSectionExtension","addRuleFormEnrichmentSection","AnnotationsStep","showPanelSelector","setShowPanelSelector","useToggle","setValue","selectedDashboard","setSelectedDashboard","selectedPanel","setSelectedPanel","setSelectedDashboardAndPanelId","updatedAnnotations","draft","dashboardAnnotation","panelAnnotation","handleDeleteDashboardAnnotation","handleEditDashboardAnnotation","getAnnotationsSectionDescription","step","RuleEditorSection","isUrl","ValueInputComponent","TextArea","contentText","externalLink","linkText","title","stepNo","children","fullWidth","description","switchMode","AlertRuleSelectors","event","usePrometheusRuleNamespacesQuery","useLazyRulerRulesQuery","useRulerRulesQuery","useDiscoverDsFeaturesQuery","emptyRulerConfig","prometheusRulesPrimary","useGetLabelsFromDataSourceName","rulesSourceName","features","isFeaturesLoading","fetchRulerRules","rulerRules","isRulerRulesLoading","promNamespaces","isPrometheusRulesLoading","promNamespacesToLabels","rulerRulesToLabels","useGetNameSpacesByDatasourceName","promNamespacesToNamespaceGroups","rulerRulesToNamespaceGroups","useGetRulerRules","groups","namespace","rulerConfig","result","promNamespace","rule","labelValue","labelEntry","_","InternalAIFeedbackButtonComponent","AIFeedbackButtonComponent","propsWithDefaults","addAIFeedbackButton"],"sourceRoot":""}