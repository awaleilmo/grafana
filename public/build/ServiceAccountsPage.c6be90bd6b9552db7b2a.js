"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[6777],{9390:(ee,B,t)=>{t.d(B,{r:()=>m});var e=t(74848),C=t(90382),i=t(92745),p=t(18857);const x=Object.values(C.X).filter(o=>o!==C.X.None).map(o=>({label:o,value:o}));function m({value:o,onChange:v,"aria-label":A,inputId:r,autoFocus:P,...L}){return(0,e.jsx)(p.l6,{inputId:r,value:o,options:x,onChange:U=>v(U.value??C.X.None),placeholder:(0,i.t)("admin.org-role-picker.placeholder-choose-role","Choose role..."),"aria-label":A,autoFocus:P,...L})}},18079:(ee,B,t)=>{t.d(B,{z:()=>F});var e=t(74848),C=t(22803),i=t(96540),p=t(24726),n=t(92745),x=t(43173),m=t(47931),o=t(43482),v=t(22787),A=t(45861),r=t(37386),P=t(77824),L=t(63527),U=t(63142);const z=[{label:"No expiration",value:!1},{label:"Set expiration date",value:!0}],F=({isOpen:l,token:a,serviceAccountLogin:s,onCreateToken:N,onClose:M})=>{const y=new Date;y.setDate(y.getDate()+1);const b=new Date;x.$.tokenExpirationDayLimit!==void 0&&x.$.tokenExpirationDayLimit>-1?b.setDate(b.getDate()+x.$.tokenExpirationDayLimit+1):b.setDate(864e13);const j=x.$.tokenExpirationDayLimit!==void 0&&x.$.tokenExpirationDayLimit>0,[K,w]=(0,i.useState)(""),[O,W]=(0,i.useState)(""),[R,te]=(0,i.useState)(j),[X,I]=(0,i.useState)(y),[ie,ne]=(0,i.useState)(X!==""),Z=(0,U.of)(u);(0,i.useEffect)(()=>{l&&w(`${s}-${(0,p.A)()}`)},[s,l]);const ae=G=>{ne(G!==""),I(G)},se=()=>{N({name:O||K,secondsToLive:R?J(X):void 0})},H=()=>{W(""),w(""),te(j),I(y),ne(X!==""),M()},le=a?"Service account token created":"Add service account token";return(0,e.jsx)(v.a,{isOpen:l,title:le,onDismiss:H,className:Z.modal,children:a?(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(r.D,{label:(0,n.t)("serviceaccounts.create-token-modal.label-token","Token"),description:(0,n.t)("serviceaccounts.create-token-modal.description-token","Copy the token now as you will not be able to see it again. Losing a token requires creating a new one."),children:(0,e.jsxs)("div",{className:Z.modalTokenRow,children:[(0,e.jsx)(L.p,{name:"tokenValue",value:a,readOnly:!0}),(0,e.jsx)(m.b,{className:Z.modalCopyToClipboardButton,variant:"primary",size:"md",icon:"copy",getText:()=>a,children:(0,e.jsx)(n.x6,{i18nKey:"serviceaccounts.create-token-modal.copy-clipboard",children:"Copy to clipboard"})})]})}),(0,e.jsxs)(v.a.ButtonRow,{children:[(0,e.jsx)(m.b,{variant:"primary",getText:()=>a,onClipboardCopy:H,children:(0,e.jsx)(n.x6,{i18nKey:"serviceaccounts.create-token-modal.copy-to-clipboard-and-close",children:"Copy to clipboard and close"})}),(0,e.jsx)(A.$n,{variant:"secondary",onClick:H,children:(0,e.jsx)(n.x6,{i18nKey:"serviceaccounts.create-token-modal.close",children:"Close"})})]})]}):(0,e.jsxs)("div",{children:[(0,e.jsx)(r.D,{label:(0,n.t)("serviceaccounts.create-token-modal.label-display-name","Display name"),description:(0,n.t)("serviceaccounts.create-token-modal.description-name-to-easily-identify-the-token","Name to easily identify the token"),required:!0,children:(0,e.jsx)(L.p,{name:"tokenName",value:O,placeholder:K,onChange:G=>{W(G.currentTarget.value)}})}),(0,e.jsx)(r.D,{label:(0,n.t)("serviceaccounts.create-token-modal.label-expiration","Expiration"),children:(0,e.jsx)(P.z,{options:z,value:R,onChange:te,size:"md"})}),R&&(0,e.jsx)(r.D,{label:(0,n.t)("serviceaccounts.create-token-modal.label-expiration-date","Expiration date"),children:(0,e.jsx)(o.l,{onChange:ae,value:X,placeholder:"",minDate:y,maxDate:b})}),(0,e.jsx)(v.a.ButtonRow,{children:(0,e.jsx)(A.$n,{onClick:se,disabled:R&&!ie,children:(0,e.jsx)(n.x6,{i18nKey:"serviceaccounts.create-token-modal.generate-token",children:"Generate token"})})})]})})},J=l=>{const a=new Date(l),s=new Date;return Math.ceil((a.getTime()-s.getTime())/1e3)},u=l=>({modal:(0,C.css)({width:"550px"}),modalTokenRow:(0,C.css)({display:"flex"}),modalCopyToClipboardButton:(0,C.css)({marginLeft:l.spacing(.5)})})},75955:(ee,B,t)=>{t.r(B),t.d(B,{ServiceAccountsListPageUnconnected:()=>se,default:()=>G});var e=t(74848),C=t(22803),i=t(96540),p=t(71468),n=t(92745),x=t(63142),m=t(89640),o=t(45861),v=t(41654),A=t(18027),r=t(12737),P=t(31286),L=t(77824),U=t(50201),z=t(71599),F=t(13791),J=t(65642),u=t(73427),l=t(11257),a=t(92654),s=t(70255),N=t(27594),M=t(34213),y=t(71555),b=t(30703),j=t(76319),K=t(91087),w=t(9390);const O=({services:c,onRoleChange:d,roleOptions:k,onRemoveButtonClick:f,onDisable:h,onEnable:g,onAddTokenClick:Y,showPaging:V,totalPages:ce,onChangePage:_,currentPage:oe,isLoading:$})=>{const q=(0,i.useMemo)(()=>[{id:"avatarUrl",header:"",cell:({cell:{value:E},row:{original:S}})=>W(E,S,$,"avatarUrl")},{id:"name",header:"Account",cell:({cell:{value:E},row:{original:S}})=>W(E,S,$),sortType:"string"},{id:"id",header:"ID",cell:({cell:{value:E},row:{original:S}})=>W(E,S,$,"id")},{id:"role",header:"Roles",cell:({cell:{value:E},row:{original:S}})=>R(E,S,$,k,d)},{id:"tokens",header:"Tokens",cell:({cell:{value:E},row:{original:S}})=>W(E,S,$,"tokens")},{id:"actions",header:"",cell:({row:{original:E}})=>te(E,$,Y,g,h,f)}],[$,Y,h,g,f,d,k]);return(0,e.jsxs)(v.B,{direction:"column",gap:2,children:[(0,e.jsx)(N.j,{columns:q,data:c,getRowId:E=>String(E.id)}),V&&ce>1&&(0,e.jsx)(v.B,{justifyContent:"flex-end",children:(0,e.jsx)(M.d,{numberOfPages:ce,currentPage:oe,onNavigate:_})})]})},W=(c,d,k,f)=>{if(k)return f==="avatarUrl"?(0,e.jsx)(s.A,{circle:!0,width:24,height:24}):(0,e.jsx)(s.A,{width:100});const h=`/org/serviceaccounts/${d.uid}`,g=`Edit service account's ${d.name} details`;switch(f){case"avatarUrl":return(0,e.jsx)("a",{"aria-label":g,href:h,children:(0,e.jsx)(y.e,{src:c,alt:"User avatar"})});case"id":return(0,e.jsx)(m.Y,{href:h,"aria-label":g,color:"secondary",inline:!1,children:d.login});case"tokens":return(0,e.jsxs)(v.B,{alignItems:"center",children:[(0,e.jsx)(b.I,{name:"key-skeleton-alt"}),(0,e.jsx)(m.Y,{href:h,"aria-label":g,color:"primary",inline:!1,children:c||"No tokens"})]});default:return(0,e.jsx)(m.Y,{href:h,"aria-label":g,color:"primary",inline:!1,children:c})}},R=(c,d,k,f,h)=>{const g=u.TP.hasPermission(l.w.ActionRolesList)&&u.TP.hasPermission(l.w.ActionUserRolesList),Y=u.TP.hasPermissionInMetadata(l.w.ServiceAccountsWrite,d);return k?(0,e.jsx)(s.A,{width:100}):u.TP.licensedAccessControlEnabled()?g&&(0,e.jsx)(K.y,{userId:d.id,orgId:d.orgId,basicRole:c,roles:d.roles||[],onBasicRoleChange:V=>h(V,d),roleOptions:f,basicRoleDisabled:!Y,disabled:d.isExternal||d.isDisabled,width:40}):(0,e.jsx)(w.r,{"aria-label":(0,n.t)("serviceaccounts.get-role-cell.aria-label-role","Role"),value:c,disabled:d.isExternal||!Y||d.isDisabled,onChange:V=>h(V,d)})},te=(c,d,k,f,h,g)=>d?(0,e.jsx)(s.A,{width:100}):c.isExternal?(0,e.jsx)(v.B,{alignItems:"center",justifyContent:"flex-end",children:(0,e.jsx)(j.K,{disabled:!0,name:"lock",size:"md",tooltip:(0,n.t)("serviceaccounts.get-actions-cell.tooltip-managed-service-account-cannot-modified","This is a managed service account and cannot be modified")})}):(0,e.jsxs)(v.B,{alignItems:"center",justifyContent:"flex-end",children:[u.TP.hasPermission(l.w.ServiceAccountsWrite)&&!c.tokens&&(0,e.jsx)(o.$n,{onClick:()=>k(c),disabled:c.isDisabled,children:(0,e.jsx)(n.x6,{i18nKey:"serviceaccounts.get-actions-cell.add-token",children:"Add token"})}),u.TP.hasPermissionInMetadata(l.w.ServiceAccountsWrite,c)&&(c.isDisabled?(0,e.jsx)(o.$n,{variant:"secondary",size:"md",onClick:()=>f(c),children:(0,e.jsx)(n.x6,{i18nKey:"serviceaccounts.get-actions-cell.enable",children:"Enable"})}):(0,e.jsx)(o.$n,{variant:"secondary",size:"md",onClick:()=>h(c),children:(0,e.jsx)(n.x6,{i18nKey:"serviceaccounts.get-actions-cell.disable",children:"Disable"})})),u.TP.hasPermissionInMetadata(l.w.ServiceAccountsDelete,c)&&(0,e.jsx)(j.K,{name:"trash-alt","aria-label":(0,n.t)("serviceaccounts.get-actions-cell.aria-label-delete-button","Delete service account {{serviceAccountName}}",{serviceAccountName:c.name}),variant:"secondary",onClick:()=>g(c)})]});O.displayName="ServiceAccountTable";var X=t(18079),I=t(76031);function ie(c){return{...c.serviceAccounts}}const ne={changePage:I.yd,changeQuery:I.nM,fetchACOptions:I.pJ,fetchServiceAccounts:I.iJ,deleteServiceAccount:I.W4,updateServiceAccount:I.mV,changeStateFilter:I.qS,createServiceAccountToken:I.yC},Z=(0,p.connect)(ie,ne),ae=[{label:"All",value:a.i.All},{label:"With expired tokens",value:a.i.WithExpiredTokens},{label:"Disabled",value:a.i.Disabled}];J.Ay.featureToggles.externalServiceAccounts&&ae.push({label:"Managed",value:a.i.External});const se=({page:c,changePage:d,totalPages:k,serviceAccounts:f,isLoading:h,roleOptions:g,query:Y,serviceAccountStateFilter:V,changeQuery:ce,fetchACOptions:_,fetchServiceAccounts:oe,deleteServiceAccount:$,updateServiceAccount:q,changeStateFilter:E,createServiceAccountToken:S})=>{const[Ee,de]=(0,i.useState)(!1),[De,ue]=(0,i.useState)(!1),[Pe,ve]=(0,i.useState)(!1),[fe,he]=(0,i.useState)(""),[T,Q]=(0,i.useState)(null),Ae=(0,x.of)(H);(0,i.useEffect)(()=>{oe({withLoadingIndicator:!0}),u.TP.licensedAccessControlEnabled()&&_()},[_,oe]);const re=f.length===0&&V===a.i.All&&!Y,ye=async(D,Le)=>{const Ue={...Le,role:D};q(Ue),u.TP.licensedAccessControlEnabled()&&_()},ge=D=>{ce(D)},Te=D=>{E(D)},Ce=D=>{Q(D),ue(!0)},pe=async()=>{T&&$(T.uid),me()},Me=D=>{Q(D),ve(!0)},je=()=>{T&&q({...T,isDisabled:!0}),xe()},Oe=D=>{q({...D,isDisabled:!1})},Re=D=>{Q(D),de(!0)},Ie=async D=>{T&&S(T.uid,D,he)},Se=()=>{de(!1),Q(null),he("")},me=()=>{ue(!1),Q(null)},xe=()=>{ve(!1),Q(null)},Be=(0,e.jsx)("span",{children:(0,e.jsxs)(n.x6,{i18nKey:"serviceaccounts.service-accounts-list-page-unconnected.sub-title",children:["Service accounts and their tokens can be used to authenticate against the Grafana API. Find out more in our"," ",(0,e.jsx)(m.Y,{href:"https://grafana.com/docs/grafana/latest/administration/service-accounts/",external:!0,children:"documentation."})]})});return(0,e.jsx)(F.Y,{navId:"serviceaccounts",subTitle:Be,actions:(0,e.jsx)(e.Fragment,{children:!re&&u.TP.hasPermission(l.w.ServiceAccountsCreate)&&(0,e.jsx)(o.z9,{href:"org/serviceaccounts/create",variant:"primary",children:(0,e.jsx)(n.x6,{i18nKey:"serviceaccounts.service-accounts-list-page-unconnected.add-service-account",children:"Add service account"})})}),children:(0,e.jsxs)(F.Y.Contents,{children:[(0,e.jsxs)(v.B,{justifyContent:"space-between",wrap:"wrap",children:[(0,e.jsx)(A.I,{grow:!0,children:(0,e.jsx)(r.Z,{className:Ae.filterInput,placeholder:(0,n.t)("serviceaccounts.service-accounts-list-page-unconnected.placeholder-search-service-account-by-name","Search service account by name"),value:Y,onChange:ge})}),(0,e.jsx)(P.a,{marginBottom:1,children:(0,e.jsx)(L.z,{options:ae,onChange:Te,value:V})})]}),!h&&!re&&f.length===0&&(0,e.jsx)(U.p,{variant:"not-found",message:(0,n.t)("service-accounts.empty-state.message","No service accounts found")}),!h&&re&&(0,e.jsx)(U.p,{variant:"call-to-action",button:(0,e.jsx)(o.z9,{disabled:!u.TP.hasPermission(l.w.ServiceAccountsCreate),href:"org/serviceaccounts/create",icon:"key-skeleton-alt",size:"lg",children:(0,e.jsx)(n.x6,{i18nKey:"service-accounts.empty-state.button-title",children:"Add service account"})}),message:(0,n.t)("service-accounts.empty-state.title","You haven't created any service accounts yet"),children:(0,e.jsx)(n.x6,{i18nKey:"service-accounts.empty-state.more-info",children:"Remember, you can provide specific permissions for API access to other applications"})}),(h||f.length!==0)&&(0,e.jsx)(O,{services:f,showPaging:!0,totalPages:k,onChangePage:d,currentPage:c,onRoleChange:ye,roleOptions:g,onRemoveButtonClick:Ce,onDisable:Me,onEnable:Oe,onAddTokenClick:Re,isLoading:h}),T&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(z.u,{isOpen:De,body:T.tokens?(0,n.t)("serviceaccounts.service-accounts-list-page-unconnected.body-delete","Are you sure you want to delete {{serviceAccountName}} and {{count}} accompanying tokens?",{serviceAccountName:T.name,count:T.tokens}):(0,n.t)("serviceaccounts.service-accounts-list-page-unconnected.body-delete-with-tokens","Are you sure you want to delete {{serviceAccountName}}?",{serviceAccountName:T.name}),confirmText:(0,n.t)("serviceaccounts.service-accounts-list-page-unconnected.confirmText-delete","Delete"),title:(0,n.t)("serviceaccounts.service-accounts-list-page-unconnected.title-delete-service-account","Delete service account"),onConfirm:pe,onDismiss:me}),(0,e.jsx)(z.u,{isOpen:Pe,title:(0,n.t)("serviceaccounts.service-accounts-list-page-unconnected.title-disable-service-account","Disable service account"),body:(0,n.t)("serviceaccounts.service-accounts-list-page-unconnected.body-disable-service-account","Are you sure you want to disable '{{accountToDisable}}'?",{accountToDisable:T.name}),confirmText:(0,n.t)("serviceaccounts.service-accounts-list-page-unconnected.confirmText-disable-service-account","Disable service account"),onConfirm:je,onDismiss:xe}),(0,e.jsx)(X.z,{isOpen:Ee,token:fe,serviceAccountLogin:T.login,onCreateToken:Ie,onClose:Se})]})]})})},H=c=>({filterInput:(0,C.css)({maxWidth:c.spacing(50)})}),G=Z(se)},76031:(ee,B,t)=>{t.d(B,{W4:()=>U,iJ:()=>r,mV:()=>L,nM:()=>J,pJ:()=>A,qS:()=>u,yC:()=>z,yd:()=>l});var e=t(2543),C=t.n(e),i=t(68143),p=t(34418),n=t(15130),x=t(11257),m=t(92654),o=t(13640);const v="/api/serviceaccounts";function A(){return async a=>{try{if(n.TP.licensedAccessControlEnabled()&&n.TP.hasPermission(x.w.ActionRolesList)){const s=await(0,p.RL)();a((0,o.ew)(s))}}catch(s){console.error(s)}}}function r({withLoadingIndicator:a}={withLoadingIndicator:!1}){return async(s,N)=>{try{if(n.TP.hasPermission(x.w.ServiceAccountsRead)){a&&s((0,o.FW)());const{perPage:M,page:y,query:b,serviceAccountStateFilter:j}=N().serviceAccounts,K=await(0,i.AI)().get(`/api/serviceaccounts/search?perpage=${M}&page=${y}&query=${b}${F(j)}&accesscontrol=true`);if(n.TP.licensedAccessControlEnabled()&&n.TP.hasPermission(x.w.ActionUserRolesList)){s((0,o.dJ)());const w=n.TP.user.orgId,O=K?.serviceAccounts.map(R=>R.id),W=await(0,i.AI)().post("/api/access-control/users/roles/search",{userIds:O,orgId:w});K.serviceAccounts.forEach(R=>{R.roles=W?W[R.id]||[]:[]}),s((0,o.jE)())}s((0,o.zh)(K))}}catch(M){console.error(M)}finally{s((0,o.Yh)())}}}const P=(0,e.debounce)(a=>a(r()),500,{leading:!0});function L(a){return async s=>{await(0,i.AI)().patch(`${v}/${a.uid}?accesscontrol=true`,{...a}),s(r())}}function U(a){return async s=>{await(0,i.AI)().delete(`${v}/${a}`),s(r())}}function z(a,s,N){return async M=>{const y=await(0,i.AI)().post(`${v}/${a}/tokens`,s);N(y.key),M(r())}}const F=a=>{switch(a){case m.i.WithExpiredTokens:return"&expiredTokens=true";case m.i.Disabled:return"&disabled=true";case m.i.External:return"&external=true";default:return""}};function J(a){return async s=>{s((0,o.L5)(a)),P(s)}}function u(a){return async s=>{s((0,o.c3)(a)),s(r())}}function l(a){return async s=>{s((0,o.EC)(a)),s(r())}}},91087:(ee,B,t)=>{t.d(B,{y:()=>o});var e=t(74848),C=t(96540),i=t(41053),p=t(73427),n=t(11257),x=t(59812),m=t(34418);const o=({basicRole:v,roles:A,userId:r,orgId:P,onBasicRoleChange:L,roleOptions:U,disabled:z,basicRoleDisabled:F,basicRoleDisabledMessage:J,apply:u=!1,onApplyRoles:l,pendingRoles:a,maxWidth:s,width:N,isLoading:M})=>{const[{loading:y,value:b=A||[]},j]=(0,i.A)(async()=>{try{if(A)return A;if(u&&a?.length)return a;if(p.TP.hasPermission(n.w.ActionUserRolesList)&&r>0)return await(0,m.Xh)(r,P)}catch{console.error("Error loading options")}return[]},[P,r,a,A]);(0,C.useEffect)(()=>{P&&j()},[j,P]);const K=async O=>{u?l&&l(O,r,P):(await(0,m.eA)(O,r,P),await j())},w=p.TP.hasPermission(n.w.ActionUserRolesAdd)&&p.TP.hasPermission(n.w.ActionUserRolesRemove);return(0,e.jsx)(x.n,{appliedRoles:b,basicRole:v,onRolesChange:K,onBasicRoleChange:L,roleOptions:U,isLoading:y||M,disabled:z,basicRoleDisabled:F,basicRoleDisabledMessage:J,showBasicRole:!0,apply:u,canUpdateRoles:w,maxWidth:s,width:N})}}}]);

//# sourceMappingURL=ServiceAccountsPage.c6be90bd6b9552db7b2a.js.map