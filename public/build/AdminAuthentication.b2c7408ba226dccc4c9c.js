"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[5592],{22011:(W,C,n)=>{n.d(C,{L:()=>l,o:()=>e});const e="admin/authentication/",l={github:["github","GitHub"],gitlab:["gitlab","GitLab"],google:["google","Google"],generic_oauth:["lock","Generic OAuth"],grafana_com:["grafana","Grafana.com"],azuread:["microsoft","Azure AD"],okta:["okta","Okta"],scim:["scim","SCIM"]}},22942:(W,C,n)=>{n.d(C,{q:()=>t});var e=n(74848),l=n(92745),x=n(39118);function t(){return(0,e.jsx)(x.I,{text:(0,l.t)("cloud-enterprise-feature-badge","Cloud & Enterprise")})}},35991:(W,C,n)=>{n.d(C,{DZ:()=>V,M5:()=>m,TD:()=>G});var e=n(75505),l=n(68143),x=n(73427),t=n(11257),o=n(69874),A=n(21875);function m(b=!0){return async d=>{if(x.TP.hasPermission(t.w.SettingsRead)){b&&d((0,A.sr)()),d(G());const y=await(0,l.AI)().get("/api/admin/settings");return d((0,A.jA)(y)),await d(ne()),b&&d((0,A.MH)()),y}}}function G(b=""){return async d=>{const y=await(0,l.AI)().get(`/api/v1/sso-settings${b?`/${b}`:""}`);return d((0,A.Oy)(b?[y]:y)),y}}function ne(){return async b=>{const d=(0,o.getRegisteredAuthProviders)(),y={},w=[];for(const U of d)w.push((0,o.getAuthProviderStatus)(U.id));const T=await Promise.all(w);for(let U=0;U<d.length;U++){const Z=d[U];y[Z.id]=T[U]}b((0,A.TO)(y))}}function V(b){return async d=>{if(x.TP.hasPermission(t.w.SettingsWrite))try{return await(0,e.s)((0,l.AI)().fetch({url:"/api/admin/settings",method:"PUT",data:b,showSuccessAlert:!1,showErrorAlert:!1})),d((0,A.SH)()),!0}catch(y){if(console.log(y),(0,l.NF)(y)){y.isHandled=!0;const w={message:y.data?.message,errors:y.data?.errors};return d((0,A.Nh)(w)),!1}}return!1}}},39118:(W,C,n)=>{n.d(C,{I:()=>o});var e=n(74848),l=n(22803),x=n(30703),t=n(63142);function o({text:m}){const G=(0,t.of)(A);return(0,e.jsxs)("div",{className:G.wrapper,children:[(0,e.jsx)(x.I,{name:"cloud",size:"sm"}),m]})}const A=m=>({wrapper:(0,l.css)({display:"inline-flex",padding:m.spacing(.5,1),borderRadius:m.shape.radius.pill,background:m.colors.gradients.brandHorizontal,color:m.colors.primary.contrastText,fontWeight:m.typography.fontWeightMedium,gap:m.spacing(.5),fontSize:m.typography.bodySmall.fontSize,lineHeight:m.typography.bodySmall.lineHeight,alignItems:"center"})})},41391:(W,C,n)=>{n.d(C,{A:()=>x});const e=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-8][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000|ffffffff-ffff-ffff-ffff-ffffffffffff)$/i;function l(t){return typeof t=="string"&&e.test(t)}const x=l},53953:(W,C,n)=>{n.r(C),n.d(C,{AuthConfigPageUnconnected:()=>he,default:()=>ve});var e=n(74848),l=n(96540),x=n(71468),t=n(41607),o=n(92745),A=n(27489),m=n(89640),G=n(7895),ne=n(13943),V=n(13791),b=n(65642),d=n(22803),y=n(63142),w=n(8207),T=n(66404),U=n(21285),Z=n(45861),R=n(64762),J=n(35991);const pe=g=>({allowInsecureEmail:g.authConfig.settings?.auth?.oauth_allow_insecure_email_lookup.toLowerCase()==="true"}),me={loadSettings:J.M5,saveSettings:J.DZ},X=(0,x.connect)(pe,me)(({allowInsecureEmail:g,loadSettings:M,onClose:z,saveSettings:E})=>{const F=(0,R._2)(),q=async()=>{try{await E({updates:{auth:{oauth_allow_insecure_email_lookup:""+!g}}}),await M(!1),F.success("Settings saved")}catch{F.error("Failed to save settings")}},oe=async()=>{try{await E({removals:{auth:["oauth_allow_insecure_email_lookup"]}}),await M(!1),F.success("Settings saved")}catch{F.error("Failed to save settings")}},N=(0,e.jsxs)(o.x6,{i18nKey:"auth-config.auth-drawer-unconneced.subtitle",children:["Configure auth settings. Find out more in our"," ",(0,e.jsx)(m.Y,{external:!0,href:"https://grafana.com/docs/grafana/next/setup-grafana/configure-security/configure-authentication/#settings",children:"documentation"}),"."]}),se=(0,y.of)(ye);return(0,e.jsxs)(w._,{title:(0,o.t)("auth-config.auth-drawer-unconnected.title-auth-settings","Auth settings"),subtitle:N,size:"md",onClose:z,children:[(0,e.jsxs)("div",{className:se.advancedAuth,children:[(0,e.jsx)(T.E,{variant:"h4",children:(0,e.jsx)(o.x6,{i18nKey:"auth-config.auth-drawer-unconnected.advanced-auth",children:"Advanced Auth"})}),(0,e.jsx)(T.E,{variant:"h5",children:(0,e.jsx)(o.x6,{i18nKey:"auth-config.auth-drawer-unconnected.enable-insecure-email-lookup",children:"Enable insecure email lookup"})}),(0,e.jsx)(T.E,{variant:"body",color:"secondary",children:(0,e.jsx)(o.x6,{i18nKey:"auth-config.auth-drawer-unconnected.enable-insecure-email-lookup-description",children:"Allow users to use the same email address to log into Grafana with different identity providers."})}),(0,e.jsx)(U.d,{value:g,onChange:q})]}),(0,e.jsx)(Z.$n,{size:"md",variant:"secondary",className:se.button,onClick:oe,tooltip:(0,o.t)("auth-config.auth-drawer-unconnected.reset-tooltip","This action will disregard any saved changes and load the configuration from the configuration file."),children:(0,e.jsx)(o.x6,{i18nKey:"auth-config.auth-drawer-unconnected.reset",children:"Reset"})})]})}),ye=g=>({advancedAuth:(0,d.css)({display:"flex",flexDirection:"column",gap:g.spacing(1)}),button:(0,d.css)({marginTop:g.spacing(2)})});var ie=n(41654),B=n(30703);const Te=()=>{const g=(0,y.of)(Ae);return(0,e.jsxs)("div",{className:g.container,children:[(0,e.jsxs)(ie.B,{gap:1,alignItems:"center",children:[(0,e.jsx)(B.I,{name:"cog"}),(0,e.jsx)(T.E,{children:(0,e.jsx)(o.x6,{i18nKey:"auth-config.configure-auth-cta.configuration-required",children:"Configuration required"})})]}),(0,e.jsx)(T.E,{variant:"bodySmall",color:"secondary",children:(0,e.jsx)(o.x6,{i18nKey:"auth-config.configure-auth-cta.authentication-configuration-created-moment",children:"You have no authentication configuration created at the moment."})}),(0,e.jsx)(m.Y,{href:"https://grafana.com/docs/grafana/latest/auth/overview/",external:!0,children:(0,e.jsx)(o.x6,{i18nKey:"auth-config.configure-auth-cta.refer-documentation-configure-authentication",children:"Refer to the documentation on how to configure authentication"})})]})},Ae=g=>({container:(0,d.css)({display:"flex",flexDirection:"column",gap:g.spacing(2),backgroundColor:g.colors.background.secondary,borderRadius:g.shape.radius.default,padding:g.spacing(3),width:"max-content",margin:g.spacing(3,"auto")})}),Ee=Te;var Oe=n(30360),j=n(8073),Ie=n(99887),fe=n(22942),Pe=n(22011),be=n(74997);function Ce({providerId:g,enabled:M,configPath:z,authType:E,onClick:F}){const q=(0,be.hD)({configPath:z,id:g}),[oe,N]=Pe.L[g]||["lock",g.toUpperCase()];return(0,e.jsxs)(j.Z,{href:q,onClick:F,noMargin:!0,children:[(0,e.jsx)(j.Z.Heading,{children:N}),(0,e.jsx)(j.Z.Meta,{children:E}),(0,Oe.n6)(oe)&&(0,e.jsx)(j.Z.Figure,{children:(0,e.jsx)(B.I,{name:oe,size:"xxxl"})}),(0,e.jsx)(j.Z.Actions,{children:(0,e.jsx)(Ie.E,{text:M?(0,o.t)("auth-config.provider-card.text-badge-enabled","Enabled"):(0,o.t)("auth-config.provider-card.text-badge-not-enabled","Not enabled"),color:M?"green":"blue"})})]})}function Q(){return(0,e.jsxs)(j.Z,{noMargin:!0,children:[(0,e.jsx)(j.Z.Heading,{children:"SAML"}),(0,e.jsx)(j.Z.Meta,{children:(0,e.jsx)(m.Y,{external:!0,variant:"bodySmall",color:"secondary",href:"https://grafana.com/auth/sign-up/create-user?cloud-auth=&redirectPath=cloud-auth&utm_source=oss-grafana&cnt=admin-authorization-saml",children:(0,o.t)("auth-config.provider-card.saml-learn-more","Single sign-on (SSO) with SAML.")})}),(0,e.jsx)(j.Z.Figure,{children:(0,e.jsx)(B.I,{name:"lock",size:"xxxl"})}),(0,e.jsx)(j.Z.Actions,{children:(0,e.jsx)(fe.q,{})})]})}function we(){return(0,e.jsxs)(j.Z,{noMargin:!0,children:[(0,e.jsx)(j.Z.Heading,{children:"SCIM"}),(0,e.jsx)(j.Z.Meta,{children:(0,e.jsx)("div",{children:(0,e.jsx)(m.Y,{external:!0,variant:"bodySmall",color:"secondary",href:"https://grafana.com/auth/sign-up/create-user?cloud-auth=&redirectPath=cloud-auth&utm_source=oss-grafana&cnt=admin-authorization-scim",children:(0,o.t)("auth-config.provider-card.scim-learn-more"," Sync users and teams with SCIM.")})})}),(0,e.jsx)(j.Z.Figure,{children:(0,e.jsx)(B.I,{name:"sync",size:"xxxl"})}),(0,e.jsx)(j.Z.Actions,{children:(0,e.jsx)(fe.q,{})})]})}var Ue=n(69874);function ae(g){const{isLoading:M,providerStatuses:z,providers:E}=g.authConfig;return{isLoading:M,providerStatuses:z,providers:E}}const Re={loadSettings:J.M5},Se=(0,x.connect)(ae,Re),he=({providerStatuses:g,isLoading:M,loadSettings:z,providers:E})=>{(0,l.useEffect)(()=>{z()},[z]);const[F,q]=(0,l.useState)(!1),N=(0,Ue.getRegisteredAuthProviders)().filter(v=>!g[v.id]?.hide),se=(v,_)=>{(0,A.rR)("authentication_ui_provider_clicked",{provider:v,enabled:_})};E=E.filter(v=>v.provider!=="saml"),E=E.map(v=>v.provider==="ldap"?{...v,settings:{...v.settings,type:"LDAP"}}:v);const ge=N.length?[...N.map(v=>({provider:v.id,settings:{...g[v.id],configPath:v.configPath,type:v.type}})),...E]:E;return(0,e.jsx)(V.Y,{navId:"authentication",subTitle:(0,e.jsxs)(o.x6,{i18nKey:"auth-config-auth-config-page-unconnected.subtitle",children:["Manage your auth settings and configure single sign-on. Find out more in our"," ",(0,e.jsx)(m.Y,{external:!0,href:"https://grafana.com/docs/grafana/next/setup-grafana/configure-security/configure-authentication",children:"documentation"}),"."]}),actions:b.$W.buildInfo.edition!==t.r.OpenSource&&(0,e.jsx)(G.I,{icon:"cog",variant:"canvas",onClick:()=>q(!0),children:(0,e.jsx)(o.x6,{i18nKey:"auth-config.auth-config-page-unconnected.auth-settings",children:"Auth settings"})}),children:(0,e.jsx)(V.Y.Contents,{isLoading:M,children:ge.length?(0,e.jsxs)(ne.x,{gap:3,minColumnWidth:34,children:[ge.filter(({provider:v})=>!["grafana_com"].includes(v)).map(({provider:v,settings:_})=>(0,e.jsx)(Ce,{authType:_.type||"OAuth",providerId:v,enabled:_.enabled,onClick:()=>se(v,_.enabled),configPath:_.configPath},v)),b.$W.buildInfo.edition===t.r.OpenSource&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(Q,{}),(0,e.jsx)(we,{})]}),F&&(0,e.jsx)(X,{onClose:()=>q(!1)})]}):(0,e.jsx)(Ee,{})})})},ve=Se(he)},74997:(W,C,n)=>{n.d(C,{Ks:()=>x,Ll:()=>t,hD:()=>l});var e=n(22011);function l(o){return e.o+(o.configPath||o.id)}const x=o=>{if(typeof o!="string")return!1;try{return new URL(o).protocol.includes("http")}catch{return!1}},t=o=>typeof o!="string"||!o.length?!1:/^[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*\.[a-zA-Z]{2,6}$/.test(o)},81172:(W,C,n)=>{n.r(C),n.d(C,{ProviderConfigPage:()=>Be,default:()=>Xe});var e=n(74848),l=n(96540),x=n(54148),t=n(92745),o=n(41654),A=n(66404),m=n(99887),G=n(13791),ne=n(86678),V=n(52763),b=n(49785),d=n(32899),y=n(75234),w=n(68143),T=n(27489),U=n(36490),Z=n(87063),R=n(37386),J=n(21285),pe=n(74475),me=n(31286),$=n(45861),H=n(88559),X=n(76319),ye=n(71599),ie=n(83813),B=n(22803),Te=n(63142),Ae=n(63527),Ee=n(48767),Oe=n(18857),j=n(32635),Ie=n(41391),fe=n(43173),Pe=n(89640),be=n(73427),Ce=n(22787),Q=n(74997);const we=({isOpen:i,onClose:a,onSuccess:c,isLoading:r})=>{const{handleSubmit:u,register:I,formState:{errors:f}}=(0,b.mN)({mode:"onBlur",defaultValues:{url:""}}),P=L=>L===""?"Please enter the .well-known/openid-configuration endpoint for your IdP":(0,Q.Ks)(L)?!0:"Please enter a valid URL";return(0,e.jsx)(Ce.a,{title:(0,t.t)("auth-config.server-discovery-modal.title-open-id-connect-discovery-url","OpenID Connect Discovery URL"),onDismiss:a,onClickBackdrop:a,isOpen:i,children:(0,e.jsxs)("form",{onSubmit:L=>(L.stopPropagation(),u(c)(L)),children:[(0,e.jsx)(R.D,{label:(0,t.t)("auth-config.server-discovery-modal.label-the-wellknownopenidconfiguration-endpoint-for-your-id-p","The .well-known/openid-configuration endpoint for your IdP"),invalid:!!f.url,error:f.url?.message,htmlFor:"url",children:(0,e.jsx)(Ae.p,{...I("url",{validate:P}),width:80,id:"url"})}),(0,e.jsxs)(Ce.a.ButtonRow,{children:[(0,e.jsx)($.$n,{type:"submit",variant:"primary",disabled:r,children:r?(0,e.jsx)(t.x6,{i18nKey:"oauth.form.server-discovery-modal-loading",children:"Loading..."}):(0,e.jsx)(t.x6,{i18nKey:"oauth.form.server-discovery-modal-submit",children:"Submit"})}),(0,e.jsx)($.$n,{type:"button",variant:"secondary",onClick:a,children:(0,e.jsx)(t.x6,{i18nKey:"oauth.form.server-discovery-modal-close",children:"Close"})})]})]})})},Ue=({setValue:i})=>{const a=(0,y.J7)(),[c,r]=(0,l.useState)(!1),[u,I]=(0,l.useState)(!1),f=()=>r(!1),P=async L=>{I(!0);try{const s="/.well-known/openid-configuration",D=new URL(L.url);D.pathname.includes(s)||(L.url=D.origin+s);const S=await(0,w.AI)().get(L.url);if(!S.token_endpoint||!S.authorization_endpoint){a.publish({type:d.r1.alertWarning.name,payload:["The URL provided is not a valid .well-known/openid-configuration endpoint"]});return}i("tokenUrl",S.token_endpoint),i("authUrl",S.authorization_endpoint),S.userinfo_endpoint&&i("apiUrl",S.userinfo_endpoint),a.publish({type:d.r1.alertSuccess.name,payload:["OpenID Connect Discovery URL has been successfully fetched."]})}catch{a.publish({type:d.r1.alertWarning.name,payload:["Failed to fetch URL or invalid content"]})}finally{f(),I(!1)}};return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)($.$n,{type:"button",variant:"secondary",onClick:()=>{r(!0)},children:(0,e.jsx)(t.x6,{i18nKey:"oauth.form.server-discovery-action-button",children:"Enter OpenID Connect Discovery URL"})}),(0,e.jsx)(we,{isOpen:c,onClose:f,onSuccess:P,isLoading:u})]})};function ae(i){return Array.isArray(i)&&i.every(a=>typeof a=="object"&&a!==null&&"value"in a)}function Re(i){return typeof i=="object"&&i!==null&&"value"in i}const Se=()=>{const i=(0,t.t)("auth-config.fields.section-general-settings","General settings"),a=(0,t.t)("auth-config.fields.section-user-mapping","User mapping"),c=(0,t.t)("auth-config.fields.section-extra-security","Extra security measures");return{azuread:[{name:i,id:"general",fields:["name","clientAuthentication","clientId","clientSecret","managedIdentityClientId","federatedCredentialAudience","scopes","authUrl","tokenUrl","allowSignUp","autoLogin","signoutRedirectUrl","loginPrompt"]},{name:a,id:"user",fields:["roleAttributeStrict","orgMapping","allowAssignGrafanaAdmin","skipOrgRoleSync"]},{name:c,id:"extra",fields:["allowedOrganizations","allowedDomains","allowedGroups","forceUseGraphApi","domainHint","usePkce","useRefreshToken","tlsSkipVerifyInsecure","tlsClientCert","tlsClientKey","tlsClientCa","workloadIdentityTokenFile"]}],generic_oauth:[{name:i,id:"general",fields:["name","clientId","clientSecret","authStyle","scopes","serverDiscoveryUrl","authUrl","tokenUrl","apiUrl","allowSignUp","autoLogin","signoutRedirectUrl","loginPrompt"]},{name:a,id:"user",fields:["nameAttributePath","loginAttributePath","emailAttributeName","emailAttributePath","idTokenAttributeName","roleAttributePath","roleAttributeStrict","orgMapping","orgAttributePath","allowAssignGrafanaAdmin","skipOrgRoleSync"]},{name:c,id:"extra",fields:["allowedOrganizations","allowedDomains","defineAllowedGroups",{name:"allowedGroups",dependsOn:"defineAllowedGroups"},{name:"groupsAttributePath",dependsOn:"defineAllowedGroups"},"defineAllowedTeamsIds",{name:"teamIds",dependsOn:"defineAllowedTeamsIds"},{name:"teamsUrl",dependsOn:"defineAllowedTeamsIds"},{name:"teamIdsAttributePath",dependsOn:"defineAllowedTeamsIds"},"usePkce","useRefreshToken","tlsSkipVerifyInsecure","tlsClientCert","tlsClientKey","tlsClientCa"]}],google:[{name:i,id:"general",fields:["name","clientId","clientSecret","scopes","allowSignUp","autoLogin","signoutRedirectUrl","loginPrompt"]},{name:a,id:"user",fields:["roleAttributePath","roleAttributeStrict","orgMapping","allowAssignGrafanaAdmin","skipOrgRoleSync"]},{name:c,id:"extra",fields:["validateHd","hostedDomain","allowedDomains","allowedGroups","usePkce","useRefreshToken","tlsSkipVerifyInsecure","tlsClientCert","tlsClientKey","tlsClientCa"]}],github:[{name:i,id:"general",fields:["name","clientId","clientSecret","scopes","allowSignUp","autoLogin","signoutRedirectUrl","loginPrompt"]},{name:a,id:"user",fields:["roleAttributePath","roleAttributeStrict","orgMapping","allowAssignGrafanaAdmin","skipOrgRoleSync"]},{name:c,id:"extra",fields:["allowedOrganizations","allowedDomains","teamIds","usePkce","useRefreshToken","tlsSkipVerifyInsecure","tlsClientCert","tlsClientKey","tlsClientCa"]}],gitlab:[{name:i,id:"general",fields:["name","clientId","clientSecret","scopes","allowSignUp","autoLogin","signoutRedirectUrl","loginPrompt"]},{name:a,id:"user",fields:["roleAttributePath","roleAttributeStrict","orgMapping","allowAssignGrafanaAdmin","skipOrgRoleSync"]},{name:c,id:"extra",fields:["allowedDomains","allowedGroups","usePkce","useRefreshToken","tlsSkipVerifyInsecure","tlsClientCert","tlsClientKey","tlsClientCa"]}],okta:[{name:i,id:"general",fields:["name","clientId","clientSecret","scopes","authUrl","tokenUrl","apiUrl","allowSignUp","autoLogin","signoutRedirectUrl"]},{name:a,id:"user",fields:["roleAttributePath","roleAttributeStrict","orgMapping","orgAttributePath","allowAssignGrafanaAdmin","skipOrgRoleSync"]},{name:c,id:"extra",fields:["allowedDomains","allowedGroups","usePkce","useRefreshToken","tlsSkipVerifyInsecure","tlsClientCert","tlsClientKey","tlsClientCa"]}]}},he="Client ID",ve="Client secret",g="Scopes",M="OpenID Connect Discovery URL",z="Auth URL",E="Token URL",F="API URL",q="JMESPath",oe="Workload identity";function N(i){const a=(0,t.t)("auth-config.fields.organization-mapping-label","Organization mapping"),c=(0,t.t)("auth-config.fields.organization-attribute-path-label","Organization attribute path"),r=(0,t.t)("auth-config.fields.teams-url-label","Teams URL"),u=(0,t.t)("auth-config.fields.team-ids-attribute-path-label","Team IDs attribute path"),I=(0,t.t)("auth-config.fields.allowed-groups-label","Allowed groups"),f=(0,t.t)("auth-config.fields.groups-attribute-path-label","Groups attribute path"),P=(0,t.t)("auth-config.fields.team-ids-label","Team IDs"),L=(0,t.t)("auth-config.fields.allowed-domains-label","Allowed domains");return{clientAuthentication:{label:(0,t.t)("auth-config.fields.client-authentication-label","Client authentication"),type:"select",description:(0,t.t)("auth-config.fields.client-authentication-description","The client authentication method used to authenticate to the token endpoint."),multi:!1,options:v(i),defaultValue:{value:"none",label:(0,t.t)("auth-config.field-map.label.none","None")},validation:{required:!0,message:(0,t.t)("auth-config.fields.required","This field is required")}},clientId:{label:he,type:"text",description:(0,t.t)("auth-config.fields.client-id-description","The {{ clientIDLabel }} of your OAuth2 app.",{clientIDLabel:he}),validation:{required:!0,message:(0,t.t)("auth-config.fields.required","This field is required")}},clientSecret:{label:ve,type:"secret",description:(0,t.t)("auth-config.fields.client-secret-description","The {{ clientSecretLabel }} of your OAuth2 app.",{clientSecretLabel:ve})},managedIdentityClientId:{label:(0,t.t)("auth-config.fields.managed-identity-client-id-label","FIC managed identity client ID"),type:"text",description:(0,t.t)("auth-config.fields.managed-identity-client-id-description","The managed identity client ID of the federated identity credential of your OAuth2 app.")},federatedCredentialAudience:{label:(0,t.t)("auth-config.fields.federated-credential-audience-label","FIC audience"),type:"text",description:(0,t.t)("auth-config.fields.federated-credential-audience-description","The audience of the federated identity credential of your OAuth2 app.")},workloadIdentityTokenFile:{label:(0,t.t)("auth-config.fields.workload-identity-token-file-label","{{ workloadIdentityLabel }} token file",{workloadIdentityLabel:oe}),type:"text",description:(0,t.t)("auth-config.fields.workload-identity-token-file-description",'The file path to the token file used to authenticate to the OAuth2 provider. This is only required when client authentication is set to "workload_identity". Defaults to /var/run/secrets/azure/tokens/azure-identity-token.'),validation:{validate:(s,D)=>{let S=D.clientAuthentication;return Re(S)&&(S=S.value),S==="workload_identity"?!!s:!0},message:(0,t.t)("auth-config.fields.workload-identity-token-file-required",'This field must be set when client authentication is set to "Workload identity".')}},allowedOrganizations:{label:(0,t.t)("auth-config.fields.allowed-organizations-label","Allowed organizations"),type:"select",description:(0,t.t)("auth-config.fields.allowed-organizations-description",`List of comma- or space-separated organizations. The user should be a member 
of at least one organization to log in.`),multi:!0,allowCustomValue:!0,options:[],placeholder:(0,t.t)("auth-config.fields.allowed-organizations-placeholder","Enter organizations (my-team, myteam...) and press Enter to add")},allowedDomains:{label:L,type:"select",description:(0,t.t)("auth-config.fields.allowed-domains-description",`List of comma- or space-separated domains. The user should belong to at least 
one domain to log in.`),multi:!0,allowCustomValue:!0,options:[]},authUrl:{label:z,type:"text",description:(0,t.t)("auth-config.fields.auth-url-description","The authorization endpoint of your OAuth2 provider."),validation:{required:!0,validate:s=>(0,Q.Ks)(s),message:(0,t.t)("auth-config.fields.auth-url-required","This field is required and must be a valid URL.")}},authStyle:{label:(0,t.t)("auth-config.fields.auth-style-label","Auth style"),type:"select",description:(0,t.t)("auth-config.fields.auth-style-description",'It determines how "{{ clientIDLabel }}" and "{{ clientSecretLabel }}" are sent to Oauth2 provider. Default is AutoDetect.',{clientIDLabel:he,clientSecretLabel:ve}),multi:!1,options:[{value:"AutoDetect",label:"AutoDetect"},{value:"InParams",label:"InParams"},{value:"InHeader",label:"InHeader"}],defaultValue:{value:"AutoDetect",label:"AutoDetect"}},tokenUrl:{label:E,type:"text",description:(0,t.t)("auth-config.fields.token-url-description","The token endpoint of your OAuth2 provider."),validation:{required:!0,validate:s=>(0,Q.Ks)(s),message:(0,t.t)("auth-config.fields.token-url-required","This field is required and must be a valid URL.")}},scopes:{label:g,type:"select",description:(0,t.t)("auth-config.fields.scopes-description","List of comma- or space-separated OAuth2 {{ scopesLabel }}.",{scopesLabel:g}),multi:!0,allowCustomValue:!0,options:[]},allowedGroups:{label:I,type:"select",description:(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(t.x6,{i18nKey:"auth-config.fields.allowed-groups-description",children:"List of comma- or space-separated groups. The user should be a member of at least one group to log in."})," ",i==="generic_oauth"&&(0,t.t)("auth-config.fields.allowed-groups-description-oauth",'If you configure "{{ allowedGroupsLabel }}", you must also configure "{{ groupsAttributePathLabel }}".',{allowedGroupsLabel:I,groupsAttributePathLabel:f})]}),multi:!0,allowCustomValue:!0,options:[],validation:i==="azuread"?{validate:s=>typeof s=="string"?(0,Ie.A)(s):ae(s)?s.every(D=>D?.value&&(0,Ie.A)(D.value)):!0,message:(0,t.t)("auth-config.fields.allowed-groups-object-ids","{{ allowedGroupsLabel }} must be {{ objectIDsField }}.",{objectIDsField:"Object IDs"})}:void 0},apiUrl:{label:F,type:"text",description:(0,e.jsxs)(t.x6,{i18nKey:"auth-config.fields.api-url-description",children:["The user information endpoint of your OAuth2 provider. Information returned by this endpoint must be compatible with"," ",(0,e.jsx)(Pe.Y,{href:"https://connect2id.com/products/server/docs/api/userinfo",external:!0,variant:"bodySmall",children:"OpenID UserInfo"}),"."]}),validation:{required:!1,validate:s=>typeof s!="string"?!1:s.length?(0,Q.Ks)(s):!0,message:(0,t.t)("auth-config.fields.api-url-required","This field must be a valid URL if set.")}},roleAttributePath:{label:(0,t.t)("auth-config.fields.role-attribute-path-label","Role attribute path"),description:(0,t.t)("auth-config.fields.role-attribute-path-description","{{ jmesPathLabel }} expression to use for Grafana role lookup.",{jmesPathLabel:q}),type:"text",validation:{required:!1}},name:{label:(0,t.t)("auth-config.fields.display-name-label","Display name"),description:(0,t.t)("auth-config.fields.display-name-description",'Will be displayed on the login page as "Sign in with ...". Helpful if you use more than one identity providers or SSO protocols.'),type:"text"},allowSignUp:{label:(0,t.t)("auth-config.fields.allow-sign-up-label","Allow sign up"),description:(0,t.t)("auth-config.fields.allow-sign-up-description","If not enabled, only existing Grafana users can log in using OAuth."),type:"switch"},autoLogin:{label:(0,t.t)("auth-config.fields.auto-login-label","Auto login"),description:(0,t.t)("auth-config.fields.auto-login-description","Log in automatically, skipping the login screen."),type:"switch"},signoutRedirectUrl:{label:(0,t.t)("auth-config.fields.signout-redirect-url-label","Sign out redirect URL"),description:(0,t.t)("auth-config.fields.signout-redirect-url-description","The URL to redirect the user to after signing out from Grafana."),type:"text",validation:{required:!1}},emailAttributeName:{label:(0,t.t)("auth-config.fields.email-attribute-name-label","Email attribute name"),description:(0,t.t)("auth-config.fields.email-attribute-name-description","Name of the key to use for user email lookup within the attributes map of OAuth2 ID token."),type:"text"},emailAttributePath:{label:(0,t.t)("auth-config.fields.email-attribute-path-label","Email attribute path"),description:(0,t.t)("auth-config.fields.email-attribute-path-description","JMESPath expression to use for user email lookup from the user information."),type:"text"},nameAttributePath:{label:(0,t.t)("auth-config.fields.name-attribute-path-label","Name attribute path"),description:(0,t.t)("auth-config.fields.name-attribute-path-description",`JMESPath expression to use for user name lookup from the user ID token. 
This name will be used as the user's display name.`),type:"text"},loginAttributePath:{label:(0,t.t)("auth-config.fields.login-attribute-path-label","Login attribute path"),description:(0,t.t)("auth-config.fields.login-attribute-path-description","JMESPath expression to use for user login lookup from the user ID token."),type:"text"},idTokenAttributeName:{label:(0,t.t)("auth-config.fields.id-token-attribute-name-label","ID token attribute name"),description:(0,t.t)("auth-config.fields.id-token-attribute-name-description","The name of the key used to extract the ID token from the returned OAuth2 token."),type:"text"},roleAttributeStrict:{label:(0,t.t)("auth-config.fields.role-attribute-strict-label","Role attribute strict mode"),description:(0,t.t)("auth-config.fields.role-attribute-strict-description","If enabled, denies user login if the Grafana role cannot be extracted using Role attribute path."),type:"switch"},allowAssignGrafanaAdmin:{label:(0,t.t)("auth-config.fields.allow-assign-grafana-admin-label","Allow assign Grafana admin"),description:(0,t.t)("auth-config.fields.allow-assign-grafana-admin-description","If enabled, it will automatically sync the Grafana server administrator role."),type:"switch",hidden:!be.TP.isGrafanaAdmin},skipOrgRoleSync:{label:(0,t.t)("auth-config.fields.skip-org-role-sync-label","Skip organization role sync"),description:(0,t.t)("auth-config.fields.skip-org-role-sync-description","Prevent synchronizing users' organization roles from your IdP."),type:"switch"},orgMapping:{label:a,description:ge(i),type:"select",hidden:!be.TP.isGrafanaAdmin,multi:!0,allowCustomValue:!0,options:[],placeholder:(0,t.t)("auth-config.fields.organization-mapping-placeholder","Enter mappings (my-team:1:Viewer...) and press Enter to add")},orgAttributePath:{label:c,description:(0,t.t)("auth-config.fields.organization-attribute-path-description",'JMESPath expression to use for organization lookup. If you configure "{{ orgMappingLabel }}", you must also configure "{{ orgAttributePathLabel }}".',{orgMappingLabel:a,orgAttributePathLabel:c}),type:"text",hidden:!(["generic_oauth","okta"].includes(i)&&be.TP.isGrafanaAdmin)},defineAllowedGroups:{label:(0,t.t)("auth-config.fields.define-allowed-groups-label","Define allowed groups"),type:"switch"},defineAllowedTeamsIds:{label:(0,t.t)("auth-config.fields.define-allowed-teams-ids-label","Define allowed teams IDs"),type:"switch"},forceUseGraphApi:{label:(0,t.t)("auth-config.fields.force-use-graph-api-label","Force use Graph API"),description:(0,t.t)("auth-config.fields.force-use-graph-api-description","If enabled, Grafana will fetch the users' groups using the Microsoft Graph API."),type:"checkbox"},usePkce:{label:(0,t.t)("auth-config.fields.use-pkce-label","Use PKCE"),description:(0,e.jsxs)(t.x6,{i18nKey:"auth-config.fields.use-pkce-description",children:["If enabled, Grafana will use"," ",(0,e.jsx)(Pe.Y,{external:!0,variant:"bodySmall",href:"https://datatracker.ietf.org/doc/html/rfc7636",children:"Proof Key for Code Exchange (PKCE)"})," ","with the OAuth2 Authorization Code Grant."]}),type:"checkbox"},useRefreshToken:{label:(0,t.t)("auth-config.fields.use-refresh-token-label","Use refresh token"),description:(0,t.t)("auth-config.fields.use-refresh-token-description","If enabled, Grafana will fetch a new access token using the refresh token provided by the OAuth2 provider."),type:"checkbox"},tlsClientCa:{label:(0,t.t)("auth-config.fields.tls-client-ca-label","TLS client CA"),description:(0,t.t)("auth-config.fields.tls-client-ca-description","The file path to the trusted certificate authority list. Is not applicable on Grafana Cloud."),type:"text",hidden:!fe.$.localFileSystemAvailable},tlsClientCert:{label:(0,t.t)("auth-config.fields.tls-client-cert-label","TLS client cert"),description:(0,t.t)("auth-config.fields.tls-client-cert-description","The file path to the certificate. Is not applicable on Grafana Cloud."),type:"text",hidden:!fe.$.localFileSystemAvailable},tlsClientKey:{label:(0,t.t)("auth-config.fields.tls-client-key-label","TLS client key"),description:(0,t.t)("auth-config.fields.tls-client-key-description","The file path to the key. Is not applicable on Grafana Cloud."),type:"text",hidden:!fe.$.localFileSystemAvailable},tlsSkipVerifyInsecure:{label:(0,t.t)("auth-config.fields.tls-skip-verify-label","TLS skip verify"),description:(0,t.t)("auth-config.fields.tls-skip-verify-description",`If enabled, the client accepts any certificate presented by the server and any host 
name in that certificate. You should only use this for testing, because this mode leaves 
SSL/TLS susceptible to man-in-the-middle attacks.`),type:"switch"},groupsAttributePath:{label:f,description:(0,t.t)("auth-config.fields.groups-attribute-path-description",`JMESPath expression to use for user group lookup. If you configure "{{ allowedGroupsLabel }}", 
you must also configure "{{ groupsAttributePathLabel }}".`,{allowedGroupsLabel:I,groupsAttributePathLabel:f}),type:"text"},teamsUrl:{label:r,description:(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(t.x6,{i18nKey:"auth-config.fields.teams-url-description",children:"The URL used to query for Team IDs. If not set, the default value is /teams."})," ",i==="generic_oauth"&&(0,t.t)("auth-config.fields.teams-url-description-oauth",'If you configure "{{ teamsURLLabel }}", you must also configure "{{ teamIDsAttributePathLabel }}".',{teamsURLLabel:r,teamIDsAttributePathLabel:u})]}),type:"text",validation:{validate:(s,D)=>{let S=!0;return D.teamIds.length&&(S=!!s),typeof s=="string"&&s.length&&(S=(0,Q.Ks)(s)),S},message:(0,t.t)("auth-config.fields.teams-url-required",'This field must be set if "{{ teamIDsLabel }}" are configured and must be a valid URL.',{teamIDsLabel:P})}},teamIdsAttributePath:{label:u,description:(0,t.t)("auth-config.fields.team-ids-attribute-path-description",'The JMESPath expression to use for Grafana Team ID lookup within the results returned by the "{{ teamsURLLabel }}" endpoint.',{teamsURLLabel:r}),type:"text",validation:{validate:(s,D)=>D.teamIds.length?!!s:!0,message:(0,t.t)("auth-config.fields.team-ids-attribute-path-required",'This field must be set if "{{ teamIDsLabel }}" are configured.',{teamIDsLabel:P})}},teamIds:{label:P,type:"select",description:(0,e.jsxs)(e.Fragment,{children:[i==="github"?(0,t.t)("auth-config.fields.team-ids-github","Integer list of Team IDs."):(0,t.t)("auth-config.fields.team-ids-other","String list of Team IDs.")," ",(0,e.jsx)(t.x6,{i18nKey:"auth-config.fields.team-ids-description",children:"If set, the user must be a member of one of the given teams to log in."})," ",i==="generic_oauth"&&(0,t.t)("auth-config.fields.team-ids-description-oauth",'If you configure "{{ teamIDsLabel }}", you must also configure "{{ teamsURLLabel }}" and "{{ teamIDsAttributePathLabel }}".',{teamIDsLabel:P,teamsURLLabel:r,teamIDsAttributePathLabel:u})]}),multi:!0,allowCustomValue:!0,options:[],placeholder:(0,t.t)("auth-config.fields.team-ids-placeholder","Enter Team IDs and press Enter to add"),validation:i==="github"?{validate:s=>typeof s=="string"?se(s):ae(s)?s.every(D=>D?.value&&se(D.value)):!0,message:(0,t.t)("auth-config.fields.team-ids-numbers","Team IDs must be numbers.")}:void 0},hostedDomain:{label:(0,t.t)("auth-config.fields.hosted-domain-label","Hosted domain"),description:(0,t.t)("auth-config.fields.hosted-domain-description","The domain under which Grafana is hosted and accessible."),type:"text"},validateHd:{label:(0,t.t)("auth-config.fields.validate-hosted-domain-label","Validate hosted domain"),description:(0,t.t)("auth-config.fields.validate-hosted-domain-description",'If enabled, Grafana will match the Hosted Domain retrieved from the Google ID Token against the "{{ allowedDomainsLabel }}" list specified by the user.',{allowedDomainsLabel:L}),type:"checkbox"},serverDiscoveryUrl:{label:M,description:(0,t.t)("auth-config.fields.server-discovery-url-description",'The .well-known/openid-configuration endpoint for your IdP. The info extracted from this URL will be used to populate the "{{ authURLLabel }}", "{{ tokenURLLabel }}" and "{{ apiURLLabel }}" fields.',{authURLLabel:z,tokenURLLabel:E,apiURLLabel:F}),type:"custom",content:s=>(0,e.jsx)(Ue,{setValue:s})},domainHint:{label:(0,t.t)("auth-config.fields.domain-hint-label","Domain hint"),description:(0,t.t)("auth-config.fields.domain-hint-description","Parameter to indicate the realm of the user in the Azure AD/Entra ID tenant and streamline the login process."),type:"text",validation:{validate:s=>typeof s=="string"&&s.length?(0,Q.Ll)(s):!0,message:(0,t.t)("auth-config.fields.domain-hint-valid-domain","This field must be a valid domain.")}},loginPrompt:{label:(0,t.t)("auth-config.fields.login-prompt-label","Login prompt"),type:"select",description:(0,t.t)("auth-config.fields.login-prompt-description","Indicates the type of user interaction when the user logs in with the IdP."),multi:!1,options:[{value:"",label:""},{value:"login",label:(0,t.t)("auth-config.fields.login-prompt-login","Login")},{value:"consent",label:(0,t.t)("auth-config.fields.login-prompt-consent","Consent")},{value:"select_account",label:(0,t.t)("auth-config.fields.login-prompt-select-account","Select account")}],defaultValue:{value:"",label:""}}}}function se(i){return/^-?\d+$/.test(i)}function ge(i){switch(i){case"azuread":return(0,t.t)("auth-config.fields.org-mapping-description-azuread",'List of "<GroupID>:<OrgIdOrName>:<Role>" mappings.');case"github":return(0,t.t)("auth-config.fields.org-mapping-description-github",'List of "<GitHubTeamName>:<OrgIdOrName>:<Role>" mappings.');case"gitlab":return(0,t.t)("auth-config.fields.org-mapping-description-gitlab",'List of "<GitlabGroupName>:<OrgIdOrName>:<Role>" mappings.');case"google":return(0,t.t)("auth-config.fields.org-mapping-description-google",'List of "<GoogleGroupName>:<OrgIdOrName>:<Role>" mappings.');default:return(0,t.t)("auth-config.fields.org-mapping-description-generic",'List of "<ExternalName>:<OrgIdOrName>:<Role>" mappings.')}}function v(i){switch(i){case"azuread":return[{value:"none",label:(0,t.t)("auth-config.fields.client-authentication-none","None")},{value:"client_secret_post",label:"Client secret"},{value:"managed_identity",label:"Managed identity"},{value:"workload_identity",label:"Workload identity"}];default:return[{value:"none",label:"None"},{value:"client_secret_post",label:"Client secret"}]}}const _=({field:i,register:a,errors:c,watch:r,setValue:u,getValues:I,control:f,unregister:P,secretConfigured:L,provider:s})=>{const[D,S]=(0,l.useState)(L),re=typeof i!="string",h=re?i.name:i,le=re?r(i.dependsOn):null,p=N(s)[h],Me=(0,Te.$j)();(0,l.useEffect)(()=>{re&&(le||P(h))},[P,h,le,re]);const je=k=>Array.isArray(k)&&k.length>0&&"value"in k[0];if((0,l.useEffect)(()=>{if(p.defaultValue){const k=I(h),de=p.options?.find(ce=>ce.value===(je(k)?k[0].value:void 0));u(h,de?.value||p.defaultValue.value)}},[]),!i)return console.log("missing field:",h),null;if(p.hidden||re&&!r(i.dependsOn))return null;const ee={label:p.label,required:!!p.validation?.required,invalid:!!c[h],error:p.validation?.message,description:p.description,defaultValue:p.defaultValue?.value};switch(p.type){case"text":return(0,e.jsx)(R.D,{...ee,children:(0,e.jsx)(Ae.p,{...a(h,p.validation),type:p.type,id:h,autoComplete:"off"})},h);case"secret":return(0,e.jsx)(R.D,{...ee,htmlFor:h,children:(0,e.jsx)(b.xI,{name:h,control:f,rules:p.validation,render:({field:{ref:ce,value:ue,...xe}})=>(0,e.jsx)(Ee.L4,{...xe,autoComplete:"off",id:h,value:typeof ue=="string"?ue:"",isConfigured:D,onReset:()=>{S(!1),u(h,"")}})})},h);case"select":const k=r(h);let de=p.options;return p.options?.length||(de=ae(k)?k:[]),(0,e.jsx)(R.D,{...ee,htmlFor:h,children:(0,e.jsx)(b.xI,{rules:p.validation,name:h,control:f,render:({field:{ref:ce,onChange:ue,...xe},fieldState:{invalid:ke}})=>(0,e.jsx)(Oe.l6,{...xe,placeholder:p.placeholder,isMulti:p.multi,invalid:ke,inputId:h,options:de,allowCustomValue:!!p.allowCustomValue,defaultValue:p.defaultValue,onChange:ue,onCreateOption:Y=>{const Le={value:Y,label:Y};ue([...de||[],Le])}})})},h);case"switch":return(0,e.jsx)(R.D,{...ee,children:(0,e.jsx)(J.d,{...a(h),id:h})},h);case"checkbox":return(0,e.jsx)(j.S,{...a(h),id:h,...ee,className:(0,B.css)({marginBottom:Me.spacing(2)})},h);case"custom":return(0,e.jsx)(R.D,{...ee,children:p.content?p.content(u):(0,e.jsx)(e.Fragment,{})},h);default:return console.error(`Unknown field type: ${p.type}`),null}},Ne={allowAssignGrafanaAdmin:!1,allowSignUp:!1,allowedDomains:[],allowedGroups:[],allowedOrganizations:[],apiUrl:"",authStyle:"",authUrl:"",autoLogin:!1,clientAuthentication:"",clientId:"",clientSecret:"",managedIdentityClientId:"",federatedCredentialAudience:"",workloadIdentityTokenFile:"",emailAttributeName:"",emailAttributePath:"",emptyScopes:!1,enabled:!1,loginPrompt:"",extra:{},groupsAttributePath:"",hostedDomain:"",icon:"shield",name:"",roleAttributePath:"",roleAttributeStrict:!1,scopes:[],signoutRedirectUrl:"",skipOrgRoleSync:!1,teamIds:[],teamIdsAttributePath:"",teamsUrl:"",tlsClientCa:"",tlsClientCert:"",tlsClientKey:"",tlsSkipVerify:!1,tokenUrl:"",type:"",usePkce:!1,useRefreshToken:!1},We=i=>{if(!i?.length)return[];if(Array.isArray(i))return i.map(a=>({label:a,value:a}));if(i.startsWith("[")&&i.endsWith("]"))try{return JSON.parse(i).map(a=>({label:a,value:a}))}catch{}return i.split(/[\s,]/).map(a=>({label:a,value:a}))};function Ve(i){if(!i)return Ne;const a=Ge(i.provider),c=ze(N(i.provider),a),r={...i.settings};for(const u of c)r[u]=We(r[u]);return r}const Ze=i=>JSON.stringify(i.map(({value:a})=>a)),Ge=i=>{const a=Se()[i],c=["enabled"];return Object.values(a).reduce((r,u)=>[...r,...u.fields.map(I=>typeof I=="string"?I:I.name)],c)};function $e(i,a){let c=i;const r=Ge(a),u=ze(N(a),r),I=Object.keys(c).filter(f=>r.includes(f)).reduce((f,P)=>({...f,[P]:c[P]}),{});for(const f of u){const P=c[f];P&&(ae(P)?I[f]=Ze(P):ae([P])&&(I[f]=P.value))}return I}function ze(i,a){return Object.entries(i).filter(([c,r])=>a.includes(c)&&r.type==="select").map(([c])=>c)}const De=(0,y.J7)(),He=({config:i,provider:a,isLoading:c})=>{const{register:r,handleSubmit:u,control:I,reset:f,watch:P,setValue:L,getValues:s,unregister:D,formState:{errors:S,dirtyFields:re,isSubmitted:h}}=(0,b.mN)({defaultValues:Ve(i),mode:"onSubmit",reValidateMode:"onChange"}),[le,p]=(0,l.useState)(!1),[Me,je]=(0,l.useState)(!1),ee=h&&!Me,k=(0,l.useMemo)(()=>Se()[a],[a]),[de,ce]=(0,l.useState)(!1),ue=(0,e.jsx)(Z.W,{children:(0,e.jsx)(Z.W.Item,{label:(0,t.t)("auth-config.provider-config-form.additional-actions-menu.label-reset-to-default-values","Reset to default values"),icon:"history-alt",onClick:()=>{ce(!0)}})}),xe=async O=>{p(!0),je(!1);const te=$e(O,a);try{await(0,w.AI)().put(`/api/v1/sso-settings/${a}`,{id:i?.id,provider:i?.provider,settings:{...te}},{showErrorAlert:!1}),(0,T.rR)("grafana_authentication_ssosettings_saved",{provider:a,enabled:te.enabled}),De.publish({type:d.r1.alertSuccess.name,payload:["Settings saved"]}),f(O),setTimeout(()=>{U.Ny.push("/admin/authentication")},300)}catch(K){let Ke="";(0,w.NF)(K)?Ke=K.data.message:K instanceof Error&&(Ke=K.message),De.publish({type:d.r1.alertError.name,payload:[Ke]}),je(!0),p(!1)}},ke=async()=>{try{await(0,w.AI)().delete(`/api/v1/sso-settings/${a}`,void 0,{showSuccessAlert:!1}),(0,T.rR)("grafana_authentication_ssosettings_removed",{provider:a}),De.publish({type:d.r1.alertSuccess.name,payload:["Settings reset to defaults"]}),setTimeout(()=>{U.Ny.push("/admin/authentication")})}catch(O){let te="";(0,w.NF)(O)?te=O.data.message:O instanceof Error&&(te=O.message),De.publish({type:d.r1.alertError.name,payload:[te]})}},Y=i?.settings.enabled,Le=O=>{(0,T.rR)("grafana_authentication_ssosettings_save_attempt",{provider:a,enabled:O?!Y:Y}),O&&L("enabled",!Y)};return(0,e.jsxs)(G.Y.Contents,{isLoading:c,children:[(0,e.jsxs)("form",{onSubmit:u(xe),style:{maxWidth:"600px"},children:[(0,e.jsx)(ie.F,{confirmRedirect:!!Object.keys(re).length&&!ee,onDiscard:()=>{(0,T.rR)("grafana_authentication_ssosettings_abandoned",{provider:a}),f()}}),(0,e.jsx)(R.D,{label:(0,t.t)("auth-config.provider-config-form.label-enabled","Enabled"),hidden:!0,children:(0,e.jsx)(J.d,{...r("enabled"),id:"enabled",label:(0,t.t)("auth-config.provider-config-form.enabled-label-enabled","Enabled")})}),(0,e.jsx)(o.B,{gap:2,direction:"column",children:k.filter(O=>!O.hidden).map((O,te)=>(0,e.jsx)(pe.M,{label:O.name,isOpen:te===0,children:O.fields.filter(K=>typeof K!="string"?!K.hidden:!0).map(K=>(0,e.jsx)(_,{field:K,control:I,errors:S,setValue:L,getValues:s,register:r,watch:P,unregister:D,provider:a,secretConfigured:!!i?.settings.clientSecret},typeof K=="string"?K:K.name))},O.name))}),(0,e.jsx)(me.a,{display:"flex",gap:2,marginTop:5,children:(0,e.jsxs)(o.B,{alignItems:"center",gap:2,children:[(0,e.jsx)($.$n,{type:"submit",disabled:le,onClick:()=>Le(!0),variant:Y?"secondary":void 0,children:le?Y?(0,t.t)("auth-config.provider-config-form.disabling","Disabling..."):(0,t.t)("auth-config.provider-config-form.saving","Saving..."):Y?(0,t.t)("auth-config.provider-config-form.disable","Disable"):(0,t.t)("auth-config.provider-config-form.save-and-enable","Save and enable")}),(0,e.jsx)($.$n,{type:"submit",disabled:le,variant:"secondary",onClick:()=>Le(!1),children:le?(0,t.t)("auth-config.provider-config-form.saving","Saving..."):(0,t.t)("auth-config.provider-config-form.save","Save")}),(0,e.jsx)($.z9,{href:"/admin/authentication",variant:"secondary",children:(0,e.jsx)(t.x6,{i18nKey:"auth-config.provider-config-form.discard",children:"Discard"})}),(0,e.jsx)(H.m,{overlay:ue,placement:"bottom-start",children:(0,e.jsx)(X.K,{tooltip:(0,t.t)("auth-config.provider-config-form.tooltip-more-actions","More actions"),title:(0,t.t)("auth-config.provider-config-form.title-more-actions","More actions"),tooltipPlacement:"top",size:"md",variant:"secondary",name:"ellipsis-v",hidden:i?.source==="system"})})]})})]}),de&&(0,e.jsx)(ye.u,{isOpen:!0,icon:"trash-alt",title:(0,t.t)("auth-config.provider-config-form.title-reset","Reset"),body:(0,e.jsxs)(o.B,{direction:"column",gap:3,children:[(0,e.jsx)("span",{children:(0,e.jsx)(t.x6,{i18nKey:"auth-config.provider-config-form.reset-configuration",children:"Are you sure you want to reset this configuration?"})}),(0,e.jsx)("small",{children:(0,e.jsx)(t.x6,{i18nKey:"auth-config.provider-config-form.reset-configuration-description",children:"After resetting these settings Grafana will use the provider configuration from the system (config file/environment variables) if any."})})]}),confirmText:(0,t.t)("auth-config.provider-config-form.confirmText-reset","Reset"),onDismiss:()=>ce(!1),onConfirm:async()=>{await ke(),ce(!1)}})]})};var Fe=n(22011),Ye=n(35991);const Je=i=>{if(!i)return{text:(0,t.t)("auth-config.get-page-nav.text.authentication","Authentication"),subTitle:(0,t.t)("auth-config.get-page-nav.subTitle.configure-authentication-providers","Configure authentication providers"),icon:"shield",id:"authentication"};const a=Fe.L[i.provider][1]||i.provider.toUpperCase();return{text:a||"",subTitle:`To configure ${a} OAuth2 you must register your application with ${a}. The provider will generate a Client ID and Client Secret for you to use.`,icon:i.settings.icon||"shield",id:i.provider}},Be=()=>{const i=(0,V.wA)(),{isLoading:a,providers:c}=(0,V.d4)(f=>f.authConfig),{provider:r=""}=(0,x.g)(),u=c.find(f=>f.provider===r);if((0,l.useEffect)(()=>{i((0,Ye.TD)(r))},[i,r]),!u||!u.provider||!Fe.L[u.provider])return(0,e.jsx)(ne.H,{});const I=Je(u);return(0,e.jsx)(G.Y,{navId:"authentication",pageNav:I,renderTitle:f=>(0,e.jsxs)(o.B,{gap:2,alignItems:"center",children:[(0,e.jsx)(A.E,{variant:"h1",children:f}),(0,e.jsx)(m.E,{text:u.settings.enabled?(0,t.t)("auth-config.provider-config-page.text-badge-enabled","Enabled"):(0,t.t)("auth-config.provider-config-page.text-badge-not-enabled","Not enabled"),color:u.settings.enabled?"green":"blue",icon:u.settings.enabled?"check":void 0})]}),children:(0,e.jsx)(He,{config:u,isLoading:a,provider:r})})},Xe=Be},83560:(W,C,n)=>{n.d(C,{X:()=>x});var e=n(96540),l=n(36490);const x=({message:t,when:o=!0})=>{const A=l.Ny.getHistory();return(0,e.useEffect)(()=>{if(!o)return;const m=A.block(t);return()=>{m()}},[o,t,A]),null}},83813:(W,C,n)=>{n.d(C,{F:()=>ne});var e=n(74848),l=n(22803),x=n(96540),t=n(54148),o=n(92745),A=n(22787),m=n(45861),G=n(83560);const ne=({confirmRedirect:b,onDiscard:d,onLocationChange:y})=>{const[w,T]=(0,x.useState)(!1),[U,Z]=(0,x.useState)(null),[R,J]=(0,x.useState)(!1);(0,x.useEffect)(()=>{const H=X=>{b&&(X.preventDefault(),X.returnValue="")};return window.addEventListener("beforeunload",H),()=>{window.removeEventListener("beforeunload",H)}},[b]);const pe=H=>{const X=window.location.pathname,ye=H.pathname;if(X===ye)return!0;const ie=y?.(H);let B=b&&!R;return ie!==void 0&&(B=B&&ie),B?(T(!0),Z(H),!1):(ie&&d(),!0)},me=()=>{T(!1),Z(null)},$=()=>{T(!1),J(!0),d()};return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(G.X,{when:!0,message:pe}),U&&R&&(0,e.jsx)(t.C5,{replace:!0,to:U}),(0,e.jsx)(V,{isOpen:w,onDiscard:$,onBackToForm:me})]})},V=({onDiscard:b,onBackToForm:d,isOpen:y})=>(0,e.jsxs)(A.a,{isOpen:y,title:(0,o.t)("form-prompt.title","Leave page?"),onDismiss:d,icon:"exclamation-triangle",className:(0,l.css)({width:"500px"}),children:[(0,e.jsx)("h5",{children:(0,e.jsx)(o.x6,{i18nKey:"form-prompt.description",children:"Changes that you made may not be saved."})}),(0,e.jsxs)(A.a.ButtonRow,{children:[(0,e.jsx)(m.$n,{variant:"secondary",onClick:d,fill:"outline",children:(0,e.jsx)(o.x6,{i18nKey:"form-prompt.continue-button",children:"Continue editing"})}),(0,e.jsx)(m.$n,{variant:"destructive",onClick:b,children:(0,e.jsx)(o.x6,{i18nKey:"form-prompt.discard-button",children:"Discard unsaved changes"})})]})]})}}]);

//# sourceMappingURL=AdminAuthentication.b2c7408ba226dccc4c9c.js.map