"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[152],{15983:(ve,ee,t)=>{t.d(ee,{A:()=>ae});var e=t(74848),h=t(92745),i=t(41654),A=t(68079),N=t(66404),r=t(83793),w=t(96540),K=t(89599),C=t(45861);function G({urls:R,jobType:U}){const H=R?.newPullRequestURL,F=R?.compareURL,z=R?.sourceURL;return U==="sync"?null:(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(C.z9,{href:z,icon:"external-link-alt",variant:"secondary",target:"_blank",children:(0,e.jsx)(h.x6,{i18nKey:"provisioning.repository-link.delete-or-move-job.view-branch",children:"View branch"})}),(0,e.jsx)(C.z9,{href:F,icon:"external-link-alt",variant:"secondary",target:"_blank",children:(0,e.jsx)(h.x6,{i18nKey:"provisioning.repository-link.delete-or-move-job.compare-branch",children:"Compare branch"})}),(0,e.jsx)(C.z9,{href:H,icon:"external-link-alt",variant:"secondary",target:"_blank",children:(0,e.jsx)(h.x6,{i18nKey:"provisioning.repository-link.delete-or-move-job.open-pull-request",children:"Open pull request"})})]})}var _=t(29189),j=t(89640),te=t(92784);function W({name:R,jobType:U}){const H=(0,r.Sw)(R?{name:R}:_.hT),F=H.data;if(!F||H.isLoading)return null;const z=(0,te.ar)(F.spec?.github);return U==="sync"?(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(N.E,{children:(0,e.jsx)(h.x6,{i18nKey:"provisioning.repository-link.grafana-repository-synced",children:"Your resources are now in your external storage and provisioned into your instance. From now on, your instance and the external storage will be synchronized."})}),z&&(0,e.jsx)(i.B,{direction:"row",gap:2,children:(0,e.jsx)(j.Y,{href:z,external:!0,children:(0,e.jsx)(h.x6,{i18nKey:"provisioning.repository-link.sync-job.view-repository",children:"View repository"})})})]}):(0,e.jsx)(e.Fragment,{children:z&&(0,e.jsx)(i.B,{direction:"row",gap:2,children:(0,e.jsx)(C.z9,{href:z,icon:"external-link-alt",variant:"secondary",target:"_blank",children:(0,e.jsx)(h.x6,{i18nKey:"provisioning.repository-link.delete-or-move-job.view-repository",children:"View repository"})})})})}var Q=t(22803),X=t(63142);const g=({progress:R,topBottomSpacing:U})=>{const H=(0,X.of)(V,U);return R===void 0?null:(0,e.jsx)("div",{className:H.container,children:(0,e.jsx)("div",{className:H.filler,style:{width:`${R}%`}})})},V=(R,U=2)=>({container:(0,Q.css)({height:"10px",width:"400px",backgroundColor:R.colors.background.secondary,borderRadius:R.shape.radius.pill,overflow:"hidden",margin:R.spacing(U,0)}),filler:(0,Q.css)({height:"100%",background:R.colors.success.text,[R.transitions.handleMotion("no-preference","reduce")]:{transition:"width 0.5s ease-in-out"}})}),l=g;var D=t(34888);function q({jobType:R,job:U,isFinishedJob:H=!1,onStatusChange:F}){const z=(0,w.useRef)(!1),{state:$,message:ne,progress:re,summary:le,errors:se}=U?.status||{},k=U?.metadata?.labels?.["provisioning.grafana.app/repository"],ie=U?.status?.url?.newPullRequestURL;return(0,w.useEffect)(()=>{if($)switch($){case"success":F?.({status:"success"});break;case"warning":z.current||(F?.({status:"warning",warning:{title:(0,h.t)("provisioning.job-status.status.title-warning-running-job","Job completed with warnings"),message:se?.length?se:ne}}),z.current=!0);break;case"error":z.current||(F?.({status:"error",error:{title:(0,h.t)("provisioning.job-status.status.title-error-running-job","Error running job"),message:se?.length?se:ne}}),z.current=!0);break;case"working":case"pending":F?.({status:"running"});break;default:break}},[$,ne,se,F]),U?.status?(0,e.jsx)(i.B,{direction:"column",gap:2,children:(0,e.jsxs)(i.B,{direction:"column",gap:2,children:[["working","pending"].includes($??"")&&(0,e.jsxs)(i.B,{direction:"column",alignItems:"center",children:[(0,e.jsxs)(i.B,{direction:"row",alignItems:"center",justifyContent:"center",gap:2,children:[(0,e.jsx)(A.y,{size:24}),(0,e.jsx)(N.E,{element:"h5",color:"secondary",children:ne??$??(0,h.t)("provisioning.job-status.starting","Starting...")})]}),(0,e.jsx)(l,{progress:re??0})]}),H&&le&&(0,e.jsxs)(i.B,{direction:"column",gap:2,children:[(0,e.jsx)(N.E,{variant:"h3",children:(0,e.jsx)(h.x6,{i18nKey:"provisioning.job-status.summary",children:"Summary"})}),(0,e.jsx)(D.c,{summary:le})]}),$==="success"?(0,e.jsx)(i.B,{direction:"row",gap:1,children:ie?(0,e.jsx)(G,{urls:U.status?.url,jobType:R}):(0,e.jsx)(W,{name:k,jobType:R})}):(0,e.jsx)(K.a,{label:(0,h.t)("provisioning.job-status.label-view-details","View details"),isOpen:!1,children:(0,e.jsx)("pre",{children:JSON.stringify(U,null,2)})})]})}):null}function oe({jobUid:R,repositoryName:U,jobType:H,onStatusChange:F}){const z=(0,w.useRef)(!1),$=(0,r.$9)({name:U,uid:R}),ne=z.current&&$.isError,re=$.data;return(0,w.useEffect)(()=>{const le=!re&&!z.current&&!$.isFetching;let se;if(le&&(z.current=!0,se=setTimeout(()=>{$.refetch()},1e3)),ne){F?.({status:"error",error:{title:(0,h.t)("provisioning.job-status.no-job-found","No job found"),message:(0,h.t)("provisioning.job-status.no-job-found-message","The job may have been deleted or could not be retrieved. Cancel the current process and start again.")}});return}if($.isSuccess&&re?.status){const{state:k,message:ie,errors:ge}=re.status;k==="error"?F?.({status:"error",error:{title:(0,h.t)("provisioning.job-status.status.title-error-running-job","Error running job"),message:ge?.length?ge:ie}}):k==="success"?F?.({status:"success",success:{title:(0,h.t)("provisioning.job-status.status.title-success-running-job","Job completed successfully")}}):k==="warning"&&F?.({status:"warning",warning:{title:(0,h.t)("provisioning.job-status.status.title-warning-running-job","Job completed with warnings"),message:ge?.length?ge:ie}})}return()=>{se&&clearTimeout(se)}},[$,re,F,ne]),!re||$.isLoading||$.isFetching?(0,e.jsxs)(i.B,{direction:"row",alignItems:"center",justifyContent:"center",gap:2,children:[(0,e.jsx)(A.y,{size:24}),(0,e.jsx)(N.E,{element:"h4",color:"secondary",children:(0,e.jsx)(h.x6,{i18nKey:"provisioning.job-status.loading-finished-job",children:"Loading finished job..."})})]}):(0,e.jsx)(q,{job:re,isFinishedJob:!0,onStatusChange:F,jobType:H})}function ae({jobType:R,watch:U,onStatusChange:H}){const F=(0,r.L3)({fieldSelector:`metadata.name=${U.metadata?.name}`,watch:!0}),z=F?.data?.items?.[0],$=U.metadata?.labels?.["provisioning.grafana.app/repository"],re=!F.isUninitialized&&!F.isLoading&&!z&&!!$;return F.isLoading?(0,e.jsxs)(i.B,{direction:"row",alignItems:"center",justifyContent:"center",gap:2,children:[(0,e.jsx)(A.y,{size:24}),(0,e.jsx)(N.E,{element:"h4",color:"secondary",children:(0,e.jsx)(h.x6,{i18nKey:"provisioning.job-status.starting",children:"Starting..."})})]}):F.isError?(H?.({status:"error",error:{title:(0,h.t)("provisioning.job-status.title.error-fetching-active-job","Error fetching active job")}}),null):z?(0,e.jsx)(q,{job:z,isFinishedJob:!1,onStatusChange:H,jobType:R}):re?(0,e.jsx)(oe,{jobUid:U.metadata?.uid,repositoryName:$,onStatusChange:H,jobType:R}):(0,e.jsxs)(i.B,{direction:"row",alignItems:"center",justifyContent:"center",gap:2,children:[(0,e.jsx)(A.y,{size:24}),(0,e.jsx)(N.E,{element:"h4",weight:"bold",children:(0,e.jsx)(h.x6,{i18nKey:"provisioning.job-status.starting",children:"Starting..."})})]})}},34888:(ve,ee,t)=>{t.d(ee,{c:()=>N});var e=t(74848),h=t(27594),i=t(41654);const A=()=>[{id:"resource",header:"Resource",cell:({row:{original:r}})=>r.resource},{id:"created",header:"Created",cell:({row:{original:r}})=>r.create?.toString()||"-"},{id:"deleted",header:"Deleted",cell:({row:{original:r}})=>r.delete?.toString()||"-"},{id:"updated",header:"Updated",cell:({row:{original:r}})=>r.update?.toString()||"-"},{id:"unchanged",header:"Unchanged",cell:({row:{original:r}})=>r.noop?.toString()||"-"},{id:"errors",header:"Errors",cell:({row:{original:r}})=>r.error?.toString()||"-"},{id:"total",header:"Total",cell:({row:{original:r}})=>((r.create||0)+(r.delete||0)+(r.update||0)+(r.noop||0)+(r.error||0)).toString()}];function N({summary:r}){return(0,e.jsx)(i.B,{direction:"column",gap:2,children:(0,e.jsx)(h.j,{data:r,columns:A(),getRowId:w=>w.resource||"",pageSize:10})})}},63498:(ve,ee,t)=>{t.d(ee,{bj:()=>Q});var e=t(74848),h=t(22803),i=t(92745),A=t(43173),N=t(45861),r=t(41654),w=t(77824),K=t(32635),C=t(63142),G=t(18552),_=t(93732),j=t(83458);function te(){return[{value:j.P.Folders,icon:"folder",description:(0,i.t)("search.actions.view-as-folders","View by folders")},{value:j.P.List,icon:"list-ul",description:(0,i.t)("search.actions.view-as-list","View as list")}]}function W(g){const V=g.layout??j.P.Folders;return V===j.P.Folders&&(g.query||g.sort||g.starred||g.tag.length>0)?j.P.List:V}const Q=({state:g,showStarredFilter:V,showLayout:l,sortPlaceholder:D,onLayoutChange:q,onSortChange:oe,onStarredFilterChange:ae=()=>{},onTagFilterChange:R,getTagOptions:U,getSortOptions:H,onDatasourceChange:F,onPanelTypeChange:z,onSetIncludePanels:$})=>{const ne=(0,C.of)(X),re=W(g),le=g.tag.length||g.starred||g.query||g.datasource||g.panel_type?[j.P.Folders]:[];return(0,e.jsxs)(r.B,{justifyContent:"space-between",alignItems:"center",children:[(0,e.jsxs)(r.B,{gap:2,alignItems:"center",children:[(0,e.jsx)(_.$,{isClearable:!1,tags:g.tag,tagOptions:U,onChange:R}),A.$.featureToggles.panelTitleSearch&&(0,e.jsx)(K.S,{"data-testid":"include-panels",disabled:re===j.P.Folders,value:g.includePanels,onChange:()=>$(!g.includePanels),label:(0,i.t)("search.actions.include-panels","Include panels")}),V&&(0,e.jsx)("div",{className:ne.checkboxWrapper,children:(0,e.jsx)(K.S,{label:(0,i.t)("search.actions.starred","Starred"),onChange:ae,value:g.starred})}),g.datasource&&(0,e.jsx)(N.$n,{icon:"times",variant:"secondary",onClick:()=>F(void 0),children:(0,e.jsxs)(i.x6,{i18nKey:"search.actions.remove-datasource-filter",children:["Datasource: ",{datasource:g.datasource}]})}),g.panel_type&&(0,e.jsx)(N.$n,{icon:"times",variant:"secondary",onClick:()=>z(void 0),children:(0,e.jsxs)(i.x6,{i18nKey:"search.action-row.panel-type",values:{panel:g.panel_type},children:["Panel: ","{{panel}}"]})})]}),(0,e.jsxs)(r.B,{gap:2,children:[l&&(0,e.jsx)(w.z,{options:te(),disabledOptions:le,onChange:q,value:re}),(0,e.jsx)(G.r,{onChange:se=>oe(se?.value),value:g.sort,getSortOptions:H,placeholder:D||(0,i.t)("search.actions.sort-placeholder","Sort"),isClearable:!0})]})]})};Q.displayName="ActionRow";const X=g=>({checkboxWrapper:(0,h.css)({label:{lineHeight:"1.2"}})})},72017:(ve,ee,t)=>{t.d(ee,{h:()=>_,s:()=>C});var e=t(74848),h=t(92745),i=t(43173),A=t(34999),N=t(83793),r=t(96727),w=t(6262),K=t(79205);const C={severity:"info",style:{flex:0}};function G({queryParams:j,slug:te,path:W}){const{prURL:Q}=(0,r.H)(),X=(0,N.Kw)({name:te,path:W,ref:j.ref});if(X.data?.errors)return(0,e.jsx)(A.F,{title:(0,h.t)("dashboard-scene.dashboard-preview-banner.title-error-loading-dashboard","Error loading dashboard"),severity:"error",style:{flex:0},children:X.data.errors.map((V,l)=>(0,e.jsx)("div",{children:V},l))});if(Q?.length)return(0,e.jsx)(K.G,{prParam:Q,isNewPr:!0});const g=X.data?.urls?.newPullRequestURL??X.data?.urls?.compareURL;return g?(0,e.jsx)(K.G,{prParam:g}):(0,e.jsx)(A.F,{...C,title:(0,h.t)("dashboard-scene.dashboard-preview-banner.title-dashboard-loaded-external-repository","This dashboard is loaded from an external repository"),children:(0,e.jsx)(h.x6,{i18nKey:"dashboard-scene.dashboard-preview-banner.not-yet-saved",children:"The value is not saved in the Grafana database"})})}function _({queryParams:j,route:te,slug:W,path:Q}){return!i.$.featureToggles.provisioning||"kiosk"in j||!Q||te!==w.Z4.Provisioning||!W?null:(0,e.jsx)(G,{queryParams:j,slug:W,path:Q})}},75793:(ve,ee,t)=>{t.d(ee,{ET:()=>g,lC:()=>W,ue:()=>_});var e=t(2543),h=t.n(e),i=t(36490),A=t(5114),N=t(29043),r=t(99090),w=t(67497),K=t(55860),C=t(83458),G=t(35886);const _={query:"",tag:[],starred:!1,layout:C.P.Folders,sort:void 0,prevSort:void 0,eventTrackingNamespace:"dashboard_search",deleted:!1},j={sort:null,starred:null,query:null,tag:null,layout:null},te=()=>localStorage.getItem(r.YU)===C.P.List?C.P.List:C.P.Folders;class W extends A.Q{constructor(){super(...arguments),this.updateLocation=(0,e.debounce)(l=>i.Ny.partial(l,!0),300),this.doSearchWithDebounce=(0,e.debounce)(()=>this.doSearch(),300),this.lastSearchTimestamp=0,this.onCloseSearch=()=>{this.updateLocation({search:null,folder:null,...j})},this.onClearSearchAndFilters=()=>{this.setStateAndDoSearch({query:"",datasource:void 0,tag:[],panel_type:void 0,starred:void 0,sort:void 0})},this.onQueryChange=l=>{this.setStateAndDoSearch({query:l})},this.onRemoveTag=l=>{this.setStateAndDoSearch({tag:this.state.tag.filter(D=>D!==l)})},this.onTagFilterChange=l=>{this.setStateAndDoSearch({tag:l})},this.onAddTag=l=>{this.state.tag&&this.state.tag.includes(l)||this.setStateAndDoSearch({tag:[...this.state.tag,l]})},this.onDatasourceChange=l=>{this.setStateAndDoSearch({datasource:l})},this.onPanelTypeChange=l=>{this.setStateAndDoSearch({panel_type:l})},this.onStarredFilterChange=l=>{const D=l.currentTarget.checked;this.setStateAndDoSearch({starred:D})},this.onClearStarred=()=>{this.setStateAndDoSearch({starred:!1})},this.onSetStarred=l=>{l!==this.state.starred&&this.setStateAndDoSearch({starred:l})},this.onSortChange=l=>{l?(localStorage.setItem(r.w7,l),localStorage.setItem(r.YU,C.P.List)):localStorage.removeItem(r.w7),this.state.layout===C.P.Folders?this.setStateAndDoSearch({sort:l,layout:C.P.List}):this.setStateAndDoSearch({sort:l})},this.onLayoutChange=l=>{localStorage.setItem(r.YU,l),this.state.sort&&l===C.P.Folders?this.setStateAndDoSearch({layout:l,prevSort:this.state.sort,sort:void 0}):this.setStateAndDoSearch({layout:l,sort:this.state.prevSort})},this.onSetIncludePanels=l=>{this.setStateAndDoSearch({includePanels:l}),N.A.set(r.d7,l)},this.getTagOptions=()=>{const l=this.lastQuery??{kind:["dashboard","folder"],query:"*"};return(0,K.S)().tags(l)},this.onSearchItemClicked=l=>{(0,w.MK)(this.state.eventTrackingNamespace,{layout:this.state.layout,starred:this.state.starred,sortValue:this.state.sort,query:this.state.query,tagCount:this.state.tag?.length,includePanels:this.state.includePanels,deleted:this.state.deleted})},this.onReportSearchUsage=()=>{(0,w.Pf)(this.state.eventTrackingNamespace,{layout:this.state.layout,starred:this.state.starred,sortValue:this.state.sort,query:this.state.query,tagCount:this.state.tag?.length,includePanels:this.state.includePanels,deleted:this.state.deleted})}}initStateFromUrl(l,D=!0){const q=(0,G.N1)(i.Ny.getSearchObject());(q.query||q.datasource||q.panel_type)&&(q.layout=C.P.List);const oe=te(),ae=localStorage.getItem(r.w7)??void 0,R=oe===C.P.List?q.sort||ae:null;this.setState({..._,...q,layout:oe,sort:R??_.sort,prevSort:ae,folderUid:l,eventTrackingNamespace:l?"manage_dashboards":"dashboard_search",deleted:this.state.deleted}),D&&this.hasSearchFilters()&&this.doSearch()}setStateAndDoSearch(l){const D=l.sort||this.state.sort||localStorage.getItem(r.w7)||void 0;this.setState({sort:D,...l}),this.updateLocation({query:this.state.query.length===0?null:this.state.query,tag:this.state.tag,datasource:this.state.datasource,panel_type:this.state.panel_type,starred:this.state.starred?this.state.starred:null,sort:this.state.sort}),this.hasSearchFilters()&&this.doSearchWithDebounce()}hasSearchFilters(){return!!(this.state.query||this.state.tag.length||this.state.starred||this.state.panel_type||this.state.sort||this.state.deleted||this.state.layout===C.P.List)}getSearchQuery(){const l={query:this.state.query,tags:this.state.tag,ds_uid:this.state.datasource,panel_type:this.state.panel_type,location:this.state.folderUid,sort:this.state.sort,explain:this.state.explain,withAllowedActions:this.state.explain,starred:this.state.starred,deleted:this.state.deleted};return l.sort?.length&&!l.sort.includes("name")&&(l.kind=["dashboard","folder"]),l.query?.length||(l.query="*",l.location||(l.kind=["dashboard","folder"])),!this.state.includePanels&&!l.kind&&(l.kind=["dashboard","folder"]),l.panel_type?.length&&(l.kind=["panel"]),l}doSearch(){const l={layout:this.state.layout,starred:this.state.starred,sortValue:this.state.sort,query:this.state.query,tagCount:this.state.tag?.length,includePanels:this.state.includePanels,deleted:this.state.deleted};(0,w.J$)(this.state.eventTrackingNamespace,l),this.lastQuery=this.getSearchQuery(),this.setState({loading:!0});const D=(0,K.S)(),q=Date.now();(this.state.starred?D.starred(this.lastQuery):D.search(this.lastQuery)).then(ae=>{q>this.lastSearchTimestamp&&(this.setState({result:ae,loading:!1}),this.lastSearchTimestamp=q)}).catch(ae=>{(0,w.KZ)(this.state.eventTrackingNamespace,{...l,error:ae?.message}),this.setState({loading:!1})})}}let Q;function X(){if(!Q){const l=localStorage.getItem(r.YU)??_.layout;let D=N.A.getBool(r.d7,!0);D&&(D=!1),Q=new W({..._,layout:l,includePanels:D})}return Q}function g(){const V=X();return[V.useState(),V]}},77123:(ve,ee,t)=>{t.r(ee),t.d(ee,{default:()=>Ps});var e=t(74848),h=t(22803),i=t(96540),A=t(54148),N=t(70713),r=t(92745),w=t(27489),K=t(43173),C=t(63142),G=t(41654),_=t(66404),j=t(45861),te=t(12737),W=t(98970),Q=t(13791),X=t(65642),g=t(52763),V=t(82151),l=t(15130),D=t(75735),q=t(66198),oe=t(79205),ae=t(96727);function R({queryParams:s}){const o=K.$.featureToggles.provisioning,{prURL:c,newPrURL:d,repoURL:n}=(0,ae.H)();return!o||"kiosk"in s?null:c?(0,e.jsx)(oe.G,{prParam:c}):d?(0,e.jsx)(oe.G,{prParam:d,isNewPr:!0}):n?(0,e.jsx)(oe.G,{repoUrl:n,behindBranch:!0}):null}var U=t(55266),H=t(75793);function F(s=!1){return s?(0,r.t)("search.search-input.include-panels-placeholder","Search for dashboards, folders, and panels"):(0,r.t)("search.search-input.placeholder","Search for dashboards and folders")}function z(){return(0,r.t)("search.dashboard-actions.new-dashboard","New dashboard")}function $(){return(0,r.t)("search.dashboard-actions.new-folder","New folder")}function ne(){return(0,r.t)("search.dashboard-actions.import","Import")}function re(){return(0,r.t)("search.dashboard-actions.new","New")}var le=t(8207),se=t(45229),k=t(49785),ie=t(32899),ge=t(75234),Ae=t(31286),Ne=t(78059),me=t(62963),Ke=t(15983),We=t(99090),Te=t(29189),De=t(83793),$e=t(78034),be=t(27321),we=t(45942),he=t(80231);function Ie(s){const o=K.$.featureToggles.provisioning,c=(0,he.V6)(),d=(0,g.d4)(he.ku)?.items??[],n=(0,be.F)(),{data:a}=(0,De.F9)(o?void 0:Te.hT),u=b=>{if(!(!a?.items||b==="non_provisioned"))return a.items.find(O=>O.name===b)},v=b=>{const O=(0,$e.R)(d,c,b);return O?(0,we.Ym)(O,d,c):"non_provisioned"},m=[...Object.keys(s.folder||{}).filter(b=>s.folder[b]),...Object.keys(s.dashboard||{}).filter(b=>s.dashboard[b])].map(v).filter(b=>!!b),P=m.length>0?m[0]:void 0,f=new Set(m).size>1;return{selectedItemsRepoUID:P,isInLockedRepo:b=>n?!0:!P||v(b)===P,isCrossRepo:f,isUidInReadOnlyRepo:b=>{const O=u(v(b));return O?(0,we.li)(O):!1}}}var Me=t(96733),Be=t(65411),Ee=t(76701),ke=t(43385),lt=t(85618);function ze(){const[s,{isLoading:o}]=(0,De.bS)();return{createBulkJob:async(d,n)=>{try{const a=await s({name:d.name,jobSpec:n}).unwrap();return{success:!0,jobId:a.metadata?.name,job:a}}catch(a){return{success:!1,error:(0,lt.PE)(a)}}},isLoading:o}}function dt({initialValues:s,selectedItems:o,repository:c,workflowOptions:d,onDismiss:n}){const[a,u]=(0,i.useState)(),[v,p]=(0,i.useState)(!1),{createBulkJob:m,isLoading:P}=ze(),f=(0,k.mN)({defaultValues:s}),{handleSubmit:M,watch:B}=f,b=B("workflow"),O=async Y=>{p(!0);const I=(0,me.aY)(o),E={action:"delete",delete:{ref:Y.workflow==="write"?void 0:Y.ref,resources:I}},y=await m(c,E);y.success&&y.job?u(y.job):!y.success&&y.error&&((0,ge.J7)().publish({type:ie.r1.alertError.name,payload:[(0,r.t)("browse-dashboards.bulk-delete-resources-form.error-deleting-resources","Error deleting resources"),y.error]}),p(!1))},J=P||a?.status?.state==="working"||a?.status?.state==="pending"||v;return(0,e.jsx)(k.Op,{...f,children:(0,e.jsx)("form",{onSubmit:M(O),children:(0,e.jsxs)(G.B,{direction:"column",gap:2,children:[(0,e.jsxs)(Ae.a,{paddingBottom:2,children:[(0,e.jsx)(r.x6,{i18nKey:"browse-dashboards.bulk-delete-resources-form.delete-warning",children:"This will delete selected folders and their descendants. In total, this will affect:"}),(0,e.jsx)(Ne.x,{selectedItems:{...o,panel:{},$all:!1}})]}),v&&a?(0,e.jsx)(Ke.A,{watch:a,jobType:"delete"}):(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(Be.x,{resourceType:"folder",isNew:!1,workflow:b,workflowOptions:d,repository:c,hidePath:!0}),(0,e.jsxs)(G.B,{gap:2,children:[(0,e.jsx)(j.$n,{variant:"secondary",fill:"outline",onClick:n,disabled:P,children:(0,e.jsx)(r.x6,{i18nKey:"browse-dashboards.bulk-delete-resources-form.button-cancel",children:"Cancel"})}),(0,e.jsx)(j.$n,{type:"submit",disabled:J,variant:"destructive",children:a?.status?.state==="working"||a?.status?.state==="pending"?(0,r.t)("browse-dashboards.bulk-delete-resources-form.button-deleting","Deleting..."):(0,r.t)("browse-dashboards.bulk-delete-resources-form.button-delete","Delete")})]})]})]})})})}function ct({folderUid:s,selectedItems:o,onDismiss:c}){const d=!s||s===We.TF,{selectedItemsRepoUID:n}=Ie(o),{repository:a,isReadOnlyRepo:u}=(0,U.T)({folderName:d?n:s}),v=(0,Ee.a)(a),m={comment:"",ref:`bulk-delete/${(0,ke.g)()}`,workflow:(0,Ee.r)(a)};return!a||u?(0,e.jsx)(Me.t,{noRepository:!a,isReadOnlyRepo:u}):(0,e.jsx)(dt,{selectedItems:o,onDismiss:c,initialValues:m,repository:a,workflowOptions:v})}var Oe=t(37386),ut=t(87161),ht=t(51552),ft=t(94626),gt=t(76466);function vt({initialValues:s,selectedItems:o,repository:c,workflowOptions:d,onDismiss:n}){const[a,u]=(0,i.useState)(),[v,p]=(0,i.useState)(void 0),[m,P]=(0,i.useState)(!1),{createBulkJob:f,isLoading:M}=ze(),B=(0,k.mN)({defaultValues:s}),{handleSubmit:b,watch:O,setError:J,clearErrors:Y,formState:{errors:I}}=B,E=O("workflow"),{data:y}=(0,ut.kH)(v?{name:v}:Te.hT),S=()=>{const T=(0,gt.EM)({targetFolderUID:v,targetFolder:y,repoName:c.name}),x=(0,me.aY)(o);return{targetFolderPathInRepo:T,resources:x}},L=async T=>{P(!0);const{targetFolderPathInRepo:x,resources:Z}=S();if(!x){J("targetFolderUID",{type:"manual",message:(0,r.t)("browse-dashboards.bulk-move-resources-form.error-no-target-folder-path","Target folder path is invalid or empty, please select again.")}),P(!1);return}const ue={action:"move",move:{ref:T.workflow==="write"?void 0:T.ref,targetPath:x,resources:Z}},ce=await f(c,ue);ce.success&&ce.job?u(ce.job):!ce.success&&ce.error&&((0,ge.J7)().publish({type:ie.r1.alertError.name,payload:[(0,r.t)("browse-dashboards.bulk-move-resources-form.error-moving-resources","Error moving resources"),ce.error]}),P(!1))};return(0,e.jsx)(k.Op,{...B,children:(0,e.jsx)("form",{onSubmit:b(L),children:(0,e.jsxs)(G.B,{direction:"column",gap:2,children:[(0,e.jsx)(ht.o,{}),(0,e.jsxs)(Ae.a,{paddingBottom:2,children:[(0,e.jsx)(r.x6,{i18nKey:"browse-dashboards.bulk-move-resources-form.move-total",children:"In total, this will affect:"}),(0,e.jsx)(Ne.x,{selectedItems:{...o,panel:{},$all:!1}})]}),m&&a?(0,e.jsx)(Ke.A,{watch:a,jobType:"move"}):(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(Oe.D,{noMargin:!0,label:(0,r.t)("browse-dashboards.bulk-move-resources-form.target-folder","Target Folder"),error:I.targetFolderUID?.message,invalid:!!I.targetFolderUID,children:(0,e.jsx)(ft.a,{value:v,onChange:T=>{p(T||""),Y("targetFolderUID")},repositoryName:c.name})}),(0,e.jsx)(Be.x,{resourceType:"folder",isNew:!1,workflow:E,workflowOptions:d,repository:c,hidePath:!0}),(0,e.jsxs)(G.B,{gap:2,children:[(0,e.jsx)(j.$n,{variant:"secondary",fill:"outline",onClick:n,disabled:M,children:(0,e.jsx)(r.x6,{i18nKey:"browse-dashboards.bulk-move-resources-form.button-cancel",children:"Cancel"})}),(0,e.jsx)(j.$n,{type:"submit",disabled:!!a||M||m||v===void 0,children:M?(0,r.t)("browse-dashboards.bulk-move-resources-form.button-moving","Moving..."):(0,r.t)("browse-dashboards.bulk-move-resources-form.button-move","Move")})]})]})]})})})}function mt({folderUid:s,selectedItems:o,onDismiss:c}){const d=!s||s===We.TF,{selectedItemsRepoUID:n}=Ie(o),{repository:a,folder:u,isReadOnlyRepo:v}=(0,U.T)({folderName:d?n:s}),p=(0,Ee.a)(a),m=u?.metadata?.annotations?.[D.Y_]||"",f={comment:"",ref:`bulk-move/${(0,ke.g)()}`,workflow:(0,Ee.r)(a)};return!a||v?(0,e.jsx)(Me.t,{noRepository:!a,isReadOnlyRepo:v}):(0,e.jsx)(vt,{selectedItems:o,onDismiss:c,initialValues:f,repository:a,workflowOptions:p,folderPath:d?"/":m})}var pt=t(54115),bt=t(68528),yt=t(13956);function xt(s,o){const c=(0,g.d4)(I=>I.browseDashboards),d=(0,be.F)(),[,n]=(0,H.ET)(),a=n.hasSearchFilters(),u=K.$.featureToggles.provisioning,[v,p]=(0,i.useState)({hasProvisioned:!1,hasNonProvisioned:!1}),[m,P]=(0,i.useState)({}),[f,M]=(0,i.useState)({}),B=(0,i.useMemo)(()=>new pt.ws({group:"folder.grafana.app",version:"v1beta1",resource:"folders"}),[]),b=(0,i.useCallback)(I=>{const E=(0,$e.R)(c.rootItems?.items||[],c.childrenByParentUID,I);return E?{parentUID:E.parentUID,managedBy:E.managedBy}:void 0},[c]),O=(0,i.useCallback)(async I=>{if(m[I]!==void 0)return m[I];try{const S=(await B.get(I)).metadata?.annotations?.[D.LH]===D.Sf.Repo;return P(L=>({...L,[I]:S})),S}catch{return!1}},[m,B]),J=(0,i.useCallback)(async I=>{if(f[I]!==void 0)return f[I];try{const E=await(0,yt.n)().getDashboardDTO(I),y=(0,bt.j)(E);return M(S=>({...S,[I]:y})),y}catch{return!1}},[f]),Y=(0,i.useCallback)(async(I,E)=>{if(a)return E?await O(I):await J(I);const y=b(I);return E?y?.managedBy===D.Sf.Repo:(y?.parentUID?b(y.parentUID):void 0)?.managedBy===D.Sf.Repo?!0:y?.managedBy===D.Sf.Repo},[a,O,J,b]);return(0,i.useEffect)(()=>{(async()=>{if(d||o){p({hasProvisioned:!0,hasNonProvisioned:!1});return}if(!u){p({hasProvisioned:!1,hasNonProvisioned:!0});return}const E=Object.keys(s.folder).filter(x=>s.folder[x]),y=Object.keys(s.dashboard).filter(x=>s.dashboard[x]);if(E.length===0&&y.length===0){p({hasProvisioned:!1,hasNonProvisioned:!1});return}let S=!1,L=!1;const T=[...E.map(x=>({uid:x,isFolder:!0})),...y.map(x=>({uid:x,isFolder:!1}))];for(const{uid:x,isFolder:Z}of T)if(await Y(x,Z)?S=!0:L=!0,S&&L)break;p({hasProvisioned:S,hasNonProvisioned:L})})()},[s,d,o,Y,u]),{hasProvisioned:v.hasProvisioned,hasNonProvisioned:v.hasNonProvisioned}}var Ce=t(87745),Ve=t(15203),ye=t(87186),jt=t(72472),St=t(65542),Pt=t(22787);const He=({onDismiss:s})=>{const o=(0,C.of)(Dt);return(0,e.jsx)(Pt.a,{title:(0,r.t)("browse-dashboards.action.selected-mix-resources-modal-title","Mixed resource types selected"),isOpen:!0,onDismiss:s,className:o.modal,children:(0,e.jsx)(r.x6,{i18nKey:"browse-dashboards.action.selected-mix-resources-modal-text",children:"You have selected both provisioned and non-provisioned resources. These cannot be processed together. Please select only provisioned resources or only non-provisioned resources and try again."})})},Dt=()=>({modal:(0,h.css)({label:"RowOptionsModal",width:"500px"})});function wt({folderDTO:s}){const[o,c]=(0,i.useState)(!1),[d,n]=(0,i.useState)(!1),a=(0,g.wA)(),u=(0,he.xK)(),[v]=(0,Ve.vd)(),p=(0,W.VQ)(),[m]=(0,W.Fv)(),[P]=(0,Ve.lv)(),[,f]=(0,H.ET)(),M=K.$.featureToggles.provisioning,{hasProvisioned:B,hasNonProvisioned:b}=xt(u,s?.managedBy===D.Sf.Repo),O=f.hasSearchFilters(),J=()=>{a((0,ye.cT)({isSelected:!1,folderUID:void 0})),O&&f.doSearchWithDebounce()},Y=async()=>{const L=Object.keys(u.dashboard).filter(x=>u.dashboard[x]),T=Object.keys(u.folder).filter(x=>u.folder[x]);await v({dashboardUIDs:L}),await p({folderUIDs:T}),Je("delete",u),J()},I=async L=>{const T=Object.keys(u.dashboard).filter(Z=>u.dashboard[Z]),x=Object.keys(u.folder).filter(Z=>u.folder[Z]);await m({folderUIDs:x,destinationUID:L}),await P({dashboardUIDs:T,destinationUID:L}),Je("move",u),J()},E=()=>{if(M&&B&&b){se.A.publish(new Ce.S8({component:He,props:{}}));return}if(M&&B){n(!0);return}se.A.publish(new Ce.S8({component:St.J,props:{selectedItems:u,onConfirm:I}}))},y=()=>{B&&b&&M?se.A.publish(new Ce.S8({component:He,props:{}})):B&&M?c(!0):se.A.publish(new Ce.S8({component:jt.T,props:{selectedItems:u,onConfirm:Y}}))},S=(0,e.jsx)(j.$n,{onClick:E,variant:"secondary",children:(0,e.jsx)(r.x6,{i18nKey:"browse-dashboards.action.move-button",children:"Move"})});return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsxs)(G.B,{gap:1,"data-testid":"manage-actions",children:[S,(0,e.jsx)(j.$n,{onClick:y,variant:"destructive",children:(0,e.jsx)(r.x6,{i18nKey:"browse-dashboards.action.delete-button",children:"Delete"})})]}),o&&(0,e.jsx)(le._,{title:(0,r.t)("browse-dashboards.action.bulk-delete-provisioned-resources","Bulk Delete Provisioned Resources"),onClose:()=>c(!1),size:"md",children:(0,e.jsx)(ct,{selectedItems:u,folderUid:s?.uid||"",onDismiss:()=>{c(!1)}})}),d&&(0,e.jsx)(le._,{title:(0,r.t)("browse-dashboards.action.bulk-move-provisioned-resources","Bulk Move Provisioned Resources"),onClose:()=>n(!1),size:"md",children:(0,e.jsx)(mt,{selectedItems:u,folderUid:s?.uid,onDismiss:()=>{n(!1)}})})]})}const Et={move:"grafana_manage_dashboards_item_moved",delete:"grafana_manage_dashboards_item_deleted"};function Je(s,o){const c=Object.keys(o.dashboard).filter(n=>o.dashboard[n]),d=Object.keys(o.folder).filter(n=>o.folder[n]);(0,w.rR)(Et[s],{item_counts:{folder:d.length,dashboard:c.length},source:"tree_actions",restore_enabled:!!K.$.featureToggles.restoreDashboards})}var Ct=t(63498),Qe=t(55860);function Rt(){const[s,o]=(0,H.ET)();return(0,e.jsx)(Ct.bj,{showStarredFilter:!0,showLayout:!0,state:s,getTagOptions:o.getTagOptions,getSortOptions:(0,Qe.S)().getSortOptions,sortPlaceholder:(0,Qe.S)().sortPlaceholder,onLayoutChange:o.onLayoutChange,onStarredFilterChange:o.onStarredFilterChange,onSortChange:o.onSortChange,onTagFilterChange:o.onTagFilterChange,onDatasourceChange:o.onDatasourceChange,onPanelTypeChange:o.onPanelTypeChange,onSetIncludePanels:o.onSetIncludePanels})}var Tt=t(90382),It=t(50201),Mt=t(89640),Bt=t(43951),Ot=t(73427),Lt=t(27044),Ut=t(44220),de=(s=>(s[s.Unselected=0]="Unselected",s[s.Selected=1]="Selected",s[s.Mixed=2]="Mixed",s))(de||{}),Ft=t(32885),At=t(91793),Nt=t(10022),Kt=t(28105),xe=t(51898),je=t(32635),Ge=t(45967);function Wt({row:{original:s},isSelected:o,onItemSelectionChange:c,permissions:d}){const n=s.item,a=(0,g.d4)(f=>f.browseDashboards.selectedItems),{selectedItemsRepoUID:u,isInLockedRepo:v,isUidInReadOnlyRepo:p}=Ie(a),m=(0,be.F)();if(!o)return(0,e.jsx)(Se,{});if(n.kind==="ui")return n.uiKind==="pagination-placeholder"?(0,e.jsx)(je.S,{disabled:!0,value:!1}):(0,e.jsx)(Se,{});if((0,me.I2)(n.uid))return(0,e.jsx)(Se,{});if(!m&&n.managedBy===D.Sf.Repo&&!n.parentUID)return(0,e.jsx)(Se,{});if(d&&d.isReadOnlyRepo||p(n.uid))return(0,e.jsx)(Ge.m,{content:(0,we.Te)({}),children:(0,e.jsx)("span",{children:(0,e.jsx)(je.S,{disabled:!0,value:!1})})});if(d&&!(0,me.Gf)(n.kind,d))return(0,e.jsx)(Se,{});if(u&&!v(n.uid))return(0,e.jsx)(Ge.m,{content:(0,r.t)("browse-dashboards.dashboards-tree.checkbox.disabled-not-in-same-repo","This item is not in the same repository as the selected items."),children:(0,e.jsx)("span",{children:(0,e.jsx)(je.S,{disabled:!0,value:!1})})});const P=o(n);return(0,e.jsx)(je.S,{"data-testid":xe.Tp.pages.BrowseDashboards.table.checkbox(n.uid),"aria-label":(0,r.t)("browse-dashboards.dashboards-tree.select-checkbox","Select"),value:P===de.Selected,indeterminate:P===de.Mixed,onChange:f=>c?.(n,f.currentTarget.checked)})}function Se(){const s=(0,C.of)($t);return(0,e.jsx)("span",{className:s.checkboxSpacer})}const $t=s=>({checkboxSpacer:(0,h.css)({paddingLeft:s.spacing(2)})});function kt({isSelected:s,onAllSelectionChange:o,permissions:c}){const d=s?.("$all")??de.Unselected,n=c?.isReadOnlyRepo;return(0,e.jsx)(je.S,{disabled:n,value:d===de.Selected,indeterminate:d===de.Mixed,"aria-label":(0,r.t)("browse-dashboards.dashboards-tree.select-all-header-checkbox","Select all"),onChange:a=>{d===de.Mixed?o?.(!1):o?.(a.currentTarget.checked)}})}var zt=t(70255),Vt=t(76319),Ht=t(68079),Ye=t(30703),Jt=t(20941),Ze=t(58851),Qt=t(93854),Xe=t(90666);const Le="md",qe="sm";function Gt({row:{original:s},onFolderClick:o,treeID:c}){const d=(0,C.of)(Yt),{item:n,level:a,isOpen:u}=s,v=(0,he.V6)(),p=u&&!v[n.uid],m=(0,Qt.cu)(s.item,u);return n.kind==="ui"?(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(Xe.T,{level:a,spacing:{xs:1,md:3}}),(0,e.jsx)("span",{className:d.folderButtonSpacer}),n.uiKind==="empty-folder"?(0,e.jsx)("em",{className:d.emptyText,children:(0,e.jsx)(_.E,{variant:"body",color:"secondary",truncate:!0,children:(0,e.jsx)(r.x6,{i18nKey:"browse-dashboards.name-cell.no-items",children:"No items"})})}):(0,e.jsx)(zt.A,{width:200})]}):(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(Xe.T,{level:a,spacing:{xs:1,md:3}}),n.kind==="folder"?(0,e.jsx)(Vt.K,{size:Le,className:d.chevron,onClick:()=>{o(n.uid,!u)},name:u?"angle-down":"angle-right","aria-label":u?(0,r.t)("browse-dashboards.dashboards-tree.collapse-folder-button","Collapse folder {{title}}",{title:n.title}):(0,r.t)("browse-dashboards.dashboards-tree.expand-folder-button","Expand folder {{title}}",{title:n.title})}):(0,e.jsx)("span",{className:d.folderButtonSpacer}),(0,e.jsxs)("div",{className:d.iconNameContainer,children:[p?(0,e.jsx)(Ht.y,{size:qe}):(0,e.jsx)(Ye.I,{size:qe,name:m}),(0,e.jsx)(_.E,{variant:"body",truncate:!0,id:c&&(0,me.eM)(c,n),children:n.url?(0,e.jsx)(Jt.N,{onClick:()=>{(0,w.rR)("manage_dashboards_result_clicked")},href:n.url,className:d.link,children:n.title}):n.title}),(0,e.jsx)(V.b,{folder:n})]})]})}const Yt=s=>({chevron:(0,h.css)({marginRight:s.spacing(1),width:(0,Ze.cs)(Le)}),emptyText:(0,h.css)({overflow:"hidden"}),folderButtonSpacer:(0,h.css)({paddingLeft:`calc(${(0,Ze.cs)(Le)}px + ${s.spacing(1)})`}),iconNameContainer:(0,h.css)({alignItems:"center",display:"flex",gap:s.spacing(1),overflow:"hidden"}),link:(0,h.css)({"&:hover":{textDecoration:"underline"}})});var _e=t(37658);function Zt({row:{original:s}}){const o=(0,C.of)(Xt),c=s.item;return c.kind==="ui"?c.uiKind==="pagination-placeholder"?(0,e.jsx)(_e.L.Skeleton,{}):null:c.tags?(0,e.jsx)(_e.L,{className:o.tagList,tags:c.tags}):null}function Xt(s){return{tagList:(0,h.css)({justifyContent:"flex-start",flexWrap:"nowrap"})}}var qt=t(75044);const et=36,Ue=36,_t=0;function es({items:s,width:o,height:c,isSelected:d,onFolderClick:n,onAllSelectionChange:a,onItemSelectionChange:u,isItemLoaded:v,requestLoadMore:p,permissions:m}){const P=(0,i.useId)(),f=(0,i.useRef)(null),M=(0,i.useRef)(null),B=(0,C.of)(tt);(0,i.useEffect)(()=>{f.current&&f.current.resetloadMoreItemsCache(!0),M.current&&M.current.resetAfterIndex(0)},[s]);const b=(0,i.useMemo)(()=>{const T={id:"checkbox",width:0,Header:kt,Cell:Wt},x={id:"name",width:3,Header:(0,e.jsx)("span",{style:{paddingLeft:24},children:(0,e.jsx)(r.x6,{i18nKey:"browse-dashboards.dashboards-tree.name-column",children:"Name"})}),Cell:Pe=>(0,e.jsx)(Gt,{...Pe,onFolderClick:n})},Z={id:"tags",width:2,Header:(0,r.t)("browse-dashboards.dashboards-tree.tags-column","Tags"),Cell:Zt};return[(0,me.X2)(m)&&T,x,Z].filter(Kt.zz)},[n,m]),O=(0,Ft.useTable)({columns:b,data:s},qt.A),{getTableProps:J,getTableBodyProps:Y,headerGroups:I}=O,E=(0,i.useMemo)(()=>({table:O,isSelected:d,onAllSelectionChange:a,onItemSelectionChange:u,treeID:P,permissions:m}),[O,d,a,u,s,P,m]),y=(0,i.useCallback)(T=>v(T),[v]),S=(0,i.useCallback)((T,x)=>{const{parentUID:Z}=s[T];p(Z)},[p,s]),L=(0,i.useCallback)(T=>{const x=s[T];return x.item.kind==="ui"&&x.item.uiKind==="divider"?_t:Ue},[s]);return(0,e.jsxs)("div",{...J(),role:"table",children:[I.map(T=>{const{key:x,...Z}=T.getHeaderGroupProps({style:{width:o}});return(0,e.jsx)("div",{...Z,className:(0,h.cx)(B.row,B.headerRow),children:T.headers.map(ue=>{const{key:ce,...Pe}=ue.getHeaderProps();return(0,e.jsx)("div",{...Pe,role:"columnheader",className:B.cell,children:ue.render("Header",{isSelected:d,onAllSelectionChange:a,permissions:m})},ce)})},x)}),(0,e.jsx)("div",{...Y(),"data-testid":xe.Tp.pages.BrowseDashboards.table.body,children:(0,e.jsx)(Nt.A,{ref:f,itemCount:s.length,isItemLoaded:y,loadMoreItems:S,children:({onItemsRendered:T,ref:x})=>(0,e.jsx)(At._m,{ref:Z=>{x(Z),M.current=Z},height:c-et,width:o,itemCount:s.length,itemData:E,estimatedItemSize:Ue,itemSize:L,onItemsRendered:T,children:ts})})})]})}function ts({index:s,style:o,data:c}){const d=(0,C.of)(tt),{table:n,isSelected:a,onItemSelectionChange:u,treeID:v,permissions:p}=c,{rows:m,prepareRow:P}=n,f=m[s];P(f);const M=f.original.item,{key:B,...b}=f.getRowProps({style:o});return M.kind==="ui"&&M.uiKind==="divider"?(0,e.jsx)("div",{...b,children:(0,e.jsx)("hr",{className:d.divider})},B):(0,e.jsx)("div",{...b,className:(0,h.cx)(d.row,d.bodyRow),"aria-labelledby":(0,me.eM)(v,M),"data-testid":xe.Tp.pages.BrowseDashboards.table.row("title"in M?M.title:M.uid),children:f.cells.map(O=>{const{key:J,...Y}=O.getCellProps();return(0,e.jsx)("div",{...Y,className:d.cell,children:O.render("Cell",{isSelected:a,onItemSelectionChange:u,treeID:v,permissions:p})},J)})},B)}const tt=s=>({row:(0,h.css)({gap:s.spacing(1)}),divider:(0,h.css)({borderTop:`1px solid ${s.colors.border.weak}`,width:"100%",margin:0}),headerRow:(0,h.css)({backgroundColor:s.colors.background.secondary,height:et}),bodyRow:(0,h.css)({height:Ue,"&:hover":{backgroundColor:s.colors.action.hover}}),cell:(0,h.css)({padding:s.spacing(1),overflow:"hidden",display:"flex",alignItems:"center"}),link:(0,h.css)({"&:hover":{textDecoration:"underline"}})});function ss({folderUID:s,width:o,height:c,permissions:d}){const n=(0,he.eC)(s),a=(0,g.wA)(),u=(0,he.q0)(s),v=(0,he.Ms)(),p=(0,he.V6)(),m=(0,me.X2)(d),P=(0,be.F)(),f=K.$.featureToggles.provisioning,M=Ot.TP.user.orgRole===Tt.X.None,{data:B}=(0,De.F9)(!f||M?Te.hT:void 0),b=(0,g.d4)(he.ku),O=(0,i.useMemo)(()=>P||!f?[]:f?b?.items.length===1&&B?.items.length===1?[]:B?.items.map(S=>S.name):[],[P,B,f,b]),J=(0,i.useCallback)((S,L)=>{a((0,ye.wn)({folderUID:S,isOpen:L})),L&&a((0,Ut.Ii)({parentUID:S,pageSize:Lt.md}))},[a]),Y=(0,i.useCallback)((S,L)=>{a((0,ye.t$)({item:S,isSelected:L}))},[a]),I=(0,i.useCallback)(S=>{if(S==="$all"){if(v.$all)return de.Selected;for(const x of Object.values(v))if(typeof x!="boolean"){for(const Z in x)if(x[Z])return de.Mixed}return de.Unselected}return v[S.kind][S.uid]?de.Selected:st(S,p,v)?de.Mixed:de.Unselected},[v,p]),E=(0,i.useCallback)(S=>{const L=u[S];if(!L)return!1;const T=L.item;return!(T.kind==="ui"&&T.uiKind==="pagination-placeholder")},[u]),y=(0,he.Zg)();return n==="fulfilled"&&u.length===0?(0,e.jsx)("div",{style:{width:o},children:m?(0,e.jsx)(It.p,{variant:"call-to-action",button:(0,e.jsx)(j.z9,{href:s?`dashboard/new?folderUid=${s}`:"dashboard/new",icon:"plus",size:"lg",children:(0,e.jsx)(r.x6,{i18nKey:"browse-dashboards.empty-state.button-title",children:"Create dashboard"})}),message:s?(0,r.t)("browse-dashboards.empty-state.title-folder","This folder doesn't have any dashboards yet"):(0,r.t)("browse-dashboards.empty-state.title","You haven't created any dashboards yet"),children:s&&(0,e.jsxs)(r.x6,{i18nKey:"browse-dashboards.empty-state.pro-tip",children:["Add/move dashboards to your folder at"," ",(0,e.jsx)(Mt.Y,{external:!1,href:"/dashboards",children:"Browse dashboards"})]})}):(0,e.jsx)(Bt.c,{callToActionElement:(0,e.jsx)("span",{children:(0,e.jsx)(r.x6,{i18nKey:"browse-dashboards.browse-view.this-folder-is-empty",children:"This folder is empty"})})})}):(0,e.jsx)(es,{permissions:d,items:u,width:o,height:c,isSelected:I,onFolderClick:J,onAllSelectionChange:S=>a((0,ye.cT)({isSelected:S,folderUID:s,excludeUIDs:O})),onItemSelectionChange:Y,isItemLoaded:E,requestLoadMore:y})}function st(s,o,c){const d=o[s.uid];return d?d.items.some(n=>{const a=c[n.kind][n.uid];return a||st(n,o,c)}):!1}var rs=t(92138),os=t(36490),as=t(87063),Fe=t(94535),ns=t(88559),is=t(64762),rt=t(34999),ot=t(63527),ls=t(91555),ds=t(21840),cs=t(34621),us=t(49314);function hs({initialValues:s,repository:o,workflowOptions:c,folder:d,onDismiss:n}){const{prURL:a}=(0,ae.H)(),u=(0,A.Zp)(),[v,p]=(0,De.tj)(),m=(0,k.mN)({defaultValues:s,mode:"onBlur"}),{handleSubmit:P,watch:f,register:M,formState:B}=m,[b]=f(["workflow"]),O=({urls:E},y)=>{const S=E?.newPullRequestURL;if(S){const L=(0,us.q)({paramName:"new_pull_request_url",paramValue:S,repoType:y.repoType});u(L)}},J=E=>{if(E?.metadata?.name){u(`/dashboards/f/${E.metadata.name}/`);return}if(o?.name&&p.data?.path){let y=`${ls.mL}/${o.name}/file/${p.data.path}`;p.data.ref?.length&&(y+="?ref="+p.data.ref),u(y)}},Y=E=>{(0,ge.J7)().publish({type:ie.r1.alertError.name,payload:[(0,r.t)("browse-dashboards.new-provisioned-folder-form.alert-error-creating-folder","Error creating folder"),E]})};(0,cs.J)({folderUID:d?.metadata.name,request:p,workflow:b,repository:o,resourceType:"folder",handlers:{onDismiss:n,onBranchSuccess:O,onWriteSuccess:(E,y)=>J(y),onError:Y}});const I=async({ref:E,title:y,workflow:S,comment:L})=>{const T=o?.name;if(!y||!T)return;const x=d?.metadata?.annotations?.[D.Y_]??"",ue=`${x?`${x}/`:""}${y}/`,ce={title:y,type:"folder"};S==="write"&&(E=void 0),v({ref:E,name:T,path:ue,message:L||`Create folder: ${y}`,body:ce})};return(0,e.jsx)(k.Op,{...m,children:(0,e.jsx)("form",{onSubmit:P(I),children:(0,e.jsxs)(G.B,{direction:"column",gap:2,children:[!o?.workflows?.length&&(0,e.jsx)(rt.F,{title:(0,r.t)("browse-dashboards.new-provisioned-folder-form.title-this-repository-is-read-only","This repository is read only"),children:(0,e.jsx)(r.x6,{i18nKey:"browse-dashboards.text-this-repository-is-read-only",children:"If you have direct access to the target, copy the JSON and paste it there."})}),(0,e.jsx)(Oe.D,{noMargin:!0,label:(0,r.t)("browse-dashboards.new-provisioned-folder-form.label-folder-name","Folder name"),invalid:!!B?.errors.title,error:B?.errors.title?.message,children:(0,e.jsx)(ot.p,{...M("title",{required:(0,r.t)("browse-dashboards.new-provisioned-folder-form.error-required","Folder name is required"),validate:gs}),placeholder:(0,r.t)("browse-dashboards.new-provisioned-folder-form.folder-name-input-placeholder-enter-folder-name","Enter folder name"),id:"folder-name-input"})}),(0,e.jsx)(Be.x,{resourceType:"folder",isNew:!0,workflow:b,workflowOptions:c,repository:o,hidePath:!0}),a&&(0,e.jsxs)(rt.F,{severity:"info",title:(0,r.t)("browse-dashboards.new-provisioned-folder-form.title-pull-request-created","Pull request created"),children:[(0,e.jsx)(r.x6,{i18nKey:"browse-dashboards.new-provisioned-folder-form.text-pull-request-created",children:"A pull request has been created with changes to this folder:"})," ",(0,e.jsx)("a",{href:a,target:"_blank",rel:"noopener noreferrer",children:a})]}),(0,e.jsxs)(G.B,{gap:2,children:[(0,e.jsx)(j.$n,{variant:"secondary",fill:"outline",onClick:n,children:(0,e.jsx)(r.x6,{i18nKey:"browse-dashboards.new-provisioned-folder-form.cancel",children:"Cancel"})}),(0,e.jsx)(j.$n,{type:"submit",disabled:p.isLoading||!!B?.errors.title,children:p.isLoading?(0,r.t)("browse-dashboards.new-provisioned-folder-form.button-creating","Creating..."):(0,r.t)("browse-dashboards.new-provisioned-folder-form.button-create","Create")})]})]})})})}function fs({parentFolder:s,onDismiss:o}){const{workflowOptions:c,repository:d,folder:n,initialValues:a,isReadOnlyRepo:u}=(0,ds.Y)({folderUid:s?.uid,title:""});return u||!a?(0,e.jsx)(Me.t,{noRepository:!a,isReadOnlyRepo:u,readOnlyMessage:(0,r.t)("browse-dashboards.new-folder.read-only-message","To create this folder, please add the resource in your repository directly.")}):(0,e.jsx)(hs,{parentFolder:s,onDismiss:o,initialValues:a,repository:d,workflowOptions:c,folder:n})}function gs(s){return!s||typeof s!="string"?(0,r.t)("browse-dashboards.new-provisioned-folder-form.error-required","Folder name is required"):/[^a-zA-Z0-9 _-]/.test(s)?(0,r.t)("browse-dashboards.new-provisioned-folder-form.error-invalid-characters","Folder name contains invalid characters. Only letters, numbers, spaces, underscores, and hyphens are allowed."):!0}var vs=t(89223);const at={folderName:""};function ms({onCancel:s,onConfirm:o,parentFolder:c}){const{handleSubmit:d,register:n,formState:{errors:a,isSubmitting:u}}=(0,k.mN)({defaultValues:at}),v=(0,r.t)("browse-dashboards.action.new-folder-name-required-phrase","Folder name is required."),p=(0,r.t)("browse-dashboards.new-folder-form.name-label","Folder name");return(0,e.jsxs)("form",{name:"addFolder",onSubmit:d(m=>o(m.folderName)),"data-testid":xe.Tp.pages.BrowseDashboards.NewFolderForm.form,children:[(0,e.jsx)(Oe.D,{label:p,invalid:!!a.folderName,error:a.folderName&&a.folderName.message,children:(0,e.jsx)(ot.p,{"data-testid":xe.Tp.pages.BrowseDashboards.NewFolderForm.nameInput,id:"folder-name-input",defaultValue:at.folderName,...n("folderName",{required:v,validate:async m=>await ps(m,c?.uid)})})}),(0,e.jsxs)(G.B,{children:[(0,e.jsx)(j.$n,{variant:"secondary",fill:"outline",onClick:s,children:(0,e.jsx)(r.x6,{i18nKey:"browse-dashboards.new-folder-form.cancel-label",children:"Cancel"})}),(0,e.jsx)(j.$n,{type:"submit",disabled:u,children:(0,e.jsx)(r.x6,{i18nKey:"browse-dashboards.new-folder-form.create-label",children:"Create"})})]})]})}async function ps(s,o){try{return await vs.P.validateNewFolderName(s,o),!0}catch(c){if(c instanceof Error)return c.message;throw c}}function bs({parentFolder:s,canCreateDashboard:o,canCreateFolder:c,isReadOnlyRepo:d,repoType:n}){const[a,u]=(0,i.useState)(!1),v=(0,A.zy)(),[p]=(0,W.Si)(),[m,P]=(0,i.useState)(!1),f=(0,is._2)(),M=(0,be.F)(),B=async O=>{try{const J=await p({title:O,parentUid:s?.uid}),Y=s?(s.parents?.length||0)+1:0;(0,w.rR)("grafana_manage_dashboards_folder_created",{is_subfolder:!!s?.uid,folder_depth:Y}),J.error?f.error("Failed to create folder"):f.success("Folder created"),J.data&&os.Ny.push(rs.I.stripBaseFromUrl(J.data.url))}finally{P(!1)}},b=(0,e.jsxs)(as.W,{children:[o&&(0,e.jsx)(Fe.D,{label:z(),onClick:()=>(0,w.rR)("grafana_menu_item_clicked",{url:Re("/dashboard/new",s?.uid),from:v.pathname}),url:Re("/dashboard/new",s?.uid)}),c&&(0,e.jsx)(Fe.D,{onClick:()=>P(!0),label:$()}),o&&(0,e.jsx)(Fe.D,{label:ne(),onClick:()=>(0,w.rR)("grafana_menu_item_clicked",{url:Re("/dashboard/import",s?.uid),from:v.pathname}),url:Re("/dashboard/import",s?.uid)})]});return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(ns.m,{overlay:b,onVisibleChange:u,children:(0,e.jsxs)(j.$n,{disabled:d,tooltip:d?(0,we.Te)({isLocal:n==="local"}):void 0,variant:"secondary",children:[re(),(0,e.jsx)(Ye.I,{name:a?"angle-up":"angle-down"})]})}),m&&(0,e.jsx)(le._,{title:$(),subtitle:s?.title?`Location: ${s.title}`:void 0,onClose:()=>P(!1),size:"sm",children:s?.managedBy===D.Sf.Repo||M?(0,e.jsx)(fs,{onDismiss:()=>P(!1),parentFolder:s}):(0,e.jsx)(ms,{onConfirm:B,onCancel:()=>P(!1),parentFolder:s})})]})}function Re(s,o){const c=o?s+"?folderUid="+o:s;return K.$.appSubUrl?K.$.appSubUrl+c:c}var ys=t(43003),xs=t(85643),js=t(83485);const nt=(0,i.memo)(({queryParams:s})=>{const{uid:o}=(0,A.g)(),c=(0,g.wA)(),d=(0,C.of)(Ss),[n,a]=(0,H.ET)(),u=a.hasSearchFilters(),v=(0,A.zy)(),p=(0,i.useMemo)(()=>new URLSearchParams(v.search),[v.search]),{isReadOnlyRepo:m,repoType:P}=(0,U.T)({folderName:o});(0,i.useEffect)(()=>{a.initStateFromUrl(o),c((0,ye.cT)({isSelected:!1,folderUID:void 0}))},[c,o,a]),(0,i.useEffect)(()=>{a.onSetStarred(p.has("starred"))},[p,a]),(0,i.useEffect)(()=>{!u&&n.result&&a.setState({result:void 0,includePanels:void 0}),u&&n.result?.totalRows===0&&(0,w.rR)("grafana_empty_state_shown",{source:"browse_dashboards"})},[u,n.result,a]);const{data:f}=(0,W.u$)(o),[M]=(0,W.HP)(),B=(0,i.useMemo)(()=>{if(!f)return;const fe=(0,q.R4)(f),pe=(0,q.Cg)(f.uid),it=fe.children?.find(ws=>ws.id===pe);return it&&(it.active=!0),fe},[f]),b=(0,he.QE)(),{data:O}=(0,W.u$)(f?void 0:"general"),J=f??O,{canEditFolders:Y,canDeleteFolders:I,canDeleteDashboards:E,canEditDashboards:y,canCreateDashboards:S,canCreateFolders:L}=(0,js.N)(J),T=l.TP.hasRole("Admin")||l.TP.isGrafanaAdmin,x=J?.managedBy===D.Sf.Repo,Z=Y&&o&&!x,ue={canEditFolders:Y,canEditDashboards:y,canDeleteFolders:I,canDeleteDashboards:E,isReadOnlyRepo:m},ce=async fe=>{if(f){const pe=await M({...f,title:fe});if("error"in pe)throw(0,w.rR)("grafana_browse_dashboards_page_edit_folder_name",{status:"failed_with_error"}),pe.error;(0,w.rR)("grafana_browse_dashboards_page_edit_folder_name",{status:"success"})}else(0,w.rR)("grafana_browse_dashboards_page_edit_folder_name",{status:"failed_no_folderDTO"})},Pe=()=>{(0,w.rR)("grafana_browse_dashboards_page_button_to_recently_deleted",{origin:window.location.pathname===(0,X.zj)().appSubUrl+"/dashboards"?"Dashboards":"Folder view"})},Ds=fe=>(0,e.jsxs)(G.B,{alignItems:"center",gap:2,children:[(0,e.jsx)(_.E,{element:"h1",children:fe})," ",(0,e.jsx)(V.b,{folder:J})]});return(0,e.jsx)(Q.Y,{navId:"dashboards/browse",pageNav:B,onEditTitle:Z?ce:void 0,renderTitle:Ds,actions:(0,e.jsxs)(e.Fragment,{children:[K.$.featureToggles.restoreDashboards&&T&&(0,e.jsx)(j.z9,{variant:"secondary",href:(0,X.zj)().appSubUrl+"/dashboard/recently-deleted",onClick:Pe,children:(0,e.jsx)(r.x6,{i18nKey:"browse-dashboards.actions.button-to-recently-deleted",children:"Recently deleted"})}),f&&(0,e.jsx)(ys.m,{folder:f,repoType:P,isReadOnlyRepo:m}),(S||L)&&(0,e.jsx)(bs,{parentFolder:f,canCreateDashboard:S,canCreateFolder:L,repoType:P,isReadOnlyRepo:m})]}),children:(0,e.jsxs)(Q.Y.Contents,{className:d.pageContents,children:[(0,e.jsx)(R,{queryParams:s}),(0,e.jsx)("div",{children:(0,e.jsx)(te.Z,{placeholder:F(n.includePanels),value:n.query,escapeRegex:!1,onChange:fe=>a.onQueryChange(fe)})}),b?(0,e.jsx)(wt,{folderDTO:f}):(0,e.jsx)("div",{className:d.filters,children:(0,e.jsx)(Rt,{})}),(0,e.jsx)("div",{className:d.subView,children:(0,e.jsx)(N.Ay,{children:({width:fe,height:pe})=>u?(0,e.jsx)(xs.Q,{permissions:ue,width:fe,height:pe,searchState:n,searchStateManager:a}):(0,e.jsx)(ss,{permissions:ue,width:fe,height:pe,folderUID:o})})})]})})}),Ss=s=>({pageContents:(0,h.css)({display:"flex",flexDirection:"column",gap:s.spacing(1),height:"100%"}),subView:(0,h.css)({height:"100%"}),filters:(0,h.css)({display:"none",[s.breakpoints.up("md")]:{display:"block"}})});nt.displayName="BrowseDashboardsPage";const Ps=nt},79205:(ve,ee,t)=>{t.d(ee,{G:()=>G});var e=t(74848),h=t(63704),i=t(92745),A=t(34999),N=t(41654),r=t(30703);const w={github:"GitHub",gitlab:"GitLab",bitbucket:"Bitbucket",git:"Git",local:"Local"};var K=t(96727),C=t(72017);function G({prParam:j,isNewPr:te,behindBranch:W,repoUrl:Q}){const{repoType:X}=(0,K.H)(),g=_(X)?w[X]:"repository",V=te?(0,i.t)("provisioned-resource-preview-banner.title-created-branch-in-repo","A new resource has been created in a branch in {{repoType}}.",{repoType:g}):(0,i.t)("provisioned-resource-preview-banner.title-loaded-pull-request-in-repo","This resource is loaded from the branch you just created in {{repoType}} and it is only visible to you",{repoType:g});return W?(0,e.jsx)(A.F,{...C.s,buttonContent:(0,e.jsxs)(N.B,{alignItems:"center",children:[(0,i.t)("provisioned-resource-preview-banner.preview-banner.open-in-repo-button","Open in {{repoType}}",{repoType:g}),(0,e.jsx)(r.I,{name:"external-link-alt"})]}),title:(0,i.t)("provisioned-resource-preview-banner.preview-banner.behind-branch-text","This resource is behind the branch in {{repoType}}.",{repoType:g}),onRemove:Q?()=>window.open(h.sQ.sanitizeUrl(Q),"_blank"):void 0,children:(0,e.jsxs)(i.x6,{i18nKey:"provisioned-resource-preview-banner.preview-banner.view-in-repo-button",values:{repoType:g},children:["View it in ",{repoType:X}," to see the latest changes."]})}):(0,e.jsx)(A.F,{...C.s,title:V,buttonContent:(0,e.jsxs)(N.B,{alignItems:"center",children:[te?(0,i.t)("provisioned-resource-preview-banner.preview-banner.open-pull-request-in-repo","Open pull request in {{repoType}}",{repoType:g}):(0,i.t)("provisioned-resource-preview-banner.preview-banner.view-pull-request-in-repo","View pull request in {{repoType}}",{repoType:g}),(0,e.jsx)(r.I,{name:"external-link-alt"})]}),onRemove:j?()=>window.open(h.sQ.sanitizeUrl(j),"_blank"):void 0,children:(0,e.jsx)(i.x6,{i18nKey:"provisioned-resource-preview-banner.preview-banner.not-saved",children:"The rest of Grafana users in your organization will still see the current version saved to configured default branch until this branch is merged"})})}function _(j){return typeof j!="string"?!1:j in w}},85643:(ve,ee,t)=>{t.d(ee,{Q:()=>X});var e=t(74848),h=t(96540),i=t(88673),A=t(41119),N=t(92745),r=t(50201),w=t(45861),K=t(5478),C=t(86436),G=t(52763),_=t(80231),j=t(87186),te=t(62963);const W=25,Q={view:new i.R((0,A.Vc)({fields:[{name:"uid",display:!0,values:Array(W).fill(null)},{name:"kind",display:!0,values:Array(W).fill("dashboard")},{name:"name",display:!0,values:Array(W).fill("")},{name:"location",display:!0,values:Array(W).fill("")},{name:"tags",display:!0,values:Array(W).fill([])}],meta:{custom:{locationInfo:[]}}})),loadMoreItems:()=>Promise.resolve(),isItemLoaded:()=>!1,totalRows:W};function X({width:V,height:l,permissions:D,searchState:q,searchStateManager:oe,emptyState:ae}){const R=(0,G.wA)(),U=(0,G.d4)(k=>k.browseDashboards.selectedItems),H=(0,_.QE)(),{keyboardEvents:F}=(0,K.d)(),z=q.result??Q,$=(0,h.useCallback)((k,ie)=>!k||!(0,te.Gf)(k,D)?!1:k==="*"&&ie==="*"?H:k==="*"?!1:U[g(k)][ie]??!1,[U,H,D]),ne=(0,h.useCallback)(()=>{R((0,j.cT)({isSelected:!1,folderUID:void 0}))},[R]),re=(0,h.useCallback)((k,ie)=>{if(!(0,te.Gf)(k,D))return;const ge=!$(k,ie);R((0,j.t$)({item:{kind:g(k),uid:ie},isSelected:ge}))},[$,R,D]);if(z.totalRows===0){const k=ae??(0,e.jsx)(r.p,{button:(0,e.jsx)(w.$n,{variant:"secondary",onClick:oe.onClearSearchAndFilters,children:(0,e.jsx)(N.x6,{i18nKey:"browse-dashboards.no-results.clear",children:"Clear search and filters"})}),message:(0,N.t)("browse-dashboards.no-results.text","No results found for your query"),variant:"not-found",role:"alert"});return(0,e.jsx)("div",{style:{width:V},children:k})}const le=(0,te.X2)(D),se={response:z,selection:le?$:void 0,selectionToggle:le?re:void 0,clearSelection:ne,width:V,height:l,onTagSelected:oe.onAddTag,keyboardEvents:F,onDatasourceChange:q.datasource?oe.onDatasourceChange:void 0,onClickItem:oe.onSearchItemClicked};return(0,e.jsx)(C.P,{...se})}function g(V){switch(V){case"folder":return"folder";case"dashboard":return"dashboard";case"panel":return"panel"}throw new Error("Unsupported kind"+V)}},96727:(ve,ee,t)=>{t.d(ee,{H:()=>i});var e=t(63704),h=t(74101);const i=()=>{const[A]=(0,h.z)(),N=A.get("pull_request_url"),r=A.get("new_pull_request_url"),w=A.get("repo_url"),K=A.get("repo_type");return{prURL:N?e.sQ.sanitizeUrl(N):void 0,newPrURL:r?e.sQ.sanitizeUrl(r):void 0,repoURL:w?e.sQ.sanitizeUrl(w):void 0,repoType:K?e.sQ.sanitizeUrl(K):void 0}}}}]);

//# sourceMappingURL=DashboardListPage.8cd0b30e85d9e3d70971.js.map