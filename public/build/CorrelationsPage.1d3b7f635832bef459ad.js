"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[9981],{45185:(ie,K,n)=>{n.r(K),n.d(K,{default:()=>ze});var e=n(74848),x=n(22803),A=n(2543),f=n(96540),t=n(92745),v=n(27489),E=n(68143),le=n(44458),w=n(45861),Y=n(89640),Q=n(6975),O=n(34999),ce=n(27594),de=n(34213),I=n(63142),ue=n(99887),H=n(13791),fe=n(73427),me=n(45776),ge=n(11257),xe=n(3023),he=n(15840),p=n(49785);const J=(0,f.createContext)(void 0);function pe(o){const[r,a]=(0,f.useState)(0),{pages:s,onSubmit:i,children:u}=o;return(0,e.jsx)(J.Provider,{value:{currentPage:r,CurrentPageComponent:s[r],isLastPage:r===s.length-1,nextPage:()=>a(r+1),prevPage:()=>a(r-1),onSubmit:i},children:u})}const Z=()=>{const o=(0,f.useContext)(J);if(!o)throw new Error("useWizardContext must be used within a WizardContextProvider");return o};function ve(o){const{navigation:r}=o,{handleSubmit:a}=(0,p.xW)(),{CurrentPageComponent:s,isLastPage:i,nextPage:u,onSubmit:l}=Z(),d=r;return(0,e.jsxs)("form",{onSubmit:a(c=>{i?l(c):u()}),children:[(0,e.jsx)(s,{}),(0,e.jsx)(d,{})]})}function G(o){const{defaultValues:r,pages:a,onSubmit:s,navigation:i}=o,u=(0,p.mN)({defaultValues:r});return(0,e.jsx)(p.Op,{...u,children:(0,e.jsx)(pe,{pages:a,onSubmit:s,children:(0,e.jsx)(ve,{navigation:i})})})}var B=n(52860),z=n(16780),y=n(37386),F=n(63527),ye=n(87105);const X=(0,f.createContext)({loading:!1,correlation:void 0,readOnly:!1}),k=o=>{const{data:r,children:a}=o;return(0,e.jsx)(X.Provider,{value:r,children:a})},L=()=>(0,f.useContext)(X),M=(o,r)=>r?`${o}_${r.sourceUID}-${r.uid}`:o,je=o=>({label:(0,x.css)({maxWidth:o.spacing(80)}),description:(0,x.css)({maxWidth:o.spacing(80)})}),_=()=>{const{register:o,formState:r}=(0,p.xW)(),a=(0,I.of)(je),{correlation:s,readOnly:i}=L();return(0,e.jsx)(e.Fragment,{children:(0,e.jsxs)(z.n,{label:(0,t.t)("correlations.basic-info-form.title","Define correlation label (Step 1 of 3)"),children:[(0,e.jsx)(t.x6,{i18nKey:"correlations.basic-info-form.sub-text",children:(0,e.jsx)("p",{children:"Define text that will describe the correlation."})}),(0,e.jsx)("input",{type:"hidden",...o("type")}),(0,e.jsx)(y.D,{label:(0,t.t)("correlations.basic-info-form.label-label","Label"),description:(0,t.t)("correlations.basic-info-form.label-description","This name will be used as the label for the correlation. This will show as button text, a menu item, or hover text on a link."),className:a.label,invalid:!!r.errors.label,error:r.errors.label?.message,children:(0,e.jsx)(F.p,{id:M("label",s),...o("label",{required:{value:!0,message:(0,t.t)("correlations.basic-info-form.label-required","This field is required.")}}),readOnly:i,placeholder:(0,t.t)("correlations.basic-info-form.label-placeholder","e.g. Tempo traces")})}),(0,e.jsx)(y.D,{label:(0,t.t)("correlations.basic-info-form.description-label","Description"),description:(0,t.t)("correlations.basic-info-form.description-description","Optional description with more information about the link"),className:(0,x.cx)(a.description),children:(0,e.jsx)(ye.f,{id:M("description",s),...o("description"),readOnly:i})})]})})};var P=n(8073),ee=n(76792),Ce=n(28998),be=n(78529),T=n(41654),De=n(66404),U=n(72636),W=n(45967),N=n(30703),re=n(18857),Te=n(76319),S=n(58843);const Se=()=>({removeButton:(0,x.css)({marginTop:"25px"})}),we=o=>{const{index:r,value:a,readOnly:s,remove:i}=o,{control:u,formState:l,register:d,setValue:c,watch:h,getValues:j}=(0,p.xW)(),[C,D]=(0,f.useState)({});d(`config.transformations.${r}.type`,{required:{value:!0,message:(0,t.t)("correlations.transform-row.transform-required","Please select a transformation type")}});const $=(0,p.FH)({name:`config.transformations.${r}.type`,control:u}),m=(0,I.of)(Se),b=(0,S.jN)();return(0,e.jsxs)(T.B,{direction:"row",alignItems:"flex-start",children:[(0,e.jsx)(y.D,{label:(0,e.jsxs)(T.B,{gap:.5,children:[(0,e.jsx)(U.J,{htmlFor:`config.transformations.${a.id}-${r}.type`,children:(0,e.jsx)(t.x6,{i18nKey:"correlations.transform-row.type-label",children:"Type"})}),(0,e.jsx)(W.m,{content:(0,e.jsx)("div",{children:(0,e.jsx)("p",{children:(0,e.jsx)(t.x6,{i18nKey:"correlations.transform-row.type-tooltip",children:"The type of transformation that will be applied to the source data."})})}),children:(0,e.jsx)(N.I,{name:"info-circle",size:"sm"})})]}),invalid:!!l.errors?.config?.transformations?.[r]?.type,error:l.errors?.config?.transformations?.[r]?.message,validationMessageHorizontalOverflow:!0,children:(0,e.jsx)(re.l6,{value:$,onChange:V=>{if(!s){const g=j()?.config?.transformations?.[r];if(g&&D({expression:g.expression,mapValue:g.mapValue}),V.value){const R=(0,S.hr)(V.value);R.expressionDetails.show?c(`config.transformations.${r}.expression`,C?.expression||""):c(`config.transformations.${r}.expression`,""),R.mapValueDetails.show?c(`config.transformations.${r}.mapValue`,C?.mapValue||""):c(`config.transformations.${r}.mapValue`,""),c(`config.transformations.${r}.type`,V.value)}}},options:b,width:25,inputId:`config.transformations.${a.id}-${r}.type`})}),(0,e.jsx)(y.D,{label:(0,e.jsxs)(T.B,{gap:.5,children:[(0,e.jsx)(U.J,{htmlFor:`config.transformations.${a.id}.field`,children:(0,e.jsx)(t.x6,{i18nKey:"correlations.transform-row.field-label",children:"Field"})}),(0,e.jsx)(W.m,{content:(0,e.jsx)("div",{children:(0,e.jsx)("p",{children:(0,e.jsx)(t.x6,{i18nKey:"correlations.transform-row.field-tooltip",children:"Optional. The field to transform. If not specified, the transformation will be applied to the results field."})})}),children:(0,e.jsx)(N.I,{name:"info-circle",size:"sm"})})]}),children:(0,e.jsx)(F.p,{...d(`config.transformations.${r}.field`),readOnly:s,defaultValue:a.field,label:(0,t.t)("correlations.transform-row.field-input","field"),id:`config.transformations.${a.id}.field`})}),(0,e.jsx)(y.D,{label:(0,e.jsxs)(T.B,{gap:.5,children:[(0,e.jsxs)(U.J,{htmlFor:`config.transformations.${a.id}.expression`,children:[(0,e.jsx)(t.x6,{i18nKey:"correlations.transform-row.expression-label",children:"Expression"}),(0,S.hr)(h(`config.transformations.${r}.type`)).expressionDetails.required?" *":""]}),(0,e.jsx)(W.m,{content:(0,e.jsx)("div",{children:(0,e.jsx)("p",{children:(0,e.jsx)(t.x6,{i18nKey:"correlations.transform-row.expression-tooltip",children:"Required for regular expression. The expression the transformation will use. Logfmt does not use further specifications."})})}),children:(0,e.jsx)(N.I,{name:"info-circle",size:"sm"})})]}),invalid:!!l.errors?.config?.transformations?.[r]?.expression,error:l.errors?.config?.transformations?.[r]?.expression?.message,children:(0,e.jsx)(F.p,{...d(`config.transformations.${r}.expression`,{required:(0,S.hr)(h(`config.transformations.${r}.type`)).expressionDetails.required?(0,t.t)("correlations.transform-row.expression-required","Please define an expression"):void 0}),defaultValue:a.expression,readOnly:s,disabled:!(0,S.hr)(h(`config.transformations.${r}.type`)).expressionDetails.show,id:`config.transformations.${a.id}.expression`})}),(0,e.jsx)(y.D,{label:(0,e.jsxs)(T.B,{gap:.5,children:[(0,e.jsx)(U.J,{htmlFor:`config.transformations.${a.id}.mapValue`,children:(0,e.jsx)(t.x6,{i18nKey:"correlations.transform-row.map-value-label",children:"Map value"})}),(0,e.jsx)(W.m,{content:(0,e.jsx)("div",{children:(0,e.jsx)("p",{children:(0,e.jsx)(t.x6,{i18nKey:"correlations.transform-row.map-value-tooltip",children:"Optional. Defines the name of the variable. This is currently only valid for regular expressions with a single, unnamed capture group."})})}),children:(0,e.jsx)(N.I,{name:"info-circle",size:"sm"})})]}),children:(0,e.jsx)(F.p,{...d(`config.transformations.${r}.mapValue`),defaultValue:a.mapValue,readOnly:s,disabled:!(0,S.hr)(h(`config.transformations.${r}.type`)).mapValueDetails.show,id:`config.transformations.${a.id}.mapValue`})}),!s&&(0,e.jsx)("div",{className:m.removeButton,children:(0,e.jsx)(Te.K,{tooltip:(0,t.t)("correlations.transform-row.remove-tooltip","Remove transformation"),name:"trash-alt",onClick:()=>{i(r)},children:(0,e.jsx)(t.x6,{i18nKey:"correlations.transform-row.remove-button",children:"Remove"})})})]},a.id)},Ie=o=>{const{control:r,register:a}=(0,p.xW)(),{fields:s,append:i,remove:u}=(0,p.jz)({control:r,name:"config.transformations"}),{readOnly:l}=o;return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("input",{type:"hidden",...a("id")}),(0,e.jsxs)(T.B,{direction:"column",alignItems:"flex-start",children:[(0,e.jsx)(De.E,{variant:"h5",children:(0,e.jsx)(t.x6,{i18nKey:"correlations.transform.heading",children:"Transformations"})}),s.length===0&&(0,e.jsx)("div",{children:(0,e.jsx)(t.x6,{i18nKey:"correlations.transform.no-transform",children:"No transformations defined."})}),s.length>0&&(0,e.jsx)("div",{children:s.map((d,c)=>(0,e.jsx)(we,{value:d,index:c,readOnly:l,remove:u},c))}),!l&&(0,e.jsx)(w.$n,{icon:"plus",onClick:()=>i({type:void 0},{shouldFocus:!1}),variant:"secondary",type:"button",children:(0,e.jsx)(t.x6,{i18nKey:"correlations.transform.add-button",children:"Add transformation"})})]})]})},Fe=o=>({label:(0,x.css)({maxWidth:o.spacing(80)}),variable:(0,x.css)({fontFamily:o.typography.fontFamilyMonospace,fontWeight:o.typography.fontWeightMedium})}),Pe=(o,r)=>o==="query"?{title:(0,t.t)("correlations.source-form.query-title","Configure the data source that will link to {{dataSourceName}} (Step 3 of 3)",{dataSourceName:r}),descriptionPre:(0,t.t)("correlations.source-form.description-query-pre","You have used following variables in the target query:"),heading:(0,t.t)("correlations.source-form.heading-query","Variables used in the target query")}:{title:(0,t.t)("correlations.source-form.external-title","Configure the data source that will use the URL (Step 3 of 3)"),descriptionPre:(0,t.t)("correlations.source-form.description-external-pre","You have used following variables in the target URL:"),heading:(0,t.t)("correlations.source-form.heading-external","Variables used in the target URL")},te=()=>{const{control:o,formState:r,register:a,getValues:s}=(0,p.xW)(),i=(0,I.of)(Fe),u=m=>b=>m(b.uid),{correlation:l,readOnly:d}=L(),c=s("config.target"),h=s("type"),j=(0,be.O1)(c,{}).variables.map(m=>m.variableName+(m.fieldPath?`.${m.fieldPath}`:"")),C=(0,Ce.tR)().getInstanceSettings(s("targetUID"))?.name,D=Pe(h,C);function $(){return(0,e.jsx)(e.Fragment,{children:j.map((m,b)=>(0,e.jsxs)("span",{className:i.variable,children:[m,b<j.length-1?", ":""]},b))})}return(0,e.jsx)(e.Fragment,{children:(0,e.jsxs)(z.n,{label:D.title,children:[(0,e.jsx)(t.x6,{i18nKey:"correlations.source-form.sub-text",children:(0,e.jsx)("p",{children:"Define what data source will display the correlation, and what data will replace previously defined variables."})}),(0,e.jsx)(p.xI,{control:o,name:"sourceUID",rules:{required:{value:!0,message:(0,t.t)("correlations.source-form.control-required","This field is required.")}},render:({field:{onChange:m,value:b}})=>(0,e.jsx)(y.D,{label:(0,t.t)("correlations.source-form.source-label","Source"),description:(0,t.t)("correlations.source-form.source-description","Results from selected source data source have links displayed in the panel"),htmlFor:"source",invalid:!!r.errors.sourceUID,error:r.errors.sourceUID?.message,children:(0,e.jsx)(ee.sk,{onChange:u(m),noDefault:!0,current:b,inputId:"source",width:32,disabled:l!==void 0})})}),(0,e.jsx)(y.D,{label:(0,t.t)("correlations.source-form.results-label","Results field"),description:(0,t.t)("correlations.source-form.results-description","The link will be shown next to the value of this field"),className:i.label,invalid:!!r.errors?.config?.field,error:r.errors?.config?.field?.message,children:(0,e.jsx)(F.p,{id:M("field",l),...a("config.field",{required:(0,t.t)("correlations.source-form.results-required","This field is required.")}),readOnly:d})}),j.length>0&&(0,e.jsxs)(P.Z,{children:[(0,e.jsx)(P.Z.Heading,{children:D.heading}),(0,e.jsxs)(P.Z.Description,{children:[D.descriptionPre,(0,e.jsx)($,{}),(0,e.jsx)("br",{}),(0,e.jsxs)(t.x6,{i18nKey:"correlations.source-form.description",children:["A data point needs to provide values to all variables as fields or as transformations output to make the correlation button appear in the visualization.",(0,e.jsx)("br",{}),"Note: Not every variable needs to be explicitly defined below. A transformation such as"," ",(0,e.jsx)("span",{className:i.variable,children:"logfmt"})," will create variables for every key/value pair."]})]})]}),(0,e.jsx)(Ie,{readOnly:d})]})})};var Re=n(16817),Ee=n(1906),$e=n(78282);const Ve=({dsUid:o,invalid:r,error:a,name:s})=>{const{value:i,loading:u,error:l}=(0,Re.A)(async()=>{if(o)return(0,$e.l)().get(o)},[o]),d=i?.components?.QueryEditor;return(0,e.jsx)(y.D,{label:(0,t.t)("correlations.query-editor.query-label","Query"),description:(0,e.jsx)("span",{children:(0,e.jsxs)(t.x6,{i18nKey:"correlations.query-editor.query-description",children:["Define the query that is run when the link is clicked. You can use"," ",(0,e.jsx)(Y.Y,{href:"https://grafana.com/docs/grafana/latest/panels-visualizations/configure-data-links/",external:!0,children:"variables"})," ","to access specific field values."]})}),invalid:r,error:a,children:(0,e.jsx)(p.xI,{name:s,rules:{validate:{hasQueryEditor:(c,h)=>h.type==="query"&&d===void 0?(0,t.t)("correlations.query-editor.control-rules","The selected target data source must export a query editor."):!0}},render:({field:{value:c,onChange:h}})=>u?(0,e.jsx)(Q._,{text:(0,t.t)("correlations.query-editor.loading","Loading query editor...")}):l?(0,e.jsx)(O.F,{title:(0,t.t)("correlations.query-editor.error-title","Error loading data source"),children:(0,e.jsx)(t.x6,{i18nKey:"correlations.query-editor.error-text",children:"The selected data source could not be loaded."})}):i?d?(0,e.jsx)(e.Fragment,{children:(0,e.jsx)(d,{onRunQuery:()=>{},app:Ee.Jk.Correlations,onChange:j=>{h(j)},datasource:i,query:c})}):(0,e.jsx)(O.F,{title:(0,t.t)("correlations.query-editor.query-editor-title","Data source does not export a query editor.")}):(0,e.jsx)(O.F,{title:(0,t.t)("correlations.query-editor.data-source-title","No data source selected"),severity:"info",children:(0,e.jsx)(t.x6,{i18nKey:"correlations.query-editor.data-source-text",children:"Please select a target data source first."})})})})},Ke={query:{value:"query",label:"Query",description:"Open a query"},external:{value:"external",label:"External",description:"Open an external URL"}},Oe=o=>({typeSelect:(0,x.css)({maxWidth:o.spacing(40)})}),oe=()=>{const{control:o,formState:{errors:r}}=(0,p.xW)(),a=c=>h=>c(h.uid),{correlation:s}=L(),i=s&&"targetUID"in s?s.targetUID:void 0,u=(0,p.FH)({name:"targetUID"})||i,l=(0,p.FH)({name:"type"})||s?.type,d=(0,I.of)(Oe);return(0,e.jsx)(e.Fragment,{children:(0,e.jsxs)(z.n,{label:(0,t.t)("correlations.target-form.title","Setup the target for the correlation (Step 2 of 3)"),children:[(0,e.jsx)(t.x6,{i18nKey:"correlations.target-form.sub-text",children:(0,e.jsx)("p",{children:"Define what the correlation will link to. With the query type, a query will run when the correlation is clicked. With the external type, clicking the correlation will open a URL."})}),(0,e.jsx)(p.xI,{control:o,name:"type",rules:{required:{value:!0,message:(0,t.t)("correlations.target-form.control-rules","This field is required.")}},render:({field:{onChange:c,value:h,...j}})=>(0,e.jsx)(y.D,{label:(0,t.t)("correlations.target-form.type-label","Type"),description:(0,t.t)("correlations.target-form.target-type-description","Specify the type of correlation"),htmlFor:"corrType",invalid:!!r.type,children:(0,e.jsx)(re.l6,{className:d.typeSelect,value:l,onChange:C=>c(C.value),options:Object.values(Ke),"aria-label":(0,t.t)("correlations.configure-correlation-target-form.aria-label-correlation-type","Correlation type")})})}),l==="query"&&((0,S.L5)(r),(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(p.xI,{control:o,name:"targetUID",rules:{required:{value:!0,message:(0,t.t)("correlations.target-form.control-rules","This field is required.")}},render:({field:{onChange:c,value:h}})=>(0,e.jsx)(y.D,{label:(0,t.t)("correlations.target-form.target-label","Target"),description:(0,t.t)("correlations.target-form.target-description-query","Specify which data source is queried when the link is clicked"),htmlFor:"target",invalid:!!r.targetUID,error:r.targetUID?.message,children:(0,e.jsx)(ee.sk,{onChange:a(c),noDefault:!0,current:h,inputId:"target",width:32,disabled:s!==void 0})})}),(0,e.jsx)(Ve,{name:"config.target",dsUid:u,invalid:!!r?.config?.target,error:r?.config?.target&&"message"in r?.config?.target?(r?.config?.target).message:"Error"})]})),l==="external"&&(0,e.jsx)(e.Fragment,{children:(0,e.jsx)(p.xI,{control:o,name:"config.target",rules:{required:{value:!0,message:(0,t.t)("correlations.target-form.control-rules","This field is required.")}},render:({field:{onChange:c,value:h}})=>{const j=h;return(0,e.jsx)(y.D,{label:(0,t.t)("correlations.target-form.target-label","Target"),description:(0,t.t)("correlations.target-form.target-description-external","Specify the URL that will open when the link is clicked"),htmlFor:"target",children:(0,e.jsx)(F.p,{value:j.url||"",onChange:C=>{c({url:C.currentTarget.value})}})})}})})]})})},ne=()=>{const{currentPage:o,prevPage:r,isLastPage:a}=Z(),{readOnly:s,loading:i,correlation:u}=L(),l=!s&&(0,e.jsx)(w.$n,{variant:"primary",icon:i?"spinner":"save",type:"submit",disabled:i,children:u===void 0?(0,t.t)("correlations.navigation-form.add-button","Add"):(0,t.t)("correlations.navigation-form.save-button","Save")}),d=(0,e.jsx)(w.$n,{variant:"primary",type:"submit",children:(0,e.jsx)(t.x6,{i18nKey:"correlations.navigation-form.next-button",children:"Next"})});return(0,e.jsxs)(T.B,{justifyContent:"flex-start",children:[o>0?(0,e.jsx)(w.$n,{variant:"secondary",onClick:r,children:(0,e.jsx)(t.x6,{i18nKey:"correlations.navigation-form.back-button",children:"Back"})}):void 0,a?l:d]})},Le=o=>({panelContainer:(0,x.css)({position:"relative",padding:o.spacing(1),marginBottom:o.spacing(2)}),infoBox:(0,x.css)({marginTop:"20px"})}),Ue=({onClose:o,onCreated:r})=>{const a=(0,I.of)(Le),{create:{execute:s,loading:i,error:u,value:l}}=(0,B.lW)();(0,f.useEffect)(()=>{!u&&!i&&l&&r()},[u,i,l,r]);const d={type:"query",config:{target:{},field:""}};return(0,e.jsxs)(xe._,{className:a.panelContainer,children:[(0,e.jsx)(he.J,{onClick:o}),(0,e.jsx)(k,{data:{loading:i,readOnly:!1,correlation:void 0},children:(0,e.jsx)(G,{defaultValues:d,pages:[_,oe,te],navigation:ne,onSubmit:s})})]})},We=({onUpdated:o,correlation:r,readOnly:a=!1})=>{const{update:{execute:s,loading:i,error:u,value:l}}=(0,B.lW)(),d=c=>s({...c,sourceUID:r.sourceUID,uid:r.uid});return(0,f.useEffect)(()=>{!u&&!i&&l&&o()},[u,i,l,o]),(0,e.jsx)(k,{data:{loading:i,readOnly:a,correlation:r},children:(0,e.jsx)(G,{defaultValues:r,pages:[_,oe,te],onSubmit:a?c=>()=>{}:d,navigation:ne})})};var Ne=n(50201);const Ae=({onClick:o,canWriteCorrelations:r})=>r?(0,e.jsx)(Ne.p,{variant:"call-to-action",button:(0,e.jsx)(w.$n,{icon:"gf-glue",onClick:o,size:"lg",children:(0,e.jsx)(t.x6,{i18nKey:"correlations.empty-state.button-title",children:"Add correlation"})}),message:(0,t.t)("correlations.empty-state.title","You haven't defined any correlations yet"),children:(0,e.jsx)(t.x6,{i18nKey:"correlations.empty-state.pro-tip",children:"You can also define correlations via datasource provisioning"})}):(0,e.jsxs)(P.Z,{children:[(0,e.jsx)(P.Z.Heading,{children:(0,e.jsx)(t.x6,{i18nKey:"correlations.empty-correlations-cta.there-are-no-correlations-configured-yet",children:"There are no correlations configured yet."})}),(0,e.jsx)(P.Z.Description,{children:(0,e.jsx)(t.x6,{i18nKey:"correlations.empty-correlations-cta.please-contact-administrator-create-correlations",children:"Please contact your administrator to create new correlations."})})]}),ae=(o,r,a)=>o.values[a].name.localeCompare(r.values[a].name),q=o=>o.provisioned,Be=(0,x.css)({display:"flex",justifyContent:"center"});function ze(){const o=(0,me.C)("correlations"),[r,a]=(0,f.useState)(!1),s=(0,f.useRef)(1),i=g=>{a(g),g&&(0,v.rR)("grafana_correlations_adding_started")},{remove:u,get:{execute:l,...d}}=(0,B.lW)(),c=fe.TP.hasPermission(ge.w.DataSourcesWrite),h=(0,f.useCallback)(()=>{(0,v.rR)("grafana_correlations_added"),l({page:s.current}),i(!1)},[l]),j=(0,f.useCallback)(()=>{(0,v.rR)("grafana_correlations_edited"),l({page:s.current})},[l]),C=(0,f.useCallback)(async(g,R)=>{await u.execute(g),(0,v.rR)("grafana_correlations_deleted"),R&&s.current--,l({page:s.current})},[u,l]);(0,f.useEffect)(()=>{l({page:s.current})},[l]);const D=(0,f.useCallback)(({row:{index:g,original:{source:{uid:R},provisioned:He,uid:Je}}})=>!He&&(0,e.jsx)(le.e,{"aria-label":(0,t.t)("correlations.list.delete","delete correlation"),onConfirm:()=>C({sourceUID:R,uid:Je},s.current>1&&g===0&&m?.correlations.length===1),closeOnConfirm:!0}),[C]),$=(0,f.useMemo)(()=>[{id:"info",cell:Qe,disableGrow:!0,visible:g=>g.some(q)},{id:"source",header:(0,t.t)("correlations.list.source","Source"),cell:se,sortType:ae},{id:"target",header:(0,t.t)("correlations.list.target","Target"),cell:se,sortType:ae},{id:"label",header:(0,t.t)("correlations.list.label","Label"),sortType:"alphanumeric"},{id:"actions",cell:D,disableGrow:!0,visible:g=>c&&g.some((0,A.negate)(q))}],[D,c]),m=(0,f.useMemo)(()=>d.value,[d.value]),b=m?.correlations.length===0&&!r&&!d.error,V=c&&m?.correlations?.length!==0&&m!==void 0&&!r&&(0,e.jsx)(w.$n,{icon:"plus",onClick:()=>i(!0),children:(0,e.jsx)(t.x6,{i18nKey:"correlations.add-new",children:"Add new"})});return(0,e.jsx)(H.Y,{navModel:o,subTitle:(0,e.jsx)(e.Fragment,{children:(0,e.jsxs)(t.x6,{i18nKey:"correlations.sub-title",children:["Define how data living in different data sources relates to each other. Read more in the"," ",(0,e.jsx)(Y.Y,{href:"https://grafana.com/docs/grafana/next/administration/correlations/",external:!0,children:"documentation"})]})}),actions:V,children:(0,e.jsx)(H.Y.Contents,{children:(0,e.jsxs)("div",{children:[!m&&d.loading&&(0,e.jsx)("div",{className:Be,children:(0,e.jsx)(Q._,{text:(0,t.t)("correlations.list.loading","loading...")})}),b&&(0,e.jsx)(Ae,{canWriteCorrelations:c,onClick:()=>i(!0)}),d.error&&(0,e.jsx)(O.F,{severity:"error",title:(0,t.t)("correlations.alert.title","Error fetching correlation data"),topSpacing:2,children:(0,E.NF)(d.error)&&d.error.data?.message||(0,t.t)("correlations.alert.error-message","An unknown error occurred while fetching correlation data. Please try again.")}),r&&(0,e.jsx)(Ue,{onClose:()=>i(!1),onCreated:h}),m&&m.correlations.length>=1&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(ce.j,{renderExpandedRow:g=>(0,e.jsx)(Me,{correlation:g,onUpdated:j,readOnly:q(g)||!c}),columns:$,data:m.correlations,getRowId:g=>`${g.source.uid}-${g.uid}`}),(0,e.jsx)(de.d,{currentPage:s.current,numberOfPages:Math.ceil(m.totalCount/m.limit),onNavigate:g=>{l({page:s.current=g})}})]})]})})})}function Me({correlation:{source:o,...r},readOnly:a,onUpdated:s}){(0,f.useEffect)(()=>(0,v.rR)("grafana_correlations_details_expanded"),[]);let i=r.type==="query"?{...r,type:"query",sourceUID:o.uid,targetUID:r.target.uid}:{...r,type:"external",sourceUID:o.uid};return(0,e.jsx)(We,{correlation:i,onUpdated:s,readOnly:a})}const qe=o=>({root:(0,x.css)({display:"flex",alignItems:"center"}),dsLogo:(0,x.css)({marginRight:o.spacing(),height:"16px",width:"16px"})}),se=(0,f.memo)(function({cell:{value:r}}){const a=(0,I.of)(qe);return(0,e.jsx)("span",{className:a.root,children:r?.name!==void 0&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("img",{src:r.meta.info.logos.small,alt:"",className:a.dsLogo}),r.name]})})},({cell:{value:o}},{cell:{value:r}})=>o?.type===r?.type&&o?.name===r?.name),Ye=(0,x.css)({whiteSpace:"nowrap"}),Qe=(0,f.memo)(function({...r}){return r.row.original.provisioned?(0,e.jsx)(ue.E,{text:(0,t.t)("correlations.list.read-only","Read only"),color:"purple",className:Ye}):null},(o,r)=>o.row.original.source.readOnly===r.row.original.source.readOnly)},58843:(ie,K,n)=>{n.d(K,{L5:()=>A,hr:()=>f,jN:()=>t});var e=n(79609),x=n(92745);function A(v){}function f(v){switch(v){case e.CC.Logfmt:return{label:(0,x.t)("correlations.trans-details.logfmt-label","Logfmt"),value:e.CC.Logfmt,description:(0,x.t)("correlations.trans-details.logfmt-description","Parse provided field with logfmt to get variables"),expressionDetails:{show:!1},mapValueDetails:{show:!1}};case e.CC.Regex:return{label:(0,x.t)("correlations.trans-details.regex-label","Regular expression"),value:e.CC.Regex,description:(0,x.t)("correlations.trans-details.regex-description","Field will be parsed with regex. Use named capture groups to return multiple variables, or a single unnamed capture group to add variable to named map value. Regex is case insensitive."),expressionDetails:{show:!0,required:!0,helpText:(0,x.t)("correlations.trans-details.regex-expression","Use capture groups to extract a portion of the field.")},mapValueDetails:{show:!0,required:!1,helpText:(0,x.t)("correlations.trans-details.regex-map-values","Defines the name of the variable if the capture group is not named.")}};default:return{label:v,value:v,expressionDetails:{show:!1},mapValueDetails:{show:!1}}}}const t=()=>Object.values(e.CC).map(v=>{const E=f(v);return{label:E.label,value:E.value,description:E.description}})}}]);

//# sourceMappingURL=CorrelationsPage.1d3b7f635832bef459ad.js.map