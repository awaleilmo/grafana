"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[8547],{70928:(Oe,J,a)=>{a.r(J),a.d(J,{default:()=>me});var e=a(74848),O=a(22803),m=a(96540),h=a(49785),q=a(47987),l=a(92745),E=a(63142),I=a(41654),f=a(72636),K=a(30703),_=a(31286),ee=a(12737),w=a(45861),te=a(63527),z=a(70683),$=a(43243),M=a(45967),G=a(77824),le=a(73427),ne=a(11257),R=a(24619),N=a(74268),Q=a(38055),re=a(72984),ae=a(78282),T=a(76151),se=a(52161);const H=new Intl.Collator;function oe(){return(0,se.qi)().filter(t=>!!t?.url)}function ie(){const[t]=T.V.useLazyGetGrafanaGroupsQuery(),[n]=T.V.useLazyGetGroupsQuery(),r=(0,m.useCallback)(o=>{if(o.includes("/")&&(o.endsWith(".yml")||o.endsWith(".yaml"))){const F=o.split("/").pop()||o,S=100,P=o.length>S?`${o.substring(0,S)}...`:o;return{label:F,value:o,description:P}}const v=50,b=100,y=o.length>v?`${o.substring(0,v)}...`:o,C=o.length>b?`${o.substring(0,b)}...`:o;return{label:y,value:o,description:C}},[]),i=(0,m.useCallback)(async o=>{const v=await t({limitAlerts:0,groupLimit:1e3}).unwrap(),b=Array.from(new Set(v.data.groups.map(g=>g.file||"default"))).map(g=>({label:g,value:g,description:(0,l.t)("alerting.rules-filter.grafana-folder","Grafana folder")})).sort((g,u)=>H.compare(g.label??"",u.label??"")),y=new Set,C=oe().map(g=>n({ruleSource:{uid:g.uid},excludeAlerts:!0,groupLimit:500,notificationOptions:{showErrorAlert:!1}}).unwrap()),F=await Promise.allSettled(C);for(const g of F)g.status==="fulfilled"&&g.value.data.groups.forEach(u=>y.add(u.file||"default"));const S=Array.from(y).map(r).sort((g,u)=>H.compare(g.label??"",u.label??"")),P=[...b,...S];return B(P,o)},[t,n,r]),s=[],c=!1,d=(0,l.t)("alerting.rules-filter.filter-options.placeholder-namespace","Select namespace"),x=(0,l.t)("grafana.select-group","Select group");return{namespaceOptions:i,allGroupNames:s,isLoadingNamespaces:c,namespacePlaceholder:d,groupPlaceholder:x}}function ce(){const[t]=T.V.useLazyGetGrafanaGroupsQuery(),n=(0,m.useCallback)(()=>({label:(0,l.t)("label-dropdown-info","Can't find your label? Enter it manually"),value:"__GRAFANA_LABEL_DROPDOWN_INFO__",infoOption:!0}),[]),r=(0,m.useCallback)(s=>{const c=Array.from(s.entries()).flatMap(([d,x])=>Array.from(x).map(o=>({label:`${d}=${o}`,value:`${d}=${o}`})));return c.sort((d,x)=>H.compare(d.label??"",x.label??"")),c},[]);return{labelOptions:(0,m.useCallback)(async s=>{const c=await t({limitAlerts:0,groupLimit:1e3},!0).unwrap(),d=de(c.data.groups),x=r(d);if(x.length===0)return[];const o=[...x,n()];return B(o,s,!0)},[t,r,n])}}function ue(){return(0,m.useCallback)(async t=>{const n=(0,ae.l)().getList({alerting:!0}).map(r=>({label:r.name,value:r.name}));return B(n,t)},[])}function de(t){return t.flatMap(r=>r.rules).reduce((r,i)=>(i.labels&&Object.entries(i.labels).forEach(([s,c])=>{if(!s||!c)return;const d=r.get(s);d?d.add(c):r.set(s,new Set([c]))}),r),new Map)}function B(t,n,r=!1){const i=(n??"").toLowerCase();return i?t.filter(s=>(s.label??s.value).toLowerCase().includes(i)||r&&!!s.infoOption):t}var U=a(96784),A=a(56369),he=a(98684);function V(t){return{freeFormWords:[],...t,namespace:t.namespace||void 0,groupName:t.groupName||void 0,contactPoint:t.contactPoint||void 0,ruleHealth:t.ruleHealth==="*"?void 0:t.ruleHealth,ruleState:t.ruleState==="*"?void 0:t.ruleState,ruleType:t.ruleType==="*"?void 0:t.ruleType,plugins:t.plugins==="show"?void 0:"hide",ruleSource:t.ruleSource??void 0}}const Y={namespace:null,groupName:null,ruleName:void 0,ruleType:"*",ruleState:"*",dataSourceNames:[],labels:[],ruleHealth:"*",dashboardUid:void 0,plugins:"show",contactPoint:null,ruleSource:null};function X(t){return{namespace:t.namespace??null,groupName:t.groupName??null,ruleName:t.ruleName,ruleType:t.ruleType??"*",ruleState:t.ruleState??"*",dataSourceNames:t.dataSourceNames,labels:t.labels,ruleHealth:t.ruleHealth??"*",dashboardUid:t.dashboardUid,plugins:t.plugins??"show",contactPoint:t.contactPoint??null,ruleSource:t.ruleSource??null}}function pe(t){const n=(0,m.useRef)(null);return(0,m.useEffect)(()=>{const r=document.createElement("div");return Object.assign(r.style,{position:"fixed",top:"0",left:"0",width:"100%",height:"100%",pointerEvents:"none",zIndex:String(t)}),document.body.appendChild(r),n.current=r,()=>{r.remove()}},[t]),n.current||void 0}function ge(){const{components:t}=(0,he.u)();return{pluginsFilterEnabled:t.length>0}}const xe=le.TP.hasPermission(ne.w.AlertingReceiversRead),L=(0,O.css)({width:"max-content"});function me({viewMode:t,onViewModeChange:n}){const r=(0,E.of)(k),[i,s]=(0,m.useState)(!1),{searchQuery:c,updateFilters:d,setSearchQuery:x}=(0,U.dI)(),o=(0,m.useRef)(null),{pluginsFilterEnabled:v}=ge(),{control:b,setValue:y,handleSubmit:C}=(0,h.mN)({defaultValues:{query:c}});(0,m.useEffect)(()=>{y("query",c)},[c,y]);const F=u=>{const p=(0,A.XY)(u.query);(0,N.iH)({filterMethod:"search-input",filter:p}),d(p)},S=u=>{const p=V(u);d(p),(0,N.O$)(u,v),s(!1)},P=()=>{d(V(Y)),x(void 0)},W=()=>{(0,N.oY)(),s(!i)};(0,m.useEffect)(()=>{const u=p=>{i&&o.current&&p.target instanceof Node&&!o.current.contains(p.target)&&(p.target instanceof Element&&(p.target.closest("[data-popper-placement]")||p.target.closest('[role="listbox"]'))||s(!1))};return i&&document.addEventListener("mousedown",u),()=>{document.removeEventListener("mousedown",u)}},[i]);const g=(0,l.t)("alerting.rules-filter.filter-options.aria-label-show-filters","Filter");return(0,e.jsx)("form",{onSubmit:C(F),onReset:()=>{},children:(0,e.jsxs)(I.B,{direction:"column",gap:1,children:[(0,e.jsx)(f.J,{htmlFor:"rulesSearchInput",children:(0,e.jsxs)(I.B,{gap:.5,alignItems:"center",children:[(0,e.jsx)("span",{children:(0,e.jsx)(l.x6,{i18nKey:"alerting.rules-filter.search",children:"Search"})}),(0,e.jsx)(Q.B,{content:(0,e.jsx)(Ne,{}),children:(0,e.jsx)(K.I,{name:"info-circle",size:"sm",tabIndex:0,title:(0,l.t)("alerting.rules-filter.title-search-help","Search help")})})]})}),(0,e.jsxs)(I.B,{direction:"row",alignItems:"center",gap:1,children:[(0,e.jsx)(_.a,{flex:1,children:(0,e.jsx)(h.xI,{name:"query",control:b,render:({field:u})=>(0,e.jsx)(ee.Z,{id:"rulesSearchInput","data-testid":"search-query-input",placeholder:(0,l.t)("alerting.rules-filter.filter-options.placeholder-search-input","Search by name or enter filter query..."),name:"searchQuery",onChange:p=>{(0,N.pf)(u.value,p),u.onChange(p)},onKeyDown:p=>{(p.key==="Enter"||p.key==="NumpadEnter")&&(p.preventDefault(),C(F)())},onBlur:()=>{const p=u.value,D=(0,A.XY)(p);(0,N.iH)({filterMethod:"search-input",filter:D}),d(D)},value:u.value})})}),(0,e.jsx)(Q.B,{showOn:"click",placement:"auto",disableBlur:!0,isOpen:i,onClose:()=>s(!1),onToggle:W,content:(0,e.jsx)("div",{ref:o,className:r.content,onClick:u=>u.stopPropagation(),onKeyDown:u=>{(u.key==="Enter"||u.key===" ")&&u.stopPropagation()},role:"dialog","aria-label":(0,l.t)("alerting.rules-filter.filter-options.aria-label","Filter options"),tabIndex:-1,children:(0,e.jsx)(fe,{onSubmit:S,onClear:P,pluginsFilterEnabled:v})}),children:(0,e.jsx)(w.$n,{name:"filter",icon:"filter",variant:"secondary","aria-label":g,children:g})}),(0,e.jsx)(re.b,{viewMode:t,onViewModeChange:n})]})]})})}const fe=({onSubmit:t,onClear:n,pluginsFilterEnabled:r})=>{const i=(0,E.of)(k),s=(0,E.$j)(),{filterState:c}=(0,U.dI)(),d=(0,m.useRef)(!1),x=pe(s.zIndex.portal+100),o=X(c),{namespaceOptions:v,allGroupNames:b,isLoadingNamespaces:y,namespacePlaceholder:C,groupPlaceholder:F}=ie(),{labelOptions:S}=ce(),P=ue(),W=(0,h.mN)({defaultValues:o}),{handleSubmit:g,reset:u}=W;(0,m.useEffect)(()=>{if(d.current){d.current=!1;return}const D=X(c);u(D)},[c,u]);const p=g(t);return(0,e.jsx)(h.Op,{...W,children:(0,e.jsx)("form",{onSubmit:p,onReset:()=>{d.current=!0,u(Y),(0,N.lC)(),n()},children:(0,e.jsxs)(I.B,{direction:"column",alignItems:"end",gap:2,children:[(0,e.jsxs)("div",{className:i.grid,children:[(0,e.jsx)(je,{}),(0,e.jsx)(ye,{labelOptions:S,portalContainer:x}),(0,e.jsx)(ve,{namespaceOptions:v,namespacePlaceholder:C,isLoadingNamespaces:y,portalContainer:x}),(0,e.jsx)(be,{allGroupNames:b,groupPlaceholder:F,isLoadingNamespaces:y,portalContainer:x}),(0,e.jsx)(Ce,{dataSourceOptions:P,portalContainer:x}),xe&&(0,e.jsx)(Fe,{portalContainer:x}),(0,e.jsx)(Re,{}),(0,e.jsx)(Se,{}),(0,e.jsx)(Ie,{}),(0,e.jsx)(Ae,{}),r&&(0,e.jsx)(Pe,{})]}),(0,e.jsxs)(I.B,{direction:"row",alignItems:"center",children:[(0,e.jsx)(w.$n,{type:"reset",variant:"secondary","data-testid":"filter-clear-button",children:(0,e.jsx)(l.x6,{i18nKey:"common.clear",children:"Clear"})}),(0,e.jsx)(w.$n,{type:"submit","data-testid":"filter-apply-button",children:(0,e.jsx)(l.x6,{i18nKey:"common.apply",children:"Apply"})})]})]})})})};function je(){const{register:t}=(0,h.xW)();return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(f.J,{children:(0,e.jsx)(l.x6,{i18nKey:"alerting.search.property.rule-name",children:"Rule name"})}),(0,e.jsx)(te.p,{...t("ruleName"),"data-testid":"rule-name-input"})]})}function ye({labelOptions:t,portalContainer:n}){const{control:r}=(0,h.xW)();return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(f.J,{children:(0,e.jsx)(l.x6,{i18nKey:"alerting.search.property.labels",children:"Labels"})}),(0,e.jsx)(h.xI,{name:"labels",control:r,render:({field:i})=>(0,e.jsx)(z.f,{options:t,value:i.value,onChange:s=>i.onChange(s.map(c=>c.value)),placeholder:(0,l.t)("alerting.rules-filter.placeholder-labels","Select labels"),portalContainer:n,width:"auto",minWidth:40,maxWidth:80})})]})}function ve({namespaceOptions:t,namespacePlaceholder:n,isLoadingNamespaces:r,portalContainer:i}){const{control:s}=(0,h.xW)();return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(f.J,{children:(0,e.jsx)(l.x6,{i18nKey:"alerting.search.property.namespace",children:"Folder / Namespace"})}),(0,e.jsx)(h.xI,{name:"namespace",control:s,render:({field:c})=>(0,e.jsx)($.G,{placeholder:n,options:t,onChange:d=>c.onChange(d?.value||null),value:c.value,loading:r,isClearable:!0,portalContainer:i})})]})}function be({allGroupNames:t,groupPlaceholder:n,isLoadingNamespaces:r,portalContainer:i}){const{control:s}=(0,h.xW)();return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(f.J,{children:(0,e.jsx)(l.x6,{i18nKey:"alerting.search.property.evaluation-group",children:"Evaluation group"})}),(0,e.jsx)(h.xI,{name:"groupName",control:s,render:({field:c})=>(0,e.jsx)($.G,{placeholder:n,options:t.map(d=>({label:d,value:d})),onChange:d=>c.onChange(d?.value||null),value:c.value,loading:r,isClearable:!0,portalContainer:i})})]})}function Ce({dataSourceOptions:t,portalContainer:n}){const{control:r}=(0,h.xW)();return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(f.J,{children:(0,e.jsxs)(I.B,{gap:.5,alignItems:"center",children:[(0,e.jsx)("span",{children:(0,e.jsx)(l.x6,{i18nKey:"alerting.search.property.data-source",children:"Data source"})}),(0,e.jsx)(M.m,{content:(0,e.jsxs)("div",{children:[(0,e.jsx)("p",{children:(0,e.jsx)(l.x6,{i18nKey:"alerting.rules-filter.configured-alert-rules",children:"Data sources containing configured alert rules are Mimir or Loki data sources where alert rules are stored and evaluated in the data source itself."})}),(0,e.jsx)("p",{children:(0,e.jsx)(l.x6,{i18nKey:"alerting.rules-filter.manage-alerts",children:"In these data sources, you can select Manage alerts via Alerting UI to be able to manage these alert rules in the Grafana UI as well as in the data source where they were configured."})})]}),children:(0,e.jsx)(K.I,{name:"info-circle",size:"sm",title:(0,l.t)("alerting.rules-filter.data-source-picker-inline-help-title-search-by-data-sources-help","Search by data sources help")})})]})}),(0,e.jsx)(h.xI,{name:"dataSourceNames",control:r,render:({field:i})=>(0,e.jsx)(z.f,{options:t,value:i.value,onChange:s=>i.onChange(s.map(c=>c.value)),placeholder:(0,l.t)("alerting.rules-filter.placeholder-data-sources","Select data sources"),portalContainer:n,width:"auto",minWidth:40,maxWidth:80})})]})}function Fe({portalContainer:t}){const{control:n}=(0,h.xW)();return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(f.J,{children:(0,e.jsxs)(I.B,{gap:.5,alignItems:"center",children:[(0,e.jsx)("span",{children:(0,e.jsx)(l.x6,{i18nKey:"alerting.contactPointFilter.label",children:"Contact point"})}),(0,e.jsx)(M.m,{content:(0,e.jsx)(l.x6,{i18nKey:"alerting.rules-filter.contact-point-tooltip",children:"Filters alert rules which route directly to the selected contact point. Alert rules routed to notification policies will not be displayed."}),children:(0,e.jsx)(K.I,{name:"info-circle",size:"sm",title:(0,l.t)("alerting.rules-filter.contact-point-tooltip-title","Contact point filter help")})})]})}),(0,e.jsx)(h.xI,{name:"contactPoint",control:n,render:({field:r})=>(0,e.jsx)(q.u,{placeholder:(0,l.t)("alerting.rules-filter.placeholder-contact-point","Select contact point"),value:r.value,isClearable:!0,onChange:i=>{r.onChange(i?.spec.title||null)},portalContainer:t})})]})}function Se(){const{control:t}=(0,h.xW)();return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(f.J,{children:(0,e.jsx)(l.x6,{i18nKey:"alerting.search.property.state",children:"State"})}),(0,e.jsx)(h.xI,{name:"ruleState",control:t,render:({field:n})=>(0,e.jsx)(G.z,{options:[{label:(0,l.t)("common.all","All"),value:"*"},{label:(0,l.t)("alerting.rules.state.firing","Firing"),value:R.cF.Firing},{label:(0,l.t)("alerting.rules.state.normal","Normal"),value:R.cF.Inactive},{label:(0,l.t)("alerting.rules.state.pending","Pending"),value:R.cF.Pending},{label:(0,l.t)("alerting.rules.state.recovering","Recovering"),value:R.cF.Recovering},{label:(0,l.t)("alerting.rules.state.unknown","Unknown"),value:R.cF.Unknown}],value:n.value,onChange:n.onChange,fullWidth:!1,className:L})})]})}function Ie(){const{control:t}=(0,h.xW)();return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(f.J,{children:(0,e.jsx)(l.x6,{i18nKey:"alerting.search.property.rule-type",children:"Type"})}),(0,e.jsx)(h.xI,{name:"ruleType",control:t,render:({field:n})=>(0,e.jsx)(G.z,{options:[{label:(0,l.t)("common.all","All"),value:"*"},{label:(0,l.t)("alerting.rules.type.alert","Alert rule"),value:R.JS.Alerting},{label:(0,l.t)("alerting.rules.type.recording","Recording rule"),value:R.JS.Recording}],value:n.value,onChange:n.onChange,fullWidth:!1,className:L})})]})}function Re(){const{control:t}=(0,h.xW)();return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(f.J,{children:(0,e.jsx)(l.x6,{i18nKey:"alerting.search.property.rule-source",children:"Rule source"})}),(0,e.jsx)(h.xI,{name:"ruleSource",control:t,render:({field:n})=>(0,e.jsx)(G.z,{options:[{label:(0,l.t)("common.all","All"),value:null},{label:(0,l.t)("alerting.rules-filter.rule-source.grafana","Grafana managed"),value:A.Eg.Grafana},{label:(0,l.t)("alerting.rules-filter.rule-source.datasource","Data source managed"),value:A.Eg.DataSource}],value:n.value,onChange:n.onChange,fullWidth:!1,className:L})})]})}function Ae(){const{control:t}=(0,h.xW)();return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(f.J,{children:(0,e.jsx)(l.x6,{i18nKey:"alerting.search.property.rule-health",children:"Health"})}),(0,e.jsx)(h.xI,{name:"ruleHealth",control:t,render:({field:n})=>(0,e.jsx)(G.z,{options:[{label:(0,l.t)("common.all","All"),value:"*"},{label:(0,l.t)("alerting.rules.health.ok","OK"),value:A.Jc.Ok},{label:(0,l.t)("alerting.rules.health.no-data","No data"),value:A.Jc.NoData},{label:(0,l.t)("alerting.rules.health.error","Error"),value:A.Jc.Error}],value:n.value,onChange:n.onChange,fullWidth:!1,className:L})})]})}function Pe(){const{control:t}=(0,h.xW)();return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(f.J,{children:(0,e.jsx)(l.x6,{i18nKey:"alerting.rules-filter.plugin-rules",children:"Plugin rules"})}),(0,e.jsx)(h.xI,{name:"plugins",control:t,render:({field:n})=>(0,e.jsx)(G.z,{options:[{label:(0,l.t)("alerting.rules-filter.label.show","Show"),value:"show"},{label:(0,l.t)("alerting.rules-filter.label.hide","Hide"),value:"hide"}],value:n.value,onChange:n.onChange,fullWidth:!1,className:L})})]})}function Ne(){const t=(0,E.of)(Z);return(0,e.jsxs)("div",{children:[(0,e.jsx)("div",{children:(0,e.jsx)(l.x6,{i18nKey:"alerting.search-query-help.search-syntax",children:"Search syntax allows to query alert rules by the parameters defined below."})}),(0,e.jsx)("hr",{}),(0,e.jsxs)("div",{className:t.grid,children:[(0,e.jsx)("div",{children:(0,e.jsx)(l.x6,{i18nKey:"alerting.search-query-help.filter-type",children:"Filter type"})}),(0,e.jsx)("div",{children:(0,e.jsx)(l.x6,{i18nKey:"alerting.search-query-help.expression",children:"Expression"})}),(0,e.jsx)(j,{title:(0,l.t)("alerting.search-query-help.title-datasources","Datasources"),expr:"datasource:mimir datasource:prometheus"}),(0,e.jsx)(j,{title:(0,l.t)("alerting.search-query-help.title-folder-namespace","Folder/Namespace"),expr:"namespace:global"}),(0,e.jsx)(j,{title:(0,l.t)("alerting.search-query-help.title-group","Group"),expr:"group:cpu-usage"}),(0,e.jsx)(j,{title:(0,l.t)("alerting.search-query-help.title-rule","Rule"),expr:'rule:"cpu 80%"'}),(0,e.jsx)(j,{title:(0,l.t)("alerting.search-query-help.title-labels","Labels"),expr:"label:team=A label:cluster=a1"}),(0,e.jsx)(j,{title:(0,l.t)("alerting.search-query-help.title-state","State"),expr:"state:firing|normal|pending"}),(0,e.jsx)(j,{title:(0,l.t)("alerting.search-query-help.title-type","Type"),expr:"type:alerting|recording"}),(0,e.jsx)(j,{title:(0,l.t)("alerting.search-query-help.title-health","Health"),expr:"health:ok|nodata|error"}),(0,e.jsx)(j,{title:(0,l.t)("alerting.search-query-help.title-dashboard-uid","Dashboard UID"),expr:"dashboard:eadde4c7-54e6-4964-85c0-484ab852fd04"}),(0,e.jsx)(j,{title:(0,l.t)("alerting.search-query-help.title-contact-point","Contact point"),expr:"contactPoint:slack"})]})]})}function j({title:t,expr:n}){const r=(0,E.of)(Z);return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("div",{children:t}),(0,e.jsx)("code",{className:r.code,children:n})]})}const Z=t=>({grid:(0,O.css)({display:"grid",gridTemplateColumns:"max-content auto",gap:t.spacing(1),alignItems:"center"}),code:(0,O.css)({display:"block",textAlign:"center"})});function k(t){return{content:(0,O.css)({padding:t.spacing(1)}),grid:(0,O.css)({display:"grid",gridTemplateColumns:"auto 1fr",alignItems:"center",gap:t.spacing(2)})}}}}]);

//# sourceMappingURL=8547.a1eb59fb9f5e1edecd1d.js.map