"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[9119],{9390:(Z,O,e)=>{e.d(O,{r:()=>j});var s=e(74848),n=e(90382),R=e(92745),r=e(18857);const l=Object.values(n.X).filter(d=>d!==n.X.None).map(d=>({label:d,value:d}));function j({value:d,onChange:A,"aria-label":v,inputId:m,autoFocus:i,...x}){return(0,s.jsx)(r.l6,{inputId:m,value:d,options:l,onChange:h=>A(h.value??n.X.None),placeholder:(0,R.t)("admin.org-role-picker.placeholder-choose-role","Choose role..."),"aria-label":v,autoFocus:i,...x})}},31908:(Z,O,e)=>{e.d(O,{I:()=>i});var s=e(74848),n=e(49785),R=e(47184),r=e(90382),u=e(92745),l=e(8207),j=e(89640),d=e(37386),A=e(77824);const v=Object.keys(r.X).map(R.z),m=(0,s.jsxs)(u.x6,{i18nKey:"role-picker.title.description",children:["Assign roles to users to ensure granular control over access to Grafana\u2018s features and resources. Find out more in our"," ",(0,s.jsx)(j.Y,{external:!0,href:"https://grafana.com/docs/grafana/latest/administration/roles-and-permissions/#organization-roles",children:"documentation"}),"."]}),i=({onClose:x})=>{const h=(0,n.xW)(),{control:K,getValues:P,setValue:p}=h,[U,M]=P(["name","roles"]);return(0,s.jsx)(l._,{title:U,subtitle:m,onClose:x,children:(0,s.jsx)(d.D,{label:(0,u.t)("role-picker-drawer.basic-roles.label","Basic Roles"),children:(0,s.jsx)(n.xI,{name:"role",control:K,render:({field:{onChange:D,ref:W,...S}})=>(0,s.jsx)(A.z,{...S,options:v,onChange:y=>{p("roleCollection",[y,...M]),D(y)}})})})})}},77527:(Z,O,e)=>{e.d(O,{b:()=>_});var s=e(74848),n=e(96540),R=e(51898),r=e(92745),u=e(43173),l=e(71555),j=e(66404),d=e(31286),A=e(45967),v=e(89640),m=e(30703),i=e(94018),x=e(45861),h=e(41654),K=e(27594),P=e(34213),p=e(71599),U=e(91087),M=e(34418),D=e(22803),W=e(49785),S=e(63142),y=e(99887),Y=e(31908);const w=({disabled:T,user:c})=>{const[I,B]=(0,n.useState)(!1),{badge:V,badgeDisabled:G}=(0,S.of)(b),$=T?G:V,L=(0,W.mN)({defaultValues:{name:c.name,role:c.role,roles:c.roles}}),{watch:H}=L,F=()=>{T||B(!0)};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(h.B,{gap:1,children:[(0,s.jsx)(y.E,{className:$,color:"blue",onClick:F,text:H("role")}),c.roles&&c.roles.length>0&&(0,s.jsx)(y.E,{className:$,color:"blue",onClick:F,text:(0,r.t)("role-picker-drawer.user-count","+{{numUsers}}",{numUsers:c.roles.length})})]}),I&&(0,s.jsx)(W.Op,{...L,children:(0,s.jsx)(Y.I,{onClose:()=>B(!1)})})]})};function b(T){return{badge:(0,D.css)({cursor:"pointer"}),badgeDisabled:(0,D.css)({cursor:"not-allowed"})}}var o=e(11297),t=e(73427),f=e(11257),N=e(9390);const C=`This user's role is not editable because it is synchronized from your auth provider.
Refer to the Grafana authentication docs for details.`,k=T=>{const c=T?.isExternallySynced;return!t.TP.hasPermissionInMetadata(f.w.OrgUsersWrite,T)||c},z=R.Tp.pages.UserListPage.UsersListPage,_=({users:T,orgId:c,onRoleChange:I,onUserRolesChange:B,onRemoveUser:V,fetchData:G,changePage:$,page:L,totalPages:H,rolesLoading:F})=>{const[X,J]=(0,n.useState)(null),[q,ee]=(0,n.useState)([]);(0,n.useEffect)(()=>{async function a(){try{if(t.TP.hasPermission(f.w.ActionRolesList)){let g=await(0,M.RL)(c);ee(g)}}catch{console.error("Error loading options")}}t.TP.licensedAccessControlEnabled()&&a()},[c]);const E=(0,n.useMemo)(()=>[{id:"avatarUrl",header:"",cell:({cell:{value:a}})=>a&&(0,s.jsx)(l.e,{src:a,alt:"User avatar"})},{id:"login",header:"Login",cell:({cell:{value:a}})=>(0,s.jsx)("div",{children:a}),sortType:"string"},{id:"email",header:"Email",cell:({cell:{value:a}})=>a,sortType:"string"},{id:"name",header:"Name",cell:({cell:{value:a}})=>a,sortType:"string"},{id:"lastSeenAtAge",header:"Last active",cell:({cell:{value:a}})=>(0,s.jsx)(s.Fragment,{children:a&&(0,s.jsx)(s.Fragment,{children:a==="10 years"?(0,s.jsx)(j.E,{color:"disabled",children:(0,s.jsx)(r.x6,{i18nKey:"admin.org-uers.last-seen-never",children:"Never"})}):a})}),sortType:(a,g)=>new Date(a.original.lastSeenAt).getTime()-new Date(g.original.lastSeenAt).getTime()},{id:"role",header:"Role",cell:({cell:{value:a},row:{original:g}})=>{const se=k(g),ae=async(Q,te,ne)=>{await(0,M.eA)(Q,te,ne),B&&B()};return u.$.featureToggles.rolePickerDrawer?(0,s.jsx)(w,{disabled:se,user:g}):t.TP.licensedAccessControlEnabled()?(0,s.jsx)(U.y,{userId:g.userId,roles:g.roles,apply:!0,onApplyRoles:ae,isLoading:F,orgId:c,roleOptions:q,basicRole:a,onBasicRoleChange:Q=>I(Q,g),basicRoleDisabled:se,basicRoleDisabledMessage:C,width:40}):(0,s.jsx)(N.r,{"aria-label":(0,r.t)("admin.org-users-table.columns.aria-label-role","Role"),value:a,disabled:se,onChange:Q=>I(Q,g)})}},{id:"info",header:"",cell:({row:{original:a}})=>k(a)&&(0,s.jsx)(d.a,{display:"flex",alignItems:"center",marginLeft:1,children:(0,s.jsx)(A.m,{interactive:!0,content:(0,s.jsx)("div",{children:(0,s.jsxs)(r.x6,{i18nKey:"admin.org-users.not-editable",children:["This user's role is not editable because it is synchronized from your auth provider. Refer to the\xA0",(0,s.jsx)(v.Y,{href:"https://grafana.com/docs/grafana/latest/administration/user-management/manage-org-users/#change-a-users-organization-permissions",external:!0,children:"Grafana authentication docs"}),"\xA0for details."]})}),children:(0,s.jsx)(m.I,{name:"question-circle"})})})},{id:"authLabels",header:"Origin",cell:({cell:{value:a}})=>(0,s.jsx)(s.Fragment,{children:Array.isArray(a)&&a.length>0&&(0,s.jsx)(o.E,{label:a[0],removeIcon:!1,count:0})})},{id:"isProvisioned",header:"Provisioned",cell:({cell:{value:a}})=>(0,s.jsx)(s.Fragment,{children:a&&(0,s.jsx)(i.v,{colorIndex:14,name:"Provisioned"})})},{id:"isDisabled",header:"",cell:({cell:{value:a}})=>(0,s.jsx)(s.Fragment,{children:a&&(0,s.jsx)(i.v,{colorIndex:9,name:"Disabled"})})},{id:"delete",header:"",cell:({row:{original:a}})=>t.TP.hasPermissionInMetadata(f.w.OrgUsersRemove,a)&&(0,s.jsx)(x.$n,{size:"sm",variant:"destructive",onClick:()=>{J(a)},icon:"times","aria-label":(0,r.t)("admin.org-users-table.delete-aria-label","Delete user: {{name}}",{name:a.name})})}],[F,c,q,B,I]);return(0,s.jsxs)(h.B,{direction:"column",gap:2,"data-testid":z.container,children:[(0,s.jsx)(K.j,{columns:E,data:T,getRowId:a=>String(a.userId),fetchData:G}),(0,s.jsx)(h.B,{justifyContent:"flex-end",children:(0,s.jsx)(P.d,{onNavigate:$,currentPage:L,numberOfPages:H,hideWhenSinglePage:!0})}),!!X&&(0,s.jsx)(p.u,{body:(0,r.t)("admin.org-users-table.body-delete","Are you sure you want to delete user {{user}}?",{user:X?.login}),confirmText:(0,r.t)("admin.org-users-table.confirmText-delete","Delete"),title:(0,r.t)("admin.org-users-table.title-delete","Delete"),onDismiss:()=>{J(null)},isOpen:!0,onConfirm:()=>{X&&(V(X),J(null))}})]})}},88947:(Z,O,e)=>{e.r(O),e.d(O,{default:()=>b});var s=e(74848),n=e(96540),R=e(49785),r=e(54148),u=e(41053),l=e(92745),j=e(34999),d=e(53487),A=e(37386),v=e(63527),m=e(45861),i=e(13791),x=e(73427),h=e(11257),K=e(77527),P=e(68143),p=e(81871);const U=30,M=async o=>await(0,P.AI)().get(`/api/orgs/${o}`),D=async(o,t)=>x.TP.hasPermission(h.w.OrgUsersRead)?(0,P.AI)().get(`/api/orgs/${o}/users/search`,(0,p.F)({perpage:U,page:t})):{orgUsers:[]},W=async(o,t)=>{const f=t.map(C=>C.userId),N=await(0,P.AI)().post("/api/access-control/users/roles/search?includeMapped=true",{userIds:f,orgId:o});t.forEach(C=>{C.roles=N?N[C.userId]||[]:[]})},S=(o,t)=>(0,P.AI)().patch(`/api/orgs/${t}/users/${o.userId}`,o),y=(o,t)=>(0,P.AI)().delete(`/api/orgs/${t}/users/${o.userId}`),Y=(o,t)=>(0,P.AI)().put(`/api/orgs/${t}`,{name:o}),b=()=>{const{id:o=""}=(0,r.g)(),t=parseInt(o,10),f=x.TP.hasPermission(h.w.OrgsWrite),N=x.TP.hasPermission(h.w.OrgUsersRead),[C,k]=(0,n.useState)([]),[z,_]=(0,n.useState)(1),[T,c]=(0,n.useState)(1),[I,B]=(0,u.A)(()=>M(t),[]),{handleSubmit:V,register:G,formState:{errors:$}}=(0,R.mN)(),[,L]=(0,u.A)(async E=>{const a=await D(t,E);x.TP.licensedAccessControlEnabled()&&await W(t,a.orgUsers);const g=a?.perPage!==0?Math.ceil(a.totalCount/a.perPage):0;return c(g),k(a.orgUsers),a.orgUsers},[]);(0,n.useEffect)(()=>{B(),L(z)},[B,L,z]);const H=async({orgName:E})=>{await Y(E,t)},F=()=>(0,s.jsx)(j.F,{severity:"info",title:(0,l.t)("admin.admin-edit-org-page.render-missing-permission-message.title-access-denied","Access denied"),children:(0,s.jsx)(l.x6,{i18nKey:"admin.edit-org.access-denied",children:"You do not have permission to see users in this organization. To update this organization, contact your server administrator."})}),X=E=>{_(E)},J=async E=>{await y(E,t),L(z)},q=async(E,a)=>{await S({...a,role:E},t),L(z)},ee={text:I?.value?.name??"",icon:"shield",subTitle:(0,l.t)("admin.admin-edit-org-page.page-nav.subTitle.manage-settings-roles-organization","Manage settings and user roles for an organization.")};return(0,s.jsx)(i.Y,{navId:"global-orgs",pageNav:ee,subTitle:"Manage settings for this specific org.",children:(0,s.jsx)(i.Y.Contents,{children:(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(d.s,{children:(0,s.jsx)(l.x6,{i18nKey:"admin.edit-org.heading",children:"Edit Organization"})}),I.value&&(0,s.jsxs)("form",{onSubmit:V(H),style:{maxWidth:"600px"},children:[(0,s.jsx)(A.D,{label:(0,l.t)("admin.admin-edit-org-page.label-name","Name"),invalid:!!$.orgName,error:"Name is required",disabled:!f,children:(0,s.jsx)(v.p,{...G("orgName",{required:!0}),id:"org-name-input",defaultValue:I.value.name})}),(0,s.jsx)(m.$n,{type:"submit",disabled:!f,children:(0,s.jsx)(l.x6,{i18nKey:"admin.edit-org.update-button",children:"Update"})})]}),(0,s.jsxs)("div",{style:{marginTop:"20px"},children:[(0,s.jsx)(d.s,{children:(0,s.jsx)(l.x6,{i18nKey:"admin.edit-org.users-heading",children:"Organization users"})}),!N&&F(),N&&!!C.length&&(0,s.jsx)(K.b,{users:C,orgId:t,onRoleChange:q,onRemoveUser:J,changePage:X,page:z,totalPages:T})]})]})})})}},91087:(Z,O,e)=>{e.d(O,{y:()=>d});var s=e(74848),n=e(96540),R=e(41053),r=e(73427),u=e(11257),l=e(59812),j=e(34418);const d=({basicRole:A,roles:v,userId:m,orgId:i,onBasicRoleChange:x,roleOptions:h,disabled:K,basicRoleDisabled:P,basicRoleDisabledMessage:p,apply:U=!1,onApplyRoles:M,pendingRoles:D,maxWidth:W,width:S,isLoading:y})=>{const[{loading:Y,value:w=v||[]},b]=(0,R.A)(async()=>{try{if(v)return v;if(U&&D?.length)return D;if(r.TP.hasPermission(u.w.ActionUserRolesList)&&m>0)return await(0,j.Xh)(m,i)}catch{console.error("Error loading options")}return[]},[i,m,D,v]);(0,n.useEffect)(()=>{i&&b()},[b,i]);const o=async f=>{U?M&&M(f,m,i):(await(0,j.eA)(f,m,i),await b())},t=r.TP.hasPermission(u.w.ActionUserRolesAdd)&&r.TP.hasPermission(u.w.ActionUserRolesRemove);return(0,s.jsx)(l.n,{appliedRoles:w,basicRole:A,onRolesChange:o,onBasicRoleChange:x,roleOptions:h,isLoading:Y||y,disabled:K,basicRoleDisabled:P,basicRoleDisabledMessage:p,showBasicRole:!0,apply:U,canUpdateRoles:t,maxWidth:W,width:S})}}}]);

//# sourceMappingURL=AdminEditOrgPage.8df8167ea6ff8f4803bd.js.map