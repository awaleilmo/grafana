"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[4312,4514],{1806:(ie,D,t)=>{t.d(D,{o:()=>n});var e=t(96540),s=t(92745),r=t(36303),x=t(74268);let R=null;const n=c=>{if(!R)return null;const y=(0,r.Xc)(R,{title:(0,s.t)("alerting.ai.error-boundary.alert-rule-button","AI Alert Rule Button failed to load"),style:"alertbox",errorLogger:x.vV});return(0,e.createElement)(y,c)};function g(c){R=c}},8369:(ie,D,t)=>{t.d(D,{s:()=>y});var e=t(74848),s=t(96540),r=t(92745),x=t(6975),R=t(70327),n=t(77880),g=t(25149),c=t(78102);function y({folder:o,onClose:p}){const[i,P]=(0,s.useState)("yaml");return(0,e.jsx)(g.m,{title:(0,r.t)("alerting.grafana-rule-folder-exporter.title-drawer","Export {{folderName}} rules",{folderName:o.title}),activeTab:i,onTabChange:P,onClose:p,formatProviders:Object.values(c.sl),children:(0,e.jsx)(u,{folder:o,exportFormat:i,onClose:p})})}function u({folder:o,exportFormat:p,onClose:i}){const{currentData:P="",isFetching:T}=R.hK.endpoints.exportRules.useQuery({folderUid:o.uid,format:p});if(T)return(0,e.jsx)(x._,{text:(0,r.t)("alerting.grafana-rule-folder-export-preview.text-loading","Loading....")});const l=`${o.title}-${o.uid}`;return(0,e.jsx)(n.J,{format:p,textDefinition:P,downloadFileName:l,onClose:i})}},12207:(ie,D,t)=>{t.d(D,{$s:()=>l,ww:()=>T});var e=t(74848),s=t(22803),r=t(92745),x=t(43173),R=t(50201),n=t(87063),g=t(94535),c=t(45861),y=t(89640),u=t(41654),o=t(88559),p=t(67817),i=t(88721);const P=()=>{const{canCreateGrafanaRules:v,canCreateCloudRules:S}=(0,i.V)(),C=x.$.unifiedAlerting.recordingRulesEnabled&&v;return v&&S&&C?(0,e.jsx)(o.m,{overlay:(0,e.jsxs)(n.W,{children:[(0,e.jsx)(g.D,{url:"alerting/new/grafana-recording",icon:"plus",label:(0,r.t)("alerting.list-view.empty.new-grafana-recording-rule","New recording rule")}),(0,e.jsx)(g.D,{url:"alerting/new/recording",icon:"plus",label:(0,r.t)("alerting.list-view.empty.new-ds-managed-recording-rule","New data source-managed recording rule")})]}),children:(0,e.jsx)(c.z9,{variant:"primary",icon:"plus",size:"lg",children:(0,e.jsx)(r.x6,{i18nKey:"alerting.list-view.empty.new-recording-rule",children:"New recording rule"})})}):(0,e.jsxs)(e.Fragment,{children:[v&&C&&(0,e.jsx)(c.z9,{variant:"primary",icon:"plus",size:"lg",href:"alerting/new/grafana-recording",children:(0,e.jsx)(r.x6,{i18nKey:"alerting.list-view.empty.new-grafana-recording-rule",children:"New recording rule"})}),S&&(0,e.jsx)(c.z9,{variant:"primary",icon:"plus",size:"lg",href:"alerting/new/recording",children:(0,e.jsx)(r.x6,{i18nKey:"alerting.list-view.empty.new-ds-managed-recording-rule",children:"New data source-managed recording rule"})})]})},T=()=>{const{canCreateGrafanaRules:v,canCreateCloudRules:S}=(0,i.V)(),C=v||S;return(0,e.jsx)("div",{children:(0,e.jsxs)(R.p,{message:(0,r.t)("alerting.list-view.empty.no-rules-created","You haven't created any rules yet"),variant:"call-to-action",button:C?(0,e.jsxs)(u.B,{direction:"column",alignItems:"center",justifyContent:"center",children:[C&&(0,e.jsx)(c.z9,{variant:"primary",icon:"plus",size:"lg",href:"alerting/new/alerting",children:(0,e.jsx)(r.x6,{i18nKey:"alerting.list-view.empty.new-alert-rule",children:"New alert rule"})}),(0,e.jsx)(P,{})]}):null,children:[(0,e.jsx)(r.x6,{i18nKey:"alerting.list-view.empty.provisioning",children:"You can also define rules through file provisioning or Terraform"}),(0,e.jsx)(y.Y,{href:"https://grafana.com/docs/grafana/latest/alerting/set-up/provision-alerting-resources/",external:!0,children:(0,e.jsx)(r.x6,{i18nKey:"alerting.common.learn-more",children:"Learn more"})})]})})};function l(){const{canCreateGrafanaRules:v}=(0,i.V)(),S=x.$.unifiedAlerting.recordingRulesEnabled&&v;return(0,e.jsx)(R.p,{message:(0,r.t)("alerting.list-view.empty.no-rules-created","You haven't created any rules yet"),variant:"call-to-action",children:(0,e.jsxs)(u.B,{direction:"column",alignItems:"center",justifyContent:"center",gap:2,children:[(0,e.jsxs)(u.B,{direction:"row",alignItems:"center",justifyContent:"center",children:[(0,e.jsx)(r.x6,{i18nKey:"alerting.list-view.empty.provisioning",children:"You can also define rules through file provisioning or Terraform"}),(0,e.jsx)(y.Y,{href:"https://grafana.com/docs/grafana/latest/alerting/set-up/provision-alerting-resources/",external:!0,children:(0,e.jsx)(r.x6,{i18nKey:"alerting.common.learn-more",children:"Learn more"})})]}),(0,e.jsxs)(u.B,{direction:"row",alignItems:"center",justifyContent:"center",children:[v&&(0,e.jsx)(c.z9,{variant:"primary",icon:"plus",href:"alerting/new/alerting",children:(0,e.jsx)(r.x6,{i18nKey:"alerting.list-view.empty.new-grafana-alerting-rule",children:"New alert rule"})}),v&&S&&(0,e.jsx)(c.z9,{variant:"primary",icon:"plus",href:"alerting/new/grafana-recording",children:(0,e.jsx)(r.x6,{i18nKey:"alerting.list-view.empty.new-grafana-recording-rule",children:"New recording rule"})})]})]})})}function X({dataSourceName:v}){const S=useStyles2(z),{canCreateCloudRules:C}=useRulesAccess(),N=F(v,RuleFormType.cloudAlerting),ne=F(v,RuleFormType.cloudRecording);return jsxs("div",{className:S.container,children:[jsx(Text,{variant:"h5",children:jsx(Trans,{i18nKey:"alerting.list-view.empty.ds-no-rules",children:"This data source has no rules configured"})}),C&&jsxs(Stack,{direction:"row",alignItems:"center",justifyContent:"center",children:[jsx(LinkButton,{variant:"secondary",size:"sm",icon:"plus",href:N,children:jsx(Trans,{i18nKey:"alerting.list-view.empty.new-ds-managed-alerting-rule",children:"New data source-managed alerting rule"})}),jsx(LinkButton,{variant:"secondary",size:"sm",icon:"plus",href:ne,children:jsx(Trans,{i18nKey:"alerting.list-view.empty.new-ds-managed-recording-rule",children:"New data source-managed recording rule"})})]})]})}function F(v,S){const C=S===RuleFormType.cloudAlerting?"alerting":"recording",N={dataSourceName:v,editorSettings:{simplifiedQueryEditor:!1,simplifiedNotificationEditor:!1},type:S};return createRelativeUrl(`/alerting/new/${C}`,{defaults:JSON.stringify(N)})}const z=v=>({container:css({display:"flex",gap:v.spacing(1),flexDirection:"column",alignItems:"center",justifyContent:"center",padding:v.spacing(2,1)})})},12266:(ie,D,t)=>{t.d(D,{e:()=>r});var e=t(74848),s=t(45861);const r=({isCollapsed:x,onToggle:R,idControlled:n,className:g,text:c,size:y="xl",...u})=>(0,e.jsx)(s.$n,{type:"button",fill:"text",variant:"secondary","aria-expanded":!x,"aria-controls":n,className:g,icon:x?"angle-right":"angle-down",onClick:()=>R(!x),...u,children:c})},47987:(ie,D,t)=>{t.d(D,{u:()=>y});var e=t(74848),s=t(2543),r=t(43243),x=t(1749);function R(u={},o={}){return x.P.useListReceiverQuery(u,o)}function n(u){const[o,p]=alertingAPI.endpoints.createReceiver.useMutation(u);return[P=>o(P),p]}function g(u){if((0,s.isEmpty)(u.spec.integrations))return"<empty contact point>";const o=(0,s.countBy)(u.spec.integrations,i=>i.type);return Object.entries(o).map(([i,P])=>P>1?`${i} (${P})`:i).join(", ")}const c=new Intl.Collator("en",{sensitivity:"accent"});function y(u){const{currentData:o,isLoading:p}=R({},{refetchOnFocus:!0,refetchOnMountOrArgChange:!0}),i=(0,s.chain)(o?.items).toArray().map(l=>({option:{label:l.spec.title,value:l.metadata.uid??l.spec.title,description:g(l)},contactPoint:l})).value().sort((l,X)=>c.compare(l.option.label,X.option.label)),P=i.map(l=>l.option),T=l=>{if(l==null&&u.isClearable){u.onChange(null);return}if(l){const X=i.find(({option:F})=>F.value===l.value);if(!X)return;u.onChange(X.contactPoint)}};return(0,e.jsx)(r.G,{...u,loading:p,options:P,onChange:T})}},59935:(ie,D,t)=>{t.d(D,{A:()=>Oe});var e=t(74848),s=t(22803),r=t(96540),x=t(49785),R=t(47987),n=t(92745),g=t(63142),c=t(30703),y=t(41654),u=t(37386),o=t(72636),p=t(45967),i=t(77824),P=t(63527),T=t(45861),l=t(95506),X=t(73427),F=t(11257),z=t(24619),v=t(74268),S=t(96784),C=t(98684),N=t(56369),ne=t(29609),Pe=t(38055),Ue=t(48480),We=t(29246),q=t(51898),Ve=t(78282),Se=t(36580),Ze=t(18857),Ge=t(63509),O=t(52161);const w=A=>{const _=(0,Ve.l)(),[ge,ee]=(0,r.useState)(),Ie=(J,ce)=>{if(ce.action==="clear"&&A.onClear){A.onClear();return}const fe=J[J.length-1];let he,ae;ce.action==="pop-value"||ce.action==="remove-value"?(he=ce.removedValue?.value,ae="remove"):(he=fe.value,ae="add");const re=_.getInstanceSettings(he);re&&(A.onChange(re,ae),ee({error:void 0}))},Y=()=>{const{current:J,hideTextValue:ce,noDefault:fe}=A;if(!(!J&&fe))return J?.map(he=>{const ae=_.getInstanceSettings(he);if(ae)return{label:ae.name.slice(0,37),value:ae.name,imgUrl:ae.meta.info.logos.small,hideText:ce,meta:ae.meta};const re=(0,Ue.Iz)(he);return re===Se.dR.uid||re===Se.dR.name?{label:re,value:re,hideText:ce}:{label:(re??"no name")+" - not found",value:re??void 0,imgUrl:"",hideText:ce}})},ke=()=>{const{alerting:J,tracing:ce,metrics:fe,mixed:he,dashboard:ae,variables:re,annotations:Ye,pluginId:_e,type:L,filter:Ne,logs:et}=A,Q=_.getList({alerting:J,tracing:ce,metrics:fe,logs:et,dashboard:ae,mixed:he,variables:re,annotations:Ye,pluginId:_e,filter:Ne,type:L}),at=Q.filter(O.hP).map(se=>({value:se.name,label:`${se.name}${se.isDefault?" (default)":""}`,imgUrl:se.meta.info.logos.small,meta:se.meta})),rt=Q.filter(se=>!(0,O.hP)(se)).map(se=>({value:se.name,label:`${se.name}${se.isDefault?" (default)":""}`,imgUrl:se.meta.info.logos.small,meta:se.meta}));return[{label:(0,n.t)("alerting.multiple-data-source-picker.get-data-source-options.grouped-options.label.data-sources-with-configured-alert-rules","Data sources with configured alert rules"),options:at,expanded:!0},{label:(0,n.t)("alerting.multiple-data-source-picker.get-data-source-options.grouped-options.label.other-data-sources","Other data sources"),options:rt,expanded:!0}]},{autoFocus:Me,onBlur:$e,onClear:me,openMenuOnFocus:Ae,placeholder:Te,width:Be,inputId:be,disabled:Fe=!1,isLoading:ze=!1}=A,He=ke(),Ke=Y(),qe=typeof me=="function";return(0,e.jsx)("div",{"data-testid":q.Tp.components.DataSourcePicker.container,children:(0,e.jsx)(Ze.KF,{isLoading:ze,disabled:Fe,"data-testid":q.Tp.components.DataSourcePicker.inputV2,inputId:be||"data-source-picker",className:"ds-picker select-container",isClearable:qe,backspaceRemovesValue:!0,onChange:Ie,options:He,autoFocus:Me,onBlur:$e,width:Be,openMenuOnFocus:Ae,maxMenuHeight:500,placeholder:Te,noOptionsMessage:(0,n.t)("alerting.multiple-data-source-picker.noOptionsMessage-no-datasources-found","No datasources found"),value:Ke??[],invalid:!!ge?.error||!!A.invalid,getOptionLabel:J=>J.meta&&(0,We.x)(J.meta.signature)&&J!==Ke?(0,e.jsxs)(y.B,{alignItems:"center",justifyContent:"space-between",children:[(0,e.jsx)("span",{children:J.label})," ",(0,e.jsx)(Ge.B,{status:J.meta.signature})]}):J.label||""})})};var V=t(72984);const U=[{label:"Alert ",value:z.JS.Alerting},{label:"Recording ",value:z.JS.Recording}],$=[{label:"Ok",value:N.Jc.Ok},{label:"No Data",value:N.Jc.NoData},{label:"Error",value:N.Jc.Error}],H=X.TP.hasPermission(F.w.AlertingReceiversRead),pe=Object.entries(z.cF).filter(([A,_])=>_!==z.cF.Unknown).map(([A,_])=>({label:(0,ne.XI)(_),value:_})),Ee=({onClear:A=()=>{},viewMode:_,onViewModeChange:ge})=>{const ee=(0,g.of)(Re),{pluginsFilterEnabled:Ie}=De(),{filterState:Y,hasActiveFilters:ke,searchQuery:Me,setSearchQuery:$e,updateFilters:me}=(0,S.dI)(),[Ae,Te]=(0,r.useState)(Math.floor(Math.random()*100)),Be=`dataSource-${Ae}`,be=`queryString-${Ae}`,Fe=(0,r.useRef)(null),{handleSubmit:ze,register:He,setValue:Ke}=(0,x.mN)({defaultValues:{searchQuery:Me}}),{ref:qe,...J}=He("searchQuery");(0,r.useEffect)(()=>{Ke("searchQuery",Me)},[Me,Ke]);const ce=(L,Ne)=>{const et=Ne==="add"?[...Y.dataSourceNames].concat([L.name]):Y.dataSourceNames.filter(Q=>Q!==L.name);me({...Y,dataSourceNames:et}),Te(Q=>Q+1),(0,v.iH)({filterMethod:"filter-component",filter:"dataSourceNames"})},fe=L=>Ne=>{me({...Y,[L]:Ne}),(0,v.iH)({filterMethod:"filter-component",filter:L})},he=()=>{me({...Y,dataSourceNames:[]}),Te(L=>L+1)},ae=L=>{(0,v.fH)(v.le.clickingAlertStateFilters),fe("ruleState")(L)},re=()=>{$e(void 0),A(),setTimeout(()=>Te(Ae+1),100)},Ye=L=>{fe("contactPoint")(L)},_e=(0,e.jsx)(c.I,{name:"search"});return(0,e.jsxs)(y.B,{direction:"column",gap:0,children:[(0,e.jsxs)(y.B,{direction:"row",gap:1,wrap:"wrap",children:[(0,e.jsx)(u.D,{className:ee.dsPickerContainer,label:(0,e.jsx)(o.J,{htmlFor:"data-source-picker",children:(0,e.jsxs)(y.B,{gap:.5,alignItems:"center",children:[(0,e.jsx)("span",{children:(0,e.jsx)(n.x6,{i18nKey:"alerting.rules-filter.search-by-data-sources",children:"Search by data sources"})}),(0,e.jsx)(p.m,{content:(0,e.jsxs)("div",{children:[(0,e.jsx)("p",{children:(0,e.jsx)(n.x6,{i18nKey:"alerting.rules-filter.configured-alert-rules",children:"Data sources containing configured alert rules are Mimir or Loki data sources where alert rules are stored and evaluated in the data source itself."})}),(0,e.jsx)("p",{children:(0,e.jsx)(n.x6,{i18nKey:"alerting.rules-filter.manage-alerts",children:"In these data sources, you can select Manage alerts via Alerting UI to be able to manage these alert rules in the Grafana UI as well as in the data source where they were configured."})})]}),children:(0,e.jsx)(c.I,{id:"data-source-picker-inline-help",name:"info-circle",size:"sm",title:(0,n.t)("alerting.rules-filter.data-source-picker-inline-help-title-search-by-data-sources-help","Search by data sources help")})})]})}),children:(0,e.jsx)(w,{alerting:!0,noDefault:!0,placeholder:(0,n.t)("alerting.rules-filter.placeholder-all-data-sources","All data sources"),current:Y.dataSourceNames,onChange:ce,onClear:he},Be)}),(0,e.jsx)(u.D,{className:ee.dashboardPickerContainer,label:(0,e.jsx)(o.J,{htmlFor:"filters-dashboard-picker",children:(0,e.jsx)(n.x6,{i18nKey:"alerting.rules-filter.dashboard",children:"Dashboard"})}),children:(0,e.jsx)(l.b,{inputId:"filters-dashboard-picker",value:Y.dashboardUid,onChange:L=>fe("dashboardUid")(L?.uid),isClearable:!0,cacheOptions:!0},Y.dashboardUid?"dashboard-defined":"dashboard-not-defined")}),(0,e.jsxs)("div",{children:[(0,e.jsx)(o.J,{children:(0,e.jsx)(n.x6,{i18nKey:"alerting.rules-filter.state",children:"State"})}),(0,e.jsx)(i.z,{options:pe,value:Y.ruleState,onChange:ae})]}),(0,e.jsxs)("div",{children:[(0,e.jsx)(o.J,{children:(0,e.jsx)(n.x6,{i18nKey:"alerting.rules-filter.rule-type",children:"Rule type"})}),(0,e.jsx)(i.z,{options:U,value:Y.ruleType,onChange:fe("ruleType")})]}),(0,e.jsxs)("div",{children:[(0,e.jsx)(o.J,{children:(0,e.jsx)(n.x6,{i18nKey:"alerting.rules-filter.health",children:"Health"})}),(0,e.jsx)(i.z,{options:$,value:Y.ruleHealth,onChange:fe("ruleHealth")})]}),H&&(0,e.jsx)(y.B,{direction:"column",gap:0,children:(0,e.jsx)(u.D,{label:(0,e.jsx)(o.J,{htmlFor:"contactPointFilter",children:(0,e.jsx)(n.x6,{i18nKey:"alerting.contactPointFilter.label",children:"Contact point"})}),children:(0,e.jsx)(R.u,{id:"contactPointFilter",value:Y.contactPoint??null,width:40,placeholder:(0,n.t)("alerting.notification-policies-filter.placeholder-search-by-contact-point","Choose a contact point"),isClearable:!0,onChange:L=>{Ye(L?.spec.title??"")}})})}),Ie&&(0,e.jsxs)("div",{children:[(0,e.jsx)(o.J,{children:(0,e.jsx)(n.x6,{i18nKey:"alerting.rules-filter.plugin-rules",children:"Plugin rules"})}),(0,e.jsx)(i.z,{options:[{label:(0,n.t)("alerting.rules-filter.label.show","Show"),value:void 0},{label:(0,n.t)("alerting.rules-filter.label.hide","Hide"),value:"hide"}],value:Y.plugins,onChange:L=>me({...Y,plugins:L})})]})]}),(0,e.jsxs)(y.B,{direction:"column",gap:0,children:[(0,e.jsxs)(y.B,{direction:"row",gap:1,children:[(0,e.jsxs)("form",{className:ee.searchInput,onSubmit:ze(L=>{$e(L.searchQuery),Fe.current?.blur(),(0,v.iH)({filterMethod:"search-input",filter:(0,N.XY)(L.searchQuery)})}),children:[(0,e.jsx)(u.D,{label:(0,e.jsx)(o.J,{htmlFor:"rulesSearchInput",children:(0,e.jsxs)(y.B,{gap:.5,alignItems:"center",children:[(0,e.jsx)("span",{children:(0,e.jsx)(n.x6,{i18nKey:"alerting.rules-filter.search",children:"Search"})}),(0,e.jsx)(Pe.B,{content:(0,e.jsx)(ye,{}),children:(0,e.jsx)(c.I,{name:"info-circle",size:"sm",tabIndex:0,title:(0,n.t)("alerting.rules-filter.title-search-help","Search help")})})]})}),children:(0,e.jsx)(P.p,{id:"rulesSearchInput",prefix:_e,ref:L=>{qe(L),Fe.current=L},...J,placeholder:(0,n.t)("alerting.rules-filter.rulesSearchInput-placeholder-search","Search"),"data-testid":"search-query-input"},be)}),(0,e.jsx)("input",{type:"submit",hidden:!0})]}),(0,e.jsxs)("div",{children:[(0,e.jsx)(o.J,{children:(0,e.jsx)(n.x6,{i18nKey:"alerting.rules-filter.view-as",children:"View as"})}),(0,e.jsx)(V.b,{viewMode:_,onViewModeChange:ge})]})]}),ke&&(0,e.jsx)("div",{children:(0,e.jsx)(T.$n,{fullWidth:!1,icon:"times",variant:"secondary",onClick:re,children:(0,e.jsx)(n.x6,{i18nKey:"alerting.rules-filter.clear-filters",children:"Clear filters"})})})]})]})},Re=A=>({dsPickerContainer:(0,s.css)({width:A.spacing(60),flexGrow:0,margin:0}),dashboardPickerContainer:(0,s.css)({minWidth:A.spacing(50)}),searchInput:(0,s.css)({flex:1,margin:0})});function ye(){const A=(0,g.of)(Ce);return(0,e.jsxs)("div",{children:[(0,e.jsx)("div",{children:(0,e.jsx)(n.x6,{i18nKey:"alerting.search-query-help.search-syntax",children:"Search syntax allows to query alert rules by the parameters defined below."})}),(0,e.jsx)("hr",{}),(0,e.jsxs)("div",{className:A.grid,children:[(0,e.jsx)("div",{children:(0,e.jsx)(n.x6,{i18nKey:"alerting.search-query-help.filter-type",children:"Filter type"})}),(0,e.jsx)("div",{children:(0,e.jsx)(n.x6,{i18nKey:"alerting.search-query-help.expression",children:"Expression"})}),(0,e.jsx)(K,{title:(0,n.t)("alerting.search-query-help.title-datasources","Datasources"),expr:"datasource:mimir datasource:prometheus"}),(0,e.jsx)(K,{title:(0,n.t)("alerting.search-query-help.title-folder-namespace","Folder/Namespace"),expr:"namespace:global"}),(0,e.jsx)(K,{title:(0,n.t)("alerting.search-query-help.title-group","Group"),expr:"group:cpu-usage"}),(0,e.jsx)(K,{title:(0,n.t)("alerting.search-query-help.title-rule","Rule"),expr:'rule:"cpu 80%"'}),(0,e.jsx)(K,{title:(0,n.t)("alerting.search-query-help.title-labels","Labels"),expr:"label:team=A label:cluster=a1"}),(0,e.jsx)(K,{title:(0,n.t)("alerting.search-query-help.title-state","State"),expr:"state:firing|normal|pending"}),(0,e.jsx)(K,{title:(0,n.t)("alerting.search-query-help.title-type","Type"),expr:"type:alerting|recording"}),(0,e.jsx)(K,{title:(0,n.t)("alerting.search-query-help.title-health","Health"),expr:"health:ok|nodata|error"}),(0,e.jsx)(K,{title:(0,n.t)("alerting.search-query-help.title-dashboard-uid","Dashboard UID"),expr:"dashboard:eadde4c7-54e6-4964-85c0-484ab852fd04"}),(0,e.jsx)(K,{title:(0,n.t)("alerting.search-query-help.title-contact-point","Contact point"),expr:"contactPoint:slack"})]})]})}function K({title:A,expr:_}){const ge=(0,g.of)(Ce);return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("div",{children:A}),(0,e.jsx)("code",{className:ge.code,children:_})]})}const Ce=A=>({grid:(0,s.css)({display:"grid",gridTemplateColumns:"max-content auto",gap:A.spacing(1),alignItems:"center"}),code:(0,s.css)({display:"block",textAlign:"center"})});function De(){const{components:A}=(0,C.u)();return{pluginsFilterEnabled:A.length>0}}const Oe=Ee},64628:(ie,D,t)=>{t.d(D,{i:()=>o});var e=t(74848),s=t(22803),r=t(2543),x=t.n(r),R=t(42941),n=t(92745),g=t(76319),c=t(41654),y=t(63142),u=t(49779);const o=({children:i,title:P,collapsed:T=!1,actions:l=null,pagination:X=null})=>{const F=(0,y.of)(p),[z,v]=(0,R.A)(T);return(0,e.jsxs)("li",{className:F.wrapper,role:"treeitem","aria-selected":"false",children:[(0,e.jsx)("div",{className:F.sectionTitle,children:(0,e.jsxs)(c.B,{alignItems:"center",children:[(0,e.jsxs)(c.B,{alignItems:"center",gap:.5,children:[(0,e.jsx)(g.K,{name:z?"angle-right":"angle-down",onClick:v,"aria-label":(0,n.t)("common.collapse","Collapse")}),P]}),l&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(u.h,{}),l]})]})}),!(0,r.isEmpty)(i)&&!z&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("ul",{role:"group",className:F.groupItemsWrapper,children:i}),X]})]})},p=i=>({groupItemsWrapper:(0,s.css)({position:"relative","li[role=treeitem]":{listStyle:"none",position:"relative",paddingLeft:i.spacing(6.5),"&:before":{content:"''",position:"absolute",height:"100%",marginLeft:i.spacing(-1.5),marginTop:i.spacing(-1),borderLeft:`solid 1px ${i.colors.border.weak}`}}}),wrapper:(0,s.css)({display:"flex",flexDirection:"column"}),sectionTitle:(0,s.css)({padding:i.spacing(1,1.5),"&:hover":{background:i.colors.action.hover}})})},66178:(ie,D,t)=>{t.d(D,{A:()=>r});var e=t(96540),s=function(x,R){var n=(0,e.useRef)(function(){});(0,e.useEffect)(function(){n.current=x}),(0,e.useEffect)(function(){if(R!==null){var g=setInterval(function(){return n.current()},R||0);return function(){return clearInterval(g)}}},[R])};const r=s},71774:(ie,D,t)=>{t.d(D,{M:()=>r});var e=t(74848),s=t(45861);const r=({tooltip:x,icon:R,to:n,target:g,onClick:c,className:y,tooltipPlacement:u="top",...o})=>{const p=typeof x=="string"?x:void 0;return n?(0,e.jsx)(s.z9,{tooltip:x,tooltipPlacement:u,variant:"secondary",fill:"text",icon:R,href:n,size:"sm",target:g,...o,"aria-label":p}):(0,e.jsx)(s.$n,{tooltip:x,tooltipPlacement:u,className:y,variant:"secondary",fill:"text",size:"sm",icon:R,type:"button",onClick:c,...o,"aria-label":p})}},72984:(ie,D,t)=>{t.d(D,{O:()=>u,b:()=>P});var e=t(74848),s=t(96540),r=t(77824),x=t(74268),R=t(74869),n=t(96784),g=t(20962);const c=[{icon:"folder",value:"grouped",label:"Grouped"},{icon:"list-ul",value:"list",label:"List"}];function y({viewMode:T,onViewModeChange:l}){return(0,e.jsx)(r.z,{options:c,value:T,onChange:l})}function u(){const[T,l]=(0,g.l)(),{activeFilters:X}=(0,n.dI)(),F=T.get("view")==="list"?"list":"grouped",z=X.every(N=>N==="groupName"||N==="namespace"),v=z===!1||F==="list",S=(0,s.useCallback)(N=>{l(N==="grouped"?z?{view:void 0}:{view:void 0,search:void 0}:{view:N}),(0,x.aL)({view:N})},[l,z]);return{viewMode:v?"list":"grouped",handleViewChange:S}}const o=[{label:"Grouped",value:"grouped"},{label:"List",value:"list"},{label:"State",value:"state"}];function p(){const[T,l]=(0,g.l)(),X=T.get("view"),F=i(X),z=v=>{l({view:v})};return(0,e.jsx)(r.z,{options:o,value:F,onChange:z})}function i(T){return T==="list"?"list":T==="state"?"state":"grouped"}function P({viewMode:T,onViewModeChange:l}){return(0,R.sk)()?(0,e.jsx)(y,{viewMode:T,onViewModeChange:l}):(0,e.jsx)(p,{})}},74514:(ie,D,t)=>{t.r(D),t.d(D,{default:()=>Tt});var e=t(74848),s=t(96540),r=t(74869),x=t(41053),R=t(66178),n=t(92745),g=t(41654),c=t(45861),y=t(70958),u=t(52763),o=t(74268),p=t(36826),i=t(59935),P=t(12207),T=t(90186),l=t(22803),X=t(78685),F=t(63142),z=t(34999),v=t(45967),S=t(98127),C=t(52161),N=t(77256),ne=t(29609);function Pe(){const[a,h]=(0,s.useState)(!1),[d,I]=(0,X.A)("grafana.unifiedalerting.hideErrors",!1),M=(0,S.$)(m=>m.promRules),j=(0,S.$)(m=>m.rulerRules),E=(0,F.of)(We),f=(0,s.useMemo)(()=>{const[m,B]=[M,j].map(W=>(0,C.qi)().reduce((b,G)=>{const ue=W[G.name]?.error;return W[G.name]&&ue&&!(0,ne.$7)(W[G.name])?[...b,{dataSource:G,error:ue}]:b},[])),Z=M[C.hY]?.error,le=j[C.hY]?.error,te=[],k=(0,n.t)("alerting.rule-list-errors.unknown-error","Unknown error.");return Z&&te.push((0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(n.x6,{i18nKey:"alerting.rule-list-errors.failed-to-load-grafana-rules-state",children:"Failed to load Grafana rules state:"})," ",Z.message||k]})),le&&te.push((0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(n.x6,{i18nKey:"alerting.rule-list-errors.failed-to-load-grafana-rules-config",children:"Failed to load Grafana rules config:"})," ",le?.message||k]})),m.forEach(({dataSource:W,error:b})=>te.push((0,e.jsxs)(e.Fragment,{children:[(0,e.jsxs)(n.x6,{i18nKey:"alerting.rule-list-errors.failed-to-load-rules-state",values:{dataSource:W.name},children:["Failed to load rules state from"," ",(0,e.jsx)("a",{href:(0,N.GD)(W.uid),className:E.dsLink,children:"{{dataSource}}"})]}),": ",b.message||k]}))),B.forEach(({dataSource:W,error:b})=>te.push((0,e.jsxs)(e.Fragment,{children:[(0,e.jsxs)(n.x6,{i18nKey:"alerting.rule-list-errors.failed-to-load-rules-config",values:{dataSource:W.name},children:["Failed to load rules config from"," ",(0,e.jsx)("a",{href:(0,N.GD)(W.uid),className:E.dsLink,children:"{{dataSource}}"})]}),": ",b.message||k]}))),te},[M,j,E.dsLink]);return(0,e.jsxs)(e.Fragment,{children:[!!f.length&&d&&(0,e.jsx)(Ue,{count:f.length,onClick:()=>I(m=>!m)}),!!f.length&&!d&&(0,e.jsxs)(z.F,{"data-testid":"cloud-rulessource-errors",title:(0,n.t)("alerting.rule-list-errors.cloud-rulessource-errors-title-errors-loading-rules","Errors loading rules"),severity:"error",onRemove:()=>I(!0),children:[a&&f.map((m,B)=>(0,e.jsx)("div",{children:m},B)),!a&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("div",{children:f[0]}),f.length>=2&&(0,e.jsx)(c.$n,{className:E.moreButton,fill:"text",icon:"angle-right",size:"sm",onClick:()=>h(!0),children:(0,e.jsxs)(n.x6,{i18nKey:"alerting.rule-list-errors.more-errors",count:f.length-1,children:["{{count}}"," more errors"]})})]})]})]})}const Ue=({count:a,onClick:h})=>{const d=(0,F.of)(We);return(0,e.jsx)("div",{className:d.floatRight,children:(0,e.jsx)(v.m,{content:(0,n.t)("alerting.error-summary-button.content-show-all-errors","Show all errors"),placement:"bottom",children:(0,e.jsx)(c.$n,{fill:"text",variant:"destructive",icon:"exclamation-triangle",onClick:h,children:(0,e.jsxs)(n.x6,{i18nKey:"alerting.rule-list-errors.button-errors",count:a,children:["{{count}}"," errors"]})})})})},We=a=>({moreButton:(0,l.css)({padding:0}),floatRight:(0,l.css)({display:"flex",justifyContent:"flex-end"}),dsLink:(0,l.css)({fontWeight:a.typography.fontWeightBold,color:a.colors.text.link})});var q=t(16692),Ve=t(24898),Se=t(54148),Ze=t(5556),Ge=t(43173),O=t(66404),w=t(6975),V=t(68079),U=t(34213),$=t(99887),H=t(15130),pe=t(11257),Ee=t(95943),Re=t(74048),ye=t(18771),K=t(36200),Ce=t(92367),De=t(51898),Oe=t(30703),A=t(18404),_=t(11940),ge=t(88721),ee=t(29442),Ie=t(12266),Y=t(40360),ke=t(8369),Me=t(88589),$e=t(85597),me=t(71774),Ae=t(46672),Te=t(22971);const Be=s.memo(({group:a,namespace:h,expandAll:d,viewMode:I})=>{const{rulesSource:M}=h,j=(0,C.EV)(M),E=(0,Te.ZI)(M),f=(0,F.of)(ze),[m,B]=(0,s.useState)(void 0),[Z,le]=(0,s.useState)(!d);(0,s.useEffect)(()=>{le(!d)},[d]);const{hasRuler:te}=(0,_.y)(h.rulesSource),k=a.rules[0]?.rulerRule,W=k&&ne.p.grafana.rule(k)&&k.grafana_alert.namespace_uid||void 0,{folder:b}=(0,A.a)(W),{canEditRules:G}=(0,ge.V)(),ue=te&&E&&!a.rules.find(de=>!!de.rulerRule),Qe=(0,ne.YN)(a),we=a.rules.some(de=>ne.p.grafana.rule(de.rulerRule)&&de.rulerRule.grafana_alert.provenance),tt=a.rules.some(de=>(0,ne.Tm)(de.rulerRule??de.promRule)),Xe=te&&!we&&!Qe&&!tt&&G(j),ve=I==="list",Le=I==="grouped",oe=[];if(ue)oe.push((0,e.jsxs)(g.B,{children:[(0,e.jsx)(V.y,{}),(0,e.jsx)(n.x6,{i18nKey:"alerting.rules-group.deleting",children:"Deleting"})]},"is-deleting"));else if(M===C.hY){if(W){const de=(0,N.NH)(W);Le&&(oe.push((0,e.jsx)(me.M,{"aria-label":(0,n.t)("alerting.rule-group-action.details","rule group details"),icon:"info-circle",tooltip:(0,n.t)("alerting.rule-group-action.details","rule group details"),to:ee.TN.detailsPageLink("grafana",W,a.name,{includeReturnTo:!0})},"rule-group-details")),b?.canSave&&Xe&&oe.push((0,e.jsx)(me.M,{"aria-label":(0,n.t)("alerting.rule-group-action.edit","edit rule group"),icon:"pen",tooltip:(0,n.t)("alerting.rule-group-action.edit","edit rule group"),to:ee.TN.editPageLink("grafana",W,a.name,{includeReturnTo:!0})},"rule-group-edit"))),b?.canSave&&ve&&(oe.push((0,e.jsx)(me.M,{"aria-label":(0,n.t)("alerting.rule-group-action.go-to-folder","go to folder"),icon:"folder-open",tooltip:(0,n.t)("alerting.rule-group-action.go-to-folder","go to folder"),to:de,target:"__blank"},"goto")),b?.canAdmin&&oe.push((0,e.jsx)(me.M,{"aria-label":(0,n.t)("alerting.rule-group-action.manage-permissions","manage permissions"),icon:"lock",tooltip:(0,n.t)("alerting.rule-group-action.manage-permissions","manage permissions"),to:de+"/permissions",target:"__blank"},"manage-perms"))),b&&ve&&oe.push((0,e.jsx)($e.m,{folderUID:W},"folder-bulk-actions"))}}else oe.push((0,e.jsx)(me.M,{"aria-label":(0,n.t)("alerting.rule-group-action.details","rule group details"),icon:"info-circle",tooltip:(0,n.t)("alerting.rule-group-action.details","rule group details"),to:ee.TN.detailsPageLink(M.uid,h.name,a.name,{includeReturnTo:!0})},"rule-group-details")),Xe&&oe.push((0,e.jsx)(me.M,{"aria-label":(0,n.t)("alerting.rule-group-action.edit","edit rule group"),icon:"pen",tooltip:(0,n.t)("alerting.rule-group-action.edit","edit rule group"),to:ee.TN.editPageLink(M.uid,h.name,a.name,{includeReturnTo:!0})},"rule-group-edit"));const nt=ve?(0,e.jsx)(Y.c,{namespace:(0,Me.EL)(h).name}):(0,e.jsx)(Y.c,{namespace:(0,Me.EL)(h).name,group:a.name});return(0,e.jsxs)("div",{className:f.wrapper,"data-testid":"rule-group",children:[(0,e.jsxs)("div",{className:f.header,"data-testid":"rule-group-header",children:[(0,e.jsx)(Ie.e,{size:"sm",className:f.collapseToggle,isCollapsed:Z,onToggle:le,"data-testid":De.Tp.components.AlertRules.groupToggle}),(0,e.jsx)(Fe,{isCollapsed:Z}),(0,e.jsx)(be,{rulesSource:M}),(0,e.jsxs)("div",{className:f.groupName,onClick:()=>le(!Z),children:[Qe&&(0,e.jsx)($.E,{color:"purple",text:(0,n.t)("alerting.rules-group.text-federated","Federated")})," ",nt]}),(0,e.jsx)("div",{className:f.spacer}),(0,e.jsx)("div",{className:f.headerStats,children:(0,e.jsx)(Ae.j7,{group:a})}),we&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("div",{className:f.actionsSeparator,children:"|"}),(0,e.jsx)("div",{className:f.actionIcons,children:(0,e.jsx)($.E,{color:"purple",text:(0,n.t)("alerting.rules-group.text-provisioned","Provisioned")})})]}),!!oe.length&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("div",{className:f.actionsSeparator,children:"|"}),(0,e.jsx)("div",{className:f.actionIcons,children:(0,e.jsx)(g.B,{gap:.5,children:oe})})]})]}),!Z&&(0,e.jsx)(Te.sF,{showSummaryColumn:!0,className:f.rulesTable,showGuidelines:!0,showNextEvaluationColumn:!!a.interval,rules:a.rules}),b&&m==="folder"&&(0,e.jsx)(ke.s,{folder:b,onClose:()=>B(void 0)})]})});Be.displayName="RulesGroup";const be=s.memo(({rulesSource:a})=>{const h=(0,F.of)(ze);return(0,C.Eb)(a)?(0,e.jsx)(v.m,{content:a.name,placement:"top",children:(0,e.jsx)("img",{alt:a.meta.name,className:h.dataSourceIcon,src:a.meta.info.logos.small})}):null});be.displayName="CloudSourceLogo";const Fe=s.memo(({isCollapsed:a})=>(0,e.jsx)(Oe.I,{name:a?"folder":"folder-open"}));Fe.displayName="FolderIcon";const ze=a=>({wrapper:(0,l.css)({}),header:(0,l.css)({display:"flex",flexDirection:"row",alignItems:"center",padding:`${a.spacing(1)} ${a.spacing(1)} ${a.spacing(1)} 0`,flexWrap:"nowrap",borderBottom:`1px solid ${a.colors.border.weak}`,"&:hover":{backgroundColor:a.components.table.rowHoverBackground}}),headerStats:(0,l.css)({flexShrink:0,span:{verticalAlign:"middle"},[a.breakpoints.down("sm")]:{order:2,width:"100%",paddingLeft:a.spacing(1)}}),groupName:(0,l.css)({marginLeft:a.spacing(1),marginBottom:0,cursor:"pointer",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"}),spacer:(0,l.css)({flex:1}),collapseToggle:(0,l.css)({background:"none",border:"none",marginTop:`-${a.spacing(1)}`,marginBottom:`-${a.spacing(1)}`,svg:{marginBottom:0}}),dataSourceIcon:(0,l.css)({width:a.spacing(2),height:a.spacing(2),marginLeft:a.spacing(2)}),dataSourceOrigin:(0,l.css)({marginRight:"1em",color:a.colors.text.disabled}),actionsSeparator:(0,l.css)({margin:`0 ${a.spacing(2)}`}),actionIcons:(0,l.css)({width:"120px",alignItems:"center",flexShrink:0}),rulesTable:(0,l.css)({margin:a.spacing(2,0)}),rotate90:(0,l.css)({transform:"rotate(90deg)"})});function He(a){return(0,s.useMemo)(()=>a.flatMap(h=>h.groups.map(d=>({namespace:h,group:d}))),[a])}const Ke=({namespaces:a,expandAll:h})=>{const d=(0,F.of)(qe),I=(0,S.$)(G=>G.promRules),M=(0,s.useMemo)(C.qi,[]),j=He(a),E=(0,s.useMemo)(()=>M.filter(G=>(0,K.ML)(I[G.name])),[I,M]),f=M.some(G=>!!I[G.name]?.result?.length),m=M.length>0,B=E.length>0,Z=a.length>0,{numberOfPages:le,onPageChange:te,page:k,pageItems:W}=(0,Re.W)(j,1,Ee.FG),b=m&&Ge.$.featureToggles.alertingMigrationUI&&H.TP.hasPermission(pe.w.AlertingRuleCreate)&&H.TP.hasPermission(pe.w.AlertingProvisioningSetStatus);return(0,e.jsxs)("section",{className:d.wrapper,children:[(0,e.jsx)(g.B,{gap:2,direction:"column",children:(0,e.jsx)("div",{className:d.sectionHeader,children:(0,e.jsxs)("div",{className:d.headerRow,children:[(0,e.jsx)(O.E,{element:"h2",variant:"h5",children:(0,e.jsx)(n.x6,{i18nKey:"alerting.list-view.section.dataSourceManaged.title",children:"Data source-managed"})}),E.length?(0,e.jsx)(w._,{className:d.loader,text:(0,n.t)("alerting.list-view.section.loading-rules","Loading rules from {{count}} sources",{count:E.length})}):(0,e.jsx)("div",{}),(0,e.jsxs)(g.B,{gap:1,children:[b&&f&&(0,e.jsx)(ce,{}),(0,e.jsx)(J,{})]})]})})}),W.map(({group:G,namespace:ue})=>(0,e.jsx)(Be,{group:G,namespace:ue,expandAll:h,viewMode:"grouped"},`${(0,C.v0)(ue.rulesSource)}-${ue.name}-${G.name}`)),!m&&(0,e.jsx)("p",{children:(0,e.jsx)(n.x6,{i18nKey:"alerting.list-view.no-prom-or-loki-rules",children:"There are no Prometheus or Loki data sources configured"})}),m&&!B&&!Z&&(0,e.jsx)("p",{children:(0,e.jsx)(n.x6,{i18nKey:"alerting.list-view.no-rules",children:"No rules found."})}),!f&&B&&(0,e.jsx)(V.y,{size:"xl",className:d.spinner}),(0,e.jsx)(U.d,{className:d.pagination,currentPage:k,numberOfPages:le,onNavigate:te,hideWhenSinglePage:!0})]})},qe=a=>({loader:(0,l.css)({marginBottom:0}),sectionHeader:(0,l.css)({display:"flex",justifyContent:"space-between"}),wrapper:(0,l.css)({marginBottom:a.spacing(4)}),spinner:(0,l.css)({textAlign:"center",padding:a.spacing(2)}),pagination:(0,ye.H)(a),headerRow:(0,l.css)({display:"flex",alignItems:"center",justifyContent:"space-between",width:"100%",marginBottom:a.spacing(1)})});function J(){const[a,h]=(0,q.Ej)(q.RY.CreateExternalAlertRule),d=(0,Se.zy)();return a&&h?(0,e.jsx)(c.z9,{href:Ze.kM.renderUrl("alerting/new/recording",{returnTo:d.pathname+d.search}),icon:"plus",variant:"secondary",children:(0,e.jsx)(n.x6,{i18nKey:"alerting.list-view.empty.new-ds-managed-recording-rule",children:"New data source-managed recording rule"})},"new-recording-rule"):null}function ce(){const a=(0,Ce.G)("/alerting/import-datasource-managed-rules");return(0,e.jsx)(c.z9,{variant:"secondary",href:a,icon:"arrow-up",children:(0,e.jsxs)(g.B,{direction:"row",gap:1,alignItems:"center",children:[(0,e.jsx)(n.x6,{i18nKey:"alerting.rule-list.import-to-gma.text",children:"Import to Grafana-managed rules"}),(0,e.jsx)($.E,{text:(0,n.t)("alerting.rule-list.import-to-gma.new-badge","New!"),"aria-label":(0,n.t)("alerting.migrate-to-gmabutton.aria-label-new","new"),color:"blue",icon:"rocket"})]})})}var fe=t(42941),he=t(23265),ae=t(94332);const re=({namespaces:a,expandAll:h})=>{const d=(0,F.of)(Ye),[I]=(0,y.s)(),{prom:M,ruler:j}=(0,S.$)(Le=>({prom:Le.promRules[C.hY]||K.jA,ruler:Le.rulerRules[C.hY]||K.jA})),E=M.loading||j.loading,f=!!M.result||!!j.result,m=I.view==="list",B=m?(0,he.Jr)(a):a,Z=He(B),{numberOfPages:le,onPageChange:te,page:k,pageItems:W}=(0,Re.W)(Z,1,Ee.FG),[b,G]=(0,q.Ej)(q.RY.ExportGrafanaManagedRules),ue=b&&G,[Qe,we]=(0,fe.A)(!1),tt=a.length>0,{canCreateGrafanaRules:Xe}=(0,ge.V)(),ve=Ge.$.unifiedAlerting.recordingRulesEnabled&&Xe;return(0,e.jsxs)("section",{className:d.wrapper,children:[(0,e.jsx)("div",{className:d.sectionHeader,children:(0,e.jsxs)("div",{className:d.headerRow,children:[(0,e.jsx)(O.E,{element:"h2",variant:"h5",children:(0,e.jsx)(n.x6,{i18nKey:"alerting.list-view.section.grafanaManaged.title",children:"Grafana-managed"})}),E?(0,e.jsx)(w._,{className:d.loader,text:(0,n.t)("alerting.list-view.section.grafanaManaged.loading","Loading...")}):(0,e.jsx)("div",{}),(0,e.jsxs)(g.B,{direction:"row",alignItems:"center",justifyContent:"flex-end",children:[tt&&ue&&(0,e.jsx)(c.$n,{"aria-label":(0,n.t)("alerting.grafana-rules.export-all-grafana-rules-aria-label-export-all-grafana-rules","export all grafana rules"),"data-testid":"export-all-grafana-rules",icon:"download-alt",tooltip:(0,n.t)("alerting.grafana-rules.export-all-grafana-rules-tooltip-export-all-grafanamanaged-rules","Export all Grafana-managed rules"),onClick:we,variant:"secondary",children:(0,e.jsx)(n.x6,{i18nKey:"alerting.list-view.section.grafanaManaged.export-rules",children:"Export rules"})}),ve&&(0,e.jsx)(c.z9,{href:(0,Ce.G)("/alerting/new/grafana-recording",{returnTo:"/alerting/list"+window.location.search}),icon:"plus",variant:"secondary",tooltip:(0,n.t)("alerting.grafana-rules.tooltip-create-new-grafanamanaged-recording-rule","Create new Grafana-managed recording rule"),onClick:()=>(0,o.fH)(o.le.grafanaRecording),children:(0,e.jsx)(n.x6,{i18nKey:"alerting.list-view.section.grafanaManaged.new-recording-rule",children:"New recording rule"})})]})]})}),W.map(({group:Le,namespace:oe})=>(0,e.jsx)(Be,{group:Le,namespace:oe,expandAll:h,viewMode:m?"list":"grouped"},`${oe.name}-${Le.name}`)),f&&B?.length===0&&(0,e.jsx)("p",{children:(0,e.jsx)(n.x6,{i18nKey:"alerting.grafana-rules.no-rules-found",children:"No rules found."})}),!f&&E&&(0,e.jsx)(V.y,{size:"xl",className:d.spinner}),(0,e.jsx)(U.d,{className:d.pagination,currentPage:k,numberOfPages:le,onNavigate:te,hideWhenSinglePage:!0}),ue&&Qe&&(0,e.jsx)(ae.F,{onClose:we})]})},Ye=a=>({loader:(0,l.css)({marginBottom:0}),sectionHeader:(0,l.css)({display:"flex",justifyContent:"space-between",marginBottom:a.spacing(1)}),wrapper:(0,l.css)({marginBottom:a.spacing(4)}),spinner:(0,l.css)({textAlign:"center",padding:a.spacing(2)}),pagination:(0,ye.H)(a),headerRow:(0,l.css)({display:"flex",alignItems:"center",justifyContent:"space-between",width:"100%",flexDirection:"row"})}),_e=({namespaces:a,expandAll:h})=>{const[d,I]=(0,s.useMemo)(()=>{const M=a.map(j=>({...j,groups:j.groups.sort((E,f)=>E.name.localeCompare(f.name))})).sort((j,E)=>j.name.localeCompare(E.name));return[M.filter(j=>(0,C.z2)(j.rulesSource)),M.filter(j=>(0,C.Eb)(j.rulesSource))]},[a]);return(0,s.useEffect)(()=>{(0,o.fH)(o.le.loadedList)},[]),(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(Ve._,{actions:[q.RY.ViewAlertRule],children:(0,e.jsx)(re,{namespaces:d,expandAll:h})}),(0,e.jsx)(Ve._,{actions:[q.RY.ViewExternalAlertRule],children:(0,e.jsx)(Ke,{namespaces:I,expandAll:h})})]})};var L=t(49185),Ne=t(47327),et=t(72489),Q=t(24619),at=t(87154),rt=t(64628),st=t(94646),se=t(22973),mt=t(3969);const ft=({namespaces:a})=>{const[h,{width:d}]=(0,L.A)(),I=pt(),j=(0,s.useMemo)(()=>{const E=new Map([[Q.cF.Firing,[]],[Q.cF.Pending,[]],[Q.cF.Recovering,[]],[Q.cF.Inactive,[]],[Q.cF.Unknown,[]]]);return a.forEach(f=>f.groups.forEach(m=>m.rules.forEach(B=>{ne.R$.alertingRule(B.promRule)&&B.promRule.state&&E.get(B.promRule.state)?.push(B)}))),E.forEach(f=>f.sort((m,B)=>m.name.localeCompare(B.name))),E},[a]).entries();return(0,e.jsxs)("ul",{role:"tree",ref:h,children:[I&&(0,e.jsx)(Ne.G,{width:d}),(0,e.jsx)(g.B,{direction:"column",children:Array.from(j).map(([E,f])=>(0,e.jsx)(xt,{state:E,rules:f},E))})]})},ht={[Q.cF.Firing]:"Firing",[Q.cF.Pending]:"Pending",[Q.cF.Inactive]:"Normal",[Q.cF.Recovering]:"Recovering",[Q.cF.Unknown]:"Unknown"},xt=({state:a,rules:h})=>{const{page:d,pageItems:I,numberOfPages:M,onPageChange:j}=(0,Re.W)(h,1,Ee.FG),E=a!==Q.cF.Firing,f=h.length>0;return(0,e.jsx)(rt.i,{title:(0,e.jsxs)(g.B,{alignItems:"center",gap:0,children:[ht[a]??"Unknown",(0,e.jsx)(et.p,{value:h.length})]}),collapsed:E||f,pagination:(0,e.jsx)(U.d,{currentPage:d,numberOfPages:M,onNavigate:j,hideWhenSinglePage:!0}),children:I.map(m=>{const{rulerRule:B,promRule:Z}=m,le=B?(0,ne.Nv)(B):!1,te=ne.R$.alertingRule(m.promRule)?(0,se.rf)(m.instanceTotals):void 0;if(!Z)return null;const k=(0,ne.uo)(m.promRule);return(0,e.jsx)(at.WG,{name:m.name,href:(0,N.w$)(m.namespace.rulesSource,m),summary:m.annotations.summary,state:a,health:m.promRule?.health,error:m.promRule?.lastError,labels:m.promRule?.labels,isProvisioned:le,instancesCount:te,namespace:m.namespace.name,group:m.group.name,actions:(0,e.jsx)(mt.l,{compact:!0,rule:m,rulesSource:m.namespace.rulesSource}),origin:k},(0,st.jY)(Z))})})};function pt(){const a=(0,S.$)(j=>j.promRules),h=(0,s.useMemo)(C.qi,[]),d=(0,S.$)(j=>{const E=(0,K.ML)(j.promRules[C.hY]),f=(0,K.ML)(j.rulerRules[C.hY]);return E||f}),I=h.some(j=>(0,K.ML)(a[j.name]));return d||I}var lt=t(96784),Je=t(11018),vt=t(95443),jt=t(77833),ot=t(25992),Et=t(1806),it=t(39187);const ct=(0,s.memo)(({hasAlertRulesCreated:a})=>a?(0,e.jsxs)(g.B,{gap:1,children:[(0,e.jsx)(Rt,{}),(0,e.jsx)(yt,{})]}):null);ct.displayName="RuleListActionButtons";function Rt(){const[a,h]=(0,q.Ej)(q.RY.CreateAlertRule),[d,I]=(0,q.Ej)(q.RY.CreateExternalAlertRule),M=(0,it.w)(),j=d&&I,E=a&&h;return E||j?(0,e.jsxs)(g.B,{direction:"row",gap:1,children:[E&&(0,e.jsx)(Et.o,{}),(0,e.jsx)(c.z9,{href:(0,Ce.G)("/alerting/new/alerting",{returnTo:M}),icon:"plus",onClick:()=>(0,ot.fH)(o.le.alertRuleFromScratch),children:(0,e.jsx)(n.x6,{i18nKey:"alerting.rule-list.new-alert-rule",children:"New alert rule"})})]}):null}function yt(){const a=(0,it.w)(),h=(0,Ce.G)("/alerting/export-new-rule",{returnTo:a});return(0,e.jsx)(c.z9,{href:h,icon:"download-alt",variant:"secondary",tooltip:(0,n.t)("alerting.export-new-rule-button.tooltip-export-new-grafana-rule","Export new grafana rule"),onClick:()=>(0,ot.fH)(o.le.exportNewGrafanaRule),children:(0,e.jsx)(n.x6,{i18nKey:"alerting.list-view.section.grafanaManaged.export-new-rule",children:"Export rule definition"})})}const ut={groups:_e,state:ft},Ct=T.Ys+1,dt=(0,r.wS)(),Pt=()=>{const a=(0,u.wA)(),h=(0,s.useMemo)(C.gR,[]),[d,I]=(0,s.useState)(!1),M=(0,s.useCallback)(()=>I(!1),[]),[j]=(0,y.s)(),{filterState:E,hasActiveFilters:f}=(0,lt.dI)(),m=E.labels.length>0,B=j.view,Z=B==="state"||B==="groups"?B:"groups",le=ut[Z]?Z:"groups",te=ut[le],k=(0,S.$)(je=>je.promRules),W=(0,S.$)(je=>je.rulerRules),b=h.some(je=>k[je]?.loading||W[je]?.loading),G=Object.entries(k),ue=Object.entries(W),Qe=G.every(([je,xe])=>xe.dispatched&&(xe?.result!==void 0||xe?.error!==void 0)),we=ue.every(([je,xe])=>xe.dispatched&&(xe?.result!==void 0||xe?.error!==void 0)),tt=G.every(([je,xe])=>xe.dispatched&&xe?.result?.length===0),Xe=ue.every(([je,xe])=>Object.entries(xe?.result??{}).every(([Ft,St])=>St?.length===0)&&xe.dispatched),ve=m?void 0:Ct,[Le,oe]=(0,x.A)(async()=>{b||(dt?(await a((0,Je.eB)({rulesSourceName:C.hY})),await a((0,Je.nV)(!1,{limitAlerts:ve}))):await a((0,Je.yo)(!1,{limitAlerts:ve})))},[b,ve,a]);(0,s.useEffect)(()=>{(0,o.Sq)().catch(()=>{})},[]),(0,s.useEffect)(()=>{dt?(a((0,Je.eB)({rulesSourceName:C.hY})),a((0,Je.nV)(!1,{limitAlerts:ve}))):a((0,Je.yo)(!1,{limitAlerts:ve}))},[a,ve]),(0,R.A)(oe,vt.HH);const nt=Qe&&tt&&G.length>0&&Xe&&we,de=!nt,Lt=(0,he.dy)(),gt=(0,lt.i7)(Lt,E);return(0,e.jsx)(p.d,{navId:"alert-list",isLoading:!1,renderTitle:je=>(0,e.jsx)(jt.Q,{title:je}),actions:(0,e.jsx)(ct,{hasAlertRulesCreated:de}),children:(0,e.jsxs)(g.B,{direction:"column",children:[(0,e.jsx)(Pe,{}),(0,e.jsx)(i.A,{onClear:M}),de&&(0,e.jsx)(g.B,{direction:"row",alignItems:"center",children:le==="groups"&&f&&(0,e.jsx)(c.$n,{icon:d?"angle-double-up":"angle-double-down",variant:"secondary",onClick:()=>I(!d),children:d?(0,n.t)("alerting.rule-list-v1.collapse-all","Collapse all"):(0,n.t)("alerting.rule-list-v1.expand-all","Expand all")})}),(0,e.jsx)(Ae.M_,{namespaces:gt}),nt&&(0,e.jsx)(P.ww,{}),de&&(0,e.jsx)(te,{expandAll:d,namespaces:gt})]})})};var Dt=t(88547);const Mt=(0,s.lazy)(()=>Promise.all([t.e(4162),t.e(4732)]).then(t.bind(t,14732))),At=()=>{const a=(0,r.sk)();return(0,e.jsx)(s.Suspense,{children:a?(0,e.jsx)(Mt,{}):(0,e.jsx)(Pt,{})})},Tt=(0,Dt.S)(At)},77833:(ie,D,t)=>{t.d(D,{Q:()=>y});var e=t(74848),s=t(92745),r=t(43173),x=t(27489),R=t(45861),n=t(41654),g=t(74869),c=t(1487);function y({title:u}){const o=r.$.featureToggles.alertingListViewV2PreviewToggle??!1,p=(0,g.sk)(),i=()=>{p?((0,c.J)("alertingListViewV2",!1),(0,x.rR)("alerting.list_view.v2.disabled")):((0,c.J)("alertingListViewV2",!0),(0,x.rR)("alerting.list_view.v2.enabled")),window.location.reload()},P=p?{variant:"secondary",icon:void 0,children:(0,s.t)("alerting.rule-list.toggle.go-back-to-old-look","Go back to the old look"),"data-testid":"alerting-list-view-toggle-v1"}:{variant:"primary",icon:"rocket",children:(0,s.t)("alerting.rule-list.toggle.try-out-the-new-look","Try out the new look!"),"data-testid":"alerting-list-view-toggle-v2"};return(0,e.jsxs)(n.B,{direction:"row",alignItems:"center",justifyContent:"space-between",gap:2,children:[(0,e.jsx)("h1",{children:u}),o&&(0,e.jsx)("div",{children:(0,e.jsx)(R.$n,{size:"sm",fill:"outline",...P,onClick:i,className:"fs-unmask"})})]})}},85597:(ie,D,t)=>{t.d(D,{m:()=>Ve});var e=t(74848),s=t(96540),r=t(92745),x=t(43173),R=t(36490),n=t(87063),g=t(88559),c=t(52763),y=t(5709),u=t(55143),o=t(77295);const p=y.H.injectEndpoints({endpoints:O=>({pauseFolder:O.mutation({query:({namespace:w,notificationOptions:V})=>{const U=(0,r.t)("alerting.bulk-actions.pause.success","Rules evaluation successfully paused for folder"),{path:$,params:H}=(0,o.$o)(u.b).namespace(w);return{url:$,params:H,body:{is_paused:!0},method:"PATCH",notificationOptions:{successMessage:U,...V}}}}),unpauseFolder:O.mutation({query:({namespace:w,notificationOptions:V})=>{const U=(0,r.t)("alerting.bulk-actions.unpause.success","Rules successfully unpaused for this folder"),{path:$,params:H}=(0,o.$o)(u.b).namespace(w);return{url:$,params:H,body:{is_paused:!1},method:"PATCH",notificationOptions:{successMessage:U,...V}}}}),deleteGrafanaRulesFromFolder:O.mutation({query:({namespace:w,notificationOptions:V})=>{const U=(0,r.t)("alerting.bulk-actions.delete.success","Rules successfully deleted from folder"),{path:$,params:H}=(0,o.$o)(u.b).namespace(w);return{url:$,params:H,method:"DELETE",notificationOptions:{successMessage:U,...V}}}})})});var i=t(74869),P=t(16692),T=t(18404),l=t(11018),X=t(52161),F=t(77256),z=t(92367),v=t(50072),S=t(8369),C=t(71599),N=t(66404),ne=t(35137),Pe=t(74268);const Ue=s.memo(({onConfirm:O,onDismiss:w,isOpen:V,folderName:U})=>{const[$,H]=(0,s.useState)(!1),pe=async()=>{H(!0);try{await O(),(0,Pe.D0)(),w()}catch{(0,Pe.Ks)()}finally{H(!1)}};return(0,e.jsx)(C.u,{body:(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(N.E,{element:"p",children:(0,e.jsxs)(r.x6,{i18nKey:"alerting.folder-bulk-actions.delete-modal-text",values:{folderName:U},children:["This action will delete all alert rules in the ",(0,e.jsx)("code",{children:"{{folderName}}"})," folder. Nested folders will not be affected."]})}),(0,e.jsx)(ne.$,{v:2})]}),confirmationText:(0,r.t)("alerting.folder-bulk-actions.delete-modal-confirmation-text","Delete"),confirmText:$?(0,r.t)("alerting.folder-bulk-actions.delete-modal-deleting","Deleting..."):(0,r.t)("alerting.folder-bulk-actions.delete-modal-delete-button","Delete"),onDismiss:w,onConfirm:pe,title:(0,r.t)("alerting.folder-bulk-actions.delete-modal-title","Delete"),isOpen:V})});Ue.displayName="DeleteModal";var We=t(64762);function q({folderUID:O,executeAction:w,isLoading:V,action:U}){const $=(0,We._2)(),H=U==="pause"?(0,r.t)("alerting.folder-bulk-actions.pause.button.label","Pause all rules"):(0,r.t)("alerting.folder-bulk-actions.unpause.button.label","Resume all rules"),pe=U==="pause"?"pause":"play",Ee=U==="pause"?Pe.QA:Pe.Zc,Re=U==="pause"?Pe.D_:Pe.a5,ye=async()=>{try{await w(O),Ee()}catch(K){Re(),$.error((0,r.t)("alerting.folder-bulk-actions.error","Failed to execute action for folder: {{error}}",{error:(0,F.JZ)(K)}))}};return(0,e.jsx)(n.W.Item,{label:H,icon:pe,disabled:V,onClick:ye})}const Ve=({folderUID:O})=>{const[w,V]=(0,s.useState)(!1),[U,$]=(0,s.useState)(!1),H=x.$.featureToggles.alertingBulkActionsInUI,pe=(0,i.sk)(),[Ee,Re]=(0,P.Ej)(P.RY.ExportGrafanaManagedRules),ye=Ee&&Re,[K,Ce]=p.endpoints.deleteGrafanaRulesFromFolder.useMutation(),{folder:De}=(0,T.a)(O),Oe=De?.title||"unknown folder",A=(0,F.NH)(O),ge=Se(pe?"list":"grouped");if(!De)return null;const ee=async()=>{await K({namespace:O}).unwrap(),await ge()},Ie=(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(n.W.Item,{url:A,icon:"eye","aria-label":(0,r.t)("alerting.list-view.folder-actions.view.aria-label","View folder"),label:(0,r.t)("alerting.list-view.folder-actions.view.label","View folder")}),(0,e.jsx)(Ge,{folderUID:O,onClickDelete:V,isLoading:Ce.isLoading}),ye&&(0,e.jsxs)(e.Fragment,{children:[H&&(0,e.jsx)(n.W.Divider,{}),(0,e.jsx)(Ze,{onClickExport:()=>$(!0)})]})]});return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(g.m,{placement:"bottom",overlay:(0,e.jsx)(n.W,{children:Ie}),children:(0,e.jsx)(v.A,{fill:"text",size:"sm","aria-label":(0,r.t)("alerting.list-view.folder-actions.button.aria-label","Folder actions"),title:(0,r.t)("alerting.list-view.folder-actions.button.title","Actions")})}),U&&(0,e.jsx)(S.s,{folder:De,onClose:()=>$(!1)}),(0,e.jsx)(Ue,{isOpen:w,onConfirm:ee,onDismiss:()=>V(!1),folderName:Oe})]})};function Se(O){const w=(0,c.wA)(),V=(0,i.wS)();return async()=>{V?(await w((0,l.eB)({rulesSourceName:X.hY})),await w((0,l.nV)(!1))):await w((0,l.yo)(!1)),R.Ny.push((0,z.G)("/alerting/list",{view:O},{skipSubPath:!0}))}}function Ze({onClickExport:O}){return(0,e.jsx)(n.W.Item,{"aria-label":(0,r.t)("alerting.list-view.folder-actions.export.aria-label","Export rules folder"),"data-testid":"export-folder",label:(0,r.t)("alerting.list-view.folder-actions.export.label","Export rules folder"),icon:"download-alt",onClick:O},"export-folder")}function Ge({folderUID:O,onClickDelete:w,isLoading:V}){const U=(0,i.sk)(),$=x.$.featureToggles.alertingBulkActionsInUI,[H,pe]=(0,P.aw)(P.$m.Pause),[Ee,Re]=(0,P.aw)(P.$m.Delete),ye=H&&pe,K=Ee&&Re,[Ce,De]=p.endpoints.pauseFolder.useMutation(),[Oe,A]=p.endpoints.unpauseFolder.useMutation(),ge=Se(U?"list":"grouped");return!$||!ye&&!K?null:(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(n.W.Divider,{}),ye&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(q,{folderUID:O,action:"pause",executeAction:async ee=>{await Ce({namespace:ee}).unwrap(),await ge()},isLoading:De.isLoading}),(0,e.jsx)(q,{folderUID:O,action:"unpause",executeAction:async ee=>{await Oe({namespace:ee}).unwrap(),await ge()},isLoading:A.isLoading})]}),K&&(0,e.jsx)(n.W.Item,{label:(0,r.t)("alerting.folder-bulk-actions.delete.button.label","Delete all rules"),icon:"trash-alt",onClick:()=>w(!0),disabled:V})]})}},94332:(ie,D,t)=>{t.d(D,{F:()=>y});var e=t(74848),s=t(96540),r=t(92745),x=t(6975),R=t(70327),n=t(77880),g=t(25149),c=t(78102);function y({onClose:o}){const[p,i]=(0,s.useState)("yaml");return(0,e.jsx)(g.m,{activeTab:p,onTabChange:i,onClose:o,formatProviders:Object.values(c.sl),children:(0,e.jsx)(u,{exportFormat:p,onClose:o})})}function u({exportFormat:o,onClose:p}){const{currentData:i="",isFetching:P}=R.hK.endpoints.exportRules.useQuery({format:o}),T=`alert-rules-${new Date().getTime()}`;return P?(0,e.jsx)(x._,{text:(0,r.t)("alerting.grafana-rules-export-preview.text-loading","Loading....")}):(0,e.jsx)(n.J,{format:o,textDefinition:i,downloadFileName:T,onClose:p})}},98684:(ie,D,t)=>{t.d(D,{u:()=>r});var e=t(54092),s=t(33604);function r(){return(0,s.f)({extensionPointId:e.SM.AlertingHomePage,limitPerPlugin:1})}}}]);

//# sourceMappingURL=4514.42d324f558a5fdc837aa.js.map