{"version":3,"file":"4162.a0dc9d0149bcc67a5989.js","mappings":"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","sources":["webpack://grafana/./public/app/features/alerting/unified/rule-list/GrafanaRuleListItem.tsx","webpack://grafana/./public/app/features/alerting/unified/rule-list/components/RuleActionsSkeleton.tsx","webpack://grafana/./public/app/features/alerting/unified/rule-list/GrafanaGroupLoader.tsx","webpack://grafana/./public/app/features/alerting/unified/rule-list/DataSourceRuleListItem.tsx","webpack://grafana/./public/app/features/alerting/unified/rule-list/components/LoadMoreButton.tsx","webpack://grafana/./public/app/features/alerting/unified/api/prometheusApi.ts","webpack://grafana/./public/app/features/alerting/unified/rule-list/components/RuleActionsButtons.V2.tsx","webpack://grafana/./public/app/features/alerting/unified/rule-list/components/AlertRuleListItemLoader.tsx","webpack://grafana/./public/app/features/alerting/unified/rule-list/DataSourceGroupLoader.tsx","webpack://grafana/./public/app/features/alerting/unified/rule-list/ruleMatching.ts"],"sourcesContent":["import { GrafanaRuleGroupIdentifier } from 'app/types/unified-alerting';\nimport { GrafanaPromRuleDTO, PromRuleType } from 'app/types/unified-alerting-dto';\n\nimport { GRAFANA_RULES_SOURCE_NAME, GrafanaRulesSource } from '../utils/datasource';\nimport { groups } from '../utils/navigation';\nimport { totalFromStats } from '../utils/ruleStats';\nimport { prometheusRuleType } from '../utils/rules';\nimport { createRelativeUrl } from '../utils/url';\n\nimport {\n  AlertRuleListItem,\n  RecordingRuleListItem,\n  RuleListItemCommonProps,\n  UnknownRuleListItem,\n} from './components/AlertRuleListItem';\nimport { RuleActionsButtons } from './components/RuleActionsButtons.V2';\nimport { RuleOperation } from './components/RuleListIcon';\n\ninterface GrafanaRuleListItemProps {\n  rule: GrafanaPromRuleDTO;\n  groupIdentifier: GrafanaRuleGroupIdentifier;\n  namespaceName: string;\n  operation?: RuleOperation;\n  showLocation?: boolean;\n}\n\nexport function GrafanaRuleListItem({\n  rule,\n  groupIdentifier,\n  namespaceName,\n  operation,\n  showLocation = true,\n}: GrafanaRuleListItemProps) {\n  const { name, uid, labels, provenance } = rule;\n\n  const groupUrl = groups.detailsPageLink(\n    GRAFANA_RULES_SOURCE_NAME,\n    groupIdentifier.namespace.uid,\n    groupIdentifier.groupName\n  );\n\n  const commonProps: RuleListItemCommonProps = {\n    name,\n    rulesSource: GrafanaRulesSource,\n    group: groupIdentifier.groupName,\n    groupUrl,\n    namespace: namespaceName,\n    href: createRelativeUrl(`/alerting/grafana/${uid}/view`),\n    health: rule?.health,\n    error: rule?.lastError,\n    labels: labels,\n    isProvisioned: Boolean(provenance),\n    isPaused: rule?.isPaused,\n    application: 'grafana' as const,\n    actions: <RuleActionsButtons promRule={rule} groupIdentifier={groupIdentifier} compact />,\n    querySourceUIDs: rule?.queriedDatasourceUIDs,\n  };\n\n  if (prometheusRuleType.grafana.alertingRule(rule)) {\n    const promAlertingRule = rule && rule.type === PromRuleType.Alerting ? rule : undefined;\n    const instancesCount = totalFromStats(promAlertingRule?.totals ?? {});\n\n    return (\n      <AlertRuleListItem\n        {...commonProps}\n        summary={rule.annotations?.summary}\n        state={promAlertingRule?.state}\n        instancesCount={instancesCount}\n        operation={operation}\n        showLocation={showLocation}\n      />\n    );\n  }\n\n  if (prometheusRuleType.grafana.recordingRule(rule)) {\n    return <RecordingRuleListItem {...commonProps} showLocation={showLocation} />;\n  }\n\n  return <UnknownRuleListItem ruleName={name} groupIdentifier={groupIdentifier} ruleDefinition={rule} />;\n}\n","import Skeleton from 'react-loading-skeleton';\n\nexport function RuleActionsSkeleton() {\n  return <Skeleton width={50} height={16} />;\n}\n","import { css } from '@emotion/css';\nimport { useMemo } from 'react';\n\nimport { GrafanaTheme2 } from '@grafana/data';\nimport { t } from '@grafana/i18n';\nimport { Alert, Stack, useStyles2 } from '@grafana/ui';\nimport { GrafanaRuleGroupIdentifier } from 'app/types/unified-alerting';\n\nimport { prometheusApi } from '../api/prometheusApi';\nimport { useContinuousPagination } from '../hooks/usePagination';\nimport { DEFAULT_PER_PAGE_PAGINATION_RULES_PER_GROUP, RULE_LIST_POLL_INTERVAL_MS } from '../utils/constants';\n\nimport { GrafanaRuleListItem } from './GrafanaRuleListItem';\nimport { AlertRuleListItemSkeleton } from './components/AlertRuleListItemLoader';\nimport { LoadMoreButton } from './components/LoadMoreButton';\n\nconst { useGetGrafanaGroupsQuery } = prometheusApi;\n\nexport interface GrafanaGroupLoaderProps {\n  groupIdentifier: GrafanaRuleGroupIdentifier;\n  namespaceName: string;\n  /**\n   * Used to display the same number of skeletons as there are rules\n   * The number of rules is typically known from paginated Prometheus response\n   * Ruler response might contain different number of rules, but in most cases what we get from Prometheus is fine\n   */\n  expectedRulesCount?: number;\n}\n\n/**\n * Loads an evaluation group from Prometheus and Ruler endpoints.\n * Displays a loading skeleton while the data is being fetched.\n * Polls the Prometheus endpoint every 20 seconds to refresh the data.\n */\nexport function GrafanaGroupLoader({\n  groupIdentifier,\n  namespaceName,\n  expectedRulesCount = 3, // 3 is a random number. Usually we get the number of rules from Prometheus response\n}: GrafanaGroupLoaderProps) {\n  const styles = useStyles2(getStyles);\n\n  const { data: promResponse, isLoading: isPromResponseLoading } = useGetGrafanaGroupsQuery(\n    {\n      folderUid: groupIdentifier.namespace.uid,\n      groupName: groupIdentifier.groupName,\n      limitAlerts: 0,\n    },\n    { pollingInterval: RULE_LIST_POLL_INTERVAL_MS }\n  );\n\n  const rules = useMemo(() => {\n    return promResponse?.data.groups.at(0)?.rules ?? [];\n  }, [promResponse]);\n\n  const { pageItems, hasMore, loadMore } = useContinuousPagination(rules, DEFAULT_PER_PAGE_PAGINATION_RULES_PER_GROUP);\n\n  if (isPromResponseLoading) {\n    return (\n      <>\n        {Array.from({ length: expectedRulesCount }).map((_, index) => (\n          <AlertRuleListItemSkeleton key={index} />\n        ))}\n      </>\n    );\n  }\n\n  if (!promResponse) {\n    return (\n      <Alert\n        title={t(\n          'alerting.group-loader.group-load-failed',\n          'Failed to load rules from group {{ groupName }} in {{ namespaceName }}',\n          { groupName: groupIdentifier.groupName, namespaceName }\n        )}\n        severity=\"error\"\n      />\n    );\n  }\n\n  // If no rules found, return early without pagination\n  if (rules.length === 0) {\n    return <Alert title={t('alerting.group-loader.no-rules', 'No rules found in this group')} severity=\"info\" />;\n  }\n\n  return (\n    <Stack direction=\"column\" gap={0}>\n      {pageItems.map((promRule) => {\n        return (\n          <GrafanaRuleListItem\n            key={promRule.uid}\n            rule={promRule}\n            groupIdentifier={groupIdentifier}\n            namespaceName={namespaceName}\n            // we don't show the location again for rules, it's redundant because they are shown in a folder > group hierarchy\n            showLocation={false}\n          />\n        );\n      })}\n      {hasMore && (\n        <li aria-selected=\"false\" role=\"treeitem\" className={styles.loadMoreWrapper}>\n          <LoadMoreButton onClick={loadMore} />\n        </li>\n      )}\n    </Stack>\n  );\n}\n\nconst getStyles = (theme: GrafanaTheme2) => ({\n  loadMoreWrapper: css({\n    listStyle: 'none',\n    paddingTop: theme.spacing(1),\n  }),\n});\n","import React from 'react';\n\nimport { DataSourceRuleGroupIdentifier, Rule, RuleIdentifier } from 'app/types/unified-alerting';\nimport { PromRuleType, RulerRuleDTO, RulesSourceApplication } from 'app/types/unified-alerting-dto';\n\nimport { createReturnTo } from '../hooks/useReturnTo';\nimport { Annotation } from '../utils/constants';\nimport { groups } from '../utils/navigation';\nimport { fromRule, fromRulerRule, stringifyIdentifier } from '../utils/rule-id';\nimport { getRuleName, getRulePluginOrigin, rulerRuleType } from '../utils/rules';\nimport { createRelativeUrl } from '../utils/url';\n\nimport {\n  AlertRuleListItem,\n  RecordingRuleListItem,\n  RuleListItemCommonProps,\n  UnknownRuleListItem,\n} from './components/AlertRuleListItem';\n\nexport interface DataSourceRuleListItemProps {\n  rule: Rule;\n  rulerRule?: RulerRuleDTO;\n  groupIdentifier: DataSourceRuleGroupIdentifier;\n  application?: RulesSourceApplication;\n  actions?: React.ReactNode;\n  showLocation?: boolean;\n}\n\nexport function DataSourceRuleListItem({\n  rule,\n  rulerRule,\n  groupIdentifier,\n  application,\n  actions,\n  showLocation = true,\n}: DataSourceRuleListItemProps) {\n  const returnTo = createReturnTo();\n  const { rulesSource, namespace, groupName } = groupIdentifier;\n\n  const ruleIdentifier = rulerRule\n    ? fromRulerRule(rulesSource.name, namespace.name, groupName, rulerRule)\n    : fromRule(rulesSource.name, namespace.name, groupName, rule);\n  const href = createViewLinkFromIdentifier(ruleIdentifier, returnTo);\n  const originMeta = getRulePluginOrigin(rule);\n\n  // If ruler rule is available, we should use it as it contains fresh data\n  const ruleName = rulerRule ? getRuleName(rulerRule) : rule.name;\n  const labels = rulerRule ? rulerRule.labels : rule.labels;\n\n  const groupUrl = groups.detailsPageLink(rulesSource.uid, namespace.name, groupName);\n\n  const commonProps: RuleListItemCommonProps = {\n    name: ruleName,\n    rulesSource: rulesSource,\n    application: application,\n    group: groupName,\n    groupUrl,\n    namespace: namespace.name,\n    href,\n    health: rule.health,\n    error: rule.lastError,\n    labels,\n    actions,\n    origin: originMeta,\n    showLocation,\n  };\n\n  switch (rule.type) {\n    case PromRuleType.Alerting:\n      const annotations = (rulerRuleType.any.alertingRule(rulerRule) ? rulerRule.annotations : rule.annotations) ?? {};\n      const summary = annotations[Annotation.summary];\n\n      return (\n        <AlertRuleListItem {...commonProps} summary={summary} state={rule.state} instancesCount={rule.alerts?.length} />\n      );\n    case PromRuleType.Recording:\n      return <RecordingRuleListItem {...commonProps} />;\n    default:\n      return <UnknownRuleListItem ruleName={ruleName} groupIdentifier={groupIdentifier} ruleDefinition={rule} />;\n  }\n}\n\nexport function createViewLinkFromIdentifier(identifier: RuleIdentifier, returnTo?: string) {\n  const paramId = encodeURIComponent(stringifyIdentifier(identifier));\n  const paramSource = encodeURIComponent(identifier.ruleSourceName);\n\n  return createRelativeUrl(`/alerting/${paramSource}/${paramId}/view`, returnTo ? { returnTo } : {});\n}\n","import { Trans, t } from '@grafana/i18n';\nimport { Button } from '@grafana/ui';\n\ninterface LoadMoreButtonProps {\n  onClick: () => void;\n  loading?: boolean;\n}\n\nexport function LoadMoreButton({ onClick, loading = false }: LoadMoreButtonProps) {\n  const label = t('alerting.rule-list.pagination.next-page', 'Show more…');\n\n  return (\n    <Button\n      data-testid=\"load-more-rule-groups\"\n      aria-label={label}\n      fill=\"text\"\n      size=\"sm\"\n      variant=\"secondary\"\n      onClick={onClick}\n      disabled={loading}\n    >\n      {loading ? <Trans i18nKey=\"alerting.rule-list.loading-more-groups\">Loading more groups…</Trans> : label}\n    </Button>\n  );\n}\n","import { useCallback } from 'react';\n\nimport { useDispatch } from 'app/types/store';\nimport { RuleHealth } from 'app/types/unified-alerting';\nimport {\n  GrafanaPromRuleGroupDTO,\n  PromAlertingRuleState,\n  PromRuleDTO,\n  PromRuleGroupDTO,\n} from 'app/types/unified-alerting-dto';\n\nimport { GRAFANA_RULES_SOURCE_NAME } from '../utils/datasource';\n\nimport { WithNotificationOptions, alertingApi } from './alertingApi';\nimport { normalizeRuleGroup } from './prometheus';\n\nexport interface PromRulesResponse<TRuleGroup> {\n  status: string;\n  data: {\n    groups: TRuleGroup[];\n    groupNextToken?: string;\n  };\n  errorType?: string;\n  error?: string;\n}\n\ntype PromRulesOptions = WithNotificationOptions<{\n  ruleSource: { uid: string };\n  namespace?: string;\n  groupName?: string;\n  ruleName?: string;\n  groupLimit?: number;\n  excludeAlerts?: boolean;\n  groupNextToken?: string;\n}>;\n\ntype GrafanaPromRulesOptions = Omit<PromRulesOptions, 'ruleSource' | 'namespace' | 'excludeAlerts'> & {\n  folderUid?: string;\n  dashboardUid?: string;\n  panelId?: number;\n  limitAlerts?: number;\n  contactPoint?: string;\n  health?: RuleHealth[];\n  state?: PromAlertingRuleState[];\n};\n\nexport const prometheusApi = alertingApi.injectEndpoints({\n  endpoints: (build) => ({\n    getGroups: build.query<PromRulesResponse<PromRuleGroupDTO<PromRuleDTO>>, PromRulesOptions>({\n      query: ({\n        ruleSource,\n        namespace,\n        groupName,\n        ruleName,\n        groupLimit,\n        excludeAlerts,\n        groupNextToken,\n        notificationOptions,\n      }) => {\n        if (ruleSource.uid === GRAFANA_RULES_SOURCE_NAME) {\n          throw new Error('Please use getGrafanaGroups endpoint for grafana rules');\n        }\n        return {\n          url: `api/prometheus/${ruleSource.uid}/api/v1/rules`,\n          params: {\n            file: namespace, // Mimir\n            'file[]': namespace, // Prometheus\n            rule_group: groupName, // Mimir\n            'rule_group[]': groupName, // Prometheus\n            rule_name: ruleName, // Mimir\n            'rule_name[]': ruleName, // Prometheus\n            exclude_alerts: excludeAlerts?.toString(),\n            group_limit: groupLimit?.toFixed(0),\n            group_next_token: groupNextToken,\n          },\n          notificationOptions,\n        };\n      },\n      transformResponse: (response: PromRulesResponse<PromRuleGroupDTO<PromRuleDTO>>) => {\n        return { ...response, data: { ...response.data, groups: response.data.groups.map(normalizeRuleGroup) } };\n      },\n    }),\n    getGrafanaGroups: build.query<PromRulesResponse<GrafanaPromRuleGroupDTO>, GrafanaPromRulesOptions>({\n      query: ({\n        folderUid,\n        groupName,\n        ruleName,\n        contactPoint,\n        health,\n        state,\n        groupLimit,\n        limitAlerts,\n        groupNextToken,\n      }) => ({\n        url: `api/prometheus/grafana/api/v1/rules`,\n        params: {\n          folder_uid: folderUid,\n          rule_group: groupName,\n          rule_name: ruleName,\n          receiver_name: contactPoint,\n          health: health,\n          state: state,\n          limit_alerts: limitAlerts,\n          group_limit: groupLimit?.toFixed(0),\n          group_next_token: groupNextToken,\n        },\n      }),\n      providesTags: (_result, _error, { folderUid, groupName, ruleName }) => {\n        const folderKey = folderUid ?? '__any__';\n        const groupKey = groupName ?? '__any__';\n        const ruleKey = ruleName ?? '__any__';\n        return [{ type: 'GrafanaPrometheusGroups', id: `grafana/${folderKey}/${groupKey}/${ruleKey}` }];\n      },\n    }),\n  }),\n});\n\nexport function usePopulateGrafanaPrometheusApiCache() {\n  const dispatch = useDispatch();\n\n  const populateGroupsResponseCache = useCallback(\n    (groups: GrafanaPromRuleGroupDTO[]) => {\n      dispatch(\n        prometheusApi.util.upsertQueryEntries(\n          groups.map((group) => ({\n            endpointName: 'getGrafanaGroups',\n            arg: { folderUid: group.folderUid, groupName: group.name, limitAlerts: 0 },\n            value: { data: { groups: [group] }, status: 'success' },\n          }))\n        )\n      );\n    },\n    [dispatch]\n  );\n\n  return { populateGroupsResponseCache };\n}\n","import { isString } from 'lodash';\nimport { useState } from 'react';\nimport { RequireAtLeastOne } from 'type-fest';\n\nimport { Trans, t } from '@grafana/i18n';\nimport { LinkButton, Stack } from '@grafana/ui';\nimport AlertRuleMenu from 'app/features/alerting/unified/components/rule-viewer/AlertRuleMenu';\nimport { useDeleteModal } from 'app/features/alerting/unified/components/rule-viewer/DeleteModal';\nimport { RedirectToCloneRule } from 'app/features/alerting/unified/components/rules/CloneRule';\nimport SilenceGrafanaRuleDrawer from 'app/features/alerting/unified/components/silences/SilenceGrafanaRuleDrawer';\nimport {\n  EditableRuleIdentifier,\n  GrafanaRuleIdentifier,\n  Rule,\n  RuleGroupIdentifierV2,\n  RuleIdentifier,\n} from 'app/types/unified-alerting';\nimport { RulerRuleDTO } from 'app/types/unified-alerting-dto';\n\nimport { logWarning } from '../../Analytics';\nimport { AlertRuleAction, skipToken, useGrafanaPromRuleAbility, useRulerRuleAbility } from '../../hooks/useAbilities';\nimport * as ruleId from '../../utils/rule-id';\nimport {\n  getRuleUID,\n  isProvisionedPromRule,\n  isProvisionedRule,\n  prometheusRuleType,\n  rulerRuleType,\n} from '../../utils/rules';\nimport { createRelativeUrl } from '../../utils/url';\n\ntype RuleProps = RequireAtLeastOne<{\n  rule?: RulerRuleDTO;\n  promRule?: Rule;\n}>;\n\ntype Props = RuleProps & {\n  groupIdentifier: RuleGroupIdentifierV2;\n  /**\n   * Should we show the buttons in a \"compact\" state?\n   * i.e. without text and using smaller button sizes\n   */\n  compact?: boolean;\n};\n\n// For now this is just a copy of RuleActionsButtons.tsx but with the View button removed.\n// This is only done to keep the new list behind a feature flag and limit changes in the existing components\nexport function RuleActionsButtons({ compact, rule, promRule, groupIdentifier }: Props) {\n  const redirectToListView = compact ? false : true;\n  const [deleteModal, showDeleteModal] = useDeleteModal(redirectToListView);\n\n  const [showSilenceDrawer, setShowSilenceDrawer] = useState<boolean>(false);\n\n  const [redirectToClone, setRedirectToClone] = useState<\n    { identifier: RuleIdentifier; isProvisioned: boolean } | undefined\n  >(undefined);\n\n  const isProvisioned = getIsProvisioned(rule, promRule);\n\n  const [editRuleSupported, editRuleAllowed] = useRulerRuleAbility(rule, groupIdentifier, AlertRuleAction.Update);\n  // If the consumer of this component comes from the alert list view, we need to use promRule to check abilities and permissions,\n  // as we have removed all requests to the ruler API in the list view.\n  const [grafanaEditRuleSupported, grafanaEditRuleAllowed] = useGrafanaPromRuleAbility(\n    prometheusRuleType.grafana.rule(promRule) ? promRule : skipToken,\n    AlertRuleAction.Update\n  );\n\n  const canEditRule = (editRuleSupported && editRuleAllowed) || (grafanaEditRuleSupported && grafanaEditRuleAllowed);\n\n  const buttons: JSX.Element[] = [];\n  const buttonSize = compact ? 'sm' : 'md';\n\n  const identifier = getEditableIdentifier(groupIdentifier, rule, promRule);\n\n  if (!identifier) {\n    return null;\n  }\n\n  // determine if this rule can be silenced by checking for Grafana Alert rule type and extracting the UID\n  const ruleUid = getRuleUID(rule ?? promRule);\n  const silenceableRule =\n    isString(ruleUid) &&\n    (rulerRuleType.grafana.alertingRule(rule) || prometheusRuleType.grafana.alertingRule(promRule));\n\n  if (canEditRule) {\n    const editURL = createRelativeUrl(`/alerting/${encodeURIComponent(ruleId.stringifyIdentifier(identifier))}/edit`);\n\n    buttons.push(\n      <LinkButton\n        title={t('alerting.rule-actions-buttons.title-edit', 'Edit')}\n        size={buttonSize}\n        key=\"edit\"\n        variant=\"secondary\"\n        fill=\"text\"\n        href={editURL}\n      >\n        <Trans i18nKey=\"common.edit\">Edit</Trans>\n      </LinkButton>\n    );\n  }\n\n  return (\n    <Stack gap={0} alignItems=\"center\" wrap=\"nowrap\">\n      {buttons}\n      <AlertRuleMenu\n        buttonSize={buttonSize}\n        fill=\"text\"\n        rulerRule={rule}\n        promRule={promRule}\n        groupIdentifier={groupIdentifier}\n        identifier={identifier}\n        handleDelete={(identifier, groupIdentifier) => showDeleteModal(identifier, groupIdentifier)}\n        handleSilence={() => setShowSilenceDrawer(true)}\n        handleDuplicateRule={() => setRedirectToClone({ identifier, isProvisioned })}\n      />\n      {deleteModal}\n      {silenceableRule && showSilenceDrawer && (\n        <SilenceGrafanaRuleDrawer ruleUid={ruleUid} onClose={() => setShowSilenceDrawer(false)} />\n      )}\n      {redirectToClone?.identifier && (\n        <RedirectToCloneRule\n          identifier={redirectToClone.identifier}\n          isProvisioned={redirectToClone.isProvisioned}\n          onDismiss={() => setRedirectToClone(undefined)}\n        />\n      )}\n    </Stack>\n  );\n}\n\nfunction getIsProvisioned(rule?: RulerRuleDTO, promRule?: Rule): boolean {\n  if (rule) {\n    return isProvisionedRule(rule);\n  }\n\n  if (promRule) {\n    return isProvisionedPromRule(promRule);\n  }\n\n  return false;\n}\n\nfunction getEditableIdentifier(\n  groupIdentifier: RuleGroupIdentifierV2,\n  rule?: RulerRuleDTO,\n  promRule?: Rule\n): EditableRuleIdentifier | undefined {\n  if (rule) {\n    return ruleId.fromRulerRuleAndGroupIdentifierV2(groupIdentifier, rule);\n  }\n\n  if (prometheusRuleType.grafana.rule(promRule)) {\n    return {\n      ruleSourceName: 'grafana',\n      uid: promRule.uid,\n    } satisfies GrafanaRuleIdentifier;\n  }\n\n  logWarning('Unable to construct an editable rule identifier');\n\n  // Returning undefined is safer than throwing here as it allows the component to gracefully handle\n  // the error by returning null instead of crashing the entire component tree\n  return undefined;\n}\n","import Skeleton from 'react-loading-skeleton';\n\nimport { t } from '@grafana/i18n';\nimport { GrafanaRuleIdentifier } from 'app/types/unified-alerting';\n\nimport { stringifyErrorLike } from '../../utils/misc';\n\nimport { ListItem } from './ListItem';\nimport { RuleActionsSkeleton } from './RuleActionsSkeleton';\nimport { RuleListIcon } from './RuleListIcon';\n\nexport function AlertRuleListItemSkeleton() {\n  return (\n    <ListItem\n      title={<Skeleton width={64} />}\n      icon={<RuleListIcon isPaused={false} />}\n      description={<Skeleton width={256} />}\n      actions={<RuleActionsSkeleton />}\n      data-testid=\"alert-rule-list-item-loader\"\n      aria-disabled={true}\n    />\n  );\n}\n\nexport function RulerRuleLoadingError({\n  ruleIdentifier,\n  error,\n}: {\n  ruleIdentifier: GrafanaRuleIdentifier;\n  error?: unknown;\n}) {\n  const errorMessage = error\n    ? stringifyErrorLike(error)\n    : t('alerting.rule-list.rulerrule-loading-error', 'Failed to load the rule');\n\n  return <ListItem title={ruleIdentifier.uid} description={errorMessage} data-testid=\"ruler-rule-loading-error\" />;\n}\n","import { css } from '@emotion/css';\nimport { skipToken } from '@reduxjs/toolkit/query';\nimport { useMemo } from 'react';\n\nimport { GrafanaTheme2 } from '@grafana/data';\nimport { t } from '@grafana/i18n';\nimport { isFetchError } from '@grafana/runtime';\nimport { Alert, useStyles2 } from '@grafana/ui';\nimport { DataSourceRuleGroupIdentifier } from 'app/types/unified-alerting';\nimport {\n  PromRuleDTO,\n  PromRuleGroupDTO,\n  RulerCloudRuleDTO,\n  RulerRuleGroupDTO,\n  RulesSourceApplication,\n} from 'app/types/unified-alerting-dto';\n\nimport { alertRuleApi } from '../api/alertRuleApi';\nimport { featureDiscoveryApi } from '../api/featureDiscoveryApi';\nimport { prometheusApi } from '../api/prometheusApi';\nimport { useContinuousPagination } from '../hooks/usePagination';\nimport { DEFAULT_PER_PAGE_PAGINATION_RULES_PER_GROUP, RULE_LIST_POLL_INTERVAL_MS } from '../utils/constants';\nimport { hashRule } from '../utils/rule-id';\nimport { getRuleName, isCloudRulerGroup } from '../utils/rules';\n\nimport { DataSourceRuleListItem } from './DataSourceRuleListItem';\nimport { RuleOperationListItem } from './components/AlertRuleListItem';\nimport { AlertRuleListItemSkeleton } from './components/AlertRuleListItemLoader';\nimport { LoadMoreButton } from './components/LoadMoreButton';\nimport { RuleActionsButtons } from './components/RuleActionsButtons.V2';\nimport { RuleOperation } from './components/RuleListIcon';\nimport { matchRulesGroup } from './ruleMatching';\n\nconst { useDiscoverDsFeaturesQuery } = featureDiscoveryApi;\nconst { useGetGroupsQuery } = prometheusApi;\nconst { useGetRuleGroupForNamespaceQuery } = alertRuleApi;\n\nexport interface DataSourceGroupLoaderProps {\n  groupIdentifier: DataSourceRuleGroupIdentifier;\n  /**\n   * Used to display the same number of skeletons as there are rules\n   * The number of rules is typically known from paginated Prometheus response\n   * Ruler response might contain different number of rules, but in most cases what we get from Prometheus is fine\n   */\n  expectedRulesCount?: number;\n}\n\n/**\n * Loads an evaluation group from Prometheus and Ruler endpoints.\n * Displays a loading skeleton while the data is being fetched.\n * Polls the Prometheus endpoint every 20 seconds to refresh the data.\n */\nexport function DataSourceGroupLoader({ groupIdentifier, expectedRulesCount = 3 }: DataSourceGroupLoaderProps) {\n  const { namespace, groupName } = groupIdentifier;\n  const namespaceName = namespace.name;\n\n  const {\n    data: promResponse,\n    isLoading: isPromResponseLoading,\n    isError: isPromResponseError,\n  } = useGetGroupsQuery(\n    {\n      ruleSource: { uid: groupIdentifier.rulesSource.uid },\n      namespace: namespaceName,\n      groupName: groupName,\n    },\n    { pollingInterval: RULE_LIST_POLL_INTERVAL_MS }\n  );\n\n  const {\n    data: dsFeatures,\n    isLoading: isDsFeaturesLoading,\n    isError: isDsFeaturesError,\n  } = useDiscoverDsFeaturesQuery({\n    uid: groupIdentifier.rulesSource.uid,\n  });\n\n  const {\n    data: rulerGroup,\n    error: rulerGroupError,\n    isFetching: isRulerGroupFetching,\n    isError: isRulerGroupError,\n  } = useGetRuleGroupForNamespaceQuery(\n    dsFeatures?.rulerConfig\n      ? {\n          rulerConfig: dsFeatures?.rulerConfig,\n          namespace: namespaceName,\n          group: groupName,\n        }\n      : skipToken\n  );\n\n  const isLoading = isPromResponseLoading || isDsFeaturesLoading || isRulerGroupFetching;\n  if (isLoading) {\n    return (\n      <>\n        {Array.from({ length: expectedRulesCount }).map((_, index) => (\n          <AlertRuleListItemSkeleton key={index} />\n        ))}\n      </>\n    );\n  }\n\n  const isError = isPromResponseError || isDsFeaturesError || isRulerGroupError;\n  if (isError) {\n    if (isFetchError(rulerGroupError) && rulerGroupError.status === 404) {\n      return (\n        <Alert severity=\"warning\" title={t('alerting.ds-group-loader.group-deleting', 'The group is being deleted')} />\n      );\n    }\n\n    return (\n      <Alert\n        title={t(\n          'alerting.ds-group-loader.group-load-failed',\n          'Failed to load rules from group {{ groupName }} in {{ namespaceName }}',\n          { groupName, namespaceName }\n        )}\n        severity=\"error\"\n      />\n    );\n  }\n\n  // There should be always only one group in the response but some Prometheus-compatible data sources\n  // implement different filter parameters\n  const promGroup = promResponse?.data.groups.find((g) => g.file === namespaceName && g.name === groupName);\n  if (dsFeatures?.rulerConfig && rulerGroup && isCloudRulerGroup(rulerGroup) && promGroup) {\n    return (\n      <RulerBasedGroupRules\n        groupIdentifier={groupIdentifier}\n        promGroup={promGroup}\n        rulerGroup={rulerGroup}\n        application={dsFeatures.application}\n      />\n    );\n  }\n\n  // Data source without ruler\n  if (promGroup) {\n    return (\n      <>\n        {promGroup.rules.map((rule) => (\n          <DataSourceRuleListItem\n            key={hashRule(rule)}\n            rule={rule}\n            groupIdentifier={groupIdentifier}\n            application={dsFeatures?.application}\n            showLocation={false}\n          />\n        ))}\n      </>\n    );\n  }\n\n  // This should never happen\n  return (\n    <Alert\n      title={t(\n        'alerting.ds-group-loader.group-load-failed',\n        'Failed to load rules from group {{ groupName }} in {{ namespaceName }}',\n        { groupName, namespaceName }\n      )}\n      severity=\"warning\"\n    />\n  );\n}\n\ninterface RulerBasedGroupRulesProps {\n  groupIdentifier: DataSourceRuleGroupIdentifier;\n  promGroup: PromRuleGroupDTO<PromRuleDTO>;\n  rulerGroup: RulerRuleGroupDTO<RulerCloudRuleDTO>;\n  application: RulesSourceApplication;\n}\n\nexport function RulerBasedGroupRules({\n  groupIdentifier,\n  application,\n  promGroup,\n  rulerGroup,\n}: RulerBasedGroupRulesProps) {\n  const styles = useStyles2(getStyles);\n  const { namespace, groupName } = groupIdentifier;\n\n  const { matches, promOnlyRules } = useMemo(() => {\n    return matchRulesGroup(rulerGroup, promGroup);\n  }, [promGroup, rulerGroup]);\n\n  const { pageItems, hasMore, loadMore } = useContinuousPagination(\n    rulerGroup.rules,\n    DEFAULT_PER_PAGE_PAGINATION_RULES_PER_GROUP\n  );\n\n  return (\n    <>\n      {pageItems.map((rulerRule) => {\n        const promRule = matches.get(rulerRule);\n\n        return promRule ? (\n          <DataSourceRuleListItem\n            key={hashRule(promRule)}\n            rule={promRule}\n            rulerRule={rulerRule}\n            groupIdentifier={groupIdentifier}\n            application={application}\n            actions={\n              <RuleActionsButtons rule={rulerRule} promRule={promRule} groupIdentifier={groupIdentifier} compact />\n            }\n            showLocation={false}\n          />\n        ) : (\n          <RuleOperationListItem\n            key={getRuleName(rulerRule)}\n            name={getRuleName(rulerRule)}\n            namespace={namespace.name}\n            group={groupName}\n            rulesSource={groupIdentifier.rulesSource}\n            application={application}\n            operation={RuleOperation.Creating}\n            showLocation={false}\n          />\n        );\n      })}\n      {promOnlyRules.map((rule) => (\n        <RuleOperationListItem\n          key={rule.name}\n          name={rule.name}\n          namespace={namespace.name}\n          group={groupName}\n          rulesSource={groupIdentifier.rulesSource}\n          application={application}\n          operation={RuleOperation.Deleting}\n          showLocation={false}\n        />\n      ))}\n      {hasMore && (\n        <li aria-selected=\"false\" role=\"treeitem\" className={styles.loadMoreWrapper}>\n          <LoadMoreButton onClick={loadMore} />\n        </li>\n      )}\n    </>\n  );\n}\n\nconst getStyles = (theme: GrafanaTheme2) => ({\n  loadMoreWrapper: css({\n    listStyle: 'none',\n    paddingTop: theme.spacing(1),\n  }),\n});\n","import { Rule } from 'app/types/unified-alerting';\nimport {\n  PromRuleDTO,\n  PromRuleGroupDTO,\n  RulerCloudRuleDTO,\n  RulerRuleDTO,\n  RulerRuleGroupDTO,\n} from 'app/types/unified-alerting-dto';\n\nimport { getPromRuleFingerprint, getRulerRuleFingerprint } from '../utils/rule-id';\nimport { getRuleName } from '../utils/rules';\n\nexport function getMatchingRulerRule(rulerRuleGroup: RulerRuleGroupDTO<RulerCloudRuleDTO>, rule: Rule) {\n  // If all rule names are unique, we can use the rule name to find the rule. We don't need to hash the rule\n  const rulesByName = rulerRuleGroup.rules.filter((r) => getRuleName(r) === rule.name);\n  if (rulesByName.length === 1) {\n    return rulesByName[0];\n  }\n\n  // If we don't have a unique rule name, try to compare by labels and annotations\n  const rulesByLabelsAndAnnotations = rulesByName.filter((r) => {\n    return getRulerRuleFingerprint(r, false).join('-') === getPromRuleFingerprint(rule, false).join('-');\n  });\n\n  if (rulesByLabelsAndAnnotations.length === 1) {\n    return rulesByLabelsAndAnnotations[0];\n  }\n\n  // As a last resort, compare including the query\n  const rulesByLabelsAndAnnotationsAndQuery = rulesByName.filter((r) => {\n    return getRulerRuleFingerprint(r, true).join('-') === getPromRuleFingerprint(rule, true).join('-');\n  });\n\n  if (rulesByLabelsAndAnnotationsAndQuery.length === 1) {\n    return rulesByLabelsAndAnnotationsAndQuery[0];\n  }\n\n  return undefined;\n}\n\nexport function getMatchingPromRule(promRuleGroup: PromRuleGroupDTO<PromRuleDTO>, rule: RulerCloudRuleDTO) {\n  // If all rule names are unique, we can use the rule name to find the rule. We don't need to hash the rule\n  const rulesByName = promRuleGroup.rules.filter((r) => r.name === getRuleName(rule));\n  if (rulesByName.length === 1) {\n    return rulesByName[0];\n  }\n\n  // If we don't have a unique rule name, try to compare by labels and annotations\n  const rulesByLabelsAndAnnotations = rulesByName.filter((r) => {\n    return getPromRuleFingerprint(r, false).join('-') === getRulerRuleFingerprint(rule, false).join('-');\n  });\n\n  if (rulesByLabelsAndAnnotations.length === 1) {\n    return rulesByLabelsAndAnnotations[0];\n  }\n\n  // As a last resort, compare including the query\n  const rulesByLabelsAndAnnotationsAndQuery = rulesByName.filter((r) => {\n    return getPromRuleFingerprint(r, true).join('-') === getRulerRuleFingerprint(rule, true).join('-');\n  });\n\n  if (rulesByLabelsAndAnnotationsAndQuery.length === 1) {\n    return rulesByLabelsAndAnnotationsAndQuery[0];\n  }\n\n  return undefined;\n}\n\ninterface GroupMatchingResult {\n  matches: Map<RulerRuleDTO, PromRuleDTO>;\n  promOnlyRules: PromRuleDTO[];\n}\n\nexport function matchRulesGroup(\n  rulerGroup: RulerRuleGroupDTO<RulerCloudRuleDTO>,\n  promGroup: PromRuleGroupDTO<PromRuleDTO>\n): GroupMatchingResult {\n  const matchingResult = rulerGroup.rules.reduce(\n    (acc, rulerRule) => {\n      const { matches, unmatchedPromRules } = acc;\n\n      const promRule = getMatchingPromRule(promGroup, rulerRule);\n      if (promRule) {\n        matches.set(rulerRule, promRule);\n        unmatchedPromRules.delete(promRule);\n      }\n      return acc;\n    },\n    { matches: new Map<RulerRuleDTO, PromRuleDTO>(), unmatchedPromRules: new Set(promGroup.rules) }\n  );\n\n  return { matches: matchingResult.matches, promOnlyRules: Array.from(matchingResult.unmatchedPromRules) };\n}\n"],"names":["GrafanaRuleListItem","rule","groupIdentifier","namespaceName","operation","showLocation","name","uid","labels","provenance","groupUrl","commonProps","promAlertingRule","instancesCount","RuleActionsSkeleton","useGetGrafanaGroupsQuery","GrafanaGroupLoader","expectedRulesCount","styles","getStyles","promResponse","isPromResponseLoading","rules","pageItems","hasMore","loadMore","_","index","promRule","theme","DataSourceRuleListItem","rulerRule","application","actions","returnTo","rulesSource","namespace","groupName","ruleIdentifier","href","createViewLinkFromIdentifier","originMeta","ruleName","summary","identifier","paramId","paramSource","LoadMoreButton","onClick","loading","label","prometheusApi","build","ruleSource","groupLimit","excludeAlerts","groupNextToken","notificationOptions","response","folderUid","contactPoint","health","state","limitAlerts","_result","_error","usePopulateGrafanaPrometheusApiCache","dispatch","groups","group","RuleActionsButtons","compact","redirectToListView","deleteModal","showDeleteModal","showSilenceDrawer","setShowSilenceDrawer","redirectToClone","setRedirectToClone","isProvisioned","getIsProvisioned","editRuleSupported","editRuleAllowed","grafanaEditRuleSupported","grafanaEditRuleAllowed","canEditRule","buttons","buttonSize","getEditableIdentifier","ruleUid","silenceableRule","editURL","AlertRuleListItemSkeleton","RulerRuleLoadingError","error","errorMessage","useDiscoverDsFeaturesQuery","useGetGroupsQuery","useGetRuleGroupForNamespaceQuery","DataSourceGroupLoader","isPromResponseError","dsFeatures","isDsFeaturesLoading","isDsFeaturesError","rulerGroup","rulerGroupError","isRulerGroupFetching","isRulerGroupError","promGroup","g","RulerBasedGroupRules","matches","promOnlyRules","getMatchingRulerRule","rulerRuleGroup","rulesByName","r","rulesByLabelsAndAnnotations","rulesByLabelsAndAnnotationsAndQuery","getMatchingPromRule","promRuleGroup","matchRulesGroup","matchingResult","acc","unmatchedPromRules"],"sourceRoot":""}