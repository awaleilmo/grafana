{"version":3,"file":"FolderLibraryPanelsPage.67cba8216d7e003379c0.js","mappings":"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","sources":["webpack://grafana/./public/app/features/library-panels/components/OpenLibraryPanelModal/OpenLibraryPanelModal.tsx","webpack://grafana/./public/app/features/browse-dashboards/BrowseFolderLibraryPanelsPage.tsx"],"sourcesContent":["import debounce from 'debounce-promise';\nimport { MouseEvent, useCallback, useEffect, useMemo, useState } from 'react';\n\nimport { SelectableValue, urlUtil } from '@grafana/data';\nimport { Trans, t } from '@grafana/i18n';\nimport { locationService } from '@grafana/runtime';\nimport { AsyncSelect, Button, Modal } from '@grafana/ui';\n\nimport { DashboardSearchItem } from '../../../search/types';\nimport { getConnectedDashboards, getLibraryPanelConnectedDashboards } from '../../state/api';\nimport { LibraryElementDTO } from '../../types';\n\nexport interface OpenLibraryPanelModalProps {\n  onDismiss: () => void;\n  libraryPanel: LibraryElementDTO;\n}\n\nexport function OpenLibraryPanelModal({ libraryPanel, onDismiss }: OpenLibraryPanelModalProps): JSX.Element {\n  const [loading, setLoading] = useState(false);\n  const [connected, setConnected] = useState(0);\n  const [option, setOption] = useState<SelectableValue<DashboardSearchItem> | undefined>(undefined);\n  useEffect(() => {\n    const getConnected = async () => {\n      const connectedDashboards = await getLibraryPanelConnectedDashboards(libraryPanel.uid);\n      setConnected(connectedDashboards.length);\n    };\n    getConnected();\n  }, [libraryPanel.uid]);\n  const loadOptions = useCallback(\n    (searchString: string) => loadOptionsAsync(libraryPanel.uid, searchString, setLoading),\n    [libraryPanel.uid]\n  );\n  const debouncedLoadOptions = useMemo(() => debounce(loadOptions, 300, { leading: true }), [loadOptions]);\n\n  const onViewPanel = (e: MouseEvent<HTMLButtonElement>) => {\n    e.preventDefault();\n    locationService.push(urlUtil.renderUrl(`/d/${option?.value?.uid}`, {}));\n  };\n\n  return (\n    <Modal\n      title={t('library-panels.modal.title', 'View panel in dashboard')}\n      onDismiss={onDismiss}\n      onClickBackdrop={onDismiss}\n      isOpen\n    >\n      <div>\n        {connected === 0 ? (\n          <span>\n            <Trans i18nKey={'library-panels.modal.panel-not-linked'}>\n              Panel is not linked to a dashboard. Add the panel to a dashboard and retry.\n            </Trans>\n          </span>\n        ) : null}\n        {connected > 0 ? (\n          <>\n            <p>\n              <Trans i18nKey=\"library-panels.modal.body\" count={connected}>\n                This panel is being used in {{ count: connected }} dashboard. Please choose which dashboard to view the\n                panel in:\n              </Trans>\n            </p>\n            <AsyncSelect\n              isClearable\n              isLoading={loading}\n              defaultOptions={true}\n              loadOptions={debouncedLoadOptions}\n              onChange={setOption}\n              placeholder={t('library-panels.modal.select-placeholder', 'Start typing to search for dashboard')}\n              noOptionsMessage={t('library-panels.modal.select-no-options-message', 'No dashboards found')}\n            />\n          </>\n        ) : null}\n      </div>\n      <Modal.ButtonRow>\n        <Button variant=\"secondary\" onClick={onDismiss} fill=\"outline\">\n          <Trans i18nKey={'library-panels.modal.button-cancel'}>Cancel</Trans>\n        </Button>\n        <Button onClick={onViewPanel} disabled={!Boolean(option)}>\n          {option\n            ? t('library-panels.modal.button-view-panel1', 'View panel in {{label}}...', { label: option?.label })\n            : t('library-panels.modal.button-view-panel2', 'View panel in dashboard...')}\n        </Button>\n      </Modal.ButtonRow>\n    </Modal>\n  );\n}\n\nasync function loadOptionsAsync(uid: string, searchString: string, setLoading: (loading: boolean) => void) {\n  setLoading(true);\n  const searchHits = await getConnectedDashboards(uid);\n  const options = searchHits\n    .filter((d) => d.title.toLowerCase().includes(searchString.toLowerCase()))\n    .map((d) => ({ label: d.title, value: d }));\n  setLoading(false);\n\n  return options;\n}\n","import { useMemo, useState } from 'react';\nimport { useParams } from 'react-router-dom-v5-compat';\n\nimport { useGetFolderQueryFacade, useUpdateFolder } from 'app/api/clients/folder/v1beta1/hooks';\nimport { Page } from 'app/core/components/Page/Page';\n\nimport { GrafanaRouteComponentProps } from '../../core/navigation/types';\nimport { FolderActionsButton } from '../browse-dashboards/components/FolderActionsButton';\nimport { buildNavModel, getLibraryPanelsTabID } from '../folders/state/navModel';\nimport { LibraryPanelsSearch } from '../library-panels/components/LibraryPanelsSearch/LibraryPanelsSearch';\nimport { OpenLibraryPanelModal } from '../library-panels/components/OpenLibraryPanelModal/OpenLibraryPanelModal';\nimport { LibraryElementDTO } from '../library-panels/types';\n\nexport interface OwnProps extends GrafanaRouteComponentProps<{ uid: string }> {}\n\nexport function BrowseFolderLibraryPanelsPage() {\n  const { uid: folderUID = '' } = useParams();\n  const { data: folderDTO } = useGetFolderQueryFacade(folderUID);\n  const [selected, setSelected] = useState<LibraryElementDTO | undefined>(undefined);\n  const [saveFolder] = useUpdateFolder();\n\n  const navModel = useMemo(() => {\n    if (!folderDTO) {\n      return undefined;\n    }\n    const model = buildNavModel(folderDTO);\n\n    // Set the \"Library panels\" tab to active\n    const libraryPanelsTabID = getLibraryPanelsTabID(folderDTO.uid);\n    const libraryPanelsTab = model.children?.find((child) => child.id === libraryPanelsTabID);\n    if (libraryPanelsTab) {\n      libraryPanelsTab.active = true;\n    }\n    return model;\n  }, [folderDTO]);\n\n  const onEditTitle = folderUID\n    ? async (newValue: string) => {\n        if (folderDTO) {\n          const result = await saveFolder({\n            ...folderDTO,\n            title: newValue,\n          });\n          if ('error' in result) {\n            throw result.error;\n          }\n        }\n      }\n    : undefined;\n\n  return (\n    <Page\n      navId=\"dashboards/browse\"\n      pageNav={navModel}\n      onEditTitle={onEditTitle}\n      actions={<>{folderDTO && <FolderActionsButton folder={folderDTO} />}</>}\n    >\n      <Page.Contents>\n        <LibraryPanelsSearch\n          onClick={setSelected}\n          currentFolderUID={folderUID}\n          showSecondaryActions\n          showSort\n          showPanelFilter\n        />\n        {selected ? <OpenLibraryPanelModal onDismiss={() => setSelected(undefined)} libraryPanel={selected} /> : null}\n      </Page.Contents>\n    </Page>\n  );\n}\n\nexport default BrowseFolderLibraryPanelsPage;\n"],"names":["OpenLibraryPanelModal","libraryPanel","onDismiss","loading","setLoading","connected","setConnected","option","setOption","connectedDashboards","loadOptions","searchString","loadOptionsAsync","debouncedLoadOptions","onViewPanel","e","uid","options","d","BrowseFolderLibraryPanelsPage","folderUID","folderDTO","selected","setSelected","saveFolder","navModel","model","libraryPanelsTabID","libraryPanelsTab","child","onEditTitle","newValue","result"],"sourceRoot":""}