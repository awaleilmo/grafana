"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[2472],{4392:(M,p,s)=>{s.d(p,{A:()=>U});var e=s(94701),h=function(y){(0,e.A)(function(){y()})};const U=h},67521:(M,p,s)=>{s.r(p),s.d(p,{UserProfileEditPage:()=>Y,default:()=>le});var e=s(74848),h=s(71468),U=s(4392),y=s(54092),L=s(33604),b=s(41654),S=s(13791),E=s(13126),j=s(96540),g=s(51898),n=s(92745),d=s(6975),T=s(92807),P=s(45861);class v extends j.PureComponent{render(){const{isLoading:u,orgs:c,user:l}=this.props;return u?(0,e.jsx)(d._,{text:(0,n.t)("profile.user-organizations.text-loading-organizations","Loading organizations...")}):c.length===0?null:(0,e.jsxs)("div",{children:[(0,e.jsx)("h3",{className:"page-sub-heading",children:(0,e.jsx)(n.x6,{i18nKey:"user-orgs.title",children:"Organizations"})}),(0,e.jsx)(T.P,{overflowY:"visible",overflowX:"auto",width:"100%",children:(0,e.jsxs)("table",{className:"filter-table form-inline","data-testid":g.Tp.components.UserProfile.orgsTable,children:[(0,e.jsx)("thead",{children:(0,e.jsxs)("tr",{children:[(0,e.jsx)("th",{children:(0,e.jsx)(n.x6,{i18nKey:"user-orgs.name-column",children:"Name"})}),(0,e.jsx)("th",{children:(0,e.jsx)(n.x6,{i18nKey:"user-orgs.role-column",children:"Role"})}),(0,e.jsx)("th",{})]})}),(0,e.jsx)("tbody",{children:c.map((o,i)=>(0,e.jsxs)("tr",{children:[(0,e.jsx)("td",{children:o.name}),(0,e.jsx)("td",{children:o.role}),(0,e.jsx)("td",{className:"text-right",children:o.orgId===l?.orgId?(0,e.jsx)(P.$n,{variant:"secondary",size:"sm",disabled:!0,children:(0,e.jsx)(n.x6,{i18nKey:"user-orgs.current-org-button",children:"Current"})}):(0,e.jsx)(P.$n,{variant:"secondary",size:"sm",onClick:()=>{this.props.setUserOrg(o)},children:(0,e.jsx)(n.x6,{i18nKey:"user-orgs.select-org-button",children:"Select organisation"})})})]},i))})]})})]})}}const I=v;var O=s(16780),K=s(37386),N=s(63527),D=s(45967),C=s(30703),r=s(74410),a=s(65642);const{disableLoginForm:w}=a.Ay,Q=({user:t,isSavingUser:u,updateProfile:c})=>{const l=m=>{c(m)},o=(t&&t.isExternal)??!1;let i=o&&t&&t.authLabels?t.authLabels[0]:"";t?.isProvisioned&&(i="SCIM");const x=i?` (Synced via ${i})`:"",f=w||o;return(0,e.jsx)(r.l,{onSubmit:l,validateOn:"onBlur",children:({register:m,errors:A})=>(0,e.jsxs)(e.Fragment,{children:[(0,e.jsxs)(O.n,{children:[(0,e.jsx)(K.D,{label:(0,n.t)("user-profile.fields.name-label","Name")+x,invalid:!!A.name,error:(0,e.jsx)(n.x6,{i18nKey:"user-profile.fields.name-error",children:"Name is required"}),disabled:f,children:(0,e.jsx)(N.p,{...m("name",{required:!0}),id:"edit-user-profile-name",placeholder:(0,n.t)("user-profile.fields.name-label","Name"),defaultValue:t?.name??"",suffix:(0,e.jsx)(F,{})})}),(0,e.jsx)(K.D,{label:(0,n.t)("user-profile.fields.email-label","Email")+x,invalid:!!A.email,error:(0,e.jsx)(n.x6,{i18nKey:"user-profile.fields.email-error",children:"Email is required"}),disabled:f,children:(0,e.jsx)(N.p,{...m("email",{required:!0}),id:"edit-user-profile-email",placeholder:(0,n.t)("user-profile.fields.email-label","Email"),defaultValue:t?.email??"",suffix:(0,e.jsx)(F,{})})}),(0,e.jsx)(K.D,{label:(0,n.t)("user-profile.fields.username-label","Username")+x,disabled:f,children:(0,e.jsx)(N.p,{...m("login"),id:"edit-user-profile-username",defaultValue:t?.login??"",placeholder:(0,n.t)("user-profile.fields.username-label","Username")+x,suffix:(0,e.jsx)(F,{})})})]}),(0,e.jsx)(P.$n,{variant:"primary",disabled:u||f,"data-testid":g.Tp.components.UserProfile.profileSaveButton,type:"submit",children:(0,e.jsx)(n.x6,{i18nKey:"common.save",children:"Save"})})]})})},F=()=>w?(0,e.jsx)(D.m,{content:(0,n.t)("profile.input-suffix.content-login-details-locked-because-managed-another","Login details locked because they are managed in another system."),children:(0,e.jsx)(C.I,{name:"lock"})}):null;var W=s(54314),V=s(60208),X=s(13941),G=s(70958);const z="tab",R="general";function H(t){const{children:u,components:c}=t,l=J(c,u),[o,i]=Z(l);return c.length>0===!1?(0,e.jsx)(e.Fragment,{children:u}):(0,e.jsx)("div",{"data-testid":g.Tp.components.UserProfile.extensionPointTabs,children:(0,e.jsxs)(b.B,{direction:"column",gap:2,children:[(0,e.jsx)(W.U,{children:Object.values(l).map(({tabId:f,title:m})=>(0,e.jsx)(V.o,{label:m,active:o?.tabId===f,onChangeTab:()=>i(f),"data-testid":g.Tp.components.UserProfile.extensionPointTab(f)},f))}),(0,e.jsx)(X.J,{children:!!o&&(0,e.jsx)(j.Fragment,{children:o?.components.map((f,m)=>(0,e.jsx)(f,{},`${o?.tabId}-${m}`))},o?.tabId)})]})})}function J(t,u){return(0,j.useMemo)(()=>{const c={[R]:{title:(0,n.t)("user-profile.tabs.general","General"),tabId:R,components:[()=>(0,e.jsx)(e.Fragment,{children:u})]}};return t.reduce((l,o)=>{const{title:i}=o.meta,x=$(i);return l[x]||(l[x]={title:i,tabId:x,components:[]}),l[x].components.push(o),l},c)},[t,u])}function Z(t){const[u,c]=(0,G.s)(),l=k(u[z]),o=t[l],i=(0,j.useCallback)(x=>c({[z]:x}),[c]);return[o,i]}function k(t){return typeof t!="string"?R:$(t)}function $(t){return t.toLowerCase()}var q=s(22803),_=s(11297),ee=s(12810);class se extends j.PureComponent{render(){const{isLoading:u,sessions:c,revokeUserSession:l}=this.props,o=ne();return u?(0,e.jsx)(d._,{text:(0,e.jsx)(n.x6,{i18nKey:"user-sessions.loading",children:"Loading sessions..."})}):(0,e.jsx)("div",{className:o.wrapper,children:c.length>0&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("h3",{className:"page-sub-heading",children:(0,e.jsx)(n.x6,{i18nKey:"profile.user-sessions.sessions",children:"Sessions"})}),(0,e.jsx)(T.P,{overflowY:"visible",overflowX:"auto",width:"100%",children:(0,e.jsxs)("table",{className:"filter-table form-inline","data-testid":g.Tp.components.UserProfile.sessionsTable,children:[(0,e.jsx)("thead",{children:(0,e.jsxs)("tr",{children:[(0,e.jsx)("th",{children:(0,e.jsx)(n.x6,{i18nKey:"user-session.seen-at-column",children:"Last seen"})}),(0,e.jsx)("th",{children:(0,e.jsx)(n.x6,{i18nKey:"user-session.created-at-column",children:"Logged on"})}),(0,e.jsx)("th",{children:(0,e.jsx)(n.x6,{i18nKey:"user-session.ip-column",children:"IP address"})}),(0,e.jsx)("th",{children:(0,e.jsx)(n.x6,{i18nKey:"user-session.browser-column",children:"Browser & OS"})}),(0,e.jsx)("th",{children:(0,e.jsx)(n.x6,{i18nKey:"user-session.identity-provider-column",children:"Identity Provider"})}),(0,e.jsx)("th",{})]})}),(0,e.jsx)("tbody",{children:c.map((i,x)=>(0,e.jsxs)("tr",{children:[i.isActive?(0,e.jsx)("td",{children:(0,e.jsx)(n.x6,{i18nKey:"profile.user-sessions.now",children:"Now"})}):(0,e.jsx)("td",{children:i.seenAt}),(0,e.jsx)("td",{children:(0,ee.Y)(i.createdAt,{dateStyle:"long"})}),(0,e.jsx)("td",{children:i.clientIp}),(0,e.jsx)("td",{children:(0,e.jsxs)(n.x6,{i18nKey:"profile.user-sessions.browser-details",values:{browser:i.browser,os:i.os,osVersion:i.osVersion},children:["{{browser}}"," on ","{{os}}"," ","{{osVersion}}"]})}),(0,e.jsx)("td",{children:i.authModule&&(0,e.jsx)(_.E,{label:i.authModule,removeIcon:!1,count:0})}),(0,e.jsx)("td",{children:(0,e.jsx)(P.$n,{size:"sm",variant:"destructive",tooltip:(0,n.t)("user-session.revoke","Revoke user session"),onClick:()=>l(i.id),"aria-label":(0,n.t)("user-session.revoke","Revoke user session"),children:(0,e.jsx)(C.I,{name:"power"})})})]},x))})]})})]})})}}const ne=()=>({wrapper:(0,q.css)({maxWidth:"100%"})}),re=se;class te extends j.PureComponent{render(){const{isLoading:u,teams:c}=this.props;return u?(0,e.jsx)(d._,{text:(0,n.t)("profile.user-teams.text-loading-teams","Loading teams...")}):c.length===0?null:(0,e.jsxs)("div",{children:[(0,e.jsx)("h3",{className:"page-sub-heading",children:(0,e.jsx)(n.x6,{i18nKey:"profile.user-teams.teams",children:"Teams"})}),(0,e.jsx)(T.P,{overflowY:"visible",overflowX:"auto",width:"100%",children:(0,e.jsxs)("table",{className:"filter-table form-inline","aria-label":(0,n.t)("profile.user-teams.aria-label-user-teams-table","User teams table"),children:[(0,e.jsx)("thead",{children:(0,e.jsxs)("tr",{children:[(0,e.jsx)("th",{}),(0,e.jsx)("th",{children:(0,e.jsx)(n.x6,{i18nKey:"profile.user-teams.name",children:"Name"})}),(0,e.jsx)("th",{children:(0,e.jsx)(n.x6,{i18nKey:"profile.user-teams.email",children:"Email"})}),(0,e.jsx)("th",{children:(0,e.jsx)(n.x6,{i18nKey:"profile.user-teams.members",children:"Members"})})]})}),(0,e.jsx)("tbody",{children:c.map((l,o)=>(0,e.jsxs)("tr",{children:[(0,e.jsx)("td",{className:"width-4 text-center",children:(0,e.jsx)("img",{className:"filter-table__avatar",src:l.avatarUrl,alt:""})}),(0,e.jsx)("td",{children:l.name}),(0,e.jsx)("td",{children:l.email}),(0,e.jsx)("td",{children:l.memberCount})]},o))})]})})]})}}const me=null;var B=s(88482);function ie(t){const u=t.user,{user:c,teams:l,orgs:o,sessions:i,teamsAreLoading:x,orgsAreLoading:f,sessionsAreLoading:m,isUpdating:A}=u;return{orgsAreLoading:f,sessionsAreLoading:m,teamsAreLoading:x,orgs:o,sessions:i,teams:l,isUpdating:A,user:c}}const oe={initUserProfilePage:B.Qe,revokeUserSession:B._O,changeUserOrg:B.Aj,updateUserProfile:B.eg},ae=(0,h.connect)(ie,oe);function Y({orgsAreLoading:t,sessionsAreLoading:u,teamsAreLoading:c,initUserProfilePage:l,orgs:o,sessions:i,teams:x,isUpdating:f,user:m,revokeUserSession:A,changeUserOrg:de,updateUserProfile:ce}){(0,U.A)(()=>l());const{components:ue,isLoading:xe}=(0,L.f)({extensionPointId:y.SM.UserProfileTab});return(0,e.jsx)(S.Y,{navId:"profile/settings",children:(0,e.jsx)(S.Y.Contents,{isLoading:!m||xe,children:(0,e.jsx)(H,{components:ue,children:(0,e.jsxs)(b.B,{direction:"column",gap:2,"data-testid":"user-profile-edit-page",children:[(0,e.jsx)(Q,{updateProfile:ce,isSavingUser:f,user:m}),(0,e.jsx)(E.A,{resourceUri:"user",preferenceType:"user"}),(0,e.jsxs)(b.B,{direction:"column",gap:6,children:[(0,e.jsx)(te,{isLoading:c,teams:x}),(0,e.jsx)(I,{isLoading:t,setUserOrg:de,orgs:o,user:m}),(0,e.jsx)(re,{isLoading:u,revokeUserSession:A,sessions:i})]})]})})})})}const le=ae(Y)},74410:(M,p,s)=>{s.d(p,{l:()=>L});var e=s(74848),h=s(22803),U=s(96540),y=s(49785);function L({defaultValues:b,onSubmit:S,validateOnMount:E=!1,validateFieldsOnMount:j,children:g,validateOn:n="onSubmit",maxWidth:d=600,...T}){const{handleSubmit:P,trigger:v,formState:I,...O}=(0,y.mN)({mode:n,defaultValues:b});return(0,U.useEffect)(()=>{E&&v(j)},[v,j,E]),(0,e.jsx)("form",{className:(0,h.css)({maxWidth:d!=="none"?d+"px":d,width:"100%"}),onSubmit:P(S),...T,children:g({errors:I.errors,formState:I,trigger:v,...O})})}},88482:(M,p,s)=>{s.d(p,{ec:()=>T,Aj:()=>D,Qe:()=>P,YW:()=>v,_O:()=>N,eg:()=>C});var e=s(43173),h=s(68143);async function U(r){try{await(0,h.AI)().put("/api/user/password",r)}catch(a){console.error(a)}}function y(){return(0,h.AI)().get("/api/user")}function L(){return(0,h.AI)().get("/api/user/teams")}function b(){return(0,h.AI)().get("/api/user/orgs")}function S(){return(0,h.AI)().get("/api/user/auth-tokens")}async function E(r){await(0,h.AI)().post("/api/user/revoke-auth-token",{authTokenId:r})}async function j(r){await(0,h.AI)().post("/api/user/using/"+r.orgId,{})}async function g(r){try{await(0,h.AI)().put("/api/user",r)}catch(a){console.error(a)}}const n={changePassword:U,revokeUserSession:E,loadUser:y,loadSessions:S,loadOrgs:b,loadTeams:L,setUserOrg:j,updateUserProfile:g};var d=s(69289);function T(r){return async function(a){a((0,d.Nm)({updating:!0})),await n.changePassword(r),a((0,d.Nm)({updating:!1}))}}function P(){return async function(r){await r(v()),r(I()),r(O()),r(K())}}function v(){return async function(r){const a=await n.loadUser();r((0,d.HO)({user:a}))}}function I(){return async function(r){r((0,d.ri)());const a=await n.loadTeams();r((0,d.Q9)({teams:a}))}}function O(){return async function(r){r((0,d.Mj)());const a=await n.loadOrgs();r((0,d.ny)({orgs:a}))}}function K(){return async function(r){r((0,d.uh)());const a=await n.loadSessions();r((0,d.RS)({sessions:a}))}}function N(r){return async function(a){a((0,d.Nm)({updating:!0})),await n.revokeUserSession(r),a((0,d.g$)({tokenId:r}))}}function D(r){return async function(a){a((0,d.Nm)({updating:!0})),await n.setUserOrg(r),window.location.href=e.$.appSubUrl+"/profile"}}function C(r){return async function(a){a((0,d.Nm)({updating:!0})),await n.updateUserProfile(r),await a(v()),a((0,d.Nm)({updating:!1}))}}}}]);

//# sourceMappingURL=UserProfileEditPage.6ebcc9cb9158e8c9c57a.js.map