"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[1909,4312],{12266:(Re,ae,t)=>{t.d(ae,{e:()=>c});var e=t(74848),E=t(45861);const c=({isCollapsed:a,onToggle:w,idControlled:Z,className:X,text:ue,size:fe="xl",...re})=>(0,e.jsx)(E.$n,{type:"button",fill:"text",variant:"secondary","aria-expanded":!a,"aria-controls":Z,className:X,icon:a?"angle-right":"angle-down",onClick:()=>w(!a),...re,children:ue})},19726:(Re,ae,t)=>{t.r(ae),t.d(ae,{default:()=>an});var e=t(74848),E=t(22803),c=t(96540),a=t(92745),w=t(63142),Z=t(54314),X=t(60208),ue=t(13941),fe=t(70958),re=t(51686),me=t(2543),D=t(41053),z=t(34999),I=t(41654),j=t(45861),he=t(64762),k=t(97507),b=t(16692),T=t(20443),te=t(77256),Se=t(48442),ie=t(84266),ve=t(80218),oe=t(5358),we=t(33998),Be=t(91984),Ge=t(95443),Te=t(5709),ge=t(75505),xe=t(68143),Ie=t(52161);const Ae=n=>{const i=n.match(/^(\w+)(\[\d+\])?$/);return i?{type:i[1],index:i[2]}:{type:n,index:void 0}},v=n=>{const i={receivers:{},errorCount:0};n.forEach(s=>{i.receivers[s.name]={active:s.active,notifiers:{},errorCount:0};const l=i.receivers[s.name];s.integrations.forEach(d=>{!!d?.lastNotifyAttemptError&&(l.errorCount+=1);const u=$(d.name);u&&(l.notifiers[u]||(l.notifiers[u]=[]),l.notifiers[u].push(d))})});const o=Object.values(i.receivers).reduce((s,l)=>s+l.errorCount,0);return{...i,errorCount:o}},$=n=>Ae(n)?.type;async function K(n){try{const i=await(0,ge.s)((0,xe.AI)().fetch({url:`/api/alertmanager/${(0,Ie.w5)(n)}/config/api/v1/receivers`,showErrorAlert:!1,showSuccessAlert:!1}));return v(i.data)}catch{return v([])}}const L=Te.H.injectEndpoints({endpoints:n=>({contactPointsState:n.query({queryFn:async({amSourceName:i})=>{try{return{data:await K(i)}}catch(o){return{error:o}}}})})}),U=n=>{const i={receivers:{},errorCount:0},{currentData:o}=L.useContactPointsStateQuery({amSourceName:n??""},{skip:!n,pollingInterval:Ge.cB});return o??i};var P=t(59062),se=t(47987),r=t(37386),m=t(72636),p=t(45967),W=t(30703),A=t(63527),B=t(66404),q=t(20962),V=t(86017),Q=t(63895),O=t(18857),Y=t(24961);const ne=500,H=({selectProps:n,selectedContactPointName:i,onError:o=()=>{}})=>{const{selectedAlertmanager:s}=(0,oe.VI)(),{contactPoints:l,isLoading:d,error:f}=(0,k.dK)({alertmanager:s}),u=l.map(g=>({label:g.name,value:g,component:()=>(0,e.jsx)(B.E,{variant:"bodySmall",color:"secondary",children:(0,e.jsx)(Y.yz,{receivers:g.grafana_managed_receiver_configs,limit:2})})})),h=(0,c.useMemo)(()=>u.find(g=>g.value?.name===i)||null,[u,i]);return(0,c.useEffect)(()=>{!d&&i&&!h&&o(new Error(`Contact point "${i}" could not be found`))},[d,h,o,i]),f?(0,e.jsx)(z.F,{title:(0,a.t)("alerting.contact-point-selector.title-failed-to-fetch-contact-points","Failed to fetch contact points"),severity:"error"}):(0,e.jsx)(O.l6,{virtualized:u.length>ne,options:u,value:h,...n,isLoading:d,disabled:d})},Me=({onChangeReceiver:n,onChangeMatchers:i,matchingCount:o})=>{const[s,l]=(0,b.L7)(b.QI.ViewContactPoint),{isGrafanaAlertmanager:d}=(0,oe.VI)(),[f,u]=(0,q.l)(),h=(0,c.useRef)(null),{queryString:g,contactPoint:x}=ct(f),S=(0,w.of)(dt),R=(0,c.useCallback)(()=>(0,me.debounce)(i,500),[i]);(0,c.useEffect)(()=>{n(x)},[x,n]),(0,c.useEffect)(()=>{const M=(0,Q.Zc)(g??"").map(V.NL);R()(M)},[R,g]);const C=(0,c.useCallback)(()=>{h.current&&(h.current.value=""),u({contactPoint:"",queryString:void 0})},[u]),y=g||x;let N=!!(g&&g.length>3);try{g?(0,Q.S6)(g):N=!0}catch{N=!1}return(0,e.jsxs)(I.B,{direction:"row",alignItems:"flex-end",gap:1,children:[(0,e.jsx)(r.D,{className:S.noBottom,label:(0,e.jsx)(m.J,{children:(0,e.jsxs)(I.B,{gap:.5,children:[(0,e.jsx)(a.x6,{i18nKey:"alerting.common.search-by-matchers",children:"Search by matchers"}),(0,e.jsx)(p.m,{content:(0,e.jsxs)(a.x6,{i18nKey:"alerting.policies.filter-description",children:["Filter notification policies by using a comma separated list of matchers, e.g.:",(0,e.jsx)("pre",{children:"severity=critical, region=EMEA"})]}),children:(0,e.jsx)(W.I,{name:"info-circle",size:"sm"})})]})}),invalid:!N,error:N?null:"Query must use valid matcher syntax",children:(0,e.jsx)(A.p,{ref:h,"data-testid":"search-query-input",placeholder:(0,a.t)("alerting.notification-policies-filter.search-query-input-placeholder-search","Search"),width:46,prefix:(0,e.jsx)(W.I,{name:"search"}),onChange:M=>{u({queryString:M.currentTarget.value})},defaultValue:g})}),s&&l&&(0,e.jsx)(r.D,{label:(0,a.t)("alerting.notification-policies-filter.label-search-by-contact-point","Search by contact point"),style:{marginBottom:0},children:d?(0,e.jsx)(se.u,{placeholder:(0,a.t)("alerting.notification-policies-filter.placeholder-search-by-contact-point","Choose a contact point"),id:"receiver",onChange:M=>{u(M?{contactPoint:M.spec.title}:{contactPoint:void 0})},width:28,isClearable:!0,value:f.get("contactPoint")??void 0}):(0,e.jsx)(H,{selectProps:{id:"receiver","aria-label":"Search by contact point",onChange:M=>{u({contactPoint:M?.value?.name})},width:28,isClearable:!0,placeholder:(0,a.t)("alerting.notification-policies-filter.placeholder-search-by-contact-point","Choose a contact point")},selectedContactPointName:f.get("contactPoint")??void 0})}),y&&(0,e.jsxs)(I.B,{alignItems:"center",children:[(0,e.jsx)(j.$n,{variant:"secondary",icon:"times",onClick:C,children:(0,e.jsx)(a.x6,{i18nKey:"alerting.common.clear-filters",children:"Clear filters"})}),(0,e.jsxs)(B.E,{variant:"bodySmall",color:"secondary",children:[o===0&&"No policies matching filters.",o===1&&`${o} policy matches the filters.`,o>1&&`${o} policies match the filters.`]})]})]})};function Ze(n,i){const o=new Map;function s(l,d){const f=[...d,l];if(i(l)){const u=o.get(l)??[];o.set(l,[...u,...f])}l.routes?.forEach(u=>s(u,f))}return s(n,[]),o}function lt(n,i){const o=i.map(Xe),s=(0,Q.J$)(n).map(Xe);return o.every(l=>s.some(d=>(0,me.isEqual)(l,d)))}const Xe=([n,i,o])=>[(0,Q.yk)(n),i,(0,Q.yk)(o)],ct=n=>({queryString:n.get("queryString")??void 0,contactPoint:n.get("contactPoint")??void 0}),dt=()=>({noBottom:(0,E.css)({marginBottom:0})});var ye=t(22787),ut=t(68079),mt=t(82658),gt=t(55127),pt=t.n(gt),Ne=t(99887);const ft=({active:n=0,suppressed:i=0,unprocessed:o=0})=>{const s=[],l=n+i+o;return n&&s.push((0,e.jsx)(Ne.E,{color:"red",text:(0,a.t)("alerting.alert-groups-summary.text-firing","{{count}} firing",{count:n})},"firing")),i&&s.push((0,e.jsx)(Ne.E,{color:"blue",text:(0,a.t)("alerting.alert-groups-summary.text-suppressed","{{count}} suppressed",{count:i})},"suppressed")),o&&s.push((0,e.jsx)(Ne.E,{color:"orange",text:(0,a.t)("alerting.alert-groups-summary.text-unprocessed","{{count}} unprocessed",{count:o})},"unprocessed")),s.length>1&&s.unshift((0,e.jsxs)(c.Fragment,{children:[l," ",pt()("instance",l)]},"total")),!!s.length?(0,e.jsx)(I.B,{gap:.5,children:s}):null};var je=t(49785),ht=t(20941),vt=t(89599);const Le=(n,i)=>i(n===null?null:n||"");var De=t(21563),ke=t(65120),Ve=t(61474);const xt=({actionButtons:n,alertManagerSourceName:i,onSubmit:o,route:s})=>{const l=(0,w.of)(ke.t),[d,f]=(0,c.useState)(!1),{isGrafanaAlertmanager:u}=(0,oe.VI)(),[h,g]=(0,c.useState)((0,T.gY)(s.group_by)),x=(0,T.YE)(s),{handleSubmit:S,register:R,control:C,formState:{errors:y},setValue:N,getValues:M}=(0,je.mN)({defaultValues:{...x,overrideTimings:!0,overrideGrouping:!0}});return(0,e.jsxs)("form",{onSubmit:S(o),children:[(0,e.jsx)(r.D,{label:(0,a.t)("alerting.am-root-route-form.label-default-contact-point","Default contact point"),invalid:y.receiver?!0:void 0,error:y.receiver?.message,children:(0,e.jsxs)("div",{className:l.container,"data-testid":"am-receiver-select",children:[(0,e.jsx)(je.xI,{render:({field:{onChange:F,ref:Ee,value:be,...le}})=>u?(0,e.jsx)(se.u,{onChange:ce=>{Le(ce?.spec.title,F)},isClearable:!1,value:be,placeholder:(0,a.t)("alerting.notification-policies-filter.placeholder-search-by-contact-point","Choose a contact point")}):(0,e.jsx)(H,{selectProps:{...le,onChange:ce=>Le(ce.value?.name,F)},selectedContactPointName:be}),control:C,name:"receiver",rules:{required:{value:!0,message:(0,a.t)("alerting.am-root-route-form.message.required","Required.")}}}),(0,e.jsx)("span",{children:(0,e.jsx)(a.x6,{i18nKey:"alerting.am-root-route-form.or",children:"or"})}),(0,e.jsx)(ht.N,{className:l.linkText,href:(0,te.nL)("/alerting/notifications/receivers/new",i),children:(0,e.jsx)(a.x6,{i18nKey:"alerting.am-root-route-form.create-a-contact-point",children:"Create a contact point"})})]})}),(0,e.jsx)(r.D,{label:(0,a.t)("alerting.am-root-route-form.am-group-select-label-group-by","Group by"),description:(0,a.t)("alerting.am-root-route-form.am-group-select-description-group-by","Combine multiple alerts into a single notification by grouping them by the same label values."),"data-testid":"am-group-select",children:(0,e.jsx)(je.xI,{render:({field:{onChange:F,ref:Ee,...be}})=>(0,e.jsx)(O.KF,{"aria-label":(0,a.t)("alerting.am-root-route-form.aria-label-group-by","Group by"),...be,allowCustomValue:!0,className:l.input,onCreateOption:le=>{g(ce=>[...ce,(0,T.Mk)(le)]),N("groupBy",[...be.value||[],le])},onChange:le=>F((0,T.ie)(le)),options:[...T.Yl,...h]}),control:C,name:"groupBy"})}),(0,e.jsx)(vt.S,{collapsible:!0,className:l.collapse,isOpen:d,label:(0,a.t)("alerting.am-root-route-form.label-timing-options","Timing options"),onToggle:f,children:(0,e.jsxs)("div",{className:l.timingFormContainer,children:[(0,e.jsx)(r.D,{label:(0,a.t)("alerting.am-root-route-form.am-group-wait-label-group-wait","Group wait"),description:(0,a.t)("alerting.am-root-route-form.am-group-description-label","The waiting time before sending the first notification for a new group of alerts. Default 30 seconds."),invalid:!!y.groupWaitValue,error:y.groupWaitValue?.message,"data-testid":"am-group-wait",children:(0,e.jsx)(De.V,{...R("groupWaitValue",{validate:T.hH}),placeholder:Ve.H.group_wait,className:l.promDurationInput,"aria-label":(0,a.t)("alerting.am-root-route-form.aria-label-group-wait","Group wait")})}),(0,e.jsx)(r.D,{label:(0,a.t)("alerting.am-root-route-form.am-group-interval-label-group-interval","Group interval"),description:(0,a.t)("alerting.am-root-route-form.am-group-interval-description","The wait time before sending a notification about changes in the alert group after the first notification has been sent. Default is 5 minutes."),invalid:!!y.groupIntervalValue,error:y.groupIntervalValue?.message,"data-testid":"am-group-interval",children:(0,e.jsx)(De.V,{...R("groupIntervalValue",{validate:T.hH}),placeholder:Ve.H.group_interval,className:l.promDurationInput,"aria-label":(0,a.t)("alerting.am-root-route-form.aria-label-group-interval","Group interval")})}),(0,e.jsx)(r.D,{label:(0,a.t)("alerting.am-root-route-form.am-repeat-interval-label-repeat-interval","Repeat interval"),description:(0,a.t)("alerting.am-root-route-form.am-repeat-interval-description","The wait time before resending a notification that has already been sent successfully. Default is 4 hours. Should be a multiple of Group interval."),invalid:!!y.repeatIntervalValue,error:y.repeatIntervalValue?.message,"data-testid":"am-repeat-interval",children:(0,e.jsx)(De.V,{...R("repeatIntervalValue",{validate:F=>{const Ee=M("groupIntervalValue");return(0,T.DY)(F,Ee)}}),placeholder:Ve.H.repeat_interval,className:l.promDurationInput,"aria-label":(0,a.t)("alerting.am-root-route-form.aria-label-repeat-interval","Repeat interval")})})]})}),(0,e.jsx)("div",{className:l.container,children:n})]})};var yt=t(76319),We=t(21285),jt=t(12594),qe=t(55684),Ce=t(92649);const _e=({actionButtons:n,route:i,onSubmit:o,defaults:s})=>{const l=(0,w.of)(bt),d=(0,w.of)(ke.t),{selectedAlertmanager:f,isGrafanaAlertmanager:u}=(0,oe.VI)(),[,h]=(0,b.L7)(b.QI.ViewTimeInterval),[g,x]=(0,c.useState)((0,T.gY)(i?.group_by)),S=[{name:"",operator:ie.ho.equal,value:""}],R={...(0,T.YE)(i),...s},C={...R,object_matchers:i?R.object_matchers:S},{handleSubmit:y,control:N,register:M,formState:{errors:F},setValue:Ee,watch:be,getValues:le}=(0,je.mN)({defaultValues:C}),{fields:ce,append:Oe,remove:Ke}=(0,je.jz)({control:N,name:"object_matchers"});return(0,e.jsxs)("form",{onSubmit:y(o),children:[(0,e.jsx)("input",{type:"hidden",...M("id")}),(0,e.jsxs)(I.B,{direction:"column",alignItems:"flex-start",children:[(0,e.jsx)("div",{children:(0,e.jsx)(a.x6,{i18nKey:"alerting.am-routes-expanded-form.matching-labels",children:"Matching labels"})}),ce.length===0&&(0,e.jsx)(Ne.E,{color:"orange",className:l.noMatchersWarning,icon:"exclamation-triangle",text:(0,a.t)("alerting.am-routes-expanded-form.badge-no-matchers","If no matchers are specified, this notification policy will handle all alert instances.")}),ce.length>0&&(0,e.jsx)("div",{className:l.matchersContainer,children:ce.map((G,J)=>(0,e.jsxs)(I.B,{direction:"row",alignItems:"center",children:[(0,e.jsx)(r.D,{label:(0,a.t)("alerting.am-routes-expanded-form.label-label","Label"),invalid:!!F.object_matchers?.[J]?.name,error:F.object_matchers?.[J]?.name?.message,children:(0,e.jsx)(A.p,{...M(`object_matchers.${J}.name`,{required:"Field is required"}),defaultValue:G.name,placeholder:(0,a.t)("alerting.am-routes-expanded-form.placeholder-label","label"),autoFocus:!0})}),(0,e.jsx)(r.D,{label:(0,a.t)("alerting.am-routes-expanded-form.label-operator","Operator"),children:(0,e.jsx)(je.xI,{render:({field:{onChange:_,ref:ee,...de}})=>(0,e.jsx)(O.l6,{...de,className:l.matchersOperator,onChange:Fe=>_(Fe?.value),options:V.xH,"aria-label":(0,a.t)("alerting.am-routes-expanded-form.aria-label-operator","Operator")}),defaultValue:G.operator,control:N,name:`object_matchers.${J}.operator`,rules:{required:{value:!0,message:(0,a.t)("alerting.am-routes-expanded-form.message.required","Required.")}}})}),(0,e.jsx)(r.D,{label:(0,a.t)("alerting.am-routes-expanded-form.label-value","Value"),invalid:!!F.object_matchers?.[J]?.value,error:F.object_matchers?.[J]?.value?.message,children:(0,e.jsx)(A.p,{...M(`object_matchers.${J}.value`),defaultValue:G.value,placeholder:(0,a.t)("alerting.am-routes-expanded-form.placeholder-value","value")})}),(0,e.jsx)(yt.K,{tooltip:(0,a.t)("alerting.am-routes-expanded-form.tooltip-remove-matcher","Remove matcher"),name:"trash-alt",onClick:()=>Ke(J),children:(0,e.jsx)(a.x6,{i18nKey:"alerting.am-routes-expanded-form.remove",children:"Remove"})})]},G.id))}),(0,e.jsx)(j.$n,{className:l.addMatcherBtn,icon:"plus",onClick:()=>Oe(T.Rg),variant:"secondary",type:"button",children:(0,e.jsx)(a.x6,{i18nKey:"alerting.am-routes-expanded-form.add-matcher",children:"Add matcher"})})]}),(0,e.jsx)(r.D,{label:(0,a.t)("alerting.am-routes-expanded-form.label-contact-point","Contact point"),children:(0,e.jsx)(je.xI,{render:({field:{onChange:G,ref:J,value:_,...ee}})=>u?(0,e.jsx)(se.u,{onChange:de=>{Le(de?.spec.title,G)},isClearable:!0,value:_,placeholder:(0,a.t)("alerting.notification-policies-filter.placeholder-search-by-contact-point","Choose a contact point")}):(0,e.jsx)(H,{selectProps:{...ee,className:d.input,onChange:de=>Le(de.value?.name,G),isClearable:!0},selectedContactPointName:_}),control:N,name:"receiver"})}),(0,e.jsx)(r.D,{label:(0,a.t)("alerting.am-routes-expanded-form.label-continue-matching-subsequent-sibling-nodes","Continue matching subsequent sibling nodes"),children:(0,e.jsx)(We.d,{id:"continue-toggle",...M("continue")})}),(0,e.jsx)(r.D,{label:(0,a.t)("alerting.am-routes-expanded-form.label-override-grouping","Override grouping"),children:(0,e.jsx)(We.d,{id:"override-grouping-toggle",...M("overrideGrouping")})}),be().overrideGrouping&&(0,e.jsx)(r.D,{label:(0,a.t)("alerting.am-routes-expanded-form.label-group-by","Group by"),description:(0,a.t)("alerting.am-routes-expanded-form.description-group-by","Combine multiple alerts into a single notification by grouping them by the same label values. If empty, it is inherited from the parent policy."),children:(0,e.jsx)(je.xI,{rules:{validate:G=>!G||G.length===0?"At least one group by option is required.":!0},render:({field:{onChange:G,ref:J,..._},fieldState:{error:ee}})=>(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(O.KF,{"aria-label":(0,a.t)("alerting.am-routes-expanded-form.aria-label-group-by","Group by"),..._,invalid:!!ee,allowCustomValue:!0,className:d.input,onCreateOption:de=>{x(Fe=>[...Fe,(0,T.Mk)(de)]),Ee("groupBy",[..._.value||[],de])},onChange:de=>G((0,T.ie)(de)),options:[...T.Yl,...g]}),ee&&(0,e.jsx)(jt.P,{children:ee.message})]}),control:N,name:"groupBy"})}),(0,e.jsx)(r.D,{label:(0,a.t)("alerting.am-routes-expanded-form.label-override-general-timings","Override general timings"),children:(0,e.jsx)(We.d,{id:"override-timings-toggle",...M("overrideTimings")})}),be().overrideTimings&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(r.D,{label:Ce.G.groupWait.label,description:Ce.G.groupWait.description,invalid:!!F.groupWaitValue,error:F.groupWaitValue?.message,children:(0,e.jsx)(De.V,{...M("groupWaitValue",{validate:T.hH}),"aria-label":Ce.G.groupWait.ariaLabel,className:d.promDurationInput})}),(0,e.jsx)(r.D,{label:Ce.G.groupInterval.label,description:Ce.G.groupInterval.description,invalid:!!F.groupIntervalValue,error:F.groupIntervalValue?.message,children:(0,e.jsx)(De.V,{...M("groupIntervalValue",{validate:T.hH}),"aria-label":Ce.G.groupInterval.ariaLabel,className:d.promDurationInput})}),(0,e.jsx)(r.D,{label:Ce.G.repeatInterval.label,description:Ce.G.repeatInterval.description,invalid:!!F.repeatIntervalValue,error:F.repeatIntervalValue?.message,children:(0,e.jsx)(De.V,{...M("repeatIntervalValue",{validate:(G="")=>{const J=le("groupIntervalValue");return(0,T.DY)(G,J)}}),"aria-label":Ce.G.repeatInterval.ariaLabel,className:d.promDurationInput})})]}),(0,e.jsx)(r.D,{label:(0,a.t)("alerting.am-routes-expanded-form.am-mute-timing-select-label-mute-timings","Mute timings"),"data-testid":"am-mute-timing-select",description:(0,a.t)("alerting.am-routes-expanded-form.am-mute-timing-select-description-add-mute-timing-to-policy","Add mute timing to policy"),invalid:!!F.muteTimeIntervals,children:(0,e.jsx)(je.xI,{render:({field:{onChange:G,ref:J,..._}})=>(0,e.jsx)(qe.A,{alertmanager:f,selectProps:{..._,disabled:!h,onChange:ee=>G((0,T.ie)(ee))}}),control:N,name:"muteTimeIntervals"})}),(0,e.jsx)(r.D,{label:(0,a.t)("alerting.am-routes-expanded-form.am-active-timing-select-label-active-timings","Active timings"),"data-testid":"am-active-timing-select",description:(0,a.t)("alerting.am-routes-expanded-form.am-mute-timing-select-description-add-active-timing-to-policy","Add active timing to policy"),invalid:!!F.activeTimeIntervals,children:(0,e.jsx)(je.xI,{render:({field:{onChange:G,ref:J,..._}})=>(0,e.jsx)(qe.A,{alertmanager:f,selectProps:{..._,disabled:!h,onChange:ee=>G((0,T.ie)(ee))}}),control:N,name:"activeTimeIntervals"})}),n]})},bt=n=>{const i=n.spacing(3.5);return{addMatcherBtn:(0,E.css)({marginBottom:i}),matchersContainer:(0,E.css)({backgroundColor:n.colors.background.secondary,padding:`${n.spacing(1.5)} ${n.spacing(2)}`,paddingBottom:0,width:"fit-content"}),matchersOperator:(0,E.css)({minWidth:"120px"}),noMatchersWarning:(0,E.css)({padding:`${n.spacing(1)} ${n.spacing(2)}`,marginBottom:n.spacing(1)})}};var St=t(92125);const $e=({error:n})=>{const i=(0,a.t)("alerting.policies.update-errors.title","Failed to add or update notification policy"),o=(0,te.JZ)(n);return(0,e.jsxs)(z.F,{title:i,severity:"error",children:[(0,e.jsx)("div",{children:o}),(0,e.jsx)(a.x6,{i18nKey:"alerting.policies.update-errors.suffix",children:"Please refresh the page and try again."})]})},Ct=(n,i)=>{const[o,s]=(0,c.useState)(!1),[l,d]=(0,c.useState)(void 0),[f,u]=(0,c.useState)(),h=(0,c.useCallback)(()=>{u(void 0),d(void 0),S(void 0),s(!1)},[]),g=(0,c.useCallback)((C,y)=>{u(C),d(y),s(!0)},[]),[x,S]=(0,c.useState)(void 0);return[(0,c.useMemo)(()=>i?(0,e.jsx)(Ue,{isOpen:o}):(0,e.jsxs)(ye.a,{isOpen:o,onDismiss:h,closeOnBackdropClick:!0,closeOnEscape:!0,title:(0,a.t)("alerting.use-add-policy-modal.modal-element.title-add-notification-policy","Add notification policy"),children:[x&&(0,e.jsx)($e,{error:x}),(0,e.jsx)(_e,{defaults:{groupBy:f?.group_by},onSubmit:C=>{f&&l&&n(C,f,l).catch(S)},actionButtons:(0,e.jsxs)(ye.a.ButtonRow,{children:[(0,e.jsx)(j.$n,{type:"button",variant:"secondary",onClick:h,fill:"outline",children:(0,e.jsx)(a.x6,{i18nKey:"alerting.common.cancel",children:"Cancel"})}),(0,e.jsx)(j.$n,{type:"submit",children:(0,e.jsx)(a.x6,{i18nKey:"alerting.policies.save-policy",children:"Save policy"})})]})})]}),[x,n,h,l,i,f,o,S]),g,h]},Et=(n,i,o)=>{const[s,l]=(0,c.useState)(!1),[d,f]=(0,c.useState)(!1),[u,h]=(0,c.useState)(),[g,x]=(0,c.useState)(void 0),S=(0,c.useCallback)(()=>{h(void 0),l(!1),x(void 0)},[]),R=(0,c.useCallback)((y,N)=>{f(N??!1),h(y),l(!0)},[]);return[(0,c.useMemo)(()=>o?(0,e.jsx)(Ue,{isOpen:s}):(0,e.jsxs)(ye.a,{isOpen:s,onDismiss:S,closeOnBackdropClick:!0,closeOnEscape:!0,title:(0,a.t)("alerting.use-edit-policy-modal.modal-element.title-edit-notification-policy","Edit notification policy"),children:[g&&(0,e.jsx)($e,{error:g}),d&&u&&(0,e.jsx)(xt,{alertManagerSourceName:n,onSubmit:y=>i(y).catch(x),route:u,actionButtons:(0,e.jsxs)(ye.a.ButtonRow,{children:[(0,e.jsx)(j.$n,{type:"button",variant:"secondary",onClick:S,fill:"outline",children:(0,e.jsx)(a.x6,{i18nKey:"alerting.common.cancel",children:"Cancel"})}),(0,e.jsx)(j.$n,{type:"submit",children:(0,e.jsx)(a.x6,{i18nKey:"alerting.policies.default-policy.update",children:"Update default policy"})})]})}),!d&&(0,e.jsx)(_e,{route:u,onSubmit:y=>i(y).catch(x),actionButtons:(0,e.jsxs)(ye.a.ButtonRow,{children:[(0,e.jsx)(j.$n,{type:"button",variant:"secondary",onClick:S,fill:"outline",children:(0,e.jsx)(a.x6,{i18nKey:"alerting.common.cancel",children:"Cancel"})}),(0,e.jsx)(j.$n,{type:"submit",children:(0,e.jsx)(a.x6,{i18nKey:"alerting.policies.update.update-policy",children:"Update policy"})})]})})]}),[o,s,S,g,d,u,n,i,x]),R,S]},Pt=(n,i)=>{const[o,s]=(0,c.useState)(!1),[l,d]=(0,c.useState)(),[f,u]=(0,c.useState)(void 0),h=(0,c.useCallback)(()=>{d(void 0),s(!1),u(void 0)},[d]),g=(0,c.useCallback)(S=>{d(S),s(!0)},[]);return[(0,c.useMemo)(()=>i?(0,e.jsx)(Ue,{isOpen:o}):(0,e.jsxs)(ye.a,{isOpen:o,onDismiss:h,closeOnBackdropClick:!0,closeOnEscape:!0,title:(0,a.t)("alerting.use-delete-policy-modal.modal-element.title-delete-notification-policy","Delete notification policy"),children:[f&&(0,e.jsx)($e,{error:f}),(0,e.jsx)(a.x6,{i18nKey:"alerting.policies.delete.warning-1",children:"Deleting this notification policy will permanently remove it."})," ",(0,e.jsx)(a.x6,{i18nKey:"alerting.policies.delete.warning-2",children:"Are you sure you want to delete this policy?"}),(0,e.jsxs)(ye.a.ButtonRow,{children:[(0,e.jsx)(j.$n,{type:"button",variant:"destructive",onClick:()=>l&&n(l).catch(u),children:(0,e.jsx)(a.x6,{i18nKey:"alerting.policies.delete.confirm",children:"Yes, delete policy"})}),(0,e.jsx)(j.$n,{type:"button",variant:"secondary",onClick:h,children:(0,e.jsx)(a.x6,{i18nKey:"alerting.common.cancel",children:"Cancel"})})]})]}),[h,i,o,f,l,n]),g,h]},Tt=n=>{const[i,o]=(0,c.useState)(!1),[s,l]=(0,c.useState)([]),[d,f]=(0,c.useState)([]),[u,h]=(0,c.useState)("default"),g=(0,c.useCallback)(()=>{o(!1),l([]),f([])},[]),x=(0,c.useCallback)((C,y,N)=>{l(C),y&&f(y),N&&h(N),o(!0)},[]),S=(0,c.useMemo)(()=>{const C=s.flatMap(y=>y.alerts);return(0,me.groupBy)(C,y=>y.status.state)},[s]);return[(0,c.useMemo)(()=>(0,e.jsxs)(ye.a,{isOpen:i,onDismiss:g,closeOnBackdropClick:!0,closeOnEscape:!0,title:(0,e.jsxs)(I.B,{direction:"row",alignItems:"center",gap:1,wrap:"wrap",children:[(0,e.jsxs)(I.B,{direction:"row",alignItems:"center",gap:.5,children:[(0,e.jsx)(W.I,{name:"x"})," ",(0,e.jsx)(a.x6,{i18nKey:"alerting.policies.matchers",children:"Matchers"})]}),(0,e.jsx)(St.s,{matchers:d,formatter:u})]}),children:[(0,e.jsxs)(I.B,{direction:"column",children:[(0,e.jsx)(ft,{active:S[ie.Or.Active]?.length,suppressed:S[ie.Or.Suppressed]?.length,unprocessed:S[ie.Or.Unprocessed]?.length}),(0,e.jsx)("div",{children:s.map((C,y)=>(0,e.jsx)(mt._,{alertManagerSourceName:n,group:C},y))})]}),(0,e.jsx)(ye.a.ButtonRow,{children:(0,e.jsx)(j.$n,{type:"button",variant:"secondary",onClick:g,children:(0,e.jsx)(a.x6,{i18nKey:"alerting.common.cancel",children:"Cancel"})})})]}),[s,g,S,d,u,i,n]),x,g]},Ue=({isOpen:n})=>(0,e.jsx)(ye.a,{isOpen:n,onDismiss:()=>{},closeOnBackdropClick:!1,closeOnEscape:!1,title:(0,e.jsxs)(I.B,{direction:"row",alignItems:"center",gap:.5,children:[(0,e.jsx)(a.x6,{i18nKey:"alerting.policies.update.updating",children:"Updating..."})," ",(0,e.jsx)(ut.y,{inline:!0})]}),children:(0,e.jsx)(a.x6,{i18nKey:"alerting.policies.update.please-wait",children:"Please wait while we update your notification policies."})});var At=t(42004),ze=t(46202);const Mt=()=>{const n=(0,he._2)(),[i,o]=(0,b.L7)(b.QI.ViewContactPoint),[s,l]=(0,b.L7)(b.QI.ViewAlertGroups),{useGetAlertmanagerAlertGroupsQuery:d}=Be.m,[f,u]=(0,c.useState)(),[h,g]=(0,c.useState)([]),{selectedAlertmanager:x,hasConfigurationAPI:S,isGrafanaAlertmanager:R}=(0,oe.VI)(),{getRouteGroupsMap:C}=(0,P.L)(),y=i&&o,N=U(y?x??"":""),{currentData:M,isLoading:F,error:Ee,refetch:be}=(0,ze.yV)({alertmanager:x??""}),[le]=M??[],[ce,Oe]=(0,ze.a1)({alertmanager:x??""}),[Ke,G]=(0,ze.F)({alertmanager:x??""}),[J,_]=(0,ze.g0)({alertmanager:x??""}),{currentData:ee,refetch:de}=d({amSourceName:x??""},{skip:!l||!x}),{contactPoints:Fe}=(0,k.dK)({alertmanager:x??"",fetchPolicies:!1,fetchStatuses:!0,skip:!y}),Pe=(0,c.useMemo)(()=>{if(le)return(0,T.QM)(le)},[le]),[{value:rn,error:on},ot]=(0,D.A)(C,[C]);(0,c.useEffect)(()=>{Pe&&ee&&ot(Pe,ee,{unquoteMatchers:!R})},[Pe,ee,ot,R]);const st=(0,c.useMemo)(()=>Pe?It(Pe,{contactPointFilter:f,labelMatchersFilter:h}):{filtersApplied:!1,matchedRoutesWithPath:new Map},[f,h,Pe]),sn=()=>{be(),Ke.reset(),ce.reset(),J.reset()};async function ln(pe){await Ke.execute(pe),Ye({error:G.error})}async function cn(pe){await ce.execute(pe.id),Ye({error:Oe.error})}async function dn(pe,Pn,Tn){await J.execute({partialRoute:pe,referenceRouteIdentifier:Pn.id,insertPosition:Tn}),Ye({error:_.error})}function Ye({error:pe}){pe||n.success("Updated notification policies"),x&&de(),hn(),gn(),yn()}const Je=(0,ve.Gz)(G,Oe,_).loading,[un,mn,gn]=Ct(dn,Je),[pn,fn,hn]=Et(x??"",ln,Je),[vn,xn,yn]=Pt(cn,Je),[jn,bn]=Tt(x??"");if(!x)return null;const Sn=Pe&&!Ee&&!F,Cn=!!Ee&&!F,En=[_,G,Oe].some(pe=>(0,ve.bJ)(pe)&&(0,te.E2)(pe.error)===we.g2);return(0,e.jsxs)(e.Fragment,{children:[Cn&&(0,e.jsx)(z.F,{severity:"error",title:(0,a.t)("alerting.notification-policies-list.title-error-loading-alertmanager-config","Error loading Alertmanager config"),children:(0,te.JZ)(Ee)||"Unknown error."}),En&&(0,e.jsx)(z.F,{severity:"info",title:(0,a.t)("alerting.notification-policies-list.title-notification-policies-have-changed","Notification policies have changed"),children:(0,e.jsxs)(I.B,{direction:"row",justifyContent:"space-between",alignItems:"center",children:[(0,e.jsx)(a.x6,{i18nKey:"alerting.policies.update-errors.conflict",children:"The notification policy tree has been updated by another user."}),(0,e.jsx)(j.$n,{onClick:sn,children:(0,e.jsx)(a.x6,{i18nKey:"alerting.policies.reload-policies",children:"Reload policies"})})]})}),Sn&&(0,e.jsxs)(I.B,{direction:"column",gap:1,children:[(0,e.jsx)(Me,{onChangeMatchers:g,onChangeReceiver:u,matchingCount:st.matchedRoutesWithPath.size}),(0,e.jsx)(At.PE,{receivers:Fe,currentRoute:(0,me.defaults)(Pe,Ve.H),contactPointsState:N.receivers,readOnly:!S,provisioned:Pe[ie.uz]?.provisioned,alertManagerSourceName:x,onAddPolicy:mn,onEditPolicy:fn,onDeletePolicy:xn,onShowAlertInstances:bn,routesMatchingFilters:st,matchingInstancesPreview:{groupsMap:rn,enabled:!!(l&&!on)},isAutoGenerated:!1,isDefaultPolicy:!0})]}),un,pn,vn,jn]})},It=(n,i)=>{const{contactPointFilter:o,labelMatchersFilter:s=[]}=i,l=o||s.length>0,d=!!o&&s.length>0;if(!l)return{filtersApplied:!1,matchedRoutesWithPath:new Map};const f=[],u=(0,Se._I)(n),h=o?Ze(u,C=>C.receiver===o):new Map,g=Array.from(h.keys());g&&f.push(g);const x=s.length?Ze(u,C=>lt(C,s)):new Map,S=Array.from(x.keys());return x.size>0&&f.push(S),{filtersApplied:!0,matchedRoutesWithPath:d?Dt(x,h):new Map([...x,...h])}};function Dt(...n){const i=new Map;for(const o of n[0].keys())n.every(s=>s.has(o))&&i.set(o,n[0].get(o));return i}var Rt=t(36826),wt=t(35526),He=t(6975),Bt=t(71599),Nt=t(42941),et=t(70327),tt=t(77880),Ot=t(25149),Ft=t(78102);const Gt=({exportFormat:n,onClose:i})=>{const{currentData:o="",isFetching:s}=et.hK.useExportMuteTimingsQuery({format:n}),l=`mute-timings-${new Date().getTime()}`;return s?(0,e.jsx)(He._,{text:(0,a.t)("alerting.grafana-mute-timings-exporter-preview.text-loading","Loading....")}):(0,e.jsx)(tt.J,{format:n,textDefinition:o,downloadFileName:l,onClose:i})},Lt=({exportFormat:n,onClose:i,muteTimingName:o})=>{const{currentData:s="",isFetching:l}=et.hK.useExportMuteTimingQuery({format:n,muteTiming:o}),d=`mute-timing-${o}-${new Date().getTime()}`;return l?(0,e.jsx)(He._,{text:(0,a.t)("alerting.grafana-mute-timing-exporter-preview.text-loading","Loading....")}):(0,e.jsx)(tt.J,{format:n,textDefinition:s,downloadFileName:d,onClose:i})},nt=({onClose:n,muteTimingName:i})=>{const[o,s]=(0,c.useState)("yaml");return(0,e.jsx)(Ot.m,{activeTab:o,onTabChange:s,onClose:n,formatProviders:Object.values(Ft.sl),children:i?(0,e.jsx)(Lt,{exportFormat:o,onClose:n,muteTimingName:i}):(0,e.jsx)(Gt,{exportFormat:o,onClose:n})})},at=Symbol("all mute timings"),rt=()=>{const[n,i]=(0,c.useState)(null),[o,s]=(0,Nt.A)(!1),l=(0,c.useCallback)(()=>{i(null),s(!1)},[s]),d=u=>{i(u),s(!0)};return[(0,c.useMemo)(()=>!n||!o?null:n===at?(0,e.jsx)(nt,{onClose:l}):(0,e.jsx)(nt,{muteTimingName:n,onClose:l}),[o,l,n]),d]};var Qe=t(24898),Vt=t(97539);const zt=({muteTiming:n,alertManagerSourceName:i})=>{const[o,s]=(0,re.gB)({alertmanager:i}),[l,d]=(0,c.useState)(!1),[f,u]=rt(),[h,g]=(0,b.L7)(b.QI.ExportTimeIntervals),x=()=>d(!1),S=i===Ie.hY,R=(0,te.nL)("/alerting/routes/mute-timing/edit",i,{muteName:n.id}),C=(0,e.jsx)(j.z9,{href:R,variant:"secondary",size:"sm",icon:n.provisioned?"eye":"pen",disabled:(0,ve.VP)(s),children:n.provisioned?(0,e.jsx)(a.x6,{i18nKey:"alerting.common.view",children:"View"}):(0,e.jsx)(a.x6,{i18nKey:"alerting.common.edit",children:"Edit"})});return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsxs)(I.B,{direction:"row",alignItems:"center",justifyContent:"flex-end",wrap:"wrap",children:[!S&&(0,Vt.d6)(n)&&(0,e.jsx)(Ne.E,{text:(0,a.t)("alerting.mute-timing-actions-buttons.text-disabled","Disabled"),color:"orange"}),(0,e.jsx)(Qe._,{actions:[b.QI.UpdateTimeInterval],children:C}),h&&(0,e.jsx)(j.z9,{icon:"download-alt",variant:"secondary",size:"sm","data-testid":"export",disabled:!g||(0,ve.VP)(s),onClick:()=>u(n.name),children:(0,e.jsx)(a.x6,{i18nKey:"alerting.common.export",children:"Export"})}),!n.provisioned&&(0,e.jsx)(Qe._,{actions:[b.QI.DeleteTimeInterval],children:(0,e.jsx)(j.z9,{icon:"trash-alt",variant:"secondary",size:"sm",onClick:()=>d(!0),disabled:(0,ve.VP)(s),children:(0,e.jsx)(a.x6,{i18nKey:"alerting.common.delete",children:"Delete"})})})]}),(0,e.jsx)(Bt.u,{isOpen:l,title:(0,a.t)("alerting.mute-timing-actions-buttons.title-delete-mute-timing","Delete mute timing"),body:(0,a.t)("alerting.mute-timing-actions-button.body-delete-mute-timing",'Are you sure you would like to delete "{{muteTiming}}"?',{muteTiming:n.name}),confirmText:(0,a.t)("alerting.common.delete","Delete"),onConfirm:async()=>{await o.execute({name:n?.metadata?.name??n.name}),x()},onDismiss:x}),f]})};var Kt=t(22628),Wt=t(6106),$t=t(58887);const it=({buttonIcon:n,buttonLabel:i,buttonSize:o="lg",buttonVariant:s="primary",onButtonClick:l,text:d,href:f,showButton:u=!0})=>{const h=(0,w.of)(Ut),g={className:h.button,icon:n,size:o,variant:s};return(0,e.jsx)($t.Z,{children:(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("p",{className:h.text,children:d}),u&&(f?(0,e.jsx)(j.z9,{href:f,type:"button",...g,children:i}):(0,e.jsx)(j.$n,{onClick:l,type:"button",...g,children:i}))]})})},Ut=n=>({container:(0,E.css)({backgroundColor:n.colors.background.secondary,color:n.colors.text.secondary,padding:n.spacing(4),textAlign:"center"}),text:(0,E.css)({marginBottom:n.spacing(2)}),button:(0,E.css)({margin:n.spacing(2,0,1)})});var Ht=t(1972),Qt=t(49779),Yt=t(78747);const Jt=()=>{const{selectedAlertmanager:n="",hasConfigurationAPI:i}=(0,oe.VI)(),o=!i,s=(0,w.of)(Xt),[l,d]=rt(),{data:f,isLoading:u,error:h}=(0,re.Ad)({alertmanager:n??""}),g=(0,c.useMemo)(()=>(f||[]).map(M=>({id:M.id,data:M})),[f]),[x,S]=(0,b.L7)(b.QI.CreateTimeInterval),[R,C]=(0,b.L7)(b.QI.ExportTimeIntervals),y=Zt(n,o);return u?(0,e.jsx)(He._,{text:(0,a.t)("alerting.time-intervals-table.text-loading-time-intervals","Loading time intervals...")}):h?(0,e.jsx)(z.F,{severity:"error",title:(0,a.t)("alerting.time-intervals.error-loading.title","Error loading time intervals"),children:(0,e.jsx)(a.x6,{i18nKey:"alerting.time-intervals.error-loading.description",children:"Could not load time intervals. Please try again later."})}):(0,e.jsxs)("div",{className:s.container,children:[(0,e.jsxs)(I.B,{direction:"row",alignItems:"center",children:[(0,e.jsx)(a.x6,{i18nKey:"alerting.time-intervals.description",children:"Enter specific time intervals when not to send notifications or freeze notifications for recurring periods of time."}),(0,e.jsx)(Qt.h,{}),!o&&g.length>0&&(0,e.jsx)(Qe._,{actions:[b.QI.CreateTimeInterval],children:(0,e.jsx)(j.z9,{className:s.muteTimingsButtons,icon:"plus",variant:"primary",href:(0,te.nL)("alerting/routes/mute-timing/new",n),children:(0,e.jsx)(a.x6,{i18nKey:"alerting.time-interval.add-time-interval",children:"Add time interval"})})}),R&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(j.$n,{icon:"download-alt",className:s.muteTimingsButtons,variant:"secondary",disabled:!C,onClick:()=>d(at),children:(0,e.jsx)(a.x6,{i18nKey:"alerting.common.export-all",children:"Export all"})}),l]})]}),g.length>0?(0,e.jsx)(Wt.E,{items:g,cols:y,pagination:{itemsPerPage:25}}):null,g.length===0&&(0,e.jsx)(e.Fragment,{children:o?(0,e.jsx)(it,{text:(0,a.t)("alerting.time-intervals-table.text-no-time-intervals-configured","No time intervals configured"),buttonLabel:"",showButton:!1}):(0,e.jsx)(it,{text:(0,a.t)("alerting.time-intervals-table.text-havent-created-time-intervals","You haven't created any time intervals yet"),buttonLabel:"Add time interval",buttonIcon:"plus",buttonSize:"lg",href:(0,te.nL)("alerting/routes/mute-timing/new",n),showButton:S})})]})};function Zt(n,i=!1){const[[o,s],[l,d]]=(0,b.Hl)([b.QI.UpdateTimeInterval,b.QI.DeleteTimeInterval]),f=!i&&(s||d);return(0,c.useMemo)(()=>{const u=[{id:"name",label:(0,a.t)("alerting.use-columns.columns.label.name","Name"),renderCell:function({data:g}){return(0,e.jsxs)("div",{children:[g.name," ",g.provisioned&&(0,e.jsx)(Ht.rS,{tooltip:!0,provenance:g.metadata?.annotations?.[Kt.a3]})]})},size:1},{id:"timeRange",label:(0,a.t)("alerting.use-columns.columns.label.time-range","Time range"),renderCell:({data:h})=>(0,Yt.av)(h),size:5}];return f&&u.push({id:"actions",label:(0,a.t)("alerting.use-columns.label.actions","Actions"),alignColumn:"end",renderCell:({data:h})=>(0,e.jsx)(zt,{muteTiming:h,alertManagerSourceName:n}),size:2}),u},[f,n])}const Xt=n=>({container:(0,E.css)({display:"flex",flexFlow:"column nowrap"}),muteTimingsButtons:(0,E.css)({marginBottom:n.spacing(2)})});var kt=t(88547),qt=(n=>(n.NotificationPolicies="notification_policies",n.TimeIntervals="time_intervals",n))(qt||{});const _t=()=>{const n=(0,w.of)(en),{selectedAlertmanager:i=""}=(0,oe.VI)(),[o,s]=(0,b.L7)(b.QI.ViewNotificationPolicyTree),[l,d]=(0,b.L7)(b.QI.ViewTimeInterval),f=[s&&"notification_policies",d&&"time_intervals"].filter(M=>!!M),{data:u=[]}=(0,re.Ad)({alertmanager:i,skip:!d}),[h,g]=(0,fe.s)(),{tab:x}=tn(h,f[0]),[S,R]=(0,c.useState)(x),C=S==="time_intervals",y=S==="notification_policies",N=u.length;return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(wt.e,{currentAlertmanager:i}),(0,e.jsxs)(Z.U,{children:[o&&s&&(0,e.jsx)(X.o,{label:(0,a.t)("alerting.notification-policies-tabs.label-notification-policies","Notification Policies"),active:y,onChangeTab:()=>{R("notification_policies"),g({tab:"notification_policies"})}}),l&&d&&(0,e.jsx)(X.o,{label:(0,a.t)("alerting.notification-policies-tabs.label-time-intervals","Time intervals"),active:C,counter:N,onChangeTab:()=>{R("time_intervals"),g({tab:"time_intervals"})}})]}),(0,e.jsxs)(ue.J,{className:n.tabContent,children:[y&&(0,e.jsx)(Mt,{}),C&&(0,e.jsx)(Jt,{})]})]})},en=n=>({tabContent:(0,E.css)({marginTop:n.spacing(2)})});function tn(n,i){let o=i;return n.tab==="notification_policies"&&(o="notification_policies"),n.tab==="time_intervals"&&(o="time_intervals"),{tab:o}}function nn(){return(0,e.jsx)(Rt.y,{navId:"am-routes",accessType:"notification",children:(0,e.jsx)(_t,{})})}const an=(0,kt.S)(nn)},58887:(Re,ae,t)=>{t.d(ae,{Z:()=>a});var e=t(74848),E=t(22803),c=t(63142);const a=({children:Z})=>{const X=(0,c.of)(w);return(0,e.jsx)("div",{className:X.container,children:Z})},w=Z=>({container:(0,E.css)({backgroundColor:Z.colors.background.secondary,color:Z.colors.text.secondary,padding:Z.spacing(4),textAlign:"center"})})},59062:(Re,ae,t)=>{t.d(ae,{L:()=>se});/**
 * @license
 * Copyright 2019 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const e=Symbol("Comlink.proxy"),E=Symbol("Comlink.endpoint"),c=Symbol("Comlink.releaseProxy"),a=Symbol("Comlink.finalizer"),w=Symbol("Comlink.thrown"),Z=r=>typeof r=="object"&&r!==null||typeof r=="function",X={canHandle:r=>Z(r)&&r[e],serialize(r){const{port1:m,port2:p}=new MessageChannel;return me(r,m),[p,[p]]},deserialize(r){return r.start(),I(r)}},ue={canHandle:r=>Z(r)&&w in r,serialize({value:r}){let m;return r instanceof Error?m={isError:!0,value:{message:r.message,name:r.name,stack:r.stack}}:m={isError:!1,value:r},[m,[]]},deserialize(r){throw r.isError?Object.assign(new Error(r.value.message),r.value):r.value}},fe=new Map([["proxy",X],["throw",ue]]);function re(r,m){for(const p of r)if(m===p||p==="*"||p instanceof RegExp&&p.test(m))return!0;return!1}function me(r,m=globalThis,p=["*"]){m.addEventListener("message",function W(A){if(!A||!A.data)return;if(!re(p,A.origin)){console.warn(`Invalid origin '${A.origin}' for comlink proxy`);return}const{id:B,type:q,path:V}=Object.assign({path:[]},A.data),Q=(A.data.argumentList||[]).map(ge);let O;try{const Y=V.slice(0,-1).reduce((H,Me)=>H[Me],r),ne=V.reduce((H,Me)=>H[Me],r);switch(q){case"GET":O=ne;break;case"SET":Y[V.slice(-1)[0]]=ge(A.data.value),O=!0;break;case"APPLY":O=ne.apply(Y,Q);break;case"CONSTRUCT":{const H=new ne(...Q);O=Be(H)}break;case"ENDPOINT":{const{port1:H,port2:Me}=new MessageChannel;me(r,Me),O=we(H,[H])}break;case"RELEASE":O=void 0;break;default:return}}catch(Y){O={value:Y,[w]:0}}Promise.resolve(O).catch(Y=>({value:Y,[w]:0})).then(Y=>{const[ne,H]=Te(Y);m.postMessage(Object.assign(Object.assign({},ne),{id:B}),H),q==="RELEASE"&&(m.removeEventListener("message",W),z(m),a in r&&typeof r[a]=="function"&&r[a]())}).catch(Y=>{const[ne,H]=Te({value:new TypeError("Unserializable return value"),[w]:0});m.postMessage(Object.assign(Object.assign({},ne),{id:B}),H)})}),m.start&&m.start()}function D(r){return r.constructor.name==="MessagePort"}function z(r){D(r)&&r.close()}function I(r,m){const p=new Map;return r.addEventListener("message",function(A){const{data:B}=A;if(!B||!B.id)return;const q=p.get(B.id);if(q)try{q(B)}finally{p.delete(B.id)}}),Se(r,p,[],m)}function j(r){if(r)throw new Error("Proxy has been released and is not useable")}function he(r){return xe(r,new Map,{type:"RELEASE"}).then(()=>{z(r)})}const k=new WeakMap,b="FinalizationRegistry"in globalThis&&new FinalizationRegistry(r=>{const m=(k.get(r)||0)-1;k.set(r,m),m===0&&he(r)});function T(r,m){const p=(k.get(m)||0)+1;k.set(m,p),b&&b.register(r,m,r)}function te(r){b&&b.unregister(r)}function Se(r,m,p=[],W=function(){}){let A=!1;const B=new Proxy(W,{get(q,V){if(j(A),V===c)return()=>{te(B),he(r),m.clear(),A=!0};if(V==="then"){if(p.length===0)return{then:()=>B};const Q=xe(r,m,{type:"GET",path:p.map(O=>O.toString())}).then(ge);return Q.then.bind(Q)}return Se(r,m,[...p,V])},set(q,V,Q){j(A);const[O,Y]=Te(Q);return xe(r,m,{type:"SET",path:[...p,V].map(ne=>ne.toString()),value:O},Y).then(ge)},apply(q,V,Q){j(A);const O=p[p.length-1];if(O===E)return xe(r,m,{type:"ENDPOINT"}).then(ge);if(O==="bind")return Se(r,m,p.slice(0,-1));const[Y,ne]=ve(Q);return xe(r,m,{type:"APPLY",path:p.map(H=>H.toString()),argumentList:Y},ne).then(ge)},construct(q,V){j(A);const[Q,O]=ve(V);return xe(r,m,{type:"CONSTRUCT",path:p.map(Y=>Y.toString()),argumentList:Q},O).then(ge)}});return T(B,r),B}function ie(r){return Array.prototype.concat.apply([],r)}function ve(r){const m=r.map(Te);return[m.map(p=>p[0]),ie(m.map(p=>p[1]))]}const oe=new WeakMap;function we(r,m){return oe.set(r,m),r}function Be(r){return Object.assign(r,{[e]:!0})}function Ge(r,m=globalThis,p="*"){return{postMessage:(W,A)=>r.postMessage(W,p,A),addEventListener:m.addEventListener.bind(m),removeEventListener:m.removeEventListener.bind(m)}}function Te(r){for(const[m,p]of fe)if(p.canHandle(r)){const[W,A]=p.serialize(r);return[{type:"HANDLER",name:m,value:W},A]}return[{type:"RAW",value:r},oe.get(r)||[]]}function ge(r){switch(r.type){case"HANDLER":return fe.get(r.name).deserialize(r.value);case"RAW":return r.value}}function xe(r,m,p,W){return new Promise(A=>{const B=Ie();m.set(B,A),r.start&&r.start(),r.postMessage(Object.assign({id:B},p),W)})}function Ie(){return new Array(4).fill(0).map(()=>Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString(16)).join("-")}var Ae=t(96540),v=t(74268),$=t(81041);const K=()=>new $.c(new URL(t.p+t.u(4254),t.b));let L;function U(){let r;if(L===void 0)try{r=K(),L=I(r)}catch(p){p instanceof Error&&(0,v.vV)(p)}return{disposeWorker:()=>{r&&L&&(L[c](),r.terminate(),L=void 0,r=void 0)}}}function P(r){if(!L)throw new Error("Route Matcher has not been initialized")}function se(){(0,Ae.useEffect)(()=>{const{disposeWorker:p}=U();return p},[]);const r=(0,Ae.useCallback)(async(p,W,A)=>{P(L);const B=performance.now(),q=await L.getRouteGroupsMap(p,W,A),V=performance.now()-B;return(0,v.fH)(`Route Groups Matched in  ${V} ms`,{matchingTime:V.toString(),alertGroupsCount:W.length.toString(),topLevelRoutesCount:p.routes?.length.toString()??"0"}),q},[]),m=(0,Ae.useCallback)(async(p,W,A)=>{P(L);const B=performance.now(),q=await L.matchInstancesToRoute(p,W,A),V=performance.now()-B;return(0,v.fH)(`Instances Matched in  ${V} ms`,{matchingTime:V.toString(),instancesToMatchCount:W.length.toString(),topLevelRoutesCount:p.routes?.length.toString()??"0"}),q},[]);return{getRouteGroupsMap:r,matchInstancesToRoute:m}}},82658:(Re,ae,t)=>{t.d(ae,{_:()=>Ie});var e=t(74848),E=t(22803),c=t(96540),a=t(92745),w=t(63142),Z=t(41654),X=t(89640),ue=t(77256),fe=t(7840),re=t(12266),me=t(1625),D=t(74529),z=t(57487),I=t(83903),j=t(45861),he=t(15130),k=t(84266),b=t(11257),T=t(16692),te=t(52161),Se=t(83750),ie=t(24898);const ve=({alert:v,alertManagerSourceName:$})=>{const K=(0,w.of)(oe),L=(0,te.z2)($),U=L?he.TP.hasPermission(b.w.AlertingRuleRead):!0;return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsxs)("div",{className:K.actionsRow,children:[v.status.state===k.Or.Suppressed&&(0,e.jsx)(ie._,{actions:[T.QI.CreateSilence,T.QI.UpdateSilence],children:(0,e.jsx)(j.z9,{href:`${(0,ue.nL)("/alerting/silences",$)}&silenceIds=${v.status.silencedBy.join(",")}`,className:K.button,icon:"bell",size:"sm",children:(0,e.jsx)(a.x6,{i18nKey:"alerting.alert-details.manage-silences",children:"Manage silences"})})}),v.status.state===k.Or.Active&&(0,e.jsx)(ie._,{actions:[T.QI.CreateSilence],children:(0,e.jsx)(j.z9,{href:(0,ue.BK)($,v.labels),className:K.button,icon:"bell-slash",size:"sm",children:(0,e.jsx)(a.x6,{i18nKey:"alerting.alert-details.silence",children:"Silence"})})}),U&&v.generatorURL&&(0,e.jsx)(j.z9,{className:K.button,href:v.generatorURL,icon:"chart-line",size:"sm",children:L?(0,a.t)("alerting.alert-details.button-see-rule","See alert rule"):(0,a.t)("alerting.alert-details.button-see-source","See source")})]}),Object.entries(v.annotations).map(([P,se])=>(0,e.jsx)(Se.s,{annotationKey:P,value:se},P)),(0,e.jsx)("div",{className:K.receivers,children:(0,e.jsxs)(a.x6,{i18nKey:"alerting.alert-details.receivers-list",values:{receivers:v.receivers.map(({name:P})=>P).filter(P=>!!P).join(", ")},children:["Receivers: ","{{receivers}}"]})})]})},oe=v=>({button:(0,E.css)({"& + &":{marginLeft:v.spacing(1)}}),actionsRow:(0,E.css)({padding:`${v.spacing(2,0)} !important`,borderBottom:`1px solid ${v.colors.border.medium}`}),receivers:(0,E.css)({padding:v.spacing(1,0)})}),we=({alerts:v,alertManagerSourceName:$})=>{const K=(0,w.of)(Be),L=(0,c.useMemo)(()=>[{id:"state",label:(0,a.t)("alerting.alert-group-alerts-table.columns.label.notification-state","Notification state"),renderCell:({data:P})=>(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(I.y,{state:P.status.state}),(0,e.jsx)("span",{className:K.duration,children:(0,e.jsxs)(a.x6,{i18nKey:"alerting.alert-group-alerts-table.duration",values:{time:(0,D.dU)({start:new Date(P.startsAt),end:new Date(P.endsAt)})},children:["for ","{{time}}"]})})]}),size:"220px"},{id:"labels",label:(0,a.t)("alerting.alert-group-alerts-table.columns.label.instance-labels","Instance labels"),renderCell:({data:{labels:P}})=>(0,e.jsx)(fe.m,{labels:P,size:"sm"}),size:1}],[K]),U=(0,c.useMemo)(()=>v.map(P=>({id:P.fingerprint,data:P})),[v]);return(0,e.jsx)("div",{className:K.tableWrapper,"data-testid":"alert-group-table",children:(0,e.jsx)(z.B,{cols:L,items:U,isExpandable:!0,renderExpandedContent:({data:P})=>(0,e.jsx)(ve,{alert:P,alertManagerSourceName:$})})})},Be=v=>({tableWrapper:(0,E.css)({marginTop:v.spacing(3),[v.breakpoints.up("md")]:{marginLeft:v.spacing(4.5)}}),duration:(0,E.css)({marginLeft:v.spacing(1),fontSize:v.typography.bodySmall.fontSize})});var Ge=t(55127),Te=t.n(Ge);const ge=v=>({[k.Or.Active]:(0,E.css)({color:v.colors.error.text}),[k.Or.Suppressed]:(0,E.css)({color:v.colors.primary.text}),[k.Or.Unprocessed]:(0,E.css)({color:v.colors.secondary.text})}),xe=({group:v})=>{const $=(0,w.of)(ge),K=v.alerts.length,L=v.alerts.reduce((U,P)=>(U[P.status.state]?U[P.status.state]+=1:U[P.status.state]=1,U),{});return(0,e.jsxs)("div",{children:[`${K} ${Te()("alert",K)}: `,Object.entries(L).map(([U,P],se)=>(0,e.jsxs)("span",{className:$[U],children:[se>0&&", ",`${P} ${U}`]},`${JSON.stringify(v.labels)}-notifications-${se}`))]})},Ie=({alertManagerSourceName:v,group:$})=>{const[K,L]=(0,c.useState)(!0),U=(0,w.of)(Ae),P=$.receiver.name!=="NONE",se=$.receiver.name;return(0,e.jsxs)("div",{className:U.wrapper,children:[(0,e.jsxs)("div",{className:U.header,children:[(0,e.jsxs)("div",{className:U.group,"data-testid":"alert-group",children:[(0,e.jsx)(re.e,{size:"sm",isCollapsed:K,onToggle:()=>L(!K),"data-testid":"alert-group-collapse-toggle"}),Object.keys($.labels).length?(0,e.jsxs)(Z.B,{direction:"row",alignItems:"center",children:[(0,e.jsx)(fe.m,{labels:$.labels,size:"sm"}),P&&(0,e.jsx)(me.P,{icon:"at",children:(0,e.jsxs)(a.x6,{i18nKey:"alerting.alert-group.delivered-to",values:{name:$.receiver.name},children:["Delivered to"," ",(0,e.jsx)(X.Y,{href:(0,ue.bI)(se,v),variant:"bodySmall",color:"primary",inline:!1,children:"{{name}}"})]})})]}):(0,e.jsx)("span",{children:(0,e.jsx)(a.x6,{i18nKey:"alerting.alert-group.no-grouping",children:"No grouping"})})]}),(0,e.jsx)(xe,{group:$})]}),!K&&(0,e.jsx)(we,{alertManagerSourceName:v,alerts:$.alerts})]})},Ae=v=>({wrapper:(0,E.css)({"& + &":{marginTop:v.spacing(2)}}),header:(0,E.css)({display:"flex",flexDirection:"row",flexWrap:"wrap",alignItems:"center",justifyContent:"space-between",padding:v.spacing(1),backgroundColor:v.colors.background.secondary,width:"100%"}),group:(0,E.css)({display:"flex",flexDirection:"row",alignItems:"center"})})},97539:(Re,ae,t)=>{t.d(ae,{KR:()=>a,Ww:()=>Z,d6:()=>me,iF:()=>ue,jU:()=>c,jb:()=>re,oU:()=>w});var e=t(2543),E=t.n(e);const c=["monday","tuesday","wednesday","thursday","friday","saturday","sunday"],a=["january","february","march","april","may","june","july","august","september","october","november","december"],w={times:[{start_time:"",end_time:""}],weekdays:"",days_of_month:"",months:"",years:"",location:"",disable:!1},Z=(D,z,I)=>D?D.split(",").map(j=>j.trim()).every(j=>j.split(":").every(z))||I:!0,X=D=>D?D.split(",").map(z=>z.trim()):void 0,ue=D=>{const z=D.time_intervals.map(({times:I,weekdays:j,days_of_month:he,months:k,years:b,location:T,disable:te})=>{const Se={times:fe(I,te),weekdays:X(j)?.map(ie=>ie.toLowerCase()),days_of_month:X(he),months:X(k),years:X(b),location:T||void 0};return(0,e.omitBy)(Se,e.isUndefined)});return{name:D.name,time_intervals:z}};function fe(D,z){if(z)return[];const I=D?.filter(({start_time:j,end_time:he})=>!!j&&!!he);return I?.length?I:void 0}function re(D){return D.times?.length===0||D.weekdays?.length===0||D.days_of_month?.length===0||D.months?.length===0||D.years?.length===0}function me(D){return D.time_intervals.every(z=>re(z))}}}]);

//# sourceMappingURL=NotificationPoliciesPage.408b2e643adae8e12d16.js.map