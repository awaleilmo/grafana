"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[7024],{75180:(Z,x,s)=>{s.r(x),s.d(x,{default:()=>O});var e=s(74848),f=s(22803),d=s(96540),C=s(16817),i=s(92745),A=s(63142),R=s(30703),B=s(89640),y=s(13791),b=s(68143);class F{constructor(){this.baseURL="/apis/featuretoggle.grafana.app/v0alpha1"}async getFeatureToggles(){const t=await(0,b.AI)().get(this.baseURL+"/current");return{restartRequired:!!t.restartRequired,allowEditing:!!t.allowEditing,toggles:t.toggles.map(r=>({name:r.name,description:r.description,enabled:r.enabled,readOnly:!r.writeable,stage:r.stage,hidden:!1}))}}updateFeatureToggles(t){const r={kind:"ResolvedToggleState",enabled:{}};return t.forEach(l=>{r.enabled[l.name]=l.enabled}),(0,b.AI)().patch(this.baseURL+"/current",r)}}const j=()=>new F;var T=s(45967),I=s(21285),E=s(45861),L=s(71599),M=s(27594);const w=(n,t)=>n.original.name.localeCompare(t.original.name),G=(n,t)=>{if(!n.original.description&&!t.original.description)return 0;if(n.original.description){if(!t.original.description)return-1}else return 1;return n.original.description.localeCompare(t.original.description)},K=(n,t)=>n.original.enabled===t.original.enabled?0:n.original.enabled?1:-1;function N({featureToggles:n,allowEditing:t,onUpdateSuccess:r}){n.sort((a,o)=>a.name.localeCompare(o.name));const l=(0,d.useRef)(n),[g,m]=(0,d.useState)(n),[c,u]=(0,d.useState)(!1),[U,D]=(0,d.useState)(!1),Y=j(),V=(a,o)=>{const v={...a,enabled:o},X=g.map(S=>S.name===a.name?v:S);m(X)},W=async()=>{u(!0);try{const a=$();await Y.updateFeatureToggles(a),l.current=[...g],r()}finally{u(!1)}},h=(0,d.useRef)(null),p=a=>()=>{D(a),!a&&h.current&&h.current.focus()},$=()=>g.filter((a,o)=>a.enabled!==l.current[o].enabled),z=()=>g.some((a,o)=>a.enabled!==l.current[o].enabled),H=a=>t?a?"This is a non-editable feature":"":"Feature management is not configured for editing",J=a=>{switch(a){case"GA":return(0,e.jsx)(T.m,{content:(0,i.t)("admin.admin-feature-toggles-table.get-stage-cell.content-general-availability","General availability"),children:(0,e.jsx)("div",{children:(0,e.jsx)(i.x6,{i18nKey:"admin.admin-feature-toggles-table.get-stage-cell.ga",children:"GA"})})});case"privatePreview":case"preview":case"experimental":return(0,i.t)("admin.admin-feature-toggles-table.get-stage-cell.beta","Beta");case"deprecated":return(0,i.t)("admin.admin-feature-toggles-table.get-stage-cell.deprecated","Deprecated");default:return a}},Q=[{id:"name",header:"Name",cell:({cell:{value:a}})=>(0,e.jsx)("div",{children:a}),sortType:w},{id:"description",header:"Description",cell:({cell:{value:a}})=>(0,e.jsx)("div",{children:a}),sortType:G},{id:"stage",header:"Stage",cell:({cell:{value:a}})=>(0,e.jsx)("div",{children:J(a)})},{id:"enabled",header:"State",cell:({row:a})=>{const o=(0,e.jsx)("div",{children:(0,e.jsx)(I.d,{value:a.original.enabled,disabled:a.original.readOnly,onChange:v=>V(a.original,v.currentTarget.checked)})});return a.original.readOnly?(0,e.jsx)(T.m,{content:H(a.original.readOnly),children:o}):o},sortType:K}];return(0,e.jsxs)(e.Fragment,{children:[t&&(0,e.jsxs)("div",{style:{display:"flex",justifyContent:"flex-end",padding:"0 0 5px 0"},children:[(0,e.jsx)(E.$n,{disabled:!z()||c,onClick:p(!0),ref:h,children:c?(0,i.t)("admin.admin-feature-toggles-table.saving","Saving..."):(0,i.t)("admin.admin-feature-toggles-table.save-changes","Save changes")}),(0,e.jsx)(L.u,{isOpen:U,title:(0,i.t)("admin.admin-feature-toggles-table.title-apply-feature-toggle-changes","Apply feature toggle changes"),body:(0,e.jsxs)("div",{children:[(0,e.jsx)("p",{children:(0,e.jsx)(i.x6,{i18nKey:"admin.admin-feature-toggles-table.confirm-modal-body-1",children:"Some features are stable (GA) and enabled by default, whereas some are currently in their preliminary Beta phase, available for early adoption."})}),(0,e.jsx)("p",{children:(0,e.jsx)(i.x6,{i18nKey:"admin.admin-feature-toggles-table.confirm-modal-body-2",children:"We advise understanding the implications of each feature change before making modifications."})})]}),confirmText:(0,i.t)("admin.admin-feature-toggles-table.confirmText-save-changes","Save changes"),onConfirm:async()=>{p(!1)(),W()},onDismiss:p(!1)})]}),(0,e.jsx)(M.j,{columns:Q,data:g,getRowId:a=>a.name})]})}function O(){const[n,t]=(0,d.useState)(1),r=j(),l=(0,C.A)(()=>r.getFeatureToggles(),[n]),g=(0,A.of)(P),m=()=>{t(n+1)},c=()=>(0,e.jsxs)("div",{className:g.warning,children:[(0,e.jsx)("div",{className:g.icon,children:(0,e.jsx)(R.I,{name:"exclamation-triangle"})}),(0,e.jsx)("span",{className:g.message,children:l.value?.restartRequired?(0,i.t)("admin.feature-toggles.restart-pending","A restart is pending for your Grafana instance to apply the latest feature toggle changes"):(0,i.t)("admin.feature-toggles.restart-required","Saving feature toggle changes will prompt a restart of the instance, which may take a few minutes")})]}),u=(0,e.jsx)("div",{children:(0,e.jsxs)(i.x6,{i18nKey:"admin.feature-toggles.sub-title",children:["View and edit feature toggles. Read more about feature toggles at"," ",(0,e.jsx)(B.Y,{href:"https://grafana.com/docs/grafana/latest/setup-grafana/configure-grafana/feature-toggles/",external:!0,children:"grafana.com"}),"."]})});return(0,e.jsx)(y.Y,{navId:"feature-toggles",subTitle:u,children:(0,e.jsx)(y.Y.Contents,{isLoading:l.loading,children:(0,e.jsxs)(e.Fragment,{children:[l.error?.message,l.loading&&"Fetching feature toggles",(0,e.jsx)(c,{}),l.value&&(0,e.jsx)(N,{featureToggles:l.value.toggles,allowEditing:l.value.allowEditing||!1,onUpdateSuccess:m})]})})})}function P(n){return{warning:(0,f.css)({display:"flex",marginTop:n.spacing(.25),marginBottom:n.spacing(.25)}),icon:(0,f.css)({color:n.colors.warning.main,paddingRight:n.spacing()}),message:(0,f.css)({color:n.colors.text.secondary,marginTop:n.spacing(.25)})}}}}]);

//# sourceMappingURL=AdminFeatureTogglesPage.bf8d9396925e67783ccc.js.map