{"version":3,"file":"5110.96d49ea826be96c65045.js","mappings":"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","sources":["webpack://grafana/./public/app/features/expressions/components/GenAI/utils.ts","webpack://grafana/./public/app/features/expressions/components/GenAI/GenAISuggestionsDrawer.tsx"],"sourcesContent":["/**\n * Parses AI-generated suggestions that contain mixed content (text and code blocks).\n *\n * AI responses often come in markdown format with explanatory text and code blocks\n * delimited by triple backticks (```). This function separates and structures that\n * content for proper rendering in the UI.\n *\n * @param suggestion - Raw AI suggestion string potentially containing markdown code blocks\n * @returns Array of parsed parts, each with:\n *   - type: 'text' for explanatory content, 'code' for SQL queries\n *   - content: The actual text or code content\n *   - language: For code blocks, the detected language (defaults to 'sql', normalized to 'mysql')\n *\n * Example input: \"Here's a query:\\n```sql\\nSELECT * FROM A\\n```\\nThis joins data.\"\n * Example output: [\n *   { type: 'text', content: \"Here's a query:\" },\n *   { type: 'code', content: 'SELECT * FROM A', language: 'mysql' },\n *   { type: 'text', content: 'This joins data.' }\n * ]\n */\nexport const parseSuggestion = (suggestion: string) => {\n  if (!suggestion) {\n    return [];\n  }\n  const parts: Array<{ type: 'text' | 'code'; content: string; language?: string }> = [];\n\n  // Split by triple backticks to find code blocks\n  const segments = suggestion.split(/```/);\n\n  segments.forEach((segment, index) => {\n    if (index % 2 === 0) {\n      // Even indices are text (outside code blocks)\n      if (segment.trim()) {\n        parts.push({ type: 'text', content: segment.trim() });\n      }\n    } else {\n      // Odd indices are code blocks\n      const lines = segment.split('\\n');\n      let language = 'sql'; // default language\n      let codeContent = segment;\n\n      // Check if first line specifies a language\n      if (lines[0] && lines[0].trim() && !lines[0].includes(' ')) {\n        language = lines[0].trim().toLowerCase();\n        codeContent = lines.slice(1).join('\\n');\n      }\n\n      // Remove trailing newlines\n      codeContent = codeContent.replace(/\\n+$/, '');\n\n      if (codeContent.trim()) {\n        const finalLanguage = language === 'mysql' ? 'mysql' : language === 'sql' ? 'mysql' : language;\n        parts.push({\n          type: 'code',\n          content: codeContent.trim(),\n          language: finalLanguage,\n        });\n      }\n    }\n  });\n\n  return parts;\n};\n","import { css } from '@emotion/css';\n\nimport { GrafanaTheme2, renderMarkdown } from '@grafana/data';\nimport { Trans } from '@grafana/i18n';\nimport { CodeEditor, Drawer, useStyles2, Stack, Button, Card, Text, ClipboardButton } from '@grafana/ui';\n\nimport { parseSuggestion } from './utils';\n\ninterface AISuggestionsDrawerProps {\n  isOpen: boolean;\n  onApplySuggestion: (suggestion: string) => void;\n  onClose: () => void;\n  suggestions: string[];\n}\n\nexport const GenAISuggestionsDrawer = ({\n  isOpen,\n  onApplySuggestion,\n  onClose,\n  suggestions,\n}: AISuggestionsDrawerProps) => {\n  const styles = useStyles2(getStyles);\n\n  if (!isOpen) {\n    return null;\n  }\n\n  return (\n    <Drawer\n      onClose={onClose}\n      size=\"lg\"\n      title={<Trans i18nKey=\"sql-expressions.sql-suggestion-history\">SQL Suggestion History</Trans>}\n    >\n      <div className={styles.content} data-testid=\"suggestions-drawer\">\n        <Stack direction=\"column\" gap={3}>\n          <div className={styles.timelineContainer}>\n            {/* Vertical timeline line */}\n            <div className={styles.timelineLine} />\n\n            <div className={styles.suggestionsList}>\n              {suggestions.map((suggestion, index) => {\n                const parsedSuggestion = parseSuggestion(suggestion);\n                const isLatest = index === 0;\n\n                return (\n                  <div key={index} className={styles.timelineItem}>\n                    {/* Timeline node */}\n                    <div\n                      className={`${styles.timelineNode} ${isLatest ? styles.timelineNodeActive : styles.timelineNodeInactive}`}\n                    />\n                    <Card noMargin key={index} className={isLatest ? styles.latestSuggestion : ''}>\n                      <div className={styles.suggestionContent}>\n                        {parsedSuggestion.map(({ type, content, language }, partIndex) => (\n                          <div key={partIndex} className={styles.suggestionPart}>\n                            {type === 'code' ? (\n                              <div className={styles.codeBlock}>\n                                <div className={styles.codeHeader}>\n                                  <Stack direction=\"row\" justifyContent=\"space-between\" alignItems=\"center\">\n                                    <Text variant=\"bodySmall\" weight=\"bold\">\n                                      <Trans\n                                        i18nKey=\"sql-expressions.code-label\"\n                                        values={{ language: language?.toUpperCase() || 'CODE' }}\n                                      >\n                                        {'{{ language }}'}\n                                      </Trans>\n                                    </Text>\n                                    <Stack direction=\"row\" gap={1}>\n                                      <ClipboardButton\n                                        size=\"sm\"\n                                        icon=\"copy\"\n                                        variant=\"secondary\"\n                                        getText={() => content}\n                                      >\n                                        <Trans i18nKey=\"sql-expressions.copy\">Copy</Trans>\n                                      </ClipboardButton>\n                                      <Button\n                                        size=\"sm\"\n                                        variant=\"primary\"\n                                        icon=\"ai-sparkle\"\n                                        onClick={() => onApplySuggestion(content)}\n                                      >\n                                        <Trans i18nKey=\"sql-expressions.apply\">Apply</Trans>\n                                      </Button>\n                                    </Stack>\n                                  </Stack>\n                                </div>\n                                <CodeEditor\n                                  value={content}\n                                  language={language === 'sql' || language === 'mysql' ? 'mysql' : 'sql'}\n                                  width=\"100%\"\n                                  height={Math.max(80, Math.min(300, (content.split('\\n').length + 1) * 20))}\n                                  readOnly={true}\n                                  showMiniMap={false}\n                                  showLineNumbers={true}\n                                  monacoOptions={{\n                                    lineNumbers: 'on',\n                                    folding: false,\n                                    minimap: { enabled: false },\n                                    scrollBeyondLastLine: false,\n                                    renderLineHighlight: 'none',\n                                    wordWrap: 'on',\n                                    readOnly: true,\n                                    contextmenu: false,\n                                    padding: { top: 8, bottom: 8 },\n                                    automaticLayout: true,\n                                    fontSize: 13,\n                                    lineHeight: 20,\n                                  }}\n                                />\n                              </div>\n                            ) : (\n                              <div\n                                className=\"markdown-html\"\n                                dangerouslySetInnerHTML={{ __html: renderMarkdown(content) }}\n                              />\n                            )}\n                          </div>\n                        ))}\n                      </div>\n                    </Card>\n                  </div>\n                );\n              })}\n            </div>\n          </div>\n        </Stack>\n      </div>\n    </Drawer>\n  );\n};\n\nconst getStyles = (theme: GrafanaTheme2) => ({\n  content: css({\n    height: '100%',\n    display: 'flex',\n    flexDirection: 'column',\n  }),\n  emptyState: css({\n    display: 'flex',\n    flexDirection: 'column',\n    alignItems: 'center',\n    justifyContent: 'center',\n    height: '100%',\n    textAlign: 'center',\n    gap: theme.spacing(2),\n  }),\n  timelineContainer: css({\n    position: 'relative',\n    display: 'flex',\n    flexDirection: 'column',\n    overflow: 'auto',\n    flex: 1,\n    paddingLeft: theme.spacing(4.5), // Space for timeline line and nodes\n  }),\n  timelineLine: css({\n    position: 'absolute',\n    // Offset the 2px width of the timeline line\n    left: `calc(${theme.spacing(1)} + 2px)`,\n    top: theme.spacing(1),\n    bottom: 0,\n    width: '2px',\n    backgroundColor: theme.colors.border.strong,\n    zIndex: 1,\n  }),\n  suggestionsList: css({\n    display: 'flex',\n    flexDirection: 'column',\n    gap: theme.spacing(2),\n    position: 'relative',\n  }),\n  timelineItem: css({\n    position: 'relative',\n    display: 'flex',\n    alignItems: 'flex-start',\n    gap: theme.spacing(2),\n  }),\n  timelineNode: css({\n    position: 'absolute',\n    left: theme.spacing(-4.5), // Position on the timeline line\n    top: theme.spacing(1), // Align with card content\n    width: theme.spacing(3),\n    height: theme.spacing(3),\n    borderRadius: theme.shape.radius.pill,\n    border: `2px solid ${theme.colors.primary.main}`,\n    backgroundColor: theme.colors.background.primary,\n    zIndex: 2,\n    flexShrink: 0,\n  }),\n  timelineNodeActive: css({\n    backgroundColor: theme.colors.primary.main, // Filled circle for current/latest\n    boxShadow: `0 0 0 4px ${theme.colors.background.primary}`, // White ring around filled circle\n  }),\n  timelineNodeInactive: css({\n    backgroundColor: theme.colors.background.primary, // Empty circle for others\n    boxShadow: `0 0 0 4px ${theme.colors.background.primary}`, // White ring around filled circle\n  }),\n  latestSuggestion: css({\n    border: `2px solid ${theme.colors.primary.main}`,\n    position: 'relative',\n    '&::before': {\n      content: '\"Latest\"',\n      position: 'absolute',\n      top: theme.spacing(-0.5),\n      right: theme.spacing(1),\n      backgroundColor: theme.colors.primary.main,\n      color: theme.colors.primary.contrastText,\n      padding: theme.spacing(0.25, 1),\n      borderRadius: theme.shape.radius.default,\n      fontSize: theme.typography.bodySmall.fontSize,\n      fontWeight: theme.typography.fontWeightMedium,\n    },\n  }),\n  suggestionContent: css({\n    display: 'flex',\n    flexDirection: 'column',\n    gap: theme.spacing(1.5),\n    width: '100%',\n    overflowX: 'auto',\n  }),\n  suggestionPart: css({\n    display: 'block',\n    width: '100%',\n  }),\n  codeBlock: css({\n    border: `1px solid ${theme.colors.border.medium}`,\n    borderRadius: theme.shape.radius.default,\n    overflow: 'hidden',\n    marginBottom: theme.spacing(1),\n    width: '100%',\n    minWidth: '600px',\n  }),\n  codeHeader: css({\n    backgroundColor: theme.colors.background.secondary,\n    padding: theme.spacing(1, 1.5),\n    borderBottom: `1px solid ${theme.colors.border.weak}`,\n  }),\n});\n"],"names":["parseSuggestion","suggestion","parts","segment","index","lines","language","codeContent","finalLanguage","GenAISuggestionsDrawer","isOpen","onApplySuggestion","onClose","suggestions","styles","getStyles","Drawer","Stack","parsedSuggestion","isLatest","Card","type","content","partIndex","Text","ClipboardButton","Button","CodeEditor","theme"],"sourceRoot":""}