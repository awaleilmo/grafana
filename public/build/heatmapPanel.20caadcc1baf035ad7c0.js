"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[5857],{17933:(Je,ge,l)=>{l.r(ge),l.d(ge,{plugin:()=>Bt});var h=l(74848),z=l(16207),K=l(83340),te=l(95004),Se=l(38809),n=l(92745),ae=l(43173),o=l(739),O=l(44017),L=l(45013),A=l(20276),U=l(13572),D=l(48264),J=l(22803),V=l(96540),me=l(84229),le=l(14477),H=l(63142),ne=l(64400),X=l(54735),Le=l(92790),Re=l(18667),$=l(69234),we=l(36327),Ie=l(13507),se=l(36613),s=l(39443),f=l(55386),M=l(16515),x=l(55978),N=l(39064),Z=l(61048),Oe=l(41530),ve=l(47466),pe=l(22429),Ae=l(13326),Ee=l(73125),be=l(16913),Be=l(76234);function oe(e,m,a,c,t,i,d){let u=e.current?.getContext("2d");if(u!=null){let p=i;for(;c[p-1]===c[i];)p--;let P=p+d,S=0,r=p;for(;r<P;){let re=t[r];S=Math.max(S,re),r++}let F=new Path2D,k=new Path2D;r=p;let ie=0;for(;r<P;){let re=t[r];if(re>0){let ue=re/S,Q=ie/d,fe=r===i?F:k;const q=m*Q+1,G=m/d-1;fe.rect(q,Math.round(a*(1-ue)),G,Math.round(a*ue))}r++,ie++}u.clearRect(0,0,m,a),u.fillStyle="#2E3036",u.fill(k),u.fillStyle="#5794F2",u.fill(F)}}const De=(e,m)=>{const a=e.heatmapColors?.palette,c=e.heatmapColors?.values[m];let t;return c!=null&&(t=a[c]),{cellColor:t,colorPalette:a}},he={year:1e3*60*60*24*365,month:1e3*60*60*24*30,week:1e3*60*60*24*7,day:1e3*60*60*24,h:1e3*60*60,m:1e3*60,s:1e3,ms:1},y=new Set(["ms","s","m","h"]),T=e=>{let m=1,a="ms";for(a in he)if(e>=he[a]){m=Math.floor(e/he[a]);break}const t=m!==1&&!y.has(a)?a+"s":a;return`${m} ${t}`},C=(e,m,a)=>{let c;switch(m){case"x":c=a?e?.fields.find(({name:t})=>t==="x"||t==="xMin"||t==="xMax"):e?.fields[0];break;case"y":c=a?e?.fields.find(({name:t})=>t==="y"||t==="yMin"||t==="yMax"):e?.fields[1];break;case"count":c=a?e?.fields.find(({name:t})=>t==="count"):e?.fields[2];break}return c},W=(e,m)=>{let a=e.heatmap.fields,c=a.find(u=>u.name==="xMax"),t=a.find(u=>u.name==="yMin"),i=a.find(u=>u.name==="yMax"),d=c.config.interval;return{xBucketMin:c.values[m]-d,xBucketMax:c.values[m],yBucketMin:t.values[m],yBucketMax:i.values[m]}},Ne=e=>{if(e.seriesIdx===2){const m=(0,Ae.T)(e.dataRef.current.exemplars,e.dataIdxs[2]);if(m==null)return null;const{displayValues:a,links:c}=m;return(0,h.jsx)(Ee.A,{items:a.map(t=>({label:t.name,value:t.valueString})),links:c,maxHeight:e.maxHeight,isPinned:e.isPinned})}return(0,h.jsx)(mt,{...e})},Ce=264,Xe=64,mt=({dataIdxs:e,dataRef:m,showHistogram:a,isPinned:c,showColorScale:t=!1,mode:i,annotate:d,maxHeight:u,maxWidth:v,replaceVariables:p,canExecuteActions:P})=>{const S=e[1],r=m.current,[F]=(0,V.useState)(()=>r.heatmap?.meta?.type===s.m.HeatmapCells&&!(0,D.Nb)(r.heatmap)),k=C(r.heatmap,"x",F),ie=C(r.heatmap,"y",F),re=C(r.heatmap,"count",F),ue=B=>k?.display?(0,f.cN)(k.display(B)):k?.type===te.PU.time?(0,pe.UA)().getCurrent()?.formatDate(B,"YYYY-MM-DD HH:mm:ss"):`${B}`,Q=k.values,fe=ie.values,q=re.values,G=(0,D.eE)(r.heatmap),b=ie?.display?B=>(0,f.cN)(ie.display(B)):B=>`${B}`;let Ve=k?.config.interval,E,ce,_,Y,Te,Fe=[];const ee=B=>B%(r.yBucketCount??1);let j=ee(S);const de=Math.floor(S/(r.yBucketCount??1)),Pe=(B=S)=>{if(G.yOrdinalDisplay){const I=r.yLayout===o.D7.le?j-1:j,R=r.yLayout===o.D7.le?j:j+1;E=I<0?G.yMinDisplay:`${G.yOrdinalDisplay[I]}`,ce=`${G.yOrdinalDisplay[R]}`,(!G.yOrdinalLabel||Number.isNaN(+G.yOrdinalLabel[0]))&&(Te=r.yLayout===o.D7.le?ce:E)}else{const I=fe?.[j];if(r.yLayout===o.D7.le)if(ce=`${I}`,r.yLog){let w=(r.yLog===2?Math.log2:Math.log10)(I)-1/r.yLogSplit;E=`${r.yLog**w}`}else E=`${I-r.yBucketSize}`;else if(E=`${I}`,r.yLog){let w=(r.yLog===2?Math.log2:Math.log10)(I)+1/r.yLogSplit;ce=`${r.yLog**w}`}else ce=`${I+r.yBucketSize}`}r.xLayout===o.D7.le?(Y=Q[B],_=Y-r.xBucketSize):(_=Q[B],Y=_+r.xBucketSize)};F?{xBucketMin:_,xBucketMax:Y,yBucketMin:E,yBucketMax:ce}=W(r,S):Pe();const{cellColor:Ye,colorPalette:ye}=De(r,S),je=(B,I)=>{let R=[];for(let w=B;w<=I;w++){if(!q?.[w])continue;const Me=De(r,w).cellColor;xe=ze(w),F?{xBucketMin:_,xBucketMax:Y,yBucketMin:E,yBucketMax:ce}=W(r,w):(j=ee(w),Pe(w));const{label:Ct,value:Pt}=Ke()[0];R.push({label:Ct,value:Pt,color:Me??"#FFF",isActive:S===w})}return R},Ke=()=>{const B=i===o.$N.Multi&&!c;if(Te)return B?[{label:`Name ${Te}`,value:r.display(xe)}]:[{label:"Name",value:Te}];switch(r.yLayout){case o.D7.unknown:return B?[{label:b(E),value:r.display(xe)}]:[{label:"",value:b(E)}]}return B?[{label:`Bucket ${b(E)}-${b(ce)}`,value:r.display(xe)}]:[{label:"Bucket",value:`${b(E)}-${b(ce)}`}]},ze=B=>q?.[B];let xe=ze(S);if(i===o.$N.Single||c){const B=Ve?[{label:"Duration",value:T(Ve)}]:[];Fe=[{label:(0,M.Ct)(re,r.heatmap),value:r.display(xe),color:Ye??"#FFF",colorPlacement:x.lJ.trailing,colorIndicator:x.fX.value},...Ke(),...B]}if(i===o.$N.Multi&&!c){let B=k.values[S],I=S,R=S;for(;k.values[I-1]===B;)I--;for(;k.values[R+1]===B;)R++;je(I,R).forEach(Me=>{Fe.push({label:Me.label,value:Me.value,color:Me.color??"#FFF",colorIndicator:x.fX.value,colorPlacement:x.lJ.trailing,isActive:Me.isActive})})}let Ue;if(c){let B=[],I=[];const R=r.series?.fields[j+1];if(R!=null){const w=!R.config.custom?.hideFrom?.tooltip,Me=(R.config.links?.length??0)>0;w&&Me&&(B=(0,be.u6)(R,de)),I=P?(0,be.OG)(r.series,R,p,de):[]}Ue=(0,h.jsx)(N.S,{dataLinks:B,annotate:d,actions:I})}let nt=(0,V.useRef)(null);const st=(0,H.$j)(),Dt=parseInt(st.spacing(1),10);let ot=Math.min(Ce,v?v-Dt*2:Ce),it=Xe,rt=Math.round(ot*se.A.pxRatio),ct=Math.round(it*se.A.pxRatio);(0,V.useEffect)(()=>{a&&Q!=null&&q!=null&&i===o.$N.Single&&oe(nt,rt,ct,Q,q,S,r.yBucketCount)},[S]);const Nt={label:"",value:ue(Y)};let _e=[];return i===o.$N.Single&&(a&&!F&&_e.push((0,h.jsx)("canvas",{width:rt,height:ct,ref:nt,style:{width:ot+"px",height:it+"px"}})),ye&&t&&_e.push((0,h.jsx)(A.w,{colorPalette:ye,min:r.heatmapColors?.minValue,max:r.heatmapColors?.maxValue,display:r.display,hoverValue:xe}))),(0,h.jsxs)(Z.i,{children:[(0,h.jsx)(Oe.A,{item:Nt,isPinned:c}),(0,h.jsx)(ve.o,{items:Fe,isPinned:c,scrollable:(0,Be.T5)({mode:i,maxHeight:u}),maxHeight:u,children:_e?.map((B,I)=>(0,h.jsx)("div",{style:{padding:`${st.spacing(1)} 0`},children:B},I))}),Ue]})};var et=l(60519),ut=l(8721),dt=l(11576),$e=l(70210),ke=l(50348);function Ze({frames:e,annotations:m,options:a,palette:c,theme:t,replaceVariables:i=u=>u,timeRange:d}){if(!e?.length)return{};(0,M.Fm)(e);const u=m?.find(p=>p.name==="exemplar");if(u?.fields.forEach(p=>{p.getLinks=(0,et._M)(u,p,p.state?.scopedVars??{},i)}),a.calculate){let p=pt(a.calculation);return p.xBuckets.value=i(p.xBuckets.value??""),p.yBuckets.value=i(p.yBuckets.value??""),qe((0,D.VQ)(e,{...p,timeRange:d}),u,{...a,calculation:p},c,t)}let v;for(const p of e)switch(p.meta?.type){case s.m.HeatmapCells:return(0,D.Nb)(p)?qe(p,u,a,c,t):ht(p,u,a,c,t);case s.m.HeatmapRows:v=p}if(v==null)if(e.length>1)e.every(P=>!Number.isNaN((0,$e.L)(P.fields[1].state?.displayName)))&&e.sort($e.Bm),v=(0,ut.Fd)({frames:e,keepDisplayNames:!0});else{let p=e[0],P=p.fields.filter(r=>r.type===te.PU.number);P.every(r=>!Number.isNaN((0,$e.L)(r.state?.displayName)))?(P.sort((r,F)=>(0,$e.L)(r.state?.displayName)-(0,$e.L)(F.state?.displayName)),v={...p,fields:[p.fields.find(r=>r.type===te.PU.time),...P]}):v=p}return v.fields.forEach(p=>{(p.config.links?.length??0)!==0&&(p.getLinks=(0,et._M)(v,p,p.state?.scopedVars??{},i))}),{...qe((0,D.yJ)({unit:a.yAxis?.unit,decimals:a.yAxis?.decimals,...a.rowsFrame,frame:v}),u,a,c,t),series:v}}const pt=e=>({xBuckets:{...e?.xBuckets,mode:e?.xBuckets?.mode??o.J1.Size},yBuckets:{...e?.yBuckets,mode:e?.yBuckets?.mode??o.J1.Size,scale:{...e?.yBuckets?.scale,type:e?.yBuckets?.scale?.type??o.L4.Linear}}}),ht=(e,m,a,c,t)=>{if(e.meta?.type!==s.m.HeatmapCells||(0,D.Nb)(e))return{warning:"Expected sparse heatmap format",heatmap:e};We(e.fields[1],a.yAxis,t);const i=e.fields[3],d=We(i,a.cellValues,t);let[u,v]=(0,ke.g$)(i.values,a.color.min,a.color.max,a.filterValues?.le,a.filterValues?.ge);return{heatmap:e,heatmapColors:{palette:c,values:(0,ke.O4)(i.values,c,u,v),minValue:u,maxValue:v},exemplars:m,display:p=>(0,f.cN)(d(p))}},qe=(e,m,a,c,t)=>{if(e.meta?.type!==s.m.HeatmapCells)return{warning:"Expected heatmap scanlines format",heatmap:e};if(e.fields.length<2||e.length<2)return{heatmap:e};const i=(0,D.eE)(e);let d,u,v;for(const b of e.fields)switch(b.name){case"y":u=b.name;case"yMin":case"yMax":{u||(u=b.name),i.yOrdinalDisplay==null&&We(b,a.yAxis,t);break}case"x":case"xMin":case"xMax":d=b.name;break;default:b.type===te.PU.number&&!v&&(v=b)}if(!u)return{warning:"Missing Y field",heatmap:e};if(!u)return{warning:"Missing X field",heatmap:e};if(!v)return{warning:"Missing value field",heatmap:e};const p=We(v,a.cellValues,t),P=e.fields[0].values,S=e.fields[1].values,r=P.length;let F=r-S.lastIndexOf(S[0]),k=r/F,ie=S[1]-S[0],re=P[F]-P[0],[ue,Q]=(0,ke.g$)(v.values,a.color.min,a.color.max,a.filterValues?.le,a.filterValues?.ge),fe=a.calculation?.xBuckets,q=a.calculation?.yBuckets;return{heatmap:e,heatmapColors:{palette:c,values:(0,ke.O4)(v.values,c,ue,Q),minValue:ue,maxValue:Q},exemplars:m?.length?m:void 0,xBucketSize:re,yBucketSize:ie,xBucketCount:k,yBucketCount:F,yLog:q?.scale?.log??0,xLog:fe?.scale?.log??0,xLogSplit:fe?.scale?.log?+(fe?.value??"1"):1,yLogSplit:q?.scale?.log?+(q?.value??"1"):1,xLayout:d==="xMax"?o.D7.le:d==="xMin"?o.D7.ge:o.D7.unknown,yLayout:u==="yMax"?o.D7.le:u==="yMin"?o.D7.ge:o.D7.unknown,display:b=>(0,f.cN)(p(b))}};function We(e,m,a){if(m?.unit?.length||m?.decimals!=null){const{unit:c,decimals:t}=m;e.display=void 0,e.config={...e.config},c?.length&&(e.config.unit=c),t!=null&&(e.config.decimals=t)}return e.display||(e.display=(0,dt.J)({field:e,theme:a})),e.display}var tt=l(55995),ft=l(37634),at=l(84140),g=l(4833);const He=[{name:"BrBG",invert:"always"},{name:"PiYG",invert:"always"},{name:"PRGn",invert:"always"},{name:"PuOr",invert:"always"},{name:"RdBu",invert:"always"},{name:"RdGy",invert:"always"},{name:"RdYlBu",invert:"always"},{name:"RdYlGn",invert:"always"},{name:"Spectral",invert:"always"},{name:"Blues",invert:"dark"},{name:"Greens",invert:"dark"},{name:"Greys",invert:"dark"},{name:"Oranges",invert:"dark"},{name:"Purples",invert:"dark"},{name:"Reds",invert:"dark"},{name:"Turbo",invert:"light"},{name:"Cividis",invert:"light"},{name:"Viridis",invert:"light"},{name:"Magma",invert:"light"},{name:"Inferno",invert:"light"},{name:"Plasma",invert:"light"},{name:"Warm",invert:"light"},{name:"Cool",invert:"light"},{name:"Cubehelix",invert:"light",name2:"CubehelixDefault"},{name:"BuGn",invert:"dark"},{name:"BuPu",invert:"dark"},{name:"GnBu",invert:"dark"},{name:"OrRd",invert:"dark"},{name:"PuBuGn",invert:"dark"},{name:"PuBu",invert:"dark"},{name:"PuRd",invert:"dark"},{name:"RdPu",invert:"dark"},{name:"YlGnBu",invert:"dark"},{name:"YlGn",invert:"dark"},{name:"YlOrBr",invert:"dark"},{name:"YlOrRd",invert:"dark"},{name:"Rainbow",invert:"always"},{name:"Sinebow",invert:"always"}],gt=He.find(e=>e.name==="Spectral");function Qe(e,m){const a={...g.KQ.color,...e},c=[],t=(a.steps??128)-1;if(e.mode===g.P7.Opacity){const i=(0,at.A)(m.visualization.getColorByName(e.fill)).toPercentageRgb(),d=a.scale===g.uM.Exponential?tt.scalePow().exponent(a.exponent).domain([0,1]).range([0,1]):tt.scaleLinear().domain([0,1]).range([0,1]);for(let u=0;u<=t;u++)i.a=d(u/t),c.push((0,at.A)(i).toString("hex8"))}else{const i=He.find(v=>v.name===a.scheme)??gt;let d="interpolate"+(i.name2??i.name);const u=ft[d];for(let v=0;v<=t;v++){let p=u(v/t),P=p.indexOf("rgb")===0?"#"+[...p.matchAll(/\d+/g)].map(S=>(+S[0]).toString(16).padStart(2,"0")).join(""):p;c.push(P)}(i.invert==="always"||i.invert==="dark"&&m.isDark||i.invert==="light"&&m.isLight)&&c.reverse(),e.reverse&&c.reverse()}return c}const vt=({data:e,id:m,timeRange:a,timeZone:c,width:t,height:i,options:d,fieldConfig:u,eventBus:v,onChangeTimeRange:p,replaceVariables:P})=>{const S=(0,H.$j)(),r=(0,H.of)(yt),{sync:F,eventsScope:k,canAddAnnotations:ie,onSelectRange:re,canExecuteActions:ue}=(0,ne.d2)(),Q=F?.()??me.y.Off,fe=(0,V.useMemo)(()=>ue?.()??!1,[ue]),[q,G]=(0,V.useState)(null);let b=(0,V.useRef)(a);b.current=a;const Ve=(0,V.useMemo)(()=>Qe(d.color,S),[d.color,S]),E=(0,V.useMemo)(()=>{try{return Ze({frames:e.series,annotations:e.annotations,options:d,palette:Ve,theme:S,replaceVariables:P,timeRange:a})}catch(ee){return{warning:`${ee}`}}},[e.series,e.annotations,d,Ve,S,P,a]),ce=(0,V.useMemo)(()=>{let ee=[],j=[];const de=(0,D.eE)(E.heatmap);return E.exemplars?.length&&(ee=E.exemplars?.fields[0].values,de.yMatchWithLabel&&de.yOrdinalDisplay!=null?j=(E.exemplars?.fields.find(ye=>ye.name===de.yMatchWithLabel).values).map(ye=>de.yOrdinalLabel?.indexOf(ye)):j=E.exemplars?.fields[1].values),[null,E.heatmap?.fields.map(Pe=>Pe.values),[ee,j]]},[E.heatmap,E.exemplars]),_=(0,V.useRef)(E);_.current=E;const Y=(0,V.useMemo)(()=>{const ee=_.current?.heatmap?.fields[1].config?.custom?.scaleDistribution;return(0,ke.Mv)({dataRef:_,theme:S,timeZone:c,getTimeRange:()=>b.current,cellGap:d.cellGap,hideLE:d.filterValues?.le,hideGE:d.filterValues?.ge,exemplarColor:d.exemplars?.color??"rgba(255,0,255,0.7)",yAxisConfig:d.yAxis,ySizeDivisor:ee?.type===o.L4.Log?+(d.calculation?.yBuckets?.value||1):1,selectionMode:d.selectionMode})},[d,c,e.structureRev,Q]),Te=()=>!E.heatmap||!d.legend.show?null:(0,h.jsx)(X.KU.Legend,{placement:"bottom",maxHeight:"20%",children:(0,h.jsx)("div",{className:r.colorScaleWrapper,children:(0,h.jsx)(A.w,{hoverValue:void 0,colorPalette:Ve,min:_.current.heatmapColors?.minValue,max:_.current.heatmapColors?.maxValue,display:E.display})})});if(E.warning||!E.heatmap)return(0,h.jsx)(le.a,{panelId:m,fieldConfig:u,data:e,needsNumberField:!0,message:E.warning});const Fe=!!(ie&&ie());return(0,h.jsx)(h.Fragment,{children:(0,h.jsx)(X.KU,{width:t,height:i,legend:Te(),children:(ee,j)=>(0,h.jsxs)(Le.Z,{config:Y,data:ce,width:ee,height:j,children:[Q!==me.y.Off&&(0,h.jsx)(Re.K,{config:Y,eventBus:v,frame:E.series??E.heatmap}),d.tooltip.mode!==o.$N.None&&(0,h.jsx)($.xl,{config:Y,hoverMode:d.tooltip.mode===o.$N.Single?$.b3.xOne:$.b3.xAll,queryZoom:p,onSelectRange:re,syncMode:Q,syncScope:k,render:(de,Pe,Ye,ye,je,Ke,ze)=>{if(Fe&&Ke!=null){G(Ke),je();return}const xe=()=>{let Ue=de.posToVal(de.cursor.left,"x");G({from:Ue,to:Ue}),je()};return(0,h.jsx)(Ne,{mode:ze?o.$N.Multi:d.tooltip.mode,dataIdxs:Pe,seriesIdx:Ye,dataRef:_,isPinned:ye,dismiss:je,showHistogram:d.tooltip.yHistogram,showColorScale:d.tooltip.showColorScale,panelData:e,annotate:Fe?xe:void 0,maxHeight:d.tooltip.maxHeight,maxWidth:d.tooltip.maxWidth,replaceVariables:P,canExecuteActions:fe})},maxWidth:d.tooltip.maxWidth}),(0,h.jsx)(we.W,{annotations:e.annotations??[],config:Y,timeZone:c,newRange:q,setNewRange:G,canvasRegionRendering:!1}),(0,h.jsx)(Ie.U,{config:Y,onChangeTimeRange:p})]},Y.uid)})})},yt=()=>({colorScaleWrapper:(0,J.css)({marginLeft:"25px",padding:"10px 0",maxWidth:"300px"})}),xt=e=>{if(Object.keys(e.options??{}).length===0)return lt(e,"heatmap",{angular:e},e.fieldConfig);let m=e.options?.tooltip?.show;return m!==void 0&&(m===!0?e.options.tooltip.mode=o.$N.Single:m===!1&&(e.options.tooltip.mode=o.$N.None),delete e.options.tooltip?.show),e.options},lt=(e,m,a,c)=>{if(m==="heatmap"&&a.angular){const{fieldConfig:t,options:i}=Mt({...a.angular,fieldConfig:c});return e.fieldConfig=t,i}if(m==="heatmap-new"){const{bucketFrame:t,...i}=e.options;return t?{...i,rowsFrame:t}:e.options}return{}};function Mt(e){const m={defaults:{},overrides:[]},a=e.dataFormat!=="tsbuckets",c={...g.KQ.calculation},t={logBase:1,...e.yAxis};a&&(e.xBucketSize?c.xBuckets={mode:o.J1.Size,value:`${e.xBucketSize}`}:e.xBucketNumber&&(c.xBuckets={mode:o.J1.Count,value:`${e.xBucketNumber}`}),e.yBucketSize?c.yBuckets={mode:o.J1.Size,value:`${e.yBucketSize}`}:e.xBucketNumber&&(c.yBuckets={mode:o.J1.Count,value:`${e.yBucketNumber}`}),t.logBase>1&&(c.yBuckets={mode:o.J1.Count,value:+t.splitFactor>0?`${t.splitFactor}`:void 0,scale:{type:o.L4.Log,log:t.logBase}}));const i=Ge(e.cards?.cardPadding,2),d={calculate:a,calculation:c,color:{...g.KQ.color,steps:128},cellGap:i||1,cellRadius:Ge(e.cards?.cardRound),yAxis:{axisPlacement:t.show===!1?o.vM.Hidden:o.vM.Left,reverse:!!e.reverseYBuckets,axisWidth:Ge(t.width),min:t.min,max:t.max,unit:t.format,decimals:t.decimals},cellValues:{decimals:Ge(e.tooltipDecimals)},rowsFrame:{layout:St(e.yBucketBound)},legend:{show:!!e.legend?.show},showValue:o.yL.Never,tooltip:{mode:e.tooltip?.show?o.$N.Single:o.$N.None,yHistogram:!!e.tooltip?.showHistogram},exemplars:{...g.KQ.exemplars}};e.hideZeroBuckets&&(d.filterValues={...g.KQ.filterValues});const u=e.color??{};switch(u?.mode){case"spectrum":{d.color.mode=g.P7.Scheme;const v=u.colorScheme;let p=He.find(P=>P.name===v);p||(p=He.find(P=>v.indexOf(P.name)>=0)),d.color.scheme=p?p.name:g.KQ.color.scheme;break}case"opacity":{d.color.mode=g.P7.Opacity,d.color.scale=u.scale;break}}return d.color.fill=u.cardColor,d.color.min=u.min,d.color.max=u.max,typeof u.min=="number"&&typeof u.max=="number"&&u.min>u.max&&(d.color.min=u.max,d.color.max=u.min,d.color.reverse=!0),{fieldConfig:m,options:d}}function St(e){switch(e){case"upper":return o.D7.ge;case"lower":return o.D7.le;case"middle":return o.D7.unknown}return o.D7.auto}function Ge(e,m){if(e==null||e==="")return m;const a=+e;return isNaN(a)?m:a}class Et{getSuggestionsForData(m){const{dataSummary:a}=m;if(!m.data?.series||!a.hasData||a.timeFieldCount<1||a.numberFieldCount<2||a.numberFieldCount>10)return;const c=Qe(g.KQ.color,ae.$.theme2),t=Ze({frames:m.data.series,options:g.KQ,palette:c,theme:ae.$.theme2});!t||t.warning||m.getListAppender({name:"",pluginId:"heatmap",options:{},fieldConfig:{defaults:{custom:{}},overrides:[]}})}}const Bt=new z.m(vt).useFieldConfig({disableStandardOptions:Object.values(K.uo).filter(e=>e!==K.uo.Links),standardOptions:{[K.uo.Links]:{settings:{showOneClick:!0}}},useCustomConfig:e=>{const m=[(0,n.t)("heatmap.category-heatmap","Heatmap")];e.addCustomEditor({id:"scaleDistribution",path:"scaleDistribution",name:(0,n.t)("heatmap.name-y-axis-scale","Y axis scale"),category:m,editor:O.W1,override:O.W1,defaultValue:{type:o.L4.Linear},shouldApply:a=>a.type===te.PU.number,process:Se.hS,hideFromDefaults:!0}),(0,L.e)(e)}}).setPanelChangeHandler(lt).setMigrationHandler(xt).setPanelOptions((e,m)=>{const a=m.options??g.KQ;let c=!1;if(m.data.length>0)try{const i=Qe(a.color,ae.$.theme2),d=Ze({frames:m.data,options:a,palette:i,theme:ae.$.theme2});c=(0,D.eE)(d.heatmap).yOrdinalDisplay!=null}catch{}let t=[(0,n.t)("heatmap.category-heatmap","Heatmap")];e.addRadio({path:"calculate",name:(0,n.t)("heatmap.name-calculate-from-data","Calculate from data"),defaultValue:g.KQ.calculate,category:t,settings:{options:[{label:(0,n.t)("heatmap.calculate-from-data-options.label-yes","Yes"),value:!0},{label:(0,n.t)("heatmap.calculate-from-data-options.label-no","No"),value:!1}]}}),a.calculate&&(0,U.J)("calculation.",e,a.calculation,t),t=[(0,n.t)("heatmap.category-y-axis","Y Axis")],e.addRadio({path:"yAxis.axisPlacement",name:(0,n.t)("heatmap.name-placement","Placement"),defaultValue:g.KQ.yAxis.axisPlacement??o.vM.Left,category:t,settings:{options:[{label:(0,n.t)("heatmap.placement-options.label-left","Left"),value:o.vM.Left},{label:(0,n.t)("heatmap.placement-options.label-right","Right"),value:o.vM.Right},{label:(0,n.t)("heatmap.placement-options.label-hidden","Hidden"),value:o.vM.Hidden}]}}).addUnitPicker({category:t,path:"yAxis.unit",name:(0,n.t)("heatmap.name-unit","Unit"),defaultValue:void 0,settings:{isClearable:!0}}).addNumberInput({category:t,path:"yAxis.decimals",name:(0,n.t)("heatmap.name-decimals","Decimals"),settings:{placeholder:(0,n.t)("heatmap.placeholder-decimals","Auto")}}),c||e.addNumberInput({path:"yAxis.min",name:(0,n.t)("heatmap.name-min-value","Min value"),settings:{placeholder:(0,n.t)("heatmap.placeholder-min-value","Auto")},category:t}).addTextInput({path:"yAxis.max",name:(0,n.t)("heatmap.name-max-value","Max value"),settings:{placeholder:(0,n.t)("heatmap.placeholder-max-value","Auto")},category:t}),e.addNumberInput({path:"yAxis.axisWidth",name:(0,n.t)("heatmap.name-axis-width","Axis width"),defaultValue:g.KQ.yAxis.axisWidth,settings:{placeholder:(0,n.t)("heatmap.placeholder-axis-width","Auto"),min:5},category:t}).addTextInput({path:"yAxis.axisLabel",name:(0,n.t)("heatmap.name-axis-label","Axis label"),defaultValue:g.KQ.yAxis.axisLabel,settings:{placeholder:(0,n.t)("heatmap.placeholder-axis-label","Auto")},category:t}),a.calculate||e.addRadio({path:"rowsFrame.layout",name:(0,n.t)("heatmap.name-tick-alignment","Tick alignment"),defaultValue:g.KQ.rowsFrame?.layout??o.D7.auto,category:t,settings:{options:[{label:(0,n.t)("heatmap.tick-alignment-options.label-auto","Auto"),value:o.D7.auto},{label:(0,n.t)("heatmap.tick-alignment-options.label-top","Top (LE)"),value:o.D7.le},{label:(0,n.t)("heatmap.tick-alignment-options.label-middle","Middle"),value:o.D7.unknown},{label:(0,n.t)("heatmap.tick-alignment-options.label-bottom","Bottom (GE)"),value:o.D7.ge}]}}),e.addBooleanSwitch({path:"yAxis.reverse",name:(0,n.t)("heatmap.name-reverse","Reverse"),defaultValue:g.KQ.yAxis.reverse===!0,category:t}),t=[(0,n.t)("heatmap.category-colors","Colors")],e.addRadio({path:"color.mode",name:(0,n.t)("heatmap.name-mode","Mode"),defaultValue:g.KQ.color.mode,category:t,settings:{options:[{label:(0,n.t)("heatmap.mode-options.label-scheme","Scheme"),value:g.P7.Scheme},{label:(0,n.t)("heatmap.mode-options.label-opacity","Opacity"),value:g.P7.Opacity}]}}),e.addColorPicker({path:"color.fill",name:(0,n.t)("heatmap.name-color","Color"),defaultValue:g.KQ.color.fill,category:t,showIf:i=>i.color.mode===g.P7.Opacity}),e.addRadio({path:"color.scale",name:(0,n.t)("heatmap.name-scale","Scale"),defaultValue:g.KQ.color.scale,category:t,settings:{options:[{label:(0,n.t)("heatmap.scale-options.label-exponential","Exponential"),value:g.uM.Exponential},{label:(0,n.t)("heatmap.scale-options.label-linear","Linear"),value:g.uM.Linear}]},showIf:i=>i.color.mode===g.P7.Opacity}),e.addSliderInput({path:"color.exponent",name:(0,n.t)("heatmap.name-exponent","Exponent"),defaultValue:g.KQ.color.exponent,category:t,settings:{min:.1,max:2,step:.1},showIf:i=>i.color.mode===g.P7.Opacity&&i.color.scale===g.uM.Exponential}),e.addSelect({path:"color.scheme",name:(0,n.t)("heatmap.name-scheme","Scheme"),description:"",defaultValue:g.KQ.color.scheme,category:t,settings:{options:He.map(i=>({value:i.name,label:i.name}))},showIf:i=>i.color.mode!==g.P7.Opacity}),e.addSliderInput({path:"color.steps",name:(0,n.t)("heatmap.name-steps","Steps"),defaultValue:g.KQ.color.steps,category:t,settings:{min:2,max:128,step:1}}).addBooleanSwitch({path:"color.reverse",name:(0,n.t)("heatmap.name-reverse","Reverse"),defaultValue:g.KQ.color.reverse,category:t}).addCustomEditor({id:"__scale__",path:"__scale__",name:"",category:t,editor:()=>{const i=Qe(a.color,ae.$.theme2);return(0,h.jsx)("div",{children:(0,h.jsx)(A.w,{colorPalette:i,min:1,max:100})})}}),e.addNumberInput({path:"color.min",name:(0,n.t)("heatmap.name-start-color-from-value","Start color scale from value"),defaultValue:g.KQ.color.min,settings:{placeholder:(0,n.t)("heatmap.placeholder-start-color-from-value","Auto (min)")},category:t}).addNumberInput({path:"color.max",name:(0,n.t)("heatmap.name-end-color-at-value","End color scale at value"),defaultValue:g.KQ.color.max,settings:{placeholder:(0,n.t)("heatmap.placeholder-end-color-at-value","Auto (max)")},category:t}),t=[(0,n.t)("heatmap.category-cell-display","Cell display")],a.calculate||e.addTextInput({path:"rowsFrame.value",name:(0,n.t)("heatmap.name-value-name","Value name"),defaultValue:g.KQ.rowsFrame?.value,settings:{placeholder:(0,n.t)("heatmap.placeholder-value-name","Value")},category:t}),e.addUnitPicker({category:t,path:"cellValues.unit",name:(0,n.t)("heatmap.name-unit","Unit"),defaultValue:void 0,settings:{isClearable:!0}}).addNumberInput({category:t,path:"cellValues.decimals",name:(0,n.t)("heatmap.name-decimals","Decimals"),settings:{placeholder:(0,n.t)("heatmap.placeholder-decimals","Auto")}}),e.addSliderInput({name:(0,n.t)("heatmap.name-cell-gap","Cell gap"),path:"cellGap",defaultValue:g.KQ.cellGap,category:t,settings:{min:0,max:25}}).addNumberInput({path:"filterValues.le",name:(0,n.t)("heatmap.name-hide-cells-lt","Hide cells with values <="),defaultValue:g.KQ.filterValues?.le,settings:{placeholder:(0,n.t)("heatmap.placeholder-hide-cells-lt","None")},category:t}).addNumberInput({path:"filterValues.ge",name:(0,n.t)("heatmap.name-hide-cells-gt","Hide cells with values >="),defaultValue:g.KQ.filterValues?.ge,settings:{placeholder:(0,n.t)("heatmap.placeholder-hide-cells-gt","None")},category:t}),t=[(0,n.t)("heatmap.category-tooltip","Tooltip")],e.addRadio({path:"tooltip.mode",name:(0,n.t)("heatmap.name-tooltip-mode","Tooltip mode"),category:t,defaultValue:o.$N.Single,settings:{options:[{value:o.$N.Single,label:(0,n.t)("heatmap.tooltip-mode-options.label-single","Single")},{value:o.$N.Multi,label:(0,n.t)("heatmap.tooltip-mode-options.label-all","All")},{value:o.$N.None,label:(0,n.t)("heatmap.tooltip-mode-options.label-hidden","Hidden")}]}}),e.addBooleanSwitch({path:"tooltip.yHistogram",name:(0,n.t)("heatmap.name-show-histogram","Show histogram (Y axis)"),defaultValue:g.KQ.tooltip.yHistogram,category:t,showIf:i=>i.tooltip.mode===o.$N.Single}),e.addBooleanSwitch({path:"tooltip.showColorScale",name:(0,n.t)("heatmap.name-show-color-scale","Show color scale"),defaultValue:g.KQ.tooltip.showColorScale,category:t,showIf:i=>i.tooltip.mode===o.$N.Single}),e.addNumberInput({path:"tooltip.maxWidth",name:(0,n.t)("heatmap.name-max-width","Max width"),category:t,settings:{integer:!0},showIf:i=>i.tooltip.mode!==o.$N.None}),e.addNumberInput({path:"tooltip.maxHeight",name:(0,n.t)("heatmap.name-max-height","Max height"),category:t,defaultValue:void 0,settings:{integer:!0},showIf:(i,d,u)=>i.tooltip?.mode===o.$N.Multi||u?.some(v=>v.meta?.custom?.resultType==="exemplar")}),t=[(0,n.t)("heatmap.category-legend","Legend")],e.addBooleanSwitch({path:"legend.show",name:(0,n.t)("heatmap.name-show-legend","Show legend"),defaultValue:g.KQ.legend.show,category:t}),t=[(0,n.t)("heatmap.category-exemplars","Exemplars")],e.addColorPicker({path:"exemplars.color",name:(0,n.t)("heatmap.name-color","Color"),defaultValue:g.KQ.exemplars.color,category:t,showIf:(i,d,u)=>u?.some(v=>v.meta?.custom?.resultType==="exemplar")})}).setSuggestionsSupplier(new Et).setDataSupport({annotations:!0})},20276:(Je,ge,l)=>{l.d(ge,{w:()=>n});var h=l(74848),z=l(22803),K=l(96540),te=l(63142);const Se=10,n=({colorPalette:L,min:A,max:U,display:D,hoverValue:J,useStopsPercentage:V})=>{const[me,le]=(0,K.useState)([]),[H,ne]=(0,K.useState)({isShown:!1,value:0}),[X,Le]=(0,K.useState)(null),Re=(0,te.$j)(),$=O(Re,me);(0,K.useEffect)(()=>{le(ae({colorArray:L,stops:Se,useStopsPercentage:V}))},[L,V]);const we=se=>{const s=se.nativeEvent.offsetX,f=se.currentTarget.offsetWidth,M=Math.floor(s*100/f+1),x=Math.floor((U-A)*M/100+A);ne({isShown:!0,value:x}),Le(M)},Ie=()=>{ne({isShown:!1,value:0})};return(0,K.useEffect)(()=>{Le(J==null?null:o((J-A)/(U-A)))},[J,A,U]),(0,h.jsxs)("div",{className:$.scaleWrapper,onMouseMove:we,onMouseLeave:Ie,children:[(0,h.jsx)("div",{className:$.scaleGradient,children:D&&(H.isShown||J!==void 0)&&(0,h.jsx)("div",{className:$.followerContainer,children:(0,h.jsx)("div",{className:$.follower,style:{left:`${X}%`}})})}),D&&(0,h.jsxs)("div",{className:$.followerContainer,children:[(0,h.jsxs)("div",{className:$.legendValues,children:[(0,h.jsx)("span",{className:$.disabled,children:D(A)}),(0,h.jsx)("span",{className:$.disabled,children:D(U)})]}),X!=null&&(H.isShown||J!==void 0)&&(0,h.jsx)("span",{className:$.hoverValue,style:{left:`${X}%`},children:D(J??H.value)})]})]})},ae=({colorArray:L,stops:A,useStopsPercentage:U=!0})=>{const D=L.length;if(U&&D<=20){const le=1/D*100;let H=0;const ne=[];for(const X of L)H>0?ne.push(`${X} ${H}%`):ne.push(X),H+=le,ne.push(`${X} ${H}%`);return ne}const J=L[D-1],V=Math.ceil(D/A),me=new Set;for(let le=0;le<D;le+=V)me.add(L[le]);return me.add(J),[...me]};function o(L){return L>1?100:L<0?0:L*100}const O=(L,A)=>({scaleWrapper:(0,z.css)({width:"100%",fontSize:"11px",opacity:1}),scaleGradient:(0,z.css)({background:`linear-gradient(90deg, ${A.join()})`,height:"9px",pointerEvents:"none",borderRadius:L.shape.radius.default}),legendValues:(0,z.css)({display:"flex",justifyContent:"space-between",pointerEvents:"none"}),hoverValue:(0,z.css)({position:"absolute",marginTop:"-14px",padding:"3px 15px",transform:"translateX(-50%)"}),followerContainer:(0,z.css)({position:"relative",pointerEvents:"none",whiteSpace:"nowrap"}),follower:(0,z.css)({position:"absolute",height:"13px",width:"13px",borderRadius:L.shape.radius.default,transform:"translateX(-50%) translateY(-50%)",border:`2px solid ${L.colors.text.primary}`,top:"5px"}),disabled:(0,z.css)({color:L.colors.text.disabled})})},70210:(Je,ge,l)=>{l.d(ge,{Bm:()=>Ie,J3:()=>J,L:()=>se,hF:()=>Re});var h=l(2543),z=l.n(h),K=l(739),te=l(41119),Se=l(16515),n=l(11576),ae=l(1906),o=l(39443),O=l(95004),L=l(78282);const A=/^[+-]?inf(?:inity)?$/i,U=(s,f)=>f.app===ae.Jk.Explore&&(s.meta?.custom?.resultType==="vector"||s.meta?.custom?.resultType==="scalar")?!0:f.targets.find(x=>x.refId===s.refId)?.format==="table",D=(s,f)=>s.meta?.type===o.m.HeatmapCells?!1:f.targets.find(x=>x.refId===s.refId)?.format==="heatmap";function J(s,f,M){s.data.forEach(y=>{const T=f.targets.find(C=>C.refId===y.refId);T&&T.legendFormat==="__auto"&&y.fields.forEach(C=>{if(C.labels?.__name__&&C.labels?.__name__===C.name){const W={...C,name:O.Bc};C.config.displayNameFromDS=(0,Se.Ct)(W,y,s.data)}})});const[x,N]=(0,h.partition)(s.data,y=>U(y,f)),Z=me(x),[Oe,ve]=(0,h.partition)(N,y=>y.meta?.custom?.resultType==="exemplar"),{exemplarTraceIdDestinations:pe}=M,Ae=Oe.map(y=>{if(pe?.length)for(const T of pe){const C=y.fields.find(W=>W.name===T.name);if(C){const W=H(T);C.config.links=C.config.links?.length?[...C.config.links,...W]:W}}return{...y,meta:{...y.meta,dataTopic:K.QR.Annotations}}}),[Ee,be]=(0,h.partition)(ve,y=>D(y,f));Ee.forEach(y=>{if(y.name==null){let T=y.fields.find(C=>C.type===O.PU.number);if(T){let C=T.labels?.le;C&&(y.name=C,T.config.displayNameFromDS=C)}}});const Be=(0,h.groupBy)(Ee,y=>y.refId);let oe=[];for(const y in Be){const T=Be[y],C=(0,h.groupBy)(T,W=>{const Ne=W.fields.find(Ce=>Ce.type===O.PU.number);if(Ne?.labels&&V in Ne.labels){const{le:Ce,...Xe}=Ne?.labels;return Object.values(Xe).join()}return Object.values(Ne?.labels??[]).join()});(0,h.forOwn)(C,(W,Ne)=>{const Ce=W.sort(Ie);oe.push($(we(Ce)))})}const De=be.map(y=>({...y,meta:{...y.meta,preferredVisualisationType:"graph"}})),he=(0,h.flatten)(oe);return{...s,data:[...De,...Z,...he,...Ae]}}const V="le";function me(s){if(s.length===0||s.length===1&&s[0].length===0)return s;const f=(0,h.groupBy)(s,"refId"),M=Object.keys(f);return M.map(N=>{const Z=le(M.length,N),Oe=Le({data:[],valueName:Z}),ve=X([]),pe=[];f[N].forEach(oe=>{const he=oe.fields[1]?.labels??{};Object.keys(he).sort().forEach(y=>{pe.some(T=>T.name===y)||pe.push({name:y,config:{filterable:!0},type:O.PU.string,values:[]})})});let Ae=-1/0,Ee=!1;f[N].forEach(oe=>{ve.config.interval??=oe.fields[0]?.config.interval;const De=oe.fields[0]?.values??[],he=oe.fields[1]?.values??[];De.forEach(y=>{ve.values.push(y),y<Ae&&(Ee=!0),Ae=y}),he.forEach(y=>{Oe.values.push(se(y));const T=oe.fields[1].labels??{};pe.forEach(C=>C.values.push(ne(T,C.name)))})});const be=[ve,...pe,Oe],Be={refId:N,fields:be,meta:{...f[N][0].meta,preferredVisualisationType:"rawPrometheus"},length:ve.values.length};return Ee?(0,te.ES)(Be,0):Be})}function le(s,f=""){return s>1?`Value #${f}`:"Value"}function H(s){const f=[];if(s.datasourceUid){const x=(0,L.l)().getInstanceSettings(s.datasourceUid);x&&f.push({title:s.urlDisplayLabel||`Query with ${x?.name}`,url:"",internal:{query:{query:"${__value.raw}",queryType:"traceql"},panelsState:{trace:{spanId:'${__data.fields["span_id"]}'}},datasourceUid:s.datasourceUid,datasourceName:x?.name??"Data source not found"}})}return s.url&&f.push({title:s.urlDisplayLabel||`Go to ${s.url}`,url:s.url,targetBlank:!0}),f}function ne(s,f){return s.hasOwnProperty(f)?s[f]:""}function X(s,f=!1){return{name:O.LE,type:O.PU.time,config:{},values:s.map(M=>f?M[0]:M[0]*1e3)}}function Le({data:s,valueName:f=O.Bc,parseValue:M=!0,labels:x,displayNameFromDS:N}){return{name:f,type:O.PU.number,display:(0,n.J)(),config:{displayNameFromDS:N},labels:x,values:s.map(Z=>M?se(Z[1]):Z[1])}}function Re(s){const f=s.__name__||"";delete s.__name__;const M=Object.entries(s).map(x=>`${x[0]}="${x[1]}"`).join(",");return`${f}{${M}}`}function $(s){if(s.length===0||s.length===1&&s[0].length===0)return[];const f=s[0].fields.find(x=>x.type===O.PU.time),M=s.map(x=>{let N=x.fields.find(Z=>Z.type===O.PU.number);return{...N,name:N.config.displayNameFromDS}});return[{...s[0],meta:{...s[0].meta,type:o.m.HeatmapRows},fields:[f,...M]}]}function we(s){for(let f=s.length-1;f>0;f--){const M=s[f].fields.find(N=>N.type===O.PU.number),x=s[f-1].fields.find(N=>N.type===O.PU.number);if(!M||!x)throw new Error("Prometheus heatmap transform error: data should be a time series");for(let N=0;N<M.values.length;N++){const Z=x.values[N]||[0];M.values[N]-=Z,M.values[N]<1e-9&&(M.values[N]=0)}}return s}function Ie(s,f){let M,x;try{M=se(s.fields[1].state?.displayName??s.name??s.fields[1].name),x=se(f.fields[1].state?.displayName??f.name??f.fields[1].name)}catch(N){return console.error(N),0}return M>x?1:M<x?-1:0}function se(s){return A.test(s)?s[0]==="-"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY:parseFloat(s)}},73125:(Je,ge,l)=>{l.d(ge,{A:()=>ae});var h=l(74848),z=l(92745),K=l(47466),te=l(39064),Se=l(41530),n=l(61048);const ae=({items:o,links:O,isPinned:L,maxHeight:A})=>{const U=o.find(D=>D.label==="Time");return(0,h.jsxs)(n.i,{children:[(0,h.jsx)(Se.A,{item:{label:(0,z.t)("exemplar-tooltip-header","Exemplar"),value:U?.value??""},isPinned:L}),(0,h.jsx)(K.o,{items:o.filter(D=>D!==U),isPinned:L,maxHeight:A,scrollable:A!=null}),(0,h.jsx)(te.S,{dataLinks:O??[]})]})}}}]);

//# sourceMappingURL=heatmapPanel.20caadcc1baf035ad7c0.js.map