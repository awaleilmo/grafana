"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[7620],{33876:(S,j,t)=>{t.r(j),t.d(j,{PlaylistEditPage:()=>g,default:()=>E});var a=t(74848),m=t(54148),h=t(92745),l=t(36490),b=t(13791),y=t(58614),P=t(81425);const g=()=>{const{uid:D=""}=(0,m.g)(),{data:I,isLoading:f,isError:C,error:T}=(0,y.Uu)({name:D}),[p]=(0,y.Lv)(),u=async K=>{p({name:K.metadata?.name??"",playlist:K}),l.Ny.push("/playlists")},O={text:(0,h.t)("playlist-edit.title","Edit playlist"),subTitle:(0,h.t)("playlist-edit.sub-title","A playlist rotates through a pre-selected list of dashboards. A playlist can be a great way to build situational awareness, or just show off your metrics to your team or visitors.")};return(0,a.jsx)(b.Y,{navId:"dashboards/playlists",pageNav:O,children:(0,a.jsxs)(b.Y.Contents,{isLoading:f,children:[C&&(0,a.jsxs)("div",{children:[(0,a.jsx)(h.x6,{i18nKey:"playlist-edit.error-prefix",children:"Error loading playlist:"}),JSON.stringify(T)]}),I&&(0,a.jsx)(P.$,{onSubmit:u,playlist:I})]})})},E=g},74410:(S,j,t)=>{t.d(j,{l:()=>b});var a=t(74848),m=t(22803),h=t(96540),l=t(49785);function b({defaultValues:y,onSubmit:P,validateOnMount:g=!1,validateFieldsOnMount:E,children:D,validateOn:I="onSubmit",maxWidth:f=600,...C}){const{handleSubmit:T,trigger:p,formState:u,...O}=(0,l.mN)({mode:I,defaultValues:y});return(0,h.useEffect)(()=>{g&&p(E)},[p,E,g]),(0,a.jsx)("form",{className:(0,m.css)({maxWidth:f!=="none"?f+"px":f,width:"100%"}),onSubmit:T(P),...C,children:D({errors:u.errors,formState:u,trigger:p,...O})})}},81425:(S,j,t)=>{t.d(j,{$:()=>H});var a=t(74848),m=t(96540),h=t(51898),l=t(92745),b=t(43173),y=t(37386),P=t(63527),g=t(16780),E=t(41654),D=t(45861),I=t(74410),f=t(95506),C=t(93732),T=t(55860),p=t(21835),u=t(22803),O=t(55127),K=t.n(O),L=t(63142),N=t(68079),R=t(30703),U=t(76319),F=t(11297);const W=({items:r,onDelete:e})=>{const o=(0,L.of)($);if(!r?.length)return(0,a.jsx)("div",{children:(0,a.jsx)("em",{children:(0,a.jsx)(l.x6,{i18nKey:"playlist-edit.form.table-empty",children:"Playlist is empty. Add dashboards below."})})});const v=s=>{let c=s.type==="dashboard_by_tag"?"apps":"tag-alt";const i=[],n=s.dashboards?.[0];return s.dashboards?s.type==="dashboard_by_tag"?(i.push((0,a.jsx)(F.E,{label:s.value,removeIcon:!1,count:0},s.value)),n?i.push((0,a.jsxs)("span",{children:["\xA0 ",K()("dashboard",s.dashboards.length,!0)]},"info")):(c="exclamation-triangle",i.push((0,a.jsxs)("span",{children:["\xA0"," ",(0,a.jsx)("span",{children:(0,a.jsx)(l.x6,{i18nKey:"playlist.playlist-table-rows.no-dashboards-found",children:"No dashboards found"})},"info")]})))):n?i.push(s.dashboards.length>1?(0,a.jsxs)("span",{children:["\xA0"," ",(0,a.jsx)("span",{children:(0,a.jsxs)(l.x6,{i18nKey:"playlist.playlist-table-rows.multiple-dashboards-found",values:{items:s.value},children:["Multiple items found: ","{{items}}"]})},"info")]}):(0,a.jsx)("span",{children:n.name??s.value},"info")):(c="exclamation-triangle",i.push((0,a.jsxs)("span",{children:["\xA0"," ",(0,a.jsx)("span",{children:(0,a.jsxs)(l.x6,{i18nKey:"playlist.playlist-table-rows.not-found",values:{items:s.value},children:["Not found: ","{{items}}"]})},"info")]}))):i.push((0,a.jsx)(N.y,{},"spinner")),(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(R.I,{name:c,className:o.rightMargin},"icon"),i]})};return(0,a.jsx)(a.Fragment,{children:r.map((s,c)=>(0,a.jsx)(p.sx,{draggableId:`${c}`,index:c,children:i=>(0,a.jsxs)("div",{className:o.row,ref:i.innerRef,...i.draggableProps,...i.dragHandleProps,role:"row",children:[(0,a.jsx)("div",{className:o.actions,role:"cell","aria-label":(0,l.t)("playlist.playlist-table-rows.aria-label-playlist-item","Playlist item, {{itemType}}, {{itemValue}}",{itemType:s.type,itemValue:s.value}),children:v(s)}),(0,a.jsxs)("div",{className:o.actions,children:[(0,a.jsx)(U.K,{name:"times",size:"md",onClick:()=>e(c),"data-testid":h.Tp.pages.PlaylistForm.itemDelete,tooltip:(0,l.t)("playlist-edit.form.table-delete","Delete playlist item")}),(0,a.jsx)(R.I,{title:(0,l.t)("playlist-edit.form.table-drag","Drag and drop to reorder"),name:"draggabledots",size:"md"})]})]})},`${c}/${s.value}`))})};function $(r){return{row:(0,u.css)({padding:r.spacing(.75),background:r.colors.background.secondary,borderRadius:r.shape.radius.default,display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:"3px",border:`1px solid ${r.colors.border.medium}`,"&:hover":{border:`1px solid ${r.colors.border.strong}`}}),rightMargin:(0,u.css)({marginRight:"5px"}),actions:(0,u.css)({alignItems:"center",justifyContent:"center",display:"flex"}),settings:(0,u.css)({label:"settings",textAlign:"right"})}}const z=({items:r,deleteItem:e,moveItem:o})=>{const v=s=>{s.destination&&o(s.source.index,s.destination?.index)};return(0,a.jsx)(g.n,{label:(0,l.t)("playlist-edit.form.table-heading","Dashboards"),children:(0,a.jsx)(p.JY,{onDragEnd:v,children:(0,a.jsx)(p.gL,{droppableId:"playlist-list",direction:"vertical",children:s=>(0,a.jsxs)("div",{ref:s.innerRef,...s.droppableProps,children:[(0,a.jsx)(W,{items:r,onDelete:e}),s.placeholder]})})})})};var V=t(16817),Y=t(18984);function J(r){const[e,o]=(0,m.useState)(r??[]);(0,V.A)(async()=>{for(const n of e)if(!n.dashboards){o(await(0,Y.qY)(e));return}},[e]);const v=(0,m.useCallback)(n=>{n&&o([...e,{type:"dashboard_by_uid",value:n.uid}])},[e]),s=(0,m.useCallback)(n=>{const d=n[0];if(!d||e.find(M=>M.value===d))return;const x={type:"dashboard_by_tag",value:d};o([...e,x])},[e]),c=(0,m.useCallback)((n,d)=>{if(n===d||!e[n])return;const x=Array.from(e),[M]=x.splice(n,1);x.splice(d,0,M),o(x)},[e]),i=(0,m.useCallback)(n=>{const d=e.slice();d.splice(n,1),o(d)},[e]);return{items:e,addByUID:v,addByTag:s,deleteItem:i,moveItem:c}}const H=({onSubmit:r,playlist:e})=>{const[o,v]=(0,m.useState)(!1),{title:s,interval:c,items:i}=e.spec||{},n=(0,m.useMemo)(()=>()=>(0,T.S)().tags({kind:["dashboard"]}),[]),{items:d,addByUID:x,addByTag:M,deleteItem:X,moveItem:G}=J(i),Q=A=>{v(!0),r({...e,spec:{...A,interval:A?.interval??"5m",title:A?.title??"",items:d}})};return(0,a.jsx)(I.l,{onSubmit:Q,validateOn:"onBlur",children:({register:A,errors:B})=>{const Z=d.length===0||Object.keys(B).length>0;return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(y.D,{label:(0,l.t)("playlist-edit.form.name-label","Name"),invalid:!!B.title,error:B?.title?.message,children:(0,a.jsx)(P.p,{type:"text",...A("title",{required:(0,l.t)("playlist-edit.form.name-required","Name is required")}),placeholder:(0,l.t)("playlist-edit.form.name-placeholder","Name"),defaultValue:s,"aria-label":h.Tp.pages.PlaylistForm.name})}),(0,a.jsx)(y.D,{label:(0,l.t)("playlist-edit.form.interval-label","Interval"),invalid:!!B.interval,error:B?.interval?.message,children:(0,a.jsx)(P.p,{type:"text",...A("interval",{required:(0,l.t)("playlist-edit.form.interval-required","Interval is required")}),placeholder:(0,l.t)("playlist-edit.form.interval-placeholder","5m"),defaultValue:c??"5m","aria-label":h.Tp.pages.PlaylistForm.interval})}),(0,a.jsx)(z,{items:d,deleteItem:X,moveItem:G}),(0,a.jsxs)(g.n,{label:(0,l.t)("playlist-edit.form.heading","Add dashboards"),children:[(0,a.jsx)(y.D,{label:(0,l.t)("playlist-edit.form.add-title-label","Add by title"),children:(0,a.jsx)(f.b,{id:"dashboard-picker",onChange:x},d.length)}),(0,a.jsx)(y.D,{label:(0,l.t)("playlist-edit.form.add-tag-label","Add by tag"),children:(0,a.jsx)(C.$,{isClearable:!0,tags:[],hideValues:!0,tagOptions:n,onChange:M,placeholder:(0,l.t)("playlist-edit.form.add-tag-placeholder","Select a tag")})})]}),(0,a.jsxs)(E.B,{children:[(0,a.jsx)(D.$n,{type:"submit",variant:"primary",disabled:Z,icon:o?"spinner":void 0,children:(0,a.jsx)(l.x6,{i18nKey:"playlist-edit.form.save",children:"Save"})}),(0,a.jsx)(D.z9,{variant:"secondary",href:`${b.$.appSubUrl}/playlists`,children:(0,a.jsx)(l.x6,{i18nKey:"playlist-edit.form.cancel",children:"Cancel"})})]})]})}})}}}]);

//# sourceMappingURL=PlaylistEditPage.a6bdcab9b1fbe4677fda.js.map