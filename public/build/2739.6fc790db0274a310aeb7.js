"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[2739],{12739:(Bn,Bt,m)=>{m.r(Bt),m.d(Bt,{plugin:()=>Ja});var f=m(74848),Ee=m(16207),x=m(92745),Be=m(43173),ms=m(45013),M=m(22803),Gt=m(17437),ps=m(91765),ys=m(57456),Y=m(25176),E=m(43067),Ge=m(10972);const J="units",ve=[1,2,5],xe=25.4/.28;class $e extends Ge.A{constructor(e){e=e||{};const t=document.createElement("div");t.style.pointerEvents="none",super({element:t,render:e.render,target:e.target}),this.on,this.once,this.un;const s=e.className!==void 0?e.className:e.bar?"ol-scale-bar":"ol-scale-line";this.innerElement_=document.createElement("div"),this.innerElement_.className=s+"-inner",this.element.className=s+" "+Y.XI,this.element.appendChild(this.innerElement_),this.viewState_=null,this.minWidth_=e.minWidth!==void 0?e.minWidth:64,this.maxWidth_=e.maxWidth,this.renderedVisible_=!1,this.renderedWidth_=void 0,this.renderedHTML_="",this.addChangeListener(J,this.handleUnitsChanged_),this.setUnits(e.units||"metric"),this.scaleBar_=e.bar||!1,this.scaleBarSteps_=e.steps||4,this.scaleBarText_=e.text||!1,this.dpi_=e.dpi||void 0}getUnits(){return this.get(J)}handleUnitsChanged_(){this.updateElement_()}setUnits(e){this.set(J,e)}setDpi(e){this.dpi_=e}updateElement_(){const e=this.viewState_;if(!e){this.renderedVisible_&&(this.element.style.display="none",this.renderedVisible_=!1);return}const t=e.center,s=e.projection,i=this.getUnits(),r=i=="degrees"?"degrees":"m";let o=(0,E.hO)(s,e.resolution,t,r);const a=this.minWidth_*(this.dpi_||xe)/xe,l=this.maxWidth_!==void 0?this.maxWidth_*(this.dpi_||xe)/xe:void 0;let c=a*o,h="";if(i=="degrees"){const A=E.Ig.degrees;c*=A,c<A/60?(h="\u2033",o*=3600):c<A?(h="\u2032",o*=60):h="\xB0"}else if(i=="imperial")c<.9144?(h="in",o/=.0254):c<1609.344?(h="ft",o/=.3048):(h="mi",o/=1609.344);else if(i=="nautical")o/=1852,h="NM";else if(i=="metric")c<1e-6?(h="nm",o*=1e9):c<.001?(h="\u03BCm",o*=1e6):c<1?(h="mm",o*=1e3):c<1e3?h="m":(h="km",o/=1e3);else if(i=="us")c<.9144?(h="in",o*=39.37):c<1609.344?(h="ft",o/=.30480061):(h="mi",o/=1609.3472);else throw new Error("Invalid units");let d=3*Math.floor(Math.log(a*o)/Math.log(10)),u,g,y,p=0,v,S;for(;;){y=Math.floor(d/3);const A=Math.pow(10,y);if(u=ve[(d%3+3)%3]*A,g=Math.round(u/o),isNaN(g)){this.element.style.display="none",this.renderedVisible_=!1;return}if(l!==void 0&&g>=l){u=p,g=v,y=S;break}else if(g>=a)break;p=u,v=g,S=y,++d}const C=this.scaleBar_?this.createScaleBar(g,u,h):u.toFixed(y<0?-y:0)+" "+h;this.renderedHTML_!=C&&(this.innerElement_.innerHTML=C,this.renderedHTML_=C),this.renderedWidth_!=g&&(this.innerElement_.style.width=g+"px",this.renderedWidth_=g),this.renderedVisible_||(this.element.style.display="",this.renderedVisible_=!0)}createScaleBar(e,t,s){const i=this.getScaleForResolution(),r=i<1?Math.round(1/i).toLocaleString()+" : 1":"1 : "+Math.round(i).toLocaleString(),o=this.scaleBarSteps_,a=e/o,l=[this.createMarker("absolute")];for(let h=0;h<o;++h){const d=h%2===0?"ol-scale-singlebar-odd":"ol-scale-singlebar-even";l.push(`<div><div class="ol-scale-singlebar ${d}" style="width: ${a}px;"></div>`+this.createMarker("relative")+(h%2===0||o===2?this.createStepText(h,e,!1,t,s):"")+"</div>")}return l.push(this.createStepText(o,e,!0,t,s)),(this.scaleBarText_?`<div class="ol-scale-text" style="width: ${e}px;">`+r+"</div>":"")+l.join("")}createMarker(e){return`<div class="ol-scale-step-marker" style="position: ${e}; top: ${e==="absolute"?3:-10}px;"></div>`}createStepText(e,t,s,i,r){const a=(e===0?0:Math.round(i/this.scaleBarSteps_*e*100)/100)+(e===0?"":" "+r),l=e===0?-3:t/this.scaleBarSteps_*-1,c=e===0?0:t/this.scaleBarSteps_*2;return`<div class="ol-scale-step-text" style="margin-left: ${l}px;text-align: ${e===0?"left":"center"};min-width: ${c}px;left: ${s?t+"px":"unset"};">`+a+"</div>"}getScaleForResolution(){const e=(0,E.hO)(this.viewState_.projection,this.viewState_.resolution,this.viewState_.center,"m"),t=this.dpi_||xe,s=1e3/25.4;return e*s*t}render(e){const t=e.frameState;t?this.viewState_=t.viewState:this.viewState_=null,this.updateElement_()}}const _e=$e;var we=m(69186),I=m(70915),Fe=m(88751),R=m(96540),Ct=m(64423),ie=m(57852),vs=m(64400),xs=m(45229),Nt=m(88813),ws=m(87745),Ne=m(63142);const Ot=({topRight1:n,topRight2:e,bottomLeft:t,blStyle:s})=>{const i=(n&&n.length>0)??!1,r=(0,Ne.of)(Cs(i));return(0,f.jsxs)("div",{className:r.overlay,children:[!!n?.length&&(0,f.jsx)("div",{className:r.TR1,children:n}),!!e?.length&&(0,f.jsx)("div",{className:r.TR2,children:e}),!!t?.length&&(0,f.jsx)("div",{className:r.BL,style:s,children:t})]})},Cs=n=>e=>({overlay:(0,M.css)({position:"absolute",width:"100%",height:"100%",zIndex:500,pointerEvents:"none"}),TR1:(0,M.css)({right:"0.5em",pointerEvents:"auto",position:"absolute",top:"0.5em"}),TR2:(0,M.css)({position:"absolute",top:n?"80px":"8px",right:"8px",pointerEvents:"auto"}),BL:(0,M.css)({position:"absolute",bottom:"8px",left:"8px",pointerEvents:"auto"})});var Gn=m(18828),Nn=m(93225),On=m(15245),kn=m(71076),Vn=m(15840),q=m(2543),St=m(95004),Un=m(16515),Wn=m(13941),Xn=m(89599),li=m(53049),Yn=m(27359),$n=m(13326);const ci=({feature:n})=>{let e,t=0;if(!n)return null;if(e=n.get("frame"),e)t=n.get("rowIndex");else{const{geometry:s,...i}=n.getProperties();e=new Yn.f([i])}return(0,f.jsx)($n.e,{data:e,rowIndex:t})},Zn=({layers:n,activeTabIndex:e})=>{const t=(0,Ne.of)(Kn),[s,i]=(0,R.useState)(new Map),r=(o,a)=>{i(new Map(s.set(o,a)))};return(0,f.jsx)(Wn.J,{children:n.map((o,a)=>a===e&&(0,f.jsx)("div",{children:(0,f.jsx)("div",{children:o.features.map((l,c)=>{const h=l.getId()??c;return o.features.length>1?(0,f.jsx)(Xn.S,{collapsible:!0,label:Hn(l,c),isOpen:s.get(h),onToggle:()=>{r(h,!s.get(h))},className:t.collapsibleRow,children:(0,f.jsx)(ci,{feature:l})},h):(0,f.jsx)(ci,{feature:l},h)})})},o.layer.getName()))})},Hn=(n,e)=>{const t=["Name","name","Title","ID","id"];let s=n.getProperties(),i="";const r=n.get("frame");if(r){const o=n.get("rowIndex");for(const a of r.fields)if(a.type===St.PU.string){const l=(0,Un.Ct)(a,r);i||(i=l),s[l]=a.values[o]}}for(let o of t){const a=s[o];if(a)return a}if(i)return(0,f.jsxs)("span",{children:[i,": ",(0,li.A)(s[i])]});for(let o of Object.keys(s)){const a=s[o];if((0,q.isString)(a))return(0,f.jsxs)("span",{children:[o,": ",(0,li.A)(a)]})}return`Match: ${e+1}`},Kn=n=>({collapsibleRow:(0,M.css)({marginBottom:0})});var Qn=m(54314),Jn=m(60208);const qn=({layers:n,setActiveTabIndex:e,activeTabIndex:t})=>(0,f.jsx)(Qn.U,{children:n&&n.map((s,i)=>(0,f.jsx)(Jn.o,{label:s.layer.getName(),active:i===t,counter:s.features.length>1?s.features.length:null,onChangeTab:()=>{e(i)}},i))}),er=({layers:n,onClose:e,isOpen:t})=>{const[s,i]=(0,R.useState)(0);return n?(0,f.jsxs)(f.Fragment,{children:[t&&(0,f.jsx)(Vn.J,{style:{zIndex:1},onClick:e}),(0,f.jsx)(qn,{layers:n,setActiveTabIndex:i,activeTabIndex:s}),(0,f.jsx)(Zn,{layers:n,activeTabIndex:s})]}):null},tr=({ttip:n,onClose:e,isOpen:t})=>{const s=(0,R.createRef)(),{overlayProps:i}=(0,Nn.e)({onClose:e,isDismissable:!0,isOpen:t},s),{dialogProps:r}=(0,Gn.s)({},s);return(0,f.jsx)(f.Fragment,{children:n&&n.layers&&(0,f.jsx)(On.ZL,{children:(0,f.jsx)(kn.o,{position:{x:n.pageX,y:n.pageY},offset:{x:10,y:10},allowPointerEvents:!0,children:(0,f.jsx)("section",{ref:s,...i,...r,children:(0,f.jsx)(er,{layers:n.layers,isOpen:t,onClose:e})})})})})};var Ce=m(84140),hi=m(51898),Ze=m(65642);class sr extends R.PureComponent{constructor(e){super(e),this.style=ir(Ze.$W.theme2),this.updateViewState=()=>{const t=this.props.map.getView();this.setState({zoom:t.getZoom(),center:(0,E.pd)(t.getCenter(),t.getProjection(),"EPSG:4326")})},this.state={zoom:0,center:[0,0]}}componentDidMount(){this.props.map.on("moveend",this.updateViewState),this.updateViewState()}render(){const{zoom:e,center:t}=this.state;return(0,f.jsx)("div",{className:this.style.infoWrap,"aria-label":hi.Tp.components.DebugOverlay.wrapper,children:(0,f.jsx)("table",{children:(0,f.jsxs)("tbody",{children:[(0,f.jsxs)("tr",{children:[(0,f.jsx)("th",{children:(0,f.jsx)(x.x6,{i18nKey:"geomap.debug-overlay.zoom",children:"Zoom:"})}),(0,f.jsx)("td",{children:e?.toFixed(1)})]}),(0,f.jsxs)("tr",{children:[(0,f.jsxs)("th",{children:[(0,f.jsx)(x.x6,{i18nKey:"geomap.debug-overlay.center",children:"Center:"}),"\xA0"]}),(0,f.jsxs)("td",{children:[t[0].toFixed(5),", ",t[1].toFixed(5)]})]})]})})})}}const ir=n=>({infoWrap:(0,M.css)({color:n.colors.text.primary,background:(0,Ce.A)(n.components.panel.background).setAlpha(.7).toString(),borderRadius:n.shape.radius.default,padding:n.spacing(1)})});var nt=m(77824),kt=m(45861),rt=m(18857),Ss=m(76319),de=m(55386);const ee=[{value:"length",label:"Length",geometry:"LineString",units:[{label:"Metric (m/km)",value:"m",format:n=>(0,de.j_)("lengthm")(n)},{label:"Feet (ft)",value:"ft",format:n=>(0,de.j_)("lengthft")(n*3.28084)},{label:"Miles (mi)",value:"mi",format:n=>(0,de.j_)("lengthmi")(n/1609)},{label:"Nautical miles (nmi)",value:"nmi",format:n=>(0,de.j_)("nmi")(n/1852)}],getUnit:n=>{const e=ee[0].units;return n?.endsWith("2")&&(n=n.substring(0,n.length-1)),e.find(t=>t.value===n)??e[0]}},{value:"area",label:"Area",geometry:"Polygon",units:[{label:"Square Meters (m\xB2)",value:"m2",format:n=>(0,de.j_)("areaM2")(n)},{label:"Square Kilometers (km\xB2)",value:"km2",format:n=>(0,de.G8)("km\xB2")(n*1e-6)},{label:"Square Feet (ft\xB2)",value:"ft2",format:n=>(0,de.j_)("areaF2")(n*10.76391)},{label:"Square Miles (mi\xB2)",value:"mi2",format:n=>(0,de.j_)("areaMI2")(n*3861e-10)},{label:"Acres",value:"acre2",format:n=>(0,de.G8)("acre")(n*247105e-9)},{label:"Hectare",value:"hectare2",format:n=>(0,de.G8)("ha")(n*1e-4)}],getUnit:n=>{const e=ee[1].units;return n?.endsWith("2")||(n+="2"),e.find(t=>t.value===n)??e[0]}}];var Se=m(71064),te=m(11217),ne=m(44294),As=m(50071),Vt=m(32135),$=m(86717),ue=m(73445),Ut=m(66514),V=m(6933),Wt=m(1685),At=m(6837),Ie=m(58704),Oe=m(82986),nr=m(28450),Re=m(90588),Pe=m(9438);let di=!1;function rr(n,e,t,s,i,r,o){const a=new XMLHttpRequest;a.open("GET",typeof n=="function"?n(t,s,i):n,!0),e.getType()=="arraybuffer"&&(a.responseType="arraybuffer"),a.withCredentials=di,a.onload=function(l){if(!a.status||a.status>=200&&a.status<300){const c=e.getType();try{let h;c=="text"||c=="json"?h=a.responseText:c=="xml"?h=a.responseXML||a.responseText:c=="arraybuffer"&&(h=a.response),h?r(e.readFeatures(h,{extent:t,featureProjection:i}),e.readProjection(h)):o()}catch{o()}}else o()},a.onerror=o,a.send()}function ui(n,e){return function(t,s,i,r,o){rr(n,e,t,s,i,(a,l)=>{this.addFeatures(a),r!==void 0&&r(a)},()=>{this.changed(),o!==void 0&&o()})}}function el(n){di=n}var Xt=m(74238);function fi(n,e){return[[-1/0,-1/0,1/0,1/0]]}function tl(n,e){return[n]}function sl(n){return function(e,t,s){const i=n.getZForResolution(fromUserResolution(t,s)),r=n.getTileRangeForExtentAndZ(fromUserExtent(e,s),i),o=[],a=[i,0,0];for(a[1]=r.minX;a[1]<=r.maxX;++a[1])for(a[2]=r.minY;a[2]<=r.maxY;++a[2])o.push(toUserExtent(n.getTileCoordExtent(a),s));return o}}var bs=m(43530),He=m(24778),or=m(42375),D=m(4087);class ar{constructor(e){this.rbush_=new or.A(e),this.items_={}}insert(e,t){const s={minX:e[0],minY:e[1],maxX:e[2],maxY:e[3],value:t};this.rbush_.insert(s),this.items_[(0,D.v6)(t)]=s}load(e,t){const s=new Array(t.length);for(let i=0,r=t.length;i<r;i++){const o=e[i],a=t[i],l={minX:o[0],minY:o[1],maxX:o[2],maxY:o[3],value:a};s[i]=l,this.items_[(0,D.v6)(a)]=l}this.rbush_.load(s)}remove(e){const t=(0,D.v6)(e),s=this.items_[t];return delete this.items_[t],this.rbush_.remove(s)!==null}update(e,t){const s=this.items_[(0,D.v6)(t)],i=[s.minX,s.minY,s.maxX,s.maxY];(0,I.aI)(i,e)||(this.remove(t),this.insert(e,t))}getAll(){return this.rbush_.all().map(function(t){return t.value})}getInExtent(e){const t={minX:e[0],minY:e[1],maxX:e[2],maxY:e[3]};return this.rbush_.search(t).map(function(i){return i.value})}forEach(e){return this.forEach_(this.getAll(),e)}forEachInExtent(e,t){return this.forEach_(this.getInExtent(e),t)}forEach_(e,t){let s;for(let i=0,r=e.length;i<r;i++)if(s=t(e[i]),s)return s;return s}isEmpty(){return(0,bs.p)(this.items_)}clear(){this.rbush_.clear(),this.items_={}}getExtent(e){const t=this.rbush_.toJSON();return(0,I.N)(t.minX,t.minY,t.maxX,t.maxY,e)}concat(e){this.rbush_.load(e.rbush_.all());for(const t in e.items_)this.items_[t]=e.items_[t]}}const Ts=ar;var lr=m(34120);class cr extends lr.A{constructor(e){super(),this.projection=(0,E.Jt)(e.projection),this.attributions_=gi(e.attributions),this.attributionsCollapsible_=e.attributionsCollapsible??!0,this.loading=!1,this.state_=e.state!==void 0?e.state:"ready",this.wrapX_=e.wrapX!==void 0?e.wrapX:!1,this.interpolate_=!!e.interpolate,this.viewResolver=null,this.viewRejector=null;const t=this;this.viewPromise_=new Promise(function(s,i){t.viewResolver=s,t.viewRejector=i})}getAttributions(){return this.attributions_}getAttributionsCollapsible(){return this.attributionsCollapsible_}getProjection(){return this.projection}getResolutions(e){return null}getView(){return this.viewPromise_}getState(){return this.state_}getWrapX(){return this.wrapX_}getInterpolate(){return this.interpolate_}refresh(){this.changed()}setAttributions(e){this.attributions_=gi(e),this.changed()}setState(e){this.state_=e,this.changed()}}function gi(n){return n?typeof n=="function"?n:(Array.isArray(n)||(n=[n]),e=>n):null}const mi=cr;var Z=m(88280);class ke extends Wt.Ay{constructor(e,t,s){super(e),this.feature=t,this.features=s}}class hr extends mi{constructor(e){e=e||{},super({attributions:e.attributions,interpolate:!0,projection:void 0,state:"ready",wrapX:e.wrapX!==void 0?e.wrapX:!0}),this.on,this.once,this.un,this.loader_=Xt.tV,this.format_=e.format||null,this.overlaps_=e.overlaps===void 0?!0:e.overlaps,this.url_=e.url,e.loader!==void 0?this.loader_=e.loader:this.url_!==void 0&&((0,Re.v)(this.format_,"`format` must be set when `url` is set"),this.loader_=ui(this.url_,this.format_)),this.strategy_=e.strategy!==void 0?e.strategy:fi;const t=e.useSpatialIndex!==void 0?e.useSpatialIndex:!0;this.featuresRtree_=t?new Ts:null,this.loadedExtentsRtree_=new Ts,this.loadingExtentsCount_=0,this.nullGeometryFeatures_={},this.idIndex_={},this.uidIndex_={},this.featureChangeKeys_={},this.featuresCollection_=null;let s,i;Array.isArray(e.features)?i=e.features:e.features&&(s=e.features,i=s.getArray()),!t&&s===void 0&&(s=new As.A(i)),i!==void 0&&this.addFeaturesInternal(i),s!==void 0&&this.bindFeaturesCollection_(s)}addFeature(e){this.addFeatureInternal(e),this.changed()}addFeatureInternal(e){const t=(0,D.v6)(e);if(!this.addToIndex_(t,e)){this.featuresCollection_&&this.featuresCollection_.remove(e);return}this.setupChangeEvents_(t,e);const s=e.getGeometry();if(s){const i=s.getExtent();this.featuresRtree_&&this.featuresRtree_.insert(i,e)}else this.nullGeometryFeatures_[t]=e;this.dispatchEvent(new ke(Z.A.ADDFEATURE,e))}setupChangeEvents_(e,t){t instanceof He.Ay||(this.featureChangeKeys_[e]=[(0,Pe.KT)(t,At.A.CHANGE,this.handleFeatureChange_,this),(0,Pe.KT)(t,nr.A.PROPERTYCHANGE,this.handleFeatureChange_,this)])}addToIndex_(e,t){let s=!0;if(t.getId()!==void 0){const i=String(t.getId());if(!(i in this.idIndex_))this.idIndex_[i]=t;else if(t instanceof He.Ay){const r=this.idIndex_[i];r instanceof He.Ay?Array.isArray(r)?r.push(t):this.idIndex_[i]=[r,t]:s=!1}else s=!1}return s&&((0,Re.v)(!(e in this.uidIndex_),"The passed `feature` was already added to the source"),this.uidIndex_[e]=t),s}addFeatures(e){this.addFeaturesInternal(e),this.changed()}addFeaturesInternal(e){const t=[],s=[],i=[];for(let r=0,o=e.length;r<o;r++){const a=e[r],l=(0,D.v6)(a);this.addToIndex_(l,a)&&s.push(a)}for(let r=0,o=s.length;r<o;r++){const a=s[r],l=(0,D.v6)(a);this.setupChangeEvents_(l,a);const c=a.getGeometry();if(c){const h=c.getExtent();t.push(h),i.push(a)}else this.nullGeometryFeatures_[l]=a}if(this.featuresRtree_&&this.featuresRtree_.load(t,i),this.hasListener(Z.A.ADDFEATURE))for(let r=0,o=s.length;r<o;r++)this.dispatchEvent(new ke(Z.A.ADDFEATURE,s[r]))}bindFeaturesCollection_(e){let t=!1;this.addEventListener(Z.A.ADDFEATURE,function(s){t||(t=!0,e.push(s.feature),t=!1)}),this.addEventListener(Z.A.REMOVEFEATURE,function(s){t||(t=!0,e.remove(s.feature),t=!1)}),e.addEventListener(Vt.A.ADD,s=>{t||(t=!0,this.addFeature(s.element),t=!1)}),e.addEventListener(Vt.A.REMOVE,s=>{t||(t=!0,this.removeFeature(s.element),t=!1)}),this.featuresCollection_=e}clear(e){if(e){for(const s in this.featureChangeKeys_)this.featureChangeKeys_[s].forEach(Pe.JH);this.featuresCollection_||(this.featureChangeKeys_={},this.idIndex_={},this.uidIndex_={})}else if(this.featuresRtree_){this.featuresRtree_.forEach(s=>{this.removeFeatureInternal(s)});for(const s in this.nullGeometryFeatures_)this.removeFeatureInternal(this.nullGeometryFeatures_[s])}this.featuresCollection_&&this.featuresCollection_.clear(),this.featuresRtree_&&this.featuresRtree_.clear(),this.nullGeometryFeatures_={};const t=new ke(Z.A.CLEAR);this.dispatchEvent(t),this.changed()}forEachFeature(e){if(this.featuresRtree_)return this.featuresRtree_.forEach(e);this.featuresCollection_&&this.featuresCollection_.forEach(e)}forEachFeatureAtCoordinateDirect(e,t){const s=[e[0],e[1],e[0],e[1]];return this.forEachFeatureInExtent(s,function(i){const r=i.getGeometry();if(r instanceof He.Ay||r.intersectsCoordinate(e))return t(i)})}forEachFeatureInExtent(e,t){if(this.featuresRtree_)return this.featuresRtree_.forEachInExtent(e,t);this.featuresCollection_&&this.featuresCollection_.forEach(t)}forEachFeatureIntersectingExtent(e,t){return this.forEachFeatureInExtent(e,function(s){const i=s.getGeometry();if(i instanceof He.Ay||i.intersectsExtent(e)){const r=t(s);if(r)return r}})}getFeaturesCollection(){return this.featuresCollection_}getFeatures(){let e;return this.featuresCollection_?e=this.featuresCollection_.getArray().slice(0):this.featuresRtree_&&(e=this.featuresRtree_.getAll(),(0,bs.p)(this.nullGeometryFeatures_)||(0,Ut.X$)(e,Object.values(this.nullGeometryFeatures_))),e}getFeaturesAtCoordinate(e){const t=[];return this.forEachFeatureAtCoordinateDirect(e,function(s){t.push(s)}),t}getFeaturesInExtent(e,t){if(this.featuresRtree_){if(!(t&&t.canWrapX()&&this.getWrapX()))return this.featuresRtree_.getInExtent(e);const i=(0,I.QJ)(e,t);return[].concat(...i.map(r=>this.featuresRtree_.getInExtent(r)))}return this.featuresCollection_?this.featuresCollection_.getArray().slice(0):[]}getClosestFeatureToCoordinate(e,t){const s=e[0],i=e[1];let r=null;const o=[NaN,NaN];let a=1/0;const l=[-1/0,-1/0,1/0,1/0];return t=t||Xt.rT,this.featuresRtree_.forEachInExtent(l,function(c){if(t(c)){const h=c.getGeometry(),d=a;if(a=h instanceof He.Ay?0:h.closestPointXY(s,i,o,a),a<d){r=c;const u=Math.sqrt(a);l[0]=s-u,l[1]=i-u,l[2]=s+u,l[3]=i+u}}}),r}getExtent(e){return this.featuresRtree_.getExtent(e)}getFeatureById(e){const t=this.idIndex_[e.toString()];return t!==void 0?t:null}getFeatureByUid(e){const t=this.uidIndex_[e];return t!==void 0?t:null}getFormat(){return this.format_}getOverlaps(){return this.overlaps_}getUrl(){return this.url_}handleFeatureChange_(e){const t=e.target,s=(0,D.v6)(t),i=t.getGeometry();if(!i)s in this.nullGeometryFeatures_||(this.featuresRtree_&&this.featuresRtree_.remove(t),this.nullGeometryFeatures_[s]=t);else{const o=i.getExtent();s in this.nullGeometryFeatures_?(delete this.nullGeometryFeatures_[s],this.featuresRtree_&&this.featuresRtree_.insert(o,t)):this.featuresRtree_&&this.featuresRtree_.update(o,t)}const r=t.getId();if(r!==void 0){const o=r.toString();this.idIndex_[o]!==t&&(this.removeFromIdIndex_(t),this.idIndex_[o]=t)}else this.removeFromIdIndex_(t),this.uidIndex_[s]=t;this.changed(),this.dispatchEvent(new ke(Z.A.CHANGEFEATURE,t))}hasFeature(e){const t=e.getId();return t!==void 0?t in this.idIndex_:(0,D.v6)(e)in this.uidIndex_}isEmpty(){return this.featuresRtree_?this.featuresRtree_.isEmpty()&&(0,bs.p)(this.nullGeometryFeatures_):this.featuresCollection_?this.featuresCollection_.getLength()===0:!0}loadFeatures(e,t,s){const i=this.loadedExtentsRtree_,r=this.strategy_(e,t,s);for(let o=0,a=r.length;o<a;++o){const l=r[o];i.forEachInExtent(l,function(h){return(0,I.ms)(h.extent,l)})||(++this.loadingExtentsCount_,this.dispatchEvent(new ke(Z.A.FEATURESLOADSTART)),this.loader_.call(this,l,t,s,h=>{--this.loadingExtentsCount_,this.dispatchEvent(new ke(Z.A.FEATURESLOADEND,void 0,h))},()=>{--this.loadingExtentsCount_,this.dispatchEvent(new ke(Z.A.FEATURESLOADERROR))}),i.insert(l,{extent:l.slice()}))}this.loading=this.loader_.length<4?!1:this.loadingExtentsCount_>0}refresh(){this.clear(!0),this.loadedExtentsRtree_.clear(),super.refresh()}removeLoadedExtent(e){const t=this.loadedExtentsRtree_,s=t.forEachInExtent(e,function(i){if((0,I.aI)(i.extent,e))return i});s&&t.remove(s)}removeFeatures(e){let t=!1;for(let s=0,i=e.length;s<i;++s)t=this.removeFeatureInternal(e[s])||t;t&&this.changed()}removeFeature(e){if(!e)return;this.removeFeatureInternal(e)&&this.changed()}removeFeatureInternal(e){const t=(0,D.v6)(e);if(!(t in this.uidIndex_))return!1;t in this.nullGeometryFeatures_?delete this.nullGeometryFeatures_[t]:this.featuresRtree_&&this.featuresRtree_.remove(e),this.featureChangeKeys_[t]?.forEach(Pe.JH),delete this.featureChangeKeys_[t];const i=e.getId();if(i!==void 0){const r=i.toString(),o=this.idIndex_[r];o===e?delete this.idIndex_[r]:Array.isArray(o)&&(o.splice(o.indexOf(e),1),o.length===1&&(this.idIndex_[r]=o[0]))}return delete this.uidIndex_[t],this.hasListener(Z.A.REMOVEFEATURE)&&this.dispatchEvent(new ke(Z.A.REMOVEFEATURE,e)),!0}removeFromIdIndex_(e){for(const t in this.idIndex_)if(this.idIndex_[t]===e){delete this.idIndex_[t];break}}setLoader(e){this.loader_=e}setUrl(e){(0,Re.v)(this.format_,"`format` must be set when `url` is set"),this.url_=e,this.setLoader(ui(e,this.format_))}setOverlaps(e){this.overlaps_=e,this.changed()}}const ae=hr;var L=m(29276),pi=m(21409);const yi=0,bt=1,vi=[0,0,0,0],ot=[],Es={MODIFYSTART:"modifystart",MODIFYEND:"modifyend"};class _s extends Wt.Ay{constructor(e,t,s){super(e),this.features=t,this.mapBrowserEvent=s}}class dr extends pi.A{constructor(e){super(e),this.on,this.once,this.un,this.boundHandleFeatureChange_=this.handleFeatureChange_.bind(this),this.condition_=e.condition?e.condition:Ie.fs,this.defaultDeleteCondition_=function(s){return(0,Ie.Js)(s)&&(0,Ie.t5)(s)},this.deleteCondition_=e.deleteCondition?e.deleteCondition:this.defaultDeleteCondition_,this.insertVertexCondition_=e.insertVertexCondition?e.insertVertexCondition:Ie.Gk,this.vertexFeature_=null,this.vertexSegments_=null,this.lastPixel_=[0,0],this.ignoreNextSingleClick_=!1,this.featuresBeingModified_=null,this.rBush_=new Ts,this.pixelTolerance_=e.pixelTolerance!==void 0?e.pixelTolerance:10,this.snappedToVertex_=!1,this.changingFeature_=!1,this.dragSegments_=[],this.overlay_=new Oe.A({source:new ae({useSpatialIndex:!1,wrapX:!!e.wrapX}),style:e.style?e.style:fr(),updateWhileAnimating:!0,updateWhileInteracting:!0}),this.SEGMENT_WRITERS_={Point:this.writePointGeometry_.bind(this),LineString:this.writeLineStringGeometry_.bind(this),LinearRing:this.writeLineStringGeometry_.bind(this),Polygon:this.writePolygonGeometry_.bind(this),MultiPoint:this.writeMultiPointGeometry_.bind(this),MultiLineString:this.writeMultiLineStringGeometry_.bind(this),MultiPolygon:this.writeMultiPolygonGeometry_.bind(this),Circle:this.writeCircleGeometry_.bind(this),GeometryCollection:this.writeGeometryCollectionGeometry_.bind(this)},this.source_=null,this.hitDetection_=null;let t;if(e.features?t=e.features:e.source&&(this.source_=e.source,t=new As.A(this.source_.getFeatures()),this.source_.addEventListener(Z.A.ADDFEATURE,this.handleSourceAdd_.bind(this)),this.source_.addEventListener(Z.A.REMOVEFEATURE,this.handleSourceRemove_.bind(this))),!t)throw new Error("The modify interaction requires features, a source or a layer");e.hitDetection&&(this.hitDetection_=e.hitDetection),this.features_=t,this.features_.forEach(this.addFeature_.bind(this)),this.features_.addEventListener(Vt.A.ADD,this.handleFeatureAdd_.bind(this)),this.features_.addEventListener(Vt.A.REMOVE,this.handleFeatureRemove_.bind(this)),this.lastPointerEvent_=null,this.delta_=[0,0],this.snapToPointer_=e.snapToPointer===void 0?!this.hitDetection_:e.snapToPointer}addFeature_(e){const t=e.getGeometry();if(t){const i=this.SEGMENT_WRITERS_[t.getType()];i&&i(e,t)}const s=this.getMap();s&&s.isRendered()&&this.getActive()&&this.handlePointerAtPixel_(s.getCoordinateFromPixel(this.lastPixel_)),e.addEventListener(At.A.CHANGE,this.boundHandleFeatureChange_)}willModifyFeatures_(e,t){if(!this.featuresBeingModified_){this.featuresBeingModified_=new As.A;const s=this.featuresBeingModified_.getArray();for(let i=0,r=t.length;i<r;++i){const o=t[i].feature;o&&!s.includes(o)&&this.featuresBeingModified_.push(o)}this.featuresBeingModified_.getLength()===0?this.featuresBeingModified_=null:this.dispatchEvent(new _s(Es.MODIFYSTART,this.featuresBeingModified_,e))}}removeFeature_(e){this.removeFeatureSegmentData_(e),this.vertexFeature_&&this.features_.getLength()===0&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null),e.removeEventListener(At.A.CHANGE,this.boundHandleFeatureChange_)}removeFeatureSegmentData_(e){const t=this.rBush_,s=[];t.forEach(function(i){e===i.feature&&s.push(i)});for(let i=s.length-1;i>=0;--i){const r=s[i];for(let o=this.dragSegments_.length-1;o>=0;--o)this.dragSegments_[o][0]===r&&this.dragSegments_.splice(o,1);t.remove(r)}}setActive(e){this.vertexFeature_&&!e&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null),super.setActive(e)}setMap(e){this.overlay_.setMap(e),super.setMap(e)}getOverlay(){return this.overlay_}handleSourceAdd_(e){e.feature&&this.features_.push(e.feature)}handleSourceRemove_(e){e.feature&&this.features_.remove(e.feature)}handleFeatureAdd_(e){this.addFeature_(e.element)}handleFeatureChange_(e){if(!this.changingFeature_){const t=e.target;this.removeFeature_(t),this.addFeature_(t)}}handleFeatureRemove_(e){this.removeFeature_(e.element)}writePointGeometry_(e,t){const s=t.getCoordinates(),i={feature:e,geometry:t,segment:[s,s]};this.rBush_.insert(t.getExtent(),i)}writeMultiPointGeometry_(e,t){const s=t.getCoordinates();for(let i=0,r=s.length;i<r;++i){const o=s[i],a={feature:e,geometry:t,depth:[i],index:i,segment:[o,o]};this.rBush_.insert(t.getExtent(),a)}}writeLineStringGeometry_(e,t){const s=t.getCoordinates();for(let i=0,r=s.length-1;i<r;++i){const o=s.slice(i,i+2),a={feature:e,geometry:t,index:i,segment:o};this.rBush_.insert((0,I.Tr)(o),a)}}writeMultiLineStringGeometry_(e,t){const s=t.getCoordinates();for(let i=0,r=s.length;i<r;++i){const o=s[i];for(let a=0,l=o.length-1;a<l;++a){const c=o.slice(a,a+2),h={feature:e,geometry:t,depth:[i],index:a,segment:c};this.rBush_.insert((0,I.Tr)(c),h)}}}writePolygonGeometry_(e,t){const s=t.getCoordinates();for(let i=0,r=s.length;i<r;++i){const o=s[i];for(let a=0,l=o.length-1;a<l;++a){const c=o.slice(a,a+2),h={feature:e,geometry:t,depth:[i],index:a,segment:c};this.rBush_.insert((0,I.Tr)(c),h)}}}writeMultiPolygonGeometry_(e,t){const s=t.getCoordinates();for(let i=0,r=s.length;i<r;++i){const o=s[i];for(let a=0,l=o.length;a<l;++a){const c=o[a];for(let h=0,d=c.length-1;h<d;++h){const u=c.slice(h,h+2),g={feature:e,geometry:t,depth:[a,i],index:h,segment:u};this.rBush_.insert((0,I.Tr)(u),g)}}}}writeCircleGeometry_(e,t){const s=t.getCenter(),i={feature:e,geometry:t,index:yi,segment:[s,s]},r={feature:e,geometry:t,index:bt,segment:[s,s]},o=[i,r];i.featureSegments=o,r.featureSegments=o,this.rBush_.insert((0,I.dP)(s),i);let a=t;const l=(0,E.Tf)();if(l&&this.getMap()){const c=this.getMap().getView().getProjection();a=a.clone().transform(l,c),a=(0,Se.nD)(a).transform(c,l)}this.rBush_.insert(a.getExtent(),r)}writeGeometryCollectionGeometry_(e,t){const s=t.getGeometriesArray();for(let i=0;i<s.length;++i){const r=s[i],o=this.SEGMENT_WRITERS_[r.getType()];o(e,r)}}createOrUpdateVertexFeature_(e,t,s,i){let r=this.vertexFeature_;return r?r.getGeometry().setCoordinates(e):(r=new $.A(new ne.A(e)),this.vertexFeature_=r,this.overlay_.getSource().addFeature(r)),r.set("features",t),r.set("geometries",s),r.set("existing",i),r}handleEvent(e){if(!e.originalEvent)return!0;this.lastPointerEvent_=e;let t;return!e.map.getView().getInteracting()&&e.type==ue.A.POINTERMOVE&&!this.handlingDownUpSequence&&this.handlePointerMove_(e),this.vertexFeature_&&this.deleteCondition_(e)&&(e.type!=ue.A.SINGLECLICK||!this.ignoreNextSingleClick_?t=this.removePoint():t=!0),e.type==ue.A.SINGLECLICK&&(this.ignoreNextSingleClick_=!1),super.handleEvent(e)&&!t}findInsertVerticesAndUpdateDragSegments_(e){this.handlePointerAtPixel_(e),this.dragSegments_.length=0,this.featuresBeingModified_=null;const t=this.vertexFeature_;if(!t)return;const s=this.getMap().getView().getProjection(),i=[],r=t.getGeometry().getCoordinates(),o=(0,I.Tr)([r]),a=this.rBush_.getInExtent(o),l={};a.sort(ur);for(let c=0,h=a.length;c<h;++c){const d=a[c],u=d.segment;let g=(0,D.v6)(d.geometry);const y=d.depth;if(y&&(g+="-"+y.join("-")),l[g]||(l[g]=new Array(2)),d.geometry.getType()==="Circle"&&d.index===bt){const p=wi(e,d,s);(0,V.aI)(p,r)&&!l[g][0]&&(this.dragSegments_.push([d,0]),l[g][0]=d);continue}if((0,V.aI)(u[0],r)&&!l[g][0]){this.dragSegments_.push([d,0]),l[g][0]=d;continue}if((0,V.aI)(u[1],r)&&!l[g][1]){if(l[g][0]&&l[g][0].index===0){let p=d.geometry.getCoordinates();switch(d.geometry.getType()){case"LineString":case"MultiLineString":continue;case"MultiPolygon":p=p[y[1]];case"Polygon":if(d.index!==p[y[0]].length-2)continue;break;default:}}this.dragSegments_.push([d,1]),l[g][1]=d;continue}(0,D.v6)(u)in this.vertexSegments_&&!l[g][0]&&!l[g][1]&&i.push(d)}return i}handleDragEvent(e){this.ignoreNextSingleClick_=!1,this.willModifyFeatures_(e,this.dragSegments_.map(([r])=>r));const t=[e.coordinate[0]+this.delta_[0],e.coordinate[1]+this.delta_[1]],s=[],i=[];for(let r=0,o=this.dragSegments_.length;r<o;++r){const a=this.dragSegments_[r],l=a[0],c=l.feature;s.includes(c)||s.push(c);const h=l.geometry;i.includes(h)||i.push(h);const d=l.depth;let u;const g=l.segment,y=a[1];for(;t.length<h.getStride();)t.push(g[y][t.length]);switch(h.getType()){case"Point":u=t,g[0]=t,g[1]=t;break;case"MultiPoint":u=h.getCoordinates(),u[l.index]=t,g[0]=t,g[1]=t;break;case"LineString":u=h.getCoordinates(),u[l.index+y]=t,g[y]=t;break;case"MultiLineString":u=h.getCoordinates(),u[d[0]][l.index+y]=t,g[y]=t;break;case"Polygon":u=h.getCoordinates(),u[d[0]][l.index+y]=t,g[y]=t;break;case"MultiPolygon":u=h.getCoordinates(),u[d[1]][d[0]][l.index+y]=t,g[y]=t;break;case"Circle":const p=h;if(g[0]=t,g[1]=t,l.index===yi)this.changingFeature_=!0,p.setCenter(t),this.changingFeature_=!1;else{this.changingFeature_=!0;const v=e.map.getView().getProjection();let S=(0,V.Io)((0,E.Ad)(p.getCenter(),v),(0,E.Ad)(t,v));const C=(0,E.Tf)();if(C){const A=p.clone().transform(C,v);A.setRadius(S),S=A.transform(v,C).getRadius()}p.setRadius(S),this.changingFeature_=!1}break;default:}u&&this.setGeometryCoordinates_(h,u)}this.createOrUpdateVertexFeature_(t,s,i,!0)}handleDownEvent(e){if(!this.condition_(e))return!1;const t=e.coordinate,s=this.findInsertVerticesAndUpdateDragSegments_(t);if(s?.length&&this.insertVertexCondition_(e)&&(this.willModifyFeatures_(e,s),this.vertexFeature_)){const i=this.vertexFeature_.getGeometry().getCoordinates();for(let r=s.length-1;r>=0;--r)this.insertVertex_(s[r],i);this.ignoreNextSingleClick_=!0}return!!this.vertexFeature_}handleUpEvent(e){for(let t=this.dragSegments_.length-1;t>=0;--t){const s=this.dragSegments_[t][0],i=s.geometry;if(i.getType()==="Circle"){const r=i,o=r.getCenter(),a=s.featureSegments[0],l=s.featureSegments[1];a.segment[0]=o,a.segment[1]=o,l.segment[0]=o,l.segment[1]=o,this.rBush_.update((0,I.dP)(o),a);let c=r;const h=(0,E.Tf)();if(h){const d=e.map.getView().getProjection();c=c.clone().transform(h,d),c=(0,Se.nD)(c).transform(d,h)}this.rBush_.update(c.getExtent(),l)}else this.rBush_.update((0,I.Tr)(s.segment),s)}return this.featuresBeingModified_&&(this.dispatchEvent(new _s(Es.MODIFYEND,this.featuresBeingModified_,e)),this.featuresBeingModified_=null),!1}handlePointerMove_(e){this.lastPixel_=e.pixel,this.handlePointerAtPixel_(e.coordinate)}handlePointerAtPixel_(e){const t=this.getMap(),s=t.getPixelFromCoordinate(e),i=t.getView().getProjection(),r=function(l,c){return xi(e,l,i)-xi(e,c,i)};let o,a;if(this.hitDetection_){const l=typeof this.hitDetection_=="object"?c=>c===this.hitDetection_:void 0;t.forEachFeatureAtPixel(s,(c,h,d)=>{d&&d.getType()==="Point"&&(d=new ne.A((0,E.te)(d.getCoordinates(),i)));const u=d||c.getGeometry();if(u&&u.getType()==="Point"&&c instanceof $.A&&this.features_.getArray().includes(c)){a=u;const g=c.getGeometry().getFlatCoordinates().slice(0,2);o=[{feature:c,geometry:a,segment:[g,g]}]}return!0},{layerFilter:l})}if(!o){const l=(0,E.SD)((0,I.dP)(e,vi),i),c=t.getView().getResolution()*this.pixelTolerance_,h=(0,E.JR)((0,I.r)(l,c,vi),i);o=this.rBush_.getInExtent(h)}if(o&&o.length>0){const l=o.sort(r)[0],c=l.segment;let h=wi(e,l,i);const d=t.getPixelFromCoordinate(h);let u=(0,V.Io)(s,d);if(a||u<=this.pixelTolerance_){const g={};if(g[(0,D.v6)(c)]=!0,this.snapToPointer_||(this.delta_[0]=h[0]-e[0],this.delta_[1]=h[1]-e[1]),l.geometry.getType()==="Circle"&&l.index===bt)this.snappedToVertex_=!0,this.createOrUpdateVertexFeature_(h,[l.feature],[l.geometry],this.snappedToVertex_);else{const y=t.getPixelFromCoordinate(c[0]),p=t.getPixelFromCoordinate(c[1]),v=(0,V.hG)(d,y),S=(0,V.hG)(d,p);if(u=Math.sqrt(Math.min(v,S)),this.snappedToVertex_=u<=this.pixelTolerance_,!this.snappedToVertex_&&!this.insertVertexCondition_(this.lastPointerEvent_)){this.vertexFeature_&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null);return}this.snappedToVertex_&&(h=v>S?c[1]:c[0]),this.createOrUpdateVertexFeature_(h,[l.feature],[l.geometry],this.snappedToVertex_);const C={};C[(0,D.v6)(l.geometry)]=!0;for(let A=1,F=o.length;A<F;++A){const T=o[A].segment;if((0,V.aI)(c[0],T[0])&&(0,V.aI)(c[1],T[1])||(0,V.aI)(c[0],T[1])&&(0,V.aI)(c[1],T[0])){const b=(0,D.v6)(o[A].geometry);b in C||(C[b]=!0,g[(0,D.v6)(T)]=!0)}else break}}this.vertexSegments_=g;return}}this.vertexFeature_&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null)}insertVertex_(e,t){const s=e.segment,i=e.feature,r=e.geometry,o=e.depth,a=e.index;let l;for(;t.length<r.getStride();)t.push(0);switch(r.getType()){case"MultiLineString":l=r.getCoordinates(),l[o[0]].splice(a+1,0,t);break;case"Polygon":l=r.getCoordinates(),l[o[0]].splice(a+1,0,t);break;case"MultiPolygon":l=r.getCoordinates(),l[o[1]][o[0]].splice(a+1,0,t);break;case"LineString":l=r.getCoordinates(),l.splice(a+1,0,t);break;default:return!1}this.setGeometryCoordinates_(r,l);const c=this.rBush_;c.remove(e),this.updateSegmentIndices_(r,a,o,1);const h={segment:[s[0],t],feature:i,geometry:r,depth:o,index:a};c.insert((0,I.Tr)(h.segment),h),this.dragSegments_.push([h,1]);const d={segment:[t,s[1]],feature:i,geometry:r,depth:o,index:a+1};return c.insert((0,I.Tr)(d.segment),d),this.dragSegments_.push([d,0]),!0}updatePointer_(e){return e&&this.findInsertVerticesAndUpdateDragSegments_(e),this.vertexFeature_?.getGeometry().getCoordinates()}getPoint(){const e=this.vertexFeature_?.getGeometry().getCoordinates();return e?(0,E.te)(e,this.getMap().getView().getProjection()):null}canRemovePoint(){if(!this.vertexFeature_||this.vertexFeature_.get("geometries").every(s=>s.getType()==="Circle"||s.getType().endsWith("Point")))return!1;const e=this.vertexFeature_.getGeometry().getCoordinates();return this.rBush_.getInExtent((0,I.Tr)([e])).some(({segment:s})=>(0,V.aI)(s[0],e)||(0,V.aI)(s[1],e))}removePoint(e){if(e&&(e=(0,E.Ad)(e,this.getMap().getView().getProjection()),this.updatePointer_(e)),!this.lastPointerEvent_||this.lastPointerEvent_&&this.lastPointerEvent_.type!=ue.A.POINTERDRAG){const t=this.lastPointerEvent_;this.willModifyFeatures_(t,this.dragSegments_.map(([i])=>i));const s=this.removeVertex_();return this.featuresBeingModified_&&this.dispatchEvent(new _s(Es.MODIFYEND,this.featuresBeingModified_,t)),this.featuresBeingModified_=null,s}return!1}removeVertex_(){const e=this.dragSegments_,t={};let s=!1,i,r,o,a,l,c,h,d,u,g,y;for(l=e.length-1;l>=0;--l)o=e[l],g=o[0],y=(0,D.v6)(g.feature),g.depth&&(y+="-"+g.depth.join("-")),y in t||(t[y]={}),o[1]===0?(t[y].right=g,t[y].index=g.index):o[1]==1&&(t[y].left=g,t[y].index=g.index+1);for(y in t){switch(u=t[y].right,h=t[y].left,c=t[y].index,d=c-1,h!==void 0?g=h:g=u,d<0&&(d=0),a=g.geometry,r=a.getCoordinates(),i=r,s=!1,a.getType()){case"MultiLineString":r[g.depth[0]].length>2&&(r[g.depth[0]].splice(c,1),s=!0);break;case"LineString":r.length>2&&(r.splice(c,1),s=!0);break;case"MultiPolygon":i=i[g.depth[1]];case"Polygon":i=i[g.depth[0]],i.length>4&&(c==i.length-1&&(c=0),i.splice(c,1),s=!0,c===0&&(i.pop(),i.push(i[0]),d=i.length-1));break;default:}if(s){this.setGeometryCoordinates_(a,r);const p=[];if(h!==void 0&&(this.rBush_.remove(h),p.push(h.segment[0])),u!==void 0&&(this.rBush_.remove(u),p.push(u.segment[1])),h!==void 0&&u!==void 0){const v={depth:g.depth,feature:g.feature,geometry:g.geometry,index:d,segment:p};this.rBush_.insert((0,I.Tr)(v.segment),v)}this.updateSegmentIndices_(a,c,g.depth,-1),this.vertexFeature_&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null),e.length=0}}return s}canInsertPoint(){if(!this.vertexFeature_||this.vertexFeature_.get("geometries").every(s=>s.getType()==="Circle"||s.getType().endsWith("Point")))return!1;const e=this.vertexFeature_.getGeometry().getCoordinates();return this.rBush_.getInExtent((0,I.Tr)([e])).some(({segment:s})=>!((0,V.aI)(s[0],e)||(0,V.aI)(s[1],e)))}insertPoint(e){const t=e?(0,E.Ad)(e,this.getMap().getView().getProjection()):this.vertexFeature_?.getGeometry().getCoordinates();return t?this.findInsertVerticesAndUpdateDragSegments_(t).reduce((i,r)=>i||this.insertVertex_(r,t),!1):!1}setGeometryCoordinates_(e,t){this.changingFeature_=!0,e.setCoordinates(t),this.changingFeature_=!1}updateSegmentIndices_(e,t,s,i){this.rBush_.forEachInExtent(e.getExtent(),function(r){r.geometry===e&&(s===void 0||r.depth===void 0||(0,Ut.aI)(r.depth,s))&&r.index>t&&(r.index+=i)})}}function ur(n,e){return n.index-e.index}function xi(n,e,t){const s=e.geometry;if(s.getType()==="Circle"){let r=s;if(e.index===bt){const o=(0,E.Tf)();o&&(r=r.clone().transform(o,t));const a=(0,V.hG)(r.getCenter(),(0,E.Ad)(n,t)),l=Math.sqrt(a)-r.getRadius();return l*l}}const i=(0,E.Ad)(n,t);return ot[0]=(0,E.Ad)(e.segment[0],t),ot[1]=(0,E.Ad)(e.segment[1],t),(0,V.$x)(i,ot)}function wi(n,e,t){const s=e.geometry;if(s.getType()==="Circle"&&e.index===bt){let r=s;const o=(0,E.Tf)();return o&&(r=r.clone().transform(o,t)),(0,E.te)(r.getClosestPoint((0,E.Ad)(n,t)),t)}const i=(0,E.Ad)(n,t);return ot[0]=(0,E.Ad)(e.segment[0],t),ot[1]=(0,E.Ad)(e.segment[1],t),(0,E.te)((0,V.sG)(i,ot),t)}function fr(){const n=(0,L.mY)();return function(e,t){return n.Point}}const gr=dr;var mr=m(10277),Tt=m(62096),pr=m(92497),Fs=m(87622);class Yt extends Tt.Ay{constructor(e,t,s){super(),s!==void 0&&t===void 0?this.setFlatCoordinates(s,e):(t=t||0,this.setCenterAndRadius(e,t,s))}clone(){const e=new Yt(this.flatCoordinates.slice(),void 0,this.layout);return e.applyProperties(this),e}closestPointXY(e,t,s,i){const r=this.flatCoordinates,o=e-r[0],a=t-r[1],l=o*o+a*a;if(l<i){if(l===0)for(let c=0;c<this.stride;++c)s[c]=r[c];else{const c=this.getRadius()/Math.sqrt(l);s[0]=r[0]+c*o,s[1]=r[1]+c*a;for(let h=2;h<this.stride;++h)s[h]=r[h]}return s.length=this.stride,l}return i}containsXY(e,t){const s=this.flatCoordinates,i=e-s[0],r=t-s[1];return i*i+r*r<=this.getRadiusSquared_()}getCenter(){return this.flatCoordinates.slice(0,this.stride)}computeExtent(e){const t=this.flatCoordinates,s=t[this.stride]-t[0];return(0,I.N)(t[0]-s,t[1]-s,t[0]+s,t[1]+s,e)}getRadius(){return Math.sqrt(this.getRadiusSquared_())}getRadiusSquared_(){const e=this.flatCoordinates[this.stride]-this.flatCoordinates[0],t=this.flatCoordinates[this.stride+1]-this.flatCoordinates[1];return e*e+t*t}getType(){return"Circle"}intersectsExtent(e){const t=this.getExtent();if((0,I.HY)(e,t)){const s=this.getCenter();return e[0]<=s[0]&&e[2]>=s[0]||e[1]<=s[1]&&e[3]>=s[1]?!0:(0,I.sB)(e,this.intersectsCoordinate.bind(this))}return!1}setCenter(e){const t=this.stride,s=this.flatCoordinates[t]-this.flatCoordinates[0],i=e.slice();i[t]=i[0]+s;for(let r=1;r<t;++r)i[t+r]=e[r];this.setFlatCoordinates(this.layout,i),this.changed()}setCenterAndRadius(e,t,s){this.setLayout(s,e,0),this.flatCoordinates||(this.flatCoordinates=[]);const i=this.flatCoordinates;let r=(0,pr._n)(i,0,e,this.stride);i[r++]=i[0]+t;for(let o=1,a=this.stride;o<a;++o)i[r++]=i[o];i.length=r,this.changed()}getCoordinates(){return null}setCoordinates(e,t){}setRadius(e){this.flatCoordinates[this.stride]=this.flatCoordinates[0]+e,this.changed()}rotate(e,t){const s=this.getCenter(),i=this.getStride();this.setCenter((0,Fs.e$)(s,0,s.length,i,e,t,s)),this.changed()}}Yt.prototype.transform;const Ci=Yt;var yr=m(34338),$t=m(96702),vr=m(30503),at=m(2871),se=m(61597),xr=m(82187);const Zt={DRAWSTART:"drawstart",DRAWEND:"drawend",DRAWABORT:"drawabort"};class Ht extends Wt.Ay{constructor(e,t){super(e),this.feature=t}}function wr(n,e){const t=[];for(let s=0;s<e.length;++s){const r=e[s].getGeometry();Si(n,r,t)}return t}function Kt(n,e){return(0,se.hG)(n[0],n[1],e[0],e[1])}function lt(n,e){const t=n.length;return e<0?n[e+t]:e>=t?n[e-t]:n[e]}function Qt(n,e,t){let s,i;e<t?(s=e,i=t):(s=t,i=e);const r=Math.ceil(s),o=Math.floor(i);if(r>o){const l=ct(n,s),c=ct(n,i);return Kt(l,c)}let a=0;if(s<r){const l=ct(n,s),c=lt(n,r);a+=Kt(l,c)}if(o<i){const l=lt(n,o),c=ct(n,i);a+=Kt(l,c)}for(let l=r;l<o-1;++l){const c=lt(n,l),h=lt(n,l+1);a+=Kt(c,h)}return a}function Si(n,e,t){if(e instanceof te.A){Jt(n,e.getCoordinates(),!1,t);return}if(e instanceof $t.A){const s=e.getCoordinates();for(let i=0,r=s.length;i<r;++i)Jt(n,s[i],!1,t);return}if(e instanceof Se.Ay){const s=e.getCoordinates();for(let i=0,r=s.length;i<r;++i)Jt(n,s[i],!0,t);return}if(e instanceof at.A){const s=e.getCoordinates();for(let i=0,r=s.length;i<r;++i){const o=s[i];for(let a=0,l=o.length;a<l;++a)Jt(n,o[a],!0,t)}return}if(e instanceof yr.A){const s=e.getGeometries();for(let i=0;i<s.length;++i)Si(n,s[i],t);return}}const Is={index:-1,endIndex:NaN};function Cr(n,e,t,s){const i=n[0],r=n[1];let o=1/0,a=-1,l=NaN;for(let d=0;d<e.targets.length;++d){const u=e.targets[d],g=u.coordinates;let y=1/0,p;for(let v=0;v<g.length-1;++v){const S=g[v],C=g[v+1],A=Ai(i,r,S,C);A.squaredDistance<y&&(y=A.squaredDistance,p=v+A.along)}y<o&&(o=y,u.ring&&e.targetIndex===d&&(u.endIndex>u.startIndex?p<u.startIndex&&(p+=g.length):u.endIndex<u.startIndex&&p>u.startIndex&&(p-=g.length)),l=p,a=d)}const c=e.targets[a];let h=c.ring;if(e.targetIndex===a&&h){const d=ct(c.coordinates,l),u=t.getPixelFromCoordinate(d);(0,V.Io)(u,e.startPx)>s&&(h=!1)}if(h){const d=c.coordinates,u=d.length,g=c.startIndex,y=l;if(g<y){const p=Qt(d,g,y);Qt(d,g,y-u)<p&&(l-=u)}else{const p=Qt(d,g,y);Qt(d,g,y+u)<p&&(l+=u)}}return Is.index=a,Is.endIndex=l,Is}function Jt(n,e,t,s){const i=n[0],r=n[1];for(let o=0,a=e.length-1;o<a;++o){const l=e[o],c=e[o+1],h=Ai(i,r,l,c);if(h.squaredDistance===0){const d=o+h.along;s.push({coordinates:e,ring:t,startIndex:d,endIndex:d});return}}}const Rs={along:0,squaredDistance:0};function Ai(n,e,t,s){const i=t[0],r=t[1],o=s[0],a=s[1],l=o-i,c=a-r;let h=0,d=i,u=r;return(l!==0||c!==0)&&(h=(0,se.qE)(((n-i)*l+(e-r)*c)/(l*l+c*c),0,1),d+=l*h,u+=c*h),Rs.along=h,Rs.squaredDistance=(0,se.Mg)((0,se.hG)(n,e,d,u),10),Rs}function ct(n,e){const t=n.length;let s=Math.floor(e);const i=e-s;s>=t?s-=t:s<0&&(s+=t);let r=s+1;r>=t&&(r-=t);const o=n[s],a=o[0],l=o[1],c=n[r],h=c[0]-a,d=c[1]-l;return[a+h*i,l+d*i]}class Sr extends pi.A{constructor(e){const t=e;t.stopDown||(t.stopDown=Xt.W8),super(t),this.on,this.once,this.un,this.shouldHandle_=!1,this.downPx_=null,this.downTimeout_,this.lastDragTime_,this.pointerType_,this.freehand_=!1,this.source_=e.source?e.source:null,this.features_=e.features?e.features:null,this.snapTolerance_=e.snapTolerance?e.snapTolerance:12,this.type_=e.type,this.mode_=br(this.type_),this.stopClick_=!!e.stopClick,this.minPoints_=e.minPoints?e.minPoints:this.mode_==="Polygon"?3:2,this.maxPoints_=this.mode_==="Circle"?2:e.maxPoints?e.maxPoints:1/0,this.finishCondition_=e.finishCondition?e.finishCondition:Xt.rT,this.geometryLayout_=e.geometryLayout?e.geometryLayout:"XY";let s=e.geometryFunction;if(!s){const i=this.mode_;if(i==="Circle")s=(r,o,a)=>{const l=o||new Ci([NaN,NaN]),c=(0,E.Ad)(r[0],a),h=(0,V.hG)(c,(0,E.Ad)(r[r.length-1],a));l.setCenterAndRadius(c,Math.sqrt(h),this.geometryLayout_);const d=(0,E.Tf)();return d&&l.transform(a,d),l};else{let r;i==="Point"?r=ne.A:i==="LineString"?r=te.A:i==="Polygon"&&(r=Se.Ay),s=(o,a,l)=>(a?i==="Polygon"?o[0].length?a.setCoordinates([o[0].concat([o[0][0]])],this.geometryLayout_):a.setCoordinates([],this.geometryLayout_):a.setCoordinates(o,this.geometryLayout_):a=new r(o,this.geometryLayout_),a)}}this.geometryFunction_=s,this.dragVertexDelay_=e.dragVertexDelay!==void 0?e.dragVertexDelay:500,this.finishCoordinate_=null,this.sketchFeature_=null,this.sketchPoint_=null,this.sketchCoords_=null,this.sketchLine_=null,this.sketchLineCoords_=null,this.squaredClickTolerance_=e.clickTolerance?e.clickTolerance*e.clickTolerance:36,this.overlay_=new Oe.A({source:new ae({useSpatialIndex:!1,wrapX:e.wrapX?e.wrapX:!1}),style:e.style?e.style:Ar(),updateWhileInteracting:!0}),this.geometryName_=e.geometryName,this.condition_=e.condition?e.condition:Ie.TS,this.freehandCondition_,e.freehand?this.freehandCondition_=Ie.Gk:this.freehandCondition_=e.freehandCondition?e.freehandCondition:Ie.Kg,this.traceCondition_,this.setTrace(e.trace||!1),this.traceState_={active:!1},this.traceSource_=e.traceSource||e.source||null,this.addChangeListener(xr.A.ACTIVE,this.updateState_)}setTrace(e){let t;e?e===!0?t=Ie.Gk:t=e:t=Ie.Zm,this.traceCondition_=t}setMap(e){super.setMap(e),this.updateState_()}getOverlay(){return this.overlay_}handleEvent(e){e.originalEvent.type===At.A.CONTEXTMENU&&e.originalEvent.preventDefault(),this.freehand_=this.mode_!=="Point"&&this.freehandCondition_(e);let t=e.type===ue.A.POINTERMOVE,s=!0;return!this.freehand_&&this.lastDragTime_&&e.type===ue.A.POINTERDRAG&&(Date.now()-this.lastDragTime_>=this.dragVertexDelay_?(this.downPx_=e.pixel,this.shouldHandle_=!this.freehand_,t=!0):this.lastDragTime_=void 0,this.shouldHandle_&&this.downTimeout_!==void 0&&(clearTimeout(this.downTimeout_),this.downTimeout_=void 0)),this.freehand_&&e.type===ue.A.POINTERDRAG&&this.sketchFeature_!==null?(this.addToDrawing_(e.coordinate),s=!1):this.freehand_&&e.type===ue.A.POINTERDOWN?s=!1:t&&this.getPointerCount()<2?(s=e.type===ue.A.POINTERMOVE,s&&this.freehand_?(this.handlePointerMove_(e),this.shouldHandle_&&e.originalEvent.preventDefault()):(e.originalEvent.pointerType==="mouse"||e.type===ue.A.POINTERDRAG&&this.downTimeout_===void 0)&&this.handlePointerMove_(e)):e.type===ue.A.DBLCLICK&&(s=!1),super.handleEvent(e)&&s}handleDownEvent(e){return this.shouldHandle_=!this.freehand_,this.freehand_?(this.downPx_=e.pixel,this.finishCoordinate_||this.startDrawing_(e.coordinate),!0):this.condition_(e)?(this.lastDragTime_=Date.now(),this.downTimeout_=setTimeout(()=>{this.handlePointerMove_(new mr.A(ue.A.POINTERMOVE,e.map,e.originalEvent,!1,e.frameState))},this.dragVertexDelay_),this.downPx_=e.pixel,!0):(this.lastDragTime_=void 0,!1)}deactivateTrace_(){this.traceState_={active:!1}}toggleTraceState_(e){if(!this.traceSource_||!this.traceCondition_(e))return;if(this.traceState_.active){this.deactivateTrace_();return}const t=this.getMap(),s=t.getCoordinateFromPixel([e.pixel[0]-this.snapTolerance_,e.pixel[1]+this.snapTolerance_]),i=t.getCoordinateFromPixel([e.pixel[0]+this.snapTolerance_,e.pixel[1]-this.snapTolerance_]),r=(0,I.Tr)([s,i]),o=this.traceSource_.getFeaturesInExtent(r);if(o.length===0)return;const a=wr(e.coordinate,o);a.length&&(this.traceState_={active:!0,startPx:e.pixel.slice(),targets:a,targetIndex:-1})}addOrRemoveTracedCoordinates_(e,t){const s=e.startIndex<=e.endIndex,i=e.startIndex<=t;s===i?s&&t>e.endIndex||!s&&t<e.endIndex?this.addTracedCoordinates_(e,e.endIndex,t):(s&&t<e.endIndex||!s&&t>e.endIndex)&&this.removeTracedCoordinates_(t,e.endIndex):(this.removeTracedCoordinates_(e.startIndex,e.endIndex),this.addTracedCoordinates_(e,e.startIndex,t))}removeTracedCoordinates_(e,t){if(e===t)return;let s=0;if(e<t){const i=Math.ceil(e);let r=Math.floor(t);r===t&&(r-=1),s=r-i+1}else{const i=Math.floor(e);let r=Math.ceil(t);r===t&&(r+=1),s=i-r+1}s>0&&this.removeLastPoints_(s)}addTracedCoordinates_(e,t,s){if(t===s)return;const i=[];if(t<s){const r=Math.ceil(t);let o=Math.floor(s);o===s&&(o-=1);for(let a=r;a<=o;++a)i.push(lt(e.coordinates,a))}else{const r=Math.floor(t);let o=Math.ceil(s);o===s&&(o+=1);for(let a=r;a>=o;--a)i.push(lt(e.coordinates,a))}i.length&&this.appendCoordinates(i)}updateTrace_(e){const t=this.traceState_;if(!t.active||t.targetIndex===-1&&(0,V.Io)(t.startPx,e.pixel)<this.snapTolerance_)return;const s=Cr(e.coordinate,t,this.getMap(),this.snapTolerance_);if(t.targetIndex!==s.index){if(t.targetIndex!==-1){const l=t.targets[t.targetIndex];this.removeTracedCoordinates_(l.startIndex,l.endIndex)}const a=t.targets[s.index];this.addTracedCoordinates_(a,a.startIndex,s.endIndex)}else{const a=t.targets[t.targetIndex];this.addOrRemoveTracedCoordinates_(a,s.endIndex)}t.targetIndex=s.index;const i=t.targets[t.targetIndex];i.endIndex=s.endIndex;const r=ct(i.coordinates,i.endIndex),o=this.getMap().getPixelFromCoordinate(r);e.coordinate=r,e.pixel=[Math.round(o[0]),Math.round(o[1])]}handleUpEvent(e){let t=!0;if(this.getPointerCount()===0){this.downTimeout_&&(clearTimeout(this.downTimeout_),this.downTimeout_=void 0),this.handlePointerMove_(e);const s=this.traceState_.active;if(this.toggleTraceState_(e),this.shouldHandle_){const i=!this.finishCoordinate_;i&&this.startDrawing_(e.coordinate),!i&&this.freehand_?this.finishDrawing():!this.freehand_&&(!i||this.mode_==="Point")&&(this.atFinish_(e.pixel,s)?this.finishCondition_(e)&&this.finishDrawing():this.addToDrawing_(e.coordinate)),t=!1}else this.freehand_&&this.abortDrawing()}return!t&&this.stopClick_&&e.preventDefault(),t}handlePointerMove_(e){if(this.pointerType_=e.originalEvent.pointerType,this.downPx_&&(!this.freehand_&&this.shouldHandle_||this.freehand_&&!this.shouldHandle_)){const t=this.downPx_,s=e.pixel,i=t[0]-s[0],r=t[1]-s[1],o=i*i+r*r;if(this.shouldHandle_=this.freehand_?o>this.squaredClickTolerance_:o<=this.squaredClickTolerance_,!this.shouldHandle_)return}if(!this.finishCoordinate_){this.createOrUpdateSketchPoint_(e.coordinate.slice());return}this.updateTrace_(e),this.modifyDrawing_(e.coordinate)}atFinish_(e,t){let s=!1;if(this.sketchFeature_){let i=!1,r=[this.finishCoordinate_];const o=this.mode_;if(o==="Point")s=!0;else if(o==="Circle")s=this.sketchCoords_.length===2;else if(o==="LineString")i=!t&&this.sketchCoords_.length>this.minPoints_;else if(o==="Polygon"){const a=this.sketchCoords_;i=a[0].length>this.minPoints_,r=[a[0][0],a[0][a[0].length-2]],t?r=[a[0][0]]:r=[a[0][0],a[0][a[0].length-2]]}if(i){const a=this.getMap();for(let l=0,c=r.length;l<c;l++){const h=r[l],d=a.getPixelFromCoordinate(h),u=e[0]-d[0],g=e[1]-d[1],y=this.freehand_?1:this.snapTolerance_;if(s=Math.sqrt(u*u+g*g)<=y,s){this.finishCoordinate_=h;break}}}}return s}createOrUpdateSketchPoint_(e){this.sketchPoint_?this.sketchPoint_.getGeometry().setCoordinates(e):(this.sketchPoint_=new $.A(new ne.A(e)),this.updateSketchFeatures_())}createOrUpdateCustomSketchLine_(e){this.sketchLine_||(this.sketchLine_=new $.A);const t=e.getLinearRing(0);let s=this.sketchLine_.getGeometry();s?(s.setFlatCoordinates(t.getLayout(),t.getFlatCoordinates()),s.changed()):(s=new te.A(t.getFlatCoordinates(),t.getLayout()),this.sketchLine_.setGeometry(s))}startDrawing_(e){const t=this.getMap().getView().getProjection(),s=(0,Tt.dn)(this.geometryLayout_);for(;e.length<s;)e.push(0);this.finishCoordinate_=e,this.mode_==="Point"?this.sketchCoords_=e.slice():this.mode_==="Polygon"?(this.sketchCoords_=[[e.slice(),e.slice()]],this.sketchLineCoords_=this.sketchCoords_[0]):this.sketchCoords_=[e.slice(),e.slice()],this.sketchLineCoords_&&(this.sketchLine_=new $.A(new te.A(this.sketchLineCoords_)));const i=this.geometryFunction_(this.sketchCoords_,void 0,t);this.sketchFeature_=new $.A,this.geometryName_&&this.sketchFeature_.setGeometryName(this.geometryName_),this.sketchFeature_.setGeometry(i),this.updateSketchFeatures_(),this.dispatchEvent(new Ht(Zt.DRAWSTART,this.sketchFeature_))}modifyDrawing_(e){const t=this.getMap(),s=this.sketchFeature_.getGeometry(),i=t.getView().getProjection(),r=(0,Tt.dn)(this.geometryLayout_);let o,a;for(;e.length<r;)e.push(0);this.mode_==="Point"?a=this.sketchCoords_:this.mode_==="Polygon"?(o=this.sketchCoords_[0],a=o[o.length-1],this.atFinish_(t.getPixelFromCoordinate(e))&&(e=this.finishCoordinate_.slice())):(o=this.sketchCoords_,a=o[o.length-1]),a[0]=e[0],a[1]=e[1],this.geometryFunction_(this.sketchCoords_,s,i),this.sketchPoint_&&this.sketchPoint_.getGeometry().setCoordinates(e),s.getType()==="Polygon"&&this.mode_!=="Polygon"?this.createOrUpdateCustomSketchLine_(s):this.sketchLineCoords_&&this.sketchLine_.getGeometry().setCoordinates(this.sketchLineCoords_),this.updateSketchFeatures_()}addToDrawing_(e){const t=this.sketchFeature_.getGeometry(),s=this.getMap().getView().getProjection();let i,r;const o=this.mode_;return o==="LineString"||o==="Circle"?(this.finishCoordinate_=e.slice(),r=this.sketchCoords_,r.length>=this.maxPoints_&&(this.freehand_?r.pop():i=!0),r.push(e.slice()),this.geometryFunction_(r,t,s)):o==="Polygon"&&(r=this.sketchCoords_[0],r.length>=this.maxPoints_&&(this.freehand_?r.pop():i=!0),r.push(e.slice()),i&&(this.finishCoordinate_=r[0]),this.geometryFunction_(this.sketchCoords_,t,s)),this.createOrUpdateSketchPoint_(e.slice()),this.updateSketchFeatures_(),i?this.finishDrawing():this.sketchFeature_}removeLastPoints_(e){if(!this.sketchFeature_)return;const t=this.sketchFeature_.getGeometry(),s=this.getMap().getView().getProjection(),i=this.mode_;for(let r=0;r<e;++r){let o;if(i==="LineString"||i==="Circle"){if(o=this.sketchCoords_,o.splice(-2,1),o.length>=2){this.finishCoordinate_=o[o.length-2].slice();const a=this.finishCoordinate_.slice();o[o.length-1]=a,this.createOrUpdateSketchPoint_(a)}this.geometryFunction_(o,t,s),t.getType()==="Polygon"&&this.sketchLine_&&this.createOrUpdateCustomSketchLine_(t)}else if(i==="Polygon"){o=this.sketchCoords_[0],o.splice(-2,1);const a=this.sketchLine_.getGeometry();if(o.length>=2){const l=o[o.length-2].slice();o[o.length-1]=l,this.createOrUpdateSketchPoint_(l)}a.setCoordinates(o),this.geometryFunction_(this.sketchCoords_,t,s)}if(o.length===1){this.abortDrawing();break}}this.updateSketchFeatures_()}removeLastPoint(){this.removeLastPoints_(1)}finishDrawing(){const e=this.abortDrawing_();if(!e)return null;let t=this.sketchCoords_;const s=e.getGeometry(),i=this.getMap().getView().getProjection();return this.mode_==="LineString"?(t.pop(),this.geometryFunction_(t,s,i)):this.mode_==="Polygon"&&(t[0].pop(),this.geometryFunction_(t,s,i),t=s.getCoordinates()),this.type_==="MultiPoint"?e.setGeometry(new vr.A([t])):this.type_==="MultiLineString"?e.setGeometry(new $t.A([t])):this.type_==="MultiPolygon"&&e.setGeometry(new at.A([t])),this.dispatchEvent(new Ht(Zt.DRAWEND,e)),this.features_&&this.features_.push(e),this.source_&&this.source_.addFeature(e),e}abortDrawing_(){this.finishCoordinate_=null;const e=this.sketchFeature_;return this.sketchFeature_=null,this.sketchPoint_=null,this.sketchLine_=null,this.overlay_.getSource().clear(!0),this.deactivateTrace_(),e}abortDrawing(){const e=this.abortDrawing_();e&&this.dispatchEvent(new Ht(Zt.DRAWABORT,e))}appendCoordinates(e){const t=this.mode_,s=!this.sketchFeature_;s&&this.startDrawing_(e[0]);let i;if(t==="LineString"||t==="Circle")i=this.sketchCoords_;else if(t==="Polygon")i=this.sketchCoords_&&this.sketchCoords_.length?this.sketchCoords_[0]:[];else return;s&&i.shift(),i.pop();for(let o=0;o<e.length;o++)this.addToDrawing_(e[o]);const r=e[e.length-1];this.sketchFeature_=this.addToDrawing_(r),this.modifyDrawing_(r)}extend(e){const s=e.getGeometry();this.sketchFeature_=e,this.sketchCoords_=s.getCoordinates();const i=this.sketchCoords_[this.sketchCoords_.length-1];this.finishCoordinate_=i.slice(),this.sketchCoords_.push(i.slice()),this.sketchPoint_=new $.A(new ne.A(i)),this.updateSketchFeatures_(),this.dispatchEvent(new Ht(Zt.DRAWSTART,this.sketchFeature_))}updateSketchFeatures_(){const e=[];this.sketchFeature_&&e.push(this.sketchFeature_),this.sketchLine_&&e.push(this.sketchLine_),this.sketchPoint_&&e.push(this.sketchPoint_);const t=this.overlay_.getSource();t.clear(!0),t.addFeatures(e)}updateState_(){const e=this.getMap(),t=this.getActive();(!e||!t)&&this.abortDrawing(),this.overlay_.setMap(t?e:null)}}function Ar(){const n=(0,L.mY)();return function(e,t){return n[e.getGeometry().getType()]}}function il(n,e){return function(t,s,i){const r=fromUserCoordinate(t[0],i),o=fromUserCoordinate(t[t.length-1],i),a=Math.sqrt(squaredCoordinateDistance(r,o));s=s||fromCircle(new Circle(r),n);let l=e;if(!e&&e!==0){const h=o[0]-r[0],d=o[1]-r[1];l=Math.atan2(d,h)}makeRegular(s,r,a,l);const c=getUserProjection();return c&&s.transform(i,c),s}}function nl(){return function(n,e,t){const s=boundingExtent([n[0],n[n.length-1]].map(function(o){return fromUserCoordinate(o,t)})),i=[[getBottomLeft(s),getBottomRight(s),getTopRight(s),getTopLeft(s),getBottomLeft(s)]];e?e.setCoordinates(i):e=new Polygon(i);const r=getUserProjection();return r&&e.transform(t,r),e}}function br(n){switch(n){case"Point":case"MultiPoint":return"Point";case"LineString":case"MultiLineString":return"LineString";case"Polygon":case"MultiPolygon":return"Polygon";case"Circle":return"Circle";default:throw new Error("Invalid type: "+n)}}const Tr=Sr;var bi=m(52490),ht=m(81426),N=m(13628),le=m(86936),Ve=m(27733),G=m(953);class Ti extends Oe.A{constructor(){super({source:new ae}),this.opts={action:"length",unit:"m"},this.segmentStyle=new L.Ay({text:new ht.A({font:"12px Calibri,sans-serif",fill:new N.A({color:"rgba(255, 255, 255, 1)"}),backgroundFill:new N.A({color:"rgba(0, 0, 0, 0.4)"}),padding:[2,2,2,2],textBaseline:"bottom",offsetY:-12}),image:new le.A({radius:6,points:3,angle:Math.PI,displacement:[0,8],fill:new N.A({color:"rgba(0, 0, 0, 0.4)"})})}),this.segmentStyles=[this.segmentStyle],this.shapeStyle=[new L.Ay({fill:new N.A({color:"rgba(255, 255, 255, 0.2)"}),image:new Ve.A({radius:5,stroke:new G.A({color:"rgba(0, 0, 0, 0.7)"}),fill:new N.A({color:"rgba(255, 255, 255, 0.2)"})})}),new L.Ay({stroke:new G.A({color:[0,0,0,1],width:2,lineDash:[4,8],lineDashOffset:6})}),new L.Ay({stroke:new G.A({color:[255,255,255,1],width:2,lineDash:[4,8]})})],this.labelStyle=new L.Ay({text:new ht.A({font:"14px Calibri,sans-serif",fill:new N.A({color:"rgba(255, 255, 255, 1)"}),backgroundFill:new N.A({color:"rgba(0, 0, 0, 0.7)"}),padding:[3,3,3,3],textBaseline:"bottom",offsetY:-15}),image:new le.A({radius:8,points:3,angle:Math.PI,displacement:[0,10],fill:new N.A({color:"rgba(0, 0, 0, 0.7)"})})}),this.tipStyle=new L.Ay({text:new ht.A({font:"12px Calibri,sans-serif",fill:new N.A({color:"rgba(255, 255, 255, 1)"}),backgroundFill:new N.A({color:"rgba(0, 0, 0, 0.4)"}),padding:[2,2,2,2],textAlign:"left",offsetX:15})}),this.modifyStyle=new L.Ay({image:new Ve.A({radius:5,stroke:new G.A({color:"rgba(0, 0, 0, 0.7)"}),fill:new N.A({color:"rgba(0, 0, 0, 0.4)"})}),text:new ht.A({text:"Drag to modify",font:"12px Calibri,sans-serif",fill:new N.A({color:"rgba(255, 255, 255, 1)"}),backgroundFill:new N.A({color:"rgba(0, 0, 0, 0.7)"}),padding:[2,2,2,2],textAlign:"left",offsetX:15})}),this.modify=new gr({source:this.getSource(),style:this.modifyStyle}),this.setStyle(e=>this.styleFunction(e,!1)),this.setVisible(!0)}setOptions(e){this.opts=e,this.getSource()?.refresh()}getMapMeasurement(e){let t=0,s=ee[0];return this.opts.action==="area"?(s=ee[1],t=(0,bi.UG)(e)):t=(0,bi.R3)(e),(0,de.cN)(s.getUnit(this.opts.unit).format(t))}styleFunction(e,t,s,i){const r=[...this.shapeStyle],o=e.getGeometry();if(o){const a=o.getType();let l,c,h;if((!s||s===a)&&(a==="Polygon"&&o instanceof Se.Ay?(l=o.getInteriorPoint(),c=this.getMapMeasurement(o),h=new te.A(o.getCoordinates()[0])):a==="LineString"&&o instanceof te.A&&(l=new ne.A(o.getLastCoordinate()),c=this.getMapMeasurement(o))),t&&h){let d=0;h.forEachSegment((u,g)=>{const y=new te.A([u,g]),p=this.getMapMeasurement(y);this.segmentStyles.length-1<d&&this.segmentStyles.push(this.segmentStyle.clone());const v=new ne.A(y.getCoordinateAt(.5));this.segmentStyles[d].setGeometry(v),this.segmentStyles[d].getText()?.setText(p),r.push(this.segmentStyles[d]),d++})}c&&(this.labelStyle.setGeometry(l),this.labelStyle.getText()?.setText(c),r.push(this.labelStyle)),i&&a==="Point"&&o instanceof ne.A&&!this.modify.getOverlay().getSource()?.getFeatures().length&&(this.tipPoint=o,this.tipStyle.getText()?.setText(i),r.push(this.tipStyle))}return r}addInteraction(e,t,s,i){const r=t,o=" Click to continue "+(r==="Polygon"?"polygon":"line")+` 
 (double-click to end) `,a=" Click to start ";let l=a;this.draw=new Tr({source:this.getSource(),type:r,style:c=>this.styleFunction(c,s,r,l)}),this.draw.on("drawstart",()=>{i&&this.getSource().clear(),this.modify.setActive(!1),l=o}),this.draw.on("drawend",()=>{this.modifyStyle.setGeometry(this.tipPoint),this.modify.setActive(!0),e.once("pointermove",()=>{this.modifyStyle.setGeometry("")}),l=a}),this.modify.setActive(!0),e.addInteraction(this.draw)}}const Er=({map:n,menuActiveState:e})=>{const t=(0,R.useRef)(new Ti),s=_r(Ze.$W.theme2),[i,r]=(0,R.useState)(!0),[o,a]=(0,R.useState)(!1),[l,c]=(0,R.useState)({action:ee[0].value,unit:ee[0].units[0].value}),h=(0,R.useMemo)(()=>{const y=ee.find(v=>v.value===l.action)??ee[0],p=y.getUnit(l.unit);return t.current.setOptions(l),{current:p,options:y.units}},[l]),d=!0,u=!1;function g(){if(a(!o),e(!o),o)n.removeInteraction(t.current.draw),t.current.setVisible(!1);else{i&&(r(!1),t.current.setZIndex(1),n.addLayer(t.current),n.addInteraction(t.current.modify)),t.current.setVisible(!0),n.removeInteraction(t.current.draw);const y=ee.find(p=>p.value===l.action)??ee[0];t.current.addInteraction(n,y.geometry,u,d)}}return(0,f.jsx)("div",{className:`${s.infoWrap} ${o?null:s.infoWrapClosed}`,children:o?(0,f.jsxs)("div",{children:[(0,f.jsxs)("div",{className:s.rowGroup,children:[(0,f.jsx)(nt.z,{value:l.action,options:ee,size:"md",fullWidth:!1,onChange:y=>{n.removeInteraction(t.current.draw);const p=ee.find(S=>S.value===y)??ee[0],v=p.getUnit(l.unit);c({...l,action:p.value,unit:v.value}),t.current.addInteraction(n,p.geometry,u,d)}}),(0,f.jsx)(kt.$n,{"aria-label":(0,x.t)("geomap.measure-overlay.aria-label-close","Close measure tools"),className:s.button,icon:"times",variant:"secondary",size:"sm",onClick:g})]}),(0,f.jsx)(rt.l6,{className:s.unitSelect,value:h.current,options:h.options,isSearchable:!1,onChange:y=>{const p=ee.find(S=>S.value===l.action)??ee[0],v=p.getUnit(y.value)??p.units[0];c({...l,unit:v.value})}})]}):(0,f.jsx)(Ss.K,{className:s.icon,"data-testid":hi.Tp.components.PanelEditor.measureButton,name:"ruler-combined",tooltip:(0,x.t)("geomap.measure-overlay.tooltip-show-measure-tools","Show measure tools"),tooltipPlacement:"left",onClick:g})})},_r=n=>({button:(0,M.css)({marginLeft:"auto"}),icon:(0,M.css)({backgroundColor:n.colors.secondary.main,display:"inline-block",height:"19.25px",margin:"1px",width:"19.25px"}),infoWrap:(0,M.css)({color:`${n.colors.text}`,backgroundColor:n.colors.background.secondary,borderRadius:"4px",padding:"2px"}),infoWrapClosed:(0,M.css)({height:"25.25px",width:"25.25px"}),rowGroup:(0,M.css)({display:"flex",justifyContent:"flex-end"}),unitSelect:(0,M.css)({minWidth:"200px"})});var rl=m(99639);function Fr(n){return(0,Gt.css)({".ol-scale-line":{background:n.colors.border.weak},".ol-scale-line-inner":{border:`1px solid ${n.colors.text.primary}`,borderTop:0,color:n.colors.text.primary},".ol-control":{backgroundColor:n.colors.background.primary},".ol-control:hover":{backgroundColor:n.colors.background.secondary},".ol-control button":{color:n.colors.secondary.text,backgroundColor:n.colors.secondary.main},".ol-control button:hover":{color:n.colors.secondary.text,backgroundColor:n.colors.secondary.shade},".ol-control button:focus":{color:n.colors.secondary.text,backgroundColor:n.colors.secondary.main},".ol-attribution ul":{color:n.colors.text.primary,textShadow:"none"},".ol-attribution:not(.ol-collapsed)":{backgroundColor:n.colors.background.secondary}})}var Q=m(48997),dt=m(35598),Et=m(63425),qt=m(39741),X=m(739),pe=m(87039);function Ir(n){return new $.A(n)}class _t extends ae{constructor(e){super({}),this.location=e}update(e){this.clear(!0);const t=(0,pe.FM)(e,this.location);if(!t.field){this.changed();return}for(let s=0;s<e.length;s++){const i=t.field.values[s];this.addFeatureInternal(Ir({frame:e,rowIndex:s,geometry:i}))}this.changed()}}var es=m(24120),Ei=m(62467),_i=m(76637),Rr=m(79118),Pr=m(20276),Mr=m(30868),Lr=m(68706);function Fi(n){const{layerName:e,styleConfig:t,layer:s}=n,i=(0,Ne.of)(Dr),r=(0,es.A)(s?.__state?.mouseEvents??(0,Ei.of)(void 0)),o=t?.dims?.color?.field,a=(0,R.useMemo)(()=>{if(!o||!r)return;const y=r.getProperties();if(!y.frame)return;const v=y.rowIndex;return o.values[v]},[r,o]);if(!t)return(0,f.jsx)(f.Fragment,{});const{color:l,opacity:c}=t?.base??{},h=t?.config.symbol?.fixed;if(l&&h&&!o)return(0,f.jsxs)("div",{className:i.infoWrap,children:[(0,f.jsx)("div",{className:i.layerName,children:e}),(0,f.jsx)("div",{className:(0,M.cx)(i.layerBody,i.fixedColorContainer),children:(0,f.jsx)(Mr.y,{src:`${window.__grafana_public_path__}build/${h}`,className:i.legendSymbol,title:(0,x.t)("geomap.markers-legend.title-symbol","Symbol"),style:{fill:l,opacity:c}})})]});if(!o)return(0,f.jsx)(f.Fragment,{});const d=(0,_i.Qi)(o);if(d.isContinuous&&d.getColors){const y=d.getColors(Ze.$W.theme2),p=(0,Rr.AP)(o),v=o.display?S=>(0,de.cN)(o.display(S)):S=>`${S}`;return(0,f.jsxs)("div",{className:i.infoWrap,children:[(0,f.jsx)("div",{className:i.layerName,children:e}),(0,f.jsx)("div",{className:(0,M.cx)(i.layerBody,i.colorScaleWrapper),children:(0,f.jsx)(Pr.w,{hoverValue:a,colorPalette:y,min:p.min??0,max:p.max??100,display:v,useStopsPercentage:!1})})]})}const u=o?.config?.thresholds;if(!u||u.steps.length<2)return(0,f.jsx)("div",{});const g=(0,Lr.EI)(o.config,Ze.$W.theme2);return(0,f.jsxs)("div",{className:i.infoWrap,children:[(0,f.jsx)("div",{className:i.layerName,children:e}),(0,f.jsx)("div",{className:(0,M.cx)(i.layerBody,i.legend),children:g.map((y,p)=>(0,f.jsxs)("div",{className:i.legendItem,children:[(0,f.jsx)("i",{style:{background:y.color}}),y.label]},`${p}/${y.label}`))})]})}const Dr=n=>({infoWrap:(0,M.css)({display:"flex",flexDirection:"column",background:n.colors.background.secondary,borderRadius:"1px",padding:n.spacing(1),borderBottom:`2px solid ${n.colors.border.strong}`,minWidth:"150px"}),layerName:(0,M.css)({fontSize:n.typography.body.fontSize}),layerBody:(0,M.css)({paddingLeft:"10px"}),legend:(0,M.css)({lineHeight:"18px",display:"flex",flexDirection:"column",fontSize:n.typography.bodySmall.fontSize,padding:"5px 10px 0",i:{width:"15px",height:"15px",float:"left",marginRight:"8px",opacity:.7,borderRadius:n.shape.radius.circle}}),legendItem:(0,M.css)({whiteSpace:"nowrap"}),fixedColorContainer:(0,M.css)({minWidth:"80px",fontSize:n.typography.bodySmall.fontSize,paddingTop:"5px"}),legendSymbol:(0,M.css)({height:"18px",width:"18px",margin:"auto"}),colorScaleWrapper:(0,M.css)({minWidth:"200px",fontSize:n.typography.bodySmall.fontSize,paddingTop:"10px"})});class Ii extends R.Component{constructor(e){super(e),this.state={subProps:e.initialSubProps}}componentDidMount(){this.sub=this.props.watch.subscribe({next:e=>{this.setState({subProps:e})},complete:()=>{},error:e=>{}})}componentWillUnmount(){this.sub&&this.sub.unsubscribe()}render(){const{subProps:e}=this.state;return(0,f.jsx)(this.props.child,{...e})}}var ye=m(97095),ce=m(18027),re=m(37386),jr=m(79233),zr=m(35427),Ri=m(41654),Ps=m(85053),Pi=m(21253),Br=m(87405),Mi=m(44798),Li=m(68694),Di=m(71820),Gr=m(22001),ts=m(4896),w=m(53497),ji=m(49700),zi=m(63704),ss=m(42954),Bi=m(20012),Nr=(n=>(n.circle="circle",n.square="square",n.triangle="triangle",n.star="star",n.cross="cross",n.x="x",n))(Nr||{});const Me={circle:"img/icons/marker/circle.svg",square:"img/icons/marker/square.svg",triangle:"img/icons/marker/triangle.svg",star:"img/icons/marker/star.svg",cross:"img/icons/marker/cross.svg",x:"img/icons/marker/x-mark.svg"};function ut(n){const e=n.opacity==null?.8:n.opacity;if(e===1)return new N.A({color:n.color});if(e>0){const t=(0,Ce.A)(n.color).setAlpha(e).toRgbString();return new N.A({color:t})}}function Or(n){const e=n.opacity==null?.8:n.opacity;if(e===1)return new G.A({color:n.color,width:n.lineWidth??1});if(e>0){const t=(0,Ce.A)(n.color).setAlpha(e).toRgbString();return new G.A({color:t,width:n.lineWidth??1})}}const Ae=n=>{if(!n.text)return;const e=Be.$.theme2.typography.fontFamily,t={...w.T5.textConfig,...n.textConfig};return new ht.A({text:n.text,fill:new N.A({color:n.color??w.T5.color.fixed}),font:`normal ${t.fontSize}px ${e}`,...t})},Gi=n=>new L.Ay({text:Ae(n)}),Ni=n=>{const e=new G.A({color:n.color,width:n.lineWidth??1}),t=n.size??w._7;return new L.Ay({image:new Ve.A({stroke:e,fill:ut(n),radius:t,displacement:Ue(n.symbolAlign??w.T5.symbolAlign,t)}),text:Ae(n),stroke:e})},Ft=n=>new L.Ay({fill:ut(n),stroke:new G.A({color:n.color,width:n.lineWidth??1}),text:Ae(n)}),Ms=n=>new L.Ay({fill:ut(n),stroke:Or(n),text:Ae(n)}),Oi=n=>{const e=n.size??w._7,t=new G.A({color:"#F00",width:1});return[new L.Ay({image:new le.A({stroke:t,points:4,radius:e,angle:Math.PI/4})}),new L.Ay({image:new le.A({stroke:t,points:4,radius:e,radius2:0,angle:0})})]},kr=[{id:"circle",name:"Circle",aliasIds:[Me.circle],make:Ni},{id:"square",name:"Square",aliasIds:[Me.square],make:n=>{const e=n.size??w._7,t=n.rotation??0;return new L.Ay({image:new le.A({stroke:new G.A({color:n.color,width:n.lineWidth??1}),fill:ut(n),points:4,radius:e,angle:Math.PI/4,rotation:t*Math.PI/180,displacement:Ue(n.symbolAlign??w.T5.symbolAlign,e)}),text:Ae(n)})}},{id:"triangle",name:"Triangle",aliasIds:[Me.triangle],make:n=>{const e=n.size??w._7,t=n.rotation??0;return new L.Ay({image:new le.A({stroke:new G.A({color:n.color,width:n.lineWidth??1}),fill:ut(n),points:3,radius:e,rotation:t*Math.PI/180,angle:0,displacement:Ue(n.symbolAlign??w.T5.symbolAlign,e)}),text:Ae(n)})}},{id:"star",name:"Star",aliasIds:[Me.star],make:n=>{const e=n.size??w._7,t=n.rotation??0;return new L.Ay({image:new le.A({stroke:new G.A({color:n.color,width:n.lineWidth??1}),fill:ut(n),points:5,radius:e,radius2:e*.4,angle:0,rotation:t*Math.PI/180,displacement:Ue(n.symbolAlign??w.T5.symbolAlign,e)}),text:Ae(n)})}},{id:"cross",name:"Cross",aliasIds:[Me.cross],make:n=>{const e=n.size??w._7,t=n.rotation??0;return new L.Ay({image:new le.A({stroke:new G.A({color:n.color,width:n.lineWidth??1}),points:4,radius:e,radius2:0,angle:0,rotation:t*Math.PI/180,displacement:Ue(n.symbolAlign??w.T5.symbolAlign,e)}),text:Ae(n)})}},{id:"x",name:"X",aliasIds:[Me.x],make:n=>{const e=n.size??w._7,t=n.rotation??0;return new L.Ay({image:new le.A({stroke:new G.A({color:n.color,width:n.lineWidth??1}),points:4,radius:e,radius2:0,angle:Math.PI/4,rotation:t*Math.PI/180,displacement:Ue(n.symbolAlign??w.T5.symbolAlign,e)}),text:Ae(n)})}}];async function ki(n,e,t){return fetch(n,{method:"GET"}).then(s=>s.text()).then(s=>{s=zi.sQ.sanitizeSVGContent(s);const r=new DOMParser().parseFromString(s,"image/svg+xml"),o=r.getElementsByTagName("svg")[0];if(!o)return"";const a=e??100,l=o.getAttribute("width")??a,c=o.getAttribute("height")??a;if(o.setAttribute("fill","#fff"),o.setAttribute("width",`${l}px`),o.setAttribute("height",`${c}px`),t){const u=o.getAttribute("viewBox")?.split(" ")??[0,0,l,c],g=Number(u[2])/2,y=Number(u[3])/2,p=r.createElementNS("http://www.w3.org/2000/svg","circle");p.setAttribute("cx",g.toString()),p.setAttribute("cy",y.toString()),p.setAttribute("fill","none"),p.setAttribute("r",(g/2).toString()),p.setAttribute("stroke",`rgba(255,255,255,${t})`),p.setAttribute("stroke-width",g.toString()),o.prepend(p)}const h=new XMLSerializer().serializeToString(o);return`data:image/svg+xml,${encodeURIComponent(h)}`}).catch(s=>(console.error(s),""))}const Ls=new ss.O(()=>kr);function Vr(n){const e=Ls.getIfExists(n);if(e?.aliasIds?.length)return e.aliasIds[0]}const It=["color",["get","red"],["get","green"],["get","blue"],["get","opacity"]],is=["get","size"],Ds=["get","opacity"],Vi=["get","rotation"],js=["array",["get","offsetX"],["get","offsetY"]],Ui={"shape-radius":["/",is,2],"shape-fill-color":It,"shape-stroke-color":It,"shape-stroke-width":1,"shape-opacity":Ds,"shape-rotation":Vi,"shape-displacement":js},Wi={"circle-radius":["/",is,2],"circle-fill-color":It,"circle-stroke-color":It,"circle-stroke-width":1,"circle-opacity":Ds,"circle-displacement":js};async function Ur(n,e){if(n===Me.circle)return Wi;if(n===Me.square)return{...Ui,"shape-points":4,"shape-angle":Math.PI/4};if(n===Me.triangle)return{...Ui,"shape-points":3,"shape-angle":0};if(n&&n.endsWith(".svg")){const t=e===0?0:.1/(e??1);return{"icon-src":await ki((0,Bi.D)(n),void 0,t),"icon-width":is,"icon-height":is,"icon-opacity":Ds,"icon-rotation":Vi,"icon-displacement":js,"icon-color":It}}return Wi}async function Wr(n,e){if(!n)return e?Gi:Ni;let t=Ls.getIfExists(n);if(t)return t.make;if(n.endsWith(".svg")){const s=await ki((0,Bi.D)(n));return t={id:n,name:n,aliasIds:[],make:s?i=>{const r=i.size??w._7,o=i.rotation??0;return[new L.Ay({image:new ji.A({src:s,color:i.color,opacity:i.opacity??1,scale:(w._7+r)/100,rotation:o*Math.PI/180,displacement:Ue(i.symbolAlign??w.T5.symbolAlign,r/2)}),text:i?.text?Ae(i):void 0}),new L.Ay({image:new le.A({fill:new N.A({color:"rgba(0,0,0,0)"}),points:4,radius:r,rotation:o*Math.PI/180+Math.PI/4})})]}:Oi},Ls.register(t),t.make}return Oi}function zs(n){const e=n?.text;return e?!!(e.mode===X.RU.Fixed&&e.fixed?.length||e.mode===X.RU.Field&&e.field?.length):!1}async function Le(n){n||(n=w.T5);const e=zs(n),t={},s=await Wr(n.symbol?.fixed,e),i={config:n,hasText:e,fields:t,base:{color:Be.$.theme2.visualization.getColorByName(n.color?.fixed??w.T5.color.fixed),opacity:n.opacity??w.T5.opacity,lineWidth:n.lineWidth??1,size:n.size?.fixed??w.T5.size.fixed,rotation:n.rotation?.fixed??w.T5.rotation.fixed,symbolAlign:n.symbolAlign??w.T5.symbolAlign},maker:s};return n.color?.field?.length&&(t.color=n.color.field),n.size?.field?.length&&(t.size=n.size.field),n.rotation?.field?.length&&(t.rotation=n.rotation.field),e&&(i.base.text=n.text?.fixed,i.base.textConfig=n.textConfig??w.T5.textConfig,n.text?.field?.length&&(t.text=n.text.field)),Object.keys(t).length||(i.fields=void 0),i}function Ue(n,e){const t=[0,0];return n?.horizontal===w.wq.Left?t[0]=-e:n?.horizontal===w.wq.Right&&(t[0]=e),n?.vertical===w.G4.Top?t[1]=e:n?.vertical===w.G4.Bottom&&(t[1]=-e),t}function Xr(n){return n.startsWith("#")?Yr(n):n.startsWith("rgb")?$r(n):(console.warn(`Unsupported color format: ${n}`),null)}function Yr(n){n=n.slice(1);const e=parseInt(n.slice(0,2),16),t=parseInt(n.slice(2,4),16),s=parseInt(n.slice(4,6),16);return{r:e,g:t,b:s}}function $r(n){const e=n.match(/\d+\.?\d*/g);if(e){if(e.length===3)return{r:parseInt(e[0],10),g:parseInt(e[1],10),b:parseInt(e[2],10)};if(e.length===4)return{r:parseInt(e[0],10),g:parseInt(e[1],10),b:parseInt(e[2],10),a:parseFloat(e[3])};console.warn(`Unsupported color format: ${n}`)}else console.warn(`Unsupported color format: ${n}`);return null}const We=n=>{const{value:e,onChange:t,item:s}=n,i=(0,R.useMemo)(()=>s.settings?.frameMatcher?{...n.context,data:n.context.data.filter(s.settings.frameMatcher)}:n.context,[n.context,s.settings]),r=s.settings,o=j=>{t({...e,size:j})},a=j=>{t({...e,symbol:j})},l=j=>{t({...e,color:j})},c=j=>{t({...e,opacity:j})},h=j=>{t({...e,rotation:j})},d=j=>{t({...e,text:j})},u=j=>{t({...e,textConfig:{...e.textConfig,fontSize:j}})},g=j=>{t({...e,textConfig:{...e.textConfig,offsetX:j}})},y=j=>{t({...e,textConfig:{...e.textConfig,offsetY:j}})},p=j=>{t({...e,textConfig:{...e.textConfig,textAlign:j}})},v=j=>{t({...e,textConfig:{...e.textConfig,textBaseline:j}})},S=j=>{t({...e,symbolAlign:{...e?.symbolAlign,horizontal:j}})},C=j=>{t({...e,symbolAlign:{...e?.symbolAlign,vertical:j}})},F=(0,es.A)(r?.layerInfo??(0,Ei.of)())?.geometryType===w.W_.Point,T=zs(e),b=2e3,_=(0,R.useId)(),P=(0,R.useId)(),O=(0,R.useId)(),H=(0,R.useId)(),U=(0,R.useId)(),z=(0,R.useId)(),B=(0,R.useId)(),k=(0,R.useId)(),W=(0,R.useId)(),he=(0,R.useId)(),ze=(0,R.useId)(),st=(0,R.useId)(),gs=(0,R.useId)(),ai=(0,R.useId)();return r?.simpleFixedValues?(0,f.jsxs)(f.Fragment,{children:[F&&(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)(ye.C,{children:(0,f.jsx)(ce.I,{label:(0,x.t)("geomap.style-editor.label-symbol","Symbol"),children:(0,f.jsx)(Mi.m,{id:_,value:e?.symbol??w.T5.symbol,context:i,onChange:a,item:{settings:{resourceType:"icon",folderName:ts.Iu.Marker,placeholderText:T?(0,x.t)("geomap.style-editor.placeholderText-select-symbol","Select a symbol"):(0,x.t)("geomap.style-editor.placeholderText-select-symbol-or-add-text","Select a symbol or add a text label"),placeholderValue:w.T5.symbol.fixed,showSourceRadio:!1,maxFiles:b}}})})}),(0,f.jsx)(re.D,{label:(0,x.t)("geomap.style-editor.label-rotation-angle","Rotation angle"),children:(0,f.jsx)(Li.A,{id:P,value:e?.rotation??w.T5.rotation,context:i,onChange:h,item:{settings:{min:w.T5.rotation.min,max:w.T5.rotation.max}}})})]}),(0,f.jsx)(ye.C,{children:(0,f.jsx)(ce.I,{label:(0,x.t)("geomap.style-editor.label-color","Color"),labelWidth:10,children:(0,f.jsx)(jr.c,{width:4,children:(0,f.jsx)(zr.sk,{id:O,color:e?.color?.fixed??w.T5.color.fixed,onChange:j=>{l({fixed:j})}})})})}),(0,f.jsx)(ye.C,{children:(0,f.jsx)(ce.I,{label:(0,x.t)("geomap.style-editor.label-opacity","Opacity"),labelWidth:10,grow:!0,children:(0,f.jsx)(Pi.G,{id:H,value:e?.opacity??w.T5.opacity,context:i,onChange:c,item:{settings:{min:0,max:1,step:.1}}})})})]}):(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)(re.D,{label:(0,x.t)("geomap.style-editor.label-size","Size"),children:(0,f.jsx)(Di.g,{id:U,value:e?.size??w.T5.size,context:i,onChange:o,item:{settings:{min:1,max:100}}})}),!r?.hideSymbol&&(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)(re.D,{label:(0,x.t)("geomap.style-editor.label-symbol","Symbol"),children:(0,f.jsx)(Mi.m,{id:z,value:e?.symbol??w.T5.symbol,context:i,onChange:a,item:{settings:{resourceType:ts.zu.Icon,folderName:ts.Iu.Marker,placeholderText:T?(0,x.t)("geomap.style-editor.placeholderText-select-symbol","Select a symbol"):(0,x.t)("geomap.style-editor.placeholderText-select-symbol-or-add-text","Select a symbol or add a text label"),placeholderValue:w.T5.symbol.fixed,showSourceRadio:!1,maxFiles:b}}})}),(0,f.jsx)(re.D,{label:(0,x.t)("geomap.style-editor.label-symbol-vertical-align","Symbol vertical align"),children:(0,f.jsx)(nt.z,{id:B,value:e?.symbolAlign?.vertical??w.T5.symbolAlign.vertical,onChange:C,options:[{value:w.G4.Top,label:(0,x.t)("geomap.style-editor.vertical-align-options.label-top","Top")},{value:w.G4.Center,label:(0,x.t)("geomap.style-editor.vertical-align-options.label-center","Center")},{value:w.G4.Bottom,label:(0,x.t)("geomap.style-editor.vertical-align-options.label-bottom","Bottom")}]})}),(0,f.jsx)(re.D,{label:(0,x.t)("geomap.style-editor.label-symbol-horizontal-align","Symbol horizontal align"),children:(0,f.jsx)(nt.z,{value:e?.symbolAlign?.horizontal??w.T5.symbolAlign.horizontal,onChange:S,options:[{value:w.wq.Left,label:(0,x.t)("geomap.style-editor.horizontal-align-options.label-left","Left")},{value:w.wq.Center,label:(0,x.t)("geomap.style-editor.horizontal-align-options.label-center","Center")},{value:w.wq.Right,label:(0,x.t)("geomap.style-editor.horizontal-align-options.label-right","Right")}]})})]}),(0,f.jsx)(re.D,{label:(0,x.t)("geomap.style-editor.label-color","Color"),children:(0,f.jsx)(Br.N,{id:k,value:e?.color??w.T5.color,context:i,onChange:l,item:{}})}),(0,f.jsx)(re.D,{label:(0,x.t)("geomap.style-editor.label-fill-opacity","Fill opacity"),children:(0,f.jsx)(Pi.G,{id:W,value:e?.opacity??w.T5.opacity,context:i,onChange:c,item:{settings:{min:0,max:1,step:.1}}})}),r?.displayRotation&&(0,f.jsx)(re.D,{label:(0,x.t)("geomap.style-editor.label-rotation-angle","Rotation angle"),children:(0,f.jsx)(Li.A,{id:he,value:e?.rotation??w.T5.rotation,context:i,onChange:h,item:{settings:{min:w.T5.rotation.min,max:w.T5.rotation.max}}})}),(0,f.jsx)(re.D,{label:(0,x.t)("geomap.style-editor.label-text-label","Text label"),children:(0,f.jsx)(Gr.h,{id:ze,value:e?.text??ts.nG,context:i,onChange:d,item:{}})}),T&&(0,f.jsxs)(f.Fragment,{children:[(0,f.jsxs)(Ri.B,{children:[(0,f.jsx)(re.D,{label:(0,x.t)("geomap.style-editor.label-font-size","Font size"),children:(0,f.jsx)(Ps.w,{id:st,value:e?.textConfig?.fontSize??w.T5.textConfig.fontSize,context:i,onChange:u,item:{}})}),(0,f.jsx)(re.D,{label:(0,x.t)("geomap.style-editor.label-x-offset","X offset"),children:(0,f.jsx)(Ps.w,{id:gs,value:e?.textConfig?.offsetX??w.T5.textConfig.offsetX,context:i,onChange:g,item:{}})}),(0,f.jsx)(re.D,{label:(0,x.t)("geomap.style-editor.label-y-offset","Y offset"),children:(0,f.jsx)(Ps.w,{id:ai,value:e?.textConfig?.offsetY??w.T5.textConfig.offsetY,context:i,onChange:y,item:{}})})]}),(0,f.jsx)(re.D,{label:(0,x.t)("geomap.style-editor.label-align","Align"),children:(0,f.jsx)(nt.z,{value:e?.textConfig?.textAlign??w.T5.textConfig.textAlign,onChange:p,options:[{value:w.DY.Left,label:(0,q.capitalize)(w.DY.Left)},{value:w.DY.Center,label:(0,q.capitalize)(w.DY.Center)},{value:w.DY.Right,label:(0,q.capitalize)(w.DY.Right)}]})}),(0,f.jsx)(re.D,{label:(0,x.t)("geomap.style-editor.label-baseline","Baseline"),children:(0,f.jsx)(nt.z,{value:e?.textConfig?.textBaseline??w.T5.textConfig.textBaseline,onChange:v,options:[{value:w.fX.Top,label:(0,q.capitalize)(w.fX.Top)},{value:w.fX.Middle,label:(0,q.capitalize)(w.fX.Middle)},{value:w.fX.Bottom,label:(0,q.capitalize)(w.fX.Bottom)}]})})]})]})};var K=m(46300);const Rt={style:w.T5,showLegend:!0},Bs="markers",Gs={type:Bs,name:"",config:Rt,location:{mode:X.aG.Auto},tooltip:!0},Zr={id:Bs,name:"Markers",description:"Use markers to render each data point",isBaseMap:!1,showLocation:!0,hideOpacity:!0,create:async(n,e,t,s)=>{const i={...Rt,...e?.config},r=await Le(i.style),o=i.style.symbol?.fixed,a=await Ur(o,i.style.opacity),l=zs(i.style),c=await(0,pe.nE)(e.location),h=new _t(c),d=new Et.A({source:h,style:a}),u=new Q.A({source:h,declutter:!0});let g=l;const y=new dt.A({layers:g?o?[d,u]:[u]:[d]}),p=new qt.m(1);let v=null;return i.showLegend&&(v=(0,f.jsx)(Ii,{watch:p,initialSubProps:{},child:Fi})),{init:()=>y,legend:v,update:S=>{if(!S.series?.length){h.clear();return}for(const C of S.series){r.dims=(0,K.ue)(C,r,s),v&&p.next({styleConfig:r,size:r.dims?.size,layerName:e.name,layer:d}),h.update(C);let A=!1;const F=new Set,T=(_,P)=>{const O=`${_[0]},${_[1]}`,{color:H,size:U,text:z,rotation:B}=P;return`markerAddressKey|${O}|${H}|${U}|${z}|${B}`};h.forEachFeature(_=>{const P=_.getGeometry(),O=P?.getType()==="LineString";O&&(A=!0);const H=_.get("rowIndex"),U=r.dims,z={...r.base};if(U?.color&&(z.color=U.color.get(H)),U?.size&&(z.size=U.size.get(H)),U?.text&&(z.text=U.text.get(H)),U?.rotation&&(z.rotation=U.rotation.get(H)),P?.getType()==="Point"){const B=P.getCoordinates();if(!B||B.length<2)return;const k=T(B,z);if(F.has(k))return;F.add(k)}if(O){const B=r.maker(z);_.setStyle(B)}else{const B=(0,Ce.A)(s.visualization.getColorByName(z.color)).toString(),k=Xr(B),W=z.size??w._7,he=Ue(z.symbolAlign??w.T5.symbolAlign,W);_.setProperties({red:k?.r??255}),_.setProperties({green:k?.g??255}),_.setProperties({blue:k?.b??255}),_.setProperties({size:(z.size??1)*2}),_.setProperties({rotation:(z.rotation??0)*Math.PI/180}),_.setProperties({opacity:(z.opacity??1)*(k?.a??1)}),_.setProperties({offsetX:he[0]}),_.setProperties({offsetY:he[1]})}if(l){const B=Gi(z);_.setStyle(B)}}),g=l||A;const b=y.getLayers();b.clear(),g?b.extend(o?[d,u]:[u]):b.extend([d]);break}},registerOptionsUI:S=>{S.addCustomEditor({id:"config.style",path:"config.style",name:(0,x.t)("geomap.markers-layer.name-styles","Styles"),editor:We,settings:{displayRotation:!0},defaultValue:Rt.style}).addBooleanSwitch({path:"config.showLegend",name:(0,x.t)("geomap.markers-layer.name-show-legend","Show legend"),description:(0,x.t)("geomap.markers-layer.description-show-legend","Show map legend"),defaultValue:Rt.showLegend})}}},defaultOptions:Rt};var Ke=m(11594),Ns=m(13504),Xe=m(6782),Qe=m(91110),Hr=m(4350),ns=m(40186),Os=m(57115);const ft=[0,0,0],Ye=5;class Kr{constructor(e){this.minZoom=e.minZoom!==void 0?e.minZoom:0,this.resolutions_=e.resolutions,(0,Re.v)((0,Ut.WC)(this.resolutions_,(i,r)=>r-i,!0),"`resolutions` must be sorted in descending order");let t;if(!e.origins){for(let i=0,r=this.resolutions_.length-1;i<r;++i)if(!t)t=this.resolutions_[i]/this.resolutions_[i+1];else if(this.resolutions_[i]/this.resolutions_[i+1]!==t){t=void 0;break}}this.zoomFactor_=t,this.maxZoom=this.resolutions_.length-1,this.origin_=e.origin!==void 0?e.origin:null,this.origins_=null,e.origins!==void 0&&(this.origins_=e.origins,(0,Re.v)(this.origins_.length==this.resolutions_.length,"Number of `origins` and `resolutions` must be equal"));const s=e.extent;s!==void 0&&!this.origin_&&!this.origins_&&(this.origin_=(0,I.Py)(s)),(0,Re.v)(!this.origin_&&this.origins_||this.origin_&&!this.origins_,"Either `origin` or `origins` must be configured, never both"),this.tileSizes_=null,e.tileSizes!==void 0&&(this.tileSizes_=e.tileSizes,(0,Re.v)(this.tileSizes_.length==this.resolutions_.length,"Number of `tileSizes` and `resolutions` must be equal")),this.tileSize_=e.tileSize!==void 0?e.tileSize:this.tileSizes_?null:Os.R,(0,Re.v)(!this.tileSize_&&this.tileSizes_||this.tileSize_&&!this.tileSizes_,"Either `tileSize` or `tileSizes` must be configured, never both"),this.extent_=s!==void 0?s:null,this.fullTileRanges_=null,this.tmpSize_=[0,0],this.tmpExtent_=[0,0,0,0],e.sizes!==void 0?this.fullTileRanges_=e.sizes.map((i,r)=>{const o=new Qe.A(Math.min(0,i[0]),Math.max(i[0]-1,-1),Math.min(0,i[1]),Math.max(i[1]-1,-1));if(s){const a=this.getTileRangeForExtentAndZ(s,r);o.minX=Math.max(a.minX,o.minX),o.maxX=Math.min(a.maxX,o.maxX),o.minY=Math.max(a.minY,o.minY),o.maxY=Math.min(a.maxY,o.maxY)}return o}):s&&this.calculateTileRanges_(s)}forEachTileCoord(e,t,s){const i=this.getTileRangeForExtentAndZ(e,t);for(let r=i.minX,o=i.maxX;r<=o;++r)for(let a=i.minY,l=i.maxY;a<=l;++a)s([t,r,a])}forEachTileCoordParentTileRange(e,t,s,i){let r,o,a,l=null,c=e[0]-1;for(this.zoomFactor_===2?(o=e[1],a=e[2]):l=this.getTileCoordExtent(e,i);c>=this.minZoom;){if(o!==void 0&&a!==void 0?(o=Math.floor(o/2),a=Math.floor(a/2),r=(0,Qe.N)(o,o,a,a,s)):r=this.getTileRangeForExtentAndZ(l,c,s),t(c,r))return!0;--c}return!1}getExtent(){return this.extent_}getMaxZoom(){return this.maxZoom}getMinZoom(){return this.minZoom}getOrigin(e){return this.origin_?this.origin_:this.origins_[e]}getResolution(e){return this.resolutions_[e]}getResolutions(){return this.resolutions_}getTileCoordChildTileRange(e,t,s){if(e[0]<this.maxZoom){if(this.zoomFactor_===2){const r=e[1]*2,o=e[2]*2;return(0,Qe.N)(r,r+1,o,o+1,t)}const i=this.getTileCoordExtent(e,s||this.tmpExtent_);return this.getTileRangeForExtentAndZ(i,e[0]+1,t)}return null}getTileRangeForTileCoordAndZ(e,t,s){if(t>this.maxZoom||t<this.minZoom)return null;const i=e[0],r=e[1],o=e[2];if(t===i)return(0,Qe.N)(r,o,r,o,s);if(this.zoomFactor_){const l=Math.pow(this.zoomFactor_,t-i),c=Math.floor(r*l),h=Math.floor(o*l);if(t<i)return(0,Qe.N)(c,c,h,h,s);const d=Math.floor(l*(r+1))-1,u=Math.floor(l*(o+1))-1;return(0,Qe.N)(c,d,h,u,s)}const a=this.getTileCoordExtent(e,this.tmpExtent_);return this.getTileRangeForExtentAndZ(a,t,s)}getTileRangeForExtentAndZ(e,t,s){this.getTileCoordForXYAndZ_(e[0],e[3],t,!1,ft);const i=ft[1],r=ft[2];this.getTileCoordForXYAndZ_(e[2],e[1],t,!0,ft);const o=ft[1],a=ft[2];return(0,Qe.N)(i,o,r,a,s)}getTileCoordCenter(e){const t=this.getOrigin(e[0]),s=this.getResolution(e[0]),i=(0,Xe.xq)(this.getTileSize(e[0]),this.tmpSize_);return[t[0]+(e[1]+.5)*i[0]*s,t[1]-(e[2]+.5)*i[1]*s]}getTileCoordExtent(e,t){const s=this.getOrigin(e[0]),i=this.getResolution(e[0]),r=(0,Xe.xq)(this.getTileSize(e[0]),this.tmpSize_),o=s[0]+e[1]*r[0]*i,a=s[1]-(e[2]+1)*r[1]*i,l=o+r[0]*i,c=a+r[1]*i;return(0,I.N)(o,a,l,c,t)}getTileCoordForCoordAndResolution(e,t,s){return this.getTileCoordForXYAndResolution_(e[0],e[1],t,!1,s)}getTileCoordForXYAndResolution_(e,t,s,i,r){const o=this.getZForResolution(s),a=s/this.getResolution(o),l=this.getOrigin(o),c=(0,Xe.xq)(this.getTileSize(o),this.tmpSize_);let h=a*(e-l[0])/s/c[0],d=a*(l[1]-t)/s/c[1];return i?(h=(0,se.mk)(h,Ye)-1,d=(0,se.mk)(d,Ye)-1):(h=(0,se.RI)(h,Ye),d=(0,se.RI)(d,Ye)),(0,ns.N)(o,h,d,r)}getTileCoordForXYAndZ_(e,t,s,i,r){const o=this.getOrigin(s),a=this.getResolution(s),l=(0,Xe.xq)(this.getTileSize(s),this.tmpSize_);let c=(e-o[0])/a/l[0],h=(o[1]-t)/a/l[1];return i?(c=(0,se.mk)(c,Ye)-1,h=(0,se.mk)(h,Ye)-1):(c=(0,se.RI)(c,Ye),h=(0,se.RI)(h,Ye)),(0,ns.N)(s,c,h,r)}getTileCoordForCoordAndZ(e,t,s){return this.getTileCoordForXYAndZ_(e[0],e[1],t,!1,s)}getTileCoordResolution(e){return this.resolutions_[e[0]]}getTileSize(e){return this.tileSize_?this.tileSize_:this.tileSizes_[e]}getFullTileRange(e){return this.fullTileRanges_?this.fullTileRanges_[e]:this.extent_?this.getTileRangeForExtentAndZ(this.extent_,e):null}getZForResolution(e,t){const s=(0,Ut.FT)(this.resolutions_,e,t||0);return(0,se.qE)(s,this.minZoom,this.maxZoom)}tileCoordIntersectsViewport(e,t){return(0,Hr.sj)(t,0,t.length,2,this.getTileCoordExtent(e))}calculateTileRanges_(e){const t=this.resolutions_.length,s=new Array(t);for(let i=this.minZoom;i<t;++i)s[i]=this.getTileRangeForExtentAndZ(e,i);this.fullTileRanges_=s}}const Xi=Kr;function Yi(n){let e=n.getDefaultTileGrid();return e||(e=eo(n),n.setDefaultTileGrid(e)),e}function Qr(n,e,t){const s=e[0],i=n.getTileCoordCenter(e),r=ks(t);if(!(0,I.Ym)(r,i)){const o=(0,I.RG)(r),a=Math.ceil((r[0]-i[0])/o);return i[0]+=o*a,n.getTileCoordForCoordAndZ(i,s)}return e}function Jr(n,e,t,s){s=s!==void 0?s:"top-left";const i=$i(n,e,t);return new Xi({extent:n,origin:(0,I.qF)(n,s),resolutions:i,tileSize:t})}function qr(n){const e=n||{},t=e.extent||(0,E.Jt)("EPSG:3857").getExtent(),s={extent:t,minZoom:e.minZoom,tileSize:e.tileSize,resolutions:$i(t,e.maxZoom,e.tileSize,e.maxResolution)};return new Xi(s)}function $i(n,e,t,s){e=e!==void 0?e:Os.L,t=(0,Xe.xq)(t!==void 0?t:Os.R);const i=(0,I.Oq)(n),r=(0,I.RG)(n);s=s>0?s:Math.max(r/t[0],i/t[1]);const o=e+1,a=new Array(o);for(let l=0;l<o;++l)a[l]=s/Math.pow(2,l);return a}function eo(n,e,t,s){const i=ks(n);return Jr(i,e,t,s)}function ks(n){n=(0,E.Jt)(n);let e=n.getExtent();if(!e){const t=180*E.Ig.degrees/n.getMetersPerUnit();e=(0,I.N)(-t,-t,t,t)}return e}var to=m(40190),Pt=m(11078),so=m(32963);function ol(n,e){const t=[];Object.keys(e).forEach(function(i){e[i]!==null&&e[i]!==void 0&&t.push(i+"="+encodeURIComponent(e[i]))});const s=t.join("&");return n=n.replace(/[?&]$/,""),n+=n.includes("?")?"&":"?",n+s}const io=/\{z\}/g,no=/\{x\}/g,ro=/\{y\}/g,oo=/\{-y\}/g;function ao(n,e,t,s,i){return n.replace(io,e.toString()).replace(no,t.toString()).replace(ro,s.toString()).replace(oo,function(){if(i===void 0)throw new Error("If the URL template has a {-y} placeholder, the grid extent must be known");return(i-s).toString()})}function al(n,e,t,s){const i=hashZXY(e,t,s),r=modulo(i,n.length);return n[r]}function lo(n){const e=[];let t=/\{([a-z])-([a-z])\}/.exec(n);if(t){const s=t[1].charCodeAt(0),i=t[2].charCodeAt(0);let r;for(r=s;r<=i;++r)e.push(n.replace(t[0],String.fromCharCode(r)));return e}if(t=/\{(\d+)-(\d+)\}/.exec(n),t){const s=parseInt(t[2],10);for(let i=parseInt(t[1],10);i<=s;i++)e.push(n.replace(t[0],i.toString()));return e}return e.push(n),e}function co(n,e){return function(t,s,i){if(!t)return;let r;const o=t[0];if(e){const a=e.getFullTileRange(o);a&&(r=a.getHeight()-1)}return ao(n,o,t[1],t[2],r)}}function ho(n,e){const t=n.length,s=new Array(t);for(let i=0;i<t;++i)s[i]=co(n[i],e);return uo(s)}function uo(n){return n.length===1?n[0]:function(e,t,s){if(!e)return;const i=(0,ns.tW)(e),r=(0,se.xP)(i,n.length);return n[r](e,t,s)}}function ll(n,e,t){}class fo extends mi{constructor(e){super({attributions:e.attributions,attributionsCollapsible:e.attributionsCollapsible,projection:e.projection,state:e.state,wrapX:e.wrapX,interpolate:e.interpolate}),this.on,this.once,this.un,this.tilePixelRatio_=e.tilePixelRatio!==void 0?e.tilePixelRatio:1,this.tileGrid=e.tileGrid!==void 0?e.tileGrid:null;const t=[256,256];this.tileGrid&&(0,Xe.xq)(this.tileGrid.getTileSize(this.tileGrid.getMinZoom()),t),this.tmpSize=[0,0],this.key_=e.key||(0,D.v6)(this),this.tileOptions={transition:e.transition,interpolate:e.interpolate},this.zDirection=e.zDirection?e.zDirection:0}getGutterForProjection(e){return 0}getKey(){return this.key_}setKey(e){this.key_!==e&&(this.key_=e,this.changed())}getResolutions(e){const t=e?this.getTileGridForProjection(e):this.tileGrid;return t?t.getResolutions():null}getTile(e,t,s,i,r){return(0,D.b0)()}getTileGrid(){return this.tileGrid}getTileGridForProjection(e){return this.tileGrid?this.tileGrid:Yi(e)}getTilePixelRatio(e){return this.tilePixelRatio_}getTilePixelSize(e,t,s){const i=this.getTileGridForProjection(s),r=this.getTilePixelRatio(t),o=(0,Xe.xq)(i.getTileSize(e),this.tmpSize);return r==1?o:(0,Xe.hs)(o,r,this.tmpSize)}getTileCoordForTileUrlFunction(e,t){const s=t!==void 0?t:this.getProjection(),i=t!==void 0?this.getTileGridForProjection(s):this.tileGrid||this.getTileGridForProjection(s);return this.getWrapX()&&s.isGlobal()&&(e=Qr(i,e,s)),(0,ns.N5)(e,i)?e:null}clear(){}refresh(){this.clear(),super.refresh()}}class go extends Wt.Ay{constructor(e,t){super(e),this.tile=t}}const mo=fo,Vs={TILELOADSTART:"tileloadstart",TILELOADEND:"tileloadend",TILELOADERROR:"tileloaderror"};class Us extends mo{constructor(e){super({attributions:e.attributions,cacheSize:e.cacheSize,projection:e.projection,state:e.state,tileGrid:e.tileGrid,tilePixelRatio:e.tilePixelRatio,wrapX:e.wrapX,transition:e.transition,interpolate:e.interpolate,key:e.key,attributionsCollapsible:e.attributionsCollapsible,zDirection:e.zDirection}),this.generateTileUrlFunction_=this.tileUrlFunction===Us.prototype.tileUrlFunction,this.tileLoadFunction=e.tileLoadFunction,e.tileUrlFunction&&(this.tileUrlFunction=e.tileUrlFunction),this.urls=null,e.urls?this.setUrls(e.urls):e.url&&this.setUrl(e.url),this.tileLoadingKeys_={}}getTileLoadFunction(){return this.tileLoadFunction}getTileUrlFunction(){return Object.getPrototypeOf(this).tileUrlFunction===this.tileUrlFunction?this.tileUrlFunction.bind(this):this.tileUrlFunction}getUrls(){return this.urls}handleTileChange(e){const t=e.target,s=(0,D.v6)(t),i=t.getState();let r;i==Pt.A.LOADING?(this.tileLoadingKeys_[s]=!0,r=Vs.TILELOADSTART):s in this.tileLoadingKeys_&&(delete this.tileLoadingKeys_[s],r=i==Pt.A.ERROR?Vs.TILELOADERROR:i==Pt.A.LOADED?Vs.TILELOADEND:void 0),r!=null&&this.dispatchEvent(new go(r,t))}setTileLoadFunction(e){this.tileLoadFunction=e,this.changed()}setTileUrlFunction(e,t){this.tileUrlFunction=e,typeof t<"u"?this.setKey(t):this.changed()}setUrl(e){const t=lo(e);this.urls=t,this.setUrls(t)}setUrls(e){this.urls=e;const t=e.join(`
`);this.generateTileUrlFunction_?this.setTileUrlFunction(ho(e,this.tileGrid),t):this.setKey(t)}tileUrlFunction(e,t,s){}}const po=Us;class yo extends po{constructor(e){super({attributions:e.attributions,cacheSize:e.cacheSize,projection:e.projection,state:e.state,tileGrid:e.tileGrid,tileLoadFunction:e.tileLoadFunction?e.tileLoadFunction:vo,tilePixelRatio:e.tilePixelRatio,tileUrlFunction:e.tileUrlFunction,url:e.url,urls:e.urls,wrapX:e.wrapX,transition:e.transition,interpolate:e.interpolate!==void 0?e.interpolate:!0,key:e.key,attributionsCollapsible:e.attributionsCollapsible,zDirection:e.zDirection}),this.crossOrigin=e.crossOrigin!==void 0?e.crossOrigin:null,this.tileClass=e.tileClass!==void 0?e.tileClass:to.A,this.tileGridForProjection={},this.reprojectionErrorThreshold_=e.reprojectionErrorThreshold,this.renderReprojectionEdges_=!1}getGutterForProjection(e){return this.getProjection()&&e&&!(0,E.tI)(this.getProjection(),e)?0:this.getGutter()}getGutter(){return 0}getKey(){let e=super.getKey();return this.getInterpolate()||(e+=":disable-interpolation"),e}getTileGridForProjection(e){const t=this.getProjection();if(this.tileGrid&&(!t||(0,E.tI)(t,e)))return this.tileGrid;const s=(0,D.v6)(e);return s in this.tileGridForProjection||(this.tileGridForProjection[s]=Yi(e)),this.tileGridForProjection[s]}createTile_(e,t,s,i,r,o){const a=[e,t,s],l=this.getTileCoordForTileUrlFunction(a,r),c=l?this.tileUrlFunction(l,i,r):void 0,h=new this.tileClass(a,c!==void 0?Pt.A.IDLE:Pt.A.EMPTY,c!==void 0?c:"",this.crossOrigin,this.tileLoadFunction,this.tileOptions);return h.key=o,h.addEventListener(At.A.CHANGE,this.handleTileChange.bind(this)),h}getTile(e,t,s,i,r){const o=this.getProjection();if(!o||!r||(0,E.tI)(o,r))return this.getTileInternal(e,t,s,i,o||r);const a=[e,t,s],l=this.getKey(),c=this.getTileGridForProjection(o),h=this.getTileGridForProjection(r),d=this.getTileCoordForTileUrlFunction(a,r),u=new so.A(o,c,r,h,a,d,this.getTilePixelRatio(i),this.getGutter(),(g,y,p,v)=>this.getTileInternal(g,y,p,v,o),this.reprojectionErrorThreshold_,this.renderReprojectionEdges_,this.tileOptions);return u.key=l,u}getTileInternal(e,t,s,i,r){const o=this.getKey();return this.createTile_(e,t,s,i,r,o)}setRenderReprojectionEdges(e){this.renderReprojectionEdges_!=e&&(this.renderReprojectionEdges_=e,this.changed())}setTileGridForProjection(e,t){const s=(0,E.Jt)(e);if(s){const i=(0,D.v6)(s);i in this.tileGridForProjection||(this.tileGridForProjection[i]=t)}}}function vo(n,e){n.getImage().src=e}const xo=yo;class wo extends xo{constructor(e){e=e||{};const t=e.projection!==void 0?e.projection:"EPSG:3857",s=e.tileGrid!==void 0?e.tileGrid:qr({extent:ks(t),maxResolution:e.maxResolution,maxZoom:e.maxZoom,minZoom:e.minZoom,tileSize:e.tileSize});super({attributions:e.attributions,cacheSize:e.cacheSize,crossOrigin:e.crossOrigin,interpolate:e.interpolate,projection:t,reprojectionErrorThreshold:e.reprojectionErrorThreshold,tileGrid:s,tileLoadFunction:e.tileLoadFunction,tilePixelRatio:e.tilePixelRatio,tileUrlFunction:e.tileUrlFunction,url:e.url,urls:e.urls,wrapX:e.wrapX!==void 0?e.wrapX:!0,transition:e.transition,attributionsCollapsible:e.attributionsCollapsible,zDirection:e.zDirection}),this.gutter_=e.gutter!==void 0?e.gutter:0}getGutter(){return this.gutter_}}const Ws=wo;var Co=(n=>(n.Auto="auto",n.Light="light",n.Dark="dark",n))(Co||{});const rs={theme:"auto",showLabels:!0},Zi={id:"carto",name:"CARTO basemap",description:"Add layer CARTO Raster basemaps",isBaseMap:!0,defaultOptions:rs,create:async(n,e,t,s)=>({init:()=>{const i={...rs,...e.config};let r=i.theme;(!r||r==="auto")&&(r=s.isDark?"dark":"light"),i.showLabels?r+="_all":r+="_nolabels";const o=window.devicePixelRatio>1?"@2x":"",a=e.noRepeat??!1;return new Ns.A({source:new Ws({attributions:'<a href="https://carto.com/attribution/">\xA9CARTO</a> <a href="https://www.openstreetmap.org/copyright">\xA9OpenStreetMap</a> contributors',url:`https://{1-4}.basemaps.cartocdn.com/${r}/{z}/{x}/{y}${o}.png`,wrapX:!a})})},registerOptionsUI:i=>{i.addRadio({path:"config.theme",name:"Theme",settings:{options:[{value:"auto",label:"Auto",description:"Match grafana theme"},{value:"light",label:"Light"},{value:"dark",label:"Dark"}]},defaultValue:rs.theme}).addBooleanSwitch({path:"config.showLabels",name:"Show labels",description:"",defaultValue:rs.showLabels})}})},So=[Zi],Hi="https://services.arcgisonline.com/ArcGIS/rest/services/World_Topo_Map/MapServer",gt={url:Hi+"/tile/{z}/{y}/{x}",attribution:`Tiles \xA9 <a href="${Hi}">ArcGIS</a>`},Ki={id:"xyz",name:"XYZ Tile layer",description:"Add map from a generic tile layer",isBaseMap:!0,create:async(n,e,t,s)=>({init:()=>{const i={...e.config};i.url||(i.url=gt.url,i.attribution=i.attribution??gt.attribution);const r=e.noRepeat??!1;return new Ns.A({source:new Ws({url:i.url,attributions:i.attribution,wrapX:!r}),minZoom:i.minZoom,maxZoom:i.maxZoom})},registerOptionsUI:i=>{i.addTextInput({path:"config.url",name:"URL template",description:"Must include {x}, {y} or {-y}, and {z} placeholders",settings:{placeholder:gt.url}}).addTextInput({path:"config.attribution",name:"Attribution",settings:{placeholder:gt.attribution}})}})},Ao=[Ki],os="custom",Xs="streets",Qi=new ss.O(()=>[{id:Xs,name:"World Street Map",slug:"World_Street_Map"},{id:"world-imagery",name:"World Imagery",slug:"World_Imagery"},{id:"world-physical",name:"World Physical",slug:"World_Physical_Map"},{id:"topo",name:"Topographic",slug:"World_Topo_Map"},{id:"usa-topo",name:"USA Topographic",slug:"USA_Topo_Maps"},{id:"ocean",name:"World Ocean",slug:"Ocean/World_Ocean_Base"},{id:os,name:"Custom MapServer",description:"Use a custom MapServer with pre-cached values",slug:""}]),bo=[{id:"esri-xyz",name:"ArcGIS MapServer",description:"Add layer from an ESRI ArcGIS MapServer",isBaseMap:!0,create:async(n,e,t,s)=>{const i={...e.config},r=Qi.getIfExists(i.server??Xs);if(r.id!==os){const a="https://services.arcgisonline.com/ArcGIS/rest/services/";i.url=`${a}${r.slug}/MapServer/tile/{z}/{y}/{x}`,i.attribution=`Tiles \xA9 <a href="${a}${r.slug}/MapServer">ArcGIS</a>`}const o={...e,config:i};return Ki.create(n,o,t,s).then(a=>(a.registerOptionsUI=l=>{l.addSelect({path:"config.server",name:"Server instance",settings:{options:Qi.selectOptions().options}}).addTextInput({path:"config.url",name:"URL template",description:"Must include {x}, {y} or {-y}, and {z} placeholders",settings:{placeholder:gt.url},showIf:c=>c.config?.server===os}).addTextInput({path:"config.attribution",name:"Attribution",settings:{placeholder:gt.attribution},showIf:c=>c.config?.server===os})},a))},defaultOptions:{server:Xs}}],To='&#169; <a href="https://www.openstreetmap.org/copyright" target="_blank">OpenStreetMap</a> contributors.';class Eo extends Ws{constructor(e){e=e||{};let t;e.attributions!==void 0?t=e.attributions:t=[To];const s=e.crossOrigin!==void 0?e.crossOrigin:"anonymous",i=e.url!==void 0?e.url:"https://tile.openstreetmap.org/{z}/{x}/{y}.png";super({attributions:t,attributionsCollapsible:!1,cacheSize:e.cacheSize,crossOrigin:s,interpolate:e.interpolate,maxZoom:e.maxZoom!==void 0?e.maxZoom:19,reprojectionErrorThreshold:e.reprojectionErrorThreshold,tileLoadFunction:e.tileLoadFunction,transition:e.transition,url:i,wrapX:e.wrapX,zDirection:e.zDirection})}}const _o=Eo,Ys=[...[{id:"osm-standard",name:"Open Street Map",description:"Add map from a collaborative free geographic world database",isBaseMap:!0,create:async(n,e,t)=>({init:()=>{const s=e.noRepeat??!1;return new Ns.A({source:new _o({wrapX:!s})})}})}],...So,...bo,...Ao];var be=class extends ae{constructor(e){e=e||{},e.strategy=fi,super(e),this.setLoader(this._loader),this.set("time",e.time||new Date),this.set("step",e.step||1)}static _sunEclipticPosition(e){var t=Math.PI/180,s=e-2451545,i=280.46+.9856474*s;i%=360;var r=357.528+.9856003*s;r%=360;var o=i+1.915*Math.sin(r*t)+.02*Math.sin(2*r*t),a=1.00014-.01671*Math.cos(r*t)-.0014*Math.cos(2*r*t);return{lambda:o,R:a}}static _eclipticObliquity(e){var t=e-2451545,s=t/36525,i=23.43929111-s*(46.836769/3600-s*(1831e-7/3600+s*(.0020034/3600-s*(576e-9/3600-s*434e-10/3600))));return i}static _sunEquatorialPosition(e,t){var s=180/Math.PI,i=Math.PI/180,r=Math.atan(Math.cos(t*i)*Math.tan(e*i))*s,o=Math.asin(Math.sin(t*i)*Math.sin(e*i))*s,a=Math.floor(e/90)*90,l=Math.floor(r/90)*90;return r=r+(a-l),{alpha:r,delta:o}}static getNightLat(e,t){var s=180/Math.PI,i=Math.PI/180,r=t?new Date(t):new Date,o=r/864e5+24405875e-1,a=(18.697374558+24.06570982441908*(o-2451545))%24,l=be._sunEclipticPosition(o),c=be._eclipticObliquity(o),h=be._sunEquatorialPosition(l.lambda,c),d=a*15+e-h.alpha,u=Math.atan(-Math.cos(d*i)/Math.tan(h.delta*i))*s;return u}_loader(e,t,s){var i=this.getCoordinates(this.get("time")),r=new Se.Ay([i]);r.transform("EPSG:4326",s),this.addFeature(new $.A(r))}setTime(e){this.set("time",e),this.refresh()}getSunPosition(e){var t=e?new Date(e):new Date,s=t/864e5+24405875e-1,i=(18.697374558+24.06570982441908*(s-2451545))%24,r=be._sunEclipticPosition(s),o=be._eclipticObliquity(s),a=be._sunEquatorialPosition(r.lambda,o);return[a.alpha-i*15,a.delta]}getCoordinates(e,t){for(var s=180/Math.PI,i=Math.PI/180,r=e?new Date(e):new Date,o=r/864e5+24405875e-1,a=(18.697374558+24.06570982441908*(o-2451545))%24,l=[],c=be._sunEclipticPosition(o),h=be._eclipticObliquity(o),d=be._sunEquatorialPosition(c.lambda,h),u=this.get("step")||1,g=-180;g<=180;g+=u){var y=g,p=a*15+y-d.alpha,v=Math.atan(-Math.cos(p*i)/Math.tan(d.delta*i))*s;l.push([y,v])}switch(t){case"line":break;case"day":d.delta*=-1;default:{v=d.delta<0?90:-90;for(var S=180;S>=-180;S-=u)l.push([S,v]);l.push(l[0]);break}}if(t==="daynight"){var C=[];l.forEach(function(A){C.push(A.slice())}),C[0][1]=-C[0][1],C[C.length-1][1]=-C[0][1],C[C.length-1][1]=-C[0][1],l=[l,C]}return l}};const Fo=be;var Io=(n=>(n.From="from",n.To="to",n))(Io||{});const Je={show:"to",sun:!1,nightColor:"#a7a6ba4D"},Ji="dayNight",ul={type:Ji,name:"",config:Je,tooltip:!0},Ro={id:Ji,name:"Night / Day",description:"Show day and night regions",isBaseMap:!1,create:async(n,e,t,s)=>{const i={...Je,...e?.config},r=new Fo({}),o=Object.getPrototypeOf(r),a=new Q.A({source:r,style:new L.Ay({fill:new N.A({color:s.visualization.getColorByName(i.nightColor)})})}),l=new Q.A({source:new ae({features:[]}),style:new L.Ay({stroke:new G.A({color:"#607D8B",width:1.5,lineDash:[2,3]})})}),c=new $.A({geometry:new ne.A([])}),h=new Q.A({source:new ae({features:[c]}),style:new L.Ay({image:new Ve.A({radius:13,fill:new N.A({color:"rgb(253,184,19)"})})})}),d=new $.A({geometry:new ne.A([])}),u=new L.Ay({image:new Ve.A({radius:13,stroke:new G.A({color:"rgb(253,184,19)",width:1.5})})}),g=new L.Ay({image:new Ve.A({radius:15,stroke:new G.A({color:"#607D8B",width:1.5,lineDash:[2,3]})})}),y=new Q.A({source:new ae({features:[d]}),style:[g,u]}),p=new dt.A({layers:i.sun?[a,h,y,l]:[a,l]}),v=new Ct.yU;return{init:()=>p,dispose:()=>v.unsubscribe(),update:S=>{const C=new Date(S.timeRange.from.valueOf()),A=new Date(S.timeRange.to.valueOf());let F=new Date,T=[];i.show==="from"?F=C:F=A,r.setTime(F),i.sun&&(T=o.getSunPosition(F),c.getGeometry()?.setCoordinates((0,E.Rb)(T)))},registerOptionsUI:S=>{e.config?.nightColor||(e.config={...Je,...e.config}),S.addRadio({path:"config.show",name:"Show",settings:{options:[{label:"From",value:"from"},{label:"To",value:"to"}]},defaultValue:Je.show}),S.addColorPicker({path:"config.nightColor",name:"Night region color",description:"Pick color of night region",defaultValue:Je.nightColor,settings:[{enableNamedColors:!1}]}),S.addBooleanSwitch({path:"config.sun",name:"Display sun",description:"Show the sun",defaultValue:Je.sun})}}},defaultOptions:Je};var qi=m(11854),en=m(11365),tn=m(57532),sn=m(81160),nn=m(59427),Po=m(53685);const rn=(n,e)=>{const t=e.get(n.property);return(0,Po.c)(t,n.operation,n.value)};function on(n){const e=new Set,t=new Set;n.some((i,r)=>{for(const o in i.getProperties()){if(o==="geometry")continue;t.add(o);const a=i.getGeometry();a&&e.add(a.getType())}return r>10});let s=w.W_.Any;if(e.size===1)switch(e.values().next().value){case"Point":case"MultiPoint":s=w.W_.Point;break;case"Line":case"MultiLine":s=w.W_.Line;break;case"Polygon":s=w.W_.Polygon}return{geometryType:s,propertes:Array.from(t.keys()).map(i=>({label:i,value:i}))}}function Mo(n,e){const t=new Set;for(const i of n){const r=i.get(e);r!=null&&t.add(`${r}`)}const s=Array.from(t);return s.sort(),s}const mt={src:"public/maps/countries.geojson",rules:[],style:w.T5,dataStyle:{}},fl={style:w.T5,check:{property:"",operation:X.zT.EQ,value:""}},gl={type:"dynamic-geojson",name:"Dynamic GeoJSON",config:mt,tooltip:!0},Lo={id:"dynamic-geojson",name:"Dynamic GeoJSON",description:"Style a geojson file based on query results",isBaseMap:!1,state:Ke.pn.alpha,create:async(n,e,t,s)=>{const i={...mt,...e.config},r=new ae({url:i.src,format:new en.A}),o=new qt.m,a=p=>{Do(r,p,i.idField,u)},l=r.on("change",()=>{r.getState()==="ready"&&((0,qi.e)(l),o.next(r.getFeatures()),g&&a(g))}),c=[];if(i.rules){for(const p of i.rules)if(p.style){const v=await Le(p.style);c.push({state:v,rule:p.check})}}const h=await Le(i.style);c.push({state:h});const d=await Le(i.style),u=new Map;let g;const y=new Q.A({source:r,style:p=>{const v=p.getId(),S=v!=null?u.get(String(v)):void 0,C=d.dims;if(S!==void 0&&C)return new L.Ay({fill:new N.A({color:C.color?.get(S)}),stroke:new G.A({color:d.base.color,width:d.base.lineWidth??1})});const A=p.getGeometry()?.getType()==="Point";for(const F of c)if(!(F.rule&&!rn(F.rule,p))){if(F.state.fields){const T={...F.state.base},{text:b}=F.state.fields;return b&&(T.text=`${p.get(b)}`),A?F.state.maker(T):Ft(T)}return A?(F.point||(F.point=F.state.maker(F.state.base)),F.point):(F.poly||(F.poly=Ft(F.state.base)),F.poly)}}});return{init:()=>y,update:p=>{const v=p.series[0];v&&(g=v,a(v),d.dims=(0,K.ue)(v,d,s,i.dataStyle)),y.changed()},registerOptionsUI:p=>{const v=o.pipe((0,tn.$)(),(0,sn.T)(S=>on(S)));p.addSelect({path:"config.src",name:"GeoJSON URL",settings:{options:(0,K.G_)()??[],allowCustomValue:!0},defaultValue:mt.src}).addFieldNamePicker({path:"config.idField",name:"ID Field"}).addCustomEditor({id:"config.dataStyle",path:"config.dataStyle",name:"Data style",editor:We,settings:{displayRotation:!1},defaultValue:mt.dataStyle}).addCustomEditor({id:"config.style",path:"config.style",name:"Default style",description:"The style to apply when no rules above match",editor:We,settings:{simpleFixedValues:!0,layerInfo:v},defaultValue:mt.style})}}},defaultOptions:mt};function Do(n,e,t,s){if(!e||!t)return;const i=(0,nn.UI)(e,t);i&&(s.clear(),i.values.forEach((r,o)=>s.set(String(r),o)),n.forEachFeature(r=>{const o=r.getId();if(o!=null){const a=s.get(String(o));a!==void 0&&(r.set("frame",e),r.set("rowIndex",a))}}))}var jo=m(2863),an=m(18105),Mt=m(19753);function ln(n,e){if(n&&!e){const s={label:`${n}`,value:n};return{options:[s],current:s}}e||(e=[]);let t=e.find(s=>s.value===n);return n&&!t&&(t={label:`${n} (not found)`,value:n},e.push(t)),{options:e,current:t}}const zo=({value:n,onChange:e,item:t,context:s})=>{const i=t.settings;if(!i)throw Error("Settings not found");const{features:r,layerInfo:o}=i,a=(0,es.A)(o),l=(0,es.A)(r),c=(0,R.useMemo)(()=>{const T=n?.check?.property;return T&&l&&n.check?.operation===X.zT.EQ?Mo(l,T).map(b=>{let _;return!isNaN(Number(b))?_={value:Number(b),label:b}:_={value:b,label:b},_}):[]},[l,n]),h=(0,Ne.of)(Bo),d=10,u=(0,R.useCallback)(T=>{e({...n,check:{...n.check,property:T?.value}})},[e,n]),g=(0,R.useCallback)(T=>{e({...n,check:{...n.check,operation:T.value??X.zT.EQ}})},[e,n]),y=(0,R.useCallback)(T=>{e({...n,check:{...n.check,value:T?.value}})},[e,n]),p=(0,R.useCallback)(T=>{e({...n,check:{...n.check,value:T}})},[e,n]),v=(0,R.useCallback)(T=>{e({...n,style:T})},[e,n]),S=(0,R.useCallback)(()=>{e(void 0)},[e]),C=n.check??cn.check,A=ln(C.property,a?.propertes),F=ln(C.value,c);return(0,f.jsxs)("div",{className:h.rule,children:[(0,f.jsxs)(ye.C,{className:h.row,children:[(0,f.jsx)(ce.I,{label:(0,x.t)("geomap.style-rule-editor.label-rule","Rule"),labelWidth:d,grow:!0,children:(0,f.jsx)(rt.l6,{placeholder:(0,x.t)("geomap.style-rule-editor.placeholder-feature-property","Feature property"),value:A.current,options:A.options,onChange:u,"aria-label":(0,x.t)("geomap.style-rule-editor.aria-label-feature-property","Feature property"),isClearable:!0,allowCustomValue:!0})}),(0,f.jsx)(ce.I,{className:h.inline,children:(0,f.jsx)(rt.l6,{value:an.N.find(T=>T.value===C.operation),options:an.N,onChange:g,"aria-label":(0,x.t)("geomap.style-rule-editor.aria-label-comparison-operator","Comparison operator"),width:8})}),(0,f.jsx)(ce.I,{className:h.inline,grow:!0,children:(0,f.jsxs)("div",{className:h.flexRow,children:[(C.operation===X.zT.EQ||C.operation===X.zT.NEQ)&&(0,f.jsx)(rt.l6,{placeholder:(0,x.t)("geomap.style-rule-editor.placeholder-value","value"),value:F.current,options:F.options,onChange:y,"aria-label":(0,x.t)("geomap.style-rule-editor.aria-label-comparison-value","Comparison value"),isClearable:!0,allowCustomValue:!0}),C.operation!==X.zT.EQ&&(0,f.jsx)(Mt.Q,{value:isNaN(Number(C.value))?0:Number(C.value),placeholder:(0,x.t)("geomap.style-rule-editor.placeholder-numeric-value","Numeric value"),onChange:p},`${C.property}/${C.operation}`)]})}),(0,f.jsx)(kt.$n,{size:"md",icon:"trash-alt",onClick:()=>S(),variant:"secondary","aria-label":(0,x.t)("geomap.style-rule-editor.aria-label-delete-style-rule","Delete style rule"),className:h.button})]}),(0,f.jsx)("div",{children:(0,f.jsx)(We,{value:n.style??w.T5,context:s,onChange:v,item:{settings:{simpleFixedValues:!0,layerInfo:o}}})})]})},Bo=n=>({rule:(0,M.css)({marginBottom:n.spacing(1)}),row:(0,M.css)({display:"flex",marginBottom:"4px"}),inline:(0,M.css)({marginBottom:0,marginLeft:"4px"}),button:(0,M.css)({marginLeft:"4px"}),flexRow:(0,M.css)({display:"flex",flexDirection:"row",alignItems:"flex-start"})}),Go=({value:n,onChange:e,context:t,item:s})=>{const i=(0,Ne.$j)(),r=s.settings,o=(0,R.useCallback)(()=>{const{palette:c}=i.visualization,h={fixed:c[Math.floor(Math.random()*c.length)]},d=[...n,{...cn,style:{...w.T5,color:h}}];e(d)},[e,n,i.visualization]),a=(0,R.useCallback)(c=>h=>{const d=[...n];h?d[c]=h:d.splice(c,1),e(d)},[e,n]),l=n&&n.map((c,h)=>{const d={settings:r};return(0,f.jsx)(zo,{value:c,onChange:a(h),context:t,item:d},`${h}-${c.check?.property}`)});return(0,f.jsxs)(f.Fragment,{children:[l,(0,f.jsx)(kt.$n,{size:"sm",icon:"plus",onClick:o,variant:"secondary","aria-label":(0,x.t)("geomap.geomap-style-rules-editor.aria-label-add-geomap-style-rule","Add geomap style rule"),children:"Add style rule"})]})},as={src:"public/maps/countries.geojson",rules:[],style:w.T5},cn={style:w.T5,check:{property:"",operation:X.zT.EQ,value:""}},No={id:"geojson",name:"GeoJSON",description:"Load static data from a geojson file",isBaseMap:!1,create:async(n,e,t,s)=>{const i={...as,...e.config},r=(0,jo.w)().replace(i.src||""),a=r.startsWith("http")?r:`${window.__grafana_public_path__}${r.replace(/^(public\/)/,"")}`,l=new ae({url:a,format:new en.A}),c=new qt.m,h=l.on("change",()=>{l.getState()==="ready"&&((0,qi.e)(h),c.next(l.getFeatures()))}),d=[];if(i.rules){for(const S of i.rules)if(S.style){const C=await Le(S.style);d.push({state:C,rule:S.check})}}const u=await Le(i.style);d.push({state:u});const g=Object.values(w.Sq),y=Object.values(w.yQ),p=Object.values(w.yu),v=new Q.A({source:l,style:S=>{const C=S.getGeometry()?.getType(),A=C==="Point"||C==="MultiPoint",F=C==="Polygon"||C==="MultiPolygon",T=C==="LineString"||C==="MultiLineString";for(const b of d){if(b.rule&&!rn(b.rule,S))continue;if(b.state.fields){const P={...b.state.base},{text:O}=b.state.fields;return O&&(P.text=`${S.get(O)}`),A?b.state.maker(P):Ft(P)}const _=S.getProperties();if(F&&Object.keys(_).some(P=>g.includes(P))){const P={color:_[w.Sq.color]??b.state.base.color,opacity:_[w.Sq.opacity]??b.state.base.opacity,lineWidth:_[w.Sq.lineWidth]??b.state.base.lineWidth};return Ft(P)}else if(T&&Object.keys(_).some(P=>p.includes(P))){const P={color:_[w.yu.color]??b.state.base.color,lineWidth:_[w.yu.lineWidth]??b.state.base.lineWidth};return b.state.maker(P)}else if(A&&Object.keys(_).some(P=>y.includes(P))){const P={color:_[w.yQ.color]??b.state.base.color,size:_[w.yQ.size]??b.state.base.size};return b.state.maker(P)}return A?(b.point||(b.point=b.state.maker(b.state.base)),b.point):(b.poly||(b.poly=Ft(b.state.base)),b.poly)}}});return{init:()=>v,registerOptionsUI:S=>{const C=c.pipe((0,tn.$)(),(0,sn.T)(A=>on(A)));S.addSelect({path:"config.src",name:"GeoJSON URL",settings:{options:(0,K.G_)()??[],allowCustomValue:!0,supportVariables:!0},defaultValue:as.src}).addCustomEditor({id:"config.style",path:"config.style",name:"Default style",description:"The style to apply when no rules above match",editor:We,settings:{simpleFixedValues:!0,layerInfo:C},defaultValue:as.style}).addCustomEditor({id:"config.rules",path:"config.rules",name:"Style rules",description:"Apply styles based on feature properties",editor:Go,settings:{features:c,layerInfo:C},defaultValue:[]})}}},defaultOptions:as};var Oo=m(68711),qe=m(49825),$s=m(25847),ko=m(1486),et=m(34835),hn=m(62703),dn=m(94720),Vo=m(83402);class ls{constructor(){this.globalCounter_=0,this.refToFeature_=new Map,this.uidToRef_=new Map,this.freeGlobalRef_=[],this.polygonBatch={entries:{},geometriesCount:0,verticesCount:0,ringsCount:0},this.pointBatch={entries:{},geometriesCount:0},this.lineStringBatch={entries:{},geometriesCount:0,verticesCount:0}}addFeatures(e,t){for(let s=0;s<e.length;s++)this.addFeature(e[s],t)}addFeature(e,t){let s=e.getGeometry();s&&(t&&(s=s.clone(),s.applyTransform(t)),this.addGeometry_(s,e))}clearFeatureEntryInPointBatch_(e){const t=(0,D.v6)(e),s=this.pointBatch.entries[t];if(s)return this.pointBatch.geometriesCount-=s.flatCoordss.length,delete this.pointBatch.entries[t],s}clearFeatureEntryInLineStringBatch_(e){const t=(0,D.v6)(e),s=this.lineStringBatch.entries[t];if(s)return this.lineStringBatch.verticesCount-=s.verticesCount,this.lineStringBatch.geometriesCount-=s.flatCoordss.length,delete this.lineStringBatch.entries[t],s}clearFeatureEntryInPolygonBatch_(e){const t=(0,D.v6)(e),s=this.polygonBatch.entries[t];if(s)return this.polygonBatch.verticesCount-=s.verticesCount,this.polygonBatch.ringsCount-=s.ringsCount,this.polygonBatch.geometriesCount-=s.flatCoordss.length,delete this.polygonBatch.entries[t],s}addGeometry_(e,t){const s=e.getType();switch(s){case"GeometryCollection":{const i=e.getGeometriesArray();for(const r of i)this.addGeometry_(r,t);break}case"MultiPolygon":{const i=e;this.addCoordinates_(s,i.getFlatCoordinates(),i.getEndss(),t,(0,D.v6)(t),i.getStride());break}case"MultiLineString":{const i=e;this.addCoordinates_(s,i.getFlatCoordinates(),i.getEnds(),t,(0,D.v6)(t),i.getStride());break}case"MultiPoint":{const i=e;this.addCoordinates_(s,i.getFlatCoordinates(),null,t,(0,D.v6)(t),i.getStride());break}case"Polygon":{const i=e;this.addCoordinates_(s,i.getFlatCoordinates(),i.getEnds(),t,(0,D.v6)(t),i.getStride());break}case"Point":{const i=e;this.addCoordinates_(s,i.getFlatCoordinates(),null,t,(0,D.v6)(t),i.getStride());break}case"LineString":case"LinearRing":{const i=e,r=i.getStride();this.addCoordinates_(s,i.getFlatCoordinates(),null,t,(0,D.v6)(t),r,i.getLayout?.());break}default:}}addCoordinates_(e,t,s,i,r,o,a){let l;switch(e){case"MultiPolygon":{const c=s;for(let h=0,d=c.length;h<d;h++){let u=c[h];const g=h>0?c[h-1]:null,y=g?g[g.length-1]:0,p=u[u.length-1];u=y>0?u.map(v=>v-y):u,this.addCoordinates_("Polygon",t.slice(y,p),u,i,r,o,a)}break}case"MultiLineString":{const c=s;for(let h=0,d=c.length;h<d;h++){const u=h>0?c[h-1]:0;this.addCoordinates_("LineString",t.slice(u,c[h]),null,i,r,o,a)}break}case"MultiPoint":for(let c=0,h=t.length;c<h;c+=o)this.addCoordinates_("Point",t.slice(c,c+2),null,i,r,null,null);break;case"Polygon":{const c=s;if(i instanceof He.Ay){const u=(0,Vo.yJ)(t,c);if(u.length>1){this.addCoordinates_("MultiPolygon",t,u,i,r,o,a);return}}this.polygonBatch.entries[r]||(this.polygonBatch.entries[r]=this.addRefToEntry_(r,{feature:i,flatCoordss:[],verticesCount:0,ringsCount:0,ringsVerticesCounts:[]})),l=t.length/o;const h=s.length,d=s.map((u,g,y)=>g>0?(u-y[g-1])/o:u/o);this.polygonBatch.verticesCount+=l,this.polygonBatch.ringsCount+=h,this.polygonBatch.geometriesCount++,this.polygonBatch.entries[r].flatCoordss.push(Uo(t,o)),this.polygonBatch.entries[r].ringsVerticesCounts.push(d),this.polygonBatch.entries[r].verticesCount+=l,this.polygonBatch.entries[r].ringsCount+=h;for(let u=0,g=c.length;u<g;u++){const y=u>0?c[u-1]:0;this.addCoordinates_("LinearRing",t.slice(y,c[u]),null,i,r,o,a)}break}case"Point":this.pointBatch.entries[r]||(this.pointBatch.entries[r]=this.addRefToEntry_(r,{feature:i,flatCoordss:[]})),this.pointBatch.geometriesCount++,this.pointBatch.entries[r].flatCoordss.push(t);break;case"LineString":case"LinearRing":this.lineStringBatch.entries[r]||(this.lineStringBatch.entries[r]=this.addRefToEntry_(r,{feature:i,flatCoordss:[],verticesCount:0})),l=t.length/o,this.lineStringBatch.verticesCount+=l,this.lineStringBatch.geometriesCount++,this.lineStringBatch.entries[r].flatCoordss.push(Wo(t,o,a)),this.lineStringBatch.entries[r].verticesCount+=l;break;default:}}addRefToEntry_(e,t){const s=this.uidToRef_.get(e),i=s||this.freeGlobalRef_.pop()||++this.globalCounter_;return t.ref=i,s||(this.refToFeature_.set(i,t.feature),this.uidToRef_.set(e,i)),t}removeRef_(e,t){if(!e)throw new Error("This feature has no ref: "+t);this.refToFeature_.delete(e),this.uidToRef_.delete(t),this.freeGlobalRef_.push(e)}changeFeature(e,t){if(!this.uidToRef_.get((0,D.v6)(e)))return;this.removeFeature(e);let s=e.getGeometry();s&&(t&&(s=s.clone(),s.applyTransform(t)),this.addGeometry_(s,e))}removeFeature(e){let t=this.clearFeatureEntryInPointBatch_(e);t=this.clearFeatureEntryInPolygonBatch_(e)||t,t=this.clearFeatureEntryInLineStringBatch_(e)||t,t&&this.removeRef_(t.ref,(0,D.v6)(t.feature))}clear(){this.polygonBatch.entries={},this.polygonBatch.geometriesCount=0,this.polygonBatch.verticesCount=0,this.polygonBatch.ringsCount=0,this.lineStringBatch.entries={},this.lineStringBatch.geometriesCount=0,this.lineStringBatch.verticesCount=0,this.pointBatch.entries={},this.pointBatch.geometriesCount=0,this.globalCounter_=0,this.freeGlobalRef_=[],this.refToFeature_.clear(),this.uidToRef_.clear()}getFeatureFromRef(e){return this.refToFeature_.get(e)}isEmpty(){return this.globalCounter_===0}filter(e){const t=new ls;t.globalCounter_=this.globalCounter_,t.uidToRef_=this.uidToRef_,t.refToFeature_=this.refToFeature_;let s=!0;for(const i of this.refToFeature_.values())e(i)&&(t.addFeature(i),s=!1);return s?new ls:t}}function Uo(n,e){return e===2?n:n.filter((t,s)=>s%e<2)}function Wo(n,e,t){return e===3&&t==="XYM"?n:e===4?n.filter((s,i)=>i%e!==2):e===3?n.map((s,i)=>i%e!==2?s:0):new Array(n.length*1.5).fill(0).map((s,i)=>i%3===2?0:n[Math.round(i/1.5)])}const Xo=ls;var un=m(409),oe=m(9703),fn=m(20259),fe=m(9777),cs=m(90130),Yo=m(35339),Zs=m(835),gn=m(3422);function Hs(n,e,t,s){let i=0;for(const r in e){const o=e[r],a=o.callback.call(t,t.feature);let l=a?.[0]??a;l===$s.t7&&console.warn('The "has" operator might return false positives.'),l===void 0?l=$s.t7:l===null&&(l=0),n[s+i++]=l,!(!o.size||o.size===1)&&(n[s+i++]=a[1],!(o.size<3)&&(n[s+i++]=a[2],!(o.size<4)&&(n[s+i++]=a[3])))}return i}function hs(n){return Object.keys(n).reduce((e,t)=>e+(n[t].size||1),0)}function $o(n,e,t,s){const i=(2+hs(t))*n.geometriesCount;(!e||e.length!==i)&&(e=new Float32Array(i));const r=[];let o=0;for(const a in n.entries){const l=n.entries[a];for(let c=0,h=l.flatCoordss.length;c<h;c++)r[0]=l.flatCoordss[c][0],r[1]=l.flatCoordss[c][1],(0,oe.Bb)(s,r),e[o++]=r[0],e[o++]=r[1],o+=Hs(e,t,l,o)}return e}function Zo(n,e,t,s){const i=3*n.verticesCount+(1+hs(t))*n.geometriesCount;(!e||e.length!==i)&&(e=new Float32Array(i));const r=[];let o=0;for(const a in n.entries){const l=n.entries[a];for(let c=0,h=l.flatCoordss.length;c<h;c++){r.length=l.flatCoordss[c].length,(0,Fs.Rc)(l.flatCoordss[c],0,r.length,3,s,r,3),o+=Hs(e,t,l,o),e[o++]=r.length/3;for(let d=0,u=r.length;d<u;d+=3)e[o++]=r[d],e[o++]=r[d+1],e[o++]=r[d+2]}}return e}function Ho(n,e,t,s){const i=2*n.verticesCount+(1+hs(t))*n.geometriesCount+n.ringsCount;(!e||e.length!==i)&&(e=new Float32Array(i));const r=[];let o=0;for(const a in n.entries){const l=n.entries[a];for(let c=0,h=l.flatCoordss.length;c<h;c++){r.length=l.flatCoordss[c].length,(0,Fs.Rc)(l.flatCoordss[c],0,r.length,2,s,r),o+=Hs(e,t,l,o),e[o++]=l.ringsVerticesCounts[c].length;for(let d=0,u=l.ringsVerticesCounts[c].length;d<u;d++)e[o++]=l.ringsVerticesCounts[c][d];for(let d=0,u=r.length;d<u;d+=2)e[o++]=r[d],e[o++]=r[d+1]}}return e}var mn=m(71259);const Ko=[];let Ks;function Qo(){return Ks||(Ks=(0,Yo.v)()),Ks}let Jo=0;const Te={POSITION:"a_position",INDEX:"a_index",SEGMENT_START:"a_segmentStart",SEGMENT_END:"a_segmentEnd",MEASURE_START:"a_measureStart",MEASURE_END:"a_measureEnd",PARAMETERS:"a_parameters",JOIN_ANGLES:"a_joinAngles",DISTANCE:"a_distance"};class qo{constructor(e,t,s,i,r){this.helper_,this.hitDetectionEnabled_=!!i;let o=e;if(!("builder"in e)){const h=e,d=(0,mn.my)(h.style,t,h.filter);o={builder:d.builder,attributes:d.attributes,uniforms:d.uniforms}}this.fillProgram_,this.strokeProgram_,this.symbolProgram_,this.hasFill_=!!o.builder.getFillVertexShader(),this.hasFill_&&(this.fillVertexShader_=o.builder.getFillVertexShader(),this.fillFragmentShader_=o.builder.getFillFragmentShader()),this.hasStroke_=!!o.builder.getStrokeVertexShader(),this.hasStroke_&&(this.strokeVertexShader_=o.builder.getStrokeVertexShader(),this.strokeFragmentShader_=o.builder.getStrokeFragmentShader()),this.hasSymbol_=!!o.builder.getSymbolVertexShader(),this.hasSymbol_&&(this.symbolVertexShader_=o.builder.getSymbolVertexShader(),this.symbolFragmentShader_=o.builder.getSymbolFragmentShader()),this.featureFilter_=null,r&&(this.featureFilter_=this.computeFeatureFilter(r));const l=this.hitDetectionEnabled_?{hitColor:{callback(){return(0,gn.b)(this.ref,Ko)},size:4}}:{};this.customAttributes_=Object.assign({},l,o.attributes),this.uniforms_=o.uniforms;const c=Object.entries(this.customAttributes_).map(([h,d])=>({name:`a_${h}`,size:d.size||1,type:fe.jQ.FLOAT}));this.polygonAttributesDesc_=[{name:Te.POSITION,size:2,type:fe.jQ.FLOAT},...c],this.lineStringAttributesDesc_=[{name:Te.SEGMENT_START,size:2,type:fe.jQ.FLOAT},{name:Te.MEASURE_START,size:1,type:fe.jQ.FLOAT},{name:Te.SEGMENT_END,size:2,type:fe.jQ.FLOAT},{name:Te.MEASURE_END,size:1,type:fe.jQ.FLOAT},{name:Te.JOIN_ANGLES,size:2,type:fe.jQ.FLOAT},{name:Te.DISTANCE,size:1,type:fe.jQ.FLOAT},{name:Te.PARAMETERS,size:1,type:fe.jQ.FLOAT},...c],this.pointAttributesDesc_=[{name:Te.POSITION,size:2,type:fe.jQ.FLOAT},{name:Te.INDEX,size:1,type:fe.jQ.FLOAT},...c],this.setHelper(s)}computeFeatureFilter(e){const t=(0,qe.SR)();let s;try{s=(0,un.n)(e,qe.T8,t)}catch{return null}if(t.mapState||t.variables.size>0)return null;const i=(0,un.A)();return r=>{if(i.properties=r.getPropertiesInternal(),t.featureId){const o=r.getId();o!==void 0?i.featureId=o:i.featureId=null}return i.geometryType=(0,qe.Ye)(r.getGeometry()),s(i)}}async generateBuffers(e,t){let s=e;if(this.featureFilter_&&(s=s.filter(this.featureFilter_),s.isEmpty()))return null;const i=this.generateRenderInstructions_(s,t),[r,o,a]=await Promise.all([this.generateBuffersForType_(i.polygonInstructions,"Polygon",t),this.generateBuffersForType_(i.lineStringInstructions,"LineString",t),this.generateBuffersForType_(i.pointInstructions,"Point",t)]),l=(0,oe.T9)((0,oe.vt)(),t);return{polygonBuffers:r,lineStringBuffers:o,pointBuffers:a,invertVerticesTransform:l}}generateRenderInstructions_(e,t){const s=this.hasFill_?Ho(e.polygonBatch,new Float32Array(0),this.customAttributes_,t):null,i=this.hasStroke_?Zo(e.lineStringBatch,new Float32Array(0),this.customAttributes_,t):null,r=this.hasSymbol_?$o(e.pointBatch,new Float32Array(0),this.customAttributes_,t):null;return{polygonInstructions:s,lineStringInstructions:i,pointInstructions:r}}generateBuffersForType_(e,t,s){if(e===null)return null;const i=Jo++;let r;switch(t){case"Polygon":r=Zs.x.GENERATE_POLYGON_BUFFERS;break;case"LineString":r=Zs.x.GENERATE_LINE_STRING_BUFFERS;break;case"Point":r=Zs.x.GENERATE_POINT_BUFFERS;break;default:}const o={id:i,type:r,renderInstructions:e.buffer,renderInstructionsTransform:s,customAttributesSize:hs(this.customAttributes_)},a=Qo();return a.postMessage(o,[e.buffer]),e=null,new Promise(l=>{const c=h=>{const d=h.data;if(d.id!==i||(a.removeEventListener("message",c),!this.helper_.getGL()))return;const u=new fn.Ay(cs.H7,cs.Be).fromArrayBuffer(d.vertexBuffer),g=new fn.Ay(cs.IP,cs.Be).fromArrayBuffer(d.indexBuffer);this.helper_.flushBufferData(u),this.helper_.flushBufferData(g),l([g,u])};a.addEventListener("message",c)})}render(e,t,s){this.hasFill_&&this.renderInternal_(e.polygonBuffers[0],e.polygonBuffers[1],this.fillProgram_,this.polygonAttributesDesc_,t,s),this.hasStroke_&&this.renderInternal_(e.lineStringBuffers[0],e.lineStringBuffers[1],this.strokeProgram_,this.lineStringAttributesDesc_,t,s),this.hasSymbol_&&this.renderInternal_(e.pointBuffers[0],e.pointBuffers[1],this.symbolProgram_,this.pointAttributesDesc_,t,s)}renderInternal_(e,t,s,i,r,o){const a=e.getSize();a!==0&&(this.helper_.useProgram(s,r),this.helper_.bindBuffer(t),this.helper_.bindBuffer(e),this.helper_.enableAttributes(i),o(),this.helper_.drawElements(0,a))}setHelper(e,t=null){this.helper_=e,this.hasFill_&&(this.fillProgram_=this.helper_.getProgram(this.fillFragmentShader_,this.fillVertexShader_)),this.hasStroke_&&(this.strokeProgram_=this.helper_.getProgram(this.strokeFragmentShader_,this.strokeVertexShader_)),this.hasSymbol_&&(this.symbolProgram_=this.helper_.getProgram(this.symbolFragmentShader_,this.symbolVertexShader_)),this.helper_.addUniforms(this.uniforms_),t&&(t.polygonBuffers&&(this.helper_.flushBufferData(t.polygonBuffers[0]),this.helper_.flushBufferData(t.polygonBuffers[1])),t.lineStringBuffers&&(this.helper_.flushBufferData(t.lineStringBuffers[0]),this.helper_.flushBufferData(t.lineStringBuffers[1])),t.pointBuffers&&(this.helper_.flushBufferData(t.pointBuffers[0]),this.helper_.flushBufferData(t.pointBuffers[1])))}}const ea=qo;var Qs=m(83954),ta=m(89940),sa=m(38111),ia=m(49189);const pt={...fe.M8,RENDER_EXTENT:"u_renderExtent",PATTERN_ORIGIN:"u_patternOrigin",GLOBAL_ALPHA:"u_globalAlpha"};class na extends sa.A{constructor(e,t){const s={[pt.RENDER_EXTENT]:[0,0,0,0],[pt.PATTERN_ORIGIN]:[0,0],[pt.GLOBAL_ALPHA]:1};super(e,{uniforms:s,postProcesses:t.postProcesses}),this.hitDetectionEnabled_=!t.disableHitDetection,this.hitRenderTarget_,this.sourceRevision_=-1,this.previousExtent_=(0,I.S5)(),this.currentTransform_=(0,oe.vt)(),this.tmpCoords_=[0,0],this.tmpTransform_=(0,oe.vt)(),this.tmpMat4_=(0,Qs.vt)(),this.currentFrameStateTransform_=(0,oe.vt)(),this.styleVariables_={},this.styles_=[],this.styleRenderers_=[],this.buffers_=[],this.applyOptions_(t),this.batch_=new Xo,this.initialFeaturesAdded_=!1,this.sourceListenKeys_=null}addInitialFeatures_(e){const t=this.getLayer().getSource(),s=(0,E.Tf)();let i;s&&(i=(0,E.FO)(s,e.viewState.projection)),this.batch_.addFeatures(t.getFeatures(),i),this.sourceListenKeys_=[(0,Pe.KT)(t,Z.A.ADDFEATURE,this.handleSourceFeatureAdded_.bind(this,i)),(0,Pe.KT)(t,Z.A.CHANGEFEATURE,this.handleSourceFeatureChanged_.bind(this,i),this),(0,Pe.KT)(t,Z.A.REMOVEFEATURE,this.handleSourceFeatureDelete_,this),(0,Pe.KT)(t,Z.A.CLEAR,this.handleSourceFeatureClear_,this)]}applyOptions_(e){this.styleVariables_=e.variables,this.styles_=(0,mn.iA)(e.style)}createRenderers_(){this.buffers_=[],this.styleRenderers_=this.styles_.map(e=>new ea(e,this.styleVariables_,this.helper,this.hitDetectionEnabled_,"filter"in e?e.filter:null))}reset(e){this.applyOptions_(e),this.helper&&this.createRenderers_(),super.reset(e)}afterHelperCreated(){this.styleRenderers_.length?this.styleRenderers_.forEach((e,t)=>e.setHelper(this.helper,this.buffers_[t])):this.createRenderers_(),this.hitDetectionEnabled_&&(this.hitRenderTarget_=new ta.A(this.helper))}handleSourceFeatureAdded_(e,t){const s=t.feature;this.batch_.addFeature(s,e)}handleSourceFeatureChanged_(e,t){const s=t.feature;this.batch_.changeFeature(s,e)}handleSourceFeatureDelete_(e){const t=e.feature;this.batch_.removeFeature(t)}handleSourceFeatureClear_(){this.batch_.clear()}applyUniforms_(e){(0,oe.k3)(this.tmpTransform_,this.currentFrameStateTransform_),(0,oe.lw)(this.tmpTransform_,e),this.helper.setUniformMatrixValue(pt.PROJECTION_MATRIX,(0,Qs.Z1)(this.tmpMat4_,this.tmpTransform_)),(0,oe.T9)(this.tmpTransform_,this.tmpTransform_),this.helper.setUniformMatrixValue(pt.SCREEN_TO_WORLD_MATRIX,(0,Qs.Z1)(this.tmpMat4_,this.tmpTransform_)),this.tmpCoords_[0]=0,this.tmpCoords_[1]=0,(0,oe.T9)(this.tmpTransform_,e),(0,oe.Bb)(this.tmpTransform_,this.tmpCoords_),this.helper.setUniformFloatVec2(pt.PATTERN_ORIGIN,this.tmpCoords_)}renderFrame(e){const t=this.helper.getGL();this.preRender(t,e);const[s,i,r]=(0,ia.v)(e,this.getLayer());this.helper.prepareDraw(e),this.renderWorlds(e,!1,s,i,r),this.helper.finalizeDraw(e,this.dispatchPreComposeEvent,this.dispatchPostComposeEvent);const o=this.helper.getCanvas();return this.hitDetectionEnabled_&&(this.renderWorlds(e,!0,s,i,r),this.hitRenderTarget_.clearCachedData()),this.postRender(t,e),o}prepareFrameInternal(e){this.initialFeaturesAdded_||(this.addInitialFeatures_(e),this.initialFeaturesAdded_=!0);const t=this.getLayer(),s=t.getSource(),i=e.viewState,r=!e.viewHints[hn.A.ANIMATING]&&!e.viewHints[hn.A.INTERACTING],o=!(0,I.aI)(this.previousExtent_,e.extent),a=this.sourceRevision_<s.getRevision();if(a&&(this.sourceRevision_=s.getRevision()),r&&(o||a)){const l=i.projection,c=i.resolution,h=t instanceof dn.A?t.getRenderBuffer():0,d=(0,I.r)(e.extent,h*c),u=(0,E.Tf)();u?s.loadFeatures((0,E.JR)(d,u),(0,E.vN)(c,l),u):s.loadFeatures(d,c,l),this.ready=!1;const g=this.helper.makeProjectionTransform(e,(0,oe.vt)()),y=this.styleRenderers_.map((p,v)=>p.generateBuffers(this.batch_,g).then(S=>{this.buffers_[v]&&this.disposeBuffers(this.buffers_[v]),this.buffers_[v]=S}));Promise.all(y).then(()=>{this.ready=!0,this.getLayer().changed()}),this.previousExtent_=e.extent.slice()}return!0}renderWorlds(e,t,s,i,r){let o=s;t&&(this.hitRenderTarget_.setSize([Math.floor(e.size[0]/2),Math.floor(e.size[1]/2)]),this.helper.prepareDrawToRenderTarget(e,this.hitRenderTarget_,!0));do{this.helper.makeProjectionTransform(e,this.currentFrameStateTransform_),(0,oe.Tl)(this.currentFrameStateTransform_,o*r,0);for(let a=0,l=this.styleRenderers_.length;a<l;a++){const c=this.styleRenderers_[a],h=this.buffers_[a];h&&c.render(h,e,()=>{this.applyUniforms_(h.invertVerticesTransform),this.helper.applyHitDetectionUniform(t)})}}while(++o<i)}forEachFeatureAtCoordinate(e,t,s,i,r){if((0,Re.v)(this.hitDetectionEnabled_,"`forEachFeatureAtCoordinate` cannot be used on a WebGL layer if the hit detection logic has been disabled using the `disableHitDetection: true` option."),!this.styleRenderers_.length||!this.hitDetectionEnabled_)return;const o=(0,oe.Bb)(t.coordinateToPixelTransform,e.slice()),a=this.hitRenderTarget_.readPixel(o[0]/2,o[1]/2),l=[a[0]/255,a[1]/255,a[2]/255,a[3]/255],c=(0,gn.L)(l),h=this.batch_.getFeatureFromRef(c);if(h)return i(h,this.getLayer(),null)}disposeBuffers(e){const t=s=>{for(const i of s)i&&this.helper.deleteBuffer(i)};e.pointBuffers&&t(e.pointBuffers),e.lineStringBuffers&&t(e.lineStringBuffers),e.polygonBuffers&&t(e.polygonBuffers)}disposeInternal(){this.buffers_.forEach(e=>{e&&this.disposeBuffers(e)}),this.sourceListenKeys_&&(this.sourceListenKeys_.forEach(function(e){(0,Pe.JH)(e)}),this.sourceListenKeys_=null),super.disposeInternal()}renderDeclutter(){}}const ra=na,De={BLUR:"blur",GRADIENT:"gradient",RADIUS:"radius"},oa=["#00f","#0ff","#0f0","#ff0","#f00"];class aa extends dn.A{constructor(e){e=e||{};const t=Object.assign({},e);delete t.gradient,delete t.radius,delete t.blur,delete t.weight,super(t),this.filter_=e.filter??!0,this.styleVariables_=e.variables||{},this.gradient_=null,this.addChangeListener(De.GRADIENT,this.handleGradientChanged_),this.setGradient(e.gradient?e.gradient:oa),this.setBlur(e.blur!==void 0?e.blur:15),this.setRadius(e.radius!==void 0?e.radius:8);const s=e.weight?e.weight:"weight";this.weight_=s,this.setRenderOrder(null)}getBlur(){return this.get(De.BLUR)}getGradient(){return this.get(De.GRADIENT)}getRadius(){return this.get(De.RADIUS)}handleGradientChanged_(){this.gradient_=la(this.getGradient())}setBlur(e){const t=this.get(De.BLUR);if(this.set(De.BLUR,e),typeof e=="number"&&typeof t=="number"){this.changed();return}this.clearRenderer()}setGradient(e){this.set(De.GRADIENT,e)}setRadius(e){const t=this.get(De.RADIUS);if(this.set(De.RADIUS,e),typeof e=="number"&&typeof t=="number"){this.changed();return}this.clearRenderer()}setFilter(e){this.filter_=e,this.changed(),this.clearRenderer()}setWeight(e){this.weight_=e,this.changed(),this.clearRenderer()}createRenderer(){const e=new ko.N,t=(0,$s.z0)(),s=(0,et.s2)(t,this.filter_,qe.T8);let i=(0,et.s2)(t,this.getRadius(),qe.wl),r=(0,et.s2)(t,this.getBlur(),qe.wl);const o={};typeof this.getBlur()=="number"&&(r="a_blur",o.a_blur=()=>this.getBlur(),e.addUniform("a_blur","float")),typeof this.getRadius()=="number"&&(i="a_radius",o.a_radius=()=>this.getRadius(),e.addUniform("a_radius","float"));const a={};let l=null;if(typeof this.weight_=="string"||typeof this.weight_=="function"){const d=typeof this.weight_=="string"?u=>u.get(this.weight_):this.weight_;a.prop_weight={size:1,callback:u=>{const g=d(u);return g!==void 0?(0,se.qE)(g,0,1):1}},l="a_prop_weight",e.addAttribute("a_prop_weight","float")}else{const d=["clamp",this.weight_,0,1];l=(0,et.s2)(t,d,qe.wl)}e.addFragmentShaderFunction(`float getBlurSlope() {
  float blur = max(1., ${r});
  float radius = ${i};
  return radius / blur;
}`).setSymbolSizeExpression(`vec2(${i} + ${r}) * 2.`).setSymbolColorExpression(`vec4(smoothstep(0., 1., (1. - length(coordsPx * 2. / v_quadSizePx)) * getBlurSlope()) * ${l})`).setStrokeColorExpression(`vec4(smoothstep(0., 1., (1. - length(currentRadiusPx * 2. / v_width)) * getBlurSlope()) * ${l})`).setStrokeWidthExpression(`(${i} + ${r}) * 2.`).setFillColorExpression(`vec4(${l})`).setFragmentDiscardExpression(`!${s}`),(0,et.mf)(e,t);const c=(0,et.mh)(t),h=(0,et.kc)(t,this.styleVariables_);return new ra(this,{className:this.getClassName(),variables:this.styleVariables_,style:{builder:e,attributes:{...c,...a},uniforms:{...h,...o}},disableHitDetection:!1,postProcesses:[{fragmentShader:`
            precision mediump float;

            uniform sampler2D u_image;
            uniform sampler2D u_gradientTexture;
            uniform float u_opacity;

            varying vec2 v_texCoord;

            void main() {
              vec4 color = texture2D(u_image, v_texCoord);
              gl_FragColor.a = color.a * u_opacity;
              gl_FragColor.rgb = texture2D(u_gradientTexture, vec2(0.5, color.a)).rgb;
              gl_FragColor.rgb *= gl_FragColor.a;
            }`,uniforms:{u_gradientTexture:()=>this.gradient_,u_opacity:()=>this.getOpacity()}}]})}updateStyleVariables(e){Object.assign(this.styleVariables_,e),this.changed()}renderDeclutter(){}}function la(n){const s=(0,Oo.Y)(1,256),i=s.createLinearGradient(0,0,1,256),r=1/(n.length-1);for(let o=0,a=n.length;o<a;++o)i.addColorStop(o*r,n[o]);return s.fillStyle=i,s.fillRect(0,0,1,256),s.canvas}const ca=aa;var ha=m(88011);const ds={weight:{fixed:1,min:0,max:1},blur:15,radius:5},da={id:"heatmap",name:"Heatmap",description:"Visualizes a heatmap of the data",isBaseMap:!1,showLocation:!0,create:async(n,e,t,s)=>{const i={...ds,...e.config},r=await(0,pe.nE)(e.location),o=new _t(r),a="_weight",l=new ca({source:o,blur:i.blur,radius:i.radius,weight:c=>c.get(a)});return{init:()=>l,update:c=>{const h=c.series[0];if(!h)return;o.update(h);const d=(0,ha.hX)(h,i.weight);o.forEachFeature(y=>{const p=y.get("rowIndex");p!=null&&y.set(a,d.get(p))});let u=["#00f","#0ff","#0f0","#ff0","#f00"];const g=d.field??h.fields.find(y=>y.type===St.PU.number);if(g){const y=(0,_i.Qi)(g);y.isContinuous&&y.getColors&&(u=y.getColors(s))}l.setGradient(u)},registerOptionsUI:c=>{c.addCustomEditor({id:"config.weight",path:"config.weight",name:"Weight values",description:"Scale the distribution for each row",editor:Di.g,settings:{min:0,max:1,hideRange:!0},defaultValue:{fixed:1,min:0,max:1}}).addSliderInput({path:"config.radius",description:"Configures the size of clusters",name:"Radius",defaultValue:ds.radius,settings:{min:1,max:50,step:1}}).addSliderInput({path:"config.blur",description:"Configures the amount of blur of clusters",name:"Blur",defaultValue:ds.blur,settings:{min:1,max:50,step:1}})}}},defaultOptions:ds},pn={icon:"https://openlayers.org/en/latest/examples/data/icon.png"},ua={id:"last-point-tracker",name:"Icon at last point",description:"Show an icon at the last point",isBaseMap:!1,showLocation:!0,state:Ke.pn.alpha,create:async(n,e,t,s)=>{const i=new $.A({}),r={...pn,...e.config};i.setStyle(new L.Ay({image:new ji.A({src:r.icon})}));const o=new ae({features:[i]}),a=new Oe.A({source:o}),l=await(0,pe.nE)(e.location);return{init:()=>a,update:c=>{const h=c.series[0];if(h&&h.length){const d=(0,pe.FM)(h,l);if(!d.field)return;i.setGeometry(d.field.values[h.length-1])}}}},defaultOptions:pn};var yt=m(89352),ge=function(n,e){var t=n[0]-e[0],s=n[1]-e[1];return Math.sqrt(t*t+s*s)},Js=function(n,e){return n[0]==e[0]&&n[1]==e[1]},ml=function(n){return fa(n.getGeometry())},fa=function(n){switch(n.getType()){case"Point":return n.getCoordinates();case"MultiPolygon":n=n.getPolygon(0);case"Polygon":return n.getInteriorPoint().getCoordinates();default:return n.getClosestPoint(ol_extent_getCenter(n.getExtent()))}},pl=function(n,e){var t=[],s=n.length-1,i=s,r,o,a,l,c,h,d,u,g,y,p,v,S,C=Js(n[0],n[s]);C||(p=n[0],v=n[1],S=[p[0]+(v[1]-p[1])/ge(p,v)*e,p[1]-(v[0]-p[0])/ge(p,v)*e],t.push(S),n.push(n[s]),s++,i--);for(var A=0;A<i;A++)p=n[A],v=n[(A+1)%s],S=n[(A+2)%s],r=(v[1]-p[1])/(v[0]-p[0]),o=(S[1]-v[1])/(S[0]-v[0]),Math.abs(r-o)>1e-10&&(a=Math.sqrt((v[0]-p[0])*(v[0]-p[0])+(v[1]-p[1])*(v[1]-p[1])),l=Math.sqrt((S[0]-v[0])*(S[0]-v[0])+(S[1]-v[1])*(S[1]-v[1])),c=p[0]+e*(v[1]-p[1])/a,h=v[0]+e*(S[1]-v[1])/l,d=p[1]-e*(v[0]-p[0])/a,u=v[1]-e*(S[0]-v[0])/l,g=(o*h-r*c+d-u)/(o-r),y=(r*o*(h-c)+o*d-r*u)/(o-r),v[0]-p[0]==0&&(g=v[0]+e*(v[1]-p[1])/Math.abs(v[1]-p[1]),y=o*g-o*h+u),S[0]-v[0]==0&&(g=S[0]+e*(S[1]-v[1])/Math.abs(S[1]-v[1]),y=r*g-r*c+d),t.push([g,y]));return C?t.push(t[0]):(n.pop(),p=n[n.length-1],v=n[n.length-2],S=[p[0]-(v[1]-p[1])/ge(p,v)*e,p[1]+(v[0]-p[0])/ge(p,v)*e],t.push(S)),t},yl=function(n,e){for(var t=0;t<e.length-1;t++){var s=e[t],i=e[t+1];if(Js(n,s)||Js(n,i))return{index:1,segment:[s,i]};var r=ge(s,i),o=[(i[0]-s[0])/r,(i[1]-s[1])/r],a=ge(s,n),l=[(n[0]-s[0])/a,(n[1]-s[1])/a];if(Math.abs(o[0]*l[1]-o[1]*l[0])<1e-10)return{index:1,segment:[s,i]}}return{index:-1}},vl=function(n,e,t){for(var s,i,r=[],o=0;o<n.length-1;o++)!n[o].length||!n[o+1].length||(n[o][1]<=e&&n[o+1][1]>e||n[o][1]>=e&&n[o+1][1]<e)&&(i=(e-n[o][1])/(n[o+1][1]-n[o][1]),s=i*(n[o+1][0]-n[o][0])+n[o][0],r.push({contour:t,index:o,pt:[s,e],abs:i}));r.sort(function(c,h){return c.pt[0]-h.pt[0]});for(var a=[],l=0;l<r.length-1;l+=2)a.push([r[l],r[l+1]]);return a},xl=function(n,e){switch(n){case"LineString":return new ol_geom_LineString(e);case"LinearRing":return new ol_geom_LinearRing(e);case"MultiLineString":return new ol_geom_MultiLineString(e);case"MultiPoint":return new ol_geom_MultiPoint(e);case"MultiPolygon":return new ol_geom_MultiPolygon(e);case"Point":return new ol_geom_Point(e);case"Polygon":return new ol_geom_Polygon(e);default:return console.error("[createFromType] Unsupported type: "+n),null}},wl=function(n,e){var t=n[1][0]-n[0][0],s=n[1][1]-n[0][1],i=e[1][0]-e[0][0],r=e[1][1]-e[0][1],o=t*r-s*i;if(o!=0){var a=(t*n[0][1]-t*e[0][1]-s*n[0][0]+s*e[0][0])/o;return[e[0][0]+a*i,e[0][1]+a*r]}else return!1},yn;(function(){function n(t,s){var i;for(let r=t.length-1;r>0;r--)(t[r][0]>s&&t[r-1][0]<s||t[r][0]<s&&t[r-1][0]>s)&&(i=[s,(s-t[r][0])/(t[r-1][0]-t[r][0])*(t[r-1][1]-t[r][1])+t[r][1]],t.splice(r,0,i))}function e(t,s){var i;for(let r=t.length-1;r>0;r--)(t[r][1]>s&&t[r-1][1]<s||t[r][1]<s&&t[r-1][1]>s)&&(i=[(s-t[r][1])/(t[r-1][1]-t[r][1])*(t[r-1][0]-t[r][0])+t[r][0],s],t.splice(r,0,i))}yn=function(t,s){var i=s.getType()==="Polygon";if(!i&&s.getType()!=="MultiPolygon")return null;var r=s.getCoordinates();return i&&(r=[r]),r.forEach(function(o){o.forEach(function(a){n(a,t[0]),n(a,t[2]),e(a,t[1]),e(a,t[3])})}),r.forEach(function(o){o.forEach(function(a){a.forEach(function(l){l[0]<t[0]?l[0]=t[0]:l[0]>t[2]&&(l[0]=t[2]),l[1]<t[1]?l[1]=t[1]:l[1]>t[3]&&(l[1]=t[3])})})}),i?new Se.Ay(r[0]):new at.A(r)}})();var us=function(n,e,t,s){var i=[];s!==!1&&i.push(n);var r=ge(n,e);if(r){var o=Math.round(r/t);if(o>1)for(var a=(e[0]-n[0])/o,l=(e[1]-n[1])/o,c=1;c<o;c++)i.push([n[0]+a*c,n[1]+l*c])}return i.push(e),i};te.A.prototype.sampleAt=function(n){for(var e=this.getCoordinates(),t=[],s=1;s<e.length;s++)t=t.concat(us(e[s-1],e[s],n,s===1));return new te.A(t)},$t.A.prototype.sampleAt=function(n){var e=this.getCoordinates(),t=[];return e.forEach(function(s){for(var i=[],r=1;r<s.length;r++)i=i.concat(us(s[r-1],s[r],n,r===1));t.push(i)}),new $t.A(t)},Se.Ay.prototype.sampleAt=function(n){var e=this.getCoordinates(),t=[];return e.forEach(function(s){for(var i=[],r=1;r<s.length;r++)i=i.concat(us(s[r-1],s[r],n,r===1));t.push(i)}),new Se.Ay(t)},at.A.prototype.sampleAt=function(n){var e=this.getCoordinates(),t=[];return e.forEach(function(s){var i=[];t.push(i),s.forEach(function(r){for(var o=[],a=1;a<r.length;a++)o=o.concat(us(r[a-1],r[a],n,a===1));i.push(o)})}),new at.A(t)},Ci.prototype.intersection=function(n,e){if(n.sampleAt){var t=(0,I.r)(this.getCenter().concat(this.getCenter()),this.getRadius());n=yn(t,n),n=n.simplify(e);var s=this.getCenter(),i=this.getRadius(),r=n.sampleAt(e).getCoordinates();switch(n.getType()){case"Polygon":r=[r];case"MultiPolygon":{var o=!1,a=[];return r.forEach(function(l){var c=[];a.push(c),l.forEach(function(h){var d=[];c.push(d),h.forEach(function(u){var g=ge(s,u);g>i?(o=!0,d.push([s[0]+i/g*(u[0]-s[0]),s[1]+i/g*(u[1]-s[1])])):d.push(u)})})}),o?n.getType()==="Polygon"?new Se.Ay(a[0]):new at.A(a):n}}}else console.warn("[ol/geom/Circle~intersection] Unsupported geometry type: "+n.getType());return n};var ga=class extends L.Ay{constructor(e){e=e||{},super({stroke:e.stroke,text:e.text,zIndex:e.zIndex,geometry:e.geometry}),this.setRenderer(this._render.bind(this)),this._visible=e.visible!==!1,typeof e.width=="function"?this._widthFn=e.width:this.setWidth(e.width),this.setWidth2(e.width2),typeof e.color=="function"?this._colorFn=e.color:this.setColor(e.color),this.setColor2(e.color2),this.setLineCap(e.lineCap),this.setArrow(e.arrow),this.setArrowSize(e.arrowSize),this.setArrowColor(e.arrowColor),this._offset=[0,0],this.setOffset(e.offset0,0),this.setOffset(e.offset1,1),this._noOverlap=e.noOverlap}setWidth(e){this._width=e||0}setWidth2(e){this._width2=e}getOffset(e){return this._offset[e]}setOffset(e,t){switch(e=Math.max(0,parseFloat(e)),t){case 0:{this._offset[0]=e;break}case 1:{this._offset[1]=e;break}}}setLineCap(e){this._lineCap=e==="round"?"round":"butt"}getWidth(e,t){if(this._widthFn)return this._widthFn(e,t);var s=typeof this._width2=="number"?this._width2:this._width;return this._width+(s-this._width)*t}setColor(e){try{this._color=(0,yt._j)(e)}catch{this._color=[0,0,0,1]}}setColor2(e){try{this._color2=(0,yt._j)(e)}catch{this._color2=null}}setArrowColor(e){try{this._acolor=(0,yt.oJ)(e)}catch{this._acolor=null}}getColor(e,t){if(this._colorFn)return(0,yt.oJ)(this._colorFn(e,t));var s=this._color,i=this._color2||this._color;return"rgba("+ +Math.round(s[0]+(i[0]-s[0])*t)+","+Math.round(s[1]+(i[1]-s[1])*t)+","+Math.round(s[2]+(i[2]-s[2])*t)+","+(s[3]+(i[3]-s[3])*t)+")"}getArrow(){return this._arrow}setArrow(e){this._arrow=parseInt(e),(this._arrow<-1||this._arrow>2)&&(this._arrow=0)}getArrowSize(){return this._arrowSize||[16,16]}setArrowSize(e){Array.isArray(e)?this._arrowSize=e:typeof e=="number"&&(this._arrowSize=[e,e])}drawArrow(e,t,s,i,r){var o=this.getArrowSize()[0]*r,a=ge(t,s),l=(t[0]-s[0])/a,c=(t[1]-s[1])/a;i=Math.max(this.getArrowSize()[1]/2,i/2)*r,e.beginPath(),e.moveTo(t[0],t[1]),e.lineTo(t[0]-o*l+i*c,t[1]-o*c-i*l),e.lineTo(t[0]-o*l-i*c,t[1]-o*c+i*l),e.lineTo(t[0],t[1]),e.fill()}_render(e,t){if(t.geometry.getType()==="LineString"){var s,i,r,o=t.context;if(!this._visible){var a=t.pixelRatio/t.resolution,l=Math.cos(t.rotation),c=Math.sin(t.rotation);i=t.geometry.getCoordinates();var h=e[0][0]-i[0][0]*a*l-i[0][1]*a*c,d=e[0][1]-i[0][0]*a*c+i[0][1]*a*l;for(e=[],s=0;r=i[s];s++)e[s]=[h+r[0]*a*l+r[1]*a*c,d+r[0]*a*c-r[1]*a*l,r[2]]}var u=this.getArrowSize()[0]*t.pixelRatio;o.save(),this.getOffset(0)&&this._splitAsize(e,this.getOffset(0)*t.pixelRatio),this.getOffset(1)&&this._splitAsize(e,this.getOffset(1)*t.pixelRatio,!0),e.length>1&&(this.getArrow()===-1||this.getArrow()===2)&&(r=this._splitAsize(e,u),this._acolor?o.fillStyle=this._acolor:o.fillStyle=this.getColor(t.feature,0),this.drawArrow(o,r[0],r[1],this.getWidth(t.feature,0),t.pixelRatio)),e.length>1&&this.getArrow()>0&&(r=this._splitAsize(e,u,!0),this._acolor?o.fillStyle=this._acolor:o.fillStyle=this.getColor(t.feature,1),this.drawArrow(o,r[0],r[1],this.getWidth(t.feature,1),t.pixelRatio));var g=this._splitInto(e,255,2),y=0,p=g.length;if(o.lineJoin="round",o.lineCap=this._lineCap||"butt",g.length>1)for(y=0;y<g.length;y++){var v=y/p;for(i=g[y],o.lineWidth=this.getWidth(t.feature,v)*t.pixelRatio,o.strokeStyle=this.getColor(t.feature,v),o.beginPath(),o.moveTo(i[0][0],i[0][1]),s=1;r=i[s];s++)o.lineTo(r[0],r[1]);o.stroke()}o.restore()}}_splitAsize(e,t,s){var i,r,o,a,l=0;for(s?o=e.pop():o=e.shift(),i=o;e.length;){if(s?r=e.pop():r=e.shift(),a=ge(i,r),l+a>t){i=[i[0]+(r[0]-i[0])*(t-l)/a,i[1]+(r[1]-i[1])*(t-l)/a],a=ge(i,o),s?(e.push(r),e.push(i),e.push([i[0]+(o[0]-i[0])/a,i[1]+(o[1]-i[1])/a])):(e.unshift(r),e.unshift(i),e.unshift([i[0]+(o[0]-i[0])/a,i[1]+(o[1]-i[1])/a]));break}l+=a,i=r}return[o,i]}_splitInto(e,t,s){var i,r,o=this._noOverlap?1:.9,a=[],l,c=0;for(i=1;r=e[i];i++)c+=ge(e[i-1],r);var h=Math.max(s||2,c/(t||255)),d=e[0];c=0;var u=[d];for(i=1,r=e[1];i<e.length;){var g=r[0]-d[0],y=r[1]-d[1];if(l=Math.sqrt(g*g+y*y),c+l>h){var p=(h-c)/l;u.push([d[0]+g*p,d[1]+y*p]),a.push(u),d=[d[0]+g*p*o,d[1]+y*p*o],u=[d],c=0}else c+=l,d=r,u.push(d),i++,r=e[i]}return a.push(u),a}};const vn=ga;var xn=m(34072);const tt={style:w.T5,showLegend:!1,edgeStyle:w.T5,arrow:0},wn="network",Cl={type:wn,name:"",config:tt,location:{mode:X.aG.Auto}},ma={id:wn,name:"Network",description:"Render a node graph as a map layer",isBaseMap:!1,showLocation:!0,hideOpacity:!0,state:Ke.pn.beta,create:async(n,e,t,s)=>{const i={...tt,...e?.config},r=await Le(i.style),o=await Le(i.edgeStyle),a=await(0,pe.nE)(e.location),l=new _t(a),c=new Q.A({source:l}),h=i.arrow===1||i.arrow===-1||i.arrow===2,d=new qt.m(1);let u=null;return i.showLegend&&(u=(0,f.jsx)(Ii,{watch:d,initialSubProps:{},child:Fi})),c.setStyle(g=>{const y=g.getGeometry(),p=g.get("rowIndex"),v=r.dims;if(!r.fields&&!o.fields&&!h&&y?.getType()!=="LineString")return r.maker(r.base);if(y?.getType()==="LineString"&&y instanceof Tt.Ay){const C=o.dims,A=o.config.textConfig,F=Number(g.getId()),T=y.getCoordinates(),b=o.config.opacity??1;if(T&&C){const _=T[0],P=T[1],O=(0,Ce.A)(s.visualization.getColorByName((C.color&&C.color.get(F))??o.base.color)).setAlpha(b).toString(),H=(0,Ce.A)(s.visualization.getColorByName((C.color&&C.color.get(F))??o.base.color)).setAlpha(b).toString(),U=(C.size&&C.size.get(F))??o.base.size,z=(C.size&&C.size.get(F))??o.base.size,B=[],k=new vn({visible:!0,lineCap:i.arrow===0?"round":"square",color:O,color2:H,width:(C.size&&C.size.get(F))??o.base.size,width2:(C.size&&C.size.get(F))??o.base.size});i.arrow&&(k.setArrow(i.arrow),i.arrow>0?(k.setArrowColor(H),k.setArrowSize((z??0)*2)):(k.setArrowColor(O),k.setArrowSize((U??0)*2)));const W=new te.A([_,P]);k.setGeometry(W);const he=s.typography.fontFamily;if(C.text||o.config.text?.mode===X.RU.Fixed){const ze=new L.Ay({zIndex:10,text:new ht.A({text:C.text?.get(F)??o.config.text?.fixed,font:`normal ${A?.fontSize}px ${he}`,fill:new N.A({color:O??w.T5.color.fixed}),stroke:new G.A({color:(0,Ce.A)(s.visualization.getColorByName("text")).setAlpha(b).toString(),width:Math.max(A?.fontSize/10,1)}),...A})});ze.setGeometry(W),B.push(ze)}return B.push(k),B}}if(!v||!(0,q.isNumber)(p))return r.maker(r.base);const S={...r.base};return v.color&&(S.color=v.color.get(p)),v.size&&(S.size=v.size.get(p)),v.text&&(S.text=v.text.get(p)),v.rotation&&(S.rotation=v.rotation.get(p)),r.maker(S)}),{init:()=>c,legend:u,update:g=>{if(!g.series?.length){l.clear();return}u&&d.next({styleConfig:r,size:r.dims?.size,layerName:e.name,layer:c});const y=(0,xn.CP)(g.series);for(const p of g.series)p===y.edges[0]?o.dims=(0,K.ue)(p,o,s):r.dims=(0,K.ue)(p,r,s),pa(l,y)},registerOptionsUI:(g,y)=>{const p=(0,xn.CP)(y.data),v=p.nodes[0],S=p.edges[0];g.addCustomEditor({id:"config.style",category:["Node Styles"],path:"config.style",name:"Node Styles",editor:We,settings:{displayRotation:!0,frameMatcher:C=>C===v},defaultValue:tt.style}).addCustomEditor({id:"config.edgeStyle",category:["Edge Styles"],path:"config.edgeStyle",name:"Edge Styles",editor:We,settings:{hideSymbol:!0,frameMatcher:C=>C===S},defaultValue:tt.style}).addRadio({path:"config.arrow",name:"Arrow",settings:{options:[{label:"None",value:0},{label:"Forward",value:1},{label:"Reverse",value:-1},{label:"Both",value:2}]},defaultValue:tt.arrow}).addBooleanSwitch({path:"config.showLegend",name:"Show legend",description:"Show map legend",defaultValue:tt.showLegend})}}},defaultOptions:tt};function pa(n,e){n.clear(!0);const t=e.nodes[0],s=e.edges[0];if(!t||!s)return;const i=(0,pe.FM)(t,n.location);if(!i.field){n.changed();return}const r=i.field,o=t.fields.findIndex(u=>u.name==="id"),a=t.fields[o].values,l=s.fields.findIndex(u=>u.name==="source"),c=s.fields.findIndex(u=>u.name==="target"),h=s.fields[l].values,d=s.fields[c].values;for(let u=0;u<h.length;u++){const g=h[u],y=d[u],p=a.findIndex(A=>A===g),v=a.findIndex(A=>A===y);if(!r.values[p]||!r.values[v])continue;const S=new te.A([r.values[p].getCoordinates(),r.values[v].getCoordinates()]),C=new $.A({geometry:S});C.setId(u),n.addFeatureInternal(C)}for(let u=0;u<t.length;u++)n.addFeatureInternal(new $.A({frameNodes:t,rowIndex:u,geometry:i.field.values[u]}));n.changed()}var Cn=class extends le.A{constructor(e){e=e||{},e.displacement||(e.displacement=[e.offsetX||0,-e.offsetY||0]);var t=e.kind==="anchored"?8:0,s=Number(e.shadow)||0;e.stroke||(e.stroke=new G.A({width:0,color:"#000"}));var i=e.stroke.getWidth();if(i<0&&(i=0),e.kind=="folio"&&(i+=6),e.stroke.setWidth(i),super({radius:e.radius+i+t/2+s/2,points:0,displacement:[e.displacement[0]||0,(e.displacement[1]||0)+t],fill:le.A.prototype.render?new N.A({color:[0,0,0,0]}):null,declutterMode:e.declutterMode}),this.sanchor_=t,this._shadow=s,!this.getHitDetectionImage){var r=super.getImage.call(this);if(!this.hitDetectionCanvas_){for(var o in this)if(this[o]&&this[o].getContext&&this[o]!==r){this.hitDetectionCanvas_=this[o];break}}this.hitDetectionCanvas_=document.createElement("canvas"),this.hitDetectionCanvas_.width=r.width,this.hitDetectionCanvas_.height=r.height;var a=this.hitDetectionCanvas_;this.getHitDetectionImage=function(){return a}}this._stroke=e.stroke,this._fill=e.fill,this._crop=e.crop,this._crossOrigin=e.crossOrigin,this._kind=e.kind||"default",this._radius=e.radius,this._src=e.src,this._offset=[e.offsetX?e.offsetX:0,e.offsetY?e.offsetY:0],this._onload=e.onload,this._onerror=e.onerror,typeof e.opacity=="number"&&this.setOpacity(e.opacity),typeof e.rotation=="number"&&this.setRotation(e.rotation),this.render(),this.getImage()}setOffset(e){this._offset=[e[0]||0,e[1]||0],this.render(),this.getImage()}clone(){var e=new Cn({stroke:this._stroke,fill:this._fill,shadow:this._shadow,crop:this._crop,crossOrigin:this._crossOrigin,kind:this._kind,radius:this._radius,src:this._src,offsetX:this._offset[0],offsetY:this._offset[1],opacity:this.getOpacity(),rotation:this.getRotation(),declutterMode:this.getDeclutterMode?this.getDeclutterMode():null});return e.render(),e.getImage(),e}drawBack_(e,t,s,i){var r=this._shadow,o=e.canvas;e.beginPath(),e.fillStyle=t,e.clearRect(0,0,o.width,o.height);var a=o.width/i,l=o.height/i;switch(this._kind){case"square":{e.rect(0,0,a-r,l-r);break}case"circle":{e.arc(this._radius+s,this._radius+s,this._radius+s,0,2*Math.PI,!1);break}case"folio":{var c=6;s-=c,e.strokeStyle="rgba(0,0,0,0.5)",e.lineWidth=1;var h=a-r-2*c,d=Math.atan(6/h);e.save(),e.rotate(-d),e.translate(-6,2),e.beginPath(),e.rect(c,c,h,h),e.stroke(),e.fill(),e.restore(),e.save(),e.translate(6,-1),e.rotate(d),e.beginPath(),e.rect(c,c,h,h),e.stroke(),e.fill(),e.restore(),e.beginPath(),e.rect(c,c,h,h),e.stroke();break}case"anchored":{e.roundRect(this.sanchor_/2,0,a-this.sanchor_-r,l-this.sanchor_-r,s),e.moveTo(a/2-this.sanchor_-r/2,l-this.sanchor_-r),e.lineTo(a/2+this.sanchor_-r/2,l-this.sanchor_-r),e.lineTo(a/2-r/2,l-r);break}default:{e.roundRect(0,0,a-r,l-r,s);break}}e.closePath()}createRenderOptions(){var e=super.createRenderOptions();return e.photoOptions=["photo",this._crossOrigin,this._crop,this._src,this._shadow,this._kind].join("-"),e}getImage(e){e=e||window.devicePixelRatio;var t=super.getImage(e);if((this._gethit||this.img_)&&this._currentRatio===e)return t;this._currentRatio=e;var s,i=0;this._stroke&&(s=(0,yt.oJ)(this._stroke.getColor()),i=this._stroke.getWidth()),this._gethit=!0;var r=this.getHitDetectionImage().getContext("2d");r.save(),r.setTransform(1,0,0,1,0,0),this.drawBack_(r,"#000",i,1),r.fill(),r.restore(),this._gethit=!1,r=t.getContext("2d"),r.save(),r.setTransform(e,0,0,e,0,0),this.drawBack_(r,s,i,e),this._shadow&&(r.shadowColor="rgba(0,0,0,0.5)",r.shadowBlur=e*this._shadow/2,r.shadowOffsetX=e*this._shadow/2,r.shadowOffsetY=e*this._shadow/2),r.fill(),r.restore();var o=this,a=this.img_=new Image;if(this._crossOrigin&&(a.crossOrigin=this._crossOrigin),a.src=this._src,a.width?o.drawImage_(t,a,e):(a.onload=function(){o.drawImage_(t,a,e),o._onload&&o._onload()},o._onerror&&(a.onerror=function(){o._onerror()})),!this.getDisplacement){var l=this.getAnchor();l[0]=(t.width/e-this._shadow)/2-this._offset[0],this.sanchor_?l[1]=t.height/e-this._shadow-this._offset[1]:l[1]=(t.height/e-this._shadow)/2-this._offset[1]}return t}getPhoto(){return this.img_}drawImage_(e,t,s){var i=e.getContext("2d"),r=0;this._stroke&&(r=this._stroke.getWidth());var o=2*this._radius;i.save(),le.A.prototype.render&&i.setTransform(s,0,0,s,0,0),this._kind=="circle"&&(i.beginPath(),i.arc(this._radius+r,this._radius+r,this._radius,0,2*Math.PI,!1),i.clip());var a,l,c,h,d,u,g,y,p;this._crop?(a=Math.min(t.width/o,t.height/o),y=p=a*o,u=(t.width-y)/2,g=(t.height-p)/2,l=c=0,h=d=o+1):(a=Math.min(o/t.width,o/t.height),u=g=0,y=t.width,p=t.height,h=a*y,d=a*p,l=(o-h)/2,c=(o-d)/2),l+=r+this.sanchor_/2,c+=r,i.drawImage(t,u,g,y,p,l,c,h,d),this._kind=="circle"&&r&&(i.beginPath(),i.strokeStyle=(0,yt.oJ)(this._stroke.getColor()),i.lineWidth=r/4,i.arc(this._radius+r,this._radius+r,this._radius,0,2*Math.PI,!1),i.stroke()),i.restore()}};CanvasRenderingContext2D.prototype.roundRect=function(n,e,t,s,i){return i?(t<2*i&&(i=t/2),s<2*i&&(i=s/2),this.beginPath(),this.moveTo(n+i,e),this.arcTo(n+t,e,n+t,e+s,i),this.arcTo(n+t,e+s,n,e+s,i),this.arcTo(n,e+s,n,e,i),this.arcTo(n,e,n+t,e,i),this.closePath()):this.rect(n,e,t,s),this};const qs=Cn,je={kind:"square",border:2,shadow:!0,crop:!0,radius:20,color:"rgb(200, 200, 200)"},Sn="photos",Sl={type:Sn,name:"",config:je,location:{mode:X.aG.Auto},tooltip:!0},ei="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAyNCAyNCIgd2lkdGg9IjI0IiBoZWlnaHQ9IjI0IiBjbGFzcz0iY3NzLWV5eDRkbyI+PHBhdGggZD0iTTExLjI5LDE1LjI5YTEuNTgsMS41OCwwLDAsMC0uMTIuMTUuNzYuNzYsMCwwLDAtLjA5LjE4LjY0LjY0LDAsMCwwLS4wNi4xOCwxLjM2LDEuMzYsMCwwLDAsMCwuMi44NC44NCwwLDAsMCwuMDguMzguOS45LDAsMCwwLC41NC41NC45NC45NCwwLDAsMCwuNzYsMCwuOS45LDAsMCwwLC41NC0uNTRBMSwxLDAsMCwwLDEzLDE2YTEsMSwwLDAsMC0uMjktLjcxQTEsMSwwLDAsMCwxMS4yOSwxNS4yOVpNMTIsMkExMCwxMCwwLDEsMCwyMiwxMiwxMCwxMCwwLDAsMCwxMiwyWm0wLDE4YTgsOCwwLDEsMSw4LThBOCw4LDAsMCwxLDEyLDIwWk0xMiw3QTMsMywwLDAsMCw5LjQsOC41YTEsMSwwLDEsMCwxLjczLDFBMSwxLDAsMCwxLDEyLDlhMSwxLDAsMCwxLDAsMiwxLDEsMCwwLDAtMSwxdjFhMSwxLDAsMCwwLDIsMHYtLjE4QTMsMywwLDAsMCwxMiw3WiI+PC9wYXRoPjwvc3ZnPgo=",ya="data:image/svg+xml;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mNk+M9QDwADhgGAWjR9awAAAABJRU5ErkJggg==";let Lt=[];const va={id:Sn,name:"Photos",description:"Render photos at each data point",isBaseMap:!1,showLocation:!0,hideOpacity:!0,state:Ke.pn.beta,create:async(n,e,t,s)=>{const i={...je,...e?.config},r=await(0,pe.nE)(e.location),o=new _t(r),a=new Q.A({source:o});let l=[];return a.setStyle(c=>{let h=ei,d=1/0;l.length>0&&(d=c.get("rowIndex"),h=l[d]??ei);const u=new L.Ay({image:new qs({src:h,radius:i.radius,crop:i.crop,kind:i.kind,shadow:0,stroke:new G.A({width:0,color:"rgba(0,0,0,0)"}),onload:()=>{a.changed(),Lt&&!Lt.includes(d)&&Lt.push(d)}})}),g=new L.Ay({image:new qs({src:ya,radius:i.radius,crop:!1,kind:i.kind,shadow:i.shadow?2:0,stroke:new G.A({width:i.border??0,color:s.visualization.getColorByName(i.color)}),onload:()=>{a.changed()}})}),y=new L.Ay({image:new qs({src:ei,radius:i.radius,crop:!1,kind:i.kind,shadow:0,stroke:new G.A({width:0,color:"rgba(0,0,0,0)"}),onload:()=>{a.changed()}})});return Lt&&Lt.includes(d)?[g,u]:[g,y,u]}),{init:()=>a,update:c=>{if(!c.series?.length){o.clear();return}for(const h of c.series){if(o.update(h),i.src){const d=(0,nn.UI)(h,i.src);d&&(l=d?.values)}else for(let d=0;d<h.fields.length;d++){const u=h.fields[d];if(u.type===St.PU.string){l=u.values;break}}break}},registerOptionsUI:c=>{c.addFieldNamePicker({path:"config.src",name:"Image Source field",settings:{filter:h=>h.type===St.PU.string,noFieldsMessage:(0,x.t)("geomap.photos-layer.noFieldsMessage-no-string-fields","No string fields found")}}).addRadio({path:"config.kind",name:"Kind",settings:{options:[{label:"Square",value:"square"},{label:"Circle",value:"circle"},{label:"Anchored",value:"anchored"},{label:"Folio",value:"folio"}]},defaultValue:je.kind}).addBooleanSwitch({path:"config.crop",name:"Crop",settings:{},defaultValue:je.crop}).addBooleanSwitch({path:"config.shadow",name:"Shadow",settings:{},defaultValue:je.shadow}).addSliderInput({path:"config.border",name:"Border",settings:{min:0,max:10},defaultValue:je.border}).addColorPicker({path:"config.color",name:"Border color",defaultValue:je.color,settings:[{enableNamedColors:!1}]}).addSliderInput({path:"config.radius",name:"Radius",settings:{min:1,max:100},defaultValue:je.radius})}}},defaultOptions:je};var xa=m(99165),An=m(6773);const Dt={style:{...w.T5,opacity:1,lineWidth:2},arrow:0},bn="route",Al={type:bn,name:"",config:Dt,location:{mode:X.aG.Auto},tooltip:!1};var wa=(n=>(n[n.x1=0]="x1",n[n.y1=1]="y1",n[n.x2=2]="x2",n[n.y2=3]="y2",n))(wa||{});const ti="#607D8B",Ca={id:bn,name:"Route",description:"Render data points as a route",isBaseMap:!1,showLocation:!0,state:Ke.pn.beta,create:async(n,e,t,s)=>{const i={...Dt,...e?.config},r=await Le(i.style),o=await(0,pe.nE)(e.location),a=new _t(o),l=new Q.A({source:a}),c=i.arrow===1||i.arrow===-1;if(!r.fields&&!c){const T=Ms(r.base);r.config.size&&r.config.size.fixed&&T.getStroke()?.setWidth(r.config.size.fixed),l.setStyle(T)}else l.setStyle(T=>{const b=T.get("rowIndex"),_=r.dims;if(!_||!(0,q.isNumber)(b))return Ms(r.base);const P=[],O=T.getGeometry(),H=r.config.opacity??1;if(O instanceof Tt.Ay){const z=O.getCoordinates();if(z){let B=0;const k=2;for(let W=0;W<z.length-1;W++){const he=z[B],ze=z[W+1],st=(0,Ce.A)(s.visualization.getColorByName((_.color&&_.color.get(B))??r.base.color)).setAlpha(H).toString(),gs=(0,Ce.A)(s.visualization.getColorByName((_.color&&_.color.get(W+1))??r.base.color)).setAlpha(H).toString(),ai=(_.size&&_.size.get(B))??r.base.size,j=(_.size&&_.size.get(W+1))??r.base.size,it=new vn({visible:!0,lineCap:i.arrow===0?"round":"square",color:st,color2:gs,width:(_.size&&_.size.get(B))??r.base.size,width2:(_.size&&_.size.get(W+1))??r.base.size});if(i.arrow&&(it.setArrow(i.arrow),i.arrow>0?(it.setArrowColor(gs),it.setArrowSize((j??0)*1.5)):(it.setArrowColor(st),it.setArrowSize((ai??0)*1.5))),(0,K.o3)(n,k,he,ze)){const qa=new te.A([he,ze]);it.setGeometry(qa),P.push(it),B=W+1}}if(P.length===0){const W=new ne.A(z[0]),he=((_.size&&_.size.get(0))??r.base.size??10)/2,ze=(0,Ce.A)(s.visualization.getColorByName((_.color&&_.color.get(0))??r.base.color)).setAlpha(H).toString(),st=new L.Ay({image:new Ve.A({radius:he,fill:new N.A({color:ze})})});st.setGeometry(W),P.push(st)}}return P}const U={...r.base};return _.color&&(U.color=_.color.get(b)),Ms(U)});const h=new $.A({}),d=new $.A({}),u=new $.A({}),g=[d,u],y=(r.base.lineWidth||6)+3,p=new L.Ay({image:new Ve.A({radius:y,stroke:new G.A({color:An.MV.alpha(ti,1),width:1}),fill:new N.A({color:An.MV.alpha(ti,.4)})})}),v=new L.Ay({stroke:new G.A({color:ti,width:1,lineDash:[3,3],lineCap:"square"})}),S=new Q.A({source:new ae({features:[h]}),style:p}),C=new Q.A({source:new ae({features:g}),style:v}),A=new dt.A({layers:[l,S,C]}),F=new Ct.yU;return F.add(t.getStream(ie.b_).pipe((0,xa.c)(8)).subscribe({next:T=>{const b=n.getView().calculateExtent(n.getSize()),P=a.getFeatures()[0]?.get("frame"),O=T.payload?.point?.time;if(P&&O){const H=P.fields.find(U=>U.type===St.PU.time);if(H){const U=H.values,z=Sa(U,O);if(z!==null){const B=(0,pe.FM)(P,o);if(B.field){const k=B.field.values[z],W=k.getCoordinates();h.setGeometry(k),h.setStyle(p),d.setGeometry(new te.A([[b[0],W[1]],[b[2],W[1]]])),u.setGeometry(new te.A([[W[0],b[1]],[W[0],b[3]]])),g.forEach(he=>he.setStyle(v))}}}}}})),F.add(t.subscribe(ie.ql,T=>{h.setStyle(new L.Ay({})),g.forEach(b=>b.setStyle(new L.Ay({})))})),{init:()=>A,dispose:()=>F.unsubscribe(),update:T=>{if(T.series?.length)for(const b of T.series){(r.fields||c)&&(r.dims=(0,K.ue)(b,r,s)),a.clear(!0);const _=(0,pe.FM)(b,o);if(!_.field){a.changed();break}const P=[];for(const O of _.field.values)O instanceof ne.A&&P.push(O.getCoordinates());if(P.length>=2){const O=new te.A(P);a.addFeatureInternal(new $.A({frame:b,rowIndex:0,geometry:O}))}a.changed();break}},registerOptionsUI:T=>{T.addCustomEditor({id:"config.style",path:"config.style",name:"Style",editor:We,settings:{simpleFixedValues:!1},defaultValue:Dt.style}).addRadio({path:"config.arrow",name:"Arrow",settings:{options:[{label:"None",value:0},{label:"Forward",value:1},{label:"Reverse",value:-1}]},defaultValue:Dt.arrow})}}},defaultOptions:Dt};function Sa(n,e){if(n.length===0)return null;if(n.length===1)return 0;const t=n.length-1;if(e<n[0])return 0;if(e>n[t])return t;const s=Math.abs(Math.round(t*(e-n[0])/(n[t]-n[0])));if(e<n[s]){for(let i=s;i>0;i--)if(e>n[i])return i<t?i+1:t;return 0}else{for(let i=s;i<t;i++)if(e<n[i])return i>0?i-1:0;return t}}const Tn=[Zr,da,ua,No,Lo,Ro,Ca,va,ma],vt={type:"default",name:"",config:{}},En={id:vt.type,name:"Default base layer",isBaseMap:!0,create:(n,e,t,s)=>{const i=Ze.$W?.geomapDefaultBaseLayerConfig?.type;if(i){const r=jt.getIfExists(i);if(!r)throw new Error("Invalid basemap configuration on server");return r.create(n,Ze.$W.geomapDefaultBaseLayerConfig,t,s)}return Zi.create(n,e,t,s)}},jt=new ss.O(()=>[En,...Ys,...Tn]);function _n(n,e){const t={options:[],current:[]},s=[];for(const i of n){const r={label:i.name,value:i.id,description:i.description};switch(i.state){case Ke.pn.alpha:if(!Ze.yn)break;r.label=`${i.name} (Alpha)`,r.icon="bolt",s.push(r);break;case Ke.pn.beta:r.label=`${i.name} (Beta)`;default:t.options.push(r)}i.id===e&&t.current.push(r)}for(const i of s)t.options.push(i);return t}function Fn(n,e){return _n(n?[En,...Ys]:[...Tn,...Ys],e)}const bl={layers:[]},In={allLayers:!0,id:"zero",lat:0,lon:0,noRepeat:!1,zoom:1};var xt=(n=>(n.Details="details",n.None="none",n))(xt||{}),Aa=(n=>(n.Coords="coords",n.Fit="fit",n.Zero="zero",n))(Aa||{}),ba=m(13752),Rn=m(36638);const si=new WeakMap,ii=(n,e,t)=>{if(n.update){let s=t;if(e.filterData){const i=(0,Rn.Dq)(e.filterData);s={...s,series:s.series.filter(i)}}n.update(s)}};async function Ta(n,e,t){if(!n.map)return!1;const s=n.byName.get(e);if(!s)return!1;let i=-1;const r=n.map?.getLayers();for(let a=0;a<r?.getLength();a++)if(r.item(a)===s.layer){i=a;break}if(t.name!==e){if(!t.name)t.name=e;else if(n.byName.has(t.name))return!1;n.byName.delete(e),e=t.name,n.byName.set(e,s)}s.options.type,t.type;const o=n.layers.slice(0);try{const a=await fs(n,n.map,t,s.isBasemap);o[i]?.handler.dispose?.(),o[i]=a,r.setAt(i,a.layer),ii(a.handler,t,n.props.data)}catch(a){return console.warn("ERROR",a),!1}return n.setState({legends:[]}),n.layers=o,n.doOptionsUpdate(i),!0}async function fs(n,e,t,s){s&&(!t?.type||Be.$.geomapDisableCustomBaseLayer)&&(t=vt),t?.type||(t={type:Bs,name:(0,K.q)(n),config:{}});const i=jt.getIfExists(t.type);if(!i)return Promise.reject("unknown layer: "+t.type);t.config?.attribution&&(t.config.attribution=zi.sQ.sanitizeTextPanelContent(t.config.attribution));const r=await i.create(e,t,n.props.eventBus,Be.$.theme2),o=r.init();t.opacity!=null&&o.setOpacity(t.opacity),t.name||(t.name=(0,K.q)(n));const a=t.name,l={isBasemap:s,options:t,layer:o,handler:r,mouseEvents:new ba.B,getName:()=>a,onChange:c=>{Ta(n,a,c)}};return n.byName.set(a,l),si.set(l.layer,l),o instanceof dt.A&&o.getLayers().getArray().forEach(c=>{c instanceof Et.A&&si.set(c,l)}),ii(r,t,n.props.data),l}const Pn=n=>n?si.get(n):void 0,Ea=n=>({selectLayer:t=>{const s=n.layers.findIndex(i=>i.options.name===t);n.panelContext&&n.panelContext.onInstanceStateChange&&n.panelContext.onInstanceStateChange({map:n.map,layers:n.layers,selected:s,actions:n.actions})},canRename:t=>!n.byName.has(t),deleteLayer:t=>{const s=[];for(const i of n.layers)i.options.name===t?n.map?.removeLayer(i.layer):s.push(i);n.layers=s,n.doOptionsUpdate(0)},addlayer:t=>{const s=jt.getIfExists(t);s&&fs(n,n.map,{type:s.id,name:(0,K.q)(n),config:(0,q.cloneDeep)(s.defaultOptions),location:s.showLocation?{mode:X.aG.Auto}:void 0,tooltip:!0,...!s.hideOpacity&&{opacity:w.T5.opacity}},!1).then(i=>{n.layers=n.layers.slice(0),n.layers.push(i),n.map?.addLayer(i.layer),n.doOptionsUpdate(n.layers.length-1)})},reorder:(t,s)=>{const i=Array.from(n.layers),[r]=i.splice(t,1);i.splice(s,0,r),n.layers=i,n.doOptionsUpdate(s);const o=n.map?.getLayers();o.clear(),n.layers.forEach(a=>o.push(a.layer))}});function _a(n=[],e=!1,t=!1,s){return n.filter(i=>i.layer instanceof Oe.A||i.layer instanceof dt.A||i.layer instanceof Q.A).flatMap(i=>{const r=i.options.name,o=i.layer;if(o instanceof dt.A)return!e&&r!==s?[]:Fa(o,t);if(o instanceof Oe.A||o instanceof Q.A){if(e)return[o.getSource().getExtent()];if(t&&s===r){const a=o.getSource().getFeatures(),c=a[a.length-1]?.getGeometry();return c?[c.getExtent()]:[]}else if(!t&&s===r)return[o.getSource().getExtent()];return[]}else return[]}).reduce(I.X$,(0,I.S5)())}function Fa(n,e){return n.getLayers().getArray().filter(t=>t instanceof Oe.A||t instanceof Q.A||t instanceof Et.A).map(t=>{if(t instanceof Oe.A||t instanceof Q.A||t instanceof Et.A){if(e){const s=t.getSource().getFeatures(),r=s[s.length-1]?.getGeometry();if(r){const o=r.flatCoordinates,a=o.length;if(a>1){const l=o[a-2],c=o[a-1];return[l,c,l,c]}}return[]}return t.getSource().getExtent()??[]}else return[]})}const Ia=n=>{n.map?.on("singleclick",e=>Mn(e,n)),n.map?.on("pointermove",(0,q.debounce)(e=>ni(e,n),200)),n.map?.getViewport().addEventListener("mouseout",e=>{n.props.eventBus.publish(new ie.ql)})},Mn=(n,e)=>{ni(n,e)&&(n.preventDefault(),n.stopPropagation(),e.mapDiv.style.cursor="auto",e.setState({ttipOpen:!0}))},ni=(n,e)=>{if(e.state.measureMenuActive)return!0;if(!e.map||e.state.ttipOpen&&e.state?.ttip?.layers?.length||!(n.originalEvent instanceof MouseEvent))return!1;const t=n.originalEvent,s=e.map.getEventPixel(t),i=(0,E.WP)(e.map.getCoordinateFromPixel(s)),{hoverPayload:r}=e;r.pageX=t.pageX,r.pageY=t.pageY-window.scrollY,r.point={lat:i[1],lon:i[0]},r.data=void 0,r.columnIndex=void 0,r.rowIndex=void 0,r.layers=void 0;const o=[],a=new Map;let l={};e.map.forEachFeatureAtPixel(s,(h,d,u)=>{const g=Pn(d);if(!r.data){const y=h.getProperties(),p=y.frame;p&&(r.data=l.data=p,r.rowIndex=l.rowIndex=y.rowIndex),g?.mouseEvents&&g.mouseEvents.next(h)}if(g){let y=a.get(g);if(y||(y={layer:g,features:[]},a.set(g,y),o.push(y)),y.features.some(p=>p===h)||y.features.push(h),d instanceof Et.A){const p=h.getGeometry();if(p instanceof ne.A){const v=p.getCoordinates(),S=d.getSource();let C=!1;S.forEachFeature(A=>{if(A!==h&&!y.features.some(F=>F===A)){const F=A.getGeometry();if(F instanceof ne.A){const T=F.getCoordinates();T[0]===v[0]&&T[1]===v[1]&&(y.features.push(A),C=!0)}}}),C&&y.features.sort((A,F)=>{const T=A.getProperties().rowIndex!==void 0?Number(A.getProperties().rowIndex):Number.MAX_SAFE_INTEGER,b=F.getProperties().rowIndex!==void 0?Number(F.getProperties().rowIndex):Number.MAX_SAFE_INTEGER;return T-b})}}}},{layerFilter:h=>Pn(h)?.options?.tooltip!==!1}),e.hoverPayload.layers=o.length?o:void 0,e.props.eventBus.publish(e.hoverEvent),(e.state.ttip===void 0||e.state.ttip?.layers!==r.layers||r.layers)&&e.setState({ttip:{...r}}),o.length||e.layers.forEach(h=>{h.mouseEvents.next(void 0)});const c=!!o.length;return e.mapDiv.style.cursor=c?"pointer":"auto",c};var me=(n=>(n.Zero="zero",n.Coordinates="coords",n.Fit="fit",n))(me||{});const zt=new ss.O(()=>[{id:"fit",name:"Fit to data",zoom:15},{id:"zero",name:"(0\xB0, 0\xB0)",lat:0,lon:0},{id:"coords",name:"Coordinates"},{id:"north-america",name:"North America",lat:40,lon:-100,zoom:4},{id:"south-america",name:"South America",lat:-20,lon:-60,zoom:3},{id:"europe",name:"Europe",lat:46,lon:14,zoom:4},{id:"africa",name:"Africa",lat:0,lon:30,zoom:3},{id:"west-asia",name:"West Asia",lat:26,lon:53,zoom:4},{id:"s-asia",name:"South Asia",lat:19.5,lon:80,zoom:4},{id:"se-asia",name:"South-East Asia",lat:10,lon:106,zoom:4},{id:"e-asia",name:"East Asia",lat:33,lon:120,zoom:4},{id:"australia",name:"Australia",lat:-25,lon:135,zoom:4},{id:"oceania",name:"Oceania",lat:-10,lon:-140,zoom:3}]);let ri;class Ra extends R.Component{constructor(e){super(e),this.panelContext=void 0,this.subs=new Ct.yU,this.globalCSS=Fr(Be.$.theme2),this.hoverPayload={point:{},pageX:-1,pageY:-1},this.hoverEvent=new ie.b_(this.hoverPayload),this.layers=[],this.byName=new Map,this.actions=Ea(this),this.initMapRef=async t=>{if(!t)return;this.mapDiv=t,this.map&&this.map.dispose();const{options:s}=this.props,i=(0,K.rd)(this,s,t);this.byName.clear();const r=[];try{const o={...s.basemap??vt,noRepeat:s.view?.noRepeat??!1};r.push(await fs(this,i,o,!0)),s.layers||(s.layers=[Gs]);for(const a of s.layers)r.push(await fs(this,i,a,!1))}catch(o){console.error("error loading layers",o)}for(const o of r)i.addLayer(o.layer);this.layers=r,this.map=i,this.initViewExtent(i.getView(),s.view),this.mouseWheelZoom=new Fe.A,this.map?.addInteraction(this.mouseWheelZoom),(0,K.Lc)(this,s),Ia(this),(0,K.Bz)(this,r,r.length-1),this.setState({legends:this.getLegends()})},this.clearTooltip=()=>{this.state.ttip&&!this.state.ttipOpen&&this.tooltipPopupClosed()},this.tooltipPopupClosed=()=>{this.setState({ttipOpen:!1,ttip:void 0})},this.pointerClickListener=t=>{Mn(t,this)},this.pointerMoveListener=t=>{ni(t,this)},this.initMapView=t=>{const s=t.noRepeat??!1;let i={center:[0,0],zoom:1};if(s){const o=[-180,-85.05112878,180,85.05112878],a=(0,E.DI)(o,"EPSG:4326","EPSG:3857");i.extent=a,i.showFullExtent=!1,i.constrainOnlyCenter=!1}let r=new ps.Ay(i);return t.shared&&(ri?r=ri:ri=r),this.initViewExtent(r,t),r},this.state={ttipOpen:!1,legends:[]},this.subs.add(this.props.eventBus.subscribe(ws.i0,t=>{this.mapDiv&&this.props.id===t.payload&&this.initMapRef(this.mapDiv)})),this.subs.add(xs.l.subscribe(Nt.og,()=>{this.mapDiv&&this.layers.some(s=>{const i=s.options.config;return!i||typeof i!="object"?!1:(0,K.cA)(i)})&&this.initMapRef(this.mapDiv)}))}static{this.contextType=vs.e4}componentDidMount(){this.panelContext=this.context}componentWillUnmount(){this.subs.unsubscribe();for(const e of this.layers)e.handler.dispose?.();this.map?.dispose()}shouldComponentUpdate(e){return this.map&&((this.props.height!==e.height||this.props.width!==e.width)&&this.map.updateSize(),this.props.data!==e.data&&this.dataChanged(e.data)),!0}componentDidUpdate(e){this.map&&(this.props.height!==e.height||this.props.width!==e.width)&&this.map.updateSize(),this.map&&this.props.data!==e.data&&this.dataChanged(this.props.data),this.props.options!==e.options&&this.optionsChanged(e.options,this.props.options)}doOptionsUpdate(e){const{options:t,onOptionsChange:s}=this.props,i=this.layers;this.map?.getLayers().forEach(r=>{r instanceof Ti&&(this.map?.removeLayer(r),this.map?.addLayer(r))}),s({...t,basemap:i[0].options,layers:i.slice(1).map(r=>r.options)}),(0,K.Bz)(this,i,e),this.setState({legends:this.getLegends()})}optionsChanged(e,t){if(e.view?.noRepeat!==t.view?.noRepeat){this.mapDiv&&this.initMapRef(this.mapDiv);return}if(e.view!==t.view){const i=this.initMapView(t.view);this.map&&i&&this.map.setView(i)}t.controls!==e.controls&&this.initControls(t.controls??{showZoom:!0,showAttribution:!0})}dataChanged(e){if(e===this.props.data)for(const s of this.layers)ii(s.handler,s.options,this.props.data);const t=zt.getIfExists(this.props.options.view.id);if(t&&t.id===me.Fit){const s=this.initMapView(this.props.options.view);this.map&&s&&this.map.setView(s)}this.setState({legends:this.getLegends()})}initViewExtent(e,t){const s=zt.getIfExists(t.id);if(s){let i;if(s.lat==null){if(s.id===me.Coordinates)i=[t.lon??0,t.lat??0];else if(s.id===me.Fit){const r=_a(this.layers,t.allLayers,t.lastOnly,t.layer);if(!(0,I.Im)(r)){const o=t.padding??5,a=e.getResolutionForExtent(r,this.map?.getSize()),l=t.zoom??t.maxZoom;e.fit(r,{maxZoom:l}),e.setResolution(a*(o/100+1));const c=e.getZoom();c&&l&&c>l&&e.setZoom(l)}}}else i=[s.lon??0,s.lat??0];i&&e.setCenter((0,E.Rb)(i))}t.maxZoom&&e.setMaxZoom(t.maxZoom),t.minZoom&&e.setMaxZoom(t.minZoom),t.zoom&&s?.id!==me.Fit&&e.setZoom(t.zoom)}initControls(e){if(!this.map)return;this.map.getControls().clear(),e.showZoom&&this.map.addControl(new we.A),e.showScale&&this.map.addControl(new _e({units:e.scaleUnits,minWidth:100})),this.mouseWheelZoom?.setActive(!!e.mouseWheelZoom),e.showAttribution&&this.map.addControl(new ys.A({collapsed:!0,collapsible:!0}));let t=[];e.showMeasure&&(t=[(0,f.jsx)(Er,{map:this.map,menuActiveState:i=>{this.setState({ttipOpen:i,measureMenuActive:i})}},"measure")]);let s=[];e.showDebug&&(s=[(0,f.jsx)(sr,{map:this.map},"debug")]),this.setState({topRight1:t,topRight2:s})}getLegends(){const e=[];for(const t of this.layers)t.handler.legend&&(0,K.sN)(t.layer)&&e.push((0,f.jsx)("div",{children:t.handler.legend},t.options.name));return e}render(){let{ttip:e,ttipOpen:t,topRight1:s,legends:i,topRight2:r}=this.state;const{options:o}=this.props,a=o.controls.showScale;return!t&&o.tooltip?.mode===xt.None&&(e=void 0),(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)(Gt.Global,{styles:this.globalCSS}),(0,f.jsxs)("div",{className:Ln.wrap,onMouseLeave:this.clearTooltip,children:[(0,f.jsx)("div",{role:"application",className:Ln.map,tabIndex:0,"aria-label":(0,x.t)("geomap.geomap-panel.aria-label-map","Navigable map"),ref:this.initMapRef}),(0,f.jsx)(Ot,{bottomLeft:i,topRight1:s,topRight2:r,blStyle:{bottom:a?"35px":"8px"}})]}),(0,f.jsx)(tr,{ttip:e,isOpen:t,onClose:this.tooltipPopupClosed})]})}}const Ln={wrap:(0,M.css)({position:"relative",width:"100%",height:"100%"}),map:(0,M.css)({position:"absolute",zIndex:0,width:"100%",height:"100%"})};var Pa=m(32881),Ma=m(86956),oi=m(21835),La=m(30703),Da=m(34316);const ja="layer-drag-drop-list",za=({layers:n,getLayerInfo:e,onDragEnd:t,onSelect:s,onDelete:i,onDuplicate:r,showActions:o,selection:a,excludeBaseLayer:l,onNameChange:c,verifyLayerNameUniqueness:h})=>{const d=(0,Ne.of)(Ba),u=g=>g?`${d.row} ${d.sel}`:d.row;return(0,f.jsx)(oi.JY,{onDragEnd:t,children:(0,f.jsx)(oi.gL,{droppableId:"droppable",children:(g,y)=>(0,f.jsxs)("div",{...g.droppableProps,ref:g.innerRef,"data-testid":ja,children:[(()=>{const p=[],v=l?1:0,S=l?2:1;for(let C=n.length-1;C>=v;C--){const A=n[C],F=A.getName(),T=!!a?.includes(F);p.push((0,f.jsx)(oi.sx,{draggableId:F,index:p.length,children:(b,_)=>(0,f.jsxs)("div",{className:u(T),ref:b.innerRef,...b.draggableProps,...b.dragHandleProps,onClick:()=>s(A),onKeyDown:P=>{(P.key==="Enter"||P.key===" ")&&(P.preventDefault(),s(A))},role:"button",tabIndex:0,children:[(0,f.jsx)(Da.R,{name:F,onChange:P=>c(A,P),verifyLayerNameUniqueness:h??void 0}),(0,f.jsxs)("div",{className:d.textWrapper,children:["\xA0 ",e(A)]}),o(A)&&(0,f.jsxs)(f.Fragment,{children:[r?(0,f.jsx)(Ss.K,{name:"copy",tooltip:(0,x.t)("layers.layer-drag-drop-list.duplicate-tooltip","Duplicate"),className:d.actionIcon,onClick:()=>r(A)}):null,(0,f.jsx)(Ss.K,{name:"trash-alt",tooltip:(0,x.t)("layers.layer-drag-drop-list.remove-tooltip","Remove"),className:(0,M.cx)(d.actionIcon,d.dragIcon),onClick:()=>i(A)})]}),n.length>S&&(0,f.jsx)(La.I,{"aria-label":(0,x.t)("layers.layer-drag-drop-list.draggable-aria-label","Drag and drop to reorder"),name:"draggabledots",size:"lg",className:d.dragIcon})]})},F))}return p})(),g.placeholder]})})})},Ba=n=>({wrapper:(0,M.css)({marginBottom:n.spacing(2)}),row:(0,M.css)({padding:n.spacing(.5,1),borderRadius:n.shape.radius.default,background:n.colors.background.secondary,minHeight:n.spacing(4),display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:"3px",cursor:"pointer",border:`1px solid ${n.components.input.borderColor}`,"&:hover":{border:`1px solid ${n.components.input.borderHover}`}}),sel:(0,M.css)({border:`1px solid ${n.colors.primary.border}`,"&:hover":{border:`1px solid ${n.colors.primary.border}`}}),dragIcon:(0,M.css)({cursor:"drag"}),actionIcon:(0,M.css)({color:n.colors.text.secondary,"&:hover":{color:n.colors.text.primary}}),typeWrapper:(0,M.css)({color:n.colors.primary.text,marginRight:"5px"}),textWrapper:(0,M.css)({display:"flex",alignItems:"center",flexGrow:1,overflow:"hidden",marginRight:n.spacing(1)})}),Ga=n=>{const{layers:e,selected:t,actions:s}=n.context.instanceState??{};if(!e||!s)return(0,f.jsx)("div",{children:(0,f.jsx)(x.x6,{i18nKey:"geomap.layers-editor.no-layers",children:"No layers?"})});const i=h=>{if(!h.destination)return;const{layers:d,actions:u}=n.context.instanceState??{};if(!d||!u)return;const g=d.length-1,y=(h.source.index-g)*-1,p=(h.destination.index-g)*-1;u.reorder(y,p)},r=h=>{s.selectLayer(h.options.name)},o=h=>{s.deleteLayer(h.options.name)},a=h=>h.options.type,l=(h,d)=>{h.onChange({...h.options,name:d})},c=t?[e[t]?.getName()]:[];return(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)(Pa.mc,{children:(0,f.jsx)(Ma.r,{onChange:h=>s.addlayer(h.value),options:Fn(!1).options,label:(0,x.t)("geomap.layers-editor.label-add-layer","Add layer")})}),(0,f.jsx)("br",{}),(0,f.jsx)(za,{layers:e,showActions:()=>e.length>2,getLayerInfo:a,onDragEnd:i,onSelect:r,onDelete:o,selection:c,excludeBaseLayer:!0,onNameChange:l,verifyLayerNameUniqueness:s.canRename})]})},Na=({labelWidth:n,value:e,onChange:t})=>{const s=r=>{t({...e,lat:r})},i=r=>{t({...e,lon:r})};return(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)(ye.C,{children:(0,f.jsx)(ce.I,{label:(0,x.t)("geomap.coordinates-map-view-editor.label-latitude","Latitude"),labelWidth:n,grow:!0,children:(0,f.jsx)(Mt.Q,{value:e.lat,min:-90,max:90,step:.001,onChange:s})})}),(0,f.jsx)(ye.C,{children:(0,f.jsx)(ce.I,{label:(0,x.t)("geomap.coordinates-map-view-editor.label-longitude","Longitude"),labelWidth:n,grow:!0,children:(0,f.jsx)(Mt.Q,{value:e.lon,min:-180,max:180,step:.001,onChange:i})})})]})};var Dn=(n=>(n.all="all",n.layer="layer",n.last="last",n))(Dn||{}),jn=(n=>(n.all="All layers",n.layer="Layer",n.last="Last value",n))(jn||{});const Oa=Object.values(Dn).map(n=>({label:jn[n],value:n})),ka=({labelWidth:n,value:e,onChange:t,context:s})=>{const i=(0,R.useMemo)(()=>s.options?.layers?s.options.layers.map(d=>({label:d.name,value:d.name,description:void 0})):[],[s.options?.layers]),r=(0,R.useCallback)(d=>{t({...e,layer:d.value})},[e,t]),o=(0,f.jsx)(ye.C,{children:(0,f.jsx)(ce.I,{label:(0,x.t)("geomap.fit-map-view-editor.all-layers-editor-fragment.label-layer","Layer"),labelWidth:n,grow:!0,children:(0,f.jsx)(rt.l6,{options:i,onChange:r,placeholder:i[0]?.label,value:e.layer})})}),a=d=>{t({...e,padding:d})},l=(0,f.jsx)(ye.C,{children:(0,f.jsx)(ce.I,{label:(0,x.t)("geomap.fit-map-view-editor.last-only-editor-fragment.label-padding","Padding"),labelWidth:n,grow:!0,tooltip:(0,x.t)("geomap.fit-map-view-editor.last-only-editor-fragment.tooltip-padding-relative-percent-beyond-extent","Sets padding in relative percent beyond data extent"),children:(0,f.jsx)(Mt.Q,{value:e?.padding??5,min:0,step:1,onChange:a})})}),c=e.allLayers?"all":!e.allLayers&&e.lastOnly?"last":"layer",h=d=>{d!=="all"&&!e.layer?t({...e,allLayers:d==="all",lastOnly:d==="last",layer:i[0].value}):t({...e,allLayers:d==="all",lastOnly:d==="last"})};return(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)(ye.C,{children:(0,f.jsx)(ce.I,{label:(0,x.t)("geomap.fit-map-view-editor.label-data","Data"),labelWidth:n,grow:!0,children:(0,f.jsx)(nt.z,{value:c,options:Oa,onChange:h})})}),!e?.allLayers&&o,!e?.lastOnly&&l]})},Va=({value:n,onChange:e,context:t})=>{const i=(0,R.useMemo)(()=>{const c=[];return n?.id?c.push(n.id):c.push(zt.list()[0].id),zt.selectOptions(c)},[n?.id]),r=(0,R.useCallback)(()=>{const c=t.instanceState?.map;if(c){const h=c.getView(),d=h.getCenter();if(d){const u=(0,E.WP)(d,h.getProjection());e({...n,id:me.Coordinates,lon:+u[0].toFixed(6),lat:+u[1].toFixed(6),zoom:+h.getZoom().toFixed(2)})}}},[n,e,t.instanceState]),o=(0,R.useCallback)(c=>{const h=zt.getIfExists(c.value);h&&e({...n,id:h.id,lat:h.lat??n?.lat,lon:h.lon??n?.lon,zoom:h.zoom??n?.zoom})},[n,e]),a=(0,R.useId)(),l=(0,R.useId)();return(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)(ye.C,{children:(0,f.jsx)(ce.I,{label:(0,x.t)("geomap.map-view-editor.label-view","View"),labelWidth:10,grow:!0,children:(0,f.jsx)(rt.l6,{inputId:a,options:i.options,value:i.current,onChange:o})})}),n.id===me.Coordinates&&(0,f.jsx)(Na,{labelWidth:10,value:n,onChange:e}),n.id===me.Fit&&(0,f.jsx)(ka,{labelWidth:10,value:n,onChange:e,context:t}),(0,f.jsx)(ye.C,{children:(0,f.jsx)(ce.I,{label:n?.id===me.Fit?(0,x.t)("geomap.map-view-editor.label-max-zoom","Max Zoom"):(0,x.t)("geomap.map-view-editor.label-zoom","Zoom"),labelWidth:10,grow:!0,children:(0,f.jsx)(Mt.Q,{id:l,value:n?.zoom??1,min:1,max:18,step:.01,onChange:c=>{e({...n,zoom:c})}})})}),(0,f.jsx)(Ri.B,{direction:"column",children:(0,f.jsx)(kt.$n,{variant:"secondary",size:"sm",fullWidth:!0,onClick:r,children:(0,f.jsx)("span",{children:(0,f.jsx)(x.x6,{i18nKey:"geomap.map-view-editor.use-current-map-settings",children:"Use current map settings"})})})})]})};var Ua=m(61215),Wa=m(90267),Xa=m(42240);function zn(n){return{category:n.category,path:"--",defaultValue:n.basemaps?vt:Gs,values:e=>({getContext:t=>({...t,options:n.state.options,instanceState:n.state}),getValue:t=>(0,q.get)(n.state.options,t),onChange:(t,s)=>{const{state:i}=n,{options:r}=i;if(t==="type"&&s){const o=jt.getIfExists(s);if(o){const a={...r,type:o.id,config:{...o.defaultOptions}};o.showLocation&&(a.location?.mode?delete a.location:a.location={mode:X.aG.Auto}),i.onChange(a);return}}i.onChange((0,Ua.Sf)(r,t,s))}}),build:(e,t)=>{if(!n.state)return;const{handler:s,options:i}=n.state,r=jt.getIfExists(i?.type),o=Fn(n.basemaps,i?.type?i.type:vt.type);if(e.addSelect({path:"type",name:(0,x.t)("geomap.layer-editor.name-layer-type","Layer type"),settings:{options:o.options}}),s.update&&e.addCustomEditor({id:"filterData",path:"filterData",name:(0,x.t)("geomap.layer-editor.name-data","Data"),editor:Xa.x,defaultValue:void 0}),!!r&&i.type!==vt.type){if(r.showLocation){let a=t.data;if(i.filterData){const l=(0,Rn.Dq)(i.filterData);a=a.filter(l)}(0,Wa.G)("Location","location.",e,i.location,a)}s.registerOptionsUI&&s.registerOptionsUI(e,t),(0,q.isEqual)(n.category,[(0,x.t)("geomap.layer-editor.category-base-layer","Base layer")])||(r.hideOpacity||e.addSliderInput({path:"opacity",name:(0,x.t)("geomap.layer-editor.name-opacity","Opacity"),defaultValue:1,settings:{min:0,max:1,step:.1}}),e.addBooleanSwitch({path:"layer-tooltip",name:(0,x.t)("geomap.layer-editor.name-display-tooltip","Display tooltip"),description:(0,x.t)("geomap.layer-editor.description-display-tooltip","Show the tooltip for layer"),defaultValue:!0}))}}}}var Ya=m(46644),$a=m(64761),Za=m(33553);const Ha=(n,e,t,s)=>{if(e==="grafana-worldmap-panel"&&t.angular){const{fieldConfig:i,options:r,xform:o}=Ka({...t.angular,fieldConfig:s});return o?.id?.length&&(n.transformations=n.transformations?[...n.transformations,o]:[o]),n.fieldConfig=i,r}return{}};function Ka(n){const e={defaults:{},overrides:[]},t=(0,q.cloneDeep)(Gs),s={view:{id:me.Zero},controls:{showZoom:!0,mouseWheelZoom:!!n.mouseWheelZoom},basemap:{type:"default",name:"Basemap"},layers:[t],tooltip:{mode:xt.Details}};let i=wt(n.decimals);i&&(e.defaults.decimals=i);const r=t.config.style;i=wt(n.circleMaxSize),i&&(r.size.max=i),i=wt(n.circleMinSize),i&&(r.size.min=i);let o;const a=Ya.AS.getIfExists(n.valueName);if(a&&n.locationData?.length)switch(o={id:$a.F.reduce,options:{reducers:[a.id]}},n.locationData){case"countries":case"countries_3letter":t.location={mode:X.aG.Lookup,gazetteer:"public/gazetteer/countries.json",lookup:void 0};break;case"states":t.location={mode:X.aG.Lookup,gazetteer:"public/gazetteer/usa-states.json",lookup:void 0};break}if(n.thresholds&&n.colors){const c=n.thresholds.split(",").map(d=>Number(d.trim())),h=[];for(const d of n.colors){const u=h.length-1;u>=0?h.push({value:c[u],color:d}):h.push({value:-1/0,color:d})}e.defaults.thresholds={mode:Za.O.Absolute,steps:h}}i=wt(n.initialZoom),i&&(s.view.zoom=i);const l={"(0\xB0, 0\xB0)":me.Zero,"North America":"north-america",Europe:"europe","West Asia":"west-asia","SE Asia":"se-asia","Last GeoHash":me.Coordinates};return s.view.id=l[n.mapCenter],s.view.lat=wt(n.mapCenterLatitude),s.view.lon=wt(n.mapCenterLongitude),{fieldConfig:e,options:s,xform:o}}function wt(n){const e=Number(n);return isNaN(e)?void 0:e}const Qa=n=>{const e=n?.pluginVersion??"";if((e.startsWith("8.1")||e.startsWith("8.2"))&&n.options?.layers?.length===1){const s=n.options.layers[0];if(s?.type==="markers"&&s.config){const i=s.config,r={style:(0,q.cloneDeep)(w.T5),showLegend:!!i.showLegend};i.size&&(r.style.size=i.size),i.color&&(r.style.color=i.color),i.fillOpacity&&(r.style.opacity=i.fillOpacity);const o=Vr(i.shape);return o&&(r.style.symbol={fixed:o,mode:X.q_.Fixed}),{...n.options,layers:[{...s,config:r}]}}}return n.options},Ja=new Ee.m(Ra).setNoPadding().setPanelChangeHandler(Ha).setMigrationHandler(Qa).useFieldConfig({useCustomConfig:n=>{ms.e(n)}}).setPanelOptions((n,e)=>{let t=[(0,x.t)("geomap.category-map-view","Map view")];n.addCustomEditor({category:t,id:"view",path:"view",name:(0,x.t)("geomap.name-initial-view","Initial view"),description:(0,x.t)("geomap.description-initial-view","This location will show when the panel first loads."),editor:Va,defaultValue:In}),n.addBooleanSwitch({category:t,path:"view.shared",description:(0,x.t)("geomap.description-share-view","Use the same view across multiple panels.  Note: this may require a dashboard reload."),name:(0,x.t)("geomap.name-share-view","Share view"),defaultValue:In.shared}),n.addBooleanSwitch({category:t,path:"view.noRepeat",name:(0,x.t)("geomap.name-no-repeat","No map repeating"),description:(0,x.t)("geomap.description-no-repeat","Prevent the map from repeating horizontally"),defaultValue:!1});const s=e.instanceState;if(s?.layers){const i=[(0,x.t)("geomap.category-map-layers","Map layers")],r=[(0,x.t)("geomap.category-basemap-layer","Basemap layer")];n.addCustomEditor({category:i,id:"layers",path:"",name:"",editor:Ga});const o=s.layers[s.selected];s.selected&&o&&n.addNestedOptions(zn({state:o,category:i,basemaps:!1}));const a=s.layers[0];Be.$.geomapDisableCustomBaseLayer?n.addCustomEditor({category:r,id:"layers",path:"",name:"",editor:()=>(0,f.jsx)("div",{children:(0,f.jsx)(x.x6,{i18nKey:"geomap.plugin.basemap-layer-configured-server-admin",children:"The basemap layer is configured by the server admin."})})}):a&&n.addNestedOptions(zn({state:a,category:r,basemaps:!0}))}t=[(0,x.t)("geomap.category-map-controls","Map controls")],n.addBooleanSwitch({category:t,path:"controls.showZoom",description:(0,x.t)("geomap.description-show-zoom","Show zoom control buttons in the upper left corner"),name:(0,x.t)("geomap.name-show-zoom","Show zoom control"),defaultValue:!0}).addBooleanSwitch({category:t,path:"controls.mouseWheelZoom",description:(0,x.t)("geomap.description-mouse-wheel-zoom","Enable zoom control via mouse wheel"),name:(0,x.t)("geomap.name-mouse-wheel-zoom","Mouse wheel zoom"),defaultValue:!0}).addBooleanSwitch({category:t,path:"controls.showAttribution",name:(0,x.t)("geomap.name-show-attribution","Show attribution"),description:(0,x.t)("geomap.description-show-attribution","Show the map source attribution info in the lower right"),defaultValue:!0}).addBooleanSwitch({category:t,path:"controls.showScale",name:(0,x.t)("geomap.name-show-scale","Show scale"),description:(0,x.t)("geomap.description-show-scale","Indicate map scale"),defaultValue:!1}).addBooleanSwitch({category:t,path:"controls.showMeasure",name:(0,x.t)("geomap.name-show-measure","Show measure tools"),description:(0,x.t)("geomap.description-show-measure","Show tools for making measurements on the map"),defaultValue:!1}).addBooleanSwitch({category:t,path:"controls.showDebug",name:(0,x.t)("geomap.name-show-debug","Show debug"),description:(0,x.t)("geomap.description-show-debug","Show map info"),defaultValue:!1}).addRadio({category:t,path:"tooltip.mode",name:(0,x.t)("geomap.name-tooltip","Tooltip"),defaultValue:xt.Details,settings:{options:[{label:(0,x.t)("geomap.tooltip-options.label-none","None"),value:xt.None,description:(0,x.t)("geomap.tooltip-options.description-none","Show contents on click, not hover")},{label:(0,x.t)("geomap.tooltip-options.label-details","Details"),value:xt.Details,description:(0,x.t)("geomap.tooltip-options.description-details","Show popup on hover")}]}})})},20276:(Bn,Bt,m)=>{m.d(Bt,{w:()=>M});var f=m(74848),Ee=m(22803),x=m(96540),Be=m(63142);const ms=10,M=({colorPalette:Y,min:E,max:Ge,display:J,hoverValue:ve,useStopsPercentage:xe})=>{const[$e,_e]=(0,x.useState)([]),[we,I]=(0,x.useState)({isShown:!1,value:0}),[Fe,R]=(0,x.useState)(null),Ct=(0,Be.$j)(),ie=ys(Ct,$e);(0,x.useEffect)(()=>{_e(Gt({colorArray:Y,stops:ms,useStopsPercentage:xe}))},[Y,xe]);const vs=Nt=>{const ws=Nt.nativeEvent.offsetX,Ne=Nt.currentTarget.offsetWidth,Ot=Math.floor(ws*100/Ne+1),Cs=Math.floor((Ge-E)*Ot/100+E);I({isShown:!0,value:Cs}),R(Ot)},xs=()=>{I({isShown:!1,value:0})};return(0,x.useEffect)(()=>{R(ve==null?null:ps((ve-E)/(Ge-E)))},[ve,E,Ge]),(0,f.jsxs)("div",{className:ie.scaleWrapper,onMouseMove:vs,onMouseLeave:xs,children:[(0,f.jsx)("div",{className:ie.scaleGradient,children:J&&(we.isShown||ve!==void 0)&&(0,f.jsx)("div",{className:ie.followerContainer,children:(0,f.jsx)("div",{className:ie.follower,style:{left:`${Fe}%`}})})}),J&&(0,f.jsxs)("div",{className:ie.followerContainer,children:[(0,f.jsxs)("div",{className:ie.legendValues,children:[(0,f.jsx)("span",{className:ie.disabled,children:J(E)}),(0,f.jsx)("span",{className:ie.disabled,children:J(Ge)})]}),Fe!=null&&(we.isShown||ve!==void 0)&&(0,f.jsx)("span",{className:ie.hoverValue,style:{left:`${Fe}%`},children:J(ve??we.value)})]})]})},Gt=({colorArray:Y,stops:E,useStopsPercentage:Ge=!0})=>{const J=Y.length;if(Ge&&J<=20){const _e=1/J*100;let we=0;const I=[];for(const Fe of Y)we>0?I.push(`${Fe} ${we}%`):I.push(Fe),we+=_e,I.push(`${Fe} ${we}%`);return I}const ve=Y[J-1],xe=Math.ceil(J/E),$e=new Set;for(let _e=0;_e<J;_e+=xe)$e.add(Y[_e]);return $e.add(ve),[...$e]};function ps(Y){return Y>1?100:Y<0?0:Y*100}const ys=(Y,E)=>({scaleWrapper:(0,Ee.css)({width:"100%",fontSize:"11px",opacity:1}),scaleGradient:(0,Ee.css)({background:`linear-gradient(90deg, ${E.join()})`,height:"9px",pointerEvents:"none",borderRadius:Y.shape.radius.default}),legendValues:(0,Ee.css)({display:"flex",justifyContent:"space-between",pointerEvents:"none"}),hoverValue:(0,Ee.css)({position:"absolute",marginTop:"-14px",padding:"3px 15px",transform:"translateX(-50%)"}),followerContainer:(0,Ee.css)({position:"relative",pointerEvents:"none",whiteSpace:"nowrap"}),follower:(0,Ee.css)({position:"absolute",height:"13px",width:"13px",borderRadius:Y.shape.radius.default,transform:"translateX(-50%) translateY(-50%)",border:`2px solid ${Y.colors.text.primary}`,top:"5px"}),disabled:(0,Ee.css)({color:Y.colors.text.disabled})})}}]);

//# sourceMappingURL=2739.6fc790db0274a310aeb7.js.map