{"version":3,"file":"8622.cd0a11d4389b2b42a07a.js","mappings":"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","sources":["webpack://grafana/./public/app/features/alerting/unified/components/receivers/form/ChannelOptions.tsx","webpack://grafana/./public/app/features/alerting/unified/components/receivers/form/ChannelSubForm.tsx","webpack://grafana/./public/app/features/alerting/unified/components/receivers/form/fields/DeletedSubform.tsx","webpack://grafana/./public/app/features/alerting/unified/components/receivers/form/util.ts","webpack://grafana/./public/app/features/alerting/unified/components/receivers/form/ReceiverForm.tsx","webpack://grafana/./public/app/features/alerting/unified/components/receivers/form/CloudCommonChannelSettings.tsx","webpack://grafana/./public/app/features/alerting/unified/components/receivers/form/CloudReceiverForm.tsx","webpack://grafana/./public/app/features/alerting/unified/components/receivers/form/GrafanaCommonChannelSettings.tsx","webpack://grafana/./public/app/features/alerting/unified/components/receivers/form/TestContactPointModal.tsx","webpack://grafana/./public/app/features/alerting/unified/components/receivers/form/GrafanaReceiverForm.tsx"],"sourcesContent":["import * as React from 'react';\nimport { DeepMap, FieldError, FieldErrors, useFormContext } from 'react-hook-form';\n\nimport { Field, SecretInput } from '@grafana/ui';\nimport {\n  NotificationChannelOption,\n  NotificationChannelSecureFields,\n  OptionMeta,\n} from 'app/features/alerting/unified/types/alerting';\n\nimport {\n  ChannelValues,\n  CloudChannelValues,\n  GrafanaChannelValues,\n  ReceiverFormValues,\n} from '../../../types/receiver-form';\n\nimport { OptionField } from './fields/OptionField';\n\nexport interface Props<R extends ChannelValues> {\n  defaultValues: R;\n  selectedChannelOptions: NotificationChannelOption[];\n\n  onResetSecureField: (key: string) => void;\n  onDeleteSubform?: (settingsPath: string, option: NotificationChannelOption) => void;\n  errors?: FieldErrors<R>;\n  /**\n   * The path for the integration in the array of integrations.\n   * This is used to access the settings and secure fields for the integration in a type-safe way.\n   */\n  integrationPrefix: `items.${number}`;\n  readOnly?: boolean;\n\n  customValidators?: Record<string, React.ComponentProps<typeof OptionField>['customValidator']>;\n}\n\nexport function ChannelOptions<R extends ChannelValues>({\n  defaultValues,\n  selectedChannelOptions,\n  onResetSecureField,\n  onDeleteSubform,\n  errors,\n  integrationPrefix,\n  readOnly = false,\n  customValidators = {},\n}: Props<R>): JSX.Element {\n  const { watch } = useFormContext<ReceiverFormValues<CloudChannelValues | GrafanaChannelValues>>();\n\n  const [settings, secureFields] = watch([`${integrationPrefix}.settings`, `${integrationPrefix}.secureFields`]);\n\n  // Note: settingsPath includes a trailing dot for OptionField, unlike the path used in watch()\n  const settingsPath = `${integrationPrefix}.settings.` as const;\n\n  const getOptionMeta = (option: NotificationChannelOption): OptionMeta => ({\n    required: determineRequired(option, settings, secureFields),\n    readOnly: determineReadOnly(option, settings, secureFields),\n  });\n\n  return (\n    <>\n      {selectedChannelOptions.map((option: NotificationChannelOption, index: number) => {\n        const key = `${option.label}-${index}`;\n        // Some options can be dependent on other options, this determines what is selected in the dependency options\n        // I think this needs more thought.\n        // pathPrefix = items.index.\n        // const paths = pathPrefix.split('.');\n        const selectedOptionValue = settings?.[option.showWhen.field];\n\n        if (option.showWhen.field && selectedOptionValue !== option.showWhen.is) {\n          return null;\n        }\n\n        if (secureFields && secureFields[option.secureFieldKey ?? option.propertyName]) {\n          return (\n            <Field\n              key={key}\n              label={option.label}\n              description={option.description}\n              htmlFor={`${settingsPath}${option.propertyName}`}\n            >\n              <SecretInput\n                id={`${settingsPath}${option.propertyName}`}\n                onReset={() => onResetSecureField(option.secureFieldKey ?? option.propertyName)}\n                isConfigured\n              />\n            </Field>\n          );\n        }\n\n        const error: FieldError | DeepMap<any, FieldError> | undefined = (\n          (option.secure ? errors?.secureFields : errors?.settings) as DeepMap<any, FieldError> | undefined\n        )?.[option.secureFieldKey ?? option.propertyName];\n\n        const defaultValue = defaultValues?.settings?.[option.propertyName];\n\n        return (\n          <OptionField\n            secureFields={secureFields}\n            onResetSecureField={onResetSecureField}\n            onDeleteSubform={onDeleteSubform}\n            defaultValue={defaultValue}\n            readOnly={readOnly}\n            key={key}\n            error={error}\n            pathPrefix={settingsPath}\n            option={option}\n            customValidator={customValidators[option.propertyName]}\n            getOptionMeta={getOptionMeta}\n          />\n        );\n      })}\n    </>\n  );\n}\n\nconst determineRequired = (\n  option: NotificationChannelOption,\n  settings: Record<string, unknown>,\n  secureFields: NotificationChannelSecureFields\n) => {\n  if (!option.required) {\n    return false;\n  }\n\n  if (!option.dependsOn) {\n    return option.required ? 'Required' : false;\n  }\n\n  // TODO: This doesn't work with nested secureFields.\n  const dependentOn = Boolean(settings[option.dependsOn]) || Boolean(secureFields[option.dependsOn]);\n\n  if (dependentOn) {\n    return false;\n  }\n\n  return 'Required';\n};\n\nconst determineReadOnly = (\n  option: NotificationChannelOption,\n  settings: Record<string, unknown>,\n  secureFields: NotificationChannelSecureFields\n) => {\n  if (!option.dependsOn) {\n    return false;\n  }\n\n  // TODO: This doesn't work with nested secureFields.\n  return Boolean(settings[option.dependsOn]) || Boolean(secureFields[option.dependsOn]);\n};\n","import { css } from '@emotion/css';\nimport { sortBy } from 'lodash';\nimport * as React from 'react';\nimport { useEffect, useMemo } from 'react';\nimport { Controller, FieldErrors, useFormContext } from 'react-hook-form';\n\nimport { GrafanaTheme2, SelectableValue } from '@grafana/data';\nimport { Trans, t } from '@grafana/i18n';\nimport { Alert, Button, Field, Select, Stack, Text, useStyles2 } from '@grafana/ui';\nimport { NotificationChannelOption } from 'app/features/alerting/unified/types/alerting';\n\nimport { useUnifiedAlertingSelector } from '../../../hooks/useUnifiedAlertingSelector';\nimport {\n  ChannelValues,\n  CloudChannelValues,\n  CommonSettingsComponentType,\n  GrafanaChannelValues,\n  ReceiverFormValues,\n} from '../../../types/receiver-form';\nimport { OnCallIntegrationType } from '../grafanaAppReceivers/onCall/useOnCallIntegration';\n\nimport { ChannelOptions } from './ChannelOptions';\nimport { CollapsibleSection } from './CollapsibleSection';\nimport { Notifier } from './notifiers';\n\ninterface Props<R extends ChannelValues> {\n  defaultValues: R;\n  initialValues?: R;\n  pathPrefix: `items.${number}.`;\n  integrationIndex: number;\n  notifiers: Notifier[];\n  onDuplicate: () => void;\n  onTest?: () => void;\n  commonSettingsComponent: CommonSettingsComponentType;\n  errors?: FieldErrors<R>;\n  onDelete?: () => void;\n  isEditable?: boolean;\n  isTestable?: boolean;\n\n  customValidators?: React.ComponentProps<typeof ChannelOptions>['customValidators'];\n}\n\nexport function ChannelSubForm<R extends ChannelValues>({\n  defaultValues,\n  initialValues,\n  pathPrefix,\n  integrationIndex,\n  onDuplicate,\n  onDelete,\n  onTest,\n  notifiers,\n  errors,\n  commonSettingsComponent: CommonSettingsComponent,\n  isEditable = true,\n  isTestable,\n  customValidators = {},\n}: Props<R>): JSX.Element {\n  const styles = useStyles2(getStyles);\n  const { control, watch, register, trigger, formState, setValue, getValues } =\n    useFormContext<ReceiverFormValues<CloudChannelValues | GrafanaChannelValues>>();\n\n  const channelFieldPath = `items.${integrationIndex}` as const;\n  const typeFieldPath = `${channelFieldPath}.type` as const;\n  const settingsFieldPath = `${channelFieldPath}.settings` as const;\n\n  const selectedType = watch(typeFieldPath) ?? defaultValues.type;\n  const parse_mode = watch(`${settingsFieldPath}.parse_mode`);\n  const { loading: testingReceiver } = useUnifiedAlertingSelector((state) => state.testReceivers);\n\n  // TODO I don't like integration specific code here but other ways require a bigger refactoring\n  const onCallIntegrationType = watch(`${settingsFieldPath}.integration_type`);\n  const isTestAvailable = onCallIntegrationType !== OnCallIntegrationType.NewIntegration;\n\n  useEffect(() => {\n    register(`${channelFieldPath}.__id`);\n    /* Need to manually register secureFields or else they'll\n     be lost when testing a contact point */\n    register(`${channelFieldPath}.secureFields`);\n  }, [register, channelFieldPath]);\n\n  // Prevent forgetting about initial values when switching the integration type and the oncall integration type\n  useEffect(() => {\n    // Restore values when switching back from a changed integration to the default one\n    const subscription = watch((formValues, { name, type }) => {\n      // @ts-expect-error name is valid key for formValues\n      const value = name ? formValues[name] : '';\n      if (initialValues && name === typeFieldPath && value === initialValues.type && type === 'change') {\n        setValue(settingsFieldPath, initialValues.settings);\n      }\n      // Restore initial value of an existing oncall integration\n      if (\n        initialValues &&\n        name === `${settingsFieldPath}.integration_type` &&\n        value === OnCallIntegrationType.ExistingIntegration\n      ) {\n        setValue(`${settingsFieldPath}.url`, initialValues.settings.url);\n      }\n    });\n\n    return () => subscription.unsubscribe();\n  }, [selectedType, initialValues, setValue, settingsFieldPath, typeFieldPath, watch]);\n\n  const onResetSecureField = (key: string) => {\n    // formSecureFields might not be up to date if this function is called multiple times in a row\n    const currentSecureFields = getValues(`${channelFieldPath}.secureFields`);\n    if (currentSecureFields[key]) {\n      setValue(`${channelFieldPath}.secureFields`, { ...currentSecureFields, [key]: '' });\n    }\n  };\n\n  const findSecureFieldsRecursively = (options: NotificationChannelOption[]): string[] => {\n    const secureFields: string[] = [];\n    options?.forEach((option) => {\n      if (option.secure && option.secureFieldKey) {\n        secureFields.push(option.secureFieldKey);\n      }\n      if (option.subformOptions) {\n        secureFields.push(...findSecureFieldsRecursively(option.subformOptions));\n      }\n    });\n    return secureFields;\n  };\n\n  const onDeleteSubform = (settingsPath: string, option: NotificationChannelOption) => {\n    // Get all subform options with secure=true recursively.\n    const relatedSecureFields = findSecureFieldsRecursively(option.subformOptions ?? []);\n    relatedSecureFields.forEach((key) => {\n      onResetSecureField(key);\n    });\n    const fieldPath = settingsPath.startsWith(`${channelFieldPath}.settings.`)\n      ? settingsPath.slice(`${channelFieldPath}.settings.`.length)\n      : settingsPath;\n    setValue(`${settingsFieldPath}.${fieldPath}`, undefined);\n  };\n\n  const typeOptions = useMemo(\n    (): SelectableValue[] =>\n      sortBy(notifiers, ({ dto, meta }) => [meta?.order ?? 0, dto.name]).map<SelectableValue>(\n        ({ dto: { name, type }, meta }) => ({\n          // @ts-expect-error ReactNode is supported\n          label: (\n            <Stack alignItems=\"center\" gap={1}>\n              {name}\n              {meta?.badge}\n            </Stack>\n          ),\n          value: type,\n          description: meta?.description,\n          isDisabled: meta ? !meta.enabled : false,\n        })\n      ),\n    [notifiers]\n  );\n\n  const handleTest = async () => {\n    await trigger();\n    const isValid = Object.keys(formState.errors).length === 0;\n\n    if (isValid && onTest) {\n      onTest();\n    }\n  };\n\n  const notifier = notifiers.find(({ dto: { type } }) => type === selectedType);\n  const isTelegram = selectedType === 'telegram';\n  // Grafana AM takes \"None\" value and maps to an empty string,\n  // Cloud AM takes no value at all\n  const isParseModeNone = parse_mode === 'None' || !parse_mode;\n  const showTelegramWarning = isTelegram && !isParseModeNone;\n  // if there are mandatory options defined, optional options will be hidden by a collapse\n  // if there aren't mandatory options, all options will be shown without collapse\n  const mandatoryOptions = notifier?.dto.options.filter((o) => o.required) ?? [];\n  const optionalOptions = notifier?.dto.options.filter((o) => !o.required) ?? [];\n\n  const contactPointTypeInputId = `contact-point-type-${pathPrefix}`;\n  return (\n    <div className={styles.wrapper} data-testid=\"item-container\">\n      <div className={styles.topRow}>\n        <div>\n          <Field\n            label={t('alerting.channel-sub-form.label-integration', 'Integration')}\n            htmlFor={contactPointTypeInputId}\n            data-testid={`${pathPrefix}type`}\n          >\n            <Controller\n              name={typeFieldPath}\n              control={control}\n              defaultValue={defaultValues.type}\n              render={({ field: { ref, onChange, ...field } }) => (\n                <Select\n                  disabled={!isEditable}\n                  inputId={contactPointTypeInputId}\n                  {...field}\n                  width={37}\n                  options={typeOptions}\n                  onChange={(value) => onChange(value?.value)}\n                />\n              )}\n            />\n          </Field>\n        </div>\n        <div className={styles.buttons}>\n          {isTestable && onTest && isTestAvailable && (\n            <Button\n              disabled={testingReceiver}\n              size=\"xs\"\n              variant=\"secondary\"\n              type=\"button\"\n              onClick={() => handleTest()}\n              icon={testingReceiver ? 'spinner' : 'message'}\n            >\n              <Trans i18nKey=\"alerting.channel-sub-form.test\">Test</Trans>\n            </Button>\n          )}\n          {isEditable && (\n            <>\n              <Button size=\"xs\" variant=\"secondary\" type=\"button\" onClick={() => onDuplicate()} icon=\"copy\">\n                <Trans i18nKey=\"alerting.channel-sub-form.duplicate\">Duplicate</Trans>\n              </Button>\n              {onDelete && (\n                <Button\n                  data-testid={`${pathPrefix}delete-button`}\n                  size=\"xs\"\n                  variant=\"secondary\"\n                  type=\"button\"\n                  onClick={() => onDelete()}\n                  icon=\"trash-alt\"\n                >\n                  <Trans i18nKey=\"alerting.channel-sub-form.delete\">Delete</Trans>\n                </Button>\n              )}\n            </>\n          )}\n        </div>\n      </div>\n      {notifier && (\n        <div className={styles.innerContent}>\n          {showTelegramWarning && (\n            <Alert\n              title={t(\n                'alerting.contact-points.telegram.parse-mode-warning-title',\n                'Telegram messages are limited to 4096 UTF-8 characters.'\n              )}\n              severity=\"warning\"\n            >\n              <Trans i18nKey=\"alerting.contact-points.telegram.parse-mode-warning-body\">\n                If you use a <Text variant=\"code\">parse_mode</Text> option other than <Text variant=\"code\">None</Text>,\n                truncation may result in an invalid message, causing the notification to fail. For longer messages, we\n                recommend using an alternative contact method.\n              </Trans>\n            </Alert>\n          )}\n          <ChannelOptions<R>\n            defaultValues={defaultValues}\n            selectedChannelOptions={mandatoryOptions.length ? mandatoryOptions : optionalOptions}\n            errors={errors}\n            onResetSecureField={onResetSecureField}\n            onDeleteSubform={onDeleteSubform}\n            integrationPrefix={channelFieldPath}\n            readOnly={!isEditable}\n            customValidators={customValidators}\n          />\n          {!!(mandatoryOptions.length && optionalOptions.length) && (\n            <CollapsibleSection\n              label={t('alerting.channel-sub-form.label-section', 'Optional {{name}} settings', {\n                name: notifier.dto.name,\n              })}\n            >\n              {notifier.dto.info !== '' && (\n                <Alert title=\"\" severity=\"info\">\n                  {notifier.dto.info}\n                </Alert>\n              )}\n              <ChannelOptions<R>\n                defaultValues={defaultValues}\n                selectedChannelOptions={optionalOptions}\n                onResetSecureField={onResetSecureField}\n                onDeleteSubform={onDeleteSubform}\n                errors={errors}\n                integrationPrefix={channelFieldPath}\n                readOnly={!isEditable}\n                customValidators={customValidators}\n              />\n            </CollapsibleSection>\n          )}\n          <CollapsibleSection\n            label={t('alerting.channel-sub-form.label-notification-settings', 'Notification settings')}\n          >\n            <CommonSettingsComponent pathPrefix={pathPrefix} readOnly={!isEditable} />\n          </CollapsibleSection>\n        </div>\n      )}\n    </div>\n  );\n}\n\nconst getStyles = (theme: GrafanaTheme2) => ({\n  buttons: css({\n    '& > * + *': {\n      marginLeft: theme.spacing(1),\n    },\n  }),\n  innerContent: css({\n    maxWidth: '536px',\n  }),\n  wrapper: css({\n    margin: theme.spacing(2, 0),\n    padding: theme.spacing(1),\n    border: `solid 1px ${theme.colors.border.medium}`,\n    borderRadius: theme.shape.radius.default,\n  }),\n  topRow: css({\n    display: 'flex',\n    flexDirection: 'row',\n    justifyContent: 'space-between',\n  }),\n  channelSettingsHeader: css({\n    marginTop: theme.spacing(2),\n  }),\n});\n","import { useEffect } from 'react';\nimport { useFormContext } from 'react-hook-form';\n\ninterface Props {\n  pathPrefix: string;\n}\n\n// we can't drop the deleted item from list entirely because\n// there will be a rece condition with register/unregister calls in react-hook-form\n// and fields will become randomly erroneously unregistered\nexport function DeletedSubForm({ pathPrefix }: Props): JSX.Element {\n  const { register } = useFormContext();\n\n  // required to be registered or react-hook-form will randomly drop the values when it feels like it\n  useEffect(() => {\n    register(`${pathPrefix}.__id`);\n    register(`${pathPrefix}.__deleted`);\n  }, [register, pathPrefix]);\n\n  return <>{null}</>;\n}\n","import { omit } from 'lodash';\n\nimport { ChannelValues, ReceiverFormValues } from '../../../types/receiver-form';\n\nexport interface DeprecatedAuthHTTPConfig {\n  bearer_token?: string;\n  bearer_token_file?: string;\n}\n\nexport interface HTTPAuthConfig {\n  authorization?: {\n    type: string;\n    credentials?: string;\n    credentials_file?: string;\n  };\n}\n\n// convert the newer http_config to the older (deprecated) format\nexport function normalizeFormValues(\n  values?: ReceiverFormValues<ChannelValues>\n): ReceiverFormValues<ChannelValues> | undefined {\n  if (!values) {\n    return;\n  }\n\n  return {\n    ...values,\n    items: values.items.map((item) => ({\n      ...item,\n      settings: {\n        ...item.settings,\n        http_config: item.settings?.http_config ? normalizeHTTPConfig(item.settings?.http_config) : undefined,\n      },\n    })),\n  };\n}\n\nfunction normalizeHTTPConfig(config: HTTPAuthConfig | DeprecatedAuthHTTPConfig): DeprecatedAuthHTTPConfig {\n  if (isDeprecatedHTTPAuthConfig(config)) {\n    return config;\n  }\n\n  return {\n    ...omit(config, 'authorization'),\n    bearer_token: config.authorization?.credentials,\n    bearer_token_file: config.authorization?.credentials_file,\n  };\n}\n\nfunction isDeprecatedHTTPAuthConfig(\n  config: HTTPAuthConfig | DeprecatedAuthHTTPConfig\n): config is DeprecatedAuthHTTPConfig {\n  return ['bearer_token', 'bearer_token_file'].some((prop) => prop in config);\n}\n","import { css } from '@emotion/css';\nimport * as React from 'react';\nimport { FieldErrors, FormProvider, SubmitErrorHandler, useForm } from 'react-hook-form';\n\nimport { GrafanaTheme2 } from '@grafana/data';\nimport { Trans, t } from '@grafana/i18n';\nimport { isFetchError } from '@grafana/runtime';\nimport { Alert, Button, Field, Input, LinkButton, Stack, useStyles2 } from '@grafana/ui';\nimport { useAppNotification } from 'app/core/copy/appNotification';\nimport { useCleanup } from 'app/core/hooks/useCleanup';\nimport { useValidateContactPoint } from 'app/features/alerting/unified/components/contact-points/useContactPoints';\nimport { ManagePermissions } from 'app/features/alerting/unified/components/permissions/ManagePermissions';\n\nimport { getMessageFromError } from '../../../../../../core/utils/errors';\nimport { logError } from '../../../Analytics';\nimport { isOnCallFetchError } from '../../../api/onCallApi';\nimport { useControlledFieldArray } from '../../../hooks/useControlledFieldArray';\nimport { ChannelValues, CommonSettingsComponentType, ReceiverFormValues } from '../../../types/receiver-form';\nimport { makeAMLink } from '../../../utils/misc';\nimport { initialAsyncRequestState } from '../../../utils/redux';\n\nimport { ChannelSubForm } from './ChannelSubForm';\nimport { DeletedSubForm } from './fields/DeletedSubform';\nimport { Notifier } from './notifiers';\nimport { normalizeFormValues } from './util';\n\ninterface Props<R extends ChannelValues> {\n  notifiers: Notifier[];\n  defaultItem: R;\n  alertManagerSourceName: string;\n  onTestChannel?: (channel: R) => void;\n  onSubmit: (values: ReceiverFormValues<R>) => Promise<void>;\n  commonSettingsComponent: CommonSettingsComponentType;\n  initialValues?: ReceiverFormValues<R>;\n  isEditable: boolean;\n  isTestable?: boolean;\n  customValidators?: Record<string, React.ComponentProps<typeof ChannelSubForm>['customValidators']>;\n  /**\n   * Should we show a warning that there is no default policy set,\n   * and that contact point being created will be set as the default?\n   */\n  showDefaultRouteWarning?: boolean;\n  contactPointId?: string;\n  canManagePermissions?: boolean;\n}\n\nexport function ReceiverForm<R extends ChannelValues>({\n  initialValues,\n  defaultItem,\n  notifiers,\n  alertManagerSourceName,\n  onSubmit,\n  onTestChannel,\n  commonSettingsComponent,\n  isEditable,\n  isTestable,\n  customValidators,\n  showDefaultRouteWarning,\n  contactPointId,\n  canManagePermissions,\n}: Props<R>) {\n  const notifyApp = useAppNotification();\n  const styles = useStyles2(getStyles);\n  const validateContactPointName = useValidateContactPoint({ alertmanager: alertManagerSourceName });\n\n  // normalize deprecated and new config values\n  const normalizedConfig = normalizeFormValues(initialValues);\n\n  const defaultValues = normalizedConfig ?? {\n    name: '',\n    items: [\n      {\n        ...defaultItem,\n        __id: String(Math.random()),\n      } as any,\n    ],\n  };\n\n  const formAPI = useForm<ReceiverFormValues<R>>({\n    // making a copy here beacuse react-hook-form will mutate these, and break if the object is frozen. for real.\n    defaultValues: structuredClone(defaultValues),\n  });\n\n  useCleanup((state) => (state.unifiedAlerting.saveAMConfig = initialAsyncRequestState));\n\n  const {\n    handleSubmit,\n    register,\n    formState: { errors, isSubmitting },\n    getValues,\n  } = formAPI;\n\n  const { fields, append, remove } = useControlledFieldArray<R>({ name: 'items', formAPI, softDelete: true });\n\n  const submitCallback = async (values: ReceiverFormValues<R>) => {\n    try {\n      await onSubmit({\n        ...values,\n        items: values.items.filter((item) => !item.__deleted),\n      });\n    } catch (e) {\n      if (e instanceof Error || isFetchError(e)) {\n        notifyApp.error('Failed to save the contact point', getErrorMessage(e));\n\n        const error = new Error('Failed to save the contact point');\n        error.cause = e;\n        logError(error);\n      }\n      throw e;\n    }\n  };\n\n  const onInvalid: SubmitErrorHandler<ReceiverFormValues<R>> = () => {\n    notifyApp.error('There are errors in the form. Please correct them and try again!');\n  };\n\n  return (\n    <FormProvider {...formAPI}>\n      {showDefaultRouteWarning && (\n        <Alert severity=\"warning\" title={t('alerting.receiver-form.title-attention', 'Attention')}>\n          <Trans i18nKey=\"alerting.receiver-form.body-attention\">\n            Because there is no default policy configured yet, this contact point will automatically be set as default.\n          </Trans>\n        </Alert>\n      )}\n\n      <form onSubmit={handleSubmit(submitCallback, onInvalid)} className={styles.wrapper}>\n        <Stack justifyContent=\"space-between\" alignItems=\"center\">\n          <h2 className={styles.heading}>\n            {!isEditable && t('alerting.receiver-form.contact-point', 'Contact point')}\n            {isEditable && initialValues && t('alerting.receiver-form.contact-point-update', 'Update contact point')}\n            {isEditable && !initialValues && t('alerting.receiver-form.contact-point-create', 'Create contact point')}\n          </h2>\n          {canManagePermissions && contactPointId && (\n            <ManagePermissions\n              resource=\"receivers\"\n              resourceId={contactPointId}\n              resourceName={initialValues?.name}\n              title={t(\n                'alerting.receiver-form.title-manage-contact-point-permissions',\n                'Manage contact point permissions'\n              )}\n            />\n          )}\n        </Stack>\n        <Field\n          label={t('alerting.receiver-form.label-name', 'Name')}\n          invalid={!!errors.name}\n          error={errors.name && errors.name.message}\n          required\n        >\n          <Input\n            readOnly={!isEditable}\n            id=\"name\"\n            {...register('name', {\n              required: 'Name is required',\n              validate: async (value) => {\n                const existingValue = initialValues?.name;\n                return validateContactPointName(value, existingValue);\n              },\n            })}\n            width={39}\n            placeholder={t('alerting.receiver-form.name-placeholder-name', 'Name')}\n          />\n        </Field>\n        {fields.map((field, index) => {\n          const pathPrefix = `items.${index}.` as const;\n          if (field.__deleted) {\n            return <DeletedSubForm key={field.__id} pathPrefix={pathPrefix} />;\n          }\n          const initialItem = initialValues?.items.find(({ __id }) => __id === field.__id);\n          return (\n            <ChannelSubForm<R>\n              defaultValues={field}\n              initialValues={initialItem}\n              key={field.__id}\n              integrationIndex={index}\n              onDuplicate={() => {\n                const currentValues: R = getValues().items[index];\n                append({ ...currentValues, __id: String(Math.random()) });\n              }}\n              onTest={\n                onTestChannel\n                  ? () => {\n                      const currentValues: R = getValues().items[index];\n                      onTestChannel(currentValues);\n                    }\n                  : undefined\n              }\n              onDelete={() => remove(index)}\n              pathPrefix={pathPrefix}\n              notifiers={notifiers}\n              errors={errors?.items?.[index] as FieldErrors<R>}\n              commonSettingsComponent={commonSettingsComponent}\n              isEditable={isEditable}\n              isTestable={isTestable}\n              customValidators={customValidators ? customValidators[field.type] : undefined}\n            />\n          );\n        })}\n        {isEditable && (\n          <Button\n            type=\"button\"\n            icon=\"plus\"\n            variant=\"secondary\"\n            onClick={() => append({ ...defaultItem, __id: String(Math.random()) })}\n          >\n            <Trans i18nKey=\"alerting.receiver-form.add-contact-point-integration\">Add contact point integration</Trans>\n          </Button>\n        )}\n        <div className={styles.buttons}>\n          {isEditable && (\n            <>\n              {isSubmitting && (\n                <Button disabled={true} icon=\"spinner\" variant=\"primary\">\n                  <Trans i18nKey=\"alerting.receiver-form.saving\">Saving...</Trans>\n                </Button>\n              )}\n              {!isSubmitting && (\n                <Button type=\"submit\">\n                  <Trans i18nKey=\"alerting.receiver-form.save-contact-point\">Save contact point</Trans>\n                </Button>\n              )}\n            </>\n          )}\n          <LinkButton\n            disabled={isSubmitting}\n            variant=\"secondary\"\n            data-testid=\"cancel-button\"\n            href={makeAMLink('/alerting/notifications', alertManagerSourceName)}\n          >\n            <Trans i18nKey=\"alerting.common.cancel\">Cancel</Trans>\n          </LinkButton>\n        </div>\n      </form>\n    </FormProvider>\n  );\n}\n\nconst getStyles = (theme: GrafanaTheme2) => ({\n  heading: css({\n    margin: theme.spacing(2, 0, 3, 0),\n  }),\n  buttons: css({\n    marginTop: theme.spacing(4),\n\n    '& > * + *': {\n      marginLeft: theme.spacing(1),\n    },\n  }),\n  wrapper: css({\n    maxWidth: `${theme.breakpoints.values.xl}px`,\n  }),\n});\n\nfunction getErrorMessage(error: unknown) {\n  if (isOnCallFetchError(error)) {\n    return error.data.detail;\n  }\n\n  return getMessageFromError(error);\n}\n","import { useFormContext } from 'react-hook-form';\n\nimport { t } from '@grafana/i18n';\nimport { Checkbox, Field } from '@grafana/ui';\n\nimport { CommonSettingsComponentProps } from '../../../types/receiver-form';\n\nexport const CloudCommonChannelSettings = ({\n  pathPrefix,\n  className,\n  readOnly = false,\n}: CommonSettingsComponentProps) => {\n  const { register } = useFormContext();\n\n  return (\n    <div className={className}>\n      <Field disabled={readOnly}>\n        <Checkbox\n          {...register(`${pathPrefix}sendResolved`)}\n          label={t('alerting.cloud-common-channel-settings.label-send-resolved', 'Send resolved')}\n          disabled={readOnly}\n          description={t(\n            'alerting.cloud-common-channel-settings.description-whether-notify-about-resolved-alerts',\n            'Whether or not to notify about resolved alerts.'\n          )}\n        />\n      </Field>\n    </div>\n  );\n};\n","import { useMemo } from 'react';\n\nimport { Trans, t } from '@grafana/i18n';\nimport { locationService } from '@grafana/runtime';\nimport { Alert } from '@grafana/ui';\nimport { alertmanagerApi } from 'app/features/alerting/unified/api/alertmanagerApi';\nimport {\n  useCreateContactPoint,\n  useUpdateContactPoint,\n} from 'app/features/alerting/unified/components/contact-points/useContactPoints';\nimport { Receiver } from 'app/plugins/datasource/alertmanager/types';\n\nimport { CloudChannelMap, CloudChannelValues, ReceiverFormValues } from '../../../types/receiver-form';\nimport { cloudNotifierTypes } from '../../../utils/cloud-alertmanager-notifier-types';\nimport { isVanillaPrometheusAlertManagerDataSource } from '../../../utils/datasource';\nimport { cloudReceiverToFormValues, formValuesToCloudReceiver } from '../../../utils/receiver-form';\n\nimport { CloudCommonChannelSettings } from './CloudCommonChannelSettings';\nimport { ReceiverForm } from './ReceiverForm';\nimport { Notifier } from './notifiers';\n\ninterface Props {\n  alertManagerSourceName: string;\n  contactPoint?: Receiver;\n  readOnly?: boolean;\n  editMode?: boolean;\n}\n\nconst defaultChannelValues: CloudChannelValues = Object.freeze({\n  __id: '',\n  sendResolved: true,\n  secureSettings: {},\n  settings: {},\n  secureFields: {},\n  type: 'email',\n});\n\nconst cloudNotifiers = cloudNotifierTypes.map<Notifier>((n) => ({ dto: n }));\nconst { useGetAlertmanagerConfigurationQuery } = alertmanagerApi;\n\nexport const CloudReceiverForm = ({ contactPoint, alertManagerSourceName, readOnly = false, editMode }: Props) => {\n  const { isLoading, data: config } = useGetAlertmanagerConfigurationQuery(alertManagerSourceName);\n\n  const isVanillaAM = isVanillaPrometheusAlertManagerDataSource(alertManagerSourceName);\n  const [createContactPoint] = useCreateContactPoint({ alertmanager: alertManagerSourceName });\n  const [updateContactPoint] = useUpdateContactPoint({ alertmanager: alertManagerSourceName });\n\n  // transform receiver DTO to form values\n  const [existingValue] = useMemo((): [ReceiverFormValues<CloudChannelValues> | undefined, CloudChannelMap] => {\n    if (!contactPoint) {\n      return [undefined, {}];\n    }\n    return cloudReceiverToFormValues(contactPoint, cloudNotifierTypes);\n  }, [contactPoint]);\n\n  const onSubmit = async (values: ReceiverFormValues<CloudChannelValues>) => {\n    const newReceiver = formValuesToCloudReceiver(values, defaultChannelValues);\n\n    try {\n      if (editMode && contactPoint) {\n        await updateContactPoint.execute({ contactPoint: newReceiver, originalName: contactPoint.name });\n      } else {\n        await createContactPoint.execute({ contactPoint: newReceiver });\n      }\n      locationService.push('/alerting/notifications');\n    } catch (error) {\n      // React form validation will handle this for us\n    }\n  };\n\n  // this basically checks if we can manage the selected alert manager data source, either because it's a Grafana Managed one\n  // or a Mimir-based AlertManager\n  const isManageableAlertManagerDataSource = !readOnly && !isVanillaAM;\n\n  return (\n    <>\n      {!isVanillaAM && (\n        <Alert title={t('alerting.cloud-receiver-form.title-info', 'Info')} severity=\"info\">\n          <Trans i18nKey=\"alerting.cloud-receiver-form.body-info\">\n            Note that empty string values will be replaced with global defaults where appropriate.\n          </Trans>\n        </Alert>\n      )}\n      <ReceiverForm<CloudChannelValues>\n        showDefaultRouteWarning={!isLoading && !config?.alertmanager_config.route}\n        isEditable={isManageableAlertManagerDataSource}\n        isTestable={isManageableAlertManagerDataSource}\n        onSubmit={onSubmit}\n        initialValues={existingValue}\n        notifiers={cloudNotifiers}\n        alertManagerSourceName={alertManagerSourceName}\n        defaultItem={defaultChannelValues}\n        commonSettingsComponent={CloudCommonChannelSettings}\n      />\n    </>\n  );\n};\n","import { useFormContext } from 'react-hook-form';\n\nimport { t } from '@grafana/i18n';\nimport { Checkbox, Field } from '@grafana/ui';\n\nimport { CommonSettingsComponentProps } from '../../../types/receiver-form';\n\nexport const GrafanaCommonChannelSettings = ({\n  pathPrefix,\n  className,\n  readOnly = false,\n}: CommonSettingsComponentProps) => {\n  const { register } = useFormContext();\n\n  return (\n    <div className={className}>\n      <Field>\n        <Checkbox\n          {...register(`${pathPrefix}disableResolveMessage`)}\n          label={t(\n            'alerting.grafana-common-channel-settings.label-disable-resolved-message',\n            'Disable resolved message'\n          )}\n          description={t(\n            'alerting.grafana-common-channel-settings.description-disable-resolved-message',\n            'Disable the resolve message [OK] that is sent when alerting state returns to false'\n          )}\n          disabled={readOnly}\n        />\n      </Field>\n    </div>\n  );\n};\n","import { css } from '@emotion/css';\nimport { useState } from 'react';\nimport { FormProvider, useForm } from 'react-hook-form';\n\nimport { GrafanaTheme2 } from '@grafana/data';\nimport { Trans, t } from '@grafana/i18n';\nimport { Button, Label, Modal, RadioButtonGroup, useStyles2 } from '@grafana/ui';\nimport { TestReceiversAlert } from 'app/plugins/datasource/alertmanager/types';\nimport { Annotations, Labels } from 'app/types/unified-alerting-dto';\n\nimport { defaultAnnotations } from '../../../utils/constants';\nimport AnnotationsStep from '../../rule-editor/AnnotationsStep';\nimport LabelsField from '../../rule-editor/labels/LabelsField';\n\ninterface Props {\n  isOpen: boolean;\n  onDismiss: () => void;\n  onTest: (alert?: TestReceiversAlert) => void;\n}\n\ntype AnnoField = {\n  key: string;\n  value: string;\n};\n\ninterface FormFields {\n  annotations: AnnoField[];\n  labels: AnnoField[];\n}\n\nenum NotificationType {\n  predefined = 'Predefined',\n  custom = 'Custom',\n}\n\nconst notificationOptions = Object.values(NotificationType).map((value) => ({ label: value, value: value }));\n\nconst defaultValues: FormFields = {\n  annotations: [...defaultAnnotations],\n  labels: [{ key: '', value: '' }],\n};\n\nexport const TestContactPointModal = ({ isOpen, onDismiss, onTest }: Props) => {\n  const [notificationType, setNotificationType] = useState<NotificationType>(NotificationType.predefined);\n  const styles = useStyles2(getStyles);\n  const formMethods = useForm<FormFields>({ defaultValues, mode: 'onBlur' });\n\n  const onSubmit = (data: FormFields) => {\n    if (notificationType === NotificationType.custom) {\n      const alert = {\n        annotations: data.annotations\n          .filter(({ key, value }) => !!key && !!value)\n          .reduce<Annotations>((acc, { key, value }) => {\n            return { ...acc, [key]: value };\n          }, {}),\n        labels: data.labels\n          .filter(({ key, value }) => !!key && !!value)\n          .reduce<Labels>((acc, { key, value }) => {\n            return { ...acc, [key]: value };\n          }, {}),\n      };\n      onTest(alert);\n    } else {\n      onTest();\n    }\n  };\n\n  return (\n    <Modal\n      onDismiss={onDismiss}\n      isOpen={isOpen}\n      title={t('alerting.test-contact-point-modal.title-test-contact-point', 'Test contact point')}\n    >\n      <div className={styles.section}>\n        <Label>\n          <Trans i18nKey=\"alerting.test-contact-point-modal.notification-message\">Notification message</Trans>\n        </Label>\n        <RadioButtonGroup\n          options={notificationOptions}\n          value={notificationType}\n          onChange={(value) => setNotificationType(value)}\n        />\n      </div>\n\n      <FormProvider {...formMethods}>\n        <form onSubmit={formMethods.handleSubmit(onSubmit)}>\n          {notificationType === NotificationType.predefined && (\n            <div className={styles.section}>\n              <Trans i18nKey=\"alerting.test-contact-point-modal.predefined-notification-message\">\n                You will send a test notification that uses a predefined alert. If you have defined a custom template or\n                message, for better results switch to <strong>custom</strong> notification message, from above.\n              </Trans>\n            </div>\n          )}\n          {notificationType === NotificationType.custom && (\n            <>\n              <div className={styles.section}>\n                <Trans i18nKey=\"alerting.test-contact-point-modal.custom-notification-message\">\n                  You will send a test notification that uses the annotations defined below. This is a good option if\n                  you use custom templates and messages.\n                </Trans>\n              </div>\n              <div className={styles.section}>\n                <AnnotationsStep />\n              </div>\n              <div className={styles.section}>\n                <LabelsField />\n              </div>\n            </>\n          )}\n\n          <Modal.ButtonRow>\n            <Button type=\"submit\">\n              <Trans i18nKey=\"alerting.test-contact-point-modal.send-test-notification\">Send test notification</Trans>\n            </Button>\n          </Modal.ButtonRow>\n        </form>\n      </FormProvider>\n    </Modal>\n  );\n};\n\nconst getStyles = (theme: GrafanaTheme2) => ({\n  flexRow: css({\n    display: 'flex',\n    flexDirection: 'row',\n    alignItems: 'flex-start',\n    marginBottom: theme.spacing(1),\n  }),\n  section: css({\n    marginBottom: theme.spacing(2),\n  }),\n});\n","import { useMemo, useState } from 'react';\n\nimport { Trans, t } from '@grafana/i18n';\nimport { locationService } from '@grafana/runtime';\nimport { Alert, LoadingPlaceholder } from '@grafana/ui';\nimport {\n  useCreateContactPoint,\n  useUpdateContactPoint,\n} from 'app/features/alerting/unified/components/contact-points/useContactPoints';\nimport { showManageContactPointPermissions } from 'app/features/alerting/unified/components/contact-points/utils';\nimport { GRAFANA_RULES_SOURCE_NAME } from 'app/features/alerting/unified/utils/datasource';\nimport { canEditEntity } from 'app/features/alerting/unified/utils/k8s/utils';\nimport {\n  GrafanaManagedContactPoint,\n  GrafanaManagedReceiverConfig,\n  TestReceiversAlert,\n} from 'app/plugins/datasource/alertmanager/types';\nimport { useDispatch } from 'app/types/store';\n\nimport { alertmanagerApi } from '../../../api/alertmanagerApi';\nimport { testReceiversAction } from '../../../state/actions';\nimport { GrafanaChannelValues, ReceiverFormValues } from '../../../types/receiver-form';\nimport {\n  formChannelValuesToGrafanaChannelConfig,\n  formValuesToGrafanaReceiver,\n  grafanaReceiverToFormValues,\n} from '../../../utils/receiver-form';\nimport { ProvisionedResource, ProvisioningAlert } from '../../Provisioning';\nimport { ReceiverTypes } from '../grafanaAppReceivers/onCall/onCall';\nimport { useOnCallIntegration } from '../grafanaAppReceivers/onCall/useOnCallIntegration';\n\nimport { GrafanaCommonChannelSettings } from './GrafanaCommonChannelSettings';\nimport { ReceiverForm } from './ReceiverForm';\nimport { TestContactPointModal } from './TestContactPointModal';\nimport { Notifier } from './notifiers';\n\nconst defaultChannelValues: GrafanaChannelValues = Object.freeze({\n  __id: '',\n  secureSettings: {},\n  settings: {},\n  secureFields: {},\n  disableResolveMessage: false,\n  type: 'email',\n});\n\ninterface Props {\n  contactPoint?: GrafanaManagedContactPoint;\n  readOnly?: boolean;\n  editMode?: boolean;\n}\n\nconst { useGrafanaNotifiersQuery } = alertmanagerApi;\n\nexport const GrafanaReceiverForm = ({ contactPoint, readOnly = false, editMode }: Props) => {\n  const dispatch = useDispatch();\n  const [createContactPoint] = useCreateContactPoint({\n    alertmanager: GRAFANA_RULES_SOURCE_NAME,\n  });\n  const [updateContactPoint] = useUpdateContactPoint({\n    alertmanager: GRAFANA_RULES_SOURCE_NAME,\n  });\n\n  const {\n    onCallNotifierMeta,\n    extendOnCallNotifierFeatures,\n    extendOnCallReceivers,\n    onCallFormValidators,\n    isLoadingOnCallIntegration,\n    hasOnCallError,\n  } = useOnCallIntegration();\n\n  const { data: grafanaNotifiers = [], isLoading: isLoadingNotifiers } = useGrafanaNotifiersQuery();\n\n  const [testChannelValues, setTestChannelValues] = useState<GrafanaChannelValues>();\n\n  // transform receiver DTO to form values\n  const [existingValue, id2original] = useMemo((): [\n    ReceiverFormValues<GrafanaChannelValues> | undefined,\n    Record<string, GrafanaManagedReceiverConfig>,\n  ] => {\n    if (!contactPoint || isLoadingNotifiers || isLoadingOnCallIntegration) {\n      return [undefined, {}];\n    }\n\n    return grafanaReceiverToFormValues(extendOnCallReceivers(contactPoint));\n  }, [contactPoint, isLoadingNotifiers, extendOnCallReceivers, isLoadingOnCallIntegration]);\n\n  const onSubmit = async (values: ReceiverFormValues<GrafanaChannelValues>) => {\n    const newReceiver = formValuesToGrafanaReceiver(values, id2original, defaultChannelValues);\n\n    try {\n      if (editMode) {\n        if (contactPoint && contactPoint.id) {\n          await updateContactPoint.execute({\n            contactPoint: newReceiver,\n            id: contactPoint.id,\n            resourceVersion: contactPoint?.metadata?.resourceVersion,\n          });\n        } else if (contactPoint) {\n          await updateContactPoint.execute({\n            contactPoint: newReceiver,\n            originalName: contactPoint.name,\n          });\n        }\n      } else {\n        await createContactPoint.execute({ contactPoint: newReceiver });\n      }\n      locationService.push('/alerting/notifications');\n    } catch (error) {\n      // React form validation will handle this for us\n    }\n  };\n\n  const onTestChannel = (values: GrafanaChannelValues) => {\n    setTestChannelValues(values);\n  };\n\n  const testNotification = (alert?: TestReceiversAlert) => {\n    if (testChannelValues) {\n      const existing: GrafanaManagedReceiverConfig | undefined = id2original[testChannelValues.__id];\n      const chan = formChannelValuesToGrafanaChannelConfig(testChannelValues, defaultChannelValues, 'test', existing);\n\n      const payload = {\n        alertManagerSourceName: GRAFANA_RULES_SOURCE_NAME,\n        receivers: [\n          {\n            name: 'test',\n            grafana_managed_receiver_configs: [chan],\n          },\n        ],\n        alert,\n      };\n\n      dispatch(testReceiversAction(payload));\n    }\n  };\n\n  // If there is no contact point it means we're creating a new one, so scoped permissions doesn't exist yet\n  const hasScopedEditPermissions = contactPoint ? canEditEntity(contactPoint) : true;\n  const isEditable = !readOnly && hasScopedEditPermissions && !contactPoint?.provisioned;\n  const isTestable = !readOnly;\n\n  if (isLoadingNotifiers || isLoadingOnCallIntegration) {\n    return (\n      <LoadingPlaceholder text={t('alerting.grafana-receiver-form.text-loading-notifiers', 'Loading notifiers...')} />\n    );\n  }\n\n  const notifiers: Notifier[] = grafanaNotifiers.map((n) => {\n    if (n.type === ReceiverTypes.OnCall) {\n      return {\n        dto: extendOnCallNotifierFeatures(n),\n        meta: onCallNotifierMeta,\n      };\n    }\n\n    return { dto: n };\n  });\n\n  return (\n    <>\n      {hasOnCallError && (\n        <Alert\n          severity=\"error\"\n          title={t(\n            'alerting.grafana-receiver-form.title-loading-on-call-integration-failed',\n            'Loading OnCall integration failed'\n          )}\n        >\n          <Trans i18nKey=\"alerting.grafana-receiver-form.body-loading-on-call-integration-failed\">\n            Grafana OnCall plugin has been enabled in your Grafana instances but it is not reachable. Please check the\n            plugin configuration\n          </Trans>\n        </Alert>\n      )}\n\n      {contactPoint?.provisioned && <ProvisioningAlert resource={ProvisionedResource.ContactPoint} />}\n\n      <ReceiverForm<GrafanaChannelValues>\n        contactPointId={contactPoint?.id}\n        isEditable={isEditable}\n        isTestable={isTestable}\n        onSubmit={onSubmit}\n        initialValues={existingValue}\n        onTestChannel={onTestChannel}\n        notifiers={notifiers}\n        alertManagerSourceName={GRAFANA_RULES_SOURCE_NAME}\n        defaultItem={{ ...defaultChannelValues }}\n        commonSettingsComponent={GrafanaCommonChannelSettings}\n        customValidators={{ [ReceiverTypes.OnCall]: onCallFormValidators }}\n        canManagePermissions={\n          editMode && contactPoint && showManageContactPointPermissions(GRAFANA_RULES_SOURCE_NAME, contactPoint)\n        }\n      />\n      <TestContactPointModal\n        onDismiss={() => setTestChannelValues(undefined)}\n        isOpen={!!testChannelValues}\n        onTest={(alert) => testNotification(alert)}\n      />\n    </>\n  );\n};\n"],"names":["ChannelOptions","defaultValues","selectedChannelOptions","onResetSecureField","onDeleteSubform","errors","integrationPrefix","readOnly","customValidators","watch","settings","secureFields","settingsPath","getOptionMeta","option","determineRequired","determineReadOnly","index","key","selectedOptionValue","Field","SecretInput","error","defaultValue","OptionField","ChannelSubForm","initialValues","pathPrefix","integrationIndex","onDuplicate","onDelete","onTest","notifiers","CommonSettingsComponent","isEditable","isTestable","styles","getStyles","control","register","trigger","formState","setValue","getValues","channelFieldPath","typeFieldPath","settingsFieldPath","selectedType","parse_mode","testingReceiver","useUnifiedAlertingSelector","state","isTestAvailable","subscription","formValues","name","type","value","currentSecureFields","findSecureFieldsRecursively","options","fieldPath","typeOptions","dto","meta","Stack","handleTest","notifier","showTelegramWarning","mandatoryOptions","o","optionalOptions","contactPointTypeInputId","ref","onChange","field","Select","Button","Alert","Text","CollapsibleSection","theme","DeletedSubForm","normalizeFormValues","values","item","normalizeHTTPConfig","config","isDeprecatedHTTPAuthConfig","prop","ReceiverForm","defaultItem","alertManagerSourceName","onSubmit","onTestChannel","commonSettingsComponent","showDefaultRouteWarning","contactPointId","canManagePermissions","notifyApp","validateContactPointName","formAPI","useCleanup","handleSubmit","isSubmitting","fields","append","remove","useControlledFieldArray","submitCallback","e","getErrorMessage","onInvalid","ManagePermissions","Input","existingValue","initialItem","__id","currentValues","CloudCommonChannelSettings","className","Checkbox","defaultChannelValues","cloudNotifiers","n","useGetAlertmanagerConfigurationQuery","alertmanagerApi","CloudReceiverForm","contactPoint","editMode","isLoading","isVanillaAM","createContactPoint","updateContactPoint","newReceiver","isManageableAlertManagerDataSource","GrafanaCommonChannelSettings","NotificationType","notificationOptions","TestContactPointModal","isOpen","onDismiss","notificationType","setNotificationType","formMethods","data","alert","acc","Modal","Label","RadioButtonGroup","AnnotationsStep","LabelsField","useGrafanaNotifiersQuery","GrafanaReceiverForm","dispatch","onCallNotifierMeta","extendOnCallNotifierFeatures","extendOnCallReceivers","onCallFormValidators","isLoadingOnCallIntegration","hasOnCallError","useOnCallIntegration","grafanaNotifiers","isLoadingNotifiers","testChannelValues","setTestChannelValues","id2original","testNotification","existing","chan","payload","hasScopedEditPermissions","LoadingPlaceholder","Provisioning"],"sourceRoot":""}