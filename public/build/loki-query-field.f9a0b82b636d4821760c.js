"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[1952],{20027:(j,I)=>{var c;c={value:!0},I.xN=I.r0=void 0,I.r0={wordPattern:/(-?\d*\.\d\w*)|([^`~!#%^&*()\-=+\[{\]}\\|;:'",.<>\/?\s]+)/g,comments:{lineComment:"#"},brackets:[["{","}"],["[","]"],["(",")"]],autoClosingPairs:[{open:"{",close:"}"},{open:"[",close:"]"},{open:"(",close:")"},{open:'"',close:'"'},{open:"'",close:"'"},{open:"`",close:"`"}],surroundingPairs:[{open:"{",close:"}"},{open:"[",close:"]"},{open:"(",close:")"},{open:'"',close:'"'},{open:"'",close:"'"},{open:"`",close:"`"},{open:"<",close:">"}],folding:{}};var M=["sum","avg","min","max","stddev","stdvar","count","topk","bottomk"],w=["json","logfmt","regexp","unpack","pattern"],P=["line_format","label_format"],v=["count_over_time","rate","bytes_over_time","bytes_rate","avg_over_time","sum_over_time","min_over_time","max_over_time","stdvar_over_time","stddev_over_time","quantile_over_time","first_over_time","last_over_time","absent_over_time"],A=["by","without"],G="(".concat(A.reduce(function(U,H){return"".concat(U,"|").concat(H)}),")"),Q=["+","-","*","/","%","^","==","!=",">","<",">=","<=","|=","!=","|~","!~","and","or","unless","|"],o=M.concat(w).concat(P).concat(v).concat(A);I.xN={ignoreCase:!1,defaultToken:"",tokenPostfix:".logql",keywords:o,operators:Q,vectorMatching:G,symbols:/[=><!~?:&|+\-*\/^%]+/,escapes:/\\(?:[abfnrtv\\"']|x[0-9A-Fa-f]{1,4}|u[0-9A-Fa-f]{4}|U[0-9A-Fa-f]{8})/,digits:/\d+(_+\d+)*/,octaldigits:/[0-7]+(_+[0-7]+)*/,binarydigits:/[0-1]+(_+[0-1]+)*/,hexdigits:/[[0-9a-fA-F]+(_+[0-9a-fA-F]+)*/,integersuffix:/(ll|LL|u|U|l|L)?(ll|LL|u|U|l|L)?/,floatsuffix:/[fFlL]?/,tokenizer:{root:[[/@vectorMatching\s*(?=\()/,"type","@clauses"],[/[a-z_]\w*(?=\s*(=|!=|=~|!~))/,"tag"],[/(^#.*$)/,"comment"],[/[a-zA-Z_]\w*/,{cases:{"@keywords":"type","@default":"identifier"}}],[/"/,"string","@string_double"],[/'/,"string","@string_single"],[/`/,"string","@string_backtick"],{include:"@whitespace"},[/[{}()\[\]]/,"@brackets"],[/[<>](?!@symbols)/,"@brackets"],[/@symbols/,{cases:{"@operators":"delimiter","@default":""}}],[/\d+(?:\.\d)?(?:ms|ns|us|Âµs|[smhdwy])/,"number"],[/\d+(?:\.\d)?(?:b|kib|Kib|kb|KB|mib|Mib|mb|MB|gib|Gib|gb|GB|tib|Tib|tb|TB|pib|Pib|pb|PB|eib|Eib|eb|EB])/,"number"],[/\d*\d+[eE]([\-+]?\d+)?(@floatsuffix)/,"number.float"],[/\d*\.\d+([eE][\-+]?\d+)?(@floatsuffix)/,"number.float"],[/0[xX][0-9a-fA-F']*[0-9a-fA-F](@integersuffix)/,"number.hex"],[/0[0-7']*[0-7](@integersuffix)/,"number.octal"],[/0[bB][0-1']*[0-1](@integersuffix)/,"number.binary"],[/\d[\d']*\d(@integersuffix)/,"number"],[/\d(@integersuffix)/,"number"]],string_double:[[/\{\{(.*?)\}\}/,{token:"number"}],[/[^\\"]/,"string"],[/@escapes/,"string.escape"],[/\\./,"string.escape.invalid"],[/"/,"string","@pop"]],string_single:[[/[^\\']+/,"string"],[/@escapes/,"string.escape"],[/\\./,"string.escape.invalid"],[/'/,"string","@pop"]],string_backtick:[[/\{\{(.*?)\}\}/,{token:"number"}],[/[^\\`]/,"string"],[/@escapes/,"string.escape"],[/\\./,"string.escape.invalid"],[/`/,"string","@pop"]],clauses:[[/[^(,)]/,"tag"],[/\)/,"identifier","@pop"]],whitespace:[[/[ \t\r\n]+/,"white"]]}}},32833:(j,I,c)=>{c.r(I),c.d(I,{default:()=>at,defaultWordPattern:()=>st});var M=c(74848),w=c(22803),P=c(2543),v=c(96540),A=c(39554),G=c(24726),Q=c(51898),o=c(36195),U=c(20027),H=c(63142),ue=c(65232);function ce(){const e=new Map;return e.set("expandSuggestionDocs","true"),{onDidChangeValue:t=>{},onDidChangeTarget:t=>{},onWillSaveState:t=>{},get:(t,n,r)=>e.get(t)??r,getBoolean:(t,n,r)=>{const s=e.get(t);return s!==void 0?s==="true":r},getNumber:(t,n,r)=>{const s=e.get(t);return s!==void 0?parseInt(s,10):r},store:(t,n,r,s)=>{n==null?e.delete(t):e.set(t,n.toString())},remove:(t,n)=>{e.delete(t)},keys:(t,n)=>Array.from(e.keys()),logStorage:()=>{console.log("logStorage: not implemented")},migrate:()=>Promise.resolve(void 0),isNew:t=>!0,flush:t=>Promise.resolve(void 0)}}let de={storageService:ce()};function ge(){return de}var q=c(22420);class pe{constructor(t,n={current:[]},r){this.languageProvider=t,this.historyRef=n,this.timeRange=r,this.queryToLabelKeysCache=new Map}buildSelector(t){return`{${t.map(r=>`${r.name}${r.op}"${(0,q.Qn)(r.value)}"`).join(",")}}`}setTimeRange(t){this.timeRange=t,this.queryToLabelKeysCache.clear()}getHistory(){return(0,P.chain)(this.historyRef.current).orderBy("ts","desc").map(t=>t.query.expr.trim()).filter().uniq().value()}async getLabelNames(t=[]){if(t.length===0)return await this.languageProvider.start(this.timeRange),this.languageProvider.getLabelKeys();const n=await this.languageProvider.fetchLabels({streamSelector:this.buildSelector(t),timeRange:this.timeRange}),r=new Set(t.map(s=>s.name));return n.filter(s=>!r.has(s))}async getLabelValues(t,n){return await this.languageProvider.fetchLabelValues(t,{streamSelector:this.buildSelector(n),timeRange:this.timeRange})}async getParserAndLabelKeys(t){const r=this.queryToLabelKeysCache.has(t)?this.queryToLabelKeysCache.get(t):null;if(r)return r;{if(this.queryToLabelKeysCache.size>=2){const a=this.queryToLabelKeysCache.keys().next().value;a!==void 0&&this.queryToLabelKeysCache.delete(a)}const s=await this.languageProvider.getParserAndLabelKeys(t,{timeRange:this.timeRange});return this.queryToLabelKeysCache.set(t,s),s}}}class X extends Error{constructor(t){super(`Unexpected case in switch statement: ${JSON.stringify(t)}`)}}var S=c(24162),E=c(38903),L=c(95826),V=c(77236);const fe=[{type:"PATTERN",label:"{}",insertText:"{$0}",isSnippet:!0,triggerOnInsert:!0}],Y=V.dZ.map(e=>({type:"FUNCTION",label:e.label,insertText:`${e.insertText??""}($0)`,isSnippet:!0,triggerOnInsert:!0,detail:e.detail,documentation:e.documentation})),J=V.RQ.map(e=>({type:"FUNCTION",label:e.label,insertText:`${e.insertText??""}({$0}[\\$__auto])`,isSnippet:!0,triggerOnInsert:!0,detail:e.detail,documentation:e.documentation})),me=V.fV.map(e=>({type:"FUNCTION",label:e.label,insertText:`${e.insertText??""}($0)`,isSnippet:!0,triggerOnInsert:!0,detail:e.detail,documentation:e.documentation})),he=["$__auto","1m","5m","10m","30m","1h","1d"].map(e=>({type:"DURATION",label:e,insertText:e})),ye=[{type:"FUNCTION",label:"duration_seconds",documentation:"Will convert the label value in seconds from the go duration format (e.g 5m, 24s30ms).",insertText:"duration_seconds()"},{type:"FUNCTION",label:"duration",documentation:"Short version of duration_seconds().",insertText:"duration()"},{type:"FUNCTION",label:"bytes",documentation:"Will convert the label value to raw bytes applying the bytes unit (e.g. 5 MiB, 3k, 1G).",insertText:"bytes()"}],Ee=[{type:"FUNCTION",label:"--strict",documentation:"Strict parsing. The logfmt parser stops scanning the log line and returns early with an error when it encounters any poorly formatted key/value pair.",insertText:"--strict"},{type:"FUNCTION",label:"--keep-empty",documentation:"Retain standalone keys with empty value. The logfmt parser retains standalone keys (keys without a value) as labels with value set to empty string.",insertText:"--keep-empty"}],Le=[{operator:"|=",documentation:(0,E.y6)(L.EF.LineContains),afterPipe:!0},{operator:"!=",documentation:(0,E.y6)(L.EF.LineContainsNot)},{operator:"|~",documentation:(0,E.y6)(L.EF.LineMatchesRegex),afterPipe:!0},{operator:"!~",documentation:(0,E.y6)(L.EF.LineMatchesRegexNot)}];function be(e){return Le.filter(t=>!e||t.afterPipe).map(({operator:t,documentation:n})=>({type:"LINE_FILTER",label:`${t} ""`,insertText:`${e?t.replace("|",""):t} "$0"`,isSnippet:!0,documentation:n}))}function Z(e=""){const t=[];return t.push({type:"PIPE_OPERATION",label:"line_format",insertText:`${e}line_format "{{.$0}}"`,isSnippet:!0,documentation:(0,E.y6)(L.EF.LineFormat)}),t.push({type:"PIPE_OPERATION",label:"label_format",insertText:`${e}label_format`,isSnippet:!0,documentation:(0,E.y6)(L.EF.LabelFormat)}),t.push({type:"PIPE_OPERATION",label:"unwrap",insertText:`${e}unwrap`,documentation:(0,E.y6)(L.EF.Unwrap)}),t.push({type:"PIPE_OPERATION",label:"decolorize",insertText:`${e}decolorize`,documentation:(0,E.y6)(L.EF.Decolorize)}),t.push({type:"PIPE_OPERATION",label:"drop",insertText:`${e}drop`,documentation:(0,E.y6)(L.EF.Drop)}),t.push({type:"PIPE_OPERATION",label:"keep",insertText:`${e}keep`,documentation:(0,E.y6)(L.EF.Keep)}),t}async function Ne(e){return(await e.getHistory()).map(n=>({type:"HISTORY",label:n,insertText:n}))}async function Te(e,t){return(await t.getLabelNames(e)).map(r=>({type:"LABEL_NAME",label:r,insertText:`${r}=`,triggerOnInsert:!0}))}async function ve(e,t){const{extractedLabelKeys:n}=await t.getParserAndLabelKeys(e);return n.map(r=>({type:"LABEL_NAME",label:r,insertText:r,triggerOnInsert:!1}))}const Ce=["json","logfmt","pattern","regexp","unpack"];async function ee(e,t,n,r,s,i){const a=new Set(Ce),l=[],m=s.some(d=>d==="level");if(t){const d=i?"":" (detected)";r?(a.delete("unpack"),l.push({type:"PARSER",label:`unpack${d}`,insertText:`${e}unpack`,documentation:(0,E.y6)(L.EF.Unpack)})):(a.delete("json"),l.push({type:"PARSER",label:`json${d}`,insertText:`${e}json`,documentation:m?"Use it to get log-levels in the histogram":(0,E.y6)(L.EF.Json)}))}if(n){a.delete("logfmt");const d=i?"":" (detected)";l.push({type:"PARSER",label:`logfmt${d}`,insertText:`${e}logfmt`,documentation:m?"Get detected levels in the histogram":(0,E.y6)(L.EF.Logfmt)})}return Array.from(a).sort().forEach(d=>{l.push({type:"PARSER",label:d,insertText:`${e}${d}`,documentation:(0,E.y6)(d)})}),l}async function Ae(e,t,n,r){let s=e;t&&(s=(0,P.trimEnd)(e,"| "));const{extractedLabelKeys:i,structuredMetadataKeys:a,hasJSON:l,hasLogfmt:m,hasPack:y}=await r.getParserAndLabelKeys(s),d=(0,S.MX)(s).queryWithParser,b=`${n?"":" "}${t?"":"| "}`,h=await ee(b,l,m,y,i,d),R=Z(b),C=[...h,...R];return a.forEach(T=>{C.push({type:"LABEL_NAME",label:`${T} (detected)`,insertText:`${b}${T}`,documentation:`"${T}" was suggested based on structured metadata attached to your loglines.`})}),d&&i.forEach(T=>{C.push({type:"LABEL_NAME",label:`${T} (detected)`,insertText:`${b}${T}`,documentation:`"${T}" was suggested based on the content of your log lines for the label filter expression.`})}),d?[...C]:[...t&&n?[]:be(t),...C]}async function Re(e,t,n,r,s,i){let a=[];n&&(e=(0,P.trimEnd)(e,", "));const{extractedLabelKeys:l,hasJSON:m,hasLogfmt:y,hasPack:d}=await i.getParserAndLabelKeys(e),b=Z("| ");if(!n&&!t&&(a=[...Ee]),!n&&r){const u=s.length>0?await ee("| ",m,y,d,l,!0):[];a=[...a,...u,...b]}const h=l.filter(u=>!s.includes(u));let R="";s.length>0&&r&&(R=n?"":", ");const C=h.map(u=>({type:"LABEL_NAME",label:u,insertText:R+u,triggerOnInsert:!1}));return a=[...a,...C],a}async function Ie(e,t,n,r){return(await r.getLabelValues(e,n)).map(i=>({type:"LABEL_VALUE",label:i,insertText:t?(0,q.Qn)(i):`"${(0,q.Qn)(i)}"`}))}async function Oe(e,t){const{unwrapLabelKeys:n}=await t.getParserAndLabelKeys(e);return[...n.map(s=>({type:"LABEL_NAME",label:s,insertText:s,triggerOnInsert:!1})),...ye]}async function Pe(e,t){const{extractedLabelKeys:n}=await t.getParserAndLabelKeys(e);return[...n.map(s=>({type:"LABEL_NAME",label:s,insertText:s,triggerOnInsert:!1}))]}async function Se(e,t){switch(e.type){case"EMPTY":case"AT_ROOT":return[...await Ne(t),...fe,...Y,...me,...J];case"IN_RANGE":return he;case"IN_GROUPING":return ve(e.logQuery,t);case"IN_LABEL_SELECTOR_NO_LABEL_NAME":return Te(e.otherLabels,t);case"IN_LABEL_SELECTOR_WITH_LABEL_NAME":return Ie(e.labelName,e.betweenQuotes,e.otherLabels,t);case"AFTER_SELECTOR":return Ae(e.logQuery,e.afterPipe,e.hasSpace,t);case"AFTER_UNWRAP":return Oe(e.logQuery,t);case"IN_AGGREGATION":return[...J,...Y];case"AFTER_KEEP_AND_DROP":return Pe(e.logQuery,t);case"IN_LOGFMT":return Re(e.logQuery,e.flags,e.trailingComma,e.trailingSpace,e.otherLabels,t);default:throw new X(e)}}function _e(e,t){return e[t]}function xe(e,t){let r=g(e,t);for(;r;){let s=g(r,t);if(s)r=s;else return r}return null}function g(e,t){let n=e;for(const[r,s]of t)if(n=_e(n,r),n===null||n.type.id!==s)return null;return n}function B(e,t){return t.slice(e.from,e.to)}function Me(e){const t=e.slice(1,e.length-1);if(e.startsWith('"')&&e.endsWith('"'))return t.replace(/\\"/gm,'"');if(e.startsWith("'")&&e.endsWith("'"))return t.replace(/\\'/gm,"'");if(e.startsWith("`")&&e.endsWith("`"))return t;throw new Error(`Invalid string literal: ${e}`)}function we(e,t){return e.every((n,r)=>n===t[r])}const f=0,Fe=[{paths:[[o.MD],[o.MD,o.sq],[o.sq],[f,o.sq],[f,o.sq,o.MD]],fun:Ve},{paths:[[o.K0],[o.h1],[f,o.xo,o.h1],[f,o.I4],[o.xo],[f,o.I4],[o.I4],[o.Tz]],fun:We},{paths:[[o.K0],[f,o.MD]],fun:Ge},{paths:[[o.Qf,o.g$]],fun:ne},{paths:[[o.aU]],fun:ke},{paths:[[o.xo]],fun:He},{paths:[[f,o.g$],[f,o.sq,o.MD]],fun:ne},{paths:[[f,o.Q6]],fun:Qe},{paths:[[f,o.xo]],fun:qe},{paths:[[f,o.Nl,o.Yw,o.Rh]],fun:()=>({type:"IN_AGGREGATION"})},{paths:[[f,o.t3,o.AL],[o.t3,o.AL]],fun:Be},{paths:[[f,o.HV],[o.HV]],fun:Ue},{paths:[[f,o.i8],[f,o.LQ],[f,o.UP],[f,o.J3]],fun:ze}],Ke=new Map([["Eq","="],["Re","=~"],["Neq","!="],["Nre","!~"]]);function $e(e){return Ke.get(e.name)??null}function De(e,t){if(e.type.id!==o.g$)return null;const n=g(e,[["firstChild",o.gw]]);if(n===null)return null;const r=n.nextSibling;if(r===null)return null;const s=$e(r);if(s===null)return null;const i=g(e,[["lastChild",o.Qf]]);if(i===null)return null;const a=B(n,t),l=Me(B(i,t));return{name:a,value:l,op:s}}function te(e,t){if(e.type.id!==o.MD&&e.type.id!==o.sq)return[];let n=null;e?.parent?.type.id===o.MD?n=e:n=xe(e,[["parent",o.sq]])??g(e,[["firstChild",o.sq]])??g(e,[["lastChild",o.sq]]);const r=[];for(;n!==null;){const s=g(n,[["lastChild",o.g$]]);if(s!==null){const i=De(s,t);i!==null&&r.push(i)}n=g(n,[["firstChild",o.sq]])}return r.reverse(),r}function Ue(e,t,n){return{type:"AFTER_UNWRAP",logQuery:(0,S.g5)(t,n).trim()}}function Be(e,t,n){let r=null;return e.type.id===f?r=g(e,[["parent",o.t3],["parent",o.AL]]):e.type.id===o.t3&&(r=g(e,[["parent",o.AL]])),r?.parent?.type.id===o.UK||r?.parent?.type.id===o.xo?k(r.parent,t,n,!0):null}function ke(e,t,n){const r=g(e,[["parent",o.Rh]]);if(r===null)return null;const s=r.getChild("MetricExpr");return s===null||g(s,[["firstChild",o.h1],["lastChild",o.xo],["firstChild",o.MD]])===null?null:{type:"IN_GROUPING",logQuery:(0,S.g5)(t,n).trim()}}function ne(e,t,n){const r=!e.type.isError,s=g(e,[["parent",o.g$]]);if(s===null)return null;const i=g(s,[["firstChild",o.gw]]);if(i===null)return null;const a=B(i,t),l=g(s,[["parent",o.sq]]);if(l===null)return null;let m=l,y=null;for(;y===null;){const h=m.parent;if(h===null)return null;switch(h.type.id){case o.sq:m=h;continue;case o.MD:y=h;continue;default:return null}}const b=te(y,t).filter(h=>h.name!==a);return{type:"IN_LABEL_SELECTOR_WITH_LABEL_NAME",labelName:a,betweenQuotes:r,otherLabels:b}}function We(e,t,n){const r=o.K3.parse(t),s=t.substring(0,n).trimEnd().length,i=s<n?s:n,a=r.cursorAt(i),l=[o.c$,o.ov,o.Gn,o.I4];let m=!1;do{const{node:u}=a;if(l.includes(u.type.id)&&a.from<=i&&a.to>=i){m=!0;break}}while(a.next());if(!m)return null;const y=(0,S.QH)(t,[o.ov]).length>1,b=(0,S.QH)(t,[o.Gn]).map(u=>u.getChild(o.gw)).filter(u=>u!==null).map(u=>B(u,t)),h=(0,S.g5)(t,i).trim(),R=t.charAt(n-1)===" ",C=t.trimEnd().charAt(i-1)===",";return{type:"IN_LOGFMT",otherLabels:b,flags:y,trailingSpace:R,trailingComma:C,logQuery:h}}function Ge(e,t,n){const r=g(e,[["lastChild",o.GN],["lastChild",o.UK]]);return r!=null&&t.endsWith(" ")?k(r,t,n,!1):g(e,[["firstChild",f],["firstChild",o.gw]])!=null?{type:"AT_ROOT"}:null}function Qe(e,t,n){return{type:"IN_RANGE"}}function He(e,t,n){const s=t.substring(0,n).trimEnd().endsWith("|");return k(e,t,n,s)}function qe(e,t,n){const r=g(e,[["parent",o.xo]]);if(r===null)return null;const i=t.substring(0,n).trimEnd().endsWith("|");return k(r,t,n,i)}function k(e,t,n,r){const s=g(e,[["firstChild",o.MD]]);return!s||s.to>n?null:{type:"AFTER_SELECTOR",afterPipe:r,hasSpace:t.charAt(n-1)===" ",logQuery:(0,S.g5)(t,n).trim()}}function Ve(e,t,n){const r=g(e,[["firstChild",o.sq]]);if(r!==null&&!t.slice(r.from,n).trim().endsWith(","))return null;const s=e.type.id===f?g(e,[["parent",o.sq]]):e;return s?{type:"IN_LABEL_SELECTOR_NO_LABEL_NAME",otherLabels:te(s,t)}:null}function ze(e,t,n){let r=(0,S.g5)(t,n).trim(),s=null,i=e.parent;for(;i!==null;){if(i.type.id===o.t3){s=i;break}i=i.parent}return s?.type.id===o.t3&&(r=r.slice(0,s.from)),{type:"AFTER_KEEP_AND_DROP",logQuery:r}}function je(e,t){const n=e.trimEnd().length,r=n<t?n:t,s=o.K3.parse(e),i=s.cursorAt(r);do if(i.from===r&&i.to===r&&i.node.type.isError)return i;while(i.next());return s.cursorAt(r)}function Xe(e,t){if(e==="")return{type:"EMPTY"};const n=je(e,t),r=n.node,s=[n.type.id];for(;n.parent();)s.push(n.type.id);for(let i of Fe)for(let a of i.paths)if(we(a,s)){const l=i.fun(r,e,t);if(l)return l}return null}const Ye=4;function Je(){return{showWords:!1}}function Ze(e,t){switch(e){case"DURATION":return t.languages.CompletionItemKind.Unit;case"FUNCTION":return t.languages.CompletionItemKind.Variable;case"HISTORY":return t.languages.CompletionItemKind.Snippet;case"LABEL_NAME":return t.languages.CompletionItemKind.Enum;case"LABEL_VALUE":return t.languages.CompletionItemKind.EnumMember;case"PATTERN":return t.languages.CompletionItemKind.Constructor;case"PARSER":return t.languages.CompletionItemKind.Class;case"LINE_FILTER":return t.languages.CompletionItemKind.TypeParameter;case"PIPE_OPERATION":return t.languages.CompletionItemKind.Interface;default:throw new X(e)}}function et(e,t){return{triggerCharacters:["{",",","[","(","=","~"," ",'"',"|"],provideCompletionItems:(r,s)=>{const i=r.getWordAtPosition(s),a=r.getWordUntilPosition(s),l={column:s.column,lineNumber:s.lineNumber},m=r.getOffsetAt(l),y=Xe(r.getValue(),m),d=tt(y,i,a,e,s);return(y!=null?Se(y,t):Promise.resolve([])).then(h=>{const R=h.length.toString().length;return{suggestions:h.map((u,T)=>({kind:Ze(u.type,e),label:u.label,insertText:u.insertText,insertTextRules:u.isSnippet?Ye:void 0,detail:u.detail,documentation:u.documentation,sortText:T.toString().padStart(R,"0"),range:d,command:u.triggerOnInsert?{id:"editor.action.triggerSuggest",title:""}:void 0}))}})}}}const tt=(e,t,n,r,s)=>{if(e&&e?.type==="IN_LABEL_SELECTOR_WITH_LABEL_NAME"&&"betweenQuotes"in e&&e.betweenQuotes){const i=n?.word?.indexOf('"')??0,a=t?.word?.lastIndexOf('"')??0,l=t?.word.indexOf("="),m=t?.word.lastIndexOf("=");if(m===l&&i!==-1&&a!==-1&&m!==-1)return t!=null?r.Range.lift({startLineNumber:s.lineNumber,endLineNumber:s.lineNumber,startColumn:n.startColumn+i+1,endColumn:n.startColumn+a}):r.Range.fromPositions(s)}return e&&e.type==="IN_LABEL_SELECTOR_WITH_LABEL_NAME"?t!=null?r.Range.lift({startLineNumber:s.lineNumber,endLineNumber:s.lineNumber,startColumn:n.endColumn,endColumn:n.endColumn}):r.Range.fromPositions(s):t!=null?r.Range.lift({startLineNumber:s.lineNumber,endLineNumber:s.lineNumber,startColumn:t.startColumn,endColumn:t.endColumn}):r.Range.fromPositions(s)};var re=c(27522);const nt={codeLens:!1,contextmenu:!1,fixedOverflowWidgets:!0,folding:!1,fontSize:14,lineDecorationsWidth:8,lineNumbers:"off",minimap:{enabled:!1},overviewRulerBorder:!1,overviewRulerLanes:0,padding:{top:4,bottom:5},renderLineHighlight:"none",scrollbar:{vertical:"hidden",verticalScrollbarSize:8,horizontal:"hidden",horizontalScrollbarSize:0,alwaysConsumeMouseWheel:!1},scrollBeyondLastLine:!1,suggest:Je(),suggestFontSize:12,wordWrap:"on"},rt=2,F="logql";let se=!1;const st=/(-?\d*\.\d\w*)|([^`~!#%^&*()\-=+\[{\]}\\|;:'",.<>\/?\s]+)/g;function ot(e){se===!1&&(se=!0,e.languages.register({id:F}),e.languages.setMonarchTokensProvider(F,U.xN),e.languages.setLanguageConfiguration(F,{...U.r0,wordPattern:/(-?\d*\.\d\w*)|([^`~!#%^&*()+\[{\]}\\|;:',.<>\/?\s]+)/g}))}const it=(e,t)=>({container:(0,w.css)({borderRadius:e.shape.radius.default,border:`1px solid ${e.components.input.borderColor}`,width:"100%",".monaco-editor .suggest-widget":{minWidth:"50%"},overflow:"hidden"}),placeholder:(0,w.css)({"::after":{content:`'${t}'`,fontFamily:e.typography.fontFamilyMonospace,opacity:.3}})}),at=({history:e,onBlur:t,onRunQuery:n,initialValue:r,datasource:s,placeholder:i,onChange:a,timeRange:l})=>{const m=(0,G.A)(),y=(0,v.useRef)(ge()),d=(0,v.useRef)(null),b=(0,A.A)(s.languageProvider),h=(0,A.A)(e),R=(0,A.A)(n),C=(0,A.A)(t),u=(0,v.useRef)(null),T=(0,v.useRef)(null),lt=(0,H.$j)(),oe=it(lt,i);(0,v.useEffect)(()=>()=>{T.current?.()},[]),(0,v.useEffect)(()=>{u.current&&l&&u.current.setTimeRange(l)},[l]);const ut=(p,N)=>{const W=[{range:new p.Range(1,1,1,1),options:{className:oe.placeholder,isWholeLine:!0}}];let K=[];const $=()=>{const D=N.getModel();if(!D)return;const z=D.getValueLength()===0?W:[];K=D.deltaDecorations(K,z)};$(),N.onDidChangeModelContent($)},ct=(0,P.debounce)(async p=>{a(p)},1e3);return(0,M.jsx)("div",{"data-testid":Q.Tp.components.QueryField.container,className:oe.container,ref:d,children:(0,M.jsx)(ue.m,{overrideServices:y.current,options:nt,language:F,value:r,beforeMount:p=>{ot(p)},onMount:(p,N)=>{const W=p.createContextKey("isEditorFocused"+m,!1);p.onDidBlurEditorWidget(()=>{W.set(!1),C.current(p.getValue())}),p.onDidChangeModelContent(_=>{const O=p.getModel();if(!O)return;const x=O.getValue(),dt=((0,re.B)(x,s.interpolateString(x,re.a),O.getLinesContent(),o.K3)||[]).map(({error:le,...gt})=>({message:`${le?`Error parsing "${le}"`:"Parse error"}. The query appears to be incorrect and could fail to be executed.`,severity:N.MarkerSeverity.Error,...gt}));ct(x),N.editor.setModelMarkers(O,"owner",dt)});const K=new pe(b.current,h,l);u.current=K;const $=et(N,K),D={...$,provideCompletionItems:(_,O,x,ae)=>p.getModel()?.id!==_.id?{suggestions:[]}:$.provideCompletionItems(_,O,x,ae)},{dispose:z}=N.languages.registerCompletionItemProvider(F,D);T.current=z;const ie=()=>{const _=d.current;if(_!==null){const O=p.getContentHeight();_.style.height=`${O+rt}px`;const x=_.clientWidth;p.layout({width:x,height:O})}};p.onDidContentSizeChange(ie),ie(),p.addCommand(N.KeyMod.Shift|N.KeyCode.Enter,()=>{R.current(p.getValue())},"isEditorFocused"+m),N.editor.addKeybindingRule({keybinding:N.KeyMod.CtrlCmd|N.KeyCode.KeyF,command:null}),p.onDidFocusEditorText(()=>{W.set(!0),p.getValue().trim()===""&&p.trigger("","editor.action.triggerSuggest",{})}),ut(N,p)}})})}},39554:(j,I,c)=>{c.d(I,{A:()=>P});var M=c(96540),w=function(v){var A=(0,M.useRef)(v);return A.current=v,A};const P=w}}]);

//# sourceMappingURL=loki-query-field.f9a0b82b636d4821760c.js.map