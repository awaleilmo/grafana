{"version":3,"file":"timeseriesPanel.00784cbccf8df2072c48.js","mappings":"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","sources":["webpack://grafana/./public/app/plugins/panel/timeseries/plugins/ExemplarMarker.tsx","webpack://grafana/./public/app/plugins/panel/timeseries/plugins/ExemplarsPlugin.tsx","webpack://grafana/./public/app/plugins/panel/timeseries/suggestions.ts","webpack://grafana/./public/app/plugins/panel/timeseries/TimeSeriesPanel.tsx","webpack://grafana/./public/app/plugins/panel/timeseries/TimezonesEditor.tsx","webpack://grafana/./public/app/plugins/panel/timeseries/migrations.ts","webpack://grafana/./public/app/plugins/panel/timeseries/module.tsx","webpack://grafana/./public/app/plugins/panel/timeseries/plugins/ThresholdDragHandle.tsx","webpack://grafana/./public/app/plugins/panel/timeseries/plugins/ThresholdControlsPlugin.tsx","webpack://grafana/./public/app/features/visualization/data-hover/ExemplarTooltip.tsx"],"sourcesContent":["import { css, cx } from '@emotion/css';\nimport {\n  autoUpdate,\n  flip,\n  safePolygon,\n  shift,\n  useDismiss,\n  useFloating,\n  useHover,\n  useInteractions,\n} from '@floating-ui/react';\nimport { useCallback, useEffect, useState } from 'react';\nimport * as React from 'react';\n\nimport { DataFrame, Field, formattedValueToString, GrafanaTheme2, LinkModel } from '@grafana/data';\nimport { selectors } from '@grafana/e2e-selectors';\nimport { TimeZone } from '@grafana/schema';\nimport { Portal, UPlotConfigBuilder, useStyles2 } from '@grafana/ui';\nimport { VizTooltipItem } from '@grafana/ui/internal';\nimport { CloseButton } from 'app/core/components/CloseButton/CloseButton';\nimport { ExemplarTooltip } from 'app/features/visualization/data-hover/ExemplarTooltip';\n\nimport { getDataLinks } from '../../status-history/utils';\n\ninterface ExemplarMarkerProps {\n  timeZone: TimeZone;\n  dataFrame: DataFrame;\n  frameIndex: number;\n  rowIndex: number;\n  config: UPlotConfigBuilder;\n  exemplarColor?: string;\n  clickedRowIndex: number | undefined;\n  setClickedRowIndex: React.Dispatch<number | undefined>;\n  maxHeight?: number;\n  maxWidth?: number;\n}\n\nexport const ExemplarMarker = ({\n  timeZone,\n  dataFrame,\n  frameIndex,\n  rowIndex,\n  config,\n  exemplarColor,\n  clickedRowIndex,\n  setClickedRowIndex,\n  maxHeight,\n  maxWidth,\n}: ExemplarMarkerProps) => {\n  const styles = useStyles2(getExemplarMarkerStyles, maxWidth);\n  const [isOpen, setIsOpen] = useState(false);\n  const [isLocked, setIsLocked] = useState(false);\n\n  // the order of middleware is important!\n  const middleware = [\n    flip({\n      fallbackAxisSideDirection: 'end',\n      // see https://floating-ui.com/docs/flip#combining-with-shift\n      crossAxis: false,\n      boundary: document.body,\n    }),\n    shift(),\n  ];\n\n  const { context, refs, floatingStyles } = useFloating({\n    open: isOpen,\n    placement: 'bottom',\n    onOpenChange: setIsOpen,\n    middleware,\n    whileElementsMounted: autoUpdate,\n    strategy: 'fixed',\n  });\n\n  const dismiss = useDismiss(context);\n  const hover = useHover(context, {\n    handleClose: safePolygon(),\n    enabled: clickedRowIndex === undefined,\n  });\n\n  const { getReferenceProps, getFloatingProps } = useInteractions([dismiss, hover]);\n\n  useEffect(() => {\n    if (clickedRowIndex !== rowIndex) {\n      setIsLocked(false);\n    }\n  }, [clickedRowIndex, rowIndex]);\n\n  const getSymbol = () => {\n    return (\n      <rect\n        fill={exemplarColor}\n        key=\"diamond\"\n        x=\"3.38672\"\n        width=\"4.78985\"\n        height=\"4.78985\"\n        transform=\"rotate(45 3.38672 0)\"\n      />\n    );\n\n    // const symbols = [\n    //   <rect\n    //     fill={exemplarColor}\n    //     key=\"diamond\"\n    //     x=\"3.38672\"\n    //     width=\"4.78985\"\n    //     height=\"4.78985\"\n    //     transform=\"rotate(45 3.38672 0)\"\n    //   />,\n    //   <path\n    //     fill={exemplarColor}\n    //     key=\"x\"\n    //     d=\"M1.94444 3.49988L0 5.44432L1.55552 6.99984L3.49996 5.05539L5.4444 6.99983L6.99992 5.44431L5.05548 3.49988L6.99983 1.55552L5.44431 0L3.49996 1.94436L1.5556 0L8.42584e-05 1.55552L1.94444 3.49988Z\"\n    //   />,\n    //   <path fill={exemplarColor} key=\"triangle\" d=\"M4 0L7.4641 6H0.535898L4 0Z\" />,\n    //   <rect fill={exemplarColor} key=\"rectangle\" width=\"5\" height=\"5\" />,\n    //   <path\n    //     fill={exemplarColor}\n    //     key=\"pentagon\"\n    //     d=\"M3 0.5L5.85317 2.57295L4.76336 5.92705H1.23664L0.146831 2.57295L3 0.5Z\"\n    //   />,\n    //   <path\n    //     fill={exemplarColor}\n    //     key=\"plus\"\n    //     d=\"m2.35672,4.2425l0,2.357l1.88558,0l0,-2.357l2.3572,0l0,-1.88558l-2.3572,0l0,-2.35692l-1.88558,0l0,2.35692l-2.35672,0l0,1.88558l2.35672,0z\"\n    //   />,\n    // ];\n\n    // return symbols[dataFrameFieldIndex.frameIndex % symbols.length];\n  };\n\n  const lockExemplarModal = () => {\n    setIsLocked(true);\n  };\n\n  const renderMarker = useCallback(() => {\n    const onClose = () => {\n      setIsLocked(false);\n      setIsOpen(false);\n      setClickedRowIndex(undefined);\n    };\n\n    let items: VizTooltipItem[] = [];\n    let links: LinkModel[] = [];\n\n    dataFrame.fields.forEach((field: Field) => {\n      const value = field.values[rowIndex];\n\n      links.push(...getDataLinks(field, rowIndex));\n\n      const fieldDisplay = field.display?.(value) ?? { text: `${value}`, numeric: +value };\n\n      items.push({\n        label: field.state?.displayName ?? field.name,\n        value: formattedValueToString(fieldDisplay),\n      });\n    });\n\n    return (\n      <div\n        className={cx(styles.tooltipWrapper, isLocked && styles.pinned)}\n        ref={refs.setFloating}\n        style={floatingStyles}\n        {...getFloatingProps()}\n      >\n        {isLocked && <CloseButton onClick={onClose} />}\n        <ExemplarTooltip items={items} links={links} isPinned={isLocked} maxHeight={maxHeight} />\n      </div>\n    );\n  }, [\n    dataFrame.fields,\n    rowIndex,\n    styles,\n    isLocked,\n    setClickedRowIndex,\n    floatingStyles,\n    getFloatingProps,\n    refs.setFloating,\n    maxHeight,\n  ]);\n\n  const seriesColor = config.getSeries().find((s) => s.props.dataFrameFieldIndex?.frameIndex === frameIndex)\n    ?.props.lineColor;\n\n  const onExemplarClick = () => {\n    setClickedRowIndex(rowIndex);\n    lockExemplarModal();\n  };\n\n  return (\n    <>\n      <div\n        ref={refs.setReference}\n        className={styles.markerWrapper}\n        data-testid={selectors.components.DataSource.Prometheus.exemplarMarker}\n        role=\"button\"\n        tabIndex={0}\n        {...getReferenceProps()}\n        onClick={onExemplarClick}\n        onKeyDown={(e: React.KeyboardEvent) => {\n          if (e.key === 'Enter') {\n            onExemplarClick();\n          }\n        }}\n      >\n        <svg\n          viewBox=\"0 0 7 7\"\n          width=\"7\"\n          height=\"7\"\n          style={{ fill: seriesColor }}\n          className={cx(styles.marble, (isOpen || isLocked) && styles.activeMarble)}\n        >\n          {getSymbol()}\n        </svg>\n      </div>\n      {(isOpen || isLocked) && <Portal>{renderMarker()}</Portal>}\n    </>\n  );\n};\n\nconst getExemplarMarkerStyles = (theme: GrafanaTheme2, maxWidth: number | undefined) => {\n  return {\n    markerWrapper: css({\n      padding: '0 4px 4px 4px',\n      width: '8px',\n      height: '8px',\n      boxSizing: 'content-box',\n      transform: 'translate3d(-50%, 0, 0)',\n      '&:hover': {\n        '> svg': {\n          transform: 'scale(1.3)',\n          opacity: 1,\n          filter: 'drop-shadow(0 0 8px rgba(0, 0, 0, 0.5))',\n        },\n      },\n    }),\n    marker: css({\n      width: 0,\n      height: 0,\n      borderLeft: '4px solid transparent',\n      borderRight: '4px solid transparent',\n      borderBottom: `4px solid ${theme.v1.palette.red}`,\n      pointerEvents: 'none',\n    }),\n    marble: css({\n      display: 'block',\n      opacity: 0.5,\n      [theme.transitions.handleMotion('no-preference')]: {\n        transition: 'transform 0.15s ease-out',\n      },\n    }),\n    activeMarble: css({\n      transform: 'scale(1.3)',\n      opacity: 1,\n      filter: 'drop-shadow(0 0 8px rgba(0, 0, 0, 0.5))',\n    }),\n    tooltipWrapper: css({\n      background: theme.colors.background.elevated,\n      maxWidth: maxWidth ?? 'none',\n      whiteSpace: 'pre',\n      borderRadius: theme.shape.radius.default,\n      position: 'fixed',\n      border: `1px solid ${theme.colors.border.weak}`,\n      boxShadow: theme.shadows.z2,\n      userSelect: 'text',\n    }),\n    pinned: css({\n      boxShadow: theme.shadows.z3,\n    }),\n  };\n};\n","import { ReactNode, useCallback, useLayoutEffect, useRef, useState } from 'react';\nimport uPlot from 'uplot';\n\nimport { DataFrame, Labels, TIME_SERIES_TIME_FIELD_NAME, TIME_SERIES_VALUE_FIELD_NAME, TimeZone } from '@grafana/data';\nimport { FIXED_UNIT, EventsCanvas, UPlotConfigBuilder } from '@grafana/ui';\n\nimport { ExemplarMarker } from './ExemplarMarker';\n\ninterface ExemplarsPluginProps {\n  config: UPlotConfigBuilder;\n  exemplars: DataFrame[];\n  timeZone: TimeZone;\n  visibleSeries?: VisibleExemplarLabels;\n  maxHeight?: number;\n  maxWidth?: number;\n}\n\nexport const ExemplarsPlugin = ({\n  exemplars,\n  timeZone,\n  config,\n  visibleSeries,\n  maxHeight,\n  maxWidth,\n}: ExemplarsPluginProps) => {\n  const plotInstance = useRef<uPlot>();\n\n  const [lockedExemplarRowIndex, setLockedExemplarRowIndex] = useState<number | undefined>();\n\n  useLayoutEffect(() => {\n    config.addHook('init', (u) => {\n      plotInstance.current = u;\n    });\n  }, [config]);\n\n  const mapExemplarToXYCoords = useCallback((dataFrame: DataFrame, rowIndex: number) => {\n    const time = dataFrame.fields.find((f) => f.name === TIME_SERIES_TIME_FIELD_NAME);\n    const value = dataFrame.fields.find((f) => f.name === TIME_SERIES_VALUE_FIELD_NAME);\n\n    if (!time || !value || !plotInstance.current) {\n      return undefined;\n    }\n\n    // Filter x, y scales out\n    const yScale =\n      Object.keys(plotInstance.current.scales).find((scale) => !['x', 'y'].some((key) => key === scale)) ?? FIXED_UNIT;\n\n    const yMin = plotInstance.current.scales[yScale].min;\n    const yMax = plotInstance.current.scales[yScale].max;\n\n    let y = value.values[rowIndex];\n    // To not to show exemplars outside of the graph we set the y value to min if it is smaller and max if it is bigger than the size of the graph\n    if (yMin != null && y < yMin) {\n      y = yMin;\n    }\n\n    if (yMax != null && y > yMax) {\n      y = yMax;\n    }\n\n    return {\n      x: plotInstance.current.valToPos(time.values[rowIndex], 'x'),\n      y: plotInstance.current.valToPos(y, yScale),\n    };\n  }, []);\n\n  const renderMarker = useCallback(\n    (dataFrame: DataFrame, rowIndex: number): ReactNode => {\n      const showMarker = visibleSeries !== undefined ? showExemplarMarker(visibleSeries, dataFrame, rowIndex) : true;\n\n      const markerColor =\n        visibleSeries !== undefined ? getExemplarColor(dataFrame, rowIndex, visibleSeries) : undefined;\n\n      if (!showMarker) {\n        return <></>;\n      }\n\n      return (\n        <ExemplarMarker\n          setClickedRowIndex={setLockedExemplarRowIndex}\n          clickedRowIndex={lockedExemplarRowIndex}\n          timeZone={timeZone}\n          dataFrame={dataFrame}\n          frameIndex={0}\n          rowIndex={rowIndex}\n          config={config}\n          exemplarColor={markerColor}\n          maxHeight={maxHeight}\n          maxWidth={maxWidth}\n        />\n      );\n    },\n    [visibleSeries, lockedExemplarRowIndex, timeZone, config, maxHeight, maxWidth]\n  );\n\n  return (\n    <EventsCanvas\n      config={config}\n      id=\"exemplars\"\n      events={exemplars}\n      renderEventMarker={renderMarker}\n      mapEventToXYCoords={mapExemplarToXYCoords}\n    />\n  );\n};\n\nexport type VisibleExemplarLabels = { labels: LabelWithExemplarUIData[]; totalSeriesCount: number };\n/**\n * Get labels that are currently visible/active in the legend\n */\nexport const getVisibleLabels = (config: UPlotConfigBuilder, frames: DataFrame[] | null): VisibleExemplarLabels => {\n  const visibleSeries = config.series.filter((series) => series.props.show);\n  const visibleLabels: LabelWithExemplarUIData[] = [];\n  if (frames?.length) {\n    visibleSeries.forEach((plotInstance) => {\n      const frameIndex = plotInstance.props?.dataFrameFieldIndex?.frameIndex;\n      const fieldIndex = plotInstance.props?.dataFrameFieldIndex?.fieldIndex;\n\n      if (frameIndex !== undefined && fieldIndex !== undefined) {\n        const field = frames[frameIndex]?.fields[fieldIndex];\n        if (field?.labels) {\n          // Note that this may be an empty object in the case of a metric being rendered with no labels\n          visibleLabels.push({\n            labels: field.labels,\n            color: plotInstance.props?.lineColor ?? '',\n          });\n        }\n      }\n    });\n  }\n\n  return { labels: visibleLabels, totalSeriesCount: config.series.length };\n};\n\ninterface LabelWithExemplarUIData {\n  labels: Labels;\n  color?: string;\n}\n\n/**\n * Get color of active series in legend\n */\nconst getExemplarColor = (dataFrame: DataFrame, rowIndex: number, visibleLabels: VisibleExemplarLabels) => {\n  let exemplarColor;\n  visibleLabels.labels.some((visibleLabel) => {\n    const labelKeys = Object.keys(visibleLabel.labels);\n    const fields = dataFrame.fields.filter((field) => {\n      return labelKeys.find((labelKey) => labelKey === field.name);\n    });\n    if (fields.length) {\n      const hasMatch = fields.every((field, index, fields) => {\n        const value = field.values[rowIndex];\n        return visibleLabel.labels[field.name] === value;\n      });\n\n      if (hasMatch) {\n        exemplarColor = visibleLabel.color;\n        return true;\n      }\n    }\n    return false;\n  });\n  return exemplarColor;\n};\n\n/**\n * Determine if the current exemplar marker is filtered by what series are selected in the legend UI\n */\nconst showExemplarMarker = (visibleSeries: VisibleExemplarLabels, dataFrame: DataFrame, rowIndex: number) => {\n  let showMarker = false;\n  // If all series are visible, don't filter any exemplars\n  if (visibleSeries.labels.length === visibleSeries.totalSeriesCount) {\n    showMarker = true;\n  } else {\n    visibleSeries.labels.some((visibleLabel) => {\n      // Get the label names\n      const labelKeys = Object.keys(visibleLabel.labels);\n\n      // If there aren't any labels, the graph is only displaying a single series with exemplars, let's show all exemplars in this case as well\n      if (Object.keys(visibleLabel.labels).length === 0) {\n        showMarker = true;\n      } else {\n        // If there are labels, lets only show the exemplars with labels associated with series that are currently visible\n        const fields = dataFrame.fields.filter((field) => {\n          return labelKeys.find((labelKey) => labelKey === field.name);\n        });\n\n        if (fields.length) {\n          // Check to see if at least one value matches each field\n          showMarker = visibleSeries.labels.some((series) => {\n            return Object.keys(series.labels).every((label) => {\n              const value = series.labels[label];\n              return fields.find((field) => field.values[rowIndex] === value);\n            });\n          });\n        }\n      }\n      return showMarker;\n    });\n  }\n  return showMarker;\n};\n","import {\n  FieldColorModeId,\n  VisualizationSuggestionsBuilder,\n  VisualizationSuggestion,\n  DataTransformerID,\n} from '@grafana/data';\nimport {\n  GraphDrawStyle,\n  GraphFieldConfig,\n  GraphGradientMode,\n  LegendDisplayMode,\n  LineInterpolation,\n  StackingMode,\n} from '@grafana/schema';\nimport { getDashboardSrv } from 'app/features/dashboard/services/DashboardSrv';\nimport { SuggestionName } from 'app/types/suggestions';\n\nimport { Options } from './panelcfg.gen';\n\nexport class TimeSeriesSuggestionsSupplier {\n  getSuggestionsForData(builder: VisualizationSuggestionsBuilder) {\n    const { dataSummary } = builder;\n\n    if (!dataSummary.hasTimeField || !dataSummary.hasNumberField || dataSummary.rowCountTotal < 2) {\n      return;\n    }\n\n    const list = builder.getListAppender<Options, GraphFieldConfig>({\n      name: SuggestionName.LineChart,\n      pluginId: 'timeseries',\n      options: {\n        legend: {\n          calcs: [],\n          displayMode: LegendDisplayMode.Hidden,\n          placement: 'right',\n          showLegend: false,\n        },\n      },\n      fieldConfig: {\n        defaults: {\n          custom: {},\n        },\n        overrides: [],\n      },\n      cardOptions: {\n        previewModifier: (s) => {\n          if (s.fieldConfig?.defaults.custom?.drawStyle !== GraphDrawStyle.Bars) {\n            s.fieldConfig!.defaults.custom!.lineWidth = Math.max(s.fieldConfig!.defaults.custom!.lineWidth ?? 1, 2);\n          }\n        },\n      },\n    });\n\n    const maxBarsCount = 100;\n\n    list.append({\n      name: SuggestionName.LineChart,\n    });\n\n    if (dataSummary.rowCountMax < 200) {\n      list.append({\n        name: SuggestionName.LineChartSmooth,\n        fieldConfig: {\n          defaults: {\n            custom: {\n              lineInterpolation: LineInterpolation.Smooth,\n            },\n          },\n          overrides: [],\n        },\n      });\n    }\n\n    // Single series suggestions\n    if (dataSummary.numberFieldCount === 1) {\n      list.append({\n        name: SuggestionName.AreaChart,\n        fieldConfig: {\n          defaults: {\n            custom: {\n              fillOpacity: 25,\n            },\n          },\n          overrides: [],\n        },\n      });\n\n      list.append({\n        name: SuggestionName.LineChartGradientColorScheme,\n        fieldConfig: {\n          defaults: {\n            color: {\n              mode: FieldColorModeId.ContinuousGrYlRd,\n            },\n            custom: {\n              gradientMode: GraphGradientMode.Scheme,\n              lineInterpolation: LineInterpolation.Smooth,\n              lineWidth: 3,\n              fillOpacity: 20,\n            },\n          },\n          overrides: [],\n        },\n      });\n\n      if (dataSummary.rowCountMax < maxBarsCount) {\n        list.append({\n          name: SuggestionName.BarChart,\n          fieldConfig: {\n            defaults: {\n              custom: {\n                drawStyle: GraphDrawStyle.Bars,\n                fillOpacity: 100,\n                lineWidth: 1,\n                gradientMode: GraphGradientMode.Hue,\n              },\n            },\n            overrides: [],\n          },\n        });\n\n        list.append({\n          name: SuggestionName.BarChartGradientColorScheme,\n          fieldConfig: {\n            defaults: {\n              color: {\n                mode: FieldColorModeId.ContinuousGrYlRd,\n              },\n              custom: {\n                drawStyle: GraphDrawStyle.Bars,\n                fillOpacity: 90,\n                lineWidth: 1,\n                gradientMode: GraphGradientMode.Scheme,\n              },\n            },\n            overrides: [],\n          },\n        });\n      }\n\n      return;\n    }\n\n    // Multiple series suggestions\n\n    list.append({\n      name: SuggestionName.AreaChartStacked,\n      fieldConfig: {\n        defaults: {\n          custom: {\n            fillOpacity: 25,\n            stacking: {\n              mode: StackingMode.Normal,\n              group: 'A',\n            },\n          },\n        },\n        overrides: [],\n      },\n    });\n\n    list.append({\n      name: SuggestionName.AreaChartStackedPercent,\n      fieldConfig: {\n        defaults: {\n          custom: {\n            fillOpacity: 25,\n            stacking: {\n              mode: StackingMode.Percent,\n              group: 'A',\n            },\n          },\n        },\n        overrides: [],\n      },\n    });\n\n    if (dataSummary.rowCountTotal / dataSummary.numberFieldCount < maxBarsCount) {\n      list.append({\n        name: SuggestionName.BarChartStacked,\n        fieldConfig: {\n          defaults: {\n            custom: {\n              drawStyle: GraphDrawStyle.Bars,\n              fillOpacity: 100,\n              lineWidth: 1,\n              gradientMode: GraphGradientMode.Hue,\n              stacking: {\n                mode: StackingMode.Normal,\n                group: 'A',\n              },\n            },\n          },\n          overrides: [],\n        },\n      });\n\n      list.append({\n        name: SuggestionName.BarChartStackedPercent,\n        fieldConfig: {\n          defaults: {\n            custom: {\n              drawStyle: GraphDrawStyle.Bars,\n              fillOpacity: 100,\n              lineWidth: 1,\n              gradientMode: GraphGradientMode.Hue,\n              stacking: {\n                mode: StackingMode.Percent,\n                group: 'A',\n              },\n            },\n          },\n          overrides: [],\n        },\n      });\n    }\n  }\n}\n\n// This will try to get a suggestion that will add a long to wide conversion\nexport function getPrepareTimeseriesSuggestion(panelId: number): VisualizationSuggestion | undefined {\n  const panel = getDashboardSrv().getCurrent()?.getPanelById(panelId);\n  if (panel) {\n    const transformations = panel.transformations ? [...panel.transformations] : [];\n    transformations.push({\n      id: DataTransformerID.prepareTimeSeries,\n      options: {\n        format: 'wide',\n      },\n    });\n\n    return {\n      name: 'Transform to wide time series format',\n      pluginId: 'timeseries',\n      transformations,\n    };\n  }\n  return undefined;\n}\n","import { useMemo, useState } from 'react';\n\nimport {\n  PanelProps,\n  DataFrameType,\n  DashboardCursorSync,\n  DataFrame,\n  alignTimeRangeCompareData,\n  shouldAlignTimeCompare,\n  FieldType,\n} from '@grafana/data';\nimport { PanelDataErrorView } from '@grafana/runtime';\nimport { TooltipDisplayMode, VizOrientation } from '@grafana/schema';\nimport { EventBusPlugin, KeyboardPlugin, TooltipPlugin2, usePanelContext } from '@grafana/ui';\nimport { TimeRange2, TooltipHoverMode } from '@grafana/ui/internal';\nimport { TimeSeries } from 'app/core/components/TimeSeries/TimeSeries';\nimport { config } from 'app/core/config';\n\nimport { TimeSeriesTooltip } from './TimeSeriesTooltip';\nimport { Options } from './panelcfg.gen';\nimport { AnnotationsPlugin2 } from './plugins/AnnotationsPlugin2';\nimport { ExemplarsPlugin, getVisibleLabels } from './plugins/ExemplarsPlugin';\nimport { OutsideRangePlugin } from './plugins/OutsideRangePlugin';\nimport { ThresholdControlsPlugin } from './plugins/ThresholdControlsPlugin';\nimport { getPrepareTimeseriesSuggestion } from './suggestions';\nimport { getTimezones, prepareGraphableFields } from './utils';\n\ninterface TimeSeriesPanelProps extends PanelProps<Options> {}\n\nexport const TimeSeriesPanel = ({\n  data,\n  timeRange,\n  timeZone,\n  width,\n  height,\n  options,\n  fieldConfig,\n  onChangeTimeRange,\n  replaceVariables,\n  id,\n}: TimeSeriesPanelProps) => {\n  const {\n    sync,\n    eventsScope,\n    canAddAnnotations,\n    onThresholdsChange,\n    canEditThresholds,\n    showThresholds,\n    dataLinkPostProcessor,\n    eventBus,\n    canExecuteActions,\n  } = usePanelContext();\n\n  const userCanExecuteActions = useMemo(() => canExecuteActions?.() ?? false, [canExecuteActions]);\n  // Vertical orientation is not available for users through config.\n  // It is simplified version of horizontal time series panel and it does not support all plugins.\n  const isVerticallyOriented = options.orientation === VizOrientation.Vertical;\n  const { frames, compareDiffMs } = useMemo(() => {\n    let frames = prepareGraphableFields(data.series, config.theme2, timeRange);\n\n    if (frames != null) {\n      let compareDiffMs: number[] = [0];\n\n      frames.forEach((frame: DataFrame) => {\n        const diffMs = frame.meta?.timeCompare?.diffMs ?? 0;\n\n        frame.fields.forEach((field) => {\n          if (field.type !== FieldType.time) {\n            compareDiffMs.push(diffMs);\n          }\n        });\n\n        if (diffMs !== 0) {\n          // Check if the compared frame needs time alignment\n          // Apply alignment when time ranges match (no shift applied yet)\n          const needsAlignment = shouldAlignTimeCompare(frame, frames, timeRange);\n\n          if (needsAlignment) {\n            alignTimeRangeCompareData(frame, diffMs, config.theme2.colors.text.disabled);\n          }\n        }\n      });\n\n      return { frames, compareDiffMs };\n    }\n\n    return { frames };\n  }, [data.series, timeRange]);\n\n  const timezones = useMemo(() => getTimezones(options.timezone, timeZone), [options.timezone, timeZone]);\n  const suggestions = useMemo(() => {\n    if (frames?.length && frames.every((df) => df.meta?.type === DataFrameType.TimeSeriesLong)) {\n      const s = getPrepareTimeseriesSuggestion(id);\n      return {\n        message: 'Long data must be converted to wide',\n        suggestions: s ? [s] : undefined,\n      };\n    }\n    return undefined;\n  }, [frames, id]);\n\n  const enableAnnotationCreation = Boolean(canAddAnnotations && canAddAnnotations());\n  const [newAnnotationRange, setNewAnnotationRange] = useState<TimeRange2 | null>(null);\n  const cursorSync = sync?.() ?? DashboardCursorSync.Off;\n\n  if (!frames || suggestions) {\n    return (\n      <PanelDataErrorView\n        panelId={id}\n        message={suggestions?.message}\n        fieldConfig={fieldConfig}\n        data={data}\n        needsTimeField={true}\n        needsNumberField={true}\n        suggestions={suggestions?.suggestions}\n      />\n    );\n  }\n\n  return (\n    <TimeSeries\n      frames={frames}\n      structureRev={data.structureRev}\n      timeRange={timeRange}\n      timeZone={timezones}\n      width={width}\n      height={height}\n      legend={options.legend}\n      options={options}\n      replaceVariables={replaceVariables}\n      dataLinkPostProcessor={dataLinkPostProcessor}\n      cursorSync={cursorSync}\n    >\n      {(uplotConfig, alignedFrame) => {\n        return (\n          <>\n            <KeyboardPlugin config={uplotConfig} />\n            {cursorSync !== DashboardCursorSync.Off && (\n              <EventBusPlugin config={uplotConfig} eventBus={eventBus} frame={alignedFrame} />\n            )}\n            {options.tooltip.mode !== TooltipDisplayMode.None && (\n              <TooltipPlugin2\n                config={uplotConfig}\n                hoverMode={\n                  options.tooltip.mode === TooltipDisplayMode.Single ? TooltipHoverMode.xOne : TooltipHoverMode.xAll\n                }\n                queryZoom={onChangeTimeRange}\n                clientZoom={true}\n                syncMode={cursorSync}\n                syncScope={eventsScope}\n                getDataLinks={(seriesIdx, dataIdx) =>\n                  alignedFrame.fields[seriesIdx].getLinks?.({ valueRowIndex: dataIdx }) ?? []\n                }\n                render={(u, dataIdxs, seriesIdx, isPinned = false, dismiss, timeRange2, viaSync, dataLinks) => {\n                  if (enableAnnotationCreation && timeRange2 != null) {\n                    setNewAnnotationRange(timeRange2);\n                    dismiss();\n                    return;\n                  }\n\n                  const annotate = () => {\n                    let xVal = u.posToVal(u.cursor.left!, 'x');\n\n                    setNewAnnotationRange({ from: xVal, to: xVal });\n                    dismiss();\n                  };\n\n                  return (\n                    // not sure it header time here works for annotations, since it's taken from nearest datapoint index\n                    <TimeSeriesTooltip\n                      series={alignedFrame}\n                      dataIdxs={dataIdxs}\n                      seriesIdx={seriesIdx}\n                      mode={viaSync ? TooltipDisplayMode.Multi : options.tooltip.mode}\n                      sortOrder={options.tooltip.sort}\n                      hideZeros={options.tooltip.hideZeros}\n                      isPinned={isPinned}\n                      annotate={enableAnnotationCreation ? annotate : undefined}\n                      maxHeight={options.tooltip.maxHeight}\n                      replaceVariables={replaceVariables}\n                      dataLinks={dataLinks}\n                      canExecuteActions={userCanExecuteActions}\n                      compareDiffMs={compareDiffMs}\n                    />\n                  );\n                }}\n                maxWidth={options.tooltip.maxWidth}\n              />\n            )}\n            {!isVerticallyOriented && (\n              <>\n                <AnnotationsPlugin2\n                  annotations={data.annotations ?? []}\n                  config={uplotConfig}\n                  timeZone={timeZone}\n                  newRange={newAnnotationRange}\n                  setNewRange={setNewAnnotationRange}\n                />\n                <OutsideRangePlugin config={uplotConfig} onChangeTimeRange={onChangeTimeRange} />\n                {data.annotations && (\n                  <ExemplarsPlugin\n                    visibleSeries={getVisibleLabels(uplotConfig, frames)}\n                    config={uplotConfig}\n                    exemplars={data.annotations}\n                    timeZone={timeZone}\n                    maxHeight={options.tooltip.maxHeight}\n                    maxWidth={options.tooltip.maxWidth}\n                  />\n                )}\n                {((canEditThresholds && onThresholdsChange) || showThresholds) && (\n                  <ThresholdControlsPlugin\n                    config={uplotConfig}\n                    fieldConfig={fieldConfig}\n                    onThresholdsChange={canEditThresholds ? onThresholdsChange : undefined}\n                  />\n                )}\n              </>\n            )}\n          </>\n        );\n      }}\n    </TimeSeries>\n  );\n};\n","import { css } from '@emotion/css';\n\nimport { GrafanaTheme2, InternalTimeZones, StandardEditorProps } from '@grafana/data';\nimport { t } from '@grafana/i18n';\nimport { OptionsWithTimezones } from '@grafana/schema';\nimport { IconButton, TimeZonePicker, useStyles2 } from '@grafana/ui';\n\ntype Props = StandardEditorProps<string[], unknown, OptionsWithTimezones>;\n\nexport const TimezonesEditor = ({ value, onChange }: Props) => {\n  const styles = useStyles2(getStyles);\n\n  if (!value || value.length < 1) {\n    value = [''];\n  }\n\n  const addTimezone = () => {\n    onChange([...value, InternalTimeZones.default]);\n  };\n\n  const removeTimezone = (idx: number) => {\n    const copy = value.slice();\n    copy.splice(idx, 1);\n    onChange(copy);\n  };\n\n  const setTimezone = (idx: number, tz?: string) => {\n    const copy = value.slice();\n    copy[idx] = tz ?? InternalTimeZones.default;\n    if (copy.length === 0 || (copy.length === 1 && copy[0] === '')) {\n      onChange(undefined);\n    } else {\n      onChange(copy);\n    }\n  };\n\n  return (\n    <ul className={styles.list}>\n      {value.map((tz, idx) => (\n        <li className={styles.listItem} key={`${idx}.${tz}`}>\n          <TimeZonePicker\n            onChange={(v) => setTimezone(idx, v)}\n            includeInternal={true}\n            value={tz ?? InternalTimeZones.default}\n          />\n          {idx === value.length - 1 ? (\n            <IconButton\n              name=\"plus\"\n              onClick={addTimezone}\n              tooltip={t('timeseries.timezones-editor.tooltip-add-timezone', 'Add timezone')}\n            />\n          ) : (\n            <IconButton\n              name=\"times\"\n              onClick={() => removeTimezone(idx)}\n              tooltip={t('timeseries.timezones-editor.tooltip-remove-timezone', 'Remove timezone')}\n            />\n          )}\n        </li>\n      ))}\n    </ul>\n  );\n};\n\nconst getStyles = (theme: GrafanaTheme2) => ({\n  list: css({\n    listStyle: 'none',\n    display: 'flex',\n    flexDirection: 'column',\n    gap: theme.spacing(0.5),\n  }),\n  listItem: css({\n    display: 'flex',\n    gap: theme.spacing(1),\n  }),\n});\n","import { omitBy, pickBy, isNil, isNumber, isString } from 'lodash';\n\nimport {\n  ConfigOverrideRule,\n  DynamicConfigValue,\n  FieldColorModeId,\n  FieldConfig,\n  FieldConfigProperty,\n  FieldConfigSource,\n  FieldMatcherID,\n  fieldReducers,\n  FieldType,\n  NullValueMode,\n  PanelTypeChangedHandler,\n  ReducerID,\n  Threshold,\n  ThresholdsMode,\n} from '@grafana/data';\nimport {\n  LegendDisplayMode,\n  TooltipDisplayMode,\n  AxisPlacement,\n  GraphDrawStyle,\n  GraphFieldConfig,\n  GraphGradientMode,\n  GraphThresholdsStyleMode,\n  LineInterpolation,\n  LineStyle,\n  VisibilityMode,\n  ScaleDistribution,\n  StackingMode,\n  SortOrder,\n  GraphTransform,\n  AnnotationQuery,\n  ComparisonOperation,\n} from '@grafana/schema';\nimport { TimeRegionConfig } from 'app/core/utils/timeRegions';\nimport { getDashboardSrv } from 'app/features/dashboard/services/DashboardSrv';\nimport { getTimeSrv } from 'app/features/dashboard/services/TimeSrv';\nimport { DashboardAnnotationsDataLayer } from 'app/features/dashboard-scene/scene/DashboardAnnotationsDataLayer';\nimport { DashboardScene } from 'app/features/dashboard-scene/scene/DashboardScene';\nimport { dashboardSceneGraph } from 'app/features/dashboard-scene/utils/dashboardSceneGraph';\nimport { GrafanaQuery, GrafanaQueryType } from 'app/plugins/datasource/grafana/types';\n\nimport { defaultGraphConfig } from './config';\nimport { Options } from './panelcfg.gen';\n\nlet dashboardRefreshDebouncer: ReturnType<typeof setTimeout> | null = null;\n\n/**\n * This is called when the panel changes from another panel\n */\nexport const graphPanelChangedHandler: PanelTypeChangedHandler = (\n  panel,\n  prevPluginId,\n  prevOptions,\n  prevFieldConfig\n) => {\n  // Changing from angular/flot panel to react/uPlot\n  if (prevPluginId === 'graph' && prevOptions.angular) {\n    const { fieldConfig, options, annotations } = graphToTimeseriesOptions({\n      ...prevOptions.angular,\n      fieldConfig: prevFieldConfig,\n      panel: panel,\n    });\n\n    if (annotations?.length > 0) {\n      addAnnotationsToDashboard(annotations);\n    }\n\n    panel.fieldConfig = fieldConfig; // Mutates the incoming panel\n    panel.alert = prevOptions.angular.alert;\n    return options;\n  }\n\n  //fixes graph -> viz renaming in custom.hideFrom field config by mutation.\n  migrateHideFrom(panel);\n\n  return {};\n};\n\nexport function graphToTimeseriesOptions(angular: any): {\n  fieldConfig: FieldConfigSource;\n  options: Options;\n  annotations: AnnotationQuery[];\n} {\n  let annotations: AnnotationQuery[] = [];\n\n  const overrides: ConfigOverrideRule[] = angular.fieldConfig?.overrides ?? [];\n  const yaxes = angular.yaxes ?? [];\n  let y1 = getFieldConfigFromOldAxis(yaxes[0]);\n  if (angular.fieldConfig?.defaults) {\n    y1 = {\n      ...angular.fieldConfig?.defaults,\n      ...y1, // Keep the y-axis unit and custom\n    };\n  }\n\n  // Dashes\n  const dash: LineStyle = {\n    fill: angular.dashes ? 'dash' : 'solid',\n    dash: [angular.dashLength ?? 10, angular.spaceLength ?? 10],\n  };\n\n  // \"seriesOverrides\": [\n  //   {\n  //     \"$$hashKey\": \"object:183\",\n  //     \"alias\": \"B-series\",\n  //     \"fill\": 3,\n  //     \"nullPointMode\": \"null as zero\",\n  //     \"lines\": true,\n  //     \"linewidth\": 2\n  //   }\n  // ],\n\n  if (angular.aliasColors) {\n    for (const alias of Object.keys(angular.aliasColors)) {\n      const color = angular.aliasColors[alias];\n      if (color) {\n        overrides.push({\n          matcher: {\n            id: FieldMatcherID.byName,\n            options: alias,\n          },\n          properties: [\n            {\n              id: FieldConfigProperty.Color,\n              value: {\n                mode: FieldColorModeId.Fixed,\n                fixedColor: color,\n              },\n            },\n          ],\n        });\n      }\n    }\n  }\n\n  let hasFillBelowTo = false;\n\n  if (angular.seriesOverrides?.length) {\n    for (const seriesOverride of angular.seriesOverrides) {\n      if (!seriesOverride.alias) {\n        continue; // the matcher config\n      }\n      const aliasIsRegex = /^([/~@;%#'])(.*?)\\1([gimsuy]*)$/.test(seriesOverride.alias);\n      const rule: ConfigOverrideRule = {\n        matcher: {\n          id: aliasIsRegex ? FieldMatcherID.byRegexp : FieldMatcherID.byName,\n          options: seriesOverride.alias,\n        },\n        properties: [],\n      };\n      let dashOverride: LineStyle | undefined = undefined;\n\n      for (const p of Object.keys(seriesOverride)) {\n        const v = seriesOverride[p];\n        switch (p) {\n          // Ignore\n          case 'alias':\n          case '$$hashKey':\n            break;\n          // Link to y axis settings\n          case 'yaxis':\n            if (2 === v) {\n              const y2 = getFieldConfigFromOldAxis(yaxes[1]);\n              fillY2DynamicValues(y1, y2, rule.properties);\n            }\n            break;\n          case 'fill':\n            rule.properties.push({\n              id: 'custom.fillOpacity',\n              value: v * 10, // was 0-10, new graph is 0 - 100\n            });\n            break;\n          case 'fillBelowTo':\n            hasFillBelowTo = true;\n            rule.properties.push({\n              id: 'custom.fillBelowTo',\n              value: v,\n            });\n            break;\n          case 'fillGradient':\n            if (v) {\n              rule.properties.push({\n                id: 'custom.fillGradient',\n                value: 'opacity', // was 0-10\n              });\n              rule.properties.push({\n                id: 'custom.fillOpacity',\n                value: v * 10, // was 0-10, new graph is 0 - 100\n              });\n            }\n            break;\n          case 'points':\n            rule.properties.push({\n              id: 'custom.showPoints',\n              value: v ? VisibilityMode.Always : VisibilityMode.Never,\n            });\n            break;\n          case 'bars':\n            if (v) {\n              rule.properties.push({\n                id: 'custom.drawStyle',\n                value: GraphDrawStyle.Bars,\n              });\n              rule.properties.push({\n                id: 'custom.fillOpacity',\n                value: 100, // solid bars\n              });\n            } else {\n              rule.properties.push({\n                id: 'custom.drawStyle',\n                value: GraphDrawStyle.Line, // Change from bars\n              });\n            }\n            break;\n          case 'lines':\n            if (v) {\n              rule.properties.push({\n                id: 'custom.drawStyle',\n                value: 'line',\n              });\n            } else {\n              rule.properties.push({\n                id: 'custom.lineWidth',\n                value: 0,\n              });\n            }\n            break;\n          case 'linewidth':\n            rule.properties.push({\n              id: 'custom.lineWidth',\n              value: v,\n            });\n            break;\n          case 'pointradius':\n            rule.properties.push({\n              id: 'custom.pointSize',\n              value: 2 + v * 2,\n            });\n            break;\n          case 'dashLength':\n          case 'spaceLength':\n          case 'dashes':\n            if (!dashOverride) {\n              dashOverride = {\n                fill: dash.fill,\n                dash: [...dash.dash!],\n              };\n            }\n            switch (p) {\n              case 'dashLength':\n                dashOverride.dash![0] = v;\n                break;\n              case 'spaceLength':\n                dashOverride.dash![1] = v;\n                break;\n              case 'dashes':\n                dashOverride.fill = v ? 'dash' : 'solid';\n                break;\n            }\n            break;\n          case 'stack':\n            rule.properties.push({\n              id: 'custom.stacking',\n              value: getStackingFromOverrides(v),\n            });\n            break;\n          case 'color':\n            rule.properties.push({\n              id: 'color',\n              value: {\n                fixedColor: v,\n                mode: FieldColorModeId.Fixed,\n              },\n            });\n            break;\n          case 'transform':\n            rule.properties.push({\n              id: 'custom.transform',\n              value: v === 'negative-Y' ? GraphTransform.NegativeY : GraphTransform.Constant,\n            });\n            break;\n          default:\n            console.log('Ignore override migration:', seriesOverride.alias, p, v);\n        }\n      }\n      if (dashOverride) {\n        rule.properties.push({\n          id: 'custom.lineStyle',\n          value: dashOverride,\n        });\n      }\n      if (rule.properties.length) {\n        overrides.push(rule);\n      }\n    }\n  }\n\n  const graph: GraphFieldConfig = y1.custom ?? {};\n  graph.drawStyle = angular.bars ? GraphDrawStyle.Bars : angular.lines ? GraphDrawStyle.Line : GraphDrawStyle.Points;\n\n  if (angular.points) {\n    graph.showPoints = VisibilityMode.Always;\n\n    if (isNumber(angular.pointradius)) {\n      graph.pointSize = 2 + angular.pointradius * 2;\n    }\n  } else if (graph.drawStyle !== GraphDrawStyle.Points) {\n    graph.showPoints = VisibilityMode.Never;\n  }\n\n  graph.lineWidth = angular.linewidth;\n  if (dash.fill !== 'solid') {\n    graph.lineStyle = dash;\n  }\n\n  if (hasFillBelowTo) {\n    graph.fillOpacity = 35; // bands are hardcoded in flot\n  } else if (isNumber(angular.fill)) {\n    graph.fillOpacity = angular.fill * 10; // fill was 0 - 10, new is 0 to 100\n  }\n\n  if (isNumber(angular.fillGradient) && angular.fillGradient > 0) {\n    graph.gradientMode = GraphGradientMode.Opacity;\n    graph.fillOpacity = angular.fillGradient * 10; // fill is 0-10\n  }\n\n  graph.spanNulls = angular.nullPointMode === NullValueMode.Ignore;\n\n  if (angular.steppedLine) {\n    graph.lineInterpolation = LineInterpolation.StepAfter;\n  }\n\n  if (graph.drawStyle === GraphDrawStyle.Bars) {\n    graph.fillOpacity = 100; // bars were always\n  }\n\n  if (angular.stack) {\n    graph.stacking = {\n      mode: angular.percentage ? StackingMode.Percent : StackingMode.Normal,\n      group: defaultGraphConfig.stacking!.group,\n    };\n\n    if (angular.percentage) {\n      if (angular.yaxis) {\n        delete y1.min;\n        delete y1.max;\n\n        // TimeSeries currently uses 0-1 for percent, so allowing zero leaves only top and bottom ticks.\n        // removing it feels better. probably should fix in TimeSeries, but let's kick it down the road\n        if (y1.decimals === 0) {\n          delete y1.decimals;\n        }\n      }\n    }\n  }\n\n  y1.custom = omitBy(graph, isNil);\n  y1.nullValueMode = angular.nullPointMode;\n\n  const options: Options = {\n    legend: {\n      displayMode: LegendDisplayMode.List,\n      showLegend: true,\n      placement: 'bottom',\n      calcs: [],\n    },\n    tooltip: {\n      mode: TooltipDisplayMode.Single,\n      sort: SortOrder.None,\n    },\n  };\n\n  // Legend config migration\n  const legendConfig = angular.legend;\n  if (legendConfig) {\n    if (legendConfig.show) {\n      options.legend.displayMode = legendConfig.alignAsTable ? LegendDisplayMode.Table : LegendDisplayMode.List;\n    } else {\n      options.legend.showLegend = false;\n    }\n\n    if (legendConfig.rightSide) {\n      options.legend.placement = 'right';\n    }\n\n    if (angular.legend.values) {\n      const enabledLegendValues = pickBy(angular.legend);\n      options.legend.calcs = getReducersFromLegend(enabledLegendValues);\n    }\n\n    if (angular.legend.sideWidth) {\n      options.legend.width = angular.legend.sideWidth;\n    }\n\n    if (legendConfig.hideZero) {\n      overrides.push(getLegendHideFromOverride(ReducerID.allIsZero));\n    }\n\n    if (legendConfig.hideEmpty) {\n      overrides.push(getLegendHideFromOverride(ReducerID.allIsNull));\n    }\n  }\n\n  // timeRegions migration\n  if (angular.timeRegions?.length) {\n    let regions = angular.timeRegions.map((old: GraphTimeRegionConfig, idx: number) => ({\n      name: `T${idx}`,\n      color: old.colorMode !== 'custom' ? old.colorMode : old.fillColor,\n      line: old.line,\n      fill: old.fill,\n      fromDayOfWeek: old.fromDayOfWeek,\n      toDayOfWeek: old.toDayOfWeek,\n      from: old.from,\n      to: old.to,\n    }));\n\n    regions.forEach((region: GraphTimeRegionConfig, idx: number) => {\n      const anno: AnnotationQuery<GrafanaQuery> = {\n        datasource: {\n          type: 'datasource',\n          uid: 'grafana',\n        },\n        enable: true,\n        hide: true, // don't show the toggle at the top of the dashboard\n        filter: {\n          exclude: false,\n          ids: [angular.panel.id],\n        },\n        iconColor: region.fillColor ?? (region as any).color,\n        name: `Time region for panel ${angular.panel.title}${idx > 0 ? ` ${idx}` : ''}`,\n        target: {\n          queryType: GrafanaQueryType.TimeRegions,\n          refId: 'Anno',\n          timeRegion: {\n            fromDayOfWeek: region.fromDayOfWeek,\n            toDayOfWeek: region.toDayOfWeek,\n            from: region.from,\n            to: region.to,\n            timezone: 'utc', // graph panel was always UTC\n          },\n        },\n      };\n\n      if (region.fill) {\n        annotations.push(anno);\n      } else if (region.line) {\n        anno.iconColor = region.lineColor ?? 'white';\n        annotations.push(anno);\n      }\n    });\n  }\n\n  const tooltipConfig = angular.tooltip;\n  if (tooltipConfig) {\n    if (tooltipConfig.shared !== undefined) {\n      options.tooltip.mode = tooltipConfig.shared ? TooltipDisplayMode.Multi : TooltipDisplayMode.Single;\n    }\n\n    if (tooltipConfig.sort !== undefined && tooltipConfig.shared) {\n      switch (tooltipConfig.sort) {\n        case 1:\n          options.tooltip.sort = SortOrder.Ascending;\n          break;\n        case 2:\n          options.tooltip.sort = SortOrder.Descending;\n          break;\n        default:\n          options.tooltip.sort = SortOrder.None;\n      }\n    }\n  }\n\n  if (angular.thresholds && angular.thresholds.length > 0) {\n    let steps: Threshold[] = [];\n    let area = false;\n    let line = false;\n\n    const sorted = (angular.thresholds as AngularThreshold[]).sort((a, b) => (a.value > b.value ? 1 : -1));\n\n    for (let idx = 0; idx < sorted.length; idx++) {\n      const threshold = sorted[idx];\n      const next = sorted.length > idx + 1 ? sorted[idx + 1] : null;\n\n      if (threshold.fill) {\n        area = true;\n      }\n\n      if (threshold.line) {\n        line = true;\n      }\n\n      if (threshold.op === 'gt') {\n        steps.push({\n          value: threshold.value,\n          color: getThresholdColor(threshold),\n        });\n      }\n\n      if (threshold.op === 'lt') {\n        if (steps.length === 0) {\n          steps.push({\n            value: -Infinity,\n            color: getThresholdColor(threshold),\n          });\n        }\n\n        // next op is gt and there is a gap set color to transparent\n        if (next && next.op === 'gt' && next.value > threshold.value) {\n          steps.push({\n            value: threshold.value,\n            color: 'transparent',\n          });\n          // if next is a lt we need to use its color\n        } else if (next && next.op === 'lt') {\n          steps.push({\n            value: threshold.value,\n            color: getThresholdColor(next),\n          });\n        } else {\n          steps.push({\n            value: threshold.value,\n            color: 'transparent',\n          });\n        }\n      }\n    }\n\n    // if now less then threshold add an -Infinity base that is transparent\n    if (steps.length > 0 && steps[0].value !== -Infinity) {\n      steps.unshift({\n        color: 'transparent',\n        value: -Infinity,\n      });\n    }\n\n    let displayMode = area ? GraphThresholdsStyleMode.Area : GraphThresholdsStyleMode.Line;\n    if (line && area) {\n      displayMode = GraphThresholdsStyleMode.LineAndArea;\n    }\n\n    // TODO move into standard ThresholdConfig ?\n    y1.custom.thresholdsStyle = { mode: displayMode };\n\n    y1.thresholds = {\n      mode: ThresholdsMode.Absolute,\n      steps,\n    };\n  }\n\n  if (angular.xaxis && angular.xaxis.show === false && angular.xaxis.mode === 'time') {\n    overrides.push({\n      matcher: {\n        id: FieldMatcherID.byType,\n        options: FieldType.time,\n      },\n      properties: [\n        {\n          id: 'custom.axisPlacement',\n          value: AxisPlacement.Hidden,\n        },\n      ],\n    });\n  }\n  return {\n    fieldConfig: {\n      defaults: omitBy(y1, isNil),\n      overrides,\n    },\n    options,\n    annotations,\n  };\n}\n\ninterface GraphTimeRegionConfig extends TimeRegionConfig {\n  colorMode: string;\n  fill: boolean;\n  fillColor: string;\n  line: boolean;\n  lineColor: string;\n}\n\nfunction getThresholdColor(threshold: AngularThreshold): string {\n  if (threshold.colorMode === 'critical') {\n    return 'red';\n  }\n\n  if (threshold.colorMode === 'warning') {\n    return 'orange';\n  }\n\n  if (threshold.colorMode === 'custom') {\n    return threshold.fillColor || threshold.lineColor;\n  }\n\n  return 'red';\n}\n\ninterface AngularThreshold {\n  op: string;\n  fill: boolean;\n  line: boolean;\n  value: number;\n  colorMode: 'critical' | 'warning' | 'custom';\n  yaxis?: 'left' | 'right';\n  fillColor: string;\n  lineColor: string;\n}\n\n// {\n//   \"label\": \"Y111\",\n//   \"show\": true,\n//   \"logBase\": 10,\n//   \"min\": \"0\",\n//   \"max\": \"1000\",\n//   \"format\": \"areaMI2\",\n//   \"$$hashKey\": \"object:19\",\n//   \"decimals\": 3\n// },\nfunction getFieldConfigFromOldAxis(obj: any): FieldConfig<GraphFieldConfig> {\n  if (!obj) {\n    return {};\n  }\n  const graph: GraphFieldConfig = {\n    axisPlacement: obj.show ? AxisPlacement.Auto : AxisPlacement.Hidden,\n  };\n  if (obj.label) {\n    graph.axisLabel = obj.label;\n  }\n  if (obj.logBase) {\n    const log: number = obj.logBase;\n    if (log === 2 || log === 10) {\n      graph.scaleDistribution = {\n        type: ScaleDistribution.Log,\n        log,\n      };\n    }\n  }\n  return omitBy(\n    {\n      unit: obj.format,\n      decimals: validNumber(obj.decimals),\n      min: validNumber(obj.min),\n      max: validNumber(obj.max),\n      custom: graph,\n    },\n    isNil\n  );\n}\n\nfunction fillY2DynamicValues(\n  y1: FieldConfig<GraphFieldConfig>,\n  y2: FieldConfig<GraphFieldConfig>,\n  props: DynamicConfigValue[]\n) {\n  // The standard properties\n  for (const [key, value] of Object.entries(y2)) {\n    if (key !== 'custom' && value !== (y1 as any)[key]) {\n      props.push({\n        id: key,\n        value,\n      });\n    }\n  }\n\n  props.push({\n    id: `custom.axisPlacement`,\n    value: AxisPlacement.Right,\n  });\n\n  // Add any custom property\n  const y1G = y1.custom ?? {};\n  const y2G = y2.custom ?? {};\n  for (const [key, value] of Object.entries(y2G)) {\n    if (value !== (y1G as any)[key]) {\n      props.push({\n        id: `custom.${key}`,\n        value,\n      });\n    }\n  }\n}\n\nfunction validNumber(val: unknown): number | undefined {\n  if (isNumber(val)) {\n    return val;\n  }\n  if (isString(val)) {\n    const num = Number(val);\n    if (!isNaN(num)) {\n      return num;\n    }\n  }\n  return undefined;\n}\n\nfunction getReducersFromLegend(obj: Record<string, unknown>): string[] {\n  const ids: string[] = [];\n  for (const key in obj) {\n    const r = fieldReducers.getIfExists(key);\n    if (r) {\n      ids.push(r.id);\n    }\n  }\n  return ids;\n}\n\nfunction migrateHideFrom(panel: {\n  fieldConfig?: { defaults?: { custom?: { hideFrom?: any } }; overrides: ConfigOverrideRule[] };\n}) {\n  if (panel.fieldConfig?.defaults?.custom?.hideFrom?.graph !== undefined) {\n    panel.fieldConfig.defaults.custom.hideFrom.viz = panel.fieldConfig.defaults.custom.hideFrom.graph;\n    delete panel.fieldConfig.defaults.custom.hideFrom.graph;\n  }\n  if (panel.fieldConfig?.overrides) {\n    panel.fieldConfig.overrides = panel.fieldConfig.overrides.map((fr) => {\n      fr.properties = fr.properties.map((p) => {\n        if (p.id === 'custom.hideFrom' && p.value.graph) {\n          p.value.viz = p.value.graph;\n          delete p.value.graph;\n        }\n        return p;\n      });\n      return fr;\n    });\n  }\n}\n\nfunction getLegendHideFromOverride(reducer: ReducerID.allIsZero | ReducerID.allIsNull) {\n  return {\n    matcher: {\n      id: FieldMatcherID.byValue,\n      options: {\n        reducer: reducer,\n        op: ComparisonOperation.GTE,\n        value: 0,\n      },\n    },\n    properties: [\n      {\n        id: 'custom.hideFrom',\n        value: {\n          tooltip: true,\n          viz: false,\n          legend: true,\n        },\n      },\n    ],\n  };\n}\n\nfunction getStackingFromOverrides(value: Boolean | string) {\n  const defaultGroupName = defaultGraphConfig.stacking?.group;\n  return {\n    mode: value ? StackingMode.Normal : StackingMode.None,\n    group: isString(value) ? value : defaultGroupName,\n  };\n}\n\nfunction addAnnotationsToDashboard(annotations: AnnotationQuery[]) {\n  const scene = window.__grafanaSceneContext;\n\n  if (scene instanceof DashboardScene) {\n    const dataLayers = dashboardSceneGraph.getDataLayers(scene);\n    const annotationLayers = [...dataLayers.state.annotationLayers];\n\n    for (let annotation of annotations) {\n      const newAnnotation = new DashboardAnnotationsDataLayer({\n        key: `annotations-${annotation.name}`,\n        query: annotation,\n        name: annotation.name,\n        isEnabled: annotation.enable,\n        isHidden: annotation.hide,\n      });\n\n      annotationLayers.push(newAnnotation);\n    }\n\n    dataLayers.setState({ annotationLayers });\n    return;\n  }\n\n  const dashboard = getDashboardSrv().getCurrent();\n  if (dashboard) {\n    dashboard.annotations.list = [...dashboard.annotations.list, ...annotations];\n\n    // Trigger a full dashboard refresh when annotations change\n    if (dashboardRefreshDebouncer == null) {\n      dashboardRefreshDebouncer = setTimeout(() => {\n        dashboardRefreshDebouncer = null;\n        getTimeSrv().refreshTimeModel();\n      });\n    }\n  }\n}\n","import { PanelPlugin } from '@grafana/data';\nimport { t } from '@grafana/i18n';\nimport { config } from '@grafana/runtime';\nimport { commonOptionsBuilder } from '@grafana/ui';\nimport { optsWithHideZeros } from '@grafana/ui/internal';\n\nimport { TimeSeriesPanel } from './TimeSeriesPanel';\nimport { TimezonesEditor } from './TimezonesEditor';\nimport { defaultGraphConfig, getGraphFieldConfig } from './config';\nimport { graphPanelChangedHandler } from './migrations';\nimport { FieldConfig, Options } from './panelcfg.gen';\nimport { TimeSeriesSuggestionsSupplier } from './suggestions';\n\nexport const plugin = new PanelPlugin<Options, FieldConfig>(TimeSeriesPanel)\n  .setPanelChangeHandler(graphPanelChangedHandler)\n  .useFieldConfig(getGraphFieldConfig(defaultGraphConfig))\n  .setPanelOptions((builder) => {\n    commonOptionsBuilder.addTooltipOptions(builder, false, true, optsWithHideZeros);\n    commonOptionsBuilder.addLegendOptions(builder);\n\n    if (config.featureToggles.timeComparison) {\n      commonOptionsBuilder.addTimeCompareOption(builder);\n    }\n\n    builder.addCustomEditor({\n      id: 'timezone',\n      name: t('timeseries.name-time-zone', 'Time zone'),\n      path: 'timezone',\n      category: [t('timeseries.category-axis', 'Axis')],\n      editor: TimezonesEditor,\n      defaultValue: undefined,\n    });\n  })\n  .setSuggestionsSupplier(new TimeSeriesSuggestionsSupplier())\n  .setDataSupport({ annotations: true, alertStates: true });\n","import { css } from '@emotion/css';\nimport { noop } from 'lodash';\nimport { useMemo, useState } from 'react';\nimport Draggable, { DraggableBounds } from 'react-draggable';\n\nimport { Threshold, GrafanaTheme2 } from '@grafana/data';\nimport { useStyles2, useTheme2 } from '@grafana/ui';\n\ntype OutOfBounds = 'top' | 'bottom' | 'none';\n\ninterface ThresholdDragHandleProps {\n  step: Threshold;\n  y: number;\n  dragBounds: DraggableBounds;\n  mapPositionToValue: (y: number) => number;\n  onChange?: (value: number) => void;\n  formatValue: (value: number) => string;\n}\n\nexport const ThresholdDragHandle = ({\n  step,\n  y,\n  dragBounds,\n  mapPositionToValue,\n  formatValue,\n  onChange,\n}: ThresholdDragHandleProps) => {\n  const theme = useTheme2();\n  let yPos = y;\n  let outOfBounds: OutOfBounds = 'none';\n\n  if (y < (dragBounds.top ?? 0)) {\n    outOfBounds = 'top';\n  }\n\n  // there seems to be a 22px offset at the bottom where the threshold line is still drawn\n  // this is probably offset by the size of the x-axis component\n  if (y > (dragBounds.bottom ?? 0) + 22) {\n    outOfBounds = 'bottom';\n  }\n\n  if (outOfBounds === 'bottom') {\n    yPos = dragBounds.bottom ?? y;\n  }\n\n  if (outOfBounds === 'top') {\n    yPos = dragBounds.top ?? y;\n  }\n\n  const disabled = typeof onChange !== 'function';\n  const styles = useStyles2(getStyles, step, outOfBounds, disabled);\n  const [currentValue, setCurrentValue] = useState(step.value);\n\n  const textColor = useMemo(() => {\n    return theme.colors.getContrastText(theme.visualization.getColorByName(step.color));\n  }, [step.color, theme]);\n\n  return (\n    <Draggable\n      axis=\"y\"\n      grid={[1, 1]}\n      disabled={disabled}\n      onStop={\n        disabled\n          ? noop\n          : (_e, d) => {\n              onChange(mapPositionToValue(d.lastY));\n              // as of https://github.com/react-grid-layout/react-draggable/issues/390#issuecomment-623237835\n              return false;\n            }\n      }\n      onDrag={(_e, d) => setCurrentValue(mapPositionToValue(d.lastY))}\n      position={{ x: 0, y: yPos }}\n      bounds={dragBounds}\n    >\n      <div className={styles.handle} style={{ color: textColor }}>\n        <span className={styles.handleText}>{formatValue(currentValue)}</span>\n      </div>\n    </Draggable>\n  );\n};\n\nThresholdDragHandle.displayName = 'ThresholdDragHandle';\n\nconst getStyles = (theme: GrafanaTheme2, step: Threshold, outOfBounds: OutOfBounds, disabled?: boolean) => {\n  const mainColor = theme.visualization.getColorByName(step.color);\n  const arrowStyles = getArrowStyles(outOfBounds);\n  const isOutOfBounds = outOfBounds !== 'none';\n\n  return {\n    handle: css(\n      {\n        display: 'flex',\n        alignItems: 'center',\n        position: 'absolute',\n        left: 0,\n        width: 'calc(100% - 9px)',\n        height: '18px',\n        marginTop: '-9px',\n        borderColor: mainColor,\n        cursor: disabled ? 'initial' : 'grab',\n        borderTopRightRadius: theme.shape.radius.default,\n        borderBottomRightRadius: theme.shape.radius.default,\n        background: mainColor,\n        fontSize: theme.typography.bodySmall.fontSize,\n        '&:before': arrowStyles,\n      },\n      isOutOfBounds && {\n        marginTop: 0,\n        borderRadius: theme.shape.radius.default,\n      }\n    ),\n    handleText: css({\n      textAlign: 'center',\n      width: '100%',\n      display: 'block',\n      textOverflow: 'ellipsis',\n      whiteSpace: 'nowrap',\n      overflow: 'hidden',\n    }),\n  };\n};\n\nfunction getArrowStyles(outOfBounds: OutOfBounds) {\n  const inBounds = outOfBounds === 'none';\n\n  const triangle = (size: number) =>\n    ({\n      content: \"''\",\n      position: 'absolute',\n\n      bottom: 0,\n      top: 0,\n      width: 0,\n      height: 0,\n      left: 0,\n\n      borderRightStyle: 'solid',\n      borderRightWidth: `${size}px`,\n      borderRightColor: 'inherit',\n      borderTop: `${size}px solid transparent`,\n      borderBottom: `${size}px solid transparent`,\n    }) as const;\n\n  if (inBounds) {\n    return css({\n      ...triangle(9),\n      left: '-9px',\n    });\n  }\n\n  if (outOfBounds === 'top') {\n    return css({\n      ...triangle(5),\n      left: 'calc(50% - 2.5px)',\n      top: '-7px',\n      transform: 'rotate(90deg)',\n    });\n  }\n\n  if (outOfBounds === 'bottom') {\n    return css({\n      ...triangle(5),\n      left: 'calc(50% - 2.5px)',\n      top: 'calc(100% - 2.5px)',\n      transform: 'rotate(-90deg)',\n    });\n  }\n\n  return '';\n}\n","import { useState, useLayoutEffect, useMemo, useRef } from 'react';\nimport uPlot from 'uplot';\n\nimport { FieldConfigSource, ThresholdsConfig, getValueFormat, FieldType } from '@grafana/data';\nimport { UPlotConfigBuilder } from '@grafana/ui';\nimport { buildScaleKey } from '@grafana/ui/internal';\n\nimport { ThresholdDragHandle } from './ThresholdDragHandle';\n\nconst GUTTER_SIZE = 60;\n\ninterface ThresholdControlsPluginProps {\n  config: UPlotConfigBuilder;\n  fieldConfig: FieldConfigSource;\n  onThresholdsChange?: (thresholds: ThresholdsConfig) => void;\n}\n\nexport const ThresholdControlsPlugin = ({ config, fieldConfig, onThresholdsChange }: ThresholdControlsPluginProps) => {\n  const plotInstance = useRef<uPlot>();\n  const [renderToken, setRenderToken] = useState(0);\n\n  useLayoutEffect(() => {\n    config.setPadding([0, GUTTER_SIZE, 0, 0]);\n\n    config.addHook('init', (u) => {\n      plotInstance.current = u;\n    });\n    // render token required to re-render handles when resizing uPlot\n    config.addHook('draw', () => {\n      setRenderToken((s) => s + 1);\n    });\n  }, [config]);\n\n  const thresholdHandles = useMemo(() => {\n    const plot = plotInstance.current;\n\n    if (!plot) {\n      return null;\n    }\n    const thresholds = fieldConfig.defaults.thresholds;\n    if (!thresholds) {\n      return null;\n    }\n    const scale = buildScaleKey(fieldConfig.defaults, FieldType.number);\n\n    const decimals = fieldConfig.defaults.decimals;\n    const handles = [];\n\n    for (let i = 0; i < thresholds.steps.length; i++) {\n      const step = thresholds.steps[i];\n      const yPos = plot.valToPos(step.value, scale);\n\n      if (Number.isNaN(yPos) || !Number.isFinite(yPos)) {\n        continue;\n      }\n\n      const height = plot.bbox.height / window.devicePixelRatio;\n\n      const isEditable = typeof onThresholdsChange === 'function';\n\n      const onChange = isEditable\n        ? (value: number) => {\n            const nextSteps = [\n              ...thresholds.steps.slice(0, i),\n              ...thresholds.steps.slice(i + 1),\n              { ...thresholds.steps[i], value },\n            ].sort((a, b) => a.value - b.value);\n\n            onThresholdsChange({\n              ...thresholds,\n              steps: nextSteps,\n            });\n          }\n        : undefined;\n\n      const handle = (\n        <ThresholdDragHandle\n          key={`${step.value}-${i}`}\n          step={step}\n          y={yPos}\n          dragBounds={{ top: 0, bottom: height }}\n          mapPositionToValue={(y) => plot.posToVal(y, scale)}\n          formatValue={(v) => getValueFormat(scale)(v, decimals).text}\n          onChange={onChange}\n        />\n      );\n\n      handles.push(handle);\n    }\n\n    return handles;\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [renderToken, fieldConfig, onThresholdsChange]);\n\n  if (!plotInstance.current) {\n    return null;\n  }\n\n  return (\n    <div\n      style={{\n        position: 'absolute',\n        overflow: 'visible',\n        left: `${(plotInstance.current.bbox.left + plotInstance.current.bbox.width) / window.devicePixelRatio}px`,\n        top: `${plotInstance.current.bbox.top / window.devicePixelRatio}px`,\n        width: `${GUTTER_SIZE}px`,\n        height: `${plotInstance.current.bbox.height / window.devicePixelRatio}px`,\n      }}\n    >\n      {thresholdHandles}\n    </div>\n  );\n};\n\nThresholdControlsPlugin.displayName = 'ThresholdControlsPlugin';\n","import { LinkModel } from '@grafana/data';\nimport { t } from '@grafana/i18n';\nimport {\n  VizTooltipContent,\n  VizTooltipFooter,\n  VizTooltipItem,\n  VizTooltipHeader,\n  VizTooltipWrapper,\n} from '@grafana/ui/internal';\n\nexport interface Props {\n  items: VizTooltipItem[];\n  links?: LinkModel[];\n  isPinned: boolean;\n  maxHeight?: number;\n}\n\nexport const ExemplarTooltip = ({ items, links, isPinned, maxHeight }: Props) => {\n  const timeItem = items.find((val) => val.label === 'Time');\n\n  return (\n    <VizTooltipWrapper>\n      <VizTooltipHeader\n        item={{\n          label: t('exemplar-tooltip-header', 'Exemplar'),\n          value: timeItem?.value ?? '',\n        }}\n        isPinned={isPinned}\n      />\n      <VizTooltipContent\n        items={items.filter((item) => item !== timeItem)}\n        isPinned={isPinned}\n        maxHeight={maxHeight}\n        scrollable={maxHeight != null}\n      />\n      <VizTooltipFooter dataLinks={links ?? []} />\n    </VizTooltipWrapper>\n  );\n};\n"],"names":["ExemplarMarker","timeZone","dataFrame","frameIndex","rowIndex","config","exemplarColor","clickedRowIndex","setClickedRowIndex","maxHeight","maxWidth","styles","getExemplarMarkerStyles","isOpen","setIsOpen","isLocked","setIsLocked","middleware","context","refs","floatingStyles","dismiss","hover","getReferenceProps","getFloatingProps","getSymbol","lockExemplarModal","renderMarker","onClose","items","links","field","value","fieldDisplay","CloseButton","ExemplarTooltip","seriesColor","s","onExemplarClick","selectors","e","Portal","theme","ExemplarsPlugin","exemplars","visibleSeries","plotInstance","lockedExemplarRowIndex","setLockedExemplarRowIndex","u","mapExemplarToXYCoords","time","f","yScale","scale","key","yMin","yMax","y","showMarker","showExemplarMarker","markerColor","getExemplarColor","EventsCanvas","getVisibleLabels","frames","series","visibleLabels","fieldIndex","visibleLabel","labelKeys","fields","labelKey","index","label","TimeSeriesSuggestionsSupplier","builder","dataSummary","list","maxBarsCount","getPrepareTimeseriesSuggestion","panelId","panel","transformations","TimeSeriesPanel","data","timeRange","width","height","options","fieldConfig","onChangeTimeRange","replaceVariables","id","sync","eventsScope","canAddAnnotations","onThresholdsChange","canEditThresholds","showThresholds","dataLinkPostProcessor","eventBus","canExecuteActions","userCanExecuteActions","isVerticallyOriented","compareDiffMs","frame","diffMs","timezones","suggestions","df","enableAnnotationCreation","newAnnotationRange","setNewAnnotationRange","cursorSync","PanelDataErrorView","TimeSeries","uplotConfig","alignedFrame","KeyboardPlugin","EventBusPlugin","TooltipPlugin2","seriesIdx","dataIdx","dataIdxs","isPinned","timeRange2","viaSync","dataLinks","annotate","xVal","TimeSeriesTooltip","AnnotationsPlugin2","OutsideRangePlugin","ThresholdControlsPlugin","TimezonesEditor","onChange","getStyles","addTimezone","removeTimezone","idx","copy","setTimezone","tz","TimeZonePicker","v","IconButton","dashboardRefreshDebouncer","graphPanelChangedHandler","prevPluginId","prevOptions","prevFieldConfig","annotations","graphToTimeseriesOptions","addAnnotationsToDashboard","migrateHideFrom","angular","overrides","yaxes","y1","getFieldConfigFromOldAxis","dash","alias","color","hasFillBelowTo","seriesOverride","rule","dashOverride","p","y2","fillY2DynamicValues","getStackingFromOverrides","graph","legendConfig","enabledLegendValues","getReducersFromLegend","getLegendHideFromOverride","old","region","anno","tooltipConfig","steps","area","line","sorted","a","b","threshold","next","getThresholdColor","displayMode","obj","log","validNumber","props","y1G","y2G","val","num","ids","r","fieldReducer","fr","reducer","defaultGroupName","scene","DashboardScene","dataLayers","dashboardSceneGraph","annotationLayers","annotation","newAnnotation","DashboardAnnotationsDataLayer","dashboard","PanelPlugin","ThresholdDragHandle","step","dragBounds","mapPositionToValue","formatValue","yPos","outOfBounds","disabled","currentValue","setCurrentValue","textColor","_e","d","mainColor","arrowStyles","getArrowStyles","isOutOfBounds","inBounds","triangle","size","GUTTER_SIZE","renderToken","setRenderToken","thresholdHandles","plot","thresholds","decimals","handles","i","nextSteps","handle","timeItem","item"],"sourceRoot":""}