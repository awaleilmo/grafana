"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[6299],{3853:(q,x,t)=>{t.r(x),t.d(x,{default:()=>dt});var a=t(74848),c=t(22803),o=t(96540),L=t(70713),l=t(92745),s=t(63142),m=t(12737),M=t(13791),h=t(63498),T=t(55860),E=t(52763),y=t(78012),p=t(99090),v=t(42361),I=t(75793);class B extends I.lC{constructor(){super(...arguments),this.getTagOptions=async()=>{try{const d=await v.v.get(),S=new Map;return d.forEach(C=>{C.tags.forEach(D=>{D&&S.set(D,(S.get(D)||0)+1)})}),Array.from(S.entries()).map(([C,D])=>({term:C,count:D})).sort((C,D)=>D.count-C.count)}catch(d){return console.error("Failed to get tags from deleted dashboards:",d),[]}},this.getSortOptions=async()=>Promise.resolve([{label:(0,l.t)("browse-dashboards.trash-state-manager.label.alphabetically-az","Alphabetically (A\u2013Z)"),value:"alpha-asc"},{label:(0,l.t)("browse-dashboards.trash-state-manager.label.alphabetically-za","Alphabetically (Z\u2013A)"),value:"alpha-desc"}])}setStateAndDoSearch(d){const S=d.sort||this.state.sort||y.M.get(p.w7)||void 0,i=d.query??this.state.query,C=d.tag??this.state.tag,D=i.length===0&&C.length===0;this.setState({sort:S,result:D?void 0:this.state.result,...d}),this.updateLocation({query:this.state.query.length===0?null:this.state.query,tag:this.state.tag,datasource:this.state.datasource,panel_type:this.state.panel_type,starred:this.state.starred?this.state.starred:null,sort:this.state.sort}),this.hasSearchFilters()&&this.doSearchWithDebounce()}}let r;function u(){return r||(r=new B({...I.ue,includePanels:!1,deleted:!0})),r}function e(){const g=u();return[g.useState(),g]}var n=t(27489),f=t(41654),A=t(45861),O=t(45229),R=t(75735),V=t(87745),b=t(15203),Q=t(80231),K=t(87186),F=t(71599),$=t(66404),_=t(35137),Y=t(91156);const G=({onConfirm:g,onDismiss:d,selectedDashboards:S,dashboardOrigin:i,isLoading:C,...D})=>{const[W,U]=(0,o.useState)(()=>i.length>0&&i.every(X=>X===i[0])?i[0]:void 0),j=S.length,J=async()=>{(0,n.rR)("grafana_restore_confirm_clicked",{item_counts:{dashboard:j}}),W!==void 0&&(await g(W),d())};return(0,a.jsx)(F.u,{body:(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)($.E,{element:"p",children:(0,a.jsxs)(l.x6,{i18nKey:"recently-deleted.restore-modal.text",count:j,children:["This action will restore ",{numberOfDashboards:j}," dashboards."]})}),(0,a.jsx)(_.$,{v:3}),(0,a.jsx)($.E,{element:"p",children:(0,a.jsx)(l.x6,{i18nKey:"recently-deleted.restore-modal.folder-picker-text",count:j,children:"Please choose a folder where your dashboards will be restored."})}),(0,a.jsx)(_.$,{v:1}),(0,a.jsx)(Y.d,{onChange:U,value:W})]}),confirmText:C?(0,l.t)("recently-deleted.restore-modal.restore-loading","Restoring..."):(0,l.t)("recently-deleted.restore-modal.restore-button","Restore"),confirmButtonVariant:"primary",onDismiss:d,onConfirm:J,title:(0,l.t)("recently-deleted.restore-modal.title","Restore Dashboards"),disabled:W===void 0,...D})};function P(){const g=(0,E.wA)(),d=(0,Q.xK)(),[S,i]=e(),C=(0,b.CE)(),[D,{isLoading:W}]=(0,b.vR)(),U=(0,o.useMemo)(()=>Object.entries(d.dashboard).filter(([z,w])=>w).map(([z])=>z),[d.dashboard]),j=[];if(S.result)for(const z of U){const w=S.result.view.fields.uid.values.findIndex(k=>k===z),tt=S.result.view.fields.location.values[w],et=tt===p.TF?"":tt;j.push(et)}const J=()=>{g((0,K.cT)({isSelected:!1,folderUID:void 0})),v.v.clear(),i.doSearchWithDebounce()},X=async z=>{const w=i.state.result?.view.toArray();if(!w)return;const tt=U.map(k=>{const Z=C.data?.items.find(rt=>rt.metadata.name===k);if(!Z)return Promise.resolve();const H=structuredClone(Z);return H.metadata={...H.metadata,annotations:{...H.metadata?.annotations,[R.ew]:z}},D({dashboard:H})});await Promise.all(tt);const et=new Set;for(const k of U){const Z=w.find(rt=>rt.uid===k);if(!Z)continue;const H=Z.location===p.TF?void 0:Z.location;et.add(H)}g((0,K.xN)(Array.from(et))),J()},st=()=>{(0,n.rR)("grafana_restore_clicked",{item_counts:{dashboard:U.length}}),O.A.publish(new V.S8({component:G,props:{selectedDashboards:U,dashboardOrigin:j,onConfirm:X,isLoading:W}}))};return(0,a.jsx)(f.B,{gap:1,children:(0,a.jsx)(A.$n,{onClick:st,variant:"secondary",children:(0,a.jsx)(l.x6,{i18nKey:"recently-deleted.buttons.restore",children:"Restore"})})})}var N=t(50201);const at=({searchState:g})=>{const d=!!(g.query||g.tag.length);return(0,a.jsx)(N.p,{message:d?(0,l.t)("recently-deleted.page.no-search-result","No results found for your query"):(0,l.t)("recently-deleted.page.no-deleted-dashboards","You haven't deleted any dashboards recently."),variant:d?"not-found":"completed",role:"alert",children:(0,a.jsx)(l.x6,{i18nKey:"recently-deleted.page.no-deleted-dashboards-text",children:"When you delete a dashboard, it will appear here for 30 days before being permanently deleted. Your organization administrator can restore recently-deleted dashboards."})})};var nt=t(85643),lt=t(83485);const ot=(0,o.memo)(()=>{const g=(0,E.wA)(),d=(0,s.of)(it),[S,i]=e(),C=(0,Q.QE)(),{canEditFolders:D,canEditDashboards:W,canDeleteFolders:U,canDeleteDashboards:j}=(0,lt.N)(),J={canEditFolders:D,canEditDashboards:W,canDeleteFolders:U,canDeleteDashboards:j};return(0,o.useEffect)(()=>{i.initStateFromUrl(void 0),g((0,K.cT)({isSelected:!1,folderUID:void 0}))},[g,i]),(0,a.jsx)(M.Y,{navId:"dashboards/recently-deleted",children:(0,a.jsxs)(M.Y.Contents,{className:d.pageContents,children:[(0,a.jsx)("div",{children:(0,a.jsx)(m.Z,{placeholder:(0,l.t)("recentlyDeleted.filter.placeholder","Search for dashboards"),value:S.query,escapeRegex:!1,onChange:i.onQueryChange})}),C?(0,a.jsx)(P,{}):(0,a.jsx)("div",{className:d.filters,children:(0,a.jsx)(h.bj,{state:S,getTagOptions:i.getTagOptions,getSortOptions:i.getSortOptions,sortPlaceholder:(0,T.S)().sortPlaceholder,onLayoutChange:i.onLayoutChange,onSortChange:i.onSortChange,onTagFilterChange:i.onTagFilterChange,onDatasourceChange:i.onDatasourceChange,onPanelTypeChange:i.onPanelTypeChange,onSetIncludePanels:i.onSetIncludePanels})}),(0,a.jsx)("div",{className:d.subView,children:(0,a.jsx)(L.Ay,{children:({width:X,height:st})=>(0,a.jsx)(nt.Q,{permissions:J,width:X,height:st,searchStateManager:i,searchState:S,emptyState:(0,a.jsx)(at,{searchState:S})})})})]})})}),it=g=>({pageContents:(0,c.css)({display:"flex",flexDirection:"column",gap:g.spacing(1),height:"100%"}),subView:(0,c.css)({height:"100%"}),filters:(0,c.css)({display:"none",[g.breakpoints.up("md")]:{display:"block"}})});ot.displayName="RecentlyDeletedPage";const dt=ot},63498:(q,x,t)=>{t.d(x,{bj:()=>I});var a=t(74848),c=t(22803),o=t(92745),L=t(43173),l=t(45861),s=t(41654),m=t(77824),M=t(32635),h=t(63142),T=t(18552),E=t(93732),y=t(83458);function p(){return[{value:y.P.Folders,icon:"folder",description:(0,o.t)("search.actions.view-as-folders","View by folders")},{value:y.P.List,icon:"list-ul",description:(0,o.t)("search.actions.view-as-list","View as list")}]}function v(r){const u=r.layout??y.P.Folders;return u===y.P.Folders&&(r.query||r.sort||r.starred||r.tag.length>0)?y.P.List:u}const I=({state:r,showStarredFilter:u,showLayout:e,sortPlaceholder:n,onLayoutChange:f,onSortChange:A,onStarredFilterChange:O=()=>{},onTagFilterChange:R,getTagOptions:V,getSortOptions:b,onDatasourceChange:Q,onPanelTypeChange:K,onSetIncludePanels:F})=>{const $=(0,h.of)(B),_=v(r),Y=r.tag.length||r.starred||r.query||r.datasource||r.panel_type?[y.P.Folders]:[];return(0,a.jsxs)(s.B,{justifyContent:"space-between",alignItems:"center",children:[(0,a.jsxs)(s.B,{gap:2,alignItems:"center",children:[(0,a.jsx)(E.$,{isClearable:!1,tags:r.tag,tagOptions:V,onChange:R}),L.$.featureToggles.panelTitleSearch&&(0,a.jsx)(M.S,{"data-testid":"include-panels",disabled:_===y.P.Folders,value:r.includePanels,onChange:()=>F(!r.includePanels),label:(0,o.t)("search.actions.include-panels","Include panels")}),u&&(0,a.jsx)("div",{className:$.checkboxWrapper,children:(0,a.jsx)(M.S,{label:(0,o.t)("search.actions.starred","Starred"),onChange:O,value:r.starred})}),r.datasource&&(0,a.jsx)(l.$n,{icon:"times",variant:"secondary",onClick:()=>Q(void 0),children:(0,a.jsxs)(o.x6,{i18nKey:"search.actions.remove-datasource-filter",children:["Datasource: ",{datasource:r.datasource}]})}),r.panel_type&&(0,a.jsx)(l.$n,{icon:"times",variant:"secondary",onClick:()=>K(void 0),children:(0,a.jsxs)(o.x6,{i18nKey:"search.action-row.panel-type",values:{panel:r.panel_type},children:["Panel: ","{{panel}}"]})})]}),(0,a.jsxs)(s.B,{gap:2,children:[e&&(0,a.jsx)(m.z,{options:p(),disabledOptions:Y,onChange:f,value:_}),(0,a.jsx)(T.r,{onChange:G=>A(G?.value),value:r.sort,getSortOptions:b,placeholder:n||(0,o.t)("search.actions.sort-placeholder","Sort"),isClearable:!0})]})]})};I.displayName="ActionRow";const B=r=>({checkboxWrapper:(0,c.css)({label:{lineHeight:"1.2"}})})},75793:(q,x,t)=>{t.d(x,{ET:()=>r,lC:()=>v,ue:()=>E});var a=t(2543),c=t.n(a),o=t(36490),L=t(5114),l=t(29043),s=t(99090),m=t(67497),M=t(55860),h=t(83458),T=t(35886);const E={query:"",tag:[],starred:!1,layout:h.P.Folders,sort:void 0,prevSort:void 0,eventTrackingNamespace:"dashboard_search",deleted:!1},y={sort:null,starred:null,query:null,tag:null,layout:null},p=()=>localStorage.getItem(s.YU)===h.P.List?h.P.List:h.P.Folders;class v extends L.Q{constructor(){super(...arguments),this.updateLocation=(0,a.debounce)(e=>o.Ny.partial(e,!0),300),this.doSearchWithDebounce=(0,a.debounce)(()=>this.doSearch(),300),this.lastSearchTimestamp=0,this.onCloseSearch=()=>{this.updateLocation({search:null,folder:null,...y})},this.onClearSearchAndFilters=()=>{this.setStateAndDoSearch({query:"",datasource:void 0,tag:[],panel_type:void 0,starred:void 0,sort:void 0})},this.onQueryChange=e=>{this.setStateAndDoSearch({query:e})},this.onRemoveTag=e=>{this.setStateAndDoSearch({tag:this.state.tag.filter(n=>n!==e)})},this.onTagFilterChange=e=>{this.setStateAndDoSearch({tag:e})},this.onAddTag=e=>{this.state.tag&&this.state.tag.includes(e)||this.setStateAndDoSearch({tag:[...this.state.tag,e]})},this.onDatasourceChange=e=>{this.setStateAndDoSearch({datasource:e})},this.onPanelTypeChange=e=>{this.setStateAndDoSearch({panel_type:e})},this.onStarredFilterChange=e=>{const n=e.currentTarget.checked;this.setStateAndDoSearch({starred:n})},this.onClearStarred=()=>{this.setStateAndDoSearch({starred:!1})},this.onSetStarred=e=>{e!==this.state.starred&&this.setStateAndDoSearch({starred:e})},this.onSortChange=e=>{e?(localStorage.setItem(s.w7,e),localStorage.setItem(s.YU,h.P.List)):localStorage.removeItem(s.w7),this.state.layout===h.P.Folders?this.setStateAndDoSearch({sort:e,layout:h.P.List}):this.setStateAndDoSearch({sort:e})},this.onLayoutChange=e=>{localStorage.setItem(s.YU,e),this.state.sort&&e===h.P.Folders?this.setStateAndDoSearch({layout:e,prevSort:this.state.sort,sort:void 0}):this.setStateAndDoSearch({layout:e,sort:this.state.prevSort})},this.onSetIncludePanels=e=>{this.setStateAndDoSearch({includePanels:e}),l.A.set(s.d7,e)},this.getTagOptions=()=>{const e=this.lastQuery??{kind:["dashboard","folder"],query:"*"};return(0,M.S)().tags(e)},this.onSearchItemClicked=e=>{(0,m.MK)(this.state.eventTrackingNamespace,{layout:this.state.layout,starred:this.state.starred,sortValue:this.state.sort,query:this.state.query,tagCount:this.state.tag?.length,includePanels:this.state.includePanels,deleted:this.state.deleted})},this.onReportSearchUsage=()=>{(0,m.Pf)(this.state.eventTrackingNamespace,{layout:this.state.layout,starred:this.state.starred,sortValue:this.state.sort,query:this.state.query,tagCount:this.state.tag?.length,includePanels:this.state.includePanels,deleted:this.state.deleted})}}initStateFromUrl(e,n=!0){const f=(0,T.N1)(o.Ny.getSearchObject());(f.query||f.datasource||f.panel_type)&&(f.layout=h.P.List);const A=p(),O=localStorage.getItem(s.w7)??void 0,R=A===h.P.List?f.sort||O:null;this.setState({...E,...f,layout:A,sort:R??E.sort,prevSort:O,folderUid:e,eventTrackingNamespace:e?"manage_dashboards":"dashboard_search",deleted:this.state.deleted}),n&&this.hasSearchFilters()&&this.doSearch()}setStateAndDoSearch(e){const n=e.sort||this.state.sort||localStorage.getItem(s.w7)||void 0;this.setState({sort:n,...e}),this.updateLocation({query:this.state.query.length===0?null:this.state.query,tag:this.state.tag,datasource:this.state.datasource,panel_type:this.state.panel_type,starred:this.state.starred?this.state.starred:null,sort:this.state.sort}),this.hasSearchFilters()&&this.doSearchWithDebounce()}hasSearchFilters(){return!!(this.state.query||this.state.tag.length||this.state.starred||this.state.panel_type||this.state.sort||this.state.deleted||this.state.layout===h.P.List)}getSearchQuery(){const e={query:this.state.query,tags:this.state.tag,ds_uid:this.state.datasource,panel_type:this.state.panel_type,location:this.state.folderUid,sort:this.state.sort,explain:this.state.explain,withAllowedActions:this.state.explain,starred:this.state.starred,deleted:this.state.deleted};return e.sort?.length&&!e.sort.includes("name")&&(e.kind=["dashboard","folder"]),e.query?.length||(e.query="*",e.location||(e.kind=["dashboard","folder"])),!this.state.includePanels&&!e.kind&&(e.kind=["dashboard","folder"]),e.panel_type?.length&&(e.kind=["panel"]),e}doSearch(){const e={layout:this.state.layout,starred:this.state.starred,sortValue:this.state.sort,query:this.state.query,tagCount:this.state.tag?.length,includePanels:this.state.includePanels,deleted:this.state.deleted};(0,m.J$)(this.state.eventTrackingNamespace,e),this.lastQuery=this.getSearchQuery(),this.setState({loading:!0});const n=(0,M.S)(),f=Date.now();(this.state.starred?n.starred(this.lastQuery):n.search(this.lastQuery)).then(O=>{f>this.lastSearchTimestamp&&(this.setState({result:O,loading:!1}),this.lastSearchTimestamp=f)}).catch(O=>{(0,m.KZ)(this.state.eventTrackingNamespace,{...e,error:O?.message}),this.setState({loading:!1})})}}let I;function B(){if(!I){const e=localStorage.getItem(s.YU)??E.layout;let n=l.A.getBool(s.d7,!0);n&&(n=!1),I=new v({...E,layout:e,includePanels:n})}return I}function r(){const u=B();return[u.useState(),u]}},83485:(q,x,t)=>{t.d(x,{N:()=>l});var a=t(73427),c=t(11257);function o(s,m){return m?a.TP.hasPermissionInMetadata(s,m):a.TP.hasPermission(s)}function L(s){return o(c.w.FoldersCreate,s)}function l(s){const m=o(c.w.DashboardsCreate,s),M=L(s),h=o(c.w.FoldersDelete,s),T=o(c.w.DashboardsDelete,s),E=o(c.w.DashboardsWrite,s),y=o(c.w.FoldersWrite,s),p=o(c.w.FoldersPermissionsWrite,s),v=o(c.w.FoldersPermissionsRead,s);return{canCreateDashboards:m,canCreateFolders:M,canDeleteFolders:h,canEditDashboards:E,canEditFolders:y,canSetPermissions:p,canViewPermissions:v,canDeleteDashboards:T}}},85643:(q,x,t)=>{t.d(x,{Q:()=>B});var a=t(74848),c=t(96540),o=t(88673),L=t(41119),l=t(92745),s=t(50201),m=t(45861),M=t(5478),h=t(86436),T=t(52763),E=t(80231),y=t(87186),p=t(62963);const v=25,I={view:new o.R((0,L.Vc)({fields:[{name:"uid",display:!0,values:Array(v).fill(null)},{name:"kind",display:!0,values:Array(v).fill("dashboard")},{name:"name",display:!0,values:Array(v).fill("")},{name:"location",display:!0,values:Array(v).fill("")},{name:"tags",display:!0,values:Array(v).fill([])}],meta:{custom:{locationInfo:[]}}})),loadMoreItems:()=>Promise.resolve(),isItemLoaded:()=>!1,totalRows:v};function B({width:u,height:e,permissions:n,searchState:f,searchStateManager:A,emptyState:O}){const R=(0,T.wA)(),V=(0,T.d4)(P=>P.browseDashboards.selectedItems),b=(0,E.QE)(),{keyboardEvents:Q}=(0,M.d)(),K=f.result??I,F=(0,c.useCallback)((P,N)=>!P||!(0,p.Gf)(P,n)?!1:P==="*"&&N==="*"?b:P==="*"?!1:V[r(P)][N]??!1,[V,b,n]),$=(0,c.useCallback)(()=>{R((0,y.cT)({isSelected:!1,folderUID:void 0}))},[R]),_=(0,c.useCallback)((P,N)=>{if(!(0,p.Gf)(P,n))return;const at=!F(P,N);R((0,y.t$)({item:{kind:r(P),uid:N},isSelected:at}))},[F,R,n]);if(K.totalRows===0){const P=O??(0,a.jsx)(s.p,{button:(0,a.jsx)(m.$n,{variant:"secondary",onClick:A.onClearSearchAndFilters,children:(0,a.jsx)(l.x6,{i18nKey:"browse-dashboards.no-results.clear",children:"Clear search and filters"})}),message:(0,l.t)("browse-dashboards.no-results.text","No results found for your query"),variant:"not-found",role:"alert"});return(0,a.jsx)("div",{style:{width:u},children:P})}const Y=(0,p.X2)(n),G={response:K,selection:Y?F:void 0,selectionToggle:Y?_:void 0,clearSelection:$,width:u,height:e,onTagSelected:A.onAddTag,keyboardEvents:Q,onDatasourceChange:f.datasource?A.onDatasourceChange:void 0,onClickItem:A.onSearchItemClicked};return(0,a.jsx)(h.P,{...G})}function r(u){switch(u){case"folder":return"folder";case"dashboard":return"dashboard";case"panel":return"panel"}throw new Error("Unsupported kind"+u)}}}]);

//# sourceMappingURL=RecentlyDeletedPage.15df72ac803f8ffc1d2c.js.map