"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[1743],{9390:(w,y,a)=>{a.d(y,{r:()=>g});var e=a(74848),i=a(90382),h=a(92745),d=a(18857);const v=Object.values(i.X).filter(j=>j!==i.X.None).map(j=>({label:j,value:j}));function g({value:j,onChange:O,"aria-label":L,inputId:b,autoFocus:f,...C}){return(0,e.jsx)(d.l6,{inputId:b,value:j,options:v,onChange:U=>O(U.value??i.X.None),placeholder:(0,h.t)("admin.org-role-picker.placeholder-choose-role","Choose role..."),"aria-label":L,autoFocus:f,...C})}},12074:(w,y,a)=>{a.r(y),a.d(y,{default:()=>As});var e=a(74848),i=a(22803),h=a(96540),d=a(51898),t=a(92745),v=a(43173),g=a(60208),j=a(63142),O=a(54314),L=a(15130),b=a(24313),f=a(11257),C=a(13791),U=a(71468),$=a(67458),K=a(34999),m=a(73427),B=a(77527),R=a(47931),P=a(45861),N=a(61666);const F={revokeInvite:N.eb},S=(0,U.connect)(null,F);class J extends h.PureComponent{render(){const{invitee:n,revokeInvite:r}=this.props;return(0,e.jsxs)("tr",{children:[(0,e.jsx)("td",{children:n.email}),(0,e.jsx)("td",{children:n.name}),(0,e.jsxs)("td",{className:"text-right",children:[(0,e.jsx)(R.b,{icon:"copy",variant:"secondary",size:"sm",getText:()=>n.url,children:"Copy Invite"}),"\xA0"]}),(0,e.jsx)("td",{children:(0,e.jsx)(P.$n,{variant:"destructive",size:"sm",icon:"times",onClick:()=>r(n.code),"aria-label":(0,t.t)("invites.invitee-row.aria-label-revoke-invite","Revoke invite")})})]})}}const te=S(J);class k extends h.PureComponent{render(){const{invitees:n}=this.props;return(0,e.jsxs)("table",{className:"filter-table form-inline",children:[(0,e.jsx)("thead",{children:(0,e.jsxs)("tr",{children:[(0,e.jsx)("th",{children:(0,e.jsx)(t.x6,{i18nKey:"invites.invitees-table.email",children:"Email"})}),(0,e.jsx)("th",{children:(0,e.jsx)(t.x6,{i18nKey:"invites.invitees-table.name",children:"Name"})}),(0,e.jsx)("th",{}),(0,e.jsx)("th",{style:{width:"34px"}})]})}),(0,e.jsx)("tbody",{"data-testid":"InviteesTable-body",children:n.map((r,c)=>(0,e.jsx)(te,{invitee:r},`${r.id}-${c}`))})]})}}var re=a(25508),Q=a(38748);const{selectAll:G,selectById:Le,selectTotal:xe}=Q.Tp,ue=(s,n)=>n,ve=(0,re.Mz)([G,ue],(s,n)=>{const r=new RegExp(n,"i");return s.filter(x=>r.test(x.name)||r.test(x.email))});var pe=a(27489),W=a(18027),E=a(12737),Y=a(77824),H=a(65642),oe=a(2543),V=a(68143),se=a(81871),I=a(1302);function z(){return async(s,n)=>{try{s((0,I.Cj)());const{perPage:r,page:c,searchQuery:x,sort:p}=n().users,D=await(0,V.AI)().get("/api/org/users/search",(0,se.F)({perpage:r,page:c,query:x,sort:p}));if(m.TP.licensedAccessControlEnabled()&&m.TP.hasPermission(f.w.ActionUserRolesList)){s((0,I.dJ)());const u=m.TP.user.orgId,M=D?.orgUsers.map(A=>A.userId),o=await(0,V.AI)().post("/api/access-control/users/roles/search?includeMapped=true",{userIds:M,orgId:u});D.orgUsers.forEach(A=>{A.roles=o?o[A.userId]||[]:[]}),s((0,I.jE)())}s((0,I.Y_)(D))}catch{(0,I.g4)()}}}const q=(0,oe.debounce)(s=>s(z()),300);function ae(s){return async n=>{await(0,V.AI)().patch(`/api/org/users/${s.userId}`,{role:s.role}),n(z())}}function ie(s){return async n=>{await(0,V.AI)().delete(`/api/org/users/${s}`),n(z())}}function he(s){return async n=>{n((0,I.EC)(s)),n(z())}}function je({sortBy:s}){const n=s.length?`${s[0].id}-${s[0].desc?"desc":"asc"}`:void 0;return async r=>{r((0,I.$u)(n)),r(z())}}function fe(s){return async n=>{n((0,I.t_)(s)),q(n)}}const l=s=>{const n=new RegExp(s.searchQuery,"i");return s.users.filter(r=>n.test(r.login)||n.test(r.email)||n.test(r.name))},T=s=>s.searchQuery;var le=a(79776);function Pe(s){return{searchQuery:T(s.users),pendingInvitesCount:xe(s.invites),externalUserMngLinkName:s.users.externalUserMngLinkName,externalUserMngLinkUrl:s.users.externalUserMngLinkUrl}}const _={changeSearchQuery:fe},Ge=(0,U.connect)(Pe,_)(({externalUserMngLinkName:s,externalUserMngLinkUrl:n,searchQuery:r,pendingInvitesCount:c,changeSearchQuery:x,onShowInvites:p,showInvites:D})=>{const u=[{label:(0,t.t)("users.users-action-bar-unconnected.options.label.users","Users"),value:"users"},{label:`Pending Invites (${c})`,value:"invites"}],o=m.TP.hasPermission(f.w.OrgUsersAdd)&&!(H.Ay.disableLoginForm&&H.Ay.externalUserMngInfo),A=()=>{(0,pe.rR)("users_admin_actions_clicked",{category:"org_users",item:"manage_users_external"})};return(0,e.jsxs)("div",{className:"page-action-bar","data-testid":"users-action-bar",children:[(0,e.jsx)(W.I,{grow:!0,children:(0,e.jsx)(E.Z,{value:r,onChange:x,placeholder:(0,t.t)("users.users-action-bar-unconnected.placeholder-search-login-email","Search user by login, email or name")})}),c>0&&(0,e.jsx)("div",{style:{marginLeft:"1rem"},children:(0,e.jsx)(Y.z,{value:D?"invites":"users",options:u,onChange:p})}),o&&(0,e.jsx)(P.z9,{href:"org/users/invite",children:(0,e.jsx)(t.x6,{i18nKey:"users.users-action-bar-unconnected.invite",children:"Invite"})}),n&&(0,e.jsx)(P.z9,{onClick:A,href:(0,le.o)("manage-users"),target:"_blank",rel:"noopener",children:s})]})});function Ye(s){const n=T(s.users);return{users:l(s.users),searchQuery:T(s.users),page:s.users.page,totalPages:s.users.totalPages,perPage:s.users.perPage,invitees:ve(s.invites,n),externalUserMngInfo:s.users.externalUserMngInfo,isLoading:s.users.isLoading,rolesLoading:s.users.rolesLoading}}const He={loadUsers:z,fetchInvitees:N.G7,changePage:he,changeSort:je,updateUser:ae,removeUser:ie},ye=(0,U.connect)(Ye,He)(({users:s,page:n,totalPages:r,invitees:c,externalUserMngInfo:x,isLoading:p,rolesLoading:D,loadUsers:u,fetchInvitees:M,changePage:o,updateUser:A,removeUser:ge,changeSort:ne})=>{const[X,De]=(0,h.useState)(!1),Qe=x?(0,$.G)(x):"";(0,h.useEffect)(()=>{u(),M()},[M,u]);const Es=(Te,Os)=>{A({...Os,role:Te})},Ds=Te=>ge(Te.userId),Ts=()=>{De(!X)},Ls=()=>{u()},Cs=()=>X?(0,e.jsx)(k,{invitees:c}):(0,e.jsx)(B.b,{users:s,orgId:m.TP.user.orgId,rolesLoading:D,onRoleChange:Es,onRemoveUser:Ds,onUserRolesChange:Ls,fetchData:ne,changePage:o,page:n,totalPages:r});return(0,e.jsxs)(C.Y.Contents,{isLoading:!p,children:[(0,e.jsx)(Ge,{onShowInvites:Ts,showInvites:X}),Qe&&(0,e.jsx)(K.F,{severity:"info",title:"",children:(0,e.jsx)("div",{dangerouslySetInnerHTML:{__html:Qe}})}),p&&Cs()]})});function Bs(){return jsx(Page,{navId:"users",children:jsx(ye,{})})}var Ze=a(50201),Xe=a(27644),Ie=a(71555),we=a(89640),ee=a(41654),ce=a(45967),me=a(30703),Me=a(66404),be=a(94018),Be=a(27594),Re=a(34213),Ve=a(11297),Se=a(31286);const Je=({units:s,icon:n})=>s?.length?s.length>1?(0,e.jsx)(ce.m,{placement:"top",content:(0,e.jsx)(ee.B,{direction:"column",children:s?.map(r=>(0,e.jsx)("span",{children:r.name},r.name))}),children:(0,e.jsx)(Ae,{icon:n,children:s.length})}):(0,e.jsx)(Ae,{icon:n,children:s[0].name}):null,Ae=(0,h.forwardRef)(({children:s,icon:n},r)=>(0,e.jsxs)(Se.a,{ref:r,display:"flex",alignItems:"center",marginRight:1,children:[(0,e.jsx)(me.I,{name:n})," ",(0,e.jsx)(Se.a,{marginLeft:1,children:s})]}));Ae.displayName="TooltipContent";const ke=({users:s,showPaging:n,totalPages:r,onChangePage:c,currentPage:x,fetchData:p})=>{const D=(0,h.useMemo)(()=>s.some(o=>o.licensedRole),[s]),u=(0,h.useMemo)(()=>s.some(o=>o.orgs),[s]),M=(0,h.useMemo)(()=>[{id:"avatarUrl",header:"",cell:({cell:{value:o}})=>o&&(0,e.jsx)(Ie.e,{src:o,alt:"User avatar"})},{id:"login",header:"Login",cell:({row:{original:o}})=>(0,e.jsx)(we.Y,{color:"primary",inline:!1,href:`/admin/users/edit/${o.uid}`,title:(0,t.t)("admin.users-table.columns.title-edit-user","Edit user"),children:o.login}),sortType:"string"},{id:"email",header:"Email",cell:({cell:{value:o}})=>o,sortType:"string"},{id:"name",header:"Name",cell:({cell:{value:o}})=>o,sortType:"string"},...u?[{id:"orgs",header:"Belongs to",cell:({cell:{value:o,row:A}})=>(0,e.jsxs)(ee.B,{alignItems:"center",children:[(0,e.jsx)(Je,{units:o,icon:"building"}),A.original.isAdmin&&(0,e.jsx)(ce.m,{placement:"top",content:(0,t.t)("admin.users-table.columns.content-grafana-admin","Grafana Admin"),children:(0,e.jsx)(me.I,{name:"shield"})})]})}]:[],...D?[{id:"licensedRole",header:"Licensed role",cell:({cell:{value:o}})=>o==="None"?(0,e.jsxs)(Me.E,{color:"disabled",children:[(0,e.jsx)(t.x6,{i18nKey:"admin.users-table.no-licensed-roles",children:"Not assigned"}),(0,e.jsx)(ce.m,{placement:"top",content:(0,t.t)("admin.users-table.tooltip-assigned-role","A licensed role will be assigned when this user signs in"),children:(0,e.jsx)(me.I,{name:"question-circle",style:{margin:"0 0 4 4"}})})]}):o}]:[],{id:"lastSeenAtAge",header:"Last active",headerTooltip:{content:"Time since user was seen using Grafana",iconName:"question-circle"},cell:({cell:{value:o}})=>(0,e.jsx)(e.Fragment,{children:o&&(0,e.jsx)(e.Fragment,{children:o==="10 years"?(0,e.jsx)(Me.E,{color:"disabled",children:(0,e.jsx)(t.x6,{i18nKey:"admin.users-table.last-seen-never",children:"Never"})}):o})}),sortType:(o,A)=>new Date(o.original.lastSeenAt).getTime()-new Date(A.original.lastSeenAt).getTime()},{id:"authLabels",header:"Origin",cell:({cell:{value:o}})=>(0,e.jsx)(e.Fragment,{children:Array.isArray(o)&&o.length>0&&(0,e.jsx)(Ve.E,{label:o[0],removeIcon:!1,count:0})})},{id:"isProvisioned",header:"Provisioned",cell:({cell:{value:o}})=>(0,e.jsx)(e.Fragment,{children:o&&(0,e.jsx)(be.v,{colorIndex:14,name:"Provisioned"})})},{id:"isDisabled",header:"",cell:({cell:{value:o}})=>(0,e.jsx)(e.Fragment,{children:o&&(0,e.jsx)(be.v,{colorIndex:9,name:"Disabled"})})},{id:"edit",header:"",cell:({row:{original:o}})=>(0,e.jsx)(P.z9,{variant:"secondary",size:"sm",icon:"pen",href:`admin/users/edit/${o.uid}`,"aria-label":(0,t.t)("admin.users-table.edit-aria-label","Edit user: {{name}}",{name:o.name}),tooltip:(0,t.t)("admin.users-table.edit-tooltip","Edit user")})}],[D,u]);return(0,e.jsxs)(ee.B,{direction:"column",gap:2,children:[(0,e.jsx)(Be.j,{columns:M,data:s,getRowId:o=>String(o.id),fetchData:p}),n&&(0,e.jsx)(ee.B,{justifyContent:"flex-end",children:(0,e.jsx)(Re.d,{numberOfPages:r,currentPage:x,onNavigate:c})})]})};var Z=a(74267);const Ke=[],Rs=s=>{Ke.push(s)},qe=d.Tp.pages.UserListPage.UserListAdminPage,_e={fetchUsers:Z.hU,changeQuery:Z.nM,changePage:Z.yd,changeFilter:Z.$u,changeSort:Z.Vk},es=s=>({users:s.userListAdmin.users,query:s.userListAdmin.query,showPaging:s.userListAdmin.showPaging,totalPages:s.userListAdmin.totalPages,page:s.userListAdmin.page,filters:s.userListAdmin.filters,isLoading:s.userListAdmin.isLoading}),Ne=(0,U.connect)(es,_e)(({fetchUsers:s,query:n,changeQuery:r,users:c,showPaging:x,changeFilter:p,filters:D,totalPages:u,page:M,changePage:o,changeSort:A,isLoading:ge})=>{const ne=(0,j.of)(ss);return(0,h.useEffect)(()=>{s()},[s]),(0,e.jsxs)(C.Y.Contents,{children:[(0,e.jsx)("div",{className:ne.actionBar,"data-testid":qe.container,children:(0,e.jsxs)("div",{className:ne.row,children:[(0,e.jsx)(E.Z,{placeholder:(0,t.t)("admin.user-list-admin-page-un-connected.placeholder-search-login-email","Search user by login, email, or name."),autoFocus:!0,value:n,onChange:r,escapeRegex:!1}),(0,e.jsx)(Y.z,{options:[{label:(0,t.t)("admin.user-list-admin-page-un-connected.label.all-users","All users"),value:!1},{label:(0,t.t)("admin.user-list-admin-page-un-connected.label.active-last-days","Active last 30 days"),value:!0}],onChange:X=>p({name:"activeLast30Days",value:X}),value:D.find(X=>X.name==="activeLast30Days")?.value,className:ne.filter}),Ke.map((X,De)=>(0,e.jsx)(X,{filters:D,onChange:p,className:ne.filter},De)),m.TP.hasPermission(f.w.UsersCreate)&&(0,e.jsx)(P.z9,{href:"admin/users/create",variant:"primary",children:(0,e.jsx)(t.x6,{i18nKey:"admin.users-list.create-button",children:"New user"})})]})}),!ge&&c.length===0?(0,e.jsx)(Ze.p,{message:(0,t.t)("users.empty-state.message","No users found"),variant:"not-found"}):(0,e.jsx)(ke,{users:c,showPaging:x,totalPages:u,onChangePage:o,currentPage:M,fetchData:A}),(0,e.jsx)(Xe.$,{page:"users"})]})});function Ns(){return jsx(Page,{navId:"global-users",children:jsx(Ne,{})})}const ss=s=>({filter:(0,i.css)({margin:s.spacing(0,1),[s.breakpoints.down("sm")]:{margin:0}}),actionBar:(0,i.css)({marginBottom:s.spacing(2),display:"flex",alignItems:"flex-start",gap:s.spacing(2),[s.breakpoints.down("sm")]:{flexWrap:"wrap"}}),row:(0,i.css)({display:"flex",alignItems:"flex-start",textAlign:"left",marginBottom:s.spacing(.5),flexGrow:1,[s.breakpoints.down("sm")]:{flexWrap:"wrap",gap:s.spacing(2),width:"100%"}})}),Ws=null;var as=a(99887),ns=a(58887);const ts=s=>{if(!s.includes(" "))return{browser:s,computer:""};const n=s.split(" ");return{browser:n[0],computer:n[1]}},We=(s,n)=>s.length>n?s.substring(0,n)+"...":s,rs=({value:s})=>{const n=ts(s);return(0,e.jsx)(ce.m,{theme:"info-alt",content:s,placement:"top-end",interactive:!0,children:(0,e.jsxs)("span",{children:[We(n.browser,10),We(n.computer,10)]})})},os=({devices:s,showPaging:n,totalPages:r,onChangePage:c,currentPage:x,fetchData:p})=>{const D=(0,h.useMemo)(()=>[{id:"avatarUrl",header:"",cell:({cell:{value:u}})=>u&&(0,e.jsx)(Ie.e,{src:u,alt:"User avatar"})},{id:"login",header:"Login",cell:({cell:{value:u}})=>"Anonymous"},{id:"userAgent",header:"User Agent",cell:({cell:{value:u}})=>(0,e.jsx)(rs,{value:u}),sortType:"string"},{id:"updatedAt",header:"Last active",cell:({cell:{value:u}})=>u,sortType:(u,M)=>new Date(u.original.updatedAt).getTime()-new Date(M.original.updatedAt).getTime()},{id:"clientIp",header:"Origin IP (address)",cell:({cell:{value:u}})=>u&&(0,e.jsx)(as.E,{text:u,color:"orange"})}],[]);return(0,e.jsxs)(ee.B,{direction:"column",gap:2,children:[(0,e.jsx)(Be.j,{columns:D,data:s,getRowId:u=>u.deviceId,fetchData:p}),n&&(0,e.jsx)(ee.B,{justifyContent:"flex-end",children:(0,e.jsx)(Re.d,{numberOfPages:r,currentPage:x,onNavigate:c})}),s.length===0&&(0,e.jsx)(ns.Z,{children:(0,e.jsx)("span",{children:(0,e.jsx)(t.x6,{i18nKey:"admin.anon-users.not-found",children:"No anonymous users found."})})})]})},is={fetchUsersAnonymousDevices:Z.xq,changeAnonUserSort:Z.A5,changeAnonPage:Z.is,changeAnonQuery:Z.Bc},ls=s=>({devices:s.userListAnonymousDevices.devices,query:s.userListAnonymousDevices.query,showPaging:s.userListAnonymousDevices.showPaging,totalPages:s.userListAnonymousDevices.totalPages,page:s.userListAnonymousDevices.page,filters:s.userListAnonymousDevices.filters}),cs=d.Tp.pages.UserListPage.UserListAdminPage,ze=(0,U.connect)(ls,is)(({devices:s,fetchUsersAnonymousDevices:n,query:r,changeAnonQuery:c,filters:x,showPaging:p,totalPages:D,page:u,changeAnonPage:M,changeAnonUserSort:o})=>{const A=(0,j.of)(ds);return(0,h.useEffect)(()=>{n()},[n]),(0,e.jsxs)(C.Y.Contents,{children:[(0,e.jsx)("div",{className:A.actionBar,"data-testid":cs.container,children:(0,e.jsxs)("div",{className:A.row,children:[(0,e.jsx)(E.Z,{placeholder:(0,t.t)("admin.user-list-anonymous-devices-page-un-connected.placeholder-search-devices-by-ip-address","Search devices by IP address."),autoFocus:!0,value:r,onChange:c}),(0,e.jsx)(Y.z,{options:[{label:(0,t.t)("admin.user-list-anonymous-devices-page-un-connected.label.active-last-days","Active last 30 days"),value:!0}],value:x.find(ge=>ge.name==="activeLast30Days")?.value,className:A.filter})]})}),(0,e.jsx)(os,{devices:s,showPaging:p,totalPages:D,onChangePage:M,currentPage:u,fetchData:o})]})});function Fs(){return jsx(Page,{navId:"anonymous-users",children:jsx(ze,{})})}const ds=s=>({filter:(0,i.css)({margin:s.spacing(0,1),[s.breakpoints.down("sm")]:{margin:0}}),actionBar:(0,i.css)({marginBottom:s.spacing(2),display:"flex",alignItems:"flex-start",gap:s.spacing(2),[s.breakpoints.down("sm")]:{flexWrap:"wrap"}}),row:(0,i.css)({display:"flex",alignItems:"flex-start",textAlign:"left",marginBottom:s.spacing(.5),flexGrow:1,[s.breakpoints.down("sm")]:{flexWrap:"wrap",gap:s.spacing(2),width:"100%"}})}),Qs=null;var Ue=a(62905),Ee=a(22787),gs=a(6975),$e=a(8515);const us=d.Tp.pages.UserListPage.UsersListPublicDashboardsPage.DashboardsListModal,hs=({email:s,onDismiss:n})=>{const r=(0,j.of)(xs),{data:c,isLoading:x}=(0,Ue.kd)(s);return(0,e.jsx)(Ee.a,{className:r.modal,isOpen:!0,title:v.$.featureToggles.newDashboardSharingComponent?(0,t.t)("public-dashboard-users-access-list.modal.shared-dashboard-modal-title","Shared dashboards"):(0,t.t)("public-dashboard-users-access-list.modal.dashboard-modal-title","Public dashboards"),onDismiss:n,children:x?(0,e.jsx)("div",{className:r.loading,children:(0,e.jsx)(gs._,{text:(0,t.t)("public-dashboard-users-access-list.dashboard-modal.loading-text","Loading...")})}):c?.map(p=>(0,e.jsxs)("div",{className:r.listItem,"data-testid":us.listItem(p.dashboardUid),children:[(0,e.jsx)("p",{className:r.dashboardTitle,children:p.dashboardTitle}),(0,e.jsxs)("div",{className:r.urlsContainer,children:[(0,e.jsx)("a",{rel:"noreferrer",target:"_blank",className:(0,i.cx)("external-link",r.url),href:(0,b.mL)(p.publicDashboardAccessToken),onClick:n,children:v.$.featureToggles.newDashboardSharingComponent?(0,e.jsx)(t.x6,{i18nKey:"public-dashboard-users-access-list.dashboard-modal.external-link",children:"External link"}):(0,e.jsx)(t.x6,{i18nKey:"public-dashboard-users-access-list.dashboard-modal.public-dashboard-link",children:"Public dashboard URL"})}),(0,e.jsx)("span",{className:r.urlsDivider,children:"\u2022"}),(0,e.jsx)("a",{className:(0,i.cx)("external-link",r.url),href:(0,b.gN)(p.dashboardUid,p.slug),onClick:n,children:v.$.featureToggles.newDashboardSharingComponent?(0,e.jsx)(t.x6,{i18nKey:"public-dashboard-users-access-list.dashboard-modal.sharing-setting",children:"Sharing settings"}):(0,e.jsx)(t.x6,{i18nKey:"public-dashboard-users-access-list.dashboard-modal.public-dashboard-setting",children:"Public dashboard settings"})})]}),(0,e.jsx)("hr",{className:r.divider})]},p.dashboardUid))})},ms=({email:s})=>{const n=(0,t.t)("public-dashboard-users-access-list.dashboard-modal.open-dashboard-list-text","Open dashboards list");return(0,e.jsx)($e.$s,{children:({showModal:r,hideModal:c})=>(0,e.jsx)(P.$n,{variant:"secondary",size:"sm",icon:"question-circle",title:n,"aria-label":n,onClick:()=>r(hs,{email:s,onDismiss:c})})})},xs=s=>({modal:(0,i.css)({width:"590px"}),loading:(0,i.css)({display:"flex",justifyContent:"center"}),listItem:(0,i.css)({display:"flex",flexDirection:"column",gap:s.spacing(.5)}),divider:(0,i.css)({margin:s.spacing(1.5,0),color:s.colors.text.secondary}),urlsContainer:(0,i.css)({display:"flex",gap:s.spacing(.5),[s.breakpoints.down("sm")]:{flexDirection:"column"}}),urlsDivider:(0,i.css)({color:s.colors.text.secondary,[s.breakpoints.down("sm")]:{display:"none"}}),dashboardTitle:(0,i.css)({fontSize:s.typography.body.fontSize,fontWeight:s.typography.fontWeightBold,marginBottom:0}),url:(0,i.css)({fontSize:s.typography.body.fontSize})}),vs=({user:s,hideModal:n})=>{const[r]=(0,Ue.g9)(),c=(0,j.of)(js),x=()=>{r({email:s.email}),n()};return(0,e.jsxs)(Ee.a,{className:c.modal,isOpen:!0,title:(0,t.t)("public-dashboard-users-access-list.delete-user-modal.revoke-access-title","Revoke access"),onDismiss:n,children:[(0,e.jsx)("p",{className:c.description,children:(0,e.jsxs)(t.x6,{i18nKey:"public-dashboard-users-access-list.delete-user-modal.revoke-user-access-modal-desc-line1",children:["Are you sure you want to revoke access for ",{email:s.email},"?"]})}),(0,e.jsx)("p",{className:c.description,children:v.$.featureToggles.newDashboardSharingComponent?(0,e.jsxs)(t.x6,{i18nKey:"public-dashboard-users-access-list.delete-user-shared-dashboards-modal.revoke-user-access-modal-desc-line2",shouldUnescape:!0,children:["This action will immediately revoke ",{email:s.email},"'s access to all shared dashboards."]}):(0,e.jsxs)(t.x6,{i18nKey:"public-dashboard-users-access-list.delete-user-modal.revoke-user-access-modal-desc-line2",shouldUnescape:!0,children:["This action will immediately revoke ",{email:s.email},"'s access to all public dashboards."]})}),(0,e.jsxs)(Ee.a.ButtonRow,{children:[(0,e.jsx)(P.$n,{type:"button",variant:"secondary",onClick:n,fill:"outline",children:(0,e.jsx)(t.x6,{i18nKey:"public-dashboard-users-access-list.delete-user-modal.delete-user-cancel-button",children:"Cancel"})}),(0,e.jsx)(P.$n,{type:"button",variant:"destructive",onClick:x,children:(0,e.jsx)(t.x6,{i18nKey:"public-dashboard-users-access-list.delete-user-modal.delete-user-revoke-access-button",children:"Revoke access"})})]})]})},ps=({user:s})=>{const n=(0,t.t)("public-dashboard-users-access-list.delete-user-modal.delete-user-button-text","Delete user");return(0,e.jsx)($e.$s,{children:({showModal:r,hideModal:c})=>(0,e.jsx)(P.$n,{size:"sm",variant:"destructive",onClick:()=>r(vs,{user:s,hideModal:c}),icon:"times","aria-label":n,title:n})})},js=s=>({modal:(0,i.css)({width:"500px"}),description:(0,i.css)({fontSize:s.typography.body.fontSize,margin:0})}),fs=d.Tp.pages.UserListPage.publicDashboards,Ps=()=>{const{data:s,isLoading:n}=(0,Ue.AK)();return(0,e.jsx)(C.Y.Contents,{isLoading:n,children:(0,e.jsxs)("table",{className:"filter-table form-inline","data-testid":fs.container,children:[(0,e.jsx)("thead",{children:(0,e.jsxs)("tr",{children:[(0,e.jsx)("th",{children:(0,e.jsx)(t.x6,{i18nKey:"public-dashboard-users-access-list.table-header.email-label",children:"Email"})}),(0,e.jsxs)("th",{children:[(0,e.jsx)("span",{children:(0,e.jsx)(t.x6,{i18nKey:"public-dashboard-users-access-list.table-header.activated-label",children:"Activated"})}),(0,e.jsx)(ce.m,{placement:"top",content:(0,t.t)("public-dashboard-users-access-list.table-header.activated-tooltip","Earliest time user has been an active user to a dashboard"),children:(0,e.jsx)(me.I,{name:"info-circle"})})]}),(0,e.jsx)("th",{children:(0,e.jsx)(t.x6,{i18nKey:"public-dashboard-users-access-list.table-header.last-active-label",children:"Last active"})}),(0,e.jsx)("th",{children:(0,e.jsx)(t.x6,{i18nKey:"public-dashboard-users-access-list.table-header.origin-label",children:"Origin"})}),(0,e.jsx)("th",{children:(0,e.jsx)(t.x6,{i18nKey:"public-dashboard-users-access-list.table-header.role-label",children:"Role"})}),(0,e.jsx)("th",{})]})}),(0,e.jsx)("tbody",{children:s?.map(r=>(0,e.jsxs)("tr",{children:[(0,e.jsx)("td",{className:"max-width-10",children:(0,e.jsx)("span",{className:"ellipsis",title:r.email,children:r.email})}),(0,e.jsx)("td",{className:"max-width-10",children:r.firstSeenAtAge}),(0,e.jsx)("td",{className:"max-width-10",children:r.lastSeenAtAge}),(0,e.jsx)("td",{className:"max-width-10",children:(0,e.jsxs)(ee.B,{gap:2,children:[(0,e.jsx)("span",{children:(0,e.jsxs)(t.x6,{i18nKey:"public-dashboard-users-access-list.table-body.dashboard-count",count:r.totalDashboards,children:[{count:r.totalDashboards}," dashboards"]})}),(0,e.jsx)(ms,{email:r.email})]})}),(0,e.jsx)("td",{className:"max-width-10",children:(0,e.jsx)(be.v,{name:"Viewer",colorIndex:19})}),(0,e.jsx)("td",{className:"text-right",children:(0,e.jsx)(ps,{user:r})})]},r.email))})]})})};var ys=(s=>(s.ADMIN="admin",s.ORG="org",s.PUBLIC_DASHBOARDS="public-dashboards",s.ANON="anon",s))(ys||{});const de=d.Tp.pages.UserListPage,Fe=({view:s,setView:n})=>(0,e.jsx)(g.o,{label:v.$.featureToggles.newDashboardSharingComponent?(0,t.t)("users-access-list.tabs.shared-dashboard-users-tab-title","Shared dashboard users"):(0,t.t)("users-access-list.tabs.public-dashboard-users-tab-title","Public dashboard users"),active:s==="public-dashboards",onChangeTab:()=>n("public-dashboards"),"data-testid":de.tabs.publicDashboardsUsers}),bs={admin:(0,e.jsx)(Ne,{}),org:(0,e.jsx)(ye,{}),"public-dashboards":(0,e.jsx)(Ps,{}),anon:(0,e.jsx)(ze,{})};function As(){const s=(0,j.of)(Us),n=L.TP.hasPermission(f.w.UsersRead),r=L.TP.hasPermission(f.w.OrgUsersRead),[c,x]=(0,h.useState)(()=>n?"admin":r?"org":null),p=r&&n;return(0,e.jsxs)(C.Y,{navId:"global-users",children:[p?(0,e.jsxs)(O.U,{className:s.tabsMargin,children:[(0,e.jsx)(g.o,{label:(0,t.t)("admin.user-list-page.label-all-users","All users"),active:c==="admin",onChangeTab:()=>x("admin"),"data-testid":de.tabs.allUsers}),(0,e.jsx)(g.o,{label:(0,t.t)("admin.user-list-page.label-organization-users","Organization users"),active:c==="org",onChangeTab:()=>x("org"),"data-testid":de.tabs.orgUsers}),v.$.anonymousEnabled&&(0,e.jsx)(g.o,{label:(0,t.t)("admin.user-list-page.label-anonymous-devices","Anonymous devices"),active:c==="anon",onChangeTab:()=>x("anon"),"data-testid":de.tabs.anonUserDevices}),(0,b.AY)()&&(0,e.jsx)(Fe,{view:c,setView:x})]}):(0,b.AY)()&&(0,e.jsxs)(O.U,{className:s.tabsMargin,children:[(0,e.jsx)(g.o,{label:(0,t.t)("admin.user-list-page.label-users","Users"),active:c==="org",onChangeTab:()=>x("org"),"data-testid":de.tabs.users}),(0,e.jsx)(Fe,{view:c,setView:x})]}),c?bs[c]:(0,e.jsx)(ye,{})]})}const Us=s=>({tabsMargin:(0,i.css)({marginBottom:s.spacing(3)})})},22942:(w,y,a)=>{a.d(y,{q:()=>d});var e=a(74848),i=a(92745),h=a(39118);function d(){return(0,e.jsx)(h.I,{text:(0,i.t)("cloud-enterprise-feature-badge","Cloud & Enterprise")})}},27644:(w,y,a)=>{a.d(y,{$:()=>U,Z:()=>K});var e=a(74848),i=a(22803),h=a(96540),d=a(41607),t=a(92745),v=a(43173),g=a(45861),j=a(66404),O=a(41654),L=a(63142),b=a(22942),f=a(73427),C=a(83873);function U({page:m}){const B=(0,L.of)($),R=f.TP.user.helpFlags1,P=4,[N,F]=(0,h.useState)(!!(R&P)),S=()=>{C.IB.put(`/api/user/helpflags/${P}`,void 0,{showSuccessAlert:!1}).then(J=>{f.TP.user.helpFlags1=J.helpFlags1,F(!0)})};return N||!K()?null:(0,e.jsxs)("div",{className:B.box,children:[(0,e.jsxs)(O.B,{direction:"row",alignItems:"center",justifyContent:"space-between",children:[(0,e.jsx)(b.q,{}),(0,e.jsx)(g.$n,{variant:"secondary",fill:"text",icon:"times",onClick:S,"aria-label":(0,t.t)("admin.enterprise-auth-features-card.dismiss","Dismiss")})]}),(0,e.jsxs)(O.B,{direction:"column",gap:.5,children:[(0,e.jsx)(j.E,{variant:"h4",children:(0,e.jsx)(t.x6,{i18nKey:"admin.enterprise-auth-features-card.heading",children:"Enterprise authentication"})}),(0,e.jsx)(j.E,{variant:"body",color:"secondary",children:(0,e.jsxs)(t.x6,{i18nKey:"admin.enterprise-auth-features-card.text",children:["Manage users, teams, and permissions automatically with ",(0,e.jsx)("strong",{children:"SAML"}),", ",(0,e.jsx)("strong",{children:"SCIM"}),","," ",(0,e.jsx)("strong",{children:"LDAP"}),", and ",(0,e.jsx)("strong",{children:"RBAC"})," \u2014 available in Grafana Cloud and Enterprise."]})})]}),(0,e.jsx)("div",{children:(0,e.jsx)(g.z9,{href:`https://grafana.com/auth/sign-up/create-user?cloud-auth=&redirectPath=cloud-auth&utm_source=oss-grafana&cnt-admin-${m}`,icon:"external-link-alt",variant:"secondary",target:"_blank",rel:"noopener noreferrer",children:(0,e.jsx)(t.x6,{i18nKey:"admin.enterprise-auth-features-card.learn-more-link",children:"Learn more"})})})]})}function $(m){return{cloudBadge:(0,i.css)({display:"flex",alignItems:"center",background:m.colors.gradients.brandHorizontal,color:m.colors.primary.contrastText,padding:m.spacing(.5,1),borderRadius:m.shape.radius.pill,fontSize:m.typography.bodySmall.fontSize,gap:m.spacing(1)}),box:(0,i.css)({padding:m.spacing(3),border:`1px solid ${m.colors.border.weak}`,backgroundColor:m.colors.background.secondary,display:"flex",flexDirection:"column",gap:m.spacing(1.5),borderRadius:m.shape.radius.default,marginTop:m.spacing(3),strong:{color:m.colors.text.primary}}),icon:(0,i.css)({position:"relative",top:-1})}}function K(){return v.$.buildInfo.edition===d.r.OpenSource||v.$.licenseInfo.stateInfo!=="Licensed"}},31908:(w,y,a)=>{a.d(y,{I:()=>f});var e=a(74848),i=a(49785),h=a(47184),d=a(90382),t=a(92745),v=a(8207),g=a(89640),j=a(37386),O=a(77824);const L=Object.keys(d.X).map(h.z),b=(0,e.jsxs)(t.x6,{i18nKey:"role-picker.title.description",children:["Assign roles to users to ensure granular control over access to Grafana\u2018s features and resources. Find out more in our"," ",(0,e.jsx)(g.Y,{external:!0,href:"https://grafana.com/docs/grafana/latest/administration/roles-and-permissions/#organization-roles",children:"documentation"}),"."]}),f=({onClose:C})=>{const U=(0,i.xW)(),{control:$,getValues:K,setValue:m}=U,[B,R]=K(["name","roles"]);return(0,e.jsx)(v._,{title:B,subtitle:b,onClose:C,children:(0,e.jsx)(j.D,{label:(0,t.t)("role-picker-drawer.basic-roles.label","Basic Roles"),children:(0,e.jsx)(i.xI,{name:"role",control:$,render:({field:{onChange:P,ref:N,...F}})=>(0,e.jsx)(O.z,{...F,options:L,onChange:S=>{m("roleCollection",[S,...R]),P(S)}})})})})}},39118:(w,y,a)=>{a.d(y,{I:()=>t});var e=a(74848),i=a(22803),h=a(30703),d=a(63142);function t({text:g}){const j=(0,d.of)(v);return(0,e.jsxs)("div",{className:j.wrapper,children:[(0,e.jsx)(h.I,{name:"cloud",size:"sm"}),g]})}const v=g=>({wrapper:(0,i.css)({display:"inline-flex",padding:g.spacing(.5,1),borderRadius:g.shape.radius.pill,background:g.colors.gradients.brandHorizontal,color:g.colors.primary.contrastText,fontWeight:g.typography.fontWeightMedium,gap:g.spacing(.5),fontSize:g.typography.bodySmall.fontSize,lineHeight:g.typography.bodySmall.lineHeight,alignItems:"center"})})},58887:(w,y,a)=>{a.d(y,{Z:()=>d});var e=a(74848),i=a(22803),h=a(63142);const d=({children:v})=>{const g=(0,h.of)(t);return(0,e.jsx)("div",{className:g.container,children:v})},t=v=>({container:(0,i.css)({backgroundColor:v.colors.background.secondary,color:v.colors.text.secondary,padding:v.spacing(4),textAlign:"center"})})},77527:(w,y,a)=>{a.d(y,{b:()=>pe});var e=a(74848),i=a(96540),h=a(51898),d=a(92745),t=a(43173),v=a(71555),g=a(66404),j=a(31286),O=a(45967),L=a(89640),b=a(30703),f=a(94018),C=a(45861),U=a(41654),$=a(27594),K=a(34213),m=a(71599),B=a(91087),R=a(34418),P=a(22803),N=a(49785),F=a(63142),S=a(99887),J=a(31908);const te=({disabled:W,user:E})=>{const[Y,H]=(0,i.useState)(!1),{badge:oe,badgeDisabled:V}=(0,F.of)(k),se=W?V:oe,I=(0,N.mN)({defaultValues:{name:E.name,role:E.role,roles:E.roles}}),{watch:z}=I,q=()=>{W||H(!0)};return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsxs)(U.B,{gap:1,children:[(0,e.jsx)(S.E,{className:se,color:"blue",onClick:q,text:z("role")}),E.roles&&E.roles.length>0&&(0,e.jsx)(S.E,{className:se,color:"blue",onClick:q,text:(0,d.t)("role-picker-drawer.user-count","+{{numUsers}}",{numUsers:E.roles.length})})]}),Y&&(0,e.jsx)(N.Op,{...I,children:(0,e.jsx)(J.I,{onClose:()=>H(!1)})})]})};function k(W){return{badge:(0,P.css)({cursor:"pointer"}),badgeDisabled:(0,P.css)({cursor:"not-allowed"})}}var re=a(11297),Q=a(73427),G=a(11257),Le=a(9390);const xe=`This user's role is not editable because it is synchronized from your auth provider.
Refer to the Grafana authentication docs for details.`,ue=W=>{const E=W?.isExternallySynced;return!Q.TP.hasPermissionInMetadata(G.w.OrgUsersWrite,W)||E},ve=h.Tp.pages.UserListPage.UsersListPage,pe=({users:W,orgId:E,onRoleChange:Y,onUserRolesChange:H,onRemoveUser:oe,fetchData:V,changePage:se,page:I,totalPages:z,rolesLoading:q})=>{const[ae,ie]=(0,i.useState)(null),[he,je]=(0,i.useState)([]);(0,i.useEffect)(()=>{async function l(){try{if(Q.TP.hasPermission(G.w.ActionRolesList)){let T=await(0,R.RL)(E);je(T)}}catch{console.error("Error loading options")}}Q.TP.licensedAccessControlEnabled()&&l()},[E]);const fe=(0,i.useMemo)(()=>[{id:"avatarUrl",header:"",cell:({cell:{value:l}})=>l&&(0,e.jsx)(v.e,{src:l,alt:"User avatar"})},{id:"login",header:"Login",cell:({cell:{value:l}})=>(0,e.jsx)("div",{children:l}),sortType:"string"},{id:"email",header:"Email",cell:({cell:{value:l}})=>l,sortType:"string"},{id:"name",header:"Name",cell:({cell:{value:l}})=>l,sortType:"string"},{id:"lastSeenAtAge",header:"Last active",cell:({cell:{value:l}})=>(0,e.jsx)(e.Fragment,{children:l&&(0,e.jsx)(e.Fragment,{children:l==="10 years"?(0,e.jsx)(g.E,{color:"disabled",children:(0,e.jsx)(d.x6,{i18nKey:"admin.org-uers.last-seen-never",children:"Never"})}):l})}),sortType:(l,T)=>new Date(l.original.lastSeenAt).getTime()-new Date(T.original.lastSeenAt).getTime()},{id:"role",header:"Role",cell:({cell:{value:l},row:{original:T}})=>{const le=ue(T),Pe=async(_,Ce,Oe)=>{await(0,R.eA)(_,Ce,Oe),H&&H()};return t.$.featureToggles.rolePickerDrawer?(0,e.jsx)(te,{disabled:le,user:T}):Q.TP.licensedAccessControlEnabled()?(0,e.jsx)(B.y,{userId:T.userId,roles:T.roles,apply:!0,onApplyRoles:Pe,isLoading:q,orgId:E,roleOptions:he,basicRole:l,onBasicRoleChange:_=>Y(_,T),basicRoleDisabled:le,basicRoleDisabledMessage:xe,width:40}):(0,e.jsx)(Le.r,{"aria-label":(0,d.t)("admin.org-users-table.columns.aria-label-role","Role"),value:l,disabled:le,onChange:_=>Y(_,T)})}},{id:"info",header:"",cell:({row:{original:l}})=>ue(l)&&(0,e.jsx)(j.a,{display:"flex",alignItems:"center",marginLeft:1,children:(0,e.jsx)(O.m,{interactive:!0,content:(0,e.jsx)("div",{children:(0,e.jsxs)(d.x6,{i18nKey:"admin.org-users.not-editable",children:["This user's role is not editable because it is synchronized from your auth provider. Refer to the\xA0",(0,e.jsx)(L.Y,{href:"https://grafana.com/docs/grafana/latest/administration/user-management/manage-org-users/#change-a-users-organization-permissions",external:!0,children:"Grafana authentication docs"}),"\xA0for details."]})}),children:(0,e.jsx)(b.I,{name:"question-circle"})})})},{id:"authLabels",header:"Origin",cell:({cell:{value:l}})=>(0,e.jsx)(e.Fragment,{children:Array.isArray(l)&&l.length>0&&(0,e.jsx)(re.E,{label:l[0],removeIcon:!1,count:0})})},{id:"isProvisioned",header:"Provisioned",cell:({cell:{value:l}})=>(0,e.jsx)(e.Fragment,{children:l&&(0,e.jsx)(f.v,{colorIndex:14,name:"Provisioned"})})},{id:"isDisabled",header:"",cell:({cell:{value:l}})=>(0,e.jsx)(e.Fragment,{children:l&&(0,e.jsx)(f.v,{colorIndex:9,name:"Disabled"})})},{id:"delete",header:"",cell:({row:{original:l}})=>Q.TP.hasPermissionInMetadata(G.w.OrgUsersRemove,l)&&(0,e.jsx)(C.$n,{size:"sm",variant:"destructive",onClick:()=>{ie(l)},icon:"times","aria-label":(0,d.t)("admin.org-users-table.delete-aria-label","Delete user: {{name}}",{name:l.name})})}],[q,E,he,H,Y]);return(0,e.jsxs)(U.B,{direction:"column",gap:2,"data-testid":ve.container,children:[(0,e.jsx)($.j,{columns:fe,data:W,getRowId:l=>String(l.userId),fetchData:V}),(0,e.jsx)(U.B,{justifyContent:"flex-end",children:(0,e.jsx)(K.d,{onNavigate:se,currentPage:I,numberOfPages:z,hideWhenSinglePage:!0})}),!!ae&&(0,e.jsx)(m.u,{body:(0,d.t)("admin.org-users-table.body-delete","Are you sure you want to delete user {{user}}?",{user:ae?.login}),confirmText:(0,d.t)("admin.org-users-table.confirmText-delete","Delete"),title:(0,d.t)("admin.org-users-table.title-delete","Delete"),onDismiss:()=>{ie(null)},isOpen:!0,onConfirm:()=>{ae&&(oe(ae),ie(null))}})]})}},91087:(w,y,a)=>{a.d(y,{y:()=>j});var e=a(74848),i=a(96540),h=a(41053),d=a(73427),t=a(11257),v=a(59812),g=a(34418);const j=({basicRole:O,roles:L,userId:b,orgId:f,onBasicRoleChange:C,roleOptions:U,disabled:$,basicRoleDisabled:K,basicRoleDisabledMessage:m,apply:B=!1,onApplyRoles:R,pendingRoles:P,maxWidth:N,width:F,isLoading:S})=>{const[{loading:J,value:te=L||[]},k]=(0,h.A)(async()=>{try{if(L)return L;if(B&&P?.length)return P;if(d.TP.hasPermission(t.w.ActionUserRolesList)&&b>0)return await(0,g.Xh)(b,f)}catch{console.error("Error loading options")}return[]},[f,b,P,L]);(0,i.useEffect)(()=>{f&&k()},[k,f]);const re=async G=>{B?R&&R(G,b,f):(await(0,g.eA)(G,b,f),await k())},Q=d.TP.hasPermission(t.w.ActionUserRolesAdd)&&d.TP.hasPermission(t.w.ActionUserRolesRemove);return(0,e.jsx)(v.n,{appliedRoles:te,basicRole:O,onRolesChange:re,onBasicRoleChange:C,roleOptions:U,isLoading:J||S,disabled:$,basicRoleDisabled:K,basicRoleDisabledMessage:m,showBasicRole:!0,apply:B,canUpdateRoles:Q,maxWidth:N,width:F})}}}]);

//# sourceMappingURL=UserListPage.bea2cc12d3b415f1733d.js.map