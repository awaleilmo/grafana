{"version":3,"file":"NotificationPoliciesPage.408b2e643adae8e12d16.js","mappings":"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","sources":["webpack://grafana/./public/app/features/alerting/unified/components/CollapseToggle.tsx","webpack://grafana/./public/app/features/alerting/unified/api/grafana.ts","webpack://grafana/./public/app/features/alerting/unified/api/receiversApi.ts","webpack://grafana/./public/app/features/alerting/unified/components/notification-policies/ContactPointSelector.tsx","webpack://grafana/./public/app/features/alerting/unified/components/notification-policies/Filters.tsx","webpack://grafana/./public/app/features/alerting/unified/components/notification-policies/AlertGroupsSummary.tsx","webpack://grafana/./public/app/features/alerting/unified/components/notification-policies/utils.ts","webpack://grafana/./public/app/features/alerting/unified/components/notification-policies/EditDefaultPolicyForm.tsx","webpack://grafana/./public/app/features/alerting/unified/components/notification-policies/EditNotificationPolicyForm.tsx","webpack://grafana/./public/app/features/alerting/unified/components/notification-policies/PolicyUpdateErrorAlert.tsx","webpack://grafana/./public/app/features/alerting/unified/components/notification-policies/Modals.tsx","webpack://grafana/./public/app/features/alerting/unified/components/notification-policies/NotificationPoliciesList.tsx","webpack://grafana/./public/app/features/alerting/unified/components/export/GrafanaMuteTimingsExporter.tsx","webpack://grafana/./public/app/features/alerting/unified/components/mute-timings/useExportMuteTimingsDrawer.tsx","webpack://grafana/./public/app/features/alerting/unified/components/mute-timings/MuteTimingActionsButtons.tsx","webpack://grafana/./public/app/features/alerting/unified/components/EmptyAreaWithCTA.tsx","webpack://grafana/./public/app/features/alerting/unified/components/mute-timings/MuteTimingsTable.tsx","webpack://grafana/./public/app/features/alerting/unified/NotificationPoliciesPage.tsx","webpack://grafana/./public/app/features/alerting/unified/components/EmptyArea.tsx","webpack://grafana/./node_modules/comlink/dist/esm/comlink.mjs","webpack://grafana/./public/app/features/alerting/unified/createRouteGroupsMatcherWorker.ts","webpack://grafana/./public/app/features/alerting/unified/useRouteGroupsMatcher.ts","webpack://grafana/./public/app/features/alerting/unified/components/alert-groups/AlertDetails.tsx","webpack://grafana/./public/app/features/alerting/unified/components/alert-groups/AlertGroupAlertsTable.tsx","webpack://grafana/./public/app/features/alerting/unified/styles/notifications.ts","webpack://grafana/./public/app/features/alerting/unified/components/alert-groups/AlertGroupHeader.tsx","webpack://grafana/./public/app/features/alerting/unified/components/alert-groups/AlertGroup.tsx","webpack://grafana/./public/app/features/alerting/unified/utils/mute-timings.ts"],"sourcesContent":["import { HTMLAttributes } from 'react';\n\nimport { Button, IconSize } from '@grafana/ui';\n\ninterface Props extends HTMLAttributes<HTMLButtonElement> {\n  isCollapsed: boolean;\n  onToggle: (isCollapsed: boolean) => void;\n  // Todo: this should be made compulsory for a11y purposes\n  idControlled?: string;\n  size?: IconSize;\n  className?: string;\n  text?: string;\n}\n\nexport const CollapseToggle = ({\n  isCollapsed,\n  onToggle,\n  idControlled,\n  className,\n  text,\n  size = 'xl',\n  ...restOfProps\n}: Props) => {\n  return (\n    <Button\n      type=\"button\"\n      fill=\"text\"\n      variant=\"secondary\"\n      aria-expanded={!isCollapsed}\n      aria-controls={idControlled}\n      className={className}\n      icon={isCollapsed ? 'angle-right' : 'angle-down'}\n      onClick={() => onToggle(!isCollapsed)}\n      {...restOfProps}\n    >\n      {text}\n    </Button>\n  );\n};\n","import { lastValueFrom } from 'rxjs';\n\nimport { getBackendSrv } from '@grafana/runtime';\nimport { ContactPointsState, ReceiverState, ReceiversStateDTO } from 'app/features/alerting/unified/types/alerting';\n\nimport { getDatasourceAPIUid } from '../utils/datasource';\n\ninterface IntegrationNameObject {\n  type: string;\n  index?: string;\n}\nexport const parseIntegrationName = (integrationName: string): IntegrationNameObject => {\n  const matches = integrationName.match(/^(\\w+)(\\[\\d+\\])?$/);\n  if (!matches) {\n    return { type: integrationName, index: undefined };\n  }\n\n  return {\n    type: matches[1],\n    index: matches[2],\n  };\n};\n\nexport const contactPointsStateDtoToModel = (receiversStateDto: ReceiversStateDTO[]): ContactPointsState => {\n  // init object to return\n  const contactPointsState: ContactPointsState = { receivers: {}, errorCount: 0 };\n  // for each receiver from response\n  receiversStateDto.forEach((cpState) => {\n    //init receiver state\n    contactPointsState.receivers[cpState.name] = { active: cpState.active, notifiers: {}, errorCount: 0 };\n    const receiverState = contactPointsState.receivers[cpState.name];\n    //update integrations in response\n    cpState.integrations.forEach((integrationStatusDTO) => {\n      //update errorcount\n      const hasError = Boolean(integrationStatusDTO?.lastNotifyAttemptError);\n      if (hasError) {\n        receiverState.errorCount += 1;\n      }\n      //add integration for this type\n      const integrationType = getIntegrationType(integrationStatusDTO.name);\n      if (integrationType) {\n        //if type still does not exist in IntegrationsTypeState we initialize it with an empty array\n        if (!receiverState.notifiers[integrationType]) {\n          receiverState.notifiers[integrationType] = [];\n        }\n        // add error status for this type\n        receiverState.notifiers[integrationType].push(integrationStatusDTO);\n      }\n    });\n  });\n  const errorsCount = Object.values(contactPointsState.receivers).reduce(\n    (prevCount: number, receiverState: ReceiverState) => prevCount + receiverState.errorCount,\n    0\n  );\n  return { ...contactPointsState, errorCount: errorsCount };\n};\n\nexport const getIntegrationType = (integrationName: string): string | undefined =>\n  parseIntegrationName(integrationName)?.type;\n\nexport async function fetchContactPointsState(alertManagerSourceName: string): Promise<ContactPointsState> {\n  try {\n    const response = await lastValueFrom(\n      getBackendSrv().fetch<ReceiversStateDTO[]>({\n        url: `/api/alertmanager/${getDatasourceAPIUid(alertManagerSourceName)}/config/api/v1/receivers`,\n        showErrorAlert: false,\n        showSuccessAlert: false,\n      })\n    );\n    return contactPointsStateDtoToModel(response.data);\n  } catch (error) {\n    return contactPointsStateDtoToModel([]);\n  }\n}\n","/** @deprecated To be deleted - use alertingApiServer API instead */\n\nimport { ContactPointsState } from 'app/features/alerting/unified/types/alerting';\n\nimport { CONTACT_POINTS_STATE_INTERVAL_MS } from '../utils/constants';\n\nimport { alertingApi } from './alertingApi';\nimport { fetchContactPointsState } from './grafana';\n\nexport const receiversApi = alertingApi.injectEndpoints({\n  endpoints: (build) => ({\n    contactPointsState: build.query<ContactPointsState, { amSourceName: string }>({\n      queryFn: async ({ amSourceName }) => {\n        try {\n          const contactPointsState = await fetchContactPointsState(amSourceName);\n          return { data: contactPointsState };\n        } catch (error) {\n          return { error: error };\n        }\n      },\n    }),\n  }),\n});\n\nexport const useGetContactPointsState = (alertManagerSourceName: string) => {\n  const contactPointsStateEmpty: ContactPointsState = { receivers: {}, errorCount: 0 };\n  const { currentData: contactPointsState } = receiversApi.useContactPointsStateQuery(\n    { amSourceName: alertManagerSourceName ?? '' },\n    {\n      skip: !alertManagerSourceName,\n      pollingInterval: CONTACT_POINTS_STATE_INTERVAL_MS,\n    }\n  );\n  return contactPointsState ?? contactPointsStateEmpty;\n};\n","import { useEffect, useMemo } from 'react';\n\nimport { SelectableValue } from '@grafana/data';\nimport { t } from '@grafana/i18n';\nimport { Alert, Select, SelectCommonProps, Text } from '@grafana/ui';\nimport { ContactPointReceiverSummary } from 'app/features/alerting/unified/components/contact-points/ContactPoint';\nimport { useAlertmanager } from 'app/features/alerting/unified/state/AlertmanagerContext';\n\nimport { useContactPointsWithStatus } from '../contact-points/useContactPoints';\nimport { ContactPointWithMetadata } from '../contact-points/utils';\n\nconst MAX_CONTACT_POINTS_RENDERED = 500;\n\ntype ContactPointSelectorProps = {\n  selectProps: SelectCommonProps<ContactPointWithMetadata>;\n  /** Name of a contact point to optionally find and set as the preset value on the dropdown */\n  selectedContactPointName?: string | null;\n  onError?: (error: Error) => void;\n};\n\nexport const ExternalAlertmanagerContactPointSelector = ({\n  selectProps,\n  selectedContactPointName,\n  onError = () => {},\n}: ContactPointSelectorProps) => {\n  const { selectedAlertmanager } = useAlertmanager();\n  const { contactPoints, isLoading, error } = useContactPointsWithStatus({\n    alertmanager: selectedAlertmanager!,\n  });\n\n  const options: Array<SelectableValue<ContactPointWithMetadata>> = contactPoints.map((contactPoint) => {\n    return {\n      label: contactPoint.name,\n      value: contactPoint,\n      component: () => (\n        <Text variant=\"bodySmall\" color=\"secondary\">\n          <ContactPointReceiverSummary receivers={contactPoint.grafana_managed_receiver_configs} limit={2} />\n        </Text>\n      ),\n    };\n  });\n\n  const matchedContactPoint: SelectableValue<ContactPointWithMetadata> | null = useMemo(() => {\n    return options.find((option) => option.value?.name === selectedContactPointName) || null;\n  }, [options, selectedContactPointName]);\n\n  useEffect(() => {\n    // If the contact points are fetched successfully and the selected contact point is not in the list, show an error\n    if (!isLoading && selectedContactPointName && !matchedContactPoint) {\n      onError(new Error(`Contact point \"${selectedContactPointName}\" could not be found`));\n    }\n  }, [isLoading, matchedContactPoint, onError, selectedContactPointName]);\n\n  // TODO error handling\n  if (error) {\n    return (\n      <Alert\n        title={t(\n          'alerting.contact-point-selector.title-failed-to-fetch-contact-points',\n          'Failed to fetch contact points'\n        )}\n        severity=\"error\"\n      />\n    );\n  }\n\n  return (\n    <Select\n      virtualized={options.length > MAX_CONTACT_POINTS_RENDERED}\n      options={options}\n      value={matchedContactPoint}\n      {...selectProps}\n      isLoading={isLoading}\n      disabled={isLoading}\n    />\n  );\n};\n","import { css } from '@emotion/css';\nimport { debounce, isEqual } from 'lodash';\nimport { useCallback, useEffect, useRef } from 'react';\n\nimport { ContactPointSelector as GrafanaManagedContactPointSelector } from '@grafana/alerting/unstable';\nimport { Trans, t } from '@grafana/i18n';\nimport { Button, Field, Icon, Input, Label, Stack, Text, Tooltip, useStyles2 } from '@grafana/ui';\nimport { AlertmanagerAction, useAlertmanagerAbility } from 'app/features/alerting/unified/hooks/useAbilities';\nimport { ObjectMatcher, RouteWithID } from 'app/plugins/datasource/alertmanager/types';\n\nimport { useURLSearchParams } from '../../hooks/useURLSearchParams';\nimport { useAlertmanager } from '../../state/AlertmanagerContext';\nimport { matcherToObjectMatcher } from '../../utils/alertmanager';\nimport {\n  normalizeMatchers,\n  parsePromQLStyleMatcherLoose,\n  parsePromQLStyleMatcherLooseSafe,\n  unquoteIfRequired,\n} from '../../utils/matchers';\n\nimport { ExternalAlertmanagerContactPointSelector } from './ContactPointSelector';\n\ninterface NotificationPoliciesFilterProps {\n  onChangeMatchers: (labels: ObjectMatcher[]) => void;\n  onChangeReceiver: (receiver: string | undefined) => void;\n  matchingCount: number;\n}\n\nconst NotificationPoliciesFilter = ({\n  onChangeReceiver,\n  onChangeMatchers,\n  matchingCount,\n}: NotificationPoliciesFilterProps) => {\n  const [contactPointsSupported, canSeeContactPoints] = useAlertmanagerAbility(AlertmanagerAction.ViewContactPoint);\n  const { isGrafanaAlertmanager } = useAlertmanager();\n  const [searchParams, setSearchParams] = useURLSearchParams();\n  const searchInputRef = useRef<HTMLInputElement | null>(null);\n  const { queryString, contactPoint } = getNotificationPoliciesFilters(searchParams);\n  const styles = useStyles2(getStyles);\n\n  const handleChangeLabels = useCallback(() => debounce(onChangeMatchers, 500), [onChangeMatchers]);\n\n  useEffect(() => {\n    onChangeReceiver(contactPoint);\n  }, [contactPoint, onChangeReceiver]);\n\n  useEffect(() => {\n    const matchers = parsePromQLStyleMatcherLooseSafe(queryString ?? '').map(matcherToObjectMatcher);\n    handleChangeLabels()(matchers);\n  }, [handleChangeLabels, queryString]);\n\n  const clearFilters = useCallback(() => {\n    if (searchInputRef.current) {\n      searchInputRef.current.value = '';\n    }\n    setSearchParams({ contactPoint: '', queryString: undefined });\n  }, [setSearchParams]);\n\n  const hasFilters = queryString || contactPoint;\n\n  let inputValid = Boolean(queryString && queryString.length > 3);\n  try {\n    if (!queryString) {\n      inputValid = true;\n    } else {\n      parsePromQLStyleMatcherLoose(queryString);\n    }\n  } catch (err) {\n    inputValid = false;\n  }\n\n  return (\n    <Stack direction=\"row\" alignItems=\"flex-end\" gap={1}>\n      <Field\n        className={styles.noBottom}\n        label={\n          <Label>\n            <Stack gap={0.5}>\n              <Trans i18nKey=\"alerting.common.search-by-matchers\">Search by matchers</Trans>\n              <Tooltip\n                content={\n                  <Trans i18nKey=\"alerting.policies.filter-description\">\n                    Filter notification policies by using a comma separated list of matchers, e.g.:\n                    <pre>severity=critical, region=EMEA</pre>\n                  </Trans>\n                }\n              >\n                <Icon name=\"info-circle\" size=\"sm\" />\n              </Tooltip>\n            </Stack>\n          </Label>\n        }\n        invalid={!inputValid}\n        error={!inputValid ? 'Query must use valid matcher syntax' : null}\n      >\n        <Input\n          ref={searchInputRef}\n          data-testid=\"search-query-input\"\n          placeholder={t('alerting.notification-policies-filter.search-query-input-placeholder-search', 'Search')}\n          width={46}\n          prefix={<Icon name=\"search\" />}\n          onChange={(event) => {\n            setSearchParams({ queryString: event.currentTarget.value });\n          }}\n          defaultValue={queryString}\n        />\n      </Field>\n      {contactPointsSupported && canSeeContactPoints && (\n        <Field\n          label={t('alerting.notification-policies-filter.label-search-by-contact-point', 'Search by contact point')}\n          style={{ marginBottom: 0 }}\n        >\n          {isGrafanaAlertmanager ? (\n            <GrafanaManagedContactPointSelector\n              placeholder={t(\n                'alerting.notification-policies-filter.placeholder-search-by-contact-point',\n                'Choose a contact point'\n              )}\n              id=\"receiver\"\n              onChange={(contactPoint) => {\n                // clearing the contact point will return \"null\"\n                if (!contactPoint) {\n                  setSearchParams({ contactPoint: undefined });\n                } else {\n                  setSearchParams({ contactPoint: contactPoint.spec.title });\n                }\n              }}\n              width={28}\n              isClearable\n              value={searchParams.get('contactPoint') ?? undefined}\n            />\n          ) : (\n            <ExternalAlertmanagerContactPointSelector\n              selectProps={{\n                id: 'receiver',\n                'aria-label': 'Search by contact point',\n                onChange: (option) => {\n                  setSearchParams({ contactPoint: option?.value?.name });\n                },\n                width: 28,\n                isClearable: true,\n                placeholder: t(\n                  'alerting.notification-policies-filter.placeholder-search-by-contact-point',\n                  'Choose a contact point'\n                ),\n              }}\n              selectedContactPointName={searchParams.get('contactPoint') ?? undefined}\n            />\n          )}\n        </Field>\n      )}\n      {hasFilters && (\n        <Stack alignItems=\"center\">\n          <Button variant=\"secondary\" icon=\"times\" onClick={clearFilters}>\n            <Trans i18nKey=\"alerting.common.clear-filters\">Clear filters</Trans>\n          </Button>\n          <Text variant=\"bodySmall\" color=\"secondary\">\n            {matchingCount === 0 && 'No policies matching filters.'}\n            {matchingCount === 1 && `${matchingCount} policy matches the filters.`}\n            {matchingCount > 1 && `${matchingCount} policies match the filters.`}\n          </Text>\n        </Stack>\n      )}\n    </Stack>\n  );\n};\n\n/**\n * Find a list of route IDs that match given input filters\n */\ntype FilterPredicate = (route: RouteWithID) => boolean;\n\n/**\n * Find routes int the tree that match the given predicate function\n * @param routeTree the route tree to search\n * @param predicateFn the predicate function to match routes\n * @returns\n * - matches: list of routes that match the predicate\n * - matchingRouteIdsWithPath: map with routeids that are part of the path of a matching route\n *  key is the route id, value is an array of route ids that are part of its path\n */\nexport function findRoutesMatchingPredicate(\n  routeTree: RouteWithID,\n  predicateFn: FilterPredicate\n): Map<RouteWithID, RouteWithID[]> {\n  // map with routids that are part of the path of a matching route\n  // key is the route id, value is an array of route ids that are part of the path\n  const matchingRouteIdsWithPath = new Map<RouteWithID, RouteWithID[]>();\n\n  function findMatch(route: RouteWithID, path: RouteWithID[]) {\n    const newPath = [...path, route];\n\n    if (predicateFn(route)) {\n      // if the route matches the predicate, we need to add the path to the map of matching routes\n      const previousPath = matchingRouteIdsWithPath.get(route) ?? [];\n      // add the current route id to the map with its path\n      matchingRouteIdsWithPath.set(route, [...previousPath, ...newPath]);\n    }\n\n    // if the route has subroutes, call findMatch recursively\n    route.routes?.forEach((route) => findMatch(route, newPath));\n  }\n\n  findMatch(routeTree, []);\n\n  return matchingRouteIdsWithPath;\n}\n\nexport function findRoutesByMatchers(route: RouteWithID, labelMatchersFilter: ObjectMatcher[]): boolean {\n  const filters = labelMatchersFilter.map(unquoteMatchersIfRequired);\n  const routeMatchers = normalizeMatchers(route).map(unquoteMatchersIfRequired);\n  return filters.every((filter) => routeMatchers.some((matcher) => isEqual(filter, matcher)));\n}\n\n/**\n * This function is mostly used for decoding matchers like \"test\"=\"test\" into test=test to remove quotes when they're not needed.\n * This mimicks the behaviour in Alertmanager where it decodes the label matchers in the same way and makes searching for policies\n * easier in case the label keys or values are quoted when they shouldn't really be.\n */\nconst unquoteMatchersIfRequired = ([key, operator, value]: ObjectMatcher): ObjectMatcher => {\n  return [unquoteIfRequired(key), operator, unquoteIfRequired(value)];\n};\n\nconst getNotificationPoliciesFilters = (searchParams: URLSearchParams) => ({\n  queryString: searchParams.get('queryString') ?? undefined,\n  contactPoint: searchParams.get('contactPoint') ?? undefined,\n});\n\nconst getStyles = () => ({\n  noBottom: css({\n    marginBottom: 0,\n  }),\n});\n\nexport { NotificationPoliciesFilter };\n","import pluralize from 'pluralize';\nimport { Fragment } from 'react';\nimport * as React from 'react';\n\nimport { t } from '@grafana/i18n';\nimport { Badge, Stack } from '@grafana/ui';\n\ninterface Props {\n  active?: number;\n  suppressed?: number;\n  unprocessed?: number;\n}\n\nexport const AlertGroupsSummary = ({ active = 0, suppressed = 0, unprocessed = 0 }: Props) => {\n  const statsComponents: React.ReactNode[] = [];\n  const total = active + suppressed + unprocessed;\n\n  if (active) {\n    statsComponents.push(\n      <Badge\n        color=\"red\"\n        key=\"firing\"\n        text={t('alerting.alert-groups-summary.text-firing', '{{count}} firing', { count: active })}\n      />\n    );\n  }\n\n  if (suppressed) {\n    statsComponents.push(\n      <Badge\n        color=\"blue\"\n        key=\"suppressed\"\n        text={t('alerting.alert-groups-summary.text-suppressed', '{{count}} suppressed', { count: suppressed })}\n      />\n    );\n  }\n\n  if (unprocessed) {\n    statsComponents.push(\n      <Badge\n        color=\"orange\"\n        key=\"unprocessed\"\n        text={t('alerting.alert-groups-summary.text-unprocessed', '{{count}} unprocessed', { count: unprocessed })}\n      />\n    );\n  }\n\n  // if we only have one category it's not really necessary to repeat the total\n  if (statsComponents.length > 1) {\n    statsComponents.unshift(\n      <Fragment key=\"total\">\n        {total} {pluralize('instance', total)}\n      </Fragment>\n    );\n  }\n\n  const hasStats = Boolean(statsComponents.length);\n\n  return hasStats ? <Stack gap={0.5}>{statsComponents}</Stack> : null;\n};\n","import { ControllerRenderProps } from 'react-hook-form';\n\nexport const handleContactPointSelect = (\n  name: string | undefined | null,\n  onChange: ControllerRenderProps['onChange']\n) => {\n  if (name === null) {\n    return onChange(null);\n  }\n\n  if (!name) {\n    return onChange('');\n  }\n\n  return onChange(name);\n};\n","import { ReactNode, useState } from 'react';\nimport { Controller, useForm } from 'react-hook-form';\n\nimport { ContactPointSelector as GrafanaManagedContactPointSelector } from '@grafana/alerting/unstable';\nimport { Trans, t } from '@grafana/i18n';\nimport { Collapse, Field, Link, MultiSelect, useStyles2 } from '@grafana/ui';\nimport { ExternalAlertmanagerContactPointSelector } from 'app/features/alerting/unified/components/notification-policies/ContactPointSelector';\nimport { handleContactPointSelect } from 'app/features/alerting/unified/components/notification-policies/utils';\nimport { RouteWithID } from 'app/plugins/datasource/alertmanager/types';\n\nimport { useAlertmanager } from '../../state/AlertmanagerContext';\nimport { FormAmRoute } from '../../types/amroutes';\nimport {\n  amRouteToFormAmRoute,\n  commonGroupByOptions,\n  mapMultiSelectValueToStrings,\n  promDurationValidator,\n  repeatIntervalValidator,\n  stringToSelectableValue,\n  stringsToSelectableValues,\n} from '../../utils/amroutes';\nimport { makeAMLink } from '../../utils/misc';\n\nimport { PromDurationInput } from './PromDurationInput';\nimport { getFormStyles } from './formStyles';\nimport { TIMING_OPTIONS_DEFAULTS } from './timingOptions';\n\nexport interface AmRootRouteFormProps {\n  alertManagerSourceName: string;\n  actionButtons: ReactNode;\n  onSubmit: (route: Partial<FormAmRoute>) => void;\n  route: RouteWithID;\n}\n\nexport const AmRootRouteForm = ({ actionButtons, alertManagerSourceName, onSubmit, route }: AmRootRouteFormProps) => {\n  const styles = useStyles2(getFormStyles);\n  const [isTimingOptionsExpanded, setIsTimingOptionsExpanded] = useState(false);\n  const { isGrafanaAlertmanager } = useAlertmanager();\n  const [groupByOptions, setGroupByOptions] = useState(stringsToSelectableValues(route.group_by));\n\n  const defaultValues = amRouteToFormAmRoute(route);\n  const {\n    handleSubmit,\n    register,\n    control,\n    formState: { errors },\n    setValue,\n    getValues,\n  } = useForm<FormAmRoute>({\n    defaultValues: {\n      ...defaultValues,\n      overrideTimings: true,\n      overrideGrouping: true,\n    },\n  });\n  return (\n    <form onSubmit={handleSubmit(onSubmit)}>\n      <Field\n        label={t('alerting.am-root-route-form.label-default-contact-point', 'Default contact point')}\n        invalid={Boolean(errors.receiver) ? true : undefined}\n        error={errors.receiver?.message}\n      >\n        <div className={styles.container} data-testid=\"am-receiver-select\">\n          <Controller\n            render={({ field: { onChange, ref, value, ...field } }) =>\n              isGrafanaAlertmanager ? (\n                <GrafanaManagedContactPointSelector\n                  onChange={(contactPoint) => {\n                    handleContactPointSelect(contactPoint?.spec.title, onChange);\n                  }}\n                  isClearable={false}\n                  value={value}\n                  placeholder={t(\n                    'alerting.notification-policies-filter.placeholder-search-by-contact-point',\n                    'Choose a contact point'\n                  )}\n                />\n              ) : (\n                <ExternalAlertmanagerContactPointSelector\n                  selectProps={{\n                    ...field,\n                    onChange: (changeValue) => handleContactPointSelect(changeValue.value?.name, onChange),\n                  }}\n                  selectedContactPointName={value}\n                />\n              )\n            }\n            control={control}\n            name=\"receiver\"\n            rules={{\n              required: { value: true, message: t('alerting.am-root-route-form.message.required', 'Required.') },\n            }}\n          />\n          <span>\n            <Trans i18nKey=\"alerting.am-root-route-form.or\">or</Trans>\n          </span>\n          <Link\n            className={styles.linkText}\n            href={makeAMLink('/alerting/notifications/receivers/new', alertManagerSourceName)}\n          >\n            <Trans i18nKey=\"alerting.am-root-route-form.create-a-contact-point\">Create a contact point</Trans>\n          </Link>\n        </div>\n      </Field>\n      <Field\n        label={t('alerting.am-root-route-form.am-group-select-label-group-by', 'Group by')}\n        description={t(\n          'alerting.am-root-route-form.am-group-select-description-group-by',\n          'Combine multiple alerts into a single notification by grouping them by the same label values.'\n        )}\n        data-testid=\"am-group-select\"\n      >\n        <Controller\n          render={({ field: { onChange, ref, ...field } }) => (\n            <MultiSelect\n              aria-label={t('alerting.am-root-route-form.aria-label-group-by', 'Group by')}\n              {...field}\n              allowCustomValue\n              className={styles.input}\n              onCreateOption={(opt: string) => {\n                setGroupByOptions((opts) => [...opts, stringToSelectableValue(opt)]);\n                setValue('groupBy', [...(field.value || []), opt]);\n              }}\n              onChange={(value) => onChange(mapMultiSelectValueToStrings(value))}\n              options={[...commonGroupByOptions, ...groupByOptions]}\n            />\n          )}\n          control={control}\n          name=\"groupBy\"\n        />\n      </Field>\n      <Collapse\n        collapsible\n        className={styles.collapse}\n        isOpen={isTimingOptionsExpanded}\n        label={t('alerting.am-root-route-form.label-timing-options', 'Timing options')}\n        onToggle={setIsTimingOptionsExpanded}\n      >\n        <div className={styles.timingFormContainer}>\n          <Field\n            label={t('alerting.am-root-route-form.am-group-wait-label-group-wait', 'Group wait')}\n            description={t(\n              'alerting.am-root-route-form.am-group-description-label',\n              'The waiting time before sending the first notification for a new group of alerts. Default 30 seconds.'\n            )}\n            invalid={!!errors.groupWaitValue}\n            error={errors.groupWaitValue?.message}\n            data-testid=\"am-group-wait\"\n          >\n            <PromDurationInput\n              {...register('groupWaitValue', { validate: promDurationValidator })}\n              placeholder={TIMING_OPTIONS_DEFAULTS.group_wait}\n              className={styles.promDurationInput}\n              aria-label={t('alerting.am-root-route-form.aria-label-group-wait', 'Group wait')}\n            />\n          </Field>\n          <Field\n            label={t('alerting.am-root-route-form.am-group-interval-label-group-interval', 'Group interval')}\n            description={t(\n              'alerting.am-root-route-form.am-group-interval-description',\n              'The wait time before sending a notification about changes in the alert group after the first notification has been sent. Default is 5 minutes.'\n            )}\n            invalid={!!errors.groupIntervalValue}\n            error={errors.groupIntervalValue?.message}\n            data-testid=\"am-group-interval\"\n          >\n            <PromDurationInput\n              {...register('groupIntervalValue', { validate: promDurationValidator })}\n              placeholder={TIMING_OPTIONS_DEFAULTS.group_interval}\n              className={styles.promDurationInput}\n              aria-label={t('alerting.am-root-route-form.aria-label-group-interval', 'Group interval')}\n            />\n          </Field>\n          <Field\n            label={t('alerting.am-root-route-form.am-repeat-interval-label-repeat-interval', 'Repeat interval')}\n            description={t(\n              'alerting.am-root-route-form.am-repeat-interval-description',\n              'The wait time before resending a notification that has already been sent successfully. Default is 4 hours. Should be a multiple of Group interval.'\n            )}\n            invalid={!!errors.repeatIntervalValue}\n            error={errors.repeatIntervalValue?.message}\n            data-testid=\"am-repeat-interval\"\n          >\n            <PromDurationInput\n              {...register('repeatIntervalValue', {\n                validate: (value: string) => {\n                  const groupInterval = getValues('groupIntervalValue');\n                  return repeatIntervalValidator(value, groupInterval);\n                },\n              })}\n              placeholder={TIMING_OPTIONS_DEFAULTS.repeat_interval}\n              className={styles.promDurationInput}\n              aria-label={t('alerting.am-root-route-form.aria-label-repeat-interval', 'Repeat interval')}\n            />\n          </Field>\n        </div>\n      </Collapse>\n      <div className={styles.container}>{actionButtons}</div>\n    </form>\n  );\n};\n","import { css } from '@emotion/css';\nimport { ReactNode, useState } from 'react';\nimport { Controller, useFieldArray, useForm } from 'react-hook-form';\n\nimport { ContactPointSelector as GrafanaManagedContactPointSelector } from '@grafana/alerting/unstable';\nimport { GrafanaTheme2 } from '@grafana/data';\nimport { Trans, t } from '@grafana/i18n';\nimport {\n  Badge,\n  Button,\n  Field,\n  FieldValidationMessage,\n  IconButton,\n  Input,\n  MultiSelect,\n  Select,\n  Stack,\n  Switch,\n  useStyles2,\n} from '@grafana/ui';\nimport MuteTimingsSelector from 'app/features/alerting/unified/components/alertmanager-entities/MuteTimingsSelector';\nimport { ExternalAlertmanagerContactPointSelector } from 'app/features/alerting/unified/components/notification-policies/ContactPointSelector';\nimport { handleContactPointSelect } from 'app/features/alerting/unified/components/notification-policies/utils';\nimport { AlertmanagerAction, useAlertmanagerAbility } from 'app/features/alerting/unified/hooks/useAbilities';\nimport { MatcherOperator, RouteWithID } from 'app/plugins/datasource/alertmanager/types';\n\nimport { useAlertmanager } from '../../state/AlertmanagerContext';\nimport { FormAmRoute } from '../../types/amroutes';\nimport { matcherFieldOptions } from '../../utils/alertmanager';\nimport {\n  amRouteToFormAmRoute,\n  commonGroupByOptions,\n  emptyArrayFieldMatcher,\n  mapMultiSelectValueToStrings,\n  promDurationValidator,\n  repeatIntervalValidator,\n  stringToSelectableValue,\n  stringsToSelectableValues,\n} from '../../utils/amroutes';\n\nimport { PromDurationInput } from './PromDurationInput';\nimport { getFormStyles } from './formStyles';\nimport { routeTimingsFields } from './routeTimingsFields';\n\nexport interface AmRoutesExpandedFormProps {\n  route?: RouteWithID;\n  onSubmit: (route: Partial<FormAmRoute>) => void;\n  actionButtons: ReactNode;\n  defaults?: Partial<FormAmRoute>;\n}\n\nexport const AmRoutesExpandedForm = ({ actionButtons, route, onSubmit, defaults }: AmRoutesExpandedFormProps) => {\n  const styles = useStyles2(getStyles);\n  const formStyles = useStyles2(getFormStyles);\n  const { selectedAlertmanager, isGrafanaAlertmanager } = useAlertmanager();\n  const [, canSeeMuteTimings] = useAlertmanagerAbility(AlertmanagerAction.ViewTimeInterval);\n  const [groupByOptions, setGroupByOptions] = useState(stringsToSelectableValues(route?.group_by));\n\n  const emptyMatcher = [{ name: '', operator: MatcherOperator.equal, value: '' }];\n\n  const formAmRoute = {\n    ...amRouteToFormAmRoute(route),\n    ...defaults,\n  };\n\n  const defaultValues: Omit<FormAmRoute, 'routes'> = {\n    ...formAmRoute,\n    // if we're adding a new route, show at least one empty matcher\n    object_matchers: route ? formAmRoute.object_matchers : emptyMatcher,\n  };\n\n  const {\n    handleSubmit,\n    control,\n    register,\n    formState: { errors },\n    setValue,\n    watch,\n    getValues,\n  } = useForm<FormAmRoute>({\n    defaultValues,\n  });\n  const { fields, append, remove } = useFieldArray({\n    control,\n    name: 'object_matchers',\n  });\n\n  return (\n    <form onSubmit={handleSubmit(onSubmit)}>\n      <input type=\"hidden\" {...register('id')} />\n      <Stack direction=\"column\" alignItems=\"flex-start\">\n        <div>\n          <Trans i18nKey=\"alerting.am-routes-expanded-form.matching-labels\">Matching labels</Trans>\n        </div>\n        {fields.length === 0 && (\n          <Badge\n            color=\"orange\"\n            className={styles.noMatchersWarning}\n            icon=\"exclamation-triangle\"\n            text={t(\n              'alerting.am-routes-expanded-form.badge-no-matchers',\n              'If no matchers are specified, this notification policy will handle all alert instances.'\n            )}\n          />\n        )}\n        {fields.length > 0 && (\n          <div className={styles.matchersContainer}>\n            {fields.map((field, index) => {\n              return (\n                <Stack direction=\"row\" key={field.id} alignItems=\"center\">\n                  <Field\n                    label={t('alerting.am-routes-expanded-form.label-label', 'Label')}\n                    invalid={!!errors.object_matchers?.[index]?.name}\n                    error={errors.object_matchers?.[index]?.name?.message}\n                  >\n                    <Input\n                      {...register(`object_matchers.${index}.name`, { required: 'Field is required' })}\n                      defaultValue={field.name}\n                      placeholder={t('alerting.am-routes-expanded-form.placeholder-label', 'label')}\n                      autoFocus\n                    />\n                  </Field>\n                  <Field label={t('alerting.am-routes-expanded-form.label-operator', 'Operator')}>\n                    <Controller\n                      render={({ field: { onChange, ref, ...field } }) => (\n                        <Select\n                          {...field}\n                          className={styles.matchersOperator}\n                          onChange={(value) => onChange(value?.value)}\n                          options={matcherFieldOptions}\n                          aria-label={t('alerting.am-routes-expanded-form.aria-label-operator', 'Operator')}\n                        />\n                      )}\n                      defaultValue={field.operator}\n                      control={control}\n                      name={`object_matchers.${index}.operator`}\n                      rules={{\n                        required: {\n                          value: true,\n                          message: t('alerting.am-routes-expanded-form.message.required', 'Required.'),\n                        },\n                      }}\n                    />\n                  </Field>\n                  <Field\n                    label={t('alerting.am-routes-expanded-form.label-value', 'Value')}\n                    invalid={!!errors.object_matchers?.[index]?.value}\n                    error={errors.object_matchers?.[index]?.value?.message}\n                  >\n                    <Input\n                      {...register(`object_matchers.${index}.value`)}\n                      defaultValue={field.value}\n                      placeholder={t('alerting.am-routes-expanded-form.placeholder-value', 'value')}\n                    />\n                  </Field>\n                  <IconButton\n                    tooltip={t('alerting.am-routes-expanded-form.tooltip-remove-matcher', 'Remove matcher')}\n                    name={'trash-alt'}\n                    onClick={() => remove(index)}\n                  >\n                    <Trans i18nKey=\"alerting.am-routes-expanded-form.remove\">Remove</Trans>\n                  </IconButton>\n                </Stack>\n              );\n            })}\n          </div>\n        )}\n        <Button\n          className={styles.addMatcherBtn}\n          icon=\"plus\"\n          onClick={() => append(emptyArrayFieldMatcher)}\n          variant=\"secondary\"\n          type=\"button\"\n        >\n          <Trans i18nKey=\"alerting.am-routes-expanded-form.add-matcher\">Add matcher</Trans>\n        </Button>\n      </Stack>\n\n      <Field label={t('alerting.am-routes-expanded-form.label-contact-point', 'Contact point')}>\n        <Controller\n          render={({ field: { onChange, ref, value, ...field } }) =>\n            isGrafanaAlertmanager ? (\n              <GrafanaManagedContactPointSelector\n                onChange={(contactPoint) => {\n                  handleContactPointSelect(contactPoint?.spec.title, onChange);\n                }}\n                isClearable\n                value={value}\n                placeholder={t(\n                  'alerting.notification-policies-filter.placeholder-search-by-contact-point',\n                  'Choose a contact point'\n                )}\n              />\n            ) : (\n              <ExternalAlertmanagerContactPointSelector\n                selectProps={{\n                  ...field,\n                  className: formStyles.input,\n                  onChange: (value) => handleContactPointSelect(value.value?.name, onChange),\n                  isClearable: true,\n                }}\n                selectedContactPointName={value}\n              />\n            )\n          }\n          control={control}\n          name=\"receiver\"\n        />\n      </Field>\n      <Field\n        label={t(\n          'alerting.am-routes-expanded-form.label-continue-matching-subsequent-sibling-nodes',\n          'Continue matching subsequent sibling nodes'\n        )}\n      >\n        <Switch id=\"continue-toggle\" {...register('continue')} />\n      </Field>\n      <Field label={t('alerting.am-routes-expanded-form.label-override-grouping', 'Override grouping')}>\n        <Switch id=\"override-grouping-toggle\" {...register('overrideGrouping')} />\n      </Field>\n      {watch().overrideGrouping && (\n        <Field\n          label={t('alerting.am-routes-expanded-form.label-group-by', 'Group by')}\n          description={t(\n            'alerting.am-routes-expanded-form.description-group-by',\n            'Combine multiple alerts into a single notification by grouping them by the same label values. If empty, it is inherited from the parent policy.'\n          )}\n        >\n          <Controller\n            rules={{\n              validate: (value) => {\n                if (!value || value.length === 0) {\n                  return 'At least one group by option is required.';\n                }\n                return true;\n              },\n            }}\n            render={({ field: { onChange, ref, ...field }, fieldState: { error } }) => (\n              <>\n                <MultiSelect\n                  aria-label={t('alerting.am-routes-expanded-form.aria-label-group-by', 'Group by')}\n                  {...field}\n                  invalid={Boolean(error)}\n                  allowCustomValue\n                  className={formStyles.input}\n                  onCreateOption={(opt: string) => {\n                    setGroupByOptions((opts) => [...opts, stringToSelectableValue(opt)]);\n                    setValue('groupBy', [...(field.value || []), opt]);\n                  }}\n                  onChange={(value) => onChange(mapMultiSelectValueToStrings(value))}\n                  options={[...commonGroupByOptions, ...groupByOptions]}\n                />\n                {error && <FieldValidationMessage>{error.message}</FieldValidationMessage>}\n              </>\n            )}\n            control={control}\n            name=\"groupBy\"\n          />\n        </Field>\n      )}\n      <Field label={t('alerting.am-routes-expanded-form.label-override-general-timings', 'Override general timings')}>\n        <Switch id=\"override-timings-toggle\" {...register('overrideTimings')} />\n      </Field>\n      {watch().overrideTimings && (\n        <>\n          <Field\n            label={routeTimingsFields.groupWait.label}\n            description={routeTimingsFields.groupWait.description}\n            invalid={!!errors.groupWaitValue}\n            error={errors.groupWaitValue?.message}\n          >\n            <PromDurationInput\n              {...register('groupWaitValue', { validate: promDurationValidator })}\n              aria-label={routeTimingsFields.groupWait.ariaLabel}\n              className={formStyles.promDurationInput}\n            />\n          </Field>\n          <Field\n            label={routeTimingsFields.groupInterval.label}\n            description={routeTimingsFields.groupInterval.description}\n            invalid={!!errors.groupIntervalValue}\n            error={errors.groupIntervalValue?.message}\n          >\n            <PromDurationInput\n              {...register('groupIntervalValue', { validate: promDurationValidator })}\n              aria-label={routeTimingsFields.groupInterval.ariaLabel}\n              className={formStyles.promDurationInput}\n            />\n          </Field>\n          <Field\n            label={routeTimingsFields.repeatInterval.label}\n            description={routeTimingsFields.repeatInterval.description}\n            invalid={!!errors.repeatIntervalValue}\n            error={errors.repeatIntervalValue?.message}\n          >\n            <PromDurationInput\n              {...register('repeatIntervalValue', {\n                validate: (value = '') => {\n                  const groupInterval = getValues('groupIntervalValue');\n                  return repeatIntervalValidator(value, groupInterval);\n                },\n              })}\n              aria-label={routeTimingsFields.repeatInterval.ariaLabel}\n              className={formStyles.promDurationInput}\n            />\n          </Field>\n        </>\n      )}\n      <Field\n        label={t('alerting.am-routes-expanded-form.am-mute-timing-select-label-mute-timings', 'Mute timings')}\n        data-testid=\"am-mute-timing-select\"\n        description={t(\n          'alerting.am-routes-expanded-form.am-mute-timing-select-description-add-mute-timing-to-policy',\n          'Add mute timing to policy'\n        )}\n        invalid={!!errors.muteTimeIntervals}\n      >\n        <Controller\n          render={({ field: { onChange, ref, ...field } }) => (\n            <MuteTimingsSelector\n              alertmanager={selectedAlertmanager!}\n              selectProps={{\n                ...field,\n                disabled: !canSeeMuteTimings,\n                onChange: (value) => onChange(mapMultiSelectValueToStrings(value)),\n              }}\n            />\n          )}\n          control={control}\n          name=\"muteTimeIntervals\"\n        />\n      </Field>\n      <Field\n        label={t('alerting.am-routes-expanded-form.am-active-timing-select-label-active-timings', 'Active timings')}\n        data-testid=\"am-active-timing-select\"\n        description={t(\n          'alerting.am-routes-expanded-form.am-mute-timing-select-description-add-active-timing-to-policy',\n          'Add active timing to policy'\n        )}\n        invalid={!!errors.activeTimeIntervals}\n      >\n        <Controller\n          render={({ field: { onChange, ref, ...field } }) => (\n            <MuteTimingsSelector\n              alertmanager={selectedAlertmanager!}\n              selectProps={{\n                ...field,\n                disabled: !canSeeMuteTimings,\n                onChange: (value) => onChange(mapMultiSelectValueToStrings(value)),\n              }}\n            />\n          )}\n          control={control}\n          name=\"activeTimeIntervals\"\n        />\n      </Field>\n      {actionButtons}\n    </form>\n  );\n};\n\nconst getStyles = (theme: GrafanaTheme2) => {\n  const commonSpacing = theme.spacing(3.5);\n\n  return {\n    addMatcherBtn: css({\n      marginBottom: commonSpacing,\n    }),\n    matchersContainer: css({\n      backgroundColor: theme.colors.background.secondary,\n      padding: `${theme.spacing(1.5)} ${theme.spacing(2)}`,\n      paddingBottom: 0,\n      width: 'fit-content',\n    }),\n    matchersOperator: css({\n      minWidth: '120px',\n    }),\n    noMatchersWarning: css({\n      padding: `${theme.spacing(1)} ${theme.spacing(2)}`,\n      marginBottom: theme.spacing(1),\n    }),\n  };\n};\n","import { Trans, t } from '@grafana/i18n';\nimport { Alert } from '@grafana/ui';\n\nimport { stringifyErrorLike } from '../../utils/misc';\n\nexport const NotificationPoliciesErrorAlert = ({ error }: { error: unknown }) => {\n  const title = t('alerting.policies.update-errors.title', 'Failed to add or update notification policy');\n\n  const errMessage = stringifyErrorLike(error);\n  return (\n    <Alert title={title} severity=\"error\">\n      <div>{errMessage}</div>\n\n      <Trans i18nKey=\"alerting.policies.update-errors.suffix\">Please refresh the page and try again.</Trans>\n    </Alert>\n  );\n};\n","import { groupBy } from 'lodash';\nimport { FC, useCallback, useMemo, useState } from 'react';\n\nimport { Trans, t } from '@grafana/i18n';\nimport { Button, Icon, Modal, ModalProps, Spinner, Stack } from '@grafana/ui';\nimport { AlertState, AlertmanagerGroup, ObjectMatcher, RouteWithID } from 'app/plugins/datasource/alertmanager/types';\n\nimport { FormAmRoute } from '../../types/amroutes';\nimport { MatcherFormatter } from '../../utils/matchers';\nimport { InsertPosition } from '../../utils/routeTree';\nimport { AlertGroup } from '../alert-groups/AlertGroup';\n\nimport { AlertGroupsSummary } from './AlertGroupsSummary';\nimport { AmRootRouteForm } from './EditDefaultPolicyForm';\nimport { AmRoutesExpandedForm } from './EditNotificationPolicyForm';\nimport { Matchers } from './Matchers';\nimport { NotificationPoliciesErrorAlert } from './PolicyUpdateErrorAlert';\n\ntype ModalHook<T = undefined> = [JSX.Element, (item: T) => void, () => void];\ntype AddModalHook<T = undefined> = [JSX.Element, (item: T, position: InsertPosition) => void, () => void];\ntype EditModalHook = [JSX.Element, (item: RouteWithID, isDefaultRoute?: boolean) => void, () => void];\nconst useAddPolicyModal = (\n  handleAdd: (route: Partial<FormAmRoute>, referenceRoute: RouteWithID, position: InsertPosition) => Promise<void>,\n  loading: boolean\n): AddModalHook<RouteWithID> => {\n  const [showModal, setShowModal] = useState(false);\n  const [insertPosition, setInsertPosition] = useState<InsertPosition | undefined>(undefined);\n  const [referenceRoute, setReferenceRoute] = useState<RouteWithID>();\n\n  const handleDismiss = useCallback(() => {\n    setReferenceRoute(undefined);\n    setInsertPosition(undefined);\n    setError(undefined);\n    setShowModal(false);\n  }, []);\n\n  const handleShow = useCallback((referenceRoute: RouteWithID, position: InsertPosition) => {\n    setReferenceRoute(referenceRoute);\n    setInsertPosition(position);\n    setShowModal(true);\n  }, []);\n\n  const [error, setError] = useState<Error | undefined>(undefined);\n\n  const modalElement = useMemo(\n    () =>\n      loading ? (\n        <UpdatingModal isOpen={showModal} />\n      ) : (\n        <Modal\n          isOpen={showModal}\n          onDismiss={handleDismiss}\n          closeOnBackdropClick={true}\n          closeOnEscape={true}\n          title={t(\n            'alerting.use-add-policy-modal.modal-element.title-add-notification-policy',\n            'Add notification policy'\n          )}\n        >\n          {error && <NotificationPoliciesErrorAlert error={error} />}\n          <AmRoutesExpandedForm\n            defaults={{\n              groupBy: referenceRoute?.group_by,\n            }}\n            onSubmit={(newRoute) => {\n              if (referenceRoute && insertPosition) {\n                handleAdd(newRoute, referenceRoute, insertPosition).catch(setError);\n              }\n            }}\n            actionButtons={\n              <Modal.ButtonRow>\n                <Button type=\"button\" variant=\"secondary\" onClick={handleDismiss} fill=\"outline\">\n                  <Trans i18nKey=\"alerting.common.cancel\">Cancel</Trans>\n                </Button>\n                <Button type=\"submit\">\n                  <Trans i18nKey=\"alerting.policies.save-policy\">Save policy</Trans>\n                </Button>\n              </Modal.ButtonRow>\n            }\n          />\n        </Modal>\n      ),\n    [error, handleAdd, handleDismiss, insertPosition, loading, referenceRoute, showModal, setError]\n  );\n\n  return [modalElement, handleShow, handleDismiss];\n};\n\nconst useEditPolicyModal = (\n  alertManagerSourceName: string,\n  handleUpdate: (route: Partial<FormAmRoute>) => Promise<void>,\n  loading: boolean\n): EditModalHook => {\n  const [showModal, setShowModal] = useState(false);\n  const [isDefaultPolicy, setIsDefaultPolicy] = useState(false);\n  const [route, setRoute] = useState<RouteWithID>();\n\n  const [error, setError] = useState<Error | undefined>(undefined);\n\n  const handleDismiss = useCallback(() => {\n    setRoute(undefined);\n    setShowModal(false);\n    setError(undefined);\n  }, []);\n\n  const handleShow = useCallback((route: RouteWithID, isDefaultPolicy?: boolean) => {\n    setIsDefaultPolicy(isDefaultPolicy ?? false);\n    setRoute(route);\n    setShowModal(true);\n  }, []);\n\n  const modalElement = useMemo(\n    () =>\n      loading ? (\n        <UpdatingModal isOpen={showModal} />\n      ) : (\n        <Modal\n          isOpen={showModal}\n          onDismiss={handleDismiss}\n          closeOnBackdropClick={true}\n          closeOnEscape={true}\n          title={t(\n            'alerting.use-edit-policy-modal.modal-element.title-edit-notification-policy',\n            'Edit notification policy'\n          )}\n        >\n          {error && <NotificationPoliciesErrorAlert error={error} />}\n          {isDefaultPolicy && route && (\n            <AmRootRouteForm\n              // TODO *sigh* this alertmanagersourcename should come from context or something\n              // passing it down all the way here is a code smell\n              alertManagerSourceName={alertManagerSourceName}\n              onSubmit={(values) => handleUpdate(values).catch(setError)}\n              route={route}\n              actionButtons={\n                <Modal.ButtonRow>\n                  <Button type=\"button\" variant=\"secondary\" onClick={handleDismiss} fill=\"outline\">\n                    <Trans i18nKey=\"alerting.common.cancel\">Cancel</Trans>\n                  </Button>\n                  <Button type=\"submit\">\n                    <Trans i18nKey=\"alerting.policies.default-policy.update\">Update default policy</Trans>\n                  </Button>\n                </Modal.ButtonRow>\n              }\n            />\n          )}\n          {!isDefaultPolicy && (\n            <AmRoutesExpandedForm\n              route={route}\n              onSubmit={(values) => handleUpdate(values).catch(setError)}\n              actionButtons={\n                <Modal.ButtonRow>\n                  <Button type=\"button\" variant=\"secondary\" onClick={handleDismiss} fill=\"outline\">\n                    <Trans i18nKey=\"alerting.common.cancel\">Cancel</Trans>\n                  </Button>\n                  <Button type=\"submit\">\n                    <Trans i18nKey=\"alerting.policies.update.update-policy\">Update policy</Trans>\n                  </Button>\n                </Modal.ButtonRow>\n              }\n            />\n          )}\n        </Modal>\n      ),\n    [loading, showModal, handleDismiss, error, isDefaultPolicy, route, alertManagerSourceName, handleUpdate, setError]\n  );\n\n  return [modalElement, handleShow, handleDismiss];\n};\n\nconst useDeletePolicyModal = (\n  handleDelete: (route: RouteWithID) => Promise<void>,\n  loading: boolean\n): ModalHook<RouteWithID> => {\n  const [showModal, setShowModal] = useState(false);\n  const [route, setRoute] = useState<RouteWithID>();\n  const [error, setError] = useState<Error | undefined>(undefined);\n\n  const handleDismiss = useCallback(() => {\n    setRoute(undefined);\n    setShowModal(false);\n    setError(undefined);\n  }, [setRoute]);\n\n  const handleShow = useCallback((route: RouteWithID) => {\n    setRoute(route);\n    setShowModal(true);\n  }, []);\n\n  const modalElement = useMemo(\n    () =>\n      loading ? (\n        <UpdatingModal isOpen={showModal} />\n      ) : (\n        <Modal\n          isOpen={showModal}\n          onDismiss={handleDismiss}\n          closeOnBackdropClick={true}\n          closeOnEscape={true}\n          title={t(\n            'alerting.use-delete-policy-modal.modal-element.title-delete-notification-policy',\n            'Delete notification policy'\n          )}\n        >\n          {error && <NotificationPoliciesErrorAlert error={error} />}\n          <Trans i18nKey=\"alerting.policies.delete.warning-1\">\n            Deleting this notification policy will permanently remove it.\n          </Trans>{' '}\n          <Trans i18nKey=\"alerting.policies.delete.warning-2\">Are you sure you want to delete this policy?</Trans>\n          <Modal.ButtonRow>\n            <Button type=\"button\" variant=\"destructive\" onClick={() => route && handleDelete(route).catch(setError)}>\n              <Trans i18nKey=\"alerting.policies.delete.confirm\">Yes, delete policy</Trans>\n            </Button>\n            <Button type=\"button\" variant=\"secondary\" onClick={handleDismiss}>\n              <Trans i18nKey=\"alerting.common.cancel\">Cancel</Trans>\n            </Button>\n          </Modal.ButtonRow>\n        </Modal>\n      ),\n    [handleDismiss, loading, showModal, error, route, handleDelete]\n  );\n\n  return [modalElement, handleShow, handleDismiss];\n};\n\nconst useAlertGroupsModal = (\n  alertManagerSourceName: string\n): [JSX.Element, (alertGroups: AlertmanagerGroup[], matchers?: ObjectMatcher[]) => void, () => void] => {\n  const [showModal, setShowModal] = useState(false);\n  const [alertGroups, setAlertGroups] = useState<AlertmanagerGroup[]>([]);\n  const [matchers, setMatchers] = useState<ObjectMatcher[]>([]);\n  const [formatter, setFormatter] = useState<MatcherFormatter>('default');\n\n  const handleDismiss = useCallback(() => {\n    setShowModal(false);\n    setAlertGroups([]);\n    setMatchers([]);\n  }, []);\n\n  const handleShow = useCallback(\n    (alertGroups: AlertmanagerGroup[], matchers?: ObjectMatcher[], formatter?: MatcherFormatter) => {\n      setAlertGroups(alertGroups);\n      if (matchers) {\n        setMatchers(matchers);\n      }\n      if (formatter) {\n        setFormatter(formatter);\n      }\n      setShowModal(true);\n    },\n    []\n  );\n\n  const instancesByState = useMemo(() => {\n    const instances = alertGroups.flatMap((group) => group.alerts);\n    return groupBy(instances, (instance) => instance.status.state);\n  }, [alertGroups]);\n\n  const modalElement = useMemo(\n    () => (\n      <Modal\n        isOpen={showModal}\n        onDismiss={handleDismiss}\n        closeOnBackdropClick={true}\n        closeOnEscape={true}\n        title={\n          <Stack direction=\"row\" alignItems=\"center\" gap={1} wrap={'wrap'}>\n            <Stack direction=\"row\" alignItems=\"center\" gap={0.5}>\n              <Icon name=\"x\" /> <Trans i18nKey=\"alerting.policies.matchers\">Matchers</Trans>\n            </Stack>\n            <Matchers matchers={matchers} formatter={formatter} />\n          </Stack>\n        }\n      >\n        <Stack direction=\"column\">\n          <AlertGroupsSummary\n            active={instancesByState[AlertState.Active]?.length}\n            suppressed={instancesByState[AlertState.Suppressed]?.length}\n            unprocessed={instancesByState[AlertState.Unprocessed]?.length}\n          />\n          <div>\n            {alertGroups.map((group, index) => (\n              <AlertGroup key={index} alertManagerSourceName={alertManagerSourceName} group={group} />\n            ))}\n          </div>\n        </Stack>\n        <Modal.ButtonRow>\n          <Button type=\"button\" variant=\"secondary\" onClick={handleDismiss}>\n            <Trans i18nKey=\"alerting.common.cancel\">Cancel</Trans>\n          </Button>\n        </Modal.ButtonRow>\n      </Modal>\n    ),\n    [alertGroups, handleDismiss, instancesByState, matchers, formatter, showModal, alertManagerSourceName]\n  );\n\n  return [modalElement, handleShow, handleDismiss];\n};\n\nconst UpdatingModal: FC<Pick<ModalProps, 'isOpen'>> = ({ isOpen }) => (\n  <Modal\n    isOpen={isOpen}\n    onDismiss={() => {}}\n    closeOnBackdropClick={false}\n    closeOnEscape={false}\n    title={\n      <Stack direction=\"row\" alignItems=\"center\" gap={0.5}>\n        <Trans i18nKey=\"alerting.policies.update.updating\">Updating...</Trans> <Spinner inline />\n      </Stack>\n    }\n  >\n    <Trans i18nKey=\"alerting.policies.update.please-wait\">\n      Please wait while we update your notification policies.\n    </Trans>\n  </Modal>\n);\n\nexport { useAddPolicyModal, useAlertGroupsModal, useDeletePolicyModal, useEditPolicyModal };\n","import { defaults } from 'lodash';\nimport { useEffect, useMemo, useState } from 'react';\nimport { useAsyncFn } from 'react-use';\n\nimport { Trans, t } from '@grafana/i18n';\nimport { Alert, Button, Stack } from '@grafana/ui';\nimport { useAppNotification } from 'app/core/copy/appNotification';\nimport { useContactPointsWithStatus } from 'app/features/alerting/unified/components/contact-points/useContactPoints';\nimport { AlertmanagerAction, useAlertmanagerAbility } from 'app/features/alerting/unified/hooks/useAbilities';\nimport { FormAmRoute } from 'app/features/alerting/unified/types/amroutes';\nimport { addUniqueIdentifierToRoute } from 'app/features/alerting/unified/utils/amroutes';\nimport { getErrorCode, stringifyErrorLike } from 'app/features/alerting/unified/utils/misc';\nimport { computeInheritedTree } from 'app/features/alerting/unified/utils/notification-policies';\nimport { ObjectMatcher, ROUTES_META_SYMBOL, RouteWithID } from 'app/plugins/datasource/alertmanager/types';\n\nimport { anyOfRequestState, isError } from '../../hooks/useAsync';\nimport { useAlertmanager } from '../../state/AlertmanagerContext';\nimport { ERROR_NEWER_CONFIGURATION } from '../../utils/k8s/errors';\n\nimport { alertmanagerApi } from './../../api/alertmanagerApi';\nimport { useGetContactPointsState } from './../../api/receiversApi';\nimport { useRouteGroupsMatcher } from './../../useRouteGroupsMatcher';\nimport { InsertPosition } from './../../utils/routeTree';\nimport { NotificationPoliciesFilter, findRoutesByMatchers, findRoutesMatchingPredicate } from './Filters';\nimport { useAddPolicyModal, useAlertGroupsModal, useDeletePolicyModal, useEditPolicyModal } from './Modals';\nimport { Policy } from './Policy';\nimport { TIMING_OPTIONS_DEFAULTS } from './timingOptions';\nimport {\n  useAddNotificationPolicy,\n  useDeleteNotificationPolicy,\n  useNotificationPolicyRoute,\n  useUpdateExistingNotificationPolicy,\n} from './useNotificationPolicyRoute';\n\nexport const NotificationPoliciesList = () => {\n  const appNotification = useAppNotification();\n  const [contactPointsSupported, canSeeContactPoints] = useAlertmanagerAbility(AlertmanagerAction.ViewContactPoint);\n\n  const [_, canSeeAlertGroups] = useAlertmanagerAbility(AlertmanagerAction.ViewAlertGroups);\n  const { useGetAlertmanagerAlertGroupsQuery } = alertmanagerApi;\n\n  const [contactPointFilter, setContactPointFilter] = useState<string | undefined>();\n  const [labelMatchersFilter, setLabelMatchersFilter] = useState<ObjectMatcher[]>([]);\n\n  const { selectedAlertmanager, hasConfigurationAPI, isGrafanaAlertmanager } = useAlertmanager();\n  const { getRouteGroupsMap } = useRouteGroupsMatcher();\n\n  const shouldFetchContactPoints = contactPointsSupported && canSeeContactPoints;\n  const contactPointsState = useGetContactPointsState(\n    // Workaround to not try and call this API when we don't have access to the policies tab\n    shouldFetchContactPoints ? (selectedAlertmanager ?? '') : ''\n  );\n\n  const {\n    currentData,\n    isLoading,\n    error: fetchPoliciesError,\n    refetch: refetchNotificationPolicyRoute,\n  } = useNotificationPolicyRoute({ alertmanager: selectedAlertmanager ?? '' });\n\n  // We make the assumption that the first policy is the default one\n  // At the time of writing, this will be always the case for the AM config response, and the K8S API\n  // TODO in the future: Generalise the component to support any number of \"root\" policies\n  const [defaultPolicy] = currentData ?? [];\n\n  // deleting policies\n  const [deleteNotificationPolicy, deleteNotificationPolicyState] = useDeleteNotificationPolicy({\n    alertmanager: selectedAlertmanager ?? '',\n  });\n\n  // updating policies\n  const [updateExistingNotificationPolicy, updateExistingNotificationPolicyState] = useUpdateExistingNotificationPolicy(\n    {\n      alertmanager: selectedAlertmanager ?? '',\n    }\n  );\n\n  // adding new policies\n  const [addNotificationPolicy, addNotificationPolicyState] = useAddNotificationPolicy({\n    alertmanager: selectedAlertmanager ?? '',\n  });\n\n  const { currentData: alertGroups, refetch: refetchAlertGroups } = useGetAlertmanagerAlertGroupsQuery(\n    { amSourceName: selectedAlertmanager ?? '' },\n    { skip: !canSeeAlertGroups || !selectedAlertmanager }\n  );\n\n  const { contactPoints: receivers } = useContactPointsWithStatus({\n    alertmanager: selectedAlertmanager ?? '',\n    fetchPolicies: false,\n    fetchStatuses: true,\n    skip: !shouldFetchContactPoints,\n  });\n\n  const rootRoute = useMemo(() => {\n    if (defaultPolicy) {\n      return addUniqueIdentifierToRoute(defaultPolicy);\n    }\n    return;\n  }, [defaultPolicy]);\n\n  // useAsync could also work but it's hard to wait until it's done in the tests\n  // Combining with useEffect gives more predictable results because the condition is in useEffect\n  const [{ value: routeAlertGroupsMap, error: instancesPreviewError }, triggerGetRouteGroupsMap] = useAsyncFn(\n    getRouteGroupsMap,\n    [getRouteGroupsMap]\n  );\n\n  useEffect(() => {\n    if (rootRoute && alertGroups) {\n      triggerGetRouteGroupsMap(rootRoute, alertGroups, { unquoteMatchers: !isGrafanaAlertmanager });\n    }\n  }, [rootRoute, alertGroups, triggerGetRouteGroupsMap, isGrafanaAlertmanager]);\n\n  // these are computed from the contactPoint and labels matchers filter\n  const routesMatchingFilters = useMemo(() => {\n    if (!rootRoute) {\n      const emptyResult: RoutesMatchingFilters = {\n        filtersApplied: false,\n        matchedRoutesWithPath: new Map(),\n      };\n\n      return emptyResult;\n    }\n\n    return findRoutesMatchingFilters(rootRoute, { contactPointFilter, labelMatchersFilter });\n  }, [contactPointFilter, labelMatchersFilter, rootRoute]);\n\n  const refetchPolicies = () => {\n    refetchNotificationPolicyRoute();\n    updateExistingNotificationPolicy.reset();\n    deleteNotificationPolicy.reset();\n    addNotificationPolicy.reset();\n  };\n\n  async function handleUpdate(partialRoute: Partial<FormAmRoute>) {\n    await updateExistingNotificationPolicy.execute(partialRoute);\n    handleActionResult({ error: updateExistingNotificationPolicyState.error });\n  }\n\n  async function handleDelete(route: RouteWithID) {\n    await deleteNotificationPolicy.execute(route.id);\n    handleActionResult({ error: deleteNotificationPolicyState.error });\n  }\n\n  async function handleAdd(\n    partialRoute: Partial<FormAmRoute>,\n    referenceRoute: RouteWithID,\n    insertPosition: InsertPosition\n  ) {\n    await addNotificationPolicy.execute({\n      partialRoute,\n      referenceRouteIdentifier: referenceRoute.id,\n      insertPosition,\n    });\n    handleActionResult({ error: addNotificationPolicyState.error });\n  }\n\n  function handleActionResult({ error }: { error?: Error }) {\n    if (!error) {\n      appNotification.success('Updated notification policies');\n    }\n    if (selectedAlertmanager) {\n      refetchAlertGroups();\n    }\n\n    // close all modals\n    closeEditModal();\n    closeAddModal();\n    closeDeleteModal();\n  }\n\n  const updatingTree = anyOfRequestState(\n    updateExistingNotificationPolicyState,\n    deleteNotificationPolicyState,\n    addNotificationPolicyState\n  ).loading;\n\n  // edit, add, delete modals\n  const [addModal, openAddModal, closeAddModal] = useAddPolicyModal(handleAdd, updatingTree);\n  const [editModal, openEditModal, closeEditModal] = useEditPolicyModal(\n    selectedAlertmanager ?? '',\n    handleUpdate,\n    updatingTree\n  );\n  const [deleteModal, openDeleteModal, closeDeleteModal] = useDeletePolicyModal(handleDelete, updatingTree);\n  const [alertInstancesModal, showAlertGroupsModal] = useAlertGroupsModal(selectedAlertmanager ?? '');\n\n  if (!selectedAlertmanager) {\n    return null;\n  }\n\n  const hasPoliciesData = rootRoute && !fetchPoliciesError && !isLoading;\n  const hasPoliciesError = Boolean(fetchPoliciesError) && !isLoading;\n  const hasConflictError = [\n    addNotificationPolicyState,\n    updateExistingNotificationPolicyState,\n    deleteNotificationPolicyState,\n  ].some((state) => isError(state) && getErrorCode(state.error) === ERROR_NEWER_CONFIGURATION);\n\n  return (\n    <>\n      {hasPoliciesError && (\n        <Alert\n          severity=\"error\"\n          title={t(\n            'alerting.notification-policies-list.title-error-loading-alertmanager-config',\n            'Error loading Alertmanager config'\n          )}\n        >\n          {stringifyErrorLike(fetchPoliciesError) || 'Unknown error.'}\n        </Alert>\n      )}\n      {/* show when there is an update error */}\n      {hasConflictError && (\n        <Alert\n          severity=\"info\"\n          title={t(\n            'alerting.notification-policies-list.title-notification-policies-have-changed',\n            'Notification policies have changed'\n          )}\n        >\n          <Stack direction=\"row\" justifyContent=\"space-between\" alignItems=\"center\">\n            <Trans i18nKey=\"alerting.policies.update-errors.conflict\">\n              The notification policy tree has been updated by another user.\n            </Trans>\n            <Button onClick={refetchPolicies}>\n              <Trans i18nKey=\"alerting.policies.reload-policies\">Reload policies</Trans>\n            </Button>\n          </Stack>\n        </Alert>\n      )}\n      {hasPoliciesData && (\n        <Stack direction=\"column\" gap={1}>\n          <NotificationPoliciesFilter\n            onChangeMatchers={setLabelMatchersFilter}\n            onChangeReceiver={setContactPointFilter}\n            matchingCount={routesMatchingFilters.matchedRoutesWithPath.size}\n          />\n          <Policy\n            receivers={receivers}\n            // add the timing defaults to the default policy to make sure child policies inherit properly\n            currentRoute={defaults(rootRoute, TIMING_OPTIONS_DEFAULTS)}\n            contactPointsState={contactPointsState.receivers}\n            readOnly={!hasConfigurationAPI}\n            provisioned={rootRoute[ROUTES_META_SYMBOL]?.provisioned}\n            alertManagerSourceName={selectedAlertmanager}\n            onAddPolicy={openAddModal}\n            onEditPolicy={openEditModal}\n            onDeletePolicy={openDeleteModal}\n            onShowAlertInstances={showAlertGroupsModal}\n            routesMatchingFilters={routesMatchingFilters}\n            matchingInstancesPreview={{\n              groupsMap: routeAlertGroupsMap,\n              enabled: Boolean(canSeeAlertGroups && !instancesPreviewError),\n            }}\n            isAutoGenerated={false}\n            isDefaultPolicy\n          />\n        </Stack>\n      )}\n      {addModal}\n      {editModal}\n      {deleteModal}\n      {alertInstancesModal}\n    </>\n  );\n};\n\ntype RouteFilters = {\n  contactPointFilter?: string;\n  labelMatchersFilter?: ObjectMatcher[];\n};\n\ntype FilterResult = Map<RouteWithID, RouteWithID[]>;\n\nexport interface RoutesMatchingFilters {\n  filtersApplied: boolean;\n  matchedRoutesWithPath: FilterResult;\n}\n\nexport const findRoutesMatchingFilters = (rootRoute: RouteWithID, filters: RouteFilters): RoutesMatchingFilters => {\n  const { contactPointFilter, labelMatchersFilter = [] } = filters;\n  const hasFilter = contactPointFilter || labelMatchersFilter.length > 0;\n  const havebothFilters = Boolean(contactPointFilter) && labelMatchersFilter.length > 0;\n\n  // if filters are empty we short-circuit this function\n  if (!hasFilter) {\n    return { filtersApplied: false, matchedRoutesWithPath: new Map() };\n  }\n\n  // we'll collect all of the routes matching the filters\n  // we track an array of matching routes, each item in the array is for 1 type of filter\n  //\n  // [contactPointMatches, labelMatcherMatches] -> [[{ a: [], b: [] }], [{ a: [], c: [] }]]\n  // later we'll use intersection to find results in all sets of filter matchers\n  const matchedRoutes: RouteWithID[][] = [];\n\n  // compute fully inherited tree so all policies have their inherited receiver\n  const fullRoute = computeInheritedTree(rootRoute);\n\n  // find all routes for our contact point filter\n  const matchingRoutesForContactPoint = contactPointFilter\n    ? findRoutesMatchingPredicate(fullRoute, (route) => route.receiver === contactPointFilter)\n    : new Map();\n\n  const routesMatchingContactPoint = Array.from(matchingRoutesForContactPoint.keys());\n  if (routesMatchingContactPoint) {\n    matchedRoutes.push(routesMatchingContactPoint);\n  }\n\n  // find all routes matching our label matchers\n  const matchingRoutesForLabelMatchers = labelMatchersFilter.length\n    ? findRoutesMatchingPredicate(fullRoute, (route) => findRoutesByMatchers(route, labelMatchersFilter))\n    : new Map();\n\n  const routesMatchingLabelFilters = Array.from(matchingRoutesForLabelMatchers.keys());\n  if (matchingRoutesForLabelMatchers.size > 0) {\n    matchedRoutes.push(routesMatchingLabelFilters);\n  }\n\n  // now that we have our maps for all filters, we just need to find the intersection of all maps by route if we have both filters\n  const routesForAllFilterResults = havebothFilters\n    ? findMapIntersection(matchingRoutesForLabelMatchers, matchingRoutesForContactPoint)\n    : new Map([...matchingRoutesForLabelMatchers, ...matchingRoutesForContactPoint]);\n\n  return {\n    filtersApplied: true,\n    matchedRoutesWithPath: routesForAllFilterResults,\n  };\n};\n\n// this function takes multiple maps and creates a new map with routes that exist in all maps\n//\n// map 1: { a: [], b: [] }\n// map 2: { a: [], c: [] }\n// return: { a: [] }\nfunction findMapIntersection(...matchingRoutes: FilterResult[]): FilterResult {\n  const result = new Map<RouteWithID, RouteWithID[]>();\n\n  // Iterate through the keys of the first map'\n  for (const key of matchingRoutes[0].keys()) {\n    // Check if the key exists in all other maps\n    if (matchingRoutes.every((map) => map.has(key))) {\n      // If yes, add the key to the result map\n      // @ts-ignore\n      result.set(key, matchingRoutes[0].get(key));\n    }\n  }\n\n  return result;\n}\n","import { useState } from 'react';\n\nimport { t } from '@grafana/i18n';\nimport { LoadingPlaceholder } from '@grafana/ui';\n\nimport { alertRuleApi } from '../../api/alertRuleApi';\n\nimport { FileExportPreview } from './FileExportPreview';\nimport { GrafanaExportDrawer } from './GrafanaExportDrawer';\nimport { ExportFormats, allGrafanaExportProviders } from './providers';\ninterface MuteTimingsExporterPreviewProps {\n  exportFormat: ExportFormats;\n  onClose: () => void;\n}\n\nconst GrafanaMuteTimingsExporterPreview = ({ exportFormat, onClose }: MuteTimingsExporterPreviewProps) => {\n  const { currentData: muteTimingsDefinition = '', isFetching } = alertRuleApi.useExportMuteTimingsQuery({\n    format: exportFormat,\n  });\n\n  const downloadFileName = `mute-timings-${new Date().getTime()}`;\n\n  if (isFetching) {\n    return (\n      <LoadingPlaceholder text={t('alerting.grafana-mute-timings-exporter-preview.text-loading', 'Loading....')} />\n    );\n  }\n  return (\n    <FileExportPreview\n      format={exportFormat}\n      textDefinition={muteTimingsDefinition}\n      downloadFileName={downloadFileName}\n      onClose={onClose}\n    />\n  );\n};\n\ninterface GrafanaMuteTimingExporterPreviewProps extends MuteTimingsExporterPreviewProps {\n  muteTimingName: string;\n}\nconst GrafanaMuteTimingExporterPreview = ({\n  exportFormat,\n  onClose,\n  muteTimingName,\n}: GrafanaMuteTimingExporterPreviewProps) => {\n  const { currentData: muteTimingsDefinition = '', isFetching } = alertRuleApi.useExportMuteTimingQuery({\n    format: exportFormat,\n    muteTiming: muteTimingName,\n  });\n\n  const downloadFileName = `mute-timing-${muteTimingName}-${new Date().getTime()}`;\n\n  if (isFetching) {\n    return <LoadingPlaceholder text={t('alerting.grafana-mute-timing-exporter-preview.text-loading', 'Loading....')} />;\n  }\n  return (\n    <FileExportPreview\n      format={exportFormat}\n      textDefinition={muteTimingsDefinition}\n      downloadFileName={downloadFileName}\n      onClose={onClose}\n    />\n  );\n};\ninterface GrafanaMuteTimingsExporterProps {\n  onClose: () => void;\n  muteTimingName?: string;\n}\n\nexport const GrafanaMuteTimingsExporter = ({ onClose, muteTimingName }: GrafanaMuteTimingsExporterProps) => {\n  const [activeTab, setActiveTab] = useState<ExportFormats>('yaml');\n  return (\n    <GrafanaExportDrawer\n      activeTab={activeTab}\n      onTabChange={setActiveTab}\n      onClose={onClose}\n      formatProviders={Object.values(allGrafanaExportProviders)}\n    >\n      {muteTimingName ? (\n        <GrafanaMuteTimingExporterPreview exportFormat={activeTab} onClose={onClose} muteTimingName={muteTimingName} />\n      ) : (\n        <GrafanaMuteTimingsExporterPreview exportFormat={activeTab} onClose={onClose} />\n      )}\n    </GrafanaExportDrawer>\n  );\n};\n","import { useCallback, useMemo, useState } from 'react';\nimport { useToggle } from 'react-use';\n\nimport { GrafanaMuteTimingsExporter } from '../export/GrafanaMuteTimingsExporter';\n\nexport const ALL_MUTE_TIMINGS = Symbol('all mute timings');\n\ntype ExportProps = [JSX.Element | null, (muteTiming: string | typeof ALL_MUTE_TIMINGS) => void];\n\nexport const useExportMuteTimingsDrawer = (): ExportProps => {\n  const [muteTimingName, setMuteTimingName] = useState<string | typeof ALL_MUTE_TIMINGS | null>(null);\n  const [isExportDrawerOpen, toggleShowExportDrawer] = useToggle(false);\n\n  const handleClose = useCallback(() => {\n    setMuteTimingName(null);\n    toggleShowExportDrawer(false);\n  }, [toggleShowExportDrawer]);\n\n  const handleOpen = (muteTimingName: string | typeof ALL_MUTE_TIMINGS) => {\n    setMuteTimingName(muteTimingName);\n    toggleShowExportDrawer(true);\n  };\n\n  const drawer = useMemo(() => {\n    if (!muteTimingName || !isExportDrawerOpen) {\n      return null;\n    }\n\n    if (muteTimingName === ALL_MUTE_TIMINGS) {\n      // use this drawer when we want to export all mute timings\n      return <GrafanaMuteTimingsExporter onClose={handleClose} />;\n    } else {\n      // use this one for exporting a single mute timing\n      return <GrafanaMuteTimingsExporter muteTimingName={muteTimingName} onClose={handleClose} />;\n    }\n  }, [isExportDrawerOpen, handleClose, muteTimingName]);\n\n  return [drawer, handleOpen];\n};\n","import { useState } from 'react';\n\nimport { Trans, t } from '@grafana/i18n';\nimport { Badge, ConfirmModal, LinkButton, Stack } from '@grafana/ui';\nimport { useExportMuteTimingsDrawer } from 'app/features/alerting/unified/components/mute-timings/useExportMuteTimingsDrawer';\n\nimport { Authorize } from '../../components/Authorize';\nimport { AlertmanagerAction, useAlertmanagerAbility } from '../../hooks/useAbilities';\nimport { isLoading } from '../../hooks/useAsync';\nimport { GRAFANA_RULES_SOURCE_NAME } from '../../utils/datasource';\nimport { makeAMLink } from '../../utils/misc';\nimport { isDisabled } from '../../utils/mute-timings';\n\nimport { MuteTiming, useDeleteMuteTiming } from './useMuteTimings';\n\ninterface MuteTimingActionsButtonsProps {\n  muteTiming: MuteTiming;\n  alertManagerSourceName: string;\n}\n\nexport const MuteTimingActionsButtons = ({ muteTiming, alertManagerSourceName }: MuteTimingActionsButtonsProps) => {\n  const [deleteMuteTiming, deleteMuteTimingRequestState] = useDeleteMuteTiming({\n    alertmanager: alertManagerSourceName!,\n  });\n  const [showDeleteDrawer, setShowDeleteDrawer] = useState(false);\n  const [ExportDrawer, showExportDrawer] = useExportMuteTimingsDrawer();\n  const [exportSupported, exportAllowed] = useAlertmanagerAbility(AlertmanagerAction.ExportTimeIntervals);\n\n  const closeDeleteModal = () => setShowDeleteDrawer(false);\n\n  const isGrafanaDataSource = alertManagerSourceName === GRAFANA_RULES_SOURCE_NAME;\n  const viewOrEditHref = makeAMLink(`/alerting/routes/mute-timing/edit`, alertManagerSourceName, {\n    muteName: muteTiming.id,\n  });\n\n  const viewOrEditButton = (\n    <LinkButton\n      href={viewOrEditHref}\n      variant=\"secondary\"\n      size=\"sm\"\n      icon={muteTiming.provisioned ? 'eye' : 'pen'}\n      disabled={isLoading(deleteMuteTimingRequestState)}\n    >\n      {muteTiming.provisioned ? (\n        <Trans i18nKey=\"alerting.common.view\">View</Trans>\n      ) : (\n        <Trans i18nKey=\"alerting.common.edit\">Edit</Trans>\n      )}\n    </LinkButton>\n  );\n\n  return (\n    <>\n      <Stack direction=\"row\" alignItems=\"center\" justifyContent=\"flex-end\" wrap=\"wrap\">\n        {!isGrafanaDataSource && isDisabled(muteTiming) && (\n          <Badge text={t('alerting.mute-timing-actions-buttons.text-disabled', 'Disabled')} color=\"orange\" />\n        )}\n        <Authorize actions={[AlertmanagerAction.UpdateTimeInterval]}>{viewOrEditButton}</Authorize>\n\n        {exportSupported && (\n          <LinkButton\n            icon=\"download-alt\"\n            variant=\"secondary\"\n            size=\"sm\"\n            data-testid=\"export\"\n            disabled={!exportAllowed || isLoading(deleteMuteTimingRequestState)}\n            onClick={() => showExportDrawer(muteTiming.name)}\n          >\n            <Trans i18nKey=\"alerting.common.export\">Export</Trans>\n          </LinkButton>\n        )}\n\n        {!muteTiming.provisioned && (\n          <Authorize actions={[AlertmanagerAction.DeleteTimeInterval]}>\n            <LinkButton\n              icon=\"trash-alt\"\n              variant=\"secondary\"\n              size=\"sm\"\n              onClick={() => setShowDeleteDrawer(true)}\n              disabled={isLoading(deleteMuteTimingRequestState)}\n            >\n              <Trans i18nKey=\"alerting.common.delete\">Delete</Trans>\n            </LinkButton>\n          </Authorize>\n        )}\n      </Stack>\n      <ConfirmModal\n        isOpen={showDeleteDrawer}\n        title={t('alerting.mute-timing-actions-buttons.title-delete-mute-timing', 'Delete mute timing')}\n        body={t(\n          'alerting.mute-timing-actions-button.body-delete-mute-timing',\n          'Are you sure you would like to delete \"{{muteTiming}}\"?',\n          { muteTiming: muteTiming.name }\n        )}\n        confirmText={t('alerting.common.delete', 'Delete')}\n        onConfirm={async () => {\n          await deleteMuteTiming.execute({\n            name: muteTiming?.metadata?.name ?? muteTiming.name,\n          });\n\n          closeDeleteModal();\n        }}\n        onDismiss={closeDeleteModal}\n      />\n      {ExportDrawer}\n    </>\n  );\n};\n","import { css } from '@emotion/css';\nimport { ButtonHTMLAttributes } from 'react';\n\nimport { GrafanaTheme2 } from '@grafana/data';\nimport { Button, ButtonVariant, IconName, LinkButton, useStyles2 } from '@grafana/ui';\n\nimport { EmptyArea } from './EmptyArea';\n\nexport interface EmptyAreaWithCTAProps {\n  buttonLabel: string;\n  href?: string;\n  onButtonClick?: ButtonHTMLAttributes<HTMLButtonElement>['onClick'];\n  text: string;\n\n  buttonIcon?: IconName;\n  buttonSize?: 'xs' | 'sm' | 'md' | 'lg';\n  buttonVariant?: ButtonVariant;\n  showButton?: boolean;\n}\n\nexport const EmptyAreaWithCTA = ({\n  buttonIcon,\n  buttonLabel,\n  buttonSize = 'lg',\n  buttonVariant = 'primary',\n  onButtonClick,\n  text,\n  href,\n  showButton = true,\n}: EmptyAreaWithCTAProps) => {\n  const styles = useStyles2(getStyles);\n\n  const commonProps = {\n    className: styles.button,\n    icon: buttonIcon,\n    size: buttonSize,\n    variant: buttonVariant,\n  };\n\n  return (\n    <EmptyArea>\n      <>\n        <p className={styles.text}>{text}</p>\n        {showButton &&\n          (href ? (\n            <LinkButton href={href} type=\"button\" {...commonProps}>\n              {buttonLabel}\n            </LinkButton>\n          ) : (\n            <Button onClick={onButtonClick} type=\"button\" {...commonProps}>\n              {buttonLabel}\n            </Button>\n          ))}\n      </>\n    </EmptyArea>\n  );\n};\n\nconst getStyles = (theme: GrafanaTheme2) => {\n  return {\n    container: css({\n      backgroundColor: theme.colors.background.secondary,\n      color: theme.colors.text.secondary,\n      padding: theme.spacing(4),\n      textAlign: 'center',\n    }),\n    text: css({\n      marginBottom: theme.spacing(2),\n    }),\n    button: css({\n      margin: theme.spacing(2, 0, 1),\n    }),\n  };\n};\n","import { css } from '@emotion/css';\nimport { useMemo } from 'react';\n\nimport { GrafanaTheme2 } from '@grafana/data';\nimport { Trans, t } from '@grafana/i18n';\nimport { Alert, Button, LinkButton, LoadingPlaceholder, Stack, useStyles2 } from '@grafana/ui';\nimport { MuteTimingActionsButtons } from 'app/features/alerting/unified/components/mute-timings/MuteTimingActionsButtons';\nimport {\n  ALL_MUTE_TIMINGS,\n  useExportMuteTimingsDrawer,\n} from 'app/features/alerting/unified/components/mute-timings/useExportMuteTimingsDrawer';\nimport { useAlertmanager } from 'app/features/alerting/unified/state/AlertmanagerContext';\nimport { PROVENANCE_ANNOTATION } from 'app/features/alerting/unified/utils/k8s/constants';\n\nimport { Authorize } from '../../components/Authorize';\nimport { AlertmanagerAction, useAlertmanagerAbilities, useAlertmanagerAbility } from '../../hooks/useAbilities';\nimport { makeAMLink } from '../../utils/misc';\nimport { DynamicTable, DynamicTableColumnProps } from '../DynamicTable';\nimport { EmptyAreaWithCTA } from '../EmptyAreaWithCTA';\nimport { ProvisioningBadge } from '../Provisioning';\nimport { Spacer } from '../Spacer';\n\nimport { MuteTiming, useMuteTimings } from './useMuteTimings';\nimport { renderTimeIntervals } from './util';\n\ntype TableItem = {\n  id: string;\n  data: MuteTiming;\n};\n\nexport const TimeIntervalsTable = () => {\n  const { selectedAlertmanager: alertManagerSourceName = '', hasConfigurationAPI } = useAlertmanager();\n  const hideActions = !hasConfigurationAPI;\n  const styles = useStyles2(getStyles);\n  const [ExportAllDrawer, showExportAllDrawer] = useExportMuteTimingsDrawer();\n\n  const { data, isLoading, error } = useMuteTimings({ alertmanager: alertManagerSourceName ?? '' });\n\n  const items = useMemo((): TableItem[] => {\n    const muteTimings = data || [];\n\n    return muteTimings.map((mute) => {\n      return {\n        id: mute.id,\n        data: mute,\n      };\n    });\n  }, [data]);\n\n  const [_, allowedToCreateMuteTiming] = useAlertmanagerAbility(AlertmanagerAction.CreateTimeInterval);\n\n  const [exportMuteTimingsSupported, exportMuteTimingsAllowed] = useAlertmanagerAbility(\n    AlertmanagerAction.ExportTimeIntervals\n  );\n  const columns = useColumns(alertManagerSourceName, hideActions);\n\n  if (isLoading) {\n    return (\n      <LoadingPlaceholder\n        text={t('alerting.time-intervals-table.text-loading-time-intervals', 'Loading time intervals...')}\n      />\n    );\n  }\n\n  if (error) {\n    return (\n      <Alert severity=\"error\" title={t('alerting.time-intervals.error-loading.title', 'Error loading time intervals')}>\n        <Trans i18nKey=\"alerting.time-intervals.error-loading.description\">\n          Could not load time intervals. Please try again later.\n        </Trans>\n      </Alert>\n    );\n  }\n\n  return (\n    <div className={styles.container}>\n      <Stack direction=\"row\" alignItems=\"center\">\n        <Trans i18nKey=\"alerting.time-intervals.description\">\n          Enter specific time intervals when not to send notifications or freeze notifications for recurring periods of\n          time.\n        </Trans>\n        <Spacer />\n        {!hideActions && items.length > 0 && (\n          <Authorize actions={[AlertmanagerAction.CreateTimeInterval]}>\n            <LinkButton\n              className={styles.muteTimingsButtons}\n              icon=\"plus\"\n              variant=\"primary\"\n              href={makeAMLink('alerting/routes/mute-timing/new', alertManagerSourceName)}\n            >\n              <Trans i18nKey=\"alerting.time-interval.add-time-interval\">Add time interval</Trans>\n            </LinkButton>\n          </Authorize>\n        )}\n        {exportMuteTimingsSupported && (\n          <>\n            <Button\n              icon=\"download-alt\"\n              className={styles.muteTimingsButtons}\n              variant=\"secondary\"\n              disabled={!exportMuteTimingsAllowed}\n              onClick={() => showExportAllDrawer(ALL_MUTE_TIMINGS)}\n            >\n              <Trans i18nKey=\"alerting.common.export-all\">Export all</Trans>\n            </Button>\n            {ExportAllDrawer}\n          </>\n        )}\n      </Stack>\n      {items.length > 0 ? <DynamicTable items={items} cols={columns} pagination={{ itemsPerPage: 25 }} /> : null}\n      {items.length === 0 && (\n        <>\n          {!hideActions ? (\n            <EmptyAreaWithCTA\n              text={t(\n                'alerting.time-intervals-table.text-havent-created-time-intervals',\n                \"You haven't created any time intervals yet\"\n              )}\n              buttonLabel=\"Add time interval\"\n              buttonIcon=\"plus\"\n              buttonSize=\"lg\"\n              href={makeAMLink('alerting/routes/mute-timing/new', alertManagerSourceName)}\n              showButton={allowedToCreateMuteTiming}\n            />\n          ) : (\n            <EmptyAreaWithCTA\n              text={t(\n                'alerting.time-intervals-table.text-no-time-intervals-configured',\n                'No time intervals configured'\n              )}\n              buttonLabel={''}\n              showButton={false}\n            />\n          )}\n        </>\n      )}\n    </div>\n  );\n};\n\nfunction useColumns(alertManagerSourceName: string, hideActions = false) {\n  const [[_editSupported, allowedToEdit], [_deleteSupported, allowedToDelete]] = useAlertmanagerAbilities([\n    AlertmanagerAction.UpdateTimeInterval,\n    AlertmanagerAction.DeleteTimeInterval,\n  ]);\n  const showActions = !hideActions && (allowedToEdit || allowedToDelete);\n\n  return useMemo((): Array<DynamicTableColumnProps<MuteTiming>> => {\n    const columns: Array<DynamicTableColumnProps<MuteTiming>> = [\n      {\n        id: 'name',\n        label: t('alerting.use-columns.columns.label.name', 'Name'),\n        renderCell: function renderName({ data }) {\n          return (\n            <div>\n              {data.name}{' '}\n              {data.provisioned && (\n                <ProvisioningBadge tooltip provenance={data.metadata?.annotations?.[PROVENANCE_ANNOTATION]} />\n              )}\n            </div>\n          );\n        },\n        size: 1,\n      },\n      {\n        id: 'timeRange',\n        label: t('alerting.use-columns.columns.label.time-range', 'Time range'),\n        renderCell: ({ data }) => {\n          return renderTimeIntervals(data);\n        },\n        size: 5,\n      },\n    ];\n    if (showActions) {\n      columns.push({\n        id: 'actions',\n        label: t('alerting.use-columns.label.actions', 'Actions'),\n        alignColumn: 'end',\n        renderCell: ({ data }) => (\n          <MuteTimingActionsButtons muteTiming={data} alertManagerSourceName={alertManagerSourceName} />\n        ),\n        size: 2,\n      });\n    }\n    return columns;\n  }, [showActions, alertManagerSourceName]);\n}\n\nconst getStyles = (theme: GrafanaTheme2) => ({\n  container: css({\n    display: 'flex',\n    flexFlow: 'column nowrap',\n  }),\n  muteTimingsButtons: css({\n    marginBottom: theme.spacing(2),\n  }),\n});\n","import { css } from '@emotion/css';\nimport { useState } from 'react';\n\nimport { GrafanaTheme2, UrlQueryMap } from '@grafana/data';\nimport { t } from '@grafana/i18n';\nimport { Tab, TabContent, TabsBar, useStyles2 } from '@grafana/ui';\nimport { useQueryParams } from 'app/core/hooks/useQueryParams';\nimport { useMuteTimings } from 'app/features/alerting/unified/components/mute-timings/useMuteTimings';\nimport { NotificationPoliciesList } from 'app/features/alerting/unified/components/notification-policies/NotificationPoliciesList';\nimport { AlertmanagerAction, useAlertmanagerAbility } from 'app/features/alerting/unified/hooks/useAbilities';\n\nimport { AlertmanagerPageWrapper } from './components/AlertingPageWrapper';\nimport { GrafanaAlertmanagerWarning } from './components/GrafanaAlertmanagerWarning';\nimport { TimeIntervalsTable } from './components/mute-timings/MuteTimingsTable';\nimport { useAlertmanager } from './state/AlertmanagerContext';\nimport { withPageErrorBoundary } from './withPageErrorBoundary';\n\nenum ActiveTab {\n  NotificationPolicies = 'notification_policies',\n  TimeIntervals = 'time_intervals',\n}\n\nconst NotificationPoliciesTabs = () => {\n  const styles = useStyles2(getStyles);\n\n  // Alertmanager logic and data hooks\n  const { selectedAlertmanager = '' } = useAlertmanager();\n  const [policiesSupported, canSeePoliciesTab] = useAlertmanagerAbility(AlertmanagerAction.ViewNotificationPolicyTree);\n  const [timingsSupported, canSeeTimingsTab] = useAlertmanagerAbility(AlertmanagerAction.ViewTimeInterval);\n  const availableTabs = [\n    canSeePoliciesTab && ActiveTab.NotificationPolicies,\n    canSeeTimingsTab && ActiveTab.TimeIntervals,\n  ].filter((tab) => !!tab);\n  const { data: muteTimings = [] } = useMuteTimings({\n    alertmanager: selectedAlertmanager,\n    skip: !canSeeTimingsTab,\n  });\n\n  // Tab state management\n  const [queryParams, setQueryParams] = useQueryParams();\n  const { tab } = getActiveTabFromUrl(queryParams, availableTabs[0]);\n  const [activeTab, setActiveTab] = useState<ActiveTab>(tab);\n\n  const muteTimingsTabActive = activeTab === ActiveTab.TimeIntervals;\n  const policyTreeTabActive = activeTab === ActiveTab.NotificationPolicies;\n\n  const numberOfMuteTimings = muteTimings.length;\n\n  return (\n    <>\n      <GrafanaAlertmanagerWarning currentAlertmanager={selectedAlertmanager} />\n      <TabsBar>\n        {policiesSupported && canSeePoliciesTab && (\n          <Tab\n            label={t('alerting.notification-policies-tabs.label-notification-policies', 'Notification Policies')}\n            active={policyTreeTabActive}\n            onChangeTab={() => {\n              setActiveTab(ActiveTab.NotificationPolicies);\n              setQueryParams({ tab: ActiveTab.NotificationPolicies });\n            }}\n          />\n        )}\n        {timingsSupported && canSeeTimingsTab && (\n          <Tab\n            label={t('alerting.notification-policies-tabs.label-time-intervals', 'Time intervals')}\n            active={muteTimingsTabActive}\n            counter={numberOfMuteTimings}\n            onChangeTab={() => {\n              setActiveTab(ActiveTab.TimeIntervals);\n              setQueryParams({ tab: ActiveTab.TimeIntervals });\n            }}\n          />\n        )}\n      </TabsBar>\n      <TabContent className={styles.tabContent}>\n        {policyTreeTabActive && <NotificationPoliciesList />}\n        {muteTimingsTabActive && <TimeIntervalsTable />}\n      </TabContent>\n    </>\n  );\n};\n\nconst getStyles = (theme: GrafanaTheme2) => ({\n  tabContent: css({\n    marginTop: theme.spacing(2),\n  }),\n});\n\ninterface QueryParamValues {\n  tab: ActiveTab;\n}\n\nfunction getActiveTabFromUrl(queryParams: UrlQueryMap, defaultTab: ActiveTab): QueryParamValues {\n  let tab = defaultTab;\n\n  if (queryParams.tab === ActiveTab.NotificationPolicies) {\n    tab = ActiveTab.NotificationPolicies;\n  }\n\n  if (queryParams.tab === ActiveTab.TimeIntervals) {\n    tab = ActiveTab.TimeIntervals;\n  }\n\n  return {\n    tab,\n  };\n}\n\nfunction NotificationPoliciesPage() {\n  return (\n    <AlertmanagerPageWrapper navId=\"am-routes\" accessType=\"notification\">\n      <NotificationPoliciesTabs />\n    </AlertmanagerPageWrapper>\n  );\n}\n\nexport default withPageErrorBoundary(NotificationPoliciesPage);\n","import { css } from '@emotion/css';\nimport * as React from 'react';\n\nimport { GrafanaTheme2 } from '@grafana/data';\nimport { useStyles2 } from '@grafana/ui';\n\nexport const EmptyArea = ({ children }: React.PropsWithChildren<{}>) => {\n  const styles = useStyles2(getStyles);\n\n  return <div className={styles.container}>{children}</div>;\n};\n\nconst getStyles = (theme: GrafanaTheme2) => {\n  return {\n    container: css({\n      backgroundColor: theme.colors.background.secondary,\n      color: theme.colors.text.secondary,\n      padding: theme.spacing(4),\n      textAlign: 'center',\n    }),\n  };\n};\n","/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\nconst proxyMarker = Symbol(\"Comlink.proxy\");\nconst createEndpoint = Symbol(\"Comlink.endpoint\");\nconst releaseProxy = Symbol(\"Comlink.releaseProxy\");\nconst finalizer = Symbol(\"Comlink.finalizer\");\nconst throwMarker = Symbol(\"Comlink.thrown\");\nconst isObject = (val) => (typeof val === \"object\" && val !== null) || typeof val === \"function\";\n/**\n * Internal transfer handle to handle objects marked to proxy.\n */\nconst proxyTransferHandler = {\n    canHandle: (val) => isObject(val) && val[proxyMarker],\n    serialize(obj) {\n        const { port1, port2 } = new MessageChannel();\n        expose(obj, port1);\n        return [port2, [port2]];\n    },\n    deserialize(port) {\n        port.start();\n        return wrap(port);\n    },\n};\n/**\n * Internal transfer handler to handle thrown exceptions.\n */\nconst throwTransferHandler = {\n    canHandle: (value) => isObject(value) && throwMarker in value,\n    serialize({ value }) {\n        let serialized;\n        if (value instanceof Error) {\n            serialized = {\n                isError: true,\n                value: {\n                    message: value.message,\n                    name: value.name,\n                    stack: value.stack,\n                },\n            };\n        }\n        else {\n            serialized = { isError: false, value };\n        }\n        return [serialized, []];\n    },\n    deserialize(serialized) {\n        if (serialized.isError) {\n            throw Object.assign(new Error(serialized.value.message), serialized.value);\n        }\n        throw serialized.value;\n    },\n};\n/**\n * Allows customizing the serialization of certain values.\n */\nconst transferHandlers = new Map([\n    [\"proxy\", proxyTransferHandler],\n    [\"throw\", throwTransferHandler],\n]);\nfunction isAllowedOrigin(allowedOrigins, origin) {\n    for (const allowedOrigin of allowedOrigins) {\n        if (origin === allowedOrigin || allowedOrigin === \"*\") {\n            return true;\n        }\n        if (allowedOrigin instanceof RegExp && allowedOrigin.test(origin)) {\n            return true;\n        }\n    }\n    return false;\n}\nfunction expose(obj, ep = globalThis, allowedOrigins = [\"*\"]) {\n    ep.addEventListener(\"message\", function callback(ev) {\n        if (!ev || !ev.data) {\n            return;\n        }\n        if (!isAllowedOrigin(allowedOrigins, ev.origin)) {\n            console.warn(`Invalid origin '${ev.origin}' for comlink proxy`);\n            return;\n        }\n        const { id, type, path } = Object.assign({ path: [] }, ev.data);\n        const argumentList = (ev.data.argumentList || []).map(fromWireValue);\n        let returnValue;\n        try {\n            const parent = path.slice(0, -1).reduce((obj, prop) => obj[prop], obj);\n            const rawValue = path.reduce((obj, prop) => obj[prop], obj);\n            switch (type) {\n                case \"GET\" /* MessageType.GET */:\n                    {\n                        returnValue = rawValue;\n                    }\n                    break;\n                case \"SET\" /* MessageType.SET */:\n                    {\n                        parent[path.slice(-1)[0]] = fromWireValue(ev.data.value);\n                        returnValue = true;\n                    }\n                    break;\n                case \"APPLY\" /* MessageType.APPLY */:\n                    {\n                        returnValue = rawValue.apply(parent, argumentList);\n                    }\n                    break;\n                case \"CONSTRUCT\" /* MessageType.CONSTRUCT */:\n                    {\n                        const value = new rawValue(...argumentList);\n                        returnValue = proxy(value);\n                    }\n                    break;\n                case \"ENDPOINT\" /* MessageType.ENDPOINT */:\n                    {\n                        const { port1, port2 } = new MessageChannel();\n                        expose(obj, port2);\n                        returnValue = transfer(port1, [port1]);\n                    }\n                    break;\n                case \"RELEASE\" /* MessageType.RELEASE */:\n                    {\n                        returnValue = undefined;\n                    }\n                    break;\n                default:\n                    return;\n            }\n        }\n        catch (value) {\n            returnValue = { value, [throwMarker]: 0 };\n        }\n        Promise.resolve(returnValue)\n            .catch((value) => {\n            return { value, [throwMarker]: 0 };\n        })\n            .then((returnValue) => {\n            const [wireValue, transferables] = toWireValue(returnValue);\n            ep.postMessage(Object.assign(Object.assign({}, wireValue), { id }), transferables);\n            if (type === \"RELEASE\" /* MessageType.RELEASE */) {\n                // detach and deactive after sending release response above.\n                ep.removeEventListener(\"message\", callback);\n                closeEndPoint(ep);\n                if (finalizer in obj && typeof obj[finalizer] === \"function\") {\n                    obj[finalizer]();\n                }\n            }\n        })\n            .catch((error) => {\n            // Send Serialization Error To Caller\n            const [wireValue, transferables] = toWireValue({\n                value: new TypeError(\"Unserializable return value\"),\n                [throwMarker]: 0,\n            });\n            ep.postMessage(Object.assign(Object.assign({}, wireValue), { id }), transferables);\n        });\n    });\n    if (ep.start) {\n        ep.start();\n    }\n}\nfunction isMessagePort(endpoint) {\n    return endpoint.constructor.name === \"MessagePort\";\n}\nfunction closeEndPoint(endpoint) {\n    if (isMessagePort(endpoint))\n        endpoint.close();\n}\nfunction wrap(ep, target) {\n    const pendingListeners = new Map();\n    ep.addEventListener(\"message\", function handleMessage(ev) {\n        const { data } = ev;\n        if (!data || !data.id) {\n            return;\n        }\n        const resolver = pendingListeners.get(data.id);\n        if (!resolver) {\n            return;\n        }\n        try {\n            resolver(data);\n        }\n        finally {\n            pendingListeners.delete(data.id);\n        }\n    });\n    return createProxy(ep, pendingListeners, [], target);\n}\nfunction throwIfProxyReleased(isReleased) {\n    if (isReleased) {\n        throw new Error(\"Proxy has been released and is not useable\");\n    }\n}\nfunction releaseEndpoint(ep) {\n    return requestResponseMessage(ep, new Map(), {\n        type: \"RELEASE\" /* MessageType.RELEASE */,\n    }).then(() => {\n        closeEndPoint(ep);\n    });\n}\nconst proxyCounter = new WeakMap();\nconst proxyFinalizers = \"FinalizationRegistry\" in globalThis &&\n    new FinalizationRegistry((ep) => {\n        const newCount = (proxyCounter.get(ep) || 0) - 1;\n        proxyCounter.set(ep, newCount);\n        if (newCount === 0) {\n            releaseEndpoint(ep);\n        }\n    });\nfunction registerProxy(proxy, ep) {\n    const newCount = (proxyCounter.get(ep) || 0) + 1;\n    proxyCounter.set(ep, newCount);\n    if (proxyFinalizers) {\n        proxyFinalizers.register(proxy, ep, proxy);\n    }\n}\nfunction unregisterProxy(proxy) {\n    if (proxyFinalizers) {\n        proxyFinalizers.unregister(proxy);\n    }\n}\nfunction createProxy(ep, pendingListeners, path = [], target = function () { }) {\n    let isProxyReleased = false;\n    const proxy = new Proxy(target, {\n        get(_target, prop) {\n            throwIfProxyReleased(isProxyReleased);\n            if (prop === releaseProxy) {\n                return () => {\n                    unregisterProxy(proxy);\n                    releaseEndpoint(ep);\n                    pendingListeners.clear();\n                    isProxyReleased = true;\n                };\n            }\n            if (prop === \"then\") {\n                if (path.length === 0) {\n                    return { then: () => proxy };\n                }\n                const r = requestResponseMessage(ep, pendingListeners, {\n                    type: \"GET\" /* MessageType.GET */,\n                    path: path.map((p) => p.toString()),\n                }).then(fromWireValue);\n                return r.then.bind(r);\n            }\n            return createProxy(ep, pendingListeners, [...path, prop]);\n        },\n        set(_target, prop, rawValue) {\n            throwIfProxyReleased(isProxyReleased);\n            // FIXME: ES6 Proxy Handler `set` methods are supposed to return a\n            // boolean. To show good will, we return true asynchronously \\_()_/\n            const [value, transferables] = toWireValue(rawValue);\n            return requestResponseMessage(ep, pendingListeners, {\n                type: \"SET\" /* MessageType.SET */,\n                path: [...path, prop].map((p) => p.toString()),\n                value,\n            }, transferables).then(fromWireValue);\n        },\n        apply(_target, _thisArg, rawArgumentList) {\n            throwIfProxyReleased(isProxyReleased);\n            const last = path[path.length - 1];\n            if (last === createEndpoint) {\n                return requestResponseMessage(ep, pendingListeners, {\n                    type: \"ENDPOINT\" /* MessageType.ENDPOINT */,\n                }).then(fromWireValue);\n            }\n            // We just pretend that `bind()` didnt happen.\n            if (last === \"bind\") {\n                return createProxy(ep, pendingListeners, path.slice(0, -1));\n            }\n            const [argumentList, transferables] = processArguments(rawArgumentList);\n            return requestResponseMessage(ep, pendingListeners, {\n                type: \"APPLY\" /* MessageType.APPLY */,\n                path: path.map((p) => p.toString()),\n                argumentList,\n            }, transferables).then(fromWireValue);\n        },\n        construct(_target, rawArgumentList) {\n            throwIfProxyReleased(isProxyReleased);\n            const [argumentList, transferables] = processArguments(rawArgumentList);\n            return requestResponseMessage(ep, pendingListeners, {\n                type: \"CONSTRUCT\" /* MessageType.CONSTRUCT */,\n                path: path.map((p) => p.toString()),\n                argumentList,\n            }, transferables).then(fromWireValue);\n        },\n    });\n    registerProxy(proxy, ep);\n    return proxy;\n}\nfunction myFlat(arr) {\n    return Array.prototype.concat.apply([], arr);\n}\nfunction processArguments(argumentList) {\n    const processed = argumentList.map(toWireValue);\n    return [processed.map((v) => v[0]), myFlat(processed.map((v) => v[1]))];\n}\nconst transferCache = new WeakMap();\nfunction transfer(obj, transfers) {\n    transferCache.set(obj, transfers);\n    return obj;\n}\nfunction proxy(obj) {\n    return Object.assign(obj, { [proxyMarker]: true });\n}\nfunction windowEndpoint(w, context = globalThis, targetOrigin = \"*\") {\n    return {\n        postMessage: (msg, transferables) => w.postMessage(msg, targetOrigin, transferables),\n        addEventListener: context.addEventListener.bind(context),\n        removeEventListener: context.removeEventListener.bind(context),\n    };\n}\nfunction toWireValue(value) {\n    for (const [name, handler] of transferHandlers) {\n        if (handler.canHandle(value)) {\n            const [serializedValue, transferables] = handler.serialize(value);\n            return [\n                {\n                    type: \"HANDLER\" /* WireValueType.HANDLER */,\n                    name,\n                    value: serializedValue,\n                },\n                transferables,\n            ];\n        }\n    }\n    return [\n        {\n            type: \"RAW\" /* WireValueType.RAW */,\n            value,\n        },\n        transferCache.get(value) || [],\n    ];\n}\nfunction fromWireValue(value) {\n    switch (value.type) {\n        case \"HANDLER\" /* WireValueType.HANDLER */:\n            return transferHandlers.get(value.name).deserialize(value.value);\n        case \"RAW\" /* WireValueType.RAW */:\n            return value.value;\n    }\n}\nfunction requestResponseMessage(ep, pendingListeners, msg, transfers) {\n    return new Promise((resolve) => {\n        const id = generateUUID();\n        pendingListeners.set(id, resolve);\n        if (ep.start) {\n            ep.start();\n        }\n        ep.postMessage(Object.assign({ id }, msg), transfers);\n    });\n}\nfunction generateUUID() {\n    return new Array(4)\n        .fill(0)\n        .map(() => Math.floor(Math.random() * Number.MAX_SAFE_INTEGER).toString(16))\n        .join(\"-\");\n}\n\nexport { createEndpoint, expose, finalizer, proxy, proxyMarker, releaseProxy, transfer, transferHandlers, windowEndpoint, wrap };\n//# sourceMappingURL=comlink.mjs.map\n","import { CorsWorker as Worker } from 'app/core/utils/CorsWorker';\n\n// CorsWorker is needed as a workaround for CORS issue caused\n// by static assets served from an url different from origin\nexport const createWorker = () => new Worker(new URL('./routeGroupsMatcher.worker.ts', import.meta.url));\n","import * as comlink from 'comlink';\nimport { useCallback, useEffect } from 'react';\n\nimport { AlertmanagerGroup, RouteWithID } from '../../../plugins/datasource/alertmanager/types';\nimport { Labels } from '../../../types/unified-alerting-dto';\n\nimport { logError, logInfo } from './Analytics';\nimport { createWorker } from './createRouteGroupsMatcherWorker';\nimport type { MatchOptions, RouteGroupsMatcher } from './routeGroupsMatcher';\n\nlet routeMatcher: comlink.Remote<RouteGroupsMatcher> | undefined;\n\n// Load worker loads the worker if it's not loaded yet\n// and returns a function to dispose of the worker\n// We do it to enable feature toggling. If the feature is disabled we don't wont to load the worker code at all\n// An alternative way would be to move all this code to the hook below, but it will create and terminate the worker much more often\nfunction loadWorker() {\n  let worker: Worker | undefined;\n\n  if (routeMatcher === undefined) {\n    try {\n      worker = createWorker();\n      routeMatcher = comlink.wrap<RouteGroupsMatcher>(worker);\n    } catch (e: unknown) {\n      if (e instanceof Error) {\n        logError(e);\n      }\n    }\n  }\n\n  const disposeWorker = () => {\n    if (worker && routeMatcher) {\n      routeMatcher[comlink.releaseProxy]();\n      worker.terminate();\n\n      routeMatcher = undefined;\n      worker = undefined;\n    }\n  };\n\n  return { disposeWorker };\n}\n\nfunction validateWorker(matcher: typeof routeMatcher): asserts matcher is comlink.Remote<RouteGroupsMatcher> {\n  if (!routeMatcher) {\n    throw new Error('Route Matcher has not been initialized');\n  }\n}\n\nexport function useRouteGroupsMatcher() {\n  useEffect(() => {\n    const { disposeWorker } = loadWorker();\n    return disposeWorker;\n  }, []);\n\n  const getRouteGroupsMap = useCallback(\n    async (rootRoute: RouteWithID, alertGroups: AlertmanagerGroup[], options?: MatchOptions) => {\n      validateWorker(routeMatcher);\n\n      const startTime = performance.now();\n\n      const result = await routeMatcher.getRouteGroupsMap(rootRoute, alertGroups, options);\n\n      const timeSpent = performance.now() - startTime;\n\n      logInfo(`Route Groups Matched in  ${timeSpent} ms`, {\n        matchingTime: timeSpent.toString(),\n        alertGroupsCount: alertGroups.length.toString(),\n        // Counting all nested routes might be too time-consuming, so we only count the first level\n        topLevelRoutesCount: rootRoute.routes?.length.toString() ?? '0',\n      });\n\n      return result;\n    },\n    []\n  );\n\n  const matchInstancesToRoute = useCallback(\n    async (rootRoute: RouteWithID, instancesToMatch: Labels[], options?: MatchOptions) => {\n      validateWorker(routeMatcher);\n\n      const startTime = performance.now();\n\n      const result = await routeMatcher.matchInstancesToRoute(rootRoute, instancesToMatch, options);\n\n      const timeSpent = performance.now() - startTime;\n\n      logInfo(`Instances Matched in  ${timeSpent} ms`, {\n        matchingTime: timeSpent.toString(),\n        instancesToMatchCount: instancesToMatch.length.toString(),\n        // Counting all nested routes might be too time-consuming, so we only count the first level\n        topLevelRoutesCount: rootRoute.routes?.length.toString() ?? '0',\n      });\n\n      return result;\n    },\n    []\n  );\n\n  return { getRouteGroupsMap, matchInstancesToRoute };\n}\n","import { css } from '@emotion/css';\n\nimport { GrafanaTheme2 } from '@grafana/data';\nimport { Trans, t } from '@grafana/i18n';\nimport { LinkButton, useStyles2 } from '@grafana/ui';\nimport { contextSrv } from 'app/core/services/context_srv';\nimport { AlertState, AlertmanagerAlert } from 'app/plugins/datasource/alertmanager/types';\nimport { AccessControlAction } from 'app/types/accessControl';\n\nimport { AlertmanagerAction } from '../../hooks/useAbilities';\nimport { isGrafanaRulesSource } from '../../utils/datasource';\nimport { makeAMLink, makeLabelBasedSilenceLink } from '../../utils/misc';\nimport { AnnotationDetailsField } from '../AnnotationDetailsField';\nimport { Authorize } from '../Authorize';\n\ninterface AmNotificationsAlertDetailsProps {\n  alertManagerSourceName: string;\n  alert: AlertmanagerAlert;\n}\n\nexport const AlertDetails = ({ alert, alertManagerSourceName }: AmNotificationsAlertDetailsProps) => {\n  const styles = useStyles2(getStyles);\n\n  // For Grafana Managed alerts the Generator URL redirects to the alert rule edit page, so update permission is required\n  // For external alert manager the Generator URL redirects to an external service which we don't control\n  const isGrafanaSource = isGrafanaRulesSource(alertManagerSourceName);\n  const isSeeSourceButtonEnabled = isGrafanaSource\n    ? contextSrv.hasPermission(AccessControlAction.AlertingRuleRead)\n    : true;\n\n  return (\n    <>\n      <div className={styles.actionsRow}>\n        {alert.status.state === AlertState.Suppressed && (\n          <Authorize actions={[AlertmanagerAction.CreateSilence, AlertmanagerAction.UpdateSilence]}>\n            <LinkButton\n              href={`${makeAMLink(\n                '/alerting/silences',\n                alertManagerSourceName\n              )}&silenceIds=${alert.status.silencedBy.join(',')}`}\n              className={styles.button}\n              icon={'bell'}\n              size={'sm'}\n            >\n              <Trans i18nKey=\"alerting.alert-details.manage-silences\">Manage silences</Trans>\n            </LinkButton>\n          </Authorize>\n        )}\n        {alert.status.state === AlertState.Active && (\n          <Authorize actions={[AlertmanagerAction.CreateSilence]}>\n            <LinkButton\n              href={makeLabelBasedSilenceLink(alertManagerSourceName, alert.labels)}\n              className={styles.button}\n              icon={'bell-slash'}\n              size={'sm'}\n            >\n              <Trans i18nKey=\"alerting.alert-details.silence\">Silence</Trans>\n            </LinkButton>\n          </Authorize>\n        )}\n        {isSeeSourceButtonEnabled && alert.generatorURL && (\n          <LinkButton className={styles.button} href={alert.generatorURL} icon={'chart-line'} size={'sm'}>\n            {isGrafanaSource\n              ? t('alerting.alert-details.button-see-rule', 'See alert rule')\n              : t('alerting.alert-details.button-see-source', 'See source')}\n          </LinkButton>\n        )}\n      </div>\n      {Object.entries(alert.annotations).map(([annotationKey, annotationValue]) => (\n        <AnnotationDetailsField key={annotationKey} annotationKey={annotationKey} value={annotationValue} />\n      ))}\n      <div className={styles.receivers}>\n        <Trans\n          i18nKey=\"alerting.alert-details.receivers-list\"\n          values={{\n            receivers: alert.receivers\n              .map(({ name }) => name)\n              .filter((name) => !!name)\n              .join(', '),\n          }}\n        >\n          Receivers: {'{{receivers}}'}\n        </Trans>\n      </div>\n    </>\n  );\n};\n\nconst getStyles = (theme: GrafanaTheme2) => ({\n  button: css({\n    '& + &': {\n      marginLeft: theme.spacing(1),\n    },\n  }),\n  actionsRow: css({\n    padding: `${theme.spacing(2, 0)} !important`,\n    borderBottom: `1px solid ${theme.colors.border.medium}`,\n  }),\n  receivers: css({\n    padding: theme.spacing(1, 0),\n  }),\n});\n","import { css } from '@emotion/css';\nimport { useMemo } from 'react';\n\nimport { GrafanaTheme2, intervalToAbbreviatedDurationString } from '@grafana/data';\nimport { Trans, t } from '@grafana/i18n';\nimport { useStyles2 } from '@grafana/ui';\nimport { AlertmanagerAlert } from 'app/plugins/datasource/alertmanager/types';\n\nimport { AlertLabels } from '../AlertLabels';\nimport { DynamicTableColumnProps, DynamicTableItemProps } from '../DynamicTable';\nimport { DynamicTableWithGuidelines } from '../DynamicTableWithGuidelines';\nimport { AmAlertStateTag } from '../silences/AmAlertStateTag';\n\nimport { AlertDetails } from './AlertDetails';\n\ninterface Props {\n  alerts: AlertmanagerAlert[];\n  alertManagerSourceName: string;\n}\n\ntype AlertGroupAlertsTableColumnProps = DynamicTableColumnProps<AlertmanagerAlert>;\ntype AlertGroupAlertsTableItemProps = DynamicTableItemProps<AlertmanagerAlert>;\n\nexport const AlertGroupAlertsTable = ({ alerts, alertManagerSourceName }: Props) => {\n  const styles = useStyles2(getStyles);\n\n  const columns = useMemo(\n    (): AlertGroupAlertsTableColumnProps[] => [\n      {\n        id: 'state',\n        label: t('alerting.alert-group-alerts-table.columns.label.notification-state', 'Notification state'),\n        // eslint-disable-next-line react/display-name\n        renderCell: ({ data: alert }) => (\n          <>\n            <AmAlertStateTag state={alert.status.state} />\n            <span className={styles.duration}>\n              <Trans\n                i18nKey=\"alerting.alert-group-alerts-table.duration\"\n                values={{\n                  time: intervalToAbbreviatedDurationString({\n                    start: new Date(alert.startsAt),\n                    end: new Date(alert.endsAt),\n                  }),\n                }}\n              >\n                for {'{{time}}'}\n              </Trans>\n            </span>\n          </>\n        ),\n        size: '220px',\n      },\n      {\n        id: 'labels',\n        label: t('alerting.alert-group-alerts-table.columns.label.instance-labels', 'Instance labels'),\n        // eslint-disable-next-line react/display-name\n        renderCell: ({ data: { labels } }) => <AlertLabels labels={labels} size=\"sm\" />,\n        size: 1,\n      },\n    ],\n    [styles]\n  );\n\n  const items = useMemo(\n    (): AlertGroupAlertsTableItemProps[] =>\n      alerts.map((alert) => ({\n        id: alert.fingerprint,\n        data: alert,\n      })),\n    [alerts]\n  );\n\n  return (\n    <div className={styles.tableWrapper} data-testid=\"alert-group-table\">\n      <DynamicTableWithGuidelines\n        cols={columns}\n        items={items}\n        isExpandable={true}\n        renderExpandedContent={({ data: alert }) => (\n          <AlertDetails alert={alert} alertManagerSourceName={alertManagerSourceName} />\n        )}\n      />\n    </div>\n  );\n};\n\nconst getStyles = (theme: GrafanaTheme2) => ({\n  tableWrapper: css({\n    marginTop: theme.spacing(3),\n    [theme.breakpoints.up('md')]: {\n      marginLeft: theme.spacing(4.5),\n    },\n  }),\n  duration: css({\n    marginLeft: theme.spacing(1),\n    fontSize: theme.typography.bodySmall.fontSize,\n  }),\n});\n","import { css } from '@emotion/css';\n\nimport { GrafanaTheme2 } from '@grafana/data';\nimport { AlertState } from 'app/plugins/datasource/alertmanager/types';\n\nexport const getNotificationsTextColors = (theme: GrafanaTheme2) => ({\n  [AlertState.Active]: css({\n    color: theme.colors.error.text,\n  }),\n  [AlertState.Suppressed]: css({\n    color: theme.colors.primary.text,\n  }),\n  [AlertState.Unprocessed]: css({\n    color: theme.colors.secondary.text,\n  }),\n});\n","import pluralize from 'pluralize';\n\nimport { useStyles2 } from '@grafana/ui';\nimport { AlertState, AlertmanagerGroup } from 'app/plugins/datasource/alertmanager/types';\n\nimport { getNotificationsTextColors } from '../../styles/notifications';\n\ninterface Props {\n  group: AlertmanagerGroup;\n}\n\nexport const AlertGroupHeader = ({ group }: Props) => {\n  const textStyles = useStyles2(getNotificationsTextColors);\n  const total = group.alerts.length;\n  const countByStatus = group.alerts.reduce(\n    (statusObj, alert) => {\n      if (statusObj[alert.status.state]) {\n        statusObj[alert.status.state] += 1;\n      } else {\n        statusObj[alert.status.state] = 1;\n      }\n      return statusObj;\n    },\n    {} as Record<AlertState, number>\n  );\n\n  return (\n    <div>\n      {`${total} ${pluralize('alert', total)}: `}\n      {Object.entries(countByStatus).map(([state, count], index) => {\n        return (\n          <span\n            key={`${JSON.stringify(group.labels)}-notifications-${index}`}\n            className={textStyles[state as AlertState]}\n          >\n            {index > 0 && ', '}\n            {`${count} ${state}`}\n          </span>\n        );\n      })}\n    </div>\n  );\n};\n","import { css } from '@emotion/css';\nimport { useState } from 'react';\n\nimport { GrafanaTheme2 } from '@grafana/data';\nimport { Trans } from '@grafana/i18n';\nimport { Stack, TextLink, useStyles2 } from '@grafana/ui';\nimport { AlertmanagerGroup } from 'app/plugins/datasource/alertmanager/types';\n\nimport { createContactPointSearchLink } from '../../utils/misc';\nimport { AlertLabels } from '../AlertLabels';\nimport { CollapseToggle } from '../CollapseToggle';\nimport { MetaText } from '../MetaText';\n\nimport { AlertGroupAlertsTable } from './AlertGroupAlertsTable';\nimport { AlertGroupHeader } from './AlertGroupHeader';\n\ninterface Props {\n  group: AlertmanagerGroup;\n  alertManagerSourceName: string;\n}\n\nexport const AlertGroup = ({ alertManagerSourceName, group }: Props) => {\n  const [isCollapsed, setIsCollapsed] = useState<boolean>(true);\n  const styles = useStyles2(getStyles);\n\n  // When group is grouped, receiver.name is 'NONE' as it can contain multiple receivers\n  const receiverInGroup = group.receiver.name !== 'NONE';\n  const contactPoint = group.receiver.name;\n\n  return (\n    <div className={styles.wrapper}>\n      <div className={styles.header}>\n        <div className={styles.group} data-testid=\"alert-group\">\n          <CollapseToggle\n            size=\"sm\"\n            isCollapsed={isCollapsed}\n            onToggle={() => setIsCollapsed(!isCollapsed)}\n            data-testid=\"alert-group-collapse-toggle\"\n          />\n          {Object.keys(group.labels).length ? (\n            <Stack direction=\"row\" alignItems=\"center\">\n              <AlertLabels labels={group.labels} size=\"sm\" />\n\n              {receiverInGroup && (\n                <MetaText icon=\"at\">\n                  <Trans i18nKey=\"alerting.alert-group.delivered-to\" values={{ name: group.receiver.name }}>\n                    Delivered to{' '}\n                    <TextLink\n                      href={createContactPointSearchLink(contactPoint, alertManagerSourceName)}\n                      variant=\"bodySmall\"\n                      color=\"primary\"\n                      inline={false}\n                    >\n                      {'{{name}}'}\n                    </TextLink>\n                  </Trans>\n                </MetaText>\n              )}\n            </Stack>\n          ) : (\n            <span>\n              <Trans i18nKey=\"alerting.alert-group.no-grouping\">No grouping</Trans>\n            </span>\n          )}\n        </div>\n        <AlertGroupHeader group={group} />\n      </div>\n      {!isCollapsed && <AlertGroupAlertsTable alertManagerSourceName={alertManagerSourceName} alerts={group.alerts} />}\n    </div>\n  );\n};\n\nconst getStyles = (theme: GrafanaTheme2) => ({\n  wrapper: css({\n    '& + &': {\n      marginTop: theme.spacing(2),\n    },\n  }),\n  header: css({\n    display: 'flex',\n    flexDirection: 'row',\n    flexWrap: 'wrap',\n    alignItems: 'center',\n    justifyContent: 'space-between',\n    padding: theme.spacing(1),\n    backgroundColor: theme.colors.background.secondary,\n    width: '100%',\n  }),\n  group: css({\n    display: 'flex',\n    flexDirection: 'row',\n    alignItems: 'center',\n  }),\n});\n","import { isUndefined, omitBy } from 'lodash';\n\nimport { MuteTimeInterval, TimeInterval, TimeRange } from 'app/plugins/datasource/alertmanager/types';\n\nimport { MuteTimingFields, MuteTimingIntervalFields } from '../types/mute-timing-form';\n\nexport const DAYS_OF_THE_WEEK = ['monday', 'tuesday', 'wednesday', 'thursday', 'friday', 'saturday', 'sunday'];\n\nexport const MONTHS = [\n  'january',\n  'february',\n  'march',\n  'april',\n  'may',\n  'june',\n  'july',\n  'august',\n  'september',\n  'october',\n  'november',\n  'december',\n];\n\nexport const defaultTimeInterval: MuteTimingIntervalFields = {\n  times: [{ start_time: '', end_time: '' }],\n  weekdays: '',\n  days_of_month: '',\n  months: '',\n  years: '',\n  location: '',\n  disable: false,\n};\n\nexport const validateArrayField = (\n  value: string | undefined,\n  validateValue: (input: string) => boolean,\n  invalidText: string\n) => {\n  if (value) {\n    return (\n      value\n        .split(',')\n        .map((x) => x.trim())\n        .every((entry) => entry.split(':').every(validateValue)) || invalidText\n    );\n  } else {\n    return true;\n  }\n};\n\nconst convertStringToArray = (str?: string) => {\n  return str ? str.split(',').map((s) => s.trim()) : undefined;\n};\n\nexport const createMuteTiming = (fields: MuteTimingFields): MuteTimeInterval => {\n  const timeIntervals: TimeInterval[] = fields.time_intervals.map(\n    ({ times, weekdays, days_of_month, months, years, location, disable }) => {\n      const interval = {\n        times: convertTimesToDto(times, disable),\n        weekdays: convertStringToArray(weekdays)?.map((v) => v.toLowerCase()),\n        days_of_month: convertStringToArray(days_of_month),\n        months: convertStringToArray(months),\n        years: convertStringToArray(years),\n        location: location ? location : undefined,\n      };\n\n      return omitBy(interval, isUndefined);\n    }\n  );\n\n  return {\n    name: fields.name,\n    time_intervals: timeIntervals,\n  };\n};\n\n/*\n * Convert times from form to dto, if disable is true, then return an empty array as times\n If the times array is empty and disable is false, then return undefined\n * @param muteTimeInterval\n * @returns MuteTimingFields\n *\n */\nfunction convertTimesToDto(times: TimeRange[] | undefined, disable: boolean) {\n  if (disable) {\n    return [];\n  }\n  const timesToReturn = times?.filter(({ start_time, end_time }) => !!start_time && !!end_time);\n  return timesToReturn?.length ? timesToReturn : undefined;\n}\n\n/*\n * Get disable field from dto, if any of the lists is an empty array, then the disable field is true\n * @param muteTimeInterval\n * @returns MuteTimingFields\n *\n */\n\nexport function isTimeIntervalDisabled(intervals: TimeInterval): boolean {\n  if (\n    intervals.times?.length === 0 ||\n    intervals.weekdays?.length === 0 ||\n    intervals.days_of_month?.length === 0 ||\n    intervals.months?.length === 0 ||\n    intervals.years?.length === 0\n  ) {\n    return true;\n  }\n  return false;\n}\n\n/*\n   Return true if all the time intervals are disabled\n  * @param muteTimeInterval\n  * @returns MuteTimingFields\n  * */\nexport function isDisabled(muteTiming: MuteTimeInterval) {\n  return muteTiming.time_intervals.every((timeInterval) => isTimeIntervalDisabled(timeInterval));\n}\n"],"names":["CollapseToggle","isCollapsed","onToggle","idControlled","className","text","size","restOfProps","parseIntegrationName","integrationName","matches","contactPointsStateDtoToModel","receiversStateDto","contactPointsState","cpState","receiverState","integrationStatusDTO","integrationType","getIntegrationType","errorsCount","prevCount","fetchContactPointsState","alertManagerSourceName","response","lastValueFrom","receiversApi","alertingApi","build","amSourceName","error","useGetContactPointsState","contactPointsStateEmpty","MAX_CONTACT_POINTS_RENDERED","ExternalAlertmanagerContactPointSelector","selectProps","selectedContactPointName","onError","selectedAlertmanager","contactPoints","isLoading","useContactPoints","options","contactPoint","Text","ContactPoint","matchedContactPoint","option","Alert","Select","NotificationPoliciesFilter","onChangeReceiver","onChangeMatchers","matchingCount","contactPointsSupported","canSeeContactPoints","isGrafanaAlertmanager","searchParams","setSearchParams","useURLSearchParams","searchInputRef","queryString","getNotificationPoliciesFilters","styles","getStyles","handleChangeLabels","matchers","clearFilters","hasFilters","inputValid","Stack","Field","Label","Tooltip","Icon","Input","event","Button","findRoutesMatchingPredicate","routeTree","predicateFn","matchingRouteIdsWithPath","findMatch","route","path","newPath","previousPath","findRoutesByMatchers","labelMatchersFilter","filters","unquoteMatchersIfRequired","routeMatchers","filter","matcher","key","operator","value","AlertGroupsSummary","active","suppressed","unprocessed","statsComponents","total","Badge","handleContactPointSelect","name","onChange","AmRootRouteForm","actionButtons","onSubmit","isTimingOptionsExpanded","setIsTimingOptionsExpanded","groupByOptions","setGroupByOptions","defaultValues","handleSubmit","register","control","errors","setValue","getValues","ref","field","changeValue","Link","opt","opts","Collapse","PromDurationInput","groupInterval","AmRoutesExpandedForm","defaults","formStyles","canSeeMuteTimings","emptyMatcher","formAmRoute","watch","fields","append","remove","index","IconButton","Switch","FieldValidationMessage","routeTimingsFields","MuteTimingsSelector","theme","commonSpacing","NotificationPoliciesErrorAlert","title","errMessage","useAddPolicyModal","handleAdd","loading","showModal","setShowModal","insertPosition","setInsertPosition","referenceRoute","setReferenceRoute","handleDismiss","setError","handleShow","position","UpdatingModal","Modal","newRoute","useEditPolicyModal","handleUpdate","isDefaultPolicy","setIsDefaultPolicy","setRoute","values","useDeletePolicyModal","handleDelete","useAlertGroupsModal","alertGroups","setAlertGroups","setMatchers","formatter","setFormatter","instancesByState","instances","group","instance","Matchers","AlertGroup","isOpen","Spinner","NotificationPoliciesList","appNotification","_","canSeeAlertGroups","useGetAlertmanagerAlertGroupsQuery","alertmanagerApi","contactPointFilter","setContactPointFilter","setLabelMatchersFilter","hasConfigurationAPI","getRouteGroupsMap","useRouteGroupsMatcher","shouldFetchContactPoints","currentData","fetchPoliciesError","refetchNotificationPolicyRoute","useNotificationPolicyRoute","defaultPolicy","deleteNotificationPolicy","deleteNotificationPolicyState","updateExistingNotificationPolicy","updateExistingNotificationPolicyState","addNotificationPolicy","addNotificationPolicyState","refetchAlertGroups","receivers","rootRoute","routeAlertGroupsMap","instancesPreviewError","triggerGetRouteGroupsMap","useAsyncFn","routesMatchingFilters","findRoutesMatchingFilters","refetchPolicies","partialRoute","handleActionResult","closeEditModal","closeAddModal","closeDeleteModal","updatingTree","addModal","openAddModal","editModal","openEditModal","deleteModal","openDeleteModal","alertInstancesModal","showAlertGroupsModal","hasPoliciesData","hasPoliciesError","hasConflictError","state","Policy","hasFilter","havebothFilters","matchedRoutes","fullRoute","matchingRoutesForContactPoint","routesMatchingContactPoint","matchingRoutesForLabelMatchers","routesMatchingLabelFilters","findMapIntersection","matchingRoutes","result","map","GrafanaMuteTimingsExporterPreview","exportFormat","onClose","muteTimingsDefinition","isFetching","alertRuleApi","downloadFileName","LoadingPlaceholder","FileExportPreview","GrafanaMuteTimingExporterPreview","muteTimingName","GrafanaMuteTimingsExporter","activeTab","setActiveTab","GrafanaExportDrawer","ALL_MUTE_TIMINGS","useExportMuteTimingsDrawer","setMuteTimingName","isExportDrawerOpen","toggleShowExportDrawer","useToggle","handleClose","handleOpen","MuteTimingActionsButtons","muteTiming","deleteMuteTiming","deleteMuteTimingRequestState","showDeleteDrawer","setShowDeleteDrawer","ExportDrawer","showExportDrawer","exportSupported","exportAllowed","isGrafanaDataSource","viewOrEditHref","viewOrEditButton","Authorize","ConfirmModal","EmptyAreaWithCTA","buttonIcon","buttonLabel","buttonSize","buttonVariant","onButtonClick","href","showButton","commonProps","EmptyArea","TimeIntervalsTable","hideActions","ExportAllDrawer","showExportAllDrawer","data","useMuteTimings","items","mute","allowedToCreateMuteTiming","exportMuteTimingsSupported","exportMuteTimingsAllowed","columns","useColumns","Spacer","DynamicTable","_editSupported","allowedToEdit","_deleteSupported","allowedToDelete","showActions","Provisioning","ActiveTab","NotificationPoliciesTabs","policiesSupported","canSeePoliciesTab","timingsSupported","canSeeTimingsTab","availableTabs","tab","muteTimings","queryParams","setQueryParams","useQueryParams","getActiveTabFromUrl","muteTimingsTabActive","policyTreeTabActive","numberOfMuteTimings","GrafanaAlertmanagerWarning","TabsBar","Tab","TabContent","defaultTab","NotificationPoliciesPage","withPageErrorBoundary","children","proxyMarker","createEndpoint","releaseProxy","finalizer","throwMarker","isObject","val","proxyTransferHandler","obj","port1","port2","expose","port","wrap","throwTransferHandler","serialized","transferHandlers","isAllowedOrigin","allowedOrigins","origin","allowedOrigin","ep","callback","ev","id","type","argumentList","fromWireValue","returnValue","parent","prop","rawValue","proxy","transfer","wireValue","transferables","toWireValue","closeEndPoint","isMessagePort","endpoint","target","pendingListeners","resolver","createProxy","throwIfProxyReleased","isReleased","releaseEndpoint","requestResponseMessage","proxyCounter","proxyFinalizers","newCount","registerProxy","unregisterProxy","isProxyReleased","_target","r","p","_thisArg","rawArgumentList","last","processArguments","myFlat","arr","processed","v","transferCache","transfers","windowEndpoint","w","context","targetOrigin","msg","handler","serializedValue","resolve","generateUUID","createWorker","routeMatcher","loadWorker","worker","e","validateWorker","disposeWorker","startTime","timeSpent","matchInstancesToRoute","instancesToMatch","AlertDetails","alert","isGrafanaSource","isSeeSourceButtonEnabled","annotationKey","annotationValue","AnnotationDetailsField","AlertGroupAlertsTable","alerts","AmAlertStateTag","labels","AlertLabels","DynamicTableWithGuidelines","getNotificationsTextColors","AlertGroupHeader","textStyles","countByStatus","statusObj","count","setIsCollapsed","receiverInGroup","MetaText","TextLink","DAYS_OF_THE_WEEK","MONTHS","defaultTimeInterval","validateArrayField","validateValue","invalidText","x","entry","convertStringToArray","str","s","createMuteTiming","timeIntervals","times","weekdays","days_of_month","months","years","location","disable","interval","convertTimesToDto","timesToReturn","start_time","end_time","isTimeIntervalDisabled","intervals","isDisabled","timeInterval"],"sourceRoot":""}