"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[9609],{46505:(O,P,a)=>{a.d(P,{P:()=>w});var t=a(74848),v=a(22803),R=a(92745),u=a(36490),j=a(68079),D=a(45861),m=a(41654),f=a(63142);const w=({initPhase:b})=>{const p=(0,f.of)(c),x=()=>{u.Ny.push("/")};return(0,t.jsx)("div",{className:p.dashboardLoading,children:(0,t.jsx)("div",{className:p.dashboardLoadingText,children:(0,t.jsxs)(m.B,{direction:"column",gap:2,children:[(0,t.jsxs)(m.B,{alignItems:"center",justifyContent:"center",gap:.5,children:[(0,t.jsx)(j.y,{inline:!0})," ",b]})," ",(0,t.jsx)(m.B,{alignItems:"center",justifyContent:"center",children:(0,t.jsx)(D.$n,{variant:"secondary",size:"md",icon:"repeat",onClick:x,children:(0,t.jsx)(R.x6,{i18nKey:"dashboard.dashboard-loading.cancel-loading-dashboard",children:"Cancel loading dashboard"})})})]})})})},c=b=>{const p="0.5s",x=(0,v.keyframes)`
    0% { opacity: 0%; }
    100% { opacity: 100%; }
  `;return{dashboardLoading:(0,v.css)({height:"60vh",display:"flex",opacity:"0%",alignItems:"center",justifyContent:"center",[b.transitions.handleMotion("no-preference","reduce")]:{animation:`${x} 0s step-end ${p} 1 normal forwards`}}),dashboardLoadingText:(0,v.css)({fontSize:b.typography.h4.fontSize})}}},74410:(O,P,a)=>{a.d(P,{l:()=>j});var t=a(74848),v=a(22803),R=a(96540),u=a(49785);function j({defaultValues:D,onSubmit:m,validateOnMount:f=!1,validateFieldsOnMount:w,children:c,validateOn:b="onSubmit",maxWidth:p=600,...x}){const{handleSubmit:l,trigger:C,formState:h,...E}=(0,u.mN)({mode:b,defaultValues:D});return(0,R.useEffect)(()=>{f&&C(w)},[C,w,f]),(0,t.jsx)("form",{className:(0,v.css)({maxWidth:p!=="none"?p+"px":p,width:"100%"}),onSubmit:l(m),...x,children:c({errors:h.errors,formState:h,trigger:C,...E})})}},77598:(O,P,a)=>{a.d(P,{N:()=>gt});var t=a(74848),v=a(46942),R=a.n(v),u=a(96540),j=a(66816),D=a.n(j),m=a(64423),f=a(43173),w=a(45229),c=a(95943),b=a(15130),p=a(88813),x=a(87745),l=a(22803),C=a(84140),h=a(92745),E=a(63142),G=a(76319),W=a(24438);const Y=({panel:o,dashboard:e})=>{const s=r=>{r.preventDefault(),e.removePanel(o)},i=r=>{const{gridPos:d}=o,g={...r.model,gridPos:d,libraryPanel:r};e.addPanel(g),e.removePanel(o)},n=(0,E.of)(k);return(0,t.jsx)("div",{className:n.wrapper,children:(0,t.jsxs)("div",{className:n.callToAction,children:[(0,t.jsxs)("div",{className:(0,l.cx)(n.headerRow,"grid-drag-handle"),children:[(0,t.jsx)("span",{children:(0,t.jsx)(h.x6,{i18nKey:"library-panel.add-widget.title",children:"Add panel from panel library"})}),(0,t.jsx)("div",{className:"flex-grow-1"}),(0,t.jsx)(G.K,{"aria-label":(0,h.t)("dashboard.add-library-panel-widget.aria-label-close-add-panel-widget","Close 'Add Panel' widget"),name:"times",onClick:s,tooltip:(0,h.t)("dashboard.add-library-panel-widget.tooltip-close-widget","Close widget")})]}),(0,t.jsx)(W.j,{onClick:i,variant:W.s.Tight,showPanelFilter:!0})]})})},k=o=>{const e=(0,l.keyframes)({"0%":{boxShadow:`0 0 0 2px ${o.colors.background.canvas}, 0 0 0px 4px ${o.colors.primary.main}`},"50%":{boxShadow:`0 0 0 2px ${o.components.dashboard.background}, 0 0 0px 4px ${(0,C.A)(o.colors.primary.main).darken(20).toHexString()}`},"100%":{boxShadow:`0 0 0 2px ${o.components.dashboard.background}, 0 0 0px 4px  ${o.colors.primary.main}`}});return{wrapper:(0,l.css)({height:"100%",paddingTop:`${o.spacing(.5)}`}),headerRow:(0,l.css)({display:"flex",alignItems:"center",height:"38px",flexShrink:0,width:"100%",fontSize:o.typography.fontSize,fontWeight:o.typography.fontWeightMedium,paddingLeft:`${o.spacing(1)}`,[o.transitions.handleMotion("no-preference","reduce")]:{transition:"background-color 0.1s ease-in-out"},cursor:"move","&:hover":{background:`${o.colors.background.secondary}`}}),callToAction:(0,l.css)({backgroundColor:o.components.panel.background,border:`1px solid ${o.components.panel.borderColor}`,borderRadius:o.shape.radius.default,display:"flex",flex:"1 1 0",flexDirection:"column",height:"100%",position:"relative",width:"100%",outline:"2px dotted transparent",outlineOffset:"2px",overflow:"hidden",[o.transitions.handleMotion("no-preference","reduce")]:{animation:`${e} 2s ease infinite`}})}};var Q=a(2543),I=a(51898),J=a(75234),X=a(2863),Z=a(89640),U=a(30703),z=a(9931),q=a(20230),_=a(5878),tt=a(8515),B=a(22787),$=a(37386),st=a(63527),et=a(34999),N=a(45861),at=a(74410),ot=a(31819);const nt=({repeat:o,title:e,warning:s,onUpdate:i,onCancel:n})=>{const[r,d]=(0,u.useState)(o),g=(0,u.useCallback)(y=>d(y),[d]);return(0,t.jsx)(at.l,{defaultValues:{title:e},onSubmit:y=>{i(y.title,r)},children:({register:y})=>(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)($.D,{label:(0,h.t)("dashboard.row-options-form.label-title","Title"),children:(0,t.jsx)(st.p,{...y("title"),type:"text"})}),(0,t.jsx)($.D,{label:(0,h.t)("dashboard.row-options-form.label-repeat-for","Repeat for"),children:(0,t.jsx)(ot.G,{repeat:r,onChange:g})}),s&&(0,t.jsx)(et.F,{"data-testid":I.Tp.pages.Dashboard.Rows.Repeated.ConfigSection.warningMessage,severity:"warning",title:"",topSpacing:3,bottomSpacing:0,children:s}),(0,t.jsxs)(B.a.ButtonRow,{children:[(0,t.jsx)(N.$n,{type:"button",variant:"secondary",onClick:n,fill:"outline",children:(0,t.jsx)(h.x6,{i18nKey:"dashboard.row-options-form.cancel",children:"Cancel"})}),(0,t.jsx)(N.$n,{type:"submit",children:(0,t.jsx)(h.x6,{i18nKey:"dashboard.row-options-form.update",children:"Update"})})]})]})})},it=({repeat:o,title:e,onDismiss:s,onUpdate:i,warning:n})=>{const r=(0,E.of)(rt);return(0,t.jsx)(B.a,{isOpen:!0,title:(0,h.t)("dashboard.row-options-modal.title-row-options","Row options"),icon:"copy",onDismiss:s,className:r.modal,children:(0,t.jsx)(nt,{repeat:o,title:e,onCancel:s,onUpdate:i,warning:n})})},rt=()=>({modal:(0,l.css)({label:"RowOptionsModal",width:"500px"})}),K=({repeat:o,title:e,onUpdate:s,warning:i})=>{const n=r=>(d,g)=>{s(d,g),r()};return(0,t.jsx)(tt.$s,{children:({showModal:r,hideModal:d})=>(0,t.jsx)("button",{type:"button",className:"pointer","aria-label":(0,h.t)("dashboard.row-options-button.aria-label-row-options","Row options"),onClick:()=>{r(it,{title:e,repeat:o,onDismiss:d,onUpdate:n(d),warning:i})},children:(0,t.jsx)(U.I,{name:"cog"})})})};K.displayName="RowOptionsButton";class dt extends u.Component{constructor(){super(...arguments),this.onVariableUpdated=()=>{this.forceUpdate()},this.onToggle=()=>{this.props.dashboard.toggleRow(this.props.panel)},this.getWarning=()=>{if((this.props.panel.panels?.length?this.props.panel.panels:this.props.dashboard.getRowPanels((0,Q.indexOf)(this.props.dashboard.panels,this.props.panel))).some(i=>i.datasource?.uid===z.K))return(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{children:(0,t.jsxs)(h.x6,{i18nKey:"dashboard.untheme-dashboard-row.dashboard-datasource",children:["Panels in this row use the ",{SHARED_DASHBOARD_QUERY:z.K}," data source. These panels will reference the panel in the original row, not the ones in the repeated rows."]})}),(0,t.jsx)(Z.Y,{external:!0,href:"https://grafana.com/docs/grafana/latest/dashboards/build-dashboards/create-dashboard/#configure-repeating-rows",children:(0,t.jsx)(h.x6,{i18nKey:"dashboard.unthemed-dashboard-row.learn-more",children:"Learn more"})})]})},this.onUpdate=(e,s)=>{this.props.panel.setProperty("title",e),this.props.panel.setProperty("repeat",s??void 0),this.props.panel.render(),this.props.dashboard.processRepeats(),this.forceUpdate()},this.onDelete=()=>{w.A.publish(new x.bY({title:(0,h.t)("dashboard.unthemed-dashboard-row.title.delete-row","Delete row"),text:"Are you sure you want to remove this row and all its panels?",altActionText:"Delete row only",icon:"trash-alt",onConfirm:()=>{this.props.dashboard.removeRow(this.props.panel,!0)},onAltAction:()=>{this.props.dashboard.removeRow(this.props.panel,!1)}}))}}componentDidMount(){this.sub=this.props.dashboard.events.subscribe(J._,this.onVariableUpdated)}componentWillUnmount(){this.sub&&this.sub.unsubscribe()}render(){const e=(0,X.w)().replace(this.props.panel.title,this.props.panel.scopedVars,"text"),s=this.props.panel.panels?this.props.panel.panels.length:0,i=s===1?"panel":"panels",n=this.props.dashboard.meta.canEdit===!0,r=this.props.panel.collapsed,d=ht(this.props.theme);return(0,t.jsxs)("div",{className:(0,l.cx)(d.dashboardRow,{[d.dashboardRowCollapsed]:r}),"data-testid":"dashboard-row-container",children:[(0,t.jsxs)("button",{"aria-expanded":!r,className:(0,l.cx)(d.title,"pointer"),type:"button","data-testid":I.Tp.components.DashboardRow.title(e),onClick:this.onToggle,children:[(0,t.jsx)(U.I,{name:r?"angle-right":"angle-down"}),e,(0,t.jsxs)("span",{className:(0,l.cx)(d.count,{[d.countCollapsed]:r}),children:["(",s," ",i,")"]})]}),n&&(0,t.jsxs)("div",{className:d.actions,children:[(0,t.jsx)(K,{title:this.props.panel.title,repeat:this.props.panel.repeat,onUpdate:this.onUpdate,warning:this.getWarning()}),(0,t.jsx)("button",{type:"button",className:"pointer",onClick:this.onDelete,"aria-label":(0,h.t)("dashboard.unthemed-dashboard-row.aria-label-delete-row","Delete row"),children:(0,t.jsx)(U.I,{name:"trash-alt"})})]}),r===!0&&(0,t.jsx)("div",{className:(0,l.cx)({[d.toggleTargetCollapsed]:r}),onClick:this.onToggle,children:"\xA0"}),n&&(0,t.jsx)("div",{"data-testid":"dashboard-row-drag",className:(0,l.cx)(d.dragHandle,"grid-drag-handle",{[d.dragHandleCollapsed]:r})})]})}}const lt=(0,E.cV)(dt),ht=o=>{const e=o.name==="dark"?q:_,s=(0,l.css)({color:o.colors.text.secondary,opacity:0,[o.transitions.handleMotion("no-preference","reduce")]:{transition:"200ms opacity ease-in 200ms"},button:{color:o.colors.text.secondary,paddingLeft:o.spacing(2),background:"transparent",border:"none","&:hover":{color:o.colors.text.maxContrast}}});return{dashboardRow:(0,l.css)({display:"flex",alignItems:"center",height:"100%","&:hover, &:focus-within":{[`.${s}`]:{opacity:1}}}),dashboardRowCollapsed:(0,l.css)({background:o.components.panel.background}),toggleTargetCollapsed:(0,l.css)({flex:1,cursor:"pointer",marginRight:"15px"}),title:(0,l.css)({flexGrow:0,fontSize:o.typography.h5.fontSize,fontWeight:o.typography.fontWeightMedium,color:o.colors.text.primary,background:"transparent",border:"none",".fa":{color:o.colors.text.secondary,fontSize:o.typography.size.xs,padding:o.spacing(0,1)}}),actions:s,count:(0,l.css)({paddingLeft:o.spacing(2),color:o.colors.text.secondary,fontStyle:"italic",fontSize:o.typography.size.sm,fontWeight:"normal",display:"none"}),countCollapsed:(0,l.css)({display:"inline-block"}),dragHandle:(0,l.css)({cursor:"move",width:"16px",height:"100%",background:`url("${e}") no-repeat 50% 50%`,backgroundSize:"8px",visibility:"hidden",position:"absolute",top:0,right:0}),dragHandleCollapsed:(0,l.css)({visibility:"visible",opacity:1})}};var ct=a(84403),pt=a(97976);const F="systemPanelFilterVar";class gt extends u.PureComponent{constructor(e){super(e),this.panelMap={},this.eventSubs=new m.yU,this.windowHeight=1200,this.windowWidth=1920,this.gridWidth=0,this.lastPanelBottom=0,this.isLayoutInitialized=!1,this.onLayoutChange=s=>{if(!this.state.panelFilter){for(const i of s)this.panelMap[i.i].updateGridPos(i,this.isLayoutInitialized);this.isLayoutInitialized&&(this.isLayoutInitialized=!0),this.props.dashboard.sortPanelsByGridPos(),this.forceUpdate()}},this.triggerForceUpdate=()=>{this.forceUpdate()},this.updateGridPos=(s,i)=>{this.panelMap[s.i].updateGridPos(s)},this.onResize=(s,i,n)=>{this.panelMap[n.i].updateGridPos(n)},this.onResizeStop=(s,i,n)=>{this.updateGridPos(n,s)},this.onDragStop=(s,i,n)=>{this.updateGridPos(n,s)},this.onGetWrapperDivRef=s=>{s&&b.TP.user.authenticatedBy!=="render"&&setTimeout(()=>{s.classList.add("react-grid-layout--enable-move-animations")},50)},this.rootEl=null,this.onMeasureRef=s=>{if(!s){this.rootEl&&this.resizeObserver&&this.resizeObserver.unobserve(this.rootEl);return}this.rootEl=s,this.resizeObserver=new ResizeObserver(i=>{i.forEach(n=>{this.setState({width:n.contentRect.width})})}),this.resizeObserver.observe(s)},this.state={panelFilter:void 0,width:document.body.clientWidth}}componentDidMount(){const{dashboard:e}=this.props;if(f.$.featureToggles.panelFilterVariable){for(const s of e.getVariables())if(s.id===F){"query"in s&&this.setPanelFilter(s.query);break}this.eventSubs.add(w.A.subscribe(p.og,s=>{if(s.payload.variable?.id===F&&"current"in s.payload.variable){let i=s.payload.variable.current;"value"in i&&typeof i.value=="string"&&this.setPanelFilter(i.value)}}))}this.eventSubs.add(e.events.subscribe(x.Q$,this.triggerForceUpdate))}componentWillUnmount(){this.eventSubs.unsubscribe()}setPanelFilter(e){let s;e.length>0&&(s=new RegExp(e,"i")),this.setState({panelFilter:s})}buildLayout(){const e=[];this.panelMap={};const{panelFilter:s}=this.state;let i=0;for(const n of this.props.dashboard.panels){if(n.key||(n.key=`panel-${n.id}-${Date.now()}`),n.title=n.title?.substring(0,5e3),this.panelMap[n.key]=n,!n.gridPos){console.log("panel without gridpos");continue}const r={i:n.key,x:n.gridPos.x,y:n.gridPos.y,w:n.gridPos.w,h:n.gridPos.h};n.type==="row"&&(r.w=c.cV,r.h=1,r.isResizable=!1,r.isDraggable=n.collapsed),s?s.test(n.title)&&(r.isResizable=!1,r.isDraggable=!1,r.x=i%2*c.cV,r.y=Math.floor(i/2),e.push(r),i++):e.push(r)}return e}getPanelScreenPos(e,s){let i=0;return s<f.$.theme2.breakpoints.values.md?i=this.lastPanelBottom+c.dU:i=T(e.gridPos.y)+c.dU,this.lastPanelBottom=i+T(e.gridPos.h),{top:i,bottom:this.lastPanelBottom}}renderPanels(e,s){const{panelFilter:i}=this.state,n=[];this.lastPanelBottom=0,this.gridWidth!==e&&(this.windowHeight=window.innerHeight??1e3,this.windowWidth=window.innerWidth,this.gridWidth=e);for(const r of this.props.dashboard.panels){const d=R()({"react-grid-item--fullscreen":r.isViewing}),g=(0,t.jsx)(V,{className:d,"data-panelid":r.id,gridPos:r.gridPos,gridWidth:e,windowHeight:this.windowHeight,windowWidth:this.windowWidth,isViewing:r.isViewing,children:(y,A)=>this.renderPanel(r,y,A,s)},r.key);i?i.test(r.title)&&n.push(g):n.push(g)}return n}renderPanel(e,s,i,n){return e.type==="row"?(0,t.jsx)(lt,{panel:e,dashboard:this.props.dashboard},e.key):e.type==="add-library-panel"?(0,t.jsx)(Y,{panel:e,dashboard:this.props.dashboard},e.key):(0,t.jsx)(pt.L,{stateKey:e.key,panel:e,dashboard:this.props.dashboard,isEditing:e.isEditing,isViewing:e.isViewing,isDraggable:n,width:s,height:i,hideMenu:this.props.hidePanelMenus},e.key)}render(){const{isEditable:e,dashboard:s}=this.props,{width:i}=this.state;if(s.panels.length===0)return(0,t.jsx)(ct.A,{dashboard:s,canCreate:e});const n=i<=f.$.theme2.breakpoints.values.md?!1:e;return(0,t.jsx)("div",{ref:this.onMeasureRef,style:{flex:"1 1 auto",position:"relative",zIndex:1,display:this.props.editPanel?"none":void 0},children:(0,t.jsx)("div",{style:{width:i,height:"100%"},ref:this.onGetWrapperDivRef,children:(0,t.jsx)(D(),{width:i,isDraggable:n,isResizable:e,containerPadding:[0,0],useCSSTransforms:!0,margin:[c.dU,c.dU],cols:c.cV,rowHeight:c.sD,draggableHandle:".grid-drag-handle",draggableCancel:".grid-drag-cancel",layout:this.buildLayout(),onDragStop:this.onDragStop,onResize:this.onResize,onResizeStop:this.onResizeStop,onLayoutChange:this.onLayoutChange,children:this.renderPanels(i,n)})})})}}const V=u.forwardRef((o,e)=>{const s=f.$.theme2;let i=100,n=100;const{gridWidth:r,gridPos:d,isViewing:g,windowHeight:y,windowWidth:A,...H}=o,S=o.style??{};if(g)i=r,n=y*.85,S.height=n,S.width="100%";else if(A<s.breakpoints.values.md)i=o.gridWidth,n=T(d.h),S.height=n,S.width="100%";else if(o.style){const{width:M,height:L}=o.style;M!=null&&(i=typeof M=="number"?M:parseFloat(M)),L!=null&&(n=typeof L=="number"?L:parseFloat(L))}return(0,t.jsx)("div",{...H,style:{...H.style},ref:e,children:[o.children[0](i,n),o.children.slice(1)]})});function T(o){return o*(c.sD+c.dU)-c.dU}V.displayName="GridItemWithDimensions"}}]);

//# sourceMappingURL=9609.6c96f40e0a6cd8bb3f0b.js.map