"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[8758],{22488:(H,j,n)=>{n.d(j,{c:()=>M});var e=n(74848),C=n(92745),i=n(34999);function M({repo:h,items:v}){const m=x=>x?.spec?.type==="local"||!!x?.secure?.token?.name;return m(h)||v?.every(m)?null:(0,e.jsx)(i.F,{title:(0,C.t)("provisioning.inline-secure-values-warning","You need to save your access tokens again due to a system update"),severity:"error"})}},33580:(H,j,n)=>{n.r(j),n.d(j,{default:()=>de});var e=n(74848),C=n(54148),i=n(92745),M=n(50201),h=n(66404),v=n(89640),m=n(83793),x=n(13791),Q=n(29189),u=n(96540),D=n(49785),E=n(41654),s=n(37386),c=n(63527),Z=n(48767),J=n(43243),S=n(32635),F=n(89599),X=n(21285),q=n(77824),w=n(45861),_=n(83813),ee=n(48485),L=n(6279),ne=n(22488),ie=n(67170),re=n(79162),oe=n(92784),U=n(82781),P=n(53247),W=n(91555);function se({register:l}){const t=(0,P.ED)(),b=(0,P.hF)();return(0,e.jsxs)(F.a,{label:(0,i.t)("provisioning.config-form-github-collapse.label-git-hub-features","GitHub features"),isOpen:!0,children:[(0,e.jsx)(s.D,{children:(0,e.jsx)(S.S,{disabled:!b||!t,label:(0,i.t)("provisioning.finish-step.label-enable-previews","Enable dashboard previews in pull requests"),description:(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(i.x6,{i18nKey:"provisioning.finish-step.description-enable-previews",children:"Adds an image preview of dashboard changes in pull requests. Images of your Grafana dashboards will be shared in your Git repository and visible to anyone with repository access."})," ",(0,e.jsx)(h.E,{italic:!0,children:(0,e.jsxs)(i.x6,{i18nKey:"provisioning.finish-step.description-image-rendering",children:["Requires image rendering."," ",(0,e.jsx)(v.Y,{variant:"bodySmall",external:!0,href:"https://grafana.com/grafana/plugins/grafana-image-renderer",children:"Set up image rendering"})]})})]}),...l("generateDashboardPreviews")})}),!t&&(0,e.jsx)(s.D,{label:(0,i.t)("provisioning.config-form-github-collapse.label-realtime-feedback","Realtime feedback"),children:(0,e.jsx)(h.E,{variant:"bodySmall",color:"secondary",children:(0,e.jsxs)(i.x6,{i18nKey:"provisioning.config-form-github-collapse.description-realtime-feedback",children:[(0,e.jsx)(v.Y,{variant:"bodySmall",href:W.zM,children:"Configure webhooks"})," ","to get instant updates in Grafana as soon as changes are committed. Review and approve changes using pull requests before they go live."]})})})]})}var te=n(70368);const ae=()=>[{value:"instance",label:(0,i.t)("provisioning.config-form.option-entire-instance","Entire instance")},{value:"folder",label:(0,i.t)("provisioning.config-form.option-managed-folder","Managed folder")}];function le({data:l}){const t=l?.metadata?.name,[b,G]=(0,ie.A)(t),{register:d,handleSubmit:ge,reset:R,control:T,formState:{errors:o,isDirty:ce},setValue:A,setError:K,watch:fe,getValues:Y}=(0,D.mN)({defaultValues:(0,te.w)(l?.spec)}),V=!!t,[ue,I]=(0,u.useState)(V),[N,z]=(0,u.useState)(!1),$=(0,C.Zp)(),[g,pe]=fe(["type","readOnly"]),he=(0,u.useMemo)(()=>ae(),[]),y=(0,U.QM)(g),{data:k,isLoading:ve,error:O}=(0,m.Cx)(!t||!y?Q.hT:{name:t}),me=(0,u.useMemo)(()=>k?.items?k.items.map(a=>({label:a.name,value:a.name})):[],[k?.items]),r=y?(0,L.L)(g):null,p=g==="local"?(0,L.Y)(g):null,xe=(0,oe.Nv)(g);(0,u.useEffect)(()=>{y&&!l?.secure?.token&&(I(!1),K("token",{type:"manual",message:`Enter your ${r?.tokenConfig.label??"access token"}`}))},[l,r,I,K,y]),(0,u.useEffect)(()=>{if(G.isSuccess){const a=Y();R(a),setTimeout(()=>{$("/admin/provisioning")},300)}},[G.isSuccess,R,Y,$]);const be=async a=>{z(!0);try{const f=(0,re.tB)(a);await b(f,a.token)}finally{z(!1)}};return(0,e.jsxs)("form",{onSubmit:ge(be),style:{maxWidth:700},children:[(0,e.jsx)(_.F,{onDiscard:R,confirmRedirect:ce}),(0,e.jsxs)(E.B,{direction:"column",gap:2,children:[(0,e.jsx)(s.D,{noMargin:!0,label:(0,i.t)("provisioning.config-form.label-repository-type","Repository type"),children:(0,e.jsx)(c.p,{value:(0,U.R0)(g)?.label||g,disabled:!0})}),(0,e.jsx)(s.D,{noMargin:!0,label:(0,i.t)("provisioning.config-form.label-title","Title"),description:(0,i.t)("provisioning.config-form.description-title","A human-readable name for the config"),invalid:!!o.title,error:o?.title?.message,children:(0,e.jsx)(c.p,{...d("title",{required:(0,i.t)("provisioning.config-form.error-required","This field is required.")}),placeholder:(0,i.t)("provisioning.config-form.placeholder-my-config","My config")})}),r&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(ne.c,{repo:l}),(0,e.jsx)(s.D,{noMargin:!0,label:r.tokenConfig.label,required:r.tokenConfig.required,error:o?.token?.message,invalid:!!o.token,description:r.tokenConfig.description,children:(0,e.jsx)(D.xI,{name:"token",control:T,rules:{required:V?!1:r.tokenConfig.validation?.required},render:({field:{ref:a,...f}})=>(0,e.jsx)(Z.L4,{...f,invalid:!!o.token,id:"token",placeholder:r.tokenConfig.placeholder,isConfigured:ue,onReset:()=>{A("token",""),I(!1)}})})}),r.tokenUserConfig&&(0,e.jsx)(s.D,{noMargin:!0,label:r.tokenUserConfig.label,required:r.tokenUserConfig.required,error:o?.tokenUser?.message,invalid:!!o?.tokenUser,description:r.tokenUserConfig.description,children:(0,e.jsx)(c.p,{...d("tokenUser",{required:r.tokenUserConfig.validation?.required}),placeholder:r.tokenUserConfig.placeholder})}),xe&&(0,e.jsx)(ee.c,{type:g}),(0,e.jsx)(s.D,{noMargin:!0,label:r.urlConfig.label,error:o?.url?.message,invalid:!!o?.url,description:r.urlConfig.description,required:r.urlConfig.required,children:(0,e.jsx)(c.p,{...d("url",{required:r.urlConfig.validation?.required,pattern:r.urlConfig.validation?.pattern}),placeholder:r.urlConfig.placeholder})}),(0,e.jsx)(s.D,{noMargin:!0,label:r.branchConfig.label,description:r.branchConfig.description,error:o?.branch?.message||(O?(0,i.t)("provisioning.config-form.error-fetch-branches","Failed to fetch branches"):void 0),invalid:!!(o?.branch?.message||O),children:(0,e.jsx)(D.xI,{name:"branch",control:T,rules:r.branchConfig.validation,render:({field:{ref:a,onChange:f,...B}})=>(0,e.jsx)(J.G,{invalid:!!(o?.branch?.message||O),onChange:ye=>f(ye?.value||""),placeholder:r.branchConfig.placeholder,options:me,loading:ve,isClearable:!0,...B})})}),(0,e.jsx)(s.D,{noMargin:!0,label:r.pathConfig.label,description:r.pathConfig.description,children:(0,e.jsx)(c.p,{...d("path")})})]}),p&&(0,e.jsx)(s.D,{noMargin:!0,label:p.pathConfig.label,error:o?.path?.message,invalid:!!o?.path,description:p.pathConfig.description,required:p.pathConfig.required,children:(0,e.jsx)(c.p,{...d("path",{required:p.pathConfig.validation?.required}),placeholder:p.pathConfig.placeholder})}),(0,e.jsx)(s.D,{noMargin:!0,children:(0,e.jsx)(S.S,{...d("readOnly",{onChange:a=>{a.target.checked&&A("prWorkflow",!1)}}),label:(0,i.t)("provisioning.finish-step.label-read-only","Read only"),description:(0,i.t)("provisioning.config-form.description-read-only","Resources can't be modified through Grafana.")})}),r&&(0,e.jsx)(s.D,{noMargin:!0,children:(0,e.jsx)(S.S,{disabled:pe,...d("prWorkflow"),label:r.prWorkflowConfig.label,description:r.prWorkflowConfig.description})}),g==="github"&&(0,e.jsx)(se,{register:d}),y&&(0,e.jsx)(F.a,{label:(0,i.t)("provisioning.config-form.label-automatic-pulling","Automatic pulling"),isOpen:!1,children:(0,e.jsxs)(E.B,{direction:"column",gap:2,children:[(0,e.jsx)(s.D,{noMargin:!0,label:(0,i.t)("provisioning.config-form.label-enabled","Enabled"),description:(0,i.t)("provisioning.config-form.description-enabled","Once automatic pulling is enabled, the target cannot be changed."),children:(0,e.jsx)(X.d,{...d("sync.enabled"),id:"sync.enabled"})}),(0,e.jsx)(s.D,{noMargin:!0,label:(0,i.t)("provisioning.config-form.label-target","Target"),required:!0,error:o?.sync?.target?.message,invalid:!!o?.sync?.target,children:(0,e.jsx)(D.xI,{name:"sync.target",control:T,rules:{required:(0,i.t)("provisioning.config-form.error-required","This field is required.")},render:({field:{ref:a,onChange:f,...B}})=>(0,e.jsx)(q.z,{options:he,onChange:f,disabled:!!l?.status?.sync.state,...B})})}),(0,e.jsx)(s.D,{noMargin:!0,label:(0,i.t)("provisioning.config-form.label-interval-seconds","Interval (seconds)"),children:(0,e.jsx)(c.p,{...d("sync.intervalSeconds",{valueAsNumber:!0}),type:"number",placeholder:(0,i.t)("provisioning.config-form.placeholder-interval-seconds","60")})})]})}),(0,e.jsx)(E.B,{gap:2,children:(0,e.jsx)(w.$n,{type:"submit",disabled:N,children:N?(0,i.t)("provisioning.config-form.button-saving","Saving..."):(0,i.t)("provisioning.config-form.button-save","Save")})})]})]})}function de(){const{name:l=""}=(0,C.g)(),t=(0,m.Sw)({name:l}),b=t.isError&&t.error?.status===404;return(0,e.jsx)(x.Y,{navId:"provisioning",pageNav:{text:(0,i.t)("provisioning.edit-repository-page.text.configure-repository","Configure repository"),subTitle:(0,i.t)("provisioning.edit-repository-page.subTitle.configure-repository-storing-resources","Configure a repository for storing your resources.")},children:(0,e.jsx)(x.Y.Contents,{isLoading:t.isLoading,children:b?(0,e.jsxs)(M.p,{message:"Repository config not found",variant:"not-found",children:[(0,e.jsx)(h.E,{element:"p",children:(0,e.jsx)(i.x6,{i18nKey:"provisioning.edit-repository-page.repository-config-exists-configuration",children:"Make sure the repository config exists in the configuration file."})}),(0,e.jsx)(v.Y,{href:W.mL,children:(0,e.jsx)(i.x6,{i18nKey:"provisioning.edit-repository-page.back-to-repositories",children:"Back to repositories"})})]}):(0,e.jsx)(le,{data:t.data})})})}}}]);

//# sourceMappingURL=EditRepositoryPage.40be2f2b94465489d9d7.js.map