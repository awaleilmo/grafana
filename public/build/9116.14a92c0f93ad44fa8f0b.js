"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[4312,9116],{8402:(ie,G,t)=>{t.d(G,{DI:()=>Ae,C1:()=>$e,Ay:()=>Me});var e=t(74848),a=t(22803),D=t(96540),d=t(49785),g=t(92745),O=t(63142),s=t(41654),R=t(66404),k=t(35137),E=t(45861),I=t(37386),F=t(79233),Y=t(63527),K=t(2869),Q=t(5709);const _=Q.H.injectEndpoints({endpoints:c=>({getLabels:c.query({query:()=>({url:`/api/plugins/${K.W.Labels}/resources/v1/labels/keys`}),providesTags:["GrafanaLabels"]}),getLabelValues:c.query({query:({key:u})=>({url:`/api/plugins/${K.W.Labels}/resources/v1/labels/name/${u}`}),providesTags:["GrafanaLabels"]})})});var J=t(3986),Z=t(67817),b=t(39659),o=t(29609),y=t(43243);const v=(0,D.forwardRef)(function({onChange:u,options:A,defaultValue:p,type:m,onOpenMenu:W=()=>{},isLoading:q=!1},V){const H=(0,O.of)(C),B=f=>{f&&u({label:f.label||f.value,value:f.value,description:f.description})},U=p?{label:p.label||p.value,value:p.value,description:p.description}:void 0;return(0,e.jsx)("div",{ref:V,children:(0,e.jsx)(I.D,{disabled:!1,"data-testid":`alertlabel-${m}-picker`,className:H.resetMargin,children:(0,e.jsx)(y.G,{placeholder:(0,g.t)("alerting.alert-label-dropdown.placeholder-select","Choose {{type}}",{type:m}),width:25,options:A,value:U,onChange:B,createCustomValue:!0,"data-testid":`alertlabel-${m}-combobox`})})})}),C=()=>({resetMargin:(0,a.css)({marginBottom:0})}),T=v;var $=t(7840),w=t(25521),X=t(59672);function fe({remove:c,index:u}){return(0,e.jsx)(E.$n,{"aria-label":(0,g.t)("alerting.remove-button.aria-label-delete-label","delete label"),icon:"trash-alt","data-testid":`delete-label-${u}`,variant:"secondary",onClick:()=>{c(u)}})}function Ce({append:c}){return(0,e.jsx)(E.$n,{icon:"plus",type:"button",variant:"secondary",onClick:c,children:(0,e.jsx)(g.x6,{i18nKey:"alerting.add-button.add-more",children:"Add more"})})}const Ke=c=>{const{currentData:u,isLoading:A}=_.endpoints.getLabels.useQuery(void 0,{skip:c});return{loading:A,labelsOpsKeys:u}};function le(c=[],u){const A=new Set(u?u.map(p=>p.key):[]);return Array.from(c,p=>({label:p,value:p,disabled:A.has(p)}))}const Ae=({labels:c})=>{const u=c.reduce((A,p)=>(p.key&&(A[p.key]=p.value),A),{});return(0,e.jsx)($.m,{labels:u})};function $e({dataSourceName:c,onClose:u,initialLabels:A}){const p=(0,O.of)(ve),{watch:m}=(0,d.xW)(),W=m("type")??Z.Z.grafana,q=U=>{u(U.labelsInSubform)},V=()=>{u()},H=(0,D.useMemo)(()=>({labelsInSubform:A}),[A]),B=(0,d.mN)({defaultValues:H});return(0,e.jsx)(d.Op,{...B,children:(0,e.jsx)("form",{onSubmit:B.handleSubmit(q),children:(0,e.jsxs)(s.B,{direction:"column",gap:4,children:[(0,e.jsxs)(s.B,{direction:"column",gap:1,children:[(0,e.jsx)(R.E,{children:xe(W)}),(0,e.jsx)(R.E,{variant:"bodySmall",color:"secondary",children:Re()})]}),(0,e.jsxs)(s.B,{direction:"column",gap:1,children:[(0,e.jsx)(Le,{dataSourceName:c}),(0,e.jsx)(k.$,{v:2}),(0,e.jsx)(Ae,{labels:B.watch("labelsInSubform")}),(0,e.jsx)(k.$,{v:1}),(0,e.jsxs)("div",{className:p.confirmButton,children:[(0,e.jsx)(E.$n,{type:"button",variant:"secondary",onClick:V,children:(0,e.jsx)(g.x6,{i18nKey:"alerting.common.cancel",children:"Cancel"})}),(0,e.jsx)(E.$n,{type:"submit",children:(0,e.jsx)(g.x6,{i18nKey:"alerting.labels-sub-form.save",children:"Save"})})]})]})]})})})}const de=c=>!(0,b.F2)(c);function Se(c,u,A,p,m){const{labels:W,isLoading:q}=(0,X.DJ)(c),{loading:V,labelsOpsKeys:H=[]}=Ke(!u||A),B=(0,D.useMemo)(()=>H.reduce((i,x)=>(i[x.name]=new Set,i),{}),[H]),U=(0,D.useMemo)(()=>le(Object.keys(B).filter(de),p),[B,p]),f=(0,D.useMemo)(()=>le(Array.from(W.keys()).filter(de),p),[W,p]),ce=[{label:(0,g.t)("alerting.use-combined-labels.grouped-options.label.from-alerts","From alerts"),options:f,expanded:!0},{label:(0,g.t)("alerting.use-combined-labels.grouped-options.label.from-system","From system"),options:U,expanded:!0}],ee=W.has(m),ue=B[m]!==void 0&&B[m]?.size>0,be=!ee&&!ue,ye=!ee&&B[m]?.size>0,{currentData:n,isLoading:l=!1,error:r}=_.endpoints.getLabelValues.useQuery({key:m},{skip:!u||!m||ee||ye||be}),h=(0,D.useMemo)(()=>{if(ee)return[];const i=B[m];if(i?.size>0)return le(i);if(!l&&n?.values?.length&&!r){const L=n?.values.map(M=>M.name);return B[m]=new Set(L),le(L)}return[]},[ee,B,m,l,n,r]),S=(0,D.useCallback)(i=>de(i)?ee||!u?le(W.get(i)):h:[],[W,u,h,ee]);return{loading:q||V,keysFromExistingAlerts:f,groupedOptions:ce,getValuesForLabel:S}}function Le({dataSourceName:c}){const u=(0,O.of)(ve),{control:A,watch:p,formState:{errors:m}}=(0,d.xW)(),W=p("labelsInSubform"),{fields:q,remove:V,append:H}=(0,d.jz)({control:A,name:"labelsInSubform"}),B=(0,D.useCallback)(()=>{H({key:"",value:""})},[H]),[U,f]=(0,D.useState)(""),{installed:ce=!1,loading:ee}=(0,J._)(K.W.Labels),{loading:ue,keysFromExistingAlerts:be,groupedOptions:ye,getValuesForLabel:n}=Se(c,ce,ee,W,U),l=(0,D.useMemo)(()=>n(U),[U,n]);return(0,e.jsxs)(s.B,{direction:"column",gap:2,alignItems:"flex-start",children:[q.map((r,h)=>(0,e.jsxs)("div",{className:(0,a.cx)(u.flexRow,u.centerAlignRow),id:"hola",children:[(0,e.jsx)(I.D,{className:u.labelInput,invalid:!!m.labelsInSubform?.[h]?.key?.message,error:m.labelsInSubform?.[h]?.key?.message,"data-testid":`labelsInSubform-key-${h}`,children:(0,e.jsx)(d.xI,{name:`labelsInSubform.${h}.key`,control:A,rules:{required:W[h]?.value?"Required.":!1},render:({field:{onChange:S,ref:i,...x}})=>(0,e.jsx)(T,{...x,defaultValue:r.key?{label:r.key,value:r.key}:void 0,options:ce?ye.flatMap(L=>L.options):be,isLoading:ue,onChange:L=>{L&&(S(L.value||L.label||""),f(L.value))},type:"key"})})}),(0,e.jsx)(F.c,{className:u.equalSign,children:"="}),(0,e.jsx)(I.D,{className:u.labelInput,invalid:!!m.labelsInSubform?.[h]?.value?.message,error:m.labelsInSubform?.[h]?.value?.message,"data-testid":`labelsInSubform-value-${h}`,children:(0,e.jsx)(d.xI,{control:A,name:`labelsInSubform.${h}.value`,rules:{required:W[h]?.value?"Required.":!1},render:({field:{onChange:S,ref:i,...x}})=>(0,e.jsx)(T,{...x,defaultValue:r.value?{label:r.value,value:r.value}:void 0,options:l,isLoading:ue,onChange:L=>{L&&S(L.value||L.label||"")},onOpenMenu:()=>{f(W[h].key)},type:"value"})})}),(0,e.jsx)(fe,{index:h,remove:V})]},r.id)),(0,e.jsx)(Ce,{append:B})]})}const Pe=()=>{const c=(0,O.of)(ve),{register:u,control:A,watch:p,formState:{errors:m}}=(0,d.xW)(),W=p("labels"),{fields:q,remove:V,append:H}=(0,d.jz)({control:A,name:"labels"}),B=(0,D.useCallback)(()=>{H({key:"",value:""})},[H]);return(0,e.jsxs)(e.Fragment,{children:[q.map((U,f)=>(0,e.jsx)("div",{children:(0,e.jsxs)("div",{className:(0,a.cx)(c.flexRow,c.centerAlignRow),"data-testid":"alertlabel-input-wrapper",children:[(0,e.jsx)(I.D,{className:c.labelInput,invalid:!!m.labels?.[f]?.key?.message,error:m.labels?.[f]?.key?.message,children:(0,e.jsx)(Y.p,{...u(`labels.${f}.key`,{required:{value:!!W[f]?.value,message:(0,g.t)("alerting.labels-without-suggestions.message.required","Required.")}}),placeholder:(0,g.t)("alerting.labels-without-suggestions.placeholder-key","key"),"data-testid":`label-key-${f}`,defaultValue:U.key})}),(0,e.jsx)(F.c,{className:c.equalSign,children:"="}),(0,e.jsx)(I.D,{className:c.labelInput,invalid:!!m.labels?.[f]?.value?.message,error:m.labels?.[f]?.value?.message,children:(0,e.jsx)(Y.p,{...u(`labels.${f}.value`,{required:{value:!!W[f]?.key,message:(0,g.t)("alerting.labels-without-suggestions.message.required","Required.")}}),placeholder:(0,g.t)("alerting.labels-without-suggestions.placeholder-value","value"),"data-testid":`label-value-${f}`,defaultValue:U.value})}),(0,e.jsx)(fe,{index:f,remove:V})]})},U.id)),(0,e.jsx)(Ce,{append:B})]})};function Ue(){const{watch:c}=(0,d.xW)(),u=c("type")??Z.Z.grafana;return(0,e.jsxs)("div",{children:[(0,e.jsxs)(s.B,{direction:"column",gap:1,children:[(0,e.jsx)(R.E,{element:"h5",children:(0,e.jsx)(g.x6,{i18nKey:"alerting.labels-field.labels",children:"Labels"})}),(0,e.jsxs)(s.B,{direction:"row",gap:1,children:[(0,e.jsx)(R.E,{variant:"bodySmall",color:"secondary",children:xe(u)}),(0,e.jsx)(w.G,{externalLink:"https://grafana.com/docs/grafana/latest/alerting/fundamentals/alert-rules/annotation-label/",linkText:"Read about labels",contentText:`The dropdown only displays labels that you have previously used for alerts.
            Select a label from the options below or type in a new one.`,title:(0,g.t)("alerting.labels-field.title-labels","Labels")})]})]}),(0,e.jsx)(Pe,{})]})}function xe(c){return(c?(0,o.vE)(c):!1)?(0,g.t)("alerting.alertform.labels.recording","Add labels to your rule."):(0,g.t)("alerting.alertform.labels.alerting","Add labels to your rule for searching, silencing, or routing to a notification policy.")}function Re(){return(0,g.t)("alerting.labels-sub-form.description","Select a label key/value from the options below, or type a new one and press Enter.")}const ve=c=>({flexColumn:(0,a.css)({display:"flex",flexDirection:"column"}),flexRow:(0,a.css)({display:"flex",flexDirection:"row",justifyContent:"flex-start"}),centerAlignRow:(0,a.css)({alignItems:"center",gap:c.spacing(.5)}),equalSign:(0,a.css)({alignSelf:"flex-start",width:"28px",justifyContent:"center",margin:0}),labelInput:(0,a.css)({width:"215px",margin:0}),confirmButton:(0,a.css)({display:"flex",flexDirection:"row",gap:c.spacing(1),marginLeft:"auto"})}),Me=Ue},12266:(ie,G,t)=>{t.d(G,{e:()=>D});var e=t(74848),a=t(45861);const D=({isCollapsed:d,onToggle:g,idControlled:O,className:s,text:R,size:k="xl",...E})=>(0,e.jsx)(a.$n,{type:"button",fill:"text",variant:"secondary","aria-expanded":!d,"aria-controls":O,className:s,icon:d?"angle-right":"angle-down",onClick:()=>g(!d),...E,children:R})},20593:(ie,G,t)=>{t.d(G,{A:()=>ye});var e=t(74848),a=t(22803),D=t(1932),d=t(96540),g=t(49785),O=t(42941),s=t(92745),R=t(63142),k=t(41654),E=t(66404),I=t(63527),F=t(87105),Y=t(37386),K=t(45861),Q=t(36303),_=t(74268);let J=null;const Z=n=>{if(!J)return null;const l=(0,Q.Xc)(J,{title:(0,s.t)("alerting.ai.error-boundary.improve-annotations-button","AI Improve Annotations Button failed to load"),style:"alertbox",errorLogger:_.vV});return(0,d.createElement)(l,n)};function b(n){J=n}var o=t(95443),y=t(29609);const v=({field:n})=>{const l=(0,R.of)(C);return(0,e.jsxs)("div",{children:[(0,e.jsx)("span",{className:l.annotationTitle,children:(0,e.jsx)(s.x6,{i18nKey:"alerting.custom-annotation-header-field.custom-annotation-name-and-content",children:"Custom annotation name and content"})}),(0,e.jsx)(I.p,{placeholder:(0,s.t)("alerting.custom-annotation-header-field.placeholder-enter-custom-annotation-name","Enter custom annotation name..."),width:18,...n,className:l.customAnnotationInput})]})},C=n=>({annotationTitle:(0,a.css)({color:n.colors.text.primary,marginBottom:"3px"}),customAnnotationInput:(0,a.css)({marginTop:"5px",width:"100%"})}),T=v,w=({annotationField:n,annotations:l,annotation:r,index:h,labelId:S})=>{const{control:i}=(0,g.xW)();return(0,e.jsxs)(k.B,{direction:"column",gap:0,children:[(0,e.jsx)("label",{htmlFor:S,children:(0,e.jsx)(g.xI,{name:`annotations.${h}.key`,defaultValue:n.key,render:({field:{ref:x,...L}})=>{if(!o.J3[r])return(0,e.jsx)(T,{field:L});let M;switch(n.key){case o.YH.dashboardUID:M="Dashboard and panel";break;case o.YH.panelID:M="";break;default:M=o.J3[r]&&o.J3[r]+" (optional)"}return(0,e.jsx)("span",{"data-testid":`annotation-key-${h}`,children:(0,e.jsx)(E.E,{color:"primary",variant:"bodySmall",children:M})})},control:i,rules:{required:{value:!!l[h]?.value,message:(0,s.t)("alerting.annotation-header-field.message.required","Required.")}}})}),(0,e.jsx)(E.E,{variant:"bodySmall",color:"secondary",children:o.H8[r]})]})};var X=t(30703),fe=t(77256);const Ce=({dashboard:n,panel:l,dashboardUid:r,panelId:h,onEditClick:S,onDeleteClick:i})=>{const x=(0,R.of)(Ke),L=(0,fe.JM)(n?.uid||r),M=(0,fe.D2)(n?.uid||r,l?.id?.toString()||h);return(0,e.jsxs)("div",{className:x.container,children:[n&&(0,e.jsxs)("a",{href:L,className:x.link,target:"_blank",rel:"noreferrer","data-testid":"dashboard-annotation",children:[n.title," ",(0,e.jsx)(X.I,{name:"external-link-alt"})]}),!n&&(0,e.jsx)(E.E,{color:"secondary",children:(0,e.jsxs)(s.x6,{i18nKey:"alerting.annotations.dashboard-annotation-field.dashboard",values:{dashboardUid:r},children:["Dashboard ",{dashboardUid:r}]})}),l&&(0,e.jsxs)("a",{href:M,className:x.link,target:"_blank",rel:"noreferrer","data-testid":"panel-annotation",children:[l.title||"<No title>"," ",(0,e.jsx)(X.I,{name:"external-link-alt"})]}),!l&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("span",{children:" - "}),(0,e.jsx)(E.E,{color:"secondary",children:(0,e.jsxs)(s.x6,{i18nKey:"alerting.annotations.dashboard-annotation-field.panel",values:{panelId:h},children:["Panel ",{panelId:h}]})})]}),(n||l)&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(X.I,{name:"pen",onClick:S,className:x.icon}),(0,e.jsx)(X.I,{name:"trash-alt",onClick:i,className:x.icon})]})]})},Ke=n=>({container:(0,a.css)({marginTop:"5px"}),noLink:(0,a.css)({color:n.colors.text.secondary}),link:(0,a.css)({color:n.colors.text.link,marginRight:n.spacing(1.5)}),icon:(0,a.css)({marginRight:n.spacing(1),cursor:"pointer"})}),le=Ce;var Ae=t(2543),$e=t(40996),de=t(70713),Se=t(91793),Le=t(45967),Pe=t(22787),Ue=t(34999),xe=t(12737),Re=t(6975),ve=t(5709);const Me=ve.H.injectEndpoints({endpoints:n=>({search:n.query({query:({query:l})=>{const r=new URLSearchParams({type:"dash-db",limit:"1000",page:"1",sort:"name_sort"});return l&&r.set("query",l),{url:`/api/search?${r.toString()}`}}}),dashboard:n.query({query:({uid:l})=>({url:`/api/dashboards/uid/${l}`})})})});var c=t(41811),u=t(7817);const A=(0,c.default)(n=>{const{dashboard:l,meta:r}=structuredClone(n);return new u.G(l,r)});function p(n){return Me.endpoints.dashboard.useQuery({uid:n??""},{skip:!n,selectFromResult:({currentData:r,data:h,...S})=>({dashboardModel:r?A(r):void 0,...S})})}function m(n,l){return n.title&&l.title?n.title.localeCompare(l.title):n.title&&!l.title?1:!n.title&&l.title?-1:0}const W=({dashboardUid:n,panelId:l,isOpen:r,onChange:h,onDismiss:S})=>{const i=(0,R.of)(H),[x,L]=(0,d.useState)(n),[M,je]=(0,d.useState)(l),[De,we]=(0,d.useState)(""),[He,ge]=(0,d.useState)(""),[se,Te]=(0,d.useState)(""),{useSearchQuery:Be}=Me,{currentData:he=[],isFetching:Ee}=Be({query:He}),{dashboardModel:te,isFetching:pe}=p(x),Ge=(0,d.useCallback)(j=>{L(j),je(void 0)},[]),Oe=q(te),Ne=Oe.filter(j=>j.title?.toLowerCase().includes(se.toLowerCase())).sort(m)??[],Ie=Oe.find(j=>V(j)&&j.id?.toString()===M),me=(0,d.useMemo)(()=>he.map(j=>j.uid).indexOf(x??""),[he,x]),P=n&&n===x,N=me>=0,ne=(0,d.useCallback)(j=>{const ae=me>=0;P&&ae&&j?.scrollToItem(me,"smart")},[P,me]);(0,$e.A)(()=>{ge(De)},500,[De]);const oe=({index:j,style:ae})=>{const z=he[j],Fe=x===z.uid;return(0,e.jsxs)("button",{type:"button",title:z.title,style:ae,className:(0,a.cx)(i.rowButton,{[i.rowOdd]:j%2===1,[i.rowSelected]:Fe}),onClick:()=>Ge(z.uid),children:[(0,e.jsx)("div",{className:(0,a.cx)(i.dashboardTitle,i.rowButtonTitle),children:z.title}),(0,e.jsxs)("div",{className:i.dashboardFolder,children:[(0,e.jsx)(X.I,{name:"folder"})," ",z.folderTitle??"Dashboards"]})]})},re=({index:j,style:ae})=>{const z=Ne[j],Fe=z.title||"<No title>",ze=!!z.id&&M===z.id,Ye=z.type==="graph"||z.type==="timeseries",We=!V(z);return(0,e.jsxs)("button",{type:"button",style:ae,disabled:We,className:(0,a.cx)(i.rowButton,i.panelButton,{[i.rowOdd]:j%2===1,[i.rowSelected]:ze}),onClick:()=>We?Ae.noop:je(z.id),children:[(0,e.jsx)("div",{className:i.rowButtonTitle,title:Fe,children:Fe}),!Ye&&!We&&(0,e.jsx)(Le.m,{content:(0,s.t)("alerting.dashboard-picker.panel-row.tooltip-alert-tab-support","The alert tab and alert annotations are only supported on graph and timeseries panels."),children:(0,e.jsx)(X.I,{name:"exclamation-triangle",className:i.warnIcon,"data-testid":"warning-icon"})}),We&&(0,e.jsx)(Le.m,{content:(0,s.t)("alerting.dashboard-picker.panel-row.content-panel-valid-identifier","This panel does not have a valid identifier."),children:(0,e.jsx)(X.I,{name:"info-circle","data-testid":"info-icon"})})]})},ke=(0,s.t)("alerting.dashboard-picker.fallback-dashboards-string","Dashboards");return(0,e.jsxs)(Pe.a,{title:(0,s.t)("alerting.dashboard-picker.title-select-dashboard-and-panel","Select dashboard and panel"),closeOnEscape:!0,isOpen:r,onDismiss:S,className:i.modal,contentClassName:i.modalContent,children:[!N&&n&&te&&(0,e.jsxs)(Ue.F,{title:(0,s.t)("alerting.dashboard-picker.title-current-selection","Current selection"),severity:"info",topSpacing:0,bottomSpacing:1,className:i.modalAlert,children:[(0,e.jsx)("div",{children:(0,e.jsxs)(s.x6,{i18nKey:"alerting.dashboard-picker.current-selection-dashboard",values:{dashboardTitle:te.title,dashboardUid:te.uid,folderTitle:te.meta?.folderTitle??ke},children:["Dashboard: ","{{dashboardTitle}}"," (","{{ dashboardUid }}",") in folder ","{{ folderTitle }}"]})}),Ie&&(0,e.jsx)("div",{children:(0,e.jsxs)(s.x6,{i18nKey:"alerting.dashboard-picker.current-selection-panel",values:{panelTitle:Ie.title,panelId:Ie.id},children:["Panel: ","{{ panelTitle }}"," (","{{ panelId }}",")"]})})]}),(0,e.jsxs)("div",{className:i.container,children:[(0,e.jsx)(xe.Z,{value:De,onChange:we,title:(0,s.t)("alerting.dashboard-picker.title-search-dashboard","Search dashboard"),placeholder:(0,s.t)("alerting.dashboard-picker.placeholder-search-dashboard","Search dashboard"),autoFocus:!0}),(0,e.jsx)(xe.Z,{value:se,onChange:Te,title:(0,s.t)("alerting.dashboard-picker.title-search-panel","Search panel"),placeholder:(0,s.t)("alerting.dashboard-picker.placeholder-search-panel","Search panel")}),(0,e.jsxs)("div",{className:i.column,children:[Ee&&(0,e.jsx)(Re._,{text:(0,s.t)("alerting.dashboard-picker.text-loading-dashboards","Loading dashboards..."),className:i.loadingPlaceholder}),!Ee&&(0,e.jsx)(de.Ay,{children:({height:j,width:ae})=>(0,e.jsx)(Se.Y1,{ref:ne,itemSize:50,height:j,width:ae,itemCount:he.length,children:oe})})]}),(0,e.jsxs)("div",{className:i.column,children:[!x&&!pe&&(0,e.jsx)("div",{className:i.selectDashboardPlaceholder,children:(0,e.jsx)("div",{children:(0,e.jsx)(s.x6,{i18nKey:"alerting.dashboard-picker.select-dashboard-available-panels",children:"Select a dashboard to get a list of available panels"})})}),pe&&(0,e.jsx)(Re._,{text:(0,s.t)("alerting.dashboard-picker.text-loading-dashboard","Loading dashboard..."),className:i.loadingPlaceholder}),x&&!pe&&(0,e.jsx)(de.Ay,{children:({width:j,height:ae})=>(0,e.jsx)(Se.Y1,{itemSize:32,height:ae,width:j,itemCount:Ne.length,children:re})})]})]}),(0,e.jsxs)(Pe.a.ButtonRow,{children:[(0,e.jsx)(K.$n,{type:"button",variant:"secondary",onClick:S,fill:"text",children:(0,e.jsx)(s.x6,{i18nKey:"alerting.common.cancel",children:"Cancel"})}),(0,e.jsx)(K.$n,{type:"button",variant:"primary",disabled:!(x&&M),onClick:()=>{x&&M&&h(x,M)},children:(0,e.jsx)(s.x6,{i18nKey:"alerting.dashboard-picker.confirm",children:"Confirm"})})]})]})};function q(n){if(!n)return[];const l=n.panels.filter(S=>S.type!=="row"),r=n.panels.filter(S=>S.collapsed).flatMap(S=>S.panels??[]);return[...l,...r]}const V=n=>{const l=typeof n.id=="number",r=typeof n.type=="string",h="libraryPanel"in n;return l&&(r||h)},H=n=>{const l=(0,K.my)(n);return{container:(0,a.css)({display:"grid",gridTemplateColumns:"1fr 1fr",gridTemplateRows:"min-content auto",gap:n.spacing(2),flex:1}),column:(0,a.css)({flex:"1 1 auto"}),dashboardTitle:(0,a.css)({height:"22px",fontWeight:n.typography.fontWeightBold}),dashboardFolder:(0,a.css)({height:"20px",fontSize:n.typography.bodySmall.fontSize,color:n.colors.text.secondary,display:"flex",flexDirection:"row",justifyContent:"flex-start",columnGap:n.spacing(1),alignItems:"center"}),rowButton:(0,a.css)(l,{padding:n.spacing(.5),overflow:"hidden",textOverflow:"ellipsis",textAlign:"left",whiteSpace:"nowrap",cursor:"pointer",border:"2px solid transparent","&:disabled":{cursor:"not-allowed",color:n.colors.text.disabled}}),rowButtonTitle:(0,a.css)({textOverflow:"ellipsis",overflow:"hidden"}),rowSelected:(0,a.css)({borderColor:n.colors.primary.border}),rowOdd:(0,a.css)({backgroundColor:n.colors.background.secondary}),panelButton:(0,a.css)({display:"flex",gap:n.spacing(1),justifyContent:"space-between",alignItems:"center"}),loadingPlaceholder:(0,a.css)({height:"100%",display:"flex",justifyContent:"center",alignItems:"center"}),selectDashboardPlaceholder:(0,a.css)({width:"100%",height:"100%",display:"flex",flexDirection:"column",justifyContent:"center",textAlign:"center",fontWeight:n.typography.fontWeightBold}),modal:(0,a.css)({height:"100%"}),modalContent:(0,a.css)({flex:1,display:"flex",flexDirection:"column"}),modalAlert:(0,a.css)({flexGrow:0}),warnIcon:(0,a.css)({fill:n.colors.warning.main})}};var B=t(25521),U=t(58872);let f=null;const ce=n=>{if(!f)return null;const l=(0,Q.Xc)(f,{title:(0,s.t)("alerting.enrichment.error-boundary.notification-message-section-extension","Notification Message Section Extension failed to load"),style:"alertbox",errorLogger:_.vV});return(0,e.jsx)(l,{...n})};function ee(n){f=n}const ue=()=>{const n=(0,R.of)(be),[l,r]=(0,O.A)(!1),{control:h,register:S,watch:i,formState:{errors:x},setValue:L}=(0,g.xW)(),M=i("annotations"),je=i("type"),{fields:De,append:we,remove:He}=(0,g.jz)({control:h,name:"annotations"}),ge=M.find(P=>P.key===o.YH.dashboardUID)?.value,se=Number(M.find(P=>P.key===o.YH.panelID)?.value),[Te,Be]=(0,d.useState)(void 0),[he,Ee]=(0,d.useState)(void 0),{dashboardModel:te,isFetching:pe}=p(ge);(0,d.useEffect)(()=>{if(pe||!te)return;Be(te);const N=q(te).find(ne=>ne.id===se);Ee(N)},[se,te,pe]);const Ge=(P,N)=>{const ne=(0,D.jM)(M,oe=>{const re=oe.find(j=>j.key===o.YH.dashboardUID),ke=oe.find(j=>j.key===o.YH.panelID);re?re.value=P:oe.push({key:o.YH.dashboardUID,value:P}),ke?ke.value=N.toString():oe.push({key:o.YH.panelID,value:N.toString()})});L("annotations",ne),r(!1)},Oe=()=>{const P=M.filter(N=>N.key!==o.YH.dashboardUID&&N.key!==o.YH.panelID);L("annotations",P),Be(void 0),Ee(void 0)},Ne=()=>{r(!0)};function Ie(){return(0,e.jsxs)(k.B,{direction:"row",gap:.5,alignItems:"center",children:[(0,e.jsx)(E.E,{variant:"bodySmall",color:"secondary",children:(0,e.jsx)(s.x6,{i18nKey:"alerting.annotations.description",children:"Add more context to your alert notifications."})}),(0,e.jsx)(B.G,{externalLink:"https://grafana.com/docs/grafana/latest/alerting/fundamentals/alert-rules/annotation-label/#annotations",linkText:"Read about annotations",contentText:(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("p",{children:(0,s.t)("alerting.rule-form.annotations.description1","Annotations add additional information to alerts, helping alert responders identify and address potential issues.")}),(0,e.jsx)("p",{children:(0,s.t)("alerting.rule-form.annotations.description2","For example, add a Summary annotation to tell you which value caused the alert to fire or which server it happened on.")}),(0,s.t)("alerting.rule-form.annotations.description3","Annotations can contain a combination of text and template code, which is used to include data from queries.")]}),title:(0,s.t)("alerting.annotations-step.get-annotations-section-description.title-annotations","Annotations")})]})}const me=(0,y.H2)(je)?6:5;return(0,e.jsx)(U.P,{stepNo:me,title:(0,s.t)("alerting.annotations.title","Configure notification message"),description:Ie(),fullWidth:!0,children:(0,e.jsxs)(k.B,{direction:"column",gap:1,children:[(0,y.H2)(je)&&(0,e.jsx)(Z,{}),De.map((P,N)=>{const ne=M[N]?.key?.toLocaleLowerCase().endsWith("url"),oe=ne?I.p:F.f,re=P.key;return(0,e.jsx)("div",{className:n.flexRow,children:(0,e.jsxs)("div",{children:[(0,e.jsx)(w,{annotationField:P,annotations:M,annotation:re,index:N,labelId:`annotation-${N}`}),ge&&se&&P.key===o.YH.dashboardUID&&(0,e.jsx)(le,{dashboard:Te,panel:he,dashboardUid:ge.toString(),panelId:se.toString(),onEditClick:Ne,onDeleteClick:Oe}),(0,e.jsxs)("div",{className:n.annotationValueContainer,children:[(0,e.jsx)(Y.D,{hidden:P.key===o.YH.dashboardUID||P.key===o.YH.panelID,className:(0,a.cx)(n.flexRowItemMargin,n.field),invalid:!!x.annotations?.[N]?.value?.message,error:x.annotations?.[N]?.value?.message,noMargin:!0,children:(0,e.jsx)(oe,{"data-testid":`annotation-value-${N}`,id:`annotation-${N}`,className:(0,a.cx)(n.annotationValueInput,{[n.textarea]:!ne}),...S(`annotations.${N}.value`),placeholder:ne?"https://":P.key&&(0,s.t)("alerting.annotations-step.placeholder-value-input","Enter a {{key}}...",{key:P.key})||(0,s.t)("alerting.annotations-step.placeholder-value-input-default","Enter custom annotation content..."),defaultValue:P.value})}),!o.J3[re]&&(0,e.jsx)(K.$n,{type:"button",className:n.deleteAnnotationButton,"aria-label":(0,s.t)("alerting.annotations-step.aria-label-delete-annotation","delete annotation"),icon:"trash-alt",variant:"secondary",onClick:()=>He(N)})]})]})},P.id)}),(0,e.jsx)(k.B,{direction:"row",gap:1,children:(0,e.jsxs)("div",{className:n.addAnnotationsButtonContainer,children:[(0,e.jsx)(K.$n,{icon:"plus",type:"button",variant:"secondary",onClick:()=>{we({key:"",value:""})},children:(0,e.jsx)(s.x6,{i18nKey:"alerting.annotations-step.add-custom-annotation",children:"Add custom annotation"})}),!Te&&(0,e.jsx)(K.$n,{type:"button",variant:"secondary",icon:"dashboard",onClick:()=>r(!0),children:(0,e.jsx)(s.x6,{i18nKey:"alerting.annotations-step.link-dashboard-and-panel",children:"Link dashboard and panel"})})]})}),l&&(0,e.jsx)(W,{isOpen:!0,dashboardUid:ge,panelId:se,onChange:Ge,onDismiss:()=>r(!1)}),(0,e.jsx)(ce,{})]})})},be=n=>({annotationValueInput:(0,a.css)({width:"394px"}),textarea:(0,a.css)({height:"76px"}),addAnnotationsButtonContainer:(0,a.css)({marginTop:n.spacing(1),gap:n.spacing(1),display:"flex"}),field:(0,a.css)({marginBottom:n.spacing(.5)}),flexRow:(0,a.css)({display:"flex",flexDirection:"row",justifyContent:"flex-start"}),flexRowItemMargin:(0,a.css)({marginTop:n.spacing(1)}),deleteAnnotationButton:(0,a.css)({display:"inline-block",marginTop:"10px",marginLeft:"10px"}),annotationTitle:(0,a.css)({color:n.colors.text.primary,marginBottom:"3px"}),annotationContainer:(0,a.css)({marginTop:"5px"}),annotationDescription:(0,a.css)({color:n.colors.text.secondary}),annotationValueContainer:(0,a.css)({display:"flex"})}),ye=ue},25521:(ie,G,t)=>{t.d(G,{G:()=>k});var e=t(74848),a=t(22803),D=t(92745),d=t(30703),g=t(59243),O=t(66404),s=t(41654),R=t(63142);function k({contentText:I,externalLink:F,linkText:Y,title:K="Need help?"}){const Q=(0,R.of)(E);return(0,e.jsx)(g.G,{content:(0,e.jsx)("div",{className:Q.mutedText,children:I}),title:(0,e.jsxs)(s.B,{gap:.5,direction:"row",alignItems:"center",children:[(0,e.jsx)(d.I,{name:"question-circle"}),K]}),footer:F?(0,e.jsx)("a",{href:F,target:"_blank",rel:"noreferrer",children:(0,e.jsx)(s.B,{direction:"row",gap:.5,alignItems:"center",children:(0,e.jsxs)(O.E,{color:"link",children:[Y," ",(0,e.jsx)(d.I,{size:"sm",name:"external-link-alt"})]})})}):void 0,closeButton:!0,placement:"bottom-start",children:(0,e.jsx)("div",{className:Q.helpInfo,children:(0,e.jsxs)(s.B,{direction:"row",alignItems:"center",gap:.5,children:[(0,e.jsx)(d.I,{name:"question-circle",size:"sm"}),(0,e.jsx)(O.E,{variant:"bodySmall",color:"primary",children:(0,e.jsx)(D.x6,{i18nKey:"alerting.need-help-info.need-help",children:"Need help?"})})]})})})}const E=I=>({mutedText:(0,a.css)({color:I.colors.text.secondary,fontSize:I.typography.size.sm}),helpInfo:(0,a.css)({cursor:"pointer",textDecoration:"underline"})})},58872:(ie,G,t)=>{t.d(G,{P:()=>E});var e=t(74848),a=t(22803),D=t(51898),d=t(92745),g=t(66404),O=t(41654),s=t(16780),R=t(21285),k=t(63142);const E=({title:F,stepNo:Y,children:K,fullWidth:Q=!1,description:_,switchMode:J})=>{const Z=(0,k.of)(I),b=D.Tp.components.AlertRules;return(0,e.jsx)("div",{className:Z.parent,"data-testid":b.step(Y.toString()),children:(0,e.jsx)(s.n,{className:(0,a.cx)(Q&&Z.fullWidth),label:(0,e.jsxs)(O.B,{direction:"row",alignItems:"center",justifyContent:"space-between",children:[(0,e.jsxs)(g.E,{variant:"h3",children:[Y,". ",F]}),J&&(0,e.jsx)(g.E,{variant:"bodySmall",children:(0,e.jsx)(R.K,{"data-testid":b.stepAdvancedModeSwitch(Y.toString()),value:J.isAdvancedMode,onChange:o=>{J.setAdvancedMode(o.currentTarget.checked)},label:(0,d.t)("alerting.rule-editor-section.label-advanced-options","Advanced options"),showLabel:!0,transparent:!0,className:Z.reverse})})]}),children:(0,e.jsxs)(O.B,{direction:"column",children:[_&&(0,e.jsx)("div",{className:Z.description,children:_}),K]})})})},I=F=>({parent:(0,a.css)({display:"flex",flexDirection:"row",border:`solid 1px ${F.colors.border.weak}`,borderRadius:F.shape.radius.default,padding:`${F.spacing(2)} ${F.spacing(3)}`}),description:(0,a.css)({marginTop:`-${F.spacing(2)}`}),fullWidth:(0,a.css)({width:"100%"}),reverse:(0,a.css)({flexDirection:"row-reverse",gap:F.spacing(1)})})},59672:(ie,G,t)=>{t.d(G,{$i:()=>Y,DJ:()=>F,h$:()=>K});var e=t(29189),a=t(96540),D=t(70327),d=t(55143),g=t(74869);const{usePrometheusRuleNamespacesQuery:O,useLazyRulerRulesQuery:s,useRulerRulesQuery:R}=D.hK,{useDiscoverDsFeaturesQuery:k}=d.L,E={},I=(0,g.wS)();function F(b){const{data:o,isLoading:y}=k({rulesSourceName:b}),[v,{data:C=E,isLoading:T}]=s(),{data:$=[],isLoading:w}=O({ruleSourceName:b},{skip:!I});return(0,a.useEffect)(()=>{o?.rulerConfig&&!I&&v({rulerConfig:o.rulerConfig},!0)},[o?.rulerConfig,v]),{labels:(0,a.useMemo)(()=>w||T?new Map:I?J($):Z(C),[$,C,w,T]),isLoading:w||T||y}}function Y(b){const{data:o,isLoading:y}=k(b?{rulesSourceName:b}:e.hT,{skip:!b}),[v,{data:C=E,isLoading:T}]=s(),{data:$=[],isLoading:w}=O(b&&I?{ruleSourceName:b}:e.hT);return(0,a.useEffect)(()=>{o?.rulerConfig&&!I&&v({rulerConfig:o.rulerConfig})},[o?.rulerConfig,v]),{namespaceGroups:(0,a.useMemo)(()=>w||T?new Map:I?Q($):_(C),[$,C,w,T]),isLoading:w||T||y,promNamespaces:$}}function K(b){const{data:o,isLoading:y}=k(b?{rulesSourceName:b}:e.hT),{data:v=E,isLoading:C}=R(o?.rulerConfig?{rulerConfig:o.rulerConfig}:e.hT);return{isLoading:C||y,rulerRules:v}}function Q(b){const o=new Map;return b.forEach(y=>{o.set(y.name,y.groups.map(v=>v.name))}),o}function _(b){const o=new Map;return Object.entries(b).forEach(([y,v])=>{o.set(y,v.map(C=>C.name))}),o}function J(b){return b.flatMap(y=>y.groups).flatMap(y=>y.rules).reduce((y,v)=>(v.labels&&Object.entries(v.labels).forEach(([C,T])=>{if(!C||!T)return;const $=y.get(C);$?$.add(T):y.set(C,new Set([T]))}),y),new Map)}function Z(b){const o=new Map;return Object.entries(b).flatMap(([v,C])=>C).flatMap(v=>v.rules).reduce((v,C)=>(C.labels&&Object.entries(C.labels).forEach(([T,$])=>{if(!T||!$)return;const w=v.get(T);w?w.add($):v.set(T,new Set([$]))}),v),o)}},70654:(ie,G,t)=>{t.d(G,{b:()=>O});var e=t(96540),a=t(92745),D=t(36303),d=t(74268);let g=null;const O=R=>{if(!g)return null;const k=(0,D.Xc)(g,{title:(0,a.t)("alerting.ai.error-boundary.feedback-button","AI Feedback Button failed to load"),style:"alertbox",errorLogger:d.vV}),E={shouldShowFeedbackButton:!0,useRouteDetection:!1,...R};return(0,e.createElement)(k,E)};function s(R){g=R}}}]);

//# sourceMappingURL=9116.14a92c0f93ad44fa8f0b.js.map