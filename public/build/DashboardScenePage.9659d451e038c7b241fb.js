"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[8638],{21819:(R,p,e)=>{e.r(p),e.d(p,{DashboardScenePage:()=>G,default:()=>X});var n=e(74848),a=e(96540),t=e(54148),o=e(84596),v=e(75683),s=e(36490),h=e(45863),f=e(31286),x=e(13791),T=e(11098),U=e(99362),c=e(54767),m=e(72017),g=e(6262),E=e(22803),l=e(92745),P=e(8515),L=e(63142),B=e(22787),A=e(45861),V=e(83560),N=e(15130),$=e(17732),W=e(8285);const z=(0,a.memo)(({dashboard:r})=>{const D=(0,a.useMemo)(()=>s.Ny.getLocation().pathname,[r]),{showModal:M,hideModal:u}=(0,a.useContext)(P.wE);(0,a.useEffect)(()=>{const i=d=>{F(r)||r.state.isDirty&&(d.preventDefault(),d.returnValue="")};return window.addEventListener("beforeunload",i),()=>window.removeEventListener("beforeunload",i)},[r]);const y=i=>{const d=r.state.editPanel,j=d?.getPanel(),S=new URLSearchParams(i.search);if(d&&j&&(0,W.ME)(j)&&d.state.isDirty&&!S.has("editPanel")){const O=(0,W.iL)(j);return M($.Z,{dashboard:r,isUnsavedPrompt:!0,libraryPanel:O,onConfirm:()=>{d.onConfirmSaveLibraryPanel(),u(),I(i)},onDiscard:()=>{d.onDiscard(),u(),I(i)},onDismiss:u}),!1}return D===i.pathname||F(r)||!r.state.isDirty?!0:(M(w,{dashboard:r,onSaveDashboardClick:()=>{u(),r.openSaveDrawer({onSaveSuccess:()=>{I(i)}})},onDiscard:()=>{r.exitEditMode({skipConfirm:!0}),u(),I(i)},onDismiss:u}),!1)};return(0,n.jsx)(V.X,{when:!0,message:y})});z.displayName="DashboardPrompt";function I(r){r&&setTimeout(()=>s.Ny.push(r),10)}const w=({onDiscard:r,onDismiss:D,onSaveDashboardClick:M})=>{const u=(0,L.of)(Q);return(0,n.jsxs)(B.a,{isOpen:!0,title:(0,l.t)("dashboard-scene.unsaved-changes-modal.title-unsaved-changes","Unsaved changes"),onDismiss:D,icon:"exclamation-triangle",className:u.modal,children:[(0,n.jsx)("h5",{children:(0,n.jsx)(l.x6,{i18nKey:"dashboard-scene.unsaved-changes-modal.changes",children:"Do you want to save your changes?"})}),(0,n.jsxs)(B.a.ButtonRow,{children:[(0,n.jsx)(A.$n,{variant:"secondary",onClick:D,fill:"outline",children:(0,n.jsx)(l.x6,{i18nKey:"dashboard-scene.unsaved-changes-modal.cancel",children:"Cancel"})}),(0,n.jsx)(A.$n,{variant:"destructive",onClick:r,children:(0,n.jsx)(l.x6,{i18nKey:"dashboard-scene.unsaved-changes-modal.discard",children:"Discard"})}),(0,n.jsx)(A.$n,{onClick:M,children:(0,n.jsx)(l.x6,{i18nKey:"dashboard-scene.unsaved-changes-modal.save-dashboard",children:"Save dashboard"})})]})]})},Q=()=>({modal:(0,E.css)({width:"500px"})});function F(r){if(!r?.getInitialSaveModel()||r?.state.meta.version===0||!N.TP.isSignedIn||!r)return!0;const{canSave:M,fromScript:u,fromFile:y}=r.state.meta;return!N.TP.isEditor&&!M?!0:!M||u||y}var Z=e(17788),Y=e(41644);function G({route:r,queryParams:D,location:M}){const u=(0,t.g)(),{type:y,slug:i,uid:d}=u,j=u["*"],S=(0,o.A)({params:u}),O=(0,Y.sP)(),{dashboard:C,isLoading:J,loadError:H}=O.useState(),k=M.state?.routeReloadCounter,b=(0,a.useRef)(u);if((0,a.useEffect)(()=>(r.routeName===g.Z4.Normal&&y==="snapshot"?O.loadSnapshot(i):O.loadDashboard({uid:(r.routeName===g.Z4.Provisioning?j:d)??"",type:y,slug:i,route:r.routeName,urlFolderUid:D.folderUid}),()=>{(0,c.S)().cancelProfile(),(0,Z.zf)(s.Ny.getSearch(),d),O.clearState(),O.resetActiveManager()}),[O,d,r.routeName,D.folderUid,k,y]),(0,a.useEffect)(()=>{if(r.routeName===g.Z4.Normal&&d===b.current.uid&&b.current.slug&&!i){const K=`/d/${d}/${b.current.slug}`;s.Ny.replace({...s.Ny.getLocation(),pathname:K})}return()=>{b.current={uid:d,slug:i||b.current.slug}}},[r,i,y,d]),!C){let K;return H&&(K=(0,n.jsx)(U.i,{error:H,type:y})),K||(0,n.jsx)(x.Y,{navId:"dashboards/browse",layout:v.k.Canvas,"data-testid":"dashboard-scene-page",children:(0,n.jsx)(f.a,{paddingY:4,display:"flex",direction:"column",alignItems:"center",children:J&&(0,n.jsx)(T.A,{})})})}return y!=="snapshot"&&(!S||d!==S?.params.uid)?(console.log("skipping rendering"),null):(0,n.jsxs)(h.$L,{scene:C,updateUrlOnInit:!0,createBrowserHistorySteps:!0,children:[(0,n.jsx)(m.h,{queryParams:D,route:r.routeName,slug:i,path:j}),(0,n.jsx)(C.Component,{model:C},C.state.key),(0,n.jsx)(z,{dashboard:C})]})}const X=G},72017:(R,p,e)=>{e.d(p,{h:()=>U,s:()=>x});var n=e(74848),a=e(92745),t=e(43173),o=e(34999),v=e(83793),s=e(96727),h=e(6262),f=e(79205);const x={severity:"info",style:{flex:0}};function T({queryParams:c,slug:m,path:g}){const{prURL:E}=(0,s.H)(),l=(0,v.Kw)({name:m,path:g,ref:c.ref});if(l.data?.errors)return(0,n.jsx)(o.F,{title:(0,a.t)("dashboard-scene.dashboard-preview-banner.title-error-loading-dashboard","Error loading dashboard"),severity:"error",style:{flex:0},children:l.data.errors.map((L,B)=>(0,n.jsx)("div",{children:L},B))});if(E?.length)return(0,n.jsx)(f.G,{prParam:E,isNewPr:!0});const P=l.data?.urls?.newPullRequestURL??l.data?.urls?.compareURL;return P?(0,n.jsx)(f.G,{prParam:P}):(0,n.jsx)(o.F,{...x,title:(0,a.t)("dashboard-scene.dashboard-preview-banner.title-dashboard-loaded-external-repository","This dashboard is loaded from an external repository"),children:(0,n.jsx)(a.x6,{i18nKey:"dashboard-scene.dashboard-preview-banner.not-yet-saved",children:"The value is not saved in the Grafana database"})})}function U({queryParams:c,route:m,slug:g,path:E}){return!t.$.featureToggles.provisioning||"kiosk"in c||!E||m!==h.Z4.Provisioning||!g?null:(0,n.jsx)(T,{queryParams:c,slug:g,path:E})}},79205:(R,p,e)=>{e.d(p,{G:()=>T});var n=e(74848),a=e(63704),t=e(92745),o=e(34999),v=e(41654),s=e(30703);const h={github:"GitHub",gitlab:"GitLab",bitbucket:"Bitbucket",git:"Git",local:"Local"};var f=e(96727),x=e(72017);function T({prParam:c,isNewPr:m,behindBranch:g,repoUrl:E}){const{repoType:l}=(0,f.H)(),P=U(l)?h[l]:"repository",L=m?(0,t.t)("provisioned-resource-preview-banner.title-created-branch-in-repo","A new resource has been created in a branch in {{repoType}}.",{repoType:P}):(0,t.t)("provisioned-resource-preview-banner.title-loaded-pull-request-in-repo","This resource is loaded from the branch you just created in {{repoType}} and it is only visible to you",{repoType:P});return g?(0,n.jsx)(o.F,{...x.s,buttonContent:(0,n.jsxs)(v.B,{alignItems:"center",children:[(0,t.t)("provisioned-resource-preview-banner.preview-banner.open-in-repo-button","Open in {{repoType}}",{repoType:P}),(0,n.jsx)(s.I,{name:"external-link-alt"})]}),title:(0,t.t)("provisioned-resource-preview-banner.preview-banner.behind-branch-text","This resource is behind the branch in {{repoType}}.",{repoType:P}),onRemove:E?()=>window.open(a.sQ.sanitizeUrl(E),"_blank"):void 0,children:(0,n.jsxs)(t.x6,{i18nKey:"provisioned-resource-preview-banner.preview-banner.view-in-repo-button",values:{repoType:P},children:["View it in ",{repoType:l}," to see the latest changes."]})}):(0,n.jsx)(o.F,{...x.s,title:L,buttonContent:(0,n.jsxs)(v.B,{alignItems:"center",children:[m?(0,t.t)("provisioned-resource-preview-banner.preview-banner.open-pull-request-in-repo","Open pull request in {{repoType}}",{repoType:P}):(0,t.t)("provisioned-resource-preview-banner.preview-banner.view-pull-request-in-repo","View pull request in {{repoType}}",{repoType:P}),(0,n.jsx)(s.I,{name:"external-link-alt"})]}),onRemove:c?()=>window.open(a.sQ.sanitizeUrl(c),"_blank"):void 0,children:(0,n.jsx)(t.x6,{i18nKey:"provisioned-resource-preview-banner.preview-banner.not-saved",children:"The rest of Grafana users in your organization will still see the current version saved to configured default branch until this branch is merged"})})}function U(c){return typeof c!="string"?!1:c in h}},83560:(R,p,e)=>{e.d(p,{X:()=>t});var n=e(96540),a=e(36490);const t=({message:o,when:v=!0})=>{const s=a.Ny.getHistory();return(0,n.useEffect)(()=>{if(!v)return;const h=s.block(o);return()=>{h()}},[v,o,s]),null}},96727:(R,p,e)=>{e.d(p,{H:()=>t});var n=e(63704),a=e(74101);const t=()=>{const[o]=(0,a.z)(),v=o.get("pull_request_url"),s=o.get("new_pull_request_url"),h=o.get("repo_url"),f=o.get("repo_type");return{prURL:v?n.sQ.sanitizeUrl(v):void 0,newPrURL:s?n.sQ.sanitizeUrl(s):void 0,repoURL:h?n.sQ.sanitizeUrl(h):void 0,repoType:f?n.sQ.sanitizeUrl(f):void 0}}},99362:(R,p,e)=>{e.d(p,{i:()=>x});var n=e(74848),a=e(75683),t=e(92745),o=e(34999),v=e(31286),s=e(13791),h=e(1506),f=e(47797);function x({error:T,type:U}){const c=(0,f.do)(T),m=(0,f.q6)(T),g=U==="snapshot"?"Snapshot":"Dashboard";return(0,n.jsx)(s.Y,{navId:"dashboards/browse",layout:a.k.Canvas,pageNav:{text:(0,t.t)("dashboard.dashboard-page-error.text.not-found","Not found")},children:(0,n.jsx)(v.a,{paddingY:4,display:"flex",direction:"column",alignItems:"center",children:c===404?(0,n.jsx)(h.L,{entity:g}):(0,n.jsx)(o.F,{title:(0,t.t)("dashboard.errors.failed-to-load","Failed to load dashboard"),severity:"error","data-testid":"dashboard-page-error",children:m})})})}}}]);

//# sourceMappingURL=DashboardScenePage.9659d451e038c7b241fb.js.map