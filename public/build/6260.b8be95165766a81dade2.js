(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[6260],{2174:(ce,N,h)=>{"use strict";h.d(N,{j:()=>_});var S=h(92908),d=h(64878);function _(e){return(0,S.N)(function(I,C){var G=!1,Z=0;I.subscribe((0,d._)(C,function(z){return(G||(G=!e(z,Z++)))&&C.next(z)}))})}},20559:ce=>{"use strict";var N="<implicit>";ce.exports=function h(S){if(!S)return"";var d="";return S.start!=null&&(d+=(S.parenthesized?"(":"")+S.start+" "),S.field&&S.field!==N&&(d+=S.field+":"),S.left&&(S.parenthesized&&!S.start&&(d+="("),d+=h(S.left),S.parenthesized&&!S.right&&(d+=")")),S.operator&&(S.left&&(d+=" "),S.operator!==N&&(d+=S.operator)),S.right&&(S.operator&&S.operator!==N&&(d+=" "),d+=h(S.right),S.parenthesized&&(d+=")")),(S.term||S.term===""&&S.quoted)&&(S.prefix&&(d+=S.prefix),S.quoted?(d+='"',d+=S.term,d+='"'):S.regex?(d+="/",d+=S.term,d+="/"):d+=S.term,S.proximity!=null&&(d+="~"+S.proximity),S.boost!=null&&(d+="^"+S.boost)),S.term_min&&(S.inclusive==="both"||S.inclusive==="left"?d+="[":d+="{",d+=S.term_min,d+=" TO ",d+=S.term_max,S.inclusive==="both"||S.inclusive==="right"?d+="]":d+="}"),S.similarity&&(d+="~",S.similarity!==.5&&(d+=S.similarity)),d}},27487:(ce,N)=>{N.escape=function(_){return _.replace(/[\+\-\!\(\)\{\}\[\]\^\"\?\:\\\&\|\'\/\s\*\~]/g,h)};function h(d){return"\\"+d}N.unescape=function(_){return _.replace(/\\([\+\-\!\(\)\{\}\[\]\^\"\?\:\\\&\|\'\/\s\*\~])/g,S)};function S(d,_){return _}N.escapePhrase=function(_){return _.replace(/"/g,h)},N.unescapePhrase=function(_){return _.replace(/\\(")/g,S)}},51553:(ce,N,h)=>{"use strict";h.d(N,{c:()=>C});var S=h(31635),d=h(58307),_=h(98820),e=h(72316),I=h(98581);function C(G,Z,z,se,T){var b,F,J,ae;arguments.length===1?(b=G,ae=b.initialState,Z=b.condition,z=b.iterate,F=b.resultSelector,J=F===void 0?d.D:F,T=b.scheduler):(ae=G,!se||(0,_.m)(se)?(J=d.D,T=se):J=se);function ye(){var B;return(0,S.__generator)(this,function(ue){switch(ue.label){case 0:B=ae,ue.label=1;case 1:return!Z||Z(B)?[4,J(B)]:[3,4];case 2:ue.sent(),ue.label=3;case 3:return B=z(B),[3,1];case 4:return[2]}})}return(0,e.v)(T?function(){return(0,I.S)(ye(),T)}:ye)}},72316:(ce,N,h)=>{"use strict";h.d(N,{v:()=>_});var S=h(88483),d=h(15964);function _(e){return new S.c(function(I){(0,d.Tg)(e()).subscribe(I)})}},79148:ce=>{"use strict";function N(d,_){function e(){this.constructor=d}e.prototype=_.prototype,d.prototype=new e}function h(d,_,e,I){this.message=d,this.expected=_,this.found=e,this.location=I,this.name="SyntaxError",typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,h)}N(h,Error),h.buildMessage=function(d,_){var e={literal:function(T){return'"'+C(T.text)+'"'},class:function(T){var b="",F;for(F=0;F<T.parts.length;F++)b+=T.parts[F]instanceof Array?G(T.parts[F][0])+"-"+G(T.parts[F][1]):G(T.parts[F]);return"["+(T.inverted?"^":"")+b+"]"},any:function(T){return"any character"},end:function(T){return"end of input"},other:function(T){return T.description}};function I(T){return T.charCodeAt(0).toString(16).toUpperCase()}function C(T){return T.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(b){return"\\x0"+I(b)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(b){return"\\x"+I(b)})}function G(T){return T.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(b){return"\\x0"+I(b)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(b){return"\\x"+I(b)})}function Z(T){return e[T.type](T)}function z(T){var b=new Array(T.length),F,J;for(F=0;F<T.length;F++)b[F]=Z(T[F]);if(b.sort(),b.length>0){for(F=1,J=1;F<b.length;F++)b[F-1]!==b[F]&&(b[J]=b[F],J++);b.length=J}switch(b.length){case 1:return b[0];case 2:return b[0]+" or "+b[1];default:return b.slice(0,-1).join(", ")+", or "+b[b.length-1]}}function se(T){return T?'"'+C(T)+'"':"end of input"}return"Expected "+z(d)+" but "+se(_)+" found."};function S(d,_){_=_!==void 0?_:{};var e={},I={start:ts},C=ts,G=function(s){return s[0]},Z=function(){return{}},z=function(s){return{operator:s}},se=function(s,l,c,D){var m={start:s,left:l},D=D.length==0?null:D[0].right==null?D[0].left:D[0];return D!=null&&(m.operator=c==""?"<implicit>":c[0],m.right=D),m},T=function(s,l){return l},b=function(s,l,m){var g={left:s},m=m.length==0?null:m[0].right==null?m[0].left:m[0];return m!=null&&(g.operator=l==""?"<implicit>":l[0],g.right=m),g},F=function(s){return s},J="(",ae=P("(",!1),ye=")",B=P(")",!1),ue=function(s){return s[0].parenthesized=!0,s[0]},It=function(s,l){return l.field=s==null||s.label==""?"<implicit>":s.label,l.fieldLocation=s==null||s.label==""?null:s.location,l},At=function(s,l){return l.field=s.label,l.fieldLocation=s.location,l},rt=function(s,l){var c={field:s==null||s.label==""?"<implicit>":s.label,fieldLocation:s==null||s.label==""?null:s.location};for(var g in l)c[g]=l[g];return c},Oe=/^[:]/,xs=Pe([":"],!1,!1),de=function(s){return{label:s.label,location:s.location}},Se=function(s,l,c,g){var m={term:l,quoted:!0,regex:!1,termLocation:Je()};return c!=""&&(m.proximity=c),g!=""&&(m.boost=g),s!=""&&(m.prefix=s),m},Re=function(s,l){var c={term:l,quoted:!1,regex:!0,termLocation:Je()};return c},bs=function(s,l,c,g){var m={term:l.label,quoted:!1,regex:!1,termLocation:Je()};return c!=""&&(m.similarity=c),g!=""&&(m.boost=g),s!=""&&(m.prefix=s),m},ie="\\",fe=P("\\",!1),Fe=function(s){return"\\"+s},Ct=".",wt=P(".",!1),Q=/^[^ \t\r\n\f{}()"\/\^~[\]]/,Us=Pe([" ","	","\r",`
`,"\f","{","}","(",")",'"',"/","^","~","[","]"],!0,!1),Mt=function(s){return s.join("")},Tt=function(s){return{label:s.join(""),location:Je()}},js=/^[^: \t\r\n\f{}()"\/\^~[\]]/,Dt=Pe([":"," ","	","\r",`
`,"\f","{","}","(",")",'"',"/","^","~","[","]"],!0,!1),ve='"',ge=P('"',!1),nt=function(s){return s.join("")},Ie="/",at=P("/",!1),Gs=function(s){return s.join("")},Et=Ts(),Ve=function(s){return s},xe="+",Le=P("+",!1),lt="-",Ne=P("-",!1),Pt="!",_t=P("!",!1),Be="{",ot=P("{",!1),Ot="}",R=P("}",!1),Qe="[",We=P("[",!1),qe="]",Ae=P("]",!1),Ce="^",ct=P("^",!1),q="?",Rt=P("?",!1),we=":",Vt=P(":",!1),Lt="&",$s=P("&",!1),Ss="|",ut=P("|",!1),Nt="'",W=P("'",!1),ze="~",Me=P("~",!1),Bt="*",Qt=P("*",!1),Wt=" ",qt=P(" ",!1),k=function(s){return s},Fs=function(s){return s},Is=function(s){return s==""||s==null?.5:s},dt="0.",zt=P("0.",!1),Te=/^[0-9]/,ke=Pe([["0","9"]],!1,!1),ft=function(s){return parseFloat("0."+s.join(""))},pe=function(s){return parseInt(s.join(""))},re="TO",He=P("TO",!1),kt=function(s,l){return{term_min:s,term_max:l,inclusive:"both"}},As=function(s,l){return{term_min:s,term_max:l,inclusive:"none"}},Cs=function(s,l){return{term_min:s,term_max:l,inclusive:"left"}},be=function(s,l){return{term_min:s,term_max:l,inclusive:"right"}},V=function(s){return s},Ue="OR NOT",De=P("OR NOT",!1),gt="AND NOT",Ht=P("AND NOT",!1),Ut="OR",Gt=P("OR",!1),Ee="AND",le=P("AND",!1),Ge="NOT",ws=P("NOT",!1),Kt="||",Ms=P("||",!1),Yt="&&",Ke=P("&&",!1),je=Xe("whitespace"),Zt=/^[ \t\r\n\f]/,Jt=Pe([" ","	","\r",`
`,"\f"],!1,!1),a=0,A=0,Ye=[{line:1,column:1}],ee=0,pt=[],x=0,Ze;if("startRule"in _){if(!(_.startRule in I))throw new Error(`Can't start parsing from rule "`+_.startRule+'".');C=I[_.startRule]}function Ks(){return d.substring(A,a)}function Je(){return he(A,a)}function Ys(s,l){throw l=l!==void 0?l:he(A,a),es([Xe(s)],d.substring(A,a),l)}function Zs(s,l){throw l=l!==void 0?l:he(A,a),Ds(s,l)}function P(s,l){return{type:"literal",text:s,ignoreCase:l}}function Pe(s,l,c){return{type:"class",parts:s,inverted:l,ignoreCase:c}}function Ts(){return{type:"any"}}function Xt(){return{type:"end"}}function Xe(s){return{type:"other",description:s}}function ht(s){var l=Ye[s],c;if(l)return l;for(c=s-1;!Ye[c];)c--;for(l=Ye[c],l={line:l.line,column:l.column};c<s;)d.charCodeAt(c)===10?(l.line++,l.column=1):l.column++,c++;return Ye[s]=l,l}function he(s,l){var c=ht(s),g=ht(l);return{start:{offset:s,line:c.line,column:c.column},end:{offset:l,line:g.line,column:g.column}}}function j(s){a<ee||(a>ee&&(ee=a,pt=[]),pt.push(s))}function Ds(s,l){return new h(s,null,null,l)}function es(s,l,c){return new h(h.buildMessage(s,l),s,l,c)}function ts(){var s,l,c,g;for(s=a,l=[],c=M();c!==e;)l.push(c),c=M();if(l!==e){if(c=[],g=ne(),g!==e)for(;g!==e;)c.push(g),g=ne();else c=e;c!==e?(A=s,l=G(c),s=l):(a=s,s=e)}else a=s,s=e;if(s===e){for(s=a,l=[],c=M();c!==e;)l.push(c),c=M();l!==e&&(A=s,l=Z()),s=l,s===e&&(s=a,l=$t(),l!==e&&(A=s,l=Z()),s=l)}return s}function ne(){var s,l,c,g,m,D;if(s=a,l=me(),l!==e?(c=$t(),c!==e?(A=s,l=z(l),s=l):(a=s,s=e)):(a=s,s=e),s===e){if(s=a,l=me(),l!==e)if(c=ss(),c!==e){for(g=[],m=me();m!==e;)g.push(m),m=me();if(g!==e){for(m=[],D=ne();D!==e;)m.push(D),D=ne();m!==e?(A=s,l=se(l,c,g,m),s=l):(a=s,s=e)}else a=s,s=e}else a=s,s=e;else a=s,s=e;if(s===e&&(s=a,l=me(),l!==e?(c=ne(),c!==e?(A=s,l=T(l,c),s=l):(a=s,s=e)):(a=s,s=e),s===e))if(s=a,l=ss(),l!==e){for(c=[],g=me();g!==e;)c.push(g),g=me();if(c!==e){for(g=[],m=ne();m!==e;)g.push(m),m=ne();g!==e?(A=s,l=b(l,c,g),s=l):(a=s,s=e)}else a=s,s=e}else a=s,s=e}return s}function ss(){var s,l,c,g;if(s=a,l=rs(),l!==e){for(c=[],g=M();g!==e;)c.push(g),g=M();c!==e?(A=s,l=F(l),s=l):(a=s,s=e)}else a=s,s=e;return s===e&&(s=is()),s}function is(){var s,l,c,g,m,D,w;if(s=a,d.charCodeAt(a)===40?(l=J,a++):(l=e,x===0&&j(ae)),l!==e){for(c=[],g=M();g!==e;)c.push(g),g=M();if(c!==e){if(g=[],m=ne(),m!==e)for(;m!==e;)g.push(m),m=ne();else g=e;if(g!==e)if(d.charCodeAt(a)===41?(m=ye,a++):(m=e,x===0&&j(B)),m!==e){for(D=[],w=M();w!==e;)D.push(w),w=M();D!==e?(A=s,l=ue(g),s=l):(a=s,s=e)}else a=s,s=e;else a=s,s=e}else a=s,s=e}else a=s,s=e;return s}function rs(){var s,l,c;return s=a,l=mt(),l===e&&(l=null),l!==e?(c=ds(),c!==e?(A=s,l=It(l,c),s=l):(a=s,s=e)):(a=s,s=e),s===e&&(s=a,l=mt(),l!==e?(c=is(),c!==e?(A=s,l=At(l,c),s=l):(a=s,s=e)):(a=s,s=e),s===e&&(s=a,l=mt(),l===e&&(l=null),l!==e?(c=K(),c!==e?(A=s,l=rt(l,c),s=l):(a=s,s=e)):(a=s,s=e))),s}function mt(){var s,l,c,g,m;if(s=a,l=as(),l!==e)if(Oe.test(d.charAt(a))?(c=d.charAt(a),a++):(c=e,x===0&&j(xs)),c!==e){for(g=[],m=M();m!==e;)g.push(m),m=M();g!==e?(A=s,l=de(l),s=l):(a=s,s=e)}else a=s,s=e;else a=s,s=e;return s}function K(){var s,l,c,g,m,D,w;if(s=a,l=jt(),l===e&&(l=null),l!==e)if(c=Es(),c!==e)if(g=cs(),g===e&&(g=null),g!==e)if(m=us(),m===e&&(m=null),m!==e){for(D=[],w=M();w!==e;)D.push(w),w=M();D!==e?(A=s,l=Se(l,c,g,m),s=l):(a=s,s=e)}else a=s,s=e;else a=s,s=e;else a=s,s=e;else a=s,s=e;if(s===e){if(s=a,l=jt(),l===e&&(l=null),l!==e)if(c=_e(),c!==e){for(g=[],m=M();m!==e;)g.push(m),m=M();g!==e?(A=s,l=Re(l,c),s=l):(a=s,s=e)}else a=s,s=e;else a=s,s=e;if(s===e)if(s=a,l=jt(),l===e&&(l=null),l!==e)if(c=as(),c!==e)if(g=H(),g===e&&(g=null),g!==e)if(m=us(),m===e&&(m=null),m!==e){for(D=[],w=M();w!==e;)D.push(w),w=M();D!==e?(A=s,l=bs(l,c,g,m),s=l):(a=s,s=e)}else a=s,s=e;else a=s,s=e;else a=s,s=e;else a=s,s=e}return s}function ns(){var s,l,c;return s=a,d.charCodeAt(a)===92?(l=ie,a++):(l=e,x===0&&j(fe)),l!==e?(c=et(),c!==e?(A=s,l=Fe(c),s=l):(a=s,s=e)):(a=s,s=e),s===e&&(d.charCodeAt(a)===46?(s=Ct,a++):(s=e,x===0&&j(wt)),s===e&&(Q.test(d.charAt(a))?(s=d.charAt(a),a++):(s=e,x===0&&j(Us)))),s}function oe(){var s,l,c;if(s=a,l=[],c=ns(),c!==e)for(;c!==e;)l.push(c),c=ns();else l=e;return l!==e&&(A=s,l=Mt(l)),s=l,s}function as(){var s,l,c;if(s=a,l=[],c=ls(),c!==e)for(;c!==e;)l.push(c),c=ls();else l=e;return l!==e&&(A=s,l=Tt(l)),s=l,s}function ls(){var s,l,c;return s=a,d.charCodeAt(a)===92?(l=ie,a++):(l=e,x===0&&j(fe)),l!==e?(c=et(),c!==e?(A=s,l=Fe(c),s=l):(a=s,s=e)):(a=s,s=e),s===e&&(d.charCodeAt(a)===46?(s=Ct,a++):(s=e,x===0&&j(wt)),s===e&&(js.test(d.charAt(a))?(s=d.charAt(a),a++):(s=e,x===0&&j(Dt)))),s}function Es(){var s,l,c,g;if(s=a,d.charCodeAt(a)===34?(l=ve,a++):(l=e,x===0&&j(ge)),l!==e){for(c=[],g=os();g!==e;)c.push(g),g=os();c!==e?(d.charCodeAt(a)===34?(g=ve,a++):(g=e,x===0&&j(ge)),g!==e?(A=s,l=nt(c),s=l):(a=s,s=e)):(a=s,s=e)}else a=s,s=e;return s}function _e(){var s,l,c,g;if(s=a,d.charCodeAt(a)===47?(l=Ie,a++):(l=e,x===0&&j(at)),l!==e){if(c=[],g=yt(),g!==e)for(;g!==e;)c.push(g),g=yt();else c=e;c!==e?(d.charCodeAt(a)===47?(g=Ie,a++):(g=e,x===0&&j(at)),g!==e?(A=s,l=Gs(c),s=l):(a=s,s=e)):(a=s,s=e)}else a=s,s=e;return s}function os(){var s,l,c;return s=a,l=a,x++,d.charCodeAt(a)===34?(c=ve,a++):(c=e,x===0&&j(ge)),c===e&&(d.charCodeAt(a)===92?(c=ie,a++):(c=e,x===0&&j(fe))),x--,c===e?l=void 0:(a=l,l=e),l!==e?(d.length>a?(c=d.charAt(a),a++):(c=e,x===0&&j(Et)),c!==e?(A=s,l=Ve(c),s=l):(a=s,s=e)):(a=s,s=e),s===e&&(s=a,d.charCodeAt(a)===92?(l=ie,a++):(l=e,x===0&&j(fe)),l!==e?(c=et(),c!==e?(A=s,l=Fe(c),s=l):(a=s,s=e)):(a=s,s=e)),s}function yt(){var s,l,c;return s=a,l=a,x++,d.charCodeAt(a)===47?(c=Ie,a++):(c=e,x===0&&j(at)),c===e&&(d.charCodeAt(a)===92?(c=ie,a++):(c=e,x===0&&j(fe))),x--,c===e?l=void 0:(a=l,l=e),l!==e?(d.length>a?(c=d.charAt(a),a++):(c=e,x===0&&j(Et)),c!==e?(A=s,l=Ve(c),s=l):(a=s,s=e)):(a=s,s=e),s===e&&(s=a,d.charCodeAt(a)===92?(l=ie,a++):(l=e,x===0&&j(fe)),l!==e?(c=et(),c!==e?(A=s,l=Fe(c),s=l):(a=s,s=e)):(a=s,s=e)),s}function et(){var s;return d.charCodeAt(a)===43?(s=xe,a++):(s=e,x===0&&j(Le)),s===e&&(d.charCodeAt(a)===45?(s=lt,a++):(s=e,x===0&&j(Ne)),s===e&&(d.charCodeAt(a)===33?(s=Pt,a++):(s=e,x===0&&j(_t)),s===e&&(d.charCodeAt(a)===40?(s=J,a++):(s=e,x===0&&j(ae)),s===e&&(d.charCodeAt(a)===41?(s=ye,a++):(s=e,x===0&&j(B)),s===e&&(d.charCodeAt(a)===123?(s=Be,a++):(s=e,x===0&&j(ot)),s===e&&(d.charCodeAt(a)===125?(s=Ot,a++):(s=e,x===0&&j(R)),s===e&&(d.charCodeAt(a)===91?(s=Qe,a++):(s=e,x===0&&j(We)),s===e&&(d.charCodeAt(a)===93?(s=qe,a++):(s=e,x===0&&j(Ae)),s===e&&(d.charCodeAt(a)===94?(s=Ce,a++):(s=e,x===0&&j(ct)),s===e&&(d.charCodeAt(a)===34?(s=ve,a++):(s=e,x===0&&j(ge)),s===e&&(d.charCodeAt(a)===63?(s=q,a++):(s=e,x===0&&j(Rt)),s===e&&(d.charCodeAt(a)===58?(s=we,a++):(s=e,x===0&&j(Vt)),s===e&&(d.charCodeAt(a)===92?(s=ie,a++):(s=e,x===0&&j(fe)),s===e&&(d.charCodeAt(a)===38?(s=Lt,a++):(s=e,x===0&&j($s)),s===e&&(d.charCodeAt(a)===124?(s=Ss,a++):(s=e,x===0&&j(ut)),s===e&&(d.charCodeAt(a)===39?(s=Nt,a++):(s=e,x===0&&j(W)),s===e&&(d.charCodeAt(a)===47?(s=Ie,a++):(s=e,x===0&&j(at)),s===e&&(d.charCodeAt(a)===126?(s=ze,a++):(s=e,x===0&&j(Me)),s===e&&(d.charCodeAt(a)===42?(s=Bt,a++):(s=e,x===0&&j(Qt)),s===e&&(d.charCodeAt(a)===32?(s=Wt,a++):(s=e,x===0&&j(qt)))))))))))))))))))))),s}function cs(){var s,l,c;return s=a,d.charCodeAt(a)===126?(l=ze,a++):(l=e,x===0&&j(Me)),l!==e?(c=bt(),c!==e?(A=s,l=k(c),s=l):(a=s,s=e)):(a=s,s=e),s}function us(){var s,l,c;return s=a,d.charCodeAt(a)===94?(l=Ce,a++):(l=e,x===0&&j(ct)),l!==e?(c=vt(),c!==e?(A=s,l=Fs(c),s=l):(a=s,s=e)):(a=s,s=e),s}function H(){var s,l,c;return s=a,d.charCodeAt(a)===126?(l=ze,a++):(l=e,x===0&&j(Me)),l!==e?(c=xt(),c===e&&(c=null),c!==e?(A=s,l=Is(c),s=l):(a=s,s=e)):(a=s,s=e),s}function vt(){var s;return s=xt(),s===e&&(s=bt()),s}function xt(){var s,l,c,g;if(s=a,d.substr(a,2)===dt?(l=dt,a+=2):(l=e,x===0&&j(zt)),l!==e){if(c=[],Te.test(d.charAt(a))?(g=d.charAt(a),a++):(g=e,x===0&&j(ke)),g!==e)for(;g!==e;)c.push(g),Te.test(d.charAt(a))?(g=d.charAt(a),a++):(g=e,x===0&&j(ke));else c=e;c!==e?(A=s,l=ft(c),s=l):(a=s,s=e)}else a=s,s=e;return s}function bt(){var s,l,c;if(s=a,l=[],Te.test(d.charAt(a))?(c=d.charAt(a),a++):(c=e,x===0&&j(ke)),c!==e)for(;c!==e;)l.push(c),Te.test(d.charAt(a))?(c=d.charAt(a),a++):(c=e,x===0&&j(ke));else l=e;return l!==e&&(A=s,l=pe(l)),s=l,s}function ds(){var s,l,c,g,m,D,w,X;if(s=a,d.charCodeAt(a)===91?(l=Qe,a++):(l=e,x===0&&j(We)),l!==e)if(c=oe(),c!==e){for(g=[],m=M();m!==e;)g.push(m),m=M();if(g!==e)if(d.substr(a,2)===re?(m=re,a+=2):(m=e,x===0&&j(He)),m!==e){if(D=[],w=M(),w!==e)for(;w!==e;)D.push(w),w=M();else D=e;D!==e?(w=oe(),w!==e?(d.charCodeAt(a)===93?(X=qe,a++):(X=e,x===0&&j(Ae)),X!==e?(A=s,l=kt(c,w),s=l):(a=s,s=e)):(a=s,s=e)):(a=s,s=e)}else a=s,s=e;else a=s,s=e}else a=s,s=e;else a=s,s=e;if(s===e){if(s=a,d.charCodeAt(a)===123?(l=Be,a++):(l=e,x===0&&j(ot)),l!==e)if(c=oe(),c!==e){for(g=[],m=M();m!==e;)g.push(m),m=M();if(g!==e)if(d.substr(a,2)===re?(m=re,a+=2):(m=e,x===0&&j(He)),m!==e){if(D=[],w=M(),w!==e)for(;w!==e;)D.push(w),w=M();else D=e;D!==e?(w=oe(),w!==e?(d.charCodeAt(a)===125?(X=Ot,a++):(X=e,x===0&&j(R)),X!==e?(A=s,l=As(c,w),s=l):(a=s,s=e)):(a=s,s=e)):(a=s,s=e)}else a=s,s=e;else a=s,s=e}else a=s,s=e;else a=s,s=e;if(s===e){if(s=a,d.charCodeAt(a)===91?(l=Qe,a++):(l=e,x===0&&j(We)),l!==e)if(c=oe(),c!==e){for(g=[],m=M();m!==e;)g.push(m),m=M();if(g!==e)if(d.substr(a,2)===re?(m=re,a+=2):(m=e,x===0&&j(He)),m!==e){if(D=[],w=M(),w!==e)for(;w!==e;)D.push(w),w=M();else D=e;D!==e?(w=oe(),w!==e?(d.charCodeAt(a)===125?(X=Ot,a++):(X=e,x===0&&j(R)),X!==e?(A=s,l=Cs(c,w),s=l):(a=s,s=e)):(a=s,s=e)):(a=s,s=e)}else a=s,s=e;else a=s,s=e}else a=s,s=e;else a=s,s=e;if(s===e)if(s=a,d.charCodeAt(a)===123?(l=Be,a++):(l=e,x===0&&j(ot)),l!==e)if(c=oe(),c!==e){for(g=[],m=M();m!==e;)g.push(m),m=M();if(g!==e)if(d.substr(a,2)===re?(m=re,a+=2):(m=e,x===0&&j(He)),m!==e){if(D=[],w=M(),w!==e)for(;w!==e;)D.push(w),w=M();else D=e;D!==e?(w=oe(),w!==e?(d.charCodeAt(a)===93?(X=qe,a++):(X=e,x===0&&j(Ae)),X!==e?(A=s,l=be(c,w),s=l):(a=s,s=e)):(a=s,s=e)):(a=s,s=e)}else a=s,s=e;else a=s,s=e}else a=s,s=e;else a=s,s=e}}return s}function me(){var s,l,c,g,m;for(s=a,l=[],c=M();c!==e;)l.push(c),c=M();if(l!==e)if(c=fs(),c!==e){if(g=[],m=M(),m!==e)for(;m!==e;)g.push(m),m=M();else g=e;g!==e?(A=s,l=V(c),s=l):(a=s,s=e)}else a=s,s=e;else a=s,s=e;if(s===e){for(s=a,l=[],c=M();c!==e;)l.push(c),c=M();l!==e?(c=fs(),c!==e?(g=$t(),g!==e?(A=s,l=V(c),s=l):(a=s,s=e)):(a=s,s=e)):(a=s,s=e)}return s}function fs(){var s;return d.substr(a,6)===Ue?(s=Ue,a+=6):(s=e,x===0&&j(De)),s===e&&(d.substr(a,7)===gt?(s=gt,a+=7):(s=e,x===0&&j(Ht)),s===e&&(d.substr(a,2)===Ut?(s=Ut,a+=2):(s=e,x===0&&j(Gt)),s===e&&(d.substr(a,3)===Ee?(s=Ee,a+=3):(s=e,x===0&&j(le)),s===e&&(d.substr(a,3)===Ge?(s=Ge,a+=3):(s=e,x===0&&j(ws)),s===e&&(d.substr(a,2)===Kt?(s=Kt,a+=2):(s=e,x===0&&j(Ms)),s===e&&(d.substr(a,2)===Yt?(s=Yt,a+=2):(s=e,x===0&&j(Ke)))))))),s}function jt(){var s,l,c;for(s=a,l=[],c=M();c!==e;)l.push(c),c=M();return l!==e?(c=Ps(),c!==e?(A=s,l=V(c),s=l):(a=s,s=e)):(a=s,s=e),s}function Ps(){var s;return d.charCodeAt(a)===43?(s=xe,a++):(s=e,x===0&&j(Le)),s===e&&(d.charCodeAt(a)===45?(s=lt,a++):(s=e,x===0&&j(Ne)),s===e&&(d.charCodeAt(a)===33?(s=Pt,a++):(s=e,x===0&&j(_t)))),s}function M(){var s,l;if(x++,s=[],Zt.test(d.charAt(a))?(l=d.charAt(a),a++):(l=e,x===0&&j(Jt)),l!==e)for(;l!==e;)s.push(l),Zt.test(d.charAt(a))?(l=d.charAt(a),a++):(l=e,x===0&&j(Jt));else s=e;return x--,s===e&&(l=e,x===0&&j(je)),s}function $t(){var s,l;return s=a,x++,d.length>a?(l=d.charAt(a),a++):(l=e,x===0&&j(Et)),x--,l===e?s=void 0:(a=s,s=e),s}if(Ze=C(),Ze!==e&&a===d.length)return Ze;throw Ze!==e&&a<d.length&&j(Xt()),es(pt,ee<d.length?d.charAt(ee):null,ee<d.length?he(ee,ee+1):he(ee,ee))}ce.exports={SyntaxError:h,parse:S}},94601:(ce,N,h)=>{"use strict";var S=h(79148),d=h(27487);N.parse=S.parse.bind(S),N.toString=h(20559),N.term={escape:d.escape,unescape:d.unescape},N.phrase={escape:d.escapePhrase,unescape:d.unescapePhrase}},96260:(ce,N,h)=>{"use strict";h.r(N),h.d(N,{plugin:()=>Mr});var S=h(94644),d=h(57852),_=h(75234),e=h(74848),I=h(22803),C=h(96540),G=h(22592),Z=h(34999),z=h(63142),se=h(92505),T=h(79233),b=h(18027),F=h(63527);const J=t=>(i,r)=>{const n={};for(const o in t)n[o]=t[o](i[o],r);return n},ae=(t,i,r)=>(0,C.useCallback)(o=>{t(r(i,o))},[t,i,r]),ye=(0,C.createContext)(void 0),B=()=>{const t=(0,C.useContext)(ye);if(!t)throw new Error("Use DispatchContext first.");return t},ue=t=>({name:t,pipelineAgg:""}),It=t=>`var${Math.max(0,...t.map(i=>parseInt(i.name.match("^var(\\d+)$")?.[1]||"0",10)))+1}`,At=t=>t.settings?.model==="ewma",rt=t=>t.settings?.model==="holt",Oe=t=>t.settings?.model==="holt_winters",xs=t=>["holt","ewma","holt_winters"].includes(t.settings?.model||""),de=t=>Q[t.type].requiresField,Se=t=>Q[t.type].isPipelineAgg,Re=t=>Q[t.type].supportsMultipleBucketPaths,bs=t=>Q[t.type].supportsMissing,ie=t=>Q[t.type].hasSettings,fe=t=>Q[t.type].hasMeta,Fe=t=>Q[t.type].supportsInlineScript,Ct=["count","avg","sum","min","max","extended_stats","percentiles","cardinality","raw_document","raw_data","logs","moving_avg","moving_fn","derivative","serial_diff","cumulative_sum","bucket_script","rate","top_metrics"],wt=t=>Ct.includes(t),Q={count:{label:"Count",impliedQueryType:"metrics",requiresField:!1,isPipelineAgg:!1,supportsMissing:!1,supportsMultipleBucketPaths:!1,hasSettings:!1,hasMeta:!1,supportsInlineScript:!1,defaults:{}},avg:{label:"Average",impliedQueryType:"metrics",requiresField:!0,supportsInlineScript:!0,supportsMissing:!0,isPipelineAgg:!1,supportsMultipleBucketPaths:!1,hasSettings:!0,hasMeta:!1,defaults:{}},sum:{label:"Sum",impliedQueryType:"metrics",requiresField:!0,supportsInlineScript:!0,supportsMissing:!0,isPipelineAgg:!1,supportsMultipleBucketPaths:!1,hasSettings:!0,hasMeta:!1,defaults:{}},max:{label:"Max",impliedQueryType:"metrics",requiresField:!0,supportsInlineScript:!0,supportsMissing:!0,isPipelineAgg:!1,supportsMultipleBucketPaths:!1,hasSettings:!0,hasMeta:!1,defaults:{}},min:{label:"Min",impliedQueryType:"metrics",requiresField:!0,supportsInlineScript:!0,supportsMissing:!0,isPipelineAgg:!1,supportsMultipleBucketPaths:!1,hasSettings:!0,hasMeta:!1,defaults:{}},extended_stats:{label:"Extended Stats",impliedQueryType:"metrics",requiresField:!0,supportsMissing:!0,supportsInlineScript:!0,isPipelineAgg:!1,supportsMultipleBucketPaths:!1,hasSettings:!0,hasMeta:!0,defaults:{meta:{std_deviation_bounds_lower:!0,std_deviation_bounds_upper:!0}}},percentiles:{label:"Percentiles",impliedQueryType:"metrics",requiresField:!0,supportsMissing:!0,supportsInlineScript:!0,isPipelineAgg:!1,supportsMultipleBucketPaths:!1,hasSettings:!0,hasMeta:!1,defaults:{settings:{percents:["25","50","75","95","99"]}}},cardinality:{label:"Unique Count",impliedQueryType:"metrics",requiresField:!0,supportsMissing:!0,isPipelineAgg:!1,supportsMultipleBucketPaths:!1,hasSettings:!0,supportsInlineScript:!1,hasMeta:!1,defaults:{}},moving_avg:{label:"Moving Average",impliedQueryType:"metrics",requiresField:!0,isPipelineAgg:!0,versionRange:"<8.0.0",supportsMissing:!1,supportsMultipleBucketPaths:!1,hasSettings:!0,supportsInlineScript:!1,hasMeta:!1,defaults:{settings:{model:"simple",window:"5"}}},moving_fn:{label:"Moving Function",impliedQueryType:"metrics",requiresField:!0,isPipelineAgg:!0,supportsMultipleBucketPaths:!1,supportsInlineScript:!1,supportsMissing:!1,hasMeta:!1,hasSettings:!0,defaults:{}},derivative:{label:"Derivative",impliedQueryType:"metrics",requiresField:!0,isPipelineAgg:!0,supportsMissing:!1,supportsMultipleBucketPaths:!1,hasSettings:!0,supportsInlineScript:!1,hasMeta:!1,defaults:{}},serial_diff:{label:"Serial Difference",impliedQueryType:"metrics",requiresField:!0,isPipelineAgg:!0,supportsMissing:!1,supportsMultipleBucketPaths:!1,hasSettings:!0,supportsInlineScript:!1,hasMeta:!1,defaults:{settings:{lag:"1"}}},cumulative_sum:{label:"Cumulative Sum",impliedQueryType:"metrics",requiresField:!0,isPipelineAgg:!0,supportsMissing:!1,supportsMultipleBucketPaths:!1,hasSettings:!0,supportsInlineScript:!1,hasMeta:!1,defaults:{}},bucket_script:{label:"Bucket Script",impliedQueryType:"metrics",requiresField:!1,isPipelineAgg:!0,supportsMissing:!1,supportsMultipleBucketPaths:!0,hasSettings:!0,supportsInlineScript:!1,hasMeta:!1,defaults:{pipelineVariables:[ue(It([]))]}},raw_document:{label:"Raw Document (deprecated)",requiresField:!1,impliedQueryType:"raw_document",isPipelineAgg:!1,supportsMissing:!1,supportsMultipleBucketPaths:!1,hasSettings:!0,supportsInlineScript:!1,hasMeta:!1,defaults:{settings:{size:"500"}}},raw_data:{label:"Raw Data",requiresField:!1,impliedQueryType:"raw_data",isPipelineAgg:!1,supportsMissing:!1,supportsMultipleBucketPaths:!1,hasSettings:!0,supportsInlineScript:!1,hasMeta:!1,defaults:{settings:{size:"500"}}},logs:{label:"Logs",requiresField:!1,isPipelineAgg:!1,supportsMissing:!1,supportsMultipleBucketPaths:!1,hasSettings:!0,impliedQueryType:"logs",supportsInlineScript:!1,hasMeta:!1,defaults:{settings:{limit:"500"}}},top_metrics:{label:"Top Metrics",impliedQueryType:"metrics",requiresField:!1,isPipelineAgg:!1,supportsMissing:!1,supportsMultipleBucketPaths:!1,hasSettings:!0,supportsInlineScript:!1,hasMeta:!1,defaults:{settings:{order:"desc"}}},rate:{label:"Rate",impliedQueryType:"metrics",requiresField:!0,isPipelineAgg:!1,supportsMissing:!1,supportsMultipleBucketPaths:!1,hasSettings:!0,supportsInlineScript:!0,hasMeta:!1,defaults:{}}},Us={moving_avg:[{label:"window",default:5},{label:"model",default:"simple"},{label:"predict"},{label:"minimize",default:!1}],moving_fn:[{label:"window",default:5},{label:"script"}],derivative:[{label:"unit"}],serial_diff:[{label:"lag"}],cumulative_sum:[{label:"format"}],bucket_script:[]},Mt=(t,i)=>{const r=i.filter(n=>Re(n)?n.pipelineVariables?.some(o=>o.pipelineAgg===t.id):de(n)&&t.id===n.field);return[...r,...r.flatMap(n=>Mt(n,i))]},Tt=[{label:"Avg",value:"avg"},{label:"Min",value:"min"},{label:"Max",value:"max"},{label:"Sum",value:"sum"},{label:"Count",value:"count"},{label:"Std Dev",value:"std_deviation"},{label:"Std Dev Upper",value:"std_deviation_bounds_upper"},{label:"Std Dev Lower",value:"std_deviation_bounds_lower"}],js=[{label:"Simple",value:"simple"},{label:"Linear",value:"linear"},{label:"Exponentially Weighted",value:"ewma"},{label:"Holt Linear",value:"holt"},{label:"Holt Winters",value:"holt_winters"}],Dt={pre:"@HIGHLIGHT@",post:"@/HIGHLIGHT@"},ve="3";function ge(t="1"){return{type:"count",id:t}}function nt(t="1"){return{type:"date_histogram",id:t,settings:{interval:"auto"}}}const Ie=(t,i)=>t.find(r=>r.id===i);function at(t,i){return!!t?.metrics?.some(r=>r.type===i)}function Gs(t){return t in pipelineOptions}function Et(t){return!!metricAggregationConfig[t].supportsMultipleBucketPaths}var Ve=h(99589);const xe=t=>de(t)?`${Q[t.type].label} ${t.field}`:Q[t.type].label,Le=t=>Object.entries(t).reduce((i,[r,n])=>{if(n==null)return{...i};if(Array.isArray(n)&&n.length===0)return{...i};if(typeof n=="string"&&n.length===0)return{...i};if(!Array.isArray(n)&&typeof n=="object"){const o=Le(n);return Object.keys(o).length===0?{...i}:{...i,[r]:o}}return{...i,[r]:n}},{}),lt=t=>{const i=t.match(/^(\d+)/);return i?i[1]:void 0},Ne=t=>(typeof t.settings?.script=="object"?t.settings?.script?.inline:t.settings?.script)||"",Pt=t=>!!(0,Ve.gte)(t,"7.16.0"),_t="Support for Elasticsearch versions after their end-of-life (currently versions < 7.16) was removed. Using unsupported version of Elasticsearch may lead to unexpected and incorrect results.",Be=t=>t?.bucketAggs?.slice(-1)[0]?.type==="date_histogram",ot=/\$(\w+)|\[\[(\w+?)(?::(\w+))?\]\]|\${(\w+)(?:\.([^:^\}]+))?(?::([^\}]+))?}/g;function Ot(t,i){i=i||{};const r=i.delimiter||".";let n=i.maxDepth||3,o=1;const u={};function f(y,$){Object.keys(y).forEach(p=>{const v=y[p],E=i?.safe&&Array.isArray(v),O=Object.prototype.toString.call(v)==="[object Object]",U=$?$+r+p:p;if(i?.maxDepth||(n=o+1),!E&&O&&v&&Object.keys(v).length&&o<n)return++o,f({...v},U);u[U]=v})}return f(t,null),u}var R=h(65307);const Qe=(0,R.VP)("@metrics/add"),We=(0,R.VP)("@metrics/remove"),qe=(0,R.VP)("@metrics/toggle_visibility"),Ae=(0,R.VP)("@metrics/change_field"),Ce=(0,R.VP)("@metrics/change_type"),ct=(0,R.VP)("@metrics/change_attr"),q=(0,R.VP)("@metrics/change_setting"),Rt=(0,R.VP)("@metrics/change_meta"),we=(0,R.VP)("init"),Vt=(0,R.VP)("change_query"),Lt=(0,R.VP)("change_alias_pattern"),$s=(t,i)=>Vt.match(i)?i.payload:we.match(i)?t||"":t,Ss=(t,i)=>Lt.match(i)?i.payload:we.match(i)?t||"":t;var ut=h(62717);const Nt=()=>({label:"",query:"*"}),W={terms:{label:"Terms",requiresField:!0,defaultSettings:{min_doc_count:"1",size:"10",order:"desc",orderBy:"_term"}},filters:{label:"Filters",requiresField:!1,defaultSettings:{filters:[Nt()]}},geohash_grid:{label:"Geo Hash Grid",requiresField:!0,defaultSettings:{precision:ve}},date_histogram:{label:"Date Histogram",requiresField:!0,defaultSettings:{interval:"auto",min_doc_count:"0",trimEdges:"0",timeZone:ut.g$.utc}},histogram:{label:"Histogram",requiresField:!0,defaultSettings:{interval:"1000",min_doc_count:"0"}},nested:{label:"Nested (experimental)",requiresField:!0,defaultSettings:{}}},ze=[{label:"Term value",value:"_term"},{label:"Doc Count",value:"_count"}],Me=[{label:"Top",value:"desc"},{label:"Bottom",value:"asc"}],Bt=(0,R.VP)("@bucketAggs/add"),Qt=(0,R.VP)("@bucketAggs/remove"),Wt=(0,R.VP)("@bucketAggs/change_type"),qt=(0,R.VP)("@bucketAggs/change_field"),k=(0,R.VP)("@bucketAggs/change_setting"),Fs=t=>(i,r)=>{if(Bt.match(r)){const n={id:r.payload,type:"terms",settings:W.terms.defaultSettings},o=i[i.length-1];return o?.type==="date_histogram"?[...i.slice(0,i.length-1),n,o]:[...i,n]}return Qt.match(r)?i.filter(n=>n.id!==r.payload):Wt.match(r)?i.map(n=>n.id!==r.payload.id?n:{id:n.id,type:r.payload.newType,settings:W[r.payload.newType].defaultSettings}):qt.match(r)?i.map(n=>n.id!==r.payload.id?n:{...n,field:r.payload.newField}):Ce.match(r)?Q[r.payload.type].impliedQueryType!=="metrics"?[]:i.length===0?[{...nt("2"),field:t}]:i:k.match(r)?i.map(n=>{if(n.id!==r.payload.bucketAgg.id)return n;const o=Le({...n.settings,[r.payload.settingName]:r.payload.newValue});return{...n,settings:{...o}}}):we.match(r)?i&&i.length>0?i:[{...nt("2"),field:t}]:i},Is=(t,i)=>{if(Qe.match(i))return[...t,ge(i.payload)];if(We.match(i)){const r=t.find(u=>u.id===i.payload),n=[r,...Mt(r,t)],o=t.filter(u=>!n.some(f=>f.id===u.id));return o.length===0?[ge("1")]:o}return Ce.match(i)?t.filter(r=>Q[i.payload.type].impliedQueryType==="metrics"?!0:r.id===i.payload.id).map(r=>r.id!==i.payload.id?r:{id:r.id,type:i.payload.type,...Q[i.payload.type].defaults}):Ae.match(i)?t.map(r=>{if(r.id!==i.payload.id)return r;const n={...r,field:i.payload.field};return Se(r)?{...n,pipelineAgg:i.payload.field}:n}):qe.match(i)?t.map(r=>r.id!==i.payload?r:{...r,hide:!r.hide}):q.match(i)?t.map(r=>{if(r.id!==i.payload.metric.id)return r;if(ie(r)){const n=Le({...r.settings,[i.payload.settingName]:i.payload.newValue});return{...r,settings:{...n}}}return r}):Rt.match(i)?t.map(r=>r.id!==i.payload.metric.id?r:fe(r)?{...r,meta:{...r.meta,[i.payload.meta]:i.payload.newValue}}:r):ct.match(i)?t.map(r=>r.id!==i.payload.metric.id?r:{...r,[i.payload.attribute]:i.payload.newValue}):we.match(i)?t&&t.length>0?t:[ge("1")]:t},dt=(0,C.createContext)(void 0),zt=(0,C.createContext)(void 0),Te=(0,C.createContext)(void 0),ke=({children:t,onChange:i,onRunQuery:r,query:n,datasource:o,range:u})=>{const f=(0,C.useCallback)((L,O)=>{i(L),(L.query===O.query||O.query===void 0)&&r()},[i,r]),y=J({query:$s,alias:Ss,metrics:Is,bucketAggs:Fs(o.timeField)}),$=ae(L=>f({...n,...L,timeField:o.timeField},n),n,y),p=!n.metrics||!n.bucketAggs||n.query===void 0,[v,E]=(0,C.useState)(p);return(0,C.useEffect)(()=>{v&&p&&($(we()),E(!1))},[v,$,p]),p?null:(0,e.jsx)(dt.Provider,{value:o,children:(0,e.jsx)(zt.Provider,{value:n,children:(0,e.jsx)(Te.Provider,{value:u,children:(0,e.jsx)(ye.Provider,{value:$,children:t})})})})},ft=t=>()=>{const i=(0,C.useContext)(t);if(!i)throw new Error("use ElasticsearchProvider first.");return i},pe=ft(zt),re=ft(dt),He=ft(Te),kt=t=>t.id,As=t=>parseInt(t,10),Cs=()=>{const{metrics:t,bucketAggs:i}=pe();return(0,C.useMemo)(()=>(Math.max(...[...t?.map(kt)||["0"],...i?.map(kt)||["0"]].map(As))+1).toString(),[t,i])};var be=h(45861),V=h(2543),Ue=h(97095),De=h(83871),gt=h(76319);const Ht=({children:t,label:i,onRemoveClick:r,onHideClick:n,hidden:o=!1})=>{const u=(0,z.of)(Ut);return(0,e.jsxs)(Ue.C,{children:[(0,e.jsx)(De.e,{children:(0,e.jsxs)(T.c,{width:17,as:"div",children:[(0,e.jsx)("span",{children:i}),(0,e.jsxs)("span",{className:u.iconWrapper,children:[n&&(0,e.jsx)(gt.K,{name:o?"eye-slash":"eye",onClick:n,size:"sm","aria-pressed":o,className:u.icon,tooltip:"Hide row"}),(0,e.jsx)(gt.K,{name:"trash-alt",size:"sm",className:u.icon,onClick:r||V.noop,disabled:!r,tooltip:"Remove row"})]})]})}),t]})},Ut=t=>({iconWrapper:(0,I.css)({display:"flex"}),icon:(0,I.css)({color:t.colors.text.secondary,marginLeft:t.spacing(.25)})});var Gt=h(61875),Ee=h(76671),le=h(75505);const Ge=t=>W[t.type].requiresField,ws=["date_histogram","histogram","terms","filters","geohash_grid","nested"],Kt=t=>ws.includes(t),Ms=t=>{if(wt(t))switch(t){case"cardinality":return[];case"top_metrics":return["number"];default:return["number"]}if(Kt(t))switch(t){case"date_histogram":return["date"];case"geohash_grid":return["geo_point"];case"histogram":return["number"];default:return[]}return[]},Yt=({text:t})=>({label:t,value:t}),Ke=t=>{const i=re(),r=He(),n=Array.isArray(t)?t:Ms(t);let o;return async u=>(o||(o=await(0,le.s)(i.getFields(n,r))),o.filter(({text:f})=>u===void 0||f.includes(u)).map(Yt))},je=(0,I.css)({minWidth:"150px"});var Zt=h(30703);const Jt=(t,i)=>({wrapper:(0,I.css)({maxWidth:"500px",display:"flex",flexDirection:"column"}),settingsWrapper:(0,I.css)({display:"flex",flexDirection:"column",paddingTop:t.spacing(.5)}),icon:(0,I.css)({marginRight:t.spacing(.5)}),button:(0,I.css)({justifyContent:"flex-start",display:"flex",alignItems:"center",padding:t.spacing(0,1),fontSize:t.typography.bodySmall.fontSize,backgroundColor:t.colors.background.secondary,height:"32px",lineHeight:"32px",border:"none"},i&&{color:t.colors.text.disabled})}),a=({label:t,children:i,hidden:r=!1})=>{const[n,o]=(0,C.useState)(!1),u=(0,z.$j)(),f=Jt(u,r);return(0,e.jsx)(De.e,{children:(0,e.jsxs)("div",{className:(0,I.cx)(f.wrapper),children:[(0,e.jsxs)("button",{className:(0,I.cx)(f.button,je),onClick:()=>o(!n),"aria-expanded":n,type:"button",children:[(0,e.jsx)(Zt.I,{name:n?"angle-down":"angle-right","aria-hidden":"true",className:f.icon}),t]}),n&&(0,e.jsx)("div",{className:f.settingsWrapper,children:i})]})})};var A=h(18857),Ye=h(59310);const ee=["1w","1M","1q","1y"];class pt{constructor(i){this.timeField=i.timeField}getRangeFilter(){return{[this.timeField]:{gte:"$timeFrom",lte:"$timeTo",format:"epoch_millis"}}}buildTermsAgg(i,r,n){if(r.terms={field:i.field},!i.settings)return r;const o=i.settings?.size?parseInt(i.settings.size,10):500;if(r.terms.size=o===0?500:o,i.settings.orderBy!==void 0){r.terms.order={},i.settings.orderBy==="_term"?r.terms.order._key=i.settings.order:r.terms.order[i.settings.orderBy]=i.settings.order;const u=lt(i.settings.orderBy);if(u){for(let f of n.metrics||[])if(f.id===u){f.type==="count"?r.terms.order={_count:i.settings.order}:de(f)&&(r.aggs={},r.aggs[f.id]={[f.type]:{field:f.field}});break}}}return i.settings.min_doc_count!==void 0&&(r.terms.min_doc_count=parseInt(i.settings.min_doc_count,10),isNaN(r.terms.min_doc_count)&&(r.terms.min_doc_count=i.settings.min_doc_count)),i.settings.missing&&(r.terms.missing=i.settings.missing),r}getDateHistogramAgg(i){const r={},n=i.settings||{};r.field=i.field||this.timeField,r.min_doc_count=n.min_doc_count||0,r.extended_bounds={min:"$timeFrom",max:"$timeTo"},r.format="epoch_millis",n.timeZone&&n.timeZone!==ut.g$.utc&&(r.time_zone=n.timeZone),n.offset!==""&&(r.offset=n.offset);const o=n.interval==="auto"?"${__interval_ms}ms":n.interval;return o!==void 0&&ee.includes(o)?r.calendar_interval=o:r.fixed_interval=o,r}getHistogramAgg(i){return{interval:i.settings?.interval,field:i.field,min_doc_count:i.settings?.min_doc_count||0}}getFiltersAgg(i){const r={};for(let{query:n,label:o}of i.settings?.filters||[])r[o||n]={query_string:{query:n,analyze_wildcard:!0}};return r}documentQuery(i,r){return i.size=r,i.sort=[{[this.timeField]:{order:"desc",unmapped_type:"boolean"}},{_doc:{order:"desc"}}],i.script_fields={},i}build(i){i.metrics=i.metrics||[ge()],i.bucketAggs=i.bucketAggs||[nt()],i.timeField=this.timeField;let r,n,o,u,f;const y={size:0,query:{bool:{filter:[{range:this.getRangeFilter()}]}}};if(i.query&&i.query!==""&&(y.query.bool.filter=[...y.query.bool.filter,{query_string:{analyze_wildcard:!0,query:i.query}}]),i.bucketAggs.length===0&&(r=i.metrics[0],!r||!(r.type==="raw_document"||r.type==="raw_data")))throw{message:"Invalid query"};if(i.metrics?.[0]?.type==="raw_document"||i.metrics?.[0]?.type==="raw_data"){r=i.metrics[0];const $=r.settings?.size?parseInt(r.settings.size,10):500;return this.documentQuery(y,$||500)}for(f=y,n=0;n<i.bucketAggs.length;n++){const $=i.bucketAggs[n],p={};switch($.type){case"date_histogram":{p.date_histogram=this.getDateHistogramAgg($);break}case"histogram":{p.histogram=this.getHistogramAgg($);break}case"filters":{p.filters={filters:this.getFiltersAgg($)};break}case"terms":{this.buildTermsAgg($,p,i);break}case"geohash_grid":{p.geohash_grid={field:$.field,precision:$.settings?.precision||ve};break}case"nested":{p.nested={path:$.field};break}}f.aggs=f.aggs||{},f.aggs[$.id]=p,f=p}for(f.aggs={},n=0;n<i.metrics.length;n++){if(r=i.metrics[n],r.type==="count")continue;const $={};let p={};if(Se(r))if(Re(r))if(r.pipelineVariables){for(p={buckets_path:{}},o=0;o<r.pipelineVariables.length;o++)if(u=r.pipelineVariables[o],u.name&&u.pipelineAgg&&/^\d*$/.test(u.pipelineAgg)){const v=Ie(i.metrics,u.pipelineAgg);v&&(v.type==="count"?p.buckets_path[u.name]="_count":p.buckets_path[u.name]=u.pipelineAgg)}}else continue;else if(r.field&&/^\d*$/.test(r.field)){const v=Ie(i.metrics,r.field);v&&(v.type==="count"?p={buckets_path:"_count"}:p={buckets_path:r.field})}else continue;else de(r)&&(p={field:r.field});if(ie(r))switch(Object.entries(r.settings||{}).filter(([v,E])=>E!==null).forEach(([v,E])=>{p[v]=v==="script"?this.buildScript(Ne(r)):E}),r.type){case"moving_avg":p={...p,...p?.window!==void 0&&{window:this.toNumber(p.window)},...p?.predict!==void 0&&{predict:this.toNumber(p.predict)},...xs(r)&&{settings:{...p.settings,...Object.fromEntries(Object.entries(p.settings||{}).filter(([v])=>["alpha","beta","gamma","period"].includes(v)).filter(([v,E])=>E!==void 0).map(([v,E])=>[v,this.toNumber(E)]))}}};break;case"serial_diff":p={...p,...p.lag!==void 0&&{lag:this.toNumber(p.lag)}};break;case"top_metrics":p={metrics:r.settings?.metrics?.map(v=>({field:v})),size:1},r.settings?.orderBy&&(p.sort=[{[r.settings?.orderBy]:r.settings?.order}]);break}$[r.type]=p,f.aggs[r.id]=$}return y}buildScript(i){return i}toNumber(i){const r=parseFloat(`${i}`);return isNaN(r)?i:r}getTermsQuery(i){const r={size:0,query:{bool:{filter:[{range:this.getRangeFilter()}]}}};i.query&&r.query.bool.filter.push({query_string:{analyze_wildcard:!0,query:i.query}});let n=500;i.size&&(n=i.size),r.aggs={1:{terms:{field:i.field,size:n,order:{}}}};const{orderBy:o="key",order:u=o==="doc_count"?"desc":"asc"}=i;if(["asc","desc"].indexOf(u)<0)throw{message:`Invalid query sort order ${u}`};switch(o){case"key":case"term":const f="_key";r.aggs[1].terms.order[f]=u;break;case"doc_count":r.aggs[1].terms.order._count=u;break;default:throw{message:`Invalid query sort type ${o}`}}return r}getLogsQuery(i,r){let n={size:0,query:{bool:{filter:[{range:this.getRangeFilter()}]}}};return i.query&&n.query.bool.filter.push({query_string:{analyze_wildcard:!0,query:i.query}}),n=this.documentQuery(n,r),{...n,aggs:this.build(i).aggs,highlight:{fields:{"*":{}},pre_tags:[Dt.pre],post_tags:[Dt.post],fragment_size:2147483647}}}}const x=t=>({value:i})=>i===t,Ze=(t,i)=>i===void 0||t.some(x(i))?t:[...t,{value:i,label:i}],Ks=({options:t,value:i,onChange:r})=>{const[n,o]=(0,C.useState)(Ze(t,i)),u=f=>o([...n,{value:f,label:f}]);return{onCreateOption:f=>{u(f),r({value:f})},onChange:r,allowCustomValue:!0,options:n,value:i}},Je=[{label:"auto",value:"auto"},{label:"10s",value:"10s"},{label:"1m",value:"1m"},{label:"5m",value:"5m"},{label:"10m",value:"10m"},{label:"20m",value:"20m"},{label:"1h",value:"1h"},{label:"1d",value:"1d"},{label:"1w",value:"1w"},{label:"1M",value:"1M"},{label:"1q",value:"1q"},{label:"1y",value:"1y"}],Ys=t=>({value:i})=>i===t,Zs=(t,i,r)=>!r.some(Ys(t))&&t.trim().length>0,P=(t,i)=>t.value?.startsWith(i)||!1,Pe=t=>t&&ee.includes(t)?"calendar":"fixed",Ts=({bucketAgg:t})=>{const i=B(),{current:r}=(0,C.useRef)((0,V.uniqueId)("es-date_histogram-")),n=(0,C.useCallback)(({value:u})=>i(k({bucketAgg:t,settingName:"interval",newValue:u})),[t,i]),o=Pe(t.settings?.interval||W.date_histogram.defaultSettings?.interval);return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(b.I,{label:o==="calendar"?"Calendar interval":"Fixed interval",tooltip:o==="calendar"?"Calendar-aware intervals adapt to varying day lengths, month durations, and leap seconds, considering the calendar context.":"Fixed intervals remain constant, always being multiples of SI units, independent of calendar changes.",...K,children:(0,e.jsx)(A.l6,{inputId:(0,V.uniqueId)("es-date_histogram-interval"),isValidNewOption:Zs,filterOption:P,...Ks({options:Je,value:t.settings?.interval||W.date_histogram.defaultSettings?.interval,onChange:n})})}),(0,e.jsx)(b.I,{label:"Min Doc Count",...K,children:(0,e.jsx)(F.p,{id:`${r}-min_doc_count`,onBlur:u=>i(k({bucketAgg:t,settingName:"min_doc_count",newValue:u.target.value})),defaultValue:t.settings?.min_doc_count||W.date_histogram.defaultSettings?.min_doc_count})}),(0,e.jsx)(b.I,{label:"Trim Edges",...K,tooltip:"Trim the edges on the timeseries datapoints",children:(0,e.jsx)(F.p,{id:`${r}-trime_edges`,onBlur:u=>i(k({bucketAgg:t,settingName:"trimEdges",newValue:u.target.value})),defaultValue:t.settings?.trimEdges||W.date_histogram.defaultSettings?.trimEdges})}),(0,e.jsx)(b.I,{label:"Offset",...K,tooltip:"Change the start value of each bucket by the specified positive (+) or negative offset (-) duration, such as 1h for an hour, or 1d for a day",children:(0,e.jsx)(F.p,{id:`${r}-offset`,onBlur:u=>i(k({bucketAgg:t,settingName:"offset",newValue:u.target.value})),defaultValue:t.settings?.offset||W.date_histogram.defaultSettings?.offset})}),(0,e.jsx)(b.I,{label:"Timezone",...K,children:(0,e.jsx)(Ye.U,{value:t.settings?.timeZone||W.date_histogram.defaultSettings?.timeZone,includeInternal:[ut.g$.utc],onChange:u=>{i(k({bucketAgg:t,settingName:"timeZone",newValue:u}))}})})]})},Xt=({index:t,onAdd:i,onRemove:r,elements:n})=>(0,e.jsxs)("div",{className:(0,I.css)({display:"flex"}),children:[t===0&&(0,e.jsx)(be.$n,{variant:"secondary",fill:"text",icon:"plus",onClick:i,tooltip:"Add","aria-label":"Add"}),n.length>=2&&(0,e.jsx)(be.$n,{variant:"secondary",fill:"text",icon:"minus",onClick:r,tooltip:"Remove","aria-label":"Remove"})]}),Xe=(0,R.VP)("@bucketAggregations/filter/add"),ht=(0,R.VP)("@bucketAggregations/filter/remove"),he=(0,R.VP)("@bucketAggregations/filter/change"),j=(t=[],i)=>Xe.match(i)?[...t,Nt()]:ht.match(i)?t.slice(0,i.payload).concat(t.slice(i.payload+1)):he.match(i)?t.map((r,n)=>n!==i.payload.index?r:i.payload.filter):t,Ds=({bucketAgg:t})=>{const{current:i}=(0,C.useRef)((0,V.uniqueId)("es-filters-")),r=B(),n=ae(o=>r(k({bucketAgg:t,settingName:"filters",newValue:o})),t.settings?.filters,j);return(0,C.useEffect)(()=>{t.settings?.filters?.length||n(Xe())},[n,t.settings?.filters?.length]),(0,e.jsx)(e.Fragment,{children:(0,e.jsx)("div",{className:(0,I.css)({display:"flex",flexDirection:"column"}),children:t.settings?.filters.map((o,u)=>(0,e.jsxs)("div",{className:(0,I.css)({display:"flex"}),children:[(0,e.jsx)(b.I,{label:"Query",labelWidth:8,children:(0,e.jsx)("div",{className:(0,I.css)({width:"150px"}),children:(0,e.jsx)(se.X,{placeholder:"Lucene Query",portalOrigin:"elasticsearch",onChange:f=>n(he({index:u,filter:{...o,query:f}})),query:o.query})})}),(0,e.jsx)(b.I,{label:"Label",labelWidth:8,children:(0,e.jsx)(F.p,{width:16,id:`${i}-label-${u}`,placeholder:"Label",onBlur:f=>n(he({index:u,filter:{...o,label:f.target.value}})),defaultValue:o.label})}),(0,e.jsx)(Xt,{index:u,elements:t.settings?.filters||[],onAdd:()=>n(Xe()),onRemove:()=>n(ht(u))})]},u))})})},es=({bucketAgg:t})=>{const{metrics:i}=pe(),r=is(i),{current:n}=(0,C.useRef)((0,V.uniqueId)("es-terms-"));let o=t.settings?.size||W.terms.defaultSettings?.size;!o||o===""?o="10":o==="0"&&(o="500");const u=B();return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(b.I,{label:"Order",...K,children:(0,e.jsx)(A.l6,{inputId:`${n}-order`,onChange:f=>u(k({bucketAgg:t,settingName:"order",newValue:f.value})),options:Me,value:t.settings?.order||W.terms.defaultSettings?.order})}),(0,e.jsx)(b.I,{label:"Size",...K,children:(0,e.jsx)(F.p,{id:`${n}-size`,onBlur:f=>u(k({bucketAgg:t,settingName:"size",newValue:f.target.value})),defaultValue:o})}),(0,e.jsx)(b.I,{label:"Min Doc Count",...K,children:(0,e.jsx)(F.p,{id:`${n}-min_doc_count`,onBlur:f=>u(k({bucketAgg:t,settingName:"min_doc_count",newValue:f.target.value})),defaultValue:t.settings?.min_doc_count||W.terms.defaultSettings?.min_doc_count})}),(0,e.jsx)(b.I,{label:"Order By",...K,children:(0,e.jsx)(A.l6,{inputId:`${n}-order_by`,onChange:f=>u(k({bucketAgg:t,settingName:"orderBy",newValue:f.value})),options:r,value:t.settings?.orderBy||W.terms.defaultSettings?.orderBy})}),(0,e.jsx)(b.I,{label:"Missing",...K,children:(0,e.jsx)(F.p,{id:`${n}-missing`,onBlur:f=>u(k({bucketAgg:t,settingName:"missing",newValue:f.target.value})),defaultValue:t.settings?.missing||W.terms.defaultSettings?.missing})})]})};function ts(t){return t.meta?Object.keys(t.meta).filter(r=>t.meta?.[r]).map(r=>{let n=r;return r==="std_deviation_bounds_lower"&&(n="std_lower"),r==="std_deviation_bounds_upper"&&(n="std_upper"),{label:`${xe(t)} (${n})`,value:`${t.id}[${n}]`}}):[]}function ne(t){return t.settings?.percents?t.settings.percents.map(i=>{const r=/^\d+\.\d+/.test(`${i}`)?i:`${i}.0`;return{label:`${xe(t)} (${i})`,value:`${t.id}[${r}]`}}):[]}function ss(t){return t.type!=="top_metrics"&&!Se(t)}const is=(t=[])=>{const i=t.filter(ss).flatMap(r=>r.type==="extended_stats"?ts(r):r.type==="percentiles"?ne(r):{label:xe(r),value:r.id});return[...ze,...i]},rs=t=>i=>i.value===t,mt=t=>{const{metrics:i}=pe();switch(t.type){case"terms":{const r=t.settings?.order||"desc",n=t.settings?.size||"10",o=parseInt(t.settings?.min_doc_count||"0",10),u=t.settings?.orderBy||"_term";let f="";n!=="0"&&(f=`${Me.find(rs(r))?.label} ${n}, `),o>0&&(f+=`Min Doc Count: ${o}, `),f+="Order by: ";const y=ze.find(rs(u));if(y)f+=y.label;else{const $=i?.find(p=>p.id===lt(u));$?f+=xe($):f+="metric not found"}return n==="0"&&(f+=` (${r})`),f}case"histogram":{const r=t.settings?.interval||"1000",n=parseInt(t.settings?.min_doc_count||"1",10);return`Interval: ${r}${n>0?`, Min Doc Count: ${n}`:""}`}case"filters":return`Filter Queries (${(t.settings?.filters||W.filters.defaultSettings?.filters).length})`;case"geohash_grid":return`Precision: ${parseInt(t.settings?.precision||ve,10)}`;case"date_histogram":{const r=t.settings?.interval||"auto",n=parseInt(t.settings?.min_doc_count||"0",10),o=parseInt(t.settings?.trimEdges||"0",10);let u=`Interval: ${r}`;return n>0&&(u+=`, Min Doc Count: ${n}`),o>0&&(u+=`, Trim edges: ${o}`),u}default:return"Settings"}},K={labelWidth:18},ns=({bucketAgg:t})=>{const{current:i}=(0,C.useRef)((0,V.uniqueId)("es-setting-")),r=B(),n=mt(t);return(0,e.jsxs)(a,{label:n,children:[t.type==="terms"&&(0,e.jsx)(es,{bucketAgg:t}),t.type==="date_histogram"&&(0,e.jsx)(Ts,{bucketAgg:t}),t.type==="filters"&&(0,e.jsx)(Ds,{bucketAgg:t}),t.type==="geohash_grid"&&(0,e.jsx)(b.I,{label:"Precision",...K,children:(0,e.jsx)(F.p,{id:`${i}-geohash_grid-precision`,onBlur:o=>r(k({bucketAgg:t,settingName:"precision",newValue:o.target.value})),defaultValue:t.settings?.precision||W[t.type].defaultSettings?.precision})}),t.type==="histogram"&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(b.I,{label:"Interval",...K,children:(0,e.jsx)(F.p,{id:`${i}-histogram-interval`,onBlur:o=>r(k({bucketAgg:t,settingName:"interval",newValue:o.target.value})),defaultValue:t.settings?.interval||W[t.type].defaultSettings?.interval})}),(0,e.jsx)(b.I,{label:"Min Doc Count",...K,children:(0,e.jsx)(F.p,{id:`${i}-histogram-min_doc_count`,onBlur:o=>r(k({bucketAgg:t,settingName:"min_doc_count",newValue:o.target.value})),defaultValue:t.settings?.min_doc_count||W[t.type].defaultSettings?.min_doc_count})})]})]})},oe=Object.entries(W).map(([t,{label:i}])=>({label:i,value:t})),as=t=>({label:W[t.type].label,value:t.type}),ls=({value:t})=>{const i=B(),r=Ke(t.type);return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsxs)(De.e,{children:[(0,e.jsx)(Gt.Y,{className:je,options:oe,onChange:n=>i(Wt({id:t.id,newType:n.value})),value:as(t)}),Ge(t)&&(0,e.jsx)(Ee.s,{className:je,loadOptions:r,onChange:n=>i(qt({id:t.id,newField:n.value})),placeholder:"Select Field",value:t.field})]}),(0,e.jsx)(ns,{bucketAgg:t})]})},Es=({nextId:t})=>{const i=B(),{bucketAggs:r}=pe(),n=r?.length||0;return(0,e.jsx)(e.Fragment,{children:r.map((o,u)=>(0,e.jsxs)(Ht,{label:u===0?"Group By":"Then By",onRemoveClick:n>1&&(()=>i(Qt(o.id))),children:[(0,e.jsx)(ls,{value:o}),u===0&&(0,e.jsx)(be.$n,{variant:"secondary",fill:"text",icon:"plus",onClick:()=>i(Bt(t)),tooltip:"Add grouping condition","aria-label":"Add grouping condition"})]},`${o.type}-${o.id}`))})};var _e=h(21285);const os=(0,I.css)({whiteSpace:"nowrap"}),yt=t=>({label:xe(t),value:t}),et=t=>t.map(yt),cs=({options:t,onChange:i,className:r,value:n})=>{const o=t.find(u=>u.id===n);return(0,e.jsx)(Gt.Y,{className:(0,I.cx)(r,os),options:et(t),onChange:i,placeholder:"Select Metric",value:o?yt(o):void 0})};var us=h(87105);function H({label:t,settingName:i,metric:r,placeholder:n,tooltip:o,inputType:u="input"}){const f=B(),[y]=(0,C.useState)((0,V.uniqueId)("es-field-id-"));let p=r.settings?.[i]||"";return i==="script"&&(p=Ne(r)),(0,e.jsx)(b.I,{label:t,labelWidth:16,tooltip:o,children:u==="textarea"?(0,e.jsx)(us.f,{id:y,placeholder:n,onBlur:v=>f(q({metric:r,settingName:i,newValue:v.target.value})),defaultValue:p}):(0,e.jsx)(F.p,{id:y,placeholder:n,onBlur:v=>f(q({metric:r,settingName:i,newValue:v.target.value})),defaultValue:p})})}const vt=(0,R.VP)("@pipelineVariables/add"),xt=(0,R.VP)("@pipelineVariables/remove"),bt=(0,R.VP)("@pipelineVariables/rename"),ds=(0,R.VP)("@pipelineVariables/change_metric"),me=(t=[],i)=>vt.match(i)?[...t,ue(It(t))]:xt.match(i)?t.slice(0,i.payload).concat(t.slice(i.payload+1)):bt.match(i)?t.map((r,n)=>n!==i.payload.index?r:{...r,name:i.payload.newName}):ds.match(i)?t.map((r,n)=>n!==i.payload.index?r:{...r,pipelineAgg:i.payload.newMetric}):t,fs=({value:t,previousMetrics:i})=>{const r=B(),n=ae(o=>r(ct({metric:t,attribute:"pipelineVariables",newValue:o})),t.pipelineVariables,me);return(0,C.useEffect)(()=>{t.pipelineVariables?.length||n(vt())},[n,t.pipelineVariables?.length]),(0,e.jsxs)(e.Fragment,{children:[(0,e.jsxs)("div",{className:(0,I.css)({display:"flex"}),children:[(0,e.jsx)(T.c,{width:16,children:"Variables"}),(0,e.jsx)("div",{className:(0,I.css)({display:"grid",gridTemplateColumns:"1fr auto",rowGap:"4px",marginBottom:"4px"}),children:t.pipelineVariables.map((o,u)=>(0,e.jsxs)(C.Fragment,{children:[(0,e.jsxs)("div",{className:(0,I.css)({display:"grid",columnGap:"4px",gridTemplateColumns:"auto auto"}),children:[(0,e.jsx)(F.p,{"aria-label":"Variable name",defaultValue:o.name,placeholder:"Variable Name",onBlur:f=>n(bt({newName:f.target.value,index:u}))}),(0,e.jsx)(cs,{onChange:f=>n(ds({newMetric:f.value.id,index:u})),options:i,value:o.pipelineAgg})]}),(0,e.jsx)(Xt,{index:u,elements:t.pipelineVariables||[],onAdd:()=>n(vt()),onRemove:()=>n(xt(u))})]},(0,V.uniqueId)("es-bs-")))})]}),(0,e.jsx)(H,{label:"Script",metric:t,inputType:"textarea",settingName:"script",tooltip:"Elasticsearch v5.0 and above: Scripting language is Painless. Use params.<var> to reference a variable. Elasticsearch pre-v5.0: Scripting language is per default Groovy if not changed. For Groovy use <var> to reference a variable.",placeholder:"params.var1 / params.var2"})]})},jt=({metric:t})=>{const i=B(),{current:r}=(0,C.useRef)((0,V.uniqueId)("es-moving-avg-"));return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(b.I,{label:"Model",labelWidth:16,children:(0,e.jsx)(A.l6,{inputId:`${r}-model`,onChange:n=>i(q({metric:t,settingName:"model",newValue:n.value})),options:js,value:t.settings?.model})}),(0,e.jsx)(H,{label:"Window",settingName:"window",metric:t,placeholder:"5"}),(0,e.jsx)(H,{label:"Predict",settingName:"predict",metric:t}),(At(t)||rt(t)||Oe(t))&&(0,e.jsx)(b.I,{label:"Alpha",labelWidth:16,children:(0,e.jsx)(F.p,{id:`${r}-alpha`,onBlur:n=>i(q({metric:t,settingName:"settings",newValue:{...t.settings?.settings,alpha:n.target.value}})),defaultValue:t.settings?.settings?.alpha})}),(rt(t)||Oe(t))&&(0,e.jsx)(b.I,{label:"Beta",labelWidth:16,children:(0,e.jsx)(F.p,{id:`${r}-beta`,onBlur:n=>i(q({metric:t,settingName:"settings",newValue:{...t.settings?.settings,beta:n.target.value}})),defaultValue:t.settings?.settings?.beta})}),Oe(t)&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(b.I,{label:"Gamma",labelWidth:16,children:(0,e.jsx)(F.p,{id:`${r}-gamma`,onBlur:n=>i(q({metric:t,settingName:"settings",newValue:{...t.settings?.settings,gamma:n.target.value}})),defaultValue:t.settings?.settings?.gamma})}),(0,e.jsx)(b.I,{label:"Period",labelWidth:16,children:(0,e.jsx)(F.p,{id:`${r}-period`,onBlur:n=>i(q({metric:t,settingName:"settings",newValue:{...t.settings?.settings,period:n.target.value}})),defaultValue:t.settings?.settings?.period})}),(0,e.jsx)(b.I,{label:"Pad",labelWidth:16,children:(0,e.jsx)(_e.K,{id:`${r}-pad`,onChange:n=>i(q({metric:t,settingName:"settings",newValue:{...t.settings?.settings,pad:n.target.checked}})),checked:!!t.settings?.settings?.pad})})]}),(At(t)||rt(t)||Oe(t))&&(0,e.jsx)(b.I,{label:"Minimize",labelWidth:16,children:(0,e.jsx)(_e.K,{id:`${r}-minimize`,onChange:n=>i(q({metric:t,settingName:"minimize",newValue:n.target.checked})),checked:!!t.settings?.minimize})})]})},Ps=t=>({value:t,label:t}),M=({metric:t})=>{const i=B(),r=Ke(["number","date"]),n=Ke(t.type);return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(b.I,{label:"Metrics",labelWidth:16,children:(0,e.jsx)(A.Iv,{onChange:o=>i(q({metric:t,settingName:"metrics",newValue:o.map(u=>u.value)})),loadOptions:n,value:t.settings?.metrics?.map(Ps),closeMenuOnSelect:!1,defaultOptions:!0})}),(0,e.jsx)(b.I,{label:"Order",labelWidth:16,children:(0,e.jsx)(A.l6,{onChange:o=>i(q({metric:t,settingName:"order",newValue:o.value})),options:Me,value:t.settings?.order})}),(0,e.jsx)(b.I,{label:"Order By",labelWidth:16,className:(0,I.css)({"& > div":{width:"100%"}}),children:(0,e.jsx)(Ee.s,{className:(0,I.css)({marginRight:0}),loadOptions:r,onChange:o=>i(q({metric:t,settingName:"orderBy",newValue:o.value})),placeholder:"Select Field",value:t.settings?.orderBy})})]})},$t=t=>i=>i.value===t,s=t=>{switch(t.type){case"cardinality":return`Precision threshold: ${t.settings?.precision_threshold||""}`;case"percentiles":return t.settings?.percents&&t.settings?.percents?.length>=1?`Values: ${t.settings?.percents}`:"Percents: Default";case"extended_stats":{const i=Object.entries(t.meta||{}).map(([r,n])=>n&&Tt.find($t(r))?.label).filter(Boolean);return`Stats: ${i.length>0?i.join(", "):"None selected"}`}case"raw_document":case"raw_data":return`Size: ${t.settings?.size||500}`;default:return"Options"}},l={labelWidth:16},c=({metric:t,previousMetrics:i})=>{const{current:r}=(0,C.useRef)((0,V.uniqueId)("es-setting-")),n=B(),o=s(t),u=(0,C.useId)(),f=(0,C.useId)(),y=(0,C.useId)(),$=[{value:"second",label:"Second"},{value:"minute",label:"Minute"},{value:"hour",label:"Hour"},{value:"day",label:"Day"},{value:"week",label:"Week"},{value:"month",label:"Month"},{value:"quarter",label:"Quarter"},{value:"Year",label:"Year"}],p=[{value:"sum",label:"Sum"},{value:"value_count",label:"Value count"}];return(0,e.jsxs)(a,{label:o,hidden:t.hide,children:[t.type==="derivative"&&(0,e.jsx)(H,{label:"Unit",metric:t,settingName:"unit"}),t.type==="serial_diff"&&(0,e.jsx)(H,{label:"Lag",metric:t,settingName:"lag",placeholder:"1"}),t.type==="cumulative_sum"&&(0,e.jsx)(H,{label:"Format",metric:t,settingName:"format"}),t.type==="moving_avg"&&(0,e.jsx)(jt,{metric:t}),t.type==="moving_fn"&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(H,{label:"Window",metric:t,settingName:"window"}),(0,e.jsx)(H,{label:"Script",metric:t,settingName:"script",inputType:"textarea"}),(0,e.jsx)(H,{label:"Shift",metric:t,settingName:"shift"})]}),t.type==="top_metrics"&&(0,e.jsx)(M,{metric:t}),t.type==="bucket_script"&&(0,e.jsx)(fs,{value:t,previousMetrics:i}),(t.type==="raw_data"||t.type==="raw_document")&&(0,e.jsx)(b.I,{label:"Size",...l,htmlFor:u,children:(0,e.jsx)(F.p,{id:u,onBlur:v=>n(q({metric:t,settingName:"size",newValue:v.target.value})),defaultValue:t.settings?.size??Q.raw_data.defaults.settings?.size})}),t.type==="logs"&&(0,e.jsx)(H,{label:"Limit",metric:t,settingName:"limit",placeholder:"500"}),t.type==="cardinality"&&(0,e.jsx)(H,{label:"Precision Threshold",metric:t,settingName:"precision_threshold"}),t.type==="extended_stats"&&(0,e.jsxs)(e.Fragment,{children:[Tt.map(v=>(0,e.jsx)(g,{stat:v,onChange:E=>n(Rt({metric:t,meta:v.value,newValue:E})),value:t.meta?.[v.value]!==void 0?!!t.meta?.[v.value]:!!Q.extended_stats.defaults.meta?.[v.value]},v.value)),(0,e.jsx)(H,{label:"Sigma",metric:t,settingName:"sigma",placeholder:"3"})]}),t.type==="percentiles"&&(0,e.jsx)(b.I,{label:"Percentiles",...l,children:(0,e.jsx)(F.p,{id:`${r}-percentiles-percents`,onBlur:v=>n(q({metric:t,settingName:"percents",newValue:v.target.value.split(",").filter(Boolean)})),defaultValue:t.settings?.percents||Q.percentiles.defaults.settings?.percents,placeholder:"1,5,25,50,75,95,99"})}),t.type==="rate"&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(b.I,{label:"Unit",...l,"data-testid":"unit-select",htmlFor:f,children:(0,e.jsx)(A.l6,{id:f,onChange:v=>n(q({metric:t,settingName:"unit",newValue:v.value})),options:$,value:t.settings?.unit})}),(0,e.jsx)(b.I,{label:"Mode",...l,"data-testid":"mode-select",htmlFor:y,children:(0,e.jsx)(A.l6,{id:y,onChange:v=>n(q({metric:t,settingName:"mode",newValue:v.value})),options:p,value:t.settings?.unit})})]}),Fe(t)&&(0,e.jsx)(H,{label:"Script",metric:t,settingName:"script",placeholder:"_value * 1",inputType:"textarea"}),bs(t)&&(0,e.jsx)(H,{label:"Missing",metric:t,settingName:"missing",tooltip:`The missing parameter defines how documents that are missing a value should be treated. By default
            they will be ignored but it is also possible to treat them as if they had a value`})]})},g=({stat:t,onChange:i,value:r})=>{const[n]=(0,C.useState)((0,V.uniqueId)("es-field-id-"));return(0,C.createElement)(b.I,{label:t.label,...l,key:t.value},(0,e.jsx)(_e.K,{id:n,onChange:o=>i(o.target.checked),value:r}))},m=({name:t,metric:i})=>{const r=[];return(0,e.jsxs)(Ue.C,{children:[(0,e.jsx)(De.e,{children:(0,e.jsx)(T.c,{width:17,as:"div",children:(0,e.jsx)("span",{children:t})})}),(0,e.jsx)(c,{metric:i,previousMetrics:r})]})},D=(t,i)=>({color:i&&(0,I.css)({"&, &:hover, label, a":{color:i?t.colors.text.disabled:t.colors.text.primary}})}),w=t=>({label:Q[t.type].label,value:t.type}),X=t=>!Q[t.type].isPipelineAgg,gi=(t,i)=>{const r=t.some(X);return Object.entries(Q).filter(([n,o])=>o.impliedQueryType==="metrics").filter(([n,{versionRange:o="*"}])=>i!=null?(0,Ve.satisfies)(i,o):!0).filter(([n,o])=>r||!o.isPipelineAgg).map(([n,{label:o}])=>({label:o,value:n}))},pi=({value:t})=>{const i=D((0,z.$j)(),!!t.hide),r=re(),n=pe(),o=B(),u=Ke(t.type),f=async p=>{const v=await r.getDatabaseVersion();return gi(p,v)},y=(0,C.useCallback)(async()=>{const p=await u();return Fe(t)?[{label:"None"},...p]:p},[u,t]),$=n.metrics.slice(0,n.metrics.findIndex(p=>p.id===t.id));return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsxs)(De.e,{children:[(0,e.jsx)(Ee.s,{className:(0,I.cx)(i.color,je),loadOptions:()=>f($),onChange:p=>o(Ce({id:t.id,type:p.value})),value:w(t)}),de(t)&&!Se(t)&&(0,e.jsx)(Ee.s,{className:(0,I.cx)(i.color,je),loadOptions:y,onChange:p=>o(Ae({id:t.id,field:p.value})),placeholder:"Select Field",value:t.field}),Se(t)&&!Re(t)&&(0,e.jsx)(cs,{className:(0,I.cx)(i.color,je),onChange:p=>o(Ae({id:t.id,field:p.value?.id})),options:$,value:t.field})]}),ie(t)&&(0,e.jsx)(c,{metric:t,previousMetrics:$})]})},hi=({nextId:t})=>{const i=B(),{metrics:r}=pe(),n=r?.length||0;return(0,e.jsx)(e.Fragment,{children:r?.map((o,u)=>{switch(o.type){case"logs":return(0,e.jsx)(m,{name:"Logs",metric:o},`${o.type}-${o.id}`);case"raw_data":return(0,e.jsx)(m,{name:"Raw Data",metric:o},`${o.type}-${o.id}`);case"raw_document":return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(m,{name:"Raw Document",metric:o},`${o.type}-${o.id}`),(0,e.jsx)(Z.F,{severity:"warning",title:"The 'Raw Document' query type is deprecated."})]});default:return(0,e.jsxs)(Ht,{label:`Metric (${o.id})`,hidden:o.hide,onHideClick:()=>i(qe(o.id)),onRemoveClick:n>1&&(()=>i(We(o.id))),children:[(0,e.jsx)(pi,{value:o}),Q[o.type].impliedQueryType==="metrics"&&u===0&&(0,e.jsx)(be.$n,{variant:"secondary",fill:"text",icon:"plus",onClick:()=>i(Qe(t)),tooltip:"Add metric","aria-label":"Add metric"})]},`${o.type}-${o.id}`)}})})};var mi=h(77824);const yi=[{value:"metrics",label:"Metrics"},{value:"logs",label:"Logs"},{value:"raw_data",label:"Raw Data"},{value:"raw_document",label:"Raw Document"}];function vi(t){switch(t){case"logs":case"raw_data":case"raw_document":return t;case"metrics":return"count";default:throw new Error(`invalid query type: ${t}`)}}const xi=()=>{const t=pe(),i=B(),r=t.metrics?.[0];if(r==null)return null;const n=Q[r.type].impliedQueryType,o=u=>{i(Ce({id:r.id,type:vi(u)}))};return(0,e.jsx)(mi.z,{fullWidth:!1,options:yi,value:n,onChange:o})};function bi(t){const[i,r]=(0,C.useState)(null);return(0,C.useEffect)(()=>{let n=!1;return t.getDatabaseVersion().then(o=>{n||r(o)},o=>{console.log(o)}),()=>{n=!0}},[t]),i}const ji=({query:t,onChange:i,onRunQuery:r,datasource:n,range:o})=>{const u=bi(n),f=u!=null&&!Pt(u);return(0,e.jsxs)(ke,{datasource:n,onChange:i,onRunQuery:r,query:t,range:o||(0,G.E2)(),children:[f&&(0,e.jsx)(Z.F,{title:_t}),(0,e.jsx)($i,{value:t})]})},Js=t=>({root:(0,I.css)({display:"flex"}),queryItem:(0,I.css)({flexGrow:1,margin:t.spacing(0,.5,.5,0)})}),Xs=({value:t,onChange:i})=>{const r=(0,z.of)(Js);return(0,e.jsx)("div",{className:r.queryItem,children:(0,e.jsx)(se.X,{query:t,onChange:i,placeholder:"Enter a lucene query",portalOrigin:"elasticsearch"})})},$i=({value:t})=>{const i=B(),r=Cs(),n=(0,C.useId)(),o=(0,z.of)(Js),u=Be(t),f=t.metrics?.every(y=>Q[y.type].impliedQueryType==="metrics");return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsxs)("div",{className:o.root,children:[(0,e.jsx)(T.c,{width:17,children:"Query type"}),(0,e.jsx)("div",{className:o.queryItem,children:(0,e.jsx)(xi,{})})]}),(0,e.jsxs)("div",{className:o.root,children:[(0,e.jsx)(T.c,{width:17,children:"Lucene Query"}),(0,e.jsx)(Xs,{onChange:y=>i(Vt(y)),value:t?.query}),u&&(0,e.jsx)(b.I,{label:"Alias",labelWidth:15,tooltip:"Aliasing only works for timeseries queries (when the last group is 'Date Histogram'). For all other query types this field is ignored.",htmlFor:n,children:(0,e.jsx)(F.p,{id:n,placeholder:"Alias Pattern",onBlur:y=>i(Lt(y.currentTarget.value)),defaultValue:t.alias})})]}),(0,e.jsx)(hi,{nextId:r}),f&&(0,e.jsx)(Es,{nextId:r})]})};var Si=h(65074),Fi=h(76229),Ii=h(50532),Ai=h(14141),Ci=h(5518),_s=h(70985),wi=h(6370),Mi=h(80486),tt=h(43173),Os=h(3271),ei=h(41654),Ti=h(3936),Di=h(38036),Ei=h(79609),Rs=h(85480);function Vs(t){const{description:i,suffix:r,feature:n}=t,o=`Learn more about ${n}`,u=(0,z.of)(Pi);return C.createElement("span",{className:u.container},i,C.createElement("a",{"aria-label":o,href:`https://grafana.com/docs/grafana/next/datasources/${r}`,rel:"noreferrer",target:"_blank"},o))}const Pi=t=>({container:(0,I.css)({color:t.colors.text.secondary,a:(0,I.css)({color:t.colors.text.link,textDecoration:"underline",marginLeft:"5px","&:hover":{textDecoration:"none"}})})});var _i=h(84596),Oi=h(80839),Ri=h(81917);const Vi=t=>{const{value:i,onChange:r,onDelete:n,suggestions:o,className:u}=t,f=(0,z.of)(Ni),[y,$]=Li(i.datasourceUid),p=v=>E=>{r({...i,[v]:E.currentTarget.value})};return(0,e.jsxs)("div",{className:u,children:[(0,e.jsxs)("div",{className:f.firstRow,children:[(0,e.jsx)(b.I,{label:"Field",htmlFor:"elasticsearch-datasource-config-field",labelWidth:12,tooltip:"Can be exact field name or a regex pattern that will match on the field name.",children:(0,e.jsx)(F.p,{type:"text",id:"elasticsearch-datasource-config-field",value:i.field,onChange:p("field"),width:100})}),(0,e.jsx)(be.$n,{variant:"destructive","aria-label":"Remove field",icon:"times",onClick:v=>{v.preventDefault(),n()}})]}),(0,e.jsxs)(Ue.C,{children:[(0,e.jsxs)("div",{className:f.urlField,children:[(0,e.jsx)(T.c,{htmlFor:"elasticsearch-datasource-internal-link",width:12,children:y?"Query":"URL"}),(0,e.jsx)(Ri.l,{placeholder:y?"${__value.raw}":"http://example.com/${__value.raw}",value:i.url||"",onChange:v=>r({...i,url:v}),suggestions:o})]}),(0,e.jsx)("div",{className:f.urlDisplayLabelField,children:(0,e.jsx)(b.I,{label:"URL Label",htmlFor:"elasticsearch-datasource-url-label",labelWidth:14,tooltip:"Use to override the button label.",children:(0,e.jsx)(F.p,{type:"text",id:"elasticsearch-datasource-url-label",value:i.urlDisplayLabel,onChange:p("urlDisplayLabel")})})})]}),(0,e.jsxs)("div",{className:f.row,children:[(0,e.jsx)(b.I,{label:"Internal link",labelWidth:12,children:(0,e.jsx)(_e.K,{label:"Internal link",value:y||!1,onChange:()=>{y&&r({...i,datasourceUid:void 0}),$(!y)}})}),y&&(0,e.jsx)(Oi.s,{tracing:!0,onChange:v=>{r({...i,datasourceUid:v.uid})},current:i.datasourceUid})]})]})};function Li(t){const[i,r]=(0,C.useState)(!!t),n=(0,_i.A)(t);return(0,C.useEffect)(()=>{!n&&t&&!i&&r(!0),n&&!t&&i&&r(!1)},[n,t,i]),[i,r]}const Ni=()=>({firstRow:(0,I.css)({display:"flex"}),nameField:(0,I.css)({flex:2}),regexField:(0,I.css)({flex:3}),row:(0,I.css)({display:"flex",alignItems:"baseline"}),urlField:(0,I.css)({display:"flex",flex:1}),urlDisplayLabelField:(0,I.css)({flex:1})}),Bi=t=>({addButton:(0,I.css)({marginRight:"10px"}),container:(0,I.css)({marginBottom:t.spacing(2)}),dataLink:(0,I.css)({marginBottom:t.spacing(1)})}),Qi=t=>{const{value:i,onChange:r}=t,n=(0,z.of)(Bi);return(0,e.jsx)(Rs.I,{title:"Data links",description:(0,e.jsx)(Vs,{description:"Add links to existing fields. Links will be shown in log row details next to the field value.",suffix:"elasticsearch/#data-links",feature:"Elasticsearch data links"}),children:(0,e.jsxs)("div",{className:n.container,children:[i&&i.length>0&&(0,e.jsx)("div",{className:"gf-form-group",children:i.map((o,u)=>(0,e.jsx)(Vi,{className:n.dataLink,value:o,onChange:f=>{const y=[...i];y.splice(u,1,f),r(y)},onDelete:()=>{const f=[...i];f.splice(u,1),r(f)},suggestions:[{value:Di.c.valueRaw,label:"Raw value",documentation:"Raw value of the field",origin:Ei.$0.Value}]},u))}),(0,e.jsx)(be.$n,{type:"button",variant:"secondary",className:n.addButton,icon:"plus",onClick:o=>{o.preventDefault();const u=[...i||[],{field:"",url:""}];r(u)},children:"Add"})]})})},Ls=[{label:"No pattern",value:"none"},{label:"Hourly",value:"Hourly",example:"[logstash-]YYYY.MM.DD.HH"},{label:"Daily",value:"Daily",example:"[logstash-]YYYY.MM.DD"},{label:"Weekly",value:"Weekly",example:"[logstash-]GGGG.WW"},{label:"Monthly",value:"Monthly",example:"[logstash-]YYYY.MM"},{label:"Yearly",value:"Yearly",example:"[logstash-]YYYY"}],Wi=({value:t,onChange:i})=>(0,e.jsxs)(Rs.I,{title:"Elasticsearch details",description:(0,e.jsx)(Vs,{description:"Specific settings for the Elasticsearch data source.",suffix:"elasticsearch/#index-settings",feature:"Elasticsearch details"}),children:[(0,e.jsx)(b.I,{label:"Index name",htmlFor:"es_config_indexName",labelWidth:29,tooltip:"Name of your Elasticsearch index. You can use a time pattern, such as YYYY.MM.DD, or a wildcard for the index name.",children:(0,e.jsx)(F.p,{id:"es_config_indexName",value:t.jsonData.index??(t.database||""),onChange:qi(t,i),width:24,placeholder:"es-index-name",required:!0})}),(0,e.jsx)(b.I,{label:"Pattern",htmlFor:"es_config_indexPattern",labelWidth:29,tooltip:"If you're using a pattern for your index, select the type, or no pattern.",children:(0,e.jsx)(A.l6,{inputId:"es_config_indexPattern",value:Ls.find(r=>r.value===(t.jsonData.interval===void 0?"none":t.jsonData.interval)),options:Ls,onChange:ki(t,i),width:24})}),(0,e.jsx)(b.I,{label:"Time field name",htmlFor:"es_config_timeField",labelWidth:29,tooltip:"Name of your time field. Defaults to @timestamp.",children:(0,e.jsx)(F.p,{id:"es_config_timeField",value:t.jsonData.timeField||"",onChange:Ns("timeField",t,i),width:24,placeholder:"@timestamp",required:!0})}),(0,e.jsx)(b.I,{label:"Max concurrent Shard Requests",htmlFor:"es_config_shardRequests",labelWidth:29,tooltip:"Maximum number of concurrent shards a search request can hit per node. Defaults to 5.",children:(0,e.jsx)(F.p,{id:"es_config_shardRequests",value:t.jsonData.maxConcurrentShardRequests||"",onChange:Ns("maxConcurrentShardRequests",t,i),width:24})}),(0,e.jsx)(b.I,{label:"Min time interval",htmlFor:"es_config_minTimeInterval",labelWidth:29,tooltip:(0,e.jsxs)(e.Fragment,{children:["A lower limit for the auto group by time interval. Recommended to be set to write frequency, for example"," ",(0,e.jsx)("code",{children:"1m"})," if your data is written every minute."]}),error:"Value is not valid, you can use number with time unit specifier: y, M, w, d, h, m, s",invalid:!!t.jsonData.timeInterval&&!/^\d+(ms|[Mwdhmsy])$/.test(t.jsonData.timeInterval),children:(0,e.jsx)(F.p,{id:"es_config_minTimeInterval",value:t.jsonData.timeInterval||"",onChange:Ns("timeInterval",t,i),width:24,placeholder:"10s"})}),(0,e.jsx)(b.I,{label:"Include Frozen Indices",htmlFor:"es_config_frozenIndices",labelWidth:29,tooltip:"Include frozen indices in searches.",children:(0,e.jsx)(_e.K,{id:"es_config_frozenIndices",value:t.jsonData.includeFrozen??!1,onChange:zi("includeFrozen",t,i)})})]}),qi=(t,i)=>r=>{i({...t,database:"",jsonData:{...t.jsonData,index:r.currentTarget.value}})},Ns=(t,i,r)=>n=>{r({...i,jsonData:{...i.jsonData,[t]:n.currentTarget.value}})},zi=(t,i,r)=>n=>{r({...i,jsonData:{...i.jsonData,[t]:n.currentTarget.checked}})},ki=(t,i)=>r=>{const n=r.value==="none"?void 0:r.value,o=t.jsonData.index??t.database;if(!o||o.length===0||o.startsWith("[logstash-]")){let u="";if(n!==void 0){const f=Ls.find(y=>y.value===n);f&&(u=f.example??"")}i({...t,database:"",jsonData:{...t.jsonData,index:u,interval:n}})}else i({...t,jsonData:{...t.jsonData,interval:n}})};function Hi(){return 5}const Ui=t=>{const{value:i,onChange:r}=t,n=o=>u=>{r({...i,[o]:u.currentTarget.value})};return(0,e.jsxs)(Rs.I,{title:"Logs",description:(0,e.jsx)(Vs,{description:"Configure which fields the data source uses for log messages and log levels.",suffix:"elasticsearch/#logs",feature:"Elasticsearch log fields"}),children:[(0,e.jsx)(b.I,{label:"Message field name",labelWidth:22,tooltip:"Configure the field to be used for log messages.",children:(0,e.jsx)(F.p,{id:"es_logs-config_logMessageField",value:i.logMessageField,onChange:n("logMessageField"),placeholder:"_source",width:24})}),(0,e.jsx)(b.I,{label:"Level field name",labelWidth:22,tooltip:"Configure the field that determines the level of each log message.",children:(0,e.jsx)(F.p,{id:"es_logs-config_logLevelField",value:i.logLevelField,onChange:n("logLevelField"),width:24})})]})},Gi=t=>({...t,jsonData:{...t.jsonData,timeField:t.jsonData.timeField||"@timestamp",maxConcurrentShardRequests:t.jsonData.maxConcurrentShardRequests||Hi(),logMessageField:t.jsonData.logMessageField||"",logLevelField:t.jsonData.logLevelField||"",includeFrozen:t.jsonData.includeFrozen??!1}}),Ki=t=>!!t.jsonData.timeField&&!!t.jsonData.maxConcurrentShardRequests&&t.jsonData.logMessageField!==void 0&&t.jsonData.logLevelField!==void 0,Yi=t=>{const{options:i,onOptionsChange:r}=t;(0,C.useEffect)(()=>{Ki(i)||r(Gi(i))},[r,i]);const n=(0,Fi.pe)({config:i,onChange:r});return tt.$.sigV4AuthEnabled&&(n.customMethods=[{id:"custom-sigv4",label:"SigV4 auth",description:"AWS Signature Version 4 authentication",component:(0,e.jsx)(Si._r,{inExperimentalAuthComponent:!0,...t})}],n.selectedMethod=i.jsonData.sigV4Auth?"custom-sigv4":n.selectedMethod),(0,e.jsxs)(e.Fragment,{children:[i.access==="direct"&&(0,e.jsx)(Z.F,{title:"Error",severity:"error",children:"Browser access mode in the Elasticsearch datasource is no longer available. Switch to server access mode."}),(0,e.jsx)(Ii.I,{dataSourceName:"Elasticsearch",docsLink:"https://grafana.com/docs/grafana/latest/datasources/elasticsearch",hasRequiredFields:!1}),(0,e.jsx)(Os.c,{spacing:4}),(0,e.jsx)(Ai.u,{config:i,onChange:r,urlPlaceholder:"http://localhost:9200"}),(0,e.jsx)(Os.c,{spacing:4}),(0,e.jsx)(Ci.N,{...n,onAuthMethodSelect:o=>{r({...i,basicAuth:o===_s.q.BasicAuth,withCredentials:o===_s.q.CrossSiteCredentials,jsonData:{...i.jsonData,sigV4Auth:o==="custom-sigv4",oauthPassThru:o===_s.q.OAuthForward}})}}),(0,e.jsx)(Os.c,{spacing:4}),(0,e.jsx)(wi.A,{title:"Additional settings",description:"Additional settings are optional settings that can be configured for more control over your data source.",isCollapsible:!0,isInitiallyOpen:!0,children:(0,e.jsxs)(ei.B,{gap:5,direction:"column",children:[(0,e.jsx)(Mi.g,{config:i,onChange:r}),tt.$.secureSocksDSProxyEnabled&&(0,e.jsx)(Ti.Y,{options:i,onOptionsChange:r}),(0,e.jsx)(Wi,{value:i,onChange:r}),(0,e.jsx)(Ui,{value:i.jsonData,onChange:o=>r({...i,jsonData:o})}),(0,e.jsx)(Qi,{value:i.jsonData.dataLinks,onChange:o=>{r({...i,jsonData:{...i.jsonData,dataLinks:o}})}})]})})]})};var Zi=h(51553),gs=h(65474),Ji=h(62467),ti=h(66847),Xi=h(69862),er=h(2174),tr=h(41560),sr=h(57532),st=h(81160),ir=h(59099),te=h(67770),rr=h(17548),Bs=h(1906),Y=h(25229),nr=h(36580),ar=h(2863),lr=h(78282);const si={Hourly:{startOf:"hour",amount:"hours"},Daily:{startOf:"day",amount:"days"},Weekly:{startOf:"isoWeek",amount:"weeks"},Monthly:{startOf:"month",amount:"months"},Yearly:{startOf:"year",amount:"years"}};class or{constructor(i,r){this.pattern=i,this.interval=r,this.dateLocale="en"}getIndexForToday(){return this.interval?(0,Y.yT)().locale(this.dateLocale).format(this.pattern):this.pattern}getIndexList(i,r){if(!this.interval)return this.pattern;const o=si[this.interval],u=(0,Y.KQ)(i||(0,Y.KQ)(r).add(-7,o.amount)).utc().startOf(o.startOf),f=(0,Y.KQ)(r||(0,Y.KQ)(i).add(7,o.amount)).utc().startOf(o.startOf).valueOf(),y=[];for(;u.valueOf()<=f;)y.push(u.locale(this.dateLocale).format(this.pattern)),u.add(1,o.amount);return y}}var ps=h(46933);class cr extends S.Is{constructor(i){super(),this.datasource=i}importFromAbstractQuery(i){return{metrics:[{id:"1",type:"logs"}],query:this.getElasticsearchDataQuery(i.labelMatchers),refId:i.refId}}getElasticsearchDataQuery(i){return i.map(r=>{switch(r.operator){case ps.D_.Equal:return r.name+':"'+r.value+'"';case ps.D_.NotEqual:return"-"+r.name+':"'+r.value+'"';case ps.D_.EqualRegEx:return r.name+":/"+r.value+"/";case ps.D_.NotEqualRegEx:return"-"+r.name+":/"+r.value+"/"}}).join(" AND ")}}var ur=h(32300),hs=h(30048);function dr(t){const i=t.annotation,r=t.onAnnotationChange;return(0,e.jsxs)(ei.B,{direction:"column",gap:5,children:[(0,e.jsx)("div",{children:(0,e.jsx)(Xs,{value:i.target?.query,onChange:n=>{const u={...i.target??{refId:"annotation_query"},query:n};r({...i,target:u})}})}),(0,e.jsxs)("div",{children:[(0,e.jsx)("h6",{children:"Field mappings"}),(0,e.jsxs)(ur.U,{children:[(0,e.jsx)(hs.c,{label:"Time",children:(0,e.jsx)(F.p,{type:"text",placeholder:"@timestamp",value:i.timeField,onChange:n=>{r({...i,timeField:n.currentTarget.value})}})}),(0,e.jsx)(hs.c,{label:"Time End",children:(0,e.jsx)(F.p,{type:"text",value:i.timeEndField,onChange:n=>{r({...i,timeEndField:n.currentTarget.value})}})}),(0,e.jsx)(hs.c,{label:"Text",children:(0,e.jsx)(F.p,{type:"text",value:i.textField,onChange:n=>{r({...i,textField:n.currentTarget.value})}})}),(0,e.jsx)(hs.c,{label:"Tags",children:(0,e.jsx)(F.p,{type:"text",placeholder:"tags",value:i.tagsField,onChange:n=>{r({...i,tagsField:n.currentTarget.value})}})})]})]}),(0,e.jsx)("div",{})]})}function fr(t){return!t||typeof t!="object"?!1:"meta"in t}var it=h(94601);function ms(t,i,r,n=""){return ii(t,i,r,n)!==null}function ii(t,i,r,n=""){const o=`${n}${it.term.escape(i)}`;r=it.phrase.escape(r);let u=oi(t);return u?Qs(u,o,r):null}function Qs(t,i,r){return Object.keys(t).length===0?null:li(t.left)?Qs(t.left,i,r):vs(t.left)&&t.left.field===i&&t.left.term===r?t.left:qs(t)?null:vs(t.right)&&t.right.field===i&&t.right.term===r?t.right:zs(t.right)?Qs(t.right,i,r):null}function St(t,i,r,n=""){if(ms(t,i,r,n))return t;i=ai(i),r=ys(r);const o=`${n}${i}:"${r}"`;return ri(t,o)}function ri(t,i,r="AND"){return i?t.trim()===""?i:`${t} ${r} ${i}`:t}function gr(t,i,r){if(!i.key||!i.value)return t;i={...i,value:i.value.toString()};let n=i.key;if(r&&n==="level"&&(n=r),["=","!="].includes(i.operator))return St(t,n,i.value,i.operator==="="?"":"-");n=ai(n);const u=ys(i.value),f=ys(i.value,!1);let y="";switch(i.operator){case"=~":y=`${n}:/${f}/`;break;case"!~":y=`-${n}:/${f}/`;break;case">":y=`${n}:>${u}`;break;case"<":y=`${n}:<${u}`;break}return ri(t,y)}function ni(t,i,r,n=""){const o=ii(t,i,r,n),u=oi(t);return!o||!u?t:it.toString(Ws(u,o))}function Ws(t,i){return Object.keys(t).length===0?t:li(t.left)?(t.left=Ws(t.left,i),t):vs(t.left)&&(0,V.isEqual)(t.left,i)?(Object.assign(t,{left:void 0,operator:void 0,right:void 0},"right"in t?t.right:{}),t):qs(t)?t:vs(t.right)&&(0,V.isEqual)(t.right,i)?(Object.assign(t,{right:void 0,operator:void 0}),t):(zs(t.right)&&(t.right=Ws(t.right,i)),t)}function ai(t){return it.term.escape(t)}function ys(t,i=!0){return i&&(t=t.replace(/\\/g,"\\\\")),it.phrase.escape(t)}function pr(t){return t.replace(/(\w+)\s(:)/gi,"$1$2")}function qs(t){return!t||typeof t!="object"?!1:"left"in t&&!("right"in t)}function zs(t){return!t||typeof t!="object"?!1:"left"in t&&"right"in t}function li(t){return qs(t)||zs(t)}function vs(t){return!!(t&&typeof t=="object"&&"term"in t)}function oi(t){try{return it.parse(pr(t))}catch{return null}}function ci(t,i,r=!0){const n=`"${ys(i)}"`;return t.trim()?`${t} ${r?"AND":"NOT"} ${n}`:`${r?"":"NOT "}${n}`}var ks=h(27489),hr=h(45622);const mr=({payload:{dashboardId:t,orgId:i,grafanaVersion:r,queries:n}})=>{try{const o=n[hr.id]?.filter(O=>!O.hide);if(!o?.length)return;const u=o.filter(vr),f=o.filter(O=>!!O.query),y=o.filter(O=>Ft(O)==="logs"),$=o.filter(O=>Ft(O)==="metric"),p=o.filter(O=>Ft(O)==="raw_data"),v=o.filter(O=>Ft(O)==="raw_document"),E=o.filter(yr),L={grafana_version:r,dashboard_id:t,org_id:i,queries_count:o.length,logs_queries_count:y.length,metric_queries_count:$.length,raw_data_queries_count:p.length,raw_document_queries_count:v.length,queries_with_template_variables_count:u.length,queries_with_changed_line_limit_count:E.length,queries_with_lucene_query_count:f.length};(0,ks.rR)("grafana_elasticsearch_dashboard_loaded",L)}catch(o){console.error("error in elasticsearch tracking handler",o)}},Ft=t=>!t.metrics||!t.metrics.length?void 0:["logs","raw_data","raw_document"].includes(t.metrics[0].type)?t.metrics[0].type:"metric",ui=t=>{if(t.metrics?.[0]?.type!=="logs")return;const i=t.metrics?.[0].settings?.limit;return i?parseInt(i,10):void 0},yr=t=>{const i=ui(t);return i!==void 0&&i!==500},vr=t=>ot.test(t.query??""),xr=t=>!!t.startsWith(di);function br(t,i,r){const{targets:n,app:o}=i;if(!(o===Bs.Jk.Dashboard||o===Bs.Jk.PanelViewer))for(const u of n){if(xr(u.refId))return;(0,ks.rR)("grafana_elasticsearch_query_executed",{app:o,grafana_version:tt.$.buildInfo.version,with_lucene_query:!!u.query,query_type:Ft(u),line_limit:ui(u),alias:u.alias,has_error:t.error!==void 0,has_data:t.data.some(f=>f.length>0),simultaneously_sent_query_count:n.length,time_range_from:i?.range?.from?.toISOString(),time_range_to:i?.range?.to?.toISOString(),time_taken:Date.now()-r.getTime()})}}function jr(t){(0,ks.rR)("grafana_elasticsearch_annotation_query_executed",{grafana_version:tt.$.buildInfo.version,has_target_query:!!t.target?.query,has_query:!!t.query,has_time_field:!!t.timeField,has_time_end_field:!!t.timeEndField,has_tags_field:!!t.tagsField,has_text_field:!!t.textField,has_index:!!t.index})}const $r=t=>t&&typeof t=="object"&&"responses"in t&&Array.isArray(t.responses)&&t.responses.find(i=>typeof i=="object"&&i!==null&&"hits"in i&&typeof i.hits=="object"&&i.hits!==null&&"hits"in i.hits&&Array.isArray(i.hits.hits)),Sr=t=>t&&typeof t=="object"&&"responses"in t&&Array.isArray(t.responses)&&t.responses.find(i=>typeof i=="object"&&i!==null&&"aggregations"in i&&typeof i.aggregations=="object"&&i.aggregations!==null&&Object.keys(i.aggregations).length>0),di="log-volume-",fi="log-sample-",Fr=["_index","_type","_id","_source","_size","_field_names","_ignored","_routing","_meta"];class Ir extends nr.iy{constructor(i,r=(0,ar.w)()){super(i),this.templateSrv=r,this.getLogRowContext=async(o,u)=>{const f=this.makeLogContextDataRequest(o,u);return(0,le.s)(this.query(f).pipe((0,ti.W)(y=>{throw{message:"Error during context query. Please check JS console logs.",status:y.status,statusText:y.statusText}})))},this.makeLogContextDataRequest=(o,u)=>{const f=u?.direction||te.ZF.Backward,y={type:"logs",id:"1",settings:{limit:u?.limit?u?.limit.toString():"10",sortDirection:f===te.ZF.Backward?"desc":"asc",searchAfter:o.dataFrame.fields.find(O=>O.name==="sort")?.values[o.rowIndex]??[o.timeEpochMs]}},$={refId:`log-context-${o.dataFrame.refId}-${f}`,metrics:[y],query:""},p=wr(o.timeEpochMs,f,this.intervalPattern),v={from:p.from,to:p.to,raw:p},E=rr.calculateInterval(v,1);return{requestId:`log-context-request-${o.dataFrame.refId}-${u?.direction}`,targets:[$],interval:E.interval,intervalMs:E.intervalMs,range:v,scopedVars:{},timezone:"UTC",app:Bs.Jk.Explore,startTime:Date.now(),hideFromInspector:!0}},this.basicAuth=i.basicAuth,this.withCredentials=i.withCredentials,this.url=i.url,this.name=i.name,this.isProxyAccess=i.access==="proxy";const n=i.jsonData||{};this.index=n.index??i.database??"",this.timeField=n.timeField,this.indexPattern=new or(this.index,n.interval),this.intervalPattern=n.interval,this.interval=n.timeInterval,this.maxConcurrentShardRequests=n.maxConcurrentShardRequests,this.queryBuilder=new pt({timeField:this.timeField}),this.logLevelField=n.logLevelField||"",this.dataLinks=n.dataLinks||[],this.includeFrozen=n.includeFrozen??!1,this.databaseVersion=null,this.annotations={QueryEditor:dr},this.logLevelField===""&&(this.logLevelField=void 0),this.languageProvider=new cr(this)}getResourceRequest(i,r,n){return this.getResource(i,r,n)}postResourceRequest(i,r,n){const o=n??{};return o.headers=o.headers??{},o.headers["content-type"]="application/x-ndjson",this.postResource(i,r,o)}async importFromAbstractQueries(i){return i.map(r=>this.languageProvider.importFromAbstractQuery(r))}requestAllIndices(i=(0,G.E2)()){let r=this.indexPattern.getIndexList(i.from,i.to);Array.isArray(r)||(r=[this.indexPattern.getIndexForToday()]);const n=tt.$.featureToggles.elasticsearchCrossClusterSearch?"_field_caps":"_mapping",o=r.map(y=>(y=y.replace(/\/$/,""),y===""?n:`${y}/${n}`)),u=7,f=o.length;return(0,Zi.c)({initialState:0,condition:y=>y<Math.min(f,u),iterate:y=>y+1}).pipe((0,Xi.Z)(y=>{const $=o[f-y-1];return(0,gs.H)(this.getResource($)).pipe((0,ti.W)(p=>(0,Ji.of)({err:p})))}),(0,er.j)(y=>y?.err?.status===404),(0,tr.v)(()=>"Could not find an available index for this time range."),(0,sr.$)(),(0,st.T)(y=>{if(y.err)throw y.err;return y}))}annotationQuery(i){const r=this.prepareAnnotationRequest(i);jr(i.annotation);const n=(0,gs.H)(this.postResourceRequest("_msearch",r));return(0,le.s)(n.pipe((0,st.T)(o=>{if(!$r(o))return[];const u=o?.responses[0].hits?.hits??[];return this.processHitsToAnnotationEvents(i.annotation,u)})))}prepareAnnotationRequest(i){const r=i.annotation,n=r.timeField||"@timestamp",o=r.timeEndField||null,$=i.dashboard.getVariables().filter($e=>$e.type==="adhoc").filter($e=>$e.datasource?.uid===r.datasource.uid).map($e=>$e.filters).flat(),p=r.query??r.target?.query??"",v=[],E={};if(E[n]={from:i.range.from.valueOf(),to:i.range.to.valueOf(),format:"epoch_millis"},v.push({range:E}),o){const $e={};$e[o]={from:i.range.from.valueOf(),to:i.range.to.valueOf(),format:"epoch_millis"},v.push({range:$e})}const L=this.interpolateLuceneQuery(p),O=this.addAdHocFilters(L,$),U={bool:{filter:[{bool:{should:v,minimum_should_match:1}}]}};O&&U.bool.filter.push({query_string:{query:O}});const Tr={query:U,size:1e4},Hs={search_type:"query_then_fetch",ignore_unavailable:!0};return r.index?Hs.index=r.index:Hs.index=this.indexPattern.getIndexList(i.range.from,i.range.to),JSON.stringify(Hs)+`
`+JSON.stringify(Tr)+`
`}processHitsToAnnotationEvents(i,r){const n=i.timeField||"@timestamp",o=i.timeEndField||null,u=i.textField||"tags",f=i.tagsField||null,y=[],$=(p,v)=>{if(!v)return;const E=v.split(".");let L=p;for(let O=0;O<E.length;O++)if(L=L[E[O]],!L)return"";return L};for(let p=0;p<r.length;p++){const v=r[p]._source;let E=$(v,n);if(typeof r[p].fields<"u"){const U=r[p].fields;typeof U=="object"&&((0,V.isString)(U[n])||(0,V.isNumber)(U[n]))&&(E=U[n])}const L={annotation:i,time:(0,Y.yT)(E).valueOf(),text:$(v,u)};if(o){const U=$(v,o);U&&(L.timeEnd=(0,Y.yT)(U).valueOf())}if(i.titleField){const U=$(v,i.titleField);U&&(L.text=U+`
`+L.text)}const O=$(v,f);typeof O=="string"?L.tags=O.split(","):L.tags=O,y.push(L)}return y}interpolateLuceneQuery(i,r){return this.templateSrv.replace(i,r,"lucene")}interpolateVariablesInQueries(i,r,n){return i.map(o=>this.applyTemplateVariables(o,r,n))}getQueryHeader(i,r,n){const o={search_type:i,ignore_unavailable:!0,index:this.indexPattern.getIndexList(r,n)};return JSON.stringify(o)}getQueryDisplayText(i){const r=i.metrics,n=i.bucketAggs;let o="";return i.query&&(o+="Query: "+i.query+", "),o+="Metrics: ",o+=r?.reduce((u,f)=>{let $=Q[f.type].label+"(";return de(f)&&($+=f.field),Re(f)&&($+=Ne(f).replace(new RegExp("params.","g"),"")),$+="), ",`${u} ${$}`},""),o+=n?.reduce((u,f,y)=>{const $=W[f.type];let p="";return y===0&&(p+=" Group by: "),p+=$.label+"(",Ge(f)&&(p+=f.field),`${u} ${p}), `},""),i.alias&&(o+="Alias: "+i.alias),o}getSupplementaryRequest(i,r){switch(i){case te.cF.LogsVolume:return this.getLogsVolumeDataProvider(r);case te.cF.LogsSample:return this.getLogsSampleDataProvider(r);default:return}}getSupportedSupplementaryQueryTypes(){return[te.cF.LogsVolume,te.cF.LogsSample]}getSupplementaryQuery(i,r){let n=!1;if(!r.hide)switch(i.type){case te.cF.LogsVolume:if(n=r.metrics?.length===1&&r.metrics[0].type==="logs",!n)return;const o=[],u=this.timeField??"@timestamp";return this.logLevelField&&o.push({id:"2",type:"terms",settings:{min_doc_count:"0",size:"0",order:"desc",orderBy:"_count",missing:te.$b.unknown},field:this.logLevelField}),o.push({id:"3",type:"date_histogram",settings:{interval:"auto",min_doc_count:"0",trimEdges:"0"},field:u}),{refId:`${di}${r.refId}`,query:r.query,metrics:[{type:"count",id:"1"}],timeField:u,bucketAggs:o};case te.cF.LogsSample:return n=Be(r),n?i.limit?{refId:`${fi}${r.refId}`,query:r.query,metrics:[{type:"logs",id:"1",settings:{limit:i.limit.toString()}}]}:{refId:`${fi}${r.refId}`,query:r.query,metrics:[{type:"logs",id:"1"}]}:void 0;default:return}}getLogsVolumeDataProvider(i){const r=(0,V.cloneDeep)(i),n=r.targets.map(o=>this.getSupplementaryQuery({type:te.cF.LogsVolume},o)).filter(o=>!!o);if(n.length)return{...r,targets:n}}getLogsSampleDataProvider(i){const r=(0,V.cloneDeep)(i),u=r.targets.map(f=>this.getSupplementaryQuery({type:te.cF.LogsSample,limit:100},f)).filter(f=>!!f);if(u.length)return{...r,targets:u}}query(i){const r=new Date;return super.query(i).pipe((0,ir.M)(n=>br(n,i,r)),(0,st.T)(n=>(n.data.forEach(o=>{Ar(o,this.dataLinks)}),n)))}filterQuery(i){return!i.hide}isMetadataField(i){return Fr.includes(i)}getFields(i,r){if(tt.$.featureToggles.elasticsearchCrossClusterSearch)return this.getFieldsCrossCluster(i,r);const n={float:"number",double:"number",integer:"number",long:"number",date:"date",date_nanos:"date",string:"string",text:"string",scaled_float:"number",nested:"nested",histogram:"number"};return this.requestAllIndices(r).pipe((0,st.T)(o=>{const u=(p,v)=>this.isMetadataField(v)?!1:!i||i.length===0?!0:i.includes(p.type)||i.includes(n[p.type]),f=[],y={};function $(p){for(const v in p){const E=p[v];if((0,V.isObject)(E.properties)&&(f.push(v),$(E.properties)),(0,V.isObject)(E.fields)&&(f.push(v),$(E.fields)),(0,V.isString)(E.type)){const L=f.concat(v).join(".");u(E,v)&&(y[L]={text:L,type:E.type})}}f.pop()}for(const p in o){const v=o[p];if(v&&v.mappings){const L=v.mappings.properties;$(L)}}return(0,V.map)(y,p=>p)}))}getFieldsCrossCluster(i,r){const n={float:"number",double:"number",integer:"number",long:"number",date:"date",date_nanos:"date",string:"string",text:"string",scaled_float:"number",nested:"nested",histogram:"number"};return this.requestAllIndices(r).pipe((0,st.T)(o=>{const u=$=>{for(const p in $)if(p!=="object"&&!$[p].metadata_field&&(!i||i.length===0||i.includes(p)||i.includes(n[p])))return!0;return!1},f={},y=o.fields;for(const $ in y){const p=y[$];u(p)&&(f[$]={text:$,type:p.type})}return(0,V.map)(f,$=>$)}))}getTerms(i,r=(0,G.E2)(),n=!1){const u=this.getQueryHeader("query_then_fetch",r.from,r.to);let f=JSON.stringify(this.queryBuilder.getTermsQuery(i));f=f.replace(/\$timeFrom/g,r.from.valueOf().toString()),f=f.replace(/\$timeTo/g,r.to.valueOf().toString()),f=u+`
`+f+`
`;const y=this.getMultiSearchUrl();return(0,gs.H)(this.postResourceRequest(y,f)).pipe((0,st.T)($=>{if(!Sr($))return[];if(!$||!$.responses[0].aggregations)return[];const p=$.responses[0].aggregations[1].buckets;return(0,V.map)(p,v=>{const E=String(v.key);return{text:v.key_as_string||E,value:n?E:v.key}})}))}getMultiSearchUrl(){const i=new URLSearchParams;return this.maxConcurrentShardRequests&&i.append("max_concurrent_shard_requests",`${this.maxConcurrentShardRequests}`),this.includeFrozen&&i.append("ignore_throttled","false"),("_msearch?"+i.toString()).replace(/\?$/,"")}metricFindQuery(i,r){const n=r?.range,o=JSON.parse(i);if(i){if(o.find==="fields")return o.type=this.interpolateLuceneQuery(o.type),(0,le.s)(this.getFields(o.type,n));if(o.find==="terms")return o.field=this.interpolateLuceneQuery(o.field),o.query=this.interpolateLuceneQuery(o.query),(0,le.s)(this.getTerms(o,n))}return Promise.resolve([])}getTagKeys(){return(0,le.s)(this.getFields())}getTagValues(i){return(0,le.s)(this.getTerms({field:i.key},i.timeRange,!0))}targetContainsTemplate(i){if(this.templateSrv.containsTemplate(i.query)||this.templateSrv.containsTemplate(i.alias))return!0;if(i.bucketAggs){for(const r of i.bucketAggs)if(Ge(r)&&this.templateSrv.containsTemplate(r.field)||this.objectContainsTemplate(r.settings))return!0}if(i.metrics){for(const r of i.metrics)if(de(r)&&(r.field&&this.templateSrv.containsTemplate(r.field)||r.settings&&this.objectContainsTemplate(r.settings)||fr(r)&&this.objectContainsTemplate(r.meta)))return!0}return!1}objectContainsTemplate(i){if(typeof i=="string")return this.templateSrv.containsTemplate(i);if(!i||typeof i!="object")return!1;for(const r in i)if(Array.isArray(i[r])){for(const n of i[r])if(this.objectContainsTemplate(n))return!0}else if(this.objectContainsTemplate(i[r]))return!0;return!1}toggleQueryFilter(i,r){let n=i.query??"";switch(r.type){case"FILTER_FOR":{n=ms(n,r.options.key,r.options.value)?ni(n,r.options.key,r.options.value):St(n,r.options.key,r.options.value);break}case"FILTER_OUT":{ms(n,r.options.key,r.options.value)&&(n=ni(n,r.options.key,r.options.value)),n=St(n,r.options.key,r.options.value,"-");break}}return{...i,query:n}}queryHasFilter(i,r){let n=i.query??"";return ms(n,r.key,r.value)}modifyQuery(i,r){if(!r.options)return i;let n=i.query??"";switch(r.type){case"ADD_FILTER":{n=St(n,r.options.key,r.options.value);break}case"ADD_FILTER_OUT":{n=St(n,r.options.key,r.options.value,"-");break}case"ADD_STRING_FILTER":{n=ci(n,r.options.value);break}case"ADD_STRING_FILTER_OUT":{n=ci(n,r.options.value,!1);break}}return{...i,query:n}}getSupportedQueryModifications(){return["ADD_FILTER","ADD_FILTER_OUT","ADD_STRING_FILTER","ADD_STRING_FILTER_OUT"]}addAdHocFilters(i,r){if(!r)return i;let n=i;return r.forEach(o=>{n=gr(n,o,this.logLevelField)}),n}applyTemplateVariables(i,r,n){const o=y=>y.type==="filters"?{...y,settings:{...y.settings,filters:y.settings?.filters?.map($=>({...$,query:this.interpolateLuceneQuery($.query,r)||"*"}))}}:y,u={...i,datasource:this.getRef(),query:this.addAdHocFilters(this.interpolateLuceneQuery(i.query||"",r),n),bucketAggs:i.bucketAggs?.map(o)};return JSON.parse(this.templateSrv.replace(JSON.stringify(u),r))}getDatabaseVersionUncached(){const i=(0,gs.H)(this.getResourceRequest(""));return(0,le.s)(i).then(r=>{const n=r?.version?.number;if(typeof n!="string")return null;try{return new Ve.SemVer(n)}catch(o){return console.error(o),null}},r=>(console.error(r),null))}async getDatabaseVersion(i=!0){if(i){const n=this.databaseVersion;if(n!=null)return n}const r=await this.getDatabaseVersionUncached();return this.databaseVersion=r,r}}function Ar(t,i){if(i.length)for(const r of t.fields){const n=i.filter(o=>new RegExp(o.field).test(r.name));n.length!==0&&(r.config=r.config||{},r.config.links=[...(r.config.links,n.map(Cr))])}}function Cr(t){const i=(0,lr.l)();if(t.datasourceUid){const r=i.getInstanceSettings(t.datasourceUid);return{title:t.urlDisplayLabel||"",url:"",internal:{query:{query:t.url},datasourceUid:t.datasourceUid,datasourceName:r?.name??"Data source not found"}}}else return{title:t.urlDisplayLabel||"",url:t.url}}function wr(t,i,r){if(r){const o=si[r];return i===te.ZF.Forward?{from:(0,Y.KQ)(t).utc(),to:(0,Y.KQ)(t).add(7,o.amount).utc().startOf(o.startOf)}:{from:(0,Y.KQ)(t).subtract(7,o.amount).utc().startOf(o.startOf),to:(0,Y.KQ)(t).utc()}}else return i===te.ZF.Forward?{from:(0,Y.KQ)(t).utc(),to:(0,Y.KQ)(t).add(7,"hours").utc()}:{from:(0,Y.KQ)(t).subtract(7,"hours").utc(),to:(0,Y.KQ)(t).utc()}}const Mr=new S.tD(Ir).setQueryEditor(ji).setConfigEditor(Yi);(0,_.J7)().subscribe(d.gc,mr)}}]);

//# sourceMappingURL=6260.b8be95165766a81dade2.js.map