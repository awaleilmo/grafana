"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[7651],{10180:(C,p,s)=>{s.d(p,{s:()=>h});var o=s(74848),n=s(96540),g=s(51898),c=s(92745),_=s(76319),e=s(63527);const h=(0,n.forwardRef)((m,f)=>{const[E,u]=(0,n.useState)(!1);return(0,o.jsx)(e.p,{...m,type:E?"text":"password","data-testid":g.Tp.pages.Login.password,ref:f,suffix:(0,o.jsx)(_.K,{name:E?"eye-slash":"eye","aria-controls":m.id,role:"switch","aria-checked":E,onClick:()=>{u(!E)},tooltip:E?(0,c.t)("grafana-ui.password-field.tooltip-hide","Hide password"):(0,c.t)("grafana-ui.password-field.tooltip-show","Show password")})})});h.displayName="PasswordField"},10501:(C,p,s)=>{s.d(p,{DP:()=>E,NQ:()=>f,zJ:()=>u});var o=s(74848),n=s(22803),g=s(92745),c=s(30703),_=s(66404),e=s(31286),h=s(63142),m=s(65642);const f=[{message:"At least 12 characters",validation:t=>t.length>=12},{message:"One uppercase letter",validation:t=>/[A-Z]+/.test(t)},{message:"One lowercase letter",validation:t=>/[a-z]+/.test(t)},{message:"One number",validation:t=>/[0-9]+/.test(t)},{message:"One symbol",validation:t=>/[\W]/.test(t)}],E=t=>!m.Ay.auth.basicAuthStrongPasswordPolicy||f.every(a=>a.validation(t))||(0,g.t)("profile.change-password.strong-password-validation-register","Password does not comply with the strong password policy"),u=({strongPasswordValidations:t,password:a,pristine:r})=>(0,o.jsx)(e.a,{marginBottom:2,children:t.map(d=>(0,o.jsx)(i,{strongPasswordValidation:d,password:a,pristine:r},d.message))}),i=({strongPasswordValidation:t,password:a,pristine:r})=>{const d=(0,h.of)(l),{basicAuthStrongPasswordPolicy:w}=m.Ay.auth;if(!w)return null;const{message:M,validation:O}=t,D=a.length>0&&O(a),x=D||r?"check":"exclamation-triangle",L=D?"secondary":r?"primary":"error";let P;return D?P=d.icon.valid:r?P=d.icon.pending:P=d.icon.error,(0,o.jsxs)(e.a,{display:"flex",alignItems:"center",marginTop:1,children:[(0,o.jsx)(c.I,{className:(0,n.cx)(d.icon.style,P),name:x}),(0,o.jsx)(_.E,{color:L,children:M})]},M)},l=t=>({icon:{style:(0,n.css)({marginRight:t.spacing(1)}),valid:(0,n.css)({color:t.colors.success.text}),pending:(0,n.css)({color:t.colors.secondary.text}),error:(0,n.css)({color:t.colors.error.text})}})},53539:(C,p,s)=>{s.d(p,{A:()=>E});var o=s(74848),n=s(96540),g=s(92745),c=s(68143),_=s(36490),e=s(65642);const h=()=>!!e.Ay.oauth&&Object.keys(e.Ay.oauth).length>0,m=()=>!!_.Ny.getSearch().get("code");class f extends n.PureComponent{constructor(t){super(t),this.changePassword=a=>{const r={newPassword:a,confirmNew:a,oldPassword:"admin"};if(this.props.resetCode){const d={code:this.props.resetCode,newPassword:a,confirmPassword:a};(0,c.AI)().post("/api/user/password/reset",d).then(()=>{this.toGrafana()})}else(0,c.AI)().put("/api/user/password",r).then(()=>{this.toGrafana()}).catch(d=>console.error(d))},this.login=a=>{this.setState({loginErrorMessage:void 0,isLoggingIn:!0}),(0,c.AI)().post("/login",a,{showErrorAlert:!1}).then(r=>{if(this.result=r,a.password!=="admin"||e.Ay.ldapEnabled||e.Ay.authProxyEnabled){this.toGrafana();return}else this.changeView(a.password==="admin")}).catch(r=>{const d=(0,c.NF)(r)?u(r):void 0;this.setState({isLoggingIn:!1,loginErrorMessage:d||(0,g.t)("login.error.unknown","Unknown error occurred")})})},this.passwordlessStart=a=>{this.setState({loginErrorMessage:void 0,isLoggingIn:!0}),(0,c.AI)().post("/api/login/passwordless/start",a,{showErrorAlert:!1}).then(r=>{window.location.assign(r.URL)}).catch(r=>{const d=(0,c.NF)(r)?u(r):void 0;this.setState({isLoggingIn:!1,loginErrorMessage:d||(0,g.t)("login.error.unknown","Unknown error occurred")})})},this.passwordlessConfirm=a=>{this.setState({loginErrorMessage:void 0,isLoggingIn:!0}),(0,c.AI)().post("/api/login/passwordless/authenticate",a,{showErrorAlert:!1}).then(r=>{this.result=r,this.toGrafana()}).catch(r=>{const d=(0,c.NF)(r)?u(r):void 0;this.setState({isLoggingIn:!1,loginErrorMessage:d||(0,g.t)("login.error.unknown","Unknown error occurred")})})},this.changeView=a=>{this.setState({isChangingPassword:!0,showDefaultPasswordWarning:a})},this.toGrafana=()=>{if(e.Ay.featureToggles.useSessionStorageForRedirection){window.location.assign(e.Ay.appSubUrl+"/");return}this.result?.redirectUrl?e.Ay.appSubUrl!==""&&!this.result.redirectUrl.startsWith(e.Ay.appSubUrl)?window.location.assign(e.Ay.appSubUrl+this.result.redirectUrl):window.location.assign(this.result.redirectUrl):window.location.assign(e.Ay.appSubUrl+"/")},this.state={isLoggingIn:!1,isChangingPassword:!1,showDefaultPasswordWarning:!1,loginErrorMessage:i(e.Ay.loginError)}}render(){const{children:t}=this.props,{isLoggingIn:a,isChangingPassword:r,showDefaultPasswordWarning:d,loginErrorMessage:w}=this.state,{login:M,toGrafana:O,changePassword:D,passwordlessStart:x,passwordlessConfirm:L}=this,{loginHint:P,passwordHint:y,disableLoginForm:v,disableUserSignUp:I}=e.Ay;return(0,o.jsx)(o.Fragment,{children:t({isOauthEnabled:h(),loginHint:P,passwordHint:y,disableLoginForm:v,disableUserSignUp:I,login:M,passwordlessStart:x,passwordlessConfirm:L,showPasswordlessConfirmation:m(),isLoggingIn:a,changePassword:D,skipPasswordChange:O,isChangingPassword:r,showDefaultPasswordWarning:d,loginErrorMessage:w})})}}const E=f;function u(l){switch(l.data?.messageId){case"password-auth.empty":case"password-auth.failed":case"password-auth.invalid":return(0,g.t)("login.error.invalid-user-or-password","Invalid username or password");case"login-attempt.blocked":return(0,g.t)("login.error.blocked","You have exceeded the number of login attempts for this user. Please try again later.");default:return l.data?.message}}function i(l){switch(l){case"oauth.login.error":return(0,g.t)("oauth.login.error","Login provider denied login request");default:return l}}},58102:(C,p,s)=>{s.d(p,{GU:()=>f,YO:()=>u,qm:()=>m});var o=s(74848),n=s(22803),g=s(96540),c=s(92745),_=s(63142),e=s(92948),h=s(10388);const m=({children:i,enterAnimation:l=!0})=>{const t=(0,_.of)(u);return(0,o.jsx)("div",{className:(0,n.cx)(t.loginInnerBox,l&&t.enterAnimation),children:i})},f=({children:i,branding:l,isChangingPassword:t})=>{const a=(0,_.of)(u),[r,d]=(0,g.useState)(!1),w=l?.loginSubtitle??e.M.GetLoginSubTitle(),M=l?.loginTitle??e.M.LoginTitle,O=l?.loginBoxBackground||e.M.LoginBoxBackground(),D=l?.loginLogo,x=l?.hideEdition??e.M.HideEdition;return(0,g.useEffect)(()=>d(!0),[]),(0,o.jsxs)(e.M.LoginBackground,{className:(0,n.cx)(a.container,r&&a.loginAnim,l?.loginBackground),children:[(0,o.jsx)("div",{className:a.loginMain,children:(0,o.jsxs)("div",{className:(0,n.cx)(a.loginContent,O,"login-content-box"),children:[(0,o.jsxs)("div",{className:a.loginLogoWrapper,children:[(0,o.jsx)(e.M.LoginLogo,{className:a.loginLogo,logo:D}),(0,o.jsx)("div",{className:a.titleWrapper,children:t?(0,o.jsx)("h1",{className:a.mainTitle,children:(0,o.jsx)(c.x6,{i18nKey:"login.layout.update-password",children:"Update your password"})}):(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("h1",{className:a.mainTitle,children:M}),w&&(0,o.jsx)("h3",{className:a.subTitle,children:w})]})})]}),(0,o.jsx)("div",{className:a.loginOuterBox,children:i})]})}),l?.hideFooter?(0,o.jsx)(o.Fragment,{}):(0,o.jsx)(h.wi,{hideEdition:x,customLinks:l?.footerLinks})]})},E=(0,n.keyframes)`
from{
  opacity: 0;
  transform: translate(-60px, 0px);
}

to{
  opacity: 1;
  transform: translate(0px, 0px);
}`,u=i=>({loginMain:(0,n.css)({flexGrow:1,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",minWidth:"100%"}),container:(0,n.css)({minHeight:"100%",backgroundPosition:"center",backgroundRepeat:"no-repeat",flex:1,minWidth:"100%",marginLeft:0,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center"}),loginAnim:(0,n.css)({"&:before":{opacity:1},".login-content-box":{opacity:1}}),submitButton:(0,n.css)({justifyContent:"center",width:"100%"}),loginLogo:(0,n.css)({width:"100%",maxWidth:60,marginBottom:i.spacing(2),[i.breakpoints.up("sm")]:{maxWidth:100}}),loginLogoWrapper:(0,n.css)({display:"flex",alignItems:"center",justifyContent:"center",flexDirection:"column",padding:i.spacing(3)}),titleWrapper:(0,n.css)({textAlign:"center"}),mainTitle:(0,n.css)({fontSize:22,[i.breakpoints.up("sm")]:{fontSize:32}}),subTitle:(0,n.css)({fontSize:i.typography.size.md,color:i.colors.text.secondary}),loginContent:(0,n.css)({maxWidth:478,width:"calc(100% - 2rem)",display:"flex",alignItems:"stretch",flexDirection:"column",position:"relative",justifyContent:"flex-start",zIndex:1,minHeight:320,borderRadius:i.shape.radius.default,padding:i.spacing(2,0),opacity:0,[i.transitions.handleMotion("no-preference","reduce")]:{transition:"opacity 0.5s ease-in-out"},[i.breakpoints.up("sm")]:{minHeight:i.spacing(40),justifyContent:"center"}}),loginOuterBox:(0,n.css)({display:"flex",overflowY:"hidden",alignItems:"center",justifyContent:"center"}),loginInnerBox:(0,n.css)({padding:i.spacing(0,2,2,2),display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",flexGrow:1,maxWidth:415,width:"100%",transform:"translate(0px, 0px)",[i.transitions.handleMotion("no-preference")]:{transition:"0.25s ease"}}),enterAnimation:(0,n.css)({[i.transitions.handleMotion("no-preference")]:{animation:`${E} ease-out 0.2s`}})})},61238:(C,p,s)=>{s.d(p,{$:()=>l,Q:()=>i});var o=s(74848),n=s(22803),g=s(96540),c=s(49785),_=s(51898),e=s(92745),h=s(45861),m=s(37386),f=s(63527),E=s(63142),u=s(10180);const i=({children:t,onSubmit:a,isLoggingIn:r,passwordHint:d,loginHint:w})=>{const M=(0,E.of)(l),O=(0,g.useId)(),D=(0,g.useId)(),{handleSubmit:x,register:L,formState:{errors:P}}=(0,c.mN)({mode:"onChange"});return(0,o.jsx)("div",{className:M.wrapper,children:(0,o.jsxs)("form",{onSubmit:x(a),children:[(0,o.jsx)(m.D,{label:(0,e.t)("login.form.username-label","Email or username"),invalid:!!P.user,error:P.user?.message,children:(0,o.jsx)(f.p,{...L("user",{required:(0,e.t)("login.form.username-required","Email or username is required")}),id:O,autoFocus:!0,autoCapitalize:"none",placeholder:w||(0,e.t)("login.form.username-placeholder","email or username"),"data-testid":_.Tp.pages.Login.username})}),(0,o.jsx)(m.D,{label:(0,e.t)("login.form.password-label","Password"),invalid:!!P.password,error:P.password?.message,children:(0,o.jsx)(u.s,{...L("password",{required:(0,e.t)("login.form.password-required","Password is required")}),id:D,autoComplete:"current-password",placeholder:d||(0,e.t)("login.form.password-placeholder","password")})}),(0,o.jsx)(h.$n,{type:"submit","data-testid":_.Tp.pages.Login.submit,className:M.submitButton,disabled:r,children:r?(0,e.t)("login.form.submit-loading-label","Logging in..."):(0,e.t)("login.form.submit-label","Log in")}),t]})})},l=t=>({wrapper:(0,n.css)({width:"100%",paddingBottom:t.spacing(2)}),submitButton:(0,n.css)({justifyContent:"center",width:"100%"}),skipButton:(0,n.css)({alignSelf:"flex-start"})})},71586:(C,p,s)=>{s.d(p,{S:()=>r});var o=s(74848),n=s(96540),g=s(49785),c=s(51898),_=s(92745),e=s(43173),h=s(45967),m=s(34999),f=s(45861),E=s(41654),u=s(37386),i=s(63142),l=s(61238),t=s(10180),a=s(10501);const r=({onSubmit:d,onSkip:w,showDefaultPasswordWarning:M})=>{const O=(0,i.of)(l.$),[D,x]=(0,n.useState)(!1),[L,P]=(0,n.useState)(!0),{handleSubmit:y,register:v,getValues:I,formState:{errors:A},watch:T}=(0,g.mN)({defaultValues:{newPassword:"",confirmNew:""}}),U=T("newPassword"),W=B=>{d(B.newPassword)};return(0,o.jsxs)("form",{onSubmit:y(W),children:[M&&(0,o.jsx)(m.F,{severity:"info",title:(0,_.t)("forgot-password.change-password.default-password-alert","Continuing to use the default password exposes you to security risks.")}),(0,o.jsx)(u.D,{label:(0,_.t)("forgot-password.change-password.new-password-label","New password"),invalid:!!A.newPassword,error:A?.newPassword?.message,children:(0,o.jsx)(t.s,{onFocus:()=>x(!0),...v("newPassword",{required:"New Password is required",onBlur:()=>P(!1),validate:{strongPasswordValidationRegister:a.DP}}),id:"new-password",autoFocus:!0,autoComplete:"new-password"})}),D&&(0,o.jsx)(a.zJ,{pristine:L,password:U,strongPasswordValidations:a.NQ}),(0,o.jsx)(u.D,{label:(0,_.t)("forgot-password.change-password.confirm-label","Confirm new password"),invalid:!!A.confirmNew,error:A?.confirmNew?.message,children:(0,o.jsx)(t.s,{...v("confirmNew",{required:"Confirmed Password is required",validate:B=>B===I().newPassword||"Passwords must match!"}),id:"confirm-new-password",autoComplete:"new-password"})}),(0,o.jsxs)(E.B,{direction:"column",children:[(0,o.jsx)(f.$n,{type:"submit",className:O.submitButton,children:(0,o.jsx)(_.x6,{i18nKey:"forgot-password.change-password.submit-button",children:"Submit"})}),!e.$.auth.basicAuthStrongPasswordPolicy&&w&&(0,o.jsx)(h.m,{content:(0,_.t)("forgot-password.change-password.tooltip-skip-button","If you skip you will be prompted to change password next time you log in."),placement:"bottom",children:(0,o.jsx)(f.$n,{className:O.skipButton,fill:"text",onClick:w,type:"button","data-testid":c.Tp.pages.Login.skip,children:(0,o.jsx)(_.x6,{i18nKey:"forgot-password.change-password.skip-button",children:"Skip"})})})]})]})}}}]);

//# sourceMappingURL=7651.df65b2a9b80637c91216.js.map