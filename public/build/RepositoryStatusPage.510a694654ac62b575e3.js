"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[6092],{11065:($,x,n)=>{n.d(x,{R:()=>a});var e=n(84140);function a(M,y,R){if(M.isLight)return y;{if(R){const h=(0,e.A)(y);return e.A.mostReadable(R,[h.clone().lighten(25),h.clone().lighten(10),h,h.clone().darken(10),h.clone().darken(25)],{includeFallbackColors:!1}).toHex8String()}const s=(0,e.A)(y).toHsl();s.l=1-s.l;const c=(0,e.A)(s);return c.isLight()?c.darken(5).toHex8String():c.lighten(5).toHex8String()}}},12917:($,x,n)=>{n.r(x),n.d(x,{default:()=>Oe});var e=n(74848),a=n(96540),M=n(61574),y=n(54148),R=n(5556),s=n(92745),c=n(34999),h=n(50201),i=n(66404),j=n(89640),C=n(54314),W=n(60208),H=n(13941),N=n(68079),P=n(83793),U=n(13791),Q=n(70958),F=n(62939),b=n(41654),K=n(45861),X=n(12737),J=n(27594),Z=n(91555),q=n(75664);function ne({repo:t}){const r=t.metadata?.name??"",o=(0,P.Bm)({name:r}),[p,E]=(0,a.useState)(""),v=[...o.data?.items??[]].filter(u=>u.path.toLowerCase().includes(p.toLowerCase())),g=(0,q.Z)(t.spec?.type),O=[{id:"path",header:"Path",sortType:"string",cell:({row:{original:u}})=>{const{path:l}=u;return(0,e.jsx)("a",{href:`${Z.mL}/${r}/file/${l}`,children:l})}},{id:"size",header:"Size (KB)",cell:({row:{original:u}})=>{const{size:l}=u;return(parseInt(l,10)/1024).toFixed(2)},sortType:"number"},{id:"hash",header:"Hash",sortType:"string"},{id:"actions",header:"",cell:({row:{original:u}})=>{const{path:l}=u;return(0,e.jsxs)(b.B,{children:[(l.endsWith(".json")||l.endsWith(".yaml")||l.endsWith(".yml"))&&(0,e.jsx)(K.z9,{href:`${Z.mL}/${r}/file/${l}`,children:(0,e.jsx)(s.x6,{i18nKey:"provisioning.files-view.columns.view",children:"View"})}),g&&(0,e.jsx)(K.z9,{href:`${Z.mL}/${r}/history/${l}?repo_type=${t.spec?.type}`,children:(0,e.jsx)(s.x6,{i18nKey:"provisioning.files-view.columns.history",children:"History"})})]})}}];return o.isLoading?(0,e.jsx)(b.B,{justifyContent:"center",alignItems:"center",children:(0,e.jsx)(N.y,{})}):(0,e.jsxs)(b.B,{grow:1,direction:"column",gap:2,children:[(0,e.jsx)(b.B,{gap:2,children:(0,e.jsx)(X.Z,{placeholder:(0,s.t)("provisioning.files-view.placeholder-search","Search"),autoFocus:!0,value:p,onChange:E})}),(0,e.jsx)(J.j,{columns:O,data:v,pageSize:25,getRowId:u=>String(u.path)})]})}var d=n(22488),I=n(99887),D=n(34145),S=n(92784),L=n(45942),f=n(82781),m=n(88559),A=n(87063),B=n(30703),V=n(71599);function z({name:t,repository:r,redirectTo:o}){const[p,E]=(0,P.So)(),[v,g]=(0,P.hD)(),[O,u]=(0,a.useState)(!1),[l,k]=(0,a.useState)("remove-resources"),w=(0,y.Zp)();(0,a.useEffect)(()=>{E.isSuccess&&(u(!1),o&&w(o))},[E.isSuccess,o,w]);const Pe=(0,a.useCallback)(async()=>{if(l==="keep-resources"&&r){const we={...r,metadata:{...r.metadata,finalizers:["cleanup","release-orphan-resources"]}};await v({name:t,repository:we})}p({name:t})},[p,v,t,l,r]),Ae=()=>l==="remove-resources"?(0,s.t)("provisioning.delete-repository-button.confirm-delete-with-resources","Are you sure you want to delete the repository configuration and all its resources?"):(0,s.t)("provisioning.delete-repository-button.confirm-delete-keep-resources","Are you sure you want to delete the repository configuration but keep its resources?"),Be=()=>l==="remove-resources"?(0,s.t)("provisioning.delete-repository-button.title-delete-repository-and-resources","Delete repository configuration and resources"):(0,s.t)("provisioning.delete-repository-button.title-delete-repository-only","Delete repository configuration only"),Ne=E.isLoading||g.isLoading;return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(m.m,{overlay:(0,e.jsxs)(A.W,{children:[(0,e.jsx)(A.W.Item,{label:(0,s.t)("provisioning.delete-repository-button.delete-and-remove-resources","Delete and remove resources (default)"),onClick:()=>{k("remove-resources"),u(!0)}}),(0,e.jsx)(A.W.Item,{label:(0,s.t)("provisioning.delete-repository-button.delete-and-keep-resources","Delete and keep resources"),onClick:()=>{k("keep-resources"),u(!0)}})]}),children:(0,e.jsx)(K.$n,{variant:"destructive",icon:"trash-alt",disabled:Ne,children:(0,e.jsxs)(b.B,{alignItems:"center",children:[(0,e.jsx)(s.x6,{i18nKey:"provisioning.delete-repository-button.delete",children:"Delete"}),(0,e.jsx)(B.I,{name:"angle-down"})]})})}),(0,e.jsx)(V.u,{isOpen:O,title:Be(),body:Ae(),confirmText:(0,s.t)("provisioning.delete-repository-button.button-delete","Delete"),onConfirm:Pe,onDismiss:()=>u(!1)})]})}var _=n(31660);function se({repository:t}){const r=t.metadata?.name??"",o=(0,S.Ib)(t.spec),p=t.spec?.type,v=(p?(0,f.R0)(p):void 0)?.icon||"external-link-alt",g=(0,L.rn)(t.spec?.workflows);return(0,e.jsxs)(b.B,{children:[g&&(0,e.jsx)(I.E,{color:"darkgrey",text:(0,s.t)("folder-repo.read-only-badge","Read only")}),(0,e.jsx)(D.W,{repo:t}),o&&(0,e.jsx)(K.$n,{variant:"secondary",icon:v,onClick:()=>window.open(o,"_blank"),children:(0,e.jsx)(s.x6,{i18nKey:"provisioning.repository-actions.source-code",children:"Source code"})}),(0,e.jsx)(_.w,{repository:t}),(0,e.jsx)(K.z9,{variant:"secondary",icon:"cog",href:`${Z.mL}/${r}/edit`,children:(0,e.jsx)(s.x6,{i18nKey:"provisioning.repository-actions.settings",children:"Settings"})}),(0,e.jsx)(z,{name:r,repository:t,redirectTo:Z.mL})]})}var Y=n(22803),te=n(41607),re=n(43173),ie=n(63142),oe=n(31286),ee=n(13943),T=n(8073),ae=n(74529),le=n(21961),ce=n(80465),de=n(40996);function ue(t){return t?`provisioning.grafana.app/repository=${t}`:void 0}function he({repositoryName:t}){const r=(0,P.L3)({labelSelector:ue(t),watch:!0}),o=(0,P.qC)({name:t});(0,de.A)(()=>{o.refetch()},250,[r.data]);const p=[...r.data?.items??[],...o.data?.items??[]],E=new Intl.Collator(void 0,{numeric:!0});return[p.slice().sort((g,O)=>{const u=g.metadata?.creationTimestamp??"",l=O.metadata?.creationTimestamp??"";return E.compare(l,u)}),r,o]}var G=n(79755),ge=n(34888);const pe=t=>{switch(t){case"success":return"green";case"working":return"blue";case"warning":return"orange";case"pending":return"darkgrey";case"error":return"red";default:return"darkgrey"}},ye=()=>[{id:"status",header:(0,s.t)("provisioning.recent-jobs.column-status","Status"),cell:({row:{original:t}})=>(0,e.jsx)(I.E,{text:t.status?.state||"",color:pe(t.status?.state),icon:t.status?.state==="working"?"spinner":void 0})},{id:"action",header:(0,s.t)("provisioning.recent-jobs.column-action","Action"),cell:({row:{original:t}})=>t.spec?.action},{id:"started",header:(0,s.t)("provisioning.recent-jobs.column-started","Started"),cell:({row:{original:t}})=>(0,G.E)(t.status?.started)},{id:"duration",header:(0,s.t)("provisioning.recent-jobs.column-duration","Duration"),cell:({row:{original:t}})=>{const r={start:t.status?.started??0,end:t.status?.finished??Date.now()};if(!r.start)return null;const o=r.end-r.start;return o<1e3?`${o}ms`:(0,ae.dU)(r,!0)}},{id:"message",header:(0,s.t)("provisioning.recent-jobs.column-message","Message"),cell:({row:{original:t}})=>(0,e.jsx)("span",{children:t.status?.message})}];function ve({row:t}){const r=!!t.status?.summary?.length,o=!!t.status?.errors?.length,p=!!t.spec,E=(0,a.useMemo)(()=>{const v=[],g=t.spec?.action;if(!g)return v;const O=t.spec?.[g];if(!O)return v;for(const[u,l]of Object.entries(O))v.push({key:u,value:l});return v},[t.spec]);return!r&&!o&&!p?null:(0,e.jsx)(oe.a,{padding:2,children:(0,e.jsxs)(b.B,{direction:"column",gap:2,children:[p&&(0,e.jsxs)(b.B,{direction:"column",children:[(0,e.jsx)(i.E,{variant:"body",color:"secondary",children:(0,e.jsx)(s.x6,{i18nKey:"provisioning.expanded-row.job-specification",children:"Job Specification"})}),(0,e.jsx)(le.Ay,{data:E})]}),o&&(0,e.jsx)(ce.Y,{error:{message:t.status?.errors}}),r&&(0,e.jsxs)(b.B,{direction:"column",gap:2,children:[(0,e.jsx)(i.E,{variant:"body",color:"secondary",children:(0,e.jsx)(s.x6,{i18nKey:"provisioning.expanded-row.summary",children:"Summary"})}),(0,e.jsx)(ge.c,{summary:t.status.summary})]})]})})}function me(){return(0,e.jsx)(b.B,{direction:"column",alignItems:"center",children:(0,e.jsx)(i.E,{color:"secondary",children:(0,e.jsx)(s.x6,{i18nKey:"provisioning.empty-state.no-jobs",children:"No jobs..."})})})}function xe(t,r){return(0,e.jsx)(c.F,{title:(0,s.t)("provisioning.recent-jobs.error-loading","Error loading {{type}}",{type:t}),severity:"error",children:(0,e.jsx)("pre",{children:JSON.stringify(r)})})}function je(){return(0,e.jsx)(b.B,{direction:"column",alignItems:"center",children:(0,e.jsx)(N.y,{})})}function fe({repo:t}){const[r,o,p]=he({repositoryName:t.metadata?.name??"x"}),E=(0,a.useMemo)(()=>ye(),[]);let v;return o.isLoading||p.isLoading?v=je():o.isError?v=xe((0,s.t)("provisioning.recent-jobs.active-jobs","active jobs"),o.error):r?.length?v=(0,e.jsx)(J.j,{data:r,columns:E,getRowId:g=>`${g.metadata?.uid}`,renderExpandedRow:g=>(0,e.jsx)(ve,{row:g}),pageSize:10}):v=(0,e.jsx)(me,{}),(0,e.jsxs)(T.Z,{noMargin:!0,children:[(0,e.jsx)(T.Z.Heading,{children:(0,e.jsx)(s.x6,{i18nKey:"provisioning.recent-jobs.jobs",children:"Jobs"})}),(0,e.jsx)(T.Z.Description,{children:v})]})}var Ee=n(88227);function Ce({repository:t}){const[r,o]=(0,P.L)(),p=t.metadata?.name,E=()=>{p&&r({name:p,body:{}})};return o.isLoading?(0,e.jsx)(N.y,{}):(0,e.jsx)(e.Fragment,{children:(0,e.jsx)(K.$n,{icon:"check-circle",variant:"secondary",disabled:o.isLoading||!p,onClick:E,children:(0,e.jsx)(s.x6,{i18nKey:"provisioning.check-repository.check",children:"Check"})})})}function be({health:t}){return(0,e.jsx)(b.B,{gap:2,direction:"column",alignItems:"flex-start",children:t.healthy?(0,e.jsx)(c.F,{title:(0,s.t)("provisioning.repository-health.title-repository-is-healthy","Repository is healthy"),severity:"success",style:{width:"100%"},children:(0,e.jsx)(s.x6,{i18nKey:"provisioning.repository-health.no-errors-found",children:"No errors found"})}):(0,e.jsx)(c.F,{title:(0,s.t)("provisioning.repository-health.title-repository-is-unhealthy","Repository is unhealthy"),severity:"warning",style:{width:"100%"},children:t.message&&t.message.length>0&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(i.E,{children:(0,e.jsx)(s.x6,{i18nKey:"provisioning.repository-health.details",children:"Details:"})}),(0,e.jsx)("ul",{children:t.message.map(r=>(0,e.jsx)("li",{children:r},r))})]})})})}function Me(t){return t?4:3}function Re({repo:t}){const r=(0,ie.of)(Se),o=t.status,p=Te(t),E=Me(!!t.status?.webhook),v=(0,a.useMemo)(()=>[{id:"Resource",header:"Resource Type",cell:({row:{original:g}})=>(0,e.jsx)("span",{children:g.resource}),size:"auto"},{id:"count",header:"Count",cell:({row:{original:g}})=>(0,e.jsx)("span",{children:g.count}),size:100}],[]);return(0,e.jsx)(oe.a,{padding:2,children:(0,e.jsxs)(b.B,{direction:"column",gap:2,children:[(0,e.jsxs)(ee.x,{columns:E,gap:2,children:[(0,e.jsx)("div",{className:r.cardContainer,children:(0,e.jsxs)(T.Z,{noMargin:!0,className:r.card,children:[(0,e.jsx)(T.Z.Heading,{children:(0,e.jsx)(s.x6,{i18nKey:"provisioning.repository-overview.resources",children:"Resources"})}),(0,e.jsx)(T.Z.Description,{children:t.status?.stats?(0,e.jsx)(J.j,{columns:v,data:t.status.stats,getRowId:g=>`${g.group}-${g.resource}`}):null}),(0,e.jsx)(T.Z.Actions,{className:r.actions,children:(0,e.jsx)(K.z9,{fill:"outline",size:"md",href:De(t),icon:"folder-open",children:(0,e.jsx)(s.x6,{i18nKey:"provisioning.repository-overview.view-folder",children:"View Folder"})})})]})}),t.status?.health&&(0,e.jsx)("div",{className:r.cardContainer,children:(0,e.jsxs)(T.Z,{noMargin:!0,className:r.card,children:[(0,e.jsx)(T.Z.Heading,{children:(0,e.jsx)(s.x6,{i18nKey:"provisioning.repository-overview.health",children:"Health"})}),(0,e.jsxs)(T.Z.Description,{children:[(0,e.jsx)(be,{health:t.status?.health}),(0,e.jsxs)(ee.x,{columns:12,gap:1,alignItems:"baseline",children:[(0,e.jsx)("div",{className:r.labelColumn,children:(0,e.jsx)(i.E,{color:"secondary",children:(0,e.jsx)(s.x6,{i18nKey:"provisioning.repository-overview.status",children:"Status:"})})}),(0,e.jsx)("div",{className:r.valueColumn,children:(0,e.jsx)(i.E,{variant:"body",children:o?.health?.healthy?(0,s.t)("provisioning.repository-overview.healthy","Healthy"):(0,s.t)("provisioning.repository-overview.unhealthy","Unhealthy")})}),(0,e.jsx)("div",{className:r.labelColumn,children:(0,e.jsx)(i.E,{color:"secondary",children:(0,e.jsx)(s.x6,{i18nKey:"provisioning.repository-overview.checked",children:"Checked:"})})}),(0,e.jsx)("div",{className:r.valueColumn,children:(0,e.jsx)(i.E,{variant:"body",children:(0,G.E)(o?.health?.checked)})}),!!o?.health?.message?.length&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("div",{className:r.labelColumn,children:(0,e.jsx)(i.E,{color:"secondary",children:(0,e.jsx)(s.x6,{i18nKey:"provisioning.repository-overview.messages",children:"Messages:"})})}),(0,e.jsx)("div",{className:r.valueColumn,children:(0,e.jsx)(b.B,{gap:1,children:o.health.message.map((g,O)=>(0,e.jsx)(i.E,{variant:"body",children:g},O))})})]})]})]}),(0,e.jsx)(T.Z.Actions,{className:r.actions,children:(0,e.jsx)(Ce,{repository:t})})]})}),(0,e.jsx)("div",{className:r.cardContainer,children:(0,e.jsxs)(T.Z,{className:r.card,noMargin:!0,children:[(0,e.jsx)(T.Z.Heading,{children:(0,e.jsx)(s.x6,{i18nKey:"provisioning.repository-overview.pull-status",children:"Pull status"})}),(0,e.jsx)(T.Z.Description,{children:(0,e.jsxs)(ee.x,{columns:12,gap:1,alignItems:"baseline",children:[(0,e.jsx)("div",{className:r.labelColumn,children:(0,e.jsx)(i.E,{color:"secondary",children:(0,e.jsx)(s.x6,{i18nKey:"provisioning.repository-overview.status",children:"Status:"})})}),(0,e.jsx)("div",{className:r.valueColumn,children:(0,e.jsx)(i.E,{variant:"body",children:o?.sync.state??"N/A"})}),(0,e.jsx)("div",{className:r.labelColumn,children:(0,e.jsx)(i.E,{color:"secondary",children:(0,e.jsx)(s.x6,{i18nKey:"provisioning.repository-overview.job-id",children:"Job ID:"})})}),(0,e.jsx)("div",{className:r.valueColumn,children:(0,e.jsx)(i.E,{variant:"body",children:o?.sync.job??"N/A"})}),(0,e.jsx)("div",{className:r.labelColumn,children:(0,e.jsx)(i.E,{color:"secondary",children:(0,e.jsx)(s.x6,{i18nKey:"provisioning.repository-overview.last-ref",children:"Last Ref:"})})}),(0,e.jsx)("div",{className:r.valueColumn,children:(0,e.jsx)(i.E,{variant:"body",children:o?.sync.lastRef?o.sync.lastRef.substring(0,7):(0,s.t)("provisioning.repository-overview.not-available","N/A")})}),(0,e.jsx)("div",{className:r.labelColumn,children:(0,e.jsx)(i.E,{color:"secondary",children:(0,e.jsx)(s.x6,{i18nKey:"provisioning.repository-overview.started",children:"Started:"})})}),(0,e.jsx)("div",{className:r.valueColumn,children:(0,e.jsx)(i.E,{variant:"body",children:(0,G.E)(o?.sync.started)})}),(0,e.jsx)("div",{className:r.labelColumn,children:(0,e.jsx)(i.E,{color:"secondary",children:(0,e.jsx)(s.x6,{i18nKey:"provisioning.repository-overview.finished",children:"Finished:"})})}),(0,e.jsx)("div",{className:r.valueColumn,children:(0,e.jsx)(i.E,{variant:"body",children:(0,G.E)(o?.sync.finished)})}),!!o?.sync?.message?.length&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("div",{className:r.labelColumn,children:(0,e.jsx)(i.E,{color:"secondary",children:(0,e.jsx)(s.x6,{i18nKey:"provisioning.repository-overview.messages",children:"Messages:"})})}),(0,e.jsx)("div",{className:r.valueColumn,children:(0,e.jsx)(Ee.M,{messages:o.sync.message,variant:"body"})})]})]})}),(0,e.jsx)(T.Z.Actions,{className:r.actions,children:(0,e.jsx)(_.w,{repository:t})})]})}),t.status?.webhook&&(0,e.jsx)("div",{className:r.cardContainer,children:(0,e.jsxs)(T.Z,{noMargin:!0,className:r.card,children:[(0,e.jsx)(T.Z.Heading,{children:(0,e.jsx)(s.x6,{i18nKey:"provisioning.repository-overview.webhook",children:"Webhook"})}),(0,e.jsx)(T.Z.Description,{children:(0,e.jsxs)(ee.x,{columns:12,gap:1,alignItems:"baseline",children:[(0,e.jsx)("div",{className:r.labelColumn,children:(0,e.jsx)(i.E,{color:"secondary",children:(0,e.jsx)(s.x6,{i18nKey:"provisioning.repository-overview.webhook-id",children:"ID:"})})}),(0,e.jsx)("div",{className:r.valueColumn,children:(0,e.jsx)(i.E,{variant:"body",children:o?.webhook?.id??"N/A"})}),(0,e.jsx)("div",{className:r.labelColumn,children:(0,e.jsx)(i.E,{color:"secondary",children:(0,e.jsx)(s.x6,{i18nKey:"provisioning.repository-overview.webhook-events",children:"Events:"})})}),(0,e.jsx)("div",{className:r.valueColumn,children:(0,e.jsx)(i.E,{variant:"body",children:o?.webhook?.subscribedEvents?.join(", ")??"N/A"})}),(0,e.jsx)("div",{className:r.labelColumn,children:(0,e.jsx)(i.E,{color:"secondary",children:(0,e.jsx)(s.x6,{i18nKey:"provisioning.repository-overview.webhook-last-event",children:"Last Event:"})})}),(0,e.jsx)("div",{className:r.valueColumn,children:(0,e.jsx)(i.E,{variant:"body",children:(0,G.E)(o?.webhook?.lastEvent)})})]})}),p&&(0,e.jsx)(T.Z.Actions,{className:r.actions,children:(0,e.jsx)(K.z9,{fill:"outline",href:p,icon:"external-link-alt",children:(0,e.jsx)(s.x6,{i18nKey:"provisioning.repository-overview.webhook-url",children:"View Webhook"})})})]})})]}),(re.$.buildInfo.edition===te.r.OpenSource||re.$.buildInfo.edition===te.r.Enterprise)&&(0,e.jsx)("div",{className:r.cardContainer,children:(0,e.jsx)(fe,{repo:t})})]})})}function De(t){return t.spec?.sync.target==="folder"?`/dashboards/f/${t.metadata?.name}`:"/dashboards"}const Se=()=>({cardContainer:(0,Y.css)({height:"100%"}),card:(0,Y.css)({height:"100%",display:"flex",flexDirection:"column"}),actions:(0,Y.css)({marginTop:"auto"}),labelColumn:(0,Y.css)({gridColumn:"span 3"}),valueColumn:(0,Y.css)({gridColumn:"span 9"})});function Te(t){const{status:r,spec:o}=t;if(o?.type==="github"&&r?.webhook?.url&&o.github?.url)return`${o.github.url}/settings/hooks/${r.webhook?.id}`}var Ie=n(20941);function Le({repo:t}){const r=t.metadata?.name??"",o=(0,P.nS)({name:r}),[p,E]=(0,a.useState)(""),v=(o.data?.items??[]).filter(u=>u.path.toLowerCase().includes(p.toLowerCase())),g=(0,q.Z)(t.spec?.type),O=(0,a.useMemo)(()=>[{id:"title",header:"Title",sortType:"string",cell:({row:{original:u}})=>{const{resource:l,name:k,title:w}=u;return l==="dashboards"?(0,e.jsx)("a",{href:`/d/${k}`,children:w}):l==="folders"?(0,e.jsx)("a",{href:`/dashboards/f/${k}`,children:w}):(0,e.jsx)("span",{children:w})}},{id:"resource",header:"Type",sortType:"string",cell:({row:{original:u}})=>(0,e.jsx)("span",{style:{textTransform:"capitalize"},children:u.resource})},{id:"path",header:"Path",sortType:"string",cell:({row:{original:u}})=>{const{resource:l,name:k,path:w}=u;return l==="dashboards"?(0,e.jsx)("a",{href:`/d/${k}`,children:w}):(0,e.jsx)("span",{children:w})}},{id:"hash",header:"Hash",sortType:"string",cell:({row:{original:u}})=>{const{hash:l}=u;return(0,e.jsx)("span",{title:l,children:l.substring(0,7)})}},{id:"folder",header:"Folder",sortType:"string",cell:({row:{original:u}})=>{const{folder:l}=u;return l?.length?(0,e.jsx)(Ie.N,{href:`/dashboards/f/${l}`,children:l}):(0,e.jsx)("span",{})}},{id:"actions",header:"",cell:({row:{original:u}})=>{const{resource:l,name:k,path:w}=u;return(0,e.jsxs)(b.B,{children:[l==="dashboards"&&(0,e.jsx)(K.z9,{href:`/d/${k}`,children:(0,e.jsx)(s.x6,{i18nKey:"provisioning.repository-resources.columns.view-dashboard",children:"View"})}),l==="folders"&&(0,e.jsx)(K.z9,{href:`/dashboards/f/${k}`,children:(0,e.jsx)(s.x6,{i18nKey:"provisioning.repository-resources.columns.view-folder",children:"View"})}),g&&(0,e.jsx)(K.z9,{href:`${Z.mL}/${t.metadata?.name}/history/${w}?repo_type=${t.spec?.type}`,children:(0,e.jsx)(s.x6,{i18nKey:"provisioning.repository-resources.columns.history",children:"History"})})]})}}],[t.metadata?.name,g,t.spec?.type]);return o.isLoading?(0,e.jsx)(b.B,{justifyContent:"center",alignItems:"center",children:(0,e.jsx)(N.y,{})}):(0,e.jsxs)(b.B,{grow:1,direction:"column",gap:2,children:[(0,e.jsx)(b.B,{gap:2,children:(0,e.jsx)(X.Z,{placeholder:(0,s.t)("provisioning.repository-resources.placeholder-search","Search"),autoFocus:!0,value:p,onChange:E})}),(0,e.jsx)(J.j,{columns:O,data:v,pageSize:25,getRowId:u=>String(u.path)})]})}var Ke=(t=>(t.Overview="overview",t.Resources="resources",t.Files="files",t))(Ke||{});function Oe(){const{name:t=""}=(0,y.g)(),r=(0,P.Ih)({fieldSelector:`metadata.name=${t}`,watch:!0}),o=r.data?.items?.[0],p=(0,M.zy)(),[E]=(0,Q.s)(),v=(0,P.F9)(),g=E.tab??"overview",O=r.isError&&(0,F.E)(r.error),u=(0,a.useMemo)(()=>[{value:"overview",label:(0,s.t)("provisioning.repository-status-page.tab-overview","Overview"),title:(0,s.t)("provisioning.repository-status-page.tab-overview-title","Repository overview")},{value:"resources",label:(0,s.t)("provisioning.repository-status-page.tab-resources","Resources"),title:(0,s.t)("provisioning.repository-status-page.tab-resources-title","Resources saved in grafana database")},{value:"files",label:(0,s.t)("provisioning.repository-status-page.tab-files","Files"),title:(0,s.t)("provisioning.repository-status-page.tab-files-title","The raw file list from the repository")}],[]);return(0,e.jsx)(U.Y,{navId:"provisioning",pageNav:{text:o?.spec?.title??(0,s.t)("provisioning.repository-status-page.title","Repository Status"),subTitle:o?.spec?.description},actions:o&&(0,e.jsx)(se,{repository:o}),children:(0,e.jsxs)(U.Y.Contents,{isLoading:r.isLoading,children:[v.data?.legacyStorage&&(0,e.jsx)(c.F,{title:(0,s.t)("provisioning.repository-status-page.title-legacy-storage","Legacy Storage"),severity:"error",children:(0,e.jsx)(s.x6,{i18nKey:"provisioning.repository-status-page.legacy-storage-message",children:"Instance is not yet running unified storage -- requires migration wizard"})}),(0,e.jsx)(d.c,{repo:o}),O?(0,e.jsxs)(h.p,{message:(0,s.t)("provisioning.repository-status-page.not-found-message","Repository not found"),variant:"not-found",children:[(0,e.jsx)(i.E,{element:"p",children:(0,e.jsx)(s.x6,{i18nKey:"provisioning.repository-status-page.repository-config-exists-configuration",children:"Make sure the repository config exists in the configuration file."})}),(0,e.jsx)(j.Y,{href:Z.mL,children:(0,e.jsx)(s.x6,{i18nKey:"provisioning.repository-status-page.back-to-repositories",children:"Back to repositories"})})]}):(0,e.jsx)(e.Fragment,{children:o?(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(C.U,{children:u.map(l=>(0,e.jsx)(W.o,{href:R.kM.renderUrl(p.pathname,{...E,tab:l.value}),label:l.label,active:g===l.value,title:l.title},l.value))}),(0,e.jsxs)(H.J,{children:[o?.metadata?.deletionTimestamp&&(0,e.jsxs)(c.F,{title:(0,s.t)("provisioning.repository-status-page.title-queued-for-deletion","Queued for deletion"),severity:"warning",children:[(0,e.jsx)(N.y,{})," ",(0,e.jsx)(s.x6,{i18nKey:"provisioning.repository-status-page.cleaning-up-resources",children:"Cleaning up repository resources"})]}),g==="overview"&&(0,e.jsx)(Re,{repo:o}),g==="resources"&&(0,e.jsx)(Le,{repo:o}),g==="files"&&(0,e.jsx)(ne,{repo:o})]})]}):(0,e.jsx)("div",{children:(0,e.jsx)(s.x6,{i18nKey:"provisioning.repository-status-page.not-found",children:"not found"})})})]})})}},21961:($,x,n)=>{n.d(x,{Ay:()=>ne});var e=n(74848),a=n(22803),M=n(46942),y=n.n(M),R=n(30703),s=n(63142),c=n(11065),h=n(96540),i=n(92745),j=n(45967),C=n(45861);const W=()=>({CopyIcon:(0,a.css)({backgroundColor:"transparent",border:"none",color:"inherit",overflow:"hidden","&:focus":{backgroundColor:"rgba(255, 255, 255, 0.25)",color:"inherit"}})});function H({copyText:d,icon:I="copy",tooltipTitle:D}){const S=(0,s.of)(W),[L,f]=(0,h.useState)(!1),m=()=>{navigator.clipboard.writeText(d),f(!0)};return(0,e.jsx)(j.m,{content:L?(0,i.t)("explore.trace-view.tooltip-copy-icon","Copied"):D,children:(0,e.jsx)(C.$n,{"aria-label":(0,i.t)("explore.trace-view.aria-label-copy","Copy to clipboard"),className:y()(S.CopyIcon),type:"button",icon:I,onClick:m})})}const N="    ";function P(d){let I="";return d&&Object.keys(d).forEach(function(D){I+=D+":"+d[D]+";"}),I}function U(d){function I(S){return'class="'+S+'"'}function D(S){return'style="'+P(d["."+S])+'"'}return d?D:I}function Q(d){return d===null?"null":Array.isArray(d)?"array":typeof d=="string"&&/^https?:/.test(d)?"link":typeof d=="object"&&typeof d.toISOString=="function"?"date":typeof d}function F(d){return d.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}function b(d,I){let D="";const S=U(I);let L=function(m,A,B,V){if(!m.length)return A+" "+B;let z=A+`
`;return D+=N,m.forEach(function(_,se){z+=D+V(_)+(se<m.length-1?",":"")+`
`}),D=D.slice(0,-N.length),z+D+B};function f(m){if(m===void 0)return"";switch(Q(m)){case"boolean":return"<span "+S("json-markup-bool")+">"+m+"</span>";case"number":return"<span "+S("json-markup-number")+">"+m+"</span>";case"date":return'<span class="json-markup-string">"'+F(m.toISOString())+'"</span>';case"null":return"<span "+S("json-markup-null")+">null</span>";case"string":return"<span "+S("json-markup-string")+'>"'+F(m.replace(/\n/g,`
`+D))+'"</span>';case"link":return"<span "+S("json-markup-string")+'>"<a href="'+encodeURI(m)+'">'+F(m)+'</a>"</span>';case"array":return L(m,"[","]",f);case"object":const A=Object.keys(m).filter(function(B){return m[B]!==void 0});return L(A,"{","}",function(B){return"<span "+S("json-markup-key")+'>"'+F(B)+'":</span> '+f(m[B])})}return""}return"<div "+S("json-markup")+">"+f(d)+"</div>"}const K="copyIcon",X=d=>({KeyValueTable:(0,a.css)({label:"KeyValueTable",background:(0,c.R)(d,"#fff"),border:`1px solid ${(0,c.R)(d,"#ddd")}`,marginBottom:"0.5rem",maxHeight:"450px",overflow:"auto"}),table:(0,a.css)({width:"100%"}),body:(0,a.css)({label:"body",verticalAlign:"baseline"}),row:(0,a.css)({label:"row","& > td":{padding:"0 0.5rem",height:"30px"},"&:nth-child(2n) > td":{background:(0,c.R)(d,"#f5f5f5")},[`&:not(:hover) .${K}`]:{visibility:"hidden"},"a span":{color:`${d.colors.text.link} !important`},"a:hover span":{textDecoration:"underline"}}),keyColumn:(0,a.css)({label:"keyColumn",color:(0,c.R)(d,"#888"),whiteSpace:"pre",width:"125px"}),copyColumn:(0,a.css)({label:"copyColumn",textAlign:"right"}),linkIcon:(0,a.css)({label:"linkIcon",verticalAlign:"middle",fontWeight:"bold"}),jsonTable:(0,a.css)({display:"inline-block"})}),J=/^(\[|\{)/;function Z(d){if(typeof d=="string"&&J.test(d))try{return JSON.parse(d)}catch{}return d}const q=({link:d,children:I})=>{const{path:D,title:S="",onClick:L,icon:f="external-link-alt"}=d;return(0,e.jsxs)("a",{href:D,title:S,onClick:L,target:"_blank",rel:"noopener noreferrer",children:[I," ",(0,e.jsx)(R.I,{name:f})]})};function ne(d){const{data:I,linksGetter:D,onlyValues:S}=d,L=(0,s.of)(X);return(0,e.jsx)("div",{className:y()(L.KeyValueTable),"data-testid":"KeyValueTable",children:(0,e.jsx)("table",{className:L.table,children:(0,e.jsx)("tbody",{className:L.body,children:I.map((f,m)=>{let A={__html:""};f.type==="code"?A={__html:`<pre style="border: none; background: none">${f.value}</pre>`}:f.type==="text"?A={__html:`<span style="white-space: pre-wrap;">${f.value}</span>`}:A={__html:b(Z(f.value))};const B=(0,e.jsx)("div",{className:L.jsonTable,dangerouslySetInnerHTML:A}),V=D?.(I,m);let z;return V&&V.length?z=(0,e.jsx)("div",{children:(0,e.jsx)(q,{link:V[0],children:B})}):z=B,(0,e.jsxs)("tr",{className:L.row,children:[!S&&(0,e.jsx)("td",{className:L.keyColumn,"data-testid":"KeyValueTable--keyColumn",children:f.key}),(0,e.jsx)("td",{children:z}),(0,e.jsx)("td",{className:L.copyColumn,children:(0,e.jsx)(H,{className:K,copyText:f.type==="code"||f.type==="text"?f.value:JSON.stringify(f,null,2),tooltipTitle:"Copy"})})]},`${f.key}-${m}`)})})})})}},22488:($,x,n)=>{n.d(x,{c:()=>y});var e=n(74848),a=n(92745),M=n(34999);function y({repo:R,items:s}){const c=h=>h?.spec?.type==="local"||!!h?.secure?.token?.name;return c(R)||s?.every(c)?null:(0,e.jsx)(M.F,{title:(0,a.t)("provisioning.inline-secure-values-warning","You need to save your access tokens again due to a system update"),severity:"error"})}},31660:($,x,n)=>{n.d(x,{w:()=>i});var e=n(74848),a=n(96540),M=n(54148),y=n(92745),R=n(71599),s=n(45861),c=n(83793),h=n(91555);function i({repository:j}){const[C,W]=(0,c.bS)(),[H,N]=(0,a.useState)(!1),P=(0,M.Zp)(),U=j.metadata?.name,Q=()=>{U&&(C({name:U,jobSpec:{pull:{incremental:!1}}}),N(!1))},F=!!j.status?.health.healthy;return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(s.$n,{icon:"cloud-download",variant:"secondary",tooltip:F?void 0:(0,y.t)("provisioning.sync-repository.tooltip-unhealthy-repository","Unable to pull an unhealthy repository"),disabled:W.isLoading||!U||!F,onClick:Q,children:(0,e.jsx)(y.x6,{i18nKey:"provisioning.sync-repository.pull",children:"Pull"})}),!j.spec?.sync.enabled&&(0,e.jsx)(R.u,{isOpen:H,title:(0,y.t)("provisioning.sync-repository.title-pull-not-enabled","Pull is not enabled"),body:(0,y.t)("provisioning.sync-repository.body-edit-configuration","Edit the configuration"),confirmText:(0,y.t)("provisioning.sync-repository.button-edit","Edit"),onConfirm:()=>P(`${h.mL}/${U}/edit`),onDismiss:()=>N(!1)})]})}},34145:($,x,n)=>{n.d(x,{W:()=>s});var e=n(74848),a=n(92745),M=n(36490),y=n(99887),R=n(91555);function s({repo:c}){if(!c)return null;if(c.spec?.type!=="local"&&!c.secure?.token?.name)return(0,e.jsx)(y.E,{color:"red",icon:"exclamation-triangle",style:{cursor:"pointer"},text:(0,a.t)("provisioning.inline-token-warning-badge-text","Token needs to be saved again"),tooltip:(0,a.t)("inline-token-warning-badge-tooltip","The method to save the token is to re-enter it in the repository settings."),onClick:()=>{M.Ny.push(`${R.mL}/${c.metadata?.name}/edit`)}});let h,i="purple",j="Unknown",C="exclamation-triangle";if(c.metadata?.deletionTimestamp)i="red",j="Deleting",C="spinner";else if(!c.spec?.sync?.enabled)i="red",j="Automatic pulling disabled",C="info-circle";else if(!c.status?.sync?.state?.length)i="darkgrey",j="Pending",C="spinner",h="Waiting for health check to run";else switch(c.status?.sync?.state){case"success":C="check",j="Up-to-date",i="green";break;case"working":case"warning":i="orange",j="warning",C="exclamation-triangle";break;case"pending":i="darkgrey",j="Pulling",C="spinner";break;case"error":i="red",j="Error",C="exclamation-triangle";break;default:break}return(0,e.jsx)(y.E,{color:i,icon:C,text:j,style:{cursor:"pointer"},tooltip:h,onClick:()=>{M.Ny.push(`${R.mL}/${c.metadata?.name}/?tab=overview`)}})}},34888:($,x,n)=>{n.d(x,{c:()=>R});var e=n(74848),a=n(27594),M=n(41654);const y=()=>[{id:"resource",header:"Resource",cell:({row:{original:s}})=>s.resource},{id:"created",header:"Created",cell:({row:{original:s}})=>s.create?.toString()||"-"},{id:"deleted",header:"Deleted",cell:({row:{original:s}})=>s.delete?.toString()||"-"},{id:"updated",header:"Updated",cell:({row:{original:s}})=>s.update?.toString()||"-"},{id:"unchanged",header:"Unchanged",cell:({row:{original:s}})=>s.noop?.toString()||"-"},{id:"errors",header:"Errors",cell:({row:{original:s}})=>s.error?.toString()||"-"},{id:"total",header:"Total",cell:({row:{original:s}})=>((s.create||0)+(s.delete||0)+(s.update||0)+(s.noop||0)+(s.error||0)).toString()}];function R({summary:s}){return(0,e.jsx)(M.B,{direction:"column",gap:2,children:(0,e.jsx)(a.j,{data:s,columns:y(),getRowId:c=>c.resource||"",pageSize:10})})}},75664:($,x,n)=>{n.d(x,{Z:()=>e});function e(a){return!!a&&new Set(["github","gitlab","bitbucket"]).has(a)}},79755:($,x,n)=>{n.d(x,{E:()=>e});function e(a){return a?new Date(a).toLocaleString():"N/A"}},80465:($,x,n)=>{n.d(x,{Y:()=>c});var e=n(74848),a=n(92745),M=n(34999),y=n(88227);const R=(h,i="error")=>typeof h=="string"?h:i==="warning"?h.title||(0,a.t)("provisioning.warning-title-default","Warning"):i==="success"?h.title||(0,a.t)("provisioning.success-title-default","Success"):h.title||(0,a.t)("provisioning.error-title-default","Error"),s=h=>typeof h=="string"||!h.message?null:Array.isArray(h.message)?(0,e.jsx)(y.M,{messages:h.message}):h.message;function c({error:h,warning:i,success:j}){const C=h||i||j,W=h?"error":i?"warning":"success",H=W==="success"?"success":W;return C?(0,e.jsx)(M.F,{severity:H,title:R(C,W),children:s(C)}):null}},88227:($,x,n)=>{n.d(x,{M:()=>R});var e=n(74848),a=n(22803),M=n(66404),y=n(63142);function R({messages:c,variant:h}){const i=(0,y.of)(s);return(0,e.jsx)("ul",{className:i.messageList,children:c.map((j,C)=>(0,e.jsx)("li",{children:h?(0,e.jsx)(M.E,{variant:h,children:j}):j},C))})}const s=c=>({messageList:(0,a.css)({margin:0,paddingLeft:c.spacing(3)})})}}]);

//# sourceMappingURL=RepositoryStatusPage.510a694654ac62b575e3.js.map