"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[2603],{21819:(ye,J,o)=>{o.r(J),o.d(J,{DashboardScenePage:()=>Ae,default:()=>Xe});var e=o(74848),I=o(96540),V=o(54148),M=o(84596),k=o(75683),z=o(36490),K=o(45863),$=o(31286),p=o(13791),v=o(11098),B=o(99362),F=o(54767),W=o(72017),b=o(6262),j=o(22803),y=o(92745),G=o(8515),E=o(63142),H=o(22787),se=o(45861),me=o(83560),Le=o(15130),Ce=o(17732),be=o(8285);const _=(0,I.memo)(({dashboard:S})=>{const ie=(0,I.useMemo)(()=>z.Ny.getLocation().pathname,[S]),{showModal:r,hideModal:R}=(0,I.useContext)(G.wE);(0,I.useEffect)(()=>{const w=f=>{Ve(S)||S.state.isDirty&&(f.preventDefault(),f.returnValue="")};return window.addEventListener("beforeunload",w),()=>window.removeEventListener("beforeunload",w)},[S]);const X=w=>{const f=S.state.editPanel,pe=f?.getPanel(),je=new URLSearchParams(w.search);if(f&&pe&&(0,be.ME)(pe)&&f.state.isDirty&&!je.has("editPanel")){const oe=(0,be.iL)(pe);return r(Ce.Z,{dashboard:S,isUnsavedPrompt:!0,libraryPanel:oe,onConfirm:()=>{f.onConfirmSaveLibraryPanel(),R(),he(w)},onDiscard:()=>{f.onDiscard(),R(),he(w)},onDismiss:R}),!1}return ie===w.pathname||Ve(S)||!S.state.isDirty?!0:(r(A,{dashboard:S,onSaveDashboardClick:()=>{R(),S.openSaveDrawer({onSaveSuccess:()=>{he(w)}})},onDiscard:()=>{S.exitEditMode({skipConfirm:!0}),R(),he(w)},onDismiss:R}),!1)};return(0,e.jsx)(me.X,{when:!0,message:X})});_.displayName="DashboardPrompt";function he(S){S&&setTimeout(()=>z.Ny.push(S),10)}const A=({onDiscard:S,onDismiss:ie,onSaveDashboardClick:r})=>{const R=(0,E.of)(Ze);return(0,e.jsxs)(H.a,{isOpen:!0,title:(0,y.t)("dashboard-scene.unsaved-changes-modal.title-unsaved-changes","Unsaved changes"),onDismiss:ie,icon:"exclamation-triangle",className:R.modal,children:[(0,e.jsx)("h5",{children:(0,e.jsx)(y.x6,{i18nKey:"dashboard-scene.unsaved-changes-modal.changes",children:"Do you want to save your changes?"})}),(0,e.jsxs)(H.a.ButtonRow,{children:[(0,e.jsx)(se.$n,{variant:"secondary",onClick:ie,fill:"outline",children:(0,e.jsx)(y.x6,{i18nKey:"dashboard-scene.unsaved-changes-modal.cancel",children:"Cancel"})}),(0,e.jsx)(se.$n,{variant:"destructive",onClick:S,children:(0,e.jsx)(y.x6,{i18nKey:"dashboard-scene.unsaved-changes-modal.discard",children:"Discard"})}),(0,e.jsx)(se.$n,{onClick:r,children:(0,e.jsx)(y.x6,{i18nKey:"dashboard-scene.unsaved-changes-modal.save-dashboard",children:"Save dashboard"})})]})]})},Ze=()=>({modal:(0,j.css)({width:"500px"})});function Ve(S){if(!S?.getInitialSaveModel()||S?.state.meta.version===0||!Le.TP.isSignedIn||!S)return!0;const{canSave:r,fromScript:R,fromFile:X}=S.state.meta;return!Le.TP.isEditor&&!r?!0:!r||R||X}var ue=o(17788),fe=o(41644);function Ae({route:S,queryParams:ie,location:r}){const R=(0,V.g)(),{type:X,slug:w,uid:f}=R,pe=R["*"],je=(0,M.A)({params:R}),oe=(0,fe.sP)(),{dashboard:re,isLoading:ee,loadError:De}=oe.useState(),qe=r.state?.routeReloadCounter,ge=(0,I.useRef)(R);if((0,I.useEffect)(()=>(S.routeName===b.Z4.Normal&&X==="snapshot"?oe.loadSnapshot(w):oe.loadDashboard({uid:(S.routeName===b.Z4.Provisioning?pe:f)??"",type:X,slug:w,route:S.routeName,urlFolderUid:ie.folderUid}),()=>{(0,F.S)().cancelProfile(),(0,ue.zf)(z.Ny.getSearch(),f),oe.clearState(),oe.resetActiveManager()}),[oe,f,S.routeName,ie.folderUid,qe,X]),(0,I.useEffect)(()=>{if(S.routeName===b.Z4.Normal&&f===ge.current.uid&&ge.current.slug&&!w){const ve=`/d/${f}/${ge.current.slug}`;z.Ny.replace({...z.Ny.getLocation(),pathname:ve})}return()=>{ge.current={uid:f,slug:w||ge.current.slug}}},[S,w,X,f]),!re){let ve;return De&&(ve=(0,e.jsx)(B.i,{error:De,type:X})),ve||(0,e.jsx)(p.Y,{navId:"dashboards/browse",layout:k.k.Canvas,"data-testid":"dashboard-scene-page",children:(0,e.jsx)($.a,{paddingY:4,display:"flex",direction:"column",alignItems:"center",children:ee&&(0,e.jsx)(v.A,{})})})}return X!=="snapshot"&&(!je||f!==je?.params.uid)?(console.log("skipping rendering"),null):(0,e.jsxs)(K.$L,{scene:re,updateUrlOnInit:!0,createBrowserHistorySteps:!0,children:[(0,e.jsx)(W.h,{queryParams:ie,route:S.routeName,slug:w,path:pe}),(0,e.jsx)(re.Component,{model:re},re.state.key),(0,e.jsx)(_,{dashboard:re})]})}const Xe=Ae},72017:(ye,J,o)=>{o.d(J,{h:()=>B,s:()=>p});var e=o(74848),I=o(92745),V=o(43173),M=o(34999),k=o(83793),z=o(96727),K=o(6262),$=o(79205);const p={severity:"info",style:{flex:0}};function v({queryParams:F,slug:W,path:b}){const{prURL:j}=(0,z.H)(),y=(0,k.Kw)({name:W,path:b,ref:F.ref});if(y.data?.errors)return(0,e.jsx)(M.F,{title:(0,I.t)("dashboard-scene.dashboard-preview-banner.title-error-loading-dashboard","Error loading dashboard"),severity:"error",style:{flex:0},children:y.data.errors.map((E,H)=>(0,e.jsx)("div",{children:E},H))});if(j?.length)return(0,e.jsx)($.G,{prParam:j,isNewPr:!0});const G=y.data?.urls?.newPullRequestURL??y.data?.urls?.compareURL;return G?(0,e.jsx)($.G,{prParam:G}):(0,e.jsx)(M.F,{...p,title:(0,I.t)("dashboard-scene.dashboard-preview-banner.title-dashboard-loaded-external-repository","This dashboard is loaded from an external repository"),children:(0,e.jsx)(I.x6,{i18nKey:"dashboard-scene.dashboard-preview-banner.not-yet-saved",children:"The value is not saved in the Grafana database"})})}function B({queryParams:F,route:W,slug:b,path:j}){return!V.$.featureToggles.provisioning||"kiosk"in F||!j||W!==K.Z4.Provisioning||!b?null:(0,e.jsx)(v,{queryParams:F,slug:b,path:j})}},79205:(ye,J,o)=>{o.d(J,{G:()=>v});var e=o(74848),I=o(63704),V=o(92745),M=o(34999),k=o(41654),z=o(30703);const K={github:"GitHub",gitlab:"GitLab",bitbucket:"Bitbucket",git:"Git",local:"Local"};var $=o(96727),p=o(72017);function v({prParam:F,isNewPr:W,behindBranch:b,repoUrl:j}){const{repoType:y}=(0,$.H)(),G=B(y)?K[y]:"repository",E=W?(0,V.t)("provisioned-resource-preview-banner.title-created-branch-in-repo","A new resource has been created in a branch in {{repoType}}.",{repoType:G}):(0,V.t)("provisioned-resource-preview-banner.title-loaded-pull-request-in-repo","This resource is loaded from the branch you just created in {{repoType}} and it is only visible to you",{repoType:G});return b?(0,e.jsx)(M.F,{...p.s,buttonContent:(0,e.jsxs)(k.B,{alignItems:"center",children:[(0,V.t)("provisioned-resource-preview-banner.preview-banner.open-in-repo-button","Open in {{repoType}}",{repoType:G}),(0,e.jsx)(z.I,{name:"external-link-alt"})]}),title:(0,V.t)("provisioned-resource-preview-banner.preview-banner.behind-branch-text","This resource is behind the branch in {{repoType}}.",{repoType:G}),onRemove:j?()=>window.open(I.sQ.sanitizeUrl(j),"_blank"):void 0,children:(0,e.jsxs)(V.x6,{i18nKey:"provisioned-resource-preview-banner.preview-banner.view-in-repo-button",values:{repoType:G},children:["View it in ",{repoType:y}," to see the latest changes."]})}):(0,e.jsx)(M.F,{...p.s,title:E,buttonContent:(0,e.jsxs)(k.B,{alignItems:"center",children:[W?(0,V.t)("provisioned-resource-preview-banner.preview-banner.open-pull-request-in-repo","Open pull request in {{repoType}}",{repoType:G}):(0,V.t)("provisioned-resource-preview-banner.preview-banner.view-pull-request-in-repo","View pull request in {{repoType}}",{repoType:G}),(0,e.jsx)(z.I,{name:"external-link-alt"})]}),onRemove:F?()=>window.open(I.sQ.sanitizeUrl(F),"_blank"):void 0,children:(0,e.jsx)(V.x6,{i18nKey:"provisioned-resource-preview-banner.preview-banner.not-saved",children:"The rest of Grafana users in your organization will still see the current version saved to configured default branch until this branch is merged"})})}function B(F){return typeof F!="string"?!1:F in K}},85680:(ye,J,o)=>{o.d(J,{Bz:()=>j,Q9:()=>W,Ss:()=>G,TA:()=>b,lC:()=>y});var e=o(68143),I=o(6890),V=o(64762),M=o(13956),k=o(79718),z=o(89224),K=o(69289),$=o(37256),p=o(39167),v=o(22429),B=o(75421),F=o(37918);function W(E,H){return async se=>{await(0,e.AI)().post("/api/dashboards/import",E),se((0,I.dx)((0,V.tZ)("Dashboard Imported",H))),se((0,$.h9)())}}function b(E){return async H=>{await(0,M.n)().deleteDashboard(E,!1),H((0,$.h9)())}}const j=()=>(E,H)=>{const me=H().dashboard.getModel();me&&(me.destroy(),E((0,p.Y7)(me.uid))),(0,B.jG)().stopAutoRefresh(),E((0,F.p0)()),E((0,z.rG)()),k.t.leave(),(0,v.UA)().setCurrent(void 0)},y=E=>H=>{H((0,K.Cj)(E)),(0,B.jG)().refreshTimeModel()},G=E=>H=>{H((0,K.xu)(E)),(0,B.jG)().refreshTimeModel()}},92603:(ye,J,o)=>{o.r(J),o.d(J,{default:()=>To});var e=o(74848),I=o(54148),V=o(16817),M=o(43173),k=o(21819),z=o(41644),K=o(6262),$=o(60171),p=o(22803),v=o(96540),B=o(71468),F=o(75683),W=o(92138),b=o(51898),j=o(36490),y=o(63142),G=o(6890),E=o(13791),H=o(27963),se=o(64762);function me(t){switch(t.kiosk){case"1":case!0:return K.d9.Full;default:return null}}var Le=o(38206),Ce=o(84057),be=o(79718),_=o(87745),he=o(39167),A=o(99305),Ze=o(25157),Ve=o(46505),ue=o(2543),fe=o(8515),Ae=o(45229),Xe=o(83560),S=o(15130),ie=o(40996),r=o(92745),R=o(22787),X=o(63527),w=o(30703),f=o(45861),pe=o(30124),je=o(37666),oe=o(12048);const re=({panel:t,folderUid:n,isUnsavedPrompt:a,onDismiss:s,onConfirm:i,onDiscard:l})=>{const[d,c]=(0,v.useState)(""),h=(0,V.A)(async()=>{const P=await(0,pe.xV)(t.libraryPanel.uid);return P.length>0?P.map(Z=>Z.title):[]},[t.libraryPanel.uid]),[u,g]=(0,v.useState)([]);(0,ie.A)(()=>h.value?g(h.value.filter(P=>P.toLowerCase().includes(d.toLowerCase()))):g([]),300,[h.value,d]);const{saveLibraryPanel:m}=(0,oe.b)(),x=(0,y.of)(je.o),N=(0,v.useCallback)(()=>{l()},[l]),D=a?"Unsaved library panel changes":"Save library panel";return(0,e.jsx)(R.a,{title:D,icon:"save",onDismiss:s,isOpen:!0,children:(0,e.jsxs)("div",{children:[(0,e.jsxs)("p",{className:x.textInfo,children:[(0,e.jsxs)(r.x6,{i18nKey:"library-panels.save-library-panel-modal.num-affected",count:t.libraryPanel.meta?.connectedDashboards,children:["This update will affect ",(0,e.jsxs)("strong",{children:["{{count}}"," dashboards."]})]}),(0,e.jsx)(r.x6,{i18nKey:"library-panels.save-library-panel-modal.affected-dashboards",children:"The following dashboards using the panel will be affected:"})]}),(0,e.jsx)(X.p,{className:x.dashboardSearch,prefix:(0,e.jsx)(w.I,{name:"search"}),placeholder:(0,r.t)("library-panels.save-library-panel-modal.placeholder-search-affected-dashboards","Search affected dashboards"),value:d,onChange:P=>c(P.currentTarget.value)}),h.loading?(0,e.jsx)("p",{children:(0,e.jsx)(r.x6,{i18nKey:"library-panels.save-library-panel-modal.loading-connected-dashboards",children:"Loading connected dashboards..."})}):(0,e.jsxs)("table",{className:x.myTable,children:[(0,e.jsx)("thead",{children:(0,e.jsx)("tr",{children:(0,e.jsx)("th",{children:(0,e.jsx)(r.x6,{i18nKey:"library-panels.save-library-panel-modal.dashboard-name",children:"Dashboard name"})})})}),(0,e.jsx)("tbody",{children:u.map((P,Z)=>(0,e.jsx)("tr",{children:(0,e.jsx)("td",{children:P})},`dashrow-${Z}`))})]}),(0,e.jsxs)(R.a.ButtonRow,{children:[(0,e.jsx)(f.$n,{variant:"secondary",onClick:s,fill:"outline",children:(0,e.jsx)(r.x6,{i18nKey:"library-panels.save-library-panel-modal.cancel",children:"Cancel"})}),a&&(0,e.jsx)(f.$n,{variant:"destructive",onClick:N,children:(0,e.jsx)(r.x6,{i18nKey:"library-panels.save-library-panel-modal.discard",children:"Discard"})}),(0,e.jsx)(f.$n,{onClick:()=>{m(t,n).then(()=>{i()})},children:(0,e.jsx)(r.x6,{i18nKey:"library-panels.save-library-panel-modal.update-all",children:"Update all"})})]})]})})};var ee=o(52763),De=o(7817),qe=o(29043),ge=o(17097),ve=o(87390),Ct=o(89224),le=o(42795);function Pn(t,n){return async a=>{const s=n.initEditPanel(t);a((0,le.GU)({panel:s,sourcePanel:t}))}}function Dt(){return async(t,n)=>{const{getPanel:a}=n().panelEditor;a().configRev=0,t((0,le.MJ)(!0))}}function Cn(t,n){return a=>{if(t.libraryPanel?.uid===void 0||!n)return;const s=t.getSaveModel();for(const i of n.panels){if(Dn(t,i))continue;i.restoreModel({...s,...(0,ue.pick)(i,"gridPos","id")});const l=i.plugin?.meta.id!==t.plugin?.meta.id;i.plugin=t.plugin,i.configRev++,l&&(i.generateNewKey(),a((0,Ct.XM)({key:i.key,plugin:i.plugin}))),setTimeout(()=>{i.getQueryRunner().useLastResultFrom(t.getQueryRunner())},20)}t.repeat&&setTimeout(()=>n.processRepeats(),20)}}function Dn(t,n){return!!(n.libraryPanel?.uid!==t.libraryPanel.uid||n.id&&n.id===t.id||n.repeatPanelId)}function Tn(){return async(t,n)=>{const a=n().dashboard.getModel(),{getPanel:s,getSourcePanel:i,shouldDiscardChanges:l}=n().panelEditor,d=s();a&&a.exitPanelEditor();const c=i();if(En(d)&&!l){const h=d.getSaveModel(),u=c.type!==d.type;t(Cn(d,a)),c.restoreModel(h),c.configRev++,u&&(c.plugin=d.plugin,c.generateNewKey(),await t((0,Ct.XM)({key:c.key,plugin:d.plugin}))),setTimeout(()=>{c.getQueryRunner().useLastResultFrom(d.getQueryRunner()),c.render(),d.hasSavedPanelEditChange&&!d.hasChanged&&(c.configRev=0)},20)}c.isNew&&(l?a&&(0,ge.FC)(a,c,!0):delete c.isNew),t((0,ve.O6)(d.key)),t((0,le.Ox)())}}function En(t){return t.hasChanged||t.hasSavedPanelEditChange||t.isAngularPlugin()}function _e(t){return(n,a)=>{const s={...a().panelEditor.ui,...t};n((0,le.fR)(s));try{qe.A.setObject(le.wi,s)}catch(i){console.error(i)}}}var et=o(78159);const Nn=({dashboard:t,onSaveSuccess:n,onDiscard:a,onDismiss:s})=>(0,e.jsxs)(R.a,{isOpen:!0,title:(0,r.t)("dashboard.unsaved-changes-modal.title-unsaved-changes","Unsaved changes"),onDismiss:s,icon:"exclamation-triangle",className:(0,p.css)({width:"500px"}),children:[(0,e.jsx)("h5",{children:(0,e.jsx)(r.x6,{i18nKey:"dashboard.unsaved-changes-modal.changes",children:"Do you want to save your changes?"})}),(0,e.jsxs)(R.a.ButtonRow,{children:[(0,e.jsx)(f.$n,{variant:"secondary",onClick:s,fill:"outline",children:(0,e.jsx)(r.x6,{i18nKey:"dashboard.unsaved-changes-modal.cancel",children:"Cancel"})}),(0,e.jsx)(f.$n,{variant:"destructive",onClick:a,children:(0,e.jsx)(r.x6,{i18nKey:"dashboard.unsaved-changes-modal.discard",children:"Discard"})}),(0,e.jsx)(et.C,{dashboard:t,onSaveSuccess:n})]})]}),Tt=(0,v.memo)(({dashboard:t})=>{const[n,a]=(0,v.useState)({original:null}),s=(0,ee.wA)(),{original:i,originalPath:l}=n,{showModal:d,hideModal:c}=(0,v.useContext)(fe.wE);(0,v.useEffect)(()=>{const u=setTimeout(()=>{const m=j.Ny.getLocation().pathname,x=t.getSaveModelCloneOld();a({originalPath:m,original:x})},1e3),g=Ae.l.subscribe(_.Eu,()=>{const m=t.getSaveModelCloneOld();a({originalPath:l,original:m})});return()=>{clearTimeout(u),g.unsubscribe()}},[t,l]),(0,v.useEffect)(()=>{const u=g=>{Et(t,i)||It(t,i)&&(g.preventDefault(),g.returnValue="")};return window.addEventListener("beforeunload",u),()=>window.removeEventListener("beforeunload",u)},[t,i]);const h=u=>{const g=t.panelInEdit,m=new URLSearchParams(u.search);return g&&g.libraryPanel&&g.hasChanged&&!m.has("editPanel")?(d(re,{isUnsavedPrompt:!0,panel:t.panelInEdit,folderUid:t.meta.folderUid??"",onConfirm:()=>{c(),Re(u)},onDiscard:()=>{s(Dt()),Re(u),c()},onDismiss:c}),!1):l===u.pathname||!i?(g&&!m.has("editPanel")&&s(Tn()),!0):Et(t,i)||!It(t,i)?!0:(d(Nn,{dashboard:t,onSaveSuccess:()=>{c(),Re(u)},onDiscard:()=>{a({...n,original:null}),c(),Re(u)},onDismiss:c}),!1)};return(0,e.jsx)(Xe.X,{when:!0,message:h})});Tt.displayName="DashboardPrompt";function Re(t){t&&setTimeout(()=>j.Ny.push(t),10)}function Et(t,n){if(!n||n.version===0||!S.TP.isSignedIn||!t)return!0;const{canSave:a,fromScript:s,fromFile:i}=t.meta;return!S.TP.isEditor&&!a?!0:!a||s||i}function Nt(t){const n=new De.G(t);n.expandRows();const a=n.getSaveModelClone();if(delete a.time,delete a.refresh,a.schemaVersion=0,delete a.timezone,a.panels=[],a.templating?.list)for(const s of a.templating.list)delete s.current,delete s.options,delete s.filters;return a}function It(t,n){if(t.hasUnsavedChanges())return!0;const a=Nt(t.getSaveModelCloneOld()),s=Nt(n),i=(0,ue.find)(a.nav,{type:"timepicker"}),l=(0,ue.find)(s.nav,{type:"timepicker"});i&&l&&(i.now=l.now);const d=JSON.stringify(a,null),c=JSON.stringify(s,null);return d!==c}var Mt=o(36219),L=o(41654),Oe=o(66404),wt=o(43707),tt=o(11257),Lt=o(14644),de=o(27489),nt=o(74475),at=o(68079),Be=o(45967),Se=o(76319),st=o(27690);const In=({id:t,usages:n})=>{const a=(0,v.useMemo)(()=>n.find(i=>i.variable.id===t),[t,n]);if(!a)return null;const s=a.nodes.map(i=>i.label.includes(`$${t}`)?{...i,color:"#FB7E81"}:i);return(0,e.jsx)(st.i,{show:!1,title:(0,r.t)("variables.variables-unknown-button.usage-title","Showing usages for: {{variableId}}",{variableId:`$${t}`}),nodes:s,edges:a.edges,children:({showModal:i})=>(0,e.jsx)(Se.K,{onClick:()=>i(),name:"code-branch",tooltip:(0,r.t)("variables.variables-unknown-button.VariablesUnknownButton-tooltip-show-usages","Show usages"),"data-testid":"VariablesUnknownButton"})})};var xe=o(47969);const Mn=1e3;function wn({variables:t,dashboard:n}){const[a,s]=(0,v.useState)(!1),[i,l]=(0,v.useState)(0),[d,c]=(0,v.useState)([]),h=(0,y.of)(it);(0,v.useEffect)(()=>l(m=>m+1),[t,n]);const{loading:u}=(0,V.A)(async()=>{if(a&&i>0){const m=Date.now(),x=await(0,xe.g0)(t,n),D=Date.now()-m;return D>=Mn&&(0,de.rR)("Slow unknown variables expansion",{elapsed:D}),l(0),c(x),x}return[]},[t,n,a,i]),g=m=>{m&&(0,de.rR)("Unknown variables section expanded"),s(m)};return(0,e.jsx)("div",{className:h.container,children:(0,e.jsxs)(nt.M,{label:(0,e.jsx)(Ln,{}),isOpen:a,onToggle:g,children:[u&&(0,e.jsx)(L.B,{direction:"column",justifyContent:"center",children:(0,e.jsxs)(L.B,{justifyContent:"center",children:[(0,e.jsx)("span",{children:(0,e.jsx)(r.x6,{i18nKey:"variables.variables-unknown-table.loading",children:"Loading..."})}),(0,e.jsx)(at.y,{})]})}),!u&&d&&(0,e.jsxs)(e.Fragment,{children:[d.length===0&&(0,e.jsx)(Vn,{}),d.length>0&&(0,e.jsx)(An,{usages:d})]})]})})}function Ln(){const t=(0,y.of)(it);return(0,e.jsxs)("h5",{children:[(0,e.jsx)(r.x6,{i18nKey:"variables.variables-unknown-table.collapse-label",children:"Renamed or missing variables"}),(0,e.jsx)(Be.m,{content:(0,r.t)("variables.variables-unknown-table.collapse-tooltip","Click to expand a list with all variable references that have been renamed or are missing from the dashboard."),children:(0,e.jsx)(w.I,{name:"info-circle",className:t.infoIcon})})]})}function Vn(){return(0,e.jsx)("span",{children:(0,e.jsx)(r.x6,{i18nKey:"variables.no-unknowns.no-renamed-or-missing-variables-found",children:"No renamed or missing variables found."})})}function An({usages:t}){const n=(0,y.of)(it);return(0,e.jsxs)("table",{className:"filter-table filter-table--hover",children:[(0,e.jsx)("thead",{children:(0,e.jsxs)("tr",{children:[(0,e.jsx)("th",{children:(0,e.jsx)(r.x6,{i18nKey:"variables.unknown-table.variable",children:"Variable"})}),(0,e.jsx)("th",{colSpan:5})]})}),(0,e.jsx)("tbody",{children:t.map(a=>{const{variable:s}=a,{id:i,name:l}=s;return(0,e.jsxs)("tr",{children:[(0,e.jsx)("td",{className:n.firstColumn,children:(0,e.jsx)("span",{children:l})}),(0,e.jsx)("td",{className:n.defaultColumn}),(0,e.jsx)("td",{className:n.defaultColumn}),(0,e.jsx)("td",{className:n.defaultColumn}),(0,e.jsx)("td",{className:n.lastColumn,children:(0,e.jsx)(In,{id:s.id,usages:t})})]},i)})})]})}const it=t=>({container:(0,p.css)({marginTop:t.spacing(4),paddingTop:t.spacing(4)}),infoIcon:(0,p.css)({marginLeft:t.spacing(1)}),defaultColumn:(0,p.css)({width:"1%"}),firstColumn:(0,p.css)({width:"1%",verticalAlign:"top",color:t.colors.text.maxContrast}),lastColumn:(0,p.css)({overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",width:"100%",textAlign:"right"})});var Y=o(74887),te=o(93612),ce=o(88681),ot=o(71599);function Vt({varName:t,isOpen:n=!1,onConfirm:a,onDismiss:s}){return(0,e.jsx)(ot.u,{title:(0,r.t)("variables.confirm-delete-modal.title-delete-variable","Delete variable"),isOpen:n,onConfirm:a,onDismiss:s,body:(0,r.t)("variables.confirm-delete-modal.body-delete-variable",'Are you sure you want to delete variable "{{variableToDelete}}"?',{variableToDelete:t}),modalClass:Rn.modal,confirmText:(0,r.t)("variables.confirm-delete-modal.confirmText-delete","Delete")})}const Rn={modal:(0,p.css)({width:"max-content",maxWidth:"80vw"})};var Ue=o(28105),On=o(29),Bn=o(32442),Un=o(25379),At=o(49602),zn=o(18387),rt=o(54742),lt=o(67933),Kn=o(68577);function Fn({onChange:t,type:n}){const a=(0,v.useMemo)(()=>(0,A.AX)(),[]),s=(0,v.useMemo)(()=>a.find(i=>i.value===n)??a[0],[a,n]);return(0,e.jsx)(Kn.v,{name:(0,r.t)("variables.variable-type-select.name-select-variable-type","Select variable type"),value:s,options:a,onChange:t,testId:b.Tp.pages.Dashboard.Settings.Variables.Edit.General.generalTypeSelectV2})}var $n=o(99703),Te=o(17752);const Wn=t=>async n=>{const{rootStateKey:a}=t;n((0,Y.kb)(a,(0,Te.sJ)({name:(0,te.dn)(t).name,id:t.id})))},Gn=t=>async(n,a)=>{const{rootStateKey:s}=t;n((0,Y.kb)(s,(0,Te.T7)((0,A.qD)(t))))},kn=(t,n)=>(a,s)=>{const{id:i,rootStateKey:l}=t;let d=null;if(n.match(/^(?!__).*$/)||(d="Template names cannot begin with '__', that's reserved for Grafana's global variables"),n.match(/^\w+$/)||(d="Only word characters are allowed in variable names"),(0,te.SS)(l,s()).filter(u=>u.name===n&&u.id!==i).length&&(d="Variable with the same name already exists"),d){a((0,Y.kb)(l,(0,Te.DW)({newName:n,errorText:d})));return}a(Hn(t,n))},Hn=(t,n)=>(a,s)=>{const{rootStateKey:i}=t,l=(0,te.dn)(t,s());if(l.name===n){a((0,Y.kb)(i,(0,Te.FN)((0,A.qD)(t,{newName:n}))));return}const d={...(0,ue.cloneDeep)(l),name:n,id:n},c=l.global,h=l.index,u=(0,A.jX)(d);a((0,Y.kb)(i,(0,ce.QV)((0,A.qD)(u,{global:c,index:h,model:d})))),a((0,Y.kb)(i,(0,Te.FN)((0,A.qD)(u,{newName:n})))),a((0,Y.kb)(i,(0,ce.Hr)((0,A.qD)(t,{reIndex:!1}))))},Qn=(t,n="query")=>(a,s)=>{const i=(0,A.q4)(t),l=(0,te.SS)(i,s()),d=Yn(n,l),c={type:n,id:d},h=!1,u=(0,te.hk)(i,s()),g=(0,ue.cloneDeep)(rt.B.get(n).initialState);g.id=d,g.name=d,g.rootStateKey=i,a((0,Y.kb)(i,(0,ce.QV)((0,A.qD)(c,{global:h,model:g,index:u})))),j.Ny.partial({editIndex:l.length})},Jn=t=>(n,a)=>{const s=(0,A.q4)(t),i=a(),l=(0,te.nS)(s,i),d=i.dashboard.getModel(),{usages:c}=(0,xe.hM)(l,d),h=(0,xe.Ow)(c);n((0,Y.kb)(s,(0,$n.bX)({usages:c,usagesNetwork:h})))};function Yn(t,n){let a=0,s=`${t}${a}`;for(;n.find(i=>i.id===s);)s=`${t}${++a}`;return s}var Zn=o(73829);const Xn=(t,n)=>({editor:(0,te.nx)(n.identifier.rootStateKey,t).editor,variable:(0,te.dn)(n.identifier,t)}),qn=t=>({...(0,Lt.bindActionCreators)({variableEditorMount:Wn,variableEditorUnMount:Gn,changeVariableName:kn,updateOptions:he.mZ},t),changeVariableProp:(n,a,s)=>t((0,Y.kb)(n.rootStateKey,(0,ce.QP)((0,A.qD)(n,{propName:a,propValue:s})))),changeVariableType:(n,a)=>t((0,Y.kb)(n.rootStateKey,(0,ce.l_)((0,A.qD)(n,{newType:a})))),removeVariable:n=>{t((0,Y.kb)(n.rootStateKey,(0,ce.Hr)((0,A.qD)(n,{reIndex:!0}))))}}),_n=(0,B.connect)(Xn,qn);class ea extends v.PureComponent{constructor(){super(...arguments),this.state={showDeleteModal:!1},this.onNameChange=n=>{n.preventDefault(),this.props.changeVariableName(this.props.identifier,n.currentTarget.value)},this.onTypeChange=n=>{n.value&&this.props.changeVariableType(this.props.identifier,n.value)},this.onLabelChange=n=>{n.preventDefault(),this.props.changeVariableProp(this.props.identifier,"label",n.currentTarget.value)},this.onDescriptionChange=n=>{this.props.changeVariableProp(this.props.identifier,"description",n.currentTarget.value)},this.onHideChange=n=>{this.props.changeVariableProp(this.props.identifier,"hide",n)},this.onPropChanged=({propName:n,propValue:a,updateOptions:s=!1})=>{this.props.changeVariableProp(this.props.identifier,n,a),s&&this.props.updateOptions((0,A.jX)(this.props.variable))},this.onHandleSubmit=async n=>{n.preventDefault(),this.props.editor.isValid&&this.props.updateOptions((0,A.jX)(this.props.variable))},this.onModalOpen=()=>{this.setState({showDeleteModal:!0})},this.onModalClose=()=>{this.setState({showDeleteModal:!1})},this.onDelete=()=>{this.props.removeVariable(this.props.identifier),this.onModalClose(),j.Ny.partial({editIndex:null})},this.onApply=()=>{j.Ny.partial({editIndex:null})},this.getVariableOptions=()=>{const{variable:n}=this.props;return(0,lt.SP)(n)?n.options.map(a=>({label:String(a.text),value:String(a.value)})):[]}}componentDidMount(){this.props.variableEditorMount(this.props.identifier)}componentWillUnmount(){this.props.variableEditorUnMount(this.props.identifier)}render(){const{theme:n,variable:a}=this.props,s=rt.B.get(this.props.variable.type).editor;if(!s)return null;const i=a.state===Ue.Gu.Loading,l=window.matchMedia("(prefers-reduced-motion: reduce)").matches,d=aa(n);return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsxs)("form",{"aria-label":(0,r.t)("variables.variable-editor-editor-un-connected.aria-label-variable-editor-form","Variable editor Form"),onSubmit:this.onHandleSubmit,children:[(0,e.jsx)(Fn,{onChange:this.onTypeChange,type:this.props.variable.type}),(0,e.jsx)(Bn.Y,{children:(0,e.jsx)(r.x6,{i18nKey:"variables.variable-editor-editor-un-connected.general",children:"General"})}),(0,e.jsx)(At._,{value:this.props.editor.name,onChange:this.onNameChange,name:(0,r.t)("variables.variable-editor-editor-un-connected.name-name","Name"),placeholder:(0,r.t)("variables.variable-editor-editor-un-connected.placeholder-variable-name","Variable name"),description:(0,r.t)("variables.variable-editor-editor-un-connected.description-template-variable-characters","The name of the template variable. (Max. 50 characters)"),invalid:!!this.props.editor.errors.name,error:this.props.editor.errors.name,testId:b.Tp.pages.Dashboard.Settings.Variables.Edit.General.generalNameInputV2,maxLength:Zn.M.MaxSize,required:!0}),(0,e.jsx)(At._,{name:(0,r.t)("variables.variable-editor-editor-un-connected.name-label","Label"),description:(0,r.t)("variables.variable-editor-editor-un-connected.description-optional-display-name","Optional display name"),value:this.props.variable.label??"",placeholder:(0,r.t)("variables.variable-editor-editor-un-connected.placeholder-label-name","Label name"),onChange:this.onLabelChange,testId:b.Tp.pages.Dashboard.Settings.Variables.Edit.General.generalLabelInputV2}),(0,e.jsx)(Un.Z,{name:(0,r.t)("variables.variable-editor-un-connected.name-description","Description"),value:a.description??"",placeholder:(0,r.t)("variables.variable-editor-editor-un-connected.placeholder-descriptive-text","Descriptive text"),onChange:this.onDescriptionChange,width:52}),(0,e.jsx)(On.D,{onChange:this.onHideChange,hide:this.props.variable.hide,type:this.props.variable.type}),s&&(0,e.jsx)(s,{variable:this.props.variable,onPropChange:this.onPropChanged}),(0,lt.SP)(this.props.variable)?(0,e.jsx)(zn.j,{options:this.getVariableOptions()}):null,(0,e.jsx)("div",{style:{marginTop:"16px"},children:(0,e.jsxs)(L.B,{gap:2,height:"inherit",children:[(0,e.jsx)(f.$n,{variant:"destructive",fill:"outline",onClick:this.onModalOpen,children:(0,e.jsx)(r.x6,{i18nKey:"variables.variable-editor-editor-un-connected.delete",children:"Delete"})}),(0,e.jsxs)(f.$n,{type:"submit","data-testid":b.Tp.pages.Dashboard.Settings.Variables.Edit.General.submitButton,disabled:i,variant:"secondary",children:[(0,e.jsx)(r.x6,{i18nKey:"variables.variable-editor-editor-un-connected.run-query",children:"Run query"}),i&&(0,e.jsx)(w.I,{className:d.spin,name:l?"hourglass":"sync",size:"sm",style:{marginLeft:"2px"}})]}),(0,e.jsx)(f.$n,{variant:"primary",onClick:this.onApply,"data-testid":b.Tp.pages.Dashboard.Settings.Variables.Edit.General.applyButton,children:(0,e.jsx)(r.x6,{i18nKey:"variables.variable-editor-editor-un-connected.apply",children:"Apply"})})]})})]}),(0,e.jsx)(Vt,{isOpen:this.state.showDeleteModal,varName:this.props.editor.name,onConfirm:this.onDelete,onDismiss:this.onModalClose})]})}}const ta=(0,y.cV)(_n(ea)),na=(0,p.keyframes)({"0%":{transform:"rotate(0deg) scaleX(-1)"},"100%":{transform:"rotate(359deg) scaleX(-1)"}}),aa=t=>({spin:(0,p.css)({[t.transitions.handleMotion("no-preference")]:{animation:`${na} 3s linear infinite`}})});var dt=o(21835),Rt=o(50201),Ee=o(89640);const sa=({variables:t})=>{const n=(0,v.useMemo)(()=>(0,xe.hI)(t),[t]),a=(0,v.useMemo)(()=>(0,xe.qJ)(t),[t]);return a.length?(0,e.jsx)(st.i,{show:!1,title:(0,r.t)("variables.variables-dependencies-button.title-dependencies","Dependencies"),nodes:(0,xe.H7)(n,a),edges:a,children:({showModal:s})=>(0,e.jsx)(f.$n,{onClick:()=>{(0,de.rR)("Show variable dependencies"),s()},icon:"channel-add",variant:"secondary",children:(0,e.jsx)(r.x6,{i18nKey:"variables.variables-dependencies-button.show-dependencies",children:"Show dependencies"})})}):null},ia=({id:t,usages:n,isAdhoc:a})=>{const s=(0,v.useMemo)(()=>n.find(l=>l.variable.id===t),[n,t]);if(n.length===0||a||!s)return null;const i=s.nodes.map(l=>l.label.includes(`$${t}`)?{...l,color:"#FB7E81"}:l);return(0,e.jsx)(st.i,{show:!1,title:(0,r.t)("variabels.variable-usages-button.usage-title","Showing usages for: {{variableId}}",{variableId:`$${t}`}),nodes:i,edges:s.edges,children:({showModal:l})=>(0,e.jsx)(Se.K,{onClick:()=>{(0,de.rR)("Show variable usages"),l()},name:"code-branch",tooltip:(0,r.t)("variables.variable-usages-button.tooltip-show-usages","Show usages")})})};function oa({index:t,variable:n,usageTree:a,usagesNetwork:s,onEdit:i,onDuplicate:l,onDelete:d}){const c=(0,y.$j)(),h=(0,y.of)(Ot),u=ra(n),m=(0,xe.PK)(n.id,a)>0||n.type==="adhoc",x=(0,A.jX)(n);return(0,e.jsx)(dt.sx,{draggableId:JSON.stringify(x),index:t,children:(N,D)=>(0,e.jsxs)("tr",{ref:N.innerRef,...N.draggableProps,style:{userSelect:D.isDragging?"none":"auto",background:D.isDragging?c.colors.background.secondary:void 0,...N.draggableProps.style},children:[(0,e.jsx)("td",{role:"gridcell",className:h.column,children:(0,e.jsx)(f.$n,{size:"xs",fill:"text",onClick:P=>{P.preventDefault(),i(x)},className:h.nameLink,"aria-label":b.Tp.pages.Dashboard.Settings.Variables.List.tableRowNameFields(n.name),children:n.name})}),(0,e.jsx)("td",{role:"gridcell",className:h.definitionColumn,onClick:P=>{P.preventDefault(),i(x)},"aria-label":b.Tp.pages.Dashboard.Settings.Variables.List.tableRowDefinitionFields(n.name),children:u}),(0,e.jsx)("td",{role:"gridcell",className:h.column,children:(0,e.jsxs)("div",{className:h.icons,children:[(0,e.jsx)(la,{passed:m}),(0,e.jsx)(ia,{id:n.id,isAdhoc:n.type==="adhoc",usages:s}),(0,e.jsx)(Se.K,{onClick:P=>{P.preventDefault(),(0,de.rR)("Duplicate variable"),l(x)},name:"copy",tooltip:(0,r.t)("variables.variable-editor-list-row.tooltip-duplicate-variable","Duplicate variable"),"aria-label":b.Tp.pages.Dashboard.Settings.Variables.List.tableRowDuplicateButtons(n.name)}),(0,e.jsx)(Se.K,{onClick:P=>{P.preventDefault(),(0,de.rR)("Delete variable"),d(x)},name:"trash-alt",tooltip:(0,r.t)("variables.variable-editor-list-row.tooltip-remove-variable","Remove variable"),"aria-label":b.Tp.pages.Dashboard.Settings.Variables.List.tableRowRemoveButtons(n.name)}),(0,e.jsx)("div",{...N.dragHandleProps,className:h.dragHandle,children:(0,e.jsx)(w.I,{name:"draggabledots",size:"lg"})})]})})]})})}function ra(t){let n="";return t.type==="query"?t.definition?n=t.definition:typeof t.query=="string"&&(n=t.query):(0,lt.SP)(t)&&(n=t.query),n}function la({passed:t}){const n=(0,y.of)(Ot);return t?(0,e.jsx)(w.I,{name:"check",className:n.iconPassed,title:(0,r.t)("variables.variable-check-indicator.title-variable-referenced-other-variables-dashboard","This variable is referenced by other variables or dashboard.")}):(0,e.jsx)(w.I,{name:"exclamation-triangle",className:n.iconFailed,title:(0,r.t)("variables.variable-check-indicator.title-variable-referenced-dashboard","This variable is not referenced by any variable or dashboard.")})}function Ot(t){return{dragHandle:(0,p.css)({cursor:"grab",marginLeft:t.spacing(1)}),column:(0,p.css)({width:"1%"}),nameLink:(0,p.css)({cursor:"pointer",color:t.colors.primary.text}),definitionColumn:(0,p.css)({width:"100%",maxWidth:"200px",cursor:"pointer",overflow:"hidden",textOverflow:"ellipsis",OTextOverflow:"ellipsis",whiteSpace:"nowrap"}),iconPassed:(0,p.css)({color:t.v1.palette.greenBase,marginRight:t.spacing(2)}),iconFailed:(0,p.css)({color:t.v1.palette.orange,marginRight:t.spacing(2)}),icons:(0,p.css)({display:"flex",gap:t.spacing(2),alignItems:"center"})}}function da({variables:t,usages:n,usagesNetwork:a,onChangeOrder:s,onAdd:i,onEdit:l,onDelete:d,onDuplicate:c}){const h=(0,y.of)(ha),u=g=>{if(!g.destination||!g.source)return;(0,de.rR)("Variable drag and drop");const m=JSON.parse(g.draggableId);s(m,t[g.source.index].index,t[g.destination.index].index)};return(0,e.jsx)("div",{children:(0,e.jsxs)("div",{children:[t.length===0&&(0,e.jsx)(ca,{onAdd:i}),t.length>0&&(0,e.jsxs)(L.B,{direction:"column",gap:4,children:[(0,e.jsx)("div",{className:h.tableContainer,children:(0,e.jsxs)("table",{className:"filter-table filter-table--hover","aria-label":b.Tp.pages.Dashboard.Settings.Variables.List.table,role:"grid",children:[(0,e.jsx)("thead",{children:(0,e.jsxs)("tr",{children:[(0,e.jsx)("th",{children:(0,e.jsx)(r.x6,{i18nKey:"variables.variable-editor-list.variable",children:"Variable"})}),(0,e.jsx)("th",{children:(0,e.jsx)(r.x6,{i18nKey:"variables.variable-editor-list.definition",children:"Definition"})}),(0,e.jsx)("th",{colSpan:5})]})}),(0,e.jsx)(dt.JY,{onDragEnd:u,children:(0,e.jsx)(dt.gL,{droppableId:"variables-list",direction:"vertical",children:g=>(0,e.jsxs)("tbody",{ref:g.innerRef,...g.droppableProps,children:[t.map((m,x)=>(0,e.jsx)(oa,{index:x,variable:m,usageTree:n,usagesNetwork:a,onDelete:d,onDuplicate:c,onEdit:l},`${m.name}-${x}`)),g.placeholder]})})})]})}),(0,e.jsxs)(L.B,{children:[(0,e.jsx)(sa,{variables:t}),(0,e.jsx)(f.$n,{"aria-label":b.Tp.pages.Dashboard.Settings.Variables.List.newButton,onClick:i,icon:"plus",children:(0,e.jsx)(r.x6,{i18nKey:"variables.variable-editor-list.new-variable",children:"New variable"})})]})]})]})})}function ca({onAdd:t}){return(0,e.jsx)(L.B,{direction:"column",children:(0,e.jsxs)(Rt.p,{variant:"call-to-action",button:(0,e.jsx)(f.$n,{"data-testid":b.Tp.components.CallToActionCard.buttonV2("Add variable"),icon:"calculator-alt",onClick:t,size:"lg",children:(0,e.jsx)(r.x6,{i18nKey:"variables.empty-state.button-title",children:"Add variable"})}),message:(0,r.t)("variables.empty-state.title","There are no variables added yet"),children:[(0,e.jsx)("p",{children:(0,e.jsx)(r.x6,{i18nKey:"variables.empty-state.info-box-content",children:"Variables enable more interactive and dynamic dashboards. Instead of hard-coding things like server or sensor names in your metric queries you can use variables in their place. Variables are shown as list boxes at the top of the dashboard. These drop-down lists make it easy to change the data being displayed in your dashboard."})}),(0,e.jsxs)(r.x6,{i18nKey:"variables.empty-state.info-box-content-2",children:["Check out the"," ",(0,e.jsx)(Ee.Y,{external:!0,href:"https://grafana.com/docs/grafana/latest/variables/",children:"Templates and variables documentation"})," ","for more information."]})]})})}const ha=()=>({tableContainer:(0,p.css)({overflow:"scroll",width:"100%"})}),ua=(t,n)=>{const{uid:a}=n.dashboard,s=(0,te.nx)(a,t);return{variables:(0,te.nS)(a,t),idInEditor:s.editor.id,usagesNetwork:s.inspect.usagesNetwork,usages:s.inspect.usages}},pa=t=>({...(0,Lt.bindActionCreators)({createNewVariable:Qn,initListMode:Jn},t),changeVariableOrder:(n,a,s)=>t((0,Y.kb)(n.rootStateKey,(0,ce.hj)((0,A.qD)(n,{fromIndex:a,toIndex:s})))),duplicateVariable:n=>t((0,Y.kb)(n.rootStateKey,(0,ce.ut)((0,A.qD)(n,{newId:void 0})))),removeVariable:n=>{t((0,Y.kb)(n.rootStateKey,(0,ce.Hr)((0,A.qD)(n,{reIndex:!0}))))}}),ga=(0,B.connect)(ua,pa);class va extends v.PureComponent{constructor(){super(...arguments),this.state={variableId:void 0},this.onEditVariable=n=>{const a=this.props.variables.findIndex(s=>s.id===n.id);j.Ny.partial({editIndex:a})},this.onNewVariable=()=>{this.props.createNewVariable(this.props.dashboard.uid)},this.onChangeVariableOrder=(n,a,s)=>{this.props.changeVariableOrder(n,a,s)},this.onDuplicateVariable=n=>{this.props.duplicateVariable(n)},this.onModalOpen=n=>{this.setState({variableId:n})},this.onModalClose=()=>{this.setState({variableId:void 0})},this.onRemoveVariable=()=>{this.props.removeVariable(this.state.variableId),this.onModalClose()}}componentDidMount(){this.props.initListMode(this.props.dashboard.uid)}render(){const{editIndex:n,variables:a,sectionNav:s}=this.props,i=n!=null?a[n]:void 0,d=s.node.parentItem,c=i?{text:i.name,parentItem:d}:d;return(0,e.jsxs)(E.Y,{navModel:this.props.sectionNav,pageNav:c,children:[!i&&(0,e.jsx)(da,{variables:this.props.variables,onAdd:this.onNewVariable,onEdit:this.onEditVariable,onChangeOrder:this.onChangeVariableOrder,onDuplicate:this.onDuplicateVariable,onDelete:this.onModalOpen,usages:this.props.usages,usagesNetwork:this.props.usagesNetwork}),!i&&this.props.variables.length>0&&(0,e.jsx)(wn,{variables:this.props.variables,dashboard:this.props.dashboard}),i&&(0,e.jsx)(ta,{identifier:(0,A.jX)(i)}),(0,e.jsx)(Vt,{isOpen:this.state.variableId!==void 0,varName:this.state.variableId?.id??"",onConfirm:this.onRemoveVariable,onDismiss:this.onModalClose})]})}}const ma=ga(va);var ba=o(54384),Bt=o(73427);const fa=({dashboard:t,sectionNav:n})=>{const a=Bt.TP.hasPermission(tt.w.DashboardsPermissionsWrite),s=n.node.parentItem;return(0,e.jsx)(E.Y,{navModel:n,pageNav:s,children:(0,e.jsx)(ba.x,{resource:"dashboards",resourceId:t.uid,canSetPermissions:a})})};var ze=o(48480),Ke=o(78282),Ut=o(16780),Q=o(37386),Ne=o(34999),ct=o(32635),ht=o(18857),xa=o(38669),ut=o(65642),ya=o(76478),ja=o(76792);const zt="New annotation",Sa=({editIdx:t,dashboard:n})=>{const a=(0,y.of)(Pa),[s,i]=(0,v.useState)(n.annotations.list[t]),l=(0,v.useMemo)(()=>s.filter?s.filter.exclude?2:1:0,[s.filter]),{value:d}=(0,V.A)(()=>(0,Ke.l)().get(s.datasource),[s.datasource]),c=(0,Ke.l)().getInstanceSettings(s.datasource),h=C=>{const O=[...n.annotations.list];O.splice(t,1,C),i(C),n.annotations.list=O},u=C=>{h({...s,name:C.currentTarget.value})},g=C=>{const O=(0,ze.p$)(C);s.datasource?.type!==O.type?h({datasource:O,builtIn:s.builtIn,enable:s.enable,iconColor:s.iconColor,name:s.name,hide:s.hide,filter:s.filter,mappings:s.mappings,type:s.type}):h({...s,datasource:O})},m=C=>{const O=C.currentTarget;h({...s,[O.name]:O.type==="checkbox"?O.checked:O.value})},x=C=>{h({...s,iconColor:C})},N=C=>{let O=C.value===0?void 0:{exclude:C.value===2,ids:s.filter?.ids??[]};h({...s,filter:O})},D=C=>{if(!Array.isArray(C))return;const O={exclude:l===2,ids:[]};C.forEach(Ye=>Ye.value&&O.ids.push(Ye.value)),h({...s,filter:O})},P=Kt,Z=()=>{j.Ny.partial({editview:null,editIndex:null})},ae=()=>{const C=n.annotations.list;n.annotations.list=[...C.slice(0,t),...C.slice(t+1)],Kt()},q=s.name===zt,we=(C,O)=>C.label&&O.label?C.label.toLowerCase().localeCompare(O.label.toLowerCase()):-1,Je=(0,v.useMemo)(()=>n?.panels.filter(C=>ut.Ay.panels[C.type]).map(C=>({value:C.id,label:C.title??`Panel ${C.id}`,description:C.description,imgUrl:ut.Ay.panels[C.type].info.logos.small})).sort(we)??[],[n]);return(0,e.jsxs)("div",{children:[(0,e.jsxs)(Ut.n,{className:a.settingsForm,children:[(0,e.jsx)(Q.D,{label:(0,r.t)("dashboard.annotation-settings-edit.label-name","Name"),children:(0,e.jsx)(X.p,{"data-testid":b.Tp.pages.Dashboard.Settings.Annotations.Settings.name,name:"name",id:"name",autoFocus:q,value:s.name,onChange:u})}),(0,e.jsx)(Q.D,{label:(0,r.t)("dashboard.annotation-settings-edit.label-data-source","Data source"),htmlFor:"data-source-picker",children:(0,e.jsx)(ja.sk,{annotations:!0,variables:!0,current:s.datasource,onChange:g})}),!d?.meta.annotations&&(0,e.jsx)(Ne.F,{title:(0,r.t)("dashboard.annotation-settings-edit.title-annotation-support-source","No annotation support for this data source"),severity:"error",children:(0,e.jsx)(r.x6,{i18nKey:"errors.dashboard-settings.annotations.datasource",children:"The selected data source does not support annotations. Please select a different data source."})}),(0,e.jsx)(Q.D,{label:(0,r.t)("dashboard.annotation-settings-edit.label-enabled","Enabled"),description:(0,r.t)("dashboard.annotation-settings-edit.description-enabled-annotation-query-issued-every-dashboard","When enabled the annotation query is issued every dashboard refresh"),children:(0,e.jsx)(ct.S,{name:"enable",id:"enable",value:s.enable,onChange:m})}),(0,e.jsx)(Q.D,{label:(0,r.t)("dashboard.annotation-settings-edit.label-hidden","Hidden"),description:(0,r.t)("dashboard.annotation-settings-edit.description-hidden","Annotation queries can be toggled on or off at the top of the dashboard. With this option checked this toggle will be hidden."),children:(0,e.jsx)(ct.S,{name:"hide",id:"hide",value:s.hide,onChange:m})}),(0,e.jsx)(Q.D,{label:(0,r.t)("dashboard.annotation-settings-edit.label-color","Color"),description:(0,r.t)("dashboard.annotation-settings-edit.description-color-annotation-event-markers","Color to use for the annotation event markers"),children:(0,e.jsx)(L.B,{children:(0,e.jsx)(xa.a,{value:s?.iconColor,onChange:x})})}),(0,e.jsx)(Q.D,{label:(0,r.t)("dashboard.annotation-settings-edit.label-show-in","Show in"),"data-testid":b.Tp.pages.Dashboard.Settings.Annotations.NewAnnotation.showInLabel,children:(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(ht.l6,{options:Da(),value:l,onChange:N,"data-testid":b.Tp.components.Annotations.annotationsTypeInput}),l!==0&&(0,e.jsx)(ht.KF,{options:Je,value:Je.filter(C=>s.filter?.ids.includes(C.value)),onChange:D,isClearable:!0,placeholder:(0,r.t)("dashboard.annotation-settings-edit.placeholder-choose-panels","Choose panels"),width:100,closeMenuOnSelect:!1,className:a.select,"data-testid":b.Tp.components.Annotations.annotationsChoosePanelInput})]})})]}),(0,e.jsxs)(Ut.n,{children:[(0,e.jsx)("h3",{className:"page-heading",children:(0,e.jsx)(r.x6,{i18nKey:"dashboard.annotation-settings-edit.query",children:"Query"})}),d?.annotations&&c&&(0,e.jsx)(ya.A,{datasource:d,datasourceInstanceSettings:c,annotation:s,onChange:h})]}),(0,e.jsxs)(L.B,{children:[!s.builtIn&&(0,e.jsx)(f.$n,{variant:"destructive",onClick:ae,children:(0,e.jsx)(r.x6,{i18nKey:"dashboard.annotation-settings-edit.delete",children:"Delete"})}),(0,e.jsx)(f.$n,{variant:"secondary",onClick:Z,"data-testid":b.Tp.pages.Dashboard.Settings.Annotations.NewAnnotation.previewInDashboard,children:(0,e.jsx)(r.x6,{i18nKey:"dashboard.annotation-settings-edit.preview-in-dashboard",children:"Preview in dashboard"})}),(0,e.jsx)(f.$n,{variant:"primary",onClick:P,children:(0,e.jsx)(r.x6,{i18nKey:"dashboard.annotation-settings-edit.apply",children:"Apply"})})]})]})},Pa=t=>({settingsForm:(0,p.css)({maxWidth:t.spacing(60),marginBottom:t.spacing(2)}),select:(0,p.css)({marginTop:"8px"})});function Kt(){j.Ny.partial({editIndex:null})}var Ca=(t=>(t[t.AllPanels=0]="AllPanels",t[t.IncludePanels=1]="IncludePanels",t[t.ExcludePanels=2]="ExcludePanels",t))(Ca||{});const Da=()=>[{label:(0,r.t)("dashboard.get-panel-filters.label.all-panels","All panels"),value:0,description:(0,r.t)("dashboard.get-panel-filters.description.annotation-panels-support-annotations","Send the annotation data to all panels that support annotations")},{label:(0,r.t)("dashboard.get-panel-filters.label.selected-panels","Selected panels"),value:1,description:(0,r.t)("dashboard.get-panel-filters.description.annotations-explicitly-listed-panels","Send the annotations to the explicitly listed panels")},{label:(0,r.t)("dashboard.get-panel-filters.label.all-panels-except","All panels except"),value:2,description:(0,r.t)("dashboard.get-panel-filters.description.annotation-following-panels","Do not send annotation data to the following panels")}];var Ft=o(46635),Ta=o(44458),Ea=o(39302);const Na=({dashboard:t,onNew:n,onEdit:a})=>{const s=(0,y.of)(Ia),[i,l]=(0,v.useState)(t.annotations.list),d=(m,x)=>{t.annotations.list=Ft.moveItemImmutably(i,m,m+x),l(t.annotations.list)},c=m=>{t.annotations.list=[...i.slice(0,m),...i.slice(m+1)],l(t.annotations.list)},h=i.length===0||i.length===1&&i[0].builtIn,u=m=>m.enable===!1?(0,e.jsx)(e.Fragment,{children:(0,e.jsx)("em",{className:"muted",children:(0,e.jsxs)(r.x6,{i18nKey:"dashboard.annotation-settings-list.disabled",values:{name:m.name},children:["(Disabled) ","{{name}}"]})})}):m.builtIn?(0,e.jsx)(e.Fragment,{children:(0,e.jsx)("em",{className:"muted",children:(0,e.jsxs)(r.x6,{i18nKey:"dashboard.annotation-settings-list.built-in",values:{name:m.name},children:["{{name}}"," (Built-in)"]})})}):(0,e.jsx)(e.Fragment,{children:m.name}),g=(0,Ke.l)();return(0,e.jsxs)(L.B,{direction:"column",children:[i.length>0&&(0,e.jsx)("div",{className:s.table,children:(0,e.jsxs)("table",{role:"grid",className:"filter-table filter-table--hover",children:[(0,e.jsx)("thead",{children:(0,e.jsxs)("tr",{children:[(0,e.jsx)("th",{children:(0,e.jsx)(r.x6,{i18nKey:"dashboard.annotation-settings-list.query-name",children:"Query name"})}),(0,e.jsx)("th",{children:(0,e.jsx)(r.x6,{i18nKey:"dashboard.annotation-settings-list.data-source",children:"Data source"})}),(0,e.jsx)("th",{colSpan:3})]})}),(0,e.jsx)("tbody",{children:t.annotations.list.map((m,x)=>(0,e.jsxs)("tr",{children:[m.builtIn?(0,e.jsx)("td",{role:"gridcell",style:{width:"90%"},className:"pointer",onClick:()=>a(x),children:(0,e.jsx)(f.$n,{size:"sm",fill:"text",variant:"secondary",children:u(m)})}):(0,e.jsx)("td",{role:"gridcell",className:"pointer",onClick:()=>a(x),children:(0,e.jsx)(f.$n,{size:"sm",fill:"text",variant:"secondary",children:u(m)})}),(0,e.jsx)("td",{role:"gridcell",className:"pointer",onClick:()=>a(x),children:g.getInstanceSettings(m.datasource)?.name||m.datasource?.uid}),(0,e.jsx)("td",{role:"gridcell",style:{width:"1%"},children:x!==0&&(0,e.jsx)(Se.K,{name:"arrow-up",onClick:()=>d(x,-1),tooltip:(0,r.t)("dashboard.annotation-settings-list.tooltip-move-up","Move up")})}),(0,e.jsx)("td",{role:"gridcell",style:{width:"1%"},children:t.annotations.list.length>1&&x!==t.annotations.list.length-1?(0,e.jsx)(Se.K,{name:"arrow-down",onClick:()=>d(x,1),tooltip:(0,r.t)("dashboard.annotation-settings-list.tooltip-move-down","Move down")}):null}),(0,e.jsx)("td",{role:"gridcell",style:{width:"1%"},children:!m.builtIn&&(0,e.jsx)(Ta.e,{size:"sm",onConfirm:()=>c(x),"aria-label":(0,r.t)("dashboard.annotation-settings-list.aria-label-delete",'Delete query with title "{{title}}"',{title:m.name})})})]},`${m.name}-${x}`))})]})}),h&&(0,e.jsx)(L.B,{direction:"column",children:(0,e.jsxs)(Rt.p,{variant:"call-to-action",button:(0,e.jsx)(f.$n,{"data-testid":b.Tp.components.CallToActionCard.buttonV2("Add annotation query"),icon:"comment-alt",onClick:n,size:"lg",children:(0,e.jsx)(r.x6,{i18nKey:"annotations.empty-state.button-title",children:"Add annotation query"})}),message:(0,r.t)("annotations.empty-state.title","There are no custom annotation queries added yet"),children:[(0,e.jsx)(r.x6,{i18nKey:"annotations.empty-state.info-box-content",children:(0,e.jsx)("p",{children:"Annotations provide a way to integrate event data into your graphs. They are visualized as vertical lines and icons on all graph panels. When you hover over an annotation icon you can get event text & tags for the event. You can add annotation events directly from grafana by holding CTRL or CMD + click on graph (or drag region). These will be stored in Grafana's annotation database."})}),(0,e.jsxs)(r.x6,{i18nKey:"annotations.empty-state.info-box-content-2",children:["Checkout the"," ",(0,e.jsx)(Ee.Y,{external:!0,href:"http://docs.grafana.org/reference/annotations/",children:"Annotations documentation"})," ","for more information."]})]})}),!h&&(0,e.jsx)(Ea.d,{"data-testid":b.Tp.pages.Dashboard.Settings.Annotations.List.addAnnotationCTAV2,onClick:n,children:(0,e.jsx)(r.x6,{i18nKey:"dashboard.annotation-settings-list.new-query",children:"New query"})})]})},Ia=()=>({table:(0,p.css)({width:"100%",overflowX:"scroll"})});function Ma({dashboard:t,editIndex:n,sectionNav:a}){const s=()=>{const d={name:zt,enable:!0,datasource:(0,ze.p$)((0,Ke.l)().getInstanceSettings(null)),iconColor:"red"};t.annotations.list=[...t.annotations.list,{...d}],j.Ny.partial({editIndex:t.annotations.list.length-1})},i=d=>{j.Ny.partial({editIndex:d})},l=n!=null&&n<t.annotations.list.length;return(0,e.jsxs)(E.Y,{navModel:a,pageNav:wa(t,n,a.node),children:[!l&&(0,e.jsx)(Na,{dashboard:t,onNew:s,onEdit:i}),l&&(0,e.jsx)(Sa,{dashboard:t,editIdx:n})]})}function wa(t,n,a){const s=a.parentItem;if(n==null)return s;const i=t.annotations.list[n];if(i)return{text:i.name,parentItem:s}}var pt=o(31286),$t=o(72636),La=o(87105),Va=o(10928),Fe=o(77824),Aa=o(91156),$e=o(85680),We=o(22429),Ra=o(5805),Wt=o(35137),Oa=o(15203),Ba=o(75080);const Ua={cleanUpDashboardAndVariables:$e.Bz},za=(0,B.connect)(null,Ua),Ka=({hideModal:t,cleanUpDashboardAndVariables:n,dashboard:a})=>{const s=a.meta.provisioned,[i]=(0,Oa.vd)(),[,l]=(0,Ra.default)(async()=>{(0,de.rR)("grafana_manage_dashboards_delete_clicked",{item_counts:{dashboard:1},source:"dashboard_settings",restore_enabled:!!M.$.featureToggles.restoreDashboards}),await i({dashboardUIDs:[a.uid]}),n(),t(),j.Ny.replace("/")},[t]);return s?(0,e.jsx)(Fa,{hideModal:t,provisionedId:a.meta.provisionedExternalId}):(0,e.jsx)(Ba.h,{onConfirm:l,onClose:t,dashboardTitle:a.title})},Fa=({hideModal:t,provisionedId:n})=>(0,e.jsxs)(R.a,{isOpen:!0,title:(0,r.t)("dashboard-settings.provisioned-delete-modal.title","Cannot delete provisioned dashboard"),icon:"trash-alt",onDismiss:t,className:(0,p.css)({width:"500px"}),children:[(0,e.jsx)(Oe.E,{element:"p",children:(0,e.jsx)(r.x6,{i18nKey:"dashboard-settings.provisioned-delete-modal.text-1",children:"This dashboard is managed by Grafana provisioning and cannot be deleted. Remove the dashboard from the config file to delete it."})}),(0,e.jsx)(Wt.$,{v:1}),(0,e.jsxs)(Oe.E,{element:"p",children:[(0,e.jsx)(r.x6,{i18nKey:"dashboard-settings.provisioned-delete-modal.text-2",children:"See grafana documentation for more information about provisioning.\xA0"}),(0,e.jsx)(Ee.Y,{href:"https://grafana.com/docs/grafana/latest/administration/provisioning/#dashboards",external:!0,children:(0,r.t)("dashboard-settings.provisioned-delete-modal.text-link","Go to docs page")})]}),(0,e.jsx)(Wt.$,{v:2}),(0,e.jsx)(Oe.E,{element:"p",children:(0,e.jsxs)(r.x6,{i18nKey:"dashboard-settings.provisioned-delete-modal.text-3",children:["File path: ",{provisionedId:n}]})}),(0,e.jsx)(R.a.ButtonRow,{children:(0,e.jsx)(f.$n,{variant:"primary",onClick:t,children:(0,e.jsx)(r.x6,{i18nKey:"dashboard-settings.provisioned-delete-modal.confirm-button",children:"OK"})})})]}),$a=za(Ka),Wa=()=>{const t=(0,We.UA)().getCurrent();return(0,e.jsx)(fe.$s,{children:({showModal:n,hideModal:a})=>(0,e.jsx)(f.$n,{variant:"destructive",onClick:()=>{n($a,{dashboard:t,hideModal:a})},"data-testid":b.Tp.pages.Dashboard.Settings.General.deleteDashBoard,children:(0,e.jsx)(r.x6,{i18nKey:"dashboard-settings.dashboard-delete-button",children:"Delete dashboard"})})})};var Ga=o(42357),ka=o(70969),Ha=o(56291);function Qa({dashboard:t,updateTimeZone:n,updateWeekStart:a,sectionNav:s}){const[i,l]=(0,v.useState)(0),[d,c]=(0,v.useState)(t.title),[h,u]=(0,v.useState)(t.description),g=[{value:0,label:(0,r.t)("dashboard.general-settings-unconnected.graph_tooltip_options.label.default","Default")},{value:1,label:(0,r.t)("dashboard.general-settings-unconnected.graph_tooltip_options.label.shared-crosshair","Shared crosshair")},{value:2,label:(0,r.t)("dashboard.general-settings-unconnected.graph_tooltip_options.label.shared-tooltip","Shared tooltip")}],m=s.node.parentItem,x=(T,Pt)=>{t.meta.folderUid=T,t.meta.folderTitle=Pt,t.meta.hasUnsavedFolderChange=!0,l(i+1)},N=(0,v.useCallback)(T=>{t.title=T,c(T)},[c,t]),D=(0,v.useCallback)(T=>{t.description=T,u(T)},[u,t]),P=T=>{t.graphTooltip=T,l(i+1)},Z=T=>{t.timepicker.refresh_intervals=T.filter(Pt=>Pt.trim()!=="")},ae=T=>{t.timepicker.nowDelay=T},q=T=>{t.timepicker.hidden=T,l(i+1)},we=T=>{t.liveNow=T,l(i+1)},Je=T=>{t.timezone=T,l(i+1),n(T)},C=T=>{t.weekStart=T,l(i+1),a(T)},O=T=>{t.tags=T,l(i+1)},Ye=T=>{t.editable=T,l(i+1)},Eo=[{label:(0,r.t)("dashboard.general-settings-unconnected.editable-options.label.editable","Editable"),value:!0},{label:(0,r.t)("dashboard.general-settings-unconnected.editable-options.label.readonly","Read-only"),value:!1}];return(0,e.jsx)(E.Y,{navModel:s,pageNav:m,children:(0,e.jsxs)("div",{style:{maxWidth:"600px"},children:[(0,e.jsxs)(pt.a,{marginBottom:5,children:[(0,e.jsx)(Q.D,{label:(0,e.jsxs)(L.B,{justifyContent:"space-between",children:[(0,e.jsx)($t.J,{htmlFor:"title-input",children:(0,e.jsx)(r.x6,{i18nKey:"dashboard-settings.general.title-label",children:"Title"})}),M.$.featureToggles.dashgpt&&(0,e.jsx)(ka.Z,{onGenerate:N})]}),children:(0,e.jsx)(X.p,{id:"title-input",name:"title",value:d,onChange:T=>N(T.target.value)})}),(0,e.jsx)(Q.D,{label:(0,e.jsxs)(L.B,{justifyContent:"space-between",children:[(0,e.jsx)($t.J,{htmlFor:"description-input",children:(0,r.t)("dashboard-settings.general.description-label","Description")}),M.$.featureToggles.dashgpt&&(0,e.jsx)(Ga.V,{onGenerate:D})]}),children:(0,e.jsx)(La.f,{id:"description-input",name:"description",value:h,onChange:T=>D(T.target.value)})}),(0,e.jsx)(Q.D,{label:(0,r.t)("dashboard-settings.general.tags-label","Tags"),children:(0,e.jsx)(Va.u,{id:"tags-input",tags:t.tags,onChange:O,width:40})}),(0,e.jsx)(Q.D,{label:(0,r.t)("dashboard-settings.general.folder-label","Folder"),children:(0,e.jsx)(Aa.d,{value:t.meta.folderUid,onChange:x})}),(0,e.jsx)(Q.D,{label:(0,r.t)("dashboard-settings.general.editable-label","Editable"),description:(0,r.t)("dashboard-settings.general.editable-description","Set to read-only to disable all editing. Reload the dashboard for changes to take effect"),children:(0,e.jsx)(Fe.z,{value:t.editable,options:Eo,onChange:Ye})})]}),(0,e.jsx)(Ha.p,{onTimeZoneChange:Je,onWeekStartChange:C,onRefreshIntervalChange:Z,onNowDelayChange:ae,onHideTimePickerChange:q,onLiveNowChange:we,refreshIntervals:t.timepicker.refresh_intervals,timePickerHidden:t.timepicker.hidden,nowDelay:t.timepicker.nowDelay,timezone:t.timezone,weekStart:t.weekStart,liveNow:t.liveNow}),(0,e.jsx)(nt.M,{label:(0,r.t)("dashboard-settings.general.panel-options-label","Panel options"),isOpen:!0,children:(0,e.jsx)(Q.D,{label:(0,r.t)("dashboard-settings.general.panel-options-graph-tooltip-label","Graph tooltip"),description:(0,r.t)("dashboard-settings.general.panel-options-graph-tooltip-description","Controls tooltip and hover highlight behavior across different panels. Reload the dashboard for changes to take effect"),children:(0,e.jsx)(Fe.z,{onChange:P,options:g,value:t.graphTooltip})})}),(0,e.jsx)(pt.a,{marginTop:3,children:t.meta.canDelete&&(0,e.jsx)(Wa,{})})]})})}const Ja={updateTimeZone:$e.lC,updateWeekStart:$e.Ss},Ya=(0,B.connect)(null,Ja)(Qa);var Gt=o(50992);function Za({dashboard:t,sectionNav:n}){const a=t.getSaveModelClone(),[s,i]=(0,v.useState)(JSON.stringify(a,null,2)),l=n.node.parentItem,d=async()=>{await(0,We.UA)().saveJSONDashboard(s),be.t.reloadPage()},c=(0,y.of)(Xa);return(0,e.jsx)(E.Y,{navModel:n,pageNav:l,children:(0,e.jsxs)("div",{className:c.wrapper,children:[(0,e.jsx)(r.x6,{i18nKey:"dashboard-settings.json-editor.subtitle",children:"The JSON model below is the data structure that defines the dashboard. This includes dashboard settings, panel settings, layout, queries, and so on."}),(0,e.jsx)(Gt.B,{value:s,language:"json",showMiniMap:!0,showLineNumbers:!0,onBlur:i,containerStyles:c.codeEditor}),t.meta.canSave&&(0,e.jsx)("div",{children:(0,e.jsx)(f.$n,{type:"submit",onClick:d,children:(0,e.jsx)(r.x6,{i18nKey:"dashboard-settings.json-editor.save-button",children:"Save changes"})})})]})})}const Xa=t=>({wrapper:(0,p.css)({display:"flex",height:"100%",flexDirection:"column",gap:t.spacing(2)}),codeEditor:(0,p.css)({flexGrow:1})});var gt=o(86871),qa=o(39468);const _a=({editLinkIdx:t,dashboard:n,onGoBack:a})=>{const[s,i]=(0,v.useState)(t!==null?n.links[t]:gt.q),l=d=>{const c=[...n.links];c.splice(t,1,d),n.links=c,i(d)};return(0,e.jsx)(qa.d,{link:s,onUpdate:l,onGoBack:a})};var es=o(88898);const ts=({dashboard:t,onNew:n,onEdit:a})=>{const[s,i]=(0,v.useState)(t.links),l=(h,u)=>{t.links=Ft.moveItemImmutably(s,h,h+u),i(t.links)},d=h=>{t.links=[...s,{...h}],i(t.links)},c=h=>{t.links=[...s.slice(0,h),...s.slice(h+1)],i(t.links)};return(0,e.jsx)(es.X,{links:s,onNew:n,onEdit:a,onDuplicate:d,onDelete:c,onOrderChange:l})};function ns({dashboard:t,sectionNav:n,editIndex:a}){const[s,i]=(0,v.useState)(!1),l=()=>{i(!1),j.Ny.partial({editIndex:void 0})},d=()=>{t.links=[...t.links,{...gt.q}],i(!0),j.Ny.partial({editIndex:t.links.length-1})},c=g=>{i(!1),j.Ny.partial({editIndex:g})},h=a!==void 0;let u=n.node.parentItem;return h&&(u={text:s?"New link":"Edit link",subTitle:s?"Create a new link on your dashboard":"Edit a specific link of your dashboard",parentItem:n.node.parentItem}),(0,e.jsxs)(E.Y,{navModel:n,pageNav:u,children:[!h&&(0,e.jsx)(ts,{dashboard:t,onNew:d,onEdit:c}),h&&(0,e.jsx)(_a,{dashboard:t,editLinkIdx:a,onGoBack:l})]})}var Ge=o(19161),as=o(10685),ss=o(7923),is=o(34753),os=o(1199),rs=o(61371),ls=o(41053);const ds=async(t,n)=>(be.t.ignoreNextSave(),await Ge.w.restoreDashboard(n.uid,t)),cs=(t,n)=>{const a=(0,ee.d4)(d=>d.dashboard.getModel()),[s,i]=(0,ls.A)(async()=>await ds(t,a),[]),l=(0,se._2)();return(0,v.useEffect)(()=>{if(s.value){const d=j.Ny.getLocation(),c=W.I.stripBaseFromUrl(s.value.url),h=d.state?.routeReloadCounter;j.Ny.replace({...d,pathname:c,state:{routeReloadCounter:h?h+1:1}}),l.success("Dashboard restored",`Restored from version ${n}`)}},[s,n,l]),{state:s,onRestoreDashboard:i}},kt=({hideModal:t,id:n,version:a})=>{const{state:s,onRestoreDashboard:i}=cs(n,a);return(0,v.useEffect)(()=>{!s.loading&&s.value&&t()},[s,t]),(0,e.jsx)(ot.u,{isOpen:!0,title:(0,r.t)("dashboard.revert-dashboard-modal.title-restore-version","Restore version"),icon:"history",onDismiss:t,onConfirm:i,body:(0,e.jsx)("p",{children:(0,e.jsxs)(r.x6,{i18nKey:"dashboard.revert-dashboard-modal.body-restore-version",children:["Are you sure you want to restore the dashboard to version ",{version:a},"? All unsaved changes will be lost."]})}),confirmText:(0,r.t)("dashboard.revert-dashboard-modal.confirmText-restore-version","Yes, restore to version {{version}}",{version:a})})},hs=({baseInfo:t,newInfo:n,diffData:a,isNewLatest:s})=>{const i=(0,rs.G4)(a.lhs,a.rhs),l=(0,y.of)(us);return(0,e.jsxs)(L.B,{direction:"column",gap:1,children:[(0,e.jsxs)(L.B,{justifyContent:"space-between",alignItems:"center",children:[(0,e.jsxs)(L.B,{alignItems:"center",children:[(0,e.jsxs)("span",{className:(0,p.cx)(l.versionInfo,l.noMarginBottom),children:[(0,e.jsxs)(r.x6,{i18nKey:"dashboard.version-history-comparison.old-updated-by",values:{version:t.version,editor:t.createdBy,timeAgo:t.ageString},children:[(0,e.jsxs)("strong",{children:["Version ","{{version}}"]})," updated by ","{{editor}}"," ","{{timeAgo}}"]}),t.message]}),(0,e.jsx)(w.I,{name:"arrow-right",size:"sm"}),(0,e.jsxs)("span",{className:l.versionInfo,children:[(0,e.jsxs)(r.x6,{i18nKey:"dashboard.version-history-comparison.new-updated-by",values:{version:n.version,editor:n.createdBy,timeAgo:n.ageString},children:[(0,e.jsxs)("strong",{children:["Version ","{{version}}"]})," updated by ","{{editor}}"," ","{{timeAgo}}"]}),n.message]})]}),s&&(0,e.jsx)(fe.$s,{children:({showModal:d,hideModal:c})=>(0,e.jsx)(f.$n,{variant:"destructive",icon:"history",onClick:()=>{d(kt,{id:t.id,version:t.version,hideModal:c})},children:(0,e.jsxs)(r.x6,{i18nKey:"dashboard.version-history-comparison.button-restore",values:{version:t.version},children:["Restore to version ","{{version}}"]})})})]}),Object.entries(i).map(([d,c])=>(0,e.jsx)(is.D,{diffs:c,title:d},d)),(0,e.jsx)(pt.a,{paddingTop:2,children:(0,e.jsx)(nt.M,{isOpen:!1,label:(0,r.t)("dashboard.version-history-comparison.label-view-json-diff","View JSON diff"),children:(0,e.jsx)(os.M,{oldValue:JSON.stringify(a.lhs,null,2),newValue:JSON.stringify(a.rhs,null,2)})})})]})},us=t=>({versionInfo:(0,p.css)({color:t.colors.text.secondary,fontSize:t.typography.bodySmall.fontSize}),noMarginBottom:(0,p.css)({marginBottom:0})});var ps=o(94018);const gs=({versions:t,canCompare:n,onCheck:a})=>{const s=(0,y.of)(vs);return(0,e.jsx)("div",{className:s.margin,children:(0,e.jsxs)("table",{className:"filter-table",children:[(0,e.jsx)("thead",{children:(0,e.jsxs)("tr",{children:[(0,e.jsx)("th",{className:"width-4"}),(0,e.jsx)("th",{className:"width-4",children:(0,e.jsx)(r.x6,{i18nKey:"dashboard.version-history-table.version",children:"Version"})}),(0,e.jsx)("th",{className:"width-14",children:(0,e.jsx)(r.x6,{i18nKey:"dashboard.version-history-table.date",children:"Date"})}),(0,e.jsx)("th",{className:"width-10",children:(0,e.jsx)(r.x6,{i18nKey:"dashboard.version-history-table.updated-by",children:"Updated by"})}),(0,e.jsx)("th",{children:(0,e.jsx)(r.x6,{i18nKey:"dashboard.version-history-table.notes",children:"Notes"})}),(0,e.jsx)("th",{})]})}),(0,e.jsx)("tbody",{children:t.map((i,l)=>(0,e.jsxs)("tr",{children:[(0,e.jsx)("td",{children:(0,e.jsx)(ct.S,{"aria-label":(0,r.t)("dashboard.version-history-table.aria-label-toggle-selection","Toggle selection of version {{version}}",{version:i.version}),className:(0,p.css)({display:"inline"}),checked:i.checked,onChange:d=>a(d,i.id),disabled:!i.checked&&n})}),(0,e.jsx)("td",{children:i.version}),(0,e.jsx)("td",{children:i.createdDateString}),(0,e.jsx)("td",{children:i.createdBy}),(0,e.jsx)("td",{children:i.message}),(0,e.jsx)("td",{className:"text-right",children:l===0?(0,e.jsx)(ps.v,{name:(0,r.t)("dashboard.version-history-table.name-latest","Latest"),colorIndex:17}):(0,e.jsx)(fe.$s,{children:({showModal:d,hideModal:c})=>(0,e.jsx)(f.$n,{variant:"secondary",size:"sm",icon:"history",onClick:()=>{d(kt,{id:i.id,version:i.version,hideModal:c})},children:(0,e.jsx)(r.x6,{i18nKey:"dashboard.version-history-table.restore",children:"Restore"})})})})]},i.id))})]})})};function vs(t){return{margin:(0,p.css)({marginBottom:t.spacing(4)})}}const ms=10;class bs extends v.PureComponent{constructor(n){super(n),this.getVersions=(a=!1)=>{this.setState({isAppending:a});const s=this.continueToken?{limit:this.limit,start:this.start,continueToken:this.continueToken}:{limit:this.limit,start:this.start};Ge.w.getHistoryList(this.props.dashboard.uid,s).then(i=>{this.setState({isLoading:!1,versions:[...this.state.versions??[],...this.decorateVersions(i.versions)]}),this.start+=this.limit,this.continueToken=i.continueToken??""}).catch(i=>console.log(i)).finally(()=>this.setState({isAppending:!1}))},this.getDiff=async()=>{const a=this.state.versions.filter(h=>h.checked),[s,i]=a,l=s.version===this.props.dashboard.version;this.setState({isLoading:!0});let d=await Ge.w.getDashboardVersion(this.props.dashboard.uid,i.id),c=await Ge.w.getDashboardVersion(this.props.dashboard.uid,s.id);this.setState({baseInfo:i,isLoading:!1,isNewLatest:l,newInfo:s,viewMode:"compare",diffData:{lhs:d.data,rhs:c.data}})},this.decorateVersions=a=>a.map(s=>({...s,createdDateString:this.props.dashboard.formatDate(s.created),ageString:this.props.dashboard.getRelativeTime(s.created),checked:!1})),this.onCheck=(a,s)=>{this.setState({versions:this.state.versions.map(i=>i.id===s?{...i,checked:a.currentTarget.checked}:i)})},this.reset=()=>{this.continueToken="",this.setState({baseInfo:void 0,diffData:{lhs:"",rhs:""},isNewLatest:!1,newInfo:void 0,versions:this.state.versions.map(a=>({...a,checked:!1})),viewMode:"list"})},this.limit=ms,this.start=0,this.continueToken="",this.state={isAppending:!0,isLoading:!0,versions:[],viewMode:"list",isNewLatest:!1,diffData:{lhs:"",rhs:""}}}componentDidMount(){this.getVersions()}isLastPage(){return this.state.versions.find(n=>n.version===1)||this.state.versions.length%this.limit!==0||this.continueToken===""}render(){const{versions:n,viewMode:a,baseInfo:s,newInfo:i,isNewLatest:l,isLoading:d,diffData:c}=this.state,h=n.filter(x=>x.checked).length===2,u=n.length>1,g=n.length>=this.limit,m=this.props.sectionNav.node.parentItem;return a==="compare"?(0,e.jsxs)(E.Y,{navModel:this.props.sectionNav,pageNav:m,children:[(0,e.jsx)(ss.m,{onClick:this.reset,baseVersion:s?.version,newVersion:i?.version,isNewLatest:l}),d?(0,e.jsx)(vt,{msg:"Fetching changes\u2026"}):(0,e.jsx)(hs,{newInfo:i,baseInfo:s,isNewLatest:l,diffData:c})]}):(0,e.jsxs)(E.Y,{navModel:this.props.sectionNav,pageNav:m,children:[d?(0,e.jsx)(vt,{msg:"Fetching history list\u2026"}):(0,e.jsx)(gs,{versions:n,onCheck:this.onCheck,canCompare:h}),this.state.isAppending&&(0,e.jsx)(vt,{msg:"Fetching more entries\u2026"}),u&&(0,e.jsx)(as.r,{hasMore:g,canCompare:h,getVersions:this.getVersions,getDiff:this.getDiff,isLastPage:!!this.isLastPage()})]})}}const vt=({msg:t})=>(0,e.jsxs)(L.B,{children:[(0,e.jsx)(at.y,{}),(0,e.jsx)("em",{children:t})]}),fs=()=>j.Ny.partial({editview:null,editIndex:null});function xs({dashboard:t,editview:n,pageNav:a,sectionNav:s}){const[i,l]=(0,v.useState)(0);(0,v.useEffect)(()=>{t.events.subscribe(_.Cf,()=>l(Z=>Z+1))},[t]);const d=(0,v.useMemo)(()=>ys(t),[t,i]),c=()=>{t.meta.hasUnsavedFolderChange=!1},h=d.find(Z=>Z.id===n)??d[0],u=S.TP.hasEditPermissionInFolders,g=t.meta.canSave,m=(0,I.zy)(),x=Ps(m),N=js(a,s,d,h,m,t.uid),D="sm",P=[(0,e.jsx)(f.$n,{"data-testid":b.Tp.pages.Dashboard.Settings.Actions.close,variant:"secondary",fill:"outline",size:D,onClick:fs,children:(0,e.jsx)(r.x6,{i18nKey:"dashboard.dashboard-settings.actions.close",children:"Close"})},"close"),u&&(0,e.jsx)(et.m,{dashboard:t,onSaveSuccess:c,variant:"secondary",size:D},"save as"),g&&(0,e.jsx)(et.C,{dashboard:t,onSaveSuccess:c,size:D},"Save")];return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(wt.H,{actions:(0,e.jsx)(Mt.U,{alignment:"right",children:P})}),(0,e.jsx)(h.component,{sectionNav:N,dashboard:t,editIndex:x})]})}function ys(t){const n=[],a=(0,r.t)("dashboard-settings.general.title","General");t.meta.canEdit&&(n.push({title:a,id:"settings",icon:"sliders-v-alt",component:Ya}),n.push({title:(0,r.t)("dashboard-settings.annotations.title","Annotations"),id:"annotations",icon:"comment-alt",component:Ma,subTitle:"Annotation queries return events that can be visualized as event markers in graphs across the dashboard."}),n.push({title:(0,r.t)("dashboard-settings.variables.title","Variables"),id:"templating",icon:"calculator-alt",component:ma,subTitle:"Variables can make your dashboard more dynamic and act as global filters."}),n.push({title:(0,r.t)("dashboard-settings.links.title","Links"),id:"links",icon:"link",component:ns})),t.meta.canMakeEditable&&n.push({title:a,icon:"sliders-v-alt",id:"settings",component:Ss}),t.uid&&t.meta.canSave&&n.push({title:(0,r.t)("dashboard-settings.versions.title","Versions"),id:"versions",icon:"history",component:bs});const s=(0,r.t)("dashboard-settings.permissions.title","Permissions");return t.uid&&t.meta.canAdmin&&S.TP.hasPermission(tt.w.DashboardsPermissionsRead)&&n.push({title:s,id:"permissions",icon:"lock",component:fa}),n.push({title:(0,r.t)("dashboard-settings.json-editor.title","JSON Model"),id:"dashboard_json",icon:"arrow",component:Za}),n}function Ht(t,n){return{...t,parentItem:t.parentItem?Ht(t.parentItem,n):n}}function js(t,n,a,s,i,l){const d={text:(0,r.t)("dashboard-settings.settings.title","Settings"),children:[],icon:"apps",hideFromBreadcrumbs:!1,url:W.I.getUrlForPartial(i,{editview:"settings",editIndex:null})};d.children=a.map(h=>({text:h.title,icon:h.icon,id:`${l}/${h.id}`,url:W.I.getUrlForPartial(i,{editview:h.id,editIndex:null}),active:h===s,parentItem:d,subTitle:h.subTitle}));const c=Ht(t,n.main);return d.parentItem=c,{main:d,node:d.children.find(h=>h.active)}}function Ss({dashboard:t,sectionNav:n}){return(0,e.jsx)(E.Y,{navModel:n,children:(0,e.jsxs)(L.B,{direction:"column",gap:2,alignItems:"flex-start",children:[(0,e.jsx)(Oe.E,{variant:"h3",children:(0,e.jsx)(r.x6,{i18nKey:"dashboard.make-editable.dashboard-not-editable",children:"Dashboard not editable"})}),(0,e.jsx)(f.$n,{type:"submit",onClick:()=>t.makeEditable(),children:(0,e.jsx)(r.x6,{i18nKey:"dashboard.make-editable.make-editable",children:"Make editable"})})]})})}function Ps(t){const n=new URLSearchParams(t.search).get("editIndex");if(n!=null)return parseInt(n,10)}var ne=o(26689);function Qt(t,n){return t.panels[n.key]}var mt=o(70713),Jt=o(8207),bt=o(54314),ke=o(60208),Yt=o(47931),Ie=o(21285),Cs=o(4213),Ds=o.n(Cs),Ts=o(80011),He=o(55386),Es=o(5114),Ns=o(65333),Pe=o(75421),Zt=o(98314),Me=(t=>(t[t.Support=0]="Support",t[t.Data=1]="Data",t))(Me||{}),Qe=(t=>(t[t.PanelSnapshot=0]="PanelSnapshot",t[t.GithubComment=1]="GithubComment",t))(Qe||{});class Is extends Es.Q{constructor(n){super({panel:n,panelTitle:n.replaceVariables(n.title,void 0,"text")||"Panel",currentTab:0,showMessage:1,snapshotText:"",markdownText:"",randomize:{},snapshotUpdate:0,options:[{label:(0,r.t)("dashboard.support-snapshot-service.label.git-hub-comment","GitHub comment"),description:"Copy and paste this message into a GitHub issue or comment",value:1},{label:(0,r.t)("dashboard.support-snapshot-service.label.panel-support-snapshot","Panel support snapshot"),description:(0,r.t)("dashboard.support-snapshot-service.description.dashboard-troubleshoot-visualization-issues","Dashboard JSON used to help troubleshoot visualization issues"),value:0}]}),this.onCurrentTabChange=a=>{this.setState({currentTab:a})},this.onShowMessageChange=a=>{this.setState({showMessage:a.value})},this.onGetMarkdownForClipboard=()=>{const{markdownText:a}=this.state,s=Math.pow(1024,2)*1.5;return a.length>s?(this.setState({error:{title:(0,r.t)("dashboard.support-snapshot-service.title.copy-to-clipboard-failed","Copy to clipboard failed"),message:"Snapshot is too large, consider download and attaching a file instead"}}),""):a},this.onDownloadDashboard=()=>{const{snapshotText:a,panelTitle:s}=this.state,i=new Blob([a],{type:"text/plain"}),l=`debug-${s}-${(0,Ts.LE)(new Date)}.json.txt`;Ds()(i,l)},this.onSetSnapshotText=a=>{this.setState({snapshotText:a})},this.onToggleRandomize=a=>{const{randomize:s}=this.state;this.setState({randomize:{...s,[a]:!s[a]}})}}async buildDebugDashboard(){const{panel:n,randomize:a,snapshotUpdate:s}=this.state,i=await(0,Zt.E_)(n,a,(0,Pe.jG)().timeRange()),l=JSON.stringify(i,null,2),d=(0,Zt.jD)(n,l),c=(0,He.cN)((0,He.j_)("bytes")(l?.length??0));let h;if(!n.isAngularPlugin())try{const u=new De.G(i,{isEmbedded:!0});h=(0,Ns.EH)(u,i).state.body}catch(u){console.log("Error creating scene:",u)}this.setState({snapshot:i,snapshotText:l,markdownText:d,snapshotSize:c,snapshotUpdate:s+1,scene:h})}}function Ms({panel:t,plugin:n,onClose:a}){const s=(0,y.of)(ws),i=(0,v.useMemo)(()=>new Is(t),[t]),{currentTab:l,loading:d,error:c,options:h,showMessage:u,snapshotSize:g,markdownText:m,snapshotText:x,randomize:N,panelTitle:D,scene:P}=i.useState();if((0,v.useEffect)(()=>{i.buildDebugDashboard()},[i,n,N]),!n)return null;const Z=[{label:(0,r.t)("dashboard.help-wizard.tabs.label.snapshot","Snapshot"),value:Me.Support},{label:(0,r.t)("dashboard.help-wizard.tabs.label.data","Data"),value:Me.Data}],ae=M.$.supportBundlesEnabled&&S.TP.hasPermission(tt.w.ActionSupportBundlesCreate);return(0,e.jsxs)(Jt._,{title:(0,r.t)("dashboard.help-wizard.title-get-help-with-this-panel","Get help with this panel"),size:"lg",onClose:a,subtitle:(0,e.jsxs)(L.B,{direction:"column",gap:1,children:[(0,e.jsx)(L.B,{direction:"row",gap:1,children:(0,e.jsx)(Ee.Y,{href:"https://grafana.com/docs/grafana/latest/troubleshooting/",external:!0,children:(0,e.jsx)(r.x6,{i18nKey:"dashboard.help-wizard.troubleshooting-docs",children:"Troubleshooting docs"})})}),(0,e.jsx)("span",{className:"muted",children:(0,e.jsx)(r.x6,{i18nKey:"help-wizard.troubleshooting-help",children:"To request troubleshooting help, send a snapshot of this panel to Grafana Labs Technical Support. The snapshot contains query response data and panel settings."})}),ae&&(0,e.jsx)("span",{className:"muted",children:(0,e.jsxs)(r.x6,{i18nKey:"help-wizard.support-bundle",children:["You can also retrieve a support bundle containing information concerning your Grafana instance and configured datasources in the ",(0,e.jsx)(Ee.Y,{href:"/support-bundles",children:"support bundles section"}),"."]})})]}),tabs:(0,e.jsx)(bt.U,{children:Z.map((q,we)=>(0,e.jsx)(ke.o,{label:q.label,active:q.value===l,onChangeTab:()=>i.onCurrentTabChange(q.value)},`${q.value}-${we}`))}),children:[d&&(0,e.jsx)(at.y,{}),c&&(0,e.jsx)(Ne.F,{title:c.title,children:c.message}),l===Me.Data&&(0,e.jsxs)("div",{className:s.code,children:[(0,e.jsxs)("div",{className:s.opts,children:[(0,e.jsx)(Q.D,{label:(0,r.t)("dashboard.help-wizard.label-template","Template"),className:s.field,children:(0,e.jsx)(ht.l6,{options:h,value:u,onChange:i.onShowMessageChange})}),u===Qe.GithubComment?(0,e.jsx)(Yt.b,{icon:"copy",getText:i.onGetMarkdownForClipboard,children:(0,e.jsx)(r.x6,{i18nKey:"dashboard.help-wizard.copy-to-clipboard",children:"Copy to clipboard"})}):(0,e.jsx)(f.$n,{icon:"download-alt",onClick:i.onDownloadDashboard,children:(0,e.jsxs)(r.x6,{i18nKey:"dashboard.help-wizard.download-snapshot",children:["Download (",{snapshotSize:g},")"]})})]}),(0,e.jsx)(mt.Ay,{disableWidth:!0,children:({height:q})=>(0,e.jsx)(Gt.B,{width:"100%",height:q,language:u===Qe.GithubComment?"markdown":"json",showLineNumbers:!0,showMiniMap:!0,value:u===Qe.GithubComment?m:x,readOnly:!1,onBlur:i.onSetSnapshotText})})]}),l===Me.Support&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(Q.D,{label:(0,r.t)("dashboard.help-wizard.label-obfuscate-data","Obfuscate data"),description:(0,r.t)("dashboard.help-wizard.description-obfuscate-data","Modify the original data to hide sensitve information.  Note the lengths will stay the same, and duplicate values will be equal."),children:(0,e.jsxs)(L.B,{direction:"row",gap:1,children:[(0,e.jsx)(Ie.K,{label:(0,r.t)("dashboard.help-wizard.randomize-labels-label-labels","Labels"),id:"randomize-labels",showLabel:!0,value:!!N.labels,onChange:()=>i.onToggleRandomize("labels")}),(0,e.jsx)(Ie.K,{label:(0,r.t)("dashboard.help-wizard.randomize-field-names-label-field-names","Field names"),id:"randomize-field-names",showLabel:!0,value:!!N.names,onChange:()=>i.onToggleRandomize("names")}),(0,e.jsx)(Ie.K,{label:(0,r.t)("dashboard.help-wizard.randomize-string-values-label-string-values","String values"),id:"randomize-string-values",showLabel:!0,value:!!N.values,onChange:()=>i.onToggleRandomize("values")})]})}),(0,e.jsx)(Q.D,{label:(0,r.t)("dashboard.help-wizard.label-support-snapshot","Support snapshot"),description:(0,r.t)("dashboard.help-wizard.description-support-snapshot","Panel: {{panelTitle}}",{panelTitle:D}),children:(0,e.jsxs)(L.B,{children:[(0,e.jsx)(f.$n,{icon:"download-alt",onClick:i.onDownloadDashboard,children:(0,e.jsxs)(r.x6,{i18nKey:"help-wizard.download-snapshot",children:["Download snapshot (",{snapshotSize:g},")"]})}),(0,e.jsx)(Yt.b,{icon:"github",getText:i.onGetMarkdownForClipboard,title:(0,r.t)("dashboard.help-wizard.title-complete-git-hub-comment-clipboard","Copy a complete GitHub comment to the clipboard"),children:(0,e.jsx)(r.x6,{i18nKey:"help-wizard.github-comment",children:"Copy Github comment"})})]})}),(0,e.jsx)(mt.Ay,{disableWidth:!0,children:({height:q})=>(0,e.jsx)("div",{style:{height:q,overflow:"auto"},children:P&&(0,e.jsx)(P.Component,{model:P})})})]})]})}const ws=t=>({code:(0,p.css)({flexGrow:1,height:"100%",overflow:"scroll"}),field:(0,p.css)({width:"100%"}),opts:(0,p.css)({display:"flex",width:"100%",flexGrow:0,alignItems:"center",justifyContent:"flex-end",button:{marginLeft:"8px"}})}),ft=(t,n,a)=>{const s=(0,v.useRef)(),[i,l]=(0,v.useState)();return(0,v.useEffect)(()=>{let d=-1,c=0;return s.current=t.getQueryRunner().getData({withTransforms:n.withTransforms,withFieldConfig:!1}).subscribe({next:h=>{if(a){if(d===h.structureRev){const u=Date.now();if(u-c<1e4)return;c=u}d=h.structureRev??-1}l(h)}}),()=>{s.current&&s.current.unsubscribe()}},[t,n.withTransforms]),{data:i,isLoading:i?.state===Ue.Gu.Loading,hasSeries:i?!!i.series:!1,hasError:!!(i&&(i.error||i?.errors?.length||i.state===Ue.Gu.Error))}};var Ls=o(1906),Xt=o(2863),Vs=o(42836),As=o(80307),Rs=o(82049);const Os=({data:t,metadataDatasource:n})=>!n||!n.components?.MetadataInspector?(0,e.jsx)(r.x6,{i18nKey:"dashboard.inspect-meta.no-inspector",children:"No Metadata Inspector"}):(0,e.jsx)(n.components.MetadataInspector,{datasource:n,data:t.series});var Bs=o(55072),Us=o(96065);const zs=({panel:t,plugin:n,dashboard:a,tabs:s,data:i,isDataLoading:l,dataOptions:d,metadataDatasource:c,defaultTab:h,onDataOptionsChange:u,onClose:g})=>{const[m,x]=(0,v.useState)(h??ne.q.Data);if(!n)return null;let N=Ks(i),D=m;s.find(ae=>ae.value===m)||(D=ne.q.JSON);const P=(0,Xt.w)().replace(t.title,t.scopedVars,"text")||"Panel",Z=(0,r.t)("dashboard.inspect.title","Inspect: {{panelTitle}}",{panelTitle:P});return(0,e.jsxs)(Jt._,{title:Z,subtitle:i&&Fs(i),onClose:g,tabs:(0,e.jsx)(bt.U,{children:s.map((ae,q)=>(0,e.jsx)(ke.o,{label:ae.label,active:ae.value===D,onChangeTab:()=>x(ae.value||ne.q.Data)},`${ae.value}-${q}`))}),children:[D===ne.q.Data&&(0,e.jsx)(Vs.q,{dataName:P,panelPluginId:t.type,fieldConfig:t.fieldConfig,hasTransformations:!!t.transformations?.length,data:i&&i.series,isLoading:l,options:d,onOptionsChange:u,timeZone:a.timezone,app:Ls.Jk.Dashboard}),i&&D===ne.q.Meta&&(0,e.jsx)(Os,{data:i,metadataDatasource:c}),D===ne.q.JSON&&(0,e.jsx)(Rs.w,{panel:t,dashboard:a,data:i,onClose:g}),D===ne.q.Error&&(0,e.jsx)(As.y,{errors:N}),i&&D===ne.q.Stats&&(0,e.jsx)(Bs.N,{data:i,timeZone:a.getTimezone()}),i&&D===ne.q.Query&&(0,e.jsx)(Us.e,{data:i,onRefreshQuery:()=>t.refresh()})]})};function Ks(t){let n=t?.errors??[];return t?.error&&!n.includes(t.error)&&(n=[t.error,...n]),!n.length&&t?.state===Ue.Gu.Error?[{message:(0,r.t)("dashboard.get-errors.message.error-loading-data","Error loading data")}]:n}function Fs(t){const{request:n}=t;if(!n||(0,ue.isEmpty)(n))return"";const a=n.targets.length,s=n.endTime?n.endTime-n.startTime:0,i=(0,He.cN)((0,He.j_)("ms")(s));return(0,e.jsxs)(r.x6,{i18nKey:"dashboard.inspect.subtitle",children:[{queryCount:a}," queries with total query time of ",{formatted:i}]})}var qt=o(14252);const $s=({panel:t,dashboard:n,plugin:a})=>{const s=(0,I.zy)(),i=new URLSearchParams(s.search).get("inspectTab"),[l,d]=(0,v.useState)({withTransforms:i===ne.q.Error,withFieldConfig:!0}),{data:c,isLoading:h,hasError:u}=ft(t,l,!1),g=(0,qt.sd)(c),m=(0,qt.kx)(t,n,a,u,g),x=()=>{j.Ny.partial({inspect:null,inspectTab:null})};return a?i===ne.q.Help?(0,e.jsx)(Ms,{panel:t,plugin:a,onClose:x}):(0,e.jsx)(zs,{dashboard:n,panel:t,plugin:a,defaultTab:i,tabs:m,data:c,isDataLoading:h,dataOptions:l,onDataOptionsChange:d,metadataDatasource:g,onClose:x}):null},Ws=(t,n)=>{const a=Qt(t,n.panel);return a?{plugin:a.plugin}:{plugin:null}},Gs=(0,B.connect)(Ws)($s);var _t=o(64423),xt=o(7895),en=o(65240),tn=o(77808),yt=o(7389),ks=o(8921);const Hs=t=>{const n=(0,v.useMemo)(()=>rt.B.get(t.variable.type).picker,[t.variable]);return t.variable?(0,e.jsxs)(L.B,{gap:0,children:[(0,e.jsx)(Qs,{variable:t.variable}),t.variable.hide!==yt.zL.hideVariable&&n&&(0,e.jsx)(n,{variable:t.variable,readOnly:t.readOnly??!1})]}):(0,e.jsx)("div",{children:(0,e.jsx)(r.x6,{i18nKey:"variables.picker-renderer.couldnt-load-variable",children:"Couldn't load variable"})})};function Qs({variable:t}){const n=(0,v.useMemo)(()=>t.label||t.name,[t]);if(t.hide!==yt.zL.dontHide)return null;const a=ks.qz+t.id;return t.description?(0,e.jsx)(Be.m,{content:t.description,placement:"bottom",children:(0,e.jsx)("label",{className:"gf-form-label gf-form-label--variable","data-testid":b.Tp.pages.Dashboard.SubMenu.submenuItemLabels(n),htmlFor:a,children:n})}):(0,e.jsx)("label",{className:"gf-form-label gf-form-label--variable","data-testid":b.Tp.pages.Dashboard.SubMenu.submenuItemLabels(n),htmlFor:a,children:n})}const nn=({variables:t,readOnly:n})=>{const[a,s]=(0,v.useState)([]),i=(0,y.of)(Js);return(0,v.useEffect)(()=>{s(t.filter(l=>l.hide!==yt.zL.hideVariable))},[t]),a.length===0?null:(0,e.jsx)(e.Fragment,{children:a.map(l=>(0,e.jsx)("div",{className:i.submenuItem,"data-testid":b.Tp.pages.Dashboard.SubMenu.submenuItem,children:(0,e.jsx)(Hs,{variable:l,readOnly:n})},l.id))})},Js=t=>({submenuItem:(0,p.css)({display:"inline-block",".fa-caret-down":{fontSize:"75%",paddingLeft:t.spacing(1)},".gf-form":{marginBottom:0}})});var Ys=o(69289),Zs=o(12161),an=o(75515),Xs=o(97976),qs=o(74618),_s=o(37010),ei=o(68373),ti=o(93256),ni=o(41097);const sn=t=>n=>n.plugins.panels[t]||(0,ni.$)(`Panel plugin not found (${t})`,!0),jt=({panel:t})=>{const n=(0,ee.wA)(),a=(0,ee.d4)(sn(t.type)),s=(0,ee.d4)(c=>c.panelEditor.ui.isPanelOptionsVisible),i=(0,ee.d4)(c=>c.panelEditor.isVizPickerOpen),l=()=>{n((0,le.eK)(!i))},d=()=>{n(_e({isPanelOptionsVisible:!s}))};return a?(0,e.jsx)("div",{className:on.wrapper,children:(0,e.jsxs)(ti.e,{children:[(0,e.jsx)(xt.I,{className:on.vizButton,tooltip:(0,r.t)("dashboard.visualization-button.tooltip-click-to-change-visualization","Click to change visualization"),imgSrc:a.meta.info.logos.small,isOpen:i,onClick:l,"data-testid":b.Tp.components.PanelEditor.toggleVizPicker,"aria-label":(0,r.t)("dashboard.visualization-button.aria-label-change-visualization","Change visualization"),variant:"canvas",fullWidth:!0,children:a.meta.name}),(0,e.jsx)(xt.I,{tooltip:s?(0,r.t)("dashboard.visualization-button.tooltip-close","Close options pane"):(0,r.t)("dashboard.visualization-button.tooltip-show","Show options pane"),icon:s?"angle-right":"angle-left",onClick:d,variant:"canvas","data-testid":b.Tp.components.PanelEditor.toggleVizOptions,"aria-label":s?(0,r.t)("dashboard.visualization-button.aria-label-close","Close options pane"):(0,r.t)("dashboard.visualization-button.aria-label-show","Show options pane")})]})}):null};jt.displayName="VisualizationTab";const on={wrapper:(0,p.css)({display:"flex",flexDirection:"column"}),vizButton:(0,p.css)({textAlign:"left"})};var ai=o(78685),si=o(12737),rn=o(92807),ii=o(95943),oi=o(92100),ri=o(43652);const li=({onConfirm:t,onDismiss:n,panel:a})=>{const s=(0,an.X)(a),i=`${s?"Changing":"Replace with"} library panel`,l=`${s?"Changing":"Replacing with a"} library panel will remove any changes since last save.`;return(0,e.jsx)(ot.u,{onConfirm:t,onDismiss:n,confirmText:s?(0,r.t)("library-panels.change-library-panel-modal.confirmText-change","Change"):(0,r.t)("library-panels.change-library-panel-modal.confirmText-replace","Replace"),title:i,body:l,dismissText:"Cancel",isOpen:!0})};var di=o(90232);const ci=({panel:t,searchQuery:n})=>{const[a,s]=(0,v.useState)(!1),[i,l]=(0,v.useState)(void 0),[d,c]=(0,v.useState)([]),h=(0,v.useCallback)(D=>{c(D.map(P=>P.id))},[c]),u=(0,We.UA)().getCurrent(),g=(0,ee.wA)(),m=async()=>{i&&(l(void 0),g((0,ve.Xk)(t,i)))},x=()=>s(!0),N=()=>l(void 0);return(0,e.jsxs)(L.B,{direction:"column",gap:2,children:[!t.libraryPanel&&(0,e.jsx)(L.B,{alignItems:"center",children:(0,e.jsx)(f.$n,{icon:"plus",onClick:x,variant:"secondary",fullWidth:!0,children:(0,e.jsx)(r.x6,{i18nKey:"library-panels.panel-library-options-group.create-new-library-panel",children:"Create new library panel"})})}),(0,e.jsx)(oi.$,{onChange:h}),(0,e.jsx)("div",{className:hi.libraryPanelsView,children:(0,e.jsx)(di.y,{currentPanelId:t.libraryPanel?.uid,searchString:n,panelFilter:d,onClickCard:l,showSecondaryActions:!0})}),a&&(0,e.jsx)(ri.o,{panel:t,onDismiss:()=>s(!1),initialFolderUid:u?.meta.folderUid,isOpen:a}),i&&(0,e.jsx)(li,{panel:t,onDismiss:N,onConfirm:m})]})},hi={libraryPanelsView:(0,p.css)({width:"100%"})};var ui=o(82472),pi=o(72165),U=o(62667);const ln=({panel:t,data:n})=>{const a=(0,ee.d4)(sn(t.type)),[s,i]=(0,v.useState)(""),l=ii.wV,d=U.__.Visualizations,[c,h]=(0,ai.A)(l,d),u=(0,ee.wA)(),g=(0,y.of)(gi),m=(0,v.useRef)(null),x=(0,v.useCallback)(P=>{u((0,ve.gW)({panel:t,...P})),P.withModKey||u((0,le.eK)(!1))},[u,t]),N=()=>{u((0,le.eK)(!1))};if(!a)return null;const D=[{label:(0,r.t)("dashboard.visualization-select-pane.radio-options.label.visualizations","Visualizations"),value:U.__.Visualizations},{label:(0,r.t)("dashboard.visualization-select-pane.radio-options.label.suggestions","Suggestions"),value:U.__.Suggestions},{label:(0,r.t)("dashboard.visualization-select-pane.radio-options.label.library-panels","Library panels"),value:U.__.LibraryPanels,description:(0,r.t)("dashboard.visualization-select-pane.radio-options.description.reusable-panels-share-between-multiple-dashboards","Reusable panels you can share between multiple dashboards.")}];return(0,e.jsxs)("div",{className:g.openWrapper,children:[(0,e.jsxs)("div",{className:g.formBox,children:[(0,e.jsxs)("div",{className:g.searchRow,children:[(0,e.jsx)(si.Z,{value:s,onChange:i,ref:m,autoFocus:!0,placeholder:(0,r.t)("dashboard.visualization-select-pane.placeholder-search-for","Search for...")}),(0,e.jsx)(f.$n,{title:(0,r.t)("dashboard.visualization-select-pane.title-close","Close"),variant:"secondary",icon:"angle-up",className:g.closeButton,"aria-label":b.Tp.components.PanelEditor.toggleVizPicker,onClick:N})]}),(0,e.jsx)(Q.D,{className:g.customFieldMargin,children:(0,e.jsx)(Fe.z,{options:D,value:c,onChange:h,fullWidth:!0})})]}),(0,e.jsx)("div",{className:g.scrollWrapper,children:(0,e.jsx)(rn.P,{children:(0,e.jsxs)("div",{className:g.scrollContent,children:[c===U.__.Visualizations&&(0,e.jsx)(pi.G,{pluginId:a.meta.id,onChange:x,searchQuery:s}),c===U.__.Suggestions&&(0,e.jsx)(ui.a,{onChange:x,searchQuery:s,panel:t,data:n}),c===U.__.LibraryPanels&&(0,e.jsx)(ci,{searchQuery:s,panel:t},"Panel Library")]})})})]})};ln.displayName="VisualizationSelectPane";const gi=t=>({icon:(0,p.css)({color:t.v1.palette.gray33}),wrapper:(0,p.css)({display:"flex",flexDirection:"column",flex:"1 1 0",height:"100%"}),vizButton:(0,p.css)({textAlign:"left"}),scrollWrapper:(0,p.css)({flexGrow:1,minHeight:0}),scrollContent:(0,p.css)({padding:t.spacing(1)}),openWrapper:(0,p.css)({display:"flex",flexDirection:"column",flex:"1 1 100%",height:"100%",background:t.colors.background.primary,border:`1px solid ${t.colors.border.weak}`}),searchRow:(0,p.css)({display:"flex",marginBottom:t.spacing(1)}),closeButton:(0,p.css)({marginLeft:t.spacing(1)}),customFieldMargin:(0,p.css)({marginBottom:t.spacing(1)}),formBox:(0,p.css)({padding:t.spacing(1),paddingBottom:0})}),vi=({plugin:t,panel:n,onFieldConfigsChange:a,onPanelOptionsChanged:s,onPanelConfigChange:i,dashboard:l,instanceState:d})=>{const c=(0,y.of)(mi),h=(0,ee.d4)(g=>g.panelEditor.isVizPickerOpen),{data:u}=ft(n,{withTransforms:!0,withFieldConfig:!1},!0);return(0,e.jsxs)("div",{className:c.wrapper,"data-testid":b.Tp.components.PanelEditor.OptionsPane.content,children:[!h&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("div",{className:c.vizButtonWrapper,children:(0,e.jsx)(jt,{panel:n})}),(0,e.jsx)("div",{className:c.optionsWrapper,children:(0,e.jsx)(ei.Ff,{panel:n,dashboard:l,plugin:t,instanceState:d,data:u,onFieldConfigsChange:a,onPanelOptionsChanged:s,onPanelConfigChange:i})})]}),h&&(0,e.jsx)(ln,{panel:n,data:u})]})},mi=t=>({wrapper:(0,p.css)({height:"100%",width:"100%",display:"flex",flex:"1 1 0",flexDirection:"column",padding:0}),optionsWrapper:(0,p.css)({flexGrow:1,minHeight:0}),vizButtonWrapper:(0,p.css)({padding:`0 ${t.spacing(2,2)} 0`}),legacyOptions:(0,p.css)({label:"legacy-options",".panel-options-grid":{display:"flex",flexDirection:"column"},".panel-options-group":{marginBottom:0},".panel-options-group__body":{padding:`${t.spacing(2)} 0`},".section":{display:"block",margin:`${t.spacing(2)} 0`,"&:first-child":{marginTop:0}}})});var dn=o(75234),bi=o(67522),fi=o(35307),xi=o(67458),yi=(t=>(t.Error="Error",t.Info="Info",t.Links="Links",t))(yi||{});class ji extends v.Component{constructor(){super(...arguments),this.timeSrv=(0,Pe.jG)(),this.getInfoMode=()=>{const{panel:n,error:a}=this.props;if(a)return"Error";if(n.description)return"Info";if(n.links&&n.links.length)return"Links"},this.getInfoContent=()=>{const{panel:n,theme:a}=this.props,s=n.description||"",i=(0,Xt.w)().replace(s,n.scopedVars),l=(0,xi.G)(i),d=this.props.links&&this.props.links.getLinks(n.replaceVariables),c=Ci(a);return(0,e.jsxs)("div",{className:c.content,children:[(0,e.jsx)("div",{dangerouslySetInnerHTML:{__html:l}}),d&&d.length>0&&(0,e.jsx)("ul",{className:c.cornerLinks,children:d.map((h,u)=>(0,e.jsx)("li",{children:(0,e.jsx)("a",{href:h.href,target:h.target,children:h.title})},u))})]})},this.onClickError=()=>{j.Ny.partial({inspect:this.props.panel.id,inspectTab:ne.q.Error})}}render(){const{error:n}=this.props,a=this.getInfoMode();return a?a==="Error"&&n?(0,e.jsx)(cn,{infoMode:a,content:n,onClick:this.onClickError}):a==="Info"||a==="Links"?(0,e.jsx)(cn,{infoMode:a,content:this.getInfoContent}):null:null}}const Si=(0,y.cV)(ji);function cn({infoMode:t,content:n,onClick:a}){const s=t==="Error"?"error":"info",i=b.Tp.components.Panels.Panel.headerCornerInfo(t.toLowerCase()),l=(0,y.of)(Di);return(0,e.jsx)(Be.m,{content:n,placement:"top-start",theme:s,interactive:!0,children:(0,e.jsxs)("button",{type:"button",className:l.infoCorner,onClick:a,"aria-label":i,children:[(0,e.jsx)(w.I,{name:Pi[t],size:t==="Links"?"sm":"lg",className:(0,p.cx)(l.icon,{[l.iconLinks]:t==="Links"})}),(0,e.jsx)("span",{className:(0,p.cx)(l.inner,{[l.error]:t==="Error"})})]})})}const Pi={Error:"exclamation",Info:"info",Links:"external-link-alt"},Ci=t=>({content:(0,p.css)({overflow:"auto",code:{whiteSpace:"normal",wordWrap:"break-word"},"pre > code":{display:"block"}}),cornerLinks:(0,p.css)({listStyle:"none",paddingLeft:0})}),Di=t=>({icon:(0,p.css)({position:"absolute",top:0,left:0,zIndex:2,fill:t.colors.text.maxContrast}),iconLinks:(0,p.css)({left:t.spacing(.5),top:t.spacing(.25)}),inner:(0,p.css)({width:0,height:0,position:"absolute",left:0,bottom:0,borderBottom:`${t.spacing(4)} solid transparent`,borderLeft:`${t.spacing(4)} solid ${t.colors.background.secondary}`}),error:(0,p.css)({borderLeftColor:t.colors.error.main}),infoCorner:(0,p.css)({background:"none",border:"none",color:t.colors.text.secondary,cursor:"pointer",position:"absolute",left:0,top:0,width:t.spacing(4),height:t.spacing(4),zIndex:3})});function Ti({width:t,height:n,panel:a,dashboard:s}){const{data:i}=ft(a,{withTransforms:!0,withFieldConfig:!1},!1),[l,d]=(0,v.useState)({frameIndex:0,showHeader:!0,showTypeIcons:!0});if((0,v.useEffect)(()=>{const h=(0,Pe.jG)(),u=a.events.subscribe(dn._,()=>{const g=(0,ge.nk)(a,h.timeRange());a.runAllPanelQueries({dashboardUID:s.uid,dashboardTimezone:s.getTimezone(),dashboardTitle:s.title,timeData:g,width:t})});return()=>{u.unsubscribe()}},[a,s,t]),!i)return null;const c=i?.errors?i.errors.length>1?"Multiple errors found. Click for more details":i.errors[0].message:i?.error?.message;return(0,e.jsx)(bi.NR,{width:t,height:n,padding:"none",children:(h,u)=>(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(Si,{panel:a,error:c}),(0,e.jsx)(fi.m,{title:(0,r.t)("dashboard.panel-editor-table-view.title-raw-data","Raw data"),pluginId:"table",width:h,height:u,data:i,options:l,onOptionsChange:d})]})})}var hn=o(79104),un=o(30360),Ei=o(13941),pn=o(21764);const Ni=({panel:t,dashboard:n,...a})=>{const{rules:s,loading:i}=(0,pn.S)({panelId:t.id,dashboardUID:n.uid});return(0,e.jsx)(ke.o,{...a,counter:i?null:s.length})};var Ii=o(6975),Mi=o(5556),gn=o(74268),wi=o(20437);const vn=({dashboard:t,panel:n,className:a})=>{const s=(0,ee.d4)(h=>h.templating),i=(0,I.zy)(),{loading:l,value:d}=(0,V.A)(()=>(0,wi.mp)(n,t),[n,t,s]);if(l)return(0,e.jsx)(f.$n,{disabled:!0,children:(0,e.jsx)(r.x6,{i18nKey:"alerting.new-rule-from-panel-button.new-alert-rule",children:"New alert rule"})});if(!d)return(0,e.jsx)(Ne.F,{severity:"info",title:(0,r.t)("alerting.new-rule-from-panel-button.title-no-alerting-capable-query-found","No alerting capable query found"),children:(0,e.jsx)(r.x6,{i18nKey:"alerting.new-rule-from-panel-button.body-no-alerting-capable-query-found",children:"Cannot create alerts from this panel because no query to an alerting capable datasource is found."})});const c=Mi.kM.renderUrl("alerting/new",{defaults:JSON.stringify(d),returnTo:i.pathname+i.search});return(0,e.jsx)(f.z9,{icon:"bell",onClick:()=>(0,gn.fH)(gn.le.alertRuleFromPanel),href:c,className:a,"data-testid":"create-alert-rule-button",children:(0,e.jsx)(r.x6,{i18nKey:"alerting.new-rule-from-panel-button.new-alert-rule",children:"New alert rule"})})};var Li=o(22971),mn=o(54),Vi=o(77256);const Ai=({dashboard:t,panel:n})=>{const a=(0,y.of)(Ri),{errors:s,loading:i,rules:l}=(0,pn.S)({dashboardUID:t.uid,panelId:n.id,poll:!0}),d=(0,mn.Wd)("grafana"),c=M.$.unifiedAlertingEnabled&&S.TP.hasPermission(d.create),h=s.length?(0,e.jsx)(Ne.F,{title:(0,r.t)("alerting.panel-alert-tab-content.alert.title-errors-loading-rules","Errors loading rules"),severity:"error",children:s.map((g,m)=>(0,e.jsx)("div",{children:(0,e.jsxs)(r.x6,{i18nKey:"alerting.panel-alert-tab-content.failed-to-load-error",values:{error:(0,Vi.JZ)(g)},children:["Failed to load Grafana rules state: ","{{error}}"]})},m))}):null;if(i&&!l.length)return(0,e.jsxs)("div",{className:a.innerWrapper,children:[h,(0,e.jsx)(Ii._,{text:(0,r.t)("alerting.panel-alert-tab-content.text-loading-rules","Loading rules...")})]});if(l.length)return(0,e.jsx)(rn.P,{minHeight:"100%",children:(0,e.jsxs)("div",{className:a.innerWrapper,children:[h,(0,e.jsx)(Li.sF,{rules:l}),!!t.meta.canSave&&c&&(0,e.jsx)(vn,{className:a.newButton,panel:n,dashboard:t})]})});const u=!t.uid;return(0,e.jsxs)("div",{"data-testid":b.Tp.components.PanelAlertTabContent.content,className:a.noRulesWrapper,children:[h,!u&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("p",{children:(0,e.jsx)(r.x6,{i18nKey:"dashboard.panel-edit.alerting-tab.no-rules",children:"There are no alert rules linked to this panel."})}),!!t.meta.canSave&&c&&(0,e.jsx)(vn,{panel:n,dashboard:t})]}),u&&!!t.meta.canSave&&(0,e.jsx)(Ne.F,{severity:"info",title:(0,r.t)("alerting.panel-alert-tab-content.title-dashboard-not-saved","Dashboard not saved"),children:(0,e.jsx)(r.x6,{i18nKey:"dashboard.panel-edit.alerting-tab.dashboard-not-saved",children:"Dashboard must be saved before alerts can be added."})})]})},Ri=t=>({newButton:(0,p.css)({marginTop:t.spacing(3)}),innerWrapper:(0,p.css)({padding:t.spacing(2)}),noRulesWrapper:(0,p.css)({margin:t.spacing(2),backgroundColor:t.colors.background.secondary,padding:t.spacing(3)})});var Oi=o(34176),Bi=o(7078),St=o(28998),Ui=o(32154),zi=o(77731);class Ki extends v.PureComponent{constructor(n){super(n),this.updateLastUsedDatasource=a=>{(0,Bi.tw)(a)},this.onRunQueries=()=>{this.props.panel.refresh()},this.onOpenQueryInspector=()=>{j.Ny.partial({inspect:this.props.panel.id,inspectTab:"query"})},this.onOptionsChange=a=>{const{panel:s}=this.props;s.updateQueries(a),a.dataSource.uid!==s.datasource?.uid&&setTimeout(this.onRunQueries,10),this.forceUpdate()}}buildQueryOptions(n){const a=n.datasource??{default:!0},s=(0,St.tR)().getInstanceSettings(a);return this.updateLastUsedDatasource(a),{cacheTimeout:s?.meta.queryOptions?.cacheTimeout?n.cacheTimeout:void 0,dataSource:{default:s?.isDefault,...s?(0,ze.p$)(s):{type:void 0,uid:void 0}},queryCachingTTL:s?.cachingConfig?.enabled?n.queryCachingTTL:void 0,queries:n.targets,maxDataPoints:n.maxDataPoints,minInterval:n.interval,timeRange:{from:n.timeFrom,shift:n.timeShift,hide:n.hideTimeOverride}}}async componentDidMount(){const{panel:n}=this.props;if(!n.datasource){let a;const s=(0,We.UA)().getCurrent()?.uid??"",i=(0,zi.CW)(s);i?.datasourceUid!==null&&(a=(0,St.tR)().getInstanceSettings(i?.datasourceUid)),a||(a=(0,St.tR)().getInstanceSettings(null)),n.datasource=(0,ze.p$)(a),this.forceUpdate()}}render(){const{panel:n}=this.props;if(!n.datasource)return null;const a=this.buildQueryOptions(n);return(0,e.jsx)(Ui.g,{options:a,queryRunner:n.getQueryRunner(),onRunQueries:this.onRunQueries,onOpenQueryInspector:this.onOpenQueryInspector,onOptionsChange:this.onOptionsChange})}}const bn=(0,v.memo)(({panel:t,dashboard:n,tabs:a,onChangeTab:s})=>{const i=(0,hn.C)(),l=(0,y.of)($i),d=(0,v.useCallback)(u=>{let g="panel_editor_tabs_changed";M.$.featureToggles.transformationsRedesign&&(g="transformations_redesign_"+g),u.active||(0,de.rR)(g,{tab_id:u.id}),s(u)},[s]);(0,v.useEffect)(()=>{const u=new _t.yU;return u.add(t.events.subscribe(_.zq,i)),u.add(t.events.subscribe(_.JI,i)),()=>u.unsubscribe()},[t,n,i]);const c=a.find(u=>u.active);if(a.length===0)return null;const h=M.$.unifiedAlertingEnabled;return(0,e.jsxs)("div",{className:l.wrapper,children:[(0,e.jsx)(bt.U,{className:l.tabBar,hideBorder:!0,children:a.map(u=>u.id===U.M8.Alert&&h?(0,e.jsx)(Ni,{label:u.text,active:u.active,onChangeTab:()=>s(u),icon:(0,un.Uo)(u.icon),panel:t,dashboard:n},u.id):(0,e.jsx)(ke.o,{label:u.text,active:u.active,onChangeTab:()=>d(u),icon:(0,un.Uo)(u.icon),counter:Fi(t,u)},u.id))}),(0,e.jsxs)(Ei.J,{className:l.tabContent,children:[c.id===U.M8.Query&&(0,e.jsx)(Ki,{panel:t,queries:t.targets}),c.id===U.M8.Alert&&(0,e.jsx)(Ai,{panel:t,dashboard:n}),c.id===U.M8.Transform&&(0,e.jsx)(Oi.o,{panel:t})]})]})});bn.displayName="PanelEditorTabs";function Fi(t,n){switch(n.id){case U.M8.Query:return t.targets.length;case U.M8.Alert:return t.alert?1:0;case U.M8.Transform:return(t.getTransformations()??[]).length}return null}const $i=t=>({wrapper:(0,p.css)({display:"flex",flexDirection:"column",height:"100%"}),tabBar:(0,p.css)({paddingLeft:t.spacing(2)}),tabContent:(0,p.css)({padding:0,display:"flex",flexDirection:"column",flex:1,minHeight:0,background:t.colors.background.primary,border:`1px solid ${t.components.panel.borderColor}`,borderLeft:"none",borderBottom:"none",borderTopRightRadius:t.shape.borderRadius(1.5)})});var Wi=o(41811),Gi=o(52161);const ki=(0,Wi.default)((t,n)=>{const a=[];if(!n)return a;let s=U.M8.Visualize;if(n.meta.skipDataQuery)return[];n.meta.skipDataQuery||(s=U.M8.Query,a.push({id:U.M8.Query,text:(0,r.t)("dashboard.get-panel-editor-tabs.text.query","Query"),icon:"database",active:!1}),a.push({id:U.M8.Transform,text:(0,r.t)("dashboard.get-panel-editor-tabs.text.transform-data","Transform data"),icon:"process",active:!1})),Hi(n)&&a.push({id:U.M8.Alert,text:(0,r.t)("dashboard.get-panel-editor-tabs.text.alert","Alert"),icon:"bell",active:!1});const i=a.find(l=>l.id===(t||s))??a[0];return i.active=!0,a});function Hi(t){const{unifiedAlertingEnabled:n=!1}=(0,ut.zj)(),a=S.TP.hasPermission((0,mn.Wd)(Gi.hY).read);if(!(n&&a))return!1;const i=t.meta.id==="graph",l=t.meta.id==="timeseries";return i||l}var Qi=o(61215);const Ji=(t,n)=>{const a=t.panelEditor.getPanel(),s=Qt(t,a);return{panel:a,plugin:s?.plugin,instanceState:s?.instanceState,initDone:t.panelEditor.initDone,uiState:t.panelEditor.ui,tableViewEnabled:t.panelEditor.tableViewEnabled,variables:(0,te.SS)(n.dashboard.uid,t)}},Yi={initPanelEditor:Pn,discardPanelChanges:Dt,updatePanelEditorUIState:_e,updateTimeZoneForSession:Ys.Cj,toggleTableView:le.kw,notifyApp:G.dx},Zi=(0,B.connect)(Ji,Yi);class Xi extends v.PureComponent{constructor(){super(...arguments),this.state={showSaveLibraryPanelModal:!1},this.triggerForceUpdate=()=>{this.forceUpdate()},this.onBack=()=>{j.Ny.partial({editPanel:null,tab:null,showCategory:null})},this.onDiscard=()=>{this.props.discardPanelChanges(),this.onBack()},this.onSaveDashboard=()=>{Bt.lE.publish(new _.S8({component:_s.$,props:{dashboard:this.props.dashboard}}))},this.onSaveLibraryPanel=async()=>{(0,an.X)(this.props.panel)&&this.setState({showSaveLibraryPanelModal:!0})},this.onChangeTab=n=>{j.Ny.partial({tab:n.id})},this.onFieldConfigChange=n=>{this.props.panel.updateFieldConfig({...n})},this.onPanelOptionsChanged=n=>{this.props.panel.updateOptions(n)},this.onPanelConfigChanged=(n,a)=>{this.props.panel.setProperty(n,a),this.props.panel.render(),this.forceUpdate()},this.onDisplayModeChange=n=>{const{updatePanelEditorUIState:a}=this.props;this.props.tableViewEnabled&&this.props.toggleTableView(),a({mode:n})},this.onToggleTableView=()=>{this.props.toggleTableView()},this.onGoBackToDashboard=()=>{j.Ny.partial({editPanel:null,tab:null,showCategory:null})},this.onConfirmAndDismissLibarayPanelModel=()=>{this.setState({showSaveLibraryPanelModal:!1})}}componentDidMount(){this.props.initPanelEditor(this.props.sourcePanel,this.props.dashboard)}componentDidUpdate(){const{panel:n,initDone:a}=this.props;a&&!this.eventSubs&&(this.eventSubs=new _t.yU,this.eventSubs.add(n.events.subscribe(_.PR,this.triggerForceUpdate)))}componentWillUnmount(){this.eventSubs?.unsubscribe()}renderPanel(n,a){const{dashboard:s,panel:i,uiState:l,tableViewEnabled:d,theme:c}=this.props;return(0,e.jsxs)("div",{className:n.mainPaneWrapper,children:[this.renderPanelToolbar(n),(0,e.jsx)("div",{className:n.panelWrapper,children:(0,e.jsx)(mt.Ay,{children:({width:h,height:u})=>{if(h<3||u<3)return null;if(a&&(u-=c.spacing.gridSize*2),d)return(0,e.jsx)(Ti,{width:h,height:u,panel:i,dashboard:s});const g=(0,Qi.A)(l.mode,h,u,i);return(0,e.jsx)("div",{className:n.centeringContainer,style:{width:h,height:u},children:(0,e.jsx)("div",{style:g,"data-panelid":i.id,children:(0,e.jsx)(Xs.L,{stateKey:i.key,dashboard:s,panel:i,isEditing:!0,isViewing:!1,lazy:!1,width:g.width,height:g.height},i.key)})})}})})]},"panel")}renderPanelAndEditor(n,a){const{panel:s,dashboard:i,plugin:l,tab:d}=this.props,c=ki(d,l),h=c.length===0,u=this.renderPanel(a,h);return c.length===0?(0,e.jsx)("div",{className:a.onlyPanel,children:u}):(0,e.jsxs)(tn.g,{splitOrientation:"horizontal",maxSize:-200,paneSize:n.topPaneSize,primary:"first",secondaryPaneStyle:{minHeight:0},onDragFinished:g=>{g&&_e({topPaneSize:g/window.innerHeight})},children:[u,(0,e.jsx)("div",{className:a.tabsWrapper,"data-testid":b.Tp.components.PanelEditor.DataPane.content,children:(0,e.jsx)(bn,{panel:s,dashboard:i,tabs:c,onChangeTab:this.onChangeTab},s.key)},"panel-editor-tabs")]})}renderTemplateVariables(n){const{variables:a}=this.props;return a.length?(0,e.jsx)("div",{className:n.variablesWrapper,children:(0,e.jsx)(nn,{variables:a})}):null}renderPanelToolbar(n){const{dashboard:a,uiState:s,variables:i,updateTimeZoneForSession:l,panel:d,tableViewEnabled:c}=this.props;return(0,e.jsx)("div",{className:n.panelToolbar,children:(0,e.jsxs)(L.B,{justifyContent:i.length>0?"space-between":"flex-end",alignItems:"flex-start",children:[this.renderTemplateVariables(n),(0,e.jsxs)(L.B,{gap:1,children:[(0,e.jsx)(Ie.K,{label:(0,r.t)("dashboard.panel-editor-unconnected.table-view-label-table-view","Table view"),showLabel:!0,id:"table-view",value:c,onClick:this.onToggleTableView,"data-testid":b.Tp.components.PanelEditor.toggleTableView}),(0,e.jsx)(Fe.z,{value:s.mode,options:U.Nt,onChange:this.onDisplayModeChange}),(0,e.jsx)(qs.$,{dashboard:a,onChangeTimeZone:l,isOnCanvas:!0}),!s.isPanelOptionsVisible&&(0,e.jsx)(jt,{panel:d})]})]})})}renderEditorActions(){let a=[(0,e.jsx)(f.$n,{onClick:this.onDiscard,title:(0,r.t)("dashboard.panel-editor-unconnected.editor-actions.title-undo-all-changes","Undo all changes"),size:"sm",variant:"destructive",fill:"outline",children:(0,e.jsx)(r.x6,{i18nKey:"dashboard.panel-editor-unconnected.editor-actions.discard",children:"Discard"})},"discard"),this.props.dashboard.meta.canSave&&(this.props.panel.libraryPanel?(0,e.jsx)(f.$n,{onClick:this.onSaveLibraryPanel,variant:"primary",size:"sm",title:(0,r.t)("dashboard.panel-editor-unconnected.editor-actions.title-apply-changes-and-save-library-panel","Apply changes and save library panel"),children:(0,e.jsx)(r.x6,{i18nKey:"dashboard.panel-editor-unconnected.editor-actions.save-library-panel",children:"Save library panel"})},"save-panel"):(0,e.jsx)(f.$n,{onClick:this.onSaveDashboard,title:(0,r.t)("dashboard.panel-editor-unconnected.editor-actions.title-apply-changes-and-save-dashboard","Apply changes and save dashboard"),size:"sm",variant:"secondary",children:(0,e.jsx)(r.x6,{i18nKey:"dashboard.panel-editor-unconnected.editor-actions.save",children:"Save"})},"save")),(0,e.jsx)(f.$n,{onClick:this.onBack,variant:"primary",title:(0,r.t)("dashboard.panel-editor-unconnected.editor-actions.title-apply-changes-dashboard","Apply changes and go back to dashboard"),"data-testid":b.Tp.components.PanelEditor.applyButton,size:"sm",children:(0,e.jsx)(r.x6,{i18nKey:"dashboard.panel-editor-unconnected.editor-actions.apply",children:"Apply"})},"apply")];return this.props.panel.libraryPanel&&(a.splice(1,0,(0,e.jsx)(fe.$s,{children:({showModal:s,hideModal:i})=>(0,e.jsx)(xt.I,{onClick:()=>{s(Zs.l,{onConfirm:()=>{this.props.panel.unlinkLibraryPanel(),this.forceUpdate()},onDismiss:i,isOpen:!0})},title:(0,r.t)("dashboard.panel-editor-unconnected.title-unlink","Disconnects this panel from the library panel so that you can edit it regularly."),children:(0,e.jsx)(r.x6,{i18nKey:"dashboard.panel-editor-unconnected.unlink",children:"Unlink"})},"unlink")},"unlink-controller")),a.pop()),a}renderOptionsPane(){const{plugin:n,dashboard:a,panel:s,instanceState:i}=this.props;return n?(0,e.jsx)(vi,{plugin:n,dashboard:a,panel:s,instanceState:i,onFieldConfigsChange:this.onFieldConfigChange,onPanelOptionsChanged:this.onPanelOptionsChanged,onPanelConfigChange:this.onPanelConfigChanged}):(0,e.jsx)("div",{})}render(){const{initDone:n,uiState:a,theme:s,sectionNav:i,pageNav:l,className:d,updatePanelEditorUIState:c}=this.props,h=_i(s,this.props);return n?(0,e.jsxs)(E.Y,{navModel:i,pageNav:l,"data-testid":b.Tp.components.PanelEditor.General.content,layout:F.k.Custom,className:d,children:[(0,e.jsx)(wt.H,{actions:(0,e.jsx)(Mt.U,{alignment:"right",children:this.renderEditorActions()})}),(0,e.jsxs)("div",{className:h.wrapper,children:[(0,e.jsx)("div",{className:h.verticalSplitPanesWrapper,children:a.isPanelOptionsVisible?(0,e.jsxs)(tn.g,{splitOrientation:"vertical",maxSize:-300,paneSize:a.rightPaneSize,primary:"second",onDragFinished:u=>{u&&c({rightPaneSize:u/window.innerWidth})},children:[this.renderPanelAndEditor(a,h),this.renderOptionsPane()]}):this.renderPanelAndEditor(a,h)}),this.state.showSaveLibraryPanelModal&&(0,e.jsx)(re,{panel:this.props.panel,folderUid:this.props.dashboard.meta.folderUid??"",onConfirm:this.onConfirmAndDismissLibarayPanelModel,onDiscard:this.onDiscard,onDismiss:this.onConfirmAndDismissLibarayPanelModel})]})]}):null}}const qi=(0,y.cV)(Zi(Xi)),_i=(0,en.N)((t,n)=>{const{uiState:a}=n,s=t.spacing(2);return{wrapper:(0,p.css)({width:"100%",flexGrow:1,minHeight:0,display:"flex",paddingTop:t.spacing(2)}),verticalSplitPanesWrapper:(0,p.css)({display:"flex",flexDirection:"column",height:"100%",width:"100%",position:"relative"}),mainPaneWrapper:(0,p.css)({display:"flex",flexDirection:"column",height:"100%",width:"100%",paddingRight:`${a.isPanelOptionsVisible?0:s}`}),variablesWrapper:(0,p.css)({label:"variablesWrapper",display:"flex",flexGrow:1,flexWrap:"wrap",gap:t.spacing(1,2)}),panelWrapper:(0,p.css)({flex:"1 1 0",minHeight:0,width:"100%",paddingLeft:s}),tabsWrapper:(0,p.css)({height:"100%",width:"100%"}),panelToolbar:(0,p.css)({display:"flex",padding:`0 0 ${s} ${s}`,justifyContent:"space-between",flexWrap:"wrap"}),angularWarning:(0,p.css)({display:"flex",height:t.spacing(4),alignItems:"center"}),toolbarLeft:(0,p.css)({paddingLeft:t.spacing(1)}),centeringContainer:(0,p.css)({display:"flex",justifyContent:"center",alignItems:"center",position:"relative",flexDirection:"column"}),onlyPanel:(0,p.css)({height:"100%",position:"absolute",overflow:"hidden",width:"100%"})}});var eo=o(23753),to=o(97095),no=o(18027),ao=o(39884),so=o(32380);const io=({annotation:t,events:n,onEnabledChanged:a})=>{const[s,i]=(0,v.useState)(!1),l=(0,y.of)(oo),d=()=>(0,so.Dh)().cancel(t);return(0,v.useEffect)(()=>{const c=n.getStream(_.xc).subscribe({next:u=>{u.payload===t&&i(!0)}}),h=n.getStream(_.yj).subscribe({next:u=>{u.payload===t&&i(!1)}});return()=>{c.unsubscribe(),h.unsubscribe()}}),(0,e.jsx)("div",{className:l.annotation,children:(0,e.jsxs)(to.C,{children:[(0,e.jsx)(no.I,{label:t.name,disabled:s,"data-testid":b.Tp.pages.Dashboard.SubMenu.Annotations.annotationLabel(t.name),children:(0,e.jsx)(Ie.K,{label:t.name,value:t.enable,onChange:()=>a(t),disabled:s,"data-testid":b.Tp.pages.Dashboard.SubMenu.Annotations.annotationToggle(t.name)})}),(0,e.jsx)("div",{className:l.indicator,children:(0,e.jsx)(ao.I,{loading:s,onCancel:d})})]})},t.name)};function oo(t){return{annotation:(0,p.css)({display:"inline-block",marginRight:t.spacing(1),".fa-caret-down":{fontSize:"75%",paddingLeft:t.spacing(1)},".gf-form-inline .gf-form":{marginBottom:0}}),indicator:(0,p.css)({alignSelf:"center",padding:`0 ${t.spacing(.5)}`})}}const ro=({annotations:t,onAnnotationChanged:n,events:a})=>{const[s,i]=(0,v.useState)([]);return(0,v.useEffect)(()=>{i(t.filter(l=>l.hide!==!0))},[t]),s.length===0?null:(0,e.jsx)("div",{"data-testid":b.Tp.pages.Dashboard.SubMenu.Annotations.annotationsWrapper,children:s.map(l=>(0,e.jsx)(io,{events:a,annotation:l,onEnabledChanged:n},l.name))})};var lo=o(94701),co=o(63704),ho=o(82345),fn=o(4137);const uo=({dashboard:t,links:n})=>{const a=(0,hn.C)();return(0,lo.A)(()=>{const s=t.events.subscribe(dn.sR,a);return()=>s.unsubscribe()}),n.length?(0,e.jsx)(e.Fragment,{children:n.map((s,i)=>{const l=(0,ho.mQ)().getAnchorInfo(s),d=`${s.title}-$${i}`;if(s.type==="dashboards")return(0,e.jsx)(fn.aK,{link:s,linkInfo:l,dashboardUID:t.uid},d);const c=gt.G[s.icon],h=(0,e.jsx)(fn.Zx,{href:(0,co.Jf)(l.href),target:s.targetBlank?"_blank":void 0,rel:"noreferrer","data-testid":b.Tp.components.DashboardLinks.link,icon:c,children:l.title});return(0,e.jsx)("div",{"data-testid":b.Tp.components.DashboardLinks.container,children:s.tooltip?(0,e.jsx)(Be.m,{content:l.tooltip,children:h}):h},d)})}):null};class po extends v.PureComponent{constructor(){super(...arguments),this.onAnnotationStateChanged=n=>{for(let a=0;a<this.props.dashboard.annotations.list.length;a++){const s=this.props.dashboard.annotations.list[a];if(s.name===n.name){s.enable=!s.enable;break}}this.props.dashboard.startRefresh(),this.forceUpdate()},this.disableSubmitOnEnter=n=>{n.preventDefault()}}render(){const{dashboard:n,variables:a,links:s,annotations:i,theme:l}=this.props,d=vo(l),c=n.meta.isSnapshot??!1;return(0,e.jsxs)("div",{className:d.submenu,children:[(0,e.jsx)("form",{"aria-label":(0,r.t)("dashboard.sub-menu-un-connected.aria-label-template-variables","Template variables"),className:d.formStyles,onSubmit:this.disableSubmitOnEnter,children:(0,e.jsx)(nn,{variables:a,readOnly:c})}),(0,e.jsx)(ro,{annotations:i,onAnnotationChanged:this.onAnnotationStateChanged,events:n.events}),(0,e.jsx)("div",{className:d.spacer}),n&&(0,e.jsx)(uo,{dashboard:n,links:s})]})}}const go=(t,n)=>{const{uid:a}=n.dashboard,s=(0,te.nx)(a,t);return{variables:(0,te.pi)(a,s.variables)}},vo=(0,en.N)(t=>({formStyles:(0,p.css)({display:"contents",flexWrap:"wrap"}),submenu:(0,p.css)({display:"flex",flexDirection:"row",flexWrap:"wrap",alignContent:"flex-start",alignItems:"flex-start",gap:`${t.spacing(1)} ${t.spacing(2)}`,padding:`0 0 ${t.spacing(1)} 0`}),spacer:(0,p.css)({flexGrow:1})})),xn=(0,y.cV)((0,B.connect)(go)(po));xn.displayName="SubMenu";var mo=o(77598),bo=o(4405),fo=o(27081),yn=o(99362);const xo=t=>({initPhase:t.dashboard.initPhase,initError:t.dashboard.initError,dashboard:t.dashboard.getModel(),navIndex:t.navIndex}),yo={initDashboard:fo.v,cleanUpDashboardAndVariables:$e.Bz,notifyApp:G.dx,cancelVariables:he.Y7,templateVarsChangedInUrl:he.Hn},jo=(0,B.connect)(xo,yo),So=t=>({fullScreenPanel:(0,p.css)({".react-grid-layout":{height:"auto !important",transitionProperty:"none"},".react-grid-item":{display:"none !important",transitionProperty:"none !important","&--fullscreen":{display:"block !important",position:"unset !important",transform:"translate(0px, 0px) !important"}},".panel-header:hover":{backgroundColor:"inherit"},".panel-title-container":{cursor:"pointer"},".react-resizable-handle":{display:"none"}})});class Po extends v.PureComponent{constructor(){super(...arguments),this.forceRouteReloadCounter=0,this.state=this.getCleanState(),this.updateLiveTimer=()=>{let n;this.props.dashboard?.liveNow&&(n=(0,Pe.jG)().timeRange()),bo.a.setLiveTimeRange(n)},this.setScrollRef=n=>{this.setState({scrollElement:n})},this.onCloseShareModal=()=>{j.Ny.partial({shareView:null})}}static{this.contextType=H.YE}getCleanState(){return{editView:null,editPanel:null,viewPanel:null,showLoadingState:!1,panelNotFound:!1,editPanelAccessDenied:!1}}componentDidMount(){this.initDashboard(),this.forceRouteReloadCounter=this.props.location.state?.routeReloadCounter||0}componentWillUnmount(){this.closeDashboard()}closeDashboard(){this.props.cleanUpDashboardAndVariables(),this.setState(this.getCleanState())}initDashboard(){const{dashboard:n,params:a,queryParams:s}=this.props;n&&this.closeDashboard(),this.props.initDashboard({urlSlug:a.slug,urlUid:a.uid,urlType:a.type,urlFolderUid:s.folderUid,panelType:s.panelType,routeName:this.props.route.routeName,fixUrl:!0,accessToken:a.accessToken,keybindingSrv:this.context.keybindings}),setTimeout(this.updateLiveTimer,250)}componentDidUpdate(n,a){const{dashboard:s,params:i,templateVarsChangedInUrl:l}=this.props,d=this.props.location.state?.routeReloadCounter;if(s){if(n.params.uid!==i.uid||d!==void 0&&this.forceRouteReloadCounter!==d){this.initDashboard(),this.forceRouteReloadCounter=d;return}if(n.location.search!==this.props.location.search){const c=n.queryParams,h=this.props.queryParams;(h?.from!==c?.from||h?.to!==c?.to)&&((0,Pe.jG)().updateTimeRangeFromUrl(),this.updateLiveTimer()),!c?.refresh&&h?.refresh&&(0,Pe.jG)().setAutoRefresh(h.refresh);const u=(0,A.Wz)(this.props.queryParams,n.queryParams);u&&l(s.uid,u)}this.state.editPanel&&!a.editPanel&&(be.t.setEditingState(!0),this.props.dashboard?.events.publish(new _.sL(this.state.editPanel.id))),!this.state.editPanel&&a.editPanel&&(be.t.setEditingState(!1),this.props.dashboard?.events.publish(new _.i0(a.editPanel.id))),this.state.editPanelAccessDenied&&(this.props.notifyApp((0,se.gi)("Permission to edit panel denied")),j.Ny.partial({editPanel:null})),this.state.panelNotFound&&(this.props.notifyApp((0,se.gi)("Panel not found")),j.Ny.partial({editPanel:null,viewPanel:null})),this.state.updateScrollTop!==void 0&&this.state.updateScrollTop!==a.updateScrollTop&&this.state.scrollElement?.scrollTo(0,this.state.updateScrollTop)}}static getDerivedStateFromProps(n,a){const{dashboard:s,queryParams:i}=n,l=i.editPanel,d=i.viewPanel,c=i.editview;if(!s)return a;const h={...a};if(!a.editView&&c?(h.editView=c,h.rememberScrollTop=a.scrollElement?.scrollTop,h.updateScrollTop=0):a.editView&&!c&&(h.updateScrollTop=a.rememberScrollTop,h.editView=null),!a.editPanel&&l){const u=s.getPanelByUrlId(l);u?s.canEditPanel(u)?(h.editPanel=u,h.rememberScrollTop=a.scrollElement?.scrollTop):h.editPanelAccessDenied=!0:h.panelNotFound=!0}else a.editPanel&&!l&&(h.editPanel=null,h.updateScrollTop=a.rememberScrollTop);if(!a.viewPanel&&d){const u=s.getPanelByUrlId(d);u?(s.initViewPanel(u),h.viewPanel=u,h.rememberScrollTop=a.scrollElement?.scrollTop,h.updateScrollTop=0):h.panelNotFound=!0}else a.viewPanel&&!d&&(s.exitViewPanel(a.viewPanel),h.viewPanel=null,h.updateScrollTop=a.rememberScrollTop);return(a.panelNotFound||a.editPanelAccessDenied&&!l)&&(h.panelNotFound=!1,h.editPanelAccessDenied=!1),Co(n,h)}getInspectPanel(){const{dashboard:n,queryParams:a}=this.props,s=a.inspect;if(!n||!s)return null;const i=n.getPanelById(parseInt(s,10));return i||null}render(){const{dashboard:n,initError:a,queryParams:s,theme:i,params:l}=this.props,{editPanel:d,viewPanel:c,pageNav:h,sectionNav:u}=this.state,g=me(this.props.queryParams),m=So(i);if(!n||!h||!u)return(0,e.jsx)(Ve.P,{initPhase:this.props.initPhase});const x=this.getInspectPanel(),N=!d&&!g&&!this.props.queryParams.editview&&n.isSubMenuVisible(),D=g!==K.d9.Full&&!s.editview&&!a,P=(0,p.cx)({[m.fullScreenPanel]:!!c,"page-hidden":!!(s.editview||d)});return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsxs)(E.Y,{navModel:u,pageNav:h,layout:F.k.Canvas,className:P,onSetScrollRef:this.setScrollRef,children:[D&&(0,e.jsx)("header",{"data-testid":b.Tp.pages.Dashboard.DashNav.navV2,children:(0,e.jsx)(Ze.Ay,{dashboard:n,title:n.title,folderTitle:n.meta.folderTitle,isFullscreen:!!c,kioskMode:g,hideTimePicker:n.timepicker.hidden})}),(0,e.jsx)(Tt,{dashboard:n}),a&&(0,e.jsx)(yn.i,{error:a.error,type:l.type}),N&&(0,e.jsx)("section",{"aria-label":b.Tp.pages.Dashboard.SubMenu.submenu,children:(0,e.jsx)(xn,{dashboard:n,annotations:n.annotations.list,links:n.links})}),!a&&(0,e.jsx)(mo.N,{dashboard:n,isEditable:!!n.meta.canEdit,viewPanel:c,editPanel:d}),x&&(0,e.jsx)(Gs,{dashboard:n,panel:x}),s.shareView&&(0,e.jsx)(eo.Zy,{dashboard:n,onDismiss:this.onCloseShareModal,activeTab:s.shareView})]}),d&&(0,e.jsx)(qi,{dashboard:n,sourcePanel:d,tab:this.props.queryParams.tab,sectionNav:u,pageNav:h}),s.editview&&(0,e.jsx)(xs,{dashboard:n,editview:s.editview,pageNav:h,sectionNav:u})]})}}function Co(t,n){const{dashboard:a,navIndex:s}=t;if(!a)return n;let i=n.pageNav,l=n.sectionNav;(!i||a.title!==i.text||a.meta.folderUrl!==i.parentItem?.url)&&(i={text:a.title,url:W.I.getUrlForPartial(t.location,{editview:null,editPanel:null,viewPanel:null})}),l=(0,Ce.tc)(t.navIndex,Le.L1+a.uid,(0,Ce.tc)(t.navIndex,"dashboards/browse"));const{folderUid:d}=a.meta;if(d&&i&&l.main.id!=="starred"){const c=(0,Ce.tc)(s,`folder-dashboards-${d}`).main;c.id!=="not-found"&&(i={...i,parentItem:c})}return(n.editPanel||n.viewPanel)&&(i={...i,text:`${n.editPanel?"Edit":"View"} panel`,parentItem:i,url:void 0}),n.pageNav===i&&n.sectionNav===l?n:{...n,pageNav:i,sectionNav:l}}const jn=(0,y.cV)(Po);jn.displayName="DashboardPage";const Sn=jo(jn);function Do(t){const n=t.queryParams.scenes===!0,a=t.queryParams.scenes===!1,s=(0,I.g)(),i=(0,I.zy)(),l=(0,z.sP)();if(n||M.$.featureToggles.dashboardScene&&!a)return(0,e.jsx)(k.default,{...t});const d=!!(t.route.routeName===K.Z4.Home||t.route.routeName===K.Z4.Normal&&s.uid),c=(0,V.A)(async()=>s.type==="snapshot"?null:l.fetchDashboard({route:t.route.routeName,uid:s.uid??"",type:s.type,slug:s.slug}),[s.uid,t.route.routeName]);if(c.error)return(0,e.jsx)(yn.i,{error:c.error});if(c.loading)return null;const h=c.value&&(0,$.HG)(c.value)?c.value.metadata.name:c.value?.meta.uid,u=c.value&&(0,$.HG)(c.value)?c.value?.access.canEdit:c.value?.meta?.canEdit||c.value?.meta?.canMakeEditable,g=!h;return h!==s.uid&&!g?null:M.$.featureToggles.dashboardSceneForViewers?!u&&d&&!a?(0,e.jsx)(k.default,{...t}):(0,e.jsx)(Sn,{...t,params:s,location:i}):(0,e.jsx)(Sn,{...t,params:s,location:i})}const To=Do},96727:(ye,J,o)=>{o.d(J,{H:()=>V});var e=o(63704),I=o(74101);const V=()=>{const[M]=(0,I.z)(),k=M.get("pull_request_url"),z=M.get("new_pull_request_url"),K=M.get("repo_url"),$=M.get("repo_type");return{prURL:k?e.sQ.sanitizeUrl(k):void 0,newPrURL:z?e.sQ.sanitizeUrl(z):void 0,repoURL:K?e.sQ.sanitizeUrl(K):void 0,repoType:$?e.sQ.sanitizeUrl($):void 0}}},99362:(ye,J,o)=>{o.d(J,{i:()=>p});var e=o(74848),I=o(75683),V=o(92745),M=o(34999),k=o(31286),z=o(13791),K=o(1506),$=o(47797);function p({error:v,type:B}){const F=(0,$.do)(v),W=(0,$.q6)(v),b=B==="snapshot"?"Snapshot":"Dashboard";return(0,e.jsx)(z.Y,{navId:"dashboards/browse",layout:I.k.Canvas,pageNav:{text:(0,V.t)("dashboard.dashboard-page-error.text.not-found","Not found")},children:(0,e.jsx)(k.a,{paddingY:4,display:"flex",direction:"column",alignItems:"center",children:F===404?(0,e.jsx)(K.L,{entity:b}):(0,e.jsx)(M.F,{title:(0,V.t)("dashboard.errors.failed-to-load","Failed to load dashboard"),severity:"error","data-testid":"dashboard-page-error",children:W})})})}}}]);

//# sourceMappingURL=2603.0f4d4cfba59fc830935c.js.map